/*! For license information please see agmqk6.7.84fb4e06.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{13566:R=>{"use strict";R.exports=function(R,x,H,k,c,t){var A=+x[0],D=+x[1],U=+x[2],J=+H[0],V=+H[1],n=+H[2],g=Math.sqrt(J*J+V*V+n*n);if(0===g)throw new Error("Can't raycast along a zero vector");return function(R,x,H,k,c,t,A,D,U,J){for(var V=0,n=Math.floor,g=0|n(x),I=0|n(H),i=0|n(k),q=c>0?1:-1,S=t>0?1:-1,L=A>0?1:-1,b=Math.abs(1/c),C=Math.abs(1/t),F=Math.abs(1/A),d=b<1/0?b*(q>0?g+1-x:x-g):1/0,P=C<1/0?C*(S>0?I+1-H:H-I):1/0,a=F<1/0?F*(L>0?i+1-k:k-i):1/0,X=-1;V<=D;){var M=R(g,I,i);if(M)return U&&(U[0]=x+V*c,U[1]=H+V*t,U[2]=k+V*A),J&&(J[0]=J[1]=J[2]=0,0===X&&(J[0]=-q),1===X&&(J[1]=-S),2===X&&(J[2]=-L)),M;d<P?d<a?(g+=q,V=d,d+=b,X=0):(i+=L,V=a,a+=F,X=2):P<a?(I+=S,V=P,P+=C,X=1):(i+=L,V=a,a+=F,X=2)}return U&&(U[0]=x+V*c,U[1]=H+V*t,U[2]=k+V*A),J&&(J[0]=J[1]=J[2]=0),0}(R,A,D,U,J/=g,V/=g,n/=g,k="undefined"===typeof k?64:+k,c,t)}},13609:(R,x,H)=>{"use strict";H.d(x,{d:()=>t});var k=H(82);function c(){this.Vl=!1,this.stopPropagation=!1,this.Wl=!1,this.disabled=!1}class t{constructor(R,x){this.version="0.7.0";var H=Object.assign({},new c,x||{});this.element=R||document,this.Vl=!!H.Vl,this.stopPropagation=!!H.stopPropagation,this.Wl=!!H.Wl,this.disabled=!!H.disabled,this.filterEvents=(R,x)=>!0,this.down=new k.EventEmitter,this.up=new k.EventEmitter,this.state={},this.Ik={dx:0,dy:0,Cm:0,Te:0,Dm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?D(this):document.addEventListener("DOMContentLoaded",(R=>{D(this)}),{once:!0})}bind(R){for(var x=arguments.length,H=new Array(x>1?x-1:0),k=1;k<x;k++)H[k-1]=arguments[k];H.forEach((x=>{var H=this._keyBindmap[x]||[];H.includes(R)||(H.push(R),this._keyBindmap[x]=H)})),this.state[R]=!!this.state[R],this.pressCount[R]=this.pressCount[R]||0,this.releaseCount[R]=this.releaseCount[R]||0}unbind(R){for(var x in this._keyBindmap){var H=this._keyBindmap[x],k=H.indexOf(R);k>-1&&H.splice(k,1)}}getBindings(){var R={};for(var x in this._keyBindmap){this._keyBindmap[x].forEach((H=>{R[H]=R[H]||[],R[H].push(x)}))}return R}hf(){A(this.Ik),A(this.pressCount),A(this.releaseCount)}}function A(R){for(var x in R)R[x]=0}function D(R){window.addEventListener("keydown",i.bind(null,R,!0),!1),window.addEventListener("keyup",i.bind(null,R,!1),!1);var x={passive:!0};R.element.addEventListener("touchstart",n.bind(void 0,R),{passive:!1}),R.element.addEventListener("touchend",I.bind(void 0,R),x),R.element.addEventListener("mousedown",q.bind(null,R,!0),x),window.document.addEventListener("mouseup",q.bind(null,R,!1),x),R.element.addEventListener("touchmove",S.bind(null,R),x),R.element.addEventListener("mousemove",S.bind(null,R),x),window.PointerEvent,R.element.addEventListener("wheel",L.bind(null,R),x),R.element.addEventListener("contextmenu",b.bind(null,R),!1),window.addEventListener("blur",C.bind(null,R),!1)}var U=0,J=0,V=null;function n(R,x){x.preventDefault(),g(x)}function g(R){let x=!1;for(let H=0;H<R.touches.length;++H)if(R.touches[H].identifier===V){x=!0;break}if(!x){const x=R.changedTouches[0];U=x.clientX,J=x.clientY,V=x.identifier}}function I(R,x){for(var H=x.changedTouches,k=0;k<H.length;++k)H[k].identifier===V&&(V=null)}function i(R,x,H){F(H.code,x,R,H)}function q(R,x,H){if("pointerId"in H)if(x){if(null!==R._touches.currID)return;R._touches.currID=H.pointerId}else{if(R._touches.currID!==H.pointerId)return;R._touches.currID=null}return F("Mouse"+("button"in H?H.button+1:1),x,R,H),!1}function S(R,x){var H=x.movementX||x.mozMovementX||0,k=x.movementY||x.mozMovementY||0;if(x.touches&&0===(H|k)){var c=function(R){g(R);for(let x=0;x<R.changedTouches.length;++x)if(R.changedTouches[x].identifier==V){const H=R.changedTouches[x],k=[H.clientX-U,H.clientY-J];return U=H.clientX,J=H.clientY,k}return console.error(`Did not find touch id ${V}`),[0,0]}(x);H=c[0],k=c[1]}R.Ik.dx+=H,R.Ik.dy+=k}function L(R,x){var H=1;switch(x.deltaMode){case 0:H=1;break;case 1:H=12;break;case 2:H=R.element.clientHeight||window.innerHeight}R.Ik.Cm+=(x.deltaX||0)*H,R.Ik.Te+=(x.deltaY||0)*H,R.Ik.Dm+=(x.deltaZ||0)*H}function b(R,x){if(!R.Wl)return x.preventDefault(),!1}function C(R){for(var x in R._keyStates)R._keyStates[x]&&(/^Mouse\d/.test(x)||F(x,!1,R,{code:x,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function F(R,x,H,k){var c=H._keyBindmap[R];c&&(d(H._keyStates[R],x)&&(H._keyStates[R]=x,c.forEach((R=>{(!H.filterEvents||H.filterEvents(k,R))&&function(R,x,H,k){var c=x?H.pressCount:H.releaseCount;c[R]=(c[R]||0)+1;var t=H._bindPressCount[R]||0;(t+=x?1:-1)<0&&(t=0);H._bindPressCount[R]=t;var A=H.state[R];if(d(A,t)){H.state[R]=t>0;var D=x?H.down:H.up;H.disabled||D.emit(R,k)}}(R,x,H,k)}))),"button"in k||(H.Vl&&!k.defaultPrevented&&k.preventDefault(),H.stopPropagation&&k.stopPropagation()))}function d(R,x){return R?!x:x}},13575:(R,x,H)=>{"use strict";H.d(x,{c:()=>k});class k{constructor(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.al=!1,this.bl=!1,this.Uh=30,this._k=0,this.il=!1,this.fullscreen=!1,this.dl=function(R){},this.el=function(){},this.gl=function(){},this.k=function(){},this.fl=function(R){},this.onFullscreenChanged=function(R){},J((()=>{!function(R,x){R._nowObject=performance||Date,R._lastTick=0,R._renderAccum=0,R._rt=0,R._frameCB=D.bind(null,R),requestAnimationFrame(R._frameCB),x>0&&(R._intervalCB=A.bind(null,R),R._interval=setInterval(R._intervalCB,Math.max(x,1e3/R.Uh/2)))}(this,x),function(R,x){if(!x)return;var H=!1,k=!1;document.addEventListener("pointerlockchange",(k=>{H=document.pointerLockElement===x,R.fl(H)})),document.addEventListener("fullscreenchange",(H=>{k=document.fullscreenElement===x,R.onFullscreenChanged(k)})),Object.defineProperty(R,"il",{get:()=>H,set:R=>{R&&!H?U(x):H&&!R&&function(R){R.exitPointerLock&&R.exitPointerLock()}(document)}}),Object.defineProperty(R,"fullscreen",{get:()=>k,set:R=>{R&&!k?x.requestFullscreen():k&&!R&&document.exitFullscreen()}}),x.addEventListener("click",(c=>{R.al&&!H&&U(x),R.bl&&!k&&x.requestFullscreen()}));var c=()=>R.k();if(window.ResizeObserver){new ResizeObserver(c).observe(x)}else window.addEventListener("resize",c)}(this,R),this.gl()}))}}var c=3,t=20;function A(R){for(var x=1e3/R.Uh,H=R._nowObject.now()+t,k=0;R._nowObject.now()>=R._lastTick+x&&R._nowObject.now()<H&&++k<=c;)R.dl(x),R._lastTick+=x;var A=5*(x+5),D=R._nowObject.now();if(D-R._lastTick>A)for(;D>=R._lastTick+x;)R._lastTick+=x}function D(R){requestAnimationFrame(R._frameCB),A(R);var x=R._nowObject.now(),H=x-R._rt;if(R._rt=x,R._k>0){R._renderAccum+=H;var k=1e3/R._k;if(R._renderAccum<k)return;R._renderAccum=Math.min(R._renderAccum-k,k)}var c=1e3/R.Uh,t=(x-R._lastTick)/c;R.el(H,t,c)}function U(R){R.requestPointerLock&&R.requestPointerLock()}var J=R=>{if("loading"===document.readyState){var x=()=>{document.removeEventListener("readystatechange",x),R()};document.addEventListener("readystatechange",x)}else setTimeout(R,1)}},13613:(R,x,H)=>{"use strict";H.d(x,{c:()=>n});var k=H(894),c=H(129);class t{constructor(R,x,H,t,A,D,U){this.Xh=new k(R.base,R.Yh),this.mass=x,this.friction=H,this.restitution=t,this.Nk=A,this.di=D,this.Ok=!!U,this.Cg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.nh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Zh=c.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=c.create(),this._impulses=c.create(),this._sleepFrameCount=10}loadFromCopy(R){c.i(this.Xh.base,R.Xh.base),c.i(this.Xh.Yh,R.Xh.Yh),c.i(this.Xh.max,R.Xh.max),this.Xh.mag=R.Xh.mag,this.mass=R.mass,this.friction=R.friction,this.restitution=R.restitution,this.Nk=R.Nk,this.di=R.di,this.Ok=R.Ok,this.Cg=R.Cg,this.fluidDrag=R.fluidDrag,this.nh=R.nh,this.preventFallOffEdge=R.preventFallOffEdge,this.rolledBackLastTick=R.rolledBackLastTick,c.i(this.Zh,R.Zh),c.i(this.resting,R.resting),this.inFluid=R.inFluid,this._ratioInFluid=R._ratioInFluid,c.i(this._forces,R._forces),c.i(this._impulses,R._impulses),this._sleepFrameCount=R._sleepFrameCount}setPosition(R){A(R),c.Pg(R,R,this.Xh.base),this.Xh.translate(R),this.Qg()}_e(){return c.clone(this.Xh.base)}applyForce(R){A(R),c.add(this._forces,this._forces,R),this.Qg()}applyImpulse(R){A(R),c.add(this._impulses,this._impulses,R),this.Qg()}Qg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var A=R=>{};var D=H(894),U=H(129),J=H(899);function V(){this.Cg=.1,this.fluidDrag=.4,this.Ej=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function n(R,x,H){R=Object.assign(new V,R),this.gravity=R.gravity||[0,-10,0],this.Cg=R.Cg||.1,this.Ej=R.Ej||2,this.fluidDrag=R.fluidDrag||.4,this.minBounceImpulse=R.minBounceImpulse,this.bodies=[],this.um=R.um,this.testSolid=x,this.testFluid=H}n.prototype.Lh=function(R,x,H,k,c,A){R=R||new D([0,0,0],[1,1,1]),"undefined"==typeof x&&(x=1),"undefined"==typeof H&&(H=1),"undefined"==typeof k&&(k=0),"undefined"==typeof c&&(c=1);var U=new t(R,x,H,k,c,A);return this.bodies.push(U),U},n.prototype.Ph=function(R){var x=this.bodies.indexOf(R);x<0||(this.bodies.splice(x,1),R.Xh=R.di=null)};var g=U.create(),I=U.create(),i=U.create(),q=U.create(),S=U.create(),L=U.create(),b=U.create(),C=new D([0,0,0],[1,1,1]),F=new t(C,1,1,0,1,(()=>{}),!1);function d(R,x,H){return x=H,x*=1-(1-R.ratioInFluid)**2}n.prototype.hf=function(R){R/=1e3;var x=K(0,U.squaredLength(this.gravity));this.bodies.forEach((H=>function(R,x,H,k){U.i(S,x.resting),R.um&&F.loadFromCopy(x);if(x.mass<=0)return U.set(x.Zh,0,0,0),U.set(x._forces,0,0,0),void U.set(x._impulses,0,0,0);var c=k||0===x.Nk;if(function(R,x,H,k){if(x._sleepFrameCount>0)return!1;if(k)return!0;var c=!1,t=.5*H*H*x.Nk;return U.scale(W,R.gravity,t),J(R.testSolid,x.Xh,W,(function(){return c=!0,!0}),!0),c}(R,x,H,c))return;x._sleepFrameCount--,function(R,x){var H=x.Xh,k=Math.floor(H.base[0]),c=Math.floor(H.base[2]),t=Math.floor(H.base[1]),A=Math.floor(H.max[1]);if(!R.testFluid(k,t,c))return x.inFluid=!1,void(x.ratioInFluid=0);var D=1,J=t+1;for(;J<=A&&R.testFluid(k,J,c);)D++,J++;var V=(t+D-H.base[1])/H.Yh[1];V>1&&(V=1);var n=H.Yh[0]*H.Yh[1]*H.Yh[2]*V,g=a;U.scale(g,R.gravity,-R.Ej*n*x.Nk),x.applyForce(g),x.inFluid=!0,x.ratioInFluid=V}(R,x),G(x._forces),G(x._impulses),G(x.Zh),G(x.resting),U.scale(g,x._forces,1/x.mass),U.wh(g,g,R.gravity,x.Nk),U.scale(I,x._impulses,1/x.mass),U.wh(I,I,g,H),U.add(x.Zh,x.Zh,I),x.friction&&(X(R,0,x,I,H),X(R,1,x,I,H),X(R,2,x,I,H));var t=x.fluidDrag>=0?x.fluidDrag:R.fluidDrag,A=x.Cg>=0?x.Cg:R.Cg,D=A,V=A;x.inFluid&&(D=d(x,D,x.fluidDragHoriz>=0?x.fluidDragHoriz:t),V=d(x,V,x.fluidDragVert>=0?x.fluidDragVert:t));D=Math.max(1-D*H/x.mass,0),V=Math.max(1-V*H/x.mass,0),U.set(P,D,V,D),U.multiply(x.Zh,x.Zh,P),U.scale(i,x.Zh,H),U.set(x._forces,0,0,0),U.set(x._impulses,0,0,0),x.Ok&&Q(o,x.Xh);U.i(L,i),U.set(b,0,0,0),x.preventFallOffEdge&&function(R,x,H,k){if(!x.resting[1]||H[1]>0)return;var c=h;Q(c,x.Xh);for(var t=0;t<3;t+=2){U.set(w,0,0,0),w[t]=H[t];var A=!0;(A=(A=(A=(A=A&&!N(R,c.base[0]+w[0]+1e-5,c.base[1],c.base[2]+w[2]+1e-5))&&!N(R,c.max[0]+w[0]-1e-5,c.base[1],c.base[2]+w[2]+1e-5))&&!N(R,c.base[0]+w[0]+1e-5,c.base[1],c.max[2]+w[2]-1e-5))&&!N(R,c.max[0]+w[0]-1e-5,c.base[1],c.max[2]+w[2]-1e-5))?(k[t]=H[t]>0?1:-1,H[t]=0):0===t&&(U.set(f,H[0],0,0),B(R,c,f,k,x.slideOnCollision))}}(R,x,i,b);B(R,x.Xh,i,x.resting,x.slideOnCollision),x.Ok&&function(R,x,H,k){if(x.resting[1]>=0&&!x.inFluid)return;var c=0!==x.resting[0],t=0!==x.resting[2];if(!c&&!t)return;var A=Math.abs(k[0]/k[2]),D=4;if(!c&&A>D)return;if(!t&&A<1/D)return;U.add(y,H.base,k);var V=R.testSolid;J(V,H,k,(function(R,x,H,k){if(1!==x)return!0;k[x]=0}));var n=H.base[1],g=x.inFluid?1.951:1.001,I=Math.floor(n+g)-n;U.set(s,0,I,0);var i=!1;if(J(V,H,s,(function(R,x,H,k){return i=!0,!0})),i)return;U.Pg(E,y,H.base),E[1]=0,B(R,H,E,Z,!0);var q=K(H.base[0],y[0]),S=K(H.base[2],y[2]);if(c&&!q&&(!S||!t))return;if(t&&(!q||!c)&&!S)return;var L=!0;if(L=L&&!N(R,H.base[0]+1e-5,H.base[1],H.base[2]+1e-5),L=L&&!N(R,H.max[0]-1e-5,H.base[1],H.base[2]+1e-5),L=L&&!N(R,H.base[0]+1e-5,H.base[1],H.max[2]-1e-5),L=L&&!N(R,H.max[0]-1e-5,H.base[1],H.max[2]-1e-5),L)return;Q(x.Xh,H),x.resting[0]=Z[0],x.resting[2]=Z[2],x.nh&&x.nh()}(R,x,o,L);for(var n=0;n<3;++n)x.resting[n]=x.resting[n]||b[n],q[n]=0,x.resting[n]&&(S[n]||(q[n]=-x.Zh[n]),x.Zh[n]=0);var C=U.length(q);C>.001&&(U.scale(q,q,x.mass),x.di&&x.di(q),x.restitution>0&&C>R.minBounceImpulse&&(U.scale(q,q,x.restitution),x.applyImpulse(q)));var M=U.squaredLength(x.Zh);M>1e-5&&x.Qg();R.um&&R.um(x)?(x.loadFromCopy(F),x.rolledBackLastTick=!0):x.rolledBackLastTick=!1}(this,H,R,x)))};var P=U.create([0,0,0]);var a=U.create();function X(R,x,H,k,c){var t=H.resting[x],A=k[x];if(!H.alwaysApplyHorizFriction||1!==x){if(0===t)return;if(t*A<=0)return}U.i(M,H.Zh),M[x]=0;var D=U.length(M);if(!K(D,0)){var J=Math.abs(H.friction*R.gravity[x]*c),V=D>J?(D-J)/D:0;H.Zh[(x+1)%3]*=V,H.Zh[(x+2)%3]*=V}}var M=U.create();function B(R,x,H,k,c){return U.set(k,0,0,0),J(R.testSolid,x,H,(function(R,x,H,t){k[x]=H,t[x]=0,c||(t[0]=0,t[1]=0,t[2]=0)}))}var o=new D([],[]),Z=U.create(),y=U.create(),s=U.create(),E=U.create();var w=U.create(),h=new D([],[]),f=U.create();function N(R,x,H,k){return R.testSolid(Math.floor(x),Math.floor(H-1),Math.floor(k))}var W=U.create();function K(R,x){return Math.abs(R-x)<1e-5}function Q(R,x){for(var H=0;H<3;H++)R.base[H]=x.base[H],R.max[H]=x.max[H],R.Yh[H]=x.Yh[H]}var G=function(R){}},12484:function(R,x){!function(R){"use strict";var x=function(R,H){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,x){R.__proto__=x}||function(R,x){for(var H in x)Object.prototype.hasOwnProperty.call(x,H)&&(R[H]=x[H])},x(R,H)};function H(R,H){if("function"!==typeof H&&null!==H)throw new TypeError("Class extends value "+String(H)+" is not a constructor or null");function k(){this.constructor=R}x(R,H),R.prototype=null===H?Object.create(H):(k.prototype=H.prototype,new k)}function k(R,x,H,k){var c,t=arguments.length,A=t<3?x:null===k?k=Object.getOwnPropertyDescriptor(x,H):k;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)A=Reflect.decorate(R,x,H,k);else for(var D=R.length-1;D>=0;D--)(c=R[D])&&(A=(t<3?c(A):t>3?c(x,H,A):c(x,H))||A);return t>3&&A&&Object.defineProperty(x,H,A),A}function c(R,x,H){if(H||2===arguments.length)for(var k,c=0,t=x.length;c<t;c++)!k&&c in x||(k||(k=Array.prototype.slice.call(x,0,c)),k[c]=x[c]);return R.concat(k||Array.prototype.slice.call(x))}var t,A=255,D=213;R.OPERATION=void 0,(t=R.OPERATION||(R.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var U=function(){function x(R,x,H){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=R,this.setParent(x,H)}return x.prototype.setParent=function(R,x,H){var k=this;if(this.indexes||(this.indexes=this.ref instanceof ER?this.ref._definition.indexes:{}),this.parent=R,this.parentIndex=H,x)if(this.root=x,this.ref instanceof ER){var c=this.ref._definition;for(var t in c.schema){var A=this.ref[t];if(A&&A.$changes){var D=c.indexes[t];A.$changes.setParent(this.ref,x,D)}}}else"object"===typeof this.ref&&this.ref.forEach((function(R,x){if(R instanceof ER){var H=R.$changes,c=k.ref.$changes.indexes[x];H.setParent(k.ref,k.root,c)}}))},x.prototype.operation=function(R){this.changes.set(--this.currentCustomOperation,R)},x.prototype.change=function(x,H){void 0===H&&(H=R.OPERATION.ADD);var k="number"===typeof x?x:this.indexes[x];this.assertValidIndex(k,x);var c=this.changes.get(k);c&&c.op!==R.OPERATION.DELETE&&c.op!==R.OPERATION.TOUCH||this.changes.set(k,{op:c&&c.op===R.OPERATION.DELETE?R.OPERATION.DELETE_AND_ADD:H,index:k}),this.allChanges.add(k),this.changed=!0,this.touchParents()},x.prototype.touch=function(x){var H="number"===typeof x?x:this.indexes[x];this.assertValidIndex(H,x),this.changes.has(H)||this.changes.set(H,{op:R.OPERATION.TOUCH,index:H}),this.allChanges.add(H),this.touchParents()},x.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},x.prototype.getType=function(R){if(this.ref._definition)return(x=this.ref._definition).schema[x.fieldsByIndex[R]];var x,H=(x=this.parent._definition).schema[x.fieldsByIndex[this.parentIndex]];return Object.values(H)[0]},x.prototype.getChildrenFilter=function(){var R=this.parent._definition.childFilters;return R&&R[this.parentIndex]},x.prototype.getValue=function(R){return this.ref.getByIndex(R)},x.prototype.delete=function(x){var H="number"===typeof x?x:this.indexes[x];if(void 0!==H){var k=this.getValue(H);this.changes.set(H,{op:R.OPERATION.DELETE,index:H}),this.allChanges.delete(H),delete this.caches[H],k&&k.$changes&&(k.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(x," (").concat(H,")"))},x.prototype.discard=function(x,H){var k=this;void 0===x&&(x=!1),void 0===H&&(H=!1),this.ref instanceof ER||this.changes.forEach((function(x){if(x.op===R.OPERATION.DELETE){var H=k.ref.getIndex(x.index);delete k.indexes[H]}})),this.changes.clear(),this.changed=x,H&&this.allChanges.clear(),this.currentCustomOperation=0},x.prototype.discardAll=function(){var R=this;this.changes.forEach((function(x){var H=R.getValue(x.index);H&&H.$changes&&H.$changes.discardAll()})),this.discard()},x.prototype.cache=function(R,x){this.caches[R]=x},x.prototype.clone=function(){return new x(this.ref,this.parent,this.root)},x.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},x.prototype.assertValidIndex=function(R,x){if(void 0===R)throw new Error('ChangeTree: missing index for field "'.concat(x,'"'))},x}();function J(R,x,H,k){return R[x]||(R[x]=[]),R[x].push(H),null===k||void 0===k||k.forEach((function(R,x){return H(R,x)})),function(){return n(R[x],R[x].indexOf(H))}}function V(x){var H=this,k="string"!==typeof this.$changes.getType();this.$items.forEach((function(c,t){x.push({refId:H.$changes.refId,op:R.OPERATION.DELETE,field:t,value:void 0,previousValue:c}),k&&H.$changes.root.removeRef(c.$changes.refId)}))}function n(R,x){if(-1===x||x>=R.length)return!1;for(var H=R.length-1,k=x;k<H;k++)R[k]=R[k+1];return R.length=H,!0}var g=function(R,x){var H=R.toString(),k=x.toString();return H<k?-1:H>k?1:0};function I(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,x){return"symbol"===typeof x||isNaN(x)?R[x]:R.at(x)},set:function(R,x,H){if("symbol"===typeof x||isNaN(x))R[x]=H;else{var k=Array.from(R.$items.keys()),c=parseInt(k[x]||x);void 0===H||null===H?R.deleteAt(c):R.setAt(c,H)}return!0},deleteProperty:function(R,x){return"number"===typeof x?R.deleteAt(x):delete R[x],!0}})}var i=function(){function x(){for(var R=[],x=0;x<arguments.length;x++)R[x]=arguments[x];this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,R)}return x.prototype.qh=function(x,H){return void 0===H&&(H=!0),J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,x,H?this.$items:void 0)},x.prototype.ph=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,x)},x.is=function(R){return Array.isArray(R)||void 0!==R.array},Object.defineProperty(x.prototype,"length",{get:function(){return this.$items.size},set:function(R){0===R?this.clear():this.splice(R,this.length-R)},enumerable:!1,configurable:!0}),x.prototype.push=function(){for(var R,x=this,H=[],k=0;k<arguments.length;k++)H[k]=arguments[k];return H.forEach((function(H){R=x.$refId++,x.setAt(R,H)})),R},x.prototype.pop=function(){var R=Array.from(this.$indexes.values()).pop();if(void 0!==R){this.$changes.delete(R),this.$indexes.delete(R);var x=this.$items.get(R);return this.$items.delete(R),x}},x.prototype.at=function(R){var x=Array.from(this.$items.keys())[R];return this.$items.get(x)},x.prototype.setAt=function(x,H){var k,c;if(void 0!==H&&null!==H){if(this.$items.get(x)!==H){void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,x);var t=null!==(c=null===(k=this.$changes.indexes[x])||void 0===k?void 0:k.op)&&void 0!==c?c:R.OPERATION.ADD;this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,H),this.$changes.change(x,t)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},x.prototype.deleteAt=function(R){var x=Array.from(this.$items.keys())[R];return void 0!==x&&this.$deleteAt(x)},x.prototype.$deleteAt=function(R){return this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&V.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.concat=function(){for(var R,H=[],k=0;k<arguments.length;k++)H[k]=arguments[k];return new(x.bind.apply(x,c([void 0],(R=Array.from(this.$items.values())).concat.apply(R,H),!1)))},x.prototype.join=function(R){return Array.from(this.$items.values()).join(R)},x.prototype.reverse=function(){var R=this,x=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(H,k){R.setAt(x[k],H)})),this},x.prototype.shift=function(){var R=Array.from(this.$items.keys()).shift();if(void 0!==R){var x=this.$items.get(R);return this.$deleteAt(R),x}},x.prototype.slice=function(R,H){var k=new x;return k.push.apply(k,Array.from(this.$items.values()).slice(R,H)),k},x.prototype.sort=function(R){var x=this;void 0===R&&(R=g);var H=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(R).forEach((function(R,k){x.setAt(H[k],R)})),this},x.prototype.splice=function(R,x){void 0===x&&(x=this.length-R);for(var H=Array.from(this.$items.keys()),k=[],c=R;c<R+x;c++)k.push(this.$items.get(H[c])),this.$deleteAt(H[c]);return k},x.prototype.unshift=function(){for(var R=this,x=[],H=0;H<arguments.length;H++)x[H]=arguments[H];var k=this.length,c=x.length,t=Array.from(this.$items.values());return x.forEach((function(x,H){R.setAt(H,x)})),t.forEach((function(x,H){R.setAt(c+H,x)})),k+c},x.prototype.indexOf=function(R,x){return Array.from(this.$items.values()).indexOf(R,x)},x.prototype.lastIndexOf=function(R,x){return void 0===x&&(x=this.length-1),Array.from(this.$items.values()).lastIndexOf(R,x)},x.prototype.every=function(R,x){return Array.from(this.$items.values()).every(R,x)},x.prototype.some=function(R,x){return Array.from(this.$items.values()).some(R,x)},x.prototype.forEach=function(R,x){Array.from(this.$items.values()).forEach(R,x)},x.prototype.map=function(R,x){return Array.from(this.$items.values()).map(R,x)},x.prototype.filter=function(R,x){return Array.from(this.$items.values()).filter(R,x)},x.prototype.reduce=function(R,x){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},x.prototype.reduceRight=function(R,x){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},x.prototype.find=function(R,x){return Array.from(this.$items.values()).find(R,x)},x.prototype.findIndex=function(R,x){return Array.from(this.$items.values()).findIndex(R,x)},x.prototype.fill=function(R,x,H){throw new Error("ArraySchema#fill() not implemented")},x.prototype.copyWithin=function(R,x,H){throw new Error("ArraySchema#copyWithin() not implemented")},x.prototype.toString=function(){return this.$items.toString()},x.prototype.toLocaleString=function(){return this.$items.toLocaleString()},x.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},x.prototype.includes=function(R,x){return Array.from(this.$items.values()).includes(R,x)},x.prototype.flatMap=function(R,x){throw new Error("ArraySchema#flatMap() is not supported.")},x.prototype.flat=function(R){throw new Error("ArraySchema#flat() is not supported.")},x.prototype.findLast=function(){var R=Array.from(this.$items.values());return R.findLast.apply(R,arguments)},x.prototype.findLastIndex=function(){var R=Array.from(this.$items.values());return R.findLastIndex.apply(R,arguments)},x.prototype.setIndex=function(R,x){this.$indexes.set(R,x)},x.prototype.getIndex=function(R){return this.$indexes.get(R)},x.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},x.prototype.deleteByIndex=function(R){var x=this.$indexes.get(R);this.$items.delete(x),this.$indexes.delete(R)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){return this.toArray().map((function(R){return"function"===typeof R.toJSON?R.toJSON():R}))},x.prototype.clone=function(R){return R?new(x.bind.apply(x,c([void 0],Array.from(this.$items.values()),!1))):new(x.bind.apply(x,c([void 0],this.map((function(R){return R.$changes?R.clone():R})),!1)))},x}();function q(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,x){return"symbol"!==typeof x&&"undefined"===typeof R[x]?R.get(x):R[x]},set:function(R,x,H){return"symbol"!==typeof x&&-1===x.indexOf("$")&&"qh"!==x&&"ph"!==x&&"onChange"!==x?R.set(x,H):R[x]=H,!0},deleteProperty:function(R,x){return R.delete(x),!0}})}var S=function(){function x(R){var H=this;if(this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R)if(R instanceof Map||R instanceof x)R.forEach((function(R,x){return H.set(x,R)}));else for(var k in R)this.set(k,R[k])}return x.prototype.qh=function(x,H){return void 0===H&&(H=!0),J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,x,H?this.$items:void 0)},x.prototype.ph=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,x)},x.is=function(R){return void 0!==R.map},x.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(x.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.set=function(x,H){if(void 0===H||null===H)throw new Error("MapSchema#set('".concat(x,"', ").concat(H,"): trying to set ").concat(H," value on '").concat(x,"'."));x=x.toString();var k="undefined"!==typeof this.$changes.indexes[x],c=k?this.$changes.indexes[x]:this.$refId++,t=k?R.OPERATION.REPLACE:R.OPERATION.ADD,A=void 0!==H.$changes;if(A&&H.$changes.setParent(this,this.$changes.root,c),k){if(!A&&this.$items.get(x)===H)return;A&&this.$items.get(x)!==H&&(t=R.OPERATION.ADD)}else this.$changes.indexes[x]=c,this.$indexes.set(c,x);return this.$items.set(x,H),this.$changes.change(x,t),this},x.prototype.get=function(R){return this.$items.get(R)},x.prototype.delete=function(R){return this.$changes.delete(R),this.$items.delete(R)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&V.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(R){return this.$items.has(R)},x.prototype.forEach=function(R){this.$items.forEach(R)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(R,x){this.$indexes.set(R,x)},x.prototype.getIndex=function(R){return this.$indexes.get(R)},x.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},x.prototype.deleteByIndex=function(R){var x=this.$indexes.get(R);this.$items.delete(x),this.$indexes.delete(R)},x.prototype.toJSON=function(){var R={};return this.forEach((function(x,H){R[H]="function"===typeof x.toJSON?x.toJSON():x})),R},x.prototype.clone=function(R){var H;return R?H=Object.assign(new x,this):(H=new x,this.forEach((function(R,x){R.$changes?H.set(x,R.clone()):H.set(x,R)}))),H},x}(),L={};function b(R,x){L[R]=x}function C(R){return L[R]}var F=function(){function R(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return R.create=function(x){var H=new R;return H.schema=Object.assign({},x&&x.schema||{}),H.indexes=Object.assign({},x&&x.indexes||{}),H.fieldsByIndex=Object.assign({},x&&x.fieldsByIndex||{}),H.descriptors=Object.assign({},x&&x.descriptors||{}),H.deprecated=Object.assign({},x&&x.deprecated||{}),H},R.prototype.addField=function(R,x){var H=this.getNextFieldIndex();this.fieldsByIndex[H]=R,this.indexes[R]=H,this.schema[R]=Array.isArray(x)?{array:x[0]}:x},R.prototype.hasField=function(R){return void 0!==this.indexes[R]},R.prototype.addFilter=function(R,x){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[R]]=x,this.indexesWithFilters.push(this.indexes[R]),!0},R.prototype.addChildrenFilter=function(R,x){var H=this.indexes[R],k=this.schema[R];if(C(Object.keys(k)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[H]=x,!0;console.warn("@filterChildren: field '".concat(R,"' can't have children. Ignoring filter."))},R.prototype.getChildrenFilter=function(R){return this.childFilters&&this.childFilters[this.indexes[R]]},R.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},R}();function d(R){return R._context&&R._context.useFilters}var P=function(){function R(){this.types={},this.schemas=new Map,this.useFilters=!1}return R.prototype.has=function(R){return this.schemas.has(R)},R.prototype.get=function(R){return this.types[R]},R.prototype.add=function(R,x){void 0===x&&(x=this.schemas.size),R._definition=F.create(R._definition),R._typeid=x,this.types[x]=R,this.schemas.set(R,x)},R.create=function(x){return void 0===x&&(x={}),function(H){return x.context||(x.context=new R),X(H,x)}},R}(),a=new P;function X(R,x){return void 0===x&&(x={}),function(H,k){var t=x.context||a,A=H.constructor;if(A._context=t,!R)throw new Error("".concat(A.name,': @type() reference provided for "').concat(k,"\" is undefined. Make sure you don't have any circular dependencies."));t.has(A)||t.add(A);var D=A._definition;if(D.addField(k,R),D.descriptors[k]){if(D.deprecated[k])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(k,"' definition on '").concat(A.name,"'.\nCheck @type() annotation"))}catch(L){var U=L.stack.split("\n")[4].trim();throw new Error("".concat(L.message," ").concat(U))}}var J=i.is(R),V=!J&&S.is(R);if("string"!==typeof R&&!ER.is(R)){var n=Object.values(R)[0];"string"===typeof n||t.has(n)||t.add(n)}if(x.manual)D.descriptors[k]={enumerable:!0,configurable:!0,writable:!0};else{var g="_".concat(k);D.descriptors[g]={enumerable:!1,configurable:!1,writable:!0},D.descriptors[k]={get:function(){return this[g]},set:function(R){R!==this[g]&&(void 0!==R&&null!==R?(!J||R instanceof i||(R=new(i.bind.apply(i,c([void 0],R,!1)))),!V||R instanceof S||(R=new S(R)),void 0===R.$proxy&&(V?R=q(R):J&&(R=I(R))),this.$changes.change(k),R.$changes&&R.$changes.setParent(this,this.$changes.root,this._definition.indexes[k])):this[g]&&this.$changes.delete(k),this[g]=R)},enumerable:!0,configurable:!0}}}}function M(R){return function(x,H){var k=x.constructor;k._definition.addFilter(H,R)&&(k._context.useFilters=!0)}}function B(R){return function(x,H){var k=x.constructor;k._definition.addChildrenFilter(H,R)&&(k._context.useFilters=!0)}}function o(R){return void 0===R&&(R=!0),function(x,H){var k=x.constructor._definition;k.deprecated[H]=!0,R&&(k.descriptors[H]={get:function(){throw new Error("".concat(H," is deprecated."))},set:function(R){},enumerable:!1,configurable:!0})}}function Z(R,x,H){for(var k in void 0===H&&(H={}),H.context||(H.context=R._context||H.context||a),x)X(x[k],H)(R.prototype,k);return R}function y(R){for(var x=0,H=0,k=0,c=R.length;k<c;k++)(x=R.charCodeAt(k))<128?H+=1:x<2048?H+=2:x<55296||x>=57344?H+=3:(k++,H+=4);return H}function s(R,x,H){for(var k=0,c=0,t=H.length;c<t;c++)(k=H.charCodeAt(c))<128?R[x++]=k:k<2048?(R[x++]=192|k>>6,R[x++]=128|63&k):k<55296||k>=57344?(R[x++]=224|k>>12,R[x++]=128|k>>6&63,R[x++]=128|63&k):(c++,k=65536+((1023&k)<<10|1023&H.charCodeAt(c)),R[x++]=240|k>>18,R[x++]=128|k>>12&63,R[x++]=128|k>>6&63,R[x++]=128|63&k)}function E(R,x){R.push(255&x)}function w(R,x){R.push(255&x)}function h(R,x){R.push(255&x),R.push(x>>8&255)}function f(R,x){R.push(255&x),R.push(x>>8&255)}function N(R,x){R.push(255&x),R.push(x>>8&255),R.push(x>>16&255),R.push(x>>24&255)}function W(R,x){var H=x>>24,k=x>>16,c=x>>8,t=x;R.push(255&t),R.push(255&c),R.push(255&k),R.push(255&H)}function K(R,x){var H=Math.floor(x/Math.pow(2,32));W(R,x>>>0),W(R,H)}function Q(R,x){var H=x/Math.pow(2,32)|0;W(R,x>>>0),W(R,H)}function G(R,x){z(R,x)}function T(R,x){j(R,x)}var v=new Int32Array(2),p=new Float32Array(v.buffer),r=new Float64Array(v.buffer);function z(R,x){p[0]=x,N(R,v[0])}function j(R,x){r[0]=x,N(R,v[0]),N(R,v[1])}function m(R,x){return w(R,x?1:0)}function O(R,x){x||(x="");var H=y(x),k=0;if(H<32)R.push(160|H),k=1;else if(H<256)R.push(217),w(R,H),k=2;else if(H<65536)R.push(218),f(R,H),k=3;else{if(!(H<4294967296))throw new Error("String too long");R.push(219),W(R,H),k=5}return s(R,R.length,x),k+H}function l(R,x){return isNaN(x)?l(R,0):isFinite(x)?x!==(0|x)?(R.push(203),j(R,x),9):x>=0?x<128?(w(R,x),1):x<256?(R.push(204),w(R,x),2):x<65536?(R.push(205),f(R,x),3):x<4294967296?(R.push(206),W(R,x),5):(R.push(207),Q(R,x),9):x>=-32?(R.push(224|x+32),1):x>=-128?(R.push(208),E(R,x),2):x>=-32768?(R.push(209),h(R,x),3):x>=-2147483648?(R.push(210),N(R,x),5):(R.push(211),K(R,x),9):l(R,x>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var e=Object.freeze({__proto__:null,utf8Write:s,int8:E,uint8:w,int16:h,uint16:f,int32:N,uint32:W,int64:K,uint64:Q,float32:G,float64:T,writeFloat32:z,writeFloat64:j,boolean:m,string:O,number:l});function u(R,x,H){for(var k="",c=0,t=x,A=x+H;t<A;t++){var D=R[t];0!==(128&D)?192!==(224&D)?224!==(240&D)?240!==(248&D)?console.error("Invalid byte "+D.toString(16)):(c=(7&D)<<18|(63&R[++t])<<12|(63&R[++t])<<6|63&R[++t])>=65536?(c-=65536,k+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):k+=String.fromCharCode(c):k+=String.fromCharCode((15&D)<<12|(63&R[++t])<<6|63&R[++t]):k+=String.fromCharCode((31&D)<<6|63&R[++t]):k+=String.fromCharCode(D)}return k}function Y(R,x){return RR(R,x)<<24>>24}function RR(R,x){return R[x.offset++]}function xR(R,x){return HR(R,x)<<16>>16}function HR(R,x){return R[x.offset++]|R[x.offset++]<<8}function kR(R,x){return R[x.offset++]|R[x.offset++]<<8|R[x.offset++]<<16|R[x.offset++]<<24}function cR(R,x){return kR(R,x)>>>0}function tR(R,x){return gR(R,x)}function AR(R,x){return IR(R,x)}function DR(R,x){var H=cR(R,x);return kR(R,x)*Math.pow(2,32)+H}function UR(R,x){var H=cR(R,x);return cR(R,x)*Math.pow(2,32)+H}var JR=new Int32Array(2),VR=new Float32Array(JR.buffer),nR=new Float64Array(JR.buffer);function gR(R,x){return JR[0]=kR(R,x),VR[0]}function IR(R,x){return JR[0]=kR(R,x),JR[1]=kR(R,x),nR[0]}function iR(R,x){return RR(R,x)>0}function qR(R,x){var H,k=R[x.offset++];k<192?H=31&k:217===k?H=RR(R,x):218===k?H=HR(R,x):219===k&&(H=cR(R,x));var c=u(R,x.offset,H);return x.offset+=H,c}function SR(R,x){var H=R[x.offset];return H<192&&H>160||217===H||218===H||219===H}function LR(R,x){var H=R[x.offset++];return H<128?H:202===H?gR(R,x):203===H?IR(R,x):204===H?RR(R,x):205===H?HR(R,x):206===H?cR(R,x):207===H?UR(R,x):208===H?Y(R,x):209===H?xR(R,x):210===H?kR(R,x):211===H?DR(R,x):H>223?-1*(255-H+1):void 0}function bR(R,x){var H=R[x.offset];return H<128||H>=202&&H<=211}function CR(R,x){return R[x.offset]<160}function FR(R,x){return R[x.offset-1]===A&&(R[x.offset]<128||R[x.offset]>=202&&R[x.offset]<=211)}var dR=Object.freeze({__proto__:null,int8:Y,uint8:RR,int16:xR,uint16:HR,int32:kR,uint32:cR,float32:tR,float64:AR,int64:DR,uint64:UR,readFloat32:gR,readFloat64:IR,boolean:iR,string:qR,stringCheck:SR,number:LR,numberCheck:bR,arrayCheck:CR,switchStructureCheck:FR}),PR=function(){function x(R){var x=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return x.add(R)}))}return x.prototype.qh=function(x,H){return void 0===H&&(H=!0),J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,x,H?this.$items:void 0)},x.prototype.ph=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,x)},x.is=function(R){return void 0!==R.collection},x.prototype.add=function(R){var x=this.$refId++;return void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,x),this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,R),this.$changes.change(x),x},x.prototype.at=function(R){var x=Array.from(this.$items.keys())[R];return this.$items.get(x)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(R){for(var x,H,k=this.$items.entries();(H=k.next())&&!H.done;)if(R===H.value[1]){x=H.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&V.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(R){return Array.from(this.$items.values()).some((function(x){return x===R}))},x.prototype.forEach=function(R){var x=this;this.$items.forEach((function(H,k,c){return R(H,k,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(R,x){this.$indexes.set(R,x)},x.prototype.getIndex=function(R){return this.$indexes.get(R)},x.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},x.prototype.deleteByIndex=function(R){var x=this.$indexes.get(R);this.$items.delete(x),this.$indexes.delete(R)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var R=[];return this.forEach((function(x,H){R.push("function"===typeof x.toJSON?x.toJSON():x)})),R},x.prototype.clone=function(R){var H;return R?H=Object.assign(new x,this):(H=new x,this.forEach((function(R){R.$changes?H.add(R.clone()):H.add(R)}))),H},x}(),aR=function(){function x(R){var x=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return x.add(R)}))}return x.prototype.qh=function(x,H){return void 0===H&&(H=!0),J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,x,H?this.$items:void 0)},x.prototype.ph=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,x)},x.is=function(R){return void 0!==R.set},x.prototype.add=function(x){var H,k;if(this.has(x))return!1;var c=this.$refId++;void 0!==x.$changes&&x.$changes.setParent(this,this.$changes.root,c);var t=null!==(k=null===(H=this.$changes.indexes[c])||void 0===H?void 0:H.op)&&void 0!==k?k:R.OPERATION.ADD;return this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,x),this.$changes.change(c,t),c},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(R){for(var x,H,k=this.$items.entries();(H=k.next())&&!H.done;)if(R===H.value[1]){x=H.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&V.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(R){for(var x,H=this.$items.values(),k=!1;(x=H.next())&&!x.done;)if(R===x.value){k=!0;break}return k},x.prototype.forEach=function(R){var x=this;this.$items.forEach((function(H,k,c){return R(H,k,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(R,x){this.$indexes.set(R,x)},x.prototype.getIndex=function(R){return this.$indexes.get(R)},x.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},x.prototype.deleteByIndex=function(R){var x=this.$indexes.get(R);this.$items.delete(x),this.$indexes.delete(R)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var R=[];return this.forEach((function(x,H){R.push("function"===typeof x.toJSON?x.toJSON():x)})),R},x.prototype.clone=function(R){var H;return R?H=Object.assign(new x,this):(H=new x,this.forEach((function(R){R.$changes?H.add(R.clone()):H.add(R)}))),H},x}(),XR=function(){function R(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return R.prototype.addRefId=function(R){this.refIds.has(R)||(this.refIds.add(R),this.containerIndexes.set(R,new Set))},R.get=function(x){return void 0===x.$filterState&&(x.$filterState=new R),x.$filterState},R}(),MR=function(){function R(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return R.prototype.getNextUniqueId=function(){return this.nextUniqueId++},R.prototype.addRef=function(R,x,H){void 0===H&&(H=!0),this.refs.set(R,x),H&&(this.refCounts[R]=(this.refCounts[R]||0)+1)},R.prototype.removeRef=function(R){this.refCounts[R]=this.refCounts[R]-1,this.deletedRefs.add(R)},R.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},R.prototype.garbageCollectDeletedRefs=function(){var R=this;this.deletedRefs.forEach((function(x){if(!(R.refCounts[x]>0)){var H=R.refs.get(x);if(H instanceof ER)for(var k in H._definition.schema)"string"!==typeof H._definition.schema[k]&&H[k]&&H[k].$changes&&R.removeRef(H[k].$changes.refId);else{var c=H.$changes.parent._definition,t=c.schema[c.fieldsByIndex[H.$changes.parentIndex]];"function"===typeof Object.values(t)[0]&&Array.from(H.values()).forEach((function(x){return R.removeRef(x.$changes.refId)}))}R.refs.delete(x),delete R.refCounts[x]}})),this.deletedRefs.clear()},R}(),BR=function(R){function x(){return null!==R&&R.apply(this,arguments)||this}return H(x,R),x}(Error);function oR(R,x,H,k){var c,t=!1;switch(x){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(R)&&console.log('trying to encode "NaN" in '.concat(H.constructor.name,"#").concat(k));break;case"string":c="string",t=!0;break;case"boolean":return}if(typeof R!==c&&(!t||t&&null!==R)){var A="'".concat(JSON.stringify(R),"'").concat(R&&R.constructor&&" (".concat(R.constructor.name,")")||"");throw new BR("a '".concat(c,"' was expected, but ").concat(A," was provided in ").concat(H.constructor.name,"#").concat(k))}}function ZR(R,x,H,k){if(!(R instanceof x))throw new BR("a '".concat(x.name,"' was expected, but '").concat(R.constructor.name,"' was provided in ").concat(H.constructor.name,"#").concat(k))}function yR(R,x,H,k,c){oR(H,R,k,c);var t=e[R];if(!t)throw new BR("a '".concat(R,"' was expected, but ").concat(H," was provided in ").concat(k.constructor.name,"#").concat(c));t(x,H)}function sR(R,x,H){return dR[R](x,H)}var ER=function(){function x(){for(var R=[],x=0;x<arguments.length;x++)R[x]=arguments[x];Object.defineProperties(this,{$changes:{value:new U(this,void 0,new MR),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var H=this._definition.descriptors;H&&Object.defineProperties(this,H),R[0]&&this.assign(R[0])}return x.onError=function(R){console.error(R)},x.is=function(R){return R._definition&&void 0!==R._definition.schema},x.prototype.onChange=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,x)},x.prototype.ph=function(x){return J(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,x)},x.prototype.assign=function(R){return Object.assign(this,R),this},Object.defineProperty(x.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),x.prototype.setDirty=function(R,x){this.$changes.change(R,x)},x.prototype.listen=function(R,x,H){var k=this;return void 0===H&&(H=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[R]||(this.$callbacks[R]=[]),this.$callbacks[R].push(x),H&&void 0!==this[R]&&x(this[R],void 0),function(){return n(k.$callbacks[R],k.$callbacks[R].indexOf(x))}},x.prototype.decode=function(H,k,c){var t;void 0===k&&(k={offset:0}),void 0===c&&(c=this);var D=[],U=this.$changes.root,J=H.length,V=0;for(U.refs.set(V,this);k.offset<J;){var n=H[k.offset++];if(n!=A){var g=c.$changes,I=void 0!==c._definition,q=I?n>>6<<6:n;if(q!==R.OPERATION.CLEAR){var L=I?n%(q||255):LR(H,k),b=I?c._definition.fieldsByIndex[L]:"",F=g.getType(L),d=void 0,P=void 0,a=void 0;if(I?P=c["_".concat(b)]:(P=c.getByIndex(L),(q&R.OPERATION.ADD)===R.OPERATION.ADD?(a=c instanceof S?qR(H,k):L,c.setIndex(L,a)):a=c.getIndex(L)),(q&R.OPERATION.DELETE)===R.OPERATION.DELETE&&(q!==R.OPERATION.DELETE_AND_ADD&&c.deleteByIndex(L),P&&P.$changes&&U.removeRef(P.$changes.refId),d=null),void 0!==b){if(q===R.OPERATION.DELETE);else if(x.is(F)){var X=LR(H,k);if(d=U.refs.get(X),q!==R.OPERATION.REPLACE){var M=this.getSchemaType(H,k,F);d||((d=this.createTypeInstance(M)).$changes.refId=X,P&&(d.$callbacks=P.$callbacks,P.$changes.refId&&X!==P.$changes.refId&&U.removeRef(P.$changes.refId))),U.addRef(X,d,d!==P)}}else if("string"===typeof F)d=sR(F,H,k);else{var B=C(Object.keys(F)[0]),o=LR(H,k),Z=U.refs.has(o)?P||U.refs.get(o):new B.constructor;if((d=Z.clone(!0)).$changes.refId=o,P&&(d.$callbacks=P.$callbacks,P.$changes.refId&&o!==P.$changes.refId)){U.removeRef(P.$changes.refId);for(var y=P.entries(),s=void 0;(s=y.next())&&!s.done;){var E=(t=s.value)[0],w=t[1];D.push({refId:o,op:R.OPERATION.DELETE,field:E,value:void 0,previousValue:w})}}U.addRef(o,d,Z!==P)}if(null!==d&&void 0!==d)if(d.$changes&&d.$changes.setParent(g.ref,g.root,L),c instanceof x)c[b]=d;else if(c instanceof S)E=a,c.$items.set(E,d),c.$changes.allChanges.add(L);else if(c instanceof i)c.setAt(L,d);else if(c instanceof PR){var h=c.add(d);c.setIndex(L,h)}else c instanceof aR&&!1!==(h=c.add(d))&&c.setIndex(L,h);P!==d&&D.push({refId:V,op:q,field:b,dynamicIndex:a,value:d,previousValue:P})}else{console.warn("@colyseus/schema: definition mismatch");for(var f={offset:k.offset};k.offset<J&&(!FR(H,k)||(f.offset=k.offset+1,!U.refs.has(LR(H,f))));)k.offset++}}else c.clear(D)}else{V=LR(H,k);var N=U.refs.get(V);if(!N)throw new Error('"refId" not found: '.concat(V));c=N}}return this._triggerChanges(D),U.garbageCollectDeletedRefs(),D},x.prototype.encode=function(H,k,c){void 0===H&&(H=!1),void 0===k&&(k=[]),void 0===c&&(c=!1);for(var t=this.$changes,D=new WeakSet,U=[t],J=1,V=0;V<J;V++){var n=U[V],g=n.ref,I=g instanceof x;n.ensureRefId(),D.add(n),n!==t&&(n.changed||H)&&(w(k,A),l(k,n.refId));for(var i=H?Array.from(n.allChanges):Array.from(n.changes.values()),q=0,L=i.length;q<L;q++){var b=H?{op:R.OPERATION.ADD,index:i[q]}:i[q],F=b.index,d=I?g._definition.fieldsByIndex&&g._definition.fieldsByIndex[F]:F,P=k.length;if(b.op!==R.OPERATION.TOUCH)if(I)w(k,F|b.op);else{if(w(k,b.op),b.op===R.OPERATION.CLEAR)continue;l(k,F)}if(I||(b.op&R.OPERATION.ADD)!=R.OPERATION.ADD||g instanceof S&&O(k,n.ref.$indexes.get(F)),b.op!==R.OPERATION.DELETE){var a=n.getType(F),X=n.getValue(F);if(X&&X.$changes&&!D.has(X.$changes)&&(U.push(X.$changes),X.$changes.ensureRefId(),J++),b.op!==R.OPERATION.TOUCH){if(x.is(a))ZR(X,a,g,d),l(k,X.$changes.refId),(b.op&R.OPERATION.ADD)===R.OPERATION.ADD&&this.tryEncodeTypeId(k,a,X.constructor);else if("string"===typeof a)yR(a,k,X,g,d);else{var M=C(Object.keys(a)[0]);ZR(g["_".concat(d)],M.constructor,g,d),l(k,X.$changes.refId)}c&&n.cache(F,k.slice(P))}}}H||c||n.discard()}return k},x.prototype.encodeAll=function(R){return this.encode(!0,[],R)},x.prototype.applyFilters=function(H,k){var c,t;void 0===k&&(k=!1);for(var D=this,U=new Set,J=XR.get(H),V=[this.$changes],n=1,g=[],I=function(I){var i=V[I];if(U.has(i.refId))return"continue";var q=i.ref,L=q instanceof x;w(g,A),l(g,i.refId);var b=J.refIds.has(i),C=k||!b;J.addRefId(i);var F=J.containerIndexes.get(i),d=C?Array.from(i.allChanges):Array.from(i.changes.values());!k&&L&&q._definition.indexesWithFilters&&q._definition.indexesWithFilters.forEach((function(x){!F.has(x)&&i.allChanges.has(x)&&(C?d.push(x):d.push({op:R.OPERATION.ADD,index:x}))}));for(var P=0,a=d.length;P<a;P++){var X=C?{op:R.OPERATION.ADD,index:d[P]}:d[P];if(X.op!==R.OPERATION.CLEAR){var M=X.index;if(X.op!==R.OPERATION.DELETE){var B=i.getValue(M),o=i.getType(M);if(L){if((Z=q._definition.filters&&q._definition.filters[M])&&!Z.call(q,H,B,D)){B&&B.$changes&&U.add(B.$changes.refId);continue}}else{var Z,y=i.parent;if((Z=i.getChildrenFilter())&&!Z.call(y,H,q.$indexes.get(M),B,D)){B&&B.$changes&&U.add(B.$changes.refId);continue}}if(B.$changes&&(V.push(B.$changes),n++),X.op!==R.OPERATION.TOUCH)if(X.op===R.OPERATION.ADD||L)g.push.apply(g,null!==(c=i.caches[M])&&void 0!==c?c:[]),F.add(M);else if(F.has(M))g.push.apply(g,null!==(t=i.caches[M])&&void 0!==t?t:[]);else{if(F.add(M),w(g,R.OPERATION.ADD),l(g,M),q instanceof S){var s=i.ref.$indexes.get(M);O(g,s)}B.$changes?l(g,B.$changes.refId):e[o](g,B)}else B.$changes&&!L&&(w(g,R.OPERATION.ADD),l(g,M),q instanceof S&&(s=i.ref.$indexes.get(M),O(g,s)),l(g,B.$changes.refId))}else L?w(g,X.op|M):(w(g,X.op),l(g,M))}else w(g,X.op)}},i=0;i<n;i++)I(i);return g},x.prototype.clone=function(){var R,x=new this.constructor,H=this._definition.schema;for(var k in H)"object"===typeof this[k]&&"function"===typeof(null===(R=this[k])||void 0===R?void 0:R.clone)?x[k]=this[k].clone():x[k]=this[k];return x},x.prototype.toJSON=function(){var R=this._definition.schema,x=this._definition.deprecated,H={};for(var k in R)x[k]||null===this[k]||"undefined"===typeof this[k]||(H[k]="function"===typeof this[k].toJSON?this[k].toJSON():this["_".concat(k)]);return H},x.prototype.discardAllChanges=function(){this.$changes.discardAll()},x.prototype.getByIndex=function(R){return this[this._definition.fieldsByIndex[R]]},x.prototype.deleteByIndex=function(R){this[this._definition.fieldsByIndex[R]]=void 0},x.prototype.tryEncodeTypeId=function(R,x,H){x._typeid!==H._typeid&&(w(R,D),l(R,H._typeid))},x.prototype.getSchemaType=function(R,x,H){var k;return R[x.offset]===D&&(x.offset++,k=this.constructor._context.get(LR(R,x))),k||H},x.prototype.createTypeInstance=function(R){var x=new R;return x.$changes.root=this.$changes.root,x},x.prototype._triggerChanges=function(H){for(var k,c,t,A,D,U,J,V,n,g=new Set,I=this.$changes.root.refs,i=function(i){var q=H[i],S=q.refId,L=I.get(S),b=L.$callbacks;if((q.op&R.OPERATION.DELETE)===R.OPERATION.DELETE&&q.previousValue instanceof x&&(null===(c=null===(k=q.previousValue.$callbacks)||void 0===k?void 0:k[R.OPERATION.DELETE])||void 0===c||c.forEach((function(R){return R()}))),!b)return"continue";if(L instanceof x){if(!g.has(S))try{null===(t=null===b||void 0===b?void 0:b[R.OPERATION.REPLACE])||void 0===t||t.forEach((function(R){return R()}))}catch(C){x.onError(C)}try{b.hasOwnProperty(q.field)&&(null===(A=b[q.field])||void 0===A||A.forEach((function(R){return R(q.value,q.previousValue)})))}catch(C){x.onError(C)}}else q.op===R.OPERATION.ADD&&void 0===q.previousValue?null===(D=b[R.OPERATION.ADD])||void 0===D||D.forEach((function(R){var x;return R(q.value,null!==(x=q.dynamicIndex)&&void 0!==x?x:q.field)})):q.op===R.OPERATION.DELETE?void 0!==q.previousValue&&(null===(U=b[R.OPERATION.DELETE])||void 0===U||U.forEach((function(R){var x;return R(q.previousValue,null!==(x=q.dynamicIndex)&&void 0!==x?x:q.field)}))):q.op===R.OPERATION.DELETE_AND_ADD&&(void 0!==q.previousValue&&(null===(J=b[R.OPERATION.DELETE])||void 0===J||J.forEach((function(R){var x;return R(q.previousValue,null!==(x=q.dynamicIndex)&&void 0!==x?x:q.field)}))),null===(V=b[R.OPERATION.ADD])||void 0===V||V.forEach((function(R){var x;return R(q.value,null!==(x=q.dynamicIndex)&&void 0!==x?x:q.field)}))),q.value!==q.previousValue&&(null===(n=b[R.OPERATION.REPLACE])||void 0===n||n.forEach((function(R){var x;return R(q.value,null!==(x=q.dynamicIndex)&&void 0!==x?x:q.field)})));g.add(S)},q=0;q<H.length;q++)i(q)},x._definition=F.create(),x}();function wR(R){for(var x=[R.$changes],H=1,k={},c=k,t=function(R){var H=x[R];H.changes.forEach((function(R){var x=H.ref,k=R.index,t=x._definition?x._definition.fieldsByIndex[k]:x.$indexes.get(k);c[t]=H.getValue(k)}))},A=0;A<H;A++)t(A);return k}var hR={context:new P},fR=function(R){function x(){return null!==R&&R.apply(this,arguments)||this}return H(x,R),k([X("string",hR)],x.prototype,"name",void 0),k([X("string",hR)],x.prototype,"type",void 0),k([X("number",hR)],x.prototype,"referencedType",void 0),x}(ER),NR=function(R){function x(){var x=null!==R&&R.apply(this,arguments)||this;return x.fields=new i,x}return H(x,R),k([X("number",hR)],x.prototype,"id",void 0),k([X([fR],hR)],x.prototype,"fields",void 0),x}(ER),WR=function(R){function x(){var x=null!==R&&R.apply(this,arguments)||this;return x.types=new i,x}return H(x,R),x.encode=function(R){var H=R.constructor,k=new x;k.rootType=H._typeid;var c=function(R,x){for(var H in x){var c=new fR;c.name=H;var t=void 0;if("string"===typeof x[H])t=x[H];else{var A=x[H],D=void 0;ER.is(A)?(t="ref",D=x[H]):"string"===typeof A[t=Object.keys(A)[0]]?t+=":"+A[t]:D=A[t],c.referencedType=D?D._typeid:-1}c.type=t,R.fields.push(c)}k.types.push(R)},t=H._context.types;for(var A in t){var D=new NR;D.id=Number(A),c(D,t[A]._definition.schema)}return k.encodeAll()},x.decode=function(R,k){var c=new P,t=new x;t.decode(R,k);var A=t.types.reduce((function(R,x){var k=function(R){function x(){return null!==R&&R.apply(this,arguments)||this}return H(x,R),x}(ER),t=x.id;return R[t]=k,c.add(k,t),R}),{});t.types.forEach((function(R){var x=A[R.id];R.fields.forEach((function(R){var H;if(void 0!==R.referencedType){var k=R.type,t=A[R.referencedType];if(!t){var D=R.type.split(":");k=D[0],t=D[1]}"ref"===k?X(t,{context:c})(x.prototype,R.name):X(((H={})[k]=t,H),{context:c})(x.prototype,R.name)}else X(R.type,{context:c})(x.prototype,R.name)}))}));var D=A[t.rootType],U=new D;for(var J in D._definition.schema){var V=D._definition.schema[J];"string"!==typeof V&&(U[J]="function"===typeof V?new V:new(C(Object.keys(V)[0]).constructor))}return U},k([X([NR],hR)],x.prototype,"types",void 0),k([X("number",hR)],x.prototype,"rootType",void 0),x}(ER);b("map",{constructor:S}),b("array",{constructor:i}),b("set",{constructor:aR}),b("collection",{constructor:PR}),R.ArraySchema=i,R.CollectionSchema=PR,R.Context=P,R.MapSchema=S,R.Reflection=WR,R.ReflectionField=fR,R.ReflectionType=NR,R.Schema=ER,R.SchemaDefinition=F,R.SetSchema=aR,R.decode=dR,R.defineTypes=Z,R.deprecated=o,R.dumpChanges=wR,R.encode=e,R.filter=M,R.filterChildren=B,R.hasFilter=d,R.registerType=b,R.type=X,Object.defineProperty(R,"__esModule",{value:!0})}(x)},13481:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13473:(R,x,H)=>{var k=H(13481),c=H(13487),t=Object.hasOwnProperty,A=Object.create(null);for(var D in k)t.call(k,D)&&(A[k[D]]=D);var U=R.exports={to:{},get:{}};function J(R,x,H){return Math.min(Math.max(x,R),H)}function V(R){var x=Math.round(R).toString(16).toUpperCase();return x.length<2?"0"+x:x}U.get=function(R){var x,H;switch(R.substring(0,3).toLowerCase()){case"hsl":x=U.get.hsl(R),H="hsl";break;case"hwb":x=U.get.hwb(R),H="hwb";break;default:x=U.get.rgb(R),H="rgb"}return x?{model:H,value:x}:null},U.get.rgb=function(R){if(!R)return null;var x,H,c,A=[0,0,0,1];if(x=R.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(c=x[2],x=x[1],H=0;H<3;H++){var D=2*H;A[H]=parseInt(x.slice(D,D+2),16)}c&&(A[3]=parseInt(c,16)/255)}else if(x=R.match(/^#([a-f0-9]{3,4})$/i)){for(c=(x=x[1])[3],H=0;H<3;H++)A[H]=parseInt(x[H]+x[H],16);c&&(A[3]=parseInt(c+c,16)/255)}else if(x=R.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(H=0;H<3;H++)A[H]=parseInt(x[H+1],0);x[4]&&(x[5]?A[3]=.01*parseFloat(x[4]):A[3]=parseFloat(x[4]))}else{if(!(x=R.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(x=R.match(/^(\w+)$/))?"transparent"===x[1]?[0,0,0,0]:t.call(k,x[1])?((A=k[x[1]])[3]=1,A):null:null;for(H=0;H<3;H++)A[H]=Math.round(2.55*parseFloat(x[H+1]));x[4]&&(x[5]?A[3]=.01*parseFloat(x[4]):A[3]=parseFloat(x[4]))}for(H=0;H<3;H++)A[H]=J(A[H],0,255);return A[3]=J(A[3],0,1),A},U.get.hsl=function(R){if(!R)return null;var x=R.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var H=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,J(parseFloat(x[2]),0,100),J(parseFloat(x[3]),0,100),J(isNaN(H)?1:H,0,1)]}return null},U.get.hwb=function(R){if(!R)return null;var x=R.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var H=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,J(parseFloat(x[2]),0,100),J(parseFloat(x[3]),0,100),J(isNaN(H)?1:H,0,1)]}return null},U.to.hex=function(){var R=c(arguments);return"#"+V(R[0])+V(R[1])+V(R[2])+(R[3]<1?V(Math.round(255*R[3])):"")},U.to.rgb=function(){var R=c(arguments);return R.length<4||1===R[3]?"rgb("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+")":"rgba("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+", "+R[3]+")"},U.to.rgb.percent=function(){var R=c(arguments),x=Math.round(R[0]/255*100),H=Math.round(R[1]/255*100),k=Math.round(R[2]/255*100);return R.length<4||1===R[3]?"rgb("+x+"%, "+H+"%, "+k+"%)":"rgba("+x+"%, "+H+"%, "+k+"%, "+R[3]+")"},U.to.hsl=function(){var R=c(arguments);return R.length<4||1===R[3]?"hsl("+R[0]+", "+R[1]+"%, "+R[2]+"%)":"hsla("+R[0]+", "+R[1]+"%, "+R[2]+"%, "+R[3]+")"},U.to.hwb=function(){var R=c(arguments),x="";return R.length>=4&&1!==R[3]&&(x=", "+R[3]),"hwb("+R[0]+", "+R[1]+"%, "+R[2]+"%"+x+")"},U.to.keyword=function(R){return A[R.slice(0,3)]}},13464:(R,x,H)=>{const k=H(13473),c=H(13494),t=["keyword","gray","hex"],A={};for(const I of Object.keys(c))A[[...c[I].labels].sort().join("")]=I;const D={};function U(R,x){if(!(this instanceof U))return new U(R,x);if(x&&x in t&&(x=null),x&&!(x in c))throw new Error("Unknown model: "+x);let H,J;if(null==R)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(R instanceof U)this.model=R.model,this.color=[...R.color],this.valpha=R.valpha;else if("string"===typeof R){const x=k.get(R);if(null===x)throw new Error("Unable to parse color from string: "+R);this.model=x.model,J=c[this.model].channels,this.color=x.value.slice(0,J),this.valpha="number"===typeof x.value[J]?x.value[J]:1}else if(R.length>0){this.model=x||"rgb",J=c[this.model].channels;const H=Array.prototype.slice.call(R,0,J);this.color=g(H,J),this.valpha="number"===typeof R[J]?R[J]:1}else if("number"===typeof R)this.model="rgb",this.color=[R>>16&255,R>>8&255,255&R],this.valpha=1;else{this.valpha=1;const x=Object.keys(R);"alpha"in R&&(x.splice(x.indexOf("alpha"),1),this.valpha="number"===typeof R.alpha?R.alpha:0);const k=x.sort().join("");if(!(k in A))throw new Error("Unable to parse color from object: "+JSON.stringify(R));this.model=A[k];const{labels:t}=c[this.model],D=[];for(H=0;H<t.length;H++)D.push(R[t[H]]);this.color=g(D)}if(D[this.model])for(J=c[this.model].channels,H=0;H<J;H++){const R=D[this.model][H];R&&(this.color[H]=R(this.color[H]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}U.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(R){let x=this.model in k.to?this:this.rgb();x=x.round("number"===typeof R?R:1);const H=1===x.valpha?x.color:[...x.color,this.valpha];return k.to[x.model](H)},percentString(R){const x=this.rgb().round("number"===typeof R?R:1),H=1===x.valpha?x.color:[...x.color,this.valpha];return k.to.rgb.percent(H)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const R={},{channels:x}=c[this.model],{labels:H}=c[this.model];for(let k=0;k<x;k++)R[H[k]]=this.color[k];return 1!==this.valpha&&(R.alpha=this.valpha),R},unitArray(){const R=this.rgb().color;return R[0]/=255,R[1]/=255,R[2]/=255,1!==this.valpha&&R.push(this.valpha),R},unitObject(){const R=this.rgb().object();return R.r/=255,R.g/=255,R.b/=255,1!==this.valpha&&(R.alpha=this.valpha),R},round(R){return R=Math.max(R||0,0),new U([...this.color.map(J(R)),this.valpha],this.model)},alpha(R){return void 0!==R?new U([...this.color,Math.max(0,Math.min(1,R))],this.model):this.valpha},red:V("rgb",0,n(255)),green:V("rgb",1,n(255)),blue:V("rgb",2,n(255)),hue:V(["hsl","hsv","hsl","hwb","hcg"],0,(R=>(R%360+360)%360)),saturationl:V("hsl",1,n(100)),lightness:V("hsl",2,n(100)),saturationv:V("hsv",1,n(100)),value:V("hsv",2,n(100)),chroma:V("hcg",1,n(100)),gray:V("hcg",2,n(100)),white:V("hwb",1,n(100)),wblack:V("hwb",2,n(100)),cyan:V("cmyk",0,n(100)),magenta:V("cmyk",1,n(100)),yellow:V("cmyk",2,n(100)),black:V("cmyk",3,n(100)),x:V("xyz",0,n(95.047)),y:V("xyz",1,n(100)),z:V("xyz",2,n(108.833)),l:V("lab",0,n(100)),a:V("lab",1),b:V("lab",2),keyword(R){return void 0!==R?new U(R):c[this.model].keyword(this.color)},hex(R){return void 0!==R?new U(R):k.to.hex(this.rgb().round().color)},hexa(R){if(void 0!==R)return new U(R);const x=this.rgb().round().color;let H=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===H.length&&(H="0"+H),k.to.hex(x)+H},rgbNumber(){const R=this.rgb().color;return(255&R[0])<<16|(255&R[1])<<8|255&R[2]},luminosity(){const R=this.rgb().color,x=[];for(const[H,k]of R.entries()){const R=k/255;x[H]=R<=.04045?R/12.92:((R+.055)/1.055)**2.4}return.2126*x[0]+.7152*x[1]+.0722*x[2]},contrast(R){const x=this.luminosity(),H=R.luminosity();return x>H?(x+.05)/(H+.05):(H+.05)/(x+.05)},level(R){const x=this.contrast(R);return x>=7?"AAA":x>=4.5?"AA":""},isDark(){const R=this.rgb().color;return(2126*R[0]+7152*R[1]+722*R[2])/1e4<128},isLight(){return!this.isDark()},negate(){const R=this.rgb();for(let x=0;x<3;x++)R.color[x]=255-R.color[x];return R},lighten(R){const x=this.hsl();return x.color[2]+=x.color[2]*R,x},darken(R){const x=this.hsl();return x.color[2]-=x.color[2]*R,x},saturate(R){const x=this.hsl();return x.color[1]+=x.color[1]*R,x},desaturate(R){const x=this.hsl();return x.color[1]-=x.color[1]*R,x},whiten(R){const x=this.hwb();return x.color[1]+=x.color[1]*R,x},blacken(R){const x=this.hwb();return x.color[2]+=x.color[2]*R,x},grayscale(){const R=this.rgb().color,x=.3*R[0]+.59*R[1]+.11*R[2];return U.rgb(x,x,x)},fade(R){return this.alpha(this.valpha-this.valpha*R)},opaquer(R){return this.alpha(this.valpha+this.valpha*R)},rotate(R){const x=this.hsl();let H=x.color[0];return H=(H+R)%360,H=H<0?360+H:H,x.color[0]=H,x},mix(R,x){if(!R||!R.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof R);const H=R.rgb(),k=this.rgb(),c=void 0===x?.5:x,t=2*c-1,A=H.alpha()-k.alpha(),D=((t*A===-1?t:(t+A)/(1+t*A))+1)/2,J=1-D;return U.rgb(D*H.red()+J*k.red(),D*H.green()+J*k.green(),D*H.blue()+J*k.blue(),H.alpha()*c+k.alpha()*(1-c))}};for(const I of Object.keys(c)){if(t.includes(I))continue;const{channels:R}=c[I];U.prototype[I]=function(){if(this.model===I)return new U(this);for(var R=arguments.length,x=new Array(R),H=0;H<R;H++)x[H]=arguments[H];return x.length>0?new U(x,I):new U([...(k=c[this.model][I].raw(this.color),Array.isArray(k)?k:[k]),this.valpha],I);var k},U[I]=function(){for(var x=arguments.length,H=new Array(x),k=0;k<x;k++)H[k]=arguments[k];let c=H[0];return"number"===typeof c&&(c=g(H,R)),new U(c,I)}}function J(R){return function(x){return function(R,x){return Number(R.toFixed(x))}(x,R)}}function V(R,x,H){R=Array.isArray(R)?R:[R];for(const k of R)(D[k]||(D[k]=[]))[x]=H;return R=R[0],function(k){let c;return void 0!==k?(H&&(k=H(k)),c=this[R](),c.color[x]=k,c):(c=this[R]().color[x],H&&(c=H(c)),c)}}function n(R){return function(x){return Math.max(0,Math.min(R,x))}}function g(R,x){for(let H=0;H<x;H++)"number"!==typeof R[H]&&(R[H]=0);return R}R.exports=U},13497:(R,x,H)=>{const k=H(13500),c={};for(const A of Object.keys(k))c[k[A]]=A;const t={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};R.exports=t;for(const A of Object.keys(t)){if(!("channels"in t[A]))throw new Error("missing channels property: "+A);if(!("labels"in t[A]))throw new Error("missing channel labels property: "+A);if(t[A].labels.length!==t[A].channels)throw new Error("channel and label counts mismatch: "+A);const{channels:R,labels:x}=t[A];delete t[A].channels,delete t[A].labels,Object.defineProperty(t[A],"channels",{value:R}),Object.defineProperty(t[A],"labels",{value:x})}t.rgb.hsl=function(R){const x=R[0]/255,H=R[1]/255,k=R[2]/255,c=Math.min(x,H,k),t=Math.max(x,H,k),A=t-c;let D,U;t===c?D=0:x===t?D=(H-k)/A:H===t?D=2+(k-x)/A:k===t&&(D=4+(x-H)/A),D=Math.min(60*D,360),D<0&&(D+=360);const J=(c+t)/2;return U=t===c?0:J<=.5?A/(t+c):A/(2-t-c),[D,100*U,100*J]},t.rgb.hsv=function(R){let x,H,k,c,t;const A=R[0]/255,D=R[1]/255,U=R[2]/255,J=Math.max(A,D,U),V=J-Math.min(A,D,U),n=function(R){return(J-R)/6/V+.5};return 0===V?(c=0,t=0):(t=V/J,x=n(A),H=n(D),k=n(U),A===J?c=k-H:D===J?c=1/3+x-k:U===J&&(c=2/3+H-x),c<0?c+=1:c>1&&(c-=1)),[360*c,100*t,100*J]},t.rgb.hwb=function(R){const x=R[0],H=R[1];let k=R[2];const c=t.rgb.hsl(R)[0],A=1/255*Math.min(x,Math.min(H,k));return k=1-1/255*Math.max(x,Math.max(H,k)),[c,100*A,100*k]},t.rgb.cmyk=function(R){const x=R[0]/255,H=R[1]/255,k=R[2]/255,c=Math.min(1-x,1-H,1-k);return[100*((1-x-c)/(1-c)||0),100*((1-H-c)/(1-c)||0),100*((1-k-c)/(1-c)||0),100*c]},t.rgb.keyword=function(R){const x=c[R];if(x)return x;let H,t=1/0;for(const c of Object.keys(k)){const x=k[c],U=(D=x,((A=R)[0]-D[0])**2+(A[1]-D[1])**2+(A[2]-D[2])**2);U<t&&(t=U,H=c)}var A,D;return H},t.keyword.rgb=function(R){return k[R]},t.rgb.xyz=function(R){let x=R[0]/255,H=R[1]/255,k=R[2]/255;x=x>.04045?((x+.055)/1.055)**2.4:x/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,k=k>.04045?((k+.055)/1.055)**2.4:k/12.92;return[100*(.4124*x+.3576*H+.1805*k),100*(.2126*x+.7152*H+.0722*k),100*(.0193*x+.1192*H+.9505*k)]},t.rgb.lab=function(R){const x=t.rgb.xyz(R);let H=x[0],k=x[1],c=x[2];H/=95.047,k/=100,c/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,k=k>.008856?k**(1/3):7.787*k+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;return[116*k-16,500*(H-k),200*(k-c)]},t.hsl.rgb=function(R){const x=R[0]/360,H=R[1]/100,k=R[2]/100;let c,t,A;if(0===H)return A=255*k,[A,A,A];c=k<.5?k*(1+H):k+H-k*H;const D=2*k-c,U=[0,0,0];for(let J=0;J<3;J++)t=x+1/3*-(J-1),t<0&&t++,t>1&&t--,A=6*t<1?D+6*(c-D)*t:2*t<1?c:3*t<2?D+(c-D)*(2/3-t)*6:D,U[J]=255*A;return U},t.hsl.hsv=function(R){const x=R[0];let H=R[1]/100,k=R[2]/100,c=H;const t=Math.max(k,.01);k*=2,H*=k<=1?k:2-k,c*=t<=1?t:2-t;return[x,100*(0===k?2*c/(t+c):2*H/(k+H)),100*((k+H)/2)]},t.hsv.rgb=function(R){const x=R[0]/60,H=R[1]/100;let k=R[2]/100;const c=Math.floor(x)%6,t=x-Math.floor(x),A=255*k*(1-H),D=255*k*(1-H*t),U=255*k*(1-H*(1-t));switch(k*=255,c){case 0:return[k,U,A];case 1:return[D,k,A];case 2:return[A,k,U];case 3:return[A,D,k];case 4:return[U,A,k];case 5:return[k,A,D]}},t.hsv.hsl=function(R){const x=R[0],H=R[1]/100,k=R[2]/100,c=Math.max(k,.01);let t,A;A=(2-H)*k;const D=(2-H)*c;return t=H*c,t/=D<=1?D:2-D,t=t||0,A/=2,[x,100*t,100*A]},t.hwb.rgb=function(R){const x=R[0]/360;let H=R[1]/100,k=R[2]/100;const c=H+k;let t;c>1&&(H/=c,k/=c);const A=Math.floor(6*x),D=1-k;t=6*x-A,0!==(1&A)&&(t=1-t);const U=H+t*(D-H);let J,V,n;switch(A){default:case 6:case 0:J=D,V=U,n=H;break;case 1:J=U,V=D,n=H;break;case 2:J=H,V=D,n=U;break;case 3:J=H,V=U,n=D;break;case 4:J=U,V=H,n=D;break;case 5:J=D,V=H,n=U}return[255*J,255*V,255*n]},t.cmyk.rgb=function(R){const x=R[0]/100,H=R[1]/100,k=R[2]/100,c=R[3]/100;return[255*(1-Math.min(1,x*(1-c)+c)),255*(1-Math.min(1,H*(1-c)+c)),255*(1-Math.min(1,k*(1-c)+c))]},t.xyz.rgb=function(R){const x=R[0]/100,H=R[1]/100,k=R[2]/100;let c,t,A;return c=3.2406*x+-1.5372*H+-.4986*k,t=-.9689*x+1.8758*H+.0415*k,A=.0557*x+-.204*H+1.057*k,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,c=Math.min(Math.max(0,c),1),t=Math.min(Math.max(0,t),1),A=Math.min(Math.max(0,A),1),[255*c,255*t,255*A]},t.xyz.lab=function(R){let x=R[0],H=R[1],k=R[2];x/=95.047,H/=100,k/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,k=k>.008856?k**(1/3):7.787*k+16/116;return[116*H-16,500*(x-H),200*(H-k)]},t.lab.xyz=function(R){let x,H,k;H=(R[0]+16)/116,x=R[1]/500+H,k=H-R[2]/200;const c=H**3,t=x**3,A=k**3;return H=c>.008856?c:(H-16/116)/7.787,x=t>.008856?t:(x-16/116)/7.787,k=A>.008856?A:(k-16/116)/7.787,x*=95.047,H*=100,k*=108.883,[x,H,k]},t.lab.lch=function(R){const x=R[0],H=R[1],k=R[2];let c;c=360*Math.atan2(k,H)/2/Math.PI,c<0&&(c+=360);return[x,Math.sqrt(H*H+k*k),c]},t.lch.lab=function(R){const x=R[0],H=R[1],k=R[2]/360*2*Math.PI;return[x,H*Math.cos(k),H*Math.sin(k)]},t.rgb.ansi16=function(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[H,k,c]=R;let A=null===x?t.rgb.hsv(R)[2]:x;if(A=Math.round(A/50),0===A)return 30;let D=30+(Math.round(c/255)<<2|Math.round(k/255)<<1|Math.round(H/255));return 2===A&&(D+=60),D},t.hsv.ansi16=function(R){return t.rgb.ansi16(t.hsv.rgb(R),R[2])},t.rgb.ansi256=function(R){const x=R[0],H=R[1],k=R[2];if(x===H&&H===k)return x<8?16:x>248?231:Math.round((x-8)/247*24)+232;return 16+36*Math.round(x/255*5)+6*Math.round(H/255*5)+Math.round(k/255*5)},t.ansi16.rgb=function(R){let x=R%10;if(0===x||7===x)return R>50&&(x+=3.5),x=x/10.5*255,[x,x,x];const H=.5*(1+~~(R>50));return[(1&x)*H*255,(x>>1&1)*H*255,(x>>2&1)*H*255]},t.ansi256.rgb=function(R){if(R>=232){const x=10*(R-232)+8;return[x,x,x]}let x;R-=16;return[Math.floor(R/36)/5*255,Math.floor((x=R%36)/6)/5*255,x%6/5*255]},t.rgb.hex=function(R){const x=(((255&Math.round(R[0]))<<16)+((255&Math.round(R[1]))<<8)+(255&Math.round(R[2]))).toString(16).toUpperCase();return"000000".substring(x.length)+x},t.hex.rgb=function(R){const x=R.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!x)return[0,0,0];let H=x[0];3===x[0].length&&(H=H.split("").map((R=>R+R)).join(""));const k=parseInt(H,16);return[k>>16&255,k>>8&255,255&k]},t.rgb.hcg=function(R){const x=R[0]/255,H=R[1]/255,k=R[2]/255,c=Math.max(Math.max(x,H),k),t=Math.min(Math.min(x,H),k),A=c-t;let D,U;return D=A<1?t/(1-A):0,U=A<=0?0:c===x?(H-k)/A%6:c===H?2+(k-x)/A:4+(x-H)/A,U/=6,U%=1,[360*U,100*A,100*D]},t.hsl.hcg=function(R){const x=R[1]/100,H=R[2]/100,k=H<.5?2*x*H:2*x*(1-H);let c=0;return k<1&&(c=(H-.5*k)/(1-k)),[R[0],100*k,100*c]},t.hsv.hcg=function(R){const x=R[1]/100,H=R[2]/100,k=x*H;let c=0;return k<1&&(c=(H-k)/(1-k)),[R[0],100*k,100*c]},t.hcg.rgb=function(R){const x=R[0]/360,H=R[1]/100,k=R[2]/100;if(0===H)return[255*k,255*k,255*k];const c=[0,0,0],t=x%1*6,A=t%1,D=1-A;let U=0;switch(Math.floor(t)){case 0:c[0]=1,c[1]=A,c[2]=0;break;case 1:c[0]=D,c[1]=1,c[2]=0;break;case 2:c[0]=0,c[1]=1,c[2]=A;break;case 3:c[0]=0,c[1]=D,c[2]=1;break;case 4:c[0]=A,c[1]=0,c[2]=1;break;default:c[0]=1,c[1]=0,c[2]=D}return U=(1-H)*k,[255*(H*c[0]+U),255*(H*c[1]+U),255*(H*c[2]+U)]},t.hcg.hsv=function(R){const x=R[1]/100,H=x+R[2]/100*(1-x);let k=0;return H>0&&(k=x/H),[R[0],100*k,100*H]},t.hcg.hsl=function(R){const x=R[1]/100,H=R[2]/100*(1-x)+.5*x;let k=0;return H>0&&H<.5?k=x/(2*H):H>=.5&&H<1&&(k=x/(2*(1-H))),[R[0],100*k,100*H]},t.hcg.hwb=function(R){const x=R[1]/100,H=x+R[2]/100*(1-x);return[R[0],100*(H-x),100*(1-H)]},t.hwb.hcg=function(R){const x=R[1]/100,H=1-R[2]/100,k=H-x;let c=0;return k<1&&(c=(H-k)/(1-k)),[R[0],100*k,100*c]},t.apple.rgb=function(R){return[R[0]/65535*255,R[1]/65535*255,R[2]/65535*255]},t.rgb.apple=function(R){return[R[0]/255*65535,R[1]/255*65535,R[2]/255*65535]},t.gray.rgb=function(R){return[R[0]/100*255,R[0]/100*255,R[0]/100*255]},t.gray.hsl=function(R){return[0,0,R[0]]},t.gray.hsv=t.gray.hsl,t.gray.hwb=function(R){return[0,100,R[0]]},t.gray.cmyk=function(R){return[0,0,0,R[0]]},t.gray.lab=function(R){return[R[0],0,0]},t.gray.hex=function(R){const x=255&Math.round(R[0]/100*255),H=((x<<16)+(x<<8)+x).toString(16).toUpperCase();return"000000".substring(H.length)+H},t.rgb.gray=function(R){return[(R[0]+R[1]+R[2])/3/255*100]}},13494:(R,x,H)=>{const k=H(13497),c=H(13508),t={};Object.keys(k).forEach((R=>{t[R]={},Object.defineProperty(t[R],"channels",{value:k[R].channels}),Object.defineProperty(t[R],"labels",{value:k[R].labels});const x=c(R);Object.keys(x).forEach((H=>{const k=x[H];t[R][H]=function(R){const x=function(){for(var x=arguments.length,H=new Array(x),k=0;k<x;k++)H[k]=arguments[k];const c=H[0];if(void 0===c||null===c)return c;c.length>1&&(H=c);const t=R(H);if("object"===typeof t)for(let R=t.length,A=0;A<R;A++)t[A]=Math.round(t[A]);return t};return"conversion"in R&&(x.conversion=R.conversion),x}(k),t[R][H].raw=function(R){const x=function(){for(var x=arguments.length,H=new Array(x),k=0;k<x;k++)H[k]=arguments[k];const c=H[0];return void 0===c||null===c?c:(c.length>1&&(H=c),R(H))};return"conversion"in R&&(x.conversion=R.conversion),x}(k)}))})),R.exports=t},13508:(R,x,H)=>{const k=H(13497);function c(R){const x=function(){const R={},x=Object.keys(k);for(let H=x.length,k=0;k<H;k++)R[x[k]]={distance:-1,parent:null};return R}(),H=[R];for(x[R].distance=0;H.length;){const R=H.pop(),c=Object.keys(k[R]);for(let k=c.length,t=0;t<k;t++){const k=c[t],A=x[k];-1===A.distance&&(A.distance=x[R].distance+1,A.parent=R,H.unshift(k))}}return x}function t(R,x){return function(H){return x(R(H))}}function A(R,x){const H=[x[R].parent,R];let c=k[x[R].parent][R],A=x[R].parent;for(;x[A].parent;)H.unshift(x[A].parent),c=t(k[x[A].parent][A],c),A=x[A].parent;return c.conversion=H,c}R.exports=function(R){const x=c(R),H={},k=Object.keys(x);for(let c=k.length,t=0;t<c;t++){const R=k[t];null!==x[R].parent&&(H[R]=A(R,x))}return H}},13500:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12492:function(R,x,H){"use strict";var k=this&&this.__createBinding||(Object.create?function(R,x,H,k){void 0===k&&(k=H);var c=Object.getOwnPropertyDescriptor(x,H);c&&!("get"in c?!x.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return x[H]}}),Object.defineProperty(R,k,c)}:function(R,x,H,k){void 0===k&&(k=H),R[k]=x[H]}),c=this&&this.__setModuleDefault||(Object.create?function(R,x){Object.defineProperty(R,"default",{enumerable:!0,value:x})}:function(R,x){R.default=x}),t=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var x={};if(null!=R)for(var H in R)"default"!==H&&Object.prototype.hasOwnProperty.call(R,H)&&k(x,R,H);return c(x,R),x},A=this&&this.__awaiter||function(R,x,H,k){return new(H||(H=Promise))((function(c,t){function A(R){try{U(k.next(R))}catch(x){t(x)}}function D(R){try{U(k.throw(R))}catch(x){t(x)}}function U(R){var x;R.done?c(R.value):(x=R.value,x instanceof H?x:new H((function(R){R(x)}))).then(A,D)}U((k=k.apply(R,x||[])).next())}))};Object.defineProperty(x,"__esModule",{value:!0}),x.Auth=x.Platform=void 0;const D=t(H(12423)),U=H(12497),J="colyseus-auth-token";!function(R){R.ios="ios",R.android="android"}(x.Platform||(x.Platform={}));x.Auth=class{constructor(R){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=R.replace("ws","http"),(0,U.getItem)(J,(R=>this.token=R))}get hasToken(){return!!this.token}login(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A(this,void 0,void 0,(function*(){const x=Object.assign({},R);this.hasToken&&(x.token=this.token);const H=yield this.request("post","/auth",x);this.token=H.token,(0,U.setItem)(J,this.token);for(let R in H)this.hasOwnProperty(R)&&(this[R]=H[R]);return this.registerPingService(),this}))}save(){return A(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return A(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return A(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return A(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(R){return A(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:R})}))}acceptFriendRequest(R){return A(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:R})}))}declineFriendRequest(R){return A(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:R})}))}blockUser(R){return A(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:R})}))}unblockUser(R){return A(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:R})}))}request(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},k=arguments.length>3?arguments[3]:void 0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return A(this,void 0,void 0,(function*(){c.Accept="application/json",this.hasToken&&(c.Authorization="Bearer "+this.token);const t=[];for(const R in H)t.push(`${R}=${H[R]}`);const A=t.length>0?`?${t.join("&")}`:"",U={headers:c};return k&&(U.body=k),(yield D[R](`${this.endpoint}${x}${A}`,U)).data}))}logout(){this.token=void 0,(0,U.removeItem)(J),this.unregisterPingService()}registerPingService(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),R)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},12415:function(R,x,H){"use strict";var k,c=this&&this.__awaiter||function(R,x,H,k){return new(H||(H=Promise))((function(c,t){function A(R){try{U(k.next(R))}catch(x){t(x)}}function D(R){try{U(k.throw(R))}catch(x){t(x)}}function U(R){var x;R.done?c(R.value):(x=R.value,x instanceof H?x:new H((function(R){R(x)}))).then(A,D)}U((k=k.apply(R,x||[])).next())}))};Object.defineProperty(x,"__esModule",{value:!0}),x.Client=x.MatchMakeError=void 0;const t=H(12423),A=H(12431),D=H(12439);class U extends Error{constructor(R,x){super(R),this.code=x,Object.setPrototypeOf(this,U.prototype)}}x.MatchMakeError=U;const J="undefined"!==typeof window&&"undefined"!==typeof(null===(k=null===window||void 0===window?void 0:window.location)||void 0===k?void 0:k.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";x.Client=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J;if("string"===typeof R){const x=new URL(R),H="https:"===x.protocol||"wss:"===x.protocol,k=Number(x.port||(H?443:80));this.settings={hostname:x.hostname,pathname:"/"!==x.pathname?x.pathname:"",port:k,secure:H}}else void 0===R.port&&(R.port=R.secure?443:80),void 0===R.pathname&&(R.pathname=""),this.settings=R}joinOrCreate(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",R,x,H)}))}create(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",R,x,H)}))}join(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",R,x,H)}))}joinById(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",R,x,H)}))}reconnect(R,x){return c(this,void 0,void 0,(function*(){if("string"===typeof R&&"string"===typeof x)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[H,k]=R.split(":");return yield this.createMatchMakeRequest("reconnect",H,{reconnectionToken:k},x)}))}getAvailableRooms(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c(this,void 0,void 0,(function*(){return(yield(0,t.get)(this.getHttpEndpoint(`${R}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(R,x,H){return c(this,void 0,void 0,(function*(){const k=this.createRoom(R.room.name,x);k.roomId=R.room.roomId,k.sessionId=R.sessionId;const t={sessionId:k.sessionId};R.reconnectionToken&&(t.reconnectionToken=R.reconnectionToken);const D=H||k;return k.connect(this.buildEndpoint(R.room,t),R.devMode&&(()=>c(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${k.roomId}'...`);let H=0;const t=()=>c(this,void 0,void 0,(function*(){H++;try{yield this.consumeSeatReservation(R,x,D),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${k.roomId}'`)}catch(c){H<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${H} out of 8)`),setTimeout(t,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(t,2e3)}))),D),new Promise(((R,x)=>{const H=(R,H)=>x(new A.ServerError(R,H));D.onError.once(H),D.onJoin.once((()=>{D.onError.remove(H),R(D)}))}))}))}createMatchMakeRequest(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},k=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;return c(this,void 0,void 0,(function*(){const c=(yield(0,t.post)(this.getHttpEndpoint(`${R}/${x}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(H)})).data;if(c.error)throw new U(c.error,c.code);return"reconnect"===R&&(c.reconnectionToken=H.reconnectionToken),yield this.consumeSeatReservation(c,k,A)}))}createRoom(R,x){return new D.Room(R,x)}buildEndpoint(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=[];for(const c in x)x.hasOwnProperty(c)&&H.push(`${c}=${x[c]}`);let k=this.settings.secure?"wss://":"ws://";return R.publicAddress?k+=`${R.publicAddress}`:k+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${k}/${R.processId}/${R.roomId}?${H.join("&")}`}getHttpEndpoint(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${R}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12444:(R,x,H)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.Connection=void 0;const k=H(12453);x.Connection=class{constructor(){this.events={},this.transport=new k.WebSocketTransport(this.events)}send(R){this.transport.send(R)}connect(R){this.transport.connect(R)}close(R,x){this.transport.close(R,x)}get isOpen(){return this.transport.isOpen}}},12462:(R,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.utf8Length=x.utf8Read=x.ErrorCode=x.Protocol=void 0,function(R){R[R.HANDSHAKE=9]="HANDSHAKE",R[R.JOIN_ROOM=10]="JOIN_ROOM",R[R.ERROR=11]="ERROR",R[R.LEAVE_ROOM=12]="LEAVE_ROOM",R[R.ROOM_DATA=13]="ROOM_DATA",R[R.ROOM_STATE=14]="ROOM_STATE",R[R.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",R[R.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",R[R.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(x.Protocol||(x.Protocol={})),function(R){R[R.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",R[R.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",R[R.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",R[R.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",R[R.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",R[R.AUTH_FAILED=4215]="AUTH_FAILED",R[R.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(x.ErrorCode||(x.ErrorCode={})),x.utf8Read=function(R,x){const H=R[x++];for(var k="",c=0,t=x,A=x+H;t<A;t++){var D=R[t];if(0!==(128&D))if(192!==(224&D))if(224!==(240&D)){if(240!==(248&D))throw new Error("Invalid byte "+D.toString(16));(c=(7&D)<<18|(63&R[++t])<<12|(63&R[++t])<<6|63&R[++t])>=65536?(c-=65536,k+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):k+=String.fromCharCode(c)}else k+=String.fromCharCode((15&D)<<12|(63&R[++t])<<6|63&R[++t]);else k+=String.fromCharCode((31&D)<<6|63&R[++t]);else k+=String.fromCharCode(D)}return k},x.utf8Length=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",x=0,H=0;for(let k=0,c=R.length;k<c;k++)x=R.charCodeAt(k),x<128?H+=1:x<2048?H+=2:x<55296||x>=57344?H+=3:(k++,H+=4);return H+1}},12439:function(R,x,H){"use strict";var k=this&&this.__createBinding||(Object.create?function(R,x,H,k){void 0===k&&(k=H);var c=Object.getOwnPropertyDescriptor(x,H);c&&!("get"in c?!x.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return x[H]}}),Object.defineProperty(R,k,c)}:function(R,x,H,k){void 0===k&&(k=H),R[k]=x[H]}),c=this&&this.__setModuleDefault||(Object.create?function(R,x){Object.defineProperty(R,"default",{enumerable:!0,value:x})}:function(R,x){R.default=x}),t=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var x={};if(null!=R)for(var H in R)"default"!==H&&Object.prototype.hasOwnProperty.call(R,H)&&k(x,R,H);return c(x,R),x};Object.defineProperty(x,"__esModule",{value:!0}),x.Room=void 0;const A=t(H(12442)),D=H(12444),U=H(12462),J=H(12470),V=H(12473),n=H(12482),g=H(12484),I=H(12431);class i{constructor(R,x){this.onStateChange=(0,n.createSignal)(),this.onError=(0,n.createSignal)(),this.onLeave=(0,n.createSignal)(),this.onJoin=(0,n.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,V.createNanoEvents)(),this.roomId=null,this.name=R,x&&(this.serializer=new((0,J.getSerializer)("schema")),this.rootSchema=x,this.serializer.state=new x),this.onError(((R,x)=>{var H;return null===(H=console.warn)||void 0===H?void 0:H.call(console,`colyseus.js - onError => (${R}) ${x}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const k=new D.Connection;H.connection=k,k.events.onmessage=i.prototype.onMessageCallback.bind(H),k.events.onclose=function(R){var k;if(!H.hasJoined)return null===(k=console.warn)||void 0===k||k.call(console,`Room connection was closed unexpectedly (${R.code}): ${R.reason}`),void H.onError.invoke(R.code,R.reason);R.code===I.CloseCode.DEVMODE_RESTART&&x?x():(H.onLeave.invoke(R.code),H.destroy())},k.events.onerror=function(R){var x;null===(x=console.warn)||void 0===x||x.call(console,`Room, onError (${R.code}): ${R.reason}`),H.onError.invoke(R.code,R.reason)},k.connect(R)}leave(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((x=>{this.onLeave((R=>x(R))),this.connection?R?this.connection.send([U.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(I.CloseCode.CONSENTED)}))}onMessage(R,x){return this.onMessageHandlers.on(this.getMessageHandlerKey(R),x)}send(R,x){const H=[U.Protocol.ROOM_DATA];let k;if("string"===typeof R?g.encode.string(H,R):g.encode.number(H,R),void 0!==x){const R=A.encode(x);k=new Uint8Array(H.length+R.byteLength),k.set(new Uint8Array(H),0),k.set(new Uint8Array(R),H.length)}else k=new Uint8Array(H);this.connection.send(k.buffer)}sendBytes(R,x){const H=[U.Protocol.ROOM_DATA_BYTES];let k;"string"===typeof R?g.encode.string(H,R):g.encode.number(H,R),k=new Uint8Array(H.length+(x.byteLength||x.length)),k.set(new Uint8Array(H),0),k.set(new Uint8Array(x),H.length),this.connection.send(k.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(R){const x=Array.from(new Uint8Array(R.data)),H=x[0];if(H===U.Protocol.JOIN_ROOM){let R=1;const H=(0,U.utf8Read)(x,R);if(R+=(0,U.utf8Length)(H),this.serializerId=(0,U.utf8Read)(x,R),R+=(0,U.utf8Length)(this.serializerId),!this.serializer){const R=(0,J.getSerializer)(this.serializerId);this.serializer=new R}x.length>R&&this.serializer.handshake&&this.serializer.handshake(x,{offset:R}),this.reconnectionToken=`${this.roomId}:${H}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([U.Protocol.JOIN_ROOM])}else if(H===U.Protocol.ERROR){const R={offset:1},H=g.decode.number(x,R),k=g.decode.string(x,R);this.onError.invoke(H,k)}else if(H===U.Protocol.LEAVE_ROOM)this.leave();else if(H===U.Protocol.ROOM_DATA_SCHEMA){const R={offset:1},H=this.serializer.getState().constructor._context.get(g.decode.number(x,R)),k=new H;k.decode(x,R),this.dispatchMessage(H,k)}else if(H===U.Protocol.ROOM_STATE)x.shift(),this.setState(x);else if(H===U.Protocol.ROOM_STATE_PATCH)x.shift(),this.patch(x);else if(H===U.Protocol.ROOM_DATA){const H={offset:1},k=g.decode.stringCheck(x,H)?g.decode.string(x,H):g.decode.number(x,H),c=x.length>H.offset?A.decode(R.data,H.offset):void 0;this.dispatchMessage(k,c)}else if(H===U.Protocol.ROOM_DATA_BYTES){const R={offset:1},H=g.decode.stringCheck(x,R)?g.decode.string(x,R):g.decode.number(x,R);this.dispatchMessage(H,new Uint8Array(x.slice(R.offset)))}}setState(R){this.serializer.setState(R),this.onStateChange.invoke(this.serializer.getState())}patch(R){this.serializer.patch(R),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(R,x){var H;const k=this.getMessageHandlerKey(R);this.onMessageHandlers.events[k]?this.onMessageHandlers.emit(k,x):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",R,x):null===(H=console.warn)||void 0===H||H.call(console,`colyseus.js: onMessage() not registered for type '${R}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(R){switch(typeof R){case"function":return`$${R._typeid}`;case"string":return R;case"number":return`i${R}`;default:throw new Error("invalid message type.")}}}x.Room=i},12497:(R,x)=>{"use strict";let H;function k(){return H||(H="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(R,x){this.cache[R]=x},getItem:function(R){this.cache[R]},removeItem:function(R){delete this.cache[R]}}),H}Object.defineProperty(x,"__esModule",{value:!0}),x.getItem=x.removeItem=x.setItem=void 0,x.setItem=function(R,x){k().setItem(R,x)},x.removeItem=function(R){k().removeItem(R)},x.getItem=function(R,x){const H=k().getItem(R);"undefined"!==typeof Promise&&H instanceof Promise?H.then((R=>x(R))):x(H)}},12473:(R,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createNanoEvents=void 0;x.createNanoEvents=()=>({emit(R){let x=this.events[R]||[];for(var H=arguments.length,k=new Array(H>1?H-1:0),c=1;c<H;c++)k[c-1]=arguments[c];for(let t=0,A=x.length;t<A;t++)x[t](...k)},events:{},on(R,x){var H;return(null===(H=this.events[R])||void 0===H?void 0:H.push(x))||(this.events[R]=[x]),()=>{var H;this.events[R]=null===(H=this.events[R])||void 0===H?void 0:H.filter((R=>x!==R))}}})},12482:(R,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createSignal=x.EventEmitter=void 0;class H{constructor(){this.handlers=[]}register(R){return this.handlers.push(R),this}invoke(){for(var R=arguments.length,x=new Array(R),H=0;H<R;H++)x[H]=arguments[H];this.handlers.forEach((R=>R.apply(this,x)))}invokeAsync(){for(var R=arguments.length,x=new Array(R),H=0;H<R;H++)x[H]=arguments[H];return Promise.all(this.handlers.map((R=>R.apply(this,x))))}remove(R){const x=this.handlers.indexOf(R);this.handlers[x]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}x.EventEmitter=H,x.createSignal=function(){const R=new H;function x(x){return R.register(x,null===this)}return x.once=x=>{const H=function(){for(var k=arguments.length,c=new Array(k),t=0;t<k;t++)c[t]=arguments[t];x.apply(this,c),R.remove(H)};R.register(H)},x.remove=x=>R.remove(x),x.invoke=function(){return R.invoke(...arguments)},x.invokeAsync=function(){return R.invokeAsync(...arguments)},x.clear=()=>R.clear(),x}},12431:(R,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.ServerError=x.CloseCode=void 0,function(R){R[R.CONSENTED=4e3]="CONSENTED",R[R.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(x.CloseCode||(x.CloseCode={}));class H extends Error{constructor(R,x){super(x),this.name="ServerError",this.code=R}}x.ServerError=H},12404:(R,x,H)=>{"use strict";x.b=void 0,H(12410);var k=H(12415);Object.defineProperty(x,"b",{enumerable:!0,get:function(){return k.Client}});var c=H(12462);var t=H(12439);var A=H(12492);const D=H(12499);const U=H(12503),J=H(12470);(0,J.registerSerializer)("schema",D.SchemaSerializer),(0,J.registerSerializer)("none",U.NoneSerializer)},12410:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=R=>null!==R&&"object"===typeof R&&R.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12442:(R,x)=>{"use strict";function H(R,x){if(this._offset=x,R instanceof ArrayBuffer)this._buffer=R,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(R))throw new Error("Invalid argument");this._buffer=R.buffer,this._view=new DataView(this._buffer,R.byteOffset,R.byteLength)}}Object.defineProperty(x,"__esModule",{value:!0}),x.decode=x.encode=void 0,H.prototype._array=function(R){for(var x=new Array(R),H=0;H<R;H++)x[H]=this._parse();return x},H.prototype._map=function(R){for(var x={},H=0;H<R;H++)x[this._parse()]=this._parse();return x},H.prototype._str=function(R){var x=function(R,x,H){for(var k="",c=0,t=x,A=x+H;t<A;t++){var D=R.getUint8(t);if(0!==(128&D))if(192!==(224&D))if(224!==(240&D)){if(240!==(248&D))throw new Error("Invalid byte "+D.toString(16));(c=(7&D)<<18|(63&R.getUint8(++t))<<12|(63&R.getUint8(++t))<<6|63&R.getUint8(++t))>=65536?(c-=65536,k+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):k+=String.fromCharCode(c)}else k+=String.fromCharCode((15&D)<<12|(63&R.getUint8(++t))<<6|63&R.getUint8(++t));else k+=String.fromCharCode((31&D)<<6|63&R.getUint8(++t));else k+=String.fromCharCode(D)}return k}(this._view,this._offset,R);return this._offset+=R,x},H.prototype._bin=function(R){var x=this._buffer.slice(this._offset,this._offset+R);return this._offset+=R,x},H.prototype._parse=function(){var R,x=this._view.getUint8(this._offset++),H=0,k=0,c=0,t=0;if(x<192)return x<128?x:x<144?this._map(15&x):x<160?this._array(15&x):this._str(31&x);if(x>223)return-1*(255-x+1);switch(x){case 192:return null;case 194:return!1;case 195:return!0;case 196:return H=this._view.getUint8(this._offset),this._offset+=1,this._bin(H);case 197:return H=this._view.getUint16(this._offset),this._offset+=2,this._bin(H);case 198:return H=this._view.getUint32(this._offset),this._offset+=4,this._bin(H);case 199:if(H=this._view.getUint8(this._offset),k=this._view.getInt8(this._offset+1),this._offset+=2,-1===k){var A=this._view.getUint32(this._offset);return c=this._view.getInt32(this._offset+4),t=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*c+t)+A/1e6)}return[k,this._bin(H)];case 200:return H=this._view.getUint16(this._offset),k=this._view.getInt8(this._offset+2),this._offset+=3,[k,this._bin(H)];case 201:return H=this._view.getUint32(this._offset),k=this._view.getInt8(this._offset+4),this._offset+=5,[k,this._bin(H)];case 202:return R=this._view.getFloat32(this._offset),this._offset+=4,R;case 203:return R=this._view.getFloat64(this._offset),this._offset+=8,R;case 204:return R=this._view.getUint8(this._offset),this._offset+=1,R;case 205:return R=this._view.getUint16(this._offset),this._offset+=2,R;case 206:return R=this._view.getUint32(this._offset),this._offset+=4,R;case 207:return c=this._view.getUint32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,c+t;case 208:return R=this._view.getInt8(this._offset),this._offset+=1,R;case 209:return R=this._view.getInt16(this._offset),this._offset+=2,R;case 210:return R=this._view.getInt32(this._offset),this._offset+=4,R;case 211:return c=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,c+t;case 212:return k=this._view.getInt8(this._offset),this._offset+=1,0===k?void(this._offset+=1):[k,this._bin(1)];case 213:return k=this._view.getInt8(this._offset),this._offset+=1,[k,this._bin(2)];case 214:return k=this._view.getInt8(this._offset),this._offset+=1,-1===k?(R=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*R)):[k,this._bin(4)];case 215:return k=this._view.getInt8(this._offset),this._offset+=1,0===k?(c=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(c+t)):-1===k?(c=this._view.getUint32(this._offset),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&c)+t)+(c>>>2)/1e6)):[k,this._bin(8)];case 216:return k=this._view.getInt8(this._offset),this._offset+=1,[k,this._bin(16)];case 217:return H=this._view.getUint8(this._offset),this._offset+=1,this._str(H);case 218:return H=this._view.getUint16(this._offset),this._offset+=2,this._str(H);case 219:return H=this._view.getUint32(this._offset),this._offset+=4,this._str(H);case 220:return H=this._view.getUint16(this._offset),this._offset+=2,this._array(H);case 221:return H=this._view.getUint32(this._offset),this._offset+=4,this._array(H);case 222:return H=this._view.getUint16(this._offset),this._offset+=2,this._map(H);case 223:return H=this._view.getUint32(this._offset),this._offset+=4,this._map(H)}throw new Error("Could not parse")},x.decode=function(R){var x=new H(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),k=x._parse();if(x._offset!==R.byteLength)throw new Error(R.byteLength-x._offset+" trailing bytes");return k};function k(R,x,H){for(var k=0,c=0,t=H.length;c<t;c++)(k=H.charCodeAt(c))<128?R.setUint8(x++,k):k<2048?(R.setUint8(x++,192|k>>6),R.setUint8(x++,128|63&k)):k<55296||k>=57344?(R.setUint8(x++,224|k>>12),R.setUint8(x++,128|k>>6&63),R.setUint8(x++,128|63&k)):(c++,k=65536+((1023&k)<<10|1023&H.charCodeAt(c)),R.setUint8(x++,240|k>>18),R.setUint8(x++,128|k>>12&63),R.setUint8(x++,128|k>>6&63),R.setUint8(x++,128|63&k))}function c(R,x,H){var k=typeof H,t=0,A=0,D=0,U=0,J=0,V=0;if("string"===k){if(J=function(R){for(var x=0,H=0,k=0,c=R.length;k<c;k++)(x=R.charCodeAt(k))<128?H+=1:x<2048?H+=2:x<55296||x>=57344?H+=3:(k++,H+=4);return H}(H),J<32)R.push(160|J),V=1;else if(J<256)R.push(217,J),V=2;else if(J<65536)R.push(218,J>>8,J),V=3;else{if(!(J<4294967296))throw new Error("String too long");R.push(219,J>>24,J>>16,J>>8,J),V=5}return x.push({_str:H,_length:J,_offset:R.length}),V+J}if("number"===k)return Math.floor(H)===H&&isFinite(H)?H>=0?H<128?(R.push(H),1):H<256?(R.push(204,H),2):H<65536?(R.push(205,H>>8,H),3):H<4294967296?(R.push(206,H>>24,H>>16,H>>8,H),5):(D=H/Math.pow(2,32)|0,U=H>>>0,R.push(207,D>>24,D>>16,D>>8,D,U>>24,U>>16,U>>8,U),9):H>=-32?(R.push(H),1):H>=-128?(R.push(208,H),2):H>=-32768?(R.push(209,H>>8,H),3):H>=-2147483648?(R.push(210,H>>24,H>>16,H>>8,H),5):(D=Math.floor(H/Math.pow(2,32)),U=H>>>0,R.push(211,D>>24,D>>16,D>>8,D,U>>24,U>>16,U>>8,U),9):(R.push(203),x.push({_float:H,_length:8,_offset:R.length}),9);if("object"===k){if(null===H)return R.push(192),1;if(Array.isArray(H)){if((J=H.length)<16)R.push(144|J),V=1;else if(J<65536)R.push(220,J>>8,J),V=3;else{if(!(J<4294967296))throw new Error("Array too large");R.push(221,J>>24,J>>16,J>>8,J),V=5}for(t=0;t<J;t++)V+=c(R,x,H[t]);return V}if(H instanceof Date){var n=H.getTime(),g=Math.floor(n/1e3),I=1e6*(n-1e3*g);return g>=0&&I>=0&&g<=17179869183?0===I&&g<=4294967295?(R.push(214,255,g>>24,g>>16,g>>8,g),6):(D=g/4294967296,U=4294967295&g,R.push(215,255,I>>22,I>>14,I>>6,D,U>>24,U>>16,U>>8,U),10):(D=Math.floor(g/4294967296),U=g>>>0,R.push(199,12,255,I>>24,I>>16,I>>8,I,D>>24,D>>16,D>>8,D,U>>24,U>>16,U>>8,U),15)}if(H instanceof ArrayBuffer){if((J=H.byteLength)<256)R.push(196,J),V=2;else if(J<65536)R.push(197,J>>8,J),V=3;else{if(!(J<4294967296))throw new Error("Buffer too large");R.push(198,J>>24,J>>16,J>>8,J),V=5}return x.push({_bin:H,_length:J,_offset:R.length}),V+J}if("function"===typeof H.toJSON)return c(R,x,H.toJSON());var i=[],q="",S=Object.keys(H);for(t=0,A=S.length;t<A;t++)void 0!==H[q=S[t]]&&"function"!==typeof H[q]&&i.push(q);if((J=i.length)<16)R.push(128|J),V=1;else if(J<65536)R.push(222,J>>8,J),V=3;else{if(!(J<4294967296))throw new Error("Object too large");R.push(223,J>>24,J>>16,J>>8,J),V=5}for(t=0;t<J;t++)V+=c(R,x,q=i[t]),V+=c(R,x,H[q]);return V}if("boolean"===k)return R.push(H?195:194),1;if("undefined"===k)return R.push(192),1;if("function"===typeof H.toJSON)return c(R,x,H.toJSON());throw new Error("Could not encode")}x.encode=function(R){var x=[],H=[],t=c(x,H,R),A=new ArrayBuffer(t),D=new DataView(A),U=0,J=0,V=-1;H.length>0&&(V=H[0]._offset);for(var n,g=0,I=0,i=0,q=x.length;i<q;i++)if(D.setUint8(J+i,x[i]),i+1===V){if(g=(n=H[U])._length,I=J+V,n._bin)for(var S=new Uint8Array(n._bin),L=0;L<g;L++)D.setUint8(I+L,S[L]);else n._str?k(D,I,n._str):void 0!==n._float&&D.setFloat64(I,n._float);J+=g,H[++U]&&(V=H[U]._offset)}return A}},12503:(R,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.NoneSerializer=void 0;x.NoneSerializer=class{setState(R){}getState(){return null}patch(R){}teardown(){}handshake(R){}}},12499:(R,x,H)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.SchemaSerializer=void 0;const k=H(12484);x.SchemaSerializer=class{setState(R){return this.state.decode(R)}getState(){return this.state}patch(R){return this.state.decode(R)}teardown(){var R,x;null===(x=null===(R=this.state)||void 0===R?void 0:R.$changes)||void 0===x||x.root.clearRefs()}handshake(R,x){if(this.state){(new k.Reflection).decode(R,x)}else this.state=k.Reflection.decode(R,x)}}},12470:(R,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.getSerializer=x.registerSerializer=void 0;const H={};x.registerSerializer=function(R,x){H[R]=x},x.getSerializer=function(R){const x=H[R];if(!x)throw new Error("missing serializer: "+R);return x}},12453:function(R,x,H){"use strict";var k=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(x,"__esModule",{value:!0}),x.WebSocketTransport=void 0;const c=k(H(12456)),t=globalThis.WebSocket||c.default;x.WebSocketTransport=class{constructor(R){this.events=R}send(R){R instanceof ArrayBuffer?this.ws.send(R):Array.isArray(R)&&this.ws.send(new Uint8Array(R).buffer)}connect(R){this.ws=new t(R,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(R,x){this.ws.close(R,x)}get isOpen(){return this.ws.readyState===t.OPEN}}},12456:R=>{"use strict";R.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12620:R=>{"use strict";R.exports=function(R){for(var x=new Array(R),H=0;H<R;++H)x[H]=H;return x}},12624:R=>{function x(R){return!!R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}R.exports=function(R){return null!=R&&(x(R)||function(R){return"function"===typeof R.readFloatLE&&"function"===typeof R.slice&&x(R.slice(0,0))}(R)||!!R._isBuffer)}},12618:(R,x,H)=>{var k=H(12620),c=H(12624),t="undefined"!==typeof Float64Array;function A(R,x){return R[0]-x[0]}function D(){var R,x=this.stride,H=new Array(x.length);for(R=0;R<H.length;++R)H[R]=[Math.abs(x[R]),R];H.sort(A);var k=new Array(H.length);for(R=0;R<k.length;++R)k[R]=H[R][1];return k}function U(R,x){var H=["View",x,"d",R].join("");x<0&&(H="View_Nil"+R);var c="generic"===R;if(-1===x){var t="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+R+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(t)()}if(0===x){t="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+R+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(c?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(c?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",t)(J[R][0])}t=["'use strict'"];var A=k(x),U=A.map((function(R){return"i"+R})),V="this.offset+"+A.map((function(R){return"this.stride["+R+"]*i"+R})).join("+"),n=A.map((function(R){return"b"+R})).join(","),g=A.map((function(R){return"c"+R})).join(",");t.push("function "+H+"(a,"+n+","+g+",d){this.data=a","this.shape=["+n+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+R+"'","proto.dimension="+x),t.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+A.map((function(R){return"this.shape["+R+"]"})).join("*"),"}})"),1===x?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),x<4?(t.push("function "+H+"_order(){"),2===x?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===x&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+H+"_set("+U.join(",")+",v){"),c?t.push("return this.data.set("+V+",v)}"):t.push("return this.data["+V+"]=v}"),t.push("proto.get=function "+H+"_get("+U.join(",")+"){"),c?t.push("return this.data.get("+V+")}"):t.push("return this.data["+V+"]}"),t.push("proto.index=function "+H+"_index(",U.join(),"){return "+V+"}"),t.push("proto.hi=function "+H+"_hi("+U.join(",")+"){return new "+H+"(this.data,"+A.map((function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this.shape[",R,"]:i",R,"|0"].join("")})).join(",")+","+A.map((function(R){return"this.stride["+R+"]"})).join(",")+",this.offset)}");var I=A.map((function(R){return"a"+R+"=this.shape["+R+"]"})),i=A.map((function(R){return"c"+R+"=this.stride["+R+"]"}));t.push("proto.lo=function "+H+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+I.join(",")+","+i.join(","));for(var q=0;q<x;++q)t.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");t.push("return new "+H+"(this.data,"+A.map((function(R){return"a"+R})).join(",")+","+A.map((function(R){return"c"+R})).join(",")+",b)}"),t.push("proto.step=function "+H+"_step("+U.join(",")+"){var "+A.map((function(R){return"a"+R+"=this.shape["+R+"]"})).join(",")+","+A.map((function(R){return"b"+R+"=this.stride["+R+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(q=0;q<x;++q)t.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");t.push("return new "+H+"(this.data,"+A.map((function(R){return"a"+R})).join(",")+","+A.map((function(R){return"b"+R})).join(",")+",c)}");var S=new Array(x),L=new Array(x);for(q=0;q<x;++q)S[q]="a[i"+q+"]",L[q]="b[i"+q+"]";t.push("proto.transpose=function "+H+"_transpose("+U+"){"+U.map((function(R,x){return R+"=("+R+"===undefined?"+x+":"+R+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+S.join(",")+","+L.join(",")+",this.offset)}"),t.push("proto.pick=function "+H+"_pick("+U+"){var a=[],b=[],c=this.offset");for(q=0;q<x;++q)t.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+A.map((function(R){return"shape["+R+"]"})).join(",")+","+A.map((function(R){return"stride["+R+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(J[R],D)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};R.exports=function(R,x,H,k){if(void 0===R)return(0,J.array[0])([]);"number"===typeof R&&(R=[R]),void 0===x&&(x=[R.length]);var A=x.length;if(void 0===H){H=new Array(A);for(var D=A-1,V=1;D>=0;--D)H[D]=V,V*=x[D]}if(void 0===k){k=0;for(D=0;D<A;++D)H[D]<0&&(k-=(x[D]-1)*H[D])}for(var n=function(R){if(c(R))return"buffer";if(t)switch(Object.prototype.toString.call(R)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(R)?"array":"generic"}(R),g=J[n];g.length<=A+1;)g.push(U(n,g.length-1));return(0,g[A+1])(R,x,H,k)}},13442:R=>{var x;self,x=()=>(()=>{"use strict";var R={d:(x,H)=>{for(var k in H)R.o(H,k)&&!R.o(x,k)&&Object.defineProperty(x,k,{enumerable:!0,get:H[k]})},o:(R,x)=>Object.prototype.hasOwnProperty.call(R,x)},x={};R.d(x,{default:()=>w});var H,k=function(R,x){var H=x.x-R.x,k=x.y-R.y;return Math.sqrt(H*H+k*k)},c=function(R){return R*(Math.PI/180)},t=new Map,A=function(R){t.has(R)&&clearTimeout(t.get(R)),t.set(R,setTimeout(R,100))},D=function(R,x,H){for(var k,c=x.split(/[ ,]+/g),t=0;t<c.length;t+=1)k=c[t],R.addEventListener?R.addEventListener(k,H,!1):R.attachEvent&&R.attachEvent(k,H)},U=function(R,x,H){for(var k,c=x.split(/[ ,]+/g),t=0;t<c.length;t+=1)k=c[t],R.removeEventListener?R.removeEventListener(k,H):R.detachEvent&&R.detachEvent(k,H)},J=function(R){return R.preventDefault(),R.type.match(/^touch/)?R.changedTouches:R},V=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},n=function(R,x){x.top||x.right||x.bottom||x.left?(R.style.top=x.top,R.style.right=x.right,R.style.bottom=x.bottom,R.style.left=x.left):(R.style.left=x.x+"px",R.style.top=x.y+"px")},g=function(R,x,H){var k=I(R);for(var c in k)if(k.hasOwnProperty(c))if("string"==typeof x)k[c]=x+" "+H;else{for(var t="",A=0,D=x.length;A<D;A+=1)t+=x[A]+" "+H+", ";k[c]=t.slice(0,-2)}return k},I=function(R){var x={};return x[R]="",["webkit","Moz","o"].forEach((function(H){x[H+R.charAt(0).toUpperCase()+R.slice(1)]=""})),x},i=function(R,x){for(var H in x)x.hasOwnProperty(H)&&(R[H]=x[H]);return R},q=function(R,x){if(R.length)for(var H=0,k=R.length;H<k;H+=1)x(R[H]);else x(R)},S="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,L=window.matchMedia("(any-hover: none)").matches,b=!!("ontouchstart"in window),C=!!window.PointerEvent,F=!!window.MSPointerEvent,d={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},P={start:"mousedown",move:"mousemove",end:"mouseup"},a={};function X(){}S&&!L?H=d:C?H={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:F?H={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:b?(H=d,a=P):H=P,X.prototype.on=function(R,x){var H,k=this,c=R.split(/[ ,]+/g);k._handlers_=k._handlers_||{};for(var t=0;t<c.length;t+=1)H=c[t],k._handlers_[H]=k._handlers_[H]||[],k._handlers_[H].push(x);return k},X.prototype.off=function(R,x){var H=this;return H._handlers_=H._handlers_||{},void 0===R?H._handlers_={}:void 0===x?H._handlers_[R]=null:H._handlers_[R]&&H._handlers_[R].indexOf(x)>=0&&H._handlers_[R].splice(H._handlers_[R].indexOf(x),1),H},X.prototype.trigger=function(R,x){var H,k=this,c=R.split(/[ ,]+/g);k._handlers_=k._handlers_||{};for(var t=0;t<c.length;t+=1)H=c[t],k._handlers_[H]&&k._handlers_[H].length&&k._handlers_[H].forEach((function(R){R.call(k,{type:H,target:k},x)}))},X.prototype.config=function(R){var x=this;x.options=x.defaults||{},R&&(x.options=function(R,x){var H={};for(var k in R)R.hasOwnProperty(k)&&x.hasOwnProperty(k)?H[k]=x[k]:R.hasOwnProperty(k)&&(H[k]=R[k]);return H}(x.options,R))},X.prototype.bindEvt=function(R,x){var k=this;return k._domHandlers_=k._domHandlers_||{},k._domHandlers_[x]=function(){"function"==typeof k["on"+x]?k["on"+x].apply(k,arguments):console.warn('[WARNING] : Missing "on'+x+'" handler.')},D(R,H[x],k._domHandlers_[x]),a[x]&&D(R,a[x],k._domHandlers_[x]),k},X.prototype.unbindEvt=function(R,x){var k=this;return k._domHandlers_=k._domHandlers_||{},U(R,H[x],k._domHandlers_[x]),a[x]&&U(R,a[x],k._domHandlers_[x]),delete k._domHandlers_[x],this};const M=X;function B(R,x){return this.identifier=x.identifier,this.position=x.position,this.frontPosition=x.frontPosition,this.collection=R,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(x),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=B.id,B.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}B.prototype=new M,B.constructor=B,B.id=0,B.prototype.buildEl=function(R){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},B.prototype.stylize=function(){if(this.options.dataOnly)return this;var R=this.options.fadeTime+"ms",x=function(){var R=I("borderRadius");for(var x in R)R.hasOwnProperty(x)&&(R[x]="50%");return R}(),H=g("transition","opacity",R),k={};return k.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},k.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},k.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},i(k.el,H),"circle"===this.options.shape&&i(k.back,x),i(k.front,x),this.applyStyles(k),this},B.prototype.applyStyles=function(R){for(var x in this.ui)if(this.ui.hasOwnProperty(x))for(var H in R[x])this.ui[x].style[H]=R[x][H];return this},B.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},B.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},B.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},B.prototype.show=function(R){var x=this;return x.options.dataOnly||(clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.addToDom(),x.restCallback(),setTimeout((function(){x.ui.el.style.opacity=1}),0),x.showTimeout=setTimeout((function(){x.trigger("shown",x.instance),"function"==typeof R&&R.call(this)}),x.options.fadeTime)),x},B.prototype.hide=function(R){var x=this;if(x.options.dataOnly)return x;if(x.ui.el.style.opacity=x.options.restOpacity,clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.removeTimeout=setTimeout((function(){var H="dynamic"===x.options.mode?"none":"block";x.ui.el.style.display=H,"function"==typeof R&&R.call(x),x.trigger("hidden",x.instance)}),x.options.fadeTime),x.options.restJoystick){var H=x.options.restJoystick,k={};k.x=!0===H||!1!==H.x?0:x.instance.frontPosition.x,k.y=!0===H||!1!==H.y?0:x.instance.frontPosition.y,x.setPosition(R,k)}return x},B.prototype.setPosition=function(R,x){var H=this;H.frontPosition={x:x.x,y:x.y};var k=H.options.fadeTime+"ms",c={};c.front=g("transition",["transform"],k);var t={front:{}};t.front={transform:"translate("+H.frontPosition.x+"px,"+H.frontPosition.y+"px)"},H.applyStyles(c),H.applyStyles(t),H.restTimeout=setTimeout((function(){"function"==typeof R&&R.call(H),H.restCallback()}),H.options.fadeTime)},B.prototype.restCallback=function(){var R=this,x={};x.front=g("transition","none",""),R.applyStyles(x),R.trigger("rested",R.instance)},B.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},B.prototype.computeDirection=function(R){var x,H,k,c=R.angle.radian,t=Math.PI/4,A=Math.PI/2;if(c>t&&c<3*t&&!R.lockX?x="up":c>-t&&c<=t&&!R.lockY?x="left":c>3*-t&&c<=-t&&!R.lockX?x="down":R.lockY||(x="right"),R.lockY||(H=c>-A&&c<A?"left":"right"),R.lockX||(k=c>0?"up":"down"),R.force>this.options.threshold){var D,U={};for(D in this.direction)this.direction.hasOwnProperty(D)&&(U[D]=this.direction[D]);var J={};for(D in this.direction={x:H,y:k,angle:x},R.direction=this.direction,U)U[D]===this.direction[D]&&(J[D]=!0);if(J.x&&J.y&&J.angle)return R;J.x&&J.y||this.trigger("plain",R),J.x||this.trigger("plain:"+H,R),J.y||this.trigger("plain:"+k,R),J.angle||this.trigger("dir dir:"+x,R)}else this.resetDirection();return R};const o=B;function Z(R,x){var H=this;H.nipples=[],H.idles=[],H.actives=[],H.ids=[],H.pressureIntervals={},H.manager=R,H.id=Z.id,Z.id+=1,H.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},H.config(x),"static"!==H.options.mode&&"semi"!==H.options.mode||(H.options.multitouch=!1),H.options.multitouch||(H.options.maxNumberOfNipples=1);var k=getComputedStyle(H.options.zone.parentElement);return k&&"flex"===k.display&&(H.parentIsFlex=!0),H.updateBox(),H.prepareNipples(),H.Xl(),H.begin(),H.nipples}Z.prototype=new M,Z.constructor=Z,Z.id=0,Z.prototype.prepareNipples=function(){var R=this,x=R.nipples;x.on=R.on.bind(R),x.off=R.off.bind(R),x.options=R.options,x.destroy=R.destroy.bind(R),x.ids=R.ids,x.id=R.id,x.processOnMove=R.processOnMove.bind(R),x.processOnEnd=R.processOnEnd.bind(R),x.get=function(R){if(void 0===R)return x[0];for(var H=0,k=x.length;H<k;H+=1)if(x[H].identifier===R)return x[H];return!1}},Z.prototype.Xl=function(){var R=this;R.bindEvt(R.options.zone,"start"),R.options.zone.style.touchAction="none",R.options.zone.style.msTouchAction="none"},Z.prototype.begin=function(){var R=this,x=R.options;if("static"===x.mode){var H=R.createNipple(x.position,R.manager.getIdentifier());H.add(),R.idles.push(H)}},Z.prototype.createNipple=function(R,x){var H=this,k=H.manager.scroll,c={},t=H.options,A=H.parentIsFlex?k.x:k.x+H.box.left,D=H.parentIsFlex?k.y:k.y+H.box.top;if(R.x&&R.y)c={x:R.x-A,y:R.y-D};else if(R.top||R.right||R.bottom||R.left){var U=document.createElement("DIV");U.style.display="hidden",U.style.top=R.top,U.style.right=R.right,U.style.bottom=R.bottom,U.style.left=R.left,U.style.position="absolute",t.zone.appendChild(U);var J=U.getBoundingClientRect();t.zone.removeChild(U),c=R,R={x:J.left+k.x,y:J.top+k.y}}var V=new o(H,{color:t.color,size:t.size,threshold:t.threshold,fadeTime:t.fadeTime,dataOnly:t.dataOnly,restJoystick:t.restJoystick,restOpacity:t.restOpacity,mode:t.mode,identifier:x,position:R,zone:t.zone,frontPosition:{x:0,y:0},shape:t.shape});return t.dataOnly||(n(V.ui.el,c),n(V.ui.front,V.frontPosition)),H.nipples.push(V),H.trigger("added "+V.identifier+":added",V),H.manager.trigger("added "+V.identifier+":added",V),H.bindNipple(V),V},Z.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Z.prototype.bindNipple=function(R){var x,H=this,k=function(R,k){x=R.type+" "+k.id+":"+R.type,H.trigger(x,k)};R.on("destroyed",H.onDestroyed.bind(H)),R.on("shown hidden rested dir plain",k),R.on("dir:up dir:right dir:down dir:left",k),R.on("plain:up plain:right plain:down plain:left",k)},Z.prototype.pressureFn=function(R,x,H){var k=this,c=0;clearInterval(k.pressureIntervals[H]),k.pressureIntervals[H]=setInterval(function(){var H=R.force||R.pressure||R.webkitForce||0;H!==c&&(x.trigger("pressure",H),k.trigger("pressure "+x.identifier+":pressure",H),c=H)}.bind(k),100)},Z.prototype.onstart=function(R){var x=this,H=x.options,k=R;return R=J(R),x.updateBox(),q(R,(function(c){x.actives.length<H.maxNumberOfNipples?x.processOnStart(c):k.type.match(/^touch/)&&(Object.keys(x.manager.ids).forEach((function(H){if(Object.values(k.touches).findIndex((function(R){return R.identifier===H}))<0){var c=[R[0]];c.identifier=H,x.processOnEnd(c)}})),x.actives.length<H.maxNumberOfNipples&&x.processOnStart(c))})),x.manager.bindDocument(),!1},Z.prototype.processOnStart=function(R){var x,H=this,c=H.options,t=H.manager.getIdentifier(R),A=R.force||R.pressure||R.webkitForce||0,D={x:R.pageX,y:R.pageY},U=H.getOrCreate(t,D);U.identifier!==t&&H.manager.removeIdentifier(U.identifier),U.identifier=t;var J=function(x){x.trigger("start",x),H.trigger("start "+x.id+":start",x),x.show(),A>0&&H.pressureFn(R,x,x.identifier),H.processOnMove(R)};if((x=H.idles.indexOf(U))>=0&&H.idles.splice(x,1),H.actives.push(U),H.ids.push(U.identifier),"semi"!==c.mode)J(U);else{if(!(k(D,U.position)<=c.catchDistance))return U.destroy(),void H.processOnStart(R);J(U)}return U},Z.prototype.getOrCreate=function(R,x){var H,k=this,c=k.options;return/(semi|static)/.test(c.mode)?(H=k.idles[0])?(k.idles.splice(0,1),H):"semi"===c.mode?k.createNipple(x,R):(console.warn("Coudln't find the needed nipple."),!1):H=k.createNipple(x,R)},Z.prototype.processOnMove=function(R){var x=this,H=x.options,t=x.manager.getIdentifier(R),A=x.nipples.get(t),D=x.manager.scroll;if(function(R){return isNaN(R.buttons)?0!==R.pressure:0!==R.buttons}(R)){if(!A)return console.error("Found zombie joystick with ID "+t),void x.manager.removeIdentifier(t);if(H.dynamicPage){var U=A.el.getBoundingClientRect();A.position={x:D.x+U.left,y:D.y+U.top}}A.identifier=t;var J=A.options.size/2,V={x:R.pageX,y:R.pageY};H.lockX&&(V.y=A.position.y),H.lockY&&(V.x=A.position.x);var n,g,I,i,q,S,L,b,C,F,d=k(V,A.position),P=(n=V,I=(g=A.position).x-n.x,i=g.y-n.y,function(R){return R*(180/Math.PI)}(Math.atan2(i,I))),a=c(P),X=d/J,M={distance:d,position:V};if("circle"===A.options.shape?(q=Math.min(d,J),L=A.position,b=q,F={x:0,y:0},C=c(C=P),F.x=L.x-b*Math.cos(C),F.y=L.y-b*Math.sin(C),S=F):(S=function(R,x,H){return{x:Math.min(Math.max(R.x,x.x-H),x.x+H),y:Math.min(Math.max(R.y,x.y-H),x.y+H)}}(V,A.position,J),q=k(S,A.position)),H.follow){if(d>J){var B=V.x-S.x,o=V.y-S.y;A.position.x+=B,A.position.y+=o,A.el.style.top=A.position.y-(x.box.top+D.y)+"px",A.el.style.left=A.position.x-(x.box.left+D.x)+"px",d=k(V,A.position)}}else V=S,d=q;var Z=V.x-A.position.x,y=V.y-A.position.y;A.frontPosition={x:Z,y:y},H.dataOnly||(A.ui.front.style.transform="translate("+Z+"px,"+y+"px)");var s={identifier:A.identifier,position:V,force:X,pressure:R.force||R.pressure||R.webkitForce||0,distance:d,angle:{radian:a,degree:P},vector:{x:Z/J,y:-y/J},raw:M,instance:A,lockX:H.lockX,lockY:H.lockY};(s=A.computeDirection(s)).angle={radian:c(180-P),degree:180-P},A.trigger("move",s),x.trigger("move "+A.id+":move",s)}else this.processOnEnd(R)},Z.prototype.processOnEnd=function(R){var x=this,H=x.options,k=x.manager.getIdentifier(R),c=x.nipples.get(k),t=x.manager.removeIdentifier(c.identifier);c&&(H.dataOnly||c.hide((function(){"dynamic"===H.mode&&(c.trigger("removed",c),x.trigger("removed "+c.id+":removed",c),x.manager.trigger("removed "+c.id+":removed",c),c.destroy())})),clearInterval(x.pressureIntervals[c.identifier]),c.resetDirection(),c.trigger("end",c),x.trigger("end "+c.id+":end",c),x.ids.indexOf(c.identifier)>=0&&x.ids.splice(x.ids.indexOf(c.identifier),1),x.actives.indexOf(c)>=0&&x.actives.splice(x.actives.indexOf(c),1),/(semi|static)/.test(H.mode)?x.idles.push(c):x.nipples.indexOf(c)>=0&&x.nipples.splice(x.nipples.indexOf(c),1),x.manager.unbindDocument(),/(semi|static)/.test(H.mode)&&(x.manager.ids[t.id]=t.identifier))},Z.prototype.onDestroyed=function(R,x){var H=this;H.nipples.indexOf(x)>=0&&H.nipples.splice(H.nipples.indexOf(x),1),H.actives.indexOf(x)>=0&&H.actives.splice(H.actives.indexOf(x),1),H.idles.indexOf(x)>=0&&H.idles.splice(H.idles.indexOf(x),1),H.ids.indexOf(x.identifier)>=0&&H.ids.splice(H.ids.indexOf(x.identifier),1),H.manager.removeIdentifier(x.identifier),H.manager.unbindDocument()},Z.prototype.destroy=function(){var R=this;for(var x in R.unbindEvt(R.options.zone,"start"),R.nipples.forEach((function(R){R.destroy()})),R.pressureIntervals)R.pressureIntervals.hasOwnProperty(x)&&clearInterval(R.pressureIntervals[x]);R.trigger("destroyed",R.nipples),R.manager.unbindDocument(),R.off()};const y=Z;function s(R){var x=this;x.ids={},x.index=0,x.collections=[],x.scroll=V(),x.config(R),x.prepareCollections();var H=function(){var R;x.collections.forEach((function(H){H.forEach((function(H){R=H.el.getBoundingClientRect(),H.position={x:x.scroll.x+R.left,y:x.scroll.y+R.top}}))}))};D(window,"resize",(function(){A(H)}));var k=function(){x.scroll=V()};return D(window,"scroll",(function(){A(k)})),x.collections}s.prototype=new M,s.constructor=s,s.prototype.prepareCollections=function(){var R=this;R.collections.create=R.create.bind(R),R.collections.on=R.on.bind(R),R.collections.off=R.off.bind(R),R.collections.destroy=R.destroy.bind(R),R.collections.get=function(x){var H;return R.collections.every((function(R){return!(H=R.get(x))})),H}},s.prototype.create=function(R){return this.createCollection(R)},s.prototype.createCollection=function(R){var x=this,H=new y(x,R);return x.bindCollection(H),x.collections.push(H),H},s.prototype.bindCollection=function(R){var x,H=this,k=function(R,k){x=R.type+" "+k.id+":"+R.type,H.trigger(x,k)};R.on("destroyed",H.onDestroyed.bind(H)),R.on("shown hidden rested dir plain",k),R.on("dir:up dir:right dir:down dir:left",k),R.on("plain:up plain:right plain:down plain:left",k)},s.prototype.bindDocument=function(){var R=this;R.binded||(R.bindEvt(document,"move").bindEvt(document,"end"),R.binded=!0)},s.prototype.unbindDocument=function(R){var x=this;Object.keys(x.ids).length&&!0!==R||(x.unbindEvt(document,"move").unbindEvt(document,"end"),x.binded=!1)},s.prototype.getIdentifier=function(R){var x;return R?void 0===(x=void 0===R.identifier?R.pointerId:R.identifier)&&(x=this.latest||0):x=this.index,void 0===this.ids[x]&&(this.ids[x]=this.index,this.index+=1),this.latest=x,this.ids[x]},s.prototype.removeIdentifier=function(R){var x={};for(var H in this.ids)if(this.ids[H]===R){x.id=H,x.identifier=this.ids[H],delete this.ids[H];break}return x},s.prototype.onmove=function(R){return this.onAny("move",R),!1},s.prototype.onend=function(R){return this.onAny("end",R),!1},s.prototype.oncancel=function(R){return this.onAny("end",R),!1},s.prototype.onAny=function(R,x){var H,k=this,c="processOn"+R.charAt(0).toUpperCase()+R.slice(1);x=J(x);var t=function(R,x,H){H.ids.indexOf(x)>=0&&(H[c](R),R._found_=!0)};return q(x,(function(R){H=k.getIdentifier(R),q(k.collections,t.bind(null,R,H)),R._found_||k.removeIdentifier(H)})),!1},s.prototype.destroy=function(){var R=this;R.unbindDocument(!0),R.ids={},R.index=0,R.collections.forEach((function(R){R.destroy()})),R.off()},s.prototype.onDestroyed=function(R,x){var H=this;if(H.collections.indexOf(x)<0)return!1;H.collections.splice(H.collections.indexOf(x),1)};var E=new s;const w={create:function(R){return E.create(R)},factory:E};return x.default})(),R.exports=x()},12648:(R,x,H)=>{"use strict";const{Deflate:k,deflate:c,deflateRaw:t,gzip:A}=H(12650),{Inflate:D,inflate:U,inflateRaw:J,ungzip:V}=H(12725),n=H(12698);R.exports.Deflate=k,R.exports.deflate=c,R.exports.deflateRaw=t,R.exports.gzip=A,R.exports.Inflate=D,R.exports.inflate=U,R.exports.inflateRaw=J,R.exports.ungzip=V,R.exports.constants=n},12650:(R,x,H)=>{"use strict";const k=H(12656),c=H(12704),t=H(12713),A=H(12690),D=H(12716),U=Object.prototype.toString,{Z_NO_FLUSH:J,Z_SYNC_FLUSH:V,Z_FULL_FLUSH:n,Z_FINISH:g,Z_OK:I,Z_STREAM_END:i,Z_DEFAULT_COMPRESSION:q,Z_DEFAULT_STRATEGY:S,Z_DEFLATED:L}=H(12698);function b(R){this.options=c.assign({level:q,method:L,Ja:16384,windowBits:15,memLevel:8,strategy:S},R||{});let x=this.options;x.raw&&x.windowBits>0?x.windowBits=-x.windowBits:x.gzip&&x.windowBits>0&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;let H=k.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(H!==I)throw new Error(A[H]);if(x.header&&k.deflateSetHeader(this.strm,x.header),x.dictionary){let R;if(R="string"===typeof x.dictionary?t.string2buf(x.dictionary):"[object ArrayBuffer]"===U.call(x.dictionary)?new Uint8Array(x.dictionary):x.dictionary,H=k.deflateSetDictionary(this.strm,R),H!==I)throw new Error(A[H]);this._dict_set=!0}}function C(R,x){const H=new b(x);if(H.push(R,!0),H.err)throw H.msg||A[H.err];return H.result}b.prototype.push=function(R,x){const H=this.strm,c=this.options.Ja;let A,D;if(this.ended)return!1;for(D=x===~~x?x:!0===x?g:J,"string"===typeof R?H.input=t.string2buf(R):"[object ArrayBuffer]"===U.call(R)?H.input=new Uint8Array(R):H.input=R,H.next_in=0,H.avail_in=H.input.length;;)if(0===H.avail_out&&(H.output=new Uint8Array(c),H.next_out=0,H.avail_out=c),(D===V||D===n)&&H.avail_out<=6)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else{if(A=k.deflate(H,D),A===i)return H.next_out>0&&this.onData(H.output.subarray(0,H.next_out)),A=k.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===I;if(0!==H.avail_out){if(D>0&&H.next_out>0)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else if(0===H.avail_in)break}else this.onData(H.output)}return!0},b.prototype.onData=function(R){this.chunks.push(R)},b.prototype.onEnd=function(R){R===I&&(this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.msg=this.strm.msg},R.exports.Deflate=b,R.exports.deflate=C,R.exports.deflateRaw=function(R,x){return(x=x||{}).raw=!0,C(R,x)},R.exports.gzip=function(R,x){return(x=x||{}).gzip=!0,C(R,x)},R.exports.constants=H(12698)},12725:(R,x,H)=>{"use strict";const k=H(12727),c=H(12704),t=H(12713),A=H(12690),D=H(12716),U=H(12744),J=Object.prototype.toString,{Z_NO_FLUSH:V,Z_FINISH:n,Z_OK:g,Z_STREAM_END:I,Z_NEED_DICT:i,Z_STREAM_ERROR:q,Z_DATA_ERROR:S,Z_MEM_ERROR:L}=H(12698);function b(R){this.options=c.assign({Ja:65536,windowBits:15,to:""},R||{});const x=this.options;x.raw&&x.windowBits>=0&&x.windowBits<16&&(x.windowBits=-x.windowBits,0===x.windowBits&&(x.windowBits=-15)),!(x.windowBits>=0&&x.windowBits<16)||R&&R.windowBits||(x.windowBits+=32),x.windowBits>15&&x.windowBits<48&&0===(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;let H=k.inflateInit2(this.strm,x.windowBits);if(H!==g)throw new Error(A[H]);if(this.header=new U,k.inflateGetHeader(this.strm,this.header),x.dictionary&&("string"===typeof x.dictionary?x.dictionary=t.string2buf(x.dictionary):"[object ArrayBuffer]"===J.call(x.dictionary)&&(x.dictionary=new Uint8Array(x.dictionary)),x.raw&&(H=k.inflateSetDictionary(this.strm,x.dictionary),H!==g)))throw new Error(A[H])}function C(R,x){const H=new b(x);if(H.push(R),H.err)throw H.msg||A[H.err];return H.result}b.prototype.push=function(R,x){const H=this.strm,c=this.options.Ja,A=this.options.dictionary;let D,U,b;if(this.ended)return!1;for(U=x===~~x?x:!0===x?n:V,"[object ArrayBuffer]"===J.call(R)?H.input=new Uint8Array(R):H.input=R,H.next_in=0,H.avail_in=H.input.length;;){for(0===H.avail_out&&(H.output=new Uint8Array(c),H.next_out=0,H.avail_out=c),D=k.inflate(H,U),D===i&&A&&(D=k.inflateSetDictionary(H,A),D===g?D=k.inflate(H,U):D===S&&(D=i));H.avail_in>0&&D===I&&H.state.wrap>0&&0!==R[H.next_in];)k.inflateReset(H),D=k.inflate(H,U);switch(D){case q:case S:case i:case L:return this.onEnd(D),this.ended=!0,!1}if(b=H.avail_out,H.next_out&&(0===H.avail_out||D===I))if("string"===this.options.to){let R=t.utf8border(H.output,H.next_out),x=H.next_out-R,k=t.buf2string(H.output,R);H.next_out=x,H.avail_out=c-x,x&&H.output.set(H.output.subarray(R,R+x),0),this.onData(k)}else this.onData(H.output.length===H.next_out?H.output:H.output.subarray(0,H.next_out));if(D!==g||0!==b){if(D===I)return D=k.inflateEnd(this.strm),this.onEnd(D),this.ended=!0,!0;if(0===H.avail_in)break}}return!0},b.prototype.onData=function(R){this.chunks.push(R)},b.prototype.onEnd=function(R){R===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.msg=this.strm.msg},R.exports.Inflate=b,R.exports.inflate=C,R.exports.inflateRaw=function(R,x){return(x=x||{}).raw=!0,C(R,x)},R.exports.ungzip=C,R.exports.constants=H(12698)},12704:R=>{"use strict";const x=(R,x)=>Object.prototype.hasOwnProperty.call(R,x);R.exports.assign=function(R){const H=Array.prototype.slice.call(arguments,1);for(;H.length;){const k=H.shift();if(k){if("object"!==typeof k)throw new TypeError(k+"must be non-object");for(const H in k)x(k,H)&&(R[H]=k[H])}}return R},R.exports.flattenChunks=R=>{let x=0;for(let k=0,c=R.length;k<c;k++)x+=R[k].length;const H=new Uint8Array(x);for(let k=0,c=0,t=R.length;k<t;k++){let x=R[k];H.set(x,c),c+=x.length}return H}},12713:R=>{"use strict";let x=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(k){x=!1}const H=new Uint8Array(256);for(let c=0;c<256;c++)H[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;H[254]=H[254]=1,R.exports.string2buf=R=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(R);let x,H,k,c,t,A=R.length,D=0;for(c=0;c<A;c++)H=R.charCodeAt(c),55296===(64512&H)&&c+1<A&&(k=R.charCodeAt(c+1),56320===(64512&k)&&(H=65536+(H-55296<<10)+(k-56320),c++)),D+=H<128?1:H<2048?2:H<65536?3:4;for(x=new Uint8Array(D),t=0,c=0;t<D;c++)H=R.charCodeAt(c),55296===(64512&H)&&c+1<A&&(k=R.charCodeAt(c+1),56320===(64512&k)&&(H=65536+(H-55296<<10)+(k-56320),c++)),H<128?x[t++]=H:H<2048?(x[t++]=192|H>>>6,x[t++]=128|63&H):H<65536?(x[t++]=224|H>>>12,x[t++]=128|H>>>6&63,x[t++]=128|63&H):(x[t++]=240|H>>>18,x[t++]=128|H>>>12&63,x[t++]=128|H>>>6&63,x[t++]=128|63&H);return x};R.exports.buf2string=(R,k)=>{const c=k||R.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(R.subarray(0,k));let t,A;const D=new Array(2*c);for(A=0,t=0;t<c;){let x=R[t++];if(x<128){D[A++]=x;continue}let k=H[x];if(k>4)D[A++]=65533,t+=k-1;else{for(x&=2===k?31:3===k?15:7;k>1&&t<c;)x=x<<6|63&R[t++],k--;k>1?D[A++]=65533:x<65536?D[A++]=x:(x-=65536,D[A++]=55296|x>>10&1023,D[A++]=56320|1023&x)}}return((R,H)=>{if(H<65534&&R.subarray&&x)return String.fromCharCode.apply(null,R.length===H?R:R.subarray(0,H));let k="";for(let x=0;x<H;x++)k+=String.fromCharCode(R[x]);return k})(D,A)},R.exports.utf8border=(R,x)=>{(x=x||R.length)>R.length&&(x=R.length);let k=x-1;for(;k>=0&&128===(192&R[k]);)k--;return k<0||0===k?x:k+H[R[k]]>x?k:x}},12672:R=>{"use strict";R.exports=(R,x,H,k)=>{let c=65535&R,t=R>>>16&65535,A=0;for(;0!==H;){A=H>2e3?2e3:H,H-=A;do{c=c+x[k++]|0,t=t+c|0}while(--A);c%=65521,t%=65521}return c|t<<16}},12698:R=>{"use strict";R.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12681:R=>{"use strict";const x=new Uint32Array((()=>{let R,x=[];for(var H=0;H<256;H++){R=H;for(var k=0;k<8;k++)R=1&R?3988292384^R>>>1:R>>>1;x[H]=R}return x})());R.exports=(R,H,k,c)=>{const t=x,A=c+k;R^=-1;for(let x=c;x<A;x++)R=R>>>8^t[255&(R^H[x])];return~R}},12656:(R,x,H)=>{"use strict";const{_tr_init:k,_tr_stored_block:c,_tr_flush_block:t,_tr_tally:A,_tr_align:D}=H(12664),U=H(12672),J=H(12681),V=H(12690),{Z_NO_FLUSH:n,Z_PARTIAL_FLUSH:g,Z_FULL_FLUSH:I,Z_FINISH:i,Z_BLOCK:q,Z_OK:S,Z_STREAM_END:L,Z_STREAM_ERROR:b,Z_DATA_ERROR:C,Z_BUF_ERROR:F,Z_DEFAULT_COMPRESSION:d,Z_FILTERED:P,Z_HUFFMAN_ONLY:a,Z_RLE:X,Z_FIXED:M,Z_DEFAULT_STRATEGY:B,Z_UNKNOWN:o,Z_DEFLATED:Z}=H(12698),y=258,s=262,E=103,w=113,h=666,f=(R,x)=>(R.msg=V[x],x),N=R=>(R<<1)-(R>4?9:0),W=R=>{let x=R.length;for(;--x>=0;)R[x]=0};let K=(R,x,H)=>(x<<R.hash_shift^H)&R.hash_mask;const Q=R=>{const x=R.state;let H=x.pending;H>R.avail_out&&(H=R.avail_out),0!==H&&(R.output.set(x.pending_buf.subarray(x.pending_out,x.pending_out+H),R.next_out),R.next_out+=H,x.pending_out+=H,R.total_out+=H,R.avail_out-=H,x.pending-=H,0===x.pending&&(x.pending_out=0))},G=(R,x)=>{t(R,R.block_start>=0?R.block_start:-1,R.strstart-R.block_start,x),R.block_start=R.strstart,Q(R.strm)},T=(R,x)=>{R.pending_buf[R.pending++]=x},v=(R,x)=>{R.pending_buf[R.pending++]=x>>>8&255,R.pending_buf[R.pending++]=255&x},p=(R,x,H,k)=>{let c=R.avail_in;return c>k&&(c=k),0===c?0:(R.avail_in-=c,x.set(R.input.subarray(R.next_in,R.next_in+c),H),1===R.state.wrap?R.adler=U(R.adler,x,c,H):2===R.state.wrap&&(R.adler=J(R.adler,x,c,H)),R.next_in+=c,R.total_in+=c,c)},r=(R,x)=>{let H,k,c=R.max_chain_length,t=R.strstart,A=R.prev_length,D=R.nice_match;const U=R.strstart>R.w_size-s?R.strstart-(R.w_size-s):0,J=R.window,V=R.w_mask,n=R.prev,g=R.strstart+y;let I=J[t+A-1],i=J[t+A];R.prev_length>=R.good_match&&(c>>=2),D>R.lookahead&&(D=R.lookahead);do{if(H=x,J[H+A]===i&&J[H+A-1]===I&&J[H]===J[t]&&J[++H]===J[t+1]){t+=2,H++;do{}while(J[++t]===J[++H]&&J[++t]===J[++H]&&J[++t]===J[++H]&&J[++t]===J[++H]&&J[++t]===J[++H]&&J[++t]===J[++H]&&J[++t]===J[++H]&&J[++t]===J[++H]&&t<g);if(k=y-(g-t),t=g-y,k>A){if(R.match_start=x,A=k,k>=D)break;I=J[t+A-1],i=J[t+A]}}}while((x=n[x&V])>U&&0!==--c);return A<=R.lookahead?A:R.lookahead},z=R=>{const x=R.w_size;let H,k,c,t,A;do{if(t=R.window_size-R.lookahead-R.strstart,R.strstart>=x+(x-s)){R.window.set(R.window.subarray(x,x+x),0),R.match_start-=x,R.strstart-=x,R.block_start-=x,k=R.hash_size,H=k;do{c=R.head[--H],R.head[H]=c>=x?c-x:0}while(--k);k=x,H=k;do{c=R.prev[--H],R.prev[H]=c>=x?c-x:0}while(--k);t+=x}if(0===R.strm.avail_in)break;if(k=p(R.strm,R.window,R.strstart+R.lookahead,t),R.lookahead+=k,R.lookahead+R.insert>=3)for(A=R.strstart-R.insert,R.ins_h=R.window[A],R.ins_h=K(R,R.ins_h,R.window[A+1]);R.insert&&(R.ins_h=K(R,R.ins_h,R.window[A+3-1]),R.prev[A&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=A,A++,R.insert--,!(R.lookahead+R.insert<3)););}while(R.lookahead<s&&0!==R.strm.avail_in)},j=(R,x)=>{let H,k;for(;;){if(R.lookahead<s){if(z(R),R.lookahead<s&&x===n)return 1;if(0===R.lookahead)break}if(H=0,R.lookahead>=3&&(R.ins_h=K(R,R.ins_h,R.window[R.strstart+3-1]),H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),0!==H&&R.strstart-H<=R.w_size-s&&(R.match_length=r(R,H)),R.match_length>=3)if(k=A(R,R.strstart-R.match_start,R.match_length-3),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=3){R.match_length--;do{R.strstart++,R.ins_h=K(R,R.ins_h,R.window[R.strstart+3-1]),H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart}while(0!==--R.match_length);R.strstart++}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=K(R,R.ins_h,R.window[R.strstart+1]);else k=A(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(k&&(G(R,!1),0===R.strm.avail_out))return 1}return R.insert=R.strstart<2?R.strstart:2,x===i?(G(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(G(R,!1),0===R.strm.avail_out)?1:2},m=(R,x)=>{let H,k,c;for(;;){if(R.lookahead<s){if(z(R),R.lookahead<s&&x===n)return 1;if(0===R.lookahead)break}if(H=0,R.lookahead>=3&&(R.ins_h=K(R,R.ins_h,R.window[R.strstart+3-1]),H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=2,0!==H&&R.prev_length<R.max_lazy_match&&R.strstart-H<=R.w_size-s&&(R.match_length=r(R,H),R.match_length<=5&&(R.strategy===P||3===R.match_length&&R.strstart-R.match_start>4096)&&(R.match_length=2)),R.prev_length>=3&&R.match_length<=R.prev_length){c=R.strstart+R.lookahead-3,k=A(R,R.strstart-1-R.prev_match,R.prev_length-3),R.lookahead-=R.prev_length-1,R.prev_length-=2;do{++R.strstart<=c&&(R.ins_h=K(R,R.ins_h,R.window[R.strstart+3-1]),H=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart)}while(0!==--R.prev_length);if(R.match_available=0,R.match_length=2,R.strstart++,k&&(G(R,!1),0===R.strm.avail_out))return 1}else if(R.match_available){if(k=A(R,0,R.window[R.strstart-1]),k&&G(R,!1),R.strstart++,R.lookahead--,0===R.strm.avail_out)return 1}else R.match_available=1,R.strstart++,R.lookahead--}return R.match_available&&(k=A(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<2?R.strstart:2,x===i?(G(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(G(R,!1),0===R.strm.avail_out)?1:2};function O(R,x,H,k,c){this.good_length=R,this.max_lazy=x,this.nice_length=H,this.max_chain=k,this.func=c}const l=[new O(0,0,0,0,((R,x)=>{let H=65535;for(H>R.pending_buf_size-5&&(H=R.pending_buf_size-5);;){if(R.lookahead<=1){if(z(R),0===R.lookahead&&x===n)return 1;if(0===R.lookahead)break}R.strstart+=R.lookahead,R.lookahead=0;const k=R.block_start+H;if((0===R.strstart||R.strstart>=k)&&(R.lookahead=R.strstart-k,R.strstart=k,G(R,!1),0===R.strm.avail_out))return 1;if(R.strstart-R.block_start>=R.w_size-s&&(G(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,x===i?(G(R,!0),0===R.strm.avail_out?3:4):(R.strstart>R.block_start&&(G(R,!1),R.strm.avail_out),1)})),new O(4,4,8,4,j),new O(4,5,16,8,j),new O(4,6,32,32,j),new O(4,4,16,16,m),new O(8,16,32,32,m),new O(8,16,128,128,m),new O(8,32,128,256,m),new O(32,128,258,1024,m),new O(32,258,258,4096,m)];function e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),W(this.dyn_ltree),W(this.dyn_dtree),W(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),W(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),W(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const u=R=>{if(!R||!R.state)return f(R,b);R.total_in=R.total_out=0,R.data_type=o;const x=R.state;return x.pending=0,x.pending_out=0,x.wrap<0&&(x.wrap=-x.wrap),x.status=x.wrap?42:w,R.adler=2===x.wrap?0:1,x.last_flush=n,k(x),S},Y=R=>{const x=u(R);var H;return x===S&&((H=R.state).window_size=2*H.w_size,W(H.head),H.max_lazy_match=l[H.level].max_lazy,H.good_match=l[H.level].good_length,H.nice_match=l[H.level].nice_length,H.max_chain_length=l[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=2,H.match_available=0,H.ins_h=0),x},RR=(R,x,H,k,c,t)=>{if(!R)return b;let A=1;if(x===d&&(x=6),k<0?(A=0,k=-k):k>15&&(A=2,k-=16),c<1||c>9||H!==Z||k<8||k>15||x<0||x>9||t<0||t>M)return f(R,b);8===k&&(k=9);const D=new e;return R.state=D,D.strm=R,D.wrap=A,D.gzhead=null,D.w_bits=k,D.w_size=1<<D.w_bits,D.w_mask=D.w_size-1,D.hash_bits=c+7,D.hash_size=1<<D.hash_bits,D.hash_mask=D.hash_size-1,D.hash_shift=~~((D.hash_bits+3-1)/3),D.window=new Uint8Array(2*D.w_size),D.head=new Uint16Array(D.hash_size),D.prev=new Uint16Array(D.w_size),D.lit_bufsize=1<<c+6,D.pending_buf_size=4*D.lit_bufsize,D.pending_buf=new Uint8Array(D.pending_buf_size),D.d_buf=1*D.lit_bufsize,D.l_buf=3*D.lit_bufsize,D.level=x,D.strategy=t,D.method=H,Y(R)};R.exports.deflateInit=(R,x)=>RR(R,x,Z,15,8,B),R.exports.deflateInit2=RR,R.exports.deflateReset=Y,R.exports.deflateResetKeep=u,R.exports.deflateSetHeader=(R,x)=>R&&R.state?2!==R.state.wrap?b:(R.state.gzhead=x,S):b,R.exports.deflate=(R,x)=>{let H,k;if(!R||!R.state||x>q||x<0)return R?f(R,b):b;const t=R.state;if(!R.output||!R.input&&0!==R.avail_in||t.status===h&&x!==i)return f(R,0===R.avail_out?F:b);t.strm=R;const U=t.last_flush;if(t.last_flush=x,42===t.status)if(2===t.wrap)R.adler=0,T(t,31),T(t,139),T(t,8),t.gzhead?(T(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),T(t,255&t.gzhead.time),T(t,t.gzhead.time>>8&255),T(t,t.gzhead.time>>16&255),T(t,t.gzhead.time>>24&255),T(t,9===t.level?2:t.strategy>=a||t.level<2?4:0),T(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(T(t,255&t.gzhead.extra.length),T(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(R.adler=J(R.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69):(T(t,0),T(t,0),T(t,0),T(t,0),T(t,0),T(t,9===t.level?2:t.strategy>=a||t.level<2?4:0),T(t,3),t.status=w);else{let x=Z+(t.w_bits-8<<4)<<8,H=-1;H=t.strategy>=a||t.level<2?0:t.level<6?1:6===t.level?2:3,x|=H<<6,0!==t.strstart&&(x|=32),x+=31-x%31,t.status=w,v(t,x),0!==t.strstart&&(v(t,R.adler>>>16),v(t,65535&R.adler)),R.adler=1}if(69===t.status)if(t.gzhead.extra){for(H=t.pending;t.gzindex<(65535&t.gzhead.extra.length)&&(t.pending!==t.pending_buf_size||(t.gzhead.hcrc&&t.pending>H&&(R.adler=J(R.adler,t.pending_buf,t.pending-H,H)),Q(R),H=t.pending,t.pending!==t.pending_buf_size));)T(t,255&t.gzhead.extra[t.gzindex]),t.gzindex++;t.gzhead.hcrc&&t.pending>H&&(R.adler=J(R.adler,t.pending_buf,t.pending-H,H)),t.gzindex===t.gzhead.extra.length&&(t.gzindex=0,t.status=73)}else t.status=73;if(73===t.status)if(t.gzhead.name){H=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>H&&(R.adler=J(R.adler,t.pending_buf,t.pending-H,H)),Q(R),H=t.pending,t.pending===t.pending_buf_size)){k=1;break}k=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,T(t,k)}while(0!==k);t.gzhead.hcrc&&t.pending>H&&(R.adler=J(R.adler,t.pending_buf,t.pending-H,H)),0===k&&(t.gzindex=0,t.status=91)}else t.status=91;if(91===t.status)if(t.gzhead.comment){H=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>H&&(R.adler=J(R.adler,t.pending_buf,t.pending-H,H)),Q(R),H=t.pending,t.pending===t.pending_buf_size)){k=1;break}k=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,T(t,k)}while(0!==k);t.gzhead.hcrc&&t.pending>H&&(R.adler=J(R.adler,t.pending_buf,t.pending-H,H)),0===k&&(t.status=E)}else t.status=E;if(t.status===E&&(t.gzhead.hcrc?(t.pending+2>t.pending_buf_size&&Q(R),t.pending+2<=t.pending_buf_size&&(T(t,255&R.adler),T(t,R.adler>>8&255),R.adler=0,t.status=w)):t.status=w),0!==t.pending){if(Q(R),0===R.avail_out)return t.last_flush=-1,S}else if(0===R.avail_in&&N(x)<=N(U)&&x!==i)return f(R,F);if(t.status===h&&0!==R.avail_in)return f(R,F);if(0!==R.avail_in||0!==t.lookahead||x!==n&&t.status!==h){let H=t.strategy===a?((R,x)=>{let H;for(;;){if(0===R.lookahead&&(z(R),0===R.lookahead)){if(x===n)return 1;break}if(R.match_length=0,H=A(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,H&&(G(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,x===i?(G(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(G(R,!1),0===R.strm.avail_out)?1:2})(t,x):t.strategy===X?((R,x)=>{let H,k,c,t;const D=R.window;for(;;){if(R.lookahead<=y){if(z(R),R.lookahead<=y&&x===n)return 1;if(0===R.lookahead)break}if(R.match_length=0,R.lookahead>=3&&R.strstart>0&&(c=R.strstart-1,k=D[c],k===D[++c]&&k===D[++c]&&k===D[++c])){t=R.strstart+y;do{}while(k===D[++c]&&k===D[++c]&&k===D[++c]&&k===D[++c]&&k===D[++c]&&k===D[++c]&&k===D[++c]&&k===D[++c]&&c<t);R.match_length=y-(t-c),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=3?(H=A(R,1,R.match_length-3),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(H=A(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),H&&(G(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,x===i?(G(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(G(R,!1),0===R.strm.avail_out)?1:2})(t,x):l[t.level].func(t,x);if(3!==H&&4!==H||(t.status=h),1===H||3===H)return 0===R.avail_out&&(t.last_flush=-1),S;if(2===H&&(x===g?D(t):x!==q&&(c(t,0,0,!1),x===I&&(W(t.head),0===t.lookahead&&(t.strstart=0,t.block_start=0,t.insert=0))),Q(R),0===R.avail_out))return t.last_flush=-1,S}return x!==i?S:t.wrap<=0?L:(2===t.wrap?(T(t,255&R.adler),T(t,R.adler>>8&255),T(t,R.adler>>16&255),T(t,R.adler>>24&255),T(t,255&R.total_in),T(t,R.total_in>>8&255),T(t,R.total_in>>16&255),T(t,R.total_in>>24&255)):(v(t,R.adler>>>16),v(t,65535&R.adler)),Q(R),t.wrap>0&&(t.wrap=-t.wrap),0!==t.pending?S:L)},R.exports.deflateEnd=R=>{if(!R||!R.state)return b;const x=R.state.status;return 42!==x&&69!==x&&73!==x&&91!==x&&x!==E&&x!==w&&x!==h?f(R,b):(R.state=null,x===w?f(R,C):S)},R.exports.deflateSetDictionary=(R,x)=>{let H=x.length;if(!R||!R.state)return b;const k=R.state,c=k.wrap;if(2===c||1===c&&42!==k.status||k.lookahead)return b;if(1===c&&(R.adler=U(R.adler,x,H,0)),k.wrap=0,H>=k.w_size){0===c&&(W(k.head),k.strstart=0,k.block_start=0,k.insert=0);let R=new Uint8Array(k.w_size);R.set(x.subarray(H-k.w_size,H),0),x=R,H=k.w_size}const t=R.avail_in,A=R.next_in,D=R.input;for(R.avail_in=H,R.next_in=0,R.input=x,z(k);k.lookahead>=3;){let R=k.strstart,x=k.lookahead-2;do{k.ins_h=K(k,k.ins_h,k.window[R+3-1]),k.prev[R&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=R,R++}while(--x);k.strstart=R,k.lookahead=2,z(k)}return k.strstart+=k.lookahead,k.block_start=k.strstart,k.insert=k.lookahead,k.lookahead=0,k.match_length=k.prev_length=2,k.match_available=0,R.next_in=A,R.input=D,R.avail_in=t,k.wrap=c,S},R.exports.deflateInfo="pako deflate (from Nodeca project)"},12744:R=>{"use strict";R.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12734:R=>{"use strict";R.exports=function(R,x){let H,k,c,t,A,D,U,J,V,n,g,I,i,q,S,L,b,C,F,d,P,a,X,M;const B=R.state;H=R.next_in,X=R.input,k=H+(R.avail_in-5),c=R.next_out,M=R.output,t=c-(x-R.avail_out),A=c+(R.avail_out-257),D=B.dmax,U=B.wsize,J=B.whave,V=B.wnext,n=B.window,g=B.hold,I=B.bits,i=B.lencode,q=B.distcode,S=(1<<B.lenbits)-1,L=(1<<B.distbits)-1;R:do{I<15&&(g+=X[H++]<<I,I+=8,g+=X[H++]<<I,I+=8),b=i[g&S];x:for(;;){if(C=b>>>24,g>>>=C,I-=C,C=b>>>16&255,0===C)M[c++]=65535&b;else{if(!(16&C)){if(0===(64&C)){b=i[(65535&b)+(g&(1<<C)-1)];continue x}if(32&C){B.mode=12;break R}R.msg="invalid literal/length code",B.mode=30;break R}F=65535&b,C&=15,C&&(I<C&&(g+=X[H++]<<I,I+=8),F+=g&(1<<C)-1,g>>>=C,I-=C),I<15&&(g+=X[H++]<<I,I+=8,g+=X[H++]<<I,I+=8),b=q[g&L];H:for(;;){if(C=b>>>24,g>>>=C,I-=C,C=b>>>16&255,!(16&C)){if(0===(64&C)){b=q[(65535&b)+(g&(1<<C)-1)];continue H}R.msg="invalid distance code",B.mode=30;break R}if(d=65535&b,C&=15,I<C&&(g+=X[H++]<<I,I+=8,I<C&&(g+=X[H++]<<I,I+=8)),d+=g&(1<<C)-1,d>D){R.msg="invalid distance too far back",B.mode=30;break R}if(g>>>=C,I-=C,C=c-t,d>C){if(C=d-C,C>J&&B.sane){R.msg="invalid distance too far back",B.mode=30;break R}if(P=0,a=n,0===V){if(P+=U-C,C<F){F-=C;do{M[c++]=n[P++]}while(--C);P=c-d,a=M}}else if(V<C){if(P+=U+V-C,C-=V,C<F){F-=C;do{M[c++]=n[P++]}while(--C);if(P=0,V<F){C=V,F-=C;do{M[c++]=n[P++]}while(--C);P=c-d,a=M}}}else if(P+=V-C,C<F){F-=C;do{M[c++]=n[P++]}while(--C);P=c-d,a=M}for(;F>2;)M[c++]=a[P++],M[c++]=a[P++],M[c++]=a[P++],F-=3;F&&(M[c++]=a[P++],F>1&&(M[c++]=a[P++]))}else{P=c-d;do{M[c++]=M[P++],M[c++]=M[P++],M[c++]=M[P++],F-=3}while(F>2);F&&(M[c++]=M[P++],F>1&&(M[c++]=M[P++]))}break}}break}}while(H<k&&c<A);F=I>>3,H-=F,I-=F<<3,g&=(1<<I)-1,R.next_in=H,R.next_out=c,R.avail_in=H<k?k-H+5:5-(H-k),R.avail_out=c<A?A-c+257:257-(c-A),B.hold=g,B.bits=I}},12727:(R,x,H)=>{"use strict";const k=H(12672),c=H(12681),t=H(12734),A=H(12737),{Z_FINISH:D,Z_BLOCK:U,Z_TREES:J,Z_OK:V,Z_STREAM_END:n,Z_NEED_DICT:g,Z_STREAM_ERROR:I,Z_DATA_ERROR:i,Z_MEM_ERROR:q,Z_BUF_ERROR:S,Z_DEFLATED:L}=H(12698),b=12,C=30,F=R=>(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24);function d(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const P=R=>{if(!R||!R.state)return I;const x=R.state;return R.total_in=R.total_out=x.total=0,R.msg="",x.wrap&&(R.adler=1&x.wrap),x.mode=1,x.last=0,x.havedict=0,x.dmax=32768,x.head=null,x.hold=0,x.bits=0,x.lencode=x.lendyn=new Int32Array(852),x.distcode=x.distdyn=new Int32Array(592),x.sane=1,x.back=-1,V},a=R=>{if(!R||!R.state)return I;const x=R.state;return x.wsize=0,x.whave=0,x.wnext=0,P(R)},X=(R,x)=>{let H;if(!R||!R.state)return I;const k=R.state;return x<0?(H=0,x=-x):(H=1+(x>>4),x<48&&(x&=15)),x&&(x<8||x>15)?I:(null!==k.window&&k.wbits!==x&&(k.window=null),k.wrap=H,k.wbits=x,a(R))},M=(R,x)=>{if(!R)return I;const H=new d;R.state=H,H.window=null;const k=X(R,x);return k!==V&&(R.state=null),k};let B,o,Z=!0;const y=R=>{if(Z){B=new Int32Array(512),o=new Int32Array(32);let x=0;for(;x<144;)R.lens[x++]=8;for(;x<256;)R.lens[x++]=9;for(;x<280;)R.lens[x++]=7;for(;x<288;)R.lens[x++]=8;for(A(1,R.lens,0,288,B,0,R.work,{bits:9}),x=0;x<32;)R.lens[x++]=5;A(2,R.lens,0,32,o,0,R.work,{bits:5}),Z=!1}R.lencode=B,R.lenbits=9,R.distcode=o,R.distbits=5},s=(R,x,H,k)=>{let c;const t=R.state;return null===t.window&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new Uint8Array(t.wsize)),k>=t.wsize?(t.window.set(x.subarray(H-t.wsize,H),0),t.wnext=0,t.whave=t.wsize):(c=t.wsize-t.wnext,c>k&&(c=k),t.window.set(x.subarray(H-k,H-k+c),t.wnext),(k-=c)?(t.window.set(x.subarray(H-k,H),0),t.wnext=k,t.whave=t.wsize):(t.wnext+=c,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=c))),0};R.exports.inflateReset=a,R.exports.inflateReset2=X,R.exports.inflateResetKeep=P,R.exports.inflateInit=R=>M(R,15),R.exports.inflateInit2=M,R.exports.inflate=(R,x)=>{let H,d,P,a,X,M,B,o,Z,E,w,h,f,N,W,K,Q,G,T,v,p,r,z=0;const j=new Uint8Array(4);let m,O;const l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!R||!R.state||!R.output||!R.input&&0!==R.avail_in)return I;H=R.state,H.mode===b&&(H.mode=13),X=R.next_out,P=R.output,B=R.avail_out,a=R.next_in,d=R.input,M=R.avail_in,o=H.hold,Z=H.bits,E=M,w=B,r=V;R:for(;;)switch(H.mode){case 1:if(0===H.wrap){H.mode=13;break}for(;Z<16;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(2&H.wrap&&35615===o){H.check=0,j[0]=255&o,j[1]=o>>>8&255,H.check=c(H.check,j,2,0),o=0,Z=0,H.mode=2;break}if(H.flags=0,H.head&&(H.head.done=!1),!(1&H.wrap)||(((255&o)<<8)+(o>>8))%31){R.msg="incorrect header check",H.mode=C;break}if((15&o)!==L){R.msg="unknown compression method",H.mode=C;break}if(o>>>=4,Z-=4,p=8+(15&o),0===H.wbits)H.wbits=p;else if(p>H.wbits){R.msg="invalid window size",H.mode=C;break}H.dmax=1<<H.wbits,R.adler=H.check=1,H.mode=512&o?10:b,o=0,Z=0;break;case 2:for(;Z<16;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(H.flags=o,(255&H.flags)!==L){R.msg="unknown compression method",H.mode=C;break}if(57344&H.flags){R.msg="unknown header flags set",H.mode=C;break}H.head&&(H.head.text=o>>8&1),512&H.flags&&(j[0]=255&o,j[1]=o>>>8&255,H.check=c(H.check,j,2,0)),o=0,Z=0,H.mode=3;case 3:for(;Z<32;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}H.head&&(H.head.time=o),512&H.flags&&(j[0]=255&o,j[1]=o>>>8&255,j[2]=o>>>16&255,j[3]=o>>>24&255,H.check=c(H.check,j,4,0)),o=0,Z=0,H.mode=4;case 4:for(;Z<16;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}H.head&&(H.head.xflags=255&o,H.head.os=o>>8),512&H.flags&&(j[0]=255&o,j[1]=o>>>8&255,H.check=c(H.check,j,2,0)),o=0,Z=0,H.mode=5;case 5:if(1024&H.flags){for(;Z<16;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}H.length=o,H.head&&(H.head.extra_len=o),512&H.flags&&(j[0]=255&o,j[1]=o>>>8&255,H.check=c(H.check,j,2,0)),o=0,Z=0}else H.head&&(H.head.extra=null);H.mode=6;case 6:if(1024&H.flags&&(h=H.length,h>M&&(h=M),h&&(H.head&&(p=H.head.extra_len-H.length,H.head.extra||(H.head.extra=new Uint8Array(H.head.extra_len)),H.head.extra.set(d.subarray(a,a+h),p)),512&H.flags&&(H.check=c(H.check,d,h,a)),M-=h,a+=h,H.length-=h),H.length))break R;H.length=0,H.mode=7;case 7:if(2048&H.flags){if(0===M)break R;h=0;do{p=d[a+h++],H.head&&p&&H.length<65536&&(H.head.name+=String.fromCharCode(p))}while(p&&h<M);if(512&H.flags&&(H.check=c(H.check,d,h,a)),M-=h,a+=h,p)break R}else H.head&&(H.head.name=null);H.length=0,H.mode=8;case 8:if(4096&H.flags){if(0===M)break R;h=0;do{p=d[a+h++],H.head&&p&&H.length<65536&&(H.head.comment+=String.fromCharCode(p))}while(p&&h<M);if(512&H.flags&&(H.check=c(H.check,d,h,a)),M-=h,a+=h,p)break R}else H.head&&(H.head.comment=null);H.mode=9;case 9:if(512&H.flags){for(;Z<16;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(o!==(65535&H.check)){R.msg="header crc mismatch",H.mode=C;break}o=0,Z=0}H.head&&(H.head.hcrc=H.flags>>9&1,H.head.done=!0),R.adler=H.check=0,H.mode=b;break;case 10:for(;Z<32;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}R.adler=H.check=F(o),o=0,Z=0,H.mode=11;case 11:if(0===H.havedict)return R.next_out=X,R.avail_out=B,R.next_in=a,R.avail_in=M,H.hold=o,H.bits=Z,g;R.adler=H.check=1,H.mode=b;case b:if(x===U||x===J)break R;case 13:if(H.last){o>>>=7&Z,Z-=7&Z,H.mode=27;break}for(;Z<3;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}switch(H.last=1&o,o>>>=1,Z-=1,3&o){case 0:H.mode=14;break;case 1:if(y(H),H.mode=20,x===J){o>>>=2,Z-=2;break R}break;case 2:H.mode=17;break;case 3:R.msg="invalid block type",H.mode=C}o>>>=2,Z-=2;break;case 14:for(o>>>=7&Z,Z-=7&Z;Z<32;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if((65535&o)!==(o>>>16^65535)){R.msg="invalid stored block lengths",H.mode=C;break}if(H.length=65535&o,o=0,Z=0,H.mode=15,x===J)break R;case 15:H.mode=16;case 16:if(h=H.length,h){if(h>M&&(h=M),h>B&&(h=B),0===h)break R;P.set(d.subarray(a,a+h),X),M-=h,a+=h,B-=h,X+=h,H.length-=h;break}H.mode=b;break;case 17:for(;Z<14;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(H.nlen=257+(31&o),o>>>=5,Z-=5,H.ndist=1+(31&o),o>>>=5,Z-=5,H.ncode=4+(15&o),o>>>=4,Z-=4,H.nlen>286||H.ndist>30){R.msg="too many length or distance symbols",H.mode=C;break}H.have=0,H.mode=18;case 18:for(;H.have<H.ncode;){for(;Z<3;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}H.lens[l[H.have++]]=7&o,o>>>=3,Z-=3}for(;H.have<19;)H.lens[l[H.have++]]=0;if(H.lencode=H.lendyn,H.lenbits=7,m={bits:H.lenbits},r=A(0,H.lens,0,19,H.lencode,0,H.work,m),H.lenbits=m.bits,r){R.msg="invalid code lengths set",H.mode=C;break}H.have=0,H.mode=19;case 19:for(;H.have<H.nlen+H.ndist;){for(;z=H.lencode[o&(1<<H.lenbits)-1],W=z>>>24,K=z>>>16&255,Q=65535&z,!(W<=Z);){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(Q<16)o>>>=W,Z-=W,H.lens[H.have++]=Q;else{if(16===Q){for(O=W+2;Z<O;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(o>>>=W,Z-=W,0===H.have){R.msg="invalid bit length repeat",H.mode=C;break}p=H.lens[H.have-1],h=3+(3&o),o>>>=2,Z-=2}else if(17===Q){for(O=W+3;Z<O;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}o>>>=W,Z-=W,p=0,h=3+(7&o),o>>>=3,Z-=3}else{for(O=W+7;Z<O;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}o>>>=W,Z-=W,p=0,h=11+(127&o),o>>>=7,Z-=7}if(H.have+h>H.nlen+H.ndist){R.msg="invalid bit length repeat",H.mode=C;break}for(;h--;)H.lens[H.have++]=p}}if(H.mode===C)break;if(0===H.lens[256]){R.msg="invalid code -- missing end-of-block",H.mode=C;break}if(H.lenbits=9,m={bits:H.lenbits},r=A(1,H.lens,0,H.nlen,H.lencode,0,H.work,m),H.lenbits=m.bits,r){R.msg="invalid literal/lengths set",H.mode=C;break}if(H.distbits=6,H.distcode=H.distdyn,m={bits:H.distbits},r=A(2,H.lens,H.nlen,H.ndist,H.distcode,0,H.work,m),H.distbits=m.bits,r){R.msg="invalid distances set",H.mode=C;break}if(H.mode=20,x===J)break R;case 20:H.mode=21;case 21:if(M>=6&&B>=258){R.next_out=X,R.avail_out=B,R.next_in=a,R.avail_in=M,H.hold=o,H.bits=Z,t(R,w),X=R.next_out,P=R.output,B=R.avail_out,a=R.next_in,d=R.input,M=R.avail_in,o=H.hold,Z=H.bits,H.mode===b&&(H.back=-1);break}for(H.back=0;z=H.lencode[o&(1<<H.lenbits)-1],W=z>>>24,K=z>>>16&255,Q=65535&z,!(W<=Z);){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(K&&0===(240&K)){for(G=W,T=K,v=Q;z=H.lencode[v+((o&(1<<G+T)-1)>>G)],W=z>>>24,K=z>>>16&255,Q=65535&z,!(G+W<=Z);){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}o>>>=G,Z-=G,H.back+=G}if(o>>>=W,Z-=W,H.back+=W,H.length=Q,0===K){H.mode=26;break}if(32&K){H.back=-1,H.mode=b;break}if(64&K){R.msg="invalid literal/length code",H.mode=C;break}H.extra=15&K,H.mode=22;case 22:if(H.extra){for(O=H.extra;Z<O;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}H.length+=o&(1<<H.extra)-1,o>>>=H.extra,Z-=H.extra,H.back+=H.extra}H.was=H.length,H.mode=23;case 23:for(;z=H.distcode[o&(1<<H.distbits)-1],W=z>>>24,K=z>>>16&255,Q=65535&z,!(W<=Z);){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(0===(240&K)){for(G=W,T=K,v=Q;z=H.distcode[v+((o&(1<<G+T)-1)>>G)],W=z>>>24,K=z>>>16&255,Q=65535&z,!(G+W<=Z);){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}o>>>=G,Z-=G,H.back+=G}if(o>>>=W,Z-=W,H.back+=W,64&K){R.msg="invalid distance code",H.mode=C;break}H.offset=Q,H.extra=15&K,H.mode=24;case 24:if(H.extra){for(O=H.extra;Z<O;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}H.offset+=o&(1<<H.extra)-1,o>>>=H.extra,Z-=H.extra,H.back+=H.extra}if(H.offset>H.dmax){R.msg="invalid distance too far back",H.mode=C;break}H.mode=25;case 25:if(0===B)break R;if(h=w-B,H.offset>h){if(h=H.offset-h,h>H.whave&&H.sane){R.msg="invalid distance too far back",H.mode=C;break}h>H.wnext?(h-=H.wnext,f=H.wsize-h):f=H.wnext-h,h>H.length&&(h=H.length),N=H.window}else N=P,f=X-H.offset,h=H.length;h>B&&(h=B),B-=h,H.length-=h;do{P[X++]=N[f++]}while(--h);0===H.length&&(H.mode=21);break;case 26:if(0===B)break R;P[X++]=H.length,B--,H.mode=21;break;case 27:if(H.wrap){for(;Z<32;){if(0===M)break R;M--,o|=d[a++]<<Z,Z+=8}if(w-=B,R.total_out+=w,H.total+=w,w&&(R.adler=H.check=H.flags?c(H.check,P,w,X-w):k(H.check,P,w,X-w)),w=B,(H.flags?o:F(o))!==H.check){R.msg="incorrect data check",H.mode=C;break}o=0,Z=0}H.mode=28;case 28:if(H.wrap&&H.flags){for(;Z<32;){if(0===M)break R;M--,o+=d[a++]<<Z,Z+=8}if(o!==(4294967295&H.total)){R.msg="incorrect length check",H.mode=C;break}o=0,Z=0}H.mode=29;case 29:r=n;break R;case C:r=i;break R;case 31:return q;default:return I}return R.next_out=X,R.avail_out=B,R.next_in=a,R.avail_in=M,H.hold=o,H.bits=Z,(H.wsize||w!==R.avail_out&&H.mode<C&&(H.mode<27||x!==D))&&s(R,R.output,R.next_out,w-R.avail_out)?(H.mode=31,q):(E-=R.avail_in,w-=R.avail_out,R.total_in+=E,R.total_out+=w,H.total+=w,H.wrap&&w&&(R.adler=H.check=H.flags?c(H.check,P,w,R.next_out-w):k(H.check,P,w,R.next_out-w)),R.data_type=H.bits+(H.last?64:0)+(H.mode===b?128:0)+(20===H.mode||15===H.mode?256:0),(0===E&&0===w||x===D)&&r===V&&(r=S),r)},R.exports.inflateEnd=R=>{if(!R||!R.state)return I;let x=R.state;return x.window&&(x.window=null),R.state=null,V},R.exports.inflateGetHeader=(R,x)=>{if(!R||!R.state)return I;const H=R.state;return 0===(2&H.wrap)?I:(H.head=x,x.done=!1,V)},R.exports.inflateSetDictionary=(R,x)=>{const H=x.length;let c,t,A;return R&&R.state?(c=R.state,0!==c.wrap&&11!==c.mode?I:11===c.mode&&(t=1,t=k(t,x,H,0),t!==c.check)?i:(A=s(R,x,H,H),A?(c.mode=31,q):(c.havedict=1,V))):I},R.exports.inflateInfo="pako inflate (from Nodeca project)"},12737:R=>{"use strict";const x=15,H=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),k=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),c=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),t=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);R.exports=(R,A,D,U,J,V,n,g)=>{const I=g.bits;let i,q,S,L,b,C,F=0,d=0,P=0,a=0,X=0,M=0,B=0,o=0,Z=0,y=0,s=null,E=0;const w=new Uint16Array(16),h=new Uint16Array(16);let f,N,W,K=null,Q=0;for(F=0;F<=x;F++)w[F]=0;for(d=0;d<U;d++)w[A[D+d]]++;for(X=I,a=x;a>=1&&0===w[a];a--);if(X>a&&(X=a),0===a)return J[V++]=20971520,J[V++]=20971520,g.bits=1,0;for(P=1;P<a&&0===w[P];P++);for(X<P&&(X=P),o=1,F=1;F<=x;F++)if(o<<=1,o-=w[F],o<0)return-1;if(o>0&&(0===R||1!==a))return-1;for(h[1]=0,F=1;F<x;F++)h[F+1]=h[F]+w[F];for(d=0;d<U;d++)0!==A[D+d]&&(n[h[A[D+d]]++]=d);if(0===R?(s=K=n,C=19):1===R?(s=H,E-=257,K=k,Q-=257,C=256):(s=c,K=t,C=-1),y=0,d=0,F=P,b=V,M=X,B=0,S=-1,Z=1<<X,L=Z-1,1===R&&Z>852||2===R&&Z>592)return 1;for(;;){f=F-B,n[d]<C?(N=0,W=n[d]):n[d]>C?(N=K[Q+n[d]],W=s[E+n[d]]):(N=96,W=0),i=1<<F-B,q=1<<M,P=q;do{q-=i,J[b+(y>>B)+q]=f<<24|N<<16|W}while(0!==q);for(i=1<<F-1;y&i;)i>>=1;if(0!==i?(y&=i-1,y+=i):y=0,d++,0===--w[F]){if(F===a)break;F=A[D+n[d]]}if(F>X&&(y&L)!==S){for(0===B&&(B=X),b+=P,M=F-B,o=1<<M;M+B<a&&(o-=w[M+B],!(o<=0));)M++,o<<=1;if(Z+=1<<M,1===R&&Z>852||2===R&&Z>592)return 1;S=y&L,J[S]=X<<24|M<<16|b-V}}return 0!==y&&(J[b+y]=F-B<<24|64<<16),g.bits=X,0}},12690:R=>{"use strict";R.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12664:R=>{"use strict";function x(R){let x=R.length;for(;--x>=0;)R[x]=0}const H=256,k=286,c=30,t=15,A=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),D=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V=new Array(576);x(V);const n=new Array(60);x(n);const g=new Array(512);x(g);const I=new Array(256);x(I);const i=new Array(29);x(i);const q=new Array(c);function S(R,x,H,k,c){this.static_tree=R,this.extra_bits=x,this.extra_base=H,this.elems=k,this.max_length=c,this.has_stree=R&&R.length}let L,b,C;function F(R,x){this.dyn_tree=R,this.max_code=0,this.stat_desc=x}x(q);const d=R=>R<256?g[R]:g[256+(R>>>7)],P=(R,x)=>{R.pending_buf[R.pending++]=255&x,R.pending_buf[R.pending++]=x>>>8&255},a=(R,x,H)=>{R.bi_valid>16-H?(R.bi_buf|=x<<R.bi_valid&65535,P(R,R.bi_buf),R.bi_buf=x>>16-R.bi_valid,R.bi_valid+=H-16):(R.bi_buf|=x<<R.bi_valid&65535,R.bi_valid+=H)},X=(R,x,H)=>{a(R,H[2*x],H[2*x+1])},M=(R,x)=>{let H=0;do{H|=1&R,R>>>=1,H<<=1}while(--x>0);return H>>>1},B=(R,x,H)=>{const k=new Array(16);let c,A,D=0;for(c=1;c<=t;c++)k[c]=D=D+H[c-1]<<1;for(A=0;A<=x;A++){let x=R[2*A+1];0!==x&&(R[2*A]=M(k[x]++,x))}},o=R=>{let x;for(x=0;x<k;x++)R.dyn_ltree[2*x]=0;for(x=0;x<c;x++)R.dyn_dtree[2*x]=0;for(x=0;x<19;x++)R.bl_tree[2*x]=0;R.dyn_ltree[512]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0},Z=R=>{R.bi_valid>8?P(R,R.bi_buf):R.bi_valid>0&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0},y=(R,x,H,k)=>{const c=2*x,t=2*H;return R[c]<R[t]||R[c]===R[t]&&k[x]<=k[H]},s=(R,x,H)=>{const k=R.heap[H];let c=H<<1;for(;c<=R.heap_len&&(c<R.heap_len&&y(x,R.heap[c+1],R.heap[c],R.depth)&&c++,!y(x,k,R.heap[c],R.depth));)R.heap[H]=R.heap[c],H=c,c<<=1;R.heap[H]=k},E=(R,x,k)=>{let c,t,U,J,V=0;if(0!==R.last_lit)do{c=R.pending_buf[R.d_buf+2*V]<<8|R.pending_buf[R.d_buf+2*V+1],t=R.pending_buf[R.l_buf+V],V++,0===c?X(R,t,x):(U=I[t],X(R,U+H+1,x),J=A[U],0!==J&&(t-=i[U],a(R,t,J)),c--,U=d(c),X(R,U,k),J=D[U],0!==J&&(c-=q[U],a(R,c,J)))}while(V<R.last_lit);X(R,256,x)},w=(R,x)=>{const H=x.dyn_tree,k=x.stat_desc.static_tree,c=x.stat_desc.has_stree,A=x.stat_desc.elems;let D,U,J,V=-1;for(R.heap_len=0,R.heap_max=573,D=0;D<A;D++)0!==H[2*D]?(R.heap[++R.heap_len]=V=D,R.depth[D]=0):H[2*D+1]=0;for(;R.heap_len<2;)J=R.heap[++R.heap_len]=V<2?++V:0,H[2*J]=1,R.depth[J]=0,R.opt_len--,c&&(R.static_len-=k[2*J+1]);for(x.max_code=V,D=R.heap_len>>1;D>=1;D--)s(R,H,D);J=A;do{D=R.heap[1],R.heap[1]=R.heap[R.heap_len--],s(R,H,1),U=R.heap[1],R.heap[--R.heap_max]=D,R.heap[--R.heap_max]=U,H[2*J]=H[2*D]+H[2*U],R.depth[J]=(R.depth[D]>=R.depth[U]?R.depth[D]:R.depth[U])+1,H[2*D+1]=H[2*U+1]=J,R.heap[1]=J++,s(R,H,1)}while(R.heap_len>=2);R.heap[--R.heap_max]=R.heap[1],((R,x)=>{const H=x.dyn_tree,k=x.max_code,c=x.stat_desc.static_tree,A=x.stat_desc.has_stree,D=x.stat_desc.extra_bits,U=x.stat_desc.extra_base,J=x.stat_desc.max_length;let V,n,g,I,i,q,S=0;for(I=0;I<=t;I++)R.bl_count[I]=0;for(H[2*R.heap[R.heap_max]+1]=0,V=R.heap_max+1;V<573;V++)n=R.heap[V],I=H[2*H[2*n+1]+1]+1,I>J&&(I=J,S++),H[2*n+1]=I,n>k||(R.bl_count[I]++,i=0,n>=U&&(i=D[n-U]),q=H[2*n],R.opt_len+=q*(I+i),A&&(R.static_len+=q*(c[2*n+1]+i)));if(0!==S){do{for(I=J-1;0===R.bl_count[I];)I--;R.bl_count[I]--,R.bl_count[I+1]+=2,R.bl_count[J]--,S-=2}while(S>0);for(I=J;0!==I;I--)for(n=R.bl_count[I];0!==n;)g=R.heap[--V],g>k||(H[2*g+1]!==I&&(R.opt_len+=(I-H[2*g+1])*H[2*g],H[2*g+1]=I),n--)}})(R,x),B(H,V,R.bl_count)},h=(R,x,H)=>{let k,c,t=-1,A=x[1],D=0,U=7,J=4;for(0===A&&(U=138,J=3),x[2*(H+1)+1]=65535,k=0;k<=H;k++)c=A,A=x[2*(k+1)+1],++D<U&&c===A||(D<J?R.bl_tree[2*c]+=D:0!==c?(c!==t&&R.bl_tree[2*c]++,R.bl_tree[32]++):D<=10?R.bl_tree[34]++:R.bl_tree[36]++,D=0,t=c,0===A?(U=138,J=3):c===A?(U=6,J=3):(U=7,J=4))},f=(R,x,H)=>{let k,c,t=-1,A=x[1],D=0,U=7,J=4;for(0===A&&(U=138,J=3),k=0;k<=H;k++)if(c=A,A=x[2*(k+1)+1],!(++D<U&&c===A)){if(D<J)do{X(R,c,R.bl_tree)}while(0!==--D);else 0!==c?(c!==t&&(X(R,c,R.bl_tree),D--),X(R,16,R.bl_tree),a(R,D-3,2)):D<=10?(X(R,17,R.bl_tree),a(R,D-3,3)):(X(R,18,R.bl_tree),a(R,D-11,7));D=0,t=c,0===A?(U=138,J=3):c===A?(U=6,J=3):(U=7,J=4)}};let N=!1;const W=(R,x,H,k)=>{a(R,0+(k?1:0),3),((R,x,H,k)=>{Z(R),k&&(P(R,H),P(R,~H)),R.pending_buf.set(R.window.subarray(x,x+H),R.pending),R.pending+=H})(R,x,H,!0)};R.exports._tr_init=R=>{N||((()=>{let R,x,H,J,F;const d=new Array(16);for(H=0,J=0;J<28;J++)for(i[J]=H,R=0;R<1<<A[J];R++)I[H++]=J;for(I[H-1]=J,F=0,J=0;J<16;J++)for(q[J]=F,R=0;R<1<<D[J];R++)g[F++]=J;for(F>>=7;J<c;J++)for(q[J]=F<<7,R=0;R<1<<D[J]-7;R++)g[256+F++]=J;for(x=0;x<=t;x++)d[x]=0;for(R=0;R<=143;)V[2*R+1]=8,R++,d[8]++;for(;R<=255;)V[2*R+1]=9,R++,d[9]++;for(;R<=279;)V[2*R+1]=7,R++,d[7]++;for(;R<=287;)V[2*R+1]=8,R++,d[8]++;for(B(V,287,d),R=0;R<c;R++)n[2*R+1]=5,n[2*R]=M(R,5);L=new S(V,A,257,k,t),b=new S(n,D,0,c,t),C=new S(new Array(0),U,0,19,7)})(),N=!0),R.l_desc=new F(R.dyn_ltree,L),R.d_desc=new F(R.dyn_dtree,b),R.bl_desc=new F(R.bl_tree,C),R.bi_buf=0,R.bi_valid=0,o(R)},R.exports._tr_stored_block=W,R.exports._tr_flush_block=(R,x,k,c)=>{let t,A,D=0;R.level>0?(2===R.strm.data_type&&(R.strm.data_type=(R=>{let x,k=4093624447;for(x=0;x<=31;x++,k>>>=1)if(1&k&&0!==R.dyn_ltree[2*x])return 0;if(0!==R.dyn_ltree[18]||0!==R.dyn_ltree[20]||0!==R.dyn_ltree[26])return 1;for(x=32;x<H;x++)if(0!==R.dyn_ltree[2*x])return 1;return 0})(R)),w(R,R.l_desc),w(R,R.d_desc),D=(R=>{let x;for(h(R,R.dyn_ltree,R.l_desc.max_code),h(R,R.dyn_dtree,R.d_desc.max_code),w(R,R.bl_desc),x=18;x>=3&&0===R.bl_tree[2*J[x]+1];x--);return R.opt_len+=3*(x+1)+5+5+4,x})(R),t=R.opt_len+3+7>>>3,A=R.static_len+3+7>>>3,A<=t&&(t=A)):t=A=k+5,k+4<=t&&-1!==x?W(R,x,k,c):4===R.strategy||A===t?(a(R,2+(c?1:0),3),E(R,V,n)):(a(R,4+(c?1:0),3),((R,x,H,k)=>{let c;for(a(R,x-257,5),a(R,H-1,5),a(R,k-4,4),c=0;c<k;c++)a(R,R.bl_tree[2*J[c]+1],3);f(R,R.dyn_ltree,x-1),f(R,R.dyn_dtree,H-1)})(R,R.l_desc.max_code+1,R.d_desc.max_code+1,D+1),E(R,R.dyn_ltree,R.dyn_dtree)),o(R),c&&Z(R)},R.exports._tr_tally=(R,x,k)=>(R.pending_buf[R.d_buf+2*R.last_lit]=x>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&x,R.pending_buf[R.l_buf+R.last_lit]=255&k,R.last_lit++,0===x?R.dyn_ltree[2*k]++:(R.matches++,x--,R.dyn_ltree[2*(I[k]+H+1)]++,R.dyn_dtree[2*d(x)]++),R.last_lit===R.lit_bufsize-1),R.exports._tr_align=R=>{a(R,2,3),X(R,256,V),(R=>{16===R.bi_valid?(P(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):R.bi_valid>=8&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)})(R)}},12716:R=>{"use strict";R.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12580:R=>{function x(R,x,H){for(var k=R.length,c=-1/0,t=1/0,A=0;A<k;A++){var D=(H[0][A]-R[A])/x[A],U=(H[1][A]-R[A])/x[A];if(D>U){var J=D;D=U,U=J}if(U<c||D>t)return 1/0;D>c&&(c=D),U<t&&(t=U)}return c>t?1/0:c}R.exports=function(R,H,k,c){var t=x(H,k,c);if(t===1/0)R=null;else{R=R||[];for(var A=0;A<H.length;A++)R[A]=H[A]+k[A]*t}return R},R.exports.distance=x},13523:(R,x,H)=>{"use strict";H.d(x,{e:()=>A});var k=H(32);const c=k.useLayoutEffect;const t=function(R){var x=(0,k.useRef)(R);return c((function(){x.current=R})),x};var A=function(R){var x=t(R);(0,k.lb)((function(){var R=function(R){var H;if(null!=x.current&&(H=x.current(R)),R.defaultPrevented&&(R.returnValue=""),"string"===typeof H)return R.returnValue=H,H};return window.addEventListener("beforeunload",R),function(){window.removeEventListener("beforeunload",R)}}),[])}},13487:(R,x,H)=>{"use strict";var k=H(13492),c=Array.prototype.concat,t=Array.prototype.slice,A=R.exports=function(R){for(var x=[],H=0,A=R.length;H<A;H++){var D=R[H];k(D)?x=c.call(x,t.call(D)):x.push(D)}return x};A.wrap=function(R){return function(){return R(A(arguments))}}},13492:R=>{R.exports=function(R){return!(!R||"string"===typeof R)&&(R instanceof Array||Array.isArray(R)||R.length>=0&&(R.splice instanceof Function||Object.getOwnPropertyDescriptor(R,R.length-1)&&"String"!==R.constructor.name))}},12605:(R,x,H)=>{var k=H(12612);function c(R){for(var x,H,c=0,t=R.length,A=0;A<R.length;){for(x=R[A],H=0;A<t&&R[A]===x;)++A,++H;c+=k.log2(H)/7|0,c+=k.log2(x>>>0)/7|0,c+=2}return c}x.size=c,x.encode=function(R,x){x||(x=new Uint8Array(c(R)));for(var H,k,t=0,A=x.length,D=0;D<R.length;){for(H=R[D],k=0;D<R.length&&R[D]===H;)++D,++k;for(;t<A&&k>=128;)x[t++]=128+(127&k),k>>>=7;if(t>=A)throw new Error("RLE buffer overflow");for(x[t++]=k,H>>>=0;t<A&&H>=128;)x[t++]=128+(127&H),H>>>=7;if(t>=A)throw new Error("RLE buffer overflow");x[t++]=H}return x},x.decode=function(R,x){for(var H,k,c,t,A=x.length,D=R.length,U=0,J=0;J<D;){for(H=0,k=0;J<D&&R[J]>=128;)H+=(127&R[J++])<<k,k+=7;if(H+=R[J++]<<k,J>=D)throw new Error("RLE buffer underrun");if(U+H>A)throw new Error("Chunk buffer overflow");for(c=0,k=0;J<D&&R[J]>=128;)c+=(127&R[J++])<<k,k+=7;if(J>=D)throw new Error("RLE buffer underrun");for(c+=R[J++]<<k,t=0;t<H;++t)x[U++]=c}return x}},12612:(R,x)=>{"use strict";function H(R){var x=32;return(R&=-R)&&x--,65535&R&&(x-=16),16711935&R&&(x-=8),252645135&R&&(x-=4),858993459&R&&(x-=2),1431655765&R&&(x-=1),x}x.INT_BITS=32,x.INT_MAX=2147483647,x.INT_MIN=-1<<31,x.sign=function(R){return(R>0)-(R<0)},x.abs=function(R){var x=R>>31;return(R^x)-x},x.min=function(R,x){return x^(R^x)&-(R<x)},x.max=function(R,x){return R^(R^x)&-(R<x)},x.isPow2=function(R){return!(R&R-1)&&!!R},x.log2=function(R){var x,H;return x=(R>65535)<<4,x|=H=((R>>>=x)>255)<<3,x|=H=((R>>>=H)>15)<<2,(x|=H=((R>>>=H)>3)<<1)|(R>>>=H)>>1},x.log10=function(R){return R>=1e9?9:R>=1e8?8:R>=1e7?7:R>=1e6?6:R>=1e5?5:R>=1e4?4:R>=1e3?3:R>=100?2:R>=10?1:0},x.popCount=function(R){return 16843009*((R=(858993459&(R-=R>>>1&1431655765))+(R>>>2&858993459))+(R>>>4)&252645135)>>>24},x.countTrailingZeros=H,x.nextPow2=function(R){return R+=0===R,--R,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)+1},x.prevPow2=function(R){return R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)-(R>>>1)},x.parity=function(R){return R^=R>>>16,R^=R>>>8,R^=R>>>4,27030>>>(R&=15)&1};var k=new Array(256);!function(R){for(var x=0;x<256;++x){var H=x,k=x,c=7;for(H>>>=1;H;H>>>=1)k<<=1,k|=1&H,--c;R[x]=k<<c&255}}(k),x.reverse=function(R){return k[255&R]<<24|k[R>>>8&255]<<16|k[R>>>16&255]<<8|k[R>>>24&255]},x.interleave2=function(R,x){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))|(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))<<1},x.deinterleave2=function(R,x){return(R=65535&((R=16711935&((R=252645135&((R=858993459&((R=R>>>x&1431655765)|R>>>1))|R>>>2))|R>>>4))|R>>>16))<<16>>16},x.interleave3=function(R,x,H){return R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2),(R|=(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},x.deinterleave3=function(R,x){return(R=1023&((R=4278190335&((R=251719695&((R=3272356035&((R=R>>>x&1227133513)|R>>>2))|R>>>4))|R>>>8))|R>>>16))<<22>>22},x.nextCombination=function(R){var x=R|R-1;return x+1|(~x&-~x)-1>>>H(R)+1}},12641:R=>{"use strict";R.exports=function(R,x,H,k){var c=self||window;try{try{var t;try{t=new c.Blob([R])}catch(J){(t=new(c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder||c.MSBlobBuilder)).append(R),t=t.getBlob()}var A=c.URL||c.webkitURL,D=A.createObjectURL(t),U=new c[x](D,H);return A.revokeObjectURL(D),U}catch(J){return new c[x]("data:application/javascript,".concat(encodeURIComponent(R)),H)}}catch(J){if(!k)throw Error("Inline worker is not supported");return new c[x](k,H)}}},12567:(R,x,H)=>{"use strict";function k(R,x,H,k,c){var t={};return Object.keys(k).forEach((function(R){t[R]=k[R]})),t.enumerable=!!t.enumerable,t.configurable=!!t.configurable,("value"in t||t.initializer)&&(t.writable=!0),t=H.slice().reverse().reduce((function(H,k){return k(R,x,H)||H}),t),c&&void 0!==t.initializer&&(t.value=t.initializer?t.initializer.call(c):void 0,t.initializer=void 0),void 0===t.initializer&&(Object.defineProperty(R,x,t),t=null),t}H.d(x,{b:()=>k})},12559:(R,x,H)=>{"use strict";function k(R,x,H,k){H&&Object.defineProperty(R,x,{enumerable:H.enumerable,configurable:H.configurable,writable:H.writable,value:H.initializer?H.initializer.call(k):void 0})}H.d(x,{c:()=>k})},13518:(R,x,H)=>{"use strict";H.d(x,{d:()=>A,e:()=>n,f:()=>D,g:()=>t,h:()=>U,i:()=>c,l:()=>J,n:()=>V});var k=H(2288);class c{constructor(){this._easingMode=c.EASINGMODE_EASEIN}setEasingMode(R){const x=Math.min(Math.max(R,0),2);this._easingMode=x}getEasingMode(){return this._easingMode}easeInCore(R){throw new Error("You must implement this method")}ease(R){switch(this._easingMode){case c.EASINGMODE_EASEIN:return this.easeInCore(R);case c.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-R)}return R>=.5?.5*(1-this.easeInCore(2*(1-R)))+.5:.5*this.easeInCore(2*R)}}c.EASINGMODE_EASEIN=0,c.EASINGMODE_EASEOUT=1,c.EASINGMODE_EASEINOUT=2;class t extends c{easeInCore(R){return R=Math.max(0,Math.min(1,R)),1-Math.sqrt(1-R*R)}}class A extends c{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=R}easeInCore(R){const x=Math.max(0,this.amplitude);return Math.pow(R,3)-R*x*Math.sin(3.141592653589793*R)}}class D extends c{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=R,this.bounciness=x}easeInCore(R){const x=Math.max(0,this.bounces);let H=this.bounciness;H<=1&&(H=1.001);const k=Math.pow(H,x),c=1-H,t=(1-k)/c+.5*k,A=R*t,D=Math.log(-A*(1-H)+1)/Math.log(H),U=Math.floor(D),J=U+1,V=(1-Math.pow(H,U))/(c*t),n=.5*(V+(1-Math.pow(H,J))/(c*t)),g=R-n,I=n-V;return-Math.pow(1/H,x-U)/(I*I)*(g-I)*(g+I)}}class U extends c{easeInCore(R){return R*R*R}}class J extends c{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=R,this.springiness=x}easeInCore(R){let x;const H=Math.max(0,this.oscillations),k=Math.max(0,this.springiness);return x=0==k?R:(Math.exp(k*R)-1)/(Math.exp(k)-1),x*Math.sin((6.283185307179586*H+1.5707963267948966)*R)}}class V extends c{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=R}easeInCore(R){return this.exponent<=0?R:(Math.exp(this.exponent*R)-1)/(Math.exp(this.exponent)-1)}}class n extends c{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=R,this.y1=x,this.x2=H,this.y2=k}easeInCore(R){return k.b.Interpolate(R,this.x1,this.y1,this.x2,this.y2)}}},13189:(R,x,H)=>{"use strict";H.d(x,{e:()=>A});var k=H(661),c=H(672),t=H(683);class A extends t.e{get _matrix(){return this._compose(),this.mj}set _matrix(R){(R.updateFlag!==this.mj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.mj.p(R),this._markAsDirtyAndDecompose())}constructor(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(R,x.va(),!1),this.name=R,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=x,this.mj=(null===c||void 0===c?void 0:c.clone())??k.e.Identity(),this._restMatrix=t??this.mj.clone(),this._bindMatrix=A??this.mj.clone(),this._index=D,this._absoluteMatrix=new k.e,this._absoluteBindMatrix=new k.e,this._absoluteInverseBindMatrix=new k.e,this._finalMatrix=new k.e,x.bones.push(this),this.setParent(H,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(R){this.setParent(R)}setParent(R){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==R){if(this.parent){const R=this.parent.children.indexOf(this);-1!==R&&this.parent.children.splice(R,1)}this._parentNode=R,this.parent&&this.parent.children.push(this),x&&this._updateAbsoluteBindMatrices(),this._i()}}getLocalMatrix(){return this._compose(),this.mj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(R){this._restMatrix.p(R)}setRestPose(R){this.setRestMatrix(R)}getBindPose(){return this.getBindMatrix()}setBindMatrix(R){this.jj(R)}setBindPose(R){this.setBindMatrix(R)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const R=k.g.Bi[0],x=k.g.Quaternion[0],H=k.g.Bi[1];this.getRestMatrix().decompose(R,x,H),this._linkedTransformNode.position.p(H),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??k.f.Identity(),this._linkedTransformNode.rotationQuaternion.p(x),this._linkedTransformNode.ti.p(R)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(R){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=R,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Mg}set position(R){this._decompose(),this.Mg.p(R),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(R){this.setRotation(R)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(R){this.setRotationQuaternion(R)}get ti(){return this.getScale()}set ti(R){this.setScale(R)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=k.o.Zero(),this._localRotation=k.f.Zero(),this.Mg=k.o.Zero()),this.mj.decompose(this._localScaling,this._localRotation,this.Mg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,k.e.ComposeToRef(this._localScaling,this._localRotation,this.Mg,this.mj)):this._needToCompose=!1)}jj(R){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(R),x&&this._updateAbsoluteBindMatrices(),H?this._matrix=R:this._i()}_updateAbsoluteBindMatrices(R){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R||(R=this._bindMatrix),this.parent?R.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(R),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),x)for(let H=0;H<this.children.length;H++)this.children[H]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}_i(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this._i(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this._i(),this._needToDecompose=!0}_updatePosition(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=this.getLocalMatrix();if(0==x)c?(t.addAtIndex(12,R.x),t.addAtIndex(13,R.y),t.addAtIndex(14,R.z)):t.setTranslationFromFloats(R.x,R.y,R.z);else{let x=null;H&&(x=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=A._TmpMats[0],U=A._TmpVecs[0];this.parent?H&&x?(D.p(this.parent.getAbsoluteMatrix()),D.multiplyToRef(x,D)):D.p(this.parent.getAbsoluteMatrix()):k.e.IdentityToRef(D),c&&D.setTranslationFromFloats(0,0,0),D.invert(),k.o.TransformCoordinatesToRef(R,D,U),c?(t.addAtIndex(12,U.x),t.addAtIndex(13,U.y),t.addAtIndex(14,U.z)):t.setTranslationFromFloats(U.x,U.y,U.z)}this._markAsDirtyAndDecompose()}translate(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,x,H,!0)}setPosition(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,x,H,!1)}setAbsolutePosition(R,x){this.setPosition(R,1,x)}scale(R,x,H){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=this.getLocalMatrix(),D=A._TmpMats[0];k.e.ScalingToRef(R,x,H,D),D.multiplyToRef(t,t),D.invert();for(const k of this.children){const c=k.getLocalMatrix();c.multiplyToRef(D,c),c.multiplyAtIndex(12,R),c.multiplyAtIndex(13,x),c.multiplyAtIndex(14,H),k._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),c)for(const k of this.children)k.scale(R,x,H,c)}setScale(R){this._decompose(),this._localScaling.p(R),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(R){this._decompose(),R.p(this._localScaling)}setYawPitchRoll(R,x,H){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4?arguments[4]:void 0;if(0===c){const D=A._TmpQuat;return k.f.RotationYawPitchRollToRef(R,x,H,D),void this.setRotationQuaternion(D,c,t)}const D=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(D,t))return;const U=A._TmpMats[1];k.e.RotationYawPitchRollToRef(R,x,H,U),D.multiplyToRef(U,U),this._rotateWithMatrix(U,c,t)}rotate(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;const t=A._TmpMats[0];t.setTranslationFromFloats(0,0,0),k.e.RotationAxisToRef(R,x,t),this._rotateWithMatrix(t,H,c)}setAxisAngle(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;if(0===H){const t=A._TmpQuat;return k.f.RotationAxisToRef(R,x,t),void this.setRotationQuaternion(t,H,c)}const t=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,c))return;const D=A._TmpMats[1];k.e.RotationAxisToRef(R,x,D),t.multiplyToRef(D,D),this._rotateWithMatrix(D,H,c)}setRotation(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(R.y,R.x,R.z,x,H)}setRotationQuaternion(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===x)return this._decompose(),this._localRotation.p(R),void this._markAsDirtyAndCompose();const c=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,H))return;const t=A._TmpMats[1];k.e.FromQuaternionToRef(R,t),c.multiplyToRef(t,t),this._rotateWithMatrix(t,x,H)}setRotationMatrix(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===x){const c=A._TmpQuat;return k.f.FromRotationMatrixToRef(R,c),void this.setRotationQuaternion(c,x,H)}const c=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,H))return;const t=A._TmpMats[1];t.p(R),c.multiplyToRef(R,t),this._rotateWithMatrix(t,x,H)}_rotateWithMatrix(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const k=this.getLocalMatrix(),c=k.m[12],t=k.m[13],D=k.m[14],U=this.getParent(),J=A._TmpMats[3],V=A._TmpMats[4];U&&1==x?(H?(J.p(H.getWorldMatrix()),U.getAbsoluteMatrix().multiplyToRef(J,J)):J.p(U.getAbsoluteMatrix()),V.p(J),V.invert(),k.multiplyToRef(J,k),k.multiplyToRef(R,k),k.multiplyToRef(V,k)):1==x&&H?(J.p(H.getWorldMatrix()),V.p(J),V.invert(),k.multiplyToRef(J,k),k.multiplyToRef(R,k),k.multiplyToRef(V,k)):k.multiplyToRef(R,k),k.setTranslationFromFloats(c,t,D),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(R,x){const H=A._TmpMats[2];return R.p(this.getAbsoluteMatrix()),x?(R.multiplyToRef(x.getWorldMatrix(),R),k.e.ScalingToRef(x.ti.x,x.ti.y,x.ti.z,H)):k.e.IdentityToRef(H),R.invert(),!isNaN(R.m[0])&&(H.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyToRef(H,R),!0)}_e(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=k.o.Zero();return this.getPositionToRef(R,x,H),H}getPositionToRef(){let R=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const R=this.getLocalMatrix();x.x=R.m[12],x.y=R.m[13],x.z=R.m[14]}else{let H=null;R&&(H=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let k=A._TmpMats[0];R&&H?(k.p(this.getAbsoluteMatrix()),k.multiplyToRef(H,k)):k=this.getAbsoluteMatrix(),x.x=k.m[12],x.y=k.m[13],x.z=k.m[14]}}getAbsolutePosition(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=k.o.Zero();return this.getPositionToRef(1,R,x),x}getAbsolutePositionToRef(R,x){this.getPositionToRef(1,R,x)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.mj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.mj);const R=this._skeleton.getPoseMatrix();R&&this._absoluteMatrix.multiplyToRef(R,this._absoluteMatrix)}const R=this.children,x=R.length;for(let H=0;H<x;H++)R[H].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}aj(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=k.o.Zero();return this.getDirectionToRef(R,x,H),H}getDirectionToRef(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,c=null;x&&(c=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=A._TmpMats[0];t.p(this.getAbsoluteMatrix()),x&&c&&t.multiplyToRef(c,t),k.o.TransformNormalToRef(R,t,H),H.normalize()}getRotation(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=k.o.Zero();return this.getRotationToRef(R,x,H),H}getRotationToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;const k=A._TmpQuat;this.getRotationQuaternionToRef(R,x,k),k.toEulerAnglesToRef(H)}getRotationQuaternion(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=k.f.Identity();return this.getRotationQuaternionToRef(R,x,H),H}getRotationQuaternionToRef(){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),x.p(this._localRotation);else{const H=A._TmpMats[0],k=this.getAbsoluteMatrix();R?k.multiplyToRef(R.getWorldMatrix(),H):H.p(k),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.decompose(void 0,x,void 0)}}getRotationMatrix(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1?arguments[1]:void 0;const H=k.e.Identity();return this.getRotationMatrixToRef(R,x,H),H}getRotationMatrixToRef(){let R=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(x);else{const H=A._TmpMats[0],k=this.getAbsoluteMatrix();R?k.multiplyToRef(R.getWorldMatrix(),H):H.p(k),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.getRotationMatrixToRef(x)}}getAbsolutePositionFromLocal(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=k.o.Zero();return this.getAbsolutePositionFromLocalToRef(R,x,H),H}getAbsolutePositionFromLocalToRef(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,c=null;x&&(c=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=A._TmpMats[0];t.p(this.getAbsoluteMatrix()),x&&c&&t.multiplyToRef(c,t),k.o.TransformCoordinatesToRef(R,t,H)}getLocalPositionFromAbsolute(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=k.o.Zero();return this.getLocalPositionFromAbsoluteToRef(R,x,H),H}getLocalPositionFromAbsoluteToRef(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,c=null;x&&(c=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=A._TmpMats[0];t.p(this.getAbsoluteMatrix()),x&&c&&t.multiplyToRef(c,t),t.invert(),k.o.TransformCoordinatesToRef(R,t,H)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const R=this._skeleton.bones.indexOf(this);if(-1!==R&&this._skeleton.bones.splice(R,1),this._parentNode&&this._parentNode.children){const R=this._parentNode.children,x=R.indexOf(this);-1!==x&&R.splice(x,1)}super.dispose()}}A._TmpVecs=(0,c.d)(2,k.o.Zero),A._TmpQuat=k.f.Identity(),A._TmpMats=(0,c.d)(5,k.e.Identity)},13516:(R,x,H)=>{"use strict";H.d(x,{c:()=>w});var k=H(643),c=H(647),t=H(476),A=H(661),D=H(681),U=H(683),J=H(471),V=H(2464),n=H(500),g=H(668);class I{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(R){this._idleRotationSpeed=R}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(R){this._idleRotationWaitTime=R}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(R){this._idleRotationSpinupTime=R}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(R){this._attachedCamera=R;const x=this._attachedCamera.va();this._onPrePointerObservableObserver=x.onPrePointerObservable.add((R=>{R.type!==V.e.POINTERDOWN?R.type===V.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const R=n.c.Now;let x=0;null!=this._lastFrameTime&&(x=R-this._lastFrameTime),this._lastFrameTime=R,this._applyUserInteraction();const H=R-this._lastInteractionTime-this._idleRotationWaitTime,k=Math.max(Math.min(H/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*k,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(x/1e3))}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.va();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(R){this._lastInteractionTime=R??n.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<g.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let R=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(R=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?R:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=n.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var i=H(13518),q=H(12331);class S{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(R){if(this._autoTransitionRange===R)return;this._autoTransitionRange=R;const x=this._attachedCamera;x&&(R?this._onMeshTargetChangedObserver=x.onMeshTargetChangedObservable.add((R=>{if(R&&(R.Fi(!0),R.getBoundingInfo)){const x=R.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*x,this.upperRadiusTransitionRange=.05*x}})):this._onMeshTargetChangedObserver&&x.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(R){this._attachedCamera=R,this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(R){return!!this._attachedCamera&&(this._attachedCamera.radius===R&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(R){if(!this._attachedCamera)return;this._radiusBounceTransition||(S.EasingFunction.setEasingMode(S.EasingMode),this._radiusBounceTransition=q.c.CreateAnimation("radius",q.c.ANIMATIONTYPE_FLOAT,60,S.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const x=q.c.TransitionTo("radius",this._attachedCamera.radius+R,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));x&&this._animatables.push(x)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}S.EasingFunction=new i.d(.3),S.EasingMode=i.i.EASINGMODE_EASEOUT;class L{constructor(){this.onTargetFramingAnimationEndObservable=new t.d,this._mode=L.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(R){this._mode=R}get mode(){return this._mode}set radiusScale(R){this._radiusScale=R}get radiusScale(){return this._radiusScale}set positionScale(R){this._positionScale=R}get positionScale(){return this._positionScale}set defaultElevation(R){this._defaultElevation=R}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(R){this._elevationReturnTime=R}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(R){this._elevationReturnWaitTime=R}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(R){this._framingTime=R}get framingTime(){return this._framingTime}init(){}attach(R){this._attachedCamera=R;const x=this._attachedCamera.va();L.EasingFunction.setEasingMode(L.EasingMode),this._onPrePointerObservableObserver=x.onPrePointerObservable.add((R=>{R.type!==V.e.POINTERDOWN?R.type===V.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=R.onMeshTargetChangedObservable.add((R=>{R&&R.getBoundingInfo&&this.zoomOnMesh(R,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.va();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.Fi(!0);const k=R.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(k.minimumWorld,k.maximumWorld,x,H)}zoomOnMeshHierarchy(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.Fi(!0);const k=R.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(k.min,k.max,x,H)}zoomOnMeshesHierarchy(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new A.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new A.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let t=0;t<R.length;t++){const x=R[t].getHierarchyBoundingVectors(!0);A.o.CheckExtends(x.min,k,c),A.o.CheckExtends(x.max,k,c)}this.zoomOnBoundingInfo(k,c,x,H)}zoomOnBoundingInfo(R,x){let H,k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const t=R.y,D=t+(x.y-t)*this._positionScale,U=x.Pg(R).scale(.5);if(!isFinite(D))return!1;if(k)H=new A.o(0,D,0);else{const x=R.add(U);H=new A.o(x.x,D,x.z)}this._vectorTransition||(this._vectorTransition=q.c.CreateAnimation("target",q.c.ANIMATIONTYPE_VECTOR3,60,L.EasingFunction)),this._betaIsAnimating=!0;let J=q.c.TransitionTo("target",H,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);J&&this._animatables.push(J);let V=0;if(this._mode===L.FitFrustumSidesMode){const H=this._calculateLowerRadiusFromModelBoundingSphere(R,x);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=U.length()+this._attachedCamera.Hi),V=H}else this._mode===L.IgnoreBoundsSizeMode&&(V=this._calculateLowerRadiusFromModelBoundingSphere(R,x),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Hi));if(this.autoCorrectCameraLimitsAndSensibility){const H=x.Pg(R).length();this._attachedCamera.panningSensibility=5e3/H,this._attachedCamera.wheelPrecision=100/V}return this._radiusTransition||(this._radiusTransition=q.c.CreateAnimation("radius",q.c.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),J=q.c.TransitionTo("radius",V,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),c&&c(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),J&&this._animatables.push(J),!0}_calculateLowerRadiusFromModelBoundingSphere(R,x){const H=this._attachedCamera;if(!H)return 0;let k=H._calculateLowerRadiusFromModelBoundingSphere(R,x,this._radiusScale);return H.lowerRadiusLimit&&this._mode===L.IgnoreBoundsSizeMode&&(k=k<H.lowerRadiusLimit?H.lowerRadiusLimit:k),H.upperRadiusLimit&&(k=k>H.upperRadiusLimit?H.upperRadiusLimit:k),k}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const R=n.c.Now-this._lastInteractionTime,x=.5*Math.PI-this._defaultElevation,H=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>H&&R>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=q.c.CreateAnimation("beta",q.c.ANIMATIONTYPE_FLOAT,60,L.EasingFunction));const R=q.c.TransitionTo("beta",x,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));R&&this._animatables.push(R)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=n.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}L.EasingFunction=new i.n,L.EasingMode=i.i.EASINGMODE_EASEINOUT,L.IgnoreBoundsSizeMode=0,L.FitFrustumSidesMode=1;var b=H(637),C=H(12255),F=H(13187),d=H(485);class P{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(R){R=d.e.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),H=x.getInputElement();let k=0,c=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=t=>{var A,D;const U=t.event,J="touch"===U.pointerType;if(t.type!==V.e.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const n=U.target;if(this._altKey=U.altKey,this._ctrlKey=U.ctrlKey,this._metaKey=U.metaKey,this._shiftKey=U.shiftKey,this._buttonsPressed=U.buttons,x.isPointerLock){const R=U.movementX,x=U.movementY;this.onTouch(null,R,x),this._pointA=null,this._pointB=null}else{if(t.type!==V.e.POINTERDOWN&&t.type!==V.e.POINTERDOUBLETAP&&J&&(null===(A=this._pointA)||void 0===A?void 0:A.pointerId)!==U.pointerId&&(null===(D=this._pointB)||void 0===D?void 0:D.pointerId)!==U.pointerId)return;if(t.type!==V.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!J)if(t.type===V.e.POINTERDOUBLETAP)this.onDoubleTap(U.pointerType);else if(t.type!==V.e.POINTERUP||this._currentMousePointerIdDown!==U.pointerId&&!J){if(t.type===V.e.POINTERMOVE)if(R||U.preventDefault(),this._pointA&&null===this._pointB){const R=U.clientX-this._pointA.x,x=U.clientY-this._pointA.y;this._pointA.x=U.clientX,this._pointA.y=U.clientY,this.onTouch(this._pointA,R,x)}else if(this._pointA&&this._pointB){const R=this._pointA.pointerId===U.pointerId?this._pointA:this._pointB;R.x=U.clientX,R.y=U.clientY;const x=this._pointA.x-this._pointB.x,H=this._pointA.y-this._pointB.y,A=x*x+H*H,D={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:U.pointerId,type:t.type};this.onMultiTouch(this._pointA,this._pointB,k,A,c,D),c=D,k=A}}else{try{null===n||void 0===n||n.releasePointerCapture(U.pointerId)}catch(g){}J||(this._pointB=null),x._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==U.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==U.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==k||c)&&(this.onMultiTouch(this._pointA,this._pointB,k,0,c,null),k=0,c=null),this._currentMousePointerIdDown=-1,this.onButtonUp(U),R||U.preventDefault()}else{try{null===n||void 0===n||n.setPointerCapture(U.pointerId)}catch(g){}if(null===this._pointA)this._pointA={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType};else{if(null!==this._pointB)return;this._pointB={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType}}-1!==this._currentMousePointerIdDown||J||(this._currentMousePointerIdDown=U.pointerId),this.onButtonDown(U),R||(U.preventDefault(),H&&H.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,V.e.POINTERDOWN|V.e.POINTERUP|V.e.POINTERMOVE|V.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,k=0,c=null,this.onLostFocus()},this._contextMenuBind=R=>this.onContextMenu(R),H&&H.addEventListener("contextmenu",this._contextMenuBind,!1);const t=this.camera.va().getEngine().getHostWindow();t&&d.e.RegisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}Zi(){if(this._onLostFocus){const R=this.camera.va().getEngine().getHostWindow();R&&d.e.UnregisterTopRootEvents(R,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const R=this.camera.va().getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(R){}onTouch(R,x,H){}onMultiTouch(R,x,H,k,c,t){}onContextMenu(R){R.preventDefault()}onButtonDown(R){}onButtonUp(R){}onLostFocus(){}}(0,k.d)([(0,c.Q)()],P.prototype,"buttons",void 0);class a extends P{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(R,x){if(0!==this.panningSensibility&&R&&x){const H=x.x-R.x,k=x.y-R.y;this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=k/this.panningSensibility}}_computePinchZoom(R,x){const H=this.camera.radius||a.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=H*Math.sqrt(R)/Math.sqrt(x):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(x-R)*H*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(x-R)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(R,x,H){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-x/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility):(this.camera.inertialAlphaOffset-=x/this.angularSensibilityX,this.camera.inertialBetaOffset-=H/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(R,x,H,k,c,t){0===H&&null===c||0===k&&null===t||(this.multiTouchPanAndZoom?(this._computePinchZoom(H,k),this._computeMultiTouchPanning(c,t)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(k)-Math.sqrt(H))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(H,k),this._isPinching=!0):this._computeMultiTouchPanning(c,t)):this.multiTouchPanning?this._computeMultiTouchPanning(c,t):this.pinchZoom&&this._computePinchZoom(H,k))}onButtonDown(R){this._isPanClick=R.button===this.camera._panningMouseButton}onButtonUp(R){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}a.MinimumRadiusForPinch=.001,(0,k.d)([(0,c.Q)()],a.prototype,"buttons",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"angularSensibilityX",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"angularSensibilityY",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"pinchPrecision",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"pinchDeltaPercentage",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"useNaturalPinchZoom",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"pinchZoom",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"panningSensibility",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"multiTouchPanning",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"multiTouchPanAndZoom",void 0),F.b.ArcRotateCameraPointersInput=a;var X=H(2468);class M{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(R){R=d.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const H=x.event;if(!H.metaKey)if(x.type===X.e.KEYDOWN){if(this._ctrlPressed=H.ctrlKey,this._altPressed=H.altKey,-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),H.preventDefault&&(R||H.preventDefault())}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){const x=this._keys.indexOf(H.keyCode);x>=0&&this._keys.splice(x,1),H.preventDefault&&(R||H.preventDefault())}})))}Zi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let x=0;x<this._keys.length;x++){const H=this._keys[x];-1!==this.keysLeft.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX-=1/this.panningSensibility:R.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset+=1/this.zoomingSensibility:R.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX+=1/this.panningSensibility:R.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset-=1/this.zoomingSensibility:R.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(H)&&R.useInputToRestoreState&&R.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,k.d)([(0,c.Q)()],M.prototype,"keysUp",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"keysDown",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"keysLeft",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"keysRight",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"keysReset",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"panningSensibility",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"zoomingSensibility",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"useAltToZoom",void 0),(0,k.d)([(0,c.Q)()],M.prototype,"angularSpeed",void 0),F.b.ArcRotateCameraKeyboardMoveInput=M;var B=H(717),o=H(2477);class Z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new A.o(0,0,0),this._globalOffset=new A.o(0,0,0),this._inertialPanning=A.o.Zero()}_computeDeltaFromMouseWheelLegacyEvent(R,x){let H=0;const k=.01*R*this.wheelDeltaPercentage*x;return H=R>0?k/(1+this.wheelDeltaPercentage):k*(1+this.wheelDeltaPercentage),H}attachControl(R){R=d.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==V.e.POINTERWHEEL)return;const H=x.event;let k=0;const c=H.deltaMode===o.b.DOM_DELTA_LINE?40:1,t=-H.deltaY*c;if(this.customComputeDeltaFromMouseWheel)k=this.customComputeDeltaFromMouseWheel(t,this,H);else if(this.wheelDeltaPercentage){if(k=this._computeDeltaFromMouseWheelLegacyEvent(t,this.camera.radius),k>0){let R=this.camera.radius,x=this.camera.inertialRadiusOffset+k;for(let H=0;H<20&&!(R<=x)&&!(Math.abs(x*this.camera.inertia)<.001);H++)R-=x,x*=this.camera.inertia;R=(0,D.Clamp)(R,0,Number.MAX_VALUE),k=this._computeDeltaFromMouseWheelLegacyEvent(t,R)}}else k=t/(40*this.wheelPrecision);k&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(k)):this.camera.inertialRadiusOffset+=k),H.preventDefault&&(R||H.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,V.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Ai(0)}Zi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const R=this.camera;0+R.inertialAlphaOffset+R.inertialBetaOffset+R.inertialRadiusOffset&&(this._updateHitPlane(),R.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(R.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const R=this.camera,x=R.target.Pg(R.position);this._hitPlane=B.e.FromPositionAndNormal(R.target,x)}_getPosition(){const R=this.camera,x=R.va(),H=x.createPickingRay(x.pointerX,x.pointerY,A.e.Identity(),R,!1);0===R.targetScreenOffset.x&&0===R.targetScreenOffset.y||(this._viewOffset.set(R.targetScreenOffset.x,R.targetScreenOffset.y,0),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),this._globalOffset=A.o.TransformNormal(this._viewOffset,R._cameraTransformMatrix),H.origin.addInPlace(this._globalOffset));let k=0;return this._hitPlane&&(k=H.intersectsPlane(this._hitPlane)??0),H.origin.addInPlace(H.direction.scaleInPlace(k))}_zoomToMouse(R){const x=this.camera,H=1-x.inertia;if(x.lowerRadiusLimit){const k=x.lowerRadiusLimit??0;x.radius-(x.inertialRadiusOffset+R)/H<k&&(R=(x.radius-k)*H-x.inertialRadiusOffset)}if(x.upperRadiusLimit){const k=x.upperRadiusLimit??0;x.radius-(x.inertialRadiusOffset+R)/H>k&&(R=(x.radius-k)*H-x.inertialRadiusOffset)}const k=R/H/x.radius,c=this._getPosition(),t=A.g.Bi[6];c.subtractToRef(x.target,t),t.scaleInPlace(k),t.scaleInPlace(H),this._inertialPanning.addInPlace(t),x.inertialRadiusOffset+=R}_zeroIfClose(R){Math.abs(R.x)<g.e&&(R.x=0),Math.abs(R.y)<g.e&&(R.y=0),Math.abs(R.z)<g.e&&(R.z=0)}}(0,k.d)([(0,c.Q)()],Z.prototype,"wheelPrecision",void 0),(0,k.d)([(0,c.Q)()],Z.prototype,"zoomToMouseLocation",void 0),(0,k.d)([(0,c.Q)()],Z.prototype,"wheelDeltaPercentage",void 0),F.b.ArcRotateCameraMouseWheelInput=Z;class y extends F.e{constructor(R){super(R)}addMouseWheel(){return this.add(new Z),this}addPointers(){return this.add(new a),this}addKeyboard(){return this.add(new M),this}}var s=H(610);function E(R,x){return isNaN(R)?x:R}U.e.AddNodeConstructor("ArcRotateCamera",((R,x)=>()=>new w(R,0,0,1,A.o.Zero(),x)));class w extends C.b{get target(){return this._target}set target(R){this.setTarget(R)}get targetHost(){return this._targetHost}set targetHost(R){R&&this.setTarget(R)}getTarget(){return this.target}get position(){return this._position}set position(R){this.setPosition(R)}set upVector(R){this._upToYMatrix||(this._yToUpMatrix=new A.e,this._upToYMatrix=new A.e,this._upVector=A.o.Zero()),R.normalize(),this._upVector.p(R),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){A.e.RotationAlignToRef(A.o.UpReadOnly,this._upVector,this._yToUpMatrix),A.e.RotationAlignToRef(this._upVector,A.o.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityX:0}set angularSensibilityX(R){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityX=R)}get angularSensibilityY(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityY:0}set angularSensibilityY(R){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityY=R)}get pinchPrecision(){const R=this.inputs.attached.pointers;return R?R.pinchPrecision:0}set pinchPrecision(R){const x=this.inputs.attached.pointers;x&&(x.pinchPrecision=R)}get pinchDeltaPercentage(){const R=this.inputs.attached.pointers;return R?R.pinchDeltaPercentage:0}set pinchDeltaPercentage(R){const x=this.inputs.attached.pointers;x&&(x.pinchDeltaPercentage=R)}get useNaturalPinchZoom(){const R=this.inputs.attached.pointers;return!!R&&R.useNaturalPinchZoom}set useNaturalPinchZoom(R){const x=this.inputs.attached.pointers;x&&(x.useNaturalPinchZoom=R)}get panningSensibility(){const R=this.inputs.attached.pointers;return R?R.panningSensibility:0}set panningSensibility(R){const x=this.inputs.attached.pointers;x&&(x.panningSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const x=this.inputs.attached.keyboard;x&&(x.keysUp=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const x=this.inputs.attached.keyboard;x&&(x.keysDown=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const x=this.inputs.attached.keyboard;x&&(x.keysRight=R)}get wheelPrecision(){const R=this.inputs.attached.mousewheel;return R?R.wheelPrecision:0}set wheelPrecision(R){const x=this.inputs.attached.mousewheel;x&&(x.wheelPrecision=R)}get zoomToMouseLocation(){const R=this.inputs.attached.mousewheel;return!!R&&R.zoomToMouseLocation}set zoomToMouseLocation(R){const x=this.inputs.attached.mousewheel;x&&(x.zoomToMouseLocation=R)}get wheelDeltaPercentage(){const R=this.inputs.attached.mousewheel;return R?R.wheelDeltaPercentage:0}set wheelDeltaPercentage(R){const x=this.inputs.attached.mousewheel;x&&(x.wheelDeltaPercentage=R)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(R){R!==this.useBouncingBehavior&&(R?(this._bouncingBehavior=new S,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(R){R!==this.useFramingBehavior&&(R?(this._framingBehavior=new L,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(R){R!==this.useAutoRotationBehavior&&(R?(this._autoRotationBehavior=new I,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(R,x,H,k,c,D){var U;let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(R,A.o.Zero(),D,J),U=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=A.o.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=A.k.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new A.e,this.panningAxis=new A.o(1,1,0),this._transformedDirection=new A.o,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new t.d,this.checkCollisions=!1,this.collisionRadius=new A.o(.5,.5,.5),this._previousPosition=A.o.Zero(),this._collisionVelocity=A.o.Zero(),this._newPosition=A.o.Zero(),this._computationVector=A.o.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new A.o(NaN,NaN,NaN),this._goalTargetScreenOffset=new A.k(NaN,NaN),this._onCollisionPositionChange=function(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H?(U.setPosition(x),U.di&&U.di(H)):U._previousPosition.p(U._position);const k=Math.cos(U.alpha),c=Math.sin(U.alpha),t=Math.cos(U.beta);let A=Math.sin(U.beta);0===A&&(A=1e-4);const D=U._getTargetPosition();U._computationVector.si(U.radius*k*A,U.radius*t,U.radius*c*A),D.addToRef(U._computationVector,U._newPosition),U._position.p(U._newPosition);let J=U.upVector;U.allowUpsideDown&&U.beta<0&&(J=J.clone(),J=J.negate()),U._computeViewMatrix(U._position,D,J),U._viewMatrix.addAtIndex(12,U.targetScreenOffset.x),U._viewMatrix.addAtIndex(13,U.targetScreenOffset.y),U._collisionTriggered=!1},this._target=A.o.Zero(),c&&this.setTarget(c),this.alpha=x,this.beta=H,this.radius=k,this.getViewMatrix(),this.inputs=new y(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new A.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=A.k.Zero()}_updateCache(R){R||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const R=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?R.addToRef(this._targetBoundingCenter,this._target):this._target.p(R)}const R=this._getLockedTargetPosition();return R||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>g.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,t=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=t?this._currentInterpolationFactor=t:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=E(R,this._goalAlpha),this._goalBeta=E(x,this._goalBeta),this._goalRadius=E(H,this._goalRadius),this._goalTarget.set(E(k.x,this._goalTarget.x),E(k.y,this._goalTarget.y),E(k.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(E(c.x,this._goalTargetScreenOffset.x),E(c.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,D.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,D.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,D.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,D.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(R,x){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const c=arguments;x=d.e.BackCompatCameraNoPreventDefault(c),this._useCtrlForPanning=H,this._panningMouseButton=k,"boolean"===typeof c[0]&&(c.length>1&&(this._useCtrlForPanning=c[1]),c.length>2&&(this._panningMouseButton=c[2])),this.inputs.attachElement(x),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Zi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let R=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){R=!0;const x=this.invertRotation?-1:1,H=this._calculateHandednessMultiplier();let k=this.inertialAlphaOffset*H;this.beta<0&&(k*=-1),this.alpha+=k*x,this.beta+=this.inertialBetaOffset*x,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<g.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<g.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*g.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){R=!0;const x=new A.o(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),x.multiplyInPlace(this.panningAxis),A.o.TransformNormalToRef(x,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const R=this.upVector,x=A.o.CrossToRef(this._transformedDirection,R,this._transformedDirection);A.o.CrossToRef(R,x,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);A.o.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const R=A.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.transposeToRef(R),A.o.TransformCoordinatesToRef(this._transformedDirection,R,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*g.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*g.e&&(this.inertialPanningY=0)}if(R)this.stopInterpolation();else if(this._isInterpolating){let R=!1;const x=this._scene.getEngine().getDeltaTime()/1e3,H=1-Math.pow(2,-x/this._currentInterpolationFactor),k=E(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const x=A.g.Bi[0].set(E(this._goalTarget.x,this._target.x),E(this._goalTarget.y,this._target.y),E(this._goalTarget.z,this._target.z));A.o.LerpToRef(this.target,x,H,this._target),10*A.o.Distance(this.target,x)/k<g.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(x),this.setTarget(this.target,!1,!0,!0)):R=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const x=A.f.RotationAlphaBetaGammaToRef(E(this._goalAlpha,this.alpha),E(this._goalBeta,this.beta),0,A.g.Quaternion[0]),k=A.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,A.g.Quaternion[1]),c=A.f.SlerpToRef(k,x,H,A.g.Quaternion[2]);c.normalize();const t=c.toAlphaBetaGammaToRef(A.g.Bi[0]);if(this.alpha=t.x,this.beta=t.y,c.isApprox(x,g.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const R=x.toAlphaBetaGammaToRef(A.g.Bi[0]);this.alpha=R.x,this.beta=R.y}else R=!0}if(isNaN(this._goalRadius)||(this.radius+=(k-this.radius)*H,Math.abs(k/this.radius-1)<g.e?(this._goalRadius=NaN,this.radius=k):R=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const x=A.g.Vector2[0].set(E(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),E(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));A.k.LerpToRef(this.targetScreenOffset,x,H,this.targetScreenOffset),A.k.Distance(this.targetScreenOffset,x)<g.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(x)):R=!0}this._isInterpolating=R}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.o.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const R=this.alpha;var x,H;this.alpha=function(R){let x=Math.PI/2;return 0===R.x&&0===R.z||(x=Math.acos(R.x/Math.sqrt(Math.pow(R.x,2)+Math.pow(R.z,2)))),R.z<0&&(x=2*Math.PI-x),x}(this._computationVector),this.beta=(x=this._computationVector.y,H=this.radius,Math.acos(x/H));const k=Math.round((R-this.alpha)/(2*Math.PI));this.alpha+=2*k*Math.PI,this._checkLimits()}setPosition(R){this._position.equals(R)||(this._position.p(R),this.rebuildAnglesAndRadius())}setTarget(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(k=this.overrideCloneAlphaBetaRadius??k,R.Fi)x&&R.getBoundingInfo?this._targetBoundingCenter=R.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,R.Fi(),this._targetHost=R,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const x=R,k=this._getTargetPosition();if(k&&!H&&k.equals(x))return;this._targetHost=null,this._target=x,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}k||this.rebuildAnglesAndRadius()}_getViewMatrix(){const R=Math.cos(this.alpha),x=Math.sin(this.alpha),H=Math.cos(this.beta);let k=Math.sin(this.beta);0===k&&(k=1e-4),0===this.radius&&(this.radius=1e-4);const c=this._getTargetPosition();if(this._computationVector.si(this.radius*R*k,this.radius*H,this.radius*x*k),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.o.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),c.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const R=this.va().collisionCoordinator;this._collider||(this._collider=R.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,R.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let R=this.upVector;this.allowUpsideDown&&k<0&&(R=R.negate()),this._computeViewMatrix(this._position,c,R),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(c),this._viewMatrix}zoomOn(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R=R||this.va().meshes;const H=J.d.MinMax(R);let k=this._calculateLowerRadiusFromModelBoundingSphere(H.min,H.max);if(k=Math.max(Math.min(k,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=k*this.zoomOnFactor,this.mode===b.b.ORTHOGRAPHIC_CAMERA){const R=this.va().getEngine().getAspectRatio(this),x=k*this.zoomOnFactor/2;this.orthoLeft=-x*R,this.orthoRight=x*R,this.orthoBottom=-x,this.orthoTop=x}this.focusOn({min:H.min,max:H.max,distance:k},x)}focusOn(R){let x,H,k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===R.min){const k=R||this.va().meshes;x=J.d.MinMax(k),H=A.o.Distance(x.min,x.max)}else{x=R,H=R.distance}this._target=J.d.Center(x),k||(this.maxZ=2*H)}createRigCamera(R,x){let H=0;switch(this.cameraRigMode){case b.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case b.b.RIG_MODE_VR:H=this._cameraRigParams.stereoHalfAngle*(0===x?1:-1);break;case b.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H=this._cameraRigParams.stereoHalfAngle*(0===x?-1:1)}const k=new w(R,this.alpha+H,this.beta,this.radius,this._target,this.va());return k._cameraRigParams={},k.isRigCamera=!0,k.rigParent=this,k.upVector=this.upVector,k.mode=this.mode,k.orthoLeft=this.orthoLeft,k.orthoRight=this.orthoRight,k.orthoBottom=this.orthoBottom,k.orthoTop=this.orthoTop,k}_updateRigCameras(){const R=this._rigCameras[0],x=this._rigCameras[1];switch(R.beta=x.beta=this.beta,this.cameraRigMode){case b.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case b.b.RIG_MODE_VR:R.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case b.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:R.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const k=A.o.Distance(R,x),c=this.va().getEngine().getAspectRatio(this),t=Math.tan(this.fov/2),D=t*c,U=.5*k*H,J=U*Math.sqrt(1+1/(D*D)),V=U*Math.sqrt(1+1/(t*t));return Math.max(J,V)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,k.d)([(0,c.Q)()],w.prototype,"alpha",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"beta",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"radius",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,k.d)([(0,c.N)("target")],w.prototype,"_target",void 0),(0,k.d)([(0,c.B)("targetHost")],w.prototype,"_targetHost",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"inertialAlphaOffset",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"inertialBetaOffset",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"inertialRadiusOffset",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"lowerAlphaLimit",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"upperAlphaLimit",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"lowerBetaLimit",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"upperBetaLimit",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"lowerRadiusLimit",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"upperRadiusLimit",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"lowerTargetYLimit",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"inertialPanningX",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"inertialPanningY",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"pinchToPanMaxDistance",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"panningDistanceLimit",void 0),(0,k.d)([(0,c.N)()],w.prototype,"panningOriginTarget",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"panningInertia",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"zoomToMouseLocation",null),(0,k.d)([(0,c.Q)()],w.prototype,"zoomOnFactor",void 0),(0,k.d)([(0,c.J)()],w.prototype,"targetScreenOffset",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"allowUpsideDown",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"useInputToRestoreState",void 0),(0,k.d)([(0,c.Q)()],w.prototype,"restoreStateInterpolationFactor",void 0),(0,s.h)("BABYLON.ArcRotateCamera",w)},13187:(R,x,H)=>{"use strict";H.d(x,{b:()=>A,e:()=>D});var k=H(493),c=H(687),t=H(637),A={};class D{constructor(R){this.attachedToElement=!1,this.attached={},this.camera=R,this.checkInputs=()=>{}}add(R){const x=R.getSimpleName();this.attached[x]?k.c.Warn("camera input of type "+x+" already exists on camera"):(this.attached[x]=R,R.camera=this.camera,R.checkInputs&&(this.checkInputs=this._addCheckInputs(R.checkInputs.bind(R))),this.attachedToElement&&R.attachControl(this.noPreventDefault))}remove(R){for(const x in this.attached){const H=this.attached[x];if(H===R)return H.Zi(),H.camera=null,delete this.attached[x],void this.rebuildInputCheck()}}removeByType(R){for(const x in this.attached){const H=this.attached[x];H.getClassName()===R&&(H.Zi(),H.camera=null,delete this.attached[x],this.rebuildInputCheck())}}_addCheckInputs(R){const x=this.checkInputs;return()=>{x(),R()}}attachInput(R){this.attachedToElement&&R.attachControl(this.noPreventDefault)}attachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){R=!t.b.ForceAttachControlToAlwaysPreventDefault&&R,this.attachedToElement=!0,this.noPreventDefault=R;for(const x in this.attached)this.attached[x].attachControl(R)}}detachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const x in this.attached)this.attached[x].Zi(),R&&(this.attached[x].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const R in this.attached){const x=this.attached[R];x.checkInputs&&(this.checkInputs=this._addCheckInputs(x.checkInputs.bind(x)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(R){const x={};for(const H in this.attached){const R=this.attached[H],k=c.d.Serialize(R);x[R.getClassName()]=k}R.inputsmgr=x}parse(R){const x=R.inputsmgr;if(x){this.clear();for(const R in x){const H=A[R];if(H){const k=x[R],t=c.d.Parse((()=>new H),k,null);this.add(t)}}}else for(const H in this.attached){const x=A[this.attached[H].getClassName()];if(x){const k=c.d.Parse((()=>new x),R,null);this.remove(this.attached[H]),this.add(k)}}}}},13183:(R,x,H)=>{"use strict";H.d(x,{c:()=>P});var k=H(643),c=H(647),t=H(661),A=H(12255),D=H(13187),U=H(2468),J=H(485);class V{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(R){R=J.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const H=x.event;if(!H.metaKey)if(x.type===U.e.KEYDOWN){if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),R||H.preventDefault()}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){const x=this._keys.indexOf(H.keyCode);x>=0&&this._keys.splice(x,1),R||H.preventDefault()}})))}Zi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let x=0;x<this._keys.length;x++){const H=this._keys[x],k=R._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(H)?R._localDirection.si(-k,0,0):-1!==this.keysUp.indexOf(H)?R._localDirection.si(0,0,k):-1!==this.keysRight.indexOf(H)?R._localDirection.si(k,0,0):-1!==this.keysDown.indexOf(H)?R._localDirection.si(0,0,-k):-1!==this.keysUpward.indexOf(H)?R._localDirection.si(0,k,0):-1!==this.keysDownward.indexOf(H)?R._localDirection.si(0,-k,0):-1!==this.keysRotateLeft.indexOf(H)?(R._localDirection.si(0,0,0),R.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(H)?(R._localDirection.si(0,0,0),R.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(H)?(R._localDirection.si(0,0,0),R.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(H)&&(R._localDirection.si(0,0,0),R.cameraRotation.x+=this._getLocalRotation()),R.va().useRightHandedSystem&&(R._localDirection.z*=-1),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),t.o.TransformNormalToRef(R._localDirection,R._cameraTransformMatrix,R._transformedDirection),R.cameraDirection.addInPlace(R._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const R=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*R}}(0,k.d)([(0,c.Q)()],V.prototype,"keysUp",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysUpward",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysDown",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysDownward",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysLeft",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysRight",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"rotationSpeed",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysRotateLeft",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysRotateRight",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysRotateUp",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"keysRotateDown",void 0),D.b.FreeCameraKeyboardMoveInput=V;var n=H(476),g=H(2464);class I{constructor(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=R,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new n.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(R){R=J.e.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),H=x.getInputElement();this._pointerInput||(this._pointerInput=k=>{const c=k.event,t="touch"===c.pointerType;if(!this.touchEnabled&&t)return;if(k.type!==g.e.POINTERMOVE&&-1===this.buttons.indexOf(c.button))return;const A=c.target;if(k.type===g.e.POINTERDOWN){if(t&&-1!==this._activePointerId||!t&&-1!==this._currentActiveButton)return;this._activePointerId=c.pointerId;try{null===A||void 0===A||A.setPointerCapture(c.pointerId)}catch(D){}-1===this._currentActiveButton&&(this._currentActiveButton=c.button),this._previousPosition={x:c.clientX,y:c.clientY},R||(c.preventDefault(),H&&H.focus()),x.isPointerLock&&this._onMouseMove&&this._onMouseMove(k.event)}else if(k.type===g.e.POINTERUP){if(t&&this._activePointerId!==c.pointerId||!t&&this._currentActiveButton!==c.button)return;try{null===A||void 0===A||A.releasePointerCapture(c.pointerId)}catch(D){}this._currentActiveButton=-1,this._previousPosition=null,R||c.preventDefault(),this._activePointerId=-1}else if(k.type===g.e.POINTERMOVE&&(this._activePointerId===c.pointerId||!t))if(x.isPointerLock&&this._onMouseMove)this._onMouseMove(k.event);else if(this._previousPosition){const x=this.camera._calculateHandednessMultiplier(),H=(c.clientX-this._previousPosition.x)*x,k=c.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=H/this.angularSensibility,this.camera.cameraRotation.x+=k/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:H,offsetY:k}),this._previousPosition={x:c.clientX,y:c.clientY},R||c.preventDefault()}}),this._onMouseMove=H=>{if(!x.isPointerLock)return;const k=this.camera._calculateHandednessMultiplier(),c=H.movementX*k;this.camera.cameraRotation.y+=c/this.angularSensibility;const t=H.movementY;this.camera.cameraRotation.x+=t/this.angularSensibility,this._previousPosition=null,R||H.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.e.POINTERDOWN|g.e.POINTERUP|g.e.POINTERMOVE),H&&(this._contextMenuBind=R=>this.onContextMenu(R),H.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(R){R.preventDefault()}Zi(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,k.d)([(0,c.Q)()],I.prototype,"buttons",void 0),(0,k.d)([(0,c.Q)()],I.prototype,"angularSensibility",void 0),D.b.FreeCameraMouseInput=I;var i,q=H(2477);class S{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new n.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(R){R=J.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==g.e.POINTERWHEEL)return;const H=x.event,k=H.deltaMode===q.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*k*H.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*k*H.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*k*H.deltaZ/this._normalize,H.preventDefault&&(R||H.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,g.e.POINTERWHEEL)}Zi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,k.d)([(0,c.Q)()],S.prototype,"wheelPrecisionX",void 0),(0,k.d)([(0,c.Q)()],S.prototype,"wheelPrecisionY",void 0),(0,k.d)([(0,c.Q)()],S.prototype,"wheelPrecisionZ",void 0),function(R){R[R.MoveRelative=0]="MoveRelative",R[R.RotateRelative=1]="RotateRelative",R[R.MoveScene=2]="MoveScene"}(i||(i={}));class L extends S{constructor(){super(...arguments),this._moveRelative=t.o.Zero(),this._rotateRelative=t.o.Zero(),this._moveScene=t.o.Zero(),this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(R){null===R&&this._wheelXAction!==i.MoveRelative||(this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=R)}get wheelXMoveRelative(){return this._wheelXAction!==i.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(R){null===R&&this._wheelYAction!==i.MoveRelative||(this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=R)}get wheelYMoveRelative(){return this._wheelYAction!==i.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(R){null===R&&this._wheelZAction!==i.MoveRelative||(this._wheelZAction=i.MoveRelative,this._wheelZActionCoordinate=R)}get wheelZMoveRelative(){return this._wheelZAction!==i.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(R){null===R&&this._wheelXAction!==i.RotateRelative||(this._wheelXAction=i.RotateRelative,this._wheelXActionCoordinate=R)}get wheelXRotateRelative(){return this._wheelXAction!==i.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(R){null===R&&this._wheelYAction!==i.RotateRelative||(this._wheelYAction=i.RotateRelative,this._wheelYActionCoordinate=R)}get wheelYRotateRelative(){return this._wheelYAction!==i.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(R){null===R&&this._wheelZAction!==i.RotateRelative||(this._wheelZAction=i.RotateRelative,this._wheelZActionCoordinate=R)}get wheelZRotateRelative(){return this._wheelZAction!==i.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(R){null===R&&this._wheelXAction!==i.MoveScene||(this._wheelXAction=i.MoveScene,this._wheelXActionCoordinate=R)}get wheelXMoveScene(){return this._wheelXAction!==i.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(R){null===R&&this._wheelYAction!==i.MoveScene||(this._wheelYAction=i.MoveScene,this._wheelYActionCoordinate=R)}get wheelYMoveScene(){return this._wheelYAction!==i.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(R){null===R&&this._wheelZAction!==i.MoveScene||(this._wheelZAction=i.MoveScene,this._wheelZActionCoordinate=R)}get wheelZMoveScene(){return this._wheelZAction!==i.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Ai(0),this._rotateRelative.Ai(0),this._moveScene.Ai(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const R=t.e.Zero();this.camera.getViewMatrix().invertToRef(R);const x=t.o.Zero();t.o.TransformNormalToRef(this._moveRelative,R,x),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(x),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(R,x,H){if(0===R)return;if(null===x||null===H)return;let k=null;switch(x){case i.MoveRelative:k=this._moveRelative;break;case i.RotateRelative:k=this._rotateRelative;break;case i.MoveScene:k=this._moveScene}switch(H){case 0:k.set(R,0,0);break;case 1:k.set(0,R,0);break;case 2:k.set(0,0,R)}}}(0,k.d)([(0,c.Q)()],L.prototype,"wheelXMoveRelative",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelYMoveRelative",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelZMoveRelative",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelXRotateRelative",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelYRotateRelative",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelZRotateRelative",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelXMoveScene",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelYMoveScene",null),(0,k.d)([(0,c.Q)()],L.prototype,"wheelZMoveScene",null),D.b.FreeCameraMouseWheelInput=L;class b{constructor(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=R,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=J.e.IsSafari()}attachControl(R){R=J.e.BackCompatCameraNoPreventDefault(arguments);let x=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=H=>{const k=H.event,c="mouse"===k.pointerType||this._isSafari&&"undefined"===typeof k.pointerType;if(this.allowMouse||!c)if(H.type===g.e.POINTERDOWN){if(R||k.preventDefault(),this._pointerPressed.push(k.pointerId),1!==this._pointerPressed.length)return;x={x:k.clientX,y:k.clientY}}else if(H.type===g.e.POINTERUP){R||k.preventDefault();const H=this._pointerPressed.indexOf(k.pointerId);if(-1===H)return;if(this._pointerPressed.splice(H,1),0!=H)return;x=null,this._offsetX=null,this._offsetY=null}else if(H.type===g.e.POINTERMOVE){if(R||k.preventDefault(),!x)return;if(0!=this._pointerPressed.indexOf(k.pointerId))return;this._offsetX=k.clientX-x.x,this._offsetY=-(k.clientY-x.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.e.POINTERDOWN|g.e.POINTERUP|g.e.POINTERMOVE),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.addEventListener("blur",this._onLostFocus)}}Zi(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const R=this.camera,x=R._calculateHandednessMultiplier();R.cameraRotation.y=x*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)R.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const x=R._computeLocalCameraSpeed(),H=new t.o(0,0,0!==this.touchMoveSensibility?x*this._offsetY/this.touchMoveSensibility:0);t.e.RotationYawPitchRollToRef(R.rotation.y,R.rotation.x,0,R._cameraRotationMatrix),R.cameraDirection.addInPlace(t.o.TransformCoordinates(H,R._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,k.d)([(0,c.Q)()],b.prototype,"touchAngularSensibility",void 0),(0,k.d)([(0,c.Q)()],b.prototype,"touchMoveSensibility",void 0),D.b.FreeCameraTouchInput=b;class C extends D.e{constructor(R){super(R),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new V),this}addMouse(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new I(R),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new L,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new b),this}clear(){super.clear(),this._mouseInput=null}}var F=H(610),d=H(555);class P extends A.b{get angularSensibility(){const R=this.inputs.attached.mouse;return R?R.angularSensibility:0}set angularSensibility(R){const x=this.inputs.attached.mouse;x&&(x.angularSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const x=this.inputs.attached.keyboard;x&&(x.keysUp=R)}get keysUpward(){const R=this.inputs.attached.keyboard;return R?R.keysUpward:[]}set keysUpward(R){const x=this.inputs.attached.keyboard;x&&(x.keysUpward=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const x=this.inputs.attached.keyboard;x&&(x.keysDown=R)}get keysDownward(){const R=this.inputs.attached.keyboard;return R?R.keysDownward:[]}set keysDownward(R){const x=this.inputs.attached.keyboard;x&&(x.keysDownward=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const x=this.inputs.attached.keyboard;x&&(x.keysRight=R)}get keysRotateLeft(){const R=this.inputs.attached.keyboard;return R?R.keysRotateLeft:[]}set keysRotateLeft(R){const x=this.inputs.attached.keyboard;x&&(x.keysRotateLeft=R)}get keysRotateRight(){const R=this.inputs.attached.keyboard;return R?R.keysRotateRight:[]}set keysRotateRight(R){const x=this.inputs.attached.keyboard;x&&(x.keysRotateRight=R)}get keysRotateUp(){const R=this.inputs.attached.keyboard;return R?R.keysRotateUp:[]}set keysRotateUp(R){const x=this.inputs.attached.keyboard;x&&(x.keysRotateUp=R)}get keysRotateDown(){const R=this.inputs.attached.keyboard;return R?R.keysRotateDown:[]}set keysRotateDown(R){const x=this.inputs.attached.keyboard;x&&(x.keysRotateDown=R)}constructor(R,x,H){var k;super(R,x,H,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),k=this,this.ellipsoid=new t.o(.5,1,.5),this.ellipsoidOffset=new t.o(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=t.o.Zero(),this._diffPosition=t.o.Zero(),this._newPosition=t.o.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;k._newPosition.p(x),k._newPosition.subtractToRef(k._oldPosition,k._diffPosition),k._diffPosition.length()>d.d.CollisionsEpsilon&&(k.position.addToRef(k._diffPosition,k._deferredPositionUpdate),k._deferOnly?k._deferredUpdated=!0:k.position.p(k._deferredPositionUpdate),k.di&&H&&k.di(H))},this.inputs=new C(this),this.inputs.addKeyboard().addMouse()}attachControl(R,x){x=J.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(x)}Zi(){this.inputs.detachElement(),this.cameraDirection=new t.o(0,0,0),this.cameraRotation=new t.k(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(R){this._collisionMask=isNaN(R)?-1:R}_collideWithWorld(R){let x;x=this.parent?t.o.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,x.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const H=this.va().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let k=R;this.applyGravity&&(k=R.add(this.va().gravity)),H.getNewPosition(this._oldPosition,k,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=t.o.Zero(),this._transformedDirection=t.o.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(R){this._needMoveForGravity=R}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,k.d)([(0,c.N)()],P.prototype,"ellipsoid",void 0),(0,k.d)([(0,c.N)()],P.prototype,"ellipsoidOffset",void 0),(0,k.d)([(0,c.Q)()],P.prototype,"checkCollisions",void 0),(0,k.d)([(0,c.Q)()],P.prototype,"applyGravity",void 0),(0,F.h)("BABYLON.FreeCamera",P)},13582:(R,x,H)=>{"use strict";H.d(x,{b:()=>t});var k=H(654),c=H(13589);class t{constructor(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=H,this.ll=[],this._maxBlockCapacity=x||64,this._selectionContent=new k.d(1024),this._creationFunc=R}update(R,x,H){c.e._CreateBlocks(R,x,H,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ij(R){for(let x=0;x<this.Ng.length;x++){this.Ng[x].addEntry(R)}}kj(R){for(let x=0;x<this.Ng.length;x++){this.Ng[x].removeEntry(R)}}select(R,x){this._selectionContent.reset();for(let H=0;H<this.Ng.length;H++){this.Ng[H].select(R,this._selectionContent,x)}return x?this._selectionContent.concat(this.ll):this._selectionContent.concatWithNoDuplicate(this.ll),this._selectionContent}intersects(R,x,H){this._selectionContent.reset();for(let k=0;k<this.Ng.length;k++){this.Ng[k].intersects(R,x,this._selectionContent,H)}return H?this._selectionContent.concat(this.ll):this._selectionContent.concatWithNoDuplicate(this.ll),this._selectionContent}intersectsRay(R){this._selectionContent.reset();for(let x=0;x<this.Ng.length;x++){this.Ng[x].intersectsRay(R,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.ll),this._selectionContent}}t.CreationFuncForMeshes=(R,x)=>{const H=R.getBoundingInfo();!R.isBlocked&&H.boundingBox.intersectsMinMax(x.nl,x.ol)&&x.entries.push(R)},t.CreationFuncForSubMeshes=(R,x)=>{R.getBoundingInfo().boundingBox.intersectsMinMax(x.nl,x.ol)&&x.entries.push(R)}},13589:(R,x,H)=>{"use strict";H.d(x,{e:()=>t});var k=H(661),c=H(778);class t{constructor(R,x,H,k,c,t){this.entries=[],this.pl=new Array,this._capacity=H,this._depth=k,this._maxDepth=c,this._creationFunc=t,this._minPoint=R,this._maxPoint=x,this.pl.push(R.clone()),this.pl.push(x.clone()),this.pl.push(R.clone()),this.pl[2].x=x.x,this.pl.push(R.clone()),this.pl[3].y=x.y,this.pl.push(R.clone()),this.pl[4].z=x.z,this.pl.push(x.clone()),this.pl[5].z=R.z,this.pl.push(x.clone()),this.pl[6].x=R.x,this.pl.push(x.clone()),this.pl[7].y=R.y}get ii(){return this._capacity}get nl(){return this._minPoint}get ol(){return this._maxPoint}addEntry(R){if(this.Ng)for(let x=0;x<this.Ng.length;x++){this.Ng[x].addEntry(R)}else this._creationFunc(R,this),this.entries.length>this.ii&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(R){if(this.Ng){for(let x=0;x<this.Ng.length;x++){this.Ng[x].removeEntry(R)}return}const x=this.entries.indexOf(R);x>-1&&this.entries.splice(x,1)}addEntries(R){for(let x=0;x<R.length;x++){const H=R[x];this.addEntry(H)}}select(R,x,H){if(c.b.IsInFrustum(this.pl,R)){if(this.Ng){for(let k=0;k<this.Ng.length;k++){this.Ng[k].select(R,x,H)}return}H?x.concat(this.entries):x.concatWithNoDuplicate(this.entries)}}intersects(R,x,H,k){if(c.b.IntersectsSphere(this._minPoint,this._maxPoint,R,x)){if(this.Ng){for(let c=0;c<this.Ng.length;c++){this.Ng[c].intersects(R,x,H,k)}return}k?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersectsRay(R,x){if(R.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Ng){for(let H=0;H<this.Ng.length;H++){this.Ng[H].intersectsRay(R,x)}return}x.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){t._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(R,x,H,c,A,D,U,J){U.Ng=new Array;const V=new k.o((x.x-R.x)/2,(x.y-R.y)/2,(x.z-R.z)/2);for(let k=0;k<2;k++)for(let x=0;x<2;x++)for(let n=0;n<2;n++){const g=R.add(V.multiplyByFloats(k,x,n)),I=R.add(V.multiplyByFloats(k+1,x+1,n+1)),i=new t(g,I,c,A+1,D,J);i.addEntries(H),U.Ng.push(i)}}}},13597:(R,x,H)=>{"use strict";H.d(x,{c:()=>V});var k=H(2445),c=H(661),t=H(813),A=H(12941),D=H(856),U=H(13582),J=H(513);k.e.prototype.createOrUpdateSelectionOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,H=this._getComponent(D.d.NAME_OCTREE);H||(H=new V(this),this.o(H)),this.jl||(this.jl=new U.b(U.b.CreationFuncForMeshes,R,x));const k=this.getWorldExtends();return this.jl.update(k.min,k.max,this.meshes),this.jl},Object.defineProperty(k.e.prototype,"selectionOctree",{get:function(){return this.jl},enumerable:!0,configurable:!0}),t.b.prototype.createOrUpdateSubmeshesOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const H=this.va();let k=H._getComponent(D.d.NAME_OCTREE);k||(k=new V(H),H.o(k)),this._submeshesOctree||(this._submeshesOctree=new U.b(U.b.CreationFuncForSubMeshes,R,x)),this.Fi(!0);const c=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(c.minimumWorld,c.maximumWorld,this.Ii),this._submeshesOctree};class V{constructor(R){this.name=D.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new A.e(c.o.Zero(),new c.o(1,1,1)),(R=R||J.c.LastCreatedScene)&&(this.Yk=R,this.Yk.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Yk.getActiveSubMeshCandidates=R=>this.getActiveSubMeshCandidates(R),this.Yk.getCollidingSubMeshCandidates=(R,x)=>this.getCollidingSubMeshCandidates(R,x),this.Yk.getIntersectingSubMeshCandidates=(R,x)=>this.getIntersectingSubMeshCandidates(R,x))}register(){this.Yk.onMeshRemovedObservable.add((R=>{const x=this.Yk.selectionOctree;if(void 0!==x&&null!==x){const H=x.ll.indexOf(R);-1!==H&&x.ll.splice(H,1)}})),this.Yk.onMeshImportedObservable.add((R=>{const x=this.Yk.selectionOctree;void 0!==x&&null!==x&&x.ij(R)}))}getActiveMeshCandidates(){var R;return(null===(R=this.Yk.jl)||void 0===R?void 0:R.select(this.Yk.frustumPlanes))||this.Yk._getDefaultMeshCandidates()}getActiveSubMeshCandidates(R){if(R._submeshesOctree&&R.useOctreeForRenderingSelection){return R._submeshesOctree.select(this.Yk.frustumPlanes)}return this.Yk._getDefaultSubMeshCandidates(R)}getIntersectingSubMeshCandidates(R,x){if(R._submeshesOctree&&R.useOctreeForPicking){A.e.TransformToRef(x,R.getWorldMatrix(),this._tempRay);return R._submeshesOctree.intersectsRay(this._tempRay)}return this.Yk._getDefaultSubMeshCandidates(R)}getCollidingSubMeshCandidates(R,x){if(R._submeshesOctree&&R.useOctreeForCollisions){const H=x._velocityWorldLength+Math.max(x._radius.x,x._radius.y,x._radius.z);return R._submeshesOctree.intersects(x._basePointWorld,H)}return this.Yk._getDefaultSubMeshCandidates(R)}rebuild(){}dispose(){}}},12941:(R,x,H)=>{"use strict";H.d(x,{e:()=>I});var k=H(2445),c=H(637),t=H(668),A=H(661),D=H(672),U=H(760),J=H(821),V=H(513),n=H(2484);const g={internalPickerForMesh:void 0};class I{constructor(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.e;this.origin=R,this.direction=x,this.length=H,this.epsilon=k}clone(){return new I(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const k=I._TmpVector3[0].si(R.x-H,R.y-H,R.z-H),c=I._TmpVector3[1].si(x.x+H,x.y+H,x.z+H);let t,A,D,U,J=0,V=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<k.x||this.origin.x>c.x)return!1}else if(t=1/this.direction.x,A=(k.x-this.origin.x)*t,D=(c.x-this.origin.x)*t,D===-1/0&&(D=1/0),A>D&&(U=A,A=D,D=U),J=Math.max(A,J),V=Math.min(D,V),J>V)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<k.y||this.origin.y>c.y)return!1}else if(t=1/this.direction.y,A=(k.y-this.origin.y)*t,D=(c.y-this.origin.y)*t,D===-1/0&&(D=1/0),A>D&&(U=A,A=D,D=U),J=Math.max(A,J),V=Math.min(D,V),J>V)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<k.z||this.origin.z>c.z)return!1}else if(t=1/this.direction.z,A=(k.z-this.origin.z)*t,D=(c.z-this.origin.z)*t,D===-1/0&&(D=1/0),A>D&&(U=A,A=D,D=U),J=Math.max(A,J),V=Math.min(D,V),J>V)return!1;return!0}intersectsBox(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(R.minimum,R.maximum,x)}intersectsSphere(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=R.center.x-this.origin.x,k=R.center.y-this.origin.y,c=R.center.z-this.origin.z,t=H*H+k*k+c*c,A=R.radius+x,D=A*A;if(t<=D)return!0;const U=H*this.direction.x+k*this.direction.y+c*this.direction.z;if(U<0)return!1;return t-U*U<=D}intersectsTriangle(R,x,H){const k=I._TmpVector3[0],c=I._TmpVector3[1],t=I._TmpVector3[2],D=I._TmpVector3[3],J=I._TmpVector3[4];x.subtractToRef(R,k),H.subtractToRef(R,c),A.o.CrossToRef(this.direction,c,t);const V=A.o.Dot(k,t);if(0===V)return null;const n=1/V;this.origin.subtractToRef(R,D);const g=A.o.Dot(D,t)*n;if(g<-this.epsilon||g>1+this.epsilon)return null;A.o.CrossToRef(D,k,J);const i=A.o.Dot(this.direction,J)*n;if(i<-this.epsilon||g+i>1+this.epsilon)return null;const q=A.o.Dot(c,J)*n;return q>this.length?null:new U.c(1-g-i,g,q)}intersectsPlane(R){let x;const H=A.o.Dot(R.dj,this.direction);if(Math.abs(H)<9.99999997475243e-7)return null;{const k=A.o.Dot(R.dj,this.origin);return x=(-R.d-k)/H,x<0?x<-9.99999997475243e-7?null:0:x}}intersectsAxis(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(R){case"y":{const R=(this.origin.y-x)/this.direction.y;return R>0?null:new A.o(this.origin.x+this.direction.x*-R,x,this.origin.z+this.direction.z*-R)}case"x":{const R=(this.origin.x-x)/this.direction.x;return R>0?null:new A.o(x,this.origin.y+this.direction.y*-R,this.origin.z+this.direction.z*-R)}case"z":{const R=(this.origin.z-x)/this.direction.z;return R>0?null:new A.o(this.origin.x+this.direction.x*-R,this.origin.y+this.direction.y*-R,x)}default:return null}}intersectsMesh(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const D=A.g.Matrix[0];return R.getWorldMatrix().invertToRef(D),this._tmpRay?I.TransformToRef(this,D,this._tmpRay):this._tmpRay=I.Transform(this,D),R.intersects(this._tmpRay,x,H,k,c,t)}intersectsMeshes(R,x,H){H?H.length=0:H=[];for(let k=0;k<R.length;k++){const c=this.intersectsMesh(R[k],x);c.hit&&H.push(c)}return H.sort(this._comparePickingInfo),H}_comparePickingInfo(R,x){return R.distance<x.distance?-1:R.distance>x.distance?1:0}intersectionSegment(R,x,H){const k=this.origin,c=A.g.Bi[0],t=A.g.Bi[1],D=A.g.Bi[2],U=A.g.Bi[3];x.subtractToRef(R,c),this.direction.scaleToRef(I._Rayl,D),k.addToRef(D,t),R.subtractToRef(k,U);const J=A.o.Dot(c,c),V=A.o.Dot(c,D),n=A.o.Dot(D,D),g=A.o.Dot(c,U),i=A.o.Dot(D,U),q=J*n-V*V;let S,L,b=q,C=q;q<I._Smallnum?(S=0,b=1,L=i,C=n):(S=V*i-n*g,L=J*i-V*g,S<0?(S=0,L=i,C=n):S>b&&(S=b,L=i+V,C=n)),L<0?(L=0,-g<0?S=0:-g>J?S=b:(S=-g,b=J)):L>C&&(L=C,-g+V<0?S=0:-g+V>J?S=b:(S=-g+V,b=J));const F=Math.abs(S)<I._Smallnum?0:S/b,d=Math.abs(L)<I._Smallnum?0:L/C,P=A.g.Bi[4];D.scaleToRef(d,P);const a=A.g.Bi[5];c.scaleToRef(F,a),a.addInPlace(U);const X=A.g.Bi[6];a.subtractToRef(P,X);return d>0&&d<=this.length&&X.lengthSquared()<H*H?a.length():-1}update(R,x,H,k,c,t,D){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){I._RayDistant||(I._RayDistant=I.Zero()),I._RayDistant.unprojectRayToRef(R,x,H,k,A.e.IdentityReadOnly,t,D);const U=A.g.Matrix[0];c.invertToRef(U),I.TransformToRef(I._RayDistant,U,this)}else this.unprojectRayToRef(R,x,H,k,c,t,D);return this}static Zero(){return new I(A.o.Zero(),A.o.Zero())}static CreateNew(R,x,H,k,c,t,A){return I.Zero().update(R,x,H,k,c,t,A)}static CreateNewFromTo(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.e.IdentityReadOnly;const k=new I(new A.o(0,0,0),new A.o(0,0,0));return I.CreateFromToToRef(R,x,k,H)}static CreateFromToToRef(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.e.IdentityReadOnly;H.origin.p(R);const c=x.subtractToRef(R,H.direction),t=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);return H.length=t,H.direction.normalize(),I.TransformToRef(H,k,H)}static Transform(R,x){const H=new I(new A.o(0,0,0),new A.o(0,0,0));return I.TransformToRef(R,x,H),H}static TransformToRef(R,x,H){A.o.TransformCoordinatesToRef(R.origin,x,H.origin),A.o.TransformNormalToRef(R.direction,x,H.direction),H.length=R.length,H.epsilon=R.epsilon;const k=H.direction,c=k.length();if(0!==c&&1!==c){const R=1/c;k.x*=R,k.y*=R,k.z*=R,H.length*=c}return H}unprojectRayToRef(R,x,H,k,c,t,D){const U=A.g.Matrix[0];c.multiplyToRef(t,U),U.multiplyToRef(D,U),U.invert();const J=V.c.LastCreatedEngine,n=A.g.Bi[0];n.x=R/H*2-1,n.y=-(x/k*2-1),n.z=null!==J&&void 0!==J&&J.useReverseDepthBuffer?1:null!==J&&void 0!==J&&J.isNDCHalfZRange?0:-1;const g=A.g.Bi[1].si(n.x,n.y,1-1e-8),I=A.g.Bi[2],i=A.g.Bi[3];A.o._UnprojectFromInvertedMatrixToRef(n,U,I),A.o._UnprojectFromInvertedMatrixToRef(g,U,i),this.origin.p(I),i.subtractToRef(I,this.direction),this.direction.normalize()}}function i(R,x,H,k,c){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=I.Zero();return q(R,x,H,k,A,c,t),A}function q(R,x,H,k,c,t){let D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const J=R.getEngine();if(!t&&!(t=R.activeCamera))return R;const V=t.viewport,n=J.getRenderHeight(),{x:g,y:I,width:i,height:q}=V.toGlobal(J.getRenderWidth(),n),S=1/J.getHardwareScalingLevel();return x=x*S-g,H=H*S-(n-I-q),c.update(x,H,i,q,k||A.e.IdentityReadOnly,D?A.e.IdentityReadOnly:t.getViewMatrix(),t.getProjectionMatrix(),U),R}function S(R,x,H,k,c){if(!J.c)return R;const t=R.getEngine();if(!c&&!(c=R.activeCamera))throw new Error("Active camera not set");const D=c.viewport,U=t.getRenderHeight(),{x:V,y:n,width:g,height:I}=D.toGlobal(t.getRenderWidth(),U),i=A.e.Identity(),q=1/t.getHardwareScalingLevel();return x=x*q-V,H=H*q-(U-n-I),k.update(x,H,g,I,i,i,c.getProjectionMatrix()),R}function L(R,x,H,k,c,t,A,D){const U=x(k,H.enableDistantPicking),J=H.intersects(U,c,A,t,k,D);return J&&J.hit?!c&&null!=R&&J.distance>=R.distance?null:J:null}function b(R,x,H,k,c,t){let D=null;const U=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),V=R.cameraToUseForPointers||R.activeCamera,n=g.internalPickerForMesh||L;for(let J=0;J<R.meshes.length;J++){const g=R.meshes[J];if(H){if(!H(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.Mi)continue;const I=U&&g.isWorldMatrixCameraDependent(),i=g.Fi(I,V);if(g.hasThinInstances&&g.thinInstanceEnablePicking){const R=n(D,x,g,i,!0,!0,t);if(R){if(c)return R;const U=A.g.Matrix[1],J=g.thinInstanceGetWorldMatrices();for(let R=0;R<J.length;R++){if(H&&!H(g,R))continue;J[R].multiplyToRef(i,U);const A=n(D,x,g,U,k,c,t,!0);if(A&&(D=A,D.thinInstanceIndex=R,k))return D}}}else{const R=n(D,x,g,i,k,c,t);if(R&&(D=R,k))return D}}return D||new J.c}function C(R,x,H,k){if(!J.c)return null;const c=[],t=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),D=R.cameraToUseForPointers||R.activeCamera,U=g.internalPickerForMesh||L;for(let J=0;J<R.meshes.length;J++){const V=R.meshes[J];if(H){if(!H(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.Mi)continue;const n=t&&V.isWorldMatrixCameraDependent(),g=V.Fi(n,D);if(V.hasThinInstances&&V.thinInstanceEnablePicking){if(U(null,x,V,g,!0,!0,k)){const R=A.g.Matrix[1],t=V.thinInstanceGetWorldMatrices();for(let A=0;A<t.length;A++){if(H&&!H(V,A))continue;t[A].multiplyToRef(g,R);const D=U(null,x,V,R,!1,!1,k,!0);D&&(D.thinInstanceIndex=A,c.push(D))}}}else{const R=U(null,x,V,g,!1,!1,k);R&&c.push(R)}}return c}function F(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,k=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;k||(k=R.getWorldMatrix()),x.length=H,c?x.origin.p(c):x.origin.p(R.position);const t=A.g.Bi[2];t.set(0,0,R._scene.useRightHandedSystem?-1:1);const D=A.g.Bi[3];return A.o.TransformNormalToRef(t,k,D),A.o.NormalizeToRef(D,x.direction),x}var d,P;I._TmpVector3=(0,D.d)(6,A.o.Zero),I._RayDistant=I.Zero(),I._Smallnum=1e-8,I._Rayl=1e9,d=k.e,(P=c.b)&&(P.prototype.getForwardRay=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,x=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;return F(this,new I(A.o.Zero(),A.o.Zero(),R),R,x,H)},P.prototype.getForwardRayToRef=function(R){return F(this,R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),d&&(n.e._IsPickingAvailable=!0,d.prototype.createPickingRay=function(R,x,H,k){return i(this,R,x,H,k,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),k.e.prototype.createPickingRayToRef=function(R,x,H,k,c){return q(this,R,x,H,k,c,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},k.e.prototype.createPickingRayInCameraSpace=function(R,x,H){return function(R,x,H,k){const c=I.Zero();return S(R,x,H,c,k),c}(this,R,x,H)},k.e.prototype.createPickingRayInCameraSpaceToRef=function(R,x,H,k){return S(this,R,x,H,k)},k.e.prototype.pickWithBoundingInfo=function(R,x,H,k,c){return function(R,x,H,k,c,t){if(!J.c)return null;const D=b(R,(k=>(R._tempPickingRay||(R._tempPickingRay=I.Zero()),q(R,x,H,k,R._tempPickingRay,t||null),R._tempPickingRay)),k,c,!0);return D&&(D.ray=i(R,x,H,A.e.Identity(),t||null)),D}(this,R,x,H,k,c)},k.e.prototype.Xk=function(R,x,H,k,c,t){return function(R,x,H,k,c,t,D){const U=b(R,((k,c)=>(R._tempPickingRay||(R._tempPickingRay=I.Zero()),q(R,x,H,k,R._tempPickingRay,t||null,!1,c),R._tempPickingRay)),k,c,!1,D);return U&&(U.ray=i(R,x,H,A.e.Identity(),t||null)),U}(this,R,x,H,k,c,t)},k.e.prototype.pickWithRay=function(R,x,H,k){return function(R,x,H,k,c){const t=b(R,(H=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=A.e.Identity()),H.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=I.Zero()),I.TransformToRef(x,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),H,k,!1,c);return t&&(t.ray=x),t}(this,R,x,H,k)},k.e.prototype.multiPick=function(R,x,H,k,c){return function(R,x,H,k,c,t){return C(R,(k=>i(R,x,H,k,c||null)),k,t)}(this,R,x,H,k,c)},k.e.prototype.multiPickWithRay=function(R,x,H){return function(R,x,H,k){return C(R,(H=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=A.e.Identity()),H.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=I.Zero()),I.TransformToRef(x,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),H,k)}(this,R,x,H)}},2419:(R,x,H)=>{"use strict";var k=H(590),c=H(493),t=H(517),A=H(612),D=H(555),U=H(598);D.d.prototype._partialLoadFile=function(R,x,H,k){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(R,(R=>{H[x]=R,H._internalCount++,6===H._internalCount&&k(H)}),void 0,void 0,!0,((R,x)=>{c&&R&&c(R.status+" "+R.statusText,x)}))},D.d.prototype._cascadeLoadFiles=function(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const c=[];c._internalCount=0;for(let t=0;t<6;t++)this._partialLoadFile(H[t],t,c,x,k)},D.d.prototype._cascadeLoadImgs=function(R,x,H,k){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5?arguments[5]:void 0;const A=[];A._internalCount=0;for(let D=0;D<6;D++)this._partialLoadImg(k[D],D,A,R,x,H,c,t)},D.d.prototype._partialLoadImg=function(R,x,H,k,c,D){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0;const V=(0,A.e)();(0,t.u)(R,(R=>{H[x]=R,H._internalCount++,k&&k.removePendingData(V),6===H._internalCount&&D&&D(c,H)}),((R,x)=>{k&&k.removePendingData(V),U&&U(R,x)}),k?k.offlineProvider:null,J),k&&k.addPendingData(V)},D.d.prototype.createCubeTextureBase=function(R,x,H,t){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,I=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,S=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,L=arguments.length>14&&void 0!==arguments[14]&&arguments[14],b=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const C=i||new k.b(this,7);C.isCube=!0,C.url=R,C.generateMipMaps=!t,C._lodGenerationScale=g,C._lodGenerationOffset=I,C._useSRGBBuffer=!!L&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!t),C!==i&&(C.label=R.substring(0,60)),this._doNotHandleContextLost||(C._extension=V,C._files=H,C._buffer=b);const F=R;this._transformTextureUrl&&!i&&(R=this._transformTextureUrl(R));const d=V??function(R){const x=R.split("?")[0],H=x.lastIndexOf(".");return H>-1?x.substring(H).toLowerCase():""}(R),P=(0,U.d)(d),a=(R,x)=>{C.dispose(),D?D(R,x):R&&c.c.Warn(R)},X=(k,D)=>{R===F?k&&a(k.status+" "+k.statusText,D):(c.c.Warn(`Failed to load ${R}, falling back to the ${F}`),this.createCubeTextureBase(F,x,H,!!t,A,a,J,V,n,g,I,C,q,S,L,b))};if(P)P.then((k=>{const c=R=>{q&&q(C,R),k.loadCubeData(R,C,n,A,((R,x)=>{a(R,x)}))};b?c(b):H&&6===H.length?k.supportCascades?this._cascadeLoadFiles(x,(R=>c(R.map((R=>new Uint8Array(R))))),H,a):a("Textures type does not support cascades."):this._loadFile(R,(R=>c(new Uint8Array(R))),void 0,void 0,!0,X)}));else{if(!H||0===H.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(x,C,((R,x)=>{S&&S(R,x)}),H,a)}return this._internalTexturesCache.push(C),C}},13605:(R,x,H)=>{"use strict";H(493);var k=H(2349);H(590),H(729),H(582),H(2400),H(2363);k.b},13244:(R,x,H)=>{"use strict";H.d(x,{e:()=>c});var k=H(610);class c{constructor(R){this.value=this._toInt(R)}_toInt(R){return 0|R}add(R){return new c(this.value+R.value)}Pg(R){return new c(this.value-R.value)}multiply(R){return new c(Math.imul(this.value,R.value))}divide(R){return new c(this.value/R.value)}getClassName(){return c.ClassName}equals(R){return this.value===R.value}static FromValue(R){return new c(R)}toString(){return this.value.toString()}}c.ClassName="FlowGraphInteger",(0,k.h)("FlowGraphInteger",c)},13255:(R,x,H)=>{"use strict";H.d(x,{c:()=>c,f:()=>t});var k=H(661);class c{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Xi=R}get m(){return this.Xi}transformVector(R){return this.transformVectorToRef(R,new k.k)}transformVectorToRef(R,x){return x.x=R.x*this.Xi[0]+R.y*this.Xi[1],x.y=R.x*this.Xi[2]+R.y*this.Xi[3],x}Li(){return this.toArray()}toArray(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<4;x++)R[x]=this.Xi[x];return R}bj(R){for(let x=0;x<4;x++)this.Xi[x]=R[x];return this}multiplyToRef(R,x){const H=R.Xi,k=this.Xi,c=x.Xi;return c[0]=H[0]*k[0]+H[1]*k[2],c[1]=H[0]*k[1]+H[1]*k[3],c[2]=H[2]*k[0]+H[3]*k[2],c[3]=H[2]*k[1]+H[3]*k[3],x}multiply(R){return this.multiplyToRef(R,new c)}divideToRef(R,x){const H=this.Xi,k=R.Xi,c=x.Xi;return c[0]=H[0]/k[0],c[1]=H[1]/k[1],c[2]=H[2]/k[2],c[3]=H[3]/k[3],x}divide(R){return this.divideToRef(R,new c)}addToRef(R,x){const H=this.Xi,k=R.m,c=x.m;return c[0]=H[0]+k[0],c[1]=H[1]+k[1],c[2]=H[2]+k[2],c[3]=H[3]+k[3],x}add(R){return this.addToRef(R,new c)}subtractToRef(R,x){const H=this.Xi,k=R.m,c=x.m;return c[0]=H[0]-k[0],c[1]=H[1]-k[1],c[2]=H[2]-k[2],c[3]=H[3]-k[3],x}Pg(R){return this.subtractToRef(R,new c)}transpose(){const R=this.Xi;return new c([R[0],R[2],R[1],R[3]])}determinant(){const R=this.Xi;return R[0]*R[3]-R[1]*R[2]}inverse(){const R=this.determinant();if(0===R)throw new Error("Matrix is not invertible");const x=this.Xi,H=1/R;return new c([x[3]*H,-x[1]*H,-x[2]*H,x[0]*H])}equals(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.Xi,k=R.m;return 0===x?H[0]===k[0]&&H[1]===k[1]&&H[2]===k[2]&&H[3]===k[3]:Math.abs(H[0]-k[0])<x&&Math.abs(H[1]-k[1])<x&&Math.abs(H[2]-k[2])<x&&Math.abs(H[3]-k[3])<x}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Xi.join(", ")})`}}class t{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Xi=R}get m(){return this.Xi}transformVector(R){return this.transformVectorToRef(R,new k.o)}transformVectorToRef(R,x){const H=this.Xi;return x.x=R.x*H[0]+R.y*H[1]+R.z*H[2],x.y=R.x*H[3]+R.y*H[4]+R.z*H[5],x.z=R.x*H[6]+R.y*H[7]+R.z*H[8],x}multiplyToRef(R,x){const H=R.Xi,k=this.Xi,c=x.m;return c[0]=H[0]*k[0]+H[1]*k[3]+H[2]*k[6],c[1]=H[0]*k[1]+H[1]*k[4]+H[2]*k[7],c[2]=H[0]*k[2]+H[1]*k[5]+H[2]*k[8],c[3]=H[3]*k[0]+H[4]*k[3]+H[5]*k[6],c[4]=H[3]*k[1]+H[4]*k[4]+H[5]*k[7],c[5]=H[3]*k[2]+H[4]*k[5]+H[5]*k[8],c[6]=H[6]*k[0]+H[7]*k[3]+H[8]*k[6],c[7]=H[6]*k[1]+H[7]*k[4]+H[8]*k[7],c[8]=H[6]*k[2]+H[7]*k[5]+H[8]*k[8],x}multiply(R){return this.multiplyToRef(R,new t)}divideToRef(R,x){const H=this.Xi,k=R.m,c=x.m;return c[0]=H[0]/k[0],c[1]=H[1]/k[1],c[2]=H[2]/k[2],c[3]=H[3]/k[3],c[4]=H[4]/k[4],c[5]=H[5]/k[5],c[6]=H[6]/k[6],c[7]=H[7]/k[7],c[8]=H[8]/k[8],x}divide(R){return this.divideToRef(R,new t)}addToRef(R,x){const H=this.Xi,k=R.m,c=x.m;return c[0]=H[0]+k[0],c[1]=H[1]+k[1],c[2]=H[2]+k[2],c[3]=H[3]+k[3],c[4]=H[4]+k[4],c[5]=H[5]+k[5],c[6]=H[6]+k[6],c[7]=H[7]+k[7],c[8]=H[8]+k[8],x}add(R){return this.addToRef(R,new t)}subtractToRef(R,x){const H=this.Xi,k=R.m,c=x.m;return c[0]=H[0]-k[0],c[1]=H[1]-k[1],c[2]=H[2]-k[2],c[3]=H[3]-k[3],c[4]=H[4]-k[4],c[5]=H[5]-k[5],c[6]=H[6]-k[6],c[7]=H[7]-k[7],c[8]=H[8]-k[8],x}Pg(R){return this.subtractToRef(R,new t)}toArray(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<9;x++)R[x]=this.Xi[x];return R}Li(){return this.toArray()}bj(R){for(let x=0;x<9;x++)this.Xi[x]=R[x];return this}transpose(){const R=this.Xi;return new t([R[0],R[3],R[6],R[1],R[4],R[7],R[2],R[5],R[8]])}determinant(){const R=this.Xi;return R[0]*(R[4]*R[8]-R[5]*R[7])-R[1]*(R[3]*R[8]-R[5]*R[6])+R[2]*(R[3]*R[7]-R[4]*R[6])}inverse(){const R=this.determinant();if(0===R)throw new Error("Matrix is not invertible");const x=this.Xi,H=1/R;return new t([(x[4]*x[8]-x[5]*x[7])*H,(x[2]*x[7]-x[1]*x[8])*H,(x[1]*x[5]-x[2]*x[4])*H,(x[5]*x[6]-x[3]*x[8])*H,(x[0]*x[8]-x[2]*x[6])*H,(x[2]*x[3]-x[0]*x[5])*H,(x[3]*x[7]-x[4]*x[6])*H,(x[1]*x[6]-x[0]*x[7])*H,(x[0]*x[4]-x[1]*x[3])*H])}equals(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.Xi,k=R.m;return 0===x?H[0]===k[0]&&H[1]===k[1]&&H[2]===k[2]&&H[3]===k[3]&&H[4]===k[4]&&H[5]===k[5]&&H[6]===k[6]&&H[7]===k[7]&&H[8]===k[8]:Math.abs(H[0]-k[0])<x&&Math.abs(H[1]-k[1])<x&&Math.abs(H[2]-k[2])<x&&Math.abs(H[3]-k[3])<x&&Math.abs(H[4]-k[4])<x&&Math.abs(H[5]-k[5])<x&&Math.abs(H[6]-k[6])<x&&Math.abs(H[7]-k[7])<x&&Math.abs(H[8]-k[8])<x}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Xi.join(", ")})`}}},13258:(R,x,H)=>{"use strict";var k;function c(R,x,H,k){switch(x){case"Animation":return k?R.animations.find((R=>R.uniqueId===H))??null:R.animations[H]??null;case"AnimationGroup":return k?R.animationGroups.find((R=>R.uniqueId===H))??null:R.animationGroups[H]??null;case"Mesh":return k?R.meshes.find((R=>R.uniqueId===H))??null:R.meshes[H]??null;case"Material":return k?R.materials.find((R=>R.uniqueId===H))??null:R.materials[H]??null;case"Yi":return k?R.cameras.find((R=>R.uniqueId===H))??null:R.cameras[H]??null;case"Light":return k?R.lights.find((R=>R.uniqueId===H))??null:R.lights[H]??null;default:return null}}H.d(x,{b:()=>c}),function(R){R.Animation="Animation",R.AnimationGroup="AnimationGroup",R.Mesh="Mesh",R.Material="Material",R.Yi="Yi",R.Light="Light"}(k||(k={}))},13299:(R,x,H)=>{"use strict";H.d(x,{b:()=>c});var k=H(13301);class c extends k.d{constructor(R,x){if(super(R),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),x)for(const H of x)this._eventsSignalOutputs[H]=this._registerSignalOutput(H+"Event")}_executeOnTick(R){}_startPendingTasks(R){R._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(R),this._resetAfterCanceled(R)),this._preparePendingTasks(R),R._addPendingBlock(this),this.out._activateSignal(R),R._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(R){R._deleteExecutionVariable(this,"_initialized"),R._removePendingBlock(this)}}},13268:(R,x,H)=>{"use strict";H.d(x,{b:()=>J});var k=H(612),c=H(610),t=H(13274),A=H(476),D=H(13236);class U extends t.d{constructor(R,x,H,k){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:k.defaultValue,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(R,x,H),this.richType=k,this._defaultValue=c,this._optional=t,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new A.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(R){this._isDisabled!==R&&(this._isDisabled=R,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(R,x){x._getConnectionValue(this)!==R&&(x._setConnectionValue(this,R),this.onValueChangedObservable.notifyObservers(R))}resetToDefaultValue(R){R._setConnectionValue(this,this._defaultValue)}connectTo(R){this._isDisabled||super.connectTo(R)}_getValueOrDefault(R){const x=R._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(x):x}getValue(R){if(1===this.connectionType){R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(R);const x=this._getValueOrDefault(R);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}const x=this.isConnected()?this._connectedPoint[0].getValue(R):this._getValueOrDefault(R);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.richType={},this.richType.serialize(R.richType),R.optional=this._optional,(0,D.f)("defaultValue",this._defaultValue,R)}}(0,c.h)("FlowGraphDataConnection",U);class J{constructor(R){var x;this.config=R,this.uniqueId=(0,k.e)(),this.name=(null===(x=this.config)||void 0===x?void 0:x.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(R){}registerDataInput(R,x,H){const k=new U(R,0,this,x,H);return this.dataInputs.push(k),k}registerDataOutput(R,x,H){const k=new U(R,1,this,x,H);return this.dataOutputs.push(k),k}getDataInput(R){return this.dataInputs.find((x=>x.name===R))}getDataOutput(R){return this.dataOutputs.find((x=>x.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.f;if(R.uniqueId=this.uniqueId,R.config={},this.config){const H=this.config,k=Object.keys(H);for(const c of k)x(c,H[c],R.config)}R.dataInputs=[],R.dataOutputs=[],R.className=this.getClassName();for(const H of this.dataInputs){const x={};H.serialize(x),R.dataInputs.push(x)}for(const H of this.dataOutputs){const x={};H.serialize(x),R.dataOutputs.push(x)}}deserialize(R){}_log(R,x,H){var k;null===(k=R.logger)||void 0===k||k.addLogItem({action:x,payload:H,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13274:(R,x,H)=>{"use strict";H.d(x,{d:()=>t});var k,c=H(612);!function(R){R[R.Input=0]="Input",R[R.Output=1]="Output"}(k||(k={}));class t{constructor(R,x,H){this._ownerBlock=H,this._connectedPoint=[],this.uniqueId=(0,c.e)(),this.connectedPointIds=[],this.name=R,this._connectionType=x}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(R){if(this._connectionType===R._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||R._isSingularConnection()&&R._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(R),R._connectedPoint.push(this)}disconnectFrom(R){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=this._connectedPoint.indexOf(R),k=R._connectedPoint.indexOf(this);-1!==H&&-1!==k&&(x&&this._connectedPoint.splice(H,1),R._connectedPoint.splice(k,1))}disconnectFromAll(){for(const R of this._connectedPoint)this.disconnectFrom(R,!1);this._connectedPoint.length=0}dispose(){for(const R of this._connectedPoint)this.disconnectFrom(R)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.uniqueId=this.uniqueId,R.name=this.name,R._connectionType=this._connectionType,R.connectedPointIds=[],R.className=this.getClassName();for(const x of this._connectedPoint)R.connectedPointIds.push(x.uniqueId)}getClassName(){return"FGConnection"}deserialize(R){this.uniqueId=R.uniqueId,this.name=R.name,this._connectionType=R._connectionType,this.connectedPointIds=R.connectedPointIds}}},13229:(R,x,H)=>{"use strict";H.d(x,{d:()=>C});var k,c=H(476),t=H(643),A=H(647),D=H(612),U=H(13236),J=H(13258),V=H(493);!function(R){R.ExecuteBlock="ExecuteBlock",R.ExecuteEvent="ExecuteEvent",R.TriggerConnection="TriggerConnection",R.ContextVariableSet="ContextVariableSet",R.GlobalVariableSet="GlobalVariableSet",R.GlobalVariableDelete="GlobalVariableDelete",R.GlobalVariableGet="GlobalVariableGet",R.AddConnection="AddConnection",R.GetConnectionValue="GetConnectionValue",R.SetConnectionValue="SetConnectionValue",R.ActivateSignal="ActivateSignal",R.ContextVariableGet="ContextVariableGet"}(k||(k={}));class n{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(R){if(R.time||(R.time=Date.now()),this.log.push(R),this.logToConsole){var x;const H=null===(x=R.payload)||void 0===x?void 0:x.value;"object"===typeof H&&H.getClassName?V.c.Log(`[FGLog] ${R.className}:${R.uniqueId.split("-")[0]} ${R.action} - ${JSON.stringify(H.getClassName())}: ${H.toString()}`):V.c.Log(`[FGLog] ${R.className}:${R.uniqueId.split("-")[0]} ${R.action} - ${JSON.stringify(R.payload)}`)}}getItemsOfType(R){return this.log.filter((x=>x.action===R))}}class g{get enableLogging(){return this._enableLogging}set enableLogging(R){this._enableLogging!==R&&(this._enableLogging=R,this._enableLogging?(this.logger=new n,this.logger.logToConsole=!0):this.logger=null)}constructor(R){this.uniqueId=(0,D.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new c.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=R,this.assetsContext=R.assetsContext??R.Yk}hasVariable(R){return R in this._userVariables}setVariable(R,x){var H;this._userVariables[R]=x,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:R,value:x}})}getAsset(R,x){return(0,J.b)(this.assetsContext,R,x)}getVariable(R){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:R,value:this._userVariables[R]}}),this._userVariables[R]}get userVariables(){return this._userVariables}va(){return this._configuration.Yk}_getUniqueIdPrefixedName(R,x){return`${R.uniqueId}_${x}`}_getGlobalContextVariable(R,x){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:R,defaultValue:x,possibleValue:this._globalContextVariables[R]}}),this._hasGlobalContextVariable(R)?this._globalContextVariables[R]:x}_setGlobalContextVariable(R,x){var H;null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:R,value:x}}),this._globalContextVariables[R]=x}_deleteGlobalContextVariable(R){var x;null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:R}}),delete this._globalContextVariables[R]}_hasGlobalContextVariable(R){return R in this._globalContextVariables}_setExecutionVariable(R,x,H){this._executionVariables[this._getUniqueIdPrefixedName(R,x)]=H}_getExecutionVariable(R,x,H){return this._hasExecutionVariable(R,x)?this._executionVariables[this._getUniqueIdPrefixedName(R,x)]:H}_deleteExecutionVariable(R,x){delete this._executionVariables[this._getUniqueIdPrefixedName(R,x)]}_hasExecutionVariable(R,x){return this._getUniqueIdPrefixedName(R,x)in this._executionVariables}_hasConnectionValue(R){return R.uniqueId in this._connectionValues}_setConnectionValue(R,x){var H;this._connectionValues[R.uniqueId]=x,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:R.uniqueId,value:x}})}_setConnectionValueByKey(R,x){this._connectionValues[R]=x}_getConnectionValue(R){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:R.uniqueId,value:this._connectionValues[R.uniqueId]}}),this._connectionValues[R.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(R){this._pendingBlocks.includes(R)||(this._pendingBlocks.push(R),this._pendingBlocks.sort(((R,x)=>R.priority-x.priority)))}_removePendingBlock(R){const x=this._pendingBlocks.indexOf(R);-1!==x&&this._pendingBlocks.splice(x,1)}_clearPendingBlocks(){for(const R of this._pendingBlocks)R._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(R){var x;this.onNodeExecutedObservable.notifyObservers(R),null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:R.getClassName(),uniqueId:R.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(R){this._setGlobalContextVariable("timeSinceStart",R.timeSinceStart),this._setGlobalContextVariable("deltaTime",R.deltaTime);for(const H of this._pendingBlocks){var x;null===(x=H._executeOnTick)||void 0===x||x.call(H,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.f;R.uniqueId=this.uniqueId,R._userVariables={};for(const k in this._userVariables)x(k,this._userVariables[k],R._userVariables);R._connectionValues={};for(const k in this._connectionValues)x(k,this._connectionValues[k],R._connectionValues);var H;this.assetsContext!==this.va()&&(R._assetsContext={meshes:this.assetsContext.meshes.map((R=>R.id)),materials:this.assetsContext.materials.map((R=>R.id)),textures:this.assetsContext.textures.map((R=>R.name)),animations:this.assetsContext.animations.map((R=>R.name)),lights:this.assetsContext.lights.map((R=>R.id)),cameras:this.assetsContext.cameras.map((R=>R.id)),qm:null===(H=this.assetsContext.qm)||void 0===H?void 0:H.map((R=>R.name)),skeletons:this.assetsContext.skeletons.map((R=>R.id)),Ei:this.assetsContext.Ei.map((R=>R.name)),geometries:this.assetsContext.geometries.map((R=>R.id)),multiMaterials:this.assetsContext.multiMaterials.map((R=>R.id)),transformNodes:this.assetsContext.transformNodes.map((R=>R.id))})}getClassName(){return"FlowGraphContext"}}(0,t.d)([(0,A.Q)()],g.prototype,"uniqueId",void 0);var I=H(13262),i=H(2464);class q{constructor(R){this.onEventTriggeredObservable=new c.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=R,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Vi.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const R=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:R}}),this._startingTime+=R})),this._meshPickedObserver=this._scene.onPointerObservable.add((R=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:R})}),i.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((R=>{const x=R.pointerId,H=R.mesh,k=this._pointerUnderMeshState[x];!k&&H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:x,mesh:H}}):k&&!H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:x,mesh:k}}):k&&H&&k!==H&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:x,mesh:k,over:H}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:x,mesh:H,out:k}})),this._pointerUnderMeshState[x]=H}),i.e.POINTERMOVE)}dispose(){var R,x,H,k,c;null===(R=this._sceneDisposeObserver)||void 0===R||R.remove(),null===(x=this._sceneReadyObserver)||void 0===x||x.remove(),null===(H=this._sceneOnBeforeRenderObserver)||void 0===H||H.remove(),null===(k=this._meshPickedObserver)||void 0===k||k.remove(),null===(c=this._meshUnderPointerObserver)||void 0===c||c.remove(),this.onEventTriggeredObservable.clear()}}var S,L=H(13283);!function(R){R[R.Stopped=0]="Stopped",R[R.Started=1]="Started"}(S||(S={}));class b{get state(){return this._state}set state(R){this._state=R,this.onStateChangedObservable.notifyObservers(R)}constructor(R){this.onStateChangedObservable=new c.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=R.Yk,this._sceneEventCoordinator=new q(this._scene),this._coordinator=R.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((R=>{for(const x of this._executionContexts){const H=this._getContextualOrder(R.type,x);for(const k of H)if(!k._executeEvent(x,R.payload))break}switch(R.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const x of this._executionContexts)x._notifyOnTick(R.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const R=new g({Yk:this._scene,coordinator:this._coordinator});return this._executionContexts.push(R),R}getContext(R){return this._executionContexts[R]}addEventBlock(R){if("PointerOver"!==R.type&&"PointerOut"!==R.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==R.type&&this._eventBlocks[R.type].push(R),1===this.state)for(const x of this._executionContexts)R._startPendingTasks(x);else this.onStateChangedObservable.addOnce((x=>{if(1===x)for(const H of this._executionContexts)R._startPendingTasks(H)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((R=>{1===R&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const R of this._executionContexts)for(const x in this._eventBlocks){const H=this._getContextualOrder(x,R);for(const x of H)x._startPendingTasks(R)}}_getContextualOrder(R,x){const H=this._eventBlocks[R].sort(((R,x)=>x.initPriority-R.initPriority));if("MeshPick"===R){const R=[];for(const k of H){const c=k.asset.getValue(x);let t=0;for(;t<H.length;t++){const R=H[t].asset.getValue(x);if(c&&R&&(0,L.m)(c,R))break}R.splice(t,0,k)}return R}return H}dispose(){var R;if(0!==this.state){this.state=0;for(const R of this._executionContexts)R._clearPendingBlocks();this._executionContexts.length=0;for(const R in this._eventBlocks)this._eventBlocks[R].length=0;null===(R=this._eventObserver)||void 0===R||R.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(R){const x=[],H=new Set;for(const k in this._eventBlocks)for(const R of this._eventBlocks[k])x.push(R),H.add(R.uniqueId);for(;x.length>0;){const k=x.pop();R(k);for(const R of k.dataInputs)for(const k of R._connectedPoint)H.has(k._ownerBlock.uniqueId)||(x.push(k._ownerBlock),H.add(k._ownerBlock.uniqueId));if(k instanceof I.d)for(const R of k.signalOutputs)for(const k of R._connectedPoint)H.has(k._ownerBlock.uniqueId)||(x.push(k._ownerBlock),H.add(k._ownerBlock.uniqueId))}}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1?arguments[1]:void 0;R.allBlocks=[],this.visitAllBlocks((x=>{const H={};x.serialize(H),R.allBlocks.push(H)})),R.executionContexts=[];for(const H of this._executionContexts){const k={};H.serialize(k,x),R.executionContexts.push(k)}}}class C{constructor(R){this.config=R,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Yk.Vi.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Yk.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const R=this._executeOnNextFrame.slice(0);if(R.length)for(const x of R){this.notifyCustomEvent(x.id,x.data,!1);const R=this._executeOnNextFrame.findIndex((R=>R.uniqueId===x.uniqueId));-1!==R&&this._executeOnNextFrame.splice(R,1)}}));(C.SceneCoordinators.get(this.config.Yk)??[]).push(this)}createGraph(){const R=new b({Yk:this.config.Yk,coordinator:this});return this._flowGraphs.push(R),R}removeGraph(R){const x=this._flowGraphs.indexOf(R);-1!==x&&(R.dispose(),this._flowGraphs.splice(x,1))}start(){for(const R of this._flowGraphs)R.start()}dispose(){var R,x;for(const c of this._flowGraphs)c.dispose();this._flowGraphs.length=0,null===(R=this._disposeObserver)||void 0===R||R.remove(),null===(x=this._onBeforeRenderObserver)||void 0===x||x.remove();const H=C.SceneCoordinators.get(this.config.Yk)??[],k=H.indexOf(this);-1!==k&&H.splice(k,1)}serialize(R,x){R._flowGraphs=[];for(const H of this._flowGraphs){const k={};H.serialize(k,x),R._flowGraphs.push(k)}R.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(R){let x=this._customEventsMap.get(R);return x||(x=new c.d,this._customEventsMap.set(R,x)),x}notifyCustomEvent(R,x){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:R,data:x,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(R)){const x=this._eventExecutionCounter.get(R);if(this._eventExecutionCounter.set(R,x+1),x>=C.MaxEventTypeExecutionPerFrame)return void(x===C.MaxEventTypeExecutionPerFrame&&V.c.Warn(`FlowGraphCoordinator: Too many executions of event "${R}".`))}else this._eventExecutionCounter.set(R,1);const H=this._customEventsMap.get(R);H&&H.notifyObservers(x)}}C.MaxEventsPerType=30,C.MaxEventTypeExecutionPerFrame=30,C.SceneCoordinators=new Map},13290:(R,x,H)=>{"use strict";H.d(x,{d:()=>c});var k=H(13299);class c extends k.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(R){R._notifyExecuteNode(this),this.done._activateSignal(R)}}},13262:(R,x,H)=>{"use strict";H.d(x,{d:()=>D});var k=H(13268),c=H(13274),t=H(610);class A extends c.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(R){super.connectTo(R),this._connectedPoint.sort(((R,x)=>x.priority-R.priority))}_activateSignal(R){var x;if(null===(x=R.logger)||void 0===x||x.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(R,this),R._increaseExecutionId();else for(const H of this._connectedPoint)H._activateSignal(R)}}(0,t.h)("FlowGraphSignalConnection",A);class D extends k.b{constructor(R){super(R),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(R){const x=new A(R,0,this);return this.signalInputs.push(x),x}_registerSignalOutput(R){const x=new A(R,1,this);return this.signalOutputs.push(x),x}_unregisterSignalInput(R){const x=this.signalInputs.findIndex((x=>x.name===R));-1!==x&&(this.signalInputs[x].dispose(),this.signalInputs.splice(x,1))}_unregisterSignalOutput(R){const x=this.signalOutputs.findIndex((x=>x.name===R));-1!==x&&(this.signalOutputs[x].dispose(),this.signalOutputs.splice(x,1))}_reportError(R,x){this.error.payload="string"===typeof x?new Error(x):x,this.error._activateSignal(R)}getSignalInput(R){return this.signalInputs.find((x=>x.name===R))}getSignalOutput(R){return this.signalOutputs.find((x=>x.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.signalInputs=[],R.signalOutputs=[];for(const x of this.signalInputs){const H={};x.serialize(H),R.signalInputs.push(H)}for(const x of this.signalOutputs){const H={};x.serialize(H),R.signalOutputs.push(H)}}deserialize(R){for(let x=0;x<R.signalInputs.length;x++){const H=this.getSignalInput(R.signalInputs[x].name);if(!H)throw new Error("Could not find signal input with name "+R.signalInputs[x].name+" in block "+R.className);H.deserialize(R.signalInputs[x])}for(let x=0;x<R.signalOutputs.length;x++){const H=this.getSignalOutput(R.signalOutputs[x].name);if(!H)throw new Error("Could not find signal output with name "+R.signalOutputs[x].name+" in block "+R.className);H.deserialize(R.signalOutputs[x])}}getClassName(){return"FlowGraphExecutionBlock"}}},13301:(R,x,H)=>{"use strict";H.d(x,{d:()=>c});var k=H(13262);class c extends k.d{constructor(R){super(R),this.out=this._registerSignalOutput("out")}}},13246:(R,x,H)=>{"use strict";H.d(x,{B:()=>B,C:()=>X,G:()=>a,b:()=>J,c:()=>g,d:()=>P,f:()=>S,j:()=>L,k:()=>b,m:()=>n,o:()=>d,p:()=>V,s:()=>I,t:()=>i,w:()=>q,y:()=>M});var k,c=H(661),t=H(695),A=H(13244),D=H(13255);!function(R){R.Any="any",R.String="string",R.Number="number",R.Boolean="boolean",R.Object="object",R.Integer="FlowGraphInteger",R.Vector2="Vector2",R.Bi="Bi",R.Vector4="Vector4",R.Quaternion="Quaternion",R.Matrix="Matrix",R.Matrix2D="Matrix2D",R.Matrix3D="Matrix3D",R.fj="fj",R.gj="gj"}(k||(k={}));class U{constructor(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=R,this.defaultValue=x,this.animationType=H}serialize(R){R.typeName=this.typeName,R.defaultValue=this.defaultValue}}const J=new U("any",void 0),V=new U("string",""),n=new U("number",0,0),g=new U("boolean",!1),I=new U("Vector2",c.k.Zero(),5),i=new U("Bi",c.o.Zero(),1),q=new U("Vector4",c.p.Zero()),S=new U("Matrix",c.e.Identity(),3),L=new U("Matrix2D",new D.c),b=new U("Matrix3D",new D.f),C=new U("fj",t.c.Black(),4),F=new U("gj",new t.d(0,0,0,0),7),d=new U("Quaternion",c.f.Identity(),2);d.typeTransformer=R=>{if(R.getClassName){if("Vector4"===R.getClassName())return c.f.zi(R.Li());if("Bi"===R.getClassName())return c.f.FromEulerVector(R);if("Matrix"===R.getClassName())return c.f.FromRotationMatrix(R)}return R};const P=new U("FlowGraphInteger",new A.e(0),0);function a(R){const x=R;switch(typeof R){case"string":return V;case"number":return n;case"boolean":return g;case"object":if(x.getClassName)switch(x.getClassName()){case"Vector2":return I;case"Bi":return i;case"Vector4":return q;case"Matrix":return S;case"fj":return C;case"gj":return F;case"Quaternion":return d;case"FlowGraphInteger":return P;case"Matrix2D":return L;case"Matrix3D":return b}return J;default:return J}}function X(R){switch(R){case"string":return V;case"number":return n;case"boolean":return g;case"Vector2":return I;case"Bi":return i;case"Vector4":return q;case"Matrix":return S;case"fj":return C;case"gj":return F;case"Quaternion":return d;case"FlowGraphInteger":return P;case"Matrix2D":return L;case"Matrix3D":return b;default:return J}}function M(R){switch(R){case"number":default:return 0;case"Vector2":return 5;case"Bi":return 1;case"Matrix":return 3;case"fj":return 4;case"gj":return 7;case"Quaternion":return 2}}function B(R){switch(R){case 0:return n;case 5:return I;case 1:return i;case 3:return S;case 4:return C;case 7:return F;case 2:return d;default:return J}}},13236:(R,x,H)=>{"use strict";H.d(x,{d:()=>V,f:()=>J,j:()=>n});var k=H(695),c=H(661),t=H(13244),A=H(13246),D=H(13255);function U(R){return"Vector2"===R||"Bi"===R||"Vector4"===R||"Quaternion"===R||"fj"===R||"gj"===R}function J(R,x,H){var k;const c=(null===x||void 0===x||null===(k=x.getClassName)||void 0===k?void 0:k.call(x))??"";if(U(c)||function(R){return"Matrix"===R||"Matrix2D"===R||"Matrix3D"===R}(c))H[R]={value:x.Li(),className:c};else if("FlowGraphInteger"===c)H[R]={value:x.value,className:c};else if(c&&(x.id||x.name))H[R]={id:x.id,name:x.name,className:c};else{if("object"===typeof x)throw new Error(`Could not serialize value ${x}`);H[R]=x}}function V(R,x,H,J){const n=x[R];let g;const I=(null===n||void 0===n?void 0:n.type)??(null===n||void 0===n?void 0:n.className);if(function(R){return"Mesh"===R||"AbstractMesh"===R||"GroundMesh"===R||"InstanceMesh"===R||"LinesMesh"===R||"GoldbergMesh"===R||"GreasedLineMesh"===R||"TrailMesh"===R}(I)){let R=J.meshes.filter((R=>n.id?R.id===n.id:R.name===n.name));0===R.length&&(R=J.transformNodes.filter((R=>n.id?R.id===n.id:R.name===n.name))),g=n.uniqueId?R.find((R=>R.uniqueId===n.uniqueId)):R[0]}else if(U(I))g=function(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===R)return c.k.zi(x);if("Bi"===R)return H&&(x[2]*=-1),c.o.zi(x);if("Vector4"===R)return c.p.zi(x);if("Quaternion"===R)return H&&(x[2]*=-1,x[3]*=-1),c.f.zi(x);if("fj"===R)return new k.c(x[0],x[1],x[2]);if("gj"===R)return new k.d(x[0],x[1],x[2],x[3]);throw new Error(`Unknown vector class name ${R}`)}(I,n.value);else if(function(R){return"AnimationGroup"===R}(I)){const R=J.animationGroups.filter((R=>R.name===n.name));g=1===R.length?R[0]:R.find((R=>R.uniqueId===n.uniqueId))}else g="Matrix"===I?c.e.zi(n.value):"Matrix2D"===I?new D.c(n.value):"Matrix3D"===I?new D.f(n.value):"FlowGraphInteger"===I?t.e.FromValue(n.value):"number"===I||"string"===I||"boolean"===I?n.value[0]:n&&void 0!==n.value?n.value:Array.isArray(n)?n.reduce(((R,x)=>x.eventData?(R[x.id]={type:(0,A.C)(x.type)},"undefined"!==typeof x.value&&(R[x.id].value=V("value",x,H,J)),R):R),{}):n;return g}function n(R){return"FlowGraphJsonPointerParserBlock"===R}},13283:(R,x,H)=>{"use strict";function k(R,x){return!(!R.parent||R.parent!==x&&!k(R.parent,x))}function c(R){if(R.getClassName)return R.getClassName()}function t(R,x){return R===x&&("Vector2"===R||"Bi"===R||"Vector4"===R||"Quaternion"===R)}function A(R,x){return R===x&&("Matrix"===R||"Matrix2D"===R||"Matrix3D"===R)}function D(R,x){return"FlowGraphInteger"===R&&"FlowGraphInteger"===x}function U(R,x){const H="number"===typeof R||"number"===typeof(null===R||void 0===R?void 0:R.value);return H&&!x?!isNaN(J(R)):H}function J(R){return"number"===typeof R?R:R.value}H.d(x,{b:()=>D,d:()=>A,h:()=>t,i:()=>c,m:()=>k,q:()=>J,u:()=>U})},12632:(R,x,H)=>{"use strict";H.r(x),H.d(x,{SceneInstrumentation:()=>t});var k=H(485),c=H(2411);class t{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(R){R!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=R,R?(this._onBeforeActiveMeshesEvaluationObserver=this.Yk.onBeforeActiveMeshesEvaluationObservable.add((()=>{k.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Yk.onAfterActiveMeshesEvaluationObservable.add((()=>{k.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Yk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Yk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(R){R!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=R,R?(this._onBeforeRenderTargetsRenderObserver=this.Yk.onBeforeRenderTargetsRenderObservable.add((()=>{k.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Yk.onAfterRenderTargetsRenderObservable.add((()=>{k.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Yk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Yk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(R){R!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=R,R?(this._onBeforeParticlesRenderingObserver=this.Yk.onBeforeParticlesRenderingObservable.add((()=>{k.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Yk.onAfterParticlesRenderingObservable.add((()=>{k.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Yk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Yk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(R){R!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=R,this.Yk.spriteManagers&&(R?(this._onBeforeSpritesRenderingObserver=this.Yk.onBeforeSpritesRenderingObservable.add((()=>{k.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Yk.onAfterSpritesRenderingObservable.add((()=>{k.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Yk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Yk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(R){R!==this._capturePhysicsTime&&this.Yk.onBeforePhysicsObservable&&(this._capturePhysicsTime=R,R?(this._onBeforePhysicsObserver=this.Yk.onBeforePhysicsObservable.add((()=>{k.e.StartPerformanceCounter("ib"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Yk.onAfterPhysicsObservable.add((()=>{k.e.EndPerformanceCounter("ib"),this._physicsTime.endMonitoring()}))):(this.Yk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Yk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(R){R!==this._captureAnimationsTime&&(this._captureAnimationsTime=R,R?this._onAfterAnimationsObserver=this.Yk.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Yk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(R){this._captureFrameTime=R}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(R){this._captureInterFrameTime=R}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(R){R!==this._captureRenderTime&&(this._captureRenderTime=R,R?(this._onBeforeDrawPhaseObserver=this.Yk.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),k.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Yk.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),k.e.EndPerformanceCounter("Main render")}))):(this.Yk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Yk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(R){R!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=R,R?(this._onBeforeCameraRenderObserver=this.Yk.onBeforeCameraRenderObservable.add((R=>{this._cameraRenderTime.beginMonitoring(),k.e.StartPerformanceCounter(`Rendering camera ${R.name}`)})),this._onAfterCameraRenderObserver=this.Yk.onAfterCameraRenderObservable.add((R=>{this._cameraRenderTime.endMonitoring(!1),k.e.EndPerformanceCounter(`Rendering camera ${R.name}`)}))):(this.Yk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Yk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Yk.getEngine()._drawCalls}constructor(R){this.Yk=R,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new c.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new c.e,this._captureFrameTime=!1,this._frameTime=new c.e,this._captureRenderTime=!1,this._renderTime=new c.e,this._captureInterFrameTime=!1,this._interFrameTime=new c.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new c.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new c.e,this._capturePhysicsTime=!1,this._physicsTime=new c.e,this._captureAnimationsTime=!1,this._animationsTime=new c.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new c.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=R.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(k.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Yk.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=R.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(k.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ui(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ui(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ui(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ui(),this._captureRenderTime&&this._renderTime.Ui(),this._captureCameraRenderTime&&this._cameraRenderTime.Ui()}))}dispose(){this._disposed||(this.Yk.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Yk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Yk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Yk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Yk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Yk.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Yk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Yk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Yk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Yk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Yk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Yk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Yk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Yk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Yk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Yk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Yk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Yk=null,this._disposed=!0)}}},13225:(R,x,H)=>{"use strict";H.d(x,{c:()=>V});var k=H(643),c=H(647),t=H(661),A=H(683),D=H(12348),U=H(12395),J=H(610);A.e.AddNodeConstructor("Light_Type_1",((R,x)=>()=>new V(R,t.o.Zero(),x)));class V extends U.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(R){this._shadowFrustumSize=R,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(R){this._shadowOrthoScale=R,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(R){this._orthoLeft=R}get orthoRight(){return this._orthoRight}set orthoRight(R){this._orthoRight=R}get orthoTop(){return this._orthoTop}set orthoTop(R){this._orthoTop=R}get orthoBottom(){return this._orthoBottom}set orthoBottom(R){this._orthoBottom=R}constructor(R,x,H){super(R,H),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=x.scale(-1),this.direction=x}getClassName(){return"kb"}getTypeID(){return D.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(R,x,H){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(R):this._setDefaultAutoExtendShadowProjectionMatrix(R,x,H)}_setDefaultFixedFrustumShadowProjectionMatrix(R){const x=this.va().activeCamera;x&&t.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:x.Hi,void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,R,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(R,x,H){const k=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const R=t.o.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let k=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let A=0;A<H.length;A++){const D=H[A];if(!D)continue;const U=D.getBoundingInfo().boundingBox;for(let H=0;H<U.vectorsWorld.length;H++)t.o.TransformCoordinatesToRef(U.vectorsWorld[H],x,R),R.x<this._orthoLeft&&(this._orthoLeft=R.x),R.y<this._orthoBottom&&(this._orthoBottom=R.y),R.x>this._orthoRight&&(this._orthoRight=R.x),R.y>this._orthoTop&&(this._orthoTop=R.y),this.autoCalcShadowZBounds&&(R.z<k&&(k=R.z),R.z>c&&(c=R.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=k,this._shadowMaxZ=c)}const c=this._orthoRight-this._orthoLeft,A=this._orthoTop-this._orthoBottom,D=void 0!==this.shadowMinZ?this.shadowMinZ:(null===k||void 0===k?void 0:k.Hi)||0,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===k||void 0===k?void 0:k.maxZ)||1e4,J=this.va().getEngine().useReverseDepthBuffer;t.e.OrthoOffCenterLHToRef(this._orthoLeft-c*this.shadowOrthoScale,this._orthoRight+c*this.shadowOrthoScale,this._orthoBottom-A*this.shadowOrthoScale,this._orthoTop+A*this.shadowOrthoScale,J?U:D,J?D:U,R,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,x){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,x),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,x),this)}transferToNodeMaterialEffect(R,x){return this.computeTransformedInformation()?(R.setFloat3(x,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(R.setFloat3(x,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(R){const x=this._scene.getEngine();return!x.useReverseDepthBuffer&&x.isNDCHalfZRange?0:1}getDepthMaxZ(R){const x=this._scene.getEngine();return x.useReverseDepthBuffer&&x.isNDCHalfZRange?0:1}prepareLightSpecificDefines(R,x){R["DIRLIGHT"+x]=!0}}(0,k.d)([(0,c.Q)()],V.prototype,"shadowFrustumSize",null),(0,k.d)([(0,c.Q)()],V.prototype,"shadowOrthoScale",null),(0,k.d)([(0,c.Q)()],V.prototype,"autoUpdateExtends",void 0),(0,k.d)([(0,c.Q)()],V.prototype,"autoCalcShadowZBounds",void 0),(0,k.d)([(0,c.Q)("orthoLeft")],V.prototype,"_orthoLeft",void 0),(0,k.d)([(0,c.Q)("orthoRight")],V.prototype,"_orthoRight",void 0),(0,k.d)([(0,c.Q)("orthoTop")],V.prototype,"_orthoTop",void 0),(0,k.d)([(0,c.Q)("orthoBottom")],V.prototype,"_orthoBottom",void 0),(0,J.h)("BABYLON.DirectionalLight",V)},13520:(R,x,H)=>{"use strict";H.d(x,{d:()=>V});var k=H(643),c=H(647),t=H(661),A=H(695),D=H(683),U=H(12348),J=H(610);D.e.AddNodeConstructor("Light_Type_3",((R,x)=>()=>new V(R,t.o.Zero(),x)));class V extends U.b{constructor(R,x,H){super(R,H),this.groundColor=new A.c(0,0,0),this.direction=x||t.o.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(R){return this.direction=t.o.Normalize(R.Pg(t.o.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(R,x){const H=t.o.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",H.x,H.y,H.z,0,x),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.bb),x),this}transferToNodeMaterialEffect(R,x){const H=t.o.Normalize(this.direction);return R.setFloat3(x,H.x,H.y,H.z),this}Fi(){return this._worldMatrix||(this._worldMatrix=t.e.Identity()),this._worldMatrix}getTypeID(){return U.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(R,x){R["HEMILIGHT"+x]=!0}}(0,k.d)([(0,c.p)()],V.prototype,"groundColor",void 0),(0,k.d)([(0,c.N)()],V.prototype,"direction",void 0),(0,J.h)("BABYLON.HemisphericLight",V)},13207:(R,x,H)=>{"use strict";H.d(x,{c:()=>n});var k=H(643),c=H(647),t=H(661),A=H(683),D=H(12348),U=H(12395),J=H(2311),V=H(610);A.e.AddNodeConstructor("Light_Type_2",((R,x)=>()=>new n(R,t.o.Zero(),t.o.Zero(),0,0,x)));class n extends U.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(R){this._iesProfileTexture!==R&&(this._iesProfileTexture=R,this._iesProfileTexture&&n._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(R){this._angle=R,this._cosHalfAngle=Math.cos(.5*R),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(R){this._innerAngle=R,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(R){this._shadowAngleScale=R,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(R){this._projectionTextureLightNear=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(R){this._projectionTextureLightFar=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(R){this._projectionTextureUpDirection=R,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(R){this._projectionTexture!==R&&(this._projectionTexture=R,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(n._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):n._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(R){return void 0!==R.onGeneratedObservable}static _IsTexture(R){return void 0!==R.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(R){this._projectionTextureProjectionLightMatrix=R,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(R,x,H,k,c,A){super(R,A),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=t.e.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=t.o.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=t.o.Zero(),this._projectionTextureViewLightMatrix=t.e.Zero(),this._projectionTextureProjectionLightMatrix=t.e.Zero(),this._projectionTextureScalingMatrix=t.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=x,this.direction=H,this.angle=k,this.exponent=c}getClassName(){return"SpotLight"}getTypeID(){return D.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(R){super._setDirection(R),this._projectionTextureViewLightDirty=!0}_setPosition(R){super._setPosition(R),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(R,x,H){const k=this.va().activeCamera;if(!k)return;this._shadowAngleScale=this._shadowAngleScale||1;const c=this._shadowAngleScale*this._angle,A=void 0!==this.shadowMinZ?this.shadowMinZ:k.Hi,D=void 0!==this.shadowMaxZ?this.shadowMaxZ:k.maxZ,U=this.va().getEngine().useReverseDepthBuffer;t.e.PerspectiveFovLHToRef(c,1,U?D:A,U?A:D,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),t.e.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const R=this.projectionTextureLightFar,x=this.projectionTextureLightNear,H=R/(R-x),k=-H*x,c=1/Math.tan(this._angle/2);t.e.FromValuesToRef(c/1,0,0,0,0,c,0,0,0,0,H,1,0,0,k,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof J.d){const R=this._projectionTexture.uScale/2,x=this._projectionTexture.vScale/2;t.e.FromValuesToRef(R,0,0,0,0,x,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(R,x){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),R.setMatrix("textureProjectionMatrix"+x,this._projectionTextureMatrix),R.setTexture("projectionLightTexture"+x,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&R.setTexture("iesLightTexture"+x,this._iesProfileTexture),this}transferToEffect(R,x){let H;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,x),H=t.o.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,x),H=t.o.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",H.x,H.y,H.z,this._cosHalfAngle,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,x),this}transferToNodeMaterialEffect(R,x){let H;return H=this.computeTransformedInformation()?t.o.Normalize(this.transformedDirection):t.o.Normalize(this.direction),this.va().useRightHandedSystem?R.setFloat3(x,-H.x,-H.y,-H.z):R.setFloat3(x,H.x,H.y,H.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(R){const x=this._scene.getEngine(),H=void 0!==this.shadowMinZ?this.shadowMinZ:(null===R||void 0===R?void 0:R.Hi)??0;return x.useReverseDepthBuffer&&x.isNDCHalfZRange?H:this._scene.getEngine().isNDCHalfZRange?0:H}getDepthMaxZ(R){const x=this._scene.getEngine(),H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===R||void 0===R?void 0:R.maxZ)??1e4;return x.useReverseDepthBuffer&&x.isNDCHalfZRange?0:H}prepareLightSpecificDefines(R,x){R["SPOTLIGHT"+x]=!0,R["PROJECTEDLIGHTTEXTURE"+x]=!(!this.projectionTexture||!this.projectionTexture.isReady()),R["IESLIGHTTEXTURE"+x]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,k.d)([(0,c.Q)()],n.prototype,"angle",null),(0,k.d)([(0,c.Q)()],n.prototype,"innerAngle",null),(0,k.d)([(0,c.Q)()],n.prototype,"shadowAngleScale",null),(0,k.d)([(0,c.Q)()],n.prototype,"exponent",void 0),(0,k.d)([(0,c.Q)()],n.prototype,"projectionTextureLightNear",null),(0,k.d)([(0,c.Q)()],n.prototype,"projectionTextureLightFar",null),(0,k.d)([(0,c.Q)()],n.prototype,"projectionTextureUpDirection",null),(0,k.d)([(0,c.F)("projectedLightTexture")],n.prototype,"_projectionTexture",void 0),(0,V.h)("BABYLON.SpotLight",n)},12934:(R,x,H)=>{"use strict";H.d(x,{c:()=>A,g:()=>t,i:()=>D});const k={},c={};function t(R,x){k[R]=x}function A(R,x){c[R]=x}function D(R){return c[R]?c[R]:null}},12821:(R,x,H)=>{"use strict";H.d(x,{d:()=>a,h:()=>f});var k,c=H(485),t=H(476),A=H(2445),D=H(513),U=H(493),J=H(801),V=H(517),n=H(526),g=H(612),I=H(555),i=H(506);!function(R){R[R.Clean=0]="Clean",R[R.Stop=1]="Stop",R[R.Sync=2]="Sync",R[R.NoSync=3]="NoSync"}(k||(k={}));const q=new t.d,S={};let L=!1;function b(){return S[".babylon"]}function C(R,x){const H=S[R];return H||(U.c.Warn("Unable to find a plugin to load "+R+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),x?b():void 0)}function F(R,x,H){let k="Unable to load from "+(R.rawData?"binary data":R.url);return x?k+=`: ${x}`:H&&(k+=`: ${H}`),k}async function d(R,x,H,k,c,t,A,D,U){var J;const n="data:"===(g=R.url).substring(0,5)?g.substring(5):null;var g;if(R.rawData&&!A)throw"When using ArrayBufferView to load data the file extension must be provided.";const L=n||A?"":function(R){const x=R.indexOf("?");-1!==x&&(R=R.substring(0,x));const H=R.lastIndexOf(".");return R.substring(H,R.length).toLowerCase()}(R.url);let F=A?C(A,!0):n?function(R){for(const x in S){const H=S[x].plugin;if(H.canDirectLoad&&H.canDirectLoad(R))return S[x]}return b()}(R.url):C(L,!1);if(!F&&L){if(R.url&&!R.url.startsWith("blob:")){const x=await async function(R,x){const H=x.method||"GET";return await new Promise(((k,c)=>{const t=new i.e;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const R={};if(x.responseHeaders)for(const H of x.responseHeaders)R[H]=t.getResponseHeader(H)||"";k({response:t.response,headerValues:R})}else c(`Unable to fetch data from ${R}. Error code: ${t.status}`)})),t.open(H,R),t.send()}))}(R.url,{method:"HEAD",responseHeaders:["Content-Type"]}),H=x.headerValues?x.headerValues["Content-Type"]:"";H&&(F=function(R){for(const x in S){const H=S[x];if(H.mimeType===R)return H}}(H))}F||(F=b())}if(!F)throw new Error(`No plugin or fallback for ${A??R.url}`);if(!1===(null===U||void 0===U||null===(J=U[F.plugin.name])||void 0===J?void 0:J.enabled))throw new Error(`The '${F.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(R.rawData&&!F.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(R=>{if(F.plugin.createPlugin){const x=F.plugin.createPlugin(U??{});return x instanceof Promise?(x.then(R).catch((R=>{c("Error instantiating plugin.",R)})),null):(R(x),x)}return R(F.plugin),F.plugin})((U=>{var J;if(!U)throw`The loader plugin corresponding to the '${A}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(q.notifyObservers(U),n&&(U.canDirectLoad&&U.canDirectLoad(R.url)||!(0,V.n)(R.url))){if(U.directLoad){const R=U.directLoad(x,n);R instanceof Promise?R.then((R=>{H(U,R)})).catch((R=>{c("Error in directLoad of _loadData: "+R,R)})):H(U,R)}else H(U,n);return}const g=F.isBinary,i=(R,k)=>{x.u?c("Scene has been disposed"):H(U,R,k)};let S=null,L=!1;null===(J=U.Vi)||void 0===J||J.add((()=>{L=!0,S&&(S.abort(),S=null),t()}));const b=()=>{if(L)return;const H=(R,x)=>{c(null===R||void 0===R?void 0:R.statusText,x)};if(!U.loadFile&&R.rawData)throw"Plugin does not support loading ArrayBufferView.";S=U.loadFile?U.loadFile(x,R.rawData||R.file||R.url,R.rootUrl,i,k,g,H,D):x._loadFile(R.file||R.url,i,k,!0,g,H)},C=x.getEngine();let d=C.enableOfflineSupport;if(d){let H=!1;for(const k of x.disableOfflineSupportExceptionRules)if(k.test(R.url)){H=!0;break}d=!H}d&&I.d.OfflineProviderFactory?x.offlineProvider=I.d.OfflineProviderFactory(R.url,b,C.disableManifestCheck):b()}))}function P(R,x){let H,k,t=null,A=null;if(x)if(x.name)H=`file:${x.name}`,k=x.name,t=x;else if(ArrayBuffer.isView(x))H="",k=(0,g.e)(),A=x;else if(x.startsWith("data:"))H=x,k="";else if(R){const t=x;if("/"===t.substring(0,1))return c.e.Error("Wrong sceneFilename parameter"),null;H=R+t,k=t}else H=x,k=c.e.GetFilename(x),R=c.e.GetFolderPath(x);else H=R,k=c.e.GetFilename(R),R=c.e.GetFolderPath(R);return{url:H,rootUrl:R,name:k,file:t,rawData:A}}function a(R){if("string"===typeof R.extensions){const x=R.extensions;S[x.toLowerCase()]={plugin:R,isBinary:!1}}else{const x=R.extensions,H=Object.keys(x);for(const k of H)S[k.toLowerCase()]={plugin:R,isBinary:x[k].isBinary,mimeType:x[k].mimeType}}}async function X(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.c.LastCreatedScene,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!k)return U.c.Error("No scene available to import mesh to"),null;const I=P(x,H);if(!I)return null;const i={};k.addPendingData(i);const q=()=>{k.removePendingData(i)},S=(R,x)=>{const H=F(I,R,x);A?A(k,H,new n.g(H,n.f.SceneLoaderError,x)):U.c.Error(H),q()},L=t?R=>{try{t(R)}catch(x){S("Error in onProgress callback: "+x,x)}}:void 0,b=(R,x,H,t,A,D,U,J)=>{if(k.importedMeshesFiles.push(I.url),c)try{c(R,x,H,t,A,D,U,J)}catch(V){S("Error in onSuccess callback: "+V,V)}k.removePendingData(i)};return await d(I,k,((x,H,c)=>{if(x.rewriteRootURL&&(I.rootUrl=x.rewriteRootURL(I.rootUrl,c)),x.importMesh){const c=[],t=[],A=[];if(!x.importMesh(R,k,H,I.rootUrl,c,t,A,S))return;k.loadingPluginName=x.name,b(c,t,A,[],[],[],[],[])}else{x.importMeshAsync(R,k,H,I.rootUrl,L,I.name).then((R=>{k.loadingPluginName=x.name,b(R.meshes,R.Ei,R.skeletons,R.animationGroups,R.transformNodes,R.geometries,R.lights,R.spriteManagers)})).catch((R=>{S(R.message,R)}))}}),L,S,q,J,V,g)}async function M(R,x,H,k,c,t,A,D){return await new Promise(((U,J)=>{try{X(R,x,H,k,((R,x,H,k,c,t,A,D)=>{U({meshes:R,Ei:x,skeletons:H,animationGroups:k,transformNodes:c,geometries:t,lights:A,spriteManagers:D})}),c,((R,x,H)=>{J(H||new Error(x))}),t,A,D).catch(J)}catch(n){J(n)}}))}async function B(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.c.LastCreatedEngine,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};H?await Z(R,x,new A.e(H),k,t,U,J,V,n):c.e.Error("No engine available")}async function o(R,x,H,k,c,t,A){return await new Promise(((D,U)=>{B(R,x,H,(R=>{D(R)}),k,((R,x,H)=>{U(H||new Error(x))}),c,t,A)}))}async function Z(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.c.LastCreatedScene,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return U.c.Error("No scene available to append to"),null;const I=P(R,x);if(!I)return null;const i={};H.addPendingData(i);const q=()=>{H.removePendingData(i)};J.d.ShowLoadingScreen&&!L&&(L=!0,H.getEngine().displayLoadingUI(),H.executeWhenReady((()=>{H.getEngine().hideLoadingUI(),L=!1})));const S=(R,x)=>{const k=F(I,R,x);t?t(H,k,new n.g(k,n.f.SceneLoaderError,x)):U.c.Error(k),q()},b=c?R=>{try{c(R)}catch(x){S("Error in onProgress callback",x)}}:void 0,C=()=>{if(k)try{k(H)}catch(R){S("Error in onSuccess callback",R)}H.removePendingData(i)};return await d(I,H,((R,x)=>{if(R.load){if(!R.load(H,x,I.rootUrl,S))return;H.loadingPluginName=R.name,C()}else{R.loadAsync(H,x,I.rootUrl,b,I.name).then((()=>{H.loadingPluginName=R.name,C()})).catch((R=>{S(R.message,R)}))}}),b,S,q,A,V,g)}async function y(R,x,H,k,c,t,A){return await new Promise(((D,U)=>{try{Z(R,x,H,(R=>{D(R)}),k,((R,x,H)=>{U(H||new Error(x))}),c,t,A).catch(U)}catch(n){U(n)}}))}async function s(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.c.LastCreatedScene,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return U.c.Error("No scene available to load asset container to"),null;const g=P(R,x);if(!g)return null;const I={};H.addPendingData(I);const i=()=>{H.removePendingData(I)},q=(R,x)=>{const k=F(g,R,x);t?t(H,k,new n.g(k,n.f.SceneLoaderError,x)):U.c.Error(k),i()},S=c?R=>{try{c(R)}catch(x){q("Error in onProgress callback",x)}}:void 0,L=R=>{if(k)try{k(R)}catch(x){q("Error in onSuccess callback",x)}H.removePendingData(I)};return await d(g,H,((R,x)=>{if(R.loadAssetContainer){const k=R.loadAssetContainer(H,x,g.rootUrl,q);if(!k)return;k.populateRootNodes(),H.loadingPluginName=R.name,L(k)}else if(R.loadAssetContainerAsync){R.loadAssetContainerAsync(H,x,g.rootUrl,S,g.name).then((x=>{x.populateRootNodes(),H.loadingPluginName=R.name,L(x)})).catch((R=>{q(R.message,R)}))}else q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),S,q,i,A,J,V)}async function E(R,x,H,k,c,t,A){return await new Promise(((D,U)=>{try{s(R,x,H,(R=>{D(R)}),k,((R,x,H)=>{U(H||new Error(x))}),c,t,A).catch(U)}catch(n){U(n)}}))}async function w(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.c.LastCreatedScene,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",I=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!H)return void U.c.Error("No scene available to load animations to");if(k){for(const k of H.animatables)k.reset();H.stopAllAnimations();const R=H.animationGroups.slice();for(const H of R)H.dispose();const x=H.getNodes();for(const H of x)H.animations&&(H.animations=[])}else switch(c){case 0:const R=H.animationGroups.slice();for(const x of R)x.dispose();break;case 1:for(const x of H.animationGroups)x.stop();break;case 2:for(const x of H.animationGroups)x.reset(),x.restart();break;case 3:break;default:return void U.c.Error("Unknown animation group loading mode value '"+c+"'")}const i=H.animatables.length;await s(R,x,H,(R=>{R.mergeAnimationsTo(H,H.animatables.slice(i),t),R.dispose(),H.onAnimationFileImportedObservable.notifyObservers(H),A&&A(H)}),J,V,n,g,I)}async function h(R,x,H,k,c,t,A,D,U,J){return await new Promise(((V,g)=>{try{w(R,x,H,k,c,t,(R=>{V(R)}),A,((R,x,H)=>{g(H||new Error(x))}),D,U,J).catch(g)}catch(n){g(n)}}))}class f{static get ForceFullSceneLoadingForIncremental(){return J.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(R){J.d.ForceFullSceneLoadingForIncremental=R}static get ShowLoadingScreen(){return J.d.ShowLoadingScreen}static set ShowLoadingScreen(R){J.d.ShowLoadingScreen=R}static get loggingLevel(){return J.d.loggingLevel}static set loggingLevel(R){J.d.loggingLevel=R}static get CleanBoneMatrixWeights(){return J.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(R){J.d.CleanBoneMatrixWeights=R}static GetDefaultPlugin(){return b()}static GetPluginForExtension(R){var x;return null===(x=C(R,!0))||void 0===x?void 0:x.plugin}static IsPluginForExtensionAvailable(R){return function(R){return!!S[R]}(R)}static RegisterPlugin(R){a(R)}static ImportMesh(R,x,H,k,c,t,A,U,J){X(R,x,H,k,c,t,A,U,J).catch((R=>null===A||void 0===A?void 0:A(D.c.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async ImportMeshAsync(R,x,H,k,c,t,A){return await M(R,x,H,k,c,t,A)}static Load(R,x,H,k,c,t,A,U){B(R,x,H,k,c,t,A,U).catch((R=>null===t||void 0===t?void 0:t(D.c.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async LoadAsync(R,x,H,k,c,t){return await o(R,x,H,k,c,t)}static Append(R,x,H,k,c,t,A,U){Z(R,x,H,k,c,t,A,U).catch((R=>null===t||void 0===t?void 0:t(H??D.c.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async AppendAsync(R,x,H,k,c,t){return await y(R,x,H,k,c,t)}static LoadAssetContainer(R,x,H,k,c,t,A,U){s(R,x,H,k,c,t,A,U).catch((R=>null===t||void 0===t?void 0:t(H??D.c.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async LoadAssetContainerAsync(R,x,H,k,c,t){return await E(R,x,H,k,c,t)}static ImportAnimations(R,x,H,k,c,t,A,U,J,V,n){w(R,x,H,k,c,t,A,U,J,V,n).catch((R=>null===J||void 0===J?void 0:J(H??D.c.LastCreatedScene,null===R||void 0===R?void 0:R.message,R)))}static async ImportAnimationsAsync(R,x,H,k,c,t,A,D,U,J,V){return await h(R,x,H,k,c,t,D,J,V)}}f.NO_LOGGING=0,f.MINIMAL_LOGGING=1,f.SUMMARY_LOGGING=2,f.DETAILED_LOGGING=3,f.OnPluginActivatedObservable=q},13220:(R,x,H)=>{"use strict";H.d(x,{c:()=>g});var k=H(643),c=H(647),t=H(485),A=H(661),D=H(2319),U=H(2311),J=H(610),V=H(476),n=H(687);H(2419);class g extends D.e{set boundingBoxSize(R){if(this._boundingBoxSize&&this._boundingBoxSize.equals(R))return;this._boundingBoxSize=R;const x=this.va();x&&x.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(R){this._rotationY=R,this.setReflectionTextureMatrix(A.e.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(R,x,H){let k="";for(const c of R)k+=c;return new g(k,x,null,H,R)}static CreateFromPrefilteredData(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const c=x.useDelayedTextureLoading;x.useDelayedTextureLoading=!1;const t=new g(R,x,null,!1,null,null,null,void 0,!0,H,k);return x.useDelayedTextureLoading=c,t}constructor(R,x){var H;let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,L=arguments.length>13?arguments[13]:void 0,b=arguments.length>14?arguments[14]:void 0;super(x),this.onLoadObservable=new V.d,this.boundingBoxPosition=A.o.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new A.e,this._buffer=null,this.name=R,this.url=R,this._noMipmap=c,this.Qj=!1,this.isCube=!0,this._textureMatrix=A.e.Identity(),this.coordinatesMode=U.d.CUBIC_MODE;let C=null,F=null;null===k||Array.isArray(k)?(this._noMipmap=c,this._format=n,this._createPolynomials=i,C=k,this._loaderOptions=L,this._useSRGBBuffer=b,this._lodScale=q,this._lodOffset=S):(C=k.extensions??null,this._noMipmap=k.noMipmap??!1,t=k.files??null,F=k.buffer??null,this._format=k.format??5,g=k.prefiltered??!1,I=k.forcedExtension??null,this._createPolynomials=k.createPolynomials??!1,this._lodScale=k.lodScale??.8,this._lodOffset=k.lodOffset??0,this._loaderOptions=k.loaderOptions,this._useSRGBBuffer=k.useSRGBBuffer,D=k.X??null,J=k.onError??null),(R||t)&&this.updateURL(R,I,D,g,J,C,null===(H=this.va())||void 0===H?void 0:H.useDelayedTextureLoading,t,F)}getClassName(){return"CubeTexture"}updateURL(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=R),this.url=R,x&&(this._forcedExtension=x);const J=R.lastIndexOf("."),V=x||(J>-1?R.substring(J).toLowerCase():""),n=0===V.indexOf(".dds"),g=0===V.indexOf(".env"),I=0===V.indexOf(".basis");if(g?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=k,k&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),D)this._files=D;else if(I||g||n||t||(t=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,t){for(let x=0;x<t.length;x++)this._files.push(R+t[x]);this._extensions=t}this._buffer=U,A?(this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=c):this._loadTexture(H,c)}delayLoad(R){4===this.delayLoadState&&(R&&(this._forcedExtension=R),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(R){var x,H;if(R.updateFlag===this._textureMatrix.updateFlag)return;R.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(H=this.va())||void 0===H||H.markAllMaterialsAsDirty(1,(R=>-1!==R.getActiveTextures().indexOf(this))));if(this._textureMatrix=R,null===(x=this.va())||void 0===x||!x.useRightHandedSystem)return;const k=A.g.Bi[0],c=A.g.Quaternion[0],t=A.g.Bi[1];this._textureMatrix.decompose(k,c,t),c.z*=-1,c.w*=-1,A.e.ComposeToRef(k,c,t,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var R;return null!==(R=this.va())&&void 0!==R&&R.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this.va(),k=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const c=()=>{var x;(this.onLoadObservable.notifyObservers(this),k)&&(k.dispose(),null===(x=this.va())||void 0===x||x.markAllMaterialsAsDirty(1));R&&R()},A=(R,H)=>{this._loadingError=!0,this._errorObject={message:R,exception:H},x&&x(R,H),U.d.OnTextureLoadErrorObservable.notifyObservers(this)};var D;this._texture?this._texture.isReady?t.e.SetImmediate((()=>c())):this._texture.onLoadedObservable.add((()=>c())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,H,this._lodScale,this._lodOffset,R,A,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,H,this._files,this._noMipmap,R,A,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(D=this._texture)||void 0===D||D.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(R,x,H){const k=n.d.Parse((()=>{let k=!1;return R.prefiltered&&(k=R.prefiltered),new g(H+(R.url??R.name),x,R.extensions,!1,R.files||null,null,null,void 0,k,R.forcedExtension)}),R,x);if(R.boundingBoxPosition&&(k.boundingBoxPosition=A.o.zi(R.boundingBoxPosition)),R.boundingBoxSize&&(k.boundingBoxSize=A.o.zi(R.boundingBoxSize)),R.animations)for(let c=0;c<R.animations.length;c++){const x=R.animations[c],H=(0,J.e)("BABYLON.Animation");H&&k.animations.push(H.Parse(x))}return k}clone(){let R=0;const x=n.d.Clone((()=>{const x=new g(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return R=x.uniqueId,x}),this);return x.uniqueId=R,x}}(0,k.d)([(0,c.Q)()],g.prototype,"url",void 0),(0,k.d)([(0,c.N)()],g.prototype,"boundingBoxPosition",void 0),(0,k.d)([(0,c.N)()],g.prototype,"boundingBoxSize",null),(0,k.d)([(0,c.Q)("rotationY")],g.prototype,"rotationY",null),(0,k.d)([(0,c.Q)("files")],g.prototype,"_files",void 0),(0,k.d)([(0,c.Q)("forcedExtension")],g.prototype,"_forcedExtension",void 0),(0,k.d)([(0,c.Q)("extensions")],g.prototype,"_extensions",void 0),(0,k.d)([(0,c.z)("textureMatrix")],g.prototype,"_textureMatrix",void 0),(0,k.d)([(0,c.z)("textureMatrixRefraction")],g.prototype,"_textureMatrixRefraction",void 0),U.d._CubeTextureParser=g.Parse,(0,J.h)("BABYLON.CubeTexture",g)},13532:(R,x,H)=>{"use strict";H.d(x,{e:()=>U});var k=H(493),c=H(2311),t=H(619),A=H(2355),D=H(590);A.ThinEngine.prototype.createDynamicTexture=function(R,x,H,k){const c=new D.b(this,4);return c.baseWidth=R,c.baseHeight=x,H&&(R=this.needPOTTextures?(0,t.h)(R,this._caps.maxTextureSize):R,x=this.needPOTTextures?(0,t.h)(x,this._caps.maxTextureSize):x),c.width=R,c.height=x,c.isReady=!1,c.generateMipMaps=H,c.samplingMode=k,this.updateTextureSamplingMode(k,c),this._internalTexturesCache.push(c),c},A.ThinEngine.prototype.updateDynamicTexture=function(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!R)return;const A=this._gl,D=A.TEXTURE_2D,U=this._bindTextureDirectly(D,R,!0,t);this._unpackFlipY(void 0===H?R.invertY:H),k&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const J=this._getWebGLTextureType(R.type),V=this._getInternalFormat(c||R.format),n=this._getRGBABufferInternalSizedFormat(R.type,V);A.texImage2D(D,0,n,V,J,x),R.generateMipMaps&&A.generateMipmap(D),U||this._bindTextureDirectly(D,null),k&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),c&&(R.format=c),R._dynamicTextureSource=x,R._premulAlpha=k,R.invertY=H||!1,R.isReady=!0};class U extends c.d{constructor(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,D=arguments.length>6?arguments[6]:void 0;const U=!H||H._isScene;super(null,U?H:null===H||void 0===H?void 0:H.Yk,U?!k:H,D,t,void 0,void 0,void 0,void 0,A),this.name=R,this.wrapU=c.d.CLAMP_ADDRESSMODE,this.wrapV=c.d.CLAMP_ADDRESSMODE,this._generateMipMaps=k;const J=this._getEngine();if(!J)return;if(x.getContext)this._canvas=x,this._ownCanvas=!1,this._texture=J.createDynamicTexture(this._canvas.width,this._canvas.height,k,t);else{this._canvas=J.createCanvas(1,1),this._ownCanvas=!0;const R=x;R.width||0===R.width?this._texture=J.createDynamicTexture(R.width,R.height,k,t):this._texture=J.createDynamicTexture(x,x,k,t)}const V=this.getSize();this._canvas.width!==V.width&&(this._canvas.width=V.width),this._canvas.height!==V.height&&(this._canvas.height=V.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(R){this._canvas.width=R.width,this._canvas.height=R.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(R.width,R.height,this._generateMipMaps,this.samplingMode)}scale(R){const x=this.getSize();x.width*=R,x.height*=R,this._recreate(x)}scaleTo(R,x){const H=this.getSize();H.width=R,H.height=x,this._recreate(H)}getContext(){return this._context}clear(R){const x=this.getSize();R&&(this._context.fillStyle=R),this._context.clearRect(0,0,x.width,x.height)}update(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===R||R,x,this._format||void 0,void 0,H)}drawText(R,x,H,k,c,t,A){let D=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this.getSize();if(t&&(this._context.fillStyle=t,this._context.fillRect(0,0,U.width,U.height)),this._context.font=k,null===x||void 0===x){const H=this._context.measureText(R);x=(U.width-H.width)/2}if(null===H||void 0===H){const R=parseInt(k.replace(/\D/g,""));H=U.height/2+R/3.65}this._context.fillStyle=c||"",this._context.fillText(R,x,H),D&&this.update(A)}dispose(){var R,x;(super.dispose(),this._ownCanvas)&&(null===(R=this._canvas)||void 0===R||null===(x=R.remove)||void 0===x||x.call(R));this._canvas=null,this._context=null}clone(){const R=this.va();if(!R)return this;const x=this.getSize(),H=new U(this.name,x,R,this._generateMipMaps);return H.Qj=this.Qj,H.level=this.level,H.wrapU=this.wrapU,H.wrapV=this.wrapV,H}serialize(){const R=this.va();R&&!R.isReady()&&k.c.Warn("The scene must be ready before serializing the dynamic texture");const x=super.serialize();return U._IsCanvasElement(this._canvas)&&(x.base64String=this._canvas.toDataURL()),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x}static _IsCanvasElement(R){return void 0!==R.toDataURL}_rebuild(){this.update()}}},13140:(R,x,H)=>{"use strict";H.d(x,{d:()=>c});var k=H(2311);class c extends k.d{get depth(){return this._depth}constructor(R,x,H,c,t,A){let D=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:k.d.TRILINEAR_SAMPLINGMODE,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,n=arguments.length>10?arguments[10]:void 0;super(null,A,!D,U),this.format=t,this._texture=A.getEngine().createRawTexture2DArray(R,x,H,c,t,D,U,J,null,V,n),this._depth=c,this.is2DArray=!0}update(R){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,R,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(R,x,H,k,t){return new c(R,x,H,k,5,t,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12945:(R,x,H)=>{"use strict";H.d(x,{d:()=>D,f:()=>U,g:()=>t,j:()=>A});var k=H(681),c=H(661);function t(R,x){return`{X: ${R.x.toFixed(x)} Y: ${R.y.toFixed(x)}}`}function A(R,x){return`{X: ${R._x.toFixed(x)} Y: ${R._y.toFixed(x)} Z: ${R._z.toFixed(x)}}`}function D(R,x){return 2*Math.acos((0,k.Clamp)(c.f.Dot(R,x)))}function U(R,x){const H=new c.f;return function(R,x,H){const t=c.o.Cross(R,x),A=Math.acos((0,k.Clamp)(c.o.Dot(R,x),-1,1));c.f.RotationAxisToRef(t,A,H)}(R,x,H),H}},12770:(R,x,H)=>{"use strict";H.d(x,{c:()=>J});var k=H(661),c=H(695),t=H(471),A=H(744),D=H(809);H(12777);function U(R){let x=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const H=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],t=[];let U=[];const J=R.width||R.size||1,V=R.height||R.size||1,n=R.depth||R.size||1,g=R.wrap||!1;let I=void 0===R.topBaseAt?1:R.topBaseAt,i=void 0===R.bottomBaseAt?0:R.bottomBaseAt;I=(I+4)%4,i=(i+4)%4;let q=[2,0,3,1][I],S=[2,0,1,3][i],L=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(g){x=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],L=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let R=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],H=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const k=[17,18,19,16],c=[22,23,20,21];for(;q>0;)R.unshift(R.pop()),k.unshift(k.pop()),q--;for(;S>0;)H.unshift(H.pop()),c.unshift(c.pop()),S--;R=R.flat(),H=H.flat(),L=L.concat(R).concat(H),x.push(k[0],k[2],k[3],k[0],k[1],k[2]),x.push(c[0],c[2],c[3],c[0],c[1],c[2])}const b=[J/2,V/2,n/2];U=L.reduce(((R,x,H)=>R.concat(x*b[H%3])),[]);const C=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE,F=R.faceUV||new Array(6),d=R.faceColors,P=[];for(let A=0;A<6;A++)void 0===F[A]&&(F[A]=new k.p(0,0,1,1)),d&&void 0===d[A]&&(d[A]=new c.d(1,1,1,1));for(let k=0;k<6;k++)if(t.push(F[k].z,D.e?1-F[k].w:F[k].w),t.push(F[k].x,D.e?1-F[k].w:F[k].w),t.push(F[k].x,D.e?1-F[k].y:F[k].y),t.push(F[k].z,D.e?1-F[k].y:F[k].y),d)for(let R=0;R<4;R++)P.push(d[k].r,d[k].g,d[k].b,d[k].a);A.d._ComputeSides(C,U,x,H,t,R.frontUVs,R.backUVs);const a=new A.d;if(a.indices=x,a.xa=U,a.ya=H,a.Aa=t,d){const R=C===A.d.DOUBLESIDE?P.concat(P):P;a.za=R}return a}function J(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new t.d(R,H);x.sideOrientation=t.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return U(x).Ca(k,x.updatable),k}A.d.CreateBox=U,t.d.CreateBox=function(R,x){return J(R,{size:x,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12777:(R,x,H)=>{"use strict";H.d(x,{f:()=>S,b:()=>b,h:()=>L});var k=H(661),c=H(695),t=H(471),A=H(744),D=H(724);t.d._GroundMeshParser=(R,x)=>U.Parse(R,x);class U extends t.d{constructor(R,x){super(R,x),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=R,this._subdivisionsY=R,this.subdivide(R);const H=this;H.createOrUpdateSubmeshesOctree&&H.createOrUpdateSubmeshesOctree(x)}getHeightAtCoordinates(R,x){const H=this.getWorldMatrix(),c=k.g.Matrix[5];H.invertToRef(c);const t=k.g.Bi[8];if(k.o.TransformCoordinatesFromFloatsToRef(R,0,x,c,t),R=t.x,x=t.z,R<this._minX||R>=this._maxX||x<=this._minZ||x>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const A=this._getFacetAt(R,x),D=-(A.x*R+A.z*x+A.w)/A.y;return k.o.TransformCoordinatesFromFloatsToRef(0,D,0,H,t),t.y}getNormalAtCoordinates(R,x){const H=new k.o(0,1,0);return this.getNormalAtCoordinatesToRef(R,x,H),H}getNormalAtCoordinatesToRef(R,x,H){const c=this.getWorldMatrix(),t=k.g.Matrix[5];c.invertToRef(t);const A=k.g.Bi[8];if(k.o.TransformCoordinatesFromFloatsToRef(R,0,x,t,A),R=A.x,x=A.z,R<this._minX||R>this._maxX||x<this._minZ||x>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const D=this._getFacetAt(R,x);return k.o.TransformNormalFromFloatsToRef(D.x,D.y,D.z,c,H),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(R,x){const H=Math.floor((R+this._maxX)*this._subdivisionsX/this._width),k=Math.floor(-(x+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),c=this._heightQuads[k*this._subdivisionsX+H];let t;return t=x<c.slope.x*R+c.slope.y?c.facet1:c.facet2,t}_initHeightQuads(){const R=this._subdivisionsX,x=this._subdivisionsY;this._heightQuads=[];for(let H=0;H<x;H++)for(let x=0;x<R;x++){const c={slope:k.k.Zero(),facet1:new k.p(0,0,0,0),facet2:new k.p(0,0,0,0)};this._heightQuads[H*R+x]=c}return this}_computeHeightQuads(){const R=this.getVerticesData(D.g.PositionKind);if(!R)return this;const x=k.g.Bi[3],H=k.g.Bi[2],c=k.g.Bi[1],t=k.g.Bi[0],A=k.g.Bi[4],U=k.g.Bi[5],J=k.g.Bi[6],V=k.g.Bi[7],n=k.g.Bi[8];let g=0,I=0,i=0,q=0,S=0,L=0,b=0;const C=this._subdivisionsX,F=this._subdivisionsY;for(let D=0;D<F;D++)for(let F=0;F<C;F++){g=3*F,I=D*(C+1)*3,i=(D+1)*(C+1)*3,x.x=R[I+g],x.y=R[I+g+1],x.z=R[I+g+2],H.x=R[I+g+3],H.y=R[I+g+4],H.z=R[I+g+5],c.x=R[i+g],c.y=R[i+g+1],c.z=R[i+g+2],t.x=R[i+g+3],t.y=R[i+g+4],t.z=R[i+g+5],q=(t.z-x.z)/(t.x-x.x),S=x.z-q*x.x,H.subtractToRef(x,A),c.subtractToRef(x,U),t.subtractToRef(x,J),k.o.CrossToRef(J,U,V),k.o.CrossToRef(A,J,n),V.normalize(),n.normalize(),L=-(V.x*x.x+V.y*x.y+V.z*x.z),b=-(n.x*H.x+n.y*H.y+n.z*H.z);const d=this._heightQuads[D*C+F];d.slope.si(q,S),d.facet1.si(V.x,V.y,V.z,L),d.facet2.si(n.x,n.y,n.z,b)}return this}serialize(R){super.serialize(R),R.subdivisionsX=this._subdivisionsX,R.subdivisionsY=this._subdivisionsY,R.minX=this._minX,R.maxX=this._maxX,R.Hi=this._minZ,R.maxZ=this._maxZ,R.width=this._width,R.height=this._height}static Parse(R,x){const H=new U(R.name,x);return H._subdivisionsX=R.subdivisionsX||1,H._subdivisionsY=R.subdivisionsY||1,H._minX=R.minX,H._maxX=R.maxX,H._minZ=R.Hi,H._maxZ=R.maxZ,H._width=R.width,H._height=R.height,H}}var J=H(485),V=H(513),n=H(668),g=H(809);function I(R){const x=[],H=[],c=[],t=[];let D,U;const J=R.width||R.size||1,V=R.height||R.size||1,n=0|(R.subdivisionsX||R.subdivisions||1),I=0|(R.subdivisionsY||R.subdivisions||1);for(D=0;D<=I;D++)for(U=0;U<=n;U++){const R=new k.o(U*J/n-J/2,0,(I-D)*V/I-V/2),x=new k.o(0,1,0);H.push(R.x,R.y,R.z),c.push(x.x,x.y,x.z),t.push(U/n,g.e?D/I:1-D/I)}for(D=0;D<I;D++)for(U=0;U<n;U++)x.push(U+1+(D+1)*(n+1)),x.push(U+1+D*(n+1)),x.push(U+D*(n+1)),x.push(U+(D+1)*(n+1)),x.push(U+1+(D+1)*(n+1)),x.push(U+D*(n+1));const i=new A.d;return i.indices=x,i.xa=H,i.ya=c,i.Aa=t,i}function i(R){const x=void 0!==R.xmin&&null!==R.xmin?R.xmin:-1,H=void 0!==R.zmin&&null!==R.zmin?R.zmin:-1,c=void 0!==R.xmax&&null!==R.xmax?R.xmax:1,t=void 0!==R.zmax&&null!==R.zmax?R.zmax:1,D=R.subdivisions||{w:1,h:1},U=R.precision||{w:1,h:1},J=[],V=[],n=[],g=[];let I,i,q,S;D.h=D.h<1?1:D.h,D.w=D.w<1?1:D.w,U.w=U.w<1?1:U.w,U.h=U.h<1?1:U.h;const L=(c-x)/D.w,b=(t-H)/D.h;function C(R,x,H,c){const t=V.length/3,A=U.w+1;for(I=0;I<U.h;I++)for(i=0;i<U.w;i++){const R=[t+i+I*A,t+(i+1)+I*A,t+(i+1)+(I+1)*A,t+i+(I+1)*A];J.push(R[1]),J.push(R[2]),J.push(R[3]),J.push(R[0]),J.push(R[1]),J.push(R[3])}const D=k.o.Zero(),q=new k.o(0,1,0);for(I=0;I<=U.h;I++)for(D.z=I*(c-x)/U.h+x,i=0;i<=U.w;i++)D.x=i*(H-R)/U.w+R,D.y=0,V.push(D.x,D.y,D.z),n.push(q.x,q.y,q.z),g.push(i/U.w,I/U.h)}for(q=0;q<D.h;q++)for(S=0;S<D.w;S++)C(x+S*L,H+q*b,x+(S+1)*L,H+(q+1)*b);const F=new A.d;return F.indices=J,F.xa=V,F.ya=n,F.Aa=g,F}function q(R){const x=[],H=[],t=[],D=[];let U,J;const V=R.colorFilter||new c.c(.3,.59,.11),g=R.alphaFilter||0;let I=!1;if(R.minHeight>R.maxHeight){I=!0;const x=R.maxHeight;R.maxHeight=R.minHeight,R.minHeight=x}for(U=0;U<=R.subdivisions;U++)for(J=0;J<=R.subdivisions;J++){const x=new k.o(J*R.width/R.subdivisions-R.width/2,0,(R.subdivisions-U)*R.height/R.subdivisions-R.height/2),c=4*(((x.x+R.width/2)/R.width*(R.bufferWidth-1)|0)+((1-(x.z+R.height/2)/R.height)*(R.bufferHeight-1)|0)*R.bufferWidth);let A=R.buffer[c]/255,i=R.buffer[c+1]/255,q=R.buffer[c+2]/255;const S=R.buffer[c+3]/255;I&&(A=1-A,i=1-i,q=1-q);const L=A*V.r+i*V.g+q*V.b;x.y=S>=g?R.minHeight+(R.maxHeight-R.minHeight)*L:R.minHeight-n.e,R.heightBuffer&&(R.heightBuffer[U*(R.subdivisions+1)+J]=x.y),H.push(x.x,x.y,x.z),t.push(0,0,0),D.push(J/R.subdivisions,1-U/R.subdivisions)}for(U=0;U<R.subdivisions;U++)for(J=0;J<R.subdivisions;J++){const k=J+1+(U+1)*(R.subdivisions+1),c=J+1+U*(R.subdivisions+1),t=J+U*(R.subdivisions+1),A=J+(U+1)*(R.subdivisions+1),D=H[3*k+1]>=R.minHeight,V=H[3*c+1]>=R.minHeight,n=H[3*t+1]>=R.minHeight;D&&V&&n&&(x.push(k),x.push(c),x.push(t));H[3*A+1]>=R.minHeight&&D&&n&&(x.push(A),x.push(k),x.push(t))}A.d.ComputeNormals(H,x,t);const i=new A.d;return i.indices=x,i.xa=H,i.ya=t,i.Aa=D,i}function S(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=new U(R,arguments.length>2?arguments[2]:void 0);H._setReady(!1),H._subdivisionsX=x.subdivisionsX||x.subdivisions||1,H._subdivisionsY=x.subdivisionsY||x.subdivisions||1,H._width=x.width||1,H._height=x.height||1,H._maxX=H._width/2,H._maxZ=H._height/2,H._minX=-H._maxX,H._minZ=-H._maxZ;return I(x).Ca(H,x.updatable),H._setReady(!0),H}function L(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new t.d(R,H);return i(x).Ca(k,x.updatable),k}function b(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=H.width||10,A=H.height||10,D=H.subdivisions||1,n=H.minHeight||0,g=H.maxHeight||1,I=H.colorFilter||new c.c(.3,.59,.11),i=H.alphaFilter||0,S=H.updatable,L=H.onReady;k=k||V.c.LastCreatedScene;const b=new U(R,k);let C;b._subdivisionsX=D,b._subdivisionsY=D,b._width=t,b._height=A,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ,b._setReady(!1),H.passHeightBufferInCallback&&(C=new Float32Array((D+1)*(D+1)));const F=(R,x,H)=>{q({width:t,height:A,subdivisions:D,minHeight:n,maxHeight:g,colorFilter:I,buffer:R,bufferWidth:x,bufferHeight:H,alphaFilter:i,heightBuffer:C}).Ca(b,S),L&&L(b,C),b._setReady(!0)};if("string"===typeof x){const R=R=>{var x;const H=R.width,c=R.height;if(k.u)return;const t=null===(x=k)||void 0===x?void 0:x.getEngine().resizeImageBitmap(R,H,c);F(t,H,c)};J.e.LoadImage(x,R,H.onError?H.onError:()=>{},k.offlineProvider)}else F(x.data,x.width,x.height);return b}A.d.CreateGround=I,A.d.CreateTiledGround=i,A.d.CreateGroundFromHeightMap=q,t.d.CreateGround=(R,x,H,k,c,t)=>S(R,{width:x,height:H,subdivisions:k,updatable:t},c),t.d.CreateTiledGround=(R,x,H,k,c,t,A,D,U)=>L(R,{xmin:x,zmin:H,xmax:k,zmax:c,subdivisions:t,precision:A,updatable:U},D),t.d.CreateGroundFromHeightMap=(R,x,H,k,c,t,A,D,U,J,V)=>b(R,x,{width:H,height:k,subdivisions:c,minHeight:t,maxHeight:A,updatable:U,onReady:J,alphaFilter:V},D)},13419:(R,x,H)=>{"use strict";H.d(x,{e:()=>I,i:()=>n,l:()=>g});var k=H(661),c=H(471),t=H(744),A=H(12356),D=H(724),U=H(493);function J(R){const x=[],H=[],k=R.lines,c=R.za,A=[];let D=0;for(let t=0;t<k.length;t++){const R=k[t];for(let k=0;k<R.length;k++){const{x:U,y:J,z:V}=R[k];if(H.push(U,J,V),c){const R=c[t],{r:x,g:H,b:D,a:U}=R[k];A.push(x,H,D,U)}k>0&&(x.push(D-1),x.push(D)),D++}}const U=new t.d;return U.indices=x,U.xa=H,c&&(U.za=A),U}function V(R){const x=R.dashSize||3,H=R.gapSize||1,c=R.dashNb||200,A=R.points,D=[],U=[],J=k.o.Zero();let V=0,n=0,g=0,I=0,i=0,q=0,S=0;for(S=0;S<A.length-1;S++)A[S+1].subtractToRef(A[S],J),V+=J.length();for(g=V/c,I=x*g/(x+H),S=0;S<A.length-1;S++){A[S+1].subtractToRef(A[S],J),n=Math.floor(J.length()/g),J.normalize();for(let R=0;R<n;R++)i=g*R,D.push(A[S].x+i*J.x,A[S].y+i*J.y,A[S].z+i*J.z),D.push(A[S].x+(i+I)*J.x,A[S].y+(i+I)*J.y,A[S].z+(i+I)*J.z),U.push(q,q+1),q+=2}const L=new t.d;return L.xa=D,L.indices=U,L}function n(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=x.instance,c=x.lines,t=x.za;if(k){const R=k.getVerticesData(D.g.PositionKind);let x,H;t&&(x=k.getVerticesData(D.g.ColorKind));let A=0,U=0;for(let k=0;k<c.length;k++){const D=c[k];for(let c=0;c<D.length;c++)R[A]=D[c].x,R[A+1]=D[c].y,R[A+2]=D[c].z,t&&x&&(H=t[k],x[U]=H[c].r,x[U+1]=H[c].g,x[U+2]=H[c].b,x[U+3]=H[c].a,U+=4),A+=3}return k.updateVerticesData(D.g.PositionKind,R,!1,!1),t&&x&&k.updateVerticesData(D.g.ColorKind,x,!1,!1),k.refreshBoundingInfo(),k}const U=!!t,V=new A.e(R,H,null,void 0,void 0,U,x.useVertexAlpha,x.material);return J(x).Ca(V,x.updatable),V}function g(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=x.za?[x.za]:null;return n(R,{lines:[x.points],updatable:x.updatable,instance:x.instance,za:k,useVertexAlpha:x.useVertexAlpha,material:x.material},H)}function I(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=x.points,D=x.instance,J=x.gapSize||1,n=x.dashSize||3;if(D){const R=R=>{const x=k.o.Zero(),H=R.length/6;let c=0,A=0,U=0,J=0,V=0,n=0,g=0,I=0;for(g=0;g<t.length-1;g++)t[g+1].subtractToRef(t[g],x),c+=x.length();U=c/H;const i=D._creationDataStorage.dashSize;for(J=i*U/(i+D._creationDataStorage.gapSize),g=0;g<t.length-1;g++)for(t[g+1].subtractToRef(t[g],x),A=Math.floor(x.length()/U),x.normalize(),I=0;I<A&&n<R.length;)V=U*I,R[n]=t[g].x+V*x.x,R[n+1]=t[g].y+V*x.y,R[n+2]=t[g].z+V*x.z,R[n+3]=t[g].x+(V+J)*x.x,R[n+4]=t[g].y+(V+J)*x.y,R[n+5]=t[g].z+(V+J)*x.z,n+=6,I++;for(;n<R.length;)R[n]=t[g].x,R[n+1]=t[g].y,R[n+2]=t[g].z,n+=3};return(x.dashNb||x.dashSize||x.gapSize||x.useVertexAlpha||x.material)&&U.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),D.updateMeshPositions(R,!1),D}const g=new A.e(R,H,null,void 0,void 0,void 0,x.useVertexAlpha,x.material);return V(x).Ca(g,x.updatable),g._creationDataStorage=new c.h,g._creationDataStorage.dashSize=n,g._creationDataStorage.gapSize=J,g}t.d.CreateLineSystem=J,t.d.CreateDashedLines=V,c.d.Qi=function(R,x){return g(R,{points:x,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},c.d.CreateDashedLines=function(R,x,H,k,c){return I(R,{points:x,dashSize:H,gapSize:k,dashNb:c,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12829:(R,x,H)=>{"use strict";H.d(x,{d:()=>D,e:()=>U});var k=H(471),c=H(744),t=H(809);function A(R){const x=[],H=[],k=[],A=[],D=void 0!==R.width?R.width:void 0!==R.size?R.size:1,U=void 0!==R.height?R.height:void 0!==R.size?R.size:1,J=0===R.sideOrientation?0:R.sideOrientation||c.d.DEFAULTSIDE,V=D/2,n=U/2;H.push(-V,-n,0),k.push(0,0,-1),A.push(0,t.e?1:0),H.push(V,-n,0),k.push(0,0,-1),A.push(1,t.e?1:0),H.push(V,n,0),k.push(0,0,-1),A.push(1,t.e?0:1),H.push(-V,n,0),k.push(0,0,-1),A.push(0,t.e?0:1),x.push(0),x.push(1),x.push(2),x.push(0),x.push(2),x.push(3),c.d._ComputeSides(J,H,x,k,A,R.frontUVs,R.backUVs);const g=new c.d;return g.indices=x,g.xa=H,g.ya=k,g.Aa=A,g}function D(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new k.d(R,H);x.sideOrientation=k.d._GetDefaultSideOrientation(x.sideOrientation),c._originalBuilderSideOrientation=x.sideOrientation;return A(x).Ca(c,x.updatable),x.sourcePlane&&(c.translate(x.sourcePlane.dj,-x.sourcePlane.d),c.setDirection(x.sourcePlane.dj.scale(-1))),c}const U={Ri:D};c.d.Ri=A,k.d.Ri=(R,x,H,k,c)=>D(R,{size:x,width:x,height:x,sideOrientation:c,updatable:k},H)},12927:(R,x,H)=>{"use strict";H.d(x,{e:()=>U});var k=H(661),c=H(471),t=H(744),A=H(809);function D(R){const x=0|(R.segments||32),H=R.diameterX||R.diameter||1,c=R.diameterY||R.diameter||1,D=R.diameterZ||R.diameter||1,U=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,J=R.slice&&R.slice<=0?1:R.slice||1,V=0===R.sideOrientation?0:R.sideOrientation||t.d.DEFAULTSIDE,n=!!R.dedupTopBottomIndices,g=new k.o(H/2,c/2,D/2),I=2+x,i=2*I,q=[],S=[],L=[],b=[];for(let t=0;t<=I;t++){const R=t/I,x=R*Math.PI*J;for(let H=0;H<=i;H++){const c=H/i,t=c*Math.PI*2*U,D=k.e.RotationZ(-x),J=k.e.RotationY(t),V=k.o.TransformCoordinates(k.o.Up(),D),n=k.o.TransformCoordinates(V,J),I=n.multiply(g),q=n.divide(g).normalize();S.push(I.x,I.y,I.z),L.push(q.x,q.y,q.z),b.push(c,A.e?1-R:R)}if(t>0){const R=S.length/3;for(let x=R-2*(i+1);x+i+2<R;x++)n?(t>1&&(q.push(x),q.push(x+1),q.push(x+i+1)),(t<I||J<1)&&(q.push(x+i+1),q.push(x+1),q.push(x+i+2))):(q.push(x),q.push(x+1),q.push(x+i+1),q.push(x+i+1),q.push(x+1),q.push(x+i+2))}}t.d._ComputeSides(V,S,q,L,b,R.frontUVs,R.backUVs);const C=new t.d;return C.indices=q,C.xa=S,C.ya=L,C.Aa=b,C}function U(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return D(x).Ca(k,x.updatable),k}t.d.CreateSphere=D,c.d.CreateSphere=(R,x,H,k,c,t)=>U(R,{segments:x,diameterX:H,diameterY:H,diameterZ:H,sideOrientation:t,updatable:c},k)},13546:(R,x,H)=>{"use strict";H.d(x,{c:()=>D});var k=H(12380),c=H(13222),t=H(12391),A=H(744);class D{static get Configuration(){return{get decoder(){return c.d.DefaultConfiguration},set decoder(R){c.d.DefaultConfiguration=R}}}static set Configuration(R){c.d.DefaultConfiguration=R.decoder}static get DecoderAvailable(){return(0,k.g)(c.d.DefaultConfiguration)}static get Default(){return D._Default??(D._Default=new D),D._Default}static ResetDefault(R){D._Default&&(R||D._Default.dispose(),D._Default=null)}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.DefaultNumWorkers;const x="number"===typeof R?{...c.d.DefaultConfiguration,numWorkers:R}:{...c.d.DefaultConfiguration,...R};this._decoder=new c.d(x)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(R,x,H){return this._decoder.decodeMeshToMeshDataAsync(R,x,H)}async decodeMeshToGeometryAsync(R,x,H,k){return await this._decoder.decodeMeshToGeometryAsync(R,x,H,k)}async _decodeMeshToGeometryForGltfAsync(R,x,H,k,c,t){return await this._decoder._decodeMeshToGeometryForGltfAsync(R,x,H,k,c,t)}async decodeMeshAsync(R,x){const H=await this._decoder.decodeMeshToMeshDataAsync(R,x),k=new A.d;H.indices&&(k.indices=H.indices);for(const c of H.attributes){const R=t.e.GetFloatData(c.data,c.size,t.e.GetDataType(c.data),c.byteOffset,c.byteStride,c.normalized,H.totalVertices);k.set(R,c.kind)}return k}}D.DefaultNumWorkers=(0,k.c)(),D._Default=null},13222:(R,x,H)=>{"use strict";H.d(x,{d:()=>J});var k=H(12380),c=H(485),t=H(798),A=H(12391),D=H(493),U=H(12385);class J extends k.b{static get DefaultAvailable(){return(0,k.g)(J.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(R){J._Default&&(R||J._Default.dispose(),J._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(R,x){return{module:await(x||DracoDecoderModule)({wasmBinary:R})}}_getWorkerContent(){return`${U.c}(${U.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultConfiguration)}decodeMeshToMeshDataAsync(R,x,H){const k=R instanceof ArrayBuffer?new Int8Array(R):new Int8Array(R.buffer,R.byteOffset,R.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async R=>await new Promise(((c,t)=>{R.push(((R,A)=>{let U=null;const J=[],V=x=>{R.removeEventListener("error",V),R.removeEventListener("message",n),t(x),A()},n=x=>{const k=x.data;switch(k.id){case"indices":U=k.data;break;case"attribute":J.push({kind:k.kind,data:k.data,size:k.size,byteOffset:k.byteOffset,byteStride:k.byteStride,normalized:(t=k.kind,g=k.normalized,H&&void 0!==H[t]?(g!==H[t]&&D.c.Warn(`Normalized flag from Draco data (${g}) does not match normalized flag from glTF accessor (${H[t]}). Using flag from glTF accessor.`),H[t]):g)});break;case"decodeMeshDone":R.removeEventListener("error",V),R.removeEventListener("message",n),c({indices:U,attributes:J,totalVertices:k.totalVertices}),A()}var t,g};R.addEventListener("error",V),R.addEventListener("message",n);const g=k.slice();R.postMessage({id:"decodeMesh",dataView:g,attributes:x},[g.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((R=>{let H=null;const c=[],t=(0,U.c)(R.module,k,x,(R=>{H=R}),((R,x,H,k,t,A)=>{c.push({kind:R,data:x,size:H,byteOffset:k,byteStride:t,normalized:A})}));return{indices:H,attributes:c,totalVertices:t}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(R,x,H,k){const c=await this.decodeMeshToMeshDataAsync(H,k),D=new t.c(R,x);c.indices&&D.setIndices(c.indices);for(const t of c.attributes)D.setVerticesBuffer(new A.e(x.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),c.totalVertices);return D}async _decodeMeshToGeometryForGltfAsync(R,x,H,k,c,D){const U=await this.decodeMeshToMeshDataAsync(H,k,c),J=new t.c(R,x);D&&(J._boundingInfo=D,J.useBoundingInfoFromGeometry=!0),U.indices&&J.setIndices(U.indices);for(const t of U.attributes)J.setVerticesBuffer(new A.e(x.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),U.totalVertices);return J}}J.DefaultConfiguration={wasmUrl:`${c.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${c.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${c.e._DefaultCdnUrl}/draco_decoder_gltf.js`},J._Default=null},13416:(R,x,H)=>{"use strict";H.d(x,{b:()=>DR});var k=H(661),c=H(471),t=H(724),A=H(744),D=H(809);function U(R){let x=R.pathArray;const H=R.closeArray||!1,k=R.closePath||!1,c=R.invertUV||!1,U=Math.floor(x[0].length/2);let J=R.offset||U;J=J>U?U:Math.floor(J);const V=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE,n=R.Aa,g=R.za,I=[],i=[],q=[],S=[],L=[],b=[],C=[],F=[];let d;const P=[],a=[];let X,M,B;if(x.length<2){const R=[],H=[];for(M=0;M<x[0].length-J;M++)R.push(x[0][M]),H.push(x[0][M+J]);x=[R,H]}let o=0;const Z=k?1:0,y=H?1:0;let s,E,w,h,f,N;for(d=x[0].length,X=0;X<x.length+y;X++){for(C[X]=0,L[X]=[0],s=X===x.length?x[0]:x[X],E=s.length,d=d<E?d:E,B=0;B<E;)I.push(s[B].x,s[B].y,s[B].z),B>0&&(w=s[B].Pg(s[B-1]).length(),h=w+C[X],L[X].push(h),C[X]=h),B++;k&&(B--,I.push(s[0].x,s[0].y,s[0].z),w=s[B].Pg(s[0]).length(),h=w+C[X],L[X].push(h),C[X]=h),P[X]=E+Z,a[X]=o,o+=E+Z}let W,K,Q=null,G=null;for(M=0;M<d+Z;M++)for(F[M]=0,b[M]=[0],X=0;X<x.length-1+y;X++)f=x[X],N=X===x.length-1?x[0]:x[X+1],M===d?(Q=f[0],G=N[0]):(Q=f[M],G=N[M]),w=G.Pg(Q).length(),h=w+F[M],b[M].push(h),F[M]=h;if(n)for(X=0;X<n.length;X++)S.push(n[X].x,D.e?1-n[X].y:n[X].y);else for(X=0;X<x.length+y;X++)for(M=0;M<d+Z;M++)W=0!=C[X]?L[X][M]/C[X]:0,K=0!=F[M]?b[M][X]/F[M]:0,c?S.push(K,W):S.push(W,D.e?1-K:K);X=0;let T=0,v=P[X]-1,p=P[X+1]-1,r=v<p?v:p,z=a[1]-a[0];const j=P.length-1;for(;T<=r&&X<j;)i.push(T,T+z,T+1),i.push(T+z+1,T+1,T+z),T+=1,T===r&&(X++,z=a[X+1]-a[X],v=P[X]-1,p=P[X+1]-1,T=a[X],r=v<p?v+T:p+T);if(A.d.ComputeNormals(I,i,q),k){let R=0,H=0;for(X=0;X<x.length;X++){R=3*a[X],H=X+1<x.length?3*(a[X+1]-1):q.length-3,q[R]=.5*(q[R]+q[H]),q[R+1]=.5*(q[R+1]+q[H+1]),q[R+2]=.5*(q[R+2]+q[H+2]);const k=Math.sqrt(q[R]*q[R]+q[R+1]*q[R+1]+q[R+2]*q[R+2]);q[R]/=k,q[R+1]/=k,q[R+2]/=k,q[H]=q[R],q[H+1]=q[R+1],q[H+2]=q[R+2]}}if(H){let R=3*a[0],H=3*a[x.length];for(M=0;M<d+Z;M++){q[R]=.5*(q[R]+q[H]),q[R+1]=.5*(q[R+1]+q[H+1]),q[R+2]=.5*(q[R+2]+q[H+2]);const x=Math.sqrt(q[R]*q[R]+q[R+1]*q[R+1]+q[R+2]*q[R+2]);q[R]/=x,q[R+1]/=x,q[R+2]/=x,q[H]=q[R],q[H+1]=q[R+1],q[H+2]=q[R+2],R+=3,H+=3}}A.d._ComputeSides(V,I,i,q,S,R.frontUVs,R.backUVs);let m=null;if(g){m=new Float32Array(4*g.length);for(let R=0;R<g.length;R++)m[4*R]=g[R].r,m[4*R+1]=g[R].g,m[4*R+2]=g[R].b,m[4*R+3]=g[R].a}const O=new A.d,l=new Float32Array(I),e=new Float32Array(q),u=new Float32Array(S);return O.indices=i,O.xa=l,O.ya=e,O.Aa=u,m&&O.set(m,t.g.ColorKind),k&&(O._idx=a),O}function J(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=x.pathArray,V=x.closeArray,n=x.closePath,g=c.d._GetDefaultSideOrientation(x.sideOrientation),I=x.instance,i=x.updatable;if(I){const R=k.g.Bi[0].Ai(Number.MAX_VALUE),H=k.g.Bi[1].Ai(-Number.MAX_VALUE),U=x=>{let k=J[0].length;const t=I;let A=0;const D=t._originalBuilderSideOrientation===c.d.DOUBLESIDE?2:1;for(let c=1;c<=D;++c)for(let D=0;D<J.length;++D){const c=J[D],U=c.length;k=k<U?k:U;for(let t=0;t<k;++t){const k=c[t];x[A]=k.x,x[A+1]=k.y,x[A+2]=k.z,R.minimizeInPlaceFromFloats(k.x,k.y,k.z),H.maximizeInPlaceFromFloats(k.x,k.y,k.z),A+=3}if(t._creationDataStorage&&t._creationDataStorage.closePath){const R=c[0];x[A]=R.x,x[A+1]=R.y,x[A+2]=R.z,A+=3}}},V=I.getVerticesData(t.g.PositionKind);if(U(V),I.hasBoundingInfo?I.getBoundingInfo().reConstruct(R,H,I._worldMatrix):I.buildBoundingInfo(R,H,I._worldMatrix),I.updateVerticesData(t.g.PositionKind,V,!1,!1),x.za){const R=I.getVerticesData(t.g.ColorKind);for(let H=0,k=0;H<x.za.length;H++,k+=4){const c=x.za[H];R[k]=c.r,R[k+1]=c.g,R[k+2]=c.b,R[k+3]=c.a}I.updateVerticesData(t.g.ColorKind,R,!1,!1)}if(x.Aa){const R=I.getVerticesData(t.g.UVKind);for(let H=0;H<x.Aa.length;H++)R[2*H]=x.Aa[H].x,R[2*H+1]=D.e?1-x.Aa[H].y:x.Aa[H].y;I.updateVerticesData(t.g.UVKind,R,!1,!1)}if(!I.areNormalsFrozen||I.isFacetDataEnabled){const R=I.Gi(),x=I.getVerticesData(t.g.NormalKind),H=I.isFacetDataEnabled?I.getFacetDataParameters():null;if(A.d.ComputeNormals(V,R,x,H),I._creationDataStorage&&I._creationDataStorage.closePath){let R=0,H=0;for(let k=0;k<J.length;k++)R=3*I._creationDataStorage.idx[k],H=k+1<J.length?3*(I._creationDataStorage.idx[k+1]-1):x.length-3,x[R]=.5*(x[R]+x[H]),x[R+1]=.5*(x[R+1]+x[H+1]),x[R+2]=.5*(x[R+2]+x[H+2]),x[H]=x[R],x[H+1]=x[R+1],x[H+2]=x[R+2]}I.areNormalsFrozen||I.updateVerticesData(t.g.NormalKind,x,!1,!1)}return I}{const k=new c.d(R,H);k._originalBuilderSideOrientation=g,k._creationDataStorage=new c.h;const t=U(x);return n&&(k._creationDataStorage.idx=t._idx),k._creationDataStorage.closePath=n,k._creationDataStorage.closeArray=V,t.Ca(k,i),k}}A.d.CreateRibbon=U,c.d.CreateRibbon=function(R,x){return J(R,{pathArray:x,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var V=H(859),n=H(12770),g=H(695);function I(R){const x=R.pattern||c.d.NO_FLIP,H=R.tileWidth||R.tileSize||1,k=R.tileHeight||R.tileSize||1,t=R.alignHorizontal||0,D=R.alignVertical||0,U=R.width||R.size||1,J=Math.floor(U/H);let V=U-J*H;const n=R.height||R.size||1,g=Math.floor(n/k);let I=n-g*k;const i=H*J/2,q=k*g/2;let S=0,L=0,b=0,C=0,F=0,d=0;if(V>0||I>0){switch(b=-i,C=-q,F=i,d=q,t){case c.d.CENTER:V/=2,b-=V,F+=V;break;case c.d.LEFT:F+=V,S=-V/2;break;case c.d.RIGHT:b-=V,S=V/2}switch(D){case c.d.CENTER:I/=2,C-=I,d+=I;break;case c.d.BOTTOM:d+=I,L=-I/2;break;case c.d.TOP:C-=I,L=I/2}}const P=[],a=[],X=[];X[0]=[0,0,1,0,1,1,0,1],X[1]=[0,0,1,0,1,1,0,1],x!==c.d.ROTATE_TILE&&x!==c.d.ROTATE_ROW||(X[1]=[1,1,0,1,0,0,1,0]),x!==c.d.FLIP_TILE&&x!==c.d.FLIP_ROW||(X[1]=[1,0,0,0,0,1,1,1]),x!==c.d.FLIP_N_ROTATE_TILE&&x!==c.d.FLIP_N_ROTATE_ROW||(X[1]=[0,1,1,1,1,0,0,0]);let M=[];const B=[],o=[];let Z=0;for(let A=0;A<g;A++)for(let R=0;R<J;R++)P.push(R*H-i+S,A*k-q+L,0),P.push((R+1)*H-i+S,A*k-q+L,0),P.push((R+1)*H-i+S,(A+1)*k-q+L,0),P.push(R*H-i+S,(A+1)*k-q+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),M=x===c.d.FLIP_TILE||x===c.d.ROTATE_TILE||x===c.d.FLIP_N_ROTATE_TILE?M.concat(X[(R%2+A%2)%2]):x===c.d.FLIP_ROW||x===c.d.ROTATE_ROW||x===c.d.FLIP_N_ROTATE_ROW?M.concat(X[A%2]):M.concat(X[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Z+=4;if(V>0||I>0){const R=I>0&&(D===c.d.CENTER||D===c.d.TOP),A=I>0&&(D===c.d.CENTER||D===c.d.BOTTOM),U=V>0&&(t===c.d.CENTER||t===c.d.RIGHT),n=V>0&&(t===c.d.CENTER||t===c.d.LEFT);let X,y,s,E,w=[];if(R&&U&&(P.push(b+S,C+L,0),P.push(-i+S,C+L,0),P.push(-i+S,C+I+L,0),P.push(b+S,C+I+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,X=1-V/H,y=1-I/k,s=1,E=1,w=[X,y,s,y,s,E,X,E],x===c.d.ROTATE_ROW&&(w=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),x===c.d.FLIP_ROW&&(w=[1-X,y,1-s,y,1-s,E,1-X,E]),x===c.d.FLIP_N_ROTATE_ROW&&(w=[X,1-y,s,1-y,s,1-E,X,1-E]),M=M.concat(w),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R&&n&&(P.push(i+S,C+L,0),P.push(F+S,C+L,0),P.push(F+S,C+I+L,0),P.push(i+S,C+I+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,X=0,y=1-I/k,s=V/H,E=1,w=[X,y,s,y,s,E,X,E],(x===c.d.ROTATE_ROW||x===c.d.ROTATE_TILE&&J%2===0)&&(w=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),(x===c.d.FLIP_ROW||x===c.d.FLIP_TILE&&J%2===0)&&(w=[1-X,y,1-s,y,1-s,E,1-X,E]),(x===c.d.FLIP_N_ROTATE_ROW||x===c.d.FLIP_N_ROTATE_TILE&&J%2===0)&&(w=[X,1-y,s,1-y,s,1-E,X,1-E]),M=M.concat(w),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&U&&(P.push(b+S,q+L,0),P.push(-i+S,q+L,0),P.push(-i+S,d+L,0),P.push(b+S,d+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,X=1-V/H,y=0,s=1,E=I/k,w=[X,y,s,y,s,E,X,E],(x===c.d.ROTATE_ROW&&g%2===1||x===c.d.ROTATE_TILE&&g%1===0)&&(w=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),(x===c.d.FLIP_ROW&&g%2===1||x===c.d.FLIP_TILE&&g%2===0)&&(w=[1-X,y,1-s,y,1-s,E,1-X,E]),(x===c.d.FLIP_N_ROTATE_ROW&&g%2===1||x===c.d.FLIP_N_ROTATE_TILE&&g%2===0)&&(w=[X,1-y,s,1-y,s,1-E,X,1-E]),M=M.concat(w),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&n&&(P.push(i+S,q+L,0),P.push(F+S,q+L,0),P.push(F+S,d+L,0),P.push(i+S,d+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,X=0,y=0,s=V/H,E=I/k,w=[X,y,s,y,s,E,X,E],(x===c.d.ROTATE_ROW&&g%2===1||x===c.d.ROTATE_TILE&&(g+J)%2===1)&&(w=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),(x===c.d.FLIP_ROW&&g%2===1||x===c.d.FLIP_TILE&&(g+J)%2===1)&&(w=[1-X,y,1-s,y,1-s,E,1-X,E]),(x===c.d.FLIP_N_ROTATE_ROW&&g%2===1||x===c.d.FLIP_N_ROTATE_TILE&&(g+J)%2===1)&&(w=[X,1-y,s,1-y,s,1-E,X,1-E]),M=M.concat(w),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R){const R=[];X=0,y=1-I/k,s=1,E=1,R[0]=[X,y,s,y,s,E,X,E],R[1]=[X,y,s,y,s,E,X,E],x!==c.d.ROTATE_TILE&&x!==c.d.ROTATE_ROW||(R[1]=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),x!==c.d.FLIP_TILE&&x!==c.d.FLIP_ROW||(R[1]=[1-X,y,1-s,y,1-s,E,1-X,E]),x!==c.d.FLIP_N_ROTATE_TILE&&x!==c.d.FLIP_N_ROTATE_ROW||(R[1]=[X,1-y,s,1-y,s,1-E,X,1-E]);for(let k=0;k<J;k++)P.push(k*H-i+S,C+L,0),P.push((k+1)*H-i+S,C+L,0),P.push((k+1)*H-i+S,C+I+L,0),P.push(k*H-i+S,C+I+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=x===c.d.FLIP_TILE||x===c.d.ROTATE_TILE||x===c.d.FLIP_N_ROTATE_TILE?M.concat(R[(k+1)%2]):x===c.d.FLIP_ROW||x===c.d.ROTATE_ROW||x===c.d.FLIP_N_ROTATE_ROW?M.concat(R[1]):M.concat(R[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const R=[];X=0,y=0,s=1,E=I/k,R[0]=[X,y,s,y,s,E,X,E],R[1]=[X,y,s,y,s,E,X,E],x!==c.d.ROTATE_TILE&&x!==c.d.ROTATE_ROW||(R[1]=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),x!==c.d.FLIP_TILE&&x!==c.d.FLIP_ROW||(R[1]=[1-X,y,1-s,y,1-s,E,1-X,E]),x!==c.d.FLIP_N_ROTATE_TILE&&x!==c.d.FLIP_N_ROTATE_ROW||(R[1]=[X,1-y,s,1-y,s,1-E,X,1-E]);for(let k=0;k<J;k++)P.push(k*H-i+S,d-I+L,0),P.push((k+1)*H-i+S,d-I+L,0),P.push((k+1)*H-i+S,d+L,0),P.push(k*H-i+S,d+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=x===c.d.FLIP_TILE||x===c.d.ROTATE_TILE||x===c.d.FLIP_N_ROTATE_TILE?M.concat(R[(k+g)%2]):x===c.d.FLIP_ROW||x===c.d.ROTATE_ROW||x===c.d.FLIP_N_ROTATE_ROW?M.concat(R[g%2]):M.concat(R[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const R=[];X=1-V/H,y=0,s=1,E=1,R[0]=[X,y,s,y,s,E,X,E],R[1]=[X,y,s,y,s,E,X,E],x!==c.d.ROTATE_TILE&&x!==c.d.ROTATE_ROW||(R[1]=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),x!==c.d.FLIP_TILE&&x!==c.d.FLIP_ROW||(R[1]=[1-X,y,1-s,y,1-s,E,1-X,E]),x!==c.d.FLIP_N_ROTATE_TILE&&x!==c.d.FLIP_N_ROTATE_ROW||(R[1]=[X,1-y,s,1-y,s,1-E,X,1-E]);for(let H=0;H<g;H++)P.push(b+S,H*k-q+L,0),P.push(b+V+S,H*k-q+L,0),P.push(b+V+S,(H+1)*k-q+L,0),P.push(b+S,(H+1)*k-q+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=x===c.d.FLIP_TILE||x===c.d.ROTATE_TILE||x===c.d.FLIP_N_ROTATE_TILE?M.concat(R[(H+1)%2]):x===c.d.FLIP_ROW||x===c.d.ROTATE_ROW||x===c.d.FLIP_N_ROTATE_ROW?M.concat(R[H%2]):M.concat(R[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(n){const R=[];X=0,y=0,s=V/k,E=1,R[0]=[X,y,s,y,s,E,X,E],R[1]=[X,y,s,y,s,E,X,E],x!==c.d.ROTATE_TILE&&x!==c.d.ROTATE_ROW||(R[1]=[1-X,1-y,1-s,1-y,1-s,1-E,1-X,1-E]),x!==c.d.FLIP_TILE&&x!==c.d.FLIP_ROW||(R[1]=[1-X,y,1-s,y,1-s,E,1-X,E]),x!==c.d.FLIP_N_ROTATE_TILE&&x!==c.d.FLIP_N_ROTATE_ROW||(R[1]=[X,1-y,s,1-y,s,1-E,X,1-E]);for(let H=0;H<g;H++)P.push(F-V+S,H*k-q+L,0),P.push(F+S,H*k-q+L,0),P.push(F+S,(H+1)*k-q+L,0),P.push(F-V+S,(H+1)*k-q+L,0),o.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,M=x===c.d.FLIP_TILE||x===c.d.ROTATE_TILE||x===c.d.FLIP_N_ROTATE_TILE?M.concat(R[(H+J)%2]):x===c.d.FLIP_ROW||x===c.d.ROTATE_ROW||x===c.d.FLIP_N_ROTATE_ROW?M.concat(R[H%2]):M.concat(R[0]),B.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const y=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE;A.d._ComputeSides(y,P,o,a,M,R.frontUVs,R.backUVs);const s=new A.d;s.indices=o,s.xa=P,s.ya=a,s.Aa=M;const E=y===A.d.DOUBLESIDE?B.concat(B):B;return s.za=E,s}function i(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return I(x).Ca(k,x.updatable),k}function q(R){const x=R.faceUV||new Array(6),H=R.faceColors,t=R.pattern||c.d.NO_FLIP,U=R.width||R.size||1,J=R.height||R.size||1,V=R.depth||R.size||1,n=R.tileWidth||R.tileSize||1,i=R.tileHeight||R.tileSize||1,q=R.alignHorizontal||0,S=R.alignVertical||0,L=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE;for(let c=0;c<6;c++)void 0===x[c]&&(x[c]=new k.p(0,0,1,1)),H&&void 0===H[c]&&(H[c]=new g.d(1,1,1,1));const b=U/2,C=J/2,F=V/2,d=[];for(let k=0;k<2;k++)d[k]=I({pattern:t,tileWidth:n,tileHeight:i,width:U,height:J,alignVertical:S,alignHorizontal:q,sideOrientation:L});for(let k=2;k<4;k++)d[k]=I({pattern:t,tileWidth:n,tileHeight:i,width:V,height:J,alignVertical:S,alignHorizontal:q,sideOrientation:L});let P=S;S===c.d.BOTTOM?P=c.d.TOP:S===c.d.TOP&&(P=c.d.BOTTOM);for(let k=4;k<6;k++)d[k]=I({pattern:t,tileWidth:n,tileHeight:i,width:U,height:V,alignVertical:P,alignHorizontal:q,sideOrientation:L});let a=[],X=[],M=[],B=[];const o=[],Z=[],y=[],s=[];let E=0,w=0;for(let c=0;c<6;c++){const R=d[c].xa.length;Z[c]=[],y[c]=[];for(let x=0;x<R/3;x++)Z[c].push(new k.o(d[c].xa[3*x],d[c].xa[3*x+1],d[c].xa[3*x+2])),y[c].push(new k.o(d[c].ya[3*x],d[c].ya[3*x+1],d[c].ya[3*x+2]));E=d[c].Aa.length,s[c]=[];for(let H=0;H<E;H+=2)s[c][H]=x[c].x+(x[c].z-x[c].x)*d[c].Aa[H],s[c][H+1]=x[c].y+(x[c].w-x[c].y)*d[c].Aa[H+1],D.e&&(s[c][H+1]=1-s[c][H+1]);if(M=M.concat(s[c]),B=B.concat(d[c].indices.map((R=>R+w))),w+=Z[c].length,H)for(let x=0;x<4;x++)o.push(H[c].r,H[c].g,H[c].b,H[c].a)}const h=new k.o(0,0,F),f=k.e.RotationY(Math.PI);a=Z[0].map((R=>k.o.TransformNormal(R,f).add(h))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[]),X=y[0].map((R=>k.o.TransformNormal(R,f))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[]),a=a.concat(Z[1].map((R=>R.Pg(h))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[])),X=X.concat(y[1].map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[]));const N=new k.o(b,0,0),W=k.e.RotationY(-Math.PI/2);a=a.concat(Z[2].map((R=>k.o.TransformNormal(R,W).add(N))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[])),X=X.concat(y[2].map((R=>k.o.TransformNormal(R,W))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[]));const K=k.e.RotationY(Math.PI/2);a=a.concat(Z[3].map((R=>k.o.TransformNormal(R,K).Pg(N))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[])),X=X.concat(y[3].map((R=>k.o.TransformNormal(R,K))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[]));const Q=new k.o(0,C,0),G=k.e.RotationX(Math.PI/2);a=a.concat(Z[4].map((R=>k.o.TransformNormal(R,G).add(Q))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[])),X=X.concat(y[4].map((R=>k.o.TransformNormal(R,G))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[]));const T=k.e.RotationX(-Math.PI/2);a=a.concat(Z[5].map((R=>k.o.TransformNormal(R,T).Pg(Q))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[])),X=X.concat(y[5].map((R=>k.o.TransformNormal(R,T))).map((R=>[R.x,R.y,R.z])).reduce(((R,x)=>R.concat(x)),[])),A.d._ComputeSides(L,a,B,X,M);const v=new A.d;if(v.indices=B,v.xa=a,v.ya=X,v.Aa=M,H){const R=L===A.d.DOUBLESIDE?o.concat(o):o;v.za=R}return v}function S(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return q(x).Ca(k,x.updatable),k}A.d.CreateTiledPlane=I;A.d.CreateTiledBox=q;var L=H(12927),b=H(2445),C=H(831);function F(R){const x=R.height||2;let H=0===R.diameterTop?0:R.diameterTop||R.diameter||1,t=0===R.diameterBottom?0:R.diameterBottom||R.diameter||1;H=H||1e-5,t=t||1e-5;const U=0|(R.tessellation||24),J=0|(R.subdivisions||1),V=!!R.hasRings,n=!!R.enclose,I=0===R.cap?0:R.cap||c.d.CAP_ALL,i=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,q=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE,S=R.faceUV||new Array(3),L=R.faceColors,b=2+(1+(1!==i&&n?2:0))*(V?J:1);let F;for(F=0;F<b;F++)L&&void 0===L[F]&&(L[F]=new g.d(1,1,1,1));for(F=0;F<b;F++)S&&void 0===S[F]&&(S[F]=new k.p(0,0,1,1));const d=[],P=[],a=[],X=[],M=[],B=2*Math.PI*i/U;let o,Z,y;const s=(t-H)/2/x,E=k.o.Zero(),w=k.o.Zero(),h=k.o.Zero(),f=k.o.Zero(),N=k.o.Zero(),W=C.c.Y;let K,Q,G,T=1,v=1,p=0,r=0;for(K=0;K<=J;K++)for(Z=K/J,y=(Z*(H-t)+t)/2,T=V&&0!==K&&K!==J?2:1,G=0;G<T;G++){for(V&&(v+=G),n&&(v+=2*G),Q=0;Q<=U;Q++)o=Q*B,E.x=Math.cos(-o)*y,E.y=-x/2+Z*x,E.z=Math.sin(-o)*y,0===H&&K===J?(w.x=a[a.length-3*(U+1)],w.y=a[a.length-3*(U+1)+1],w.z=a[a.length-3*(U+1)+2]):(w.x=E.x,w.z=E.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*s,w.normalize()),0===Q&&(h.p(E),f.p(w)),P.push(E.x,E.y,E.z),a.push(w.x,w.y,w.z),r=V?p!==v?S[v].y:S[v].w:S[v].y+(S[v].w-S[v].y)*Z,X.push(S[v].x+(S[v].z-S[v].x)*Q/U,D.e?1-r:r),L&&M.push(L[v].r,L[v].g,L[v].b,L[v].a);1!==i&&n&&(P.push(E.x,E.y,E.z),P.push(0,E.y,0),P.push(0,E.y,0),P.push(h.x,h.y,h.z),k.o.CrossToRef(W,w,N),N.normalize(),a.push(N.x,N.y,N.z,N.x,N.y,N.z),k.o.CrossToRef(f,W,N),N.normalize(),a.push(N.x,N.y,N.z,N.x,N.y,N.z),r=V?p!==v?S[v+1].y:S[v+1].w:S[v+1].y+(S[v+1].w-S[v+1].y)*Z,X.push(S[v+1].x,D.e?1-r:r),X.push(S[v+1].z,D.e?1-r:r),r=V?p!==v?S[v+2].y:S[v+2].w:S[v+2].y+(S[v+2].w-S[v+2].y)*Z,X.push(S[v+2].x,D.e?1-r:r),X.push(S[v+2].z,D.e?1-r:r),L&&(M.push(L[v+1].r,L[v+1].g,L[v+1].b,L[v+1].a),M.push(L[v+1].r,L[v+1].g,L[v+1].b,L[v+1].a),M.push(L[v+2].r,L[v+2].g,L[v+2].b,L[v+2].a),M.push(L[v+2].r,L[v+2].g,L[v+2].b,L[v+2].a))),p!==v&&(p=v)}const z=1!==i&&n?U+4:U;for(K=0,v=0;v<J;v++){let R=0,x=0,H=0,k=0;for(Q=0;Q<U;Q++)R=K*(z+1)+Q,x=(K+1)*(z+1)+Q,H=K*(z+1)+(Q+1),k=(K+1)*(z+1)+(Q+1),d.push(R,x,H),d.push(k,H,x);1!==i&&n&&(d.push(R+2,x+2,H+2),d.push(k+2,H+2,x+2),d.push(R+4,x+4,H+4),d.push(k+4,H+4,x+4)),K=V?K+2:K+1}const j=R=>{const c=R?H/2:t/2;if(0===c)return;let A,J,V;const n=R?S[b-1]:S[0];let g=null;L&&(g=R?L[b-1]:L[0]);const I=P.length/3,q=R?x/2:-x/2,C=new k.o(0,q,0);P.push(C.x,C.y,C.z),a.push(0,R?1:-1,0);const F=n.y+.5*(n.w-n.y);X.push(n.x+.5*(n.z-n.x),D.e?1-F:F),g&&M.push(g.r,g.g,g.b,g.a);const B=new k.k(.5,.5);for(V=0;V<=U;V++){A=2*Math.PI*V*i/U;const x=Math.cos(-A),H=Math.sin(-A);J=new k.o(x*c,q,H*c);const t=new k.k(x*B.x+.5,H*B.y+.5);P.push(J.x,J.y,J.z),a.push(0,R?1:-1,0);const I=n.y+(n.w-n.y)*t.y;X.push(n.x+(n.z-n.x)*t.x,D.e?1-I:I),g&&M.push(g.r,g.g,g.b,g.a)}for(V=0;V<U;V++)R?(d.push(I),d.push(I+(V+2)),d.push(I+(V+1))):(d.push(I),d.push(I+(V+1)),d.push(I+(V+2)))};I!==c.d.CAP_START&&I!==c.d.CAP_ALL||j(!1),I!==c.d.CAP_END&&I!==c.d.CAP_ALL||j(!0),A.d._ComputeSides(q,P,d,a,X,R.frontUVs,R.backUVs);const m=new A.d;return m.indices=d,m.xa=P,m.ya=a,m.Aa=X,L&&(m.za=M),m}function d(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return F(x).Ca(k,x.updatable),k}function P(R){const x=[],H=[],c=[],t=[],U=R.diameter||1,J=R.thickness||.5,V=0|(R.tessellation||16),n=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE,g=V+1;for(let A=0;A<=V;A++){const R=A/V,n=A*Math.PI*2/V-Math.PI/2,I=k.e.Translation(U/2,0,0).multiply(k.e.RotationY(n));for(let U=0;U<=V;U++){const n=1-U/V,i=U*Math.PI*2/V+Math.PI,q=Math.cos(i),S=Math.sin(i);let L=new k.o(q,S,0),b=L.scale(J/2);const C=new k.k(R,n);b=k.o.TransformCoordinates(b,I),L=k.o.TransformNormal(L,I),H.push(b.x,b.y,b.z),c.push(L.x,L.y,L.z),t.push(C.x,D.e?1-C.y:C.y);const F=(A+1)%g,d=(U+1)%g;x.push(A*g+U),x.push(A*g+d),x.push(F*g+U),x.push(A*g+d),x.push(F*g+d),x.push(F*g+U)}}A.d._ComputeSides(n,H,x,c,t,R.frontUVs,R.backUVs);const I=new A.d;return I.indices=x,I.xa=H,I.ya=c,I.Aa=t,I}function a(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return P(x).Ca(k,x.updatable),k}A.d.CreateCylinder=F,c.d.CreateCylinder=(R,x,H,k,t,A,D,U,J)=>{void 0!==D&&D instanceof b.e||(void 0!==D&&(J=U||c.d.DEFAULTSIDE,U=D),D=A,A=1);return d(R,{height:x,diameterTop:H,diameterBottom:k,tessellation:t,subdivisions:A,sideOrientation:J,updatable:U},D)};function X(R){const x=[],H=[],c=[],t=[],U=R.radius||2,J=R.tube||.5,V=R.radialSegments||32,n=R.tubularSegments||32,g=R.p||2,I=R.q||3,i=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE,q=R=>{const x=Math.cos(R),H=Math.sin(R),c=I/g*R,t=Math.cos(c),A=U*(2+t)*.5*x,D=U*(2+t)*H*.5,J=U*Math.sin(c)*.5;return new k.o(A,D,J)};let S,L;for(S=0;S<=V;S++){const R=S%V/V*2*g*Math.PI,x=q(R),c=q(R+.01),A=c.Pg(x);let U=c.add(x);const I=k.o.Cross(A,U);for(U=k.o.Cross(I,A),I.normalize(),U.normalize(),L=0;L<n;L++){const R=L%n/n*2*Math.PI,k=-J*Math.cos(R),c=J*Math.sin(R);H.push(x.x+k*U.x+c*I.x),H.push(x.y+k*U.y+c*I.y),H.push(x.z+k*U.z+c*I.z),t.push(S/V),t.push(D.e?1-L/n:L/n)}}for(S=0;S<V;S++)for(L=0;L<n;L++){const R=(L+1)%n,H=S*n+L,k=(S+1)*n+L,c=(S+1)*n+R,t=S*n+R;x.push(t),x.push(k),x.push(H),x.push(t),x.push(c),x.push(k)}A.d.ComputeNormals(H,x,c),A.d._ComputeSides(i,H,x,c,t,R.frontUVs,R.backUVs);const b=new A.d;return b.indices=x,b.xa=H,b.ya=c,b.Aa=t,b}function M(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return X(x).Ca(k,x.updatable),k}A.d.CreateTorus=P,c.d.CreateTorus=(R,x,H,k,c,t,A)=>a(R,{diameter:x,thickness:H,tessellation:k,sideOrientation:A,updatable:t},c);A.d.CreateTorusKnot=X,c.d.CreateTorusKnot=(R,x,H,k,c,t,A,D,U,J)=>M(R,{radius:x,tube:H,radialSegments:k,tubularSegments:c,p:t,q:A,sideOrientation:J,updatable:U},D);var B=H(13419),o=H(12372),Z=H(2288);function y(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=x.path,t=x.shape,A=x.scale||1,D=x.rotation||0,U=0===x.cap?0:x.cap||c.d.NO_CAP,J=x.updatable,V=c.d._GetDefaultSideOrientation(x.sideOrientation),n=x.instance||null,g=x.invertUV||!1,I=x.closeShape||!1,i=x.closePath||!1,q=x.capFunction||null;return E(R,t,k,A,D,null,null,i,I,U,!1,H,!!J,V,n,g,x.frontUVs||null,x.backUVs||null,x.firstNormal||null,!!x.adjustFrame,q)}function s(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=x.path,t=x.shape,A=x.scaleFunction||(()=>1),D=x.rotationFunction||(()=>0),U=x.closePath||x.ribbonCloseArray||!1,J=x.closeShape||x.ribbonClosePath||!1,V=0===x.cap?0:x.cap||c.d.NO_CAP,n=x.updatable,g=x.firstNormal||null,I=x.adjustFrame||!1,i=c.d._GetDefaultSideOrientation(x.sideOrientation),q=x.instance,S=x.invertUV||!1,L=x.capFunction||null;return E(R,t,k,null,null,A,D,U,J,V,!0,H,!!n,i,q||null,S,x.frontUVs||null,x.backUVs||null,g,I,L||null)}function E(R,x,H,t,A,D,U,V,n,g,I,i,q,S,L,b,C,F,d,P,a){const X=(R,x,H,t,A,D,U,J,V,n,g)=>{const I=H.getTangents(),i=H.getNormals(),q=H.getBinormals(),S=H.getDistances();if(g)for(let c=0;c<I.length;c++)if(0==I[c].x&&0==I[c].y&&0==I[c].z&&I[c].p(I[c-1]),0==i[c].x&&0==i[c].y&&0==i[c].z&&i[c].p(i[c-1]),0==q[c].x&&0==q[c].y&&0==q[c].z&&q[c].p(q[c-1]),c>0){let R=I[c-1];k.o.Dot(R,I[c])<0&&I[c].scaleInPlace(-1),R=i[c-1],k.o.Dot(R,i[c])<0&&i[c].scaleInPlace(-1),R=q[c-1],k.o.Dot(R,q[c])<0&&q[c].scaleInPlace(-1)}let L=0;const b=n&&J?J:()=>null!==D?D:0,C=n&&U?U:()=>null!==A?A:1;let F=V===c.d.NO_CAP||V===c.d.CAP_END?0:2;const d=k.g.Matrix[0];for(let c=0;c<x.length;c++){const H=[],A=b(c,S[c]),D=C(c,S[c]);k.e.RotationAxisToRef(I[c],L,d);for(let t=0;t<R.length;t++){const A=I[c].scale(R[t].z).add(i[c].scale(R[t].x)).add(q[c].scale(R[t].y)),U=k.o.Zero();k.o.TransformCoordinatesToRef(A,d,U),U.scaleInPlace(D).addInPlace(x[c]),H[t]=U}t[F]=H,L+=A,F++}const P=a||(R=>{const x=Array(),H=k.o.Zero();let c;for(c=0;c<R.length;c++)H.addInPlace(R[c]);for(H.scaleInPlace(1/R.length),c=0;c<R.length;c++)x.push(H);return x});switch(V){case c.d.NO_CAP:break;case c.d.CAP_START:t[0]=P(t[2]),t[1]=t[2];break;case c.d.CAP_END:t[F]=t[F-1],t[F+1]=P(t[F-1]);break;case c.d.CAP_ALL:t[0]=P(t[2]),t[1]=t[2],t[F]=t[F-1],t[F+1]=P(t[F-1])}return t};let M,B;if(L){const R=L._creationDataStorage;return M=d?R.path3D.update(H,d):R.path3D.update(H),B=X(x,H,R.path3D,R.pathArray,t,A,D,U,R.cap,I,P),L=J("",{pathArray:B,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:L},i||void 0)}M=d?new Z.g(H,d):new Z.g(H);B=X(x,H,M,new Array,t,A,D,U,g=g<0||g>3?0:g,I,P);const o=J(R,{pathArray:B,closeArray:V,closePath:n,updatable:q,sideOrientation:S,invertUV:b,frontUVs:C||void 0,backUVs:F||void 0},i);return o._creationDataStorage.pathArray=B,o._creationDataStorage.path3D=M,o._creationDataStorage.cap=g,o}function w(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=x.arc?x.arc<=0||x.arc>1?1:x.arc:1,A=void 0===x.closed||x.closed,D=x.shape,U=x.radius||1,V=x.tessellation||64,n=x.clip||0,g=x.updatable,I=c.d._GetDefaultSideOrientation(x.sideOrientation),i=x.cap||c.d.NO_CAP,q=2*Math.PI,S=[],L=x.invertUV||!1;let b=0,C=0;const F=q/V*t;let d,P;for(b=0;b<=V-n;b++){for(P=[],i!=c.d.CAP_START&&i!=c.d.CAP_ALL||(P.push(new k.o(0,D[0].y,0)),P.push(new k.o(Math.cos(b*F)*D[0].x*U,D[0].y,Math.sin(b*F)*D[0].x*U))),C=0;C<D.length;C++)d=new k.o(Math.cos(b*F)*D[C].x*U,D[C].y,Math.sin(b*F)*D[C].x*U),P.push(d);i!=c.d.CAP_END&&i!=c.d.CAP_ALL||(P.push(new k.o(Math.cos(b*F)*D[D.length-1].x*U,D[D.length-1].y,Math.sin(b*F)*D[D.length-1].x*U)),P.push(new k.o(0,D[D.length-1].y,0))),S.push(P)}return J(R,{pathArray:S,closeArray:A,sideOrientation:I,updatable:g,invertUV:L,frontUVs:x.frontUVs,backUVs:x.backUVs},H)}c.d.ExtrudeShape=function(R,x,H,k,t,A){let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0,V=arguments.length>9?arguments[9]:void 0;return y(R,{shape:x,path:H,scale:k,rotation:t,cap:0===A?0:A||c.d.NO_CAP,sideOrientation:J,instance:V,updatable:U},D)},c.d.ExtrudeShapeCustom=(R,x,H,k,t,A,D,U,J,V,n,g)=>s(R,{shape:x,path:H,scaleFunction:k,rotationFunction:t,ribbonCloseArray:A,ribbonClosePath:D,cap:0===U?0:U||c.d.NO_CAP,sideOrientation:n,instance:g,updatable:V},J);c.d.CreateLathe=(R,x,H,k,c,t,A)=>w(R,{shape:x,radius:H,tessellation:k,sideOrientation:A,updatable:t},c);var h=H(12829),f=H(12777);function N(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=x.path;let A=x.instance,D=1;void 0!==x.radius?D=x.radius:A&&(D=A._creationDataStorage.radius);const U=x.tessellation||64,V=x.radiusFunction||null;let n=x.cap||c.d.NO_CAP;const g=x.invertUV||!1,I=x.updatable,i=c.d._GetDefaultSideOrientation(x.sideOrientation);x.arc=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1;const q=(R,x,H,t,A,D,U,J)=>{const V=x.getTangents(),n=x.getNormals(),g=x.getDistances(),I=2*Math.PI/A*J,i=D||(()=>t);let q,S,L,b;const C=k.g.Matrix[0];let F=U===c.d.NO_CAP||U===c.d.CAP_END?0:2;for(let c=0;c<R.length;c++){S=i(c,g[c]),q=Array(),L=n[c];for(let x=0;x<A;x++)k.e.RotationAxisToRef(V[c],I*x,C),b=q[x]?q[x]:k.o.Zero(),k.o.TransformCoordinatesToRef(L,C,b),b.scaleInPlace(S).addInPlace(R[c]),q[x]=b;H[F]=q,F++}const d=(x,H)=>{const k=Array();for(let c=0;c<x;c++)k.push(R[H]);return k};switch(U){case c.d.NO_CAP:break;case c.d.CAP_START:H[0]=d(A,0),H[1]=H[2].slice(0);break;case c.d.CAP_END:H[F]=H[F-1].slice(0),H[F+1]=d(A,R.length-1);break;case c.d.CAP_ALL:H[0]=d(A,0),H[1]=H[2].slice(0),H[F]=H[F-1].slice(0),H[F+1]=d(A,R.length-1)}return H};let S,L;if(A){const R=A._creationDataStorage,H=x.arc||R.arc;return S=R.path3D.update(t),L=q(t,S,R.pathArray,D,R.tessellation,V,R.cap,H),A=J("",{pathArray:L,instance:A}),R.path3D=S,R.pathArray=L,R.arc=H,R.radius=D,A}S=new Z.g(t);n=n<0||n>3?0:n,L=q(t,S,new Array,D,U,V,n,x.arc);const b=J(R,{pathArray:L,closePath:!0,closeArray:!1,updatable:I,sideOrientation:i,invertUV:g,frontUVs:x.frontUVs,backUVs:x.backUVs},H);return b._creationDataStorage.pathArray=L,b._creationDataStorage.path3D=S,b._creationDataStorage.tessellation=U,b._creationDataStorage.cap=n,b._creationDataStorage.arc=x.arc,b._creationDataStorage.radius=D,b}function W(R){const x=[];x[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},x[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},x[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},x[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},x[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},x[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},x[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},x[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},x[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},x[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},x[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},x[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},x[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},x[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},x[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const H=R.type&&(R.type<0||R.type>=x.length)?0:R.type||0,c=R.size,t=R.sizeX||c||1,U=R.sizeY||c||1,J=R.sizeZ||c||1,V=R.custom||x[H],n=V.face.length,I=R.faceUV||new Array(n),i=R.faceColors,q=void 0===R.flat||R.flat,S=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE,L=[],b=[],C=[],F=[],d=[];let P=0,a=0;const X=[];let M,B,o,Z,y,s,E=0,w=0;if(q)for(w=0;w<n;w++)i&&void 0===i[w]&&(i[w]=new g.d(1,1,1,1)),I&&void 0===I[w]&&(I[w]=new k.p(0,0,1,1));if(q)for(w=0;w<n;w++){const R=V.face[w].length;for(o=2*Math.PI/R,Z=.5*Math.tan(o/2),y=.5,E=0;E<R;E++)L.push(V.vertex[V.face[w][E]][0]*t,V.vertex[V.face[w][E]][1]*U,V.vertex[V.face[w][E]][2]*J),X.push(P),P++,M=I[w].x+(I[w].z-I[w].x)*(.5+Z),B=I[w].y+(I[w].w-I[w].y)*(y-.5),F.push(M,D.e?1-B:B),s=Z*Math.cos(o)-y*Math.sin(o),y=Z*Math.sin(o)+y*Math.cos(o),Z=s,i&&d.push(i[w].r,i[w].g,i[w].b,i[w].a);for(E=0;E<R-2;E++)b.push(X[0+a],X[E+2+a],X[E+1+a]);a+=R}else{for(E=0;E<V.vertex.length;E++)L.push(V.vertex[E][0]*t,V.vertex[E][1]*U,V.vertex[E][2]*J),F.push(0,D.e?1:0);for(w=0;w<n;w++)for(E=0;E<V.face[w].length-2;E++)b.push(V.face[w][0],V.face[w][E+2],V.face[w][E+1])}A.d.ComputeNormals(L,b,C),A.d._ComputeSides(S,L,b,C,F,R.frontUVs,R.backUVs);const h=new A.d;return h.xa=L,h.indices=b,h.ya=C,h.Aa=F,i&&q&&(h.za=d),h}function K(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return W(x).Ca(k,x.updatable),k}c.d.CreateTube=(R,x,H,k,c,t,A,D,U,J)=>N(R,{path:x,radius:H,tessellation:k,radiusFunction:c,arc:1,cap:t,updatable:D,sideOrientation:U,instance:J},A);function Q(R){const x=R.sideOrientation||A.d.DEFAULTSIDE,H=R.radius||1,c=void 0===R.flat||R.flat,t=0|(R.subdivisions||4),U=R.radiusX||H,J=R.radiusY||H,V=R.radiusZ||H,n=(1+Math.sqrt(5))/2,g=[-1,n,-0,1,n,0,-1,-n,0,1,-n,0,0,-1,-n,0,1,-n,0,-1,n,0,1,n,n,0,1,n,0,-1,-n,0,1,-n,0,-1],I=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],i=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],S=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],L=[],b=[],C=[],F=[];let d=0;const P=new Array(3),a=new Array(3);let X;for(X=0;X<3;X++)P[X]=k.o.Zero(),a[X]=k.k.Zero();for(let A=0;A<20;A++){for(X=0;X<3;X++){const R=I[3*A+X];P[X].si(g[3*i[R]],g[3*i[R]+1],g[3*i[R]+2]),P[X].normalize(),a[X].si(.134765625*q[2*R]+.05859375+-.0390625*S[A],.2333984375*q[2*R+1]+.025390625+.01953125*S[A])}const R=(R,x,H,A)=>{const n=k.o.Lerp(P[0],P[2],x/t),g=k.o.Lerp(P[1],P[2],x/t),I=t===x?P[2]:k.o.Lerp(n,g,R/(t-x));let i;if(I.normalize(),c){const R=k.o.Lerp(P[0],P[2],A/t),x=k.o.Lerp(P[1],P[2],A/t);i=k.o.Lerp(R,x,H/(t-A))}else i=new k.o(I.x,I.y,I.z);i.x/=U,i.y/=J,i.z/=V,i.normalize();const q=k.k.Lerp(a[0],a[2],x/t),S=k.k.Lerp(a[1],a[2],x/t),X=t===x?a[2]:k.k.Lerp(q,S,R/(t-x));b.push(I.x*U,I.y*J,I.z*V),C.push(i.x,i.y,i.z),F.push(X.x,D.e?1-X.y:X.y),L.push(d),d++};for(let x=0;x<t;x++)for(let H=0;H+x<t;H++)R(H,x,H+1/3,x+1/3),R(H+1,x,H+1/3,x+1/3),R(H,x+1,H+1/3,x+1/3),H+x+1<t&&(R(H+1,x,H+2/3,x+2/3),R(H+1,x+1,H+2/3,x+2/3),R(H,x+1,H+2/3,x+2/3))}A.d._ComputeSides(x,b,L,C,F,R.frontUVs,R.backUVs);const M=new A.d;return M.indices=L,M.xa=b,M.ya=C,M.Aa=F,M}function G(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new c.d(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),k._originalBuilderSideOrientation=x.sideOrientation;return Q(x).Ca(k,x.updatable),k}A.d.CreatePolyhedron=W,c.d.CreatePolyhedron=(R,x,H)=>K(R,x,H);A.d.CreateIcoSphere=Q,c.d.CreateIcoSphere=(R,x,H)=>G(R,x,H);var T=H(681);const v=new k.o(1,0,0),p=new k.o(-1,0,0),r=new k.o(0,1,0),z=new k.o(0,-1,0),j=new k.o(0,0,1),m=new k.o(0,0,-1);class O{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.o.Zero(),x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.o.Up(),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.k.Zero(),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=R,this.dj=x,this.uv=H,this.vertexIdx=c,this.vertexIdxForBones=t,this.localPositionOverride=A,this.localNormalOverride=D,this.matrixIndicesOverride=U,this.matrixWeightsOverride=J}clone(){var R,x,H,k;return new O(this.position.clone(),this.dj.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(R=this.localPositionOverride)||void 0===R?void 0:R.slice(),null===(x=this.localNormalOverride)||void 0===x?void 0:x.slice(),null===(H=this.matrixIndicesOverride)||void 0===H?void 0:H.slice(),null===(k=this.matrixWeightsOverride)||void 0===k?void 0:k.slice())}}function l(R,x,H){var U,J,V,n,g;const I=!!x.skeleton,i=!(null===(U=x.morphTargetManager)||void 0===U||!U.numTargets),q=H.localMode||I,S=x.Gi(),L=I||i?x.Zf(!0,!0):x.getVerticesData(t.g.PositionKind),b=I||i?x.getNormalsData(!0,!0):x.getVerticesData(t.g.NormalKind),C=q?I?x.getVerticesData(t.g.PositionKind):L:null,F=q?I?x.getVerticesData(t.g.NormalKind):b:null,d=x.getVerticesData(t.g.UVKind),P=I?x.getVerticesData(t.g.MatricesIndicesKind):null,a=I?x.getVerticesData(t.g.MatricesWeightsKind):null,X=I?x.getVerticesData(t.g.MatricesIndicesExtraKind):null,M=I?x.getVerticesData(t.g.MatricesWeightsExtraKind):null,B=H.position||k.o.Zero();let o=H.dj||k.o.Up();const Z=H.size||k.o.One(),y=H.angle||0;if(!o){const R=new k.o(0,0,1),H=x.va().activeCamera,c=k.o.TransformCoordinates(R,H.getWorldMatrix());o=H.globalPosition.Pg(c)}const s=-Math.atan2(o.z,o.x)-Math.PI/2,E=Math.sqrt(o.x*o.x+o.z*o.z),w=Math.atan2(o.y,E),h=new A.d;h.indices=[],h.xa=[],h.ya=[],h.Aa=[],h.matricesIndices=I?[]:null,h.matricesWeights=I?[]:null,h.matricesIndicesExtra=X?[]:null,h.matricesWeightsExtra=M?[]:null;let f=0;const N=(R,x)=>{const c=new O;if(!S||!L||!b)return c;const t=S[R];if(c.vertexIdx=3*t,c.vertexIdxForBones=4*t,c.position=new k.o(L[3*t],L[3*t+1],L[3*t+2]),k.o.TransformCoordinatesToRef(c.position,x,c.position),c.dj=new k.o(b[3*t],b[3*t+1],b[3*t+2]),k.o.TransformNormalToRef(c.dj,x,c.dj),H.captureUVS&&d){const R=d[2*t+1];c.uv=new k.k(d[2*t],D.e?1-R:R)}return c},W=[0,0,0,0],K=(R,x)=>{if(0===R.length)return R;const H=.5*Math.abs(k.o.Dot(Z,x)),c=(R,x,H,k)=>{for(let c=0;c<k;++c)if(R[H+c]===x)return H+c;return-1},t=(R,t)=>{const A=k.o.GetClipFactor(R.position,t.position,x,H);let D=W,U=W;if(P&&a){const x=R.matrixIndicesOverride?0:R.vertexIdxForBones,H=R.matrixIndicesOverride??P,k=R.matrixWeightsOverride??a,J=t.matrixIndicesOverride?0:t.vertexIdxForBones,V=t.matrixIndicesOverride??P,n=t.matrixWeightsOverride??a;D=[0,0,0,0],U=[0,0,0,0];let g=0;for(let R=0;R<4;++R)if(k[x+R]>0){const t=c(V,H[x+R],J,4);D[g]=H[x+R],U[g]=(0,T.Lerp)(k[x+R],t>=0?n[t]:0,A),g++}for(let R=0;R<4&&g<4;++R){const k=V[J+R];-1===c(H,k,x,4)&&(D[g]=k,U[g]=(0,T.Lerp)(0,n[J+R],A),g++)}const I=U[0]+U[1]+U[2]+U[3];U[0]/=I,U[1]/=I,U[2]/=I,U[3]/=I}const J=R.localPositionOverride?R.localPositionOverride[0]:(null===C||void 0===C?void 0:C[R.vertexIdx])??0,V=R.localPositionOverride?R.localPositionOverride[1]:(null===C||void 0===C?void 0:C[R.vertexIdx+1])??0,n=R.localPositionOverride?R.localPositionOverride[2]:(null===C||void 0===C?void 0:C[R.vertexIdx+2])??0,g=t.localPositionOverride?t.localPositionOverride[0]:(null===C||void 0===C?void 0:C[t.vertexIdx])??0,I=t.localPositionOverride?t.localPositionOverride[1]:(null===C||void 0===C?void 0:C[t.vertexIdx+1])??0,i=t.localPositionOverride?t.localPositionOverride[2]:(null===C||void 0===C?void 0:C[t.vertexIdx+2])??0,q=R.localNormalOverride?R.localNormalOverride[0]:(null===F||void 0===F?void 0:F[R.vertexIdx])??0,S=R.localNormalOverride?R.localNormalOverride[1]:(null===F||void 0===F?void 0:F[R.vertexIdx+1])??0,L=R.localNormalOverride?R.localNormalOverride[2]:(null===F||void 0===F?void 0:F[R.vertexIdx+2])??0,b=q+((t.localNormalOverride?t.localNormalOverride[0]:(null===F||void 0===F?void 0:F[t.vertexIdx])??0)-q)*A,d=S+((t.localNormalOverride?t.localNormalOverride[1]:(null===F||void 0===F?void 0:F[t.vertexIdx+1])??0)-S)*A,X=L+((t.localNormalOverride?t.localNormalOverride[2]:(null===F||void 0===F?void 0:F[t.vertexIdx+2])??0)-L)*A,M=Math.sqrt(b*b+d*d+X*X);return new O(k.o.Lerp(R.position,t.position,A),k.o.Lerp(R.dj,t.dj,A).normalize(),k.k.Lerp(R.uv,t.uv,A),-1,-1,C?[J+(g-J)*A,V+(I-V)*A,n+(i-n)*A]:null,F?[b/M,d/M,X/M]:null,D,U)};let A=null;R.length>3&&(A=[]);for(let D=0;D<R.length;D+=3){let c=0,U=null,J=null,V=null,n=null;const g=k.o.Dot(R[D].position,x)-H>0,I=k.o.Dot(R[D+1].position,x)-H>0,i=k.o.Dot(R[D+2].position,x)-H>0;switch(c=(g?1:0)+(I?1:0)+(i?1:0),c){case 0:R.length>3?(A.push(R[D]),A.push(R[D+1]),A.push(R[D+2])):A=R;break;case 1:if(A=A??new Array,g&&(U=R[D+1],J=R[D+2],V=t(R[D],U),n=t(R[D],J)),I){U=R[D],J=R[D+2],V=t(R[D+1],U),n=t(R[D+1],J),A.push(V),A.push(J.clone()),A.push(U.clone()),A.push(J.clone()),A.push(V.clone()),A.push(n);break}i&&(U=R[D],J=R[D+1],V=t(R[D+2],U),n=t(R[D+2],J)),U&&J&&V&&n&&(A.push(U.clone()),A.push(J.clone()),A.push(V),A.push(n),A.push(V.clone()),A.push(J.clone()));break;case 2:A=A??new Array,g||(U=R[D].clone(),J=t(U,R[D+1]),V=t(U,R[D+2]),A.push(U),A.push(J),A.push(V)),I||(U=R[D+1].clone(),J=t(U,R[D+2]),V=t(U,R[D]),A.push(U),A.push(J),A.push(V)),i||(U=R[D+2].clone(),J=t(U,R[D]),V=t(U,R[D+1]),A.push(U),A.push(J),A.push(V))}}return A},Q=x instanceof c.d?x:null,G=null===Q||void 0===Q?void 0:Q._thinInstanceDataStorage.matrixData,l=(null===Q||void 0===Q?void 0:Q.wi)||1,e=k.g.Matrix[0];e.p(k.e.IdentityReadOnly);for(let c=0;c<l;++c){if(null!==Q&&void 0!==Q&&Q.hasThinInstances&&G){const R=16*c;e.setRowFromFloats(0,G[R+0],G[R+1],G[R+2],G[R+3]),e.setRowFromFloats(1,G[R+4],G[R+5],G[R+6],G[R+7]),e.setRowFromFloats(2,G[R+8],G[R+9],G[R+10],G[R+11]),e.setRowFromFloats(3,G[R+12],G[R+13],G[R+14],G[R+15])}const R=k.e.RotationYawPitchRoll(s,w,y).multiply(k.e.Translation(B.x,B.y,B.z)),t=k.e.Invert(R),A=x.getWorldMatrix(),U=e.multiply(A).multiply(t),J=new Array(3);for(let x=0;x<S.length;x+=3){let R=J;if(R[0]=N(x,U),R[1]=N(x+1,U),R[2]=N(x+2,U),!(H.cullBackFaces&&-R[0].dj.z<=0&&-R[1].dj.z<=0&&-R[2].dj.z<=0)&&(R=K(R,v),R&&(R=K(R,p),R&&(R=K(R,r),R&&(R=K(R,z),R&&(R=K(R,j),R&&(R=K(R,m),R)))))))for(let x=0;x<R.length;x++){const k=R[x];if(h.indices.push(f),q?(k.localPositionOverride?(h.xa[3*f]=k.localPositionOverride[0],h.xa[3*f+1]=k.localPositionOverride[1],h.xa[3*f+2]=k.localPositionOverride[2]):C&&(h.xa[3*f]=C[k.vertexIdx],h.xa[3*f+1]=C[k.vertexIdx+1],h.xa[3*f+2]=C[k.vertexIdx+2]),k.localNormalOverride?(h.ya[3*f]=k.localNormalOverride[0],h.ya[3*f+1]=k.localNormalOverride[1],h.ya[3*f+2]=k.localNormalOverride[2]):F&&(h.ya[3*f]=F[k.vertexIdx],h.ya[3*f+1]=F[k.vertexIdx+1],h.ya[3*f+2]=F[k.vertexIdx+2])):(k.position.toArray(h.xa,3*f),k.dj.toArray(h.ya,3*f)),h.matricesIndices&&h.matricesWeights&&(k.matrixIndicesOverride?(h.matricesIndices[4*f]=k.matrixIndicesOverride[0],h.matricesIndices[4*f+1]=k.matrixIndicesOverride[1],h.matricesIndices[4*f+2]=k.matrixIndicesOverride[2],h.matricesIndices[4*f+3]=k.matrixIndicesOverride[3]):(P&&(h.matricesIndices[4*f]=P[k.vertexIdxForBones],h.matricesIndices[4*f+1]=P[k.vertexIdxForBones+1],h.matricesIndices[4*f+2]=P[k.vertexIdxForBones+2],h.matricesIndices[4*f+3]=P[k.vertexIdxForBones+3]),X&&h.matricesIndicesExtra&&(h.matricesIndicesExtra[4*f]=X[k.vertexIdxForBones],h.matricesIndicesExtra[4*f+1]=X[k.vertexIdxForBones+1],h.matricesIndicesExtra[4*f+2]=X[k.vertexIdxForBones+2],h.matricesIndicesExtra[4*f+3]=X[k.vertexIdxForBones+3])),k.matrixWeightsOverride?(h.matricesWeights[4*f]=k.matrixWeightsOverride[0],h.matricesWeights[4*f+1]=k.matrixWeightsOverride[1],h.matricesWeights[4*f+2]=k.matrixWeightsOverride[2],h.matricesWeights[4*f+3]=k.matrixWeightsOverride[3]):(a&&(h.matricesWeights[4*f]=a[k.vertexIdxForBones],h.matricesWeights[4*f+1]=a[k.vertexIdxForBones+1],h.matricesWeights[4*f+2]=a[k.vertexIdxForBones+2],h.matricesWeights[4*f+3]=a[k.vertexIdxForBones+3]),M&&h.matricesWeightsExtra&&(h.matricesWeightsExtra[4*f]=M[k.vertexIdxForBones],h.matricesWeightsExtra[4*f+1]=M[k.vertexIdxForBones+1],h.matricesWeightsExtra[4*f+2]=M[k.vertexIdxForBones+2],h.matricesWeightsExtra[4*f+3]=M[k.vertexIdxForBones+3]))),H.captureUVS)k.uv.toArray(h.Aa,2*f);else{h.Aa.push(.5+k.position.x/Z.x);const R=.5+k.position.y/Z.y;h.Aa.push(D.e?1-R:R)}f++}}}0===h.indices.length&&(h.indices=null),0===h.xa.length&&(h.xa=null),0===h.ya.length&&(h.ya=null),0===h.Aa.length&&(h.Aa=null),0===(null===(J=h.matricesIndices)||void 0===J?void 0:J.length)&&(h.matricesIndices=null),0===(null===(V=h.matricesWeights)||void 0===V?void 0:V.length)&&(h.matricesWeights=null),0===(null===(n=h.matricesIndicesExtra)||void 0===n?void 0:n.length)&&(h.matricesIndicesExtra=null),0===(null===(g=h.matricesWeightsExtra)||void 0===g?void 0:g.length)&&(h.matricesWeightsExtra=null);const u=new c.d(R,x.va());return h.Ca(u),q?(u.skeleton=x.skeleton,u.parent=x):(u.position=B.clone(),u.rotation=new k.o(w,s,y)),u.Fi(!0),u.refreshBoundingInfo(!0,!0),u}function e(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const x=0|Math.max(R.subdivisions?R.subdivisions:2,1),H=0|Math.max(R.tessellation?R.tessellation:16,3),c=Math.max(R.height?R.height:1,0),t=Math.max(R.radius?R.radius:.25,0),U=0|Math.max(R.capSubdivisions?R.capSubdivisions:6,1),J=H,V=x,n=Math.max(R.radiusTop?R.radiusTop:t,0),g=Math.max(R.radiusBottom?R.radiusBottom:t,0),I=c-(n+g),i=2*Math.PI,q=Math.max(R.topCapSubdivisions?R.topCapSubdivisions:U,1),S=Math.max(R.bottomCapSubdivisions?R.bottomCapSubdivisions:U,1),L=Math.acos((g-n)/c);let b=[];const C=[],F=[],d=[];let P=0;const a=[],X=.5*I,M=.5*Math.PI;let B,o;const Z=k.o.Zero(),y=k.o.Zero(),s=Math.cos(L),E=Math.sin(L),w=new k.k(n*E,X+n*s).Pg(new k.k(g*E,g*s-X)).length(),h=n*L+w+g*(M-L);let f=0;for(o=0;o<=q;o++){const R=[],x=M-L*(o/q);f+=n*L/q;const H=Math.cos(x),k=Math.sin(x),c=H*n;for(B=0;B<=J;B++){const x=B/J,t=x*i+0,A=Math.sin(t),U=Math.cos(t);y.x=c*A,y.y=X+k*n,y.z=c*U,C.push(y.x,y.y,y.z),Z.set(H*A,k,H*U),F.push(Z.x,Z.y,Z.z),d.push(x,D.e?f/h:1-f/h),R.push(P),P++}a.push(R)}const N=c-n-g+s*n-s*g,W=E*(g-n)/N;for(o=1;o<=V;o++){const R=[];f+=w/V;const x=E*(o*(g-n)/V+n);for(B=0;B<=J;B++){const H=B/J,k=H*i+0,c=Math.sin(k),t=Math.cos(k);y.x=x*c,y.y=X+s*n-o*N/V,y.z=x*t,C.push(y.x,y.y,y.z),Z.set(c,W,t).normalize(),F.push(Z.x,Z.y,Z.z),d.push(H,D.e?f/h:1-f/h),R.push(P),P++}a.push(R)}for(o=1;o<=S;o++){const R=[],x=M-L-(Math.PI-L)*(o/S);f+=g*L/S;const H=Math.cos(x),k=Math.sin(x),c=H*g;for(B=0;B<=J;B++){const x=B/J,t=x*i+0,A=Math.sin(t),U=Math.cos(t);y.x=c*A,y.y=k*g-X,y.z=c*U,C.push(y.x,y.y,y.z),Z.set(H*A,k,H*U),F.push(Z.x,Z.y,Z.z),d.push(x,D.e?f/h:1-f/h),R.push(P),P++}a.push(R)}for(B=0;B<J;B++)for(o=0;o<q+V+S;o++){const R=a[o][B],x=a[o+1][B],H=a[o+1][B+1],k=a[o][B+1];b.push(R),b.push(x),b.push(k),b.push(x),b.push(H),b.push(k)}if(b=b.reverse(),R.orientation&&!R.orientation.equals(k.o.Up())){const x=new k.e;R.orientation.clone().scale(.5*Math.PI).cross(k.o.Up()).toQuaternion().toRotationMatrix(x);const H=k.o.Zero();for(let R=0;R<C.length;R+=3)H.set(C[R],C[R+1],C[R+2]),k.o.TransformCoordinatesToRef(H.clone(),x,H),C[R]=H.x,C[R+1]=H.y,C[R+2]=H.z}const K=new A.d;return K.xa=C,K.ya=F,K.Aa=d,K.indices=b,K}function u(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:k.o.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new c.d(R,H);return e(x).Ca(t,x.updatable),t}c.d.CreateDecal=(R,x,H,k,c,t)=>l(R,x,{position:H,dj:k,size:c,angle:t});c.d.CreateCapsule=(R,x,H)=>u(R,x,H),A.d.CreateCapsule=e;var Y=H(493),RR=H(668);class xR{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=R,this.y=x,R!==Math.floor(R)&&(R=Math.floor(R),Y.c.Warn("x is not an integer, floor(x) used")),x!==Math.floor(x)&&(x=Math.floor(x),Y.c.Warn("y is not an integer, floor(y) used"))}clone(){return new xR(this.x,this.y)}rotate60About(R){const x=this.x;return this.x=R.x+R.y-this.y,this.y=x+this.y-R.x,this}rotateNeg60About(R){const x=this.x;return this.x=x+this.y-R.y,this.y=R.x+R.y-x,this}rotate120(R,x){R!==Math.floor(R)&&(R=Math.floor(R),Y.c.Warn("m not an integer only floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),Y.c.Warn("n not an integer only floor(n) used"));const H=this.x;return this.x=R-H-this.y,this.y=x+H,this}rotateNeg120(R,x){R!==Math.floor(R)&&(R=Math.floor(R),Y.c.Warn("m is not an integer, floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),Y.c.Warn("n is not an integer,   floor(n) used"));const H=this.x;return this.x=this.y-x,this.y=R+x-H-this.y,this}toCartesianOrigin(R,x){const H=k.o.Zero();return H.x=R.x+2*this.x*x+this.y*x,H.y=R.y+Math.sqrt(3)*this.y*x,H}static Zero(){return new xR(0,0)}}class HR{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new kR("icosahedron","Regular",[[0,RR.g,-1],[-RR.g,1,0],[-1,0,-RR.g],[1,0,-RR.g],[RR.g,1,0],[0,RR.g,1],[-1,0,RR.g],[-RR.g,-1,0],[0,-RR.g,-1],[RR.g,-1,0],[1,0,RR.g],[0,-RR.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let R=12;const x={},H=this.m,k=this.n;let c,t,A,D,U,J=H,V=1,n=0;0!==k&&(J=(0,T.HighestCommonFactor)(H,k)),V=H/J,n=k/J;const g=xR.Zero(),I=new xR(H,k),i=new xR(-k,H+k),q=xR.Zero(),S=xR.Zero(),L=xR.Zero();let b,C,F,d,P=[];const a=[],X=this.vertByDist,M=(H,k,c,t)=>{b=H+"|"+c,C=k+"|"+t,b in x||C in x?b in x&&!(C in x)?x[C]=x[b]:C in x&&!(b in x)&&(x[b]=x[C]):(x[b]=R,x[C]=R,R++),X[c][0]>2?a[x[b]]=[-X[c][0],X[c][1],x[b]]:a[x[b]]=[P[X[c][0]],X[c][1],x[b]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let B=0;B<20;B++){if(P=this.IDATA.face[B],A=P[2],D=P[1],U=P[0],F=g.x+"|"+g.y,b=B+"|"+F,b in x||(x[b]=A,a[A]=[P[X[F][0]],X[F][1]]),F=I.x+"|"+I.y,b=B+"|"+F,b in x||(x[b]=D,a[D]=[P[X[F][0]],X[F][1]]),F=i.x+"|"+i.y,b=B+"|"+F,b in x||(x[b]=U,a[U]=[P[X[F][0]],X[F][1]]),c=this.IDATA.edgematch[B][0],t=this.IDATA.edgematch[B][1],"B"===t)for(let R=1;R<J;R++)S.x=H-R*(V+n),S.y=k+R*V,L.x=-R*n,L.y=R*(V+n),F=S.x+"|"+S.y,d=L.x+"|"+L.y,M(B,c,F,d);if("O"===t)for(let R=1;R<J;R++)L.x=-R*n,L.y=R*(V+n),q.x=R*V,q.y=R*n,F=L.x+"|"+L.y,d=q.x+"|"+q.y,M(B,c,F,d);if(c=this.IDATA.edgematch[B][2],t=this.IDATA.edgematch[B][3],t&&"A"===t)for(let R=1;R<J;R++)q.x=R*V,q.y=R*n,S.x=H-(J-R)*(V+n),S.y=k+(J-R)*V,F=q.x+"|"+q.y,d=S.x+"|"+S.y,M(B,c,F,d);for(let H=0;H<this.vertices.length;H++)F=this.vertices[H].x+"|"+this.vertices[H].y,b=B+"|"+F,b in x||(x[b]=R++,X[F][0]>2?a[x[b]]=[-X[F][0],X[F][1],x[b]]:a[x[b]]=[P[X[F][0]],X[F][1],x[b]])}this.closestTo=a,this.vecToidx=x}calcCoeffs(){const R=this.m,x=this.n,H=Math.sqrt(3)/3,k=R*R+x*x+R*x;this.coau=(R+x)/k,this.cobu=-x/k,this.coav=-H*(R-x)/k,this.cobv=H*(2*R+x)/k}createInnerFacets(){const R=this.m,x=this.n;for(let H=0;H<x+R+1;H++)for(let R=this.min[H];R<this.max[H]+1;R++)R<this.max[H]&&R<this.max[H+1]+1&&this.innerFacets.push(["|"+R+"|"+H,"|"+R+"|"+(H+1),"|"+(R+1)+"|"+H]),H>0&&R<this.max[H-1]&&R+1<this.max[H]+1&&this.innerFacets.push(["|"+R+"|"+H,"|"+(R+1)+"|"+H,"|"+(R+1)+"|"+(H-1)])}edgeVecsABOB(){const R=this.m,x=this.n,H=new xR(-x,R+x);for(let k=1;k<R+x;k++){const R=new xR(this.min[k],k),x=new xR(this.min[k-1],k-1),c=new xR(this.min[k+1],k+1),t=R.clone(),A=x.clone(),D=c.clone();t.rotate60About(H),A.rotate60About(H),D.rotate60About(H);const U=new xR(this.max[t.y],t.y),J=new xR(this.max[t.y-1],t.y-1),V=new xR(this.max[t.y-1]-1,t.y-1);t.x===U.x&&t.y===U.y||(t.x!==J.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,J,V]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,V,U])):t.y===D.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,x,J]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([R,J,c])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,x,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,J,U])))}}mapABOBtoOBOA(){const R=new xR(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const H=[];for(let k=0;k<3;k++)R.x=this.isoVecsABOB[x][k].x,R.y=this.isoVecsABOB[x][k].y,0===this.vertexTypes[x][k]&&R.rotateNeg120(this.m,this.n),H.push(R.clone());this.isoVecsOBOA.push(H)}}mapABOBtoBAOA(){const R=new xR(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const H=[];for(let k=0;k<3;k++)R.x=this.isoVecsABOB[x][k].x,R.y=this.isoVecsABOB[x][k].y,1===this.vertexTypes[x][k]&&R.rotate120(this.m,this.n),H.push(R.clone());this.isoVecsBAOA.push(H)}}MapToFace(R,x){const H=this.IDATA.face[R],c=H[2],t=H[1],A=H[0],D=k.o.zi(this.IDATA.vertex[c]),U=k.o.zi(this.IDATA.vertex[t]),J=k.o.zi(this.IDATA.vertex[A]),V=U.Pg(D),n=J.Pg(D),g=V.scale(this.coau).add(n.scale(this.cobu)),I=V.scale(this.coav).add(n.scale(this.cobv)),i=[];let q,S=k.g.Bi[0];for(let k=0;k<this.cartesian.length;k++)S=g.scale(this.cartesian[k].x).add(I.scale(this.cartesian[k].y)).add(D),i[k]=[S.x,S.y,S.z],q=R+"|"+this.vertices[k].x+"|"+this.vertices[k].y,x.vertex[this.vecToidx[q]]=[S.x,S.y,S.z]}build(R,x){const H=[],k=xR.Zero(),c=new xR(R,x),t=new xR(-x,R+x);H.push(k,c,t);for(let F=x;F<R+1;F++)for(let x=0;x<R+1-F;x++)H.push(new xR(x,F));if(x>0){const k=(0,T.HighestCommonFactor)(R,x),c=R/k,t=x/k;for(let D=1;D<k;D++)H.push(new xR(D*c,D*t)),H.push(new xR(-D*t,D*(c+t))),H.push(new xR(R-D*(c+t),x+D*c));const A=R/x;for(let D=1;D<x;D++)for(let k=0;k<D*A;k++)H.push(new xR(k,D)),H.push(new xR(k,D).rotate120(R,x)),H.push(new xR(k,D).rotateNeg120(R,x))}H.sort(((R,x)=>R.x-x.x)),H.sort(((R,x)=>R.y-x.y));const A=new Array(R+x+1),D=new Array(R+x+1);for(let F=0;F<A.length;F++)A[F]=1/0,D[F]=-1/0;let U=0,J=0;const V=H.length;for(let F=0;F<V;F++)J=H[F].x,U=H[F].y,A[U]=Math.min(J,A[U]),D[U]=Math.max(J,D[U]);const n=(H,k)=>{const c=H.clone();return"A"===k&&c.rotateNeg120(R,x),"B"===k&&c.rotate120(R,x),c.x<0?c.y:c.x+c.y},g=[],I=[],i=[],q=[],S={},L=[];let b=-1,C=-1;for(let F=0;F<V;F++)g[F]=H[F].toCartesianOrigin(new xR(0,0),.5),I[F]=n(H[F],"O"),i[F]=n(H[F],"A"),q[F]=n(H[F],"B"),I[F]===i[F]&&i[F]===q[F]?(b=3,C=I[F]):I[F]===i[F]?(b=4,C=I[F]):i[F]===q[F]?(b=5,C=i[F]):q[F]===I[F]&&(b=6,C=I[F]),I[F]<i[F]&&I[F]<q[F]&&(b=2,C=I[F]),i[F]<I[F]&&i[F]<q[F]&&(b=1,C=i[F]),q[F]<i[F]&&q[F]<I[F]&&(b=0,C=q[F]),L.push([b,C,H[F].x,H[F].y]);L.sort(((R,x)=>R[2]-x[2])),L.sort(((R,x)=>R[3]-x[3])),L.sort(((R,x)=>R[1]-x[1])),L.sort(((R,x)=>R[0]-x[0]));for(let F=0;F<L.length;F++)S[L[F][2]+"|"+L[F][3]]=[L[F][0],L[F][1],F];return this.m=R,this.n=x,this.vertices=H,this.vertByDist=S,this.cartesian=g,this.min=A,this.max=D,this}}class kR{constructor(R,x,H,k){this.name=R,this.category=x,this.vertex=H,this.face=k}}class cR extends kR{innerToData(R,x){for(let H=0;H<x.innerFacets.length;H++)this.face.push(x.innerFacets[H].map((H=>x.vecToidx[R+H])))}mapABOBtoDATA(R,x){const H=x.IDATA.edgematch[R][0];for(let k=0;k<x.isoVecsABOB.length;k++){const c=[];for(let t=0;t<3;t++)0===x.vertexTypes[k][t]?c.push(R+"|"+x.isoVecsABOB[k][t].x+"|"+x.isoVecsABOB[k][t].y):c.push(H+"|"+x.isoVecsABOB[k][t].x+"|"+x.isoVecsABOB[k][t].y);this.face.push([x.vecToidx[c[0]],x.vecToidx[c[1]],x.vecToidx[c[2]]])}}mapOBOAtoDATA(R,x){const H=x.IDATA.edgematch[R][0];for(let k=0;k<x.isoVecsOBOA.length;k++){const c=[];for(let t=0;t<3;t++)1===x.vertexTypes[k][t]?c.push(R+"|"+x.isoVecsOBOA[k][t].x+"|"+x.isoVecsOBOA[k][t].y):c.push(H+"|"+x.isoVecsOBOA[k][t].x+"|"+x.isoVecsOBOA[k][t].y);this.face.push([x.vecToidx[c[0]],x.vecToidx[c[1]],x.vecToidx[c[2]]])}}mapBAOAtoDATA(R,x){const H=x.IDATA.edgematch[R][2];for(let k=0;k<x.isoVecsBAOA.length;k++){const c=[];for(let t=0;t<3;t++)1===x.vertexTypes[k][t]?c.push(R+"|"+x.isoVecsBAOA[k][t].x+"|"+x.isoVecsBAOA[k][t].y):c.push(H+"|"+x.isoVecsBAOA[k][t].x+"|"+x.isoVecsBAOA[k][t].y);this.face.push([x.vecToidx[c[0]],x.vecToidx[c[1]],x.vecToidx[c[2]]])}}orderData(R){const x=[];for(let t=0;t<13;t++)x[t]=[];const H=R.closestTo;for(let t=0;t<H.length;t++)H[t][0]>-1?H[t][1]>0&&x[H[t][0]].push([t,H[t][1]]):x[12].push([t,H[t][0]]);const k=[];for(let t=0;t<12;t++)k[t]=t;let c=12;for(let t=0;t<12;t++){x[t].sort(((R,x)=>R[1]-x[1]));for(let R=0;R<x[t].length;R++)k[x[t][R][0]]=c++}for(let t=0;t<x[12].length;t++)k[x[12][t][0]]=c++;for(let t=0;t<this.vertex.length;t++)this.vertex[t].push(k[t]);this.vertex.sort(((R,x)=>R[3]-x[3]));for(let t=0;t<this.vertex.length;t++)this.vertex[t].pop();for(let t=0;t<this.face.length;t++)for(let R=0;R<this.face[t].length;R++)this.face[t][R]=k[this.face[t][R]];this.sharedNodes=x[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(R,x){const H=[],k=[];let c=x.pop();k.push(c);let t=this.face[c].indexOf(R);t=(t+2)%3;let A=this.face[c][t];H.push(A);let D=0;for(;x.length>0;)c=x[D],this.face[c].indexOf(A)>-1?(t=(this.face[c].indexOf(A)+1)%3,A=this.face[c][t],H.push(A),k.push(c),x.splice(D,1),D=0):D++;return this.adjacentFaces.push(H),k}toGoldbergPolyhedronData(){const R=new kR("GeoDual","Goldberg",[],[]);R.name="GD dual";const x=this.vertex.length,H=new Array(x);for(let U=0;U<x;U++)H[U]=[];for(let U=0;U<this.face.length;U++)for(let R=0;R<3;R++)H[this.face[U][R]].push(U);let k=0,c=0,t=0,A=[],D=[];this.adjacentFaces=[];for(let U=0;U<H.length;U++){R.face[U]=this.setOrder(U,H[U].concat([]));for(const x of H[U]){k=0,c=0,t=0,A=this.face[x];for(let R=0;R<3;R++)D=this.vertex[A[R]],k+=D[0],c+=D[1],t+=D[2];R.vertex[x]=[k/3,c/3,t/3]}}return R}static BuildGeodesicData(R){const x=new cR("Geodesic-m-n","Geodesic",[[0,RR.g,-1],[-RR.g,1,0],[-1,0,-RR.g],[1,0,-RR.g],[RR.g,1,0],[0,RR.g,1],[-1,0,RR.g],[-RR.g,-1,0],[0,-RR.g,-1],[RR.g,-1,0],[1,0,RR.g],[0,-RR.g,1]],[]);R.setIndices(),R.calcCoeffs(),R.createInnerFacets(),R.edgeVecsABOB(),R.mapABOBtoOBOA(),R.mapABOBtoBAOA();for(let H=0;H<R.IDATA.face.length;H++)R.MapToFace(H,x),x.innerToData(H,R),"B"===R.IDATA.edgematch[H][1]&&x.mapABOBtoDATA(H,R),"O"===R.IDATA.edgematch[H][1]&&x.mapOBOAtoDATA(H,R),"A"===R.IDATA.edgematch[H][3]&&x.mapBAOAtoDATA(H,R);x.orderData(R);return x.vertex=x.vertex.map((function(R){const x=R[0],H=R[1],k=R[2],c=Math.sqrt(x*x+H*H+k*k);return R[0]*=1/c,R[1]*=1/c,R[2]*=1/c,R})),x}}c.d._GoldbergMeshParser=(R,x)=>tR.Parse(R,x);class tR extends c.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(R,x){return void 0===x?(R>this.goldbergData.nbUnsharedFaces-1&&(Y.c.Warn("Maximum number of unshared faces used"),R=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+R):(R>11&&(Y.c.Warn("Last pole used"),R=11),x>this.goldbergData.nbFacesAtPole-1&&(Y.c.Warn("Maximum number of faces at a pole used"),x=this.goldbergData.nbFacesAtPole-1),12+R*this.goldbergData.nbFacesAtPole+x)}_changeGoldbergFaceColors(R){for(let H=0;H<R.length;H++){const x=R[H][0],k=R[H][1],c=R[H][2];for(let R=x;R<k+1;R++)this.goldbergData.faceColors[R]=c}const x=[];for(let H=0;H<12;H++)for(let R=0;R<5;R++)x.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);for(let H=12;H<this.goldbergData.faceColors.length;H++)for(let R=0;R<6;R++)x.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);return x}setGoldbergFaceColors(R){const x=this._changeGoldbergFaceColors(R);this.Ga(t.g.ColorKind,x)}updateGoldbergFaceColors(R){const x=this._changeGoldbergFaceColors(R);this.updateVerticesData(t.g.ColorKind,x)}_changeGoldbergFaceUVs(R){const x=this.getVerticesData(t.g.UVKind);for(let H=0;H<R.length;H++){const k=R[H][0],c=R[H][1],t=R[H][2],A=R[H][3],D=R[H][4],U=[],J=[];let V,n;for(let R=0;R<5;R++)V=t.x+A*Math.cos(D+R*Math.PI/2.5),n=t.y+A*Math.sin(D+R*Math.PI/2.5),V<0&&(V=0),V>1&&(V=1),U.push(V,n);for(let R=0;R<6;R++)V=t.x+A*Math.cos(D+R*Math.PI/3),n=t.y+A*Math.sin(D+R*Math.PI/3),V<0&&(V=0),V>1&&(V=1),J.push(V,n);for(let R=k;R<Math.min(12,c+1);R++)for(let H=0;H<5;H++)x[10*R+2*H]=U[2*H],x[10*R+2*H+1]=U[2*H+1];for(let R=Math.max(12,k);R<c+1;R++)for(let H=0;H<6;H++)x[12*R-24+2*H]=J[2*H],x[12*R-23+2*H]=J[2*H+1]}return x}setGoldbergFaceUVs(R){const x=this._changeGoldbergFaceUVs(R);this.Ga(t.g.UVKind,x)}updateGoldbergFaceUVs(R){const x=this._changeGoldbergFaceUVs(R);this.updateVerticesData(t.g.UVKind,x)}placeOnGoldbergFaceAt(R,x,H){const c=k.o.RotationFromAxis(this.goldbergData.faceXaxis[x],this.goldbergData.faceYaxis[x],this.goldbergData.faceZaxis[x]);R.rotation=c,R.position=this.goldbergData.faceCenters[x].add(this.goldbergData.faceXaxis[x].scale(H.x)).add(this.goldbergData.faceYaxis[x].scale(H.y)).add(this.goldbergData.faceZaxis[x].scale(H.z))}serialize(R){super.serialize(R),R.type="GoldbergMesh";const x={};if(x.adjacentFaces=this.goldbergData.adjacentFaces,x.nbSharedFaces=this.goldbergData.nbSharedFaces,x.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,x.nbFaces=this.goldbergData.nbFaces,x.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){x.faceColors=[];for(const R of this.goldbergData.faceColors)x.faceColors.push(R.Li())}if(this.goldbergData.faceCenters){x.faceCenters=[];for(const R of this.goldbergData.faceCenters)x.faceCenters.push(R.Li())}if(this.goldbergData.faceZaxis){x.faceZaxis=[];for(const R of this.goldbergData.faceZaxis)x.faceZaxis.push(R.Li())}if(this.goldbergData.faceYaxis){x.faceYaxis=[];for(const R of this.goldbergData.faceYaxis)x.faceYaxis.push(R.Li())}if(this.goldbergData.faceXaxis){x.faceXaxis=[];for(const R of this.goldbergData.faceXaxis)x.faceXaxis.push(R.Li())}R.goldbergData=x}static Parse(R,x){const H=R.goldbergData;H.faceColors=H.faceColors.map((R=>g.d.zi(R))),H.faceCenters=H.faceCenters.map((R=>k.o.zi(R))),H.faceZaxis=H.faceZaxis.map((R=>k.o.zi(R))),H.faceXaxis=H.faceXaxis.map((R=>k.o.zi(R))),H.faceYaxis=H.faceYaxis.map((R=>k.o.zi(R)));const c=new tR(R.name,x);return c.goldbergData=H,c}}var AR=H(12370);const DR={CreateBox:n.c,CreateTiledBox:S,CreateSphere:L.e,CreateDisc:V.d,CreateIcoSphere:G,CreateRibbon:J,CreateCylinder:d,CreateTorus:a,CreateTorusKnot:M,CreateLineSystem:B.i,Qi:B.l,CreateDashedLines:B.e,ExtrudeShape:y,ExtrudeShapeCustom:s,CreateLathe:w,CreateTiledPlane:i,Ri:h.d,CreateGround:f.f,CreateTiledGround:f.h,CreateGroundFromHeightMap:f.b,CreatePolygon:o.c,ExtrudePolygon:o.e,CreateTube:N,CreatePolyhedron:K,CreateGeodesic:function(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=x.m||1;k!==Math.floor(k)&&(k=Math.floor(k),Y.c.Warn("m not an integer only floor(m) used"));let c=x.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),Y.c.Warn("n not an integer only floor(n) used")),c>k){const R=c;c=k,k=R,Y.c.Warn("n > m therefore m and n swapped")}const t=new HR;return t.build(k,c),K(R,{custom:cR.BuildGeodesicData(t),size:x.size,sizeX:x.sizeX,sizeY:x.sizeY,sizeZ:x.sizeZ,faceUV:x.faceUV,faceColors:x.faceColors,flat:x.flat,updatable:x.updatable,sideOrientation:x.sideOrientation,frontUVs:x.frontUVs,backUVs:x.backUVs},H)},CreateGoldberg:function(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=x.size,U=x.sizeX||t||1,J=x.sizeY||t||1,V=x.sizeZ||t||1;let n=x.m||1;n!==Math.floor(n)&&(n=Math.floor(n),Y.c.Warn("m not an integer only floor(m) used"));let I=x.n||0;if(I!==Math.floor(I)&&(I=Math.floor(I),Y.c.Warn("n not an integer only floor(n) used")),I>n){const R=I;I=n,n=R,Y.c.Warn("n > m therefore m and n swapped")}const i=new HR;i.build(n,I);const q=cR.BuildGeodesicData(i),S=q.toGoldbergPolyhedronData(),L=new tR(R,H);x.sideOrientation=c.d._GetDefaultSideOrientation(x.sideOrientation),L._originalBuilderSideOrientation=x.sideOrientation;(function(R,x){const H=R.size,c=R.sizeX||H||1,t=R.sizeY||H||1,U=R.sizeZ||H||1,J=0===R.sideOrientation?0:R.sideOrientation||A.d.DEFAULTSIDE,V=[],n=[],g=[],I=[];let i=1/0,q=-1/0,S=1/0,L=-1/0;for(let k=0;k<x.vertex.length;k++)i=Math.min(i,x.vertex[k][0]*c),q=Math.max(q,x.vertex[k][0]*c),S=Math.min(S,x.vertex[k][1]*t),L=Math.max(L,x.vertex[k][1]*t);let b=0;for(let A=0;A<x.face.length;A++){const R=x.face[A],H=k.o.zi(x.vertex[R[0]]),J=k.o.zi(x.vertex[R[2]]),C=k.o.zi(x.vertex[R[1]]),F=J.Pg(H),d=C.Pg(H),P=k.o.Cross(d,F).normalize();for(let k=0;k<R.length;k++){g.push(P.x,P.y,P.z);const H=x.vertex[R[k]];V.push(H[0]*c,H[1]*t,H[2]*U);const A=(H[1]*t-S)/(L-S);I.push((H[0]*c-i)/(q-i),D.e?1-A:A)}for(let x=0;x<R.length-2;x++)n.push(b,b+x+2,b+x+1);b+=R.length}A.d._ComputeSides(J,V,n,g,I);const C=new A.d;return C.xa=V,C.indices=n,C.ya=g,C.Aa=I,C})(x,S).Ca(L,x.updatable),L.goldbergData.nbSharedFaces=q.sharedNodes,L.goldbergData.nbUnsharedFaces=q.poleNodes,L.goldbergData.adjacentFaces=q.adjacentFaces,L.goldbergData.nbFaces=L.goldbergData.nbSharedFaces+L.goldbergData.nbUnsharedFaces,L.goldbergData.nbFacesAtPole=(L.goldbergData.nbUnsharedFaces-12)/12;for(let c=0;c<q.vertex.length;c++)L.goldbergData.faceCenters.push(k.o.zi(q.vertex[c])),L.goldbergData.faceCenters[c].x*=U,L.goldbergData.faceCenters[c].y*=J,L.goldbergData.faceCenters[c].z*=V,L.goldbergData.faceColors.push(new g.d(1,1,1,1));for(let c=0;c<S.face.length;c++){const R=S.face[c],x=k.o.zi(S.vertex[R[0]]),H=k.o.zi(S.vertex[R[2]]),t=k.o.zi(S.vertex[R[1]]),A=H.Pg(x),D=t.Pg(x),U=k.o.Cross(D,A).normalize(),J=k.o.Cross(D,U).normalize();L.goldbergData.faceXaxis.push(D.normalize()),L.goldbergData.faceYaxis.push(U),L.goldbergData.faceZaxis.push(J)}return L},CreateDecal:l,CreateCapsule:u,CreateText:AR.h}},12849:(R,x,H)=>{"use strict";H.d(x,{e:()=>Dx});var k=H(661),c=H(12276);class t extends c.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var A=H(695),D=(H(2388),H(610));class U{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(R){this._targetStopDuration!==R&&(this._targetStopDuration=R)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(R){this._noiseTexture!==R&&(this._noiseTexture=R,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(R){this._animationSheetEnabled!==R&&(this._animationSheetEnabled=R)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(R){this._isAnimationSheetEnabled!=R&&(this._isAnimationSheetEnabled=R,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(R){this._useLogarithmicDepth=R&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(R){switch(R){case U.BLENDMODE_MULTIPLYADD:return;case U.BLENDMODE_ADD:R=1;break;case U.BLENDMODE_ONEONE:R=6;break;case U.BLENDMODE_STANDARD:R=2;break;case U.BLENDMODE_MULTIPLY:R=4;break;case U.BLENDMODE_SUBTRACT:R=3}this._engine.setAlphaMode(R)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:k.o.Zero()}set direction1(R){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=R)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:k.o.Zero()}set direction2(R){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=R)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:k.o.Zero()}set minEmitBox(R){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=R)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:k.o.Zero()}set maxEmitBox(R){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=R)}get billboardMode(){return this._billboardMode}set billboardMode(R){this._billboardMode!==R&&(this._billboardMode=R,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(R){this._isBillboardBased!==R&&(this._isBillboardBased=R,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(R){this._attachImageProcessingConfiguration(R)}_attachImageProcessingConfiguration(R){R!==this._imageProcessingConfiguration&&(!R&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=R)}_reset(){}_removeGradientAndTexture(R,x,H){if(!x)return this;let k=0;for(const c of x){if(c.gradient===R){x.splice(k,1);break}k++}return H&&H.dispose(),this}constructor(R){this.animations=[],this.renderingGroupId=0,this.j=k.o.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new k.o(10,10,10),this.onAnimationEnd=null,this.blendMode=U.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new k.k(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.me=new k.o(0,0,0),this._useLogarithmicDepth=!1,this.gravity=k.o.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new A.d(1,1,1,1),this.color2=new A.d(1,1,1,1),this.colorDead=new A.d(0,0,0,1),this.textureMask=new A.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new t,this.id=R,this.name=R}createPointEmitter(R,x){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new k.o(0,1,0),arguments.length>2&&void 0!==arguments[2]||new k.o(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new k.o(0,1,0),arguments.length>4&&void 0!==arguments[4]||new k.o(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new k.o(0,1,0),arguments.length>3&&void 0!==arguments[3]||new k.o(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(R,x,H,k){throw new Error("Method not implemented.")}}U.BLENDMODE_ONEONE=0,U.BLENDMODE_STANDARD=1,U.BLENDMODE_ADD=2,U.BLENDMODE_MULTIPLY=3,U.BLENDMODE_MULTIPLYADD=4,U.BLENDMODE_SUBTRACT=-1,(0,D.h)("BABYLON.BaseParticleSystem",U);var J=H(681),V=H(497);class n{constructor(){this.direction1=new k.o(0,1,0),this.direction2=new k.o(0,1,0),this.minEmitBox=new k.o(-.5,-.5,-.5),this.maxEmitBox=new k.o(.5,.5,.5)}startDirectionFunction(R,x,H,c){const t=(0,J.RandomRange)(this.direction1.x,this.direction2.x),A=(0,J.RandomRange)(this.direction1.y,this.direction2.y),D=(0,J.RandomRange)(this.direction1.z,this.direction2.z);if(c)return x.x=t,x.y=A,void(x.z=D);k.o.TransformNormalFromFloatsToRef(t,A,D,R,x)}startPositionFunction(R,x,H,c){const t=(0,J.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),A=(0,J.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),D=(0,J.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(c)return x.x=t,x.y=A,void(x.z=D);k.o.TransformCoordinatesFromFloatsToRef(t,A,D,R,x)}clone(){const R=new n;return V.b.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2),R.setVector3("minEmitBox",this.minEmitBox),R.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3),R.addUniform("minEmitBox",3),R.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.Li(),R.direction2=this.direction2.Li(),R.minEmitBox=this.minEmitBox.Li(),R.maxEmitBox=this.maxEmitBox.Li(),R}parse(R){k.o.FromArrayToRef(R.direction1,0,this.direction1),k.o.FromArrayToRef(R.direction2,0,this.direction2),k.o.FromArrayToRef(R.minEmitBox,0,this.minEmitBox),k.o.FromArrayToRef(R.maxEmitBox,0,this.maxEmitBox)}}class g{get radius(){return this._radius}set radius(R){this._radius=R,this._buildHeight()}get angle(){return this._angle}set angle(R){this._angle=R,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=H,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=x,this.radius=R}startDirectionFunction(R,x,H,c){c?k.g.Bi[0].p(H.Mg).normalize():H.position.subtractToRef(R.getTranslation(),k.g.Bi[0]).normalize();const t=(0,J.RandomRange)(0,this.directionRandomizer),A=(0,J.RandomRange)(0,this.directionRandomizer),D=(0,J.RandomRange)(0,this.directionRandomizer);x.x=k.g.Bi[0].x+t,x.y=k.g.Bi[0].y+A,x.z=k.g.Bi[0].z+D,x.normalize()}startPositionFunction(R,x,H,c){const t=(0,J.RandomRange)(0,2*Math.PI);let A;this.emitFromSpawnPointOnly?A=1e-4:(A=(0,J.RandomRange)(0,this.heightRange),A=1-A*A);let D=this._radius-(0,J.RandomRange)(0,this._radius*this.radiusRange);D*=A;const U=D*Math.sin(t),V=D*Math.cos(t),n=A*this._height;if(c)return x.x=U,x.y=n,void(x.z=V);k.o.TransformCoordinatesFromFloatsToRef(U,n,V,R,x)}clone(){const R=new g(this._radius,this._angle,this.directionRandomizer);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setFloat2("radius",this._radius,this.radiusRange),R.setFloat("coneAngle",this._angle),R.setFloat2("height",this._height,this.heightRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",2),R.addUniform("coneAngle",1),R.addUniform("height",2),R.addUniform("directionRandomizer",1)}getEffectDefines(){let R="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(R+="\n#define CONEEMITTERSPAWNPOINT"),R}getClassName(){return"ConeParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this._radius,R.angle=this._angle,R.directionRandomizer=this.directionRandomizer,R.radiusRange=this.radiusRange,R.heightRange=this.heightRange,R.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,R}parse(R){this.radius=R.radius,this.angle=R.angle,this.directionRandomizer=R.directionRandomizer,this.radiusRange=void 0!==R.radiusRange?R.radiusRange:1,this.heightRange=void 0!==R.radiusRange?R.heightRange:1,this.emitFromSpawnPointOnly=void 0!==R.emitFromSpawnPointOnly&&R.emitFromSpawnPointOnly}}class I extends g{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0);super(R,x),this.direction1=H,this.direction2=c}startDirectionFunction(R,x){const H=(0,J.RandomRange)(this.direction1.x,this.direction2.x),c=(0,J.RandomRange)(this.direction1.y,this.direction2.y),t=(0,J.RandomRange)(this.direction1.z,this.direction2.z);k.o.TransformNormalFromFloatsToRef(H,c,t,R,x)}clone(){const R=new I(this.radius,this.angle,this.direction1,this.direction2);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.Li(),R.direction2=this.direction2.Li(),R}parse(R){super.parse(R),this.direction1.p(R.direction1),this.direction2.p(R.direction2)}}class i{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=R,this.height=x,this.radiusRange=H,this.directionRandomizer=c,this._tempVector=k.o.Zero()}startDirectionFunction(R,x,H,c,t){H.position.subtractToRef(R.getTranslation(),this._tempVector),this._tempVector.normalize(),k.o.TransformNormalToRef(this._tempVector,t,this._tempVector);const A=(0,J.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let D=Math.atan2(this._tempVector.x,this._tempVector.z);D+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=A,this._tempVector.x=Math.sin(D),this._tempVector.z=Math.cos(D),this._tempVector.normalize(),c?x.p(this._tempVector):k.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,R,x)}startPositionFunction(R,x,H,c){const t=(0,J.RandomRange)(-this.height/2,this.height/2),A=(0,J.RandomRange)(0,2*Math.PI),D=(0,J.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),U=Math.sqrt(D)*this.radius,V=U*Math.cos(A),n=U*Math.sin(A);c?x.si(V,t,n):k.o.TransformCoordinatesFromFloatsToRef(V,t,n,R,x)}clone(){const R=new i(this.radius,this.directionRandomizer);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.height=this.height,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.height=R.height,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class q extends i{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.o(0,1,0);super(R,x,H),this.direction1=c,this.direction2=t}startDirectionFunction(R,x,H,c){const t=(0,J.RandomRange)(this.direction1.x,this.direction2.x),A=(0,J.RandomRange)(this.direction1.y,this.direction2.y),D=(0,J.RandomRange)(this.direction1.z,this.direction2.z);c?x.si(t,A,D):k.o.TransformNormalFromFloatsToRef(t,A,D,R,x)}clone(){const R=new q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.Li(),R.direction2=this.direction2.Li(),R}parse(R){super.parse(R),k.o.FromArrayToRef(R.direction1,0,this.direction1),k.o.FromArrayToRef(R.direction2,0,this.direction2)}}class S{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=R,this.radiusRange=x,this.directionRandomizer=H}startDirectionFunction(R,x,H,c){const t=H.position.Pg(R.getTranslation()).normalize(),A=(0,J.RandomRange)(0,this.directionRandomizer),D=(0,J.RandomRange)(0,this.directionRandomizer),U=(0,J.RandomRange)(0,this.directionRandomizer);t.x+=A,t.y+=D,t.z+=U,t.normalize(),c?x.p(t):k.o.TransformNormalFromFloatsToRef(t.x,t.y,t.z,R,x)}startPositionFunction(R,x,H,c){const t=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),A=(0,J.RandomRange)(0,1),D=(0,J.RandomRange)(0,2*Math.PI),U=Math.acos(2*A-1),V=t*Math.cos(D)*Math.sin(U),n=t*Math.cos(U),g=t*Math.sin(D)*Math.sin(U);c?x.si(V,Math.abs(n),g):k.o.TransformCoordinatesFromFloatsToRef(V,Math.abs(n),g,R,x)}clone(){const R=new S(this.radius,this.directionRandomizer);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class L{constructor(){this.direction1=new k.o(0,1,0),this.direction2=new k.o(0,1,0)}startDirectionFunction(R,x,H,c){const t=(0,J.RandomRange)(this.direction1.x,this.direction2.x),A=(0,J.RandomRange)(this.direction1.y,this.direction2.y),D=(0,J.RandomRange)(this.direction1.z,this.direction2.z);c?x.si(t,A,D):k.o.TransformNormalFromFloatsToRef(t,A,D,R,x)}startPositionFunction(R,x,H,c){c?x.si(0,0,0):k.o.TransformCoordinatesFromFloatsToRef(0,0,0,R,x)}clone(){const R=new L;return V.b.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.Li(),R.direction2=this.direction2.Li(),R}parse(R){k.o.FromArrayToRef(R.direction1,0,this.direction1),k.o.FromArrayToRef(R.direction2,0,this.direction2)}}class b{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=R,this.radiusRange=x,this.directionRandomizer=H}startDirectionFunction(R,x,H,c){const t=H.position.Pg(R.getTranslation()).normalize(),A=(0,J.RandomRange)(0,this.directionRandomizer),D=(0,J.RandomRange)(0,this.directionRandomizer),U=(0,J.RandomRange)(0,this.directionRandomizer);t.x+=A,t.y+=D,t.z+=U,t.normalize(),c?x.p(t):k.o.TransformNormalFromFloatsToRef(t.x,t.y,t.z,R,x)}startPositionFunction(R,x,H,c){const t=this.radius-(0,J.RandomRange)(0,this.radius*this.radiusRange),A=(0,J.RandomRange)(0,1),D=(0,J.RandomRange)(0,2*Math.PI),U=Math.acos(2*A-1),V=t*Math.cos(D)*Math.sin(U),n=t*Math.cos(U),g=t*Math.sin(D)*Math.sin(U);c?x.si(V,n,g):k.o.TransformCoordinatesFromFloatsToRef(V,n,g,R,x)}clone(){const R=new b(this.radius,this.directionRandomizer);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.radius=this.radius,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.radius=R.radius,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class C extends b{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.o(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0);super(R),this.direction1=x,this.direction2=H}startDirectionFunction(R,x){const H=(0,J.RandomRange)(this.direction1.x,this.direction2.x),c=(0,J.RandomRange)(this.direction1.y,this.direction2.y),t=(0,J.RandomRange)(this.direction1.z,this.direction2.z);k.o.TransformNormalFromFloatsToRef(H,c,t,R,x)}clone(){const R=new C(this.radius,this.direction1,this.direction2);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setFloat("radius",this.radius),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("radius",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.Li(),R.direction2=this.direction2.Li(),R}parse(R){super.parse(R),this.direction1.p(R.direction1),this.direction2.p(R.direction2)}}class F{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(R,x,H,c){const t=k.g.Bi[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,H,t);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,H,t);const R=k.g.Bi[1];t.subtractToRef(H.position,R),R.scaleToRef(1/H.lifeTime,t)}else t.set(0,0,0);c?x.p(t):k.o.TransformNormalToRef(t,R,x)}startPositionFunction(R,x,H,c){const t=k.g.Bi[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,H,t):t.set(0,0,0),c?x.p(t):k.o.TransformCoordinatesToRef(t,R,x)}clone(){const R=new F;return V.b.DeepCopy(this,R),R}applyToShader(R){}buildUniformLayout(R){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.particlePositionGenerator=this.particlePositionGenerator,R.particleDestinationGenerator=this.particleDestinationGenerator,R}parse(R){R.particlePositionGenerator&&(this.particlePositionGenerator=R.particlePositionGenerator),R.particleDestinationGenerator&&(this.particleDestinationGenerator=R.particleDestinationGenerator)}}var d=H(724);class P{get mesh(){return this._mesh}set mesh(R){this._mesh!==R&&(this._mesh=R,R?(this._indices=R.Gi(),this._positions=R.getVerticesData(d.g.PositionKind),this._normals=R.getVerticesData(d.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=k.o.Zero(),this._mesh=null,this.direction1=new k.o(0,1,0),this.direction2=new k.o(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=R}startDirectionFunction(R,x,H,c){if(this.useMeshNormalsForDirection&&this._normals)return void k.o.TransformNormalToRef(this._storedNormal,R,x);const t=(0,J.RandomRange)(this.direction1.x,this.direction2.x),A=(0,J.RandomRange)(this.direction1.y,this.direction2.y),D=(0,J.RandomRange)(this.direction1.z,this.direction2.z);c?x.si(t,A,D):k.o.TransformNormalFromFloatsToRef(t,A,D,R,x)}startPositionFunction(R,x,H,c){if(!this._indices||!this._positions)return;const t=3*(Math.random()*(this._indices.length/3)|0),A=Math.random(),D=Math.random()*(1-A),U=1-A-D,J=this._indices[t],V=this._indices[t+1],n=this._indices[t+2],g=k.g.Bi[0],I=k.g.Bi[1],i=k.g.Bi[2],q=k.g.Bi[3];k.o.FromArrayToRef(this._positions,3*J,g),k.o.FromArrayToRef(this._positions,3*V,I),k.o.FromArrayToRef(this._positions,3*n,i),q.x=A*g.x+D*I.x+U*i.x,q.y=A*g.y+D*I.y+U*i.y,q.z=A*g.z+D*I.z+U*i.z,c?x.si(q.x,q.y,q.z):k.o.TransformCoordinatesFromFloatsToRef(q.x,q.y,q.z,R,x),this.useMeshNormalsForDirection&&this._normals&&(k.o.FromArrayToRef(this._normals,3*J,g),k.o.FromArrayToRef(this._normals,3*V,I),k.o.FromArrayToRef(this._normals,3*n,i),this._storedNormal.x=A*g.x+D*I.x+U*i.x,this._storedNormal.y=A*g.y+D*I.y+U*i.y,this._storedNormal.z=A*g.z+D*I.z+U*i.z)}clone(){const R=new P(this.mesh);return V.b.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var R;const x={};return x.type=this.getClassName(),x.direction1=this.direction1.Li(),x.direction2=this.direction2.Li(),x.meshId=null===(R=this.mesh)||void 0===R?void 0:R.id,x.useMeshNormalsForDirection=this.useMeshNormalsForDirection,x}parse(R,x){k.o.FromArrayToRef(R.direction1,0,this.direction1),k.o.FromArrayToRef(R.direction2,0,this.direction2),R.meshId&&x&&(this.mesh=x.getLastMeshById(R.meshId)),this.useMeshNormalsForDirection=R.useMeshNormalsForDirection}}class a{_isUbo(R){return void 0!==R.addUniform}constructor(R){this._isUbo(R)?(this.setMatrix3x3=R.updateMatrix3x3.bind(R),this.setMatrix2x2=R.updateMatrix2x2.bind(R),this.setFloat=R.updateFloat.bind(R),this.setFloat2=R.updateFloat2.bind(R),this.setFloat3=R.updateFloat3.bind(R),this.setFloat4=R.updateFloat4.bind(R),this.setFloatArray=R.updateFloatArray.bind(R),this.setArray=R.updateArray.bind(R),this.setIntArray=R.updateIntArray.bind(R),this.setMatrix=R.jj.bind(R),this.setMatrices=R.updateMatrices.bind(R),this.setVector3=R.updateVector3.bind(R),this.setVector4=R.updateVector4.bind(R),this.setColor3=R.updateColor3.bind(R),this.setColor4=R.updateColor4.bind(R),this.setDirectColor4=R.updateDirectColor4.bind(R),this.setInt=R.updateInt.bind(R),this.setInt2=R.updateInt2.bind(R),this.setInt3=R.updateInt3.bind(R),this.setInt4=R.updateInt4.bind(R)):(this.setMatrix3x3=R.setMatrix3x3.bind(R),this.setMatrix2x2=R.setMatrix2x2.bind(R),this.setFloat=R.setFloat.bind(R),this.setFloat2=R.setFloat2.bind(R),this.setFloat3=R.setFloat3.bind(R),this.setFloat4=R.setFloat4.bind(R),this.setFloatArray=R.setFloatArray.bind(R),this.setArray=R.setArray.bind(R),this.setIntArray=R.setIntArray.bind(R),this.setMatrix=R.setMatrix.bind(R),this.setMatrices=R.setMatrices.bind(R),this.setVector3=R.setVector3.bind(R),this.setVector4=R.setVector4.bind(R),this.setColor3=R.setColor3.bind(R),this.setColor4=R.setColor4.bind(R),this.setDirectColor4=R.setDirectColor4.bind(R),this.setInt=R.setInt.bind(R),this.setInt2=R.setInt2.bind(R),this.setInt3=R.setInt3.bind(R),this.setInt4=R.setInt4.bind(R))}}var X=H(565);const M="gpuUpdateParticlesPixelShader",B="#version 300 es\nvoid main() {discard;}\n";X.e.ShadersStore[M]||(X.e.ShadersStore[M]=B);const o="gpuUpdateParticlesVertexShader",Z="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";X.e.ShadersStore[o]||(X.e.ShadersStore[o]=Z);(0,D.h)("BABYLON.WebGL2ParticleSystem",class{constructor(R,x){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=R,this._engine=x,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var R;return(null===(R=this._updateEffect)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof F&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=R,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new a(this._updateEffect)}createVertexBuffers(R,x){this._updateVAO.push(this._createUpdateVAO(R)),this._renderVAO.push(this._engine.recordVertexArrayObject(x,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=x}createParticleBuffer(R){return R}bindDrawBuffers(R,x,H){H?this._engine.bindBuffers(this._renderVertexBuffers,H,x):this._engine.bindVertexArrayObject(this._renderVAO[R],null)}preUpdateParticleBuffer(){const R=this._engine;if(this._engine.enableEffect(this._updateEffect),!R.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(R,x,H){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[R],null);const k=this._engine;k.bindTransformFeedbackBuffer(x.getBuffer()),k.setRasterizerState(!1),k.beginTransformFeedback(!0),k.drawArraysType(3,0,H),k.endTransformFeedback(),k.setRasterizerState(!0),k.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let R=0;R<this._updateVAO.length;R++)this._engine.releaseVertexArrayObject(this._updateVAO[R]);this._updateVAO.length=0;for(let R=0;R<this._renderVAO.length;R++)this._engine.releaseVertexArrayObject(this._renderVAO[R]);this._renderVAO.length=0}_createUpdateVAO(R){const x={};x.position=R.createVertexBuffer("position",0,3);let H=3;x.age=R.createVertexBuffer("age",H,1),H+=1,x.size=R.createVertexBuffer("size",H,3),H+=3,x.life=R.createVertexBuffer("life",H,1),H+=1,x.seed=R.createVertexBuffer("seed",H,4),H+=4,x.direction=R.createVertexBuffer("direction",H,3),H+=3,this._parent.particleEmitterType instanceof F&&(x.initialPosition=R.createVertexBuffer("initialPosition",H,3),H+=3),this._parent._colorGradientsTexture||(x.color=R.createVertexBuffer("color",H,4),H+=4),this._parent._isBillboardBased||(x.initialDirection=R.createVertexBuffer("initialDirection",H,3),H+=3),this._parent.noiseTexture&&(x.noiseCoordinates1=R.createVertexBuffer("noiseCoordinates1",H,3),H+=3,x.noiseCoordinates2=R.createVertexBuffer("noiseCoordinates2",H,3),H+=3),this._parent._angularSpeedGradientsTexture?(x.angle=R.createVertexBuffer("angle",H,1),H+=1):(x.angle=R.createVertexBuffer("angle",H,2),H+=2),this._parent._isAnimationSheetEnabled&&(x.cellIndex=R.createVertexBuffer("cellIndex",H,1),H+=1,this._parent.spriteRandomStartCell&&(x.cellStartOffset=R.createVertexBuffer("cellStartOffset",H,1),H+=1));const k=this._engine.recordVertexArrayObject(x,null,this._updateEffect);return this._engine.bindArrayBuffer(null),k}});class y{constructor(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,k=arguments.length>3?arguments[3]:void 0;this._engine=R,this._label=k,this._engine._storageBuffers.push(this),this._create(x,H)}_create(R,x){this._bufferSize=R,this._creationFlags=x,this._buffer=this._engine.createStorageBuffer(R,x,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(R,x,H){this._buffer&&this._engine.updateStorageBuffer(this._buffer,R,x,H)}async read(R,x,H,k){return await this._engine.readFromStorageBuffer(this._buffer,R,x,H,k)}dispose(){const R=this._engine._storageBuffers,x=R.indexOf(this);-1!==x&&(R[x]=R[R.length-1],R.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var s=H(643),E=H(647),w=H(687),h=H(2311),f=H(2486),N=H(493),W=H(596),K=H(2411);class Q{constructor(){this._gpuTimeInFrameId=-1,this.counter=new K.e}_addDuration(R,x){R<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==R?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(x,!1),this._gpuTimeInFrameId=R):this.counter.addCount(x,!1))}}var G=H(546);class T{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=R,this._engine=x,this.uniqueId=f.e.UniqueId,x.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Q),this._engine.getCaps().supportComputeShaders?k.bindingsMapping?(this._context=x.createComputeContext(),this._shaderPath=H,this._options={bindingsMapping:{},defines:[],...k}):N.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):N.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(R,x){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const k=this._bindings[R];this._bindings[R]={type:H?0:4,object:x,indexInGroupEntries:null===k||void 0===k?void 0:k.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!k||k.object!==x||k.type!==this._bindings[R].type)}setStorageTexture(R,x){const H=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==x),this._bindings[R]={type:1,object:x,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setExternalTexture(R,x){const H=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==x),this._bindings[R]={type:6,object:x,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setVideoTexture(R,x){return!!x.externalTexture&&(this.setExternalTexture(R,x.externalTexture),!0)}setUniformBuffer(R,x){const H=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==x),this._bindings[R]={type:T._BufferIsDataBuffer(x)?7:2,object:x,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setStorageBuffer(R,x){const H=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==x),this._bindings[R]={type:T._BufferIsDataBuffer(x)?7:3,object:x,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setTextureSampler(R,x){const H=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!H||!x.compareSampler(H.object)),this._bindings[R]={type:5,object:x,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}isReady(){let R=this._effect;for(const c in this._bindings){const R=this._bindings[c],x=R.type,H=R.object;switch(x){case 0:case 4:case 1:if(!H.isReady())return!1;break;case 6:if(!H.isReady())return!1;break}}const x=[],H=this._shaderPath;if(this._options.defines)for(let c=0;c<this._options.defines.length;c++)x.push(this._options.defines[c]);const k=x.join("\n");return this._cachedDefines!==k&&(this._cachedDefines=k,R=this._engine.createComputeEffect(H,{defines:k,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=R),!!R.isReady()}dispatch(R,x,H){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,R,x,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const H=T._BufferIsDataBuffer(R)?R:R.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,H,x,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const x in this._bindings){const H=this._bindings[x];if(!this._options.bindingsMapping[x])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+x+"'");switch(H.type){case 0:{const k=this._samplers[x],c=H.object;var R;if(!k||!c._texture||!k.compareSampler(c._texture))this._samplers[x]=(new W.d).setParameters(c.wrapU,c.wrapV,c.wrapR,c.anisotropicFilteringLevel,c._texture.samplingMode,null===(R=c._texture)||void 0===R?void 0:R._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const R=H.object;R.getBuffer()!==H.buffer&&(H.buffer=R.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((c=>{(0,G.e)((()=>this.dispatch(R,x,H)),c,void 0,k)}))}serialize(){const R=w.d.Serialize(this);R.options=this._options,R.shaderPath=this._shaderPath,R.Xl={},R.textures={};for(const x in this._bindings){const H=this._bindings[x],k=H.object;switch(H.type){case 0:case 4:case 1:{const c=k.serialize();c&&(R.textures[x]=c,R.Xl[x]={type:H.type});break}}}return R}static Parse(R,x,H){const k=w.d.Parse((()=>new T(R.name,x.getEngine(),R.shaderPath,R.options)),R,x,H);for(const c in R.textures){const t=R.Xl[c],A=h.d.Parse(R.textures[c],x,H);0===t.type?k.setTexture(c,A):4===t.type?k.setTexture(c,A,!1):k.setStorageTexture(c,A)}return k}static _BufferIsDataBuffer(R){return void 0!==R.underlyingResource}}(0,s.d)([(0,E.Q)()],T.prototype,"name",void 0),(0,s.d)([(0,E.Q)()],T.prototype,"fastMode",void 0),(0,D.h)("BABYLON.ComputeShader",T);var v=H(825);const p="gpuUpdateParticlesComputeShader",r="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";X.e.ShadersStoreWGSL[p]||(X.e.ShadersStoreWGSL[p]=r);(0,D.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(R,x){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=R,this._engine=x}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var R;return(null===(R=this._updateComputeShader)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){var x;const H={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(H.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(H.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(H.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(H.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(H.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(H.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(H.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new T("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:H,defines:R.split("\n")}),null===(x=this._simParamsComputeShader)||void 0===x||x.dispose(),this._simParamsComputeShader=new v.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new a(this._simParamsComputeShader)}createVertexBuffers(R,x){this._renderVertexBuffers.push(x)}createParticleBuffer(R){const x=new y(this._engine,4*R.length,11,"ComputeShaderParticleSystemBuffer");return x.update(R),this._bufferComputeShader.push(x),x.getBuffer()}bindDrawBuffers(R,x,H){this._engine.bindBuffers(this._renderVertexBuffers[R],H,x)}preUpdateParticleBuffer(){}updateParticleBuffer(R,x,H){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[R]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^R]),this._updateComputeShader.dispatch(Math.ceil(H/64))}releaseBuffers(){var R;for(let x=0;x<this._bufferComputeShader.length;++x)this._bufferComputeShader[x].dispose();this._bufferComputeShader.length=0,null===(R=this._simParamsComputeShader)||void 0===R||R.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(R,x,H){this.gradient=R,this.color1=x,this.color2=H}getColorToRef(R){this.color2?A.d.LerpToRef(this.color1,this.color2,Math.random(),R):R.p(this.color1)}}class j{constructor(R,x){this.gradient=R,this.color=x}}class m{constructor(R,x,H){this.gradient=R,this.factor1=x,this.factor2=H}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class O{static GetCurrentGradient(R,x,H){if(x[0].gradient>R)return void H(x[0],x[0],1);for(let c=0;c<x.length-1;c++){const k=x[c],t=x[c+1];if(R>=k.gradient&&R<=t.gradient){return void H(k,t,(R-k.gradient)/(t.gradient-k.gradient))}}const k=x.length-1;H(x[k],x[k],1)}}var l=H(476),e=H(12246),u=H(513);class Y{constructor(R){this.particleSystem=R,this.position=k.o.Zero(),this.direction=k.o.Zero(),this.color=new A.d(0,0,0,0),this.colorStep=new A.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new k.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new A.d(0,0,0,0),this._currentColor2=new A.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=Y._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let R=this.age,x=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===x?(x=1,R=this._randomCellOffset):R+=this._randomCellOffset);const H=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let k;k=this._initialSpriteCellLoop?(0,J.Clamp)(R*x%this.lifeTime/this.lifeTime):(0,J.Clamp)(R*x/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+k*H|0}_inheritParticleInfoToSubEmitter(R){if(R.particleSystem.j.position){const x=R.particleSystem.j;if(x.position.p(this.position),R.inheritDirection){const R=k.g.Bi[0];this.direction.normalizeToRef(R),x.setDirection(R,0,Math.PI/2)}}else{R.particleSystem.j.p(this.position)}this.direction.scaleToRef(R.inheritedVelocityAmount/2,k.g.Bi[0]),R.particleSystem._inheritedVelocityOffset.p(k.g.Bi[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const R of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(R)}_reset(){this.age=0,this.id=Y._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(R){R.position.p(this.position),this._initialDirection?R._initialDirection?R._initialDirection.p(this._initialDirection):R._initialDirection=this._initialDirection.clone():R._initialDirection=null,R.direction.p(this.direction),this.Mg&&(R.Mg?R.Mg.p(this.Mg):R.Mg=this.Mg.clone()),R.color.p(this.color),R.colorStep.p(this.colorStep),R.lifeTime=this.lifeTime,R.age=this.age,R._randomCellOffset=this._randomCellOffset,R.size=this.size,R.scale.p(this.scale),R.angle=this.angle,R.angularSpeed=this.angularSpeed,R.particleSystem=this.particleSystem,R.cellIndex=this.cellIndex,R.id=this.id,R._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(R._currentColorGradient=this._currentColorGradient,R._currentColor1.p(this._currentColor1),R._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(R._currentSizeGradient=this._currentSizeGradient,R._currentSize1=this._currentSize1,R._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(R._currentAngularSpeedGradient=this._currentAngularSpeedGradient,R._currentAngularSpeed1=this._currentAngularSpeed1,R._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(R._currentVelocityGradient=this._currentVelocityGradient,R._currentVelocity1=this._currentVelocity1,R._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(R._currentLimitVelocityGradient=this._currentLimitVelocityGradient,R._currentLimitVelocity1=this._currentLimitVelocity1,R._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(R._currentDragGradient=this._currentDragGradient,R._currentDrag1=this._currentDrag1,R._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(R._initialStartSpriteCellId=this._initialStartSpriteCellId,R._initialEndSpriteCellId=this._initialEndSpriteCellId,R._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(R.remapData&&this.remapData?R.remapData.p(this.remapData):R.remapData=new k.p(0,0,0,0)),this._randomNoiseCoordinates1&&(R._randomNoiseCoordinates1?(R._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),R._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(R._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),R._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}Y._Count=0;var RR=H(793),xR=(H(2382),H(849)),HR=H(841),kR=H(2456);function cR(R,x){const H=(0,J.RandomRange)(0,1);A.d.LerpToRef(x.color1,x.color2,H,R.color),x.colorDead.subtractToRef(R.color,x._colorDiff),x._colorDiff.scaleToRef(1/R.lifeTime,R.colorStep)}function tR(R,x){R._currentColorGradient=x._colorGradients[0],R._currentColorGradient.getColorToRef(R.color),R._currentColor1.p(R.color),x._colorGradients.length>1?x._colorGradients[1].getColorToRef(R._currentColor2):R._currentColor2.p(R.color)}function AR(R,x){const H=x._colorGradients;O.GetCurrentGradient(x._ratio,H,((x,H,k)=>{x!==R._currentColorGradient&&(R._currentColor1.p(R._currentColor2),H.getColorToRef(R._currentColor2),R._currentColorGradient=x),A.d.LerpToRef(R._currentColor1,R._currentColor2,k,R.color)}))}function DR(R,x){R.colorStep.scaleToRef(x._scaledUpdateSpeed,x._scaledColorStep),R.color.addInPlace(x._scaledColorStep),R.color.a<0&&(R.color.a=0)}function UR(R,x){O.GetCurrentGradient(x._ratio,x._angularSpeedGradients,((x,H,k)=>{x!==R._currentAngularSpeedGradient&&(R._currentAngularSpeed1=R._currentAngularSpeed2,R._currentAngularSpeed2=H.getFactor(),R._currentAngularSpeedGradient=x),R.angularSpeed=(0,J.Lerp)(R._currentAngularSpeed1,R._currentAngularSpeed2,k)}))}function JR(R,x){R.angle+=R.angularSpeed*x._scaledUpdateSpeed}function VR(R,x){x.particleEmitterType.startDirectionFunction(x._emitterWorldMatrix,R.direction,R,x.isLocal,x._emitterInverseWorldMatrix)}function nR(R,x){x.startDirectionFunction(x._emitterWorldMatrix,R.direction,R,x.isLocal)}function gR(R,x){R._currentVelocityGradient=x._velocityGradients[0],R._currentVelocity1=R._currentVelocityGradient.getFactor(),x._velocityGradients.length>1?R._currentVelocity2=x._velocityGradients[1].getFactor():R._currentVelocity2=R._currentVelocity1}function IR(R,x){R._currentLimitVelocityGradient=x._limitVelocityGradients[0],R._currentLimitVelocity1=R._currentLimitVelocityGradient.getFactor(),x._limitVelocityGradients.length>1?R._currentLimitVelocity2=x._limitVelocityGradients[1].getFactor():R._currentLimitVelocity2=R._currentLimitVelocity1}function iR(R,x){O.GetCurrentGradient(x._ratio,x._velocityGradients,((H,k,c)=>{H!==R._currentVelocityGradient&&(R._currentVelocity1=R._currentVelocity2,R._currentVelocity2=k.getFactor(),R._currentVelocityGradient=H),x._directionScale*=(0,J.Lerp)(R._currentVelocity1,R._currentVelocity2,c)}))}function qR(R,x){O.GetCurrentGradient(x._ratio,x._limitVelocityGradients,((H,k,c)=>{H!==R._currentLimitVelocityGradient&&(R._currentLimitVelocity1=R._currentLimitVelocity2,R._currentLimitVelocity2=k.getFactor(),R._currentLimitVelocityGradient=H);const t=(0,J.Lerp)(R._currentLimitVelocity1,R._currentLimitVelocity2,c);R.direction.length()>t&&R.direction.scaleInPlace(x.limitVelocityDamping)}))}function SR(R,x){R.direction.scaleToRef(x._directionScale,x._scaledDirection)}function LR(R,x){x.particleEmitterType.startPositionFunction(x._emitterWorldMatrix,R.position,R,x.isLocal)}function bR(R,x){x.startPositionFunction(x._emitterWorldMatrix,R.position,R,x.isLocal)}function CR(R,x){R.Mg?R.Mg.p(R.position):R.Mg=R.position.clone(),k.o.TransformCoordinatesToRef(R.Mg,x._emitterWorldMatrix,R.position)}function FR(R,x){x.isLocal&&R.Mg?(R.Mg.addInPlace(x._scaledDirection),k.o.TransformCoordinatesToRef(R.Mg,x._emitterWorldMatrix,R.position)):R.position.addInPlace(x._scaledDirection)}function dR(R,x){R._currentDragGradient=x._dragGradients[0],R._currentDrag1=R._currentDragGradient.getFactor(),x._dragGradients.length>1?R._currentDrag2=x._dragGradients[1].getFactor():R._currentDrag2=R._currentDrag1}function PR(R,x){O.GetCurrentGradient(x._ratio,x._dragGradients,((H,k,c)=>{H!==R._currentDragGradient&&(R._currentDrag1=R._currentDrag2,R._currentDrag2=k.getFactor(),R._currentDragGradient=H);const t=(0,J.Lerp)(R._currentDrag1,R._currentDrag2,c);x._scaledDirection.scaleInPlace(1-t)}))}function aR(R,x){R._randomNoiseCoordinates1?(R._randomNoiseCoordinates1.si(Math.random(),Math.random(),Math.random()),R._randomNoiseCoordinates2.si(Math.random(),Math.random(),Math.random())):(R._randomNoiseCoordinates1=new k.o(Math.random(),Math.random(),Math.random()),R._randomNoiseCoordinates2=new k.o(Math.random(),Math.random(),Math.random()))}function XR(R,x){const H=x._noiseTextureData,c=x._noiseTextureSize;if(H&&c&&R._randomNoiseCoordinates1){const t=x._fetchR(R._randomNoiseCoordinates1.x,R._randomNoiseCoordinates1.y,c.width,c.height,H),A=x._fetchR(R._randomNoiseCoordinates1.z,R._randomNoiseCoordinates2.x,c.width,c.height,H),D=x._fetchR(R._randomNoiseCoordinates2.y,R._randomNoiseCoordinates2.z,c.width,c.height,H),U=k.g.Bi[0],J=k.g.Bi[1];U.si((2*t-1)*x.noiseStrength.x,(2*A-1)*x.noiseStrength.y,(2*D-1)*x.noiseStrength.z),U.scaleToRef(x._tempScaledUpdateSpeed,J),R.direction.addInPlace(J)}}function MR(R,x){x.gravity.scaleToRef(x._tempScaledUpdateSpeed,x._scaledGravity),R.direction.addInPlace(x._scaledGravity)}function BR(R,x){R.size=(0,J.RandomRange)(x.minSize,x.maxSize),R.scale.si((0,J.RandomRange)(x.minScaleX,x.maxScaleX),(0,J.RandomRange)(x.minScaleY,x.maxScaleY))}function oR(R,x){R._currentSizeGradient=x._sizeGradients[0],R._currentSize1=R._currentSizeGradient.getFactor(),R.size=R._currentSize1,x._sizeGradients.length>1?R._currentSize2=x._sizeGradients[1].getFactor():R._currentSize2=R._currentSize1,R.scale.si((0,J.RandomRange)(x.minScaleX,x.maxScaleX),(0,J.RandomRange)(x.minScaleY,x.maxScaleY))}function ZR(R,x){const H=x._actualFrame/x.targetStopDuration;O.GetCurrentGradient(H,x._startSizeGradients,((H,k,c)=>{H!==x._currentStartSizeGradient&&(x._currentStartSize1=x._currentStartSize2,x._currentStartSize2=k.getFactor(),x._currentStartSizeGradient=H);const t=(0,J.Lerp)(x._currentStartSize1,x._currentStartSize2,c);R.scale.scaleInPlace(t)}))}function yR(R,x){O.GetCurrentGradient(x._ratio,x._sizeGradients,((x,H,k)=>{x!==R._currentSizeGradient&&(R._currentSize1=R._currentSize2,R._currentSize2=H.getFactor(),R._currentSizeGradient=x),R.size=(0,J.Lerp)(R._currentSize1,R._currentSize2,k)}))}function sR(R,x){R.remapData=new k.p(0,1,0,1)}function ER(R,x){x._colorRemapGradients&&x._colorRemapGradients.length>0&&O.GetCurrentGradient(x._ratio,x._colorRemapGradients,((x,H,k)=>{const c=(0,J.Lerp)(x.factor1,H.factor1,k),t=(0,J.Lerp)(x.factor2,H.factor2,k);R.remapData.x=c,R.remapData.y=t-c})),x._alphaRemapGradients&&x._alphaRemapGradients.length>0&&O.GetCurrentGradient(x._ratio,x._alphaRemapGradients,((x,H,k)=>{const c=(0,J.Lerp)(x.factor1,H.factor1,k),t=(0,J.Lerp)(x.factor2,H.factor2,k);R.remapData.z=c,R.remapData.w=t-c}))}function wR(R,x){const H=(0,J.Clamp)(x._actualFrame/x.targetStopDuration);O.GetCurrentGradient(H,x._lifeTimeGradients,((x,k)=>{const c=x,t=k,A=c.getFactor(),D=t.getFactor(),U=(H-c.gradient)/(t.gradient-c.gradient);R.lifeTime=(0,J.Lerp)(A,D,U)})),x._emitPower=(0,J.RandomRange)(x.minEmitPower,x.maxEmitPower)}function hR(R,x){R.lifeTime=(0,J.RandomRange)(x.minLifeTime,x.maxLifeTime),x._emitPower=(0,J.RandomRange)(x.minEmitPower,x.maxEmitPower)}function fR(R,x){0===x._emitPower?(R._initialDirection?R._initialDirection.p(R.direction):R._initialDirection=R.direction.clone(),R.direction.set(0,0,0)):(R._initialDirection=null,R.direction.scaleInPlace(x._emitPower)),R.direction.addInPlace(x._inheritedVelocityOffset)}function NR(R,x){R.angularSpeed=(0,J.RandomRange)(x.minAngularSpeed,x.maxAngularSpeed),R.angle=(0,J.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function WR(R,x){R._currentAngularSpeedGradient=x._angularSpeedGradients[0],R.angularSpeed=R._currentAngularSpeedGradient.getFactor(),R._currentAngularSpeed1=R.angularSpeed,x._angularSpeedGradients.length>1?R._currentAngularSpeed2=x._angularSpeedGradients[1].getFactor():R._currentAngularSpeed2=R._currentAngularSpeed1,R.angle=(0,J.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function KR(R,x){R._initialStartSpriteCellId=x.startSpriteCellID,R._initialEndSpriteCellId=x.endSpriteCellID,R._initialSpriteCellLoop=x.spriteCellLoop}function QR(R,x){R.previousItem=x.previousItem,R.nextItem=x,x.previousItem&&(x.previousItem.nextItem=R),x.previousItem=R}function GR(R,x){R.previousItem=x,R.nextItem=x.nextItem,x.nextItem&&(x.nextItem.previousItem=R),x.nextItem=R}function TR(R,x){let H=x;for(;H.nextItem;)H=H.nextItem;R.previousItem=H,R.nextItem=H.nextItem,H.nextItem=R}function vR(R){R.previousItem&&(R.previousItem.nextItem=R.nextItem),R.nextItem&&(R.nextItem.previousItem=R.previousItem)}class pR extends U{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(R){this._startDirectionFunction!==R&&(this._startDirectionFunction=R,this._directionProcessing.process=R?nR:VR)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(R){this._startPositionFunction!==R&&(this._startPositionFunction=R,this._positionCreation.process=R?bR:LR)}set onDispose(R){this._onDisposeObserver&&this.Vi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Vi.add(R)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(R){this._useRampGradients!==R&&(this._useRampGradients=R,this._resetEffect(),R?(this._rampCreation={process:sR,previousItem:null,nextItem:null},GR(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:ER,previousItem:null,nextItem:null},GR(this._remapGradientProcessing,this._gravityProcessing)):(vR(this._rampCreation),vR(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(R){this._isLocal!==R&&(this._isLocal=R,R?(this._isLocalCreation={process:CR,previousItem:null,nextItem:null},GR(this._isLocalCreation,this._positionCreation)):vR(this._isLocalCreation))}get particles(){return this.Sl}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(R){this._animationSheetEnabled!==R&&(this._animationSheetEnabled=R,R?(this._sheetCreation={process:KR,previousItem:null,nextItem:null},GR(this._sheetCreation,this._colorCreation)):vR(this._sheetCreation),this._reset())}getActiveCount(){return this.Sl.length}getClassName(){return"qj"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var R;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[x])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new RR.d(this._engine),this._customWrappers[x].effect=R,this._customWrappers[x].drawContext&&(this._customWrappers[x].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(R){if(this.noiseTexture!==R){if(this._noiseTexture=R,!R)return vR(this._noiseCreation),void vR(this._noiseProcessing);this._noiseCreation={process:aR,previousItem:null,nextItem:null},GR(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:XR,previousItem:null,nextItem:null},GR(this._noiseProcessing,this._positionProcessing)}}constructor(R,x,H){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(R),this._emitterInverseWorldMatrix=k.e.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new k.o,this.Vi=new l.d,this.onStoppedObservable=new l.d,this.onStartedObservable=new l.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Sl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new A.d(0,0,0,0),this._colorDiff=new A.d(0,0,0,0),this._scaledDirection=k.o.Zero(),this._scaledGravity=k.o.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=R=>{},this.recycleParticle=R=>{const x=this.Sl.pop();x!==R&&x.copyTo(R),this._stockParticles.push(x)},this._createParticle=()=>{let R;return 0!==this._stockParticles.length?(R=this._stockParticles.pop(),R._reset()):R=new Y(this),this._prepareParticle(R),R},this.paused=!1,this._shadersLoaded=!1,this._capacity=x,this._epsilon=D,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=k.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||u.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ei.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:hR,previousItem:null,nextItem:null},this._positionCreation={process:LR,previousItem:null,nextItem:null},GR(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:VR,previousItem:null,nextItem:null},GR(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:fR,previousItem:null,nextItem:null},GR(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:BR,previousItem:null,nextItem:null},GR(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:NR,previousItem:null,nextItem:null},GR(this._angleCreation,this._sizeCreation),this._colorCreation={process:cR,previousItem:null,nextItem:null},GR(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,U||(this._colorProcessing={process:DR,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:JR,previousItem:null,nextItem:null},GR(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:SR,previousItem:null,nextItem:null},GR(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:FR,previousItem:null,nextItem:null},GR(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:MR,previousItem:null,nextItem:null},GR(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=t,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new RR.d(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new n,this.updateFunction=R=>{var x;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(x=this.noiseTexture.getContent())||void 0===x||x.then((R=>{this._noiseTextureData=R})));const H=R===this.Sl;for(let k=0;k<R.length;k++){const x=R[k];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const c=x.age;if(x.age+=this._tempScaledUpdateSpeed,x.age>x.lifeTime){const R=x.age-c,H=x.lifeTime-c;this._tempScaledUpdateSpeed=H*this._tempScaledUpdateSpeed/R,x.age=x.lifeTime}this._ratio=x.age/x.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let t=this._updateQueueStart;for(;t;)t.process(x,this),t=t.nextItem;if(this._isAnimationSheetEnabled&&!U&&x.updateCellIndex(),x._inheritParticleInfoToSubEmitters(),x.age>=x.lifeTime){if(this._emitFromParticle(x),x._attachedSubEmitters){for(const R of x._attachedSubEmitters)R.particleSystem.disposeOnStop=!0,R.particleSystem.stop();x._attachedSubEmitters=null}this.recycleParticle(x),H&&k--}else;}}}serialize(R){throw new Error("Method not implemented.")}clone(R,x){throw new Error("Method not implemented.")}_addFactorGradient(R,x,H,k){const c=new m(x,H,k);R.push(c),R.sort(((R,x)=>R.gradient<x.gradient?-1:R.gradient>x.gradient?1:0))}_removeFactorGradient(R,x){if(!R)return;let H=0;for(const k of R){if(k.gradient===x){R.splice(H,1);break}H++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=wR:this._lifeTimeCreation.process=hR}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:ZR,previousItem:null,nextItem:null},GR(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(vR(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(R){this.targetStopDuration!==R&&(this._targetStopDuration=R,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(R,x,H){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,R,x,H),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(R){return this._removeFactorGradient(this._lifeTimeGradients,R),this._syncLifeTimeCreation(),this}addSizeGradient(R,x,H){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=oR,this._sizeGradientProcessing={process:yR,previousItem:null,nextItem:null},QR(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,R,x,H),this}removeSizeGradient(R){var x;return this._removeFactorGradient(this._sizeGradients,R),0===(null===(x=this._sizeGradients)||void 0===x?void 0:x.length)&&(vR(this._sizeGradientProcessing),this._sizeCreation.process=BR),this}addColorRemapGradient(R,x,H){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,R,x,H),this}removeColorRemapGradient(R){return this._removeFactorGradient(this._colorRemapGradients,R),this}addAlphaRemapGradient(R,x,H){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,R,x,H),this}removeAlphaRemapGradient(R){return this._removeFactorGradient(this._alphaRemapGradients,R),this}addAngularSpeedGradient(R,x,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=WR,this._angularSpeedGradientProcessing={process:UR,previousItem:null,nextItem:null},QR(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,R,x,H),this}removeAngularSpeedGradient(R){var x;return this._removeFactorGradient(this._angularSpeedGradients,R),0===(null===(x=this._angularSpeedGradients)||void 0===x?void 0:x.length)&&(this._angleCreation.process=NR,vR(this._angularSpeedGradientProcessing)),this}addVelocityGradient(R,x,H){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:gR,previousItem:null,nextItem:null},GR(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:iR,previousItem:null,nextItem:null},QR(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,R,x,H),this}removeVelocityGradient(R){var x;return this._removeFactorGradient(this._velocityGradients,R),0===(null===(x=this._velocityGradients)||void 0===x?void 0:x.length)&&(vR(this._velocityCreation),vR(this._velocityGradientProcessing)),this}addLimitVelocityGradient(R,x,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:IR,previousItem:null,nextItem:null},GR(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:qR,previousItem:null,nextItem:null},GR(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,R,x,H),this}removeLimitVelocityGradient(R){var x;return this._removeFactorGradient(this._limitVelocityGradients,R),0===(null===(x=this._limitVelocityGradients)||void 0===x?void 0:x.length)&&(vR(this._limitVelocityCreation),vR(this._limitVelocityGradientProcessing)),this}addDragGradient(R,x,H){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:dR,previousItem:null,nextItem:null},QR(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:PR,previousItem:null,nextItem:null},QR(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,R,x,H),this}removeDragGradient(R){var x;return this._removeFactorGradient(this._dragGradients,R),0===(null===(x=this._dragGradients)||void 0===x?void 0:x.length)&&(vR(this._dragCreation),vR(this._dragGradientProcessing)),this}addEmitRateGradient(R,x,H){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,R,x,H),this}removeEmitRateGradient(R){return this._removeFactorGradient(this._emitRateGradients,R),this}addStartSizeGradient(R,x,H){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,R,x,H),this._syncStartSizeCreation(),this}removeStartSizeGradient(R){return this._removeFactorGradient(this._startSizeGradients,R),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const R=new Uint8Array(4*this._rawTextureWidth),x=A.h.fj[0];for(let H=0;H<this._rawTextureWidth;H++){const k=H/this._rawTextureWidth;O.GetCurrentGradient(k,this._rampGradients,((k,c,t)=>{A.c.LerpToRef(k.color,c.color,t,x),R[4*H]=255*x.r,R[4*H+1]=255*x.g,R[4*H+2]=255*x.b,R[4*H+3]=255}))}this._rampGradientsTexture=e.b.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((R,x)=>R.gradient<x.gradient?-1:R.gradient>x.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(R,x){this._rampGradients||(this._rampGradients=[]);const H=new j(R,x);return this._rampGradients.push(H),this._syncRampGradientTexture(),this}removeRampGradient(R){return this._removeGradientAndTexture(R,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(R,x,H){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=tR,this._colorProcessing.process=AR);const k=new z(R,x,H);return this._colorGradients.push(k),this._colorGradients.sort(((R,x)=>R.gradient<x.gradient?-1:R.gradient>x.gradient?1:0)),this}removeColorGradient(R){if(!this._colorGradients)return this;let x=0;for(const H of this._colorGradients){if(H.gradient===R){this._colorGradients.splice(x,1);break}x++}return 0===this._colorGradients.length&&(this._colorCreation.process=cR,this._colorProcessing.process=DR),this}resetDrawCache(){if(this._drawWrappers){for(const R of this._drawWrappers)if(R)for(const x of R)null===x||void 0===x||x.dispose();this._drawWrappers=[]}}_fetchR(R,x,H,k,c){return c[4*(((R=.5*Math.abs(R)+.5)*H%H|0)+((x=.5*Math.abs(x)+.5)*k%k|0)*H)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const R=this._engine,x=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*x),this._vertexBuffer=new d.d(R,this._vertexData,!0,x);let H=0;const k=this._vertexBuffer.createVertexBuffer(d.g.PositionKind,H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[d.g.PositionKind]=k,H+=3;const c=this._vertexBuffer.createVertexBuffer(d.g.ColorKind,H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[d.g.ColorKind]=c,H+=4;const t=this._vertexBuffer.createVertexBuffer("angle",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=t,H+=1;const A=this._vertexBuffer.createVertexBuffer("size",H,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=A,H+=2,this._isAnimationSheetEnabled){const R=this._vertexBuffer.createVertexBuffer("cellIndex",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=R,H+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const R=this._vertexBuffer.createVertexBuffer("direction",H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=R,H+=3}if(this._useRampGradients){const R=this._vertexBuffer.createVertexBuffer("remapData",H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=R,H+=4}let D;if(this._useInstancing){const x=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new d.d(R,x,!1,2),D=this._spriteBuffer.createVertexBuffer("offset",0,2)}else D=this._vertexBuffer.createVertexBuffer("offset",H,2,this._vertexBufferSize,this._useInstancing),H+=2;this._vertexBuffers.offset=D,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const R=[],x=[];let H=0;for(let k=0;k<this._capacity;k++)R.push(H),R.push(H+1),R.push(H+2),R.push(H),R.push(H+2),R.push(H+3),x.push(H,H+1,H+1,H+2,H+2,H+3,H+3,H,H,H+3),H+=4;this._indexBuffer=this._engine.createIndexBuffer(R),this._linesIndexBuffer=this._engine.createIndexBuffer(x)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(R)setTimeout((()=>{this.start(0)}),R);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var x;-1!==(null===(x=this.j)||void 0===x?void 0:x.getClassName().indexOf("Mesh"))&&this.j.Fi(!0);const R=this.noiseTexture;if(R&&R.onGeneratedObservable)R.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let x=0;x<this.preWarmCycles;x++)this.animate(!0),R.render()}))}));else for(let x=0;x<this.preWarmCycles;x++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(R))}_postStop(R){}reset(){this._stockParticles.length=0,this.Sl.length=0}_appendParticleVertex(R,x,H,c){let t=R*this._vertexBufferSize;if(this._vertexData[t++]=x.position.x+this.me.x,this._vertexData[t++]=x.position.y+this.me.y,this._vertexData[t++]=x.position.z+this.me.z,this._vertexData[t++]=x.color.r,this._vertexData[t++]=x.color.g,this._vertexData[t++]=x.color.b,this._vertexData[t++]=x.color.a,this._vertexData[t++]=x.angle,this._vertexData[t++]=x.scale.x*x.size,this._vertexData[t++]=x.scale.y*x.size,this._isAnimationSheetEnabled&&(this._vertexData[t++]=x.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[t++]=x.direction.x,this._vertexData[t++]=x.direction.y,this._vertexData[t++]=x.direction.z);else if(x._initialDirection){let R=x._initialDirection;this.isLocal&&(k.o.TransformNormalToRef(R,this._emitterWorldMatrix,k.g.Bi[0]),R=k.g.Bi[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[t++]=R.x,this._vertexData[t++]=R.y,this._vertexData[t++]=R.z}else{let R=x.direction;this.isLocal&&(k.o.TransformNormalToRef(R,this._emitterWorldMatrix,k.g.Bi[0]),R=k.g.Bi[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[t++]=R.x,this._vertexData[t++]=R.y,this._vertexData[t++]=R.z}this._useRampGradients&&x.remapData&&(this._vertexData[t++]=x.remapData.x,this._vertexData[t++]=x.remapData.y,this._vertexData[t++]=x.remapData.z,this._vertexData[t++]=x.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===H?H=this._epsilon:1===H&&(H=1-this._epsilon),0===c?c=this._epsilon:1===c&&(c=1-this._epsilon)),this._vertexData[t++]=H,this._vertexData[t++]=c)}_prepareParticle(R){}_createNewOnes(R){let x;for(let H=0;H<R&&this.Sl.length!==this._capacity;H++){x=this._createParticle(),this.Sl.push(x);let R=this._createQueueStart;for(;R;)R.process(x,this),R=R.nextItem;x._inheritParticleInfoToSubEmitters()}}_update(R){if(this._alive=this.Sl.length>0,this.j.position){const R=this.j;this._emitterWorldMatrix=R.getWorldMatrix()}else{const R=this.j;this._emitterWorldMatrix=k.e.Translation(R.x,R.y,R.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Sl),this._createNewOnes(R)}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=[d.g.PositionKind,d.g.ColorKind,"angle","offset","size"];return R&&k.push("cellIndex"),x||k.push("direction"),H&&k.push("remapData"),k}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,xR.e)(k),R&&k.push("particlesInfos"),x&&k.push("logarithmicDepthConstant"),H&&(k.push("vFogInfos"),k.push("vFogColor")),k}fillDefines(R,x){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xR.k)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&R.push("#define FOG")),this._isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),x===U.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&R.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case 2:R.push("#define BILLBOARDY");break;case 8:case 9:R.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&R.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:R.push("#define BILLBOARDMODE_ALL")}H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,x,H){x.push(...pR._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),R.push(...pR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,kR.e)(R,this._imageProcessingConfigurationDefines),(0,kR.d)(H,this._imageProcessingConfigurationDefines))}_getWrapper(R){const x=this._getCustomDrawWrapper(R);if(null!==x&&void 0!==x&&x.effect)return x;const H=[];this.fillDefines(H,R);const k=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let c=this._drawWrappers[k];c||(c=this._drawWrappers[k]=[]);let t=c[R];t||(t=new RR.d(this._engine),t.drawContext&&(t.drawContext.useInstancing=this._useInstancing),c[R]=t);const A=H.join("\n");if(t.defines!==A){const R=[],x=[],H=[];this.fillUniformsAttributesAndSamplerNames(x,R,H),t.setEffect(this._engine.createEffect("particles",R,x,H,A,void 0,void 0,void 0,void 0,this._shaderLanguage),A)}return t}animate(){var R;let x,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!H&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(H?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this.manualEmitCount>-1)x=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let R=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const x=this._actualFrame/this.targetStopDuration;O.GetCurrentGradient(x,this._emitRateGradients,((x,H,k)=>{x!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=H.getFactor(),this._currentEmitRateGradient=x),R=(0,J.Lerp)(this._currentEmitRate1,this._currentEmitRate2,k)}))}x=R*this._scaledUpdateSpeed|0,this._newPartsExcess+=R*this._scaledUpdateSpeed-x}if(this._newPartsExcess>1&&(x+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?x=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(x),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!H){let R=0;for(let x=0;x<this.Sl.length;x++){const H=this.Sl[x];this._appendParticleVertices(R,H),R+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Sl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(R,x){this._appendParticleVertex(R++,x,0,0),this._useInstancing||(this._appendParticleVertex(R++,x,1,0),this._appendParticleVertex(R++,x,1,1),this._appendParticleVertex(R++,x,0,1))}rebuild(){var R;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(R=this._spriteBuffer)||void 0===R||R._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!pR.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(H.bind(H,13040)),Promise.resolve().then(H.bind(H,12977))])):await Promise.all([Promise.resolve().then(H.bind(H,12962)),Promise.resolve().then(H.bind(H,12953))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(U.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(U.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(R){const x=this._getWrapper(R),H=x.effect,c=this._engine;c.enableEffect(x);const t=this.defaultViewMatrix??this._scene.getViewMatrix();if(H.setTexture("diffuseSampler",this.particleTexture),H.setMatrix("view",t),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();H.setFloat3("particlesInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,this.spriteCellWidth/R.width)}if(H.setVector2("translationPivot",this.translationPivot),H.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;H.setVector3("eyePosition",R.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),H.setTexture("rampSampler",this._rampGradientsTexture));const A=H.defines;var D,U,J,V,n,g;(this._scene&&((0,xR.i)(H,this,this._scene),this.applyFog&&(0,HR.g)(this._scene,void 0,H)),A.indexOf("#define BILLBOARDMODE_ALL")>=0&&(t.invertToRef(k.g.Matrix[0]),H.setMatrix("invView",k.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?c.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,H):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,H)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?c.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBuffer:this._indexBuffer,H):c.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null,H);(this.useLogarithmicDepth&&this._scene&&(0,HR.n)(A,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(R),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),this._useInstancing)?null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?c.drawElementsType(6,0,10,this.Sl.length):c.drawArraysType(7,0,4,this.Sl.length):null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?c.drawElementsType(1,0,10*this.Sl.length):c.drawElementsType(0,0,6*this.Sl.length);return this.Sl.length}render(){if(!this.isReady()||!this.Sl.length)return 0;const R=this._engine;R.setState&&(R.setState(!1),this.forceDepthWrite&&R.setDepthWrite(!0));let x=0;return x=this.blendMode===U.BLENDMODE_MULTIPLYADD?this._render(U.BLENDMODE_MULTIPLY)+this._render(U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),x}_onDispose(){}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(x,H),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const R=this._scene.Ei.indexOf(this);R>-1&&this._scene.Ei.splice(R,1),this._scene._activeParticleSystems.dispose()}this.Vi.notifyObservers(this),this.Vi.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}pR.ForceGLSL=!1;var rR,zR=H(502);!function(R){R[R.ATTACHED=0]="ATTACHED",R[R.END=1]="END"}(rR||(rR={}));class jR{constructor(R){if(this.particleSystem=R,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!R.j||!R.j.dispose){const x=(0,D.e)("BABYLON.AbstractMesh");R.j=new x("SubemitterSystemEmitter",R.va()),R._disposeEmitterOnDispose=!0}}clone(){let R=this.particleSystem.j;if(R){if(R instanceof k.o)R=R.clone();else if(-1!==R.getClassName().indexOf("Mesh")){R=new((0,D.e)("BABYLON.Mesh"))("",R.va()),R.isVisible=!1}}else R=new k.o;const x=new jR(this.particleSystem.clone(this.particleSystem.name,R));return x.particleSystem.name+="Clone",x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem._disposeEmitterOnDispose=!0,x.particleSystem.disposeOnStop=!0,x}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem=this.particleSystem.serialize(R),x}static _ParseParticleSystem(R,x,H){throw(0,zR.d)("ParseParticle")}static Parse(R,x,H){const k=R.particleSystem,c=new jR(jR._ParseParticleSystem(k,x,H,!0));return c.type=R.type,c.inheritDirection=R.inheritDirection,c.inheritedVelocityAmount=R.inheritedVelocityAmount,c.particleSystem._isSubEmitter=!0,c}dispose(){this.particleSystem.dispose()}}var mR=H(555);function OR(R,x){const H=new L;return H.direction1=R,H.direction2=x,H}function lR(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function eR(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function uR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.o(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0);return new C(R,x,H)}function YR(){return new i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Rx(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.o(0,1,0);return new q(R,x,H,c,t)}function xx(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new g(R,x)}function Hx(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0);return new I(R,x,H,c)}const kx=k.o.Zero(),cx=k.o.Zero(),tx=k.o.Zero();class Ax{constructor(){this.strength=0,this.position=k.o.Zero()}_processParticle(R,x){this.position.subtractToRef(R.position,kx);const H=kx.lengthSquared()+1;kx.normalize().scaleToRef(this.strength/H,cx),cx.scaleToRef(x._tempScaledUpdateSpeed,tx),R.direction.addInPlace(tx)}serialize(){return{position:this.position.Li(),strength:this.strength}}}class Dx extends pR{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=R=>{if(!this._subEmitters||0===this._subEmitters.length)return;const x=Math.floor(Math.random()*this._subEmitters.length);for(const H of this._subEmitters[x])if(1===H.type){const x=H.clone();R._inheritParticleInfoToSubEmitter(x),x.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(x.particleSystem),x.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(R,x){const H=OR(R,x);return this.particleEmitterType=H,H}get flowMap(){return this._flowMap}set flowMap(R){this._flowMap!==R&&(this._flowMap=R,this._flowMapUpdate&&(vR(this._flowMapUpdate),this._flowMapUpdate=null),R&&(this._flowMapUpdate={process:R=>{var x;const H=null===(x=this.va())||void 0===x?void 0:x.getTransformMatrix();this._flowMap._processParticle(R,this.flowMapStrength*this._tempScaledUpdateSpeed,H)},previousItem:null,nextItem:null},GR(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(R){this._attractors.push(R),1===this._attractors.length&&(this._attractorUpdate={process:R=>{for(const x of this._attractors)x._processParticle(R,this)},previousItem:null,nextItem:null},GR(this._attractorUpdate,this._directionProcessing))}removeAttractor(R){const x=this._attractors.indexOf(R);-1!==x&&this._attractors.splice(x,1),0===this._attractors.length&&vR(this._attractorUpdate)}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(R)}createHemisphericEmitter(){const R=lR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=eR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=uR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=YR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=Rx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.o(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=Hx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,x,H,k){const c=new n;return this.particleEmitterType=c,this.direction1=R,this.direction2=x,this.minEmitBox=H,this.maxEmitBox=k,c}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const R of this.subEmitters)R instanceof Dx?this._subEmitters.push([new jR(R)]):R instanceof jR?this._subEmitters.push([R]):R instanceof Array&&this._subEmitters.push(R)}_stopSubEmitters(){if(this.activeSubSystems){for(const R of this.activeSubSystems)R.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const R=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==R&&this._rootParticleSystem.activeSubSystems.splice(R,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(R){R&&this._stopSubEmitters()}_prepareParticle(R){if(this._subEmitters&&this._subEmitters.length>0){const x=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];R._attachedSubEmitters=[];for(const H of x)if(0===H.type){const x=H.clone();R._attachedSubEmitters.push(x),x.particleSystem.start()}}}_onDispose(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),R&&this.particles)for(const H of this.particles)if(H._attachedSubEmitters)for(let R=H._attachedSubEmitters.length-1;R>=0;R-=1)H._attachedSubEmitters[R].dispose();if(x&&this.activeSubSystems)for(let H=this.activeSubSystems.length-1;H>=0;H-=1)this.activeSubSystems[H].dispose();if(this._subEmitters&&this._subEmitters.length){for(let R=0;R<this._subEmitters.length;R++)for(const x of this._subEmitters[R])x.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(R,x,H,c){let t;t=H instanceof mR.d?null:H;const U=(0,D.e)("BABYLON.Texture");if(U&&t&&(R.texture?x.particleTexture=U.Parse(R.texture,t,c):R.textureName&&(x.particleTexture=new U(c+R.textureName,t,!1,void 0===R.invertY||R.invertY),x.particleTexture.name=R.textureName)),R.emitterId||0===R.emitterId||void 0!==R.j?R.emitterId&&t?x.j=t.getLastMeshById(R.emitterId):x.j=k.o.zi(R.j):x.j=k.o.Zero(),x.isLocal=!!R.isLocal,void 0!==R.renderingGroupId&&(x.renderingGroupId=R.renderingGroupId),void 0!==R.isBillboardBased&&(x.isBillboardBased=R.isBillboardBased),void 0!==R.billboardMode&&(x.billboardMode=R.billboardMode),void 0!==R.useLogarithmicDepth&&(x.useLogarithmicDepth=R.useLogarithmicDepth),R.animations){for(let H=0;H<R.animations.length;H++){const k=R.animations[H],c=(0,D.e)("BABYLON.Animation");c&&x.animations.push(c.Parse(k))}x.beginAnimationOnStart=R.beginAnimationOnStart,x.beginAnimationFrom=R.beginAnimationFrom,x.beginAnimationTo=R.beginAnimationTo,x.beginAnimationLoop=R.beginAnimationLoop}if(R.autoAnimate&&t&&t.beginAnimation(x,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),x.startDelay=0|R.startDelay,x.minAngularSpeed=R.minAngularSpeed,x.maxAngularSpeed=R.maxAngularSpeed,x.minSize=R.minSize,x.maxSize=R.maxSize,R.minScaleX&&(x.minScaleX=R.minScaleX,x.maxScaleX=R.maxScaleX,x.minScaleY=R.minScaleY,x.maxScaleY=R.maxScaleY),void 0!==R.preWarmCycles&&(x.preWarmCycles=R.preWarmCycles,x.preWarmStepOffset=R.preWarmStepOffset),void 0!==R.minInitialRotation&&(x.minInitialRotation=R.minInitialRotation,x.maxInitialRotation=R.maxInitialRotation),x.minLifeTime=R.minLifeTime,x.maxLifeTime=R.maxLifeTime,x.minEmitPower=R.minEmitPower,x.maxEmitPower=R.maxEmitPower,x.emitRate=R.emitRate,x.gravity=k.o.zi(R.gravity),R.noiseStrength&&(x.noiseStrength=k.o.zi(R.noiseStrength)),x.color1=A.d.zi(R.color1),x.color2=A.d.zi(R.color2),x.colorDead=A.d.zi(R.colorDead),x.updateSpeed=R.updateSpeed,x.targetStopDuration=R.targetStopDuration,x.blendMode=R.blendMode,R.colorGradients)for(const k of R.colorGradients)x.addColorGradient(k.gradient,A.d.zi(k.color1),k.color2?A.d.zi(k.color2):void 0);if(R.rampGradients){for(const H of R.rampGradients)x.addRampGradient(H.gradient,A.c.zi(H.color));x.useRampGradients=R.useRampGradients}if(R.colorRemapGradients)for(const k of R.colorRemapGradients)x.addColorRemapGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.alphaRemapGradients)for(const k of R.alphaRemapGradients)x.addAlphaRemapGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.sizeGradients)for(const k of R.sizeGradients)x.addSizeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.angularSpeedGradients)for(const k of R.angularSpeedGradients)x.addAngularSpeedGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.velocityGradients)for(const k of R.velocityGradients)x.addVelocityGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.dragGradients)for(const k of R.dragGradients)x.addDragGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.emitRateGradients)for(const k of R.emitRateGradients)x.addEmitRateGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.startSizeGradients)for(const k of R.startSizeGradients)x.addStartSizeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.lifeTimeGradients)for(const k of R.lifeTimeGradients)x.addLifeTimeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(R.limitVelocityGradients){for(const H of R.limitVelocityGradients)x.addLimitVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);x.limitVelocityDamping=R.limitVelocityDamping}if(R.noiseTexture&&t){const H=(0,D.e)("BABYLON.ProceduralTexture");x.noiseTexture=H.Parse(R.noiseTexture,t,c)}let J;if(R.particleEmitterType){switch(R.particleEmitterType.type){case"SphereParticleEmitter":J=new b;break;case"SphereDirectedParticleEmitter":J=new C;break;case"ConeEmitter":case"ConeParticleEmitter":J=new g;break;case"ConeDirectedParticleEmitter":J=new I;break;case"CylinderParticleEmitter":J=new i;break;case"CylinderDirectedParticleEmitter":J=new q;break;case"HemisphericParticleEmitter":J=new S;break;case"PointParticleEmitter":J=new L;break;case"MeshParticleEmitter":J=new P;break;case"CustomParticleEmitter":J=new F;break;default:J=new n}J.parse(R.particleEmitterType,t)}else J=new n,J.parse(R,t);x.particleEmitterType=J,x.startSpriteCellID=R.startSpriteCellID,x.endSpriteCellID=R.endSpriteCellID,x.spriteCellLoop=R.spriteCellLoop??!0,x.spriteCellWidth=R.spriteCellWidth,x.spriteCellHeight=R.spriteCellHeight,x.spriteCellChangeSpeed=R.spriteCellChangeSpeed,x.spriteRandomStartCell=R.spriteRandomStartCell,x.disposeOnStop=R.disposeOnStop??!1,x.manualEmitCount=R.manualEmitCount??-1}static Parse(R,x,H){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const D=R.name;let U,J,V=null,n=null;if(x instanceof mR.d?U=x:(J=x,U=J.getEngine()),R.customShader&&U.createEffectForParticles){n=R.customShader;const x=n.shaderOptions.defines.length>0?n.shaderOptions.defines.join("\n"):"";V=U.createEffectForParticles(n.shaderPath.fragmentElement,n.shaderOptions.uniforms,n.shaderOptions.samplers,x)}const g=new Dx(D,t||R.ii,x,V,R.isAnimationSheetEnabled);if(g.customShader=n,g._rootUrl=H,R.id&&(g.id=R.id),R.subEmitters){g.subEmitters=[];for(const k of R.subEmitters){const R=[];for(const c of k)R.push(jR.Parse(c,x,H));g.subEmitters.push(R)}}if(R.attractors)for(const A of R.attractors){const R=new Ax;R.position=k.o.zi(A.position),R.strength=A.strength,g.addAttractor(R)}return Dx._Parse(R,g,x,H),R.textureMask&&(g.textureMask=A.d.zi(R.textureMask)),R.me&&(g.me=k.o.zi(R.me)),R.preventAutoStart&&(g.preventAutoStart=R.preventAutoStart),c||g.preventAutoStart||g.start(),g}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};if(Dx._Serialize(x,this,R),x.textureMask=this.textureMask.Li(),x.customShader=this.customShader,x.preventAutoStart=this.preventAutoStart,x.me=this.me.Li(),this.subEmitters){x.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const H of this._subEmitters){const k=[];for(const x of H)k.push(x.serialize(R));x.subEmitters.push(k)}}if(this._attractors&&this._attractors.length){x.attractors=[];for(const R of this._attractors)x.attractors.push(R.serialize())}return x}static _Serialize(R,x,H){if(R.name=x.name,R.id=x.id,R.ii=x.getCapacity(),R.disposeOnStop=x.disposeOnStop,R.manualEmitCount=x.manualEmitCount,x.j.position){const H=x.j;R.emitterId=H.id}else{const H=x.j;R.j=H.Li()}x.particleEmitterType&&(R.particleEmitterType=x.particleEmitterType.serialize()),x.particleTexture&&(H?R.texture=x.particleTexture.serialize():(R.textureName=x.particleTexture.name,R.invertY=!!x.particleTexture._invertY)),R.isLocal=x.isLocal,w.d.AppendSerializedAnimations(x,R),R.beginAnimationOnStart=x.beginAnimationOnStart,R.beginAnimationFrom=x.beginAnimationFrom,R.beginAnimationTo=x.beginAnimationTo,R.beginAnimationLoop=x.beginAnimationLoop,R.startDelay=x.startDelay,R.renderingGroupId=x.renderingGroupId,R.isBillboardBased=x.isBillboardBased,R.billboardMode=x.billboardMode,R.minAngularSpeed=x.minAngularSpeed,R.maxAngularSpeed=x.maxAngularSpeed,R.minSize=x.minSize,R.maxSize=x.maxSize,R.minScaleX=x.minScaleX,R.maxScaleX=x.maxScaleX,R.minScaleY=x.minScaleY,R.maxScaleY=x.maxScaleY,R.minEmitPower=x.minEmitPower,R.maxEmitPower=x.maxEmitPower,R.minLifeTime=x.minLifeTime,R.maxLifeTime=x.maxLifeTime,R.emitRate=x.emitRate,R.gravity=x.gravity.Li(),R.noiseStrength=x.noiseStrength.Li(),R.color1=x.color1.Li(),R.color2=x.color2.Li(),R.colorDead=x.colorDead.Li(),R.updateSpeed=x.updateSpeed,R.targetStopDuration=x.targetStopDuration,R.blendMode=x.blendMode,R.preWarmCycles=x.preWarmCycles,R.preWarmStepOffset=x.preWarmStepOffset,R.minInitialRotation=x.minInitialRotation,R.maxInitialRotation=x.maxInitialRotation,R.startSpriteCellID=x.startSpriteCellID,R.spriteCellLoop=x.spriteCellLoop,R.endSpriteCellID=x.endSpriteCellID,R.spriteCellChangeSpeed=x.spriteCellChangeSpeed,R.spriteCellWidth=x.spriteCellWidth,R.spriteCellHeight=x.spriteCellHeight,R.spriteRandomStartCell=x.spriteRandomStartCell,R.isAnimationSheetEnabled=x.isAnimationSheetEnabled,R.useLogarithmicDepth=x.useLogarithmicDepth;const k=x.getColorGradients();if(k){R.colorGradients=[];for(const x of k){const H={gradient:x.gradient,color1:x.color1.Li()};x.color2?H.color2=x.color2.Li():H.color2=x.color1.Li(),R.colorGradients.push(H)}}const c=x.getRampGradients();if(c){R.rampGradients=[];for(const x of c){const H={gradient:x.gradient,color:x.color.Li()};R.rampGradients.push(H)}R.useRampGradients=x.useRampGradients}const t=x.getColorRemapGradients();if(t){R.colorRemapGradients=[];for(const x of t){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.colorRemapGradients.push(H)}}const A=x.getAlphaRemapGradients();if(A){R.alphaRemapGradients=[];for(const x of A){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.alphaRemapGradients.push(H)}}const D=x.getSizeGradients();if(D){R.sizeGradients=[];for(const x of D){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.sizeGradients.push(H)}}const U=x.getAngularSpeedGradients();if(U){R.angularSpeedGradients=[];for(const x of U){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.angularSpeedGradients.push(H)}}const J=x.getVelocityGradients();if(J){R.velocityGradients=[];for(const x of J){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.velocityGradients.push(H)}}const V=x.getDragGradients();if(V){R.dragGradients=[];for(const x of V){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.dragGradients.push(H)}}const n=x.getEmitRateGradients();if(n){R.emitRateGradients=[];for(const x of n){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.emitRateGradients.push(H)}}const g=x.getStartSizeGradients();if(g){R.startSizeGradients=[];for(const x of g){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.startSizeGradients.push(H)}}const I=x.getLifeTimeGradients();if(I){R.lifeTimeGradients=[];for(const x of I){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.lifeTimeGradients.push(H)}}const i=x.getLimitVelocityGradients();if(i){R.limitVelocityGradients=[];for(const x of i){const H={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?H.factor2=x.factor2:H.factor2=x.factor1,R.limitVelocityGradients.push(H)}R.limitVelocityDamping=x.limitVelocityDamping}x.noiseTexture&&(R.noiseTexture=x.noiseTexture.serialize())}clone(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k={...this._customWrappers};let c=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){c=this.customShader;const R=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",x=t.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,R);k[0]?k[0].effect=x:this.setCustomEffect(x,0)}const A=this.serialize(H),D=Dx.Parse(A,this._scene||this._engine,this._rootUrl);return D.name=R,D.customShader=c,D._customWrappers=k,void 0===x&&(x=this.j),this.noiseTexture&&(D.noiseTexture=this.noiseTexture.clone()),D.j=x,this.preventAutoStart||D.start(),D}}Dx.BILLBOARDMODE_Y=2,Dx.BILLBOARDMODE_ALL=7,Dx.BILLBOARDMODE_STRETCHED=8,Dx.BILLBOARDMODE_STRETCHED_LOCAL=9,jR._ParseParticleSystem=Dx.Parse;var Ux=H(2449),Jx=H(2445),Vx=H(2349);Vx.b.prototype.createTransformFeedback=function(){const R=this._gl.createTransformFeedback();if(!R)throw new Error("Unable to create Transform Feedback");return R},Vx.b.prototype.deleteTransformFeedback=function(R){this._gl.deleteTransformFeedback(R)},Vx.b.prototype.bindTransformFeedback=function(R){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,R)},Vx.b.prototype.beginTransformFeedback=function(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(R?this._gl.POINTS:this._gl.TRIANGLES)},Vx.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Vx.b.prototype.setTranformFeedbackVaryings=function(R,x){this._gl.transformFeedbackVaryings(R,x,this._gl.INTERLEAVED_ATTRIBS)},Vx.b.prototype.bindTransformFeedbackBuffer=function(R){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R?R.underlyingResource:null)},Vx.b.prototype.readTransformFeedbackBuffer=function(R){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R)};const nx="clipPlaneFragmentDeclaration2",gx="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";X.e.IncludesShadersStore[nx]||(X.e.IncludesShadersStore[nx]=gx);H(12855),H(12858),H(12862),H(12870),H(12877),H(12880),H(12886),H(12892);const Ix="gpuRenderParticlesPixelShader",ix="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";X.e.ShadersStore[Ix]||(X.e.ShadersStore[Ix]=ix);const qx="clipPlaneVertexDeclaration2",Sx="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";X.e.IncludesShadersStore[qx]||(X.e.IncludesShadersStore[qx]=Sx);H(12901),H(12910),H(12913),H(12919);const Lx="gpuRenderParticlesVertexShader",bx="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";X.e.ShadersStore[Lx]||(X.e.ShadersStore[Lx]=bx);class Cx extends U{static get IsSupported(){if(!u.c.LastCreatedEngine)return!1;const R=u.c.LastCreatedEngine.getCaps();return R.supportTransformFeedbacks||R.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(R){this._maxActiveParticleCount=Math.min(R,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(R){this.maxActiveParticleCount=R}createPointEmitter(R,x){const H=OR(R,x);return this.particleEmitterType=H,H}createHemisphericEmitter(){const R=lR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=eR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=uR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new k.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=YR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=Rx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new k.o(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=Hx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new k.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new k.o(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,x,H,k){const c=new n;return this.particleEmitterType=c,this.direction1=R,this.direction2=x,this.minEmitBox=H,this.maxEmitBox=k,c}get flowMap(){return this._flowMap}set flowMap(R){this._flowMap!==R&&(this._flowMap=R)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Dx.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Dx.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Dx.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";R?setTimeout((()=>{this.start(0)}),R):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var R;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[x])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new RR.d(this._engine),this._customWrappers[x].effect=R}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(R,x,H){return super._removeGradientAndTexture(R,x,H),this._releaseBuffers(),this}addColorGradient(R,x){this._colorGradients||(this._colorGradients=[]);const H=new z(R,x);return this._colorGradients.push(H),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(R&&this._colorGradients.sort(((R,x)=>R.gradient<x.gradient?-1:R.gradient>x.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(R){return this._removeGradientAndTexture(R,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const x in this._drawWrappers){var R;null===(R=this._drawWrappers[x].drawContext)||void 0===R||R.reset()}}_addFactorGradient(R,x,H){const k=new m(x,H);R.push(k),this._releaseBuffers()}addSizeGradient(R,x){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,R,x),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(R){return this._removeGradientAndTexture(R,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(R,x){if(!R)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&R.sort(((R,x)=>R.gradient<x.gradient?-1:R.gradient>x.gradient?1:0));const H=this;H[x]&&(H[x].dispose(),H[x]=null)}addAngularSpeedGradient(R,x){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,R,x),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(R){return this._removeGradientAndTexture(R,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(R,x){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,R,x),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(R){return this._removeGradientAndTexture(R,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(R,x){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,R,x),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(R){return this._removeGradientAndTexture(R,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(R,x){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,R,x),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(R){return this._removeGradientAndTexture(R,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(R){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(R,x,H){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(R),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Vi=new l.d,this.onStoppedObservable=new l.d,this.onStartedObservable=new l.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=k.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||u.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ei.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,D.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,D.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,D.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,D.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new RR.d(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers={0:new RR.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(x=x??{}).randomTextureSize||delete x.randomTextureSize;const A={ii:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...x},U=x;isFinite(U)&&(A.ii=U),this._capacity=A.ii,this._maxActiveParticleCount=A.ii,this._currentActiveCount=0,this._isAnimationSheetEnabled=t,this.particleEmitterType=new n;const J=Math.min(this._engine.getCaps().maxTextureSize,A.randomTextureSize);let V=[];for(let k=0;k<J;++k)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture=new e.b(new Float32Array(V),J,1,5,H,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,V=[];for(let k=0;k<J;++k)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture2=new e.b(new Float32Array(V),J,1,5,H,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=J}_reset(){this._releaseBuffers()}_createVertexBuffers(R,x,H){const k={};k.position=x.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let c=3;k.age=x.createVertexBuffer("age",c,1,this._attributesStrideSize,!0),c+=1,k.size=x.createVertexBuffer("size",c,3,this._attributesStrideSize,!0),c+=3,k.life=x.createVertexBuffer("life",c,1,this._attributesStrideSize,!0),c+=1,c+=4,this.billboardMode===Dx.BILLBOARDMODE_STRETCHED&&(k.direction=x.createVertexBuffer("direction",c,3,this._attributesStrideSize,!0)),c+=3,this._platform.alignDataInBuffer&&(c+=1),this.particleEmitterType instanceof F&&(c+=3,this._platform.alignDataInBuffer&&(c+=1)),this._colorGradientsTexture||(k.color=x.createVertexBuffer("color",c,4,this._attributesStrideSize,!0),c+=4),this._isBillboardBased||(k.initialDirection=x.createVertexBuffer("initialDirection",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),this.noiseTexture&&(k.noiseCoordinates1=x.createVertexBuffer("noiseCoordinates1",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1),k.noiseCoordinates2=x.createVertexBuffer("noiseCoordinates2",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),k.angle=x.createVertexBuffer("angle",c,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?c++:c+=2,this._isAnimationSheetEnabled&&(k.cellIndex=x.createVertexBuffer("cellIndex",c,1,this._attributesStrideSize,!0),c+=1,this.spriteRandomStartCell&&(k.cellStartOffset=x.createVertexBuffer("cellStartOffset",c,1,this._attributesStrideSize,!0),c+=1)),k.offset=H.createVertexBuffer("offset",0,2),k.uv=H.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(k),this._platform.createVertexBuffers(R,k),this.resetDrawCache()}_initialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!R)return;const x=this._engine,H=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof F&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const c=this.particleEmitterType instanceof F,t=k.g.Bi[0];let A=0;for(let k=0;k<this._capacity;k++)if(H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),c?(this.particleEmitterType.particleDestinationGenerator(k,null,t),H.push(t.x),H.push(t.y),H.push(t.z)):(H.push(0),H.push(0),H.push(0)),this._platform.alignDataInBuffer&&H.push(0),A+=16,c&&(this.particleEmitterType.particlePositionGenerator(k,null,t),H.push(t.x),H.push(t.y),H.push(t.z),this._platform.alignDataInBuffer&&H.push(0),A+=4),this._colorGradientsTexture||(H.push(0),H.push(0),H.push(0),H.push(0),A+=4),this.isBillboardBased||(H.push(0),H.push(0),H.push(0),this._platform.alignDataInBuffer&&H.push(0),A+=4),this.noiseTexture&&(H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),A+=8),H.push(0),A+=1,this._angularSpeedGradientsTexture||(H.push(0),A+=1),this._isAnimationSheetEnabled&&(H.push(0),A+=1,this.spriteRandomStartCell&&(H.push(0),A+=1)),this._platform.alignDataInBuffer){let R=3-(A+3&3);for(A+=R;R-- >0;)H.push(0)}const D=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),U=this._platform.createParticleBuffer(H),J=this._platform.createParticleBuffer(H);this._buffer0=new d.d(x,U,!1,this._attributesStrideSize),this._buffer1=new d.d(x,J,!1,this._attributesStrideSize),this._spriteBuffer=new d.d(x,D,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let R=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(R+="\n#define BILLBOARD"),this._colorGradientsTexture&&(R+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(R+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(R+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(R+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(R+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(R+="\n#define DRAGGRADIENTS"),this._flowMap&&(R+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(R+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(R+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(R+="\n#define NOISE"),this.isLocal&&(R+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===R||(this._cachedUpdateDefines=R,this._updateBuffer=this._platform.createUpdateBuffer(R)),this._platform.isUpdateBufferReady()}_getWrapper(R){const x=this._getCustomDrawWrapper(R);if(null!==x&&void 0!==x&&x.effect)return x;const H=[];this.fillDefines(H,R);let k=this._drawWrappers[R];k||(k=new RR.d(this._engine),k.drawContext&&(k.drawContext.useInstancing=!0),this._drawWrappers[R]=k);const c=H.join("\n");if(k.defines!==c){const R=[],x=[],H=[];this.fillUniformsAttributesAndSamplerNames(x,R,H),k.setEffect(this._engine.createEffect("gpuRenderParticles",R,x,H,c),c)}return k}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const c=[d.g.PositionKind,"age","life","size","angle"];return R||c.push(d.g.ColorKind),x&&c.push("cellIndex"),H||c.push("initialDirection"),k&&c.push("direction"),c.push("offset",d.g.UVKind),c}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=["emitterWM","me","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,xR.e)(k),R&&k.push("sheetInfos"),x&&k.push("logarithmicDepthConstant"),H&&(k.push("vFogInfos"),k.push("vFogColor")),k}fillDefines(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xR.k)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Jx.e.FOGMODE_NONE&&R.push("#define FOG")),x===Dx.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this.isLocal&&R.push("#define LOCAL"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case Dx.BILLBOARDMODE_Y:R.push("#define BILLBOARDY");break;case Dx.BILLBOARDMODE_STRETCHED:R.push("#define BILLBOARDSTRETCHED");break;case Dx.BILLBOARDMODE_ALL:R.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&R.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,x,H){x.push(...Cx._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Dx.BILLBOARDMODE_STRETCHED)),R.push(...Cx._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ux.c.PrepareUniforms(R,this._imageProcessingConfigurationDefines),Ux.c.PrepareSamplers(H,this._imageProcessingConfigurationDefines))}animate(){var R;let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(x?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(R,x){const H=this[x];if(!R||!R.length||H)return;const k=new Float32Array(this._rawTextureWidth);for(let c=0;c<this._rawTextureWidth;c++){const x=c/this._rawTextureWidth;O.GetCurrentGradient(x,R,((R,x,H)=>{k[c]=(0,J.Lerp)(R.factor1,x.factor1,H)}))}this[x]=e.b.CreateRTexture(k,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[x].name=x.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const R=new Uint8Array(4*this._rawTextureWidth),x=A.h.gj[0];for(let H=0;H<this._rawTextureWidth;H++){const k=H/this._rawTextureWidth;O.GetCurrentGradient(k,this._colorGradients,((k,c,t)=>{A.d.LerpToRef(k.color1,c.color1,t,x),R[4*H]=255*x.r,R[4*H+1]=255*x.g,R[4*H+2]=255*x.b,R[4*H+3]=255*x.a}))}this._colorGradientsTexture=e.b.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(R,x){var H,c,t,A;const D=this._getWrapper(R),U=D.effect;this._engine.enableEffect(D);const J=(null===(H=this._scene)||void 0===H?void 0:H.getViewMatrix())||k.e.IdentityReadOnly;if(U.setMatrix("view",J),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),U.setTexture("diffuseSampler",this.particleTexture),U.setVector2("translationPivot",this.translationPivot),U.setVector3("me",this.me),this.isLocal&&U.setMatrix("emitterWM",x),this._colorGradientsTexture?U.setTexture("colorGradientSampler",this._colorGradientsTexture):U.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();U.setFloat3("sheetInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,R.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;U.setVector3("eyePosition",R.globalPosition)}const V=U.defines;if(this._scene&&((0,xR.i)(U,this,this._scene),this.applyFog&&(0,HR.g)(this._scene,void 0,U)),V.indexOf("#define BILLBOARDMODE_ALL")>=0){const R=J.clone();R.invert(),U.setMatrix("invView",R)}return this.useLogarithmicDepth&&this._scene&&(0,HR.n)(V,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),this._setEngineBasedOnBlendMode(R),this._platform.bindDrawBuffers(this._targetIndex,U,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(A=this._scene)&&void 0!==A&&A.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(R){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!R)if(this.j.position){R=this.j.getWorldMatrix()}else{const x=this.j;R=k.g.Matrix[0],k.e.TranslationToRef(x.x,x.y,x.z,R)}const x=this._engine,H=x.getDepthWrite();if(x.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const R=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",R.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",R),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const c=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=c,x.setDepthWrite(H)}render(){let R,x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!x&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let R=0;R<this.preWarmCycles;R++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const R=0|this._accumulatedCount;this._accumulatedCount-=R,this._currentActiveCount+=R}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){R=this.j.getWorldMatrix()}else{const x=this.j;R=k.g.Matrix[0],k.e.TranslationToRef(x.x,x.y,x.z,R)}const c=this._engine;this.updateInAnimate||this._update(R);let t=0;return x||H||(c.setState(!1),this.forceDepthWrite&&c.setDepthWrite(!0),t=this.blendMode===Dx.BLENDMODE_MULTIPLYADD?this._render(Dx.BLENDMODE_MULTIPLY,R)+this._render(Dx.BLENDMODE_ADD,R):this._render(this.blendMode,R),this._engine.setAlphaMode(0)),t}rebuild(){const R=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(R,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,R()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const x in this._drawWrappers){this._drawWrappers[x].dispose()}if(this._drawWrappers={},this._scene){const R=this._scene.Ei.indexOf(this);R>-1&&this._scene.Ei.splice(R,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let x=0;x<this._renderVertexBuffers.length;++x){const R=this._renderVertexBuffers[x];for(const x in R)R[x].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Vi.notifyObservers(this),this.Vi.clear()}clone(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k={...this._customWrappers};let c=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){c=this.customShader;const R=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"";k[0]=t.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,R,void 0,void 0,void 0,this)}const A=this.serialize(H),D=Cx.Parse(A,this._scene||this._engine,this._rootUrl);return D.name=R,D.customShader=c,D._customWrappers=k,void 0===x&&(x=this.j),this.noiseTexture&&(D.noiseTexture=this.noiseTexture.clone()),D.j=x,D}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return Dx._Serialize(x,this,R),x.activeParticleCount=this.activeParticleCount,x.randomTextureSize=this._randomTextureSize,x.customShader=this.customShader,x}static Parse(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0;const t=R.name;let A,D;x instanceof mR.d?A=x:(D=x,A=D.getEngine());const U=new Cx(t,{ii:c||R.ii,randomTextureSize:R.randomTextureSize},x,null,R.isAnimationSheetEnabled);if(U._rootUrl=H,R.customShader&&A.createEffectForParticles){const x=R.customShader,H=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",k=A.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,H,void 0,void 0,void 0,U);U.setCustomEffect(k,0),U.customShader=x}return R.id&&(U.id=R.id),R.activeParticleCount&&(U.activeParticleCount=R.activeParticleCount),Dx._Parse(R,U,x,H),R.preventAutoStart&&(U.preventAutoStart=R.preventAutoStart),k||U.preventAutoStart||U.start(),U}}var Fx=H(485),dx=H(12927),Px=H(12328);class ax{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(R){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const x of this.systems)x.j=R;this._emitterNode=R}setEmitterAsSphere(R,x,H){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:R,renderingGroupId:x};const k=(0,dx.e)("emitterSphere",{diameter:R.diameter,segments:R.segments},H);k.renderingGroupId=x;const c=new Px.d("emitterSphereMaterial",H);c.emissiveColor=R.color,k.material=c;for(const t of this.systems)t.j=k;this._emitterNode=k}start(R){for(const x of this.systems)R&&(x.j=R),x.start()}dispose(){for(const R of this.systems)R.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={systems:[]};for(const H of this.systems)x.systems.push(H.serialize(R));return this._emitterNode&&(x.j=this._emitterCreationOptions),x}static Parse(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;const c=new ax,t=this.BaseAssetsUrl+"/textures/";x=x||u.c.LastCreatedScene;for(const A of R.systems)c.systems.push(H?Cx.Parse(A,x,t,!0,k):Dx.Parse(A,x,t,!0,k));if(R.j){const H=R.j.options;if("Sphere"===R.j.kind)c.setEmitterAsSphere({diameter:H.diameter,segments:H.segments,color:A.c.zi(H.color)},R.j.renderingGroupId,x)}return c}}ax.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Xx=H(506);class Mx{static CreateDefault(R){let x,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,k=arguments.length>2?arguments[2]:void 0;x=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Cx("default system",{ii:H},k):new Dx("default system",H,k),x.j=R;const c=Fx.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return x.particleTexture=new h.d(c,x.va()),x.createConeEmitter(.1,Math.PI/4),x.color1=new A.d(1,1,1,1),x.color2=new A.d(1,1,1,1),x.colorDead=new A.d(1,1,1,0),x.minSize=.1,x.maxSize=.1,x.minEmitPower=2,x.maxEmitPower=2,x.updateSpeed=1/60,x.emitRate=30,x}static CreateAsync(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;x||(x=u.c.LastCreatedScene);const c={};return x.addPendingData(c),new Promise(((t,A)=>{if(H&&!Cx.IsSupported)return x.removePendingData(c),A("Particle system with GPU is not supported.");Fx.e.LoadFile(`${Mx.BaseAssetsUrl}/systems/${R}.json`,(R=>{x.removePendingData(c);const A=JSON.parse(R.toString());return t(ax.Parse(A,x,H,k))}),void 0,void 0,void 0,(()=>(x.removePendingData(c),A(`An error occurred with the creation of your particle system. Check if your type '${R}' exists.`))))}))}static ExportSet(R){const x=new ax;for(const H of R)x.systems.push(H);return x}static ParseFromFileAsync(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",t=arguments.length>5?arguments[5]:void 0;return new Promise(((A,D)=>{const U=new Xx.e;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const x=JSON.parse(U.responseText);let D;D=k?Cx.Parse(x,H,c,!1,t):Dx.Parse(x,H,c,!1,t),R&&(D.name=R),A(D)}else D("Unable to load the particle system")})),U.open("GET",x),U.send()}))}static ParseFromSnippetAsync(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",c=arguments.length>4?arguments[4]:void 0;if("_BLANK"===R){const R=this.CreateDefault(null);return R.start(),Promise.resolve(R)}return new Promise(((t,A)=>{const D=new Xx.e;D.addEventListener("readystatechange",(()=>{if(4==D.readyState)if(200==D.status){const A=JSON.parse(JSON.parse(D.responseText).jsonPayload),U=JSON.parse(A.particleSystem);let J;J=H?Cx.Parse(U,x,k,!1,c):Dx.Parse(U,x,k,!1,c),J.snippetId=R,t(J)}else A("Unable to load the snippet "+R)})),D.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),D.send()}))}}Mx.BaseAssetsUrl=ax.BaseAssetsUrl,Mx.SnippetUrl="https://snippet.babylonjs.com",Mx.CreateFromSnippetAsync=Mx.ParseFromSnippetAsync;var Bx=H(471),ox=H(856),Zx=H(12934);(0,Zx.g)(ox.d.NAME_PARTICLESYSTEM,((R,x,H,k)=>{const c=(0,Zx.i)(ox.d.NAME_PARTICLESYSTEM);if(c&&void 0!==R.Ei&&null!==R.Ei)for(let t=0,A=R.Ei.length;t<A;t++){const A=R.Ei[t];H.Ei.push(c(A,x,k))}})),(0,Zx.c)(ox.d.NAME_PARTICLESYSTEM,((R,x,H)=>{if(R.activeParticleCount){return Cx.Parse(R,x,H)}return Dx.Parse(R,x,H)})),mR.d.prototype.createEffectForParticles=function(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0,D=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,V=arguments.length>9?arguments[9]:void 0,n=[],g=[];const I=[];return U?U.fillUniformsAttributesAndSamplerNames(g,n,I):(n=Dx._GetAttributeNamesOrOptions(),g=Dx._GetEffectCreationOptions()),-1===c.indexOf(" BILLBOARD")&&(c+="\n#define BILLBOARD\n"),null!==U&&void 0!==U&&U.isAnimationSheetEnabled&&-1===c.indexOf(" ANIMATESHEET")&&(c+="\n#define ANIMATESHEET\n"),-1===k.indexOf("diffuseSampler")&&k.push("diffuseSampler"),this.createEffect({vertex:V??(null===U||void 0===U?void 0:U.vertexShaderName)??"particles",fragmentElement:R},n,g.concat(x),I.concat(k),c,t,A,D,void 0,J,(async()=>{0===J?await Promise.resolve().then(H.bind(H,12962)):await Promise.resolve().then(H.bind(H,13040))}))},Bx.d.prototype.getEmittedParticleSystems=function(){const R=[];for(let x=0;x<this.va().Ei.length;x++){const H=this.va().Ei[x];H.j===this&&R.push(H)}return R},Bx.d.prototype.getHierarchyEmittedParticleSystems=function(){const R=[],x=this.getDescendants();x.push(this);for(let H=0;H<this.va().Ei.length;H++){const k=this.va().Ei[H],c=k.j;c.position&&-1!==x.indexOf(c)&&R.push(k)}return R};H(769),H(780),H(813);H(744),H(859),H(831),H(753),H(853);H(2281);var yx;H(12941),H(2319);!function(R){R[R.Color=2]="Color",R[R.UV=1]="UV",R[R.Random=0]="Random",R[R.Stated=3]="Stated"}(yx||(yx={}));var sx=H(2306);const Ex=new k.o(0,0,0),wx=new k.o(0,0,0),hx=new k.o(0,0,0);class fx{constructor(R,x,H){this.width=R,this.height=x,this.data=H}processFlowable(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;if(!H)return;H instanceof k.e?k.o.TransformCoordinatesToRef(R.position,H,hx):(hx.x=H.x,hx.y=H.y,hx.z=H.z);const c=.5*hx.x+.5,t=1-(.5*hx.y+.5),A=Math.floor(c*this.width),D=Math.floor(t*this.height);if(A<0||A>=this.width||D<0||D>=this.height)return;const U=4*(D*this.width+A),J=this.data[U]/255*2-1,V=this.data[U+1]/255*2-1,n=this.data[U+2]/255*2-1,g=this.data[U+3]/255;Ex.set(J,V,n),Ex.scaleToRef(x*g,wx),R.direction.addInPlace(wx)}_processParticle(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;this.processFlowable(R,x,H)}static async FromUrlAsync(R){return await new Promise(((x,H)=>{const k=document.createElement("canvas"),c=k.getContext("2d");let t=null;const A=new Image;A.crossOrigin="anonymous",A.src=R,A.onerror=x=>{H(new Error(`Failed to load image: ${R} : ${x}`))},A.onload=()=>{k.width=A.width,k.height=A.height,c.drawImage(A,0,0),t=c.getImageData(0,0,k.width,k.height),x(new fx(k.width,k.height,t.data))}}))}static async ExtractFromTextureAsync(R){return await new Promise(((x,H)=>{if(!R.isReady())return void R.onLoadObservable.addOnce((async()=>{try{const H=await this.ExtractFromTextureAsync(R);x(H)}catch(k){H(k)}}));const k=R.getSize();sx.j.GetTextureDataAsync(R,k.width,k.height).then((R=>{x(new fx(k.width,k.height,new Uint8ClampedArray(R)))})).catch(H)}))}}var Nx,Wx,Kx,Qx,Gx,Tx,vx,px,rx;!function(R){R[R.Int=1]="Int",R[R.Float=2]="Float",R[R.Vector2=4]="Vector2",R[R.Bi=8]="Bi",R[R.Matrix=16]="Matrix",R[R.Particle=32]="Particle",R[R.Texture=64]="Texture",R[R.gj=128]="gj",R[R.FloatGradient=256]="FloatGradient",R[R.Vector2Gradient=512]="Vector2Gradient",R[R.Vector3Gradient=1024]="Vector3Gradient",R[R.Color4Gradient=2048]="Color4Gradient",R[R.System=4096]="System",R[R.AutoDetect=8192]="AutoDetect",R[R.BasedOnInput=16384]="BasedOnInput",R[R.Undefined=32768]="Undefined",R[R.All=65535]="All"}(Nx||(Nx={})),function(R){R[R.Compatible=0]="Compatible",R[R.TypeIncompatible=1]="TypeIncompatible",R[R.HierarchyIssue=2]="HierarchyIssue"}(Wx||(Wx={})),function(R){R[R.Input=0]="Input",R[R.Output=1]="Output"}(Kx||(Kx={}));class zx{get direction(){return this._direction}get type(){if(this._type===Nx.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Nx.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(R){this._type=R}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((R=>R.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(R,x,H){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Nx.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new l.d,this.onDisconnectionObservable=new l.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=x,this.name=R,this._direction=H}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(R){var x;return this.isConnected?null!==(x=this._connectedPoint)&&void 0!==x&&x._storedFunction?this._connectedPoint._storedFunction(R):this._connectedPoint._storedValue:this.value}canConnectTo(R){return 0===this.checkCompatibilityState(R)}checkCompatibilityState(R){const x=this._ownerBlock,H=R.ownerBlock;if(this.type!==R.type&&R.innerType!==Nx.AutoDetect)return R.acceptedConnectionPointTypes&&-1!==R.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(R.excludedConnectionPointTypes&&-1!==R.excludedConnectionPointTypes.indexOf(this.type))return 1;let k=H,c=x;return 0===this.direction&&(k=x,c=H),k.isAnAncestorOf(c)?2:0}connectTo(R){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(R))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${R.ownerBlock.name}".${R.name}`;return this._endpoints.push(R),R._connectedPoint=this,this.onConnectionObservable.notifyObservers(R),R.onConnectionObservable.notifyObservers(this),this}disconnectFrom(R){const x=this._endpoints.indexOf(R);return-1===x||(this._endpoints.splice(x,1),R._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(R),R.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(R){let x=1;for(;x<Nx.All;)R&x||this.excludedConnectionPointTypes.push(x),x<<=1}serialize(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const x={};return x.name=this.name,x.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Li?(x.valueType="BABYLON."+this.value.getClassName(),x.value=this.value.Li()):(x.valueType="number",x.value=this.value)),R&&this.connectedPoint&&(x.inputName=this.name,x.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,x.targetConnectionName=this.connectedPoint.name,x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),x}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class jx{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(R){this._name=R}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(R){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new l.d,this.Vi=new l.d,this.onInputChangedObservable=new l.d,this.visibleOnFrame=!1,this._name=R,this.uniqueId=f.e.UniqueId}_inputRename(R){return R}_outputRename(R){return R}isAnAncestorOf(R){for(const x of this._outputs)if(x.hasEndpoints)for(const H of x.endpoints){if(H.ownerBlock===R)return!0;if(H.ownerBlock.isAnAncestorOf(R))return!0}return!1}isAnAncestorOfType(R){if(this.getClassName()===R)return!0;for(const x of this._outputs)if(x.hasEndpoints)for(const H of x.endpoints)if(H.ownerBlock.isAnAncestorOfType(R))return!0;return!1}getInputByName(R){const x=this._inputs.filter((x=>x.name===R));return x.length?x[0]:null}_linkConnectionTypes(R,x){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[x]._acceptedConnectionPointType=this._inputs[R]:(this._inputs[R]._linkedConnectionSource=this._inputs[x],this._inputs[R]._isMainLinkSource=!0),this._inputs[x]._linkedConnectionSource=this._inputs[R]}registerInput(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0;const A=new zx(R,this,0);return A.type=x,A.isOptional=H,A.defaultValue=k,A.value=k,A.valueMin=c,A.valueMax=t,this._inputs.push(A),this.onInputChangedObservable.notifyObservers(A),this}registerOutput(R,x,H){return(H=H??new zx(R,this,1)).type=x,this._outputs.push(H),this}_build(R){}_customBuildStep(R){}build(R){if(this._buildId===R.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((R=>R.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=R.buildId;for(const x of this._inputs){if(!x.connectedPoint){x.isOptional||R.notConnectedNonOptionalInputs.push(x);continue}const H=x.connectedPoint.ownerBlock;H&&H!==this&&!H.isSystem&&H.build(R)}return this._customBuildStep(R),R.verbose&&N.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(R),this.onBuildObservable.notifyObservers(this),!1}serialize(){const R={};R.customType="BABYLON."+this.getClassName(),R.id=this.uniqueId,R.name=this.name,R.visibleOnFrame=this.visibleOnFrame,R.inputs=[],R.outputs=[];for(const x of this.inputs)R.inputs.push(x.serialize());for(const x of this.outputs)R.outputs.push(x.serialize(!1));return R}_deserialize(R){this._name=R.name,this.comments=R.comments,this.visibleOnFrame=!!R.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(R)}_deserializePortDisplayNamesAndExposedOnFrame(R){const x=R.inputs,H=R.outputs;if(x)for(const k of x){const R=this.inputs.find((R=>R.name===k.name));if(!R)return;if(k.displayName&&(R.displayName=k.displayName),k.isExposedOnFrame&&(R.isExposedOnFrame=k.isExposedOnFrame,R.exposedPortPosition=k.exposedPortPosition),void 0!==k.value&&null!==k.value)if("number"===k.valueType)R.value=k.value;else{const x=(0,D.e)(k.valueType);x&&(R.value=x.zi(k.value))}}if(H)for(let k=0;k<H.length;k++){const R=H[k];R.displayName&&(this.outputs[k].displayName=R.displayName),R.isExposedOnFrame&&(this.outputs[k].isExposedOnFrame=R.isExposedOnFrame,this.outputs[k].exposedPortPosition=R.exposedPortPosition)}}clone(){const R=this.serialize(),x=(0,D.e)(R.customType);if(x){const H=new x;return H._deserialize(R),H}return null}dispose(){this.Vi.notifyObservers(this),this.Vi.clear();for(const R of this.inputs)R.dispose();for(const R of this.outputs)R.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function mx(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",k=arguments.length>3?arguments[3]:void 0;return(c,t)=>{let A=c._propStore;A||(A=[],c._propStore=A),A.push({propertyName:t,displayName:R,type:x,groupName:H,options:k??{},className:c.getClassName()})}}(0,s.d)([(0,E.Q)("comment")],jx.prototype,"comments",void 0),function(R){R[R.Boolean=0]="Boolean",R[R.Float=1]="Float",R[R.Int=2]="Int",R[R.Vector2=3]="Vector2",R[R.List=4]="List",R[R.gj=5]="gj",R[R.SamplingMode=6]="SamplingMode",R[R.TextureFormat=7]="TextureFormat",R[R.TextureType=8]="TextureType"}(Qx||(Qx={})),function(R){R[R.None=0]="None",R[R.Position=1]="Position",R[R.Direction=2]="Direction",R[R.Age=3]="Age",R[R.Lifetime=4]="Lifetime",R[R.Color=5]="Color",R[R.ScaledDirection=6]="ScaledDirection",R[R.Scale=7]="Scale",R[R.AgeGradient=8]="AgeGradient",R[R.Angle=9]="Angle",R[R.SpriteCellIndex=16]="SpriteCellIndex",R[R.SpriteCellStart=17]="SpriteCellStart",R[R.SpriteCellEnd=18]="SpriteCellEnd"}(Gx||(Gx={})),function(R){R[R.None=0]="None",R[R.Time=1]="Time",R[R.Delta=2]="Delta",R[R.Emitter=3]="Emitter"}(Tx||(Tx={}));class Ox{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let R="";for(const x of this.notConnectedNonOptionalInputs)R+=`input ${x.name} from block ${x.ownerBlock.name}[${x.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(R)throw"Build of Node Particle System Set failed:\n"+R}adapt(R,x){const H=R.getConnectedValue(this)||0;if(R.type===x)return H;switch(x){case Nx.Vector2:return new k.k(H,H);case Nx.Bi:return new k.o(H,H,H);case Nx.gj:return new A.d(H,H,H,H)}return null}getContextualValue(R){if(!this.particleContext||!this.systemContext)return null;switch(R){case Gx.Position:return this.particleContext.position;case Gx.Direction:return this.particleContext.direction;case Gx.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Gx.Color:return this.particleContext.color;case Gx.Age:return this.particleContext.age;case Gx.Lifetime:return this.particleContext.lifeTime;case Gx.Angle:return this.particleContext.angle;case Gx.Scale:return this.particleContext.scale;case Gx.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Gx.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Gx.SpriteCellIndex:return this.particleContext.cellIndex;case Gx.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(R){if(!this.particleContext||!this.systemContext)return null;switch(R){case Tx.Time:return this.systemContext._actualFrame;case Tx.Delta:return this.systemContext._scaledUpdateSpeed;case Tx.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function lx(R,x,H){const k=new Ox;k.Yk=x;const c=R.createSystem(k);return c.canStart=()=>!0,c.j=H.clone(),c.disposeOnStop=!0,c.start(),c}class ex extends jx{constructor(R){super(R),this.blendMode=U.BLENDMODE_ONEONE,this.ii=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Nx.Particle),this.registerInput("texture",Nx.Texture),this.registerInput("onStart",Nx.System,!0),this.registerInput("onEnd",Nx.System,!0),this.registerOutput("system",Nx.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(R){R.ii=this.ii,R.buildId=this._buildId++,this.build(R);const x=this.particle.getConnectedValue(R);return x.particleTexture=this.texture.getConnectedValue(R),x.emitRate=this.emitRate,x.blendMode=this.blendMode,x.name=this.name,x._nodeGenerated=!0,x._targetStopDuration=this.targetStopDuration,x.startDelay=this.startDelay,this.system._storedValue=this,x.canStart=()=>!this.doNoStart,x.onStartedObservable.add((H=>{const k=this.onStart.getConnectedValue(R);k&&H.onStartedObservable.addOnce((()=>{R.systemContext=x;const H=lx(k,R.Yk,R.emitterPosition);this.Vi.addOnce((()=>{H.dispose()}))}));const c=this.onEnd.getConnectedValue(R);c&&H.onStoppedObservable.addOnce((()=>{R.systemContext=x;const H=lx(c,R.Yk,R.emitterPosition);this.Vi.addOnce((()=>{H.dispose()}))}))})),this.Vi.addOnce((()=>{x.dispose()})),x}serialize(){const R=super.serialize();return R.ii=this.ii,R.emitRate=this.emitRate,R.blendMode=this.blendMode,R.doNoStart=this.doNoStart,R.targetStopDuration=this.targetStopDuration,R.startDelay=this.startDelay,R}_deserialize(R){super._deserialize(R),this.ii=R.ii,this.emitRate=R.emitRate,this.doNoStart=!!R.doNoStart,void 0!==R.blendMode&&(this.blendMode=R.blendMode),void 0!==R.targetStopDuration&&(this.targetStopDuration=R.targetStopDuration),void 0!==R.startDelay&&(this.startDelay=R.startDelay)}}(0,s.d)([mx("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:U.BLENDMODE_ONEONE},{label:"Standard",value:U.BLENDMODE_STANDARD},{label:"Add",value:U.BLENDMODE_ADD},{label:"Multiply",value:U.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:U.BLENDMODE_MULTIPLYADD}]})],ex.prototype,"blendMode",void 0),(0,s.d)([mx("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],ex.prototype,"ii",void 0),(0,s.d)([mx("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ex.prototype,"emitRate",void 0),(0,s.d)([mx("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ex.prototype,"targetStopDuration",void 0),(0,s.d)([mx("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ex.prototype,"startDelay",void 0),(0,s.d)([mx("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ex.prototype,"doNoStart",void 0),(0,D.h)("BABYLON.SystemBlock",ex);class ux extends jx{get type(){if(this._type===Nx.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Nx.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Nx.Vector2,this._type;case"Bi":return this._type=Nx.Bi,this._type;case"gj":return this._type=Nx.gj,this._type;case"Matrix":return this._type=Nx.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Gx.None&&this._systemSource!==Tx.None}get systemSource(){return this._systemSource}set systemSource(R){if(this._systemSource=R,R!==Tx.None){switch(this._contextualSource=Gx.None,this._type=Nx.Float,R){case Tx.Time:case Tx.Delta:this._type=Nx.Float;break;case Tx.Emitter:this._type=Nx.Bi}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Gx.None}get contextualValue(){return this._contextualSource}set contextualValue(R){if(this._contextualSource=R,R!==Gx.None){switch(this._systemSource=Tx.None,R){case Gx.Scale:this._type=Nx.Vector2;break;case Gx.Position:case Gx.Direction:case Gx.ScaledDirection:this._type=Nx.Bi;break;case Gx.Color:this._type=Nx.gj;break;case Gx.Age:case Gx.Lifetime:case Gx.Angle:case Gx.AgeGradient:this._type=Nx.Float;break;case Gx.SpriteCellEnd:case Gx.SpriteCellStart:case Gx.SpriteCellIndex:this._type=Nx.Int}this.output&&(this.output.type=this._type)}}constructor(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nx.AutoDetect;super(R),this._type=Nx.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new l.d,this._systemSource=Tx.None,this._contextualSource=Gx.None,this._type=x,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",x)}get value(){return this._storedValue}set value(R){this.type===Nx.Float&&this.min!==this.max&&(R=Math.max(this.min,R),R=Math.min(this.max,R)),this._storedValue=R,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(R){this._valueCallback=R}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Nx.Int:case Nx.Float:this.value=0;break;case Nx.Vector2:this.value=k.k.Zero();break;case Nx.Bi:this.value=k.o.Zero();break;case Nx.gj:this.value=new A.d(1,1,1,1);break;case Nx.Matrix:this.value=k.e.Identity()}}_build(R){super._build(R),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=R=>R.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=R=>R.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const R=super.serialize();return R.type=this.type,R.contextualValue=this.contextualValue,R.systemSource=this.systemSource,R.min=this.min,R.max=this.max,R.groupInInspector=this.groupInInspector,R.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Li?(R.valueType="BABYLON."+this._storedValue.getClassName(),R.value=this._storedValue.Li()):(R.valueType="number",R.value=this._storedValue)),R}_deserialize(R){if(super._deserialize(R),this._type=R.type,this.contextualValue=R.contextualValue,this.systemSource=R.systemSource||Tx.None,this.min=R.min||0,this.max=R.max||0,this.groupInInspector=R.groupInInspector||"",void 0!==R.displayInInspector&&(this.displayInInspector=R.displayInInspector),R.valueType)if("number"===R.valueType)this._storedValue=R.value;else{const x=(0,D.e)(R.valueType);x&&(this._storedValue=x.zi(R.value))}}}(0,D.h)("BABYLON.ParticleInputBlock",ux);class Yx extends jx{get url(){return this._url}set url(R){this._url!==R&&(this._cachedData=null,this._url=R,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(R){this._textureDataUrl!==R&&(this._cachedData=null,this._textureDataUrl=R,this._url="",this._sourceTexture=null)}set sourceTexture(R){this._sourceTexture!==R&&(this._cachedData=null,this._sourceTexture=R,this._url="",this._textureDataUrl="")}constructor(R){super(R),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Nx.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const R=this.texture._storedValue;return await new Promise(((x,H)=>{if(!R.isReady())return void R.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),x(this._cachedData)}catch(R){H(R)}}));const k=R.getSize();sx.j.GetTextureDataAsync(R,k.width,k.height).then((H=>{this._cachedData={width:k.width,height:k.height,data:new Uint8ClampedArray(H)},R.dispose(),x(this._cachedData)})).catch(H)}))}_build(R){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new h.d(this._textureDataUrl,R.Yk):this.texture._storedValue=new h.d(this._url,R.Yk):this.texture._storedValue=null}serialize(){const R=super.serialize();return R.url=this.url,R.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(R.textureDataUrl=this.textureDataUrl),R}_deserialize(R){super._deserialize(R),this.url=R.url,this.serializedCachedData=!!R.serializedCachedData,R.textureDataUrl&&(this.textureDataUrl=R.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,D.h)("BABYLON.ParticleTextureSourceBlock",Yx);class RH extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("position",Nx.Bi),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(R){const x=this.particle.getConnectedValue(R);if(this.output._storedValue=x,!this.position.isConnected)return;const H={process:H=>{R.particleContext=H,R.systemContext=x,H.position.p(this.position.getConnectedValue(R))},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H}}(0,D.h)("BABYLON.UpdatePositionBlock",RH),function(R){R[R.Add=0]="Add",R[R.Subtract=1]="Subtract",R[R.Multiply=2]="Multiply",R[R.Divide=3]="Divide",R[R.Max=4]="Max",R[R.Min=5]="Min"}(vx||(vx={}));class xH extends jx{constructor(R){super(R),this.operation=vx.Add,this.registerInput("left",Nx.AutoDetect),this.registerInput("right",Nx.AutoDetect),this.registerOutput("output",Nx.BasedOnInput),this.output._typeConnectionSource=this.left;const x=[Nx.Matrix,Nx.Particle,Nx.Texture,Nx.System,Nx.FloatGradient,Nx.Color4Gradient,Nx.Vector2Gradient,Nx.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...x),this.right.excludedConnectionPointTypes.push(...x),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(R){let x;const H=this.left,c=this.right;if(!H.isConnected||!c.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const t=H.type===Nx.Float||H.type===Nx.Int,D=c.type===Nx.Float||c.type===Nx.Int,U=t&&D;switch(this.operation){case vx.Add:x=U?R=>H.getConnectedValue(R)+c.getConnectedValue(R):t?R=>R.adapt(H,c.type).add(c.getConnectedValue(R)):R=>H.getConnectedValue(R).add(R.adapt(c,H.type));break;case vx.Subtract:x=U?R=>H.getConnectedValue(R)-c.getConnectedValue(R):t?R=>R.adapt(H,c.type).Pg(c.getConnectedValue(R)):R=>H.getConnectedValue(R).Pg(R.adapt(c,H.type));break;case vx.Multiply:x=U?R=>H.getConnectedValue(R)*c.getConnectedValue(R):t?R=>R.adapt(H,c.type).multiply(c.getConnectedValue(R)):R=>H.getConnectedValue(R).multiply(R.adapt(c,H.type));break;case vx.Divide:x=U?R=>H.getConnectedValue(R)/c.getConnectedValue(R):t?R=>R.adapt(H,c.type).divide(c.getConnectedValue(R)):R=>H.getConnectedValue(R).divide(R.adapt(c,H.type));break;case vx.Min:if(U)x=R=>Math.min(H.getConnectedValue(R),c.getConnectedValue(R));else{const[R,D]=t?[c,H]:[H,c];switch(R.type){case Nx.Vector2:x=x=>k.k.Minimize(R.getConnectedValue(x),x.adapt(D,R.type));break;case Nx.Bi:x=x=>k.o.Minimize(R.getConnectedValue(x),x.adapt(D,R.type));break;case Nx.gj:x=x=>{const H=R.getConnectedValue(x),{r:k,g:c,b:t,a:U}=x.adapt(D,R.type);return new A.d(Math.min(H.r,k),Math.min(H.g,c),Math.min(H.b,t),Math.min(H.a,U))}}}break;case vx.Max:if(!U){const[R,D]=t?[c,H]:[H,c];switch(R.type){case Nx.Vector2:x=x=>k.k.Maximize(R.getConnectedValue(x),x.adapt(D,R.type));break;case Nx.Bi:x=x=>k.o.Maximize(R.getConnectedValue(x),x.adapt(D,R.type));break;case Nx.gj:x=x=>{const H=R.getConnectedValue(x),{r:k,g:c,b:t,a:U}=x.adapt(D,R.type);return new A.d(Math.max(H.r,k),Math.min(H.g,c),Math.min(H.b,t),Math.min(H.a,U))}}break}x=R=>Math.max(H.getConnectedValue(R),c.getConnectedValue(R))}this.output._storedFunction=R=>H.type===Nx.Int?0|x(R):x(R)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Nx.Int||this.left.type===Nx.Float&&this.right.type!==Nx.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[R,x]of[[this.left,this.right],[this.right,this.left]])R.acceptedConnectionPointTypes=[Nx.Int,Nx.Float],x.isConnected&&(R.acceptedConnectionPointTypes.push(x.type),x.type!==Nx.Int&&x.type!==Nx.Float||R.acceptedConnectionPointTypes.push(Nx.Vector2,Nx.Bi,Nx.gj))}dispose(){super.dispose();for(const R of this._connectionObservers)R.remove();this._connectionObservers.length=0}serialize(){const R=super.serialize();return R.operation=this.operation,R}_deserialize(R){super._deserialize(R),this.operation=R.operation}}(0,s.d)([mx("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:vx.Add},{label:"Subtract",value:vx.Subtract},{label:"Multiply",value:vx.Multiply},{label:"Divide",value:vx.Divide},{label:"Max",value:vx.Max},{label:"Min",value:vx.Min}]})],xH.prototype,"operation",void 0),(0,D.h)("BABYLON.ParticleMathBlock",xH);class HH extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("direction1",Nx.Bi,!0,new k.o(0,1,0)),this.registerInput("direction2",Nx.Bi,!0,new k.o(0,1,0)),this.registerInput("minEmitBox",Nx.Bi,!0,new k.o(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Nx.Bi,!0,new k.o(.5,.5,.5)),this.registerOutput("output",Nx.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(R){const x=this.particle.getConnectedValue(R);x._directionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.direction1.getConnectedValue(R),t=this.direction2.getConnectedValue(R),A=(0,J.RandomRange)(c.x,t.x),D=(0,J.RandomRange)(c.y,t.y),U=(0,J.RandomRange)(c.z,t.z);R.isEmitterTransformNode?k.o.TransformNormalFromFloatsToRef(A,D,U,R.emitterWorldMatrix,H.direction):H.direction.si(A,D,U)},x._positionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.minEmitBox.getConnectedValue(R),t=this.maxEmitBox.getConnectedValue(R),A=(0,J.RandomRange)(c.x,t.x),D=(0,J.RandomRange)(c.y,t.y),U=(0,J.RandomRange)(c.z,t.z);R.isEmitterTransformNode?k.o.TransformCoordinatesFromFloatsToRef(A,D,U,R.emitterWorldMatrix,H.position):(H.position.si(A,D,U),H.position.addInPlace(R.emitterPosition))},this.output._storedValue=x}}(0,D.h)("BABYLON.BoxShapeBlock",HH);class kH extends jx{constructor(R){super(R),this.registerInput("emitPower",Nx.Float,!0,1),this.registerInput("lifeTime",Nx.Float,!0,1),this.registerInput("color",Nx.gj,!0,new A.d(1,1,1,1)),this.registerInput("scale",Nx.Vector2,!0,new k.k(1,1)),this.registerInput("angle",Nx.Float,!0,0),this.registerOutput("particle",Nx.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(R){const x=new Dx(this.name,R.ii,R.Yk,null,!1,void 0,!0);x.particleEmitterType=new L,x._lifeTimeCreation.process=(x,H)=>{R.particleContext=x,x.lifeTime=this.lifeTime.getConnectedValue(R),H._emitPower=this.emitPower.getConnectedValue(R)},x._colorCreation.process=x=>{R.particleContext=x,x.color.p(this.color.getConnectedValue(R))},x._sizeCreation.process=x=>{R.particleContext=x,x.size=1,x.scale.p(this.scale.getConnectedValue(R))},x._angleCreation.process=x=>{R.particleContext=x,x.angle=this.angle.getConnectedValue(R)},this.particle._storedValue=x}}(0,D.h)("BABYLON.CreateParticleBlock",kH);class cH{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const R=[];for(const x of this.attachedBlocks)x.isInput&&R.push(x);return R}constructor(R){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new l.d,this.name=R}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(R){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(R)&&this.attachedBlocks.push(R);for(const H of R.inputs){const k=H.connectedPoint;if(k){const H=k.ownerBlock;H!==R&&this._initializeBlock(H,x)}}}async buildAsync(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((H=>{const k=new ax;for(const R of this._systemBlocks)this._initializeBlock(R);for(const c of this.systemBlocks){const H=new Ox;H.buildId=this._buildId++,H.Yk=R,H.verbose=x;const t=c.createSystem(H);H.emitErrors(),k.systems.push(t)}this.onBuildObservable.notifyObservers(this),H(k)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const R=new ex("Particle system"),x=new RH("Update position");x.output.connectTo(R.particle);const H=new ux("Position");H.contextualValue=Gx.Position;const k=new ux("Scaled direction");k.contextualValue=Gx.ScaledDirection;const c=new xH("Add");c.operation=vx.Add,H.output.connectTo(c.left),k.output.connectTo(c.right),c.output.connectTo(x.position);const t=new kH("Create particle"),A=new HH("Box shape");t.particle.connectTo(A.particle),A.output.connectTo(x.particle);const D=new Yx("Texture");D.texture.connectTo(R.texture),D.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(R)}removeBlock(R){const x=this.attachedBlocks.indexOf(R);if(x>-1&&this.attachedBlocks.splice(x,1),R.isSystem){const x=this._systemBlocks.indexOf(R);x>-1&&this._systemBlocks.splice(x,1)}}parseSerializedObject(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x||this.clear();const H={};for(const k of R.Ng){const R=(0,D.e)(k.customType);if(R){const x=new R;x._deserialize(k),H[k.id]=x,this.attachedBlocks.push(x),x.isSystem&&this._systemBlocks.push(x)}}for(const k of this.attachedBlocks)if(k.isTeleportOut){const R=k,x=R._tempEntryPointUniqueId;if(x){const k=H[x];k&&k.attachToEndpoint(R)}}for(let k=0;k<R.Ng.length;k++){const c=R.Ng[k],t=H[c.id];t&&(t.inputs.length&&c.inputs.some((R=>R.targetConnectionName))&&!x||this._restoreConnections(t,R,H))}if(R.locations||R.editorData&&R.editorData.locations){const k=R.locations||R.editorData.locations;for(const R of k)H[R.blockId]&&(R.blockId=H[R.blockId].uniqueId);x&&this.editorData&&this.editorData.locations&&k.concat(this.editorData.locations),R.locations?this.editorData={locations:k}:(this.editorData=R.editorData,this.editorData.locations=k);const c=[];for(const R in H)c[R]=H[R].uniqueId;this.editorData.map=c}this.comment=R.comment}_restoreConnections(R,x,H){for(const k of R.outputs)for(const c of x.Ng){const t=H[c.id];if(t)for(const A of c.inputs)if(H[A.targetBlockId]!==R||A.targetConnectionName!==k.name);else{const R=t.getInputByName(A.inputName);if(!R||R.isConnected)continue;k.connectTo(R,!0),this._restoreConnections(t,x,H)}}}serialize(R){const x=R?{}:w.d.Serialize(this);x.editorData=JSON.parse(JSON.stringify(this.editorData));let H=[];R?H=R:x.customType="BABYLON.NodeParticleSystemSet",x.Ng=[];for(const k of H)x.Ng.push(k.serialize());if(!R)for(const k of this.attachedBlocks)-1===H.indexOf(k)&&x.Ng.push(k.serialize());return x}dispose(){for(const R of this.attachedBlocks)R.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(R){const x=new cH(R);return x.setToDefault(),x}static Parse(R){const x=w.d.Parse((()=>new cH(R.name)),R,null);return x.parseSerializedObject(R),x}static ParseFromSnippetAsync(R,x){return"_BLANK"===R?Promise.resolve(cH.CreateDefault("blank")):new Promise(((H,k)=>{const c=new Xx.e;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const A=JSON.parse(JSON.parse(c.responseText).jsonPayload),D=JSON.parse(A.nodeParticle);x||(x=w.d.Parse((()=>new cH(R)),D,null)),x.parseSerializedObject(D),x.snippetId=R;try{H(x)}catch(t){k(t)}}else k("Unable to load the snippet "+R)})),c.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),c.send()}))}}cH.EditorURL=`${Fx.e._DefaultCdnUrl}/v${mR.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,cH.SnippetUrl="https://snippet.babylonjs.com",(0,s.d)([(0,E.Q)()],cH.prototype,"name",void 0),(0,s.d)([(0,E.Q)("comment")],cH.prototype,"comment",void 0),function(R){R[R.None=0]="None",R[R.PerParticle=1]="PerParticle",R[R.PerSystem=2]="PerSystem"}(px||(px={}));class tH extends jx{constructor(R){super(R),this._currentLockId=-2,this.lockMode=px.PerParticle,this.registerInput("min",Nx.AutoDetect,!0,0),this.registerInput("max",Nx.AutoDetect,!0,1),this.registerOutput("output",Nx.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nx.Float|Nx.Int|Nx.Vector2|Nx.Bi|Nx.gj),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Nx.Float|Nx.Int|Nx.Vector2|Nx.Bi|Nx.gj),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Nx.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let R=null;switch(this._currentLockId=-2,this.min.type){case Nx.AutoDetect:case Nx.Int:case Nx.Float:R=R=>{const x=this.min.getConnectedValue(R)||0,H=this.max.getConnectedValue(R)||1;return x+Math.random()*(H-x)};break;case Nx.Vector2:R=R=>{const x=this.min.getConnectedValue(R)||k.k.Zero(),H=this.max.getConnectedValue(R)||k.k.One();return new k.k(x.x+Math.random()*(H.x-x.x),x.y+Math.random()*(H.y-x.y))};break;case Nx.Bi:R=R=>{const x=this.min.getConnectedValue(R)||k.o.Zero(),H=this.max.getConnectedValue(R)||k.o.One();return new k.o(x.x+Math.random()*(H.x-x.x),x.y+Math.random()*(H.y-x.y),x.z+Math.random()*(H.z-x.z))};break;case Nx.gj:R=R=>{const x=this.min.getConnectedValue(R)||new A.d(0,0,0,0),H=this.max.getConnectedValue(R)||new A.d(1,1,1,1);return new A.d(x.x+Math.random()*(H.x-x.x),x.y+Math.random()*(H.y-x.y),x.z+Math.random()*(H.z-x.z),x.w+Math.random()*(H.w-x.w))}}this.output._storedFunction=x=>{var H;let k=0;switch(this.lockMode){case px.PerParticle:k=(null===(H=x.particleContext)||void 0===H?void 0:H.id)||-1;break;case px.PerSystem:k=x.buildId||0}return this._currentLockId!==k&&(this.lockMode!==px.None&&(this._currentLockId=k),this.output._storedValue=R(x)),this.output._storedValue}}serialize(){const R=super.serialize();return R.lockMode=this.lockMode,R}_deserialize(R){super._deserialize(R),this.lockMode=R.lockMode}}(0,s.d)([mx("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:px.None},{label:"Per particle",value:px.PerParticle},{label:"Per system",value:px.PerSystem}]})],tH.prototype,"lockMode",void 0),(0,D.h)("BABYLON.ParticleRandomBlock",tH);class AH extends jx{constructor(R){super(R),this._currentLockId=-2,this.lockMode=px.PerParticle,this.registerInput("min",Nx.AutoDetect),this.registerInput("max",Nx.AutoDetect),this.registerOutput("output",Nx.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const x=[Nx.Matrix,Nx.Particle,Nx.Texture,Nx.System,Nx.FloatGradient,Nx.Color4Gradient,Nx.Vector2Gradient,Nx.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...x),this.max.excludedConnectionPointTypes.push(...x)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let R=null;switch(this._currentLockId=-2,this.min.type){case Nx.Float:case Nx.Int:R=R=>{const x=this.min.getConnectedValue(R),H=this.max.getConnectedValue(R);return Math.random()*(H-x)+x};break;case Nx.Vector2:R=R=>{const x=this.min.getConnectedValue(R),H=this.max.getConnectedValue(R);return new k.k(Math.random()*(H.x-x.x)+x.x,Math.random()*(H.y-x.y)+x.y)};break;case Nx.Bi:R=R=>{const x=this.min.getConnectedValue(R),H=this.max.getConnectedValue(R);return new k.o(Math.random()*(H.x-x.x)+x.x,Math.random()*(H.y-x.y)+x.y,Math.random()*(H.z-x.z)+x.z)};break;case Nx.gj:R=R=>{const x=this.min.getConnectedValue(R),H=this.max.getConnectedValue(R);return new A.d(Math.random()*(H.r-x.r)+x.r,Math.random()*(H.g-x.g)+x.g,Math.random()*(H.b-x.b)+x.b,Math.random()*(H.a-x.a)+x.a)}}this.output._storedFunction=x=>{var H;let k=0;switch(this.lockMode){case px.PerParticle:k=(null===(H=x.particleContext)||void 0===H?void 0:H.id)||-1;break;case px.PerSystem:k=x.buildId||0}return this._currentLockId!==k&&(this.lockMode!==px.None&&(this._currentLockId=k),this.output._storedValue=R(x)),this.output._storedValue}}serialize(){const R=super.serialize();return R.lockMode=this.lockMode,R}_deserialize(R){super._deserialize(R),void 0!==R.lockMode&&(this.lockMode=R.lockMode)}}(0,s.d)([mx("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:px.None},{label:"Per particle",value:px.PerParticle},{label:"Per system",value:px.PerSystem}]})],AH.prototype,"lockMode",void 0),(0,D.h)("BABYLON.RandomRangeBlock",AH);(0,D.h)("BABYLON.ParticleLerpBlock",class extends jx{constructor(R){super(R),this.registerInput("left",Nx.AutoDetect),this.registerInput("right",Nx.AutoDetect),this.registerInput("gradient",Nx.Float,!0,0,0,1),this.registerOutput("output",Nx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nx.Float|Nx.Int|Nx.Vector2|Nx.Bi|Nx.gj)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const R=(R,x,H)=>(1-R)*x+R*H;this.output._storedFunction=x=>{const H=this.left.getConnectedValue(x),c=this.right.getConnectedValue(x),t=this.gradient.getConnectedValue(x);switch(this.left.type){case Nx.Int:case Nx.Float:return R(t,H,c);case Nx.Vector2:return new k.k(R(t,H.x,c.x),R(t,H.y,c.y));case Nx.Bi:return new k.o(R(t,H.x,c.x),R(t,H.y,c.y),R(t,H.z,c.z));case Nx.gj:return new A.d(R(t,H.r,c.r),R(t,H.g,c.g),R(t,H.b,c.b),R(t,H.a,c.a))}return 0}}});(0,D.h)("BABYLON.UpdateDirectionBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("direction",Nx.Bi),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(R){const x=this.particle.getConnectedValue(R);if(this.output._storedValue=x,!this.direction.isConnected)return;const H={process:H=>{R.particleContext=H,R.systemContext=x,H.direction.p(this.direction.getConnectedValue(R))},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H}});(0,D.h)("BABYLON.UpdateColorBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("color",Nx.gj),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(R){const x=this.particle.getConnectedValue(R);if(this.output._storedValue=x,!this.color.isConnected)return;const H={process:H=>{R.particleContext=H,R.systemContext=x,H.color.p(this.color.getConnectedValue(R))},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H}});(0,D.h)("BABYLON.UpdateScaleBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("scale",Nx.Vector2),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(R){const x=this.particle.getConnectedValue(R);if(this.output._storedValue=x,!this.scale.isConnected)return;const H={process:H=>{R.particleContext=H,R.systemContext=x,H.scale.p(this.scale.getConnectedValue(R))},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H}});(0,D.h)("BABYLON.UpdateAngleBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("angle",Nx.Float),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(R){const x=this.particle.getConnectedValue(R);if(this.output._storedValue=x,!this.angle.isConnected)return;const H={process:H=>{R.particleContext=H,R.systemContext=x,H.angle=this.angle.getConnectedValue(R)},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H}});(0,D.h)("BABYLON.BasicPositionUpdateBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(R){const x=this.particle.getConnectedValue(R),H={process:H=>{R.particleContext=H,R.systemContext=x,H.direction.scaleToRef(x._directionScale,x._scaledDirection),H.position.addInPlace(x._scaledDirection)},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H,this.output._storedValue=x}});(0,D.h)("BABYLON.BasicSpriteUpdateBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(R){const x=this.particle.getConnectedValue(R),H={process:H=>{R.particleContext=H,R.systemContext=x,H.updateCellIndex()},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H,this.output._storedValue=x}});(0,D.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("cellIndex",Nx.Int),this.registerOutput("output",Nx.Particle),this.cellIndex.acceptedConnectionPointTypes=[Nx.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(R){const x=this.particle.getConnectedValue(R);if(this.output._storedValue=x,!this.cellIndex.isConnected)return;const H={process:H=>{R.particleContext=H,R.systemContext=x,H.cellIndex=Math.floor(this.cellIndex.getConnectedValue(R))},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H}});class DH extends jx{constructor(R){super(R),this.strength=1,this.registerInput("particle",Nx.Particle),this.registerInput("flowMap",Nx.Texture),this.registerOutput("output",Nx.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(R){var x;const H=this.particle.getConnectedValue(R),k=R.Yk;let c;(null===(x=this.flowMap.connectedPoint)||void 0===x?void 0:x.ownerBlock).extractTextureContentAsync().then((R=>{R&&(c=new fx(R.width,R.height,R.data))}));const t={process:R=>{const x=k.getTransformMatrix();c&&c._processParticle(R,this.strength*H._tempScaledUpdateSpeed,x)},previousItem:null,nextItem:null};H._updateQueueStart?TR(t,H._updateQueueStart):H._updateQueueStart=t,this.output._storedValue=H}serialize(){const R=super.serialize();return R.strength=this.strength,R}_deserialize(R){super._deserialize(R),this.strength=R.strength}}(0,s.d)([mx("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DH.prototype,"strength",void 0),(0,D.h)("BABYLON.UpdateFlowMapBlock",DH);(0,D.h)("BABYLON.SphereShapeBlock",class extends jx{constructor(R){super(R),this.registerInput("input",Nx.Particle),this.registerInput("radius",Nx.Float,!0,1),this.registerInput("radiusRange",Nx.Float,!0,1,0,1),this.registerInput("directionRandomizer",Nx.Float,!0,0,0,1),this.registerOutput("output",Nx.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(R){const x=this.input.getConnectedValue(R);x._directionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.directionRandomizer.getConnectedValue(R),t=H.position.Pg(R.emitterPosition).normalize(),A=(0,J.RandomRange)(0,c),D=(0,J.RandomRange)(0,c),U=(0,J.RandomRange)(0,c);t.x+=A,t.y+=D,t.z+=U,t.normalize(),R.isEmitterTransformNode?k.o.TransformNormalFromFloatsToRef(A,D,U,R.emitterWorldMatrix,H.direction):H.direction.si(A,D,U)},x._positionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.radius.getConnectedValue(R),t=this.radiusRange.getConnectedValue(R),A=c-(0,J.RandomRange)(0,c*t),D=(0,J.RandomRange)(0,1),U=(0,J.RandomRange)(0,2*Math.PI),V=Math.acos(2*D-1),n=A*Math.cos(U)*Math.sin(V),g=A*Math.cos(V),I=A*Math.sin(U)*Math.sin(V);R.isEmitterTransformNode?k.o.TransformCoordinatesFromFloatsToRef(n,g,I,R.emitterWorldMatrix,H.position):(H.position.si(n,g,I),H.position.addInPlace(R.emitterPosition))},this.output._storedValue=x}});(0,D.h)("BABYLON.PointShapeBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("direction1",Nx.Bi,!0,new k.o(0,1,0)),this.registerInput("direction2",Nx.Bi,!0,new k.o(0,1,0)),this.registerOutput("output",Nx.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(R){const x=this.particle.getConnectedValue(R);x._directionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.direction1.getConnectedValue(R),t=this.direction2.getConnectedValue(R),A=(0,J.RandomRange)(c.x,t.x),D=(0,J.RandomRange)(c.y,t.y),U=(0,J.RandomRange)(c.z,t.z);R.isEmitterTransformNode?k.o.TransformNormalFromFloatsToRef(A,D,U,R.emitterWorldMatrix,H.direction):H.direction.si(A,D,U)},x._positionCreation.process=H=>{R.systemContext=x,R.isEmitterTransformNode?k.o.TransformCoordinatesFromFloatsToRef(0,0,0,R.emitterWorldMatrix,H.position):H.position.p(R.emitterPosition)},this.output._storedValue=x}});(0,D.h)("BABYLON.CustomShapeBlock",class extends jx{constructor(R){super(R),this.registerInput("particle",Nx.Particle),this.registerInput("position",Nx.Bi,!0,new k.o(0,0,0)),this.registerInput("direction",Nx.Bi,!0,new k.o(0,1,0)),this.registerOutput("output",Nx.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(R){const x=this.particle.getConnectedValue(R);x._directionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.direction.getConnectedValue(R);R.isEmitterTransformNode?k.o.TransformNormalToRef(c,R.emitterWorldMatrix,H.direction):H.direction.p(c)},x._positionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.position.getConnectedValue(R);R.isEmitterTransformNode?k.o.TransformCoordinatesToRef(c,R.emitterWorldMatrix,H.position):(H.position.p(c),H.position.addInPlace(R.emitterPosition))},this.output._storedValue=x}});(0,D.h)("BABYLON.CylinderShapeBlock",class extends jx{constructor(R){super(R),this._tempVector=k.o.Zero(),this.registerInput("particle",Nx.Particle),this.registerInput("radius",Nx.Float,!0,1),this.registerInput("height",Nx.Float,!0,1,0),this.registerInput("radiusRange",Nx.Float,!0,1,0,1),this.registerInput("directionRandomizer",Nx.Float,!0,0,0,1),this.registerOutput("output",Nx.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(R){const x=this.particle.getConnectedValue(R);x._directionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.directionRandomizer.getConnectedValue(R);H.position.subtractToRef(R.emitterPosition,this._tempVector),this._tempVector.normalize(),R.isEmitterTransformNode&&k.o.TransformNormalToRef(this._tempVector,R.emitterInverseWorldMatrix,this._tempVector);const t=(0,J.RandomRange)(-c/2,c/2);let A=Math.atan2(this._tempVector.x,this._tempVector.z);A+=(0,J.RandomRange)(-Math.PI/2,Math.PI/2)*c,this._tempVector.y=t,this._tempVector.x=Math.sin(A),this._tempVector.z=Math.cos(A),this._tempVector.normalize(),R.isEmitterTransformNode?k.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,R.emitterWorldMatrix,H.direction):H.direction.p(this._tempVector)},x._positionCreation.process=H=>{R.particleContext=H,R.systemContext=x;const c=this.height.getConnectedValue(R),t=this.radiusRange.getConnectedValue(R),A=this.radius.getConnectedValue(R),D=(0,J.RandomRange)(-c/2,c/2),U=(0,J.RandomRange)(0,2*Math.PI),V=(0,J.RandomRange)((1-t)*(1-t),1),n=Math.sqrt(V)*A,g=n*Math.cos(U),I=n*Math.sin(U);R.isEmitterTransformNode?k.o.TransformCoordinatesFromFloatsToRef(g,D,I,R.emitterWorldMatrix,H.position):(H.position.si(g,D,I),H.position.addInPlace(R.emitterPosition))},this.output._storedValue=x}});class UH extends jx{constructor(R){super(R),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Nx.Particle),this.registerOutput("output",Nx.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){super._build(R);const x=this.particle.getConnectedValue(R);x._isAnimationSheetEnabled=!0,x.spriteCellWidth=this.width,x.spriteCellHeight=this.height,x.startSpriteCellID=this.start,x.endSpriteCellID=this.end,x.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=x}serialize(){const R=super.serialize();return R.width=this.width,R.height=this.height,R.start=this.start,R.end=this.end,R.randomStartCell=this.randomStartCell,R}_deserialize(R){super._deserialize(R),this.width=R.width,this.height=R.height,this.start=R.start,this.end=R.end,this.randomStartCell=R.randomStartCell}}(0,s.d)([mx("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UH.prototype,"start",void 0),(0,s.d)([mx("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UH.prototype,"end",void 0),(0,s.d)([mx("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UH.prototype,"width",void 0),(0,s.d)([mx("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UH.prototype,"height",void 0),(0,s.d)([mx("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UH.prototype,"loop",void 0),(0,s.d)([mx("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UH.prototype,"randomStartCell",void 0),(0,D.h)("BABYLON.SetupSpriteSheetBlock",UH);class JH extends jx{constructor(R){super(R),this.reference=0,this.registerInput("value",Nx.AutoDetect),this.registerOutput("output",Nx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=R=>{switch(R){case Nx.Float:return Nx.FloatGradient;case Nx.Vector2:return Nx.Vector2Gradient;case Nx.Bi:return Nx.Vector3Gradient;case Nx.gj:return Nx.Color4Gradient}return R},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nx.Float|Nx.Vector2|Nx.Bi|Nx.gj)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=R=>null}serialize(){const R=super.serialize();return R.reference=this.reference,R}_deserialize(R){super._deserialize(R),this.reference=R.reference}}(0,s.d)([mx("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],JH.prototype,"reference",void 0),(0,D.h)("BABYLON.ParticleGradientValueBlock",JH);(0,D.h)("BABYLON.ParticleGradientBlock",class extends jx{constructor(R){super(R),this._entryCount=1,this.registerInput("gradient",Nx.Float,!0,1,0,1),this.registerInput("value0",Nx.AutoDetect),this.registerOutput("output",Nx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=R=>{switch(R){case Nx.FloatGradient:return Nx.Float;case Nx.Vector2Gradient:return Nx.Vector2;case Nx.Vector3Gradient:return Nx.Bi;case Nx.Color4Gradient:return Nx.gj}return R},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Nx.FloatGradient|Nx.Vector2Gradient|Nx.Vector3Gradient|Nx.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(R){this._inputs[R].onConnectionObservable.add((()=>{this._entryCount>R||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Nx.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const R=[];for(let H=1;H<this._inputs.length;H++){var x;if(this._inputs[H].isConnected)R.push(null===(x=this._inputs[H].connectedPoint)||void 0===x?void 0:x.ownerBlock)}R.sort(((R,x)=>R.reference-x.reference)),this.output._storedFunction=x=>{const H=this.gradient.getConnectedValue(x);if(1===R.length)return R[0].value.getConnectedValue(x);let c=null;for(let t=R.length-1;t>=0;t--){const D=R[t];if(D.reference<=H){const R=D.value.getConnectedValue(x);if(c){const t=c.value.getConnectedValue(x),U=c.reference,V=D.reference,n=Math.max(0,Math.min(1,(H-V)/(U-V)));switch(this.output.type){case Nx.Float:return(0,J.Lerp)(R,t,n);case Nx.Vector2:return k.k.Lerp(R,t,n);case Nx.Bi:return k.o.Lerp(R,t,n);case Nx.gj:return A.d.Lerp(R,t,n)}}return R}c=D}return 0}}});(0,D.h)("BABYLON.ParticleConverterBlock",class extends jx{constructor(R){super(R),this.registerInput("color ",Nx.gj,!0),this.registerInput("xyz ",Nx.Bi,!0),this.registerInput("xy ",Nx.Vector2,!0),this.registerInput("zw ",Nx.Vector2,!0),this.registerInput("x ",Nx.Float,!0),this.registerInput("y ",Nx.Float,!0),this.registerInput("z ",Nx.Float,!0),this.registerInput("w ",Nx.Float,!0),this.registerOutput("color",Nx.gj),this.registerOutput("xyz",Nx.Bi),this.registerOutput("xy",Nx.Vector2),this.registerOutput("zw",Nx.Vector2),this.registerOutput("x",Nx.Float),this.registerOutput("y",Nx.Float),this.registerOutput("z",Nx.Float),this.registerOutput("w",Nx.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(R){return"color "===R?"colorIn":"xyz "===R?"xyzIn":"xy "===R?"xyIn":"zw "===R?"zwIn":"x "===R?"xIn":"y "===R?"yIn":"z "===R?"zIn":"w "===R?"wIn":R}_outputRename(R){switch(R){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return R}}_build(R){super._build(R);const x=this.xIn,H=this.yIn,c=this.zIn,t=this.wIn,D=this.xyIn,U=this.zwIn,J=this.xyzIn,V=this.colorIn,n=this.colorOut,g=this.xyzOut,I=this.xyOut,i=this.zwOut,q=this.xOut,S=this.yOut,L=this.zOut,b=this.wOut,C=R=>{if(V.isConnected)return V.getConnectedValue(R);let k=0,n=0,g=0,I=0;if(x.isConnected&&(k=x.getConnectedValue(R)),H.isConnected&&(n=H.getConnectedValue(R)),c.isConnected&&(g=c.getConnectedValue(R)),t.isConnected&&(I=t.getConnectedValue(R)),D.isConnected){const x=D.getConnectedValue(R);x&&(k=x.x,n=x.y)}if(U.isConnected){const x=U.getConnectedValue(R);x&&(g=x.x,I=x.y)}if(J.isConnected){const x=J.getConnectedValue(R);x&&(k=x.x,n=x.y,g=x.z)}return new A.d(k,n,g,I)};n._storedFunction=R=>C(R),g._storedFunction=R=>{const x=C(R);return new k.o(x.r,x.g,x.b)},I._storedFunction=R=>{const x=C(R);return new k.k(x.r,x.g)},i._storedFunction=R=>{const x=C(R);return new k.k(x.b,x.a)},q._storedFunction=R=>C(R).r,S._storedFunction=R=>C(R).g,L._storedFunction=R=>C(R).b,b._storedFunction=R=>C(R).a}}),function(R){R[R.Cos=0]="Cos",R[R.Sin=1]="Sin",R[R.Abs=2]="Abs",R[R.Exp=3]="Exp",R[R.Exp2=4]="Exp2",R[R.Round=5]="Round",R[R.Floor=6]="Floor",R[R.Ceiling=7]="Ceiling",R[R.Sqrt=8]="Sqrt",R[R.Log=9]="Log",R[R.Tan=10]="Tan",R[R.ArcTan=11]="ArcTan",R[R.ArcCos=12]="ArcCos",R[R.ArcSin=13]="ArcSin",R[R.Sign=14]="Sign",R[R.Negate=15]="Negate",R[R.OneMinus=16]="OneMinus",R[R.Reciprocal=17]="Reciprocal",R[R.ToDegrees=18]="ToDegrees",R[R.ToRadians=19]="ToRadians",R[R.Fract=20]="Fract"}(rx||(rx={}));class VH extends jx{constructor(R){super(R),this.operation=rx.Cos,this.registerInput("input",Nx.AutoDetect),this.registerOutput("output",Nx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nx.Float|Nx.Int|Nx.Vector2|Nx.Bi|Nx.gj)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){super._build(R);let x=null;switch(this.operation){case rx.Cos:x=R=>Math.cos(R);break;case rx.Sin:x=R=>Math.sin(R);break;case rx.Abs:x=R=>Math.abs(R);break;case rx.Exp:x=R=>Math.exp(R);break;case rx.Exp2:x=R=>Math.pow(2,R);break;case rx.Round:x=R=>Math.round(R);break;case rx.Floor:x=R=>Math.floor(R);break;case rx.Ceiling:x=R=>Math.ceil(R);break;case rx.Sqrt:x=R=>Math.sqrt(R);break;case rx.Log:x=R=>Math.log(R);break;case rx.Tan:x=R=>Math.tan(R);break;case rx.ArcTan:x=R=>Math.atan(R);break;case rx.ArcCos:x=R=>Math.acos(R);break;case rx.ArcSin:x=R=>Math.asin(R);break;case rx.Sign:x=R=>Math.sign(R);break;case rx.Negate:x=R=>-R;break;case rx.OneMinus:x=R=>1-R;break;case rx.Reciprocal:x=R=>1/R;break;case rx.ToRadians:x=R=>R*Math.PI/180;break;case rx.ToDegrees:x=R=>180*R/Math.PI;break;case rx.Fract:x=R=>R>=0?R-Math.floor(R):R-Math.ceil(R)}if(!x)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Nx.Int:case Nx.Float:this.output._storedFunction=R=>{const H=this.input.getConnectedValue(R);return x(H)};break;case Nx.Vector2:this.output._storedFunction=R=>{const H=this.input.getConnectedValue(R);return new k.k(x(H.x),x(H.y))};break;case Nx.Bi:this.output._storedFunction=R=>{const H=this.input.getConnectedValue(R);return new k.o(x(H.x),x(H.y),x(H.z))};break;case Nx.gj:this.output._storedFunction=R=>{const H=this.input.getConnectedValue(R);return new A.d(x(H.r),x(H.g),x(H.b),x(H.a))}}return this}serialize(){const R=super.serialize();return R.operation=this.operation,R}_deserialize(R){super._deserialize(R),this.operation=R.operation}}(0,s.d)([mx("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:rx.Cos},{label:"Sin",value:rx.Sin},{label:"Abs",value:rx.Abs},{label:"Exp",value:rx.Exp},{label:"Exp2",value:rx.Exp2},{label:"Round",value:rx.Round},{label:"Floor",value:rx.Floor},{label:"Ceiling",value:rx.Ceiling},{label:"Sqrt",value:rx.Sqrt},{label:"Log",value:rx.Log},{label:"Tan",value:rx.Tan},{label:"ArcTan",value:rx.ArcTan},{label:"ArcCos",value:rx.ArcCos},{label:"ArcSin",value:rx.ArcSin},{label:"Sign",value:rx.Sign},{label:"Negate",value:rx.Negate},{label:"OneMinus",value:rx.OneMinus},{label:"Reciprocal",value:rx.Reciprocal},{label:"ToDegrees",value:rx.ToDegrees},{label:"ToRadians",value:rx.ToRadians},{label:"Fract",value:rx.Fract}]})],VH.prototype,"operation",void 0),(0,D.h)("BABYLON.ParticleTrigonometryBlock",VH);var nH,gH=H(12945);class IH extends jx{constructor(R){super(R),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Nx.AutoDetect),this.registerOutput("output",Nx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Nx.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Nx.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Nx.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Nx.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Nx.System),this._inputs[0].excludedConnectionPointTypes.push(Nx.Particle),this._inputs[0].excludedConnectionPointTypes.push(Nx.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const x=R=>{const x=this.input.getConnectedValue(R);if(this.log.length>=this.stackSize)return x;if(null===x||void 0===x)return this.log.push(["null",""]),x;switch(this.input.type){case Nx.Vector2:this.log.push([(0,gH.g)(x,4),x.toString()]);break;case Nx.Bi:this.log.push([(0,gH.j)(x,4),x.toString()]);break;case Nx.gj:this.log.push([`{R: ${x.r.toFixed(4)} G: ${x.g.toFixed(4)} B: ${x.b.toFixed(4)} A: ${x.a.toFixed(4)}}`,x.toString()]);break;default:this.log.push([x.toString(),x.toString()])}return x};this.output.isConnected?this.output._storedFunction=x:this.output._storedValue=x(R)}serialize(){const R=super.serialize();return R.stackSize=this.stackSize,R}_deserialize(R){super._deserialize(R),this.stackSize=R.stackSize}}(0,s.d)([mx("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],IH.prototype,"stackSize",void 0),(0,D.h)("BABYLON.ParticleDebugBlock",IH);(0,D.h)("BABYLON.ParticleElbowBlock",class extends jx{constructor(R){super(R),this.registerInput("input",Nx.AutoDetect),this.registerOutput("output",Nx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(R){super._build(R);const x=this._outputs[0],H=this._inputs[0];x._storedFunction=R=>H.getConnectedValue(R)}});(0,D.h)("BABYLON.ParticleTeleportInBlock",class extends jx{get endpoints(){return this._endpoints}constructor(R){super(R),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Nx.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(R){if(this.getClassName()===R)return!0;for(const x of this.endpoints)if(x.isAnAncestorOfType(R))return!0;return!1}isAnAncestorOf(R){for(const x of this.endpoints){if(x===R)return!0;if(x.isAnAncestorOf(R))return!0}return!1}attachToEndpoint(R){R.detach(),this._endpoints.push(R),R._entryPoint=this,R._outputs[0]._typeConnectionSource=this._inputs[0],R._tempEntryPointUniqueId=null,R.name="> "+this.name}detachFromEndpoint(R){const x=this._endpoints.indexOf(R);-1!==x&&(this._endpoints.splice(x,1),R._outputs[0]._typeConnectionSource=null,R._entryPoint=null)}_build(){for(const R of this._endpoints)R.output._storedFunction=R=>this.input.getConnectedValue(R)}});(0,D.h)("BABYLON.ParticleTeleportOutBlock",class extends jx{constructor(R){super(R),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Nx.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(R){this.entryPoint&&this.entryPoint.build(R)}clone(){const R=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(R),R}serialize(){var R;const x=super.serialize();return x.entryPoint=(null===(R=this.entryPoint)||void 0===R?void 0:R.uniqueId)??"",x}_deserialize(R){super._deserialize(R),this._tempEntryPointUniqueId=R.entryPoint}}),function(R){R[R.Equal=0]="Equal",R[R.NotEqual=1]="NotEqual",R[R.LessThan=2]="LessThan",R[R.GreaterThan=3]="GreaterThan",R[R.LessOrEqual=4]="LessOrEqual",R[R.GreaterOrEqual=5]="GreaterOrEqual",R[R.Xor=6]="Xor",R[R.Or=7]="Or",R[R.And=8]="And"}(nH||(nH={}));class iH extends jx{constructor(R){super(R),this.test=nH.Equal,this.epsilon=0,this.registerInput("left",Nx.Float),this.registerInput("right",Nx.Float,!0,0),this.registerInput("ifTrue",Nx.AutoDetect,!0,1),this.registerInput("ifFalse",Nx.AutoDetect,!0,0),this.registerOutput("output",Nx.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Nx.Float,this._inputs[0].acceptedConnectionPointTypes.push(Nx.Int),this._inputs[1].acceptedConnectionPointTypes.push(Nx.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const R=R=>{const x=this.left.getConnectedValue(R),H=this.right.getConnectedValue(R);let k=!1;switch(this.test){case nH.Equal:k=(0,J.WithinEpsilon)(x,H,this.epsilon);break;case nH.NotEqual:k=!(0,J.WithinEpsilon)(x,H,this.epsilon);break;case nH.LessThan:k=x<H+this.epsilon;break;case nH.GreaterThan:k=x>H-this.epsilon;break;case nH.LessOrEqual:k=x<=H+this.epsilon;break;case nH.GreaterOrEqual:k=x>=H-this.epsilon;break;case nH.Xor:k=!!x&&!H||!x&&!!H;break;case nH.Or:k=!!x||!!H;break;case nH.And:k=!!x&&!!H}return k};this.output._storedFunction=x=>R(x)?this.ifTrue.getConnectedValue(x):this.ifFalse.getConnectedValue(x)}serialize(){const R=super.serialize();return R.test=this.test,R.epsilon=this.epsilon,R}_deserialize(R){super._deserialize(R),this.test=R.test,void 0!==R.epsilon&&(this.epsilon=R.epsilon)}}(0,s.d)([mx("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:nH.Equal},{label:"NotEqual",value:nH.NotEqual},{label:"LessThan",value:nH.LessThan},{label:"GreaterThan",value:nH.GreaterThan},{label:"LessOrEqual",value:nH.LessOrEqual},{label:"GreaterOrEqual",value:nH.GreaterOrEqual},{label:"Xor",value:nH.Xor},{label:"Or",value:nH.Or},{label:"And",value:nH.And}]})],iH.prototype,"test",void 0),(0,s.d)([mx("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],iH.prototype,"epsilon",void 0),(0,D.h)("BABYLON.ParticleConditionBlock",iH);class qH extends jx{constructor(R){super(R),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Nx.Particle),this.registerInput("condition",Nx.Float,!0,0),this.registerInput("system",Nx.System),this.registerOutput("output",Nx.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(R){this._triggerCount=0;const x=this.input.getConnectedValue(R),H={process:H=>{if(R.particleContext=H,R.systemContext=x,0!==this.condition.getConnectedValue(R)&&(0===this.limit||this._triggerCount<this.limit)){const k=(new Date).getTime();if(this._previousOne&&k-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=k;const c=this.system.getConnectedValue(R);if(c){const k=lx(c,R.Yk,H.position);k.Vi.addOnce((()=>{this._triggerCount--})),x.Vi.addOnce((()=>{k.dispose()}))}}},previousItem:null,nextItem:null};x._updateQueueStart?TR(H,x._updateQueueStart):x._updateQueueStart=H,this.output._storedValue=x}serialize(){const R=super.serialize();return R.limit=this.limit,R.delay=this.delay,R}_deserialize(R){super._deserialize(R),void 0!==R.limit&&(this.limit=R.limit),void 0!==R.delay&&(this.delay=R.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,s.d)([mx("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qH.prototype,"limit",void 0),(0,s.d)([mx("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qH.prototype,"delay",void 0),(0,D.h)("BABYLON.ParticleTriggerBlock",qH);H(12953),H(12962),H(12977),H(13040)},13020:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},12986:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13052:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneVertex",t="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13043:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13034:(R,x,H)=>{"use strict";var k=H(565);const c="fogFragment",t="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13015:(R,x,H)=>{"use strict";var k=H(565);const c="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13060:(R,x,H)=>{"use strict";var k=H(565);const c="fogVertex",t="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13046:(R,x,H)=>{"use strict";var k=H(565);const c="fogVertexDeclaration",t="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13005:(R,x,H)=>{"use strict";var k=H(565);const c="helperFunctions",t="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},12992:(R,x,H)=>{"use strict";var k=H(565);const c="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13009:(R,x,H)=>{"use strict";var k=H(565);const c="imageProcessingFunctions",t="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13e3:(R,x,H)=>{"use strict";var k=H(565);const c="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13028:(R,x,H)=>{"use strict";var k=H(565);const c="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},13068:(R,x,H)=>{"use strict";var k=H(565);const c="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";k.e.IncludesShadersStoreWGSL[c]||(k.e.IncludesShadersStoreWGSL[c]=t)},12977:(R,x,H)=>{"use strict";H.r(x),H.d(x,{particlesPixelShaderWGSL:()=>A});var k=H(565);H(12986),H(12992),H(13e3),H(13005),H(13009),H(13015),H(13020),H(13028),H(13034);const c="particlesPixelShader",t="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";k.e.ShadersStoreWGSL[c]||(k.e.ShadersStoreWGSL[c]=t);const A={name:c,shader:t}},13040:(R,x,H)=>{"use strict";H.r(x),H.d(x,{particlesVertexShaderWGSL:()=>A});var k=H(565);H(13043),H(13046),H(13e3),H(13052),H(13060),H(13068);const c="particlesVertexShader",t="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";k.e.ShadersStoreWGSL[c]||(k.e.ShadersStoreWGSL[c]=t);const A={name:c,shader:t}},12880:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12955:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12910:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneVertex",t="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12969:(R,x,H)=>{"use strict";var k=H(565);const c="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12892:(R,x,H)=>{"use strict";var k=H(565);const c="fogFragment",t="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12877:(R,x,H)=>{"use strict";var k=H(565);const c="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12913:(R,x,H)=>{"use strict";var k=H(565);const c="fogVertex",t="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12901:(R,x,H)=>{"use strict";var k=H(565);const c="fogVertexDeclaration",t="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12862:(R,x,H)=>{"use strict";var k=H(565);const c="helperFunctions",t="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12855:(R,x,H)=>{"use strict";var k=H(565);const c="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12870:(R,x,H)=>{"use strict";var k=H(565);const c="imageProcessingFunctions",t="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12858:(R,x,H)=>{"use strict";var k=H(565);const c="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12886:(R,x,H)=>{"use strict";var k=H(565);const c="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12919:(R,x,H)=>{"use strict";var k=H(565);const c="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";k.e.IncludesShadersStore[c]||(k.e.IncludesShadersStore[c]=t)},12953:(R,x,H)=>{"use strict";H.r(x),H.d(x,{particlesPixelShader:()=>A});var k=H(565);H(12955),H(12855),H(12858),H(12862),H(12870),H(12877),H(12880),H(12886),H(12892);const c="particlesPixelShader",t="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";k.e.ShadersStore[c]||(k.e.ShadersStore[c]=t);const A={name:c,shader:t}},12962:(R,x,H)=>{"use strict";H.r(x),H.d(x,{particlesVertexShader:()=>A});var k=H(565);H(12969),H(12901),H(12858),H(12910),H(12913),H(12919);const c="particlesVertexShader",t="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";k.e.ShadersStore[c]||(k.e.ShadersStore[c]=t);const A={name:c,shader:t}},13306:(R,x,H)=>{"use strict";H.r(x),H.d(x,{FlowGraphGLTFDataProvider:()=>t});var k=H(13268),c=H(13246);class t extends k.b{constructor(R){var x,H;super();const k=R.glTF,t=(null===(x=k.animations)||void 0===x?void 0:x.map((R=>R._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",c.b,t);const A=(null===(H=k.nodes)||void 0===H?void 0:H.map((R=>R._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",c.b,A)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13204:(R,x,H)=>{"use strict";H.d(x,{b:()=>S,e:()=>i,g:()=>I,j:()=>q});var k=H(661),c=H(12251),t=H(695),A=H(13207);const D=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class U{constructor(R,x){this._gltf=R,this._infoTree=x}convert(R){let x,H=this._gltf,k=this._infoTree;if(!R.startsWith("/"))throw new Error("Path must start with a /");const c=R.split("/");if(c.shift(),c[c.length-1].includes(".length")){const R=c[c.length-1].split(".");c.pop(),c.push(...R)}let t=!1;for(const U of c){const c="length"===U;if(c&&!k.__array__)throw new Error(`Path ${R} is invalid`);if(k.__ignoreObjectTree__&&(t=!0),k.__array__&&!c)k=k.__array__;else if(k=k[U],!k)throw new Error(`Path ${R} is invalid`);if(!t)if(void 0===H){if(!D.find((x=>x.regex.test(R))))throw new Error(`Path ${R} is invalid`)}else if(!c){var A;H=null===(A=H)||void 0===A?void 0:A[U]}(k.__target__||c)&&(x=H)}return{object:x,info:k}}}function J(R,x,H,k){const c=V(R,x);return k?c[H][k]:c[H]}function V(R,x,H){var k,t;return null===(k=R._data)||void 0===k||null===(t=k[(null===H||void 0===H?void 0:H.fillMode)??c.d.MATERIAL_TriangleFillMode])||void 0===t?void 0:t.babylonMaterial}function n(R,x){return{offset:{componentsCount:2,type:"Vector2",get:(H,c,t)=>{const A=J(H,t,R,x);return new k.k(null===A||void 0===A?void 0:A.uOffset,null===A||void 0===A?void 0:A.vOffset)},getTarget:V,set:(H,k,c,t)=>{const A=J(k,t,R,x);A.uOffset=H.x,A.vOffset=H.y},getPropertyName:[()=>`${R}${x?"."+x:""}.uOffset`,()=>`${R}${x?"."+x:""}.vOffset`]},rotation:{type:"number",get:(H,k,c)=>{var t;return null===(t=J(H,c,R,x))||void 0===t?void 0:t.wAng},getTarget:V,set:(H,k,c,t)=>J(k,t,R,x).wAng=H,getPropertyName:[()=>`${R}${x?"."+x:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(H,c,t)=>{const A=J(H,t,R,x);return new k.k(null===A||void 0===A?void 0:A.uScale,null===A||void 0===A?void 0:A.vScale)},getTarget:V,set:(H,k,c,t)=>{const A=J(k,t,R,x);A.uScale=H.x,A.vScale=H.y},getPropertyName:[()=>`${R}${x?"."+x:""}.uScale`,()=>`${R}${x?"."+x:""}.vScale`]}}}const g={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:R=>{var x,H;return new k.k((null===(x=R._babylonCamera)||void 0===x?void 0:x.orthoLeft)??0,(null===(H=R._babylonCamera)||void 0===H?void 0:H.orthoRight)??0)},set:(R,x)=>{x._babylonCamera&&(x._babylonCamera.orthoLeft=R.x,x._babylonCamera.orthoRight=R.y)},getTarget:R=>R,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:R=>{var x,H;return new k.k((null===(x=R._babylonCamera)||void 0===x?void 0:x.orthoBottom)??0,(null===(H=R._babylonCamera)||void 0===H?void 0:H.orthoTop)??0)},set:(R,x)=>{x._babylonCamera&&(x._babylonCamera.orthoBottom=R.x,x._babylonCamera.orthoTop=R.y)},getTarget:R=>R,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:R=>{var x;return null===(x=R._babylonCamera)||void 0===x?void 0:x.maxZ},set:(R,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=R)},getTarget:R=>R,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:R=>{var x;return null===(x=R._babylonCamera)||void 0===x?void 0:x.Hi},set:(R,x)=>{x._babylonCamera&&(x._babylonCamera.Hi=R)},getTarget:R=>R,getPropertyName:[()=>"Hi"]}},perspective:{aspectRatio:{type:"number",get:R=>{var x;return null===(x=R._babylonCamera)||void 0===x?void 0:x.getEngine().getAspectRatio(R._babylonCamera)},getTarget:R=>R,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:R=>{var x;return null===(x=R._babylonCamera)||void 0===x?void 0:x.fov},set:(R,x)=>{x._babylonCamera&&(x._babylonCamera.fov=R)},getTarget:R=>R,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:R=>{var x;return null===(x=R._babylonCamera)||void 0===x?void 0:x.maxZ},set:(R,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=R)},getTarget:R=>R,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:R=>{var x;return null===(x=R._babylonCamera)||void 0===x?void 0:x.Hi},set:(R,x)=>{x._babylonCamera&&(x._babylonCamera.Hi=R)},getTarget:R=>R,getPropertyName:[()=>"Hi"]}}}},nodes:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Bi",get:R=>{var x;return null===(x=R._babylonTransformNode)||void 0===x?void 0:x.position},set:(R,x)=>{var H;return null===(H=x._babylonTransformNode)||void 0===H?void 0:H.position.p(R)},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:R=>{var x;return null===(x=R._babylonTransformNode)||void 0===x?void 0:x.rotationQuaternion},set:(R,x)=>{var H,k;return null===(H=x._babylonTransformNode)||void 0===H||null===(k=H.rotationQuaternion)||void 0===k?void 0:k.p(R)},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Bi",get:R=>{var x;return null===(x=R._babylonTransformNode)||void 0===x?void 0:x.ti},set:(R,x)=>{var H;return null===(H=x._babylonTransformNode)||void 0===H?void 0:H.ti.p(R)},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"ti"]},weights:{length:{type:"number",get:R=>R._numMorphTargets,getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(R,x)=>{var H,k;return void 0!==x?null===(H=R._primitiveBabylonMeshes)||void 0===H||null===(k=H[0].morphTargetManager)||void 0===k?void 0:k.getTarget(x).influence:void 0},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(R,x)=>[0],getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:R=>{var x,H,c;return k.e.Compose(null===(x=R._babylonTransformNode)||void 0===x?void 0:x.ti,null===(H=R._babylonTransformNode)||void 0===H?void 0:H.rotationQuaternion,null===(c=R._babylonTransformNode)||void 0===c?void 0:c.position)},getTarget:R=>R._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:R=>{var x,H,c,t;const A=k.e.Identity();let D=R.parent;for(;D&&D.parent;)D=D.parent;const U=(null===(x=R._babylonTransformNode)||void 0===x?void 0:x.position._isDirty)||(null===(H=R._babylonTransformNode)||void 0===H||null===(c=H.rotationQuaternion)||void 0===c?void 0:c._isDirty)||(null===(t=R._babylonTransformNode)||void 0===t?void 0:t.ti._isDirty);if(D){var J;const x=null===(J=D._babylonTransformNode)||void 0===J?void 0:J.Fi(!0).invert();var V,n;if(x)null===(V=R._babylonTransformNode)||void 0===V||null===(n=V.Fi(U))||void 0===n||n.multiplyToRef(x,A)}else R._babylonTransformNode&&A.p(R._babylonTransformNode.Fi(U));return A},getTarget:R=>R._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:R=>{var x,H;return null===(x=R._babylonTransformNode)||void 0===x||null===(H=x.getChildren((R=>R instanceof A.c),!0)[0])||void 0===H?void 0:H.bb},getTarget:R=>{var x;return null===(x=R._babylonTransformNode)||void 0===x?void 0:x.getChildren((R=>R instanceof A.c),!0)[0]},set:(R,x)=>{if(x._babylonTransformNode){const H=x._babylonTransformNode.getChildren((R=>R instanceof A.c),!0)[0];H&&(H.bb=R)}}},color:{type:"fj",get:R=>{var x,H;return null===(x=R._babylonTransformNode)||void 0===x||null===(H=x.getChildren((R=>R instanceof A.c),!0)[0])||void 0===H?void 0:H.cb},getTarget:R=>{var x;return null===(x=R._babylonTransformNode)||void 0===x?void 0:x.getChildren((R=>R instanceof A.c),!0)[0]},set:(R,x)=>{if(x._babylonTransformNode){const H=x._babylonTransformNode.getChildren((R=>R instanceof A.c),!0)[0];H&&(H.cb=R)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"fj",get:(R,x,H)=>V(R,x,H).emissiveColor,set:(R,x,H,k)=>V(x,H,k).emissiveColor.p(R),getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:n("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(R,x,H)=>{var k;return null===(k=J(R,H,"bumpTexture"))||void 0===k?void 0:k.level},set:(R,x,H,k)=>{const c=J(x,k,"bumpTexture");c&&(c.level=R)},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:n("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(R,x,H)=>V(R,x,H).ambientTextureStrength,set:(R,x,H,k)=>{const c=V(x,H,k);c&&(c.ambientTextureStrength=R)},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:n("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"gj",get:(R,x,H)=>{const k=V(R,x,H);return t.d.FromColor3(k.albedoColor,k.alpha)},set:(R,x,H,k)=>{const c=V(x,H,k);c.albedoColor.set(R.r,R.g,R.b),c.alpha=R.a},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:n("albedoTexture")}},metallicFactor:{type:"number",get:(R,x,H)=>V(R,x,H).metallic,set:(R,x,H,k)=>{const c=V(x,H,k);c&&(c.metallic=R)},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(R,x,H)=>V(R,x,H).roughness,set:(R,x,H,k)=>{const c=V(x,H,k);c&&(c.roughness=R)},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:n("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(R,x,H)=>V(R,x,H).anisotropy.bb,set:(R,x,H,k)=>{V(x,H,k).anisotropy.bb=R},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(R,x,H)=>V(R,x,H).anisotropy.angle,set:(R,x,H,k)=>{V(x,H,k).anisotropy.angle=R},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:n("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(R,x,H)=>V(R,x,H).clearCoat.bb,set:(R,x,H,k)=>{V(x,H,k).clearCoat.bb=R},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(R,x,H)=>V(R,x,H).clearCoat.roughness,set:(R,x,H,k)=>{V(x,H,k).clearCoat.roughness=R},getTarget:(R,x,H)=>V(R,x,H),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:n("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(R,x,H)=>{var k;return null===(k=V(R,x,H).clearCoat.bumpTexture)||void 0===k?void 0:k.level},getTarget:V,set:(R,x,H,k)=>V(x,H,k).clearCoat.bumpTexture.level=R},extensions:{KHR_texture_transform:n("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:n("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(R,x,H)=>V(R,x,H).subSurface.dispersion,getTarget:V,set:(R,x,H,k)=>V(x,H,k).subSurface.dispersion=R}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(R,x,H)=>V(R,x,H).emissiveIntensity,getTarget:V,set:(R,x,H,k)=>V(x,H,k).emissiveIntensity=R}},KHR_materials_ior:{ior:{type:"number",get:(R,x,H)=>V(R,x,H).indexOfRefraction,getTarget:V,set:(R,x,H,k)=>V(x,H,k).indexOfRefraction=R}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(R,x,H)=>V(R,x,H).iridescence.bb,getTarget:V,set:(R,x,H,k)=>V(x,H,k).iridescence.bb=R},iridescenceIor:{type:"number",get:(R,x,H)=>V(R,x,H).iridescence.indexOfRefraction,getTarget:V,set:(R,x,H,k)=>V(x,H,k).iridescence.indexOfRefraction=R},iridescenceTexture:{extensions:{KHR_texture_transform:n("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(R,x,H)=>V(R,x,H).iridescence.maximumThickness,getTarget:V,set:(R,x,H,k)=>V(x,H,k).iridescence.maximumThickness=R},iridescenceThicknessMinimum:{type:"number",get:(R,x,H)=>V(R,x,H).iridescence.minimumThickness,getTarget:V,set:(R,x,H,k)=>V(x,H,k).iridescence.minimumThickness=R},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:n("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"fj",get:(R,x,H)=>V(R,x,H).sheen.color,getTarget:V,set:(R,x,H,k)=>V(x,H,k).sheen.color.p(R)},sheenColorTexture:{extensions:{KHR_texture_transform:n("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(R,x,H)=>V(R,x,H).sheen.bb,getTarget:V,set:(R,x,H,k)=>V(x,H,k).sheen.bb=R},sheenRoughnessTexture:{extensions:{KHR_texture_transform:n("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(R,x,H)=>V(R,x,H).metallicF0Factor,getTarget:V,set:(R,x,H,k)=>V(x,H,k).metallicF0Factor=R,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"fj",get:(R,x,H)=>V(R,x,H).metallicReflectanceColor,getTarget:V,set:(R,x,H,k)=>V(x,H,k).metallicReflectanceColor.p(R),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:n("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:n("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(R,x,H)=>V(R,x,H).subSurface.refractionIntensity,getTarget:V,set:(R,x,H,k)=>V(x,H,k).subSurface.refractionIntensity=R,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:n("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(R,x,H)=>V(R,x,H).subSurface.translucencyIntensity,getTarget:V,set:(R,x,H,k)=>V(x,H,k).subSurface.translucencyIntensity=R},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:n("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"fj",get:(R,x,H)=>V(R,x,H).subSurface.translucencyColor,getTarget:V,set:(R,x,H,k)=>{var c;return R&&(null===(c=V(x,H,k).subSurface.translucencyColor)||void 0===c?void 0:c.p(R))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:n("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"fj",get:(R,x,H)=>V(R,x,H).subSurface.tintColor,getTarget:V,set:(R,x,H,k)=>V(x,H,k).subSurface.tintColor.p(R)},attenuationDistance:{type:"number",get:(R,x,H)=>V(R,x,H).subSurface.tintColorAtDistance,getTarget:V,set:(R,x,H,k)=>V(x,H,k).subSurface.tintColorAtDistance=R},thicknessFactor:{type:"number",get:(R,x,H)=>V(R,x,H).subSurface.maximumThickness,getTarget:V,set:(R,x,H,k)=>V(x,H,k).subSurface.maximumThickness=R},thicknessTexture:{extensions:{KHR_texture_transform:n("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonLight)),getPropertyName:[R=>"length"]},__array__:{__target__:!0,color:{type:"fj",get:R=>{var x;return null===(x=R._babylonLight)||void 0===x?void 0:x.cb},set:(R,x)=>{var H;return null===(H=x._babylonLight)||void 0===H?void 0:H.cb.p(R)},getTarget:R=>R._babylonLight,getPropertyName:[R=>"diffuse"]},bb:{type:"number",get:R=>{var x;return null===(x=R._babylonLight)||void 0===x?void 0:x.bb},set:(R,x)=>x._babylonLight?x._babylonLight.bb=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"intensity"]},range:{type:"number",get:R=>{var x;return null===(x=R._babylonLight)||void 0===x?void 0:x.range},set:(R,x)=>x._babylonLight?x._babylonLight.range=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"range"]},spot:{innerConeAngle:{type:"number",get:R=>{var x;return null===(x=R._babylonLight)||void 0===x?void 0:x.innerAngle},set:(R,x)=>x._babylonLight?x._babylonLight.innerAngle=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"innerConeAngle"]},outerConeAngle:{type:"number",get:R=>{var x;return null===(x=R._babylonLight)||void 0===x?void 0:x.angle},set:(R,x)=>x._babylonLight?x._babylonLight.angle=R:void 0,getTarget:R=>R._babylonLight,getPropertyName:[R=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonLight)),getPropertyName:[R=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonTexture)),getPropertyName:[R=>"length"]},__array__:{__target__:!0,bb:{type:"number",get:R=>{var x;return null===(x=R._babylonTexture)||void 0===x?void 0:x.level},set:(R,x)=>{x._babylonTexture&&(x._babylonTexture.level=R)},getTarget:R=>R._babylonTexture},rotation:{type:"Quaternion",get:R=>{var x;return R._babylonTexture&&k.f.FromRotationMatrix(null===(x=R._babylonTexture)||void 0===x?void 0:x.getReflectionTextureMatrix())},set:(R,x)=>{var H;x._babylonTexture&&(null!==(H=x._babylonTexture.va())&&void 0!==H&&H.useRightHandedSystem||(R=k.f.Inverse(R)),k.e.FromQuaternionToRef(R,x._babylonTexture.getReflectionTextureMatrix()))},getTarget:R=>R._babylonTexture}}}}},animations:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>R._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:R=>R.length,getTarget:R=>R.map((R=>{var x;return null===(x=R.primitives[0]._instanceData)||void 0===x?void 0:x.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function I(R){return new U(R,g)}function i(R){const x=R.split("/").map((R=>R.replace(/{}/g,"__array__")));let H=g;for(const k of x)k&&(H=H[k]);if(H&&H.type&&H.get)return H}function q(R,x){const H=R.split("/").map((R=>R.replace(/{}/g,"__array__")));let k=g;for(const c of H)c&&(k=k[c]);k&&k.type&&k.get&&(k.interpolation=x)}function S(R,x){const H=R.split("/").map((R=>R.replace(/{}/g,"__array__")));let k=g;for(const c of H)if(c){if(!k[c]){if("?"===c){k.__ignoreObjectTree__=!0;continue}k[c]={},"__array__"===c&&(k[c].__target__=!0)}k=k[c]}Object.assign(k,x)}},13212:(R,x,H)=>{"use strict";H.r(x),H.d(x,{AnimationPropertyInfo:()=>J,TransformNodeAnimationPropertyInfo:()=>V,WeightAnimationPropertyInfo:()=>n,getQuaternion:()=>D,getVector3:()=>A,getWeights:()=>U});var k=H(12331),c=H(661),t=H(13204);function A(R,x,H,k){return c.o.zi(x,H).scaleInPlace(k)}function D(R,x,H,k){return c.f.zi(x,H).scaleInPlace(k)}function U(R,x,H,k){const c=new Array(R._numMorphTargets);for(let t=0;t<c.length;t++)c[t]=x[H++]*k;return c}class J{constructor(R,x,H,k){this.type=R,this.name=x,this.getValue=H,this.getStride=k}_buildAnimation(R,x,H){const c=new k.c(R,this.name,x,this.type);return c.setKeys(H),c}}class V extends J{buildAnimations(R,x,H,k){const c=[];return c.push({babylonAnimatable:R._babylonTransformNode,babylonAnimation:this._buildAnimation(x,H,k)}),c}}class n extends J{buildAnimations(R,x,H,c){const t=[];if(R._numMorphTargets)for(let A=0;A<R._numMorphTargets;A++){const D=new k.c(`${x}_${A}`,this.name,H,this.type);if(D.setKeys(c.map((R=>({frame:R.frame,inTangent:R.inTangent?R.inTangent[A]:void 0,value:R.value[A],outTangent:R.outTangent?R.outTangent[A]:void 0,interpolation:R.interpolation})))),R._primitiveBabylonMeshes)for(const x of R._primitiveBabylonMeshes)if(x.morphTargetManager){const R=x.morphTargetManager.getTarget(A),H=D.clone();R.animations.push(H),t.push({babylonAnimatable:R,babylonAnimation:H})}}return t}}(0,t.j)("/nodes/{}/translation",[new V(k.c.ANIMATIONTYPE_VECTOR3,"position",A,(()=>3))]),(0,t.j)("/nodes/{}/rotation",[new V(k.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",D,(()=>4))]),(0,t.j)("/nodes/{}/scale",[new V(k.c.ANIMATIONTYPE_VECTOR3,"ti",A,(()=>3))]),(0,t.j)("/nodes/{}/weights",[new n(k.c.ANIMATIONTYPE_FLOAT,"influence",U,(R=>R._numMorphTargets))])},13175:(R,x,H)=>{"use strict";class k{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((R,x)=>{this._resolve=R,this._reject=x}))}}var c=H(661),t=H(695),A=H(485),D=H(637),U=H(13183),J=H(13189),V=H(476),n=H(12246),g=H(12331),I=H(12334),i=H(513),q=H(493),S=H(497);class L{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(R){this._useTextureToStoreBoneMatrices=R,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(R,x,H){this.name=R,this.id=x,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=c.e.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new V.d,this.bones=[],this._scene=H||i.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const k=this._scene.getEngine().getCaps();this._canUseTextureForBones=k.textureFloat&&k.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((R=>!R.getParent()))}getTransformMatrices(R){if(this.needInitialSkinMatrix){if(!R)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return R._bonesTransformMatrices||this.prepare(!0),R._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(R){return this.needInitialSkinMatrix&&R._transformMatrixTexture?R._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(R){let x=`Name: ${this.name}, nBones: ${this.bones.length}`;if(x+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,R){x+=", Ranges: {";let R=!0;for(const H in this._ranges)R&&(x+=", ",R=!1),x+=H;x+="}"}return x}getBoneIndexByName(R){for(let x=0,H=this.bones.length;x<H;x++)if(this.bones[x].name===R)return x;return-1}createAnimationRange(R,x,H){if(!this._ranges[R]){this._ranges[R]=new I.c(R,x,H);for(let k=0,c=this.bones.length;k<c;k++)this.bones[k].animations[0]&&this.bones[k].animations[0].createRange(R,x,H)}}deleteAnimationRange(R){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let H=0,k=this.bones.length;H<k;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].deleteRange(R,x);this._ranges[R]=null}getAnimationRange(R){return this._ranges[R]||null}getAnimationRanges(){const R=[];let x;for(x in this._ranges)R.push(this._ranges[x]);return R}copyAnimationRange(R,x){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[x]||!R.getAnimationRange(x))return!1;let k=!0;const c=this._getHighestAnimationFrame()+1,t={},A=R.bones;let D,U;for(U=0,D=A.length;U<D;U++)t[A[U].name]=A[U];this.bones.length!==A.length&&(q.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${A.length}`),k=!1);const J=H&&this.dimensionsAtRest&&R.dimensionsAtRest?this.dimensionsAtRest.divide(R.dimensionsAtRest):null;for(U=0,D=this.bones.length;U<D;U++){const R=this.bones[U].name,A=t[R];A?k=k&&this.bones[U].copyAnimationRange(A,x,c,H,J):(q.c.Warn("copyAnimationRange: not same rig, missing source bone "+R),k=!1)}const V=R.getAnimationRange(x);return V&&(this._ranges[x]=new I.c(x,V.from+c,V.to+c)),k}returnToRest(){for(const R of this.bones)-1!==R._index&&R.returnToRest()}_getHighestAnimationFrame(){let R=0;for(let x=0,H=this.bones.length;x<H;x++)if(this.bones[x].animations[0]){const H=this.bones[x].animations[0].getHighestFrame();R<H&&(R=H)}return R}beginAnimation(R,x,H,k){const c=this.getAnimationRange(R);return c?this._scene.beginAnimation(this,c.from,c.to,x,H,k):null}static MakeAnimationAdditive(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const k=R.getAnimationRange(H);if(!k)return null;const c=R._scene.getAllAnimatablesByTarget(R);let t=null;for(let D=0;D<c.length;D++){const R=c[D];if(R.fromFrame===(null===k||void 0===k?void 0:k.from)&&R.toFrame===(null===k||void 0===k?void 0:k.to)){t=R;break}}const A=R.getAnimatables();for(let D=0;D<A.length;D++){const R=A[D].animations;if(R)for(let k=0;k<R.length;k++)g.c.MakeAnimationAdditive(R[k],x,H)}return t&&(t.isAdditive=!0),R}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(R){this._meshesWithPoseMatrix.push(R)}_unregisterMeshWithPoseMatrix(R){const x=this._meshesWithPoseMatrix.indexOf(R);x>-1&&this._meshesWithPoseMatrix.splice(x,1)}_computeTransformMatrices(R,x){this.onBeforeComputeObservable.notifyObservers(this);for(let H=0;H<this.bones.length;H++){const k=this.bones[H];k._childUpdateId++;const c=k.getParent();if(c?k.getLocalMatrix().multiplyToRef(c.getFinalMatrix(),k.getFinalMatrix()):x?k.getLocalMatrix().multiplyToRef(x,k.getFinalMatrix()):k.getFinalMatrix().p(k.getLocalMatrix()),-1!==k._index){const x=null===k._index?H:k._index;k.getAbsoluteInverseBindMatrix().multiplyToArray(k.getFinalMatrix(),R,16*x)}}this._identity.copyToArray(R,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const R=this.va().getRenderId();if(this._currentRenderId===R)return;this._currentRenderId=R}if(this._numBonesWithLinkedTransformNode>0)for(const R of this.bones)if(R._linkedTransformNode){const x=R._linkedTransformNode;R.position=x.position,x.rotationQuaternion?R.rotationQuaternion=x.rotationQuaternion:R.rotation=x.rotation,R.ti=x.ti}if(this.needInitialSkinMatrix)for(const R of this._meshesWithPoseMatrix){const x=R.getPoseMatrix();let H=this._isDirty;if(R._bonesTransformMatrices&&R._bonesTransformMatrices.length===16*(this.bones.length+1)||(R._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),H=!0),H){if(this._synchronizedWithMesh!==R){this._synchronizedWithMesh=R;for(const R of this.bones)if(!R.getParent()){R.getBindMatrix().multiplyToRef(x,c.g.Matrix[1]),R._updateAbsoluteBindMatrices(c.g.Matrix[1])}if(this.isUsingTextureForMatrices){const x=4*(this.bones.length+1);R._transformMatrixTexture&&R._transformMatrixTexture.getSize().width===x||(R._transformMatrixTexture&&R._transformMatrixTexture.dispose(),R._transformMatrixTexture=n.b.CreateRGBATexture(R._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(R._bonesTransformMatrices,x),this.isUsingTextureForMatrices&&R._transformMatrixTexture&&R._transformMatrixTexture.update(R._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=n.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let R=0;R<this.bones.length;R++)this._animatables.push(this.bones[R])}return this._animatables}clone(R,x){const H=new L(R,x||R,this._scene);H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let k=0;k<this.bones.length;k++){const R=this.bones[k];let x=null;const c=R.getParent();if(c){const R=this.bones.indexOf(c);x=H.bones[R]}const t=new J.e(R.name,H,x,R.getBindMatrix().clone(),R.getRestMatrix().clone());t._index=R._index,R._linkedTransformNode&&t.linkTransformNode(R._linkedTransformNode),S.b.DeepCopy(R.animations,t.animations)}if(this._ranges){H._ranges={};for(const R in this._ranges){const x=this._ranges[R];x&&(H._ranges[R]=x.clone())}}return this._isDirty=!0,H.prepare(!0),H}enableBlending(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const x of this.bones)for(const H of x.animations)H.enableBlending=!0,H.blendingSpeed=R}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const R=this._parentContainer.skeletons.indexOf(this);R>-1&&this._parentContainer.skeletons.splice(R,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const R={};R.name=this.name,R.id=this.id,this.dimensionsAtRest&&(R.dimensionsAtRest=this.dimensionsAtRest.Li()),R.bones=[],R.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){var x;const k=this.bones[H],c=k.getParent(),t={parentBoneIndex:c?this.bones.indexOf(c):-1,index:k.getIndex(),name:k.name,id:k.id,matrix:k.getBindMatrix().Li(),rest:k.getRestMatrix().Li(),linkedTransformNodeId:null===(x=k.getTransformNode())||void 0===x?void 0:x.id};R.bones.push(t),k.length&&(t.length=k.length),k.metadata&&(t.metadata=k.metadata),k.animations&&k.animations.length>0&&(t.animation=k.animations[0].serialize()),R.ranges=[];for(const x in this._ranges){const H=this._ranges[x];if(!H)continue;const k={};k.name=x,k.from=H.from,k.to=H.to,R.ranges.push(k)}}return R}static Parse(R,x){const H=new L(R.name,R.id,x);let k;for(R.dimensionsAtRest&&(H.dimensionsAtRest=c.o.zi(R.dimensionsAtRest)),H.needInitialSkinMatrix=R.needInitialSkinMatrix,k=0;k<R.bones.length;k++){const x=R.bones[k],t=R.bones[k].index;let A=null;x.parentBoneIndex>-1&&(A=H.bones[x.parentBoneIndex]);const D=x.rest?c.e.zi(x.rest):null,U=new J.e(x.name,H,A,c.e.zi(x.matrix),D,null,t);void 0!==x.id&&null!==x.id&&(U.id=x.id),x.length&&(U.length=x.length),x.metadata&&(U.metadata=x.metadata),x.animation&&U.animations.push(g.c.Parse(x.animation)),void 0!==x.linkedTransformNodeId&&null!==x.linkedTransformNodeId&&(H._hasWaitingData=!0,U._waitingTransformNodeId=x.linkedTransformNodeId)}if(R.ranges)for(k=0;k<R.ranges.length;k++){const x=R.ranges[k];H.createAnimationRange(x.name,x.from,x.to)}return H}computeAbsoluteMatrices(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||R)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(R)}getPoseMatrix(){let R=null;return this._meshesWithPoseMatrix.length>0&&(R=this._meshesWithPoseMatrix[0].getPoseMatrix()),R}sortBones(){const R=[],x=new Array(this.bones.length);for(let H=0;H<this.bones.length;H++)this._sortBones(H,R,x);this.bones=R}_sortBones(R,x,H){if(H[R])return;H[R]=!0;const k=this.bones[R];if(!k)return;void 0===k._index&&(k._index=R);const c=k.getParent();c&&this._sortBones(this.bones.indexOf(c),x,H),x.push(k)}setCurrentPoseAsRest(){for(const R of this.bones)R.setCurrentPoseAsRest()}}var b=H(837),C=H(12264),F=H(2311),d=H(819),P=H(724),a=H(798),X=H(813),M=H(471),B=H(12340),o=H(654),Z=H(13140);class y{set areUpdatesFrozen(R){R?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new o.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,R||(R=i.c.LastCreatedScene),this._scene=R,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const R=this._scene.getEngine().getCaps();this._canUseTextureForTargets=R.canUseGLVertexID&&R.textureFloat&&R.maxVertexTextureImageUnits>0&&R.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return y.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?y.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(R){this._numMaxInfluencers!==R&&(this._numMaxInfluencers=R,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(R){this._useTextureToStoreTargets!==R&&(this._useTextureToStoreTargets=R,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var R;return y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(R=this._scene)&&void 0!==R&&R.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(R){return this._activeTargets.data[R]}getTarget(R){return this._targets[R]}getTargetByName(R){for(const x of this._targets)if(x.name===R)return x;return null}addTarget(R){this._targets.push(R),this._targetInfluenceChangedObservers.push(R.onInfluenceChanged.add((R=>{this.areUpdatesFrozen&&R&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(R)}))),this._targetDataLayoutChangedObservers.push(R._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(R){const x=this._targets.indexOf(R);x>=0&&(this._targets.splice(x,1),R.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(x,1)[0]),R._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(x,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(R)}_bind(R){R.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),R.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),R.setTexture("morphTargets",this._targetStoreTexture),R.setInt("morphTargetCount",this.numInfluencers)}clone(){const R=new y(this._scene);for(const x of this._targets)R.addTarget(x.clone());return R.enablePositionMorphing=this.enablePositionMorphing,R.enableNormalMorphing=this.enableNormalMorphing,R.enableTangentMorphing=this.enableTangentMorphing,R.enableUVMorphing=this.enableUVMorphing,R.enableUV2Morphing=this.enableUV2Morphing,R.enableColorMorphing=this.enableColorMorphing,R}serialize(){const R={};R.id=this.uniqueId,R.targets=[];for(const x of this._targets)R.targets.push(x.serialize());return R}_syncActiveTargets(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const x=!!this._targetStoreTexture,H=this.isUsingTextureForTargets;(this._mustSynchronize||x!==H)&&(this._mustSynchronize=!1,this.synchronize());let k=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let c=-1;for(const t of this._targets)if(c++,0!==t.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(t),this._morphTargetTextureIndices[k]=c,this._tempInfluences[k++]=t.influence}this._morphTargetTextureIndices.length!==k&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,k)),this._influences&&this._influences.length===k||(this._influences=new Float32Array(k));for(let t=0;t<k;t++)this._influences[t]=this._tempInfluences[t];if(R&&this._scene)for(const t of this._scene.meshes)t.morphTargetManager===this&&(H?t._markSubMeshesAsAttributesDirty():t._syncGeometryWithMorphTargetManager())}synchronize(){var R;if(!this._scene||this.areUpdatesFrozen)return;const x=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(R=this._targetStoreTexture)||void 0===R||R.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>x.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const H of this._targets){this._supportsPositions=this._supportsPositions&&H.hasPositions,this._supportsNormals=this._supportsNormals&&H.hasNormals,this._supportsTangents=this._supportsTangents&&H.hasTangents,this._supportsUVs=this._supportsUVs&&H.hasUVs,this._supportsUV2s=this._supportsUV2s&&H.hasUV2s,this._supportsColors=this._supportsColors&&H.hasColors;const R=H.vertexCount;if(0===this._vertexCount)this._vertexCount=R;else if(this._vertexCount!==R)return void q.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${H.name}": ${R}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const R=x.getCaps().maxTextureSize;this._textureWidth>R&&(this._textureHeight=Math.ceil(this._textureWidth/R),this._textureWidth=R);const H=this._targets.length,k=new Float32Array(H*this._textureWidth*this._textureHeight*4);let c=0;for(let x=0;x<H;x++){const R=this._targets[x],H=R.getPositions(),t=R.getNormals(),A=R.getUVs(),D=R.getTangents(),U=R.getUV2s(),J=R.getColors();c=x*this._textureWidth*this._textureHeight*4;for(let x=0;x<this._vertexCount;x++)this._supportsPositions&&H&&(k[c]=H[3*x],k[c+1]=H[3*x+1],k[c+2]=H[3*x+2],c+=4),this._supportsNormals&&t&&(k[c]=t[3*x],k[c+1]=t[3*x+1],k[c+2]=t[3*x+2],c+=4),this._supportsUVs&&A&&(k[c]=A[2*x],k[c+1]=A[2*x+1],c+=4),this._supportsTangents&&D&&(k[c]=D[3*x],k[c+1]=D[3*x+1],k[c+2]=D[3*x+2],c+=4),this._supportsUV2s&&U&&(k[c]=U[2*x],k[c+1]=U[2*x+1],c+=4),this._supportsColors&&J&&(k[c]=J[4*x],k[c+1]=J[4*x+1],k[c+2]=J[4*x+2],k[c+3]=J[4*x+3],c+=4)}this._targetStoreTexture=Z.d.CreateRGBATexture(k,this._textureWidth,this._textureHeight,H,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const H of this._scene.meshes)H.morphTargetManager===this&&H._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const R=this._parentContainer.morphTargetManagers.indexOf(this);R>-1&&this._parentContainer.morphTargetManagers.splice(R,1),this._parentContainer=null}for(const R of this._targets)this._scene.stopAnimation(R)}}static Parse(R,x){const H=new y(x);for(const k of R.targets)H.addTarget(B.e.Parse(k,x));return H}}y.EnableTextureStorage=!0,y.MaxActiveMorphTargetsInVertexAttributeMode=8,y.ConstantTargetCountForTextureMode=0;var s=H(13197),E=H(517),w=H(769);const h=new Map,f=h;function N(R,x,H){W(R)&&q.c.Warn(`Extension with the name '${R}' already exists`),h.set(R,{isGLTFExtension:x,factory:H})}function W(R){return h.delete(R)}var K=H(13204),Q=H(12393),G=H(735);class T{static Get(R,x,H){if(!x||void 0==H||!x[H])throw new Error(`${R}: Failed to find index (${H})`);return x[H]}static TryGet(R,x){return R&&void 0!=x&&R[x]?R[x]:null}static Assign(R){if(R)for(let x=0;x<R.length;x++)R[x].index=x}}function v(R){if(R.min&&R.max){const x=R.min,H=R.max,k=c.g.Bi[0].si(x[0],x[1],x[2]),t=c.g.Bi[1].si(H[0],H[1],H[2]);if(R.normalized&&5126!==R.componentType){let x=1;switch(R.componentType){case 5120:x=127;break;case 5121:x=255;break;case 5122:x=32767;break;case 5123:x=65535}const H=1/x;k.scaleInPlace(H),t.scaleInPlace(H)}return new w.b(k,t)}return null}class p{static RegisterExtension(R,x){N(R,!1,x)}static UnregisterExtension(R){return W(R)}get Si(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(R){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=R}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((R=>R.dispose&&R.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(R,x,H,k,c,t){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=x,this._assetContainer=H,this._loadData(k);let t=null;if(R){const x={};if(this._gltf.nodes)for(const R of this._gltf.nodes)R.name&&(x[R.name]=R.index);t=(R instanceof Array?R:[R]).map((R=>{const H=x[R];if(void 0===H)throw new Error(`Failed to find node '${R}'`);return H}))}return await this._loadAsync(c,A,t,(()=>({meshes:this._getMeshes(),Ei:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(R,x,H,k){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=R,this._loadData(x),await this._loadAsync(H,c,null,(()=>{}))}async _loadAsync(R,x,H,k){return await Promise.resolve().then((async()=>{this._rootUrl=R,this._uniqueRootUrl=!R.startsWith("file:")&&x?R:`${R}${Date.now()}/`,this._fileName=x,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const c=`${s.h[s.h.LOADING]} => ${s.h[s.h.READY]}`,t=`${s.h[s.h.LOADING]} => ${s.h[s.h.COMPLETE]}`;this._parent._startPerformanceCounter(c),this._parent._startPerformanceCounter(t),this._parent._setState(s.h.LOADING),this._extensionsOnLoading();const D=new Array;if(!this.parent.loadOnlyMaterials)if(H)D.push(this.loadSceneAsync("/nodes",{nodes:H,index:-1}));else if(void 0!=this._gltf.Yk||this._gltf.scenes&&this._gltf.scenes[0]){const R=T.Get("/scene",this._gltf.scenes,this._gltf.Yk||0);D.push(this.loadSceneAsync(`/scenes/${R.index}`,R))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let R=0;R<this._gltf.materials.length;++R){const x=this._gltf.materials[R],H="/materials/"+R,k=b.b.TriangleFillMode;D.push(this._loadMaterialAsync(H,x,null,k,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&D.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&D.push(this._compileShadowGeneratorsAsync());const U=Promise.all(D).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.oi(!0);for(const R of this._babylonScene.materials){const x=R;void 0!==x.maxSimultaneousLights&&(x.maxSimultaneousLights=Math.max(x.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(s.h.READY),this._skipStartAnimationStep||this._startAnimations(),k()}));return await U.then((R=>(this._parent._endPerformanceCounter(c),A.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(t),this._parent._setState(s.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(R=>{this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()}))})),R)))})).catch((R=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()),R}))}_loadData(R){if(this._gltf=R.json,this._setupData(),R.bin){const x=this._gltf.buffers;if(x&&x[0]&&!x[0].uri){const H=x[0];(H.byteLength<R.bin.byteLength-3||H.byteLength>R.bin.byteLength)&&q.c.Warn(`Binary buffer length (${H.byteLength}) from JSON does not match chunk length (${R.bin.byteLength})`),this._bin=R.bin}else q.c.Warn("Unexpected BIN chunk")}}_setupData(){if(T.Assign(this._gltf.accessors),T.Assign(this._gltf.animations),T.Assign(this._gltf.buffers),T.Assign(this._gltf.bufferViews),T.Assign(this._gltf.cameras),T.Assign(this._gltf.images),T.Assign(this._gltf.materials),T.Assign(this._gltf.meshes),T.Assign(this._gltf.nodes),T.Assign(this._gltf.samplers),T.Assign(this._gltf.scenes),T.Assign(this._gltf.skins),T.Assign(this._gltf.textures),this._gltf.nodes){const R={};for(const H of this._gltf.nodes)if(H.children)for(const x of H.children)R[x]=H.index;const x=this._createRootNode();for(const H of this._gltf.nodes){const k=R[H.index];H.parent=void 0===k?x:this._gltf.nodes[k]}}}async _loadExtensionsAsync(){const R=[];if(f.forEach(((x,H)=>{var k;!1===(null===(k=this.parent.extensionOptions[H])||void 0===k?void 0:k.enabled)?x.isGLTFExtension&&this.isExtensionUsed(H)&&q.c.Warn(`Extension ${H} is used but has been explicitly disabled.`):x.isGLTFExtension&&!this.isExtensionUsed(H)||R.push((async()=>{const R=await x.factory(this);return R.name!==H&&q.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${R.name} !== ${H}`),this._parent.onExtensionLoadedObservable.notifyObservers(R),R})())})),this._extensions.push(...await Promise.all(R)),this._extensions.sort(((R,x)=>(R.order||Number.MAX_VALUE)-(x.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const H of this._gltf.extensionsRequired){if(!this._extensions.some((R=>R.name===H&&R.enabled))){var x;if(!1===(null===(x=this.parent.extensionOptions[H])||void 0===x?void 0:x.enabled))throw new Error(`Required extension ${H} is disabled`);throw new Error(`Required extension ${H} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new M.d("__root__",this._babylonScene);this._rootBabylonMesh=R,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.oi(!1);const x={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case s.g.AUTO:this._babylonScene.useRightHandedSystem||(x.rotation=[0,1,0,0],x.scale=[1,1,-1],p._LoadTransform(x,this._rootBabylonMesh));break;case s.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(R),x}loadSceneAsync(R,x){const H=this._extensionsLoadSceneAsync(R,x);if(H)return H;const k=new Array;if(this.logOpen(`${R} ${x.name||""}`),x.nodes)for(const c of x.nodes){const x=T.Get(`${R}/nodes/${c}`,this._gltf.nodes,c);k.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(R=>{R.parent=this._rootBabylonMesh})))}for(const c of this._postSceneLoadActions)c();return k.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(k).then((()=>{}))}_forEachPrimitive(R,x){if(R._primitiveBabylonMeshes)for(const H of R._primitiveBabylonMeshes)x(H)}_getGeometries(){const R=[],x=this._gltf.nodes;if(x)for(const H of x)this._forEachPrimitive(H,(x=>{const H=x.Ci;H&&-1===R.indexOf(H)&&R.push(H)}));return R}_getMeshes(){const R=[];this._rootBabylonMesh instanceof X.b&&R.push(this._rootBabylonMesh);const x=this._gltf.nodes;if(x)for(const H of x)this._forEachPrimitive(H,(x=>{R.push(x)}));return R}_getTransformNodes(){const R=[],x=this._gltf.nodes;if(x)for(const H of x)H._babylonTransformNode&&"nj"===H._babylonTransformNode.getClassName()&&R.push(H._babylonTransformNode),H._babylonTransformNodeForSkin&&R.push(H._babylonTransformNodeForSkin);return R}_getSkeletons(){const R=[],x=this._gltf.skins;if(x)for(const H of x)H._data&&R.push(H._data.babylonSkeleton);return R}_getAnimationGroups(){const R=[],x=this._gltf.animations;if(x)for(const H of x)H._babylonAnimationGroup&&R.push(H._babylonAnimationGroup);return R}_startAnimations(){switch(this._parent.animationStartMode){case s.f.NONE:break;case s.f.FIRST:{const R=this._getAnimationGroups();0!==R.length&&R[0].start(!0);break}case s.f.ALL:{const R=this._getAnimationGroups();for(const x of R)x.start(!0);break}default:return void q.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadNodeAsync(R,x,H);if(k)return k;if(x._babylonTransformNode)throw new Error(`${R}: Invalid recursive node hierarchy`);const c=new Array;this.logOpen(`${R} ${x.name||""}`);const t=k=>{if(p.AddPointerMetadata(k,R),p._LoadTransform(x,k),void 0!=x.camera){const H=T.Get(`${R}/camera`,this._gltf.cameras,x.camera);c.push(this.loadCameraAsync(`/cameras/${H.index}`,H,(R=>{R.parent=k,this._babylonScene.useRightHandedSystem||(k.ti.x=-1)})))}if(x.children)for(const H of x.children){const x=T.Get(`${R}/children/${H}`,this._gltf.nodes,H);c.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(R=>{R.parent=k})))}H(k)},A=void 0!=x.mesh,D=this._parent.loadSkins&&void 0!=x.skin;if(!A||D){const R=x.name||`node${x.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new d.e(R,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==x.mesh?x._babylonTransformNode=H:x._babylonTransformNodeForSkin=H,t(H)}if(A)if(D){const H=T.Get(`${R}/mesh`,this._gltf.meshes,x.mesh);c.push(this._loadMeshAsync(`/meshes/${H.index}`,x,H,(H=>{const k=x._babylonTransformNodeForSkin;H.metadata=(0,Q.e)(k.metadata,H.metadata||{});const t=T.Get(`${R}/skin`,this._gltf.skins,x.skin);c.push(this._loadSkinAsync(`/skins/${t.index}`,x,t,(R=>{this._forEachPrimitive(x,(x=>{x.skeleton=R})),this._postSceneLoadActions.push((()=>{if(void 0!=t.skeleton){const R=T.Get(`/skins/${t.index}/skeleton`,this._gltf.nodes,t.skeleton).parent;x.index===R.index?H.parent=k.parent:H.parent=R._babylonTransformNode}else H.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:k,skinnedNode:H})}))})))})))}else{const H=T.Get(`${R}/mesh`,this._gltf.meshes,x.mesh);c.push(this._loadMeshAsync(`/meshes/${H.index}`,x,H,t))}return this.logClose(),Promise.all(c).then((()=>(this._forEachPrimitive(x,(R=>{const x=R;!x.isAnInstance&&x.Ci&&x.Ci.useBoundingInfoFromGeometry?R.Ea():R.refreshBoundingInfo(!0,!0)})),x._babylonTransformNode)))}_loadMeshAsync(R,x,H,k){const c=H.primitives;if(!c||!c.length)throw new Error(`${R}: Primitives are missing`);void 0==c[0].index&&T.Assign(c);const t=new Array;this.logOpen(`${R} ${H.name||""}`);const A=x.name||`node${x.index}`;if(1===c.length){const k=H.primitives[0];t.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${k.index}`,A,x,H,k,(R=>{x._babylonTransformNode=R,x._primitiveBabylonMeshes=[R]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,x._babylonTransformNode=new d.e(A,this._babylonScene),x._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._primitiveBabylonMeshes=[];for(const k of c)t.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${k.index}`,`${A}_primitive${k.index}`,x,H,k,(R=>{R.parent=x._babylonTransformNode,x._primitiveBabylonMeshes.push(R)})))}return k(x._babylonTransformNode),this.logClose(),Promise.all(t).then((()=>x._babylonTransformNode))}_loadMeshPrimitiveAsync(R,x,H,k,c,t){const A=this._extensionsLoadMeshPrimitiveAsync(R,x,H,k,c,t);if(A)return A;this.logOpen(`${R}`);const D=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==H.skin&&!k.primitives[0].targets;let U,J;if(D&&c._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,U=c._instanceData.babylonSourceMesh.createInstance(x),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J=c._instanceData.promise;else{const t=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new M.d(x,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.sideOrientation=this._babylonScene.useRightHandedSystem?b.b.CounterClockWiseSideOrientation:b.b.ClockWiseSideOrientation,this._createMorphTargets(R,H,k,c,A),t.push(this._loadVertexDataAsync(R,c,A).then((async x=>await this._loadMorphTargetsAsync(R,c,A,x).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,x.Ca(A),x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const V=p._GetDrawMode(R,c.mode);if(void 0==c.material){let R=this._defaultBabylonMaterialData[V];R||(R=this._createDefaultMaterial("__GLTFLoader._default",V),this._parent.onMaterialLoadedObservable.notifyObservers(R),this._defaultBabylonMaterialData[V]=R),A.material=R}else if(!this.parent.skipMaterials){const x=T.Get(`${R}/material`,this._gltf.materials,c.material);t.push(this._loadMaterialAsync(`/materials/${x.index}`,x,A,V,(R=>{A.material=R})))}J=Promise.all(t),D&&(c._instanceData={babylonSourceMesh:A,promise:J}),U=A}return p.AddPointerMetadata(U,R),this._parent.onMeshLoadedObservable.notifyObservers(U),t(U),this.logClose(),J.then((()=>U))}_loadVertexDataAsync(R,x,H){const k=this._extensionsLoadVertexDataAsync(R,x,H);if(k)return k;const c=x.attributes;if(!c)throw new Error(`${R}: Attributes are missing`);const t=new Array,A=new a.c(H.name,this._babylonScene);if(void 0==x.indices)H.isUnIndexed=!0;else{const H=T.Get(`${R}/indices`,this._gltf.accessors,x.indices);t.push(this._loadIndicesAccessorAsync(`/accessors/${H.index}`,H).then((R=>{A.setIndices(R)})))}const D=(x,k,D)=>{if(void 0==c[x])return;H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(k)&&H._delayInfo.push(k);const U=T.Get(`${R}/attributes/${x}`,this._gltf.accessors,c[x]);t.push(this._loadVertexAccessorAsync(`/accessors/${U.index}`,U,k).then((R=>{if(R.getKind()===P.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!H.skeleton){const R=v(U);R&&(A._boundingInfo=R,A.useBoundingInfoFromGeometry=!0)}A.setVerticesBuffer(R,U.count)}))),k==P.g.MatricesIndicesExtraKind&&(H.numBoneInfluencers=8),D&&D(U)};return D("POSITION",P.g.PositionKind),D("NORMAL",P.g.NormalKind),D("TANGENT",P.g.TangentKind),D("TEXCOORD_0",P.g.UVKind),D("TEXCOORD_1",P.g.UV2Kind),D("TEXCOORD_2",P.g.UV3Kind),D("TEXCOORD_3",P.g.UV4Kind),D("TEXCOORD_4",P.g.UV5Kind),D("TEXCOORD_5",P.g.UV6Kind),D("JOINTS_0",P.g.MatricesIndicesKind),D("WEIGHTS_0",P.g.MatricesWeightsKind),D("JOINTS_1",P.g.MatricesIndicesExtraKind),D("WEIGHTS_1",P.g.MatricesWeightsExtraKind),D("COLOR_0",P.g.ColorKind,(R=>{"VEC4"===R.type&&(H.hasVertexAlpha=!0)})),Promise.all(t).then((()=>A))}_createMorphTargets(R,x,H,k,c){if(!k.targets||!this._parent.loadMorphTargets)return;if(void 0==x._numMorphTargets)x._numMorphTargets=k.targets.length;else if(k.targets.length!==x._numMorphTargets)throw new Error(`${R}: Primitives do not have the same number of targets`);const t=H.extras?H.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,c.morphTargetManager=new y(this._babylonScene),c.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.morphTargetManager.areUpdatesFrozen=!0;for(let A=0;A<k.targets.length;A++){const R=x.weights?x.weights[A]:H.weights?H.weights[A]:0,k=t?t[A]:`morphTarget${A}`;c.morphTargetManager.addTarget(new B.e(k,R,c.va()))}}_loadMorphTargetsAsync(R,x,H,k){if(!x.targets||!this._parent.loadMorphTargets)return Promise.resolve();const c=new Array,t=H.morphTargetManager;for(let A=0;A<t.numTargets;A++){const H=t.getTarget(A);c.push(this._loadMorphTargetVertexDataAsync(`${R}/targets/${A}`,k,x.targets[A],H))}return Promise.all(c).then((()=>{t.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(R,x,H,k){const c=new Array,t=(k,t,A)=>{if(void 0==H[k])return;const D=x.getVertexBuffer(t);if(!D)return;const U=T.Get(`${R}/${k}`,this._gltf.accessors,H[k]);c.push(this._loadFloatAccessorAsync(`/accessors/${U.index}`,U).then((R=>{A(D,R)})))};return t("POSITION",P.g.PositionKind,((R,x)=>{const H=new Float32Array(x.length);R.forEach(x.length,((R,k)=>{H[k]=x[k]+R})),k.setPositions(H)})),t("NORMAL",P.g.NormalKind,((R,x)=>{const H=new Float32Array(x.length);R.forEach(H.length,((R,k)=>{H[k]=x[k]+R})),k.setNormals(H)})),t("TANGENT",P.g.TangentKind,((R,x)=>{const H=new Float32Array(x.length/3*4);let c=0;R.forEach(x.length/3*4,((R,k)=>{(k+1)%4!==0&&(H[c]=x[c]+R,c++)})),k.setTangents(H)})),t("TEXCOORD_0",P.g.UVKind,((R,x)=>{const H=new Float32Array(x.length);R.forEach(x.length,((R,k)=>{H[k]=x[k]+R})),k.setUVs(H)})),t("TEXCOORD_1",P.g.UV2Kind,((R,x)=>{const H=new Float32Array(x.length);R.forEach(x.length,((R,k)=>{H[k]=x[k]+R})),k.setUV2s(H)})),t("COLOR_0",P.g.ColorKind,((x,H)=>{let c=null;const t=x.getSize();if(3===t){c=new Float32Array(H.length/3*4),x.forEach(H.length,((R,x)=>{const k=Math.floor(x/3),t=x%3;c[4*k+t]=H[3*k+t]+R}));for(let R=0;R<H.length/3;++R)c[4*R+3]=1}else{if(4!==t)throw new Error(`${R}: Invalid number of components (${t}) for COLOR_0 attribute`);c=new Float32Array(H.length),x.forEach(H.length,((R,x)=>{c[x]=H[x]+R}))}k.setColors(c)})),await Promise.all(c).then((()=>{}))}static _LoadTransform(R,x){if(void 0!=R.skin)return;let H=c.o.Zero(),k=c.f.Identity(),t=c.o.One();if(R.matrix){c.e.zi(R.matrix).decompose(t,k,H)}else R.translation&&(H=c.o.zi(R.translation)),R.rotation&&(k=c.f.zi(R.rotation)),R.scale&&(t=c.o.zi(R.scale));x.position=H,x.rotationQuaternion=k,x.ti=t}_loadSkinAsync(R,x,H,k){if(!this._parent.loadSkins)return Promise.resolve();const c=this._extensionsLoadSkinAsync(R,x,H);if(c)return c;if(H._data)return k(H._data.babylonSkeleton),H._data.promise;const t=`skeleton${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new L(H.name||t,t,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(R,H,A);const D=this._loadSkinInverseBindMatricesDataAsync(R,H).then((R=>{this._updateBoneMatrices(A,R)}));return H._data={babylonSkeleton:A,promise:D},k(A),D}_loadBones(R,x,H){if(void 0==x.skeleton||this._parent.alwaysComputeSkeletonRootNode){const H=this._findSkeletonRootNode(`${R}/joints`,x.joints);if(H)if(void 0===x.skeleton)x.skeleton=H.index;else{const k=(R,x)=>{for(;x.parent;x=x.parent)if(x.parent===R)return!0;return!1},c=T.Get(`${R}/skeleton`,this._gltf.nodes,x.skeleton);c===H||k(c,H)||(q.c.Warn(`${R}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),x.skeleton=H.index)}else q.c.Warn(`${R}: Failed to find common root`)}const k={};for(const c of x.joints){const t=T.Get(`${R}/joints/${c}`,this._gltf.nodes,c);this._loadBone(t,x,H,k)}}_findSkeletonRootNode(R,x){if(0===x.length)return null;const H={};for(const c of x){const x=[];let k=T.Get(`${R}/${c}`,this._gltf.nodes,c);for(;-1!==k.index;)x.unshift(k),k=k.parent;H[c]=x}let k=null;for(let c=0;;++c){let R=H[x[0]];if(c>=R.length)return k;const t=R[c];for(let A=1;A<x.length;++A)if(R=H[x[A]],c>=R.length||t!==R[c])return k;k=t}}_loadBone(R,x,H,k){R._isJoint=!0;let c=k[R.index];if(c)return c;let t=null;R.index!==x.skeleton&&(R.parent&&-1!==R.parent.index?t=this._loadBone(R.parent,x,H,k):void 0!==x.skeleton&&q.c.Warn(`/skins/${x.index}/skeleton: Skeleton node is not a common root`));const A=x.joints.indexOf(R.index);return c=new J.e(R.name||`joint${R.index}`,H,t,this._getNodeMatrix(R),null,null,A),k[R.index]=c,this._postSceneLoadActions.push((()=>{c.linkTransformNode(R._babylonTransformNode)})),c}_loadSkinInverseBindMatricesDataAsync(R,x){if(void 0==x.inverseBindMatrices)return Promise.resolve(null);const H=T.Get(`${R}/inverseBindMatrices`,this._gltf.accessors,x.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${H.index}`,H)}_updateBoneMatrices(R,x){for(const H of R.bones){const R=c.e.Identity(),k=H._index;x&&-1!==k&&(c.e.FromArrayToRef(x,16*k,R),R.invertToRef(R));const t=H.getParent();t&&R.multiplyToRef(t.getAbsoluteInverseBindMatrix(),R),H.jj(R,!1,!1),H._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(R){return R.matrix?c.e.zi(R.matrix):c.e.Compose(R.scale?c.o.zi(R.scale):c.o.One(),R.rotation?c.f.zi(R.rotation):c.f.Identity(),R.translation?c.o.zi(R.translation):c.o.Zero())}loadCameraAsync(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadCameraAsync(R,x,H);if(k)return k;const t=new Array;this.logOpen(`${R} ${x.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new U.c(x.name||`camera${x.index}`,c.o.Zero(),this._babylonScene,!1);switch(A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonCamera=A,A.setTarget(new c.o(0,0,-1)),x.type){case"perspective":{const H=x.perspective;if(!H)throw new Error(`${R}: Camera perspective properties are missing`);A.fov=H.yfov,A.Hi=H.znear,A.maxZ=H.zfar||0;break}case"orthographic":if(!x.orthographic)throw new Error(`${R}: Camera orthographic properties are missing`);A.mode=D.b.ORTHOGRAPHIC_CAMERA,A.orthoLeft=-x.orthographic.xmag,A.orthoRight=x.orthographic.xmag,A.orthoBottom=-x.orthographic.ymag,A.orthoTop=x.orthographic.ymag,A.Hi=x.orthographic.znear,A.maxZ=x.orthographic.zfar;break;default:throw new Error(`${R}: Invalid camera type (${x.type})`)}return p.AddPointerMetadata(A,R),this._parent.onCameraLoadedObservable.notifyObservers(A),H(A),this.logClose(),Promise.all(t).then((()=>A))}_loadAnimationsAsync(){const R=this._gltf.animations;if(!R)return Promise.resolve();const x=new Array;for(let H=0;H<R.length;H++){const k=R[H];x.push(this.loadAnimationAsync(`/animations/${k.index}`,k).then((R=>{0===R.targetedAnimations.length&&R.dispose()})))}return Promise.all(x).then((()=>{}))}loadAnimationAsync(R,x){const k=this._extensionsLoadAnimationAsync(R,x);return k||H.e(62).then(H.bind(H,14406)).then((H=>{let{AnimationGroup:k}=H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new k(x.name||`animation${x.index}`,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonAnimationGroup=c;const t=new Array;T.Assign(x.channels),T.Assign(x.samplers);for(const A of x.channels)t.push(this._loadAnimationChannelAsync(`${R}/channels/${A.index}`,R,x,A,((R,x)=>{R.animations=R.animations||[],R.animations.push(x),c.addTargetedAnimation(x,R)})));return Promise.all(t).then((()=>(c.normalize(0),c)))}))}async _loadAnimationChannelAsync(R,x,k,c,t){const A=this._extensionsLoadAnimationChannelAsync(R,x,k,c,t);if(A)return await A;if(void 0==c.target.node)return await Promise.resolve();const D=T.Get(`${R}/target/node`,this._gltf.nodes,c.target.node),U=c.target.path,J="weights"===U;if(J&&!D._numMorphTargets||!J&&!D._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!J&&!D._isJoint)return await Promise.resolve();let V;switch(await Promise.resolve().then(H.bind(H,13212)),U){case"translation":var n;V=null===(n=(0,K.e)("/nodes/{}/translation"))||void 0===n?void 0:n.interpolation;break;case"rotation":var g;V=null===(g=(0,K.e)("/nodes/{}/rotation"))||void 0===g?void 0:g.interpolation;break;case"scale":var I;V=null===(I=(0,K.e)("/nodes/{}/scale"))||void 0===I?void 0:I.interpolation;break;case"weights":var i;V=null===(i=(0,K.e)("/nodes/{}/weights"))||void 0===i?void 0:i.interpolation;break;default:throw new Error(`${R}/target/path: Invalid value (${c.target.path})`)}if(!V)throw new Error(`${R}/target/path: Could not find interpolation properties for target path (${c.target.path})`);const q={object:D,info:V};return await this._loadAnimationChannelFromTargetInfoAsync(R,x,k,c,q,t)}_loadAnimationChannelFromTargetInfoAsync(R,x,H,k,c,t){const A=this.parent.targetFps,D=1/A,U=T.Get(`${R}/sampler`,H.samplers,k.sampler);return this._loadAnimationSamplerAsync(`${x}/samplers/${k.sampler}`,U).then((R=>{let x=0;const U=c.object,J=c.info;for(const c of J){const J=c.getStride(U),V=R.input,n=R.output,g=new Array(V.length);let I=0;switch(R.interpolation){case"STEP":for(let R=0;R<V.length;R++){const x=c.getValue(U,n,I,1);I+=J,g[R]={frame:V[R]*A,value:x,interpolation:1}}break;case"CUBICSPLINE":for(let R=0;R<V.length;R++){const x=c.getValue(U,n,I,D);I+=J;const H=c.getValue(U,n,I,1);I+=J;const k=c.getValue(U,n,I,D);I+=J,g[R]={frame:V[R]*A,inTangent:x,value:H,outTangent:k}}break;case"LINEAR":for(let R=0;R<V.length;R++){const x=c.getValue(U,n,I,1);I+=J,g[R]={frame:V[R]*A,value:x}}}if(I>0){const R=`${H.name||`animation${H.index}`}_channel${k.index}_${x}`,D=c.buildAnimations(U,R,A,g);for(const H of D)x++,t(H.babylonAnimatable,H.babylonAnimation)}}}))}_loadAnimationSamplerAsync(R,x){if(x._data)return x._data;const H=x.interpolation||"LINEAR";switch(H){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${R}/interpolation: Invalid value (${x.interpolation})`)}const k=T.Get(`${R}/input`,this._gltf.accessors,x.input),c=T.Get(`${R}/output`,this._gltf.accessors,x.output);return x._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${k.index}`,k),this._loadFloatAccessorAsync(`/accessors/${c.index}`,c)]).then((R=>{let[x,k]=R;return{input:x,interpolation:H,output:k}})),x._data}loadBufferAsync(R,x,H,k){const c=this._extensionsLoadBufferAsync(R,x,H,k);if(c)return c;if(!x._data)if(x.uri)x._data=this.loadUriAsync(`${R}/uri`,x,x.uri);else{if(!this._bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);x._data=this._bin.readAsync(0,x.byteLength)}return x._data.then((x=>{try{return new Uint8Array(x.buffer,x.byteOffset+H,k)}catch(c){throw new Error(`${R}: ${c.message}`)}}))}loadBufferViewAsync(R,x){const H=this._extensionsLoadBufferViewAsync(R,x);if(H)return H;if(x._data)return x._data;const k=T.Get(`${R}/buffer`,this._gltf.buffers,x.buffer);return x._data=this.loadBufferAsync(`/buffers/${k.index}`,k,x.byteOffset||0,x.byteLength),x._data}_loadAccessorAsync(R,x,H){if(x._data)return x._data;const k=p._GetNumComponents(R,x.type),c=k*P.g.GetTypeByteLength(x.componentType),t=k*x.count;if(void 0==x.bufferView)x._data=Promise.resolve(new H(t));else{const A=T.Get(`${R}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((D=>{if(5126!==x.componentType||x.normalized||A.byteStride&&A.byteStride!==c){const R=new H(t);return P.g.ForEach(D,x.byteOffset||0,A.byteStride||c,k,x.componentType,R.length,x.normalized||!1,((x,H)=>{R[H]=x})),R}return p._GetTypedArray(R,x.componentType,D,x.byteOffset,t)}))}if(x.sparse){const t=x.sparse;x._data=x._data.then((A=>{const D=A,U=T.Get(`${R}/sparse/indices/bufferView`,this._gltf.bufferViews,t.indices.bufferView),J=T.Get(`${R}/sparse/values/bufferView`,this._gltf.bufferViews,t.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${U.index}`,U),this.loadBufferViewAsync(`/bufferViews/${J.index}`,J)]).then((A=>{let[U,J]=A;const V=p._GetTypedArray(`${R}/sparse/indices`,t.indices.componentType,U,t.indices.byteOffset,t.count),n=k*t.count;let g;if(5126!==x.componentType||x.normalized){const A=p._GetTypedArray(`${R}/sparse/values`,x.componentType,J,t.values.byteOffset,n);g=new H(n),P.g.ForEach(A,0,c,k,x.componentType,g.length,x.normalized||!1,((R,x)=>{g[x]=R}))}else g=p._GetTypedArray(`${R}/sparse/values`,x.componentType,J,t.values.byteOffset,n);let I=0;for(let R=0;R<V.length;R++){let x=V[R]*k;for(let R=0;R<k;R++)D[x++]=g[I++]}return D}))}))}return x._data}_loadFloatAccessorAsync(R,x){return this._loadAccessorAsync(R,x,Float32Array)}_loadIndicesAccessorAsync(R,x){if("SCALAR"!==x.type)throw new Error(`${R}/type: Invalid value ${x.type}`);if(5121!==x.componentType&&5123!==x.componentType&&5125!==x.componentType)throw new Error(`${R}/componentType: Invalid value ${x.componentType}`);if(x._data)return x._data;if(x.sparse){const H=p._GetTypedArrayConstructor(`${R}/componentType`,x.componentType);x._data=this._loadAccessorAsync(R,x,H)}else{const H=T.Get(`${R}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>p._GetTypedArray(R,x.componentType,H,x.byteOffset,x.count)))}return x._data}_loadVertexBufferViewAsync(R){if(R._babylonBuffer)return R._babylonBuffer;const x=this._babylonScene.getEngine();return R._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R).then((R=>new P.d(x,R,!1))),R._babylonBuffer}_loadVertexAccessorAsync(R,x,H){var k;if(null!==(k=x._babylonVertexBuffer)&&void 0!==k&&k[H])return x._babylonVertexBuffer[H];x._babylonVertexBuffer||(x._babylonVertexBuffer={});const c=this._babylonScene.getEngine();if(x.sparse||void 0==x.bufferView)x._babylonVertexBuffer[H]=this._loadFloatAccessorAsync(R,x).then((R=>new P.g(c,R,H,!1)));else{const k=T.Get(`${R}/bufferView`,this._gltf.bufferViews,x.bufferView);x._babylonVertexBuffer[H]=this._loadVertexBufferViewAsync(k).then((t=>{const A=p._GetNumComponents(R,x.type);return new P.g(c,t,H,!1,void 0,k.byteStride,void 0,x.byteOffset,A,x.componentType,x.normalized,!0,void 0,!0)}))}return x._babylonVertexBuffer[H]}_loadMaterialMetallicRoughnessPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return x&&(x.baseColorFactor?(H.albedoColor=t.c.zi(x.baseColorFactor),H.alpha=x.baseColorFactor[3]):H.albedoColor=t.c.White(),H.metallic=void 0==x.metallicFactor?1:x.metallicFactor,H.roughness=void 0==x.roughnessFactor?1:x.roughnessFactor,x.baseColorTexture&&k.push(this.loadTextureInfoAsync(`${R}/baseColorTexture`,x.baseColorTexture,(R=>{R.name=`${H.name} (Base Color)`,H.albedoTexture=R}))),x.metallicRoughnessTexture&&(x.metallicRoughnessTexture.nonColorData=!0,k.push(this.loadTextureInfoAsync(`${R}/metallicRoughnessTexture`,x.metallicRoughnessTexture,(R=>{R.name=`${H.name} (Metallic Roughness)`,H.metallicTexture=R}))),H.useMetallnessFromMetallicTextureBlue=!0,H.useRoughnessFromMetallicTextureGreen=!0,H.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(k).then((()=>{}))}_loadMaterialAsync(R,x,H,k){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const t=this._extensionsLoadMaterialAsync(R,x,H,k,c);if(t)return t;x._data=x._data||{};let A=x._data[k];if(!A){this.logOpen(`${R} ${x.name||""}`);const H=this.createMaterial(R,x,k);A={babylonMaterial:H,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(R,x,H)},x._data[k]=A,p.AddPointerMetadata(H,R),this._parent.onMaterialLoadedObservable.notifyObservers(H),this.logClose()}return H&&(A.babylonMeshes.push(H),H.Vi.addOnce((()=>{const R=A.babylonMeshes.indexOf(H);-1!==R&&A.babylonMeshes.splice(R,1)}))),c(A.babylonMaterial),A.promise.then((()=>A.babylonMaterial))}_createDefaultMaterial(R,x){this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new C.e(R,this._babylonScene);return H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.fillMode=x,H.enableSpecularAntiAliasing=!0,H.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,H.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,H.transparencyMode=C.e.PBRMATERIAL_OPAQUE,H.metallic=1,H.roughness=1,H}createMaterial(R,x,H){const k=this._extensionsCreateMaterial(R,x,H);if(k)return k;const c=x.name||`material${x.index}`;return this._createDefaultMaterial(c,H)}loadMaterialPropertiesAsync(R,x,H){const k=this._extensionsLoadMaterialPropertiesAsync(R,x,H);if(k)return k;const c=new Array;return c.push(this.loadMaterialBasePropertiesAsync(R,x,H)),x.pbrMetallicRoughness&&c.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${R}/pbrMetallicRoughness`,x.pbrMetallicRoughness,H)),this.loadMaterialAlphaProperties(R,x,H),Promise.all(c).then((()=>{}))}loadMaterialBasePropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return H.emissiveColor=x.emissiveFactor?t.c.zi(x.emissiveFactor):new t.c(0,0,0),x.doubleSided&&(H.Ki=!1,H.twoSidedLighting=!0),x.normalTexture&&(x.normalTexture.nonColorData=!0,k.push(this.loadTextureInfoAsync(`${R}/normalTexture`,x.normalTexture,(R=>{R.name=`${H.name} (Normal)`,H.bumpTexture=R}))),H.invertNormalMapX=!this._babylonScene.useRightHandedSystem,H.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=x.normalTexture.scale&&H.bumpTexture&&(H.bumpTexture.level=x.normalTexture.scale),H.forceIrradianceInFragment=!0),x.occlusionTexture&&(x.occlusionTexture.nonColorData=!0,k.push(this.loadTextureInfoAsync(`${R}/occlusionTexture`,x.occlusionTexture,(R=>{R.name=`${H.name} (Occlusion)`,H.ambientTexture=R}))),H.useAmbientInGrayScale=!0,void 0!=x.occlusionTexture.strength&&(H.ambientTextureStrength=x.occlusionTexture.strength)),x.emissiveTexture&&k.push(this.loadTextureInfoAsync(`${R}/emissiveTexture`,x.emissiveTexture,(R=>{R.name=`${H.name} (Emissive)`,H.emissiveTexture=R}))),Promise.all(k).then((()=>{}))}loadMaterialAlphaProperties(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);switch(x.alphaMode||"OPAQUE"){case"OPAQUE":H.transparencyMode=C.e.PBRMATERIAL_OPAQUE,H.alpha=1;break;case"MASK":H.transparencyMode=C.e.PBRMATERIAL_ALPHATEST,H.alphaCutOff=void 0==x.alphaCutoff?.5:x.alphaCutoff,H.albedoTexture&&(H.albedoTexture.Qj=!0);break;case"BLEND":H.transparencyMode=C.e.PBRMATERIAL_ALPHABLEND,H.albedoTexture&&(H.albedoTexture.Qj=!0,H.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${R}/alphaMode: Invalid value (${x.alphaMode})`)}}loadTextureInfoAsync(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadTextureInfoAsync(R,x,H);if(k)return k;if(this.logOpen(`${R}`),x.texCoord>=6)throw new Error(`${R}/texCoord: Invalid value (${x.texCoord})`);const c=T.Get(`${R}/index`,this._gltf.textures,x.index);c._textureInfo=x;const t=this._loadTextureAsync(`/textures/${x.index}`,c,(k=>{k.coordinatesIndex=x.texCoord||0,p.AddPointerMetadata(k,R),this._parent.onTextureLoadedObservable.notifyObservers(k),H(k)}));return this.logClose(),t}_loadTextureAsync(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const k=this._extensionsLoadTextureAsync(R,x,H);if(k)return k;this.logOpen(`${R} ${x.name||""}`);const c=void 0==x.sampler?p.DefaultSampler:T.Get(`${R}/sampler`,this._gltf.samplers,x.sampler),t=T.Get(`${R}/source`,this._gltf.images,x.source),A=this._createTextureAsync(R,c,t,H,void 0,!x._textureInfo.nonColorData);return this.logClose(),A}_createTextureAsync(R,x,H){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},t=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;const D=this._loadSampler(`/samplers/${x.index}`,x),U=new Array,J=new k;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V={noMipmap:D.noMipMaps,invertY:!1,samplingMode:D.samplingMode,X:()=>{this._disposed||J.resolve()},onError:(x,H)=>{this._disposed||J.reject(new Error(`${R}: ${H&&H.message?H.message:x||"Failed to load texture"}`))},mimeType:H.mimeType??(0,E.j)(H.uri??""),loaderOptions:t,useSRGBBuffer:!!A&&this._parent.useSRGBBuffers},n=new F.d(null,this._babylonScene,V);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.push(J.promise),U.push(this.loadImageAsync(`/images/${H.index}`,H).then((R=>{const x=H.uri||`${this._fileName}#image${H.index}`,k=`data:${this._uniqueRootUrl}${x}`;n.updateURL(k,R);const c=n.getInternalTexture();c&&(c.label=H.name)}))),n.wrapU=D.wrapU,n.wrapV=D.wrapV,c(n),this._parent.useGltfTextureNames&&(n.name=H.name||H.uri||`image${H.index}`),Promise.all(U).then((()=>n))}_loadSampler(R,x){return x._data||(x._data={noMipMaps:9728===x.minFilter||9729===x.minFilter,samplingMode:p._GetTextureSamplingMode(R,x),wrapU:p._GetTextureWrapMode(`${R}/wrapS`,x.wrapS),wrapV:p._GetTextureWrapMode(`${R}/wrapT`,x.wrapT)}),x._data}loadImageAsync(R,x){if(!x._data){if(this.logOpen(`${R} ${x.name||""}`),x.uri)x._data=this.loadUriAsync(`${R}/uri`,x,x.uri);else{const H=T.Get(`${R}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}this.logClose()}return x._data}loadUriAsync(R,x,H){const k=this._extensionsLoadUriAsync(R,x,H);if(k)return k;if(!p._ValidateUri(H))throw new Error(`${R}: '${H}' is invalid`);if((0,E.n)(H)){const x=new Uint8Array((0,E.d)(H));return this.log(`${R}: Decoded ${H.substring(0,64)}... (${x.length} bytes)`),Promise.resolve(x)}return this.log(`${R}: Loading ${H}`),this._parent.preprocessUrlAsync(this._rootUrl+H).then((x=>new Promise(((k,c)=>{this._parent._loadFile(this._babylonScene,x,(x=>{this._disposed||(this.log(`${R}: Loaded ${H} (${x.byteLength} bytes)`),k(new Uint8Array(x)))}),!0,(x=>{c(new E.q(`${R}: Failed to load '${H}'${x?": "+x.status+" "+x.statusText:""}`,x))}))}))))}static AddPointerMetadata(R,x){R.metadata=R.metadata||{};const H=R._internalMetadata=R._internalMetadata||{},k=H.Si=H.Si||{};(k.pointers=k.pointers||[]).push(x)}static _GetTextureWrapMode(R,x){switch(x=void 0==x?10497:x){case 33071:return F.d.CLAMP_ADDRESSMODE;case 33648:return F.d.MIRROR_ADDRESSMODE;case 10497:return F.d.WRAP_ADDRESSMODE;default:return q.c.Warn(`${R}: Invalid value (${x})`),F.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(R,x){const H=void 0==x.magFilter?9729:x.magFilter,k=void 0==x.minFilter?9987:x.minFilter;if(9729===H)switch(k){case 9728:return F.d.LINEAR_NEAREST;case 9729:return F.d.LINEAR_LINEAR;case 9984:return F.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return F.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return F.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return F.d.LINEAR_LINEAR_MIPLINEAR;default:return q.c.Warn(`${R}/minFilter: Invalid value (${k})`),F.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==H&&q.c.Warn(`${R}/magFilter: Invalid value (${H})`),k){case 9728:return F.d.NEAREST_NEAREST;case 9729:return F.d.NEAREST_LINEAR;case 9984:return F.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return F.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return F.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return F.d.NEAREST_LINEAR_MIPLINEAR;default:return q.c.Warn(`${R}/minFilter: Invalid value (${k})`),F.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(R,x){try{return(0,G.l)(x)}catch(H){throw new Error(`${R}: ${H.message}`)}}static _GetTypedArray(R,x,H,k,c){const t=H.buffer;k=H.byteOffset+(k||0);const A=p._GetTypedArrayConstructor(`${R}/componentType`,x),D=P.g.GetTypeByteLength(x);return k%D!==0?(q.c.Warn(`${R}: Copying buffer as byte offset (${k}) is not a multiple of component type byte length (${D})`),new A(t.slice(k,k+c*D),0)):new A(t,k,c)}static _GetNumComponents(R,x){switch(x){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${R}: Invalid type (${x})`)}static _ValidateUri(R){return A.e.IsBase64(R)||-1===R.indexOf("..")}static _GetDrawMode(R,x){switch(void 0==x&&(x=4),x){case 0:return b.b.PointListDrawMode;case 1:return b.b.LineListDrawMode;case 2:return b.b.LineLoopDrawMode;case 3:return b.b.LineStripDrawMode;case 4:return b.b.TriangleFillMode;case 5:return b.b.TriangleStripDrawMode;case 6:return b.b.TriangleFanDrawMode}throw new Error(`${R}: Invalid mesh primitive mode (${x})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const R=new Array;if(this._gltf.materials)for(const x of this._gltf.materials)if(x._data)for(const H in x._data){const k=x._data[H];for(const x of k.babylonMeshes){x.Fi(!0);const H=k.babylonMaterial;R.push(H.forceCompilationAsync(x)),R.push(H.forceCompilationAsync(x,{useInstances:!0})),this._parent.useClipPlane&&(R.push(H.forceCompilationAsync(x,{clipPlane:!0})),R.push(H.forceCompilationAsync(x,{clipPlane:!0,useInstances:!0})))}}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const R=new Array,x=this._babylonScene.lights;for(const H of x){const x=H.getShadowGenerator();x&&R.push(x.forceCompilationAsync())}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(R){for(const x of this._extensions)x.enabled&&R(x)}_applyExtensions(R,x,H){for(const k of this._extensions)if(k.enabled){const c=`${k.name}.${x}`,t=R;t._activeLoaderExtensionFunctions=t._activeLoaderExtensionFunctions||{};const A=t._activeLoaderExtensionFunctions;if(!A[c]){A[c]=!0;try{const R=H(k);if(R)return R}finally{delete A[c]}}}return null}_extensionsOnLoading(){this._forEachExtensions((R=>R.onLoading&&R.onLoading()))}_extensionsOnReady(){this._forEachExtensions((R=>R.onReady&&R.onReady()))}_extensionsLoadSceneAsync(R,x){return this._applyExtensions(x,"loadScene",(H=>H.loadSceneAsync&&H.loadSceneAsync(R,x)))}_extensionsLoadNodeAsync(R,x,H){return this._applyExtensions(x,"loadNode",(k=>k.loadNodeAsync&&k.loadNodeAsync(R,x,H)))}_extensionsLoadCameraAsync(R,x,H){return this._applyExtensions(x,"loadCamera",(k=>k.loadCameraAsync&&k.loadCameraAsync(R,x,H)))}_extensionsLoadVertexDataAsync(R,x,H){return this._applyExtensions(x,"loadVertexData",(k=>k._loadVertexDataAsync&&k._loadVertexDataAsync(R,x,H)))}_extensionsLoadMeshPrimitiveAsync(R,x,H,k,c,t){return this._applyExtensions(c,"loadMeshPrimitive",(A=>A._loadMeshPrimitiveAsync&&A._loadMeshPrimitiveAsync(R,x,H,k,c,t)))}_extensionsLoadMaterialAsync(R,x,H,k,c){return this._applyExtensions(x,"loadMaterial",(t=>t._loadMaterialAsync&&t._loadMaterialAsync(R,x,H,k,c)))}_extensionsCreateMaterial(R,x,H){return this._applyExtensions(x,"createMaterial",(k=>k.createMaterial&&k.createMaterial(R,x,H)))}_extensionsLoadMaterialPropertiesAsync(R,x,H){return this._applyExtensions(x,"loadMaterialProperties",(k=>k.loadMaterialPropertiesAsync&&k.loadMaterialPropertiesAsync(R,x,H)))}_extensionsLoadTextureInfoAsync(R,x,H){return this._applyExtensions(x,"loadTextureInfo",(k=>k.loadTextureInfoAsync&&k.loadTextureInfoAsync(R,x,H)))}_extensionsLoadTextureAsync(R,x,H){return this._applyExtensions(x,"loadTexture",(k=>k._loadTextureAsync&&k._loadTextureAsync(R,x,H)))}_extensionsLoadAnimationAsync(R,x){return this._applyExtensions(x,"loadAnimation",(H=>H.loadAnimationAsync&&H.loadAnimationAsync(R,x)))}_extensionsLoadAnimationChannelAsync(R,x,H,k,c){return this._applyExtensions(H,"loadAnimationChannel",(t=>t._loadAnimationChannelAsync&&t._loadAnimationChannelAsync(R,x,H,k,c)))}_extensionsLoadSkinAsync(R,x,H){return this._applyExtensions(H,"loadSkin",(k=>k._loadSkinAsync&&k._loadSkinAsync(R,x,H)))}_extensionsLoadUriAsync(R,x,H){return this._applyExtensions(x,"loadUri",(k=>k._loadUriAsync&&k._loadUriAsync(R,x,H)))}_extensionsLoadBufferViewAsync(R,x){return this._applyExtensions(x,"loadBufferView",(H=>H.loadBufferViewAsync&&H.loadBufferViewAsync(R,x)))}_extensionsLoadBufferAsync(R,x,H,k){return this._applyExtensions(x,"loadBuffer",(c=>c.loadBufferAsync&&c.loadBufferAsync(R,x,H,k)))}static LoadExtensionAsync(R,x,H,k){if(!x.extensions)return null;const c=x.extensions[H];return c?k(`${R}/extensions/${H}`,c):null}static LoadExtraAsync(R,x,H,k){if(!x.extras)return null;const c=x.extras[H];return c?k(`${R}/extras/${H}`,c):null}isExtensionUsed(R){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(R)}logOpen(R){this._parent._logOpen(R)}logClose(){this._parent._logClose()}log(R){this._parent._log(R)}startPerformanceCounter(R){this._parent._startPerformanceCounter(R)}endPerformanceCounter(R){this._parent._endPerformanceCounter(R)}}p.DefaultSampler={index:-1},s.c._CreateGLTF2Loader=R=>new p(R);var r=H(13212),z=H(2274),j=H(687),m=H(2436),O=H(13220);class l extends O.c{constructor(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",R),this._texture=R.getEngine().createRawCubeTexture(x,H,k,c,t,A,D,U)}update(R,x,H,k){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,R,x,H,k,c)}updateRGBDAsync(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,m.g)(this._texture,R,x,H,k).then((()=>{}))}clone(){return j.d.Clone((()=>{const R=this.va(),x=this._texture,H=new l(R,x._bufferViewArray,x.width,x.format,x.type,x.generateMipMaps,x.invertY,x.samplingMode,x._compression);return 13===x.source&&H.updateRGBDAsync(x._bufferViewArrayArray,x._sphericalPolynomial,x._lodGenerationScale,x._lodGenerationOffset),H}),this)}}const e="EXT_lights_image_based";class u{constructor(R){this.name=e,this._loader=R,this.enabled=this._loader.isExtensionUsed(e)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.Si.extensions;if(R&&R[this.name]){const x=R[this.name];this._lights=x.lights}}loadSceneAsync(R,x){return p.LoadExtensionAsync(R,x,this.name,(async(H,k)=>{this._loader._allMaterialsDirtyRequired=!0;const c=new Array;c.push(this._loader.loadSceneAsync(R,x)),this._loader.logOpen(`${H}`);const t=T.Get(`${H}/light`,this._lights,k.ab);return c.push(this._loadLightAsync(`/extensions/${this.name}/lights/${k.ab}`,t).then((R=>{this._loader.babylonScene.environmentTexture=R}))),this._loader.logClose(),await Promise.all(c).then((()=>{}))}))}_loadLightAsync(R,x){if(!x._loaded){const H=new Array;this._loader.logOpen(`${R}`);const k=new Array(x.specularImages.length);for(let c=0;c<x.specularImages.length;c++){const t=x.specularImages[c];k[c]=new Array(t.length);for(let x=0;x<t.length;x++){const A=`${R}/specularImages/${c}/${x}`;this._loader.logOpen(`${A}`);const D=t[x],U=T.Get(A,this._loader.Si.images,D);H.push(this._loader.loadImageAsync(`/images/${D}`,U).then((R=>{k[c][x]=R}))),this._loader.logClose()}}this._loader.logClose(),x._loaded=Promise.all(H).then((async()=>{const H=new l(this._loader.babylonScene,null,x.specularImageSize);if(H.name=x.name||"environment",x._babylonTexture=H,void 0!=x.bb&&(H.level=x.bb),x.rotation){let R=c.f.zi(x.rotation);this._loader.babylonScene.useRightHandedSystem||(R=c.f.Inverse(R)),c.e.FromQuaternionToRef(R,H.getReflectionTextureMatrix())}if(!x.irradianceCoefficients)throw new Error(`${R}: Irradiance coefficients are missing`);const t=z.d.zi(x.irradianceCoefficients);t.scaleInPlace(x.bb),t.convertIrradianceToLambertianRadiance();const A=z.e.FromHarmonics(t),D=(k.length-1)/Math.log2(x.specularImageSize);return await H.updateRGBDAsync(k,A,D)}))}return x._loaded.then((()=>x._babylonTexture))}}W(e),N(e,!0,(R=>new u(R)));H(465);const Y="EXT_mesh_gpu_instancing";class RR{constructor(R){this.name=Y,this._loader=R,this.enabled=this._loader.isExtensionUsed(Y)}dispose(){this._loader=null}loadNodeAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(R,k)=>{this._loader._disableInstancedMesh++;const t=this._loader.loadNodeAsync(`/nodes/${x.index}`,x,H);if(this._loader._disableInstancedMesh--,!x._primitiveBabylonMeshes)return await t;const A=new Array;let D=0;const U=x=>{if(void 0==k.attributes[x])return void A.push(Promise.resolve(null));const H=T.Get(`${R}/attributes/${x}`,this._loader.Si.accessors,k.attributes[x]);if(A.push(this._loader._loadFloatAccessorAsync(`/accessors/${H.bufferView}`,H)),0===D)D=H.count;else if(D!==H.count)throw new Error(`${R}/attributes: Instance buffer accessors do not have the same count.`)};return U("TRANSLATION"),U("ROTATION"),U("SCALE"),await t.then((async R=>{const[H,k,t]=await Promise.all(A),U=new Float32Array(16*D);c.g.Bi[0].si(0,0,0),c.g.Quaternion[0].si(0,0,0,1),c.g.Bi[1].si(1,1,1);for(let x=0;x<D;++x)H&&c.o.FromArrayToRef(H,3*x,c.g.Bi[0]),k&&c.f.FromArrayToRef(k,4*x,c.g.Quaternion[0]),t&&c.o.FromArrayToRef(t,3*x,c.g.Bi[1]),c.e.ComposeToRef(c.g.Bi[1],c.g.Quaternion[0],c.g.Bi[0],c.g.Matrix[0]),c.g.Matrix[0].copyToArray(U,16*x);for(const c of x._primitiveBabylonMeshes)c.xi("matrix",U,16,!0);return R}))}))}}W(Y),N(Y,!0,(R=>new RR(R)));let xR=0,HR=null;class kR{static get Default(){return kR._Default||(kR._Default=new kR),kR._Default}constructor(){const R=kR.Configuration.decoder;this._decoderModulePromise=A.e.LoadBabylonScriptAsync(R.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(R,x,H,k,c){await this._decoderModulePromise,0===xR&&(MeshoptDecoder.useWorkers(1),xR=1);const t=await MeshoptDecoder.decodeGltfBufferAsync(x,H,R,k,c);return null!==HR&&clearTimeout(HR),HR=setTimeout((()=>{MeshoptDecoder.useWorkers(0),xR=0,HR=null}),1e3),t}}kR.Configuration={decoder:{url:`${A.e._DefaultCdnUrl}/meshopt_decoder.js`}},kR._Default=null;const cR="EXT_meshopt_compression";class tR{constructor(R){this.name=cR,this.enabled=R.isExtensionUsed(cR),this._loader=R}dispose(){this._loader=null}loadBufferViewAsync(R,x){return p.LoadExtensionAsync(R,x,this.name,(async(H,k)=>{const c=x;if(c._meshOptData)return await c._meshOptData;const t=T.Get(`${R}/buffer`,this._loader.Si.buffers,k.buffer);return c._meshOptData=this._loader.loadBufferAsync(`/buffers/${t.index}`,t,k.byteOffset||0,k.byteLength).then((async R=>await kR.Default.decodeGltfBufferAsync(R,k.count,k.byteStride,k.mode,k.filter))),await c._meshOptData}))}}W(cR),N(cR,!0,(R=>new tR(R)));const AR="EXT_texture_webp";class DR{constructor(R){this.name=AR,this._loader=R,this.enabled=R.isExtensionUsed(AR)}dispose(){this._loader=null}_loadTextureAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=void 0==x.sampler?p.DefaultSampler:T.Get(`${R}/sampler`,this._loader.Si.samplers,x.sampler),A=T.Get(`${k}/source`,this._loader.Si.images,c.source);return await this._loader._createTextureAsync(R,t,A,(R=>{H(R)}),void 0,!x._textureInfo.nonColorData)}))}}W(AR),N(AR,!0,(R=>new DR(R)));const UR="EXT_texture_avif";class JR{constructor(R){this.name=UR,this._loader=R,this.enabled=R.isExtensionUsed(UR)}dispose(){this._loader=null}_loadTextureAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=void 0==x.sampler?p.DefaultSampler:T.Get(`${R}/sampler`,this._loader.Si.samplers,x.sampler),A=T.Get(`${k}/source`,this._loader.Si.images,c.source);return await this._loader._createTextureAsync(R,t,A,(R=>{H(R)}),void 0,!x._textureInfo.nonColorData)}))}}W(UR),N(UR,!0,(R=>new JR(R)));var VR=H(13207),nR=H(12348);const gR="EXT_lights_ies";class IR{constructor(R){this.name=gR,this._loader=R,this.enabled=this._loader.isExtensionUsed(gR)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.Si.extensions;if(R&&R[this.name]){const x=R[this.name];this._lights=x.lights,T.Assign(this._lights)}}loadNodeAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,A)=>{let D,U;this._loader._allMaterialsDirtyRequired=!0;const J=await this._loader.loadNodeAsync(R,x,(R=>{U=T.Get(k,this._lights,A.ab);const x=U.name||R.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,D=new VR.c(x,c.o.Zero(),c.o.Backward(),0,1,this._loader.babylonScene),D.angle=Math.PI/2,D.innerAngle=0,D._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,U._babylonLight=D,D.falloffType=nR.b.FALLOFF_GLTF,D.cb=A.color?t.c.zi(A.color):t.c.White(),D.bb=A.multiplier||1,D.range=Number.MAX_VALUE,D.parent=R,this._loader._babylonLights.push(D),p.AddPointerMetadata(D,k),H(R)}));let V;if(U.uri)V=await this._loader.loadUriAsync(R,U,U.uri);else{const x=T.Get(`${R}/bufferView`,this._loader.Si.bufferViews,U.bufferView);V=await this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}return D.iesProfileTexture=new F.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,V,!0,void 0,void 0,void 0,void 0,".ies"),J}))}}W(gR),N(gR,!0,(R=>new IR(R)));var iR=H(13222);const qR="KHR_draco_mesh_compression";class SR{constructor(R){this.name=qR,this.useNormalizedFlagFromAccessor=!0,this._loader=R,this.enabled=iR.d.DefaultAvailable&&this._loader.isExtensionUsed(qR)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{if(void 0!=x.mode&&4!==x.mode&&5!==x.mode)throw new Error(`${R}: Unsupported mode ${x.mode}`);const t={},A={},D=(R,k)=>{const D=c.attributes[R];if(void 0!=D&&(H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(k)&&H._delayInfo.push(k),t[k]=D,this.useNormalizedFlagFromAccessor)){const H=T.TryGet(this._loader.Si.accessors,x.attributes[R]);H&&(A[k]=H.normalized||!1)}};D("POSITION",P.g.PositionKind),D("NORMAL",P.g.NormalKind),D("TANGENT",P.g.TangentKind),D("TEXCOORD_0",P.g.UVKind),D("TEXCOORD_1",P.g.UV2Kind),D("TEXCOORD_2",P.g.UV3Kind),D("TEXCOORD_3",P.g.UV4Kind),D("TEXCOORD_4",P.g.UV5Kind),D("TEXCOORD_5",P.g.UV6Kind),D("JOINTS_0",P.g.MatricesIndicesKind),D("WEIGHTS_0",P.g.MatricesWeightsKind),D("COLOR_0",P.g.ColorKind);const U=T.Get(k,this._loader.Si.bufferViews,c.bufferView);return U._dracoBabylonGeometry||(U._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((async k=>{const c=this.dracoDecoder||iR.d.Default,D=T.TryGet(this._loader.Si.accessors,x.attributes.POSITION),U=this._loader.parent.alwaysComputeBoundingBox||H.skeleton||!D?null:v(D);return await c._decodeMeshToGeometryForGltfAsync(H.name,this._loader.babylonScene,k,t,A,U).catch((x=>{throw new Error(`${R}: ${x.message}`)}))}))),await U._dracoBabylonGeometry}))}}W(qR),N(qR,!0,(R=>new SR(R)));var LR=H(13225),bR=H(643),CR=H(647),FR=H(683),dR=H(12395),PR=H(610);FR.e.AddNodeConstructor("Light_Type_0",((R,x)=>()=>new aR(R,c.o.Zero(),x)));class aR extends dR.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(R){this._shadowAngle=R,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(R){const x=this.needCube();if(this._direction=R,this.needCube()!==x&&this._shadowGenerators){const R=this._shadowGenerators.values();for(let x=R.next();!0!==x.done;x=R.next()){x.value.recreateShadowMap()}}}constructor(R,x,H){super(R,H),this._shadowAngle=Math.PI/2,this.position=x}getClassName(){return"PointLight"}getTypeID(){return nR.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(R){if(this.direction)return super.getShadowDirection(R);switch(R){case 0:return new c.o(1,0,0);case 1:return new c.o(-1,0,0);case 2:return new c.o(0,-1,0);case 3:return new c.o(0,1,0);case 4:return new c.o(0,0,1);case 5:return new c.o(0,0,-1)}return c.o.Zero()}_setDefaultShadowProjectionMatrix(R,x,H){const k=this.va().activeCamera;if(!k)return;const t=void 0!==this.shadowMinZ?this.shadowMinZ:k.Hi,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:k.maxZ,D=this.va().getEngine().useReverseDepthBuffer;c.e.PerspectiveFovLHToRef(this.shadowAngle,1,D?A:t,D?t:A,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,D)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,x){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,x):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,x),this}transferToNodeMaterialEffect(R,x){return this.computeTransformedInformation()?R.setFloat3(x,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):R.setFloat3(x,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(R,x){R["POINTLIGHT"+x]=!0}}(0,bR.d)([(0,CR.Q)()],aR.prototype,"shadowAngle",null),(0,PR.h)("BABYLON.PointLight",aR);const XR="KHR_lights_punctual";class MR{constructor(R){this.name=XR,this._loader=R,this.enabled=this._loader.isExtensionUsed(XR)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.Si.extensions;if(R&&R[this.name]){const x=R[this.name];this._lights=x.lights,T.Assign(this._lights)}}loadNodeAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,A)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(R,x,(R=>{let x;const D=T.Get(k,this._lights,A.ab),U=D.name||R.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,D.type){case"directional":{const R=new LR.c(U,c.o.Backward(),this._loader.babylonScene);R.position.Ai(0),x=R;break}case"point":x=new aR(U,c.o.Zero(),this._loader.babylonScene);break;case"spot":{const R=new VR.c(U,c.o.Zero(),c.o.Backward(),0,1,this._loader.babylonScene);R.angle=2*(D.spot&&D.spot.outerConeAngle||Math.PI/4),R.innerAngle=2*(D.spot&&D.spot.innerConeAngle||0),x=R;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${k}: Invalid light type (${D.type})`)}x._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,D._babylonLight=x,x.falloffType=nR.b.FALLOFF_GLTF,x.cb=D.color?t.c.zi(D.color):t.c.White(),x.bb=void 0==D.bb?1:D.bb,x.range=void 0==D.range?Number.MAX_VALUE:D.range,x.parent=R,this._loader._babylonLights.push(x),p.AddPointerMetadata(x,k),H(R)})))))}}W(XR),N(XR,!0,(R=>new MR(R)));const BR="KHR_materials_pbrSpecularGlossiness";class oR{constructor(R){this.name=BR,this.order=200,this._loader=R,this.enabled=this._loader.isExtensionUsed(BR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialBasePropertiesAsync(R,x,H)),t.push(this._loadSpecularGlossinessPropertiesAsync(k,c,H)),this._loader.loadMaterialAlphaProperties(R,x,H),await Promise.all(t).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return H.metallic=null,H.roughness=null,x.diffuseFactor?(H.albedoColor=t.c.zi(x.diffuseFactor),H.alpha=x.diffuseFactor[3]):H.albedoColor=t.c.White(),H.reflectivityColor=x.specularFactor?t.c.zi(x.specularFactor):t.c.White(),H.microSurface=void 0==x.glossinessFactor?1:x.glossinessFactor,x.diffuseTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTexture`,x.diffuseTexture,(R=>{R.name=`${H.name} (Diffuse)`,H.albedoTexture=R}))),x.specularGlossinessTexture&&(k.push(this._loader.loadTextureInfoAsync(`${R}/specularGlossinessTexture`,x.specularGlossinessTexture,(R=>{R.name=`${H.name} (Specular Glossiness)`,H.reflectivityTexture=R,H.reflectivityTexture.Qj=!0}))),H.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(k).then((()=>{}))}}W(BR),N(BR,!0,(R=>new oR(R)));const ZR="KHR_materials_unlit";class yR{constructor(R){this.name=ZR,this.order=210,this._loader=R,this.enabled=this._loader.isExtensionUsed(ZR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async()=>await this._loadUnlitPropertiesAsync(R,x,H)))}_loadUnlitPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;H.unlit=!0;const c=x.pbrMetallicRoughness;return c&&(c.baseColorFactor?(H.albedoColor=t.c.zi(c.baseColorFactor),H.alpha=c.baseColorFactor[3]):H.albedoColor=t.c.White(),c.baseColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/baseColorTexture`,c.baseColorTexture,(R=>{R.name=`${H.name} (Base Color)`,H.albedoTexture=R})))),x.doubleSided&&(H.Ki=!1,H.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(R,x,H),Promise.all(k).then((()=>{}))}}W(ZR),N(ZR,!0,(R=>new yR(R)));const sR="KHR_materials_clearcoat";class ER{constructor(R){this.name=sR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(sR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadClearCoatPropertiesAsync(k,c,H)),await Promise.all(t)}))}_loadClearCoatPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return H.clearCoat.isEnabled=!0,H.clearCoat.useRoughnessFromMainTexture=!1,H.clearCoat.remapF0OnInterfaceChange=!1,void 0!=x.clearcoatFactor?H.clearCoat.bb=x.clearcoatFactor:H.clearCoat.bb=0,x.clearcoatTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatTexture`,x.clearcoatTexture,(R=>{R.name=`${H.name} (ClearCoat)`,H.clearCoat.texture=R}))),void 0!=x.clearcoatRoughnessFactor?H.clearCoat.roughness=x.clearcoatRoughnessFactor:H.clearCoat.roughness=0,x.clearcoatRoughnessTexture&&(x.clearcoatRoughnessTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatRoughnessTexture`,x.clearcoatRoughnessTexture,(R=>{R.name=`${H.name} (ClearCoat Roughness)`,H.clearCoat.textureRoughness=R})))),x.clearcoatNormalTexture&&(x.clearcoatNormalTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatNormalTexture`,x.clearcoatNormalTexture,(R=>{R.name=`${H.name} (ClearCoat Normal)`,H.clearCoat.bumpTexture=R}))),H.invertNormalMapX=!H.va().useRightHandedSystem,H.invertNormalMapY=H.va().useRightHandedSystem,void 0!=x.clearcoatNormalTexture.scale&&(H.clearCoat.bumpTexture.level=x.clearcoatNormalTexture.scale)),Promise.all(k).then((()=>{}))}}W(sR),N(sR,!0,(R=>new ER(R)));const wR="KHR_materials_iridescence";class hR{constructor(R){this.name=wR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(wR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadIridescencePropertiesAsync(k,c,H)),await Promise.all(t).then((()=>{}))}))}_loadIridescencePropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return H.iridescence.isEnabled=!0,H.iridescence.bb=x.iridescenceFactor??0,H.iridescence.indexOfRefraction=x.iridescenceIor??x.iridescenceIOR??1.3,H.iridescence.minimumThickness=x.iridescenceThicknessMinimum??100,H.iridescence.maximumThickness=x.iridescenceThicknessMaximum??400,x.iridescenceTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceTexture`,x.iridescenceTexture,(R=>{R.name=`${H.name} (Iridescence)`,H.iridescence.texture=R}))),x.iridescenceThicknessTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceThicknessTexture`,x.iridescenceThicknessTexture,(R=>{R.name=`${H.name} (Iridescence Thickness)`,H.iridescence.thicknessTexture=R}))),Promise.all(k).then((()=>{}))}}W(wR),N(wR,!0,(R=>new hR(R)));const fR="KHR_materials_anisotropy";class NR{constructor(R){this.name=fR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(fR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadIridescencePropertiesAsync(k,c,H)),await Promise.all(t)}))}async _loadIridescencePropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;H.anisotropy.isEnabled=!0,H.anisotropy.bb=x.anisotropyStrength??0,H.anisotropy.angle=x.anisotropyRotation??0,x.anisotropyTexture&&(x.anisotropyTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${R}/anisotropyTexture`,x.anisotropyTexture,(R=>{R.name=`${H.name} (Anisotropy Intensity)`,H.anisotropy.texture=R})))),await Promise.all(k)}}W(fR),N(fR,!0,(R=>new NR(R)));const WR="KHR_materials_emissive_strength";class KR{constructor(R){this.name=WR,this.order=170,this._loader=R,this.enabled=this._loader.isExtensionUsed(WR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>await this._loader.loadMaterialPropertiesAsync(R,x,H).then((()=>{this._loadEmissiveProperties(k,c,H)}))))}_loadEmissiveProperties(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);void 0!==x.emissiveStrength&&(H.emissiveIntensity=x.emissiveStrength)}}W(WR),N(WR,!0,(R=>new KR(R)));const QR="KHR_materials_sheen";class GR{constructor(R){this.name=QR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(QR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadSheenPropertiesAsync(k,c,H)),await Promise.all(t).then((()=>{}))}))}_loadSheenPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return H.sheen.isEnabled=!0,H.sheen.bb=1,void 0!=x.sheenColorFactor?H.sheen.color=t.c.zi(x.sheenColorFactor):H.sheen.color=t.c.Black(),x.sheenColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/sheenColorTexture`,x.sheenColorTexture,(R=>{R.name=`${H.name} (Sheen Color)`,H.sheen.texture=R}))),void 0!==x.sheenRoughnessFactor?H.sheen.roughness=x.sheenRoughnessFactor:H.sheen.roughness=0,x.sheenRoughnessTexture&&(x.sheenRoughnessTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${R}/sheenRoughnessTexture`,x.sheenRoughnessTexture,(R=>{R.name=`${H.name} (Sheen Roughness)`,H.sheen.textureRoughness=R})))),H.sheen.albedoScaling=!0,H.sheen.useRoughnessFromMainTexture=!1,Promise.all(k).then((()=>{}))}}W(QR),N(QR,!0,(R=>new GR(R)));var TR=H(12251);const vR="KHR_materials_specular";class pR{constructor(R){this.name=vR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(vR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;if(t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadSpecularPropertiesAsync(k,c,H)),c.extensions&&c.extensions.EXT_materials_specular_edge_color&&H instanceof C.e){c.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(H.brdf.dielectricSpecularModel=TR.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,H.brdf.conductorSpecularModel=TR.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(t).then((()=>{}))}))}_loadSpecularPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return void 0!==x.specularFactor&&(H.metallicF0Factor=x.specularFactor),void 0!==x.specularColorFactor&&(H.metallicReflectanceColor=t.c.zi(x.specularColorFactor)),x.specularTexture&&(x.specularTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${R}/specularTexture`,x.specularTexture,(R=>{R.name=`${H.name} (Specular)`,H.metallicReflectanceTexture=R,H.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),x.specularColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/specularColorTexture`,x.specularColorTexture,(R=>{R.name=`${H.name} (Specular Color)`,H.reflectanceTexture=R}))),Promise.all(k).then((()=>{}))}}W(vR),N(vR,!0,(R=>new pR(R)));const rR="KHR_materials_ior";class zR{constructor(R){this.name=rR,this.order=180,this._loader=R,this.enabled=this._loader.isExtensionUsed(rR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadIorPropertiesAsync(k,c,H)),await Promise.all(t).then((()=>{}))}))}_loadIorPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);return void 0!==x.ior?H.indexOfRefraction=x.ior:H.indexOfRefraction=zR._DEFAULT_IOR,Promise.resolve()}}zR._DEFAULT_IOR=1.5,W(rR),N(rR,!0,(R=>new zR(R)));const jR="KHR_materials_variants";class mR{constructor(R){this.name=jR,this._loader=R,this.enabled=this._loader.isExtensionUsed(jR)}dispose(){this._loader=null}static GetAvailableVariants(R){const x=this._GetExtensionMetadata(R);return x?Object.keys(x.variants):[]}getAvailableVariants(R){return mR.GetAvailableVariants(R)}static SelectVariant(R,x){const H=this._GetExtensionMetadata(R);if(!H)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${jR} extension`);const k=R=>{const x=H.variants[R];if(x)for(const H of x)H.mesh.material=H.material};if(x instanceof Array)for(const c of x)k(c);else k(x);H.lastSelected=x}selectVariant(R,x){mR.SelectVariant(R,x)}static Reset(R){const x=this._GetExtensionMetadata(R);if(!x)throw new Error(`Cannot reset on a glTF mesh that does not have the ${jR} extension`);for(const H of x.original)H.mesh.material=H.material;x.lastSelected=null}reset(R){mR.Reset(R)}static GetLastSelectedVariant(R){const x=this._GetExtensionMetadata(R);if(!x)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${jR} extension`);return x.lastSelected}getLastSelectedVariant(R){return mR.GetLastSelectedVariant(R)}static _GetExtensionMetadata(R){var x,H;return(null===R||void 0===R||null===(x=R._internalMetadata)||void 0===x||null===(H=x.Si)||void 0===H?void 0:H[jR])||null}onLoading(){const R=this._loader.Si.extensions;if(R&&R[this.name]){const x=R[this.name];this._variants=x.variants}}onReady(){const R=this._loader.rootBabylonMesh;if(R){var x;const H=this._loader.parent.extensionOptions[jR];null!==H&&void 0!==H&&H.defaultVariant&&mR.SelectVariant(R,H.defaultVariant),null===H||void 0===H||null===(x=H.onLoaded)||void 0===x||x.call(H,{get variants(){return mR.GetAvailableVariants(R)},get selectedVariant(){const x=mR.GetLastSelectedVariant(R);return x?Array.isArray(x)?x[0]:x:mR.GetAvailableVariants(R)[0]},set selectedVariant(x){mR.SelectVariant(R,x)}})}}_loadMeshPrimitiveAsync(R,x,H,k,c,t){return p.LoadExtensionAsync(R,c,this.name,(async(A,D)=>{const U=new Array;return U.push(this._loader._loadMeshPrimitiveAsync(R,x,H,k,c,(x=>{if(t(x),x instanceof M.d){const H=p._GetDrawMode(R,c.mode),k=this._loader.rootBabylonMesh,t=k?k._internalMetadata=k._internalMetadata||{}:{},J=t.Si=t.Si||{},V=J[jR]=J[jR]||{lastSelected:null,original:[],variants:{}};V.original.push({mesh:x,material:x.material});for(let R=0;R<D.mappings.length;++R){const c=D.mappings[R],t=T.Get(`${A}/mappings/${R}/material`,this._loader.Si.materials,c.material);U.push(this._loader._loadMaterialAsync(`#/materials/${c.material}`,t,x,H,(R=>{for(let H=0;H<c.variants.length;++H){const t=c.variants[H],A=T.Get(`/extensions/${jR}/variants/${t}`,this._variants,t);V.variants[A.name]=V.variants[A.name]||[],V.variants[A.name].push({mesh:x,material:R}),x.onClonedObservable.add((R=>{const H=R;let c=null,t=H;do{if(t=t.parent,!t)return;c=mR._GetExtensionMetadata(t)}while(null===c);if(k&&c===mR._GetExtensionMetadata(k)){t._internalMetadata={};for(const R in k._internalMetadata)t._internalMetadata[R]=k._internalMetadata[R];t._internalMetadata.Si=[];for(const R in k._internalMetadata.Si)t._internalMetadata.Si[R]=k._internalMetadata.Si[R];t._internalMetadata.Si[jR]={lastSelected:null,original:[],variants:{}};for(const R of c.original)t._internalMetadata.Si[jR].original.push({mesh:R.mesh,material:R.material});for(const R in c.variants)if(Object.prototype.hasOwnProperty.call(c.variants,R)){t._internalMetadata.Si[jR].variants[R]=[];for(const x of c.variants[R])t._internalMetadata.Si[jR].variants[R].push({mesh:x.mesh,material:x.material})}c=t._internalMetadata.Si[jR]}for(const k of c.original)k.mesh===x&&(k.mesh=H);for(const k of c.variants[A.name])k.mesh===x&&(k.mesh=H)}))}})))}}}))),await Promise.all(U).then((R=>{let[x]=R;return x}))}))}}W(jR),N(jR,!0,(R=>new mR(R)));var OR=H(2321);class lR{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:TR.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(R,x){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...lR._GetDefaultOptions(),...R},this._scene=x,this._scene._transmissionHelper=this,this.onErrorObservable=new V.d,this._scene.Vi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(R){if(!Object.keys(R).filter((x=>this._options[x]!==R[x])).length)return;const x={...this._options,...R},H=this._options;this._options=x,x.renderSize===H.renderSize&&x.renderTargetTextureType===H.renderTargetTextureType&&x.generateMipmaps===H.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=x.samples,this._opaqueRenderTarget.lodGenerationScale=x.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=x.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(R){return!!R&&!!(R instanceof C.e&&R.subSurface.isRefractionEnabled)}_addMesh(R){this._materialObservers[R.uniqueId]=R.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),A.e.SetImmediate((()=>{this._shouldRenderAsTransmission(R.material)?(R.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(R)&&this._transparentMeshesCache.push(R)):-1===this._opaqueMeshesCache.indexOf(R)&&this._opaqueMeshesCache.push(R)}))}_removeMesh(R){R.onMaterialChangedObservable.remove(this._materialObservers[R.uniqueId]),delete this._materialObservers[R.uniqueId];let x=this._transparentMeshesCache.indexOf(R);-1!==x&&this._transparentMeshesCache.splice(x,1),x=this._opaqueMeshesCache.indexOf(R),-1!==x&&this._opaqueMeshesCache.splice(x,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(R){const x=this._transparentMeshesCache.indexOf(R),H=this._opaqueMeshesCache.indexOf(R);this._shouldRenderAsTransmission(R.material)?(R.material instanceof C.e&&(R.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==H?(this._opaqueMeshesCache.splice(H,1),this._transparentMeshesCache.push(R)):-1===x&&this._transparentMeshesCache.push(R)):-1!==x?(this._transparentMeshesCache.splice(x,1),this._opaqueMeshesCache.push(R)):-1===H&&this._opaqueMeshesCache.push(R)}_isRenderTargetValid(){var R;return null!==(null===(R=this._opaqueRenderTarget)||void 0===R?void 0:R.getInternalTexture())}_setupRenderTargets(){var R;let x;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new OR.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(R=this._options.clearColor)||void 0===R?void 0:R.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((R=>{x=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?R.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(R.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=x}));for(const H of this._transparentMeshesCache)this._shouldRenderAsTransmission(H.material)&&(H.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const eR="KHR_materials_transmission";class uR{constructor(R){this.name=eR,this.order=175,this._loader=R,this.enabled=this._loader.isExtensionUsed(eR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadTransparentPropertiesAsync(k,x,H,c)),await Promise.all(t).then((()=>{}))}))}_loadTransparentPropertiesAsync(R,x,H,k){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const c=H;if(c.subSurface.isRefractionEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.useAlbedoToTintRefraction=!0,void 0===k.transmissionFactor)return c.subSurface.refractionIntensity=0,c.subSurface.isRefractionEnabled=!1,Promise.resolve();{var t;c.subSurface.refractionIntensity=k.transmissionFactor;const R=c.va();if(c.subSurface.refractionIntensity&&!R._transmissionHelper)new lR({},c.va());else if(c.subSurface.refractionIntensity&&(null===(t=R._transmissionHelper)||void 0===t||!t._isRenderTargetValid())){var A;null===(A=R._transmissionHelper)||void 0===A||A._setupRenderTargets()}}return c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,k.transmissionTexture?(k.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/transmissionTexture`,k.transmissionTexture,void 0).then((R=>{R.name=`${H.name} (Transmission)`,c.subSurface.refractionIntensityTexture=R,c.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(eR),N(eR,!0,(R=>new uR(R)));const YR="KHR_materials_diffuse_transmission";class Rx{constructor(R){this.name=YR,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(YR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadTranslucentPropertiesAsync(k,x,H,c)),await Promise.all(t).then((()=>{}))}))}_loadTranslucentPropertiesAsync(R,x,H,k){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const c=H;if(c.subSurface.isTranslucencyEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,c.subSurface.useAlbedoToTintTranslucency=!1,void 0===k.diffuseTransmissionFactor)return c.subSurface.translucencyIntensity=0,c.subSurface.isTranslucencyEnabled=!1,Promise.resolve();c.subSurface.translucencyIntensity=k.diffuseTransmissionFactor;const A=new Array;return c.subSurface.useGltfStyleTextures=!0,k.diffuseTransmissionTexture&&(k.diffuseTransmissionTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionTexture`,k.diffuseTransmissionTexture).then((R=>{R.name=`${H.name} (Diffuse Transmission)`,c.subSurface.translucencyIntensityTexture=R})))),void 0!==k.diffuseTransmissionColorFactor?c.subSurface.translucencyColor=t.c.zi(k.diffuseTransmissionColorFactor):c.subSurface.translucencyColor=t.c.White(),k.diffuseTransmissionColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionColorTexture`,k.diffuseTransmissionColorTexture).then((R=>{R.name=`${H.name} (Diffuse Transmission Color)`,c.subSurface.translucencyColorTexture=R}))),Promise.all(A).then((()=>{}))}}W(YR),N(YR,!0,(R=>new Rx(R)));const xx="KHR_materials_volume";class Hx{constructor(R){this.name=xx,this.order=173,this._loader=R,this.enabled=this._loader.isExtensionUsed(xx),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadVolumePropertiesAsync(k,x,H,c)),await Promise.all(t).then((()=>{}))}))}_loadVolumePropertiesAsync(R,x,H,k){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);if(!H.subSurface.isRefractionEnabled&&!H.subSurface.isTranslucencyEnabled||!k.thicknessFactor)return Promise.resolve();H.subSurface.volumeIndexOfRefraction=H.indexOfRefraction;const c=void 0!==k.attenuationDistance?k.attenuationDistance:Number.MAX_VALUE;return H.subSurface.tintColorAtDistance=c,void 0!==k.attenuationColor&&3==k.attenuationColor.length&&H.subSurface.tintColor.si(k.attenuationColor[0],k.attenuationColor[1],k.attenuationColor[2]),H.subSurface.minimumThickness=0,H.subSurface.maximumThickness=k.thicknessFactor,H.subSurface.useThicknessAsDepth=!0,k.thicknessTexture?(k.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/thicknessTexture`,k.thicknessTexture).then((R=>{R.name=`${H.name} (Thickness)`,H.subSurface.thicknessTexture=R,H.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(xx),N(xx,!0,(R=>new Hx(R)));const kx="KHR_materials_dispersion";class cx{constructor(R){this.name=kx,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(kx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadDispersionPropertiesAsync(k,x,H,c)),await Promise.all(t).then((()=>{}))}))}_loadDispersionPropertiesAsync(R,x,H,k){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);return H.subSurface.isRefractionEnabled&&k.dispersion?(H.subSurface.isDispersionEnabled=!0,H.subSurface.dispersion=k.dispersion,Promise.resolve()):Promise.resolve()}}W(kx),N(kx,!0,(R=>new cx(R)));const tx="EXT_materials_diffuse_roughness";class Ax{constructor(R){this.name=tx,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(tx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(R,x,H)),t.push(this._loadDiffuseRoughnessPropertiesAsync(k,c,H)),await Promise.all(t).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(R,x,H){if(!(H instanceof C.e))throw new Error(`${R}: Material type not supported`);const k=new Array;return H.brdf.baseDiffuseModel=TR.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=x.diffuseRoughnessFactor?H.baseDiffuseRoughness=x.diffuseRoughnessFactor:H.baseDiffuseRoughness=0,x.diffuseRoughnessTexture&&k.push(this._loader.loadTextureInfoAsync(`${R}/diffuseRoughnessTexture`,x.diffuseRoughnessTexture,(R=>{R.name=`${H.name} (Diffuse Roughness)`,H.baseDiffuseRoughnessTexture=R}))),Promise.all(k).then((()=>{}))}}W(tx),N(tx,!0,(R=>new Ax(R)));const Dx="KHR_mesh_quantization";class Ux{constructor(R){this.name=Dx,this.enabled=R.isExtensionUsed(Dx)}dispose(){}}W(Dx),N(Dx,!0,(R=>new Ux(R)));const Jx="KHR_texture_basisu";class Vx{constructor(R){this.name=Jx,this._loader=R,this.enabled=R.isExtensionUsed(Jx)}dispose(){this._loader=null}_loadTextureAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>{const t=void 0==x.sampler?p.DefaultSampler:T.Get(`${R}/sampler`,this._loader.Si.samplers,x.sampler),A=T.Get(`${k}/source`,this._loader.Si.images,c.source);return await this._loader._createTextureAsync(R,t,A,(R=>{H(R)}),x._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!x._textureInfo.nonColorData)}))}}W(Jx),N(Jx,!0,(R=>new Vx(R)));const nx="KHR_texture_transform";class gx{constructor(R){this.name=nx,this._loader=R,this.enabled=this._loader.isExtensionUsed(nx)}dispose(){this._loader=null}loadTextureInfoAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(k,c)=>await this._loader.loadTextureInfoAsync(R,x,(R=>{if(!(R instanceof F.d))throw new Error(`${k}: Texture type not supported`);c.offset&&(R.uOffset=c.offset[0],R.vOffset=c.offset[1]),R.uRotationCenter=0,R.vRotationCenter=0,c.rotation&&(R.wAng=-c.rotation),c.scale&&(R.uScale=c.scale[0],R.vScale=c.scale[1]),void 0!=c.texCoord&&(R.coordinatesIndex=c.texCoord),H(R)}))))}}W(nx),N(nx,!0,(R=>new gx(R)));const Ix="KHR_xmp_json_ld";class ix{constructor(R){this.name=Ix,this.order=100,this._loader=R,this.enabled=this._loader.isExtensionUsed(Ix)}dispose(){this._loader=null}onLoading(){var R,x,H;if(null===this._loader.rootBabylonMesh)return;const k=null===(R=this._loader.Si.extensions)||void 0===R?void 0:R.KHR_xmp_json_ld,c=null===(x=this._loader.Si.asset)||void 0===x||null===(H=x.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld;if(k&&c){const R=+c.packet;k.packets&&R<k.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=k.packets[R])}}}function qx(R,x,H,k){return t.c.zi(x,H).scale(k)}function Sx(R,x,H,k){return x[H]*k}function Lx(R,x,H,k){return-x[H]*k}function bx(R,x,H,k){return x[H+1]*k}function Cx(R,x,H,k){return x[H]*k*2}function Fx(R){return{scale:[new Px(g.c.ANIMATIONTYPE_FLOAT,`${R}.uScale`,Sx,(()=>2)),new Px(g.c.ANIMATIONTYPE_FLOAT,`${R}.vScale`,bx,(()=>2))],offset:[new Px(g.c.ANIMATIONTYPE_FLOAT,`${R}.uOffset`,Sx,(()=>2)),new Px(g.c.ANIMATIONTYPE_FLOAT,`${R}.vOffset`,bx,(()=>2))],rotation:[new Px(g.c.ANIMATIONTYPE_FLOAT,`${R}.wAng`,Lx,(()=>1))]}}W(Ix),N(Ix,!0,(R=>new ix(R)));class dx extends r.AnimationPropertyInfo{buildAnimations(R,x,H,k){return[{babylonAnimatable:R._babylonCamera,babylonAnimation:this._buildAnimation(x,H,k)}]}}class Px extends r.AnimationPropertyInfo{buildAnimations(R,x,H,k){const c=[];for(const t in R._data)c.push({babylonAnimatable:R._data[t].babylonMaterial,babylonAnimation:this._buildAnimation(x,H,k)});return c}}class ax extends r.AnimationPropertyInfo{buildAnimations(R,x,H,k){return[{babylonAnimatable:R._babylonLight,babylonAnimation:this._buildAnimation(x,H,k)}]}}(0,K.j)("/cameras/{}/orthographic/xmag",[new dx(g.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Lx,(()=>1)),new dx(g.c.ANIMATIONTYPE_FLOAT,"orthoRight",bx,(()=>1))]),(0,K.j)("/cameras/{}/orthographic/ymag",[new dx(g.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Lx,(()=>1)),new dx(g.c.ANIMATIONTYPE_FLOAT,"orthoTop",bx,(()=>1))]),(0,K.j)("/cameras/{}/orthographic/zfar",[new dx(g.c.ANIMATIONTYPE_FLOAT,"maxZ",Sx,(()=>1))]),(0,K.j)("/cameras/{}/orthographic/znear",[new dx(g.c.ANIMATIONTYPE_FLOAT,"Hi",Sx,(()=>1))]),(0,K.j)("/cameras/{}/perspective/yfov",[new dx(g.c.ANIMATIONTYPE_FLOAT,"fov",Sx,(()=>1))]),(0,K.j)("/cameras/{}/perspective/zfar",[new dx(g.c.ANIMATIONTYPE_FLOAT,"maxZ",Sx,(()=>1))]),(0,K.j)("/cameras/{}/perspective/znear",[new dx(g.c.ANIMATIONTYPE_FLOAT,"Hi",Sx,(()=>1))]),(0,K.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Px(g.c.ANIMATIONTYPE_COLOR3,"albedoColor",qx,(()=>4)),new Px(g.c.ANIMATIONTYPE_FLOAT,"alpha",(function(R,x,H,k){return x[H+3]*k}),(()=>4))]),(0,K.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"metallic",Sx,(()=>1))]),(0,K.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"roughness",Sx,(()=>1))]);const Xx=Fx("albedoTexture");(0,K.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Xx.scale),(0,K.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Xx.offset),(0,K.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Xx.rotation);const Mx=Fx("metallicTexture");(0,K.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Mx.scale),(0,K.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Mx.offset),(0,K.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Mx.rotation),(0,K.j)("/materials/{}/emissiveFactor",[new Px(g.c.ANIMATIONTYPE_COLOR3,"emissiveColor",qx,(()=>3))]);const Bx=Fx("bumpTexture");(0,K.j)("/materials/{}/normalTexture/scale",[new Px(g.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Sx,(()=>1))]),(0,K.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Bx.scale),(0,K.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Bx.offset),(0,K.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Bx.rotation),(0,K.j)("/materials/{}/occlusionTexture/strength",[new Px(g.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Sx,(()=>1))]);const ox=Fx("ambientTexture");(0,K.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",ox.scale),(0,K.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",ox.offset),(0,K.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",ox.rotation);const Zx=Fx("emissiveTexture");(0,K.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Zx.scale),(0,K.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Zx.offset),(0,K.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Zx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Px(g.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Px(g.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Sx,(()=>1))]);const yx=Fx("anisotropy.texture");(0,K.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",yx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",yx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",yx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Sx,(()=>1))]);const sx=Fx("clearCoat.texture");(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",sx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",sx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",sx.rotation);const Ex=Fx("clearCoat.bumpTexture");(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Px(g.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ex.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ex.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ex.rotation);const wx=Fx("clearCoat.textureRoughness");(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",wx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",wx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",wx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Px(g.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new Px(g.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Px(g.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Px(g.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Sx,(()=>1))]);const hx=Fx("iridescence.texture");(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",hx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",hx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",hx.rotation);const fx=Fx("iridescence.thicknessTexture");(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",fx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",fx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",fx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Px(g.c.ANIMATIONTYPE_COLOR3,"sheen.color",qx,(()=>3))]),(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Sx,(()=>1))]);const Nx=Fx("sheen.texture");(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Nx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Nx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Nx.rotation);const Wx=Fx("sheen.textureRoughness");(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Wx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Wx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Wx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Px(g.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",qx,(()=>3))]);const Kx=Fx("metallicReflectanceTexture");(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Kx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Kx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Kx.rotation);const Qx=Fx("reflectanceTexture");(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Qx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Qx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Qx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Sx,(()=>1))]);const Gx=Fx("subSurface.refractionIntensityTexture");(0,K.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Gx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Gx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Gx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Px(g.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",qx,(()=>3))]),(0,K.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Px(g.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Sx,(()=>1))]),(0,K.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Sx,(()=>1))]);const Tx=Fx("subSurface.thicknessTexture");(0,K.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Tx.scale),(0,K.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Tx.offset),(0,K.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Tx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Px(g.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Sx,(()=>1))]);const vx=Fx("subSurface.translucencyIntensityTexture");(0,K.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",vx.scale),(0,K.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",vx.offset),(0,K.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",vx.rotation),(0,K.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Px(g.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",qx,(()=>3))]);const px=Fx("subSurface.translucencyColorTexture");(0,K.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",px.scale),(0,K.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",px.offset),(0,K.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",px.rotation),(0,K.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new ax(g.c.ANIMATIONTYPE_COLOR3,"diffuse",qx,(()=>3))]),(0,K.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ax(g.c.ANIMATIONTYPE_FLOAT,"intensity",Sx,(()=>1))]),(0,K.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new ax(g.c.ANIMATIONTYPE_FLOAT,"range",Sx,(()=>1))]),(0,K.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ax(g.c.ANIMATIONTYPE_FLOAT,"innerAngle",Cx,(()=>1))]),(0,K.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ax(g.c.ANIMATIONTYPE_FLOAT,"angle",Cx,(()=>1))]),(0,K.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new ax(g.c.ANIMATIONTYPE_COLOR3,"diffuse",qx,(()=>3))]),(0,K.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ax(g.c.ANIMATIONTYPE_FLOAT,"intensity",Sx,(()=>1))]);const rx="KHR_animation_pointer";class zx{constructor(R){this.name=rx,this._loader=R,this._pathToObjectConverter=(0,K.g)(this._loader.Si)}get enabled(){return this._loader.isExtensionUsed(rx)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(R,x,H,k,c){var t;const A=null===(t=k.target.extensions)||void 0===t?void 0:t.KHR_animation_pointer;if(!A||!this._pathToObjectConverter)return null;"pointer"!==k.target.path&&q.c.Warn(`${R}/target/path: Value (${k.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=k.target.node&&q.c.Warn(`${R}/target/node: Value (${k.target.node}) must not be present when using the ${this.name} extension`);const D=`${R}/extensions/${this.name}`,U=A.pointer;if(!U)throw new Error(`${D}: Pointer is missing`);try{const t=this._pathToObjectConverter.convert(U);if(!t.info.interpolation)throw new Error(`${D}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(R,x,H,k,{object:t.object,info:t.info.interpolation},c)}catch(J){return q.c.Warn(`${D}/pointer: Invalid pointer (${U}) skipped`),null}}}W(rx),N(rx,!0,(R=>new zx(R)));class jx{constructor(R,x,H){this.frame=R,this.action=x,this.onlyOnce=H,this.isDone=!1}_clone(){return new jx(this.frame,this.action,this.onlyOnce)}}var mx=H(502),Ox=H(555),lx=H(546);class ex{get loop(){return this._loop}set loop(R){R!==this._loop&&(this._loop=R,this.updateOptions({loop:R}))}get currentTime(){var R;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.audioContext&&(this.isPlaying||this.isPaused)){const R=this.isPaused?0:Ox.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+R}return 0}get spatialSound(){return this._spatialSound}set spatialSound(R){if(R==this._spatialSound)return;const x=this.isPlaying;this.pause(),R?(this._spatialSound=R,this._updateSpatialParameters()):this._disableSpatialSound(),x&&this.play()}constructor(R,x,H){var k;let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new V.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=c.o.Zero(),this._localDirection=new c.o(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=R,H=H||i.c.LastCreatedScene)if(this._scene=H,ex._SceneComponentInitialization(H),this._readyToPlayCallback=t,this._customAttenuationFunction=(R,x,H,k,c)=>x<H?R*(1-x/H):0,D&&(this.autoplay=D.autoplay||!1,this._loop=D.loop||!1,void 0!==D.volume&&(this._volume=D.volume),this._spatialSound=D.spatialSound??!1,this.maxDistance=D.maxDistance??100,this.useCustomAttenuation=D.useCustomAttenuation??!1,this.rolloffFactor=D.rolloffFactor||1,this.refDistance=D.refDistance||1,this.distanceModel=D.distanceModel||"linear",this._playbackRate=D.playbackRate||1,this._streaming=D.streaming??!1,this._length=D.length,this._offset=D.offset),null!==(k=Ox.d.audioEngine)&&void 0!==k&&k.canUseWebAudio&&Ox.d.audioEngine.audioContext){this._soundGain=Ox.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let R=!0;if(x)try{"string"===typeof x?(this._urlType="String",this._url=x):x instanceof ArrayBuffer?this._urlType="ArrayBuffer":x instanceof HTMLMediaElement?this._urlType="MediaElement":x instanceof MediaStream?this._urlType="MediaStream":x instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(x)&&(this._urlType="Array");let H=[],k=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ox.d.audioEngine.audioContext.createMediaElementSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ox.d.audioEngine.audioContext.createMediaStreamSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":x.byteLength>0&&(k=!0,this._soundLoaded(x));break;case"AudioBuffer":this._audioBufferLoaded(x);break;case"String":H.push(x);case"Array":0===H.length&&(H=x);for(let R=0;R<H.length;R++){const x=H[R];if(k=D&&D.skipCodecCheck||-1!==x.indexOf(".mp3",x.length-4)&&Ox.d.audioEngine.isMP3supported||-1!==x.indexOf(".ogg",x.length-4)&&Ox.d.audioEngine.isOGGsupported||-1!==x.indexOf(".wav",x.length-4)||-1!==x.indexOf(".m4a",x.length-4)||-1!==x.indexOf(".mp4",x.length-4)||-1!==x.indexOf("blob:"),k){this._streaming?(this._htmlAudioElement=new Audio(x),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,A.e.SetCorsBehavior(x,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(x,(R=>{this._soundLoaded(R)}),void 0,!0,!0,(R=>{R&&q.c.Error("XHR "+R.status+" error on: "+x+"."),q.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:R=!1}R?k||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):q.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(U){q.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Ox.d.audioEngine&&!Ox.d.audioEngine.WarnedWebAudioUnsupported&&(q.c.Error("Web Audio is not supported by your browser."),Ox.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var R;null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(R){var x;null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.audioContext&&(this._audioBuffer=R,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(R){var x;null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.audioContext&&Ox.d.audioEngine.audioContext.decodeAudioData(R,(R=>{this._audioBufferLoaded(R)}),(R=>{q.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+R)}))}setAudioBuffer(R){var x;null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&(this._audioBuffer=R,this._isReadyToPlay=!0)}updateOptions(R){R&&(this.loop=R.loop??this.loop,this.maxDistance=R.maxDistance??this.maxDistance,this.useCustomAttenuation=R.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=R.rolloffFactor??this.rolloffFactor,this.refDistance=R.refDistance??this.refDistance,this.distanceModel=R.distanceModel??this.distanceModel,this._playbackRate=R.playbackRate??this._playbackRate,this._length=R.length??void 0,this.spatialSound=R.spatialSound??this._spatialSound,this._setOffset(R.offset??void 0),this.setVolume(R.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var R;null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&Ox.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Ox.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var R;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(R=this._soundPanner)||void 0===R||R.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var R;null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(R){var x;null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(R),this._isOutputConnected=!0)}setDirectionalCone(R,x,H){x<R?q.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=R,this._coneOuterAngle=x,this._coneOuterGain=H,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!=this._coneInnerAngle){var x;if(this._coneOuterAngle<R)return void q.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R,null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!=this._coneOuterAngle){var x;if(R<this._coneInnerAngle)return void q.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R,null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(R){var x;R.equals(this._position)||(this._position.p(R),null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(R){var x;this._localDirection=R,null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const R=this._connectedTransformNode.getWorldMatrix(),x=c.o.TransformNormal(this._localDirection,R);x.normalize(),this._soundPanner.orientationX.value=x.x,this._soundPanner.orientationY.value=x.y,this._soundPanner.orientationZ.value=x.z}updateDistanceFromListener(){var R;if(null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const R=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Pg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,R,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(R){this._customAttenuationFunction=R}play(R,x,H){var k;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(k=Ox.d.audioEngine)&&void 0!==k&&k.audioContext)try{var c,t;this._clearTimeoutsAndObservers();let k=R?(null===(c=Ox.d.audioEngine)||void 0===c?void 0:c.audioContext.currentTime)+R:null===(t=Ox.d.audioEngine)||void 0===t?void 0:t.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Ox.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const R=()=>{var H;if(null!==(H=Ox.d.audioEngine)&&void 0!==H&&H.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=x??0;const H=this._htmlAudioElement.play();void 0!==H&&H.catch((()=>{var x,H;(null===(x=Ox.d.audioEngine)||void 0===x||x.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(H=Ox.d.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{R()})))}))}else{var k;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(k=Ox.d.audioEngine)||void 0===k?void 0:k.onAudioUnlockedObservable.addOnce((()=>{R()}))}};R()}}else{var A;const c=()=>{var c;if(null!==(c=Ox.d.audioEngine)&&void 0!==c&&c.audioContext){var t;if(H=H||this._length,void 0!==x&&this._setOffset(x),this._soundSource){const R=this._soundSource;R.onended=()=>{R.disconnect()}}if(this._soundSource=null===(t=Ox.d.audioEngine)||void 0===t?void 0:t.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var A;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==x&&(this._soundSource.loopStart=x),void 0!==H&&(this._soundSource.loopEnd=(0|x)+H),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},k=R?(null===(A=Ox.d.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+R:Ox.d.audioEngine.audioContext.currentTime;const c=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(k,c,this.loop?void 0:H)}}};"suspended"===(null===(A=Ox.d.audioEngine)||void 0===A?void 0:A.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var R;"suspended"===(null===(R=Ox.d.audioEngine)||void 0===R?void 0:R.audioContext.state)?(Ox.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Ox.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{c()})))):c()}),500):c()}this._startTime=k,this.isPlaying=!0,this.isPaused=!1}catch(D){q.c.Error("Error while trying to play audio: "+this.name+", "+D.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(R){var x;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1}else if(null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.audioContext&&this._soundSource){const x=R?Ox.d.audioEngine.audioContext.currentTime+R:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(x)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var R;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var x;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(x=this._streamingSource)||void 0===x||x.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Ox.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(R,x){var H;null!==(H=Ox.d.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._soundGain&&(x&&Ox.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ox.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ox.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(R,Ox.d.audioEngine.audioContext.currentTime+x)):this._soundGain.gain.value=R),this._volume=R}setPlaybackRate(R){this._playbackRate=R,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(R){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=R,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=R=>this._onRegisterAfterWorldMatrixUpdate(R),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(R){var x;if(R.getBoundingInfo){const x=R.getBoundingInfo();this.setPosition(x.boundingSphere.centerWorld)}else this.setPosition(R.absolutePosition);null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const R=()=>{(0,lx.e)((()=>this._isReadyToPlay),(()=>{H._audioBuffer=this.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,this._offset,this._length)}),void 0,300)},x={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},H=new ex(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,x);return this.useCustomAttenuation&&H.setAttenuationFunction(this._customAttenuationFunction),H.setPosition(this._position),H.setPlaybackRate(this._playbackRate),R(),H}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const R={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(R.connectedMeshId=this._connectedTransformNode.id),R.position=this._position.Li(),R.refDistance=this.refDistance,R.distanceModel=this.distanceModel,R.isDirectional=this._isDirectional,R.localDirectionToMesh=this._localDirection.Li(),R.coneInnerAngle=this._coneInnerAngle,R.coneOuterAngle=this._coneOuterAngle,R.coneOuterGain=this._coneOuterGain),R}static Parse(R,x,H,k){const t=R.name;let A;A=R.url?H+R.url:H+t;const D={autoplay:R.autoplay,loop:R.loop,volume:R.volume,spatialSound:R.spatialSound,maxDistance:R.maxDistance,rolloffFactor:R.rolloffFactor,refDistance:R.refDistance,distanceModel:R.distanceModel,playbackRate:R.playbackRate};let U;if(k){const R=()=>{(0,lx.e)((()=>k._isReadyToPlay),(()=>{U._audioBuffer=k.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,U._offset,U._length)}),void 0,300)};U=new ex(t,new ArrayBuffer(0),x,null,D),R()}else U=new ex(t,A,x,(()=>{x.removePendingData(U)}),D),x.addPendingData(U);if(R.position){const x=c.o.zi(R.position);U.setPosition(x)}if(R.isDirectional&&(U.setDirectionalCone(R.coneInnerAngle||360,R.coneOuterAngle||360,R.coneOuterGain||0),R.localDirectionToMesh)){const x=c.o.zi(R.localDirectionToMesh);U.setLocalDirectionToMesh(x)}if(R.connectedMeshId){const H=x.getMeshById(R.connectedMeshId);H&&U.attachToMesh(H)}return R.metadata&&(U.metadata=R.metadata),U}_setOffset(R){this._offset!==R&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=R)}_clearTimeoutsAndObservers(){var R;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(R=Ox.d.audioEngine)||void 0===R||R.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}ex._SceneComponentInitialization=R=>{throw(0,mx.d)("AudioSceneComponent")},(0,PR.h)("BABYLON.Sound",ex);class ux{constructor(R,x,H){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],x.length!==H.length)throw new Error("Sounds length does not equal weights length");this.loop=R,this._weights=H;let k=0;for(const t of H)k+=t;const c=k>0?1/k:0;for(let t=0;t<this._weights.length;t++)this._weights[t]*=c;this._sounds=x;for(const t of this._sounds)t.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!==this._coneInnerAngle){if(this._coneOuterAngle<R)return void q.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R;for(const x of this._sounds)x.directionalConeInnerAngle=R}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!==this._coneOuterAngle){if(R<this._coneInnerAngle)return void q.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R;for(const x of this._sounds)x.directionalConeOuterAngle=R}}get volume(){return this._volume}set volume(R){if(R!==this._volume)for(const x of this._sounds)x.setVolume(R)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(R){if(!this.isPaused){this.stop();const R=Math.random();let x=0;for(let H=0;H<this._weights.length;H++)if(x+=this._weights[H],R<=x){this._currentIndex=H;break}}const x=this._sounds[this._currentIndex??0];x.isReady()?x.play(0,this.isPaused?void 0:R):x.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Yx{constructor(R){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(R=R||i.c.LastCreatedScene)&&(this._scene=R,this.soundCollection=[],this._options=x,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var R;null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.canUseWebAudio&&Ox.d.audioEngine.audioContext&&(this._outputAudioNode=Ox.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ox.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Ox.d.audioEngine&&Ox.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(R){var x;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&R.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==R.soundTrackId&&(-1===R.soundTrackId?this._scene.mainSoundTrack.removeSound(R):this._scene.soundTracks&&this._scene.soundTracks[R.soundTrackId].removeSound(R)),this.soundCollection.push(R),R.soundTrackId=this.id}removeSound(R){const x=this.soundCollection.indexOf(R);-1!==x&&this.soundCollection.splice(x,1)}setVolume(R){var x;null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=R)}switchPanningModelToHRTF(){var R;if(null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var R;if(null!==(R=Ox.d.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToEqualPower()}connectToAnalyser(R){var x;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=R,null!==(x=Ox.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ox.d.audioEngine.masterGain))}}var RH=H(856),xH=H(2445),HH=H(487);Ox.d.AudioEngineFactory=(R,x,H)=>new kH(R,x,H);class kH{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new V.d,this.onAudioLockedObservable=new V.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,HH.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const k=document.createElement("audio");this._hostElement=R,this._audioContext=x,this._audioDestination=H;try{k&&k.canPlayType&&(k.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||k.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(c){}try{k&&k.canPlayType&&k.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(c){}}lock(){this._triggerSuspendedState()}unlock(){var R,x;if("running"===(null===(R=this._audioContext)||void 0===R?void 0:R.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(x=this._audioContext)||void 0===x||x.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{q.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var R;null===(R=this._audioContext)||void 0===R||R.addEventListener("statechange",(()=>{var R;this.unlocked&&"running"!==(null===(R=this._audioContext)||void 0===R?void 0:R.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var R;return null!==(R=this._audioContext)&&void 0!==R&&R.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(R){this.canUseWebAudio=!1,q.c.Error("Web Audio: "+R.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(R){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const R=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",x=document.createElement("style");x.appendChild(document.createTextNode(R)),document.getElementsByTagName("head")[0].appendChild(x),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var R;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(R=this._audioContext)||void 0===R||R.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(R){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=R)}connectToAnalyser(R){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=R,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var cH=H(500);(0,H(12934).g)(RH.d.NAME_AUDIO,((R,x,H,k)=>{let c,t=[];if(H.qm=H.qm||[],void 0!==R.qm&&null!==R.qm)for(let D=0,U=R.qm.length;D<U;D++){var A;const U=R.qm[D];null!==(A=Ox.d.audioEngine)&&void 0!==A&&A.canUseWebAudio?(U.url||(U.url=U.name),t[U.url]?H.qm.push(ex.Parse(U,x,k,t[U.url])):(c=ex.Parse(U,x,k),t[U.url]=c,H.qm.push(c))):H.qm.push(new ex(U.name,null,x))}t=[]})),Object.defineProperty(xH.e.prototype,"mainSoundTrack",{get:function(){let R=this._getComponent(RH.d.NAME_AUDIO);return R||(R=new tH(this),this.o(R)),this._mainSoundTrack||(this._mainSoundTrack=new Yx(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),xH.e.prototype.getSoundByName=function(R){let x;for(x=0;x<this.mainSoundTrack.soundCollection.length;x++)if(this.mainSoundTrack.soundCollection[x].name===R)return this.mainSoundTrack.soundCollection[x];if(this.soundTracks)for(let H=0;H<this.soundTracks.length;H++)for(x=0;x<this.soundTracks[H].soundCollection.length;x++)if(this.soundTracks[H].soundCollection[x].name===R)return this.soundTracks[H].soundCollection[x];return null},Object.defineProperty(xH.e.prototype,"audioEnabled",{get:function(){let R=this._getComponent(RH.d.NAME_AUDIO);return R||(R=new tH(this),this.o(R)),R.audioEnabled},set:function(R){let x=this._getComponent(RH.d.NAME_AUDIO);x||(x=new tH(this),this.o(x)),R?x.enableAudio():x.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(xH.e.prototype,"headphone",{get:function(){let R=this._getComponent(RH.d.NAME_AUDIO);return R||(R=new tH(this),this.o(R)),R.headphone},set:function(R){let x=this._getComponent(RH.d.NAME_AUDIO);x||(x=new tH(this),this.o(x)),R?x.switchAudioModeForHeadphones():x.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(xH.e.prototype,"audioListenerPositionProvider",{get:function(){let R=this._getComponent(RH.d.NAME_AUDIO);return R||(R=new tH(this),this.o(R)),R.audioListenerPositionProvider},set:function(R){let x=this._getComponent(RH.d.NAME_AUDIO);if(x||(x=new tH(this),this.o(x)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");x.audioListenerPositionProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(xH.e.prototype,"audioListenerRotationProvider",{get:function(){let R=this._getComponent(RH.d.NAME_AUDIO);return R||(R=new tH(this),this.o(R)),R.audioListenerRotationProvider},set:function(R){let x=this._getComponent(RH.d.NAME_AUDIO);if(x||(x=new tH(this),this.o(x)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");x.audioListenerRotationProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(xH.e.prototype,"audioPositioningRefreshRate",{get:function(){let R=this._getComponent(RH.d.NAME_AUDIO);return R||(R=new tH(this),this.o(R)),R.audioPositioningRefreshRate},set:function(R){let x=this._getComponent(RH.d.NAME_AUDIO);x||(x=new tH(this),this.o(x)),x.audioPositioningRefreshRate=R},enumerable:!0,configurable:!0});class tH{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(R){this.name=RH.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new c.o,this._cachedCameraPosition=new c.o,this._lastCheck=0,this._invertMatrixTemp=new c.e,this._cameraDirectionTemp=new c.o,(R=R||i.c.LastCreatedScene)&&(this.Yk=R,R.soundTracks=[],R.qm=[])}register(){this.Yk._afterRenderStage.registerStep(RH.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(R){if(R.qm=[],this.Yk.soundTracks)for(let x=0;x<this.Yk.soundTracks.length;x++){const H=this.Yk.soundTracks[x];for(let x=0;x<H.soundCollection.length;x++)R.qm.push(H.soundCollection[x].serialize())}}addFromContainer(R){if(R.qm)for(const x of R.qm)x.play(),x.autoplay=!0,this.Yk.mainSoundTrack.addSound(x)}removeFromContainer(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(R.qm)for(const H of R.qm)H.stop(),H.autoplay=!1,this.Yk.mainSoundTrack.removeSound(H),x&&H.dispose()}dispose(){const R=this.Yk;if(R._mainSoundTrack&&R.mainSoundTrack.dispose(),R.soundTracks)for(let x=0;x<R.soundTracks.length;x++)R.soundTracks[x].dispose()}disableAudio(){const R=this.Yk;let x;for(this._audioEnabled=!1,Ox.d.audioEngine&&Ox.d.audioEngine.audioContext&&Ox.d.audioEngine.audioContext.suspend(),x=0;x<R.mainSoundTrack.soundCollection.length;x++)R.mainSoundTrack.soundCollection[x].pause();if(R.soundTracks)for(x=0;x<R.soundTracks.length;x++)for(let H=0;H<R.soundTracks[x].soundCollection.length;H++)R.soundTracks[x].soundCollection[H].pause()}enableAudio(){const R=this.Yk;let x;for(this._audioEnabled=!0,Ox.d.audioEngine&&Ox.d.audioEngine.audioContext&&Ox.d.audioEngine.audioContext.resume(),x=0;x<R.mainSoundTrack.soundCollection.length;x++)R.mainSoundTrack.soundCollection[x].isPaused&&R.mainSoundTrack.soundCollection[x].play();if(R.soundTracks)for(x=0;x<R.soundTracks.length;x++)for(let H=0;H<R.soundTracks[x].soundCollection.length;H++)R.soundTracks[x].soundCollection[H].isPaused&&R.soundTracks[x].soundCollection[H].play()}switchAudioModeForHeadphones(){const R=this.Yk;if(this._headphone=!0,R.mainSoundTrack.switchPanningModelToHRTF(),R.soundTracks)for(let x=0;x<R.soundTracks.length;x++)R.soundTracks[x].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const R=this.Yk;if(this._headphone=!1,R.mainSoundTrack.switchPanningModelToEqualPower(),R.soundTracks)for(let x=0;x<R.soundTracks.length;x++)R.soundTracks[x].switchPanningModelToEqualPower()}_afterRender(){const R=cH.c.Now;if(this._lastCheck&&R-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=R;const x=this.Yk;if(!this._audioEnabled||!x._mainSoundTrack||!x.soundTracks||0===x._mainSoundTrack.soundCollection.length&&1===x.soundTracks.length)return;const H=Ox.d.audioEngine;if(H&&H.audioContext){let R,k=x.activeCamera;if(x.activeCameras&&x.activeCameras.length>0&&(k=x.activeCameras[0]),this.audioListenerPositionProvider){const R=this.audioListenerPositionProvider();H.audioContext.listener.setPosition(R.x||0,R.y||0,R.z||0)}else k?this._cachedCameraPosition.equals(k.globalPosition)||(this._cachedCameraPosition.p(k.globalPosition),H.audioContext.listener.setPosition(k.globalPosition.x,k.globalPosition.y,k.globalPosition.z)):H.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const R=this.audioListenerRotationProvider();H.audioContext.listener.setOrientation(R.x||0,R.y||0,R.z||0,0,1,0)}else k?(k.rigCameras&&k.rigCameras.length>0&&(k=k.rigCameras[0]),k.getViewMatrix().invertToRef(this._invertMatrixTemp),c.o.TransformNormalToRef(tH._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),H.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):H.audioContext.listener.setOrientation(0,0,0,0,1,0);for(R=0;R<x.mainSoundTrack.soundCollection.length;R++){const H=x.mainSoundTrack.soundCollection[R];H.useCustomAttenuation&&H.updateDistanceFromListener()}if(x.soundTracks)for(R=0;R<x.soundTracks.length;R++)for(let H=0;H<x.soundTracks[R].soundCollection.length;H++){const k=x.soundTracks[R].soundCollection[H];k.useCustomAttenuation&&k.updateDistanceFromListener()}}}}tH._CameraDirection=new c.o(0,0,-1),ex._SceneComponentInitialization=R=>{let x=R._getComponent(RH.d.NAME_AUDIO);x||(x=new tH(R),R.o(x))};const AH="MSFT_audio_emitter";class DH{constructor(R){this.name=AH,this._loader=R,this.enabled=this._loader.isExtensionUsed(AH)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const R=this._loader.Si.extensions;if(R&&R[this.name]){const x=R[this.name];this._clips=x.clips,this._emitters=x.emitters,T.Assign(this._clips),T.Assign(this._emitters)}}loadSceneAsync(R,x){return p.LoadExtensionAsync(R,x,this.name,(async(H,k)=>{const c=new Array;c.push(this._loader.loadSceneAsync(R,x));for(const R of k.emitters){const x=T.Get(`${H}/emitters`,this._emitters,R);if(void 0!=x.refDistance||void 0!=x.maxDistance||void 0!=x.rolloffFactor||void 0!=x.distanceModel||void 0!=x.innerAngle||void 0!=x.outerAngle)throw new Error(`${H}: Direction or Distance properties are not allowed on emitters attached to a scene`);c.push(this._loadEmitterAsync(`${H}/emitters/${x.index}`,x))}await Promise.all(c)}))}loadNodeAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(R,k)=>{const t=new Array,D=await this._loader.loadNodeAsync(R,x,(x=>{for(const H of k.emitters){const k=T.Get(`${R}/emitters`,this._emitters,H);t.push(this._loadEmitterAsync(`${R}/emitters/${k.index}`,k).then((()=>{for(const R of k._babylonSounds)R.attachToMesh(x),void 0==k.innerAngle&&void 0==k.outerAngle||(R.setLocalDirectionToMesh(c.o.Forward()),R.setDirectionalCone(2*A.e.ToDegrees(void 0==k.innerAngle?Math.PI:k.innerAngle),2*A.e.ToDegrees(void 0==k.outerAngle?Math.PI:k.outerAngle),0))})))}H(x)}));return await Promise.all(t),D}))}loadAnimationAsync(R,x){return p.LoadExtensionAsync(R,x,this.name,(async(H,k)=>{const c=await this._loader.loadAnimationAsync(R,x),t=new Array;T.Assign(k.events);for(const A of k.events)t.push(this._loadAnimationEventAsync(`${H}/events/${A.index}`,R,x,A,c));return await Promise.all(t),c}))}_loadClipAsync(R,x){if(x._objectURL)return x._objectURL;let H;if(x.uri)H=this._loader.loadUriAsync(R,x,x.uri);else{const k=T.Get(`${R}/bufferView`,this._loader.Si.bufferViews,x.bufferView);H=this._loader.loadBufferViewAsync(`/bufferViews/${k.index}`,k)}return x._objectURL=H.then((R=>URL.createObjectURL(new Blob([R],{type:x.mimeType})))),x._objectURL}_loadEmitterAsync(R,x){if(x._babylonSounds=x._babylonSounds||[],!x._babylonData){const R=new Array,H=x.name||`emitter${x.index}`,k={loop:!1,autoplay:!1,volume:void 0==x.volume?1:x.volume};for(let t=0;t<x.clips.length;t++){const c=`/extensions/${this.name}/clips`,A=T.Get(c,this._clips,x.clips[t].clip);R.push(this._loadClipAsync(`${c}/${x.clips[t].clip}`,A).then((R=>{const c=x._babylonSounds[t]=new ex(H,R,this._loader.babylonScene,null,k);c.refDistance=x.refDistance||1,c.maxDistance=x.maxDistance||256,c.rolloffFactor=x.rolloffFactor||1,c.distanceModel=x.distanceModel||"exponential"})))}const c=Promise.all(R).then((()=>{const R=x.clips.map((R=>R.weight||1)),H=new ux(x.loop||!1,x._babylonSounds,R);x.innerAngle&&(H.directionalConeInnerAngle=2*A.e.ToDegrees(x.innerAngle)),x.outerAngle&&(H.directionalConeOuterAngle=2*A.e.ToDegrees(x.outerAngle)),x.volume&&(H.volume=x.volume),x._babylonData.sound=H}));x._babylonData={loaded:c}}return x._babylonData.loaded}_getEventAction(R,x,H,k,c){switch(H){case"play":return R=>{const H=(c||0)+(R-k);x.play(H)};case"stop":return()=>{x.stop()};case"pause":return()=>{x.pause()};default:throw new Error(`${R}: Unsupported action ${H}`)}}_loadAnimationEventAsync(R,x,H,k,c){if(0==c.targetedAnimations.length)return Promise.resolve();const t=c.targetedAnimations[0],A=k.j,D=T.Get(`/extensions/${this.name}/emitters`,this._emitters,A);return this._loadEmitterAsync(R,D).then((()=>{const x=D._babylonData.sound;if(x){const H=new jx(k.time,this._getEventAction(R,x,k.action,k.time,k.startOffset));t.animation.addEvent(H),c.onAnimationGroupEndObservable.add((()=>{x.stop()})),c.onAnimationGroupPauseObservable.add((()=>{x.pause()}))}}))}}W(AH),N(AH,!0,(R=>new DH(R)));const UH="MSFT_lod";class JH{constructor(R){var x;this.name=UH,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new V.d,this.onMaterialLODsLoadedObservable=new V.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=R,this.maxLODsToLoad=(null===(x=this._loader.parent.extensionOptions[UH])||void 0===x?void 0:x.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(UH)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let R=0;R<this._nodePromiseLODs.length;R++){const x=Promise.all(this._nodePromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Node LOD ${R}`),this._loader.log(`Loaded node LOD ${R}`)),this.onNodeLODsLoadedObservable.notifyObservers(R),R!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${R+1}`),this._loadBufferLOD(this._nodeBufferLODs,R+1),this._nodeSignalLODs[R]&&this._nodeSignalLODs[R].resolve())}));this._loader._completePromises.push(x)}for(let R=0;R<this._materialPromiseLODs.length;R++){const x=Promise.all(this._materialPromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Material LOD ${R}`),this._loader.log(`Loaded material LOD ${R}`)),this.onMaterialLODsLoadedObservable.notifyObservers(R),R!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${R+1}`),this._loadBufferLOD(this._materialBufferLODs,R+1),this._materialSignalLODs[R]&&this._materialSignalLODs[R].resolve())}));this._loader._completePromises.push(x)}}loadSceneAsync(R,x){const H=this._loader.loadSceneAsync(R,x);return this._loadBufferLOD(this._bufferLODs,0),H}loadNodeAsync(R,x,H){return p.LoadExtensionAsync(R,x,this.name,(async(R,c)=>{let t;const A=this._getLODs(R,x,this._loader.Si.nodes,c.ids);this._loader.logOpen(`${R}`);for(let x=0;x<A.length;x++){const R=A[x];0!==x&&(this._nodeIndexLOD=x,this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new k);const c=R=>{H(R),R.oi(!1)},D=this._loader.loadNodeAsync(`/nodes/${R.index}`,R,c).then((R=>{if(0!==x){const R=A[x-1];R._babylonTransformNode&&(this._disposeTransformNode(R._babylonTransformNode),delete R._babylonTransformNode)}return R.oi(!0),R}));this._nodePromiseLODs[x]=this._nodePromiseLODs[x]||[],0===x?t=D:(this._nodeIndexLOD=null,this._nodePromiseLODs[x].push(D))}return this._loader.logClose(),await t}))}_loadMaterialAsync(R,x,H,k,c){return this._nodeIndexLOD?null:p.LoadExtensionAsync(R,x,this.name,(async(R,t)=>{let A;const D=this._getLODs(R,x,this._loader.Si.materials,t.ids);this._loader.logOpen(`${R}`);for(let x=0;x<D.length;x++){const R=D[x];0!==x&&(this._materialIndexLOD=x);const t=this._loader._loadMaterialAsync(`/materials/${R.index}`,R,H,k,(R=>{0===x&&c(R)})).then((R=>{if(0!==x){c(R);const H=D[x-1]._data;H[k]&&(this._disposeMaterials([H[k].babylonMaterial]),delete H[k])}return R}));this._materialPromiseLODs[x]=this._materialPromiseLODs[x]||[],0===x?A=t:(this._materialIndexLOD=null,this._materialPromiseLODs[x].push(t))}return this._loader.logClose(),await A}))}_loadUriAsync(R,x,H){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const c=this._nodeIndexLOD-1;return this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new k,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(R,x,H)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const c=this._materialIndexLOD-1;return this._materialSignalLODs[c]=this._materialSignalLODs[c]||new k,this._materialSignalLODs[c].promise.then((async()=>await this._loader.loadUriAsync(R,x,H)))}return null}loadBufferAsync(R,x,H,c){if(this._loader.parent.useRangeRequests&&!x.uri){if(!this._loader.bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);const x=async(R,x)=>{const t=H,A=t+c-1;let D=R[x];return D?(D.start=Math.min(D.start,t),D.end=Math.max(D.end,A)):(D={start:t,end:A,loaded:new k},R[x]=D),await D.loaded.promise.then((R=>new Uint8Array(R.buffer,R.byteOffset+H-D.start,c)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?x(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?x(this._materialBufferLODs,this._materialIndexLOD):x(this._bufferLODs,0)}return null}_loadBufferLOD(R,x){const H=R[x];H&&(this._loader.log(`Loading buffer range [${H.start}-${H.end}]`),this._loader.bin.readAsync(H.start,H.end-H.start+1).then((R=>{H.loaded.resolve(R)}),(R=>{H.loaded.reject(R)})))}_getLODs(R,x,H,k){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const c=[];for(let t=k.length-1;t>=0;t--)if(c.push(T.Get(`${R}/ids/${k[t]}`,H,k[t])),c.length===this.maxLODsToLoad)return c;return c.push(x),c}_disposeTransformNode(R){const x=[],H=R.material;H&&x.push(H);for(const c of R.getChildMeshes())c.material&&x.push(c.material);R.dispose();const k=x.filter((R=>this._loader.babylonScene.meshes.every((x=>x.material!=R))));this._disposeMaterials(k)}_disposeMaterials(R){const x={};for(const H of R){for(const R of H.getActiveTextures())x[R.uniqueId]=R;H.dispose()}for(const H in x)for(const R of this._loader.babylonScene.materials)R.hasTexture(x[H])&&delete x[H];for(const H in x)x[H].dispose()}}W(UH),N(UH,!0,(R=>new JH(R)));const VH="MSFT_minecraftMesh";class nH{constructor(R){this.name=VH,this._loader=R,this.enabled=this._loader.isExtensionUsed(VH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtraAsync(R,x,this.name,(async(k,c)=>{if(c){if(!(H instanceof C.e))throw new Error(`${k}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(R,x,H);return H.needAlphaBlending()&&(H.forceDepthWrite=!0,H.separateCullingPass=!0),H.Ki=H.forceDepthWrite,H.twoSidedLighting=!0,await c}}))}}W(VH),N(VH,!0,(R=>new nH(R)));const gH="MSFT_sRGBFactors";class IH{constructor(R){this.name=gH,this._loader=R,this.enabled=this._loader.isExtensionUsed(gH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,x,H){return p.LoadExtraAsync(R,x,this.name,(async(k,c)=>{if(c){if(!(H instanceof C.e))throw new Error(`${k}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(R,x,H),t=H.va().getEngine().useExactSrgbConversions;return H.albedoTexture||H.albedoColor.toLinearSpaceToRef(H.albedoColor,t),H.reflectivityTexture||H.reflectivityColor.toLinearSpaceToRef(H.reflectivityColor,t),await c}}))}}W(gH),N(gH,!0,(R=>new IH(R)));var iH=H(13229);const qH={};var SH=H(13290),LH=H(13262),bH=H(13236),CH=H(13246);function FH(R,x){for(const H of R)for(const R of H.dataOutputs)if(R.uniqueId===x)return R;throw new Error("Could not find data out connection with unique id "+x)}function dH(R,x){for(const H of R)if(H instanceof LH.d)for(const R of H.signalInputs)if(R.uniqueId===x)return R;throw new Error("Could not find signal in connection with unique id "+x)}async function PH(R,x){const k=await Promise.all(R.allBlocks.map((async R=>{const x=function(R){switch(R){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([H.e(62),H.e(63)]).then(H.bind(H,14415))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await H.e(64).then(H.bind(H,14422))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await H.e(65).then(H.bind(H,14427))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await H.e(66).then(H.bind(H,14434))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await H.e(67).then(H.bind(H,14438))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await H.e(68).then(H.bind(H,14447))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await H.e(69).then(H.bind(H,14450))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await H.e(70).then(H.bind(H,14459))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await H.e(71).then(H.bind(H,14462))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await H.e(74).then(H.bind(H,14493))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await H.e(74).then(H.bind(H,14493))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await H.e(74).then(H.bind(H,14493))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await H.e(74).then(H.bind(H,14493))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await H.e(79).then(H.bind(H,14496))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await H.e(80).then(H.bind(H,14505))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await H.e(81).then(H.bind(H,14508))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await H.e(82).then(H.bind(H,14510))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await H.e(83).then(H.bind(H,14516))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await H.e(84).then(H.bind(H,14523))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await H.e(85).then(H.bind(H,14530))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await H.e(86).then(H.bind(H,14538))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await H.e(87).then(H.bind(H,14540))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await H.e(88).then(H.bind(H,14547))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await H.e(89).then(H.bind(H,14554))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await H.e(90).then(H.bind(H,14556))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await H.e(91).then(H.bind(H,14558))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await H.e(92).then(H.bind(H,14564))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await H.e(93).then(H.bind(H,14569))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await H.e(94).then(H.bind(H,14578))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await H.e(95).then(H.bind(H,14586))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await H.e(96).then(H.bind(H,14593))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await H.e(97).then(H.bind(H,14595))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await H.e(76).then(H.bind(H,14601))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await H.e(98).then(H.bind(H,14604))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await H.e(99).then(H.bind(H,14607))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await H.e(100).then(H.bind(H,14611))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await H.e(77).then(H.bind(H,14619))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await H.e(72).then(H.bind(H,14464))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await H.e(78).then(H.bind(H,14627))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await H.e(73).then(H.bind(H,14484))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await H.e(74).then(H.bind(H,14493))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await H.e(74).then(H.bind(H,14493))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await H.e(75).then(H.bind(H,14629))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await H.e(75).then(H.bind(H,14629))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await H.e(75).then(H.bind(H,14629))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await H.e(75).then(H.bind(H,14629))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await H.e(75).then(H.bind(H,14629))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await H.e(75).then(H.bind(H,14629))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await H.e(101).then(H.bind(H,14633))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await H.e(102).then(H.bind(H,14638))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await H.e(103).then(H.bind(H,14646))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await H.e(104).then(H.bind(H,14654))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await H.e(105).then(H.bind(H,14663))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await H.e(106).then(H.bind(H,14668))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await H.e(107).then(H.bind(H,14672))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await H.e(108).then(H.bind(H,14680))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await H.e(109).then(H.bind(H,14684))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await H.e(110).then(H.bind(H,14691))).FlowGraphDataSwitchBlock;default:if(qH[R])return qH[R];throw new Error(`Unknown block name ${R}`)}}(R.className);return await x()})));return function(R,x,H){const k=x.coordinator.createGraph(),c=[],t=x.valueParseFunction??bH.d;for(let A=0;A<R.allBlocks.length;A++){const D=XH(R.allBlocks[A],{Yk:x.coordinator.config.Yk,pathConverter:x.pathConverter,assetsContainer:x.coordinator.config.Yk,valueParseFunction:t},H[A]);c.push(D),D instanceof SH.d&&k.addEventBlock(D)}for(const A of c){for(const R of A.dataInputs)for(const x of R.connectedPointIds){const H=FH(c,x);R.connectTo(H)}if(A instanceof LH.d)for(const R of A.signalOutputs)for(const x of R.connectedPointIds){const H=dH(c,x);R.connectTo(H)}}for(const A of R.executionContexts)aH(A,{graph:k,valueParseFunction:t},R.rightHanded);return k}(R,x,k)}function aH(R,x,H){const k=x.graph.createContext();R.enableLogging&&(k.enableLogging=!0),k.treatDataAsRightHanded=H||!1;const c=x.valueParseFunction??bH.d;k.uniqueId=R.uniqueId;const t=k.va();if(R._assetsContext){var A,D,U,J,V,n,g,I,i,q;const x=R._assetsContext,H={meshes:null===(A=x.meshes)||void 0===A?void 0:A.map((R=>t.getMeshById(R))),lights:null===(D=x.lights)||void 0===D?void 0:D.map((R=>t.getLightByName(R))),cameras:null===(U=x.cameras)||void 0===U?void 0:U.map((R=>t.getCameraByName(R))),materials:null===(J=x.materials)||void 0===J?void 0:J.map((R=>t.getMaterialById(R))),textures:null===(V=x.textures)||void 0===V?void 0:V.map((R=>t.getTextureByName(R))),animations:null===(n=x.animations)||void 0===n?void 0:n.map((R=>t.animations.find((x=>x.name===R)))),skeletons:null===(g=x.skeletons)||void 0===g?void 0:g.map((R=>t.getSkeletonByName(R))),Ei:null===(I=x.Ei)||void 0===I?void 0:I.map((R=>t.getParticleSystemById(R))),animationGroups:null===(i=x.animationGroups)||void 0===i?void 0:i.map((R=>t.getAnimationGroupByName(R))),transformNodes:null===(q=x.transformNodes)||void 0===q?void 0:q.map((R=>t.getTransformNodeById(R))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],qm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};k.assetsContext=H}for(const S in R._userVariables){const x=c(S,R._userVariables,k.assetsContext,t);k.userVariables[S]=x}for(const S in R._connectionValues){const x=c(S,R._connectionValues,k.assetsContext,t);k._setConnectionValueByKey(S,x)}return k}function XH(R,x,H){const k={},c=x.valueParseFunction??bH.d;if(R.config)for(const A in R.config)k[A]=c(A,R.config,x.assetsContainer||x.Yk,x.Yk);if((0,bH.j)(R.className)){if(!x.pathConverter)throw new Error("Path converter is required for this block");k.pathConverter=x.pathConverter}const t=new H(k);t.uniqueId=R.uniqueId;for(let A=0;A<R.dataInputs.length;A++){const x=t.getDataInput(R.dataInputs[A].name);if(!x)throw new Error("Could not find data input with name "+R.dataInputs[A].name+" in block "+R.className);x.deserialize(R.dataInputs[A])}for(let A=0;A<R.dataOutputs.length;A++){const x=t.getDataOutput(R.dataOutputs[A].name);if(!x)throw new Error("Could not find data output with name "+R.dataOutputs[A].name+" in block "+R.className);x.deserialize(R.dataOutputs[A])}return t.metadata=R.metadata,t.deserialize&&t.deserialize(R),t}function MH(R){const[x,H]=R.split(":");return BH({op:x,extension:H})}function BH(R){var x;let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const k=R.extension?null===(x=ZH[R.extension])||void 0===x?void 0:x[R.op]:yH[R.op];if(!k&&(q.c.Warn(`No mapping found for operation ${R.op} and extension ${R.extension||"KHR_interactivity"}`),H)){const x={},H={flows:{}};if(R.inputValueSockets){x.values={};for(const H in R.inputValueSockets)x.values[H]={name:H}}return R.outputValueSockets&&(H.values={},Object.keys(R.outputValueSockets).forEach((R=>{H.values[R]={name:R}}))),{Ng:[],inputs:x,outputs:H}}return k}function oH(R,x,H){ZH[x]||(ZH[x]={}),ZH[x][R]=H}const ZH={BABYLON:{"flow/log":{Ng:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},yH={"event/onStart":{Ng:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Ng:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Ng:["FlowGraphSendCustomEventBlock"],extraProcessor(R,x,H,k,c){if("event/send"!==x.op||!R.configuration||1!==Object.keys(R.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=R.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const A=k.arrays.events[t],D=c[0];return D.config||(D.config={}),D.config.eventId=A.eventId,D.config.eventData=A.eventData,c}},"event/receive":{Ng:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(R,x){var H;if(!R.configuration)return q.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const k=R.configuration.event;if(!k)return q.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const c=k.value[0];if("number"!==typeof c)return q.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(H=x.events)||void 0===H?void 0:H[c])?{valid:!0}:(q.c.Error(`Event with id ${c} not found`),{valid:!1,error:`Event with id ${c} not found`})},extraProcessor(R,x,H,k,c){if("event/receive"!==x.op||!R.configuration||1!==Object.keys(R.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=R.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const A=k.arrays.events[t],D=c[0];return D.config||(D.config={}),D.config.eventId=A.eventId,D.config.eventData=A.eventData,c}},"math/e":sH("FlowGraphEBlock"),"math/pi":sH("FlowGraphPIBlock"),"math/inf":sH("FlowGraphInfBlock"),"math/nan":sH("FlowGraphNaNBlock"),"math/abs":sH("FlowGraphAbsBlock"),"math/sign":sH("FlowGraphSignBlock"),"math/trunc":sH("FlowGraphTruncBlock"),"math/floor":sH("FlowGraphFloorBlock"),"math/ceil":sH("FlowGraphCeilBlock"),"math/round":{Ng:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c){var t;return(t=c[0]).config||(t.config={}),c[0].config.roundHalfAwayFromZero=!0,c}},"math/fract":sH("FlowGraphFractBlock"),"math/neg":sH("FlowGraphNegationBlock"),"math/add":sH("FlowGraphAddBlock",["a","b"],!0),"math/sub":sH("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Ng:["FlowGraphMultiplyBlock"],extraProcessor(R,x,H,k,c){var t;(t=c[0]).config||(t.config={}),c[0].config.useMatrixPerComponent=!0,c[0].config.preventIntegerFloatArithmetic=!0;let A=-1;return Object.keys(R.values||{}).find((x=>{var H;return void 0!==(null===(H=R.values)||void 0===H?void 0:H[x].type)&&(A=R.values[x].type,!0)})),-1!==A&&(c[0].config.type=k.arrays.types[A].flowGraphType),c},validation:R=>R.values?EH(R):{valid:!0}},"math/div":sH("FlowGraphDivideBlock",["a","b"],!0),"math/rem":sH("FlowGraphModuloBlock",["a","b"]),"math/min":sH("FlowGraphMinBlock",["a","b"]),"math/max":sH("FlowGraphMaxBlock",["a","b"]),"math/clamp":sH("FlowGraphClampBlock",["a","b","c"]),"math/saturate":sH("FlowGraphSaturateBlock"),"math/mix":sH("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":sH("FlowGraphEqualityBlock",["a","b"]),"math/lt":sH("FlowGraphLessThanBlock",["a","b"]),"math/le":sH("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":sH("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":sH("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":sH("FlowGraphIsNaNBlock"),"math/isinf":sH("FlowGraphIsInfBlock"),"math/select":{Ng:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Ng:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":sH("FlowGraphSinBlock"),"math/cos":sH("FlowGraphCosBlock"),"math/tan":sH("FlowGraphTanBlock"),"math/asin":sH("FlowGraphASinBlock"),"math/acos":sH("FlowGraphACosBlock"),"math/atan":sH("FlowGraphATanBlock"),"math/atan2":sH("FlowGraphATan2Block",["a","b"]),"math/sinh":sH("FlowGraphSinhBlock"),"math/cosh":sH("FlowGraphCoshBlock"),"math/tanh":sH("FlowGraphTanhBlock"),"math/asinh":sH("FlowGraphASinhBlock"),"math/acosh":sH("FlowGraphACoshBlock"),"math/atanh":sH("FlowGraphATanhBlock"),"math/exp":sH("FlowGraphExponentialBlock"),"math/log":sH("FlowGraphLogBlock"),"math/log2":sH("FlowGraphLog2Block"),"math/log10":sH("FlowGraphLog10Block"),"math/sqrt":sH("FlowGraphSquareRootBlock"),"math/cbrt":sH("FlowGraphCubeRootBlock"),"math/pow":sH("FlowGraphPowerBlock",["a","b"]),"math/length":sH("FlowGraphLengthBlock"),"math/normalize":sH("FlowGraphNormalizeBlock"),"math/dot":sH("FlowGraphDotBlock",["a","b"]),"math/cross":sH("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":sH("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":sH("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Ng:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Ng:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Ng:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Ng:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Ng:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Ng:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Ng:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":sH("FlowGraphTransposeBlock"),"math/determinant":sH("FlowGraphDeterminantBlock"),"math/inverse":sH("FlowGraphInvertMatrixBlock"),"math/matmul":sH("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Ng:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ti",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c,t){const A=c[0].dataInputs.find((R=>"rotationQuaternion"===R.name));if(!A)throw new Error("Rotation quaternion input not found");return t._connectionValues[A.uniqueId]&&(t._connectionValues[A.uniqueId].type="Quaternion"),c}},"math/matDecompose":{Ng:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ti"}}}},"math/quatConjugate":sH("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Ng:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c){var t;return(t=c[0]).config||(t.config={}),c[0].config.type="Quaternion",c}},"math/quatAngleBetween":sH("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Ng:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":sH("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":sH("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Ng:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c){var t;return(t=c[0]).config||(t.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract2x2":{Ng:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Ng:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c){var t;return(t=c[0]).config||(t.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract3x3":{Ng:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Ng:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c){var t;return(t=c[0]).config||(t.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract4x4":{Ng:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Ng:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c,t){var A,D;(D=c[0]).config||(D.config={});const U=c[0].dataInputs[0];return c[0].config.valueType=(null===(A=t._connectionValues[U.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",c}},"math/and":{Ng:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c,t){var A,D,U;(U=c[0]).config||(U.config={});const J=c[0].dataInputs[0],V=c[0].dataInputs[1];return c[0].config.valueType=(null===(A=t._connectionValues[J.uniqueId])||void 0===A?void 0:A.type)??(null===(D=t._connectionValues[V.uniqueId])||void 0===D?void 0:D.type)??"FlowGraphInteger",c}},"math/or":{Ng:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c,t){var A,D,U;(U=c[0]).config||(U.config={});const J=c[0].dataInputs[0],V=c[0].dataInputs[1];return c[0].config.valueType=(null===(A=t._connectionValues[J.uniqueId])||void 0===A?void 0:A.type)??(null===(D=t._connectionValues[V.uniqueId])||void 0===D?void 0:D.type)??"FlowGraphInteger",c}},"math/xor":{Ng:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(R,x,H,k,c,t){var A,D,U;(U=c[0]).config||(U.config={});const J=c[0].dataInputs[0],V=c[0].dataInputs[1];return c[0].config.valueType=(null===(A=t._connectionValues[J.uniqueId])||void 0===A?void 0:A.type)??(null===(D=t._connectionValues[V.uniqueId])||void 0===D?void 0:D.type)??"FlowGraphInteger",c}},"math/asr":sH("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":sH("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":sH("FlowGraphLeadingZerosBlock"),"math/ctz":sH("FlowGraphTrailingZerosBlock"),"math/popcnt":sH("FlowGraphOneBitsCounterBlock"),"math/rad":sH("FlowGraphDegToRadBlock"),"math/deg":sH("FlowGraphRadToDegBlock"),"type/boolToInt":sH("FlowGraphBooleanToInt"),"type/boolToFloat":sH("FlowGraphBooleanToFloat"),"type/intToBool":sH("FlowGraphIntToBoolean"),"type/intToFloat":sH("FlowGraphIntToFloat"),"type/floatToInt":sH("FlowGraphFloatToInt"),"type/floatToBool":sH("FlowGraphFloatToBoolean"),"flow/sequence":{Ng:["FlowGraphSequenceBlock"],extraProcessor(R,x,H,k,c){const t=c[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(R.flows||[]).length,t.signalOutputs.forEach(((R,x)=>{R.name="out_"+x})),c}},"flow/branch":{Ng:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Ng:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(R){if(R.configuration&&R.configuration.cases){const x=R.configuration.cases.value;if(!x.every((R=>"number"===typeof R&&/^-?\d+$/.test(R.toString()))))return q.c.Warn("Switch cases should be integers. Using empty array instead."),R.configuration.cases.value=[],{valid:!0};const H=new Set(x);R.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(R,x,H,k,c){if("flow/switch"!==x.op||!R.flows||0===Object.keys(R.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return c[0].signalOutputs.forEach((R=>{"default"!==R.name&&(R.name="out_"+R.name)})),c}},"flow/while":{Ng:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Ng:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(R,x,H,k,c){const t=c[0];return t.config||(t.config={}),t.config.incrementIndexWhenLoopDone=!0,c}},"flow/doN":{Ng:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Ng:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(R,x,H,k,c){if("flow/multiGate"!==x.op||!R.flows||0===Object.keys(R.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const t=c[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(R.flows).length,t.signalOutputs.forEach(((R,x)=>{R.name="out_"+x})),c}},"flow/waitAll":{Ng:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(R){var x,H;return"number"!==typeof(null===(x=R.configuration)||void 0===x||null===(H=x.inputFlows)||void 0===H?void 0:H.value[0])&&(R.configuration=R.configuration||{inputFlows:{value:[0]}},R.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Ng:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Ng:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Ng:["FlowGraphCancelDelayBlock"]},"variable/get":{Ng:["FlowGraphGetVariableBlock"],validation(R){var x,H;return null!==(x=R.configuration)&&void 0!==x&&null!==(H=x.variable)&&void 0!==H&&H.value?{valid:!0}:(q.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(R,x)=>[x.getVariableName(R[0])]}}},"variable/set":{Ng:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(R,x)=>[x.getVariableName(R[0])]}}},"variable/setMultiple":{Ng:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(R,x)=>[R[0].map((R=>x.getVariableName(R)))]}},extraProcessor:(R,x,H,k,c)=>(c[0].dataInputs.forEach((R=>{R.name=k.getVariableName(+R.name)})),c)},"variable/interpolate":{Ng:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(R,x)=>[x.getVariableName(R[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:R=>!0===R[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(R,x,H,k,c){var t,A,D;const U=c[0],J=null===(t=R.configuration)||void 0===t?void 0:t.variable.value[0];if("number"!==typeof J)throw q.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const V=k.arrays.staticVariables[J];"undefined"===typeof U.config.animationType.value&&(k.arrays.staticVariables,U.config.animationType.value=(0,CH.y)(V.type));const n=c[4];return n.config||(n.config={}),(A=n.config).variable||(A.variable={}),n.config.variable.value=k.getVariableName(J),(D=c[3]).config||(D.config={}),c}},"pointer/get":{Ng:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(R,x,H,k,c)=>(c.forEach((R=>{"FlowGraphJsonPointerParserBlock"===R.className&&(R.config||(R.config={}),R.config.outputValue=!0)})),c)},"pointer/set":{Ng:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(R,x,H,k,c)=>(c.forEach((R=>{"FlowGraphJsonPointerParserBlock"===R.className&&(R.config||(R.config={}),R.config.outputValue=!0)})),c)},"pointer/interpolate":{Ng:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(R,x,H,k,c)=>(c.forEach((x=>{"FlowGraphJsonPointerParserBlock"===x.className?(x.config||(x.config={}),x.config.outputValue=!0):"FlowGraphInterpolationBlock"===x.className&&(x.config||(x.config={}),Object.keys(R.values||[]).forEach((H=>{var c;const t=null===(c=R.values)||void 0===c?void 0:c[H];if("value"===H&&t){const R=t.type;void 0!==R&&(x.config.animationType=k.arrays.types[R].flowGraphType)}})))})),c)},"animation/start":{Ng:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(R,x)=>[R[0]*x._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(R,x)=>[R[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(R,x,H,k,c,t,A){const D=c[c.length-1];return D.config||(D.config={}),D.config.glTF=A,c}},"animation/stop":{Ng:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(R,x,H,k,c,t,A){const D=c[c.length-1];return D.config||(D.config={}),D.config.glTF=A,c}},"animation/stopAt":{Ng:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(R,x)=>[R[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(R,x,H,k,c,t,A){const D=c[c.length-1];return D.config||(D.config={}),D.config.glTF=A,c}},"math/switch":{Ng:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(R){if(R.configuration&&R.configuration.cases){const x=R.configuration.cases.value;if(!x.every((R=>"number"===typeof R&&/^-?\d+$/.test(R.toString()))))return q.c.Warn("Switch cases should be integers. Using empty array instead."),R.configuration.cases.value=[],{valid:!0};const H=new Set(x);R.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(R,x,H,k,c){const t=c[0];return t.dataInputs.forEach((R=>{"default"!==R.name&&"case"!==R.name&&(R.name="in_"+R.name)})),t.config||(t.config={}),t.config.treatCasesAsIntegers=!0,c}},"debug/log":{Ng:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function sH(R){let x=arguments.length>2?arguments[2]:void 0;return{Ng:[R],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((R,x)=>(R[x]={name:x},R)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(R,H,k,c,t){var A;if(x){(A=t[0]).config||(A.config={}),t[0].config.preventIntegerFloatArithmetic=!0;let x=-1;Object.keys(R.values||{}).find((H=>{var k;return void 0!==(null===(k=R.values)||void 0===k?void 0:k[H].type)&&(x=R.values[H].type,!0)})),-1!==x&&(t[0].config.type=c.arrays.types[x].flowGraphType)}return t},validation:R=>x?EH(R):{valid:!0}}}function EH(R){if(R.values){const x=Object.keys(R.values).map((x=>R.values[x].type)).filter((R=>void 0!==R));if(!x.every((R=>R===x[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}yH["math/compose"]=yH["math/matCompose"],yH["math/decompose"]=yH["math/matDecompose"];var wH=H(612);const hH={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Bi",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class fH{constructor(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=R,this._gltf=x,this._animationTargetFps=H,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const R of this._interactivityGraph.types)this._types.push(hH[R.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const R of this._interactivityGraph.declarations){const x=BH(R);if(!x)throw q.c.Error(["No mapping found for declaration",R]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:x,fullOperationName:R.extension?R.op+":"+R.extension:R.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const R of this._interactivityGraph.variables){const x=this._parseVariable(R);this._staticVariables.push(x)}}_parseVariable(R,x){const H=this._types[R.type];if(!H)throw q.c.Error(["No type found for variable",R]),new Error("Error parsing variables");if(R.value&&R.value.length!==H.length)throw q.c.Error(["Invalid value length for variable",R,H]),new Error("Error parsing variables");const k=R.value||[];if(!k.length)switch(H.flowGraphType){case"boolean":k.push(!1);break;case"FlowGraphInteger":k.push(0);break;case"number":k.push(NaN);break;case"Vector2":k.push(NaN,NaN);break;case"Bi":k.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":k.fill(NaN,0,4);break;case"Matrix":k.fill(NaN,0,16);break;case"Matrix3D":k.fill(NaN,0,9)}return"number"===H.elementType&&"string"===typeof k[0]&&(k[0]=parseFloat(k[0])),{type:H.flowGraphType,value:x?x(k,this):k}}_parseEvents(){if(this._interactivityGraph.events)for(const R of this._interactivityGraph.events){const x={eventId:R.id||"internalEvent_"+this._internalEventsCounter++};R.values&&(x.eventData=Object.keys(R.values).map((x=>{var H;const k=null===(H=R.values)||void 0===H?void 0:H[x];if(!k)throw q.c.Error(["No value found for event key",x]),new Error("Error parsing events");const c=this._types[k.type];if(!c)throw q.c.Error(["No type found for event value",k]),new Error("Error parsing events");const t="undefined"!==typeof k.value?this._parseVariable(k):void 0;return{id:x,type:c.flowGraphType,eventData:!0,value:t}}))),this._events.push(x)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const x of this._interactivityGraph.nodes){if("number"!==typeof x.declaration)throw q.c.Error(["No declaration found for node",x]),new Error("Error parsing nodes");const H=this._mappings[x.declaration];if(!H)throw q.c.Error(["No mapping found for node",x]),new Error("Error parsing nodes");if(H.flowGraphMapping.validation){const k=H.flowGraphMapping.validation(x,this._interactivityGraph,this._gltf);var R;if(!k.valid)throw new Error(`Error validating interactivity node ${null===(R=this._interactivityGraph.declarations)||void 0===R?void 0:R[x.declaration].op} - ${k.error}`)}const k=[];for(const R of H.flowGraphMapping.Ng){const c=this._getEmptyBlock(R,H.fullOperationName);this._parseNodeConfiguration(x,c,H.flowGraphMapping,R),k.push(c)}this._nodes.push({Ng:k,fullOperationName:H.fullOperationName})}}_getEmptyBlock(R,x){return{uniqueId:(0,wH.e)(),className:R,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:x,metadata:{}}}_parseNodeConfiguration(R,x,H,k){const c=x.config;if(R.configuration){const x=Object.keys(R.configuration);for(const D of x){var t,A;const x=null===(t=R.configuration)||void 0===t?void 0:t[D];if(!x)throw q.c.Error(["No value found for node configuration",D]),new Error("Error parsing node configuration");const U=null===(A=H.configuration)||void 0===A?void 0:A[D];if(U&&U.toBlock?U.toBlock===k:0===H.Ng.indexOf(k)){const R=(null===U||void 0===U?void 0:U.name)||D;x&&"undefined"!==typeof x.value||"undefined"===typeof(null===U||void 0===U?void 0:U.defaultValue)?x.value.length>=0?c[R]={value:1===x.value.length?x.value[0]:x.value}:q.c.Warn(["Invalid value for node configuration",x]):c[R]={value:U.defaultValue},U&&U.dataTransformer&&(c[R].value=U.dataTransformer([c[R].value],this)[0])}}}}_parseNodeConnections(R){for(let P=0;P<this._nodes.length;P++){var x;const a=null===(x=this._interactivityGraph.nodes)||void 0===x?void 0:x[P];if(!a)throw q.c.Error(["No node found for interactivity node",this._nodes[P]]),new Error("Error parsing node connections");const X=this._nodes[P],M=this._mappings[a.declaration];if(!M)throw q.c.Error(["No mapping found for node",a]),new Error("Error parsing node connections");const B=a.flows||{},o=Object.keys(B).sort();for(const R of o){var H,k,c,t;const x=B[R],J=null===(H=M.flowGraphMapping.outputs)||void 0===H||null===(k=H.flows)||void 0===k?void 0:k[R],V=(null===J||void 0===J?void 0:J.name)||R,n=this._createNewSocketConnection(V,!0);(J&&J.toBlock&&X.Ng.find((R=>R.className===J.toBlock))||X.Ng[0]).signalOutputs.push(n);const g=x.node,I=this._nodes[g];if(!I)throw q.c.Error(["No node found for input node id",g]),new Error("Error parsing node connections");const i=MH(I.fullOperationName);if(!i)throw q.c.Error(["No mapping found for input node",I]),new Error("Error parsing node connections");let S=null===(c=i.inputs)||void 0===c||null===(t=c.flows)||void 0===t?void 0:t[x.socket||"in"],L=!1;if(!S)for(const R in null===(A=i.inputs)||void 0===A?void 0:A.flows){var A,D,U;if(R.startsWith("[")&&R.endsWith("]"))L=!0,S=null===(D=i.inputs)||void 0===D||null===(U=D.flows)||void 0===U?void 0:U[R]}const b=S?L?S.name.replace("$1",x.socket||""):S.name:x.socket||"in",C=S&&S.toBlock&&I.Ng.find((R=>R.className===S.toBlock))||I.Ng[0];let F=C.signalInputs.find((R=>R.name===b));F||(F=this._createNewSocketConnection(b),C.signalInputs.push(F)),F.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(F.uniqueId)}const Z=a.values||{},y=Object.keys(Z);for(const x of y){var J,V;const H=Z[x];let k=null===(J=M.flowGraphMapping.inputs)||void 0===J||null===(V=J.values)||void 0===V?void 0:V[x],c=!1;if(!k)for(const R in null===(n=M.flowGraphMapping.inputs)||void 0===n?void 0:n.values){var n,g,I;if(R.startsWith("[")&&R.endsWith("]"))c=!0,k=null===(g=M.flowGraphMapping.inputs)||void 0===g||null===(I=g.values)||void 0===I?void 0:I[R]}const t=k?c?k.name.replace("$1",x):k.name:x,A=this._createNewSocketConnection(t);if((k&&k.toBlock&&X.Ng.find((R=>R.className===k.toBlock))||X.Ng[0]).dataInputs.push(A),void 0!==H.value){const x=this._parseVariable(H,k&&k.dataTransformer);R._connectionValues[A.uniqueId]=x}else{if("undefined"===typeof H.node)throw q.c.Error(["Invalid value for value connection",H]),new Error("Error parsing node connections");{var i,S,L;const R=H.node,x=H.socket||"value",k=this._nodes[R];if(!k)throw q.c.Error(["No node found for output socket reference",H]),new Error("Error parsing node connections");const c=MH(k.fullOperationName);if(!c)throw q.c.Error(["No mapping found for output socket reference",H]),new Error("Error parsing node connections");let t=null===(i=c.outputs)||void 0===i||null===(S=i.values)||void 0===S?void 0:S[x],D=!1;if(!t)for(const H in null===(b=c.outputs)||void 0===b?void 0:b.values){var b,C,F;if(H.startsWith("[")&&H.endsWith("]"))D=!0,t=null===(C=c.outputs)||void 0===C||null===(F=C.values)||void 0===F?void 0:F[H]}const U=t?D?t.name.replace("$1",x):null===(L=t)||void 0===L?void 0:L.name:x,J=t&&t.toBlock&&k.Ng.find((R=>R.className===t.toBlock))||k.Ng[0];let V=J.dataOutputs.find((R=>R.name===U));V||(V=this._createNewSocketConnection(U,!0),J.dataOutputs.push(V)),A.connectedPointIds.push(V.uniqueId),V.connectedPointIds.push(A.uniqueId)}}}if(M.flowGraphMapping.interBlockConnectors)for(const R of M.flowGraphMapping.interBlockConnectors){const x=R.input,H=R.output,k=R.isVariable;this._connectFlowGraphNodes(x,H,X.Ng[R.inputBlockIndex],X.Ng[R.outputBlockIndex],k)}if(M.flowGraphMapping.extraProcessor){var d;const x=null===(d=this._interactivityGraph.declarations)||void 0===d?void 0:d[a.declaration];if(!x)throw q.c.Error(["No declaration found for extra processor",a]),new Error("Error parsing node connections");X.Ng=M.flowGraphMapping.extraProcessor(a,x,M.flowGraphMapping,this,X.Ng,R,this._gltf)}}}_createNewSocketConnection(R,x){return{uniqueId:(0,wH.e)(),name:R,_connectionType:x?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(R,x,H,k,c){const t=c?H.dataInputs:H.signalInputs,A=c?k.dataOutputs:k.signalOutputs,D=t.find((x=>x.name===R))||this._createNewSocketConnection(R),U=A.find((R=>R.name===x))||this._createNewSocketConnection(x,!0);t.find((x=>x.name===R))||t.push(D),A.find((R=>R.name===x))||A.push(U),D.connectedPointIds.push(U.uniqueId),U.connectedPointIds.push(D.uniqueId)}getVariableName(R){return"staticVariable_"+R}serializeToFlowGraph(){const R={uniqueId:(0,wH.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(R);for(let x=0;x<this._staticVariables.length;x++){const H=this._staticVariables[x];R._userVariables[this.getVariableName(x)]=H}return{rightHanded:!0,allBlocks:this._nodes.reduce(((R,x)=>R.concat(x.Ng)),[]),executionContexts:[R]}}}const NH="KHR_interactivity";class WH{constructor(R){this._loader=R,this.name=NH,this.enabled=this._loader.isExtensionUsed(NH),this._pathConverter=(0,K.g)(this._loader.Si),R._skipStartAnimationStep=!0;const x=R.babylonScene;x&&function(R){(0,K.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!R.activeCamera)return new c.f(NaN,NaN,NaN,NaN);const x=c.f.FromRotationMatrix(R.activeCamera.getWorldMatrix()).normalize();return R.useRightHandedSystem||(x.w*=-1,x.x*=-1),x},type:"Quaternion",getTarget:()=>R.activeCamera}),(0,K.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!R.activeCamera)return new c.o(NaN,NaN,NaN);const x=R.activeCamera.getWorldMatrix().getTranslation();return R.useRightHandedSystem||(x.x*=-1),x},type:"Bi",getTarget:()=>R.activeCamera}),(0,K.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:R=>{var x;return(null===(x=R._babylonAnimationGroup)||void 0===x?void 0:x.isPlaying)??!1},type:"boolean",getTarget:R=>R._babylonAnimationGroup}),(0,K.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:R=>{var x;return((null===(x=R._babylonAnimationGroup)||void 0===x?void 0:x.from)??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup}),(0,K.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:R=>{var x;return((null===(x=R._babylonAnimationGroup)||void 0===x?void 0:x.to)??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup}),(0,K.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:R=>{var x;return((null===(x=R._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup}),(0,K.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:R=>{var x;return((null===(x=R._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:R=>R._babylonAnimationGroup})}(x)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var R;if(!this._loader.babylonScene||!this._pathConverter)return;const x=this._loader.babylonScene,H=null===(R=this._loader.Si.extensions)||void 0===R?void 0:R.KHR_interactivity;if(!H)return;const k=new iH.d({Yk:x});k.dispatchEventsSynchronously=!1;const c=H.graphs.map((R=>new fH(R,this._loader.Si,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(c.map((async R=>await PH(R,{coordinator:k,pathConverter:this._pathConverter})))),k.start()}}var KH;KH=async()=>(await Promise.resolve().then(H.bind(H,13306))).FlowGraphGLTFDataProvider,qH[`${NH}/${"FlowGraphGLTFDataProvider"}`]=KH,W(NH),N(NH,!0,(R=>new WH(R)));const QH="KHR_node_visibility";(0,K.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:R=>{const x=R._babylonTransformNode;return!x||void 0===x.isVisible||x.isVisible},set:(R,x)=>{var H,k;null===(H=x._primitiveBabylonMeshes)||void 0===H||H.forEach((R=>{R.inheritVisibility=!0})),x._babylonTransformNode&&(x._babylonTransformNode.isVisible=R),null===(k=x._primitiveBabylonMeshes)||void 0===k||k.forEach((x=>{x.isVisible=R}))},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class GH{constructor(R){this.name=QH,this._loader=R,this.enabled=R.isExtensionUsed(QH)}async onReady(){var R;null===(R=this._loader.Si.nodes)||void 0===R||R.forEach((R=>{var x,H,k,c;(null===(x=R._primitiveBabylonMeshes)||void 0===x||x.forEach((R=>{R.inheritVisibility=!0})),null!==(H=R.extensions)&&void 0!==H&&H.KHR_node_visibility)&&(!1===(null===(k=R.extensions)||void 0===k?void 0:k.KHR_node_visibility.visible)&&(R._babylonTransformNode&&(R._babylonTransformNode.isVisible=!1),null===(c=R._primitiveBabylonMeshes)||void 0===c||c.forEach((R=>{R.isVisible=!1}))))}))}dispose(){this._loader=null}}W(QH),N(QH,!0,(R=>new GH(R)));const TH="KHR_node_selectability";oH("event/onSelect",TH,{Ng:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:R=>["pickedMesh_"+R[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(R,x,H,k,c,t,A){var D,U,J,V,n,g;const I=c[c.length-1];I.config=I.config||{},I.config.glTF=A;const i=null===(D=R.configuration)||void 0===D||null===(U=D.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const q="pickedMesh_"+i;return c[1].config.variable=q,t._userVariables[q]={className:"Mesh",id:null===A||void 0===A||null===(J=A.nodes)||void 0===J||null===(V=J[i]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===A||void 0===A||null===(n=A.nodes)||void 0===n||null===(g=n[i]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},c}}),(0,K.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:R=>{const x=R._babylonTransformNode;return!x||void 0===x.Mi||x.Mi},set:(R,x)=>{var H;null===(H=x._primitiveBabylonMeshes)||void 0===H||H.forEach((x=>{x.Mi=R}))},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"Mi"],type:"boolean"});class vH{constructor(R){this.name=TH,this._loader=R,this.enabled=R.isExtensionUsed(TH)}async onReady(){var R;null===(R=this._loader.Si.nodes)||void 0===R||R.forEach((R=>{var x,H,k;null!==(x=R.extensions)&&void 0!==x&&x.KHR_node_selectability&&!1===(null===(H=R.extensions)||void 0===H?void 0:H.KHR_node_selectability.selectable)&&(null===(k=R._babylonTransformNode)||void 0===k||k.getChildMeshes().forEach((R=>{R.Mi=!1})))}))}dispose(){this._loader=null}}W(TH),N(TH,!0,(R=>new vH(R)));const pH="KHR_node_hoverability",rH="targetMeshPointerOver_";oH("event/onHoverIn",pH,{Ng:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:R=>[rH+R[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(R,x,H,k,c,t,A){var D,U,J,V,n,g;const I=c[c.length-1];I.config=I.config||{},I.config.glTF=A;const i=null===(D=R.configuration)||void 0===D||null===(U=D.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const q=rH+i;return c[1].config.variable=q,t._userVariables[q]={className:"Mesh",id:null===A||void 0===A||null===(J=A.nodes)||void 0===J||null===(V=J[i]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===A||void 0===A||null===(n=A.nodes)||void 0===n||null===(g=n[i]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},c}});const zH="targetMeshPointerOut_";oH("event/onHoverOut",pH,{Ng:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:R=>[zH+R[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(R,x,H,k,c,t,A){var D,U,J,V,n,g;const I=c[c.length-1];I.config=I.config||{},I.config.glTF=A;const i=null===(D=R.configuration)||void 0===D||null===(U=D.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const q=zH+i;return c[1].config.variable=q,t._userVariables[q]={className:"Mesh",id:null===A||void 0===A||null===(J=A.nodes)||void 0===J||null===(V=J[i]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===A||void 0===A||null===(n=A.nodes)||void 0===n||null===(g=n[i]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},c}}),(0,K.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:R=>{const x=R._babylonTransformNode;return!x||void 0===x.pointerOverDisableMeshTesting||x.pointerOverDisableMeshTesting},set:(R,x)=>{var H;null===(H=x._primitiveBabylonMeshes)||void 0===H||H.forEach((x=>{x.pointerOverDisableMeshTesting=!R}))},getTarget:R=>R._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class jH{constructor(R){this.name=pH,this._loader=R,this.enabled=R.isExtensionUsed(pH)}async onReady(){var R;null===(R=this._loader.Si.nodes)||void 0===R||R.forEach((R=>{var x,H,k;null!==(x=R.extensions)&&void 0!==x&&x.KHR_node_hoverability&&!1===(null===(H=R.extensions)||void 0===H?void 0:H.KHR_node_hoverability.hoverable)&&(null===(k=R._babylonTransformNode)||void 0===k||k.getChildMeshes().forEach((R=>{R.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}W(pH),N(pH,!0,(R=>new jH(R)));const mH="ExtrasAsMetadata";class OH{_assignExtras(R,x){if(x.extras&&Object.keys(x.extras).length>0){const H=R.metadata=R.metadata||{};(H.Si=H.Si||{}).extras=x.extras}}constructor(R){this.name=mH,this.enabled=!0,this._loader=R}dispose(){this._loader=null}loadNodeAsync(R,x,H){return this._loader.loadNodeAsync(R,x,(R=>{this._assignExtras(R,x),H(R)}))}loadCameraAsync(R,x,H){return this._loader.loadCameraAsync(R,x,(R=>{this._assignExtras(R,x),H(R)}))}createMaterial(R,x,H){const k=this._loader.createMaterial(R,x,H);return this._assignExtras(k,x),k}}W(mH),N(mH,!1,(R=>new OH(R)));H(13306)},13197:(R,x,H)=>{"use strict";H.d(x,{c:()=>E,f:()=>M,g:()=>X,h:()=>B});var k=H(476),c=H(485),t=H(12821),A=H(471),D=H(819),U=H(813),J=H(493),V=H(513),n=H(12238),g=H(12348),I=H(637),i=H(622);class q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ei=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.qm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(R){this._environmentTexture=R}getNodes(){let R=[];R=R.concat(this.meshes),R=R.concat(this.lights),R=R.concat(this.cameras),R=R.concat(this.transformNodes);for(const x of this.skeletons)R=R.concat(x.bones);return R}}class S extends q{}class L{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const R=this.rootNodes;for(const k of R)k.dispose();R.length=0;const x=this.skeletons;for(const k of x)k.dispose();x.length=0;const H=this.animationGroups;for(const k of H)k.dispose();H.length=0}}class b extends q{constructor(R){super(),this._wasAddedToScene=!1,(R=R||V.c.LastCreatedScene)&&(this.Yk=R,this.proceduralTextures=[],R.Vi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=R.getEngine().onContextRestoredObservable.add((()=>{for(const R of this.geometries)R._rebuild();for(const R of this.meshes)R._rebuild();for(const R of this.Ei)R.rebuild();for(const R of this.textures)R._rebuild()})))}_topologicalSort(R){const x=new Map;for(const A of R)x.set(A.uniqueId,A);const H={dependsOn:new Map,dependedBy:new Map};for(const A of R){const R=A.uniqueId;H.dependsOn.set(R,new Set),H.dependedBy.set(R,new Set)}for(const A of R){const R=A.uniqueId,k=H.dependsOn.get(R);if(A instanceof n.d){const c=A.sourceMesh;x.has(c.uniqueId)&&(k.add(c.uniqueId),H.dependedBy.get(c.uniqueId).add(R))}const c=H.dependedBy.get(R);for(const t of A.getDescendants()){const k=t.uniqueId;if(x.has(k)){c.add(k);H.dependsOn.get(k).add(R)}}}const k=[],c=[];for(const A of R){const R=A.uniqueId;0===H.dependsOn.get(R).size&&(c.push(A),x.delete(R))}const t=c;for(;t.length>0;){const R=t.shift();k.push(R);const c=H.dependedBy.get(R.uniqueId);for(const k of Array.from(c.values())){const c=H.dependsOn.get(k);c.delete(R.uniqueId),0===c.size&&x.get(k)&&(t.push(x.get(k)),x.delete(k))}}return x.size>0&&(J.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),x.forEach((R=>{J.c.Error(R.name)}))),k}_addNodeAndDescendantsToList(R,x,H,k){if(H&&(!k||k(H))&&!x.has(H.uniqueId)){R.push(H),x.add(H.uniqueId);for(const c of H.getDescendants(!0))this._addNodeAndDescendantsToList(R,x,c,k)}}_isNodeInContainer(R){return R instanceof U.b&&-1!==this.meshes.indexOf(R)||(R instanceof D.e&&-1!==this.transformNodes.indexOf(R)||(R instanceof g.b&&-1!==this.lights.indexOf(R)||R instanceof I.b&&-1!==this.cameras.indexOf(R)))}_isValidHierarchy(){for(const R of this.meshes)if(R.parent&&!this._isNodeInContainer(R.parent))return J.c.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.transformNodes)if(R.parent&&!this._isNodeInContainer(R.parent))return J.c.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.lights)if(R.parent&&!this._isNodeInContainer(R.parent))return J.c.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.cameras)if(R.parent&&!this._isNodeInContainer(R.parent))return J.c.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(R){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||c.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const k={},t={},D=new L,U=[],J=[],V={doNotInstantiate:!0,...H},n=[],g=new Set;for(const c of this.transformNodes)null===c.parent&&this._addNodeAndDescendantsToList(n,g,c,V.predicate);for(const c of this.meshes)null===c.parent&&this._addNodeAndDescendantsToList(n,g,c,V.predicate);const I=this._topologicalSort(n),i=(H,c)=>{if(((x,H)=>{if(k[x.uniqueId]=H.uniqueId,t[H.uniqueId]=H,R&&(H.name=R(x.name)),H instanceof A.d){const R=H;if(R.morphTargetManager){const H=x.morphTargetManager;R.morphTargetManager=H.clone();for(let x=0;x<H.numTargets;x++){const c=H.getTarget(x),A=R.morphTargetManager.getTarget(x);k[c.uniqueId]=A.uniqueId,t[A.uniqueId]=A}}}})(H,c),H.parent){const R=k[H.parent.uniqueId],x=t[R];c.parent=x||H.parent}if(c.position&&H.position&&c.position.p(H.position),c.rotationQuaternion&&H.rotationQuaternion&&c.rotationQuaternion.p(H.rotationQuaternion),c.rotation&&H.rotation&&c.rotation.p(H.rotation),c.ti&&H.ti&&c.ti.p(H.ti),c.material){const A=c;if(A.material)if(x){const x=H.material;if(-1===J.indexOf(x)){let H=x.clone(R?R(x.name):"Clone of "+x.name);if(J.push(x),k[x.uniqueId]=H.uniqueId,t[H.uniqueId]=H,"MultiMaterial"===x.getClassName()){const c=x;for(const x of c.Ni)x&&(H=x.clone(R?R(x.name):"Clone of "+x.name),J.push(x),k[x.uniqueId]=H.uniqueId,t[H.uniqueId]=H);c.Ni=c.Ni.map((R=>R&&t[k[R.uniqueId]]))}}"InstancedMesh"!==A.getClassName()&&(A.material=t[k[x.uniqueId]])}else"MultiMaterial"===A.material.getClassName()?-1===this.Yk.multiMaterials.indexOf(A.material)&&this.Yk.addMultiMaterial(A.material):-1===this.Yk.materials.indexOf(A.material)&&this.Yk.addMaterial(A.material)}null===c.parent&&D.rootNodes.push(c)};for(const c of I)if("InstancedMesh"===c.getClassName()){const R=c,x=R.sourceMesh,H=k[x.uniqueId];i(R,("number"===typeof H?t[H]:x).createInstance(R.name))}else{let R=!0;"nj"===c.getClassName()||"Node"===c.getClassName()||c.skeleton||!c.getTotalVertices||0===c.getTotalVertices()?R=!1:V.doNotInstantiate&&(R="function"===typeof V.doNotInstantiate?!V.doNotInstantiate(c):!V.doNotInstantiate);const x=R?c.createInstance(`instance of ${c.name}`):c.clone(`Clone of ${c.name}`,null,!0);if(!x)throw new Error(`Could not clone or instantiate node on Asset Container ${c.name}`);i(c,x)}for(const c of this.skeletons){if(V.predicate&&!V.predicate(c))continue;const x=c.clone(R?R(c.name):"Clone of "+c.name);for(const R of this.meshes)if(R.skeleton===c&&!R.isAnInstance){const H=t[k[R.uniqueId]];if(!H||H.isAnInstance)continue;if(H.skeleton=x,-1!==U.indexOf(x))continue;U.push(x);for(const R of x.bones)R._linkedTransformNode&&(R._linkedTransformNode=t[k[R._linkedTransformNode.uniqueId]])}D.skeletons.push(x)}for(const c of this.animationGroups){if(V.predicate&&!V.predicate(c))continue;const x=c.clone(R?R(c.name):"Clone of "+c.name,(R=>t[k[R.uniqueId]]||R));D.animationGroups.push(x)}return D}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||c.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Yk.environmentTexture=this.environmentTexture);for(const R of this.Yk._serializableComponents)R.addFromContainer(this);this.Yk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=[];for(const H of this.cameras)R&&!R(H)||(this.Yk.addCamera(H),x.push(H));for(const H of this.lights)R&&!R(H)||(this.Yk.addLight(H),x.push(H));for(const H of this.meshes)R&&!R(H)||(this.Yk.ij(H),x.push(H));for(const H of this.skeletons)R&&!R(H)||this.Yk.addSkeleton(H);for(const H of this.animations)R&&!R(H)||this.Yk.addAnimation(H);for(const H of this.animationGroups)R&&!R(H)||this.Yk.addAnimationGroup(H);for(const H of this.multiMaterials)R&&!R(H)||this.Yk.addMultiMaterial(H);for(const H of this.materials)R&&!R(H)||this.Yk.addMaterial(H);for(const H of this.morphTargetManagers)R&&!R(H)||this.Yk.addMorphTargetManager(H);for(const H of this.geometries)R&&!R(H)||this.Yk.addGeometry(H);for(const H of this.transformNodes)R&&!R(H)||(this.Yk.addTransformNode(H),x.push(H));for(const H of this.actionManagers)R&&!R(H)||this.Yk.addActionManager(H);for(const H of this.textures)R&&!R(H)||this.Yk.addTexture(H);for(const H of this.reflectionProbes)R&&!R(H)||this.Yk.addReflectionProbe(H);for(const H of x)H.parent&&-1===this.Yk.getNodes().indexOf(H.parent)&&(H.setParent?H.setParent(null):H.parent=null)}removeAllFromScene(){this._isValidHierarchy()||c.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Yk.environmentTexture&&(this.Yk.environmentTexture=null);for(const R of this.Yk._serializableComponents)R.removeFromContainer(this)}removeFromScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const x of this.cameras)R&&!R(x)||this.Yk.removeCamera(x);for(const x of this.lights)R&&!R(x)||this.Yk.removeLight(x);for(const x of this.meshes)R&&!R(x)||this.Yk.kj(x,!0);for(const x of this.skeletons)R&&!R(x)||this.Yk.removeSkeleton(x);for(const x of this.animations)R&&!R(x)||this.Yk.removeAnimation(x);for(const x of this.animationGroups)R&&!R(x)||this.Yk.removeAnimationGroup(x);for(const x of this.multiMaterials)R&&!R(x)||this.Yk.removeMultiMaterial(x);for(const x of this.materials)R&&!R(x)||this.Yk.removeMaterial(x);for(const x of this.morphTargetManagers)R&&!R(x)||this.Yk.removeMorphTargetManager(x);for(const x of this.geometries)R&&!R(x)||this.Yk.removeGeometry(x);for(const x of this.transformNodes)R&&!R(x)||this.Yk.removeTransformNode(x);for(const x of this.actionManagers)R&&!R(x)||this.Yk.removeActionManager(x);for(const x of this.textures)R&&!R(x)||this.Yk.removeTexture(x);for(const x of this.reflectionProbes)R&&!R(x)||this.Yk.removeReflectionProbe(x)}dispose(){const R=this.cameras.slice(0);for(const I of R)I.dispose();this.cameras.length=0;const x=this.lights.slice(0);for(const I of x)I.dispose();this.lights.length=0;const H=this.meshes.slice(0);for(const I of H)I.dispose();this.meshes.length=0;const k=this.skeletons.slice(0);for(const I of k)I.dispose();this.skeletons.length=0;const c=this.animationGroups.slice(0);for(const I of c)I.dispose();this.animationGroups.length=0;const t=this.multiMaterials.slice(0);for(const I of t)I.dispose();this.multiMaterials.length=0;const A=this.materials.slice(0);for(const I of A)I.dispose();this.materials.length=0;const D=this.geometries.slice(0);for(const I of D)I.dispose();this.geometries.length=0;const U=this.transformNodes.slice(0);for(const I of U)I.dispose();this.transformNodes.length=0;const J=this.actionManagers.slice(0);for(const I of J)I.dispose();this.actionManagers.length=0;const V=this.textures.slice(0);for(const I of V)I.dispose();this.textures.length=0;const n=this.reflectionProbes.slice(0);for(const I of n)I.dispose();this.reflectionProbes.length=0;const g=this.morphTargetManagers.slice(0);for(const I of g)I.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const I of this.Yk._serializableComponents)I.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Yk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(R,x,H){if(R&&x)for(const k of R){let R=!0;if(H)for(const x of H)if(k===x){R=!1;break}R&&(x.push(k),k._parentContainer=this)}}moveAllFromScene(R){this._wasAddedToScene=!1,void 0===R&&(R=new S);for(const x in this)Object.prototype.hasOwnProperty.call(this,x)&&(this[x]=this[x]||("_environmentTexture"===x?null:[]),this._moveAssets(this.Yk[x],this[x],R[x]));this.environmentTexture=this.Yk.environmentTexture,this.removeAllFromScene()}createRootMesh(){const R=new A.d("assetContainerRootMesh",this.Yk);for(const x of this.meshes)x.parent||R.addChild(x);return this.meshes.unshift(R),R}mergeAnimationsTo(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.c.LastCreatedScene,x=arguments.length>1?arguments[1]:void 0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!R)return J.c.Error("No scene available to merge animations to"),[];const k=H||(x=>{let H=null;const k=x.animations.length?x.animations[0].targetProperty:"",c=x.name.split(".").join("").split("_primitive")[0];switch(k){case"position":case"rotationQuaternion":H=R.getTransformNodeByName(x.name)||R.getTransformNodeByName(c);break;case"influence":H=R.getMorphTargetByName(x.name)||R.getMorphTargetByName(c);break;default:H=R.getNodeByName(x.name)||R.getNodeByName(c)}return H}),c=this.getNodes();for(const D of c){const R=k(D);if(null!==R){for(const x of D.animations){const H=R.animations.filter((R=>R.targetProperty===x.targetProperty));for(const x of H){const H=R.animations.indexOf(x,0);H>-1&&R.animations.splice(H,1)}}R.animations=R.animations.concat(D.animations)}}const t=[],A=this.animationGroups.slice();for(const D of A){t.push(D.clone(D.name,k));for(const R of D.animatables)R.stop()}for(const D of x){const x=k(D.target);x&&(R.beginAnimation(x,D.fromFrame,D.toFrame,D.loopAnimation,D.speedRatio,D.onAnimationEnd?D.onAnimationEnd:void 0,void 0,!0,void 0,D.onAnimationLoop?D.onAnimationLoop:void 0),R.stopAnimation(D.target))}return t}populateRootNodes(){this.rootNodes.length=0;for(const R of this.meshes)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R);for(const R of this.transformNodes)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R);for(const R of this.lights)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R);for(const R of this.cameras)R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)}addAllAssetsToContainer(R){if(!R)return;const x=[],H=new Set;for(x.push(R);x.length>0;){const R=x.pop();if(R instanceof A.d?(R.Ci&&-1===this.geometries.indexOf(R.Ci)&&this.geometries.push(R.Ci),this.meshes.push(R)):R instanceof n.d?this.meshes.push(R):R instanceof D.e?this.transformNodes.push(R):R instanceof g.b?this.lights.push(R):R instanceof I.b&&this.cameras.push(R),R instanceof U.b){if(R.material&&-1===this.materials.indexOf(R.material)){this.materials.push(R.material);for(const x of R.material.getActiveTextures())-1===this.textures.indexOf(x)&&this.textures.push(x)}R.skeleton&&-1===this.skeletons.indexOf(R.skeleton)&&this.skeletons.push(R.skeleton),R.morphTargetManager&&-1===this.morphTargetManagers.indexOf(R.morphTargetManager)&&this.morphTargetManagers.push(R.morphTargetManager)}for(const k of R.getChildren())H.has(k)||x.push(k);H.add(R)}this.populateRootNodes()}_getByTags(R,x,H){if(void 0===x)return R;const k=[];for(const c in R){const t=R[c];i.c&&i.c.MatchesQuery(t,x)&&(!H||H(t))&&k.push(t)}return k}getMeshesByTags(R,x){return this._getByTags(this.meshes,R,x)}getCamerasByTags(R,x){return this._getByTags(this.cameras,R,x)}getLightsByTags(R,x){return this._getByTags(this.lights,R,x)}getMaterialsByTags(R,x){return this._getByTags(this.materials,R,x).concat(this._getByTags(this.multiMaterials,R,x))}getTransformNodesByTags(R,x){return this._getByTags(this.transformNodes,R,x)}}var C=H(529);class F{constructor(R){this.byteOffset=0,this.buffer=R}async loadAsync(R){const x=await this.buffer.readAsync(this.byteOffset,R);this._dataView=new DataView(x.buffer,x.byteOffset,x.byteLength),this._dataByteOffset=0}readUint32(){const R=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,R}readUint8Array(R){const x=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,R);return this._dataByteOffset+=R,this.byteOffset+=R,x}readString(R){return(0,C.h)(this.readUint8Array(R))}skipBytes(R){this._dataByteOffset+=R,this.byteOffset+=R}}var d=H(13201);const P="Z2xURg",a={name:"Si",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:R=>-1!==R.indexOf("asset")&&-1!==R.indexOf("version")||R.startsWith("data:base64,"+P)||R.startsWith("data:;base64,"+P)||R.startsWith("data:application/octet-stream;base64,"+P)||R.startsWith("data:model/gltf-binary;base64,"+P)};var X,M,B,o=H(517),Z=H(526);function y(R,x,H){try{return Promise.resolve(new Uint8Array(R,x,H))}catch(k){return Promise.reject(k)}}!function(R){R[R.AUTO=0]="AUTO",R[R.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(X||(X={})),function(R){R[R.NONE=0]="NONE",R[R.FIRST=1]="FIRST",R[R.ALL=2]="ALL"}(M||(M={})),function(R){R[R.LOADING=0]="LOADING",R[R.READY=1]="READY",R[R.COMPLETE=2]="COMPLETE"}(B||(B={}));class s{constructor(){this.coordinateSystemMode=X.AUTO,this.animationStartMode=M.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=R=>Promise.resolve(R),this.extensionOptions={}}p(R){R&&(this.onParsed=R.onParsed,this.coordinateSystemMode=R.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=R.animationStartMode??this.animationStartMode,this.loadNodeAnimations=R.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=R.loadSkins??this.loadSkins,this.loadMorphTargets=R.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=R.compileMaterials??this.compileMaterials,this.useClipPlane=R.useClipPlane??this.useClipPlane,this.compileShadowGenerators=R.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=R.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=R.useRangeRequests??this.useRangeRequests,this.createInstances=R.createInstances??this.createInstances,this.alwaysComputeBoundingBox=R.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=R.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=R.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=R.skipMaterials??this.skipMaterials,this.useSRGBBuffers=R.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=R.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=R.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=R.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=R.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=R.customRootNode,this.onMeshLoaded=R.onMeshLoaded,this.onSkinLoaded=R.onSkinLoaded,this.onTextureLoaded=R.onTextureLoaded,this.onMaterialLoaded=R.onMaterialLoaded,this.onCameraLoaded=R.onCameraLoaded,this.extensionOptions=R.extensionOptions??this.extensionOptions)}}class E extends s{constructor(R){super(),this.onParsedObservable=new k.d,this.onMeshLoadedObservable=new k.d,this.onSkinLoadedObservable=new k.d,this.onTextureLoadedObservable=new k.d,this.onMaterialLoadedObservable=new k.d,this.onCameraLoadedObservable=new k.d,this.onCompleteObservable=new k.d,this.onErrorObservable=new k.d,this.Vi=new k.d,this.onExtensionLoadedObservable=new k.d,this.validate=!1,this.onValidatedObservable=new k.d,this._loader=null,this._state=null,this._requests=new Array,this.name=a.name,this.extensions=a.extensions,this.onLoaderStateChangedObservable=new k.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(R)}set onParsed(R){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),R&&(this._onParsedObserver=this.onParsedObservable.add(R))}set onMeshLoaded(R){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),R&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(R))}set onSkinLoaded(R){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),R&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((x=>R(x.node,x.skinnedNode))))}set onTextureLoaded(R){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),R&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(R))}set onMaterialLoaded(R){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),R&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(R))}set onCameraLoaded(R){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),R&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(R))}set onComplete(R){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(R)}set onError(R){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(R)}set onDispose(R){this._onDisposeObserver&&this.Vi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Vi.add(R)}set onExtensionLoaded(R){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(R)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(R){this._loggingEnabled!==R&&(this._loggingEnabled=R,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(R){this._capturePerformanceCounters!==R&&(this._capturePerformanceCounters=R,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(R){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(R)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const R of this._requests)R.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=R=>Promise.resolve(R),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Vi.notifyObservers(void 0),this.Vi.clear()}loadFile(R,x,H,t,A,D,U,V){if(ArrayBuffer.isView(x))return this._loadBinary(R,x,H,t,U,V),null;this._progressCallback=A;const n=x.name||c.e.GetFilename(x);if(D){if(this.useRangeRequests){this.validate&&J.c.Warn("glTF validation is not supported when range requests are enabled");const H={abort:()=>{},onCompleteObservable:new k.d},c={readAsync:(H,k)=>new Promise(((c,t)=>{this._loadFile(R,x,(R=>{c(new Uint8Array(R))}),!0,(R=>{t(R)}),(R=>{R.setRequestHeader("Range",`bytes=${H}-${H+k-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new F(c)).then((R=>{H.onCompleteObservable.notifyObservers(H),t(R)}),U?R=>U(void 0,R):void 0),H}return this._loadFile(R,x,(x=>{this._validate(R,new Uint8Array(x,0,x.byteLength),H,n),this._unpackBinaryAsync(new F({readAsync:(R,H)=>y(x,R,H),byteLength:x.byteLength})).then((R=>{t(R)}),U?R=>U(void 0,R):void 0)}),!0,U)}return this._loadFile(R,x,(x=>{try{this._validate(R,x,H,n),t({json:this._parseJson(x)})}catch{U&&U()}}),!1,U)}_loadBinary(R,x,H,k,c,t){this._validate(R,new Uint8Array(x.buffer,x.byteOffset,x.byteLength),H,t),this._unpackBinaryAsync(new F({readAsync:(R,H)=>function(R,x,H){try{if(x<0||x>=R.byteLength)throw new RangeError("Offset is out of range.");if(x+H>R.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(R.buffer,R.byteOffset+x,H))}catch(k){return Promise.reject(k)}}(x,R,H),byteLength:x.byteLength})).then((R=>{k(R)}),c?R=>c(void 0,R):void 0)}importMeshAsync(R,x,H,k,c,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(H),this._loader.importMeshAsync(R,x,null,H,k,c,t))))}loadAsync(R,x,H,k,c){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(x),this._loader.loadAsync(R,x,H,k,c))))}loadAssetContainerAsync(R,x,H,k,c){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(x);const t=new b(R),A=[];this.onMaterialLoadedObservable.add((R=>{A.push(R)}));const D=[];this.onTextureLoadedObservable.add((R=>{D.push(R)}));const U=[];this.onCameraLoadedObservable.add((R=>{U.push(R)}));const J=[];return this.onMeshLoadedObservable.add((R=>{R.morphTargetManager&&J.push(R.morphTargetManager)})),this._loader.importMeshAsync(null,R,t,x,H,k,c).then((R=>(Array.prototype.push.apply(t.geometries,R.geometries),Array.prototype.push.apply(t.meshes,R.meshes),Array.prototype.push.apply(t.Ei,R.Ei),Array.prototype.push.apply(t.skeletons,R.skeletons),Array.prototype.push.apply(t.animationGroups,R.animationGroups),Array.prototype.push.apply(t.materials,A),Array.prototype.push.apply(t.textures,D),Array.prototype.push.apply(t.lights,R.lights),Array.prototype.push.apply(t.transformNodes,R.transformNodes),Array.prototype.push.apply(t.cameras,U),Array.prototype.push.apply(t.morphTargetManagers,J),t)))}))}canDirectLoad(R){return a.canDirectLoad(R)}directLoad(R,x){if(x.startsWith("base64,"+P)||x.startsWith(";base64,"+P)||x.startsWith("application/octet-stream;base64,"+P)||x.startsWith("model/gltf-binary;base64,"+P)){const H=(0,o.d)(x);return this._validate(R,new Uint8Array(H,0,H.byteLength)),this._unpackBinaryAsync(new F({readAsync:(R,x)=>y(H,R,x),byteLength:H.byteLength}))}return this._validate(R,x),Promise.resolve({json:this._parseJson(x)})}createPlugin(R){return new E(R[a.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((R,x)=>{this.onCompleteObservable.addOnce((()=>{R()})),this.onErrorObservable.addOnce((R=>{x(R)}))}))}_setState(R){this._state!==R&&(this._state=R,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(B[this._state]))}_loadFile(R,x,H,k,c,t){const A=R._loadFile(x,H,(R=>{this._onProgress(R,A)}),!0,k,c,t);return A.onCompleteObservable.add((()=>{A._lengthComputable=!0,A._total=A._loaded})),this._requests.push(A),A}_onProgress(R,x){if(!this._progressCallback)return;x._lengthComputable=R.lengthComputable,x._loaded=R.loaded,x._total=R.total;let H=!0,k=0,c=0;for(const t of this._requests){if(void 0===t._lengthComputable||void 0===t._loaded||void 0===t._total)return;H=H&&t._lengthComputable,k+=t._loaded,c+=t._total}this._progressCallback({lengthComputable:H,loaded:k,total:H?c:0})}_validate(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),d.e.ValidateAsync(x,H,k,(x=>this.preprocessUrlAsync(H+x).then((x=>R._loadFileAsync(x,void 0,!0,!0).then((R=>new Uint8Array(R,0,R.byteLength))))))).then((R=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(R),this.onValidatedObservable.clear()}),(R=>{this._endPerformanceCounter("Validate JSON"),c.e.Warn(`Failed to validate: ${R.message}`),this.onValidatedObservable.clear()})))}_getLoader(R){const x=R.json.asset||{};this._log(`Asset version: ${x.version}`),x.minVersion&&this._log(`Asset minimum version: ${x.minVersion}`),x.generator&&this._log(`Asset generator: ${x.generator}`);const H=E._parseVersion(x.version);if(!H)throw new Error("Invalid version: "+x.version);if(void 0!==x.minVersion){const R=E._parseVersion(x.minVersion);if(!R)throw new Error("Invalid minimum version: "+x.minVersion);if(E._compareVersion(R,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+x.minVersion)}const k={1:E._CreateGLTF1Loader,2:E._CreateGLTF2Loader}[H.major];if(!k)throw new Error("Unsupported version: "+x.version);return k(this)}_parseJson(R){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${R.length}`);const x=JSON.parse(R);return this._endPerformanceCounter("Parse JSON"),x}_unpackBinaryAsync(R){return this._startPerformanceCounter("Unpack Binary"),R.loadAsync(20).then((()=>{const x=R.readUint32();if(1179937895!==x)throw new Z.g("Unexpected magic: "+x,Z.f.GLTFLoaderUnexpectedMagicError);const H=R.readUint32();this.loggingEnabled&&this._log(`Binary version: ${H}`);const k=R.readUint32();let c;switch(this.useRangeRequests||k===R.buffer.byteLength||J.c.Warn(`Length in header does not match actual data length: ${k} != ${R.buffer.byteLength}`),H){case 1:c=this._unpackBinaryV1Async(R,k);break;case 2:c=this._unpackBinaryV2Async(R,k);break;default:throw new Error("Unsupported version: "+H)}return this._endPerformanceCounter("Unpack Binary"),c}))}_unpackBinaryV1Async(R,x){const H=R.readUint32(),k=R.readUint32();if(0!==k)throw new Error(`Unexpected content format: ${k}`);const c=x-R.byteOffset,t={json:this._parseJson(R.readString(H)),bin:null};if(0!==c){const x=R.byteOffset;t.bin={readAsync:(H,k)=>R.buffer.readAsync(x+H,k),byteLength:c}}return Promise.resolve(t)}_unpackBinaryV2Async(R,x){const H=1313821514,k=5130562,c=R.readUint32();if(R.readUint32()!==H)throw new Error("First chunk format is not JSON");return R.byteOffset+c===x?R.loadAsync(c).then((()=>({json:this._parseJson(R.readString(c)),bin:null}))):R.loadAsync(c+8).then((()=>{const t={json:this._parseJson(R.readString(c)),bin:null},A=()=>{const c=R.readUint32();switch(R.readUint32()){case H:throw new Error("Unexpected JSON chunk");case k:{const x=R.byteOffset;t.bin={readAsync:(H,k)=>R.buffer.readAsync(x+H,k),byteLength:c},R.skipBytes(c);break}default:R.skipBytes(c)}return R.byteOffset!==x?R.loadAsync(8).then(A):Promise.resolve(t)};return A()}))}static _parseVersion(R){if("1.0"===R||"1.0.1"===R)return{major:1,minor:0};const x=(R+"").match(/^(\d+)\.(\d+)/);return x?{major:parseInt(x[1]),minor:parseInt(x[2])}:null}static _compareVersion(R,x){return R.major>x.major?1:R.major<x.major?-1:R.minor>x.minor?1:R.minor<x.minor?-1:0}_logOpen(R){this._log(R),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(R){const x=E._logSpaces.substring(0,2*this._logIndentLevel);J.c.Log(`${x}${R}`)}_logDisabled(R){}_startPerformanceCounterEnabled(R){c.e.StartPerformanceCounter(R)}_startPerformanceCounterDisabled(R){}_endPerformanceCounterEnabled(R){c.e.EndPerformanceCounter(R)}_endPerformanceCounterDisabled(R){}}E.IncrementalLoading=!0,E.HomogeneousCoordinates=!1,E._logSpaces="                                ",(0,t.d)(new E)},13201:(R,x,H)=>{"use strict";H.d(x,{e:()=>A});var k=H(485);function c(R,x,H,k){const c={externalResourceFunction:k};return H&&(c.uri="file:"===x?H:x+H),ArrayBuffer.isView(R)?GLTFValidator.validateBytes(R,c):GLTFValidator.validateString(R,c)}function t(){const R=[];onmessage=x=>{const H=x.data;switch(H.id){case"init":importScripts(H.url);break;case"validate":c(H.data,H.rootUrl,H.fileName,(x=>new Promise(((H,k)=>{const c=R.length;R.push({resolve:H,reject:k}),postMessage({id:"getExternalResource",index:c,uri:x})})))).then((R=>{postMessage({id:"validate.resolve",value:R})}),(R=>{postMessage({id:"validate.reject",reason:R})}));break;case"getExternalResource.resolve":R[H.index].resolve(H.value);break;case"getExternalResource.reject":R[H.index].reject(H.reason)}}}class A{static ValidateAsync(R,x,H,A){return"function"===typeof Worker?new Promise(((D,U)=>{const J=`${c}(${t})()`,V=URL.createObjectURL(new Blob([J],{type:"application/javascript"})),n=new Worker(V),g=R=>{n.removeEventListener("error",g),n.removeEventListener("message",I),U(R)},I=R=>{const x=R.data;switch(x.id){case"getExternalResource":A(x.uri).then((R=>{n.postMessage({id:"getExternalResource.resolve",index:x.index,value:R},[R.buffer])}),(R=>{n.postMessage({id:"getExternalResource.reject",index:x.index,reason:R})}));break;case"validate.resolve":n.removeEventListener("error",g),n.removeEventListener("message",I),D(x.value),n.terminate();break;case"validate.reject":n.removeEventListener("error",g),n.removeEventListener("message",I),U(x.reason),n.terminate()}};if(n.addEventListener("error",g),n.addEventListener("message",I),n.postMessage({id:"init",url:k.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(R)){const k=R.slice();n.postMessage({id:"validate",data:k,rootUrl:x,fileName:H},[k.buffer])}else n.postMessage({id:"validate",data:R,rootUrl:x,fileName:H})})):(this._LoadScriptPromise||(this._LoadScriptPromise=k.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>c(R,x,H,A))))}}A.Configuration={url:`${k.e._DefaultCdnUrl}/gltf_validator.js`}},13538:(R,x,H)=>{"use strict";H.d(x,{e:()=>a});var k=H(643),c=H(647),t=H(687),A=H(661),D=H(12276),U=H(12292),J=H(724),V=H(2445),n=H(610),g=H(565);H(12955),H(12858),H(12877),H(12862),H(12880),H(12886),H(12892);const I="imageProcessingCompatibility",i="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";g.e.IncludesShadersStore[I]||(g.e.IncludesShadersStore[I]=i);const q="skyPixelShader",S="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";g.e.ShadersStore[q]||(g.e.ShadersStore[q]=S);H(12969),H(12901),H(12910),H(12919),H(12913);const L="skyVertexShader",b="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";g.e.ShadersStore[L]||(g.e.ShadersStore[L]=b);var C=H(12307),F=H(849),d=H(841);class P extends D.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class a extends U.e{constructor(R,x){super(R,x),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new A.o(0,100,0),this.useSunPosition=!1,this.cameraOffset=A.o.Zero(),this.up=A.o.Up(),this.dithering=!1,this._cameraPosition=A.o.Zero(),this._skyOrientation=new A.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(R,x){const H=x._drawWrapper;if(this.isFrozen&&H.effect&&H._wasPreviouslyReady)return!0;x.materialDefines||(x.materialDefines=new P);const k=x.materialDefines,c=this.va();if(this._isReadyForSubMesh(x))return!0;if((0,d.W)(R,c,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,k),(0,d.N)(R,k,!0,!1),k.IMAGEPROCESSINGPOSTPROCESS!==c.imageProcessingConfiguration.applyByPostProcess&&k.markAsMiscDirty(),k.DITHER!==this.dithering&&k.markAsMiscDirty(),k.isDirty){k.markAsProcessed(),c.resetCachedMaterial();const R=new C.b;k.FOG&&R.addFallback(1,"FOG"),k.IMAGEPROCESSINGPOSTPROCESS=c.imageProcessingConfiguration.applyByPostProcess,k.DITHER=this.dithering;const H=[J.g.PositionKind];k.VERTEXCOLOR&&H.push(J.g.ColorKind);const t="sky",A=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,F.e)(A);const D=k.toString();x.setEffect(c.getEngine().createEffect(t,H,A,[],D,R,this.onCompiled,this.onError),k,this._materialContext)}return!(!x.effect||!x.effect.isReady())&&(k._renderId=c.getRenderId(),H._wasPreviouslyReady=!0,!0)}bindForSubMesh(R,x,H){const k=this.va(),c=H.materialDefines;if(!c)return;const t=H.effect;if(!t)return;this._activeEffect=t,this.bindOnlyWorldMatrix(R),this._activeEffect.setMatrix("viewProjection",k.getTransformMatrix()),this._mustRebind(k,t,H)&&((0,F.i)(t,this,k),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,d.n)(c,t,k)),k.fogEnabled&&x.applyFog&&k.fogMode!==V.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",k.getViewMatrix()),(0,d.g)(k,x,this._activeEffect);const D=k.activeCamera;if(D){const R=D.getWorldMatrix();this._cameraPosition.x=R.m[12],this._cameraPosition.y=R.m[13],this._cameraPosition.z=R.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const R=Math.PI*(this.inclination-.5),x=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(x)*Math.cos(R),this.sunPosition.y=this.distance*Math.sin(-R),this.sunPosition.z=this.distance*Math.sin(x)*Math.cos(R),A.f.FromUnitVectorsToRef(A.o.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(x,this._activeEffect,H)}getAnimatables(){return[]}dispose(R){super.dispose(R)}clone(R){return t.d.Clone((()=>new a(R,this.va())),this)}serialize(){const R=super.serialize();return R.customType="BABYLON.SkyMaterial",R}getClassName(){return"SkyMaterial"}static Parse(R,x,H){return t.d.Parse((()=>new a(R.name,x)),R,x,H)}}(0,k.d)([(0,c.Q)()],a.prototype,"luminance",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"turbidity",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"rayleigh",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"mieCoefficient",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"mieDirectionalG",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"distance",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"inclination",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"azimuth",void 0),(0,k.d)([(0,c.N)()],a.prototype,"sunPosition",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"useSunPosition",void 0),(0,k.d)([(0,c.N)()],a.prototype,"cameraOffset",void 0),(0,k.d)([(0,c.N)()],a.prototype,"up",void 0),(0,k.d)([(0,c.Q)()],a.prototype,"dithering",void 0),(0,n.h)("BABYLON.SkyMaterial",a)},12423:(R,x,H)=>{"use strict";function k(R,x){x.headers=R.headers||{},x.statusMessage=R.statusText,x.statusCode=R.status,x.data=R.response}function c(R,x,H){return new Promise((function(c,t){H=H||{};var A,D,U,J=new XMLHttpRequest,V=H.body,n=H.headers||{};for(A in H.timeout&&(J.timeout=H.timeout),J.ontimeout=J.onerror=function(R){R.timeout="timeout"==R.type,t(R)},J.open(R,x.href||x),J.onload=function(){for(U=J.getAllResponseHeaders().trim().split(/[\r\n]+/),k(J,J);D=U.shift();)D=D.split(": "),J.headers[D.shift().toLowerCase()]=D.join(": ");if((D=J.headers["content-type"])&&~D.indexOf("application/json"))try{J.data=JSON.parse(J.data,H.reviver)}catch(R){return k(J,R),t(R)}(J.status>=400?t:c)(J)},typeof FormData<"u"&&V instanceof FormData||V&&"object"==typeof V&&(n["content-type"]="application/json",V=JSON.stringify(V)),J.withCredentials=!!H.withCredentials,n)J.setRequestHeader(A,n[A]);J.send(V)}))}H.r(x),H.d(x,{del:()=>U,get:()=>t,patch:()=>D,post:()=>A,put:()=>J,send:()=>c});var t=c.bind(c,"GET"),A=c.bind(c,"POST"),D=c.bind(c,"PATCH"),U=c.bind(c,"DELETE"),J=c.bind(c,"PUT")},13665:(R,x,H)=>{"use strict";H.d(x,{e:()=>n});const k=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,t=1/3,A=1/6,D=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,J=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),V=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const n=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const x="function"==typeof R?R:function(R){let x=0,H=0,k=0,c=1;const t=function(){let R=4022871197;return function(x){x=x.toString();for(let H=0;H<x.length;H++){R+=x.charCodeAt(H);let k=.02519603282416938*R;R=k>>>0,k-=R,k*=R,R=k>>>0,k-=R,R+=4294967296*k}return 2.3283064365386963e-10*(R>>>0)}}();x=t(" "),H=t(" "),k=t(" "),x-=t(R),x<0&&(x+=1);H-=t(R),H<0&&(H+=1);k-=t(R),k<0&&(k+=1);return function(){const R=2091639*x+2.3283064365386963e-10*c;return x=H,H=k,k=R-(c=0|R)}}(R);this.p=function(R){const x=new Uint8Array(256);for(let H=0;H<256;H++)x[H]=H;for(let H=0;H<255;H++){const k=H+~~(R()*(256-H)),c=x[H];x[H]=x[k],x[k]=c}return x}(x),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let H=0;H<512;H++)this.perm[H]=this.p[255&H],this.permMod12[H]=this.perm[H]%12}noise2D(R,x){const H=this.permMod12,t=this.perm;let A=0,D=0,U=0;const V=(R+x)*k,n=Math.floor(R+V),g=Math.floor(x+V),I=(n+g)*c,i=R-(n-I),q=x-(g-I);let S,L;i>q?(S=1,L=0):(S=0,L=1);const b=i-S+c,C=q-L+c,F=i-1+2*c,d=q-1+2*c,P=255&n,a=255&g;let X=.5-i*i-q*q;if(X>=0){const R=3*H[P+t[a]];X*=X,A=X*X*(J[R]*i+J[R+1]*q)}let M=.5-b*b-C*C;if(M>=0){const R=3*H[P+S+t[a+L]];M*=M,D=M*M*(J[R]*b+J[R+1]*C)}let B=.5-F*F-d*d;if(B>=0){const R=3*H[P+1+t[a+1]];B*=B,U=B*B*(J[R]*F+J[R+1]*d)}return 70*(A+D+U)}noise3D(R,x,H){const k=this.permMod12,c=this.perm;let D,U,V,n;const g=(R+x+H)*t,I=Math.floor(R+g),i=Math.floor(x+g),q=Math.floor(H+g),S=(I+i+q)*A,L=R-(I-S),b=x-(i-S),C=H-(q-S);let F,d,P,a,X,M;L>=b?b>=C?(F=1,d=0,P=0,a=1,X=1,M=0):L>=C?(F=1,d=0,P=0,a=1,X=0,M=1):(F=0,d=0,P=1,a=1,X=0,M=1):b<C?(F=0,d=0,P=1,a=0,X=1,M=1):L<C?(F=0,d=1,P=0,a=0,X=1,M=1):(F=0,d=1,P=0,a=1,X=1,M=0);const B=L-F+A,o=b-d+A,Z=C-P+A,y=L-a+2*A,s=b-X+2*A,E=C-M+2*A,w=L-1+.5,h=b-1+.5,f=C-1+.5,N=255&I,W=255&i,K=255&q;let Q=.6-L*L-b*b-C*C;if(Q<0)D=0;else{const R=3*k[N+c[W+c[K]]];Q*=Q,D=Q*Q*(J[R]*L+J[R+1]*b+J[R+2]*C)}let G=.6-B*B-o*o-Z*Z;if(G<0)U=0;else{const R=3*k[N+F+c[W+d+c[K+P]]];G*=G,U=G*G*(J[R]*B+J[R+1]*o+J[R+2]*Z)}let T=.6-y*y-s*s-E*E;if(T<0)V=0;else{const R=3*k[N+a+c[W+X+c[K+M]]];T*=T,V=T*T*(J[R]*y+J[R+1]*s+J[R+2]*E)}let v=.6-w*w-h*h-f*f;if(v<0)n=0;else{const R=3*k[N+1+c[W+1+c[K+1]]];v*=v,n=v*v*(J[R]*w+J[R+1]*h+J[R+2]*f)}return 32*(D+U+V+n)}noise4D(R,x,H,k){const c=this.perm;let t,A,J,n,g;const I=(R+x+H+k)*D,i=Math.floor(R+I),q=Math.floor(x+I),S=Math.floor(H+I),L=Math.floor(k+I),b=(i+q+S+L)*U,C=R-(i-b),F=x-(q-b),d=H-(S-b),P=k-(L-b);let a=0,X=0,M=0,B=0;C>F?a++:X++,C>d?a++:M++,C>P?a++:B++,F>d?X++:M++,F>P?X++:B++,d>P?M++:B++;const o=a>=3?1:0,Z=X>=3?1:0,y=M>=3?1:0,s=B>=3?1:0,E=a>=2?1:0,w=X>=2?1:0,h=M>=2?1:0,f=B>=2?1:0,N=a>=1?1:0,W=X>=1?1:0,K=M>=1?1:0,Q=B>=1?1:0,G=C-o+U,T=F-Z+U,v=d-y+U,p=P-s+U,r=C-E+2*U,z=F-w+2*U,j=d-h+2*U,m=P-f+2*U,O=C-N+3*U,l=F-W+3*U,e=d-K+3*U,u=P-Q+3*U,Y=C-1+4*U,RR=F-1+4*U,xR=d-1+4*U,HR=P-1+4*U,kR=255&i,cR=255&q,tR=255&S,AR=255&L;let DR=.6-C*C-F*F-d*d-P*P;if(DR<0)t=0;else{const R=c[kR+c[cR+c[tR+c[AR]]]]%32*4;DR*=DR,t=DR*DR*(V[R]*C+V[R+1]*F+V[R+2]*d+V[R+3]*P)}let UR=.6-G*G-T*T-v*v-p*p;if(UR<0)A=0;else{const R=c[kR+o+c[cR+Z+c[tR+y+c[AR+s]]]]%32*4;UR*=UR,A=UR*UR*(V[R]*G+V[R+1]*T+V[R+2]*v+V[R+3]*p)}let JR=.6-r*r-z*z-j*j-m*m;if(JR<0)J=0;else{const R=c[kR+E+c[cR+w+c[tR+h+c[AR+f]]]]%32*4;JR*=JR,J=JR*JR*(V[R]*r+V[R+1]*z+V[R+2]*j+V[R+3]*m)}let VR=.6-O*O-l*l-e*e-u*u;if(VR<0)n=0;else{const R=c[kR+N+c[cR+W+c[tR+K+c[AR+Q]]]]%32*4;VR*=VR,n=VR*VR*(V[R]*O+V[R+1]*l+V[R+2]*e+V[R+3]*u)}let nR=.6-Y*Y-RR*RR-xR*xR-HR*HR;if(nR<0)g=0;else{const R=c[kR+1+c[cR+1+c[tR+1+c[AR+1]]]]%32*4;nR*=nR,g=nR*nR*(V[R]*Y+V[R+1]*RR+V[R+2]*xR+V[R+3]*HR)}return 27*(t+A+J+n+g)}}}}]);