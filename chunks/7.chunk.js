(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{12158:function(v,d){!function(v){"use strict";var d=function(v,Q){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,d){v.__proto__=d}||function(v,d){for(var Q in d)Object.prototype.hasOwnProperty.call(d,Q)&&(v[Q]=d[Q])},d(v,Q)};function Q(v,Q){if("function"!==typeof Q&&null!==Q)throw new TypeError("Class extends value "+String(Q)+" is not a constructor or null");function n(){this.constructor=v}d(v,Q),v.prototype=null===Q?Object.create(Q):(n.prototype=Q.prototype,new n)}function n(v,d,Q,n){var T,L=arguments.length,e=L<3?d:null===n?n=Object.getOwnPropertyDescriptor(d,Q):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(v,d,Q,n);else for(var F=v.length-1;F>=0;F--)(T=v[F])&&(e=(L<3?T(e):L>3?T(d,Q,e):T(d,Q))||e);return L>3&&e&&Object.defineProperty(d,Q,e),e}function T(v,d,Q){if(Q||2===arguments.length)for(var n,T=0,L=d.length;T<L;T++)!n&&T in d||(n||(n=Array.prototype.slice.call(d,0,T)),n[T]=d[T]);return v.concat(n||Array.prototype.slice.call(d))}var L,e=255,F=213;v.OPERATION=void 0,(L=v.OPERATION||(v.OPERATION={}))[L.ADD=128]="ADD",L[L.REPLACE=0]="REPLACE",L[L.DELETE=64]="DELETE",L[L.DELETE_AND_ADD=192]="DELETE_AND_ADD",L[L.TOUCH=1]="TOUCH",L[L.CLEAR=10]="CLEAR";var r=function(){function d(v,d,Q){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=v,this.setParent(d,Q)}return d.prototype.setParent=function(v,d,Q){var n=this;if(this.indexes||(this.indexes=this.ref instanceof iv?this.ref._definition.indexes:{}),this.parent=v,this.parentIndex=Q,d)if(this.root=d,this.ref instanceof iv){var T=this.ref._definition;for(var L in T.schema){var e=this.ref[L];if(e&&e.$changes){var F=T.indexes[L];e.$changes.setParent(this.ref,d,F)}}}else"object"===typeof this.ref&&this.ref.forEach((function(v,d){if(v instanceof iv){var Q=v.$changes,T=n.ref.$changes.indexes[d];Q.setParent(n.ref,n.root,T)}}))},d.prototype.operation=function(v){this.changes.set(--this.currentCustomOperation,v)},d.prototype.change=function(d,Q){void 0===Q&&(Q=v.OPERATION.ADD);var n="number"===typeof d?d:this.indexes[d];this.assertValidIndex(n,d);var T=this.changes.get(n);T&&T.op!==v.OPERATION.DELETE&&T.op!==v.OPERATION.TOUCH||this.changes.set(n,{op:T&&T.op===v.OPERATION.DELETE?v.OPERATION.DELETE_AND_ADD:Q,index:n}),this.allChanges.add(n),this.changed=!0,this.touchParents()},d.prototype.touch=function(d){var Q="number"===typeof d?d:this.indexes[d];this.assertValidIndex(Q,d),this.changes.has(Q)||this.changes.set(Q,{op:v.OPERATION.TOUCH,index:Q}),this.allChanges.add(Q),this.touchParents()},d.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},d.prototype.getType=function(v){if(this.ref._definition)return(d=this.ref._definition).schema[d.fieldsByIndex[v]];var d,Q=(d=this.parent._definition).schema[d.fieldsByIndex[this.parentIndex]];return Object.values(Q)[0]},d.prototype.getChildrenFilter=function(){var v=this.parent._definition.childFilters;return v&&v[this.parentIndex]},d.prototype.getValue=function(v){return this.ref.getByIndex(v)},d.prototype.delete=function(d){var Q="number"===typeof d?d:this.indexes[d];if(void 0!==Q){var n=this.getValue(Q);this.changes.set(Q,{op:v.OPERATION.DELETE,index:Q}),this.allChanges.delete(Q),delete this.caches[Q],n&&n.$changes&&(n.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(d," (").concat(Q,")"))},d.prototype.discard=function(d,Q){var n=this;void 0===d&&(d=!1),void 0===Q&&(Q=!1),this.ref instanceof iv||this.changes.forEach((function(d){if(d.op===v.OPERATION.DELETE){var Q=n.ref.getIndex(d.index);delete n.indexes[Q]}})),this.changes.clear(),this.changed=d,Q&&this.allChanges.clear(),this.currentCustomOperation=0},d.prototype.discardAll=function(){var v=this;this.changes.forEach((function(d){var Q=v.getValue(d.index);Q&&Q.$changes&&Q.$changes.discardAll()})),this.discard()},d.prototype.cache=function(v,d){this.caches[v]=d},d.prototype.clone=function(){return new d(this.ref,this.parent,this.root)},d.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},d.prototype.assertValidIndex=function(v,d){if(void 0===v)throw new Error('ChangeTree: missing index for field "'.concat(d,'"'))},d}();function C(v,d,Q,n){return v[d]||(v[d]=[]),v[d].push(Q),null===n||void 0===n||n.forEach((function(v,d){return Q(v,d)})),function(){return y(v[d],v[d].indexOf(Q))}}function u(d){var Q=this,n="string"!==typeof this.$changes.getType();this.$items.forEach((function(T,L){d.push({refId:Q.$changes.refId,op:v.OPERATION.DELETE,field:L,value:void 0,previousValue:T}),n&&Q.$changes.root.removeRef(T.$changes.refId)}))}function y(v,d){if(-1===d||d>=v.length)return!1;for(var Q=v.length-1,n=d;n<Q;n++)v[n]=v[n+1];return v.length=Q,!0}var z=function(v,d){var Q=v.toString(),n=d.toString();return Q<n?-1:Q>n?1:0};function B(v){return v.$proxy=!0,v=new Proxy(v,{get:function(v,d){return"symbol"===typeof d||isNaN(d)?v[d]:v.at(d)},set:function(v,d,Q){if("symbol"===typeof d||isNaN(d))v[d]=Q;else{var n=Array.from(v.$items.keys()),T=parseInt(n[d]||d);void 0===Q||null===Q?v.deleteAt(T):v.setAt(T,Q)}return!0},deleteProperty:function(v,d){return"number"===typeof d?v.deleteAt(d):delete v[d],!0}})}var X=function(){function d(){for(var v=[],d=0;d<arguments.length;d++)v[d]=arguments[d];this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,v)}return d.prototype.cc=function(d,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,d,Q?this.$items:void 0)},d.prototype.rc=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,d)},d.is=function(v){return Array.isArray(v)||void 0!==v.array},Object.defineProperty(d.prototype,"length",{get:function(){return this.$items.size},set:function(v){0===v?this.clear():this.splice(v,this.length-v)},enumerable:!1,configurable:!0}),d.prototype.push=function(){for(var v,d=this,Q=[],n=0;n<arguments.length;n++)Q[n]=arguments[n];return Q.forEach((function(Q){v=d.$refId++,d.setAt(v,Q)})),v},d.prototype.pop=function(){var v=Array.from(this.$indexes.values()).pop();if(void 0!==v){this.$changes.delete(v),this.$indexes.delete(v);var d=this.$items.get(v);return this.$items.delete(v),d}},d.prototype.at=function(v){var d=Array.from(this.$items.keys())[v];return this.$items.get(d)},d.prototype.setAt=function(d,Q){var n,T;if(void 0!==Q&&null!==Q){if(this.$items.get(d)!==Q){void 0!==Q.$changes&&Q.$changes.setParent(this,this.$changes.root,d);var L=null!==(T=null===(n=this.$changes.indexes[d])||void 0===n?void 0:n.op)&&void 0!==T?T:v.OPERATION.ADD;this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,Q),this.$changes.change(d,L)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},d.prototype.deleteAt=function(v){var d=Array.from(this.$items.keys())[v];return void 0!==d&&this.$deleteAt(d)},d.prototype.$deleteAt=function(v){return this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&u.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.concat=function(){for(var v,Q=[],n=0;n<arguments.length;n++)Q[n]=arguments[n];return new(d.bind.apply(d,T([void 0],(v=Array.from(this.$items.values())).concat.apply(v,Q),!1)))},d.prototype.join=function(v){return Array.from(this.$items.values()).join(v)},d.prototype.reverse=function(){var v=this,d=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Q,n){v.setAt(d[n],Q)})),this},d.prototype.shift=function(){var v=Array.from(this.$items.keys()).shift();if(void 0!==v){var d=this.$items.get(v);return this.$deleteAt(v),d}},d.prototype.slice=function(v,Q){var n=new d;return n.push.apply(n,Array.from(this.$items.values()).slice(v,Q)),n},d.prototype.sort=function(v){var d=this;void 0===v&&(v=z);var Q=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(v).forEach((function(v,n){d.setAt(Q[n],v)})),this},d.prototype.splice=function(v,d){void 0===d&&(d=this.length-v);for(var Q=Array.from(this.$items.keys()),n=[],T=v;T<v+d;T++)n.push(this.$items.get(Q[T])),this.$deleteAt(Q[T]);return n},d.prototype.unshift=function(){for(var v=this,d=[],Q=0;Q<arguments.length;Q++)d[Q]=arguments[Q];var n=this.length,T=d.length,L=Array.from(this.$items.values());return d.forEach((function(d,Q){v.setAt(Q,d)})),L.forEach((function(d,Q){v.setAt(T+Q,d)})),n+T},d.prototype.indexOf=function(v,d){return Array.from(this.$items.values()).indexOf(v,d)},d.prototype.lastIndexOf=function(v,d){return void 0===d&&(d=this.length-1),Array.from(this.$items.values()).lastIndexOf(v,d)},d.prototype.every=function(v,d){return Array.from(this.$items.values()).every(v,d)},d.prototype.some=function(v,d){return Array.from(this.$items.values()).some(v,d)},d.prototype.forEach=function(v,d){Array.from(this.$items.values()).forEach(v,d)},d.prototype.map=function(v,d){return Array.from(this.$items.values()).map(v,d)},d.prototype.filter=function(v,d){return Array.from(this.$items.values()).filter(v,d)},d.prototype.reduce=function(v,d){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},d.prototype.reduceRight=function(v,d){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},d.prototype.find=function(v,d){return Array.from(this.$items.values()).find(v,d)},d.prototype.findIndex=function(v,d){return Array.from(this.$items.values()).findIndex(v,d)},d.prototype.fill=function(v,d,Q){throw new Error("ArraySchema#fill() not implemented")},d.prototype.copyWithin=function(v,d,Q){throw new Error("ArraySchema#copyWithin() not implemented")},d.prototype.toString=function(){return this.$items.toString()},d.prototype.toLocaleString=function(){return this.$items.toLocaleString()},d.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},d.prototype.includes=function(v,d){return Array.from(this.$items.values()).includes(v,d)},d.prototype.flatMap=function(v,d){throw new Error("ArraySchema#flatMap() is not supported.")},d.prototype.flat=function(v){throw new Error("ArraySchema#flat() is not supported.")},d.prototype.findLast=function(){var v=Array.from(this.$items.values());return v.findLast.apply(v,arguments)},d.prototype.findLastIndex=function(){var v=Array.from(this.$items.values());return v.findLastIndex.apply(v,arguments)},d.prototype.setIndex=function(v,d){this.$indexes.set(v,d)},d.prototype.getIndex=function(v){return this.$indexes.get(v)},d.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},d.prototype.deleteByIndex=function(v){var d=this.$indexes.get(v);this.$items.delete(d),this.$indexes.delete(v)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){return this.toArray().map((function(v){return"function"===typeof v.toJSON?v.toJSON():v}))},d.prototype.clone=function(v){return v?new(d.bind.apply(d,T([void 0],Array.from(this.$items.values()),!1))):new(d.bind.apply(d,T([void 0],this.map((function(v){return v.$changes?v.clone():v})),!1)))},d}();function m(v){return v.$proxy=!0,v=new Proxy(v,{get:function(v,d){return"symbol"!==typeof d&&"undefined"===typeof v[d]?v.get(d):v[d]},set:function(v,d,Q){return"symbol"!==typeof d&&-1===d.indexOf("$")&&"cc"!==d&&"rc"!==d&&"onChange"!==d?v.set(d,Q):v[d]=Q,!0},deleteProperty:function(v,d){return v.delete(d),!0}})}var V=function(){function d(v){var Q=this;if(this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v)if(v instanceof Map||v instanceof d)v.forEach((function(v,d){return Q.set(d,v)}));else for(var n in v)this.set(n,v[n])}return d.prototype.cc=function(d,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,d,Q?this.$items:void 0)},d.prototype.rc=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,d)},d.is=function(v){return void 0!==v.map},d.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(d.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.set=function(d,Q){if(void 0===Q||null===Q)throw new Error("MapSchema#set('".concat(d,"', ").concat(Q,"): trying to set ").concat(Q," value on '").concat(d,"'."));d=d.toString();var n="undefined"!==typeof this.$changes.indexes[d],T=n?this.$changes.indexes[d]:this.$refId++,L=n?v.OPERATION.REPLACE:v.OPERATION.ADD,e=void 0!==Q.$changes;if(e&&Q.$changes.setParent(this,this.$changes.root,T),n){if(!e&&this.$items.get(d)===Q)return;e&&this.$items.get(d)!==Q&&(L=v.OPERATION.ADD)}else this.$changes.indexes[d]=T,this.$indexes.set(T,d);return this.$items.set(d,Q),this.$changes.change(d,L),this},d.prototype.get=function(v){return this.$items.get(v)},d.prototype.delete=function(v){return this.$changes.delete(v),this.$items.delete(v)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&u.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(v){return this.$items.has(v)},d.prototype.forEach=function(v){this.$items.forEach(v)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(v,d){this.$indexes.set(v,d)},d.prototype.getIndex=function(v){return this.$indexes.get(v)},d.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},d.prototype.deleteByIndex=function(v){var d=this.$indexes.get(v);this.$items.delete(d),this.$indexes.delete(v)},d.prototype.toJSON=function(){var v={};return this.forEach((function(d,Q){v[Q]="function"===typeof d.toJSON?d.toJSON():d})),v},d.prototype.clone=function(v){var Q;return v?Q=Object.assign(new d,this):(Q=new d,this.forEach((function(v,d){v.$changes?Q.set(d,v.clone()):Q.set(d,v)}))),Q},d}(),h={};function S(v,d){h[v]=d}function A(v){return h[v]}var f=function(){function v(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return v.create=function(d){var Q=new v;return Q.schema=Object.assign({},d&&d.schema||{}),Q.indexes=Object.assign({},d&&d.indexes||{}),Q.fieldsByIndex=Object.assign({},d&&d.fieldsByIndex||{}),Q.descriptors=Object.assign({},d&&d.descriptors||{}),Q.deprecated=Object.assign({},d&&d.deprecated||{}),Q},v.prototype.addField=function(v,d){var Q=this.getNextFieldIndex();this.fieldsByIndex[Q]=v,this.indexes[v]=Q,this.schema[v]=Array.isArray(d)?{array:d[0]}:d},v.prototype.hasField=function(v){return void 0!==this.indexes[v]},v.prototype.addFilter=function(v,d){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[v]]=d,this.indexesWithFilters.push(this.indexes[v]),!0},v.prototype.addChildrenFilter=function(v,d){var Q=this.indexes[v],n=this.schema[v];if(A(Object.keys(n)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Q]=d,!0;console.warn("@filterChildren: field '".concat(v,"' can't have children. Ignoring filter."))},v.prototype.getChildrenFilter=function(v){return this.childFilters&&this.childFilters[this.indexes[v]]},v.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},v}();function P(v){return v._context&&v._context.useFilters}var O=function(){function v(){this.types={},this.schemas=new Map,this.useFilters=!1}return v.prototype.has=function(v){return this.schemas.has(v)},v.prototype.get=function(v){return this.types[v]},v.prototype.add=function(v,d){void 0===d&&(d=this.schemas.size),v._definition=f.create(v._definition),v._typeid=d,this.types[d]=v,this.schemas.set(v,d)},v.create=function(d){return void 0===d&&(d={}),function(Q){return d.context||(d.context=new v),K(Q,d)}},v}(),J=new O;function K(v,d){return void 0===d&&(d={}),function(Q,n){var L=d.context||J,e=Q.constructor;if(e._context=L,!v)throw new Error("".concat(e.name,': @type() reference provided for "').concat(n,"\" is undefined. Make sure you don't have any circular dependencies."));L.has(e)||L.add(e);var F=e._definition;if(F.addField(n,v),F.descriptors[n]){if(F.deprecated[n])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(n,"' definition on '").concat(e.name,"'.\nCheck @type() annotation"))}catch(h){var r=h.stack.split("\n")[4].trim();throw new Error("".concat(h.message," ").concat(r))}}var C=X.is(v),u=!C&&V.is(v);if("string"!==typeof v&&!iv.is(v)){var y=Object.values(v)[0];"string"===typeof y||L.has(y)||L.add(y)}if(d.manual)F.descriptors[n]={enumerable:!0,configurable:!0,writable:!0};else{var z="_".concat(n);F.descriptors[z]={enumerable:!1,configurable:!1,writable:!0},F.descriptors[n]={get:function(){return this[z]},set:function(v){v!==this[z]&&(void 0!==v&&null!==v?(!C||v instanceof X||(v=new(X.bind.apply(X,T([void 0],v,!1)))),!u||v instanceof V||(v=new V(v)),void 0===v.$proxy&&(u?v=m(v):C&&(v=B(v))),this.$changes.change(n),v.$changes&&v.$changes.setParent(this,this.$changes.root,this._definition.indexes[n])):this[z]&&this.$changes.delete(n),this[z]=v)},enumerable:!0,configurable:!0}}}}function o(v){return function(d,Q){var n=d.constructor;n._definition.addFilter(Q,v)&&(n._context.useFilters=!0)}}function g(v){return function(d,Q){var n=d.constructor;n._definition.addChildrenFilter(Q,v)&&(n._context.useFilters=!0)}}function R(v){return void 0===v&&(v=!0),function(d,Q){var n=d.constructor._definition;n.deprecated[Q]=!0,v&&(n.descriptors[Q]={get:function(){throw new Error("".concat(Q," is deprecated."))},set:function(v){},enumerable:!1,configurable:!0})}}function M(v,d,Q){for(var n in void 0===Q&&(Q={}),Q.context||(Q.context=v._context||Q.context||J),d)K(d[n],Q)(v.prototype,n);return v}function Y(v){for(var d=0,Q=0,n=0,T=v.length;n<T;n++)(d=v.charCodeAt(n))<128?Q+=1:d<2048?Q+=2:d<55296||d>=57344?Q+=3:(n++,Q+=4);return Q}function D(v,d,Q){for(var n=0,T=0,L=Q.length;T<L;T++)(n=Q.charCodeAt(T))<128?v[d++]=n:n<2048?(v[d++]=192|n>>6,v[d++]=128|63&n):n<55296||n>=57344?(v[d++]=224|n>>12,v[d++]=128|n>>6&63,v[d++]=128|63&n):(T++,n=65536+((1023&n)<<10|1023&Q.charCodeAt(T)),v[d++]=240|n>>18,v[d++]=128|n>>12&63,v[d++]=128|n>>6&63,v[d++]=128|63&n)}function i(v,d){v.push(255&d)}function Z(v,d){v.push(255&d)}function j(v,d){v.push(255&d),v.push(d>>8&255)}function x(v,d){v.push(255&d),v.push(d>>8&255)}function k(v,d){v.push(255&d),v.push(d>>8&255),v.push(d>>16&255),v.push(d>>24&255)}function t(v,d){var Q=d>>24,n=d>>16,T=d>>8,L=d;v.push(255&L),v.push(255&T),v.push(255&n),v.push(255&Q)}function p(v,d){var Q=Math.floor(d/Math.pow(2,32));t(v,d>>>0),t(v,Q)}function W(v,d){var Q=d/Math.pow(2,32)|0;t(v,d>>>0),t(v,Q)}function q(v,d){I(v,d)}function b(v,d){U(v,d)}var H=new Int32Array(2),s=new Float32Array(H.buffer),a=new Float64Array(H.buffer);function I(v,d){s[0]=d,k(v,H[0])}function U(v,d){a[0]=d,k(v,H[0]),k(v,H[1])}function c(v,d){return Z(v,d?1:0)}function w(v,d){d||(d="");var Q=Y(d),n=0;if(Q<32)v.push(160|Q),n=1;else if(Q<256)v.push(217),Z(v,Q),n=2;else if(Q<65536)v.push(218),x(v,Q),n=3;else{if(!(Q<4294967296))throw new Error("String too long");v.push(219),t(v,Q),n=5}return D(v,v.length,d),n+Q}function G(v,d){return isNaN(d)?G(v,0):isFinite(d)?d!==(0|d)?(v.push(203),U(v,d),9):d>=0?d<128?(Z(v,d),1):d<256?(v.push(204),Z(v,d),2):d<65536?(v.push(205),x(v,d),3):d<4294967296?(v.push(206),t(v,d),5):(v.push(207),W(v,d),9):d>=-32?(v.push(224|d+32),1):d>=-128?(v.push(208),i(v,d),2):d>=-32768?(v.push(209),j(v,d),3):d>=-2147483648?(v.push(210),k(v,d),5):(v.push(211),p(v,d),9):G(v,d>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var E=Object.freeze({__proto__:null,utf8Write:D,int8:i,uint8:Z,int16:j,uint16:x,int32:k,uint32:t,int64:p,uint64:W,float32:q,float64:b,writeFloat32:I,writeFloat64:U,boolean:c,string:w,number:G});function N(v,d,Q){for(var n="",T=0,L=d,e=d+Q;L<e;L++){var F=v[L];0!==(128&F)?192!==(224&F)?224!==(240&F)?240!==(248&F)?console.error("Invalid byte "+F.toString(16)):(T=(7&F)<<18|(63&v[++L])<<12|(63&v[++L])<<6|63&v[++L])>=65536?(T-=65536,n+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):n+=String.fromCharCode(T):n+=String.fromCharCode((15&F)<<12|(63&v[++L])<<6|63&v[++L]):n+=String.fromCharCode((31&F)<<6|63&v[++L]):n+=String.fromCharCode(F)}return n}function l(v,d){return vv(v,d)<<24>>24}function vv(v,d){return v[d.offset++]}function dv(v,d){return Qv(v,d)<<16>>16}function Qv(v,d){return v[d.offset++]|v[d.offset++]<<8}function nv(v,d){return v[d.offset++]|v[d.offset++]<<8|v[d.offset++]<<16|v[d.offset++]<<24}function Tv(v,d){return nv(v,d)>>>0}function Lv(v,d){return zv(v,d)}function ev(v,d){return Bv(v,d)}function Fv(v,d){var Q=Tv(v,d);return nv(v,d)*Math.pow(2,32)+Q}function rv(v,d){var Q=Tv(v,d);return Tv(v,d)*Math.pow(2,32)+Q}var Cv=new Int32Array(2),uv=new Float32Array(Cv.buffer),yv=new Float64Array(Cv.buffer);function zv(v,d){return Cv[0]=nv(v,d),uv[0]}function Bv(v,d){return Cv[0]=nv(v,d),Cv[1]=nv(v,d),yv[0]}function Xv(v,d){return vv(v,d)>0}function mv(v,d){var Q,n=v[d.offset++];n<192?Q=31&n:217===n?Q=vv(v,d):218===n?Q=Qv(v,d):219===n&&(Q=Tv(v,d));var T=N(v,d.offset,Q);return d.offset+=Q,T}function Vv(v,d){var Q=v[d.offset];return Q<192&&Q>160||217===Q||218===Q||219===Q}function hv(v,d){var Q=v[d.offset++];return Q<128?Q:202===Q?zv(v,d):203===Q?Bv(v,d):204===Q?vv(v,d):205===Q?Qv(v,d):206===Q?Tv(v,d):207===Q?rv(v,d):208===Q?l(v,d):209===Q?dv(v,d):210===Q?nv(v,d):211===Q?Fv(v,d):Q>223?-1*(255-Q+1):void 0}function Sv(v,d){var Q=v[d.offset];return Q<128||Q>=202&&Q<=211}function Av(v,d){return v[d.offset]<160}function fv(v,d){return v[d.offset-1]===e&&(v[d.offset]<128||v[d.offset]>=202&&v[d.offset]<=211)}var Pv=Object.freeze({__proto__:null,int8:l,uint8:vv,int16:dv,uint16:Qv,int32:nv,uint32:Tv,float32:Lv,float64:ev,int64:Fv,uint64:rv,readFloat32:zv,readFloat64:Bv,boolean:Xv,string:mv,stringCheck:Vv,number:hv,numberCheck:Sv,arrayCheck:Av,switchStructureCheck:fv}),Ov=function(){function d(v){var d=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v&&v.forEach((function(v){return d.add(v)}))}return d.prototype.cc=function(d,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,d,Q?this.$items:void 0)},d.prototype.rc=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,d)},d.is=function(v){return void 0!==v.collection},d.prototype.add=function(v){var d=this.$refId++;return void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,d),this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,v),this.$changes.change(d),d},d.prototype.at=function(v){var d=Array.from(this.$items.keys())[v];return this.$items.get(d)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(v){for(var d,Q,n=this.$items.entries();(Q=n.next())&&!Q.done;)if(v===Q.value[1]){d=Q.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&u.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(v){return Array.from(this.$items.values()).some((function(d){return d===v}))},d.prototype.forEach=function(v){var d=this;this.$items.forEach((function(Q,n,T){return v(Q,n,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(v,d){this.$indexes.set(v,d)},d.prototype.getIndex=function(v){return this.$indexes.get(v)},d.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},d.prototype.deleteByIndex=function(v){var d=this.$indexes.get(v);this.$items.delete(d),this.$indexes.delete(v)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var v=[];return this.forEach((function(d,Q){v.push("function"===typeof d.toJSON?d.toJSON():d)})),v},d.prototype.clone=function(v){var Q;return v?Q=Object.assign(new d,this):(Q=new d,this.forEach((function(v){v.$changes?Q.add(v.clone()):Q.add(v)}))),Q},d}(),Jv=function(){function d(v){var d=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v&&v.forEach((function(v){return d.add(v)}))}return d.prototype.cc=function(d,Q){return void 0===Q&&(Q=!0),C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,d,Q?this.$items:void 0)},d.prototype.rc=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,d)},d.is=function(v){return void 0!==v.set},d.prototype.add=function(d){var Q,n;if(this.has(d))return!1;var T=this.$refId++;void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,T);var L=null!==(n=null===(Q=this.$changes.indexes[T])||void 0===Q?void 0:Q.op)&&void 0!==n?n:v.OPERATION.ADD;return this.$changes.indexes[T]=T,this.$indexes.set(T,T),this.$items.set(T,d),this.$changes.change(T,L),T},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(v){for(var d,Q,n=this.$items.entries();(Q=n.next())&&!Q.done;)if(v===Q.value[1]){d=Q.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&u.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(v){for(var d,Q=this.$items.values(),n=!1;(d=Q.next())&&!d.done;)if(v===d.value){n=!0;break}return n},d.prototype.forEach=function(v){var d=this;this.$items.forEach((function(Q,n,T){return v(Q,n,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(v,d){this.$indexes.set(v,d)},d.prototype.getIndex=function(v){return this.$indexes.get(v)},d.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},d.prototype.deleteByIndex=function(v){var d=this.$indexes.get(v);this.$items.delete(d),this.$indexes.delete(v)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var v=[];return this.forEach((function(d,Q){v.push("function"===typeof d.toJSON?d.toJSON():d)})),v},d.prototype.clone=function(v){var Q;return v?Q=Object.assign(new d,this):(Q=new d,this.forEach((function(v){v.$changes?Q.add(v.clone()):Q.add(v)}))),Q},d}(),Kv=function(){function v(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return v.prototype.addRefId=function(v){this.refIds.has(v)||(this.refIds.add(v),this.containerIndexes.set(v,new Set))},v.get=function(d){return void 0===d.$filterState&&(d.$filterState=new v),d.$filterState},v}(),ov=function(){function v(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return v.prototype.getNextUniqueId=function(){return this.nextUniqueId++},v.prototype.addRef=function(v,d,Q){void 0===Q&&(Q=!0),this.refs.set(v,d),Q&&(this.refCounts[v]=(this.refCounts[v]||0)+1)},v.prototype.removeRef=function(v){this.refCounts[v]=this.refCounts[v]-1,this.deletedRefs.add(v)},v.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},v.prototype.garbageCollectDeletedRefs=function(){var v=this;this.deletedRefs.forEach((function(d){if(!(v.refCounts[d]>0)){var Q=v.refs.get(d);if(Q instanceof iv)for(var n in Q._definition.schema)"string"!==typeof Q._definition.schema[n]&&Q[n]&&Q[n].$changes&&v.removeRef(Q[n].$changes.refId);else{var T=Q.$changes.parent._definition,L=T.schema[T.fieldsByIndex[Q.$changes.parentIndex]];"function"===typeof Object.values(L)[0]&&Array.from(Q.values()).forEach((function(d){return v.removeRef(d.$changes.refId)}))}v.refs.delete(d),delete v.refCounts[d]}})),this.deletedRefs.clear()},v}(),gv=function(v){function d(){return null!==v&&v.apply(this,arguments)||this}return Q(d,v),d}(Error);function Rv(v,d,Q,n){var T,L=!1;switch(d){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":T="number",isNaN(v)&&console.log('trying to encode "NaN" in '.concat(Q.constructor.name,"#").concat(n));break;case"string":T="string",L=!0;break;case"boolean":return}if(typeof v!==T&&(!L||L&&null!==v)){var e="'".concat(JSON.stringify(v),"'").concat(v&&v.constructor&&" (".concat(v.constructor.name,")")||"");throw new gv("a '".concat(T,"' was expected, but ").concat(e," was provided in ").concat(Q.constructor.name,"#").concat(n))}}function Mv(v,d,Q,n){if(!(v instanceof d))throw new gv("a '".concat(d.name,"' was expected, but '").concat(v.constructor.name,"' was provided in ").concat(Q.constructor.name,"#").concat(n))}function Yv(v,d,Q,n,T){Rv(Q,v,n,T);var L=E[v];if(!L)throw new gv("a '".concat(v,"' was expected, but ").concat(Q," was provided in ").concat(n.constructor.name,"#").concat(T));L(d,Q)}function Dv(v,d,Q){return Pv[v](d,Q)}var iv=function(){function d(){for(var v=[],d=0;d<arguments.length;d++)v[d]=arguments[d];Object.defineProperties(this,{$changes:{value:new r(this,void 0,new ov),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Q=this._definition.descriptors;Q&&Object.defineProperties(this,Q),v[0]&&this.assign(v[0])}return d.onError=function(v){console.error(v)},d.is=function(v){return v._definition&&void 0!==v._definition.schema},d.prototype.onChange=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,d)},d.prototype.rc=function(d){return C(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,d)},d.prototype.assign=function(v){return Object.assign(this,v),this},Object.defineProperty(d.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),d.prototype.setDirty=function(v,d){this.$changes.change(v,d)},d.prototype.listen=function(v,d,Q){var n=this;return void 0===Q&&(Q=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[v]||(this.$callbacks[v]=[]),this.$callbacks[v].push(d),Q&&void 0!==this[v]&&d(this[v],void 0),function(){return y(n.$callbacks[v],n.$callbacks[v].indexOf(d))}},d.prototype.decode=function(Q,n,T){var L;void 0===n&&(n={offset:0}),void 0===T&&(T=this);var F=[],r=this.$changes.root,C=Q.length,u=0;for(r.refs.set(u,this);n.offset<C;){var y=Q[n.offset++];if(y!=e){var z=T.$changes,B=void 0!==T._definition,m=B?y>>6<<6:y;if(m!==v.OPERATION.CLEAR){var h=B?y%(m||255):hv(Q,n),S=B?T._definition.fieldsByIndex[h]:"",f=z.getType(h),P=void 0,O=void 0,J=void 0;if(B?O=T["_".concat(S)]:(O=T.getByIndex(h),(m&v.OPERATION.ADD)===v.OPERATION.ADD?(J=T instanceof V?mv(Q,n):h,T.setIndex(h,J)):J=T.getIndex(h)),(m&v.OPERATION.DELETE)===v.OPERATION.DELETE&&(m!==v.OPERATION.DELETE_AND_ADD&&T.deleteByIndex(h),O&&O.$changes&&r.removeRef(O.$changes.refId),P=null),void 0!==S){if(m===v.OPERATION.DELETE);else if(d.is(f)){var K=hv(Q,n);if(P=r.refs.get(K),m!==v.OPERATION.REPLACE){var o=this.getSchemaType(Q,n,f);P||((P=this.createTypeInstance(o)).$changes.refId=K,O&&(P.$callbacks=O.$callbacks,O.$changes.refId&&K!==O.$changes.refId&&r.removeRef(O.$changes.refId))),r.addRef(K,P,P!==O)}}else if("string"===typeof f)P=Dv(f,Q,n);else{var g=A(Object.keys(f)[0]),R=hv(Q,n),M=r.refs.has(R)?O||r.refs.get(R):new g.constructor;if((P=M.clone(!0)).$changes.refId=R,O&&(P.$callbacks=O.$callbacks,O.$changes.refId&&R!==O.$changes.refId)){r.removeRef(O.$changes.refId);for(var Y=O.entries(),D=void 0;(D=Y.next())&&!D.done;){var i=(L=D.value)[0],Z=L[1];F.push({refId:R,op:v.OPERATION.DELETE,field:i,value:void 0,previousValue:Z})}}r.addRef(R,P,M!==O)}if(null!==P&&void 0!==P)if(P.$changes&&P.$changes.setParent(z.ref,z.root,h),T instanceof d)T[S]=P;else if(T instanceof V)i=J,T.$items.set(i,P),T.$changes.allChanges.add(h);else if(T instanceof X)T.setAt(h,P);else if(T instanceof Ov){var j=T.add(P);T.setIndex(h,j)}else T instanceof Jv&&!1!==(j=T.add(P))&&T.setIndex(h,j);O!==P&&F.push({refId:u,op:m,field:S,dynamicIndex:J,value:P,previousValue:O})}else{console.warn("@colyseus/schema: definition mismatch");for(var x={offset:n.offset};n.offset<C&&(!fv(Q,n)||(x.offset=n.offset+1,!r.refs.has(hv(Q,x))));)n.offset++}}else T.clear(F)}else{u=hv(Q,n);var k=r.refs.get(u);if(!k)throw new Error('"refId" not found: '.concat(u));T=k}}return this._triggerChanges(F),r.garbageCollectDeletedRefs(),F},d.prototype.encode=function(Q,n,T){void 0===Q&&(Q=!1),void 0===n&&(n=[]),void 0===T&&(T=!1);for(var L=this.$changes,F=new WeakSet,r=[L],C=1,u=0;u<C;u++){var y=r[u],z=y.ref,B=z instanceof d;y.ensureRefId(),F.add(y),y!==L&&(y.changed||Q)&&(Z(n,e),G(n,y.refId));for(var X=Q?Array.from(y.allChanges):Array.from(y.changes.values()),m=0,h=X.length;m<h;m++){var S=Q?{op:v.OPERATION.ADD,index:X[m]}:X[m],f=S.index,P=B?z._definition.fieldsByIndex&&z._definition.fieldsByIndex[f]:f,O=n.length;if(S.op!==v.OPERATION.TOUCH)if(B)Z(n,f|S.op);else{if(Z(n,S.op),S.op===v.OPERATION.CLEAR)continue;G(n,f)}if(B||(S.op&v.OPERATION.ADD)!=v.OPERATION.ADD||z instanceof V&&w(n,y.ref.$indexes.get(f)),S.op!==v.OPERATION.DELETE){var J=y.getType(f),K=y.getValue(f);if(K&&K.$changes&&!F.has(K.$changes)&&(r.push(K.$changes),K.$changes.ensureRefId(),C++),S.op!==v.OPERATION.TOUCH){if(d.is(J))Mv(K,J,z,P),G(n,K.$changes.refId),(S.op&v.OPERATION.ADD)===v.OPERATION.ADD&&this.tryEncodeTypeId(n,J,K.constructor);else if("string"===typeof J)Yv(J,n,K,z,P);else{var o=A(Object.keys(J)[0]);Mv(z["_".concat(P)],o.constructor,z,P),G(n,K.$changes.refId)}T&&y.cache(f,n.slice(O))}}}Q||T||y.discard()}return n},d.prototype.encodeAll=function(v){return this.encode(!0,[],v)},d.prototype.applyFilters=function(Q,n){var T,L;void 0===n&&(n=!1);for(var F=this,r=new Set,C=Kv.get(Q),u=[this.$changes],y=1,z=[],B=function(B){var X=u[B];if(r.has(X.refId))return"continue";var m=X.ref,h=m instanceof d;Z(z,e),G(z,X.refId);var S=C.refIds.has(X),A=n||!S;C.addRefId(X);var f=C.containerIndexes.get(X),P=A?Array.from(X.allChanges):Array.from(X.changes.values());!n&&h&&m._definition.indexesWithFilters&&m._definition.indexesWithFilters.forEach((function(d){!f.has(d)&&X.allChanges.has(d)&&(A?P.push(d):P.push({op:v.OPERATION.ADD,index:d}))}));for(var O=0,J=P.length;O<J;O++){var K=A?{op:v.OPERATION.ADD,index:P[O]}:P[O];if(K.op!==v.OPERATION.CLEAR){var o=K.index;if(K.op!==v.OPERATION.DELETE){var g=X.getValue(o),R=X.getType(o);if(h){if((M=m._definition.filters&&m._definition.filters[o])&&!M.call(m,Q,g,F)){g&&g.$changes&&r.add(g.$changes.refId);continue}}else{var M,Y=X.parent;if((M=X.getChildrenFilter())&&!M.call(Y,Q,m.$indexes.get(o),g,F)){g&&g.$changes&&r.add(g.$changes.refId);continue}}if(g.$changes&&(u.push(g.$changes),y++),K.op!==v.OPERATION.TOUCH)if(K.op===v.OPERATION.ADD||h)z.push.apply(z,null!==(T=X.caches[o])&&void 0!==T?T:[]),f.add(o);else if(f.has(o))z.push.apply(z,null!==(L=X.caches[o])&&void 0!==L?L:[]);else{if(f.add(o),Z(z,v.OPERATION.ADD),G(z,o),m instanceof V){var D=X.ref.$indexes.get(o);w(z,D)}g.$changes?G(z,g.$changes.refId):E[R](z,g)}else g.$changes&&!h&&(Z(z,v.OPERATION.ADD),G(z,o),m instanceof V&&(D=X.ref.$indexes.get(o),w(z,D)),G(z,g.$changes.refId))}else h?Z(z,K.op|o):(Z(z,K.op),G(z,o))}else Z(z,K.op)}},X=0;X<y;X++)B(X);return z},d.prototype.clone=function(){var v,d=new this.constructor,Q=this._definition.schema;for(var n in Q)"object"===typeof this[n]&&"function"===typeof(null===(v=this[n])||void 0===v?void 0:v.clone)?d[n]=this[n].clone():d[n]=this[n];return d},d.prototype.toJSON=function(){var v=this._definition.schema,d=this._definition.deprecated,Q={};for(var n in v)d[n]||null===this[n]||"undefined"===typeof this[n]||(Q[n]="function"===typeof this[n].toJSON?this[n].toJSON():this["_".concat(n)]);return Q},d.prototype.discardAllChanges=function(){this.$changes.discardAll()},d.prototype.getByIndex=function(v){return this[this._definition.fieldsByIndex[v]]},d.prototype.deleteByIndex=function(v){this[this._definition.fieldsByIndex[v]]=void 0},d.prototype.tryEncodeTypeId=function(v,d,Q){d._typeid!==Q._typeid&&(Z(v,F),G(v,Q._typeid))},d.prototype.getSchemaType=function(v,d,Q){var n;return v[d.offset]===F&&(d.offset++,n=this.constructor._context.get(hv(v,d))),n||Q},d.prototype.createTypeInstance=function(v){var d=new v;return d.$changes.root=this.$changes.root,d},d.prototype._triggerChanges=function(Q){for(var n,T,L,e,F,r,C,u,y,z=new Set,B=this.$changes.root.refs,X=function(X){var m=Q[X],V=m.refId,h=B.get(V),S=h.$callbacks;if((m.op&v.OPERATION.DELETE)===v.OPERATION.DELETE&&m.previousValue instanceof d&&(null===(T=null===(n=m.previousValue.$callbacks)||void 0===n?void 0:n[v.OPERATION.DELETE])||void 0===T||T.forEach((function(v){return v()}))),!S)return"continue";if(h instanceof d){if(!z.has(V))try{null===(L=null===S||void 0===S?void 0:S[v.OPERATION.REPLACE])||void 0===L||L.forEach((function(v){return v()}))}catch(A){d.onError(A)}try{S.hasOwnProperty(m.field)&&(null===(e=S[m.field])||void 0===e||e.forEach((function(v){return v(m.value,m.previousValue)})))}catch(A){d.onError(A)}}else m.op===v.OPERATION.ADD&&void 0===m.previousValue?null===(F=S[v.OPERATION.ADD])||void 0===F||F.forEach((function(v){var d;return v(m.value,null!==(d=m.dynamicIndex)&&void 0!==d?d:m.field)})):m.op===v.OPERATION.DELETE?void 0!==m.previousValue&&(null===(r=S[v.OPERATION.DELETE])||void 0===r||r.forEach((function(v){var d;return v(m.previousValue,null!==(d=m.dynamicIndex)&&void 0!==d?d:m.field)}))):m.op===v.OPERATION.DELETE_AND_ADD&&(void 0!==m.previousValue&&(null===(C=S[v.OPERATION.DELETE])||void 0===C||C.forEach((function(v){var d;return v(m.previousValue,null!==(d=m.dynamicIndex)&&void 0!==d?d:m.field)}))),null===(u=S[v.OPERATION.ADD])||void 0===u||u.forEach((function(v){var d;return v(m.value,null!==(d=m.dynamicIndex)&&void 0!==d?d:m.field)}))),m.value!==m.previousValue&&(null===(y=S[v.OPERATION.REPLACE])||void 0===y||y.forEach((function(v){var d;return v(m.value,null!==(d=m.dynamicIndex)&&void 0!==d?d:m.field)})));z.add(V)},m=0;m<Q.length;m++)X(m)},d._definition=f.create(),d}();function Zv(v){for(var d=[v.$changes],Q=1,n={},T=n,L=function(v){var Q=d[v];Q.changes.forEach((function(v){var d=Q.ref,n=v.index,L=d._definition?d._definition.fieldsByIndex[n]:d.$indexes.get(n);T[L]=Q.getValue(n)}))},e=0;e<Q;e++)L(e);return n}var jv={context:new O},xv=function(v){function d(){return null!==v&&v.apply(this,arguments)||this}return Q(d,v),n([K("string",jv)],d.prototype,"name",void 0),n([K("string",jv)],d.prototype,"type",void 0),n([K("number",jv)],d.prototype,"referencedType",void 0),d}(iv),kv=function(v){function d(){var d=null!==v&&v.apply(this,arguments)||this;return d.fields=new X,d}return Q(d,v),n([K("number",jv)],d.prototype,"id",void 0),n([K([xv],jv)],d.prototype,"fields",void 0),d}(iv),tv=function(v){function d(){var d=null!==v&&v.apply(this,arguments)||this;return d.types=new X,d}return Q(d,v),d.encode=function(v){var Q=v.constructor,n=new d;n.rootType=Q._typeid;var T=function(v,d){for(var Q in d){var T=new xv;T.name=Q;var L=void 0;if("string"===typeof d[Q])L=d[Q];else{var e=d[Q],F=void 0;iv.is(e)?(L="ref",F=d[Q]):"string"===typeof e[L=Object.keys(e)[0]]?L+=":"+e[L]:F=e[L],T.referencedType=F?F._typeid:-1}T.type=L,v.fields.push(T)}n.types.push(v)},L=Q._context.types;for(var e in L){var F=new kv;F.id=Number(e),T(F,L[e]._definition.schema)}return n.encodeAll()},d.decode=function(v,n){var T=new O,L=new d;L.decode(v,n);var e=L.types.reduce((function(v,d){var n=function(v){function d(){return null!==v&&v.apply(this,arguments)||this}return Q(d,v),d}(iv),L=d.id;return v[L]=n,T.add(n,L),v}),{});L.types.forEach((function(v){var d=e[v.id];v.fields.forEach((function(v){var Q;if(void 0!==v.referencedType){var n=v.type,L=e[v.referencedType];if(!L){var F=v.type.split(":");n=F[0],L=F[1]}"ref"===n?K(L,{context:T})(d.prototype,v.name):K(((Q={})[n]=L,Q),{context:T})(d.prototype,v.name)}else K(v.type,{context:T})(d.prototype,v.name)}))}));var F=e[L.rootType],r=new F;for(var C in F._definition.schema){var u=F._definition.schema[C];"string"!==typeof u&&(r[C]="function"===typeof u?new u:new(A(Object.keys(u)[0]).constructor))}return r},n([K([kv],jv)],d.prototype,"types",void 0),n([K("number",jv)],d.prototype,"rootType",void 0),d}(iv);S("map",{constructor:V}),S("array",{constructor:X}),S("set",{constructor:Jv}),S("collection",{constructor:Ov}),v.ArraySchema=X,v.CollectionSchema=Ov,v.Context=O,v.MapSchema=V,v.Reflection=tv,v.ReflectionField=xv,v.ReflectionType=kv,v.Schema=iv,v.SchemaDefinition=f,v.SetSchema=Jv,v.decode=Pv,v.defineTypes=M,v.deprecated=R,v.dumpChanges=Zv,v.encode=E,v.filter=o,v.filterChildren=g,v.hasFilter=P,v.registerType=S,v.type=K,Object.defineProperty(v,"__esModule",{value:!0})}(d)},13133:v=>{"use strict";v.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13128:(v,d,Q)=>{var n=Q(13133),T=Q(13137),L=Object.hasOwnProperty,e=Object.create(null);for(var F in n)L.call(n,F)&&(e[n[F]]=F);var r=v.exports={to:{},get:{}};function C(v,d,Q){return Math.min(Math.max(d,v),Q)}function u(v){var d=Math.round(v).toString(16).toUpperCase();return d.length<2?"0"+d:d}r.get=function(v){var d,Q;switch(v.substring(0,3).toLowerCase()){case"hsl":d=r.get.hsl(v),Q="hsl";break;case"hwb":d=r.get.hwb(v),Q="hwb";break;default:d=r.get.rgb(v),Q="rgb"}return d?{model:Q,value:d}:null},r.get.rgb=function(v){if(!v)return null;var d,Q,T,e=[0,0,0,1];if(d=v.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(T=d[2],d=d[1],Q=0;Q<3;Q++){var F=2*Q;e[Q]=parseInt(d.slice(F,F+2),16)}T&&(e[3]=parseInt(T,16)/255)}else if(d=v.match(/^#([a-f0-9]{3,4})$/i)){for(T=(d=d[1])[3],Q=0;Q<3;Q++)e[Q]=parseInt(d[Q]+d[Q],16);T&&(e[3]=parseInt(T+T,16)/255)}else if(d=v.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Q=0;Q<3;Q++)e[Q]=parseInt(d[Q+1],0);d[4]&&(d[5]?e[3]=.01*parseFloat(d[4]):e[3]=parseFloat(d[4]))}else{if(!(d=v.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(d=v.match(/^(\w+)$/))?"transparent"===d[1]?[0,0,0,0]:L.call(n,d[1])?((e=n[d[1]])[3]=1,e):null:null;for(Q=0;Q<3;Q++)e[Q]=Math.round(2.55*parseFloat(d[Q+1]));d[4]&&(d[5]?e[3]=.01*parseFloat(d[4]):e[3]=parseFloat(d[4]))}for(Q=0;Q<3;Q++)e[Q]=C(e[Q],0,255);return e[3]=C(e[3],0,1),e},r.get.hsl=function(v){if(!v)return null;var d=v.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var Q=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,C(parseFloat(d[2]),0,100),C(parseFloat(d[3]),0,100),C(isNaN(Q)?1:Q,0,1)]}return null},r.get.hwb=function(v){if(!v)return null;var d=v.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var Q=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,C(parseFloat(d[2]),0,100),C(parseFloat(d[3]),0,100),C(isNaN(Q)?1:Q,0,1)]}return null},r.to.hex=function(){var v=T(arguments);return"#"+u(v[0])+u(v[1])+u(v[2])+(v[3]<1?u(Math.round(255*v[3])):"")},r.to.rgb=function(){var v=T(arguments);return v.length<4||1===v[3]?"rgb("+Math.round(v[0])+", "+Math.round(v[1])+", "+Math.round(v[2])+")":"rgba("+Math.round(v[0])+", "+Math.round(v[1])+", "+Math.round(v[2])+", "+v[3]+")"},r.to.rgb.percent=function(){var v=T(arguments),d=Math.round(v[0]/255*100),Q=Math.round(v[1]/255*100),n=Math.round(v[2]/255*100);return v.length<4||1===v[3]?"rgb("+d+"%, "+Q+"%, "+n+"%)":"rgba("+d+"%, "+Q+"%, "+n+"%, "+v[3]+")"},r.to.hsl=function(){var v=T(arguments);return v.length<4||1===v[3]?"hsl("+v[0]+", "+v[1]+"%, "+v[2]+"%)":"hsla("+v[0]+", "+v[1]+"%, "+v[2]+"%, "+v[3]+")"},r.to.hwb=function(){var v=T(arguments),d="";return v.length>=4&&1!==v[3]&&(d=", "+v[3]),"hwb("+v[0]+", "+v[1]+"%, "+v[2]+"%"+d+")"},r.to.keyword=function(v){return e[v.slice(0,3)]}},13123:(v,d,Q)=>{const n=Q(13128),T=Q(13150),L=["keyword","gray","hex"],e={};for(const B of Object.keys(T))e[[...T[B].labels].sort().join("")]=B;const F={};function r(v,d){if(!(this instanceof r))return new r(v,d);if(d&&d in L&&(d=null),d&&!(d in T))throw new Error("Unknown model: "+d);let Q,C;if(null==v)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(v instanceof r)this.model=v.model,this.color=[...v.color],this.valpha=v.valpha;else if("string"===typeof v){const d=n.get(v);if(null===d)throw new Error("Unable to parse color from string: "+v);this.model=d.model,C=T[this.model].channels,this.color=d.value.slice(0,C),this.valpha="number"===typeof d.value[C]?d.value[C]:1}else if(v.length>0){this.model=d||"rgb",C=T[this.model].channels;const Q=Array.prototype.slice.call(v,0,C);this.color=z(Q,C),this.valpha="number"===typeof v[C]?v[C]:1}else if("number"===typeof v)this.model="rgb",this.color=[v>>16&255,v>>8&255,255&v],this.valpha=1;else{this.valpha=1;const d=Object.keys(v);"alpha"in v&&(d.splice(d.indexOf("alpha"),1),this.valpha="number"===typeof v.alpha?v.alpha:0);const n=d.sort().join("");if(!(n in e))throw new Error("Unable to parse color from object: "+JSON.stringify(v));this.model=e[n];const{labels:L}=T[this.model],F=[];for(Q=0;Q<L.length;Q++)F.push(v[L[Q]]);this.color=z(F)}if(F[this.model])for(C=T[this.model].channels,Q=0;Q<C;Q++){const v=F[this.model][Q];v&&(this.color[Q]=v(this.color[Q]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}r.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(v){let d=this.model in n.to?this:this.rgb();d=d.round("number"===typeof v?v:1);const Q=1===d.valpha?d.color:[...d.color,this.valpha];return n.to[d.model](Q)},percentString(v){const d=this.rgb().round("number"===typeof v?v:1),Q=1===d.valpha?d.color:[...d.color,this.valpha];return n.to.rgb.percent(Q)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const v={},{channels:d}=T[this.model],{labels:Q}=T[this.model];for(let n=0;n<d;n++)v[Q[n]]=this.color[n];return 1!==this.valpha&&(v.alpha=this.valpha),v},unitArray(){const v=this.rgb().color;return v[0]/=255,v[1]/=255,v[2]/=255,1!==this.valpha&&v.push(this.valpha),v},unitObject(){const v=this.rgb().object();return v.r/=255,v.g/=255,v.b/=255,1!==this.valpha&&(v.alpha=this.valpha),v},round(v){return v=Math.max(v||0,0),new r([...this.color.map(C(v)),this.valpha],this.model)},alpha(v){return void 0!==v?new r([...this.color,Math.max(0,Math.min(1,v))],this.model):this.valpha},red:u("rgb",0,y(255)),green:u("rgb",1,y(255)),blue:u("rgb",2,y(255)),hue:u(["hsl","hsv","hsl","hwb","hcg"],0,(v=>(v%360+360)%360)),saturationl:u("hsl",1,y(100)),lightness:u("hsl",2,y(100)),saturationv:u("hsv",1,y(100)),value:u("hsv",2,y(100)),chroma:u("hcg",1,y(100)),gray:u("hcg",2,y(100)),white:u("hwb",1,y(100)),wblack:u("hwb",2,y(100)),cyan:u("cmyk",0,y(100)),magenta:u("cmyk",1,y(100)),yellow:u("cmyk",2,y(100)),black:u("cmyk",3,y(100)),x:u("xyz",0,y(95.047)),y:u("xyz",1,y(100)),z:u("xyz",2,y(108.833)),l:u("lab",0,y(100)),a:u("lab",1),b:u("lab",2),keyword(v){return void 0!==v?new r(v):T[this.model].keyword(this.color)},hex(v){return void 0!==v?new r(v):n.to.hex(this.rgb().round().color)},hexa(v){if(void 0!==v)return new r(v);const d=this.rgb().round().color;let Q=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Q.length&&(Q="0"+Q),n.to.hex(d)+Q},rgbNumber(){const v=this.rgb().color;return(255&v[0])<<16|(255&v[1])<<8|255&v[2]},luminosity(){const v=this.rgb().color,d=[];for(const[Q,n]of v.entries()){const v=n/255;d[Q]=v<=.04045?v/12.92:((v+.055)/1.055)**2.4}return.2126*d[0]+.7152*d[1]+.0722*d[2]},contrast(v){const d=this.luminosity(),Q=v.luminosity();return d>Q?(d+.05)/(Q+.05):(Q+.05)/(d+.05)},level(v){const d=this.contrast(v);return d>=7?"AAA":d>=4.5?"AA":""},isDark(){const v=this.rgb().color;return(2126*v[0]+7152*v[1]+722*v[2])/1e4<128},isLight(){return!this.isDark()},negate(){const v=this.rgb();for(let d=0;d<3;d++)v.color[d]=255-v.color[d];return v},lighten(v){const d=this.hsl();return d.color[2]+=d.color[2]*v,d},darken(v){const d=this.hsl();return d.color[2]-=d.color[2]*v,d},saturate(v){const d=this.hsl();return d.color[1]+=d.color[1]*v,d},desaturate(v){const d=this.hsl();return d.color[1]-=d.color[1]*v,d},whiten(v){const d=this.hwb();return d.color[1]+=d.color[1]*v,d},blacken(v){const d=this.hwb();return d.color[2]+=d.color[2]*v,d},grayscale(){const v=this.rgb().color,d=.3*v[0]+.59*v[1]+.11*v[2];return r.rgb(d,d,d)},fade(v){return this.alpha(this.valpha-this.valpha*v)},opaquer(v){return this.alpha(this.valpha+this.valpha*v)},rotate(v){const d=this.hsl();let Q=d.color[0];return Q=(Q+v)%360,Q=Q<0?360+Q:Q,d.color[0]=Q,d},mix(v,d){if(!v||!v.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof v);const Q=v.rgb(),n=this.rgb(),T=void 0===d?.5:d,L=2*T-1,e=Q.alpha()-n.alpha(),F=((L*e===-1?L:(L+e)/(1+L*e))+1)/2,C=1-F;return r.rgb(F*Q.red()+C*n.red(),F*Q.green()+C*n.green(),F*Q.blue()+C*n.blue(),Q.alpha()*T+n.alpha()*(1-T))}};for(const B of Object.keys(T)){if(L.includes(B))continue;const{channels:v}=T[B];r.prototype[B]=function(){if(this.model===B)return new r(this);for(var v=arguments.length,d=new Array(v),Q=0;Q<v;Q++)d[Q]=arguments[Q];return d.length>0?new r(d,B):new r([...(n=T[this.model][B].raw(this.color),Array.isArray(n)?n:[n]),this.valpha],B);var n},r[B]=function(){for(var d=arguments.length,Q=new Array(d),n=0;n<d;n++)Q[n]=arguments[n];let T=Q[0];return"number"===typeof T&&(T=z(Q,v)),new r(T,B)}}function C(v){return function(d){return function(v,d){return Number(v.toFixed(d))}(d,v)}}function u(v,d,Q){v=Array.isArray(v)?v:[v];for(const n of v)(F[n]||(F[n]=[]))[d]=Q;return v=v[0],function(n){let T;return void 0!==n?(Q&&(n=Q(n)),T=this[v](),T.color[d]=n,T):(T=this[v]().color[d],Q&&(T=Q(T)),T)}}function y(v){return function(d){return Math.max(0,Math.min(v,d))}}function z(v,d){for(let Q=0;Q<d;Q++)"number"!==typeof v[Q]&&(v[Q]=0);return v}v.exports=r},13157:(v,d,Q)=>{const n=Q(13164),T={};for(const e of Object.keys(n))T[n[e]]=e;const L={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};v.exports=L;for(const e of Object.keys(L)){if(!("channels"in L[e]))throw new Error("missing channels property: "+e);if(!("labels"in L[e]))throw new Error("missing channel labels property: "+e);if(L[e].labels.length!==L[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:v,labels:d}=L[e];delete L[e].channels,delete L[e].labels,Object.defineProperty(L[e],"channels",{value:v}),Object.defineProperty(L[e],"labels",{value:d})}L.rgb.hsl=function(v){const d=v[0]/255,Q=v[1]/255,n=v[2]/255,T=Math.min(d,Q,n),L=Math.max(d,Q,n),e=L-T;let F,r;L===T?F=0:d===L?F=(Q-n)/e:Q===L?F=2+(n-d)/e:n===L&&(F=4+(d-Q)/e),F=Math.min(60*F,360),F<0&&(F+=360);const C=(T+L)/2;return r=L===T?0:C<=.5?e/(L+T):e/(2-L-T),[F,100*r,100*C]},L.rgb.hsv=function(v){let d,Q,n,T,L;const e=v[0]/255,F=v[1]/255,r=v[2]/255,C=Math.max(e,F,r),u=C-Math.min(e,F,r),y=function(v){return(C-v)/6/u+.5};return 0===u?(T=0,L=0):(L=u/C,d=y(e),Q=y(F),n=y(r),e===C?T=n-Q:F===C?T=1/3+d-n:r===C&&(T=2/3+Q-d),T<0?T+=1:T>1&&(T-=1)),[360*T,100*L,100*C]},L.rgb.hwb=function(v){const d=v[0],Q=v[1];let n=v[2];const T=L.rgb.hsl(v)[0],e=1/255*Math.min(d,Math.min(Q,n));return n=1-1/255*Math.max(d,Math.max(Q,n)),[T,100*e,100*n]},L.rgb.cmyk=function(v){const d=v[0]/255,Q=v[1]/255,n=v[2]/255,T=Math.min(1-d,1-Q,1-n);return[100*((1-d-T)/(1-T)||0),100*((1-Q-T)/(1-T)||0),100*((1-n-T)/(1-T)||0),100*T]},L.rgb.keyword=function(v){const d=T[v];if(d)return d;let Q,L=1/0;for(const T of Object.keys(n)){const d=n[T],r=(F=d,((e=v)[0]-F[0])**2+(e[1]-F[1])**2+(e[2]-F[2])**2);r<L&&(L=r,Q=T)}var e,F;return Q},L.keyword.rgb=function(v){return n[v]},L.rgb.xyz=function(v){let d=v[0]/255,Q=v[1]/255,n=v[2]/255;d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92;return[100*(.4124*d+.3576*Q+.1805*n),100*(.2126*d+.7152*Q+.0722*n),100*(.0193*d+.1192*Q+.9505*n)]},L.rgb.lab=function(v){const d=L.rgb.xyz(v);let Q=d[0],n=d[1],T=d[2];Q/=95.047,n/=100,T/=108.883,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,T=T>.008856?T**(1/3):7.787*T+16/116;return[116*n-16,500*(Q-n),200*(n-T)]},L.hsl.rgb=function(v){const d=v[0]/360,Q=v[1]/100,n=v[2]/100;let T,L,e;if(0===Q)return e=255*n,[e,e,e];T=n<.5?n*(1+Q):n+Q-n*Q;const F=2*n-T,r=[0,0,0];for(let C=0;C<3;C++)L=d+1/3*-(C-1),L<0&&L++,L>1&&L--,e=6*L<1?F+6*(T-F)*L:2*L<1?T:3*L<2?F+(T-F)*(2/3-L)*6:F,r[C]=255*e;return r},L.hsl.hsv=function(v){const d=v[0];let Q=v[1]/100,n=v[2]/100,T=Q;const L=Math.max(n,.01);n*=2,Q*=n<=1?n:2-n,T*=L<=1?L:2-L;return[d,100*(0===n?2*T/(L+T):2*Q/(n+Q)),100*((n+Q)/2)]},L.hsv.rgb=function(v){const d=v[0]/60,Q=v[1]/100;let n=v[2]/100;const T=Math.floor(d)%6,L=d-Math.floor(d),e=255*n*(1-Q),F=255*n*(1-Q*L),r=255*n*(1-Q*(1-L));switch(n*=255,T){case 0:return[n,r,e];case 1:return[F,n,e];case 2:return[e,n,r];case 3:return[e,F,n];case 4:return[r,e,n];case 5:return[n,e,F]}},L.hsv.hsl=function(v){const d=v[0],Q=v[1]/100,n=v[2]/100,T=Math.max(n,.01);let L,e;e=(2-Q)*n;const F=(2-Q)*T;return L=Q*T,L/=F<=1?F:2-F,L=L||0,e/=2,[d,100*L,100*e]},L.hwb.rgb=function(v){const d=v[0]/360;let Q=v[1]/100,n=v[2]/100;const T=Q+n;let L;T>1&&(Q/=T,n/=T);const e=Math.floor(6*d),F=1-n;L=6*d-e,0!==(1&e)&&(L=1-L);const r=Q+L*(F-Q);let C,u,y;switch(e){default:case 6:case 0:C=F,u=r,y=Q;break;case 1:C=r,u=F,y=Q;break;case 2:C=Q,u=F,y=r;break;case 3:C=Q,u=r,y=F;break;case 4:C=r,u=Q,y=F;break;case 5:C=F,u=Q,y=r}return[255*C,255*u,255*y]},L.cmyk.rgb=function(v){const d=v[0]/100,Q=v[1]/100,n=v[2]/100,T=v[3]/100;return[255*(1-Math.min(1,d*(1-T)+T)),255*(1-Math.min(1,Q*(1-T)+T)),255*(1-Math.min(1,n*(1-T)+T))]},L.xyz.rgb=function(v){const d=v[0]/100,Q=v[1]/100,n=v[2]/100;let T,L,e;return T=3.2406*d+-1.5372*Q+-.4986*n,L=-.9689*d+1.8758*Q+.0415*n,e=.0557*d+-.204*Q+1.057*n,T=T>.0031308?1.055*T**(1/2.4)-.055:12.92*T,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,e=e>.0031308?1.055*e**(1/2.4)-.055:12.92*e,T=Math.min(Math.max(0,T),1),L=Math.min(Math.max(0,L),1),e=Math.min(Math.max(0,e),1),[255*T,255*L,255*e]},L.xyz.lab=function(v){let d=v[0],Q=v[1],n=v[2];d/=95.047,Q/=100,n/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,n=n>.008856?n**(1/3):7.787*n+16/116;return[116*Q-16,500*(d-Q),200*(Q-n)]},L.lab.xyz=function(v){let d,Q,n;Q=(v[0]+16)/116,d=v[1]/500+Q,n=Q-v[2]/200;const T=Q**3,L=d**3,e=n**3;return Q=T>.008856?T:(Q-16/116)/7.787,d=L>.008856?L:(d-16/116)/7.787,n=e>.008856?e:(n-16/116)/7.787,d*=95.047,Q*=100,n*=108.883,[d,Q,n]},L.lab.lch=function(v){const d=v[0],Q=v[1],n=v[2];let T;T=360*Math.atan2(n,Q)/2/Math.PI,T<0&&(T+=360);return[d,Math.sqrt(Q*Q+n*n),T]},L.lch.lab=function(v){const d=v[0],Q=v[1],n=v[2]/360*2*Math.PI;return[d,Q*Math.cos(n),Q*Math.sin(n)]},L.rgb.ansi16=function(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Q,n,T]=v;let e=null===d?L.rgb.hsv(v)[2]:d;if(e=Math.round(e/50),0===e)return 30;let F=30+(Math.round(T/255)<<2|Math.round(n/255)<<1|Math.round(Q/255));return 2===e&&(F+=60),F},L.hsv.ansi16=function(v){return L.rgb.ansi16(L.hsv.rgb(v),v[2])},L.rgb.ansi256=function(v){const d=v[0],Q=v[1],n=v[2];if(d===Q&&Q===n)return d<8?16:d>248?231:Math.round((d-8)/247*24)+232;return 16+36*Math.round(d/255*5)+6*Math.round(Q/255*5)+Math.round(n/255*5)},L.ansi16.rgb=function(v){let d=v%10;if(0===d||7===d)return v>50&&(d+=3.5),d=d/10.5*255,[d,d,d];const Q=.5*(1+~~(v>50));return[(1&d)*Q*255,(d>>1&1)*Q*255,(d>>2&1)*Q*255]},L.ansi256.rgb=function(v){if(v>=232){const d=10*(v-232)+8;return[d,d,d]}let d;v-=16;return[Math.floor(v/36)/5*255,Math.floor((d=v%36)/6)/5*255,d%6/5*255]},L.rgb.hex=function(v){const d=(((255&Math.round(v[0]))<<16)+((255&Math.round(v[1]))<<8)+(255&Math.round(v[2]))).toString(16).toUpperCase();return"000000".substring(d.length)+d},L.hex.rgb=function(v){const d=v.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!d)return[0,0,0];let Q=d[0];3===d[0].length&&(Q=Q.split("").map((v=>v+v)).join(""));const n=parseInt(Q,16);return[n>>16&255,n>>8&255,255&n]},L.rgb.hcg=function(v){const d=v[0]/255,Q=v[1]/255,n=v[2]/255,T=Math.max(Math.max(d,Q),n),L=Math.min(Math.min(d,Q),n),e=T-L;let F,r;return F=e<1?L/(1-e):0,r=e<=0?0:T===d?(Q-n)/e%6:T===Q?2+(n-d)/e:4+(d-Q)/e,r/=6,r%=1,[360*r,100*e,100*F]},L.hsl.hcg=function(v){const d=v[1]/100,Q=v[2]/100,n=Q<.5?2*d*Q:2*d*(1-Q);let T=0;return n<1&&(T=(Q-.5*n)/(1-n)),[v[0],100*n,100*T]},L.hsv.hcg=function(v){const d=v[1]/100,Q=v[2]/100,n=d*Q;let T=0;return n<1&&(T=(Q-n)/(1-n)),[v[0],100*n,100*T]},L.hcg.rgb=function(v){const d=v[0]/360,Q=v[1]/100,n=v[2]/100;if(0===Q)return[255*n,255*n,255*n];const T=[0,0,0],L=d%1*6,e=L%1,F=1-e;let r=0;switch(Math.floor(L)){case 0:T[0]=1,T[1]=e,T[2]=0;break;case 1:T[0]=F,T[1]=1,T[2]=0;break;case 2:T[0]=0,T[1]=1,T[2]=e;break;case 3:T[0]=0,T[1]=F,T[2]=1;break;case 4:T[0]=e,T[1]=0,T[2]=1;break;default:T[0]=1,T[1]=0,T[2]=F}return r=(1-Q)*n,[255*(Q*T[0]+r),255*(Q*T[1]+r),255*(Q*T[2]+r)]},L.hcg.hsv=function(v){const d=v[1]/100,Q=d+v[2]/100*(1-d);let n=0;return Q>0&&(n=d/Q),[v[0],100*n,100*Q]},L.hcg.hsl=function(v){const d=v[1]/100,Q=v[2]/100*(1-d)+.5*d;let n=0;return Q>0&&Q<.5?n=d/(2*Q):Q>=.5&&Q<1&&(n=d/(2*(1-Q))),[v[0],100*n,100*Q]},L.hcg.hwb=function(v){const d=v[1]/100,Q=d+v[2]/100*(1-d);return[v[0],100*(Q-d),100*(1-Q)]},L.hwb.hcg=function(v){const d=v[1]/100,Q=1-v[2]/100,n=Q-d;let T=0;return n<1&&(T=(Q-n)/(1-n)),[v[0],100*n,100*T]},L.apple.rgb=function(v){return[v[0]/65535*255,v[1]/65535*255,v[2]/65535*255]},L.rgb.apple=function(v){return[v[0]/255*65535,v[1]/255*65535,v[2]/255*65535]},L.gray.rgb=function(v){return[v[0]/100*255,v[0]/100*255,v[0]/100*255]},L.gray.hsl=function(v){return[0,0,v[0]]},L.gray.hsv=L.gray.hsl,L.gray.hwb=function(v){return[0,100,v[0]]},L.gray.cmyk=function(v){return[0,0,0,v[0]]},L.gray.lab=function(v){return[v[0],0,0]},L.gray.hex=function(v){const d=255&Math.round(v[0]/100*255),Q=((d<<16)+(d<<8)+d).toString(16).toUpperCase();return"000000".substring(Q.length)+Q},L.rgb.gray=function(v){return[(v[0]+v[1]+v[2])/3/255*100]}},13150:(v,d,Q)=>{const n=Q(13157),T=Q(13169),L={};Object.keys(n).forEach((v=>{L[v]={},Object.defineProperty(L[v],"channels",{value:n[v].channels}),Object.defineProperty(L[v],"labels",{value:n[v].labels});const d=T(v);Object.keys(d).forEach((Q=>{const n=d[Q];L[v][Q]=function(v){const d=function(){for(var d=arguments.length,Q=new Array(d),n=0;n<d;n++)Q[n]=arguments[n];const T=Q[0];if(void 0===T||null===T)return T;T.length>1&&(Q=T);const L=v(Q);if("object"===typeof L)for(let v=L.length,e=0;e<v;e++)L[e]=Math.round(L[e]);return L};return"conversion"in v&&(d.conversion=v.conversion),d}(n),L[v][Q].raw=function(v){const d=function(){for(var d=arguments.length,Q=new Array(d),n=0;n<d;n++)Q[n]=arguments[n];const T=Q[0];return void 0===T||null===T?T:(T.length>1&&(Q=T),v(Q))};return"conversion"in v&&(d.conversion=v.conversion),d}(n)}))})),v.exports=L},13169:(v,d,Q)=>{const n=Q(13157);function T(v){const d=function(){const v={},d=Object.keys(n);for(let Q=d.length,n=0;n<Q;n++)v[d[n]]={distance:-1,parent:null};return v}(),Q=[v];for(d[v].distance=0;Q.length;){const v=Q.pop(),T=Object.keys(n[v]);for(let n=T.length,L=0;L<n;L++){const n=T[L],e=d[n];-1===e.distance&&(e.distance=d[v].distance+1,e.parent=v,Q.unshift(n))}}return d}function L(v,d){return function(Q){return d(v(Q))}}function e(v,d){const Q=[d[v].parent,v];let T=n[d[v].parent][v],e=d[v].parent;for(;d[e].parent;)Q.unshift(d[e].parent),T=L(n[d[e].parent][e],T),e=d[e].parent;return T.conversion=Q,T}v.exports=function(v){const d=T(v),Q={},n=Object.keys(d);for(let T=n.length,L=0;L<T;L++){const v=n[L];null!==d[v].parent&&(Q[v]=e(v,d))}return Q}},13164:v=>{"use strict";v.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12165:function(v,d,Q){"use strict";var n=this&&this.__createBinding||(Object.create?function(v,d,Q,n){void 0===n&&(n=Q);var T=Object.getOwnPropertyDescriptor(d,Q);T&&!("get"in T?!d.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return d[Q]}}),Object.defineProperty(v,n,T)}:function(v,d,Q,n){void 0===n&&(n=Q),v[n]=d[Q]}),T=this&&this.__setModuleDefault||(Object.create?function(v,d){Object.defineProperty(v,"default",{enumerable:!0,value:d})}:function(v,d){v.default=d}),L=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var d={};if(null!=v)for(var Q in v)"default"!==Q&&Object.prototype.hasOwnProperty.call(v,Q)&&n(d,v,Q);return T(d,v),d},e=this&&this.__awaiter||function(v,d,Q,n){return new(Q||(Q=Promise))((function(T,L){function e(v){try{r(n.next(v))}catch(d){L(d)}}function F(v){try{r(n.throw(v))}catch(d){L(d)}}function r(v){var d;v.done?T(v.value):(d=v.value,d instanceof Q?d:new Q((function(v){v(d)}))).then(e,F)}r((n=n.apply(v,d||[])).next())}))};Object.defineProperty(d,"__esModule",{value:!0}),d.Auth=d.Platform=void 0;const F=L(Q(12104)),r=Q(12167),C="colyseus-auth-token";!function(v){v.ios="ios",v.android="android"}(d.Platform||(d.Platform={}));d.Auth=class{constructor(v){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=v.replace("ws","http"),(0,r.getItem)(C,(v=>this.token=v))}get hasToken(){return!!this.token}login(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e(this,void 0,void 0,(function*(){const d=Object.assign({},v);this.hasToken&&(d.token=this.token);const Q=yield this.request("post","/auth",d);this.token=Q.token,(0,r.setItem)(C,this.token);for(let v in Q)this.hasOwnProperty(v)&&(this[v]=Q[v]);return this.registerPingService(),this}))}save(){return e(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return e(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return e(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return e(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(v){return e(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:v})}))}acceptFriendRequest(v){return e(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:v})}))}declineFriendRequest(v){return e(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:v})}))}blockUser(v){return e(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:v})}))}unblockUser(v){return e(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:v})}))}request(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e(this,void 0,void 0,(function*(){T.Accept="application/json",this.hasToken&&(T.Authorization="Bearer "+this.token);const L=[];for(const v in Q)L.push(`${v}=${Q[v]}`);const e=L.length>0?`?${L.join("&")}`:"",r={headers:T};return n&&(r.body=n),(yield F[v](`${this.endpoint}${d}${e}`,r)).data}))}logout(){this.token=void 0,(0,r.removeItem)(C),this.unregisterPingService()}registerPingService(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),v)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},12097:function(v,d,Q){"use strict";var n,T=this&&this.__awaiter||function(v,d,Q,n){return new(Q||(Q=Promise))((function(T,L){function e(v){try{r(n.next(v))}catch(d){L(d)}}function F(v){try{r(n.throw(v))}catch(d){L(d)}}function r(v){var d;v.done?T(v.value):(d=v.value,d instanceof Q?d:new Q((function(v){v(d)}))).then(e,F)}r((n=n.apply(v,d||[])).next())}))};Object.defineProperty(d,"__esModule",{value:!0}),d.Client=d.MatchMakeError=void 0;const L=Q(12104),e=Q(12111),F=Q(12114);class r extends Error{constructor(v,d){super(v),this.code=d,Object.setPrototypeOf(this,r.prototype)}}d.MatchMakeError=r;const C="undefined"!==typeof window&&"undefined"!==typeof(null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";d.Client=class{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;if("string"===typeof v){const d=new URL(v),Q="https:"===d.protocol||"wss:"===d.protocol,n=Number(d.port||(Q?443:80));this.settings={hostname:d.hostname,pathname:"/"!==d.pathname?d.pathname:"",port:n,secure:Q}}else void 0===v.port&&(v.port=v.secure?443:80),void 0===v.pathname&&(v.pathname=""),this.settings=v}joinOrCreate(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",v,d,Q)}))}create(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",v,d,Q)}))}join(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",v,d,Q)}))}joinById(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",v,d,Q)}))}reconnect(v,d){return T(this,void 0,void 0,(function*(){if("string"===typeof v&&"string"===typeof d)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Q,n]=v.split(":");return yield this.createMatchMakeRequest("reconnect",Q,{reconnectionToken:n},d)}))}getAvailableRooms(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return T(this,void 0,void 0,(function*(){return(yield(0,L.get)(this.getHttpEndpoint(`${v}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(v,d,Q){return T(this,void 0,void 0,(function*(){const n=this.createRoom(v.room.name,d);n.roomId=v.room.roomId,n.sessionId=v.sessionId;const L={sessionId:n.sessionId};v.reconnectionToken&&(L.reconnectionToken=v.reconnectionToken);const F=Q||n;return n.connect(this.buildEndpoint(v.room,L),v.devMode&&(()=>T(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${n.roomId}'...`);let Q=0;const L=()=>T(this,void 0,void 0,(function*(){Q++;try{yield this.consumeSeatReservation(v,d,F),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${n.roomId}'`)}catch(T){Q<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Q} out of 8)`),setTimeout(L,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(L,2e3)}))),F),new Promise(((v,d)=>{const Q=(v,Q)=>d(new e.ServerError(v,Q));F.onError.once(Q),F.onJoin.once((()=>{F.onError.remove(Q),v(F)}))}))}))}createMatchMakeRequest(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,e=arguments.length>4?arguments[4]:void 0;return T(this,void 0,void 0,(function*(){const T=(yield(0,L.post)(this.getHttpEndpoint(`${v}/${d}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Q)})).data;if(T.error)throw new r(T.error,T.code);return"reconnect"===v&&(T.reconnectionToken=Q.reconnectionToken),yield this.consumeSeatReservation(T,n,e)}))}createRoom(v,d){return new F.Room(v,d)}buildEndpoint(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=[];for(const T in d)d.hasOwnProperty(T)&&Q.push(`${T}=${d[T]}`);let n=this.settings.secure?"wss://":"ws://";return v.publicAddress?n+=`${v.publicAddress}`:n+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${n}/${v.processId}/${v.roomId}?${Q.join("&")}`}getHttpEndpoint(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${v}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12125:(v,d,Q)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.Connection=void 0;const n=Q(12134);d.Connection=class{constructor(){this.events={},this.transport=new n.WebSocketTransport(this.events)}send(v){this.transport.send(v)}connect(v){this.transport.connect(v)}close(v,d){this.transport.close(v,d)}get isOpen(){return this.transport.isOpen}}},12139:(v,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.utf8Length=d.utf8Read=d.ErrorCode=d.Protocol=void 0,function(v){v[v.HANDSHAKE=9]="HANDSHAKE",v[v.JOIN_ROOM=10]="JOIN_ROOM",v[v.ERROR=11]="ERROR",v[v.LEAVE_ROOM=12]="LEAVE_ROOM",v[v.ROOM_DATA=13]="ROOM_DATA",v[v.ROOM_STATE=14]="ROOM_STATE",v[v.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",v[v.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",v[v.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(d.Protocol||(d.Protocol={})),function(v){v[v.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",v[v.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",v[v.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",v[v.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",v[v.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",v[v.AUTH_FAILED=4215]="AUTH_FAILED",v[v.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(d.ErrorCode||(d.ErrorCode={})),d.utf8Read=function(v,d){const Q=v[d++];for(var n="",T=0,L=d,e=d+Q;L<e;L++){var F=v[L];if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(T=(7&F)<<18|(63&v[++L])<<12|(63&v[++L])<<6|63&v[++L])>=65536?(T-=65536,n+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):n+=String.fromCharCode(T)}else n+=String.fromCharCode((15&F)<<12|(63&v[++L])<<6|63&v[++L]);else n+=String.fromCharCode((31&F)<<6|63&v[++L]);else n+=String.fromCharCode(F)}return n},d.utf8Length=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=0,Q=0;for(let n=0,T=v.length;n<T;n++)d=v.charCodeAt(n),d<128?Q+=1:d<2048?Q+=2:d<55296||d>=57344?Q+=3:(n++,Q+=4);return Q+1}},12114:function(v,d,Q){"use strict";var n=this&&this.__createBinding||(Object.create?function(v,d,Q,n){void 0===n&&(n=Q);var T=Object.getOwnPropertyDescriptor(d,Q);T&&!("get"in T?!d.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return d[Q]}}),Object.defineProperty(v,n,T)}:function(v,d,Q,n){void 0===n&&(n=Q),v[n]=d[Q]}),T=this&&this.__setModuleDefault||(Object.create?function(v,d){Object.defineProperty(v,"default",{enumerable:!0,value:d})}:function(v,d){v.default=d}),L=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var d={};if(null!=v)for(var Q in v)"default"!==Q&&Object.prototype.hasOwnProperty.call(v,Q)&&n(d,v,Q);return T(d,v),d};Object.defineProperty(d,"__esModule",{value:!0}),d.Room=void 0;const e=L(Q(12116)),F=Q(12125),r=Q(12139),C=Q(12141),u=Q(12149),y=Q(12151),z=Q(12158),B=Q(12111);class X{constructor(v,d){this.onStateChange=(0,y.createSignal)(),this.onError=(0,y.createSignal)(),this.onLeave=(0,y.createSignal)(),this.onJoin=(0,y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,u.createNanoEvents)(),this.roomId=null,this.name=v,d&&(this.serializer=new((0,C.getSerializer)("schema")),this.rootSchema=d,this.serializer.state=new d),this.onError(((v,d)=>{var Q;return null===(Q=console.warn)||void 0===Q?void 0:Q.call(console,`colyseus.js - onError => (${v}) ${d}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const n=new F.Connection;Q.connection=n,n.events.onmessage=X.prototype.onMessageCallback.bind(Q),n.events.onclose=function(v){var n;if(!Q.hasJoined)return null===(n=console.warn)||void 0===n||n.call(console,`Room connection was closed unexpectedly (${v.code}): ${v.reason}`),void Q.onError.invoke(v.code,v.reason);v.code===B.CloseCode.DEVMODE_RESTART&&d?d():(Q.onLeave.invoke(v.code),Q.destroy())},n.events.onerror=function(v){var d;null===(d=console.warn)||void 0===d||d.call(console,`Room, onError (${v.code}): ${v.reason}`),Q.onError.invoke(v.code,v.reason)},n.connect(v)}leave(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((d=>{this.onLeave((v=>d(v))),this.connection?v?this.connection.send([r.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(B.CloseCode.CONSENTED)}))}onMessage(v,d){return this.onMessageHandlers.on(this.getMessageHandlerKey(v),d)}send(v,d){const Q=[r.Protocol.ROOM_DATA];let n;if("string"===typeof v?z.encode.string(Q,v):z.encode.number(Q,v),void 0!==d){const v=e.encode(d);n=new Uint8Array(Q.length+v.byteLength),n.set(new Uint8Array(Q),0),n.set(new Uint8Array(v),Q.length)}else n=new Uint8Array(Q);this.connection.send(n.buffer)}sendBytes(v,d){const Q=[r.Protocol.ROOM_DATA_BYTES];let n;"string"===typeof v?z.encode.string(Q,v):z.encode.number(Q,v),n=new Uint8Array(Q.length+(d.byteLength||d.length)),n.set(new Uint8Array(Q),0),n.set(new Uint8Array(d),Q.length),this.connection.send(n.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(v){const d=Array.from(new Uint8Array(v.data)),Q=d[0];if(Q===r.Protocol.JOIN_ROOM){let v=1;const Q=(0,r.utf8Read)(d,v);if(v+=(0,r.utf8Length)(Q),this.serializerId=(0,r.utf8Read)(d,v),v+=(0,r.utf8Length)(this.serializerId),!this.serializer){const v=(0,C.getSerializer)(this.serializerId);this.serializer=new v}d.length>v&&this.serializer.handshake&&this.serializer.handshake(d,{offset:v}),this.reconnectionToken=`${this.roomId}:${Q}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([r.Protocol.JOIN_ROOM])}else if(Q===r.Protocol.ERROR){const v={offset:1},Q=z.decode.number(d,v),n=z.decode.string(d,v);this.onError.invoke(Q,n)}else if(Q===r.Protocol.LEAVE_ROOM)this.leave();else if(Q===r.Protocol.ROOM_DATA_SCHEMA){const v={offset:1},Q=this.serializer.getState().constructor._context.get(z.decode.number(d,v)),n=new Q;n.decode(d,v),this.dispatchMessage(Q,n)}else if(Q===r.Protocol.ROOM_STATE)d.shift(),this.setState(d);else if(Q===r.Protocol.ROOM_STATE_PATCH)d.shift(),this.patch(d);else if(Q===r.Protocol.ROOM_DATA){const Q={offset:1},n=z.decode.stringCheck(d,Q)?z.decode.string(d,Q):z.decode.number(d,Q),T=d.length>Q.offset?e.decode(v.data,Q.offset):void 0;this.dispatchMessage(n,T)}else if(Q===r.Protocol.ROOM_DATA_BYTES){const v={offset:1},Q=z.decode.stringCheck(d,v)?z.decode.string(d,v):z.decode.number(d,v);this.dispatchMessage(Q,new Uint8Array(d.slice(v.offset)))}}setState(v){this.serializer.setState(v),this.onStateChange.invoke(this.serializer.getState())}patch(v){this.serializer.patch(v),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(v,d){var Q;const n=this.getMessageHandlerKey(v);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,d):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",v,d):null===(Q=console.warn)||void 0===Q||Q.call(console,`colyseus.js: onMessage() not registered for type '${v}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(v){switch(typeof v){case"function":return`$${v._typeid}`;case"string":return v;case"number":return`i${v}`;default:throw new Error("invalid message type.")}}}d.Room=X},12167:(v,d)=>{"use strict";let Q;function n(){return Q||(Q="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(v,d){this.cache[v]=d},getItem:function(v){this.cache[v]},removeItem:function(v){delete this.cache[v]}}),Q}Object.defineProperty(d,"__esModule",{value:!0}),d.getItem=d.removeItem=d.setItem=void 0,d.setItem=function(v,d){n().setItem(v,d)},d.removeItem=function(v){n().removeItem(v)},d.getItem=function(v,d){const Q=n().getItem(v);"undefined"!==typeof Promise&&Q instanceof Promise?Q.then((v=>d(v))):d(Q)}},12149:(v,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createNanoEvents=void 0;d.createNanoEvents=()=>({emit(v){let d=this.events[v]||[];for(var Q=arguments.length,n=new Array(Q>1?Q-1:0),T=1;T<Q;T++)n[T-1]=arguments[T];for(let L=0,e=d.length;L<e;L++)d[L](...n)},events:{},on(v,d){var Q;return(null===(Q=this.events[v])||void 0===Q?void 0:Q.push(d))||(this.events[v]=[d]),()=>{var Q;this.events[v]=null===(Q=this.events[v])||void 0===Q?void 0:Q.filter((v=>d!==v))}}})},12151:(v,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createSignal=d.EventEmitter=void 0;class Q{constructor(){this.handlers=[]}register(v){return this.handlers.push(v),this}invoke(){for(var v=arguments.length,d=new Array(v),Q=0;Q<v;Q++)d[Q]=arguments[Q];this.handlers.forEach((v=>v.apply(this,d)))}invokeAsync(){for(var v=arguments.length,d=new Array(v),Q=0;Q<v;Q++)d[Q]=arguments[Q];return Promise.all(this.handlers.map((v=>v.apply(this,d))))}remove(v){const d=this.handlers.indexOf(v);this.handlers[d]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}d.EventEmitter=Q,d.createSignal=function(){const v=new Q;function d(d){return v.register(d,null===this)}return d.once=d=>{const Q=function(){for(var n=arguments.length,T=new Array(n),L=0;L<n;L++)T[L]=arguments[L];d.apply(this,T),v.remove(Q)};v.register(Q)},d.remove=d=>v.remove(d),d.invoke=function(){return v.invoke(...arguments)},d.invokeAsync=function(){return v.invokeAsync(...arguments)},d.clear=()=>v.clear(),d}},12111:(v,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.ServerError=d.CloseCode=void 0,function(v){v[v.CONSENTED=4e3]="CONSENTED",v[v.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(d.CloseCode||(d.CloseCode={}));class Q extends Error{constructor(v,d){super(d),this.name="ServerError",this.code=v}}d.ServerError=Q},12087:(v,d,Q)=>{"use strict";d.d=void 0,Q(12091);var n=Q(12097);Object.defineProperty(d,"d",{enumerable:!0,get:function(){return n.Client}});var T=Q(12139);var L=Q(12114);var e=Q(12165);const F=Q(12169);const r=Q(12175),C=Q(12141);(0,C.registerSerializer)("schema",F.SchemaSerializer),(0,C.registerSerializer)("none",r.NoneSerializer)},12091:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=v=>null!==v&&"object"===typeof v&&v.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12116:(v,d)=>{"use strict";function Q(v,d){if(this._offset=d,v instanceof ArrayBuffer)this._buffer=v,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(v))throw new Error("Invalid argument");this._buffer=v.buffer,this._view=new DataView(this._buffer,v.byteOffset,v.byteLength)}}Object.defineProperty(d,"__esModule",{value:!0}),d.decode=d.encode=void 0,Q.prototype._array=function(v){for(var d=new Array(v),Q=0;Q<v;Q++)d[Q]=this._parse();return d},Q.prototype._map=function(v){for(var d={},Q=0;Q<v;Q++)d[this._parse()]=this._parse();return d},Q.prototype._str=function(v){var d=function(v,d,Q){for(var n="",T=0,L=d,e=d+Q;L<e;L++){var F=v.getUint8(L);if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(T=(7&F)<<18|(63&v.getUint8(++L))<<12|(63&v.getUint8(++L))<<6|63&v.getUint8(++L))>=65536?(T-=65536,n+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):n+=String.fromCharCode(T)}else n+=String.fromCharCode((15&F)<<12|(63&v.getUint8(++L))<<6|63&v.getUint8(++L));else n+=String.fromCharCode((31&F)<<6|63&v.getUint8(++L));else n+=String.fromCharCode(F)}return n}(this._view,this._offset,v);return this._offset+=v,d},Q.prototype._bin=function(v){var d=this._buffer.slice(this._offset,this._offset+v);return this._offset+=v,d},Q.prototype._parse=function(){var v,d=this._view.getUint8(this._offset++),Q=0,n=0,T=0,L=0;if(d<192)return d<128?d:d<144?this._map(15&d):d<160?this._array(15&d):this._str(31&d);if(d>223)return-1*(255-d+1);switch(d){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Q=this._view.getUint8(this._offset),this._offset+=1,this._bin(Q);case 197:return Q=this._view.getUint16(this._offset),this._offset+=2,this._bin(Q);case 198:return Q=this._view.getUint32(this._offset),this._offset+=4,this._bin(Q);case 199:if(Q=this._view.getUint8(this._offset),n=this._view.getInt8(this._offset+1),this._offset+=2,-1===n){var e=this._view.getUint32(this._offset);return T=this._view.getInt32(this._offset+4),L=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*T+L)+e/1e6)}return[n,this._bin(Q)];case 200:return Q=this._view.getUint16(this._offset),n=this._view.getInt8(this._offset+2),this._offset+=3,[n,this._bin(Q)];case 201:return Q=this._view.getUint32(this._offset),n=this._view.getInt8(this._offset+4),this._offset+=5,[n,this._bin(Q)];case 202:return v=this._view.getFloat32(this._offset),this._offset+=4,v;case 203:return v=this._view.getFloat64(this._offset),this._offset+=8,v;case 204:return v=this._view.getUint8(this._offset),this._offset+=1,v;case 205:return v=this._view.getUint16(this._offset),this._offset+=2,v;case 206:return v=this._view.getUint32(this._offset),this._offset+=4,v;case 207:return T=this._view.getUint32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,T+L;case 208:return v=this._view.getInt8(this._offset),this._offset+=1,v;case 209:return v=this._view.getInt16(this._offset),this._offset+=2,v;case 210:return v=this._view.getInt32(this._offset),this._offset+=4,v;case 211:return T=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,T+L;case 212:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?void(this._offset+=1):[n,this._bin(1)];case 213:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(2)];case 214:return n=this._view.getInt8(this._offset),this._offset+=1,-1===n?(v=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*v)):[n,this._bin(4)];case 215:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?(T=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(T+L)):-1===n?(T=this._view.getUint32(this._offset),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&T)+L)+(T>>>2)/1e6)):[n,this._bin(8)];case 216:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(16)];case 217:return Q=this._view.getUint8(this._offset),this._offset+=1,this._str(Q);case 218:return Q=this._view.getUint16(this._offset),this._offset+=2,this._str(Q);case 219:return Q=this._view.getUint32(this._offset),this._offset+=4,this._str(Q);case 220:return Q=this._view.getUint16(this._offset),this._offset+=2,this._array(Q);case 221:return Q=this._view.getUint32(this._offset),this._offset+=4,this._array(Q);case 222:return Q=this._view.getUint16(this._offset),this._offset+=2,this._map(Q);case 223:return Q=this._view.getUint32(this._offset),this._offset+=4,this._map(Q)}throw new Error("Could not parse")},d.decode=function(v){var d=new Q(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),n=d._parse();if(d._offset!==v.byteLength)throw new Error(v.byteLength-d._offset+" trailing bytes");return n};function n(v,d,Q){for(var n=0,T=0,L=Q.length;T<L;T++)(n=Q.charCodeAt(T))<128?v.setUint8(d++,n):n<2048?(v.setUint8(d++,192|n>>6),v.setUint8(d++,128|63&n)):n<55296||n>=57344?(v.setUint8(d++,224|n>>12),v.setUint8(d++,128|n>>6&63),v.setUint8(d++,128|63&n)):(T++,n=65536+((1023&n)<<10|1023&Q.charCodeAt(T)),v.setUint8(d++,240|n>>18),v.setUint8(d++,128|n>>12&63),v.setUint8(d++,128|n>>6&63),v.setUint8(d++,128|63&n))}function T(v,d,Q){var n=typeof Q,L=0,e=0,F=0,r=0,C=0,u=0;if("string"===n){if(C=function(v){for(var d=0,Q=0,n=0,T=v.length;n<T;n++)(d=v.charCodeAt(n))<128?Q+=1:d<2048?Q+=2:d<55296||d>=57344?Q+=3:(n++,Q+=4);return Q}(Q),C<32)v.push(160|C),u=1;else if(C<256)v.push(217,C),u=2;else if(C<65536)v.push(218,C>>8,C),u=3;else{if(!(C<4294967296))throw new Error("String too long");v.push(219,C>>24,C>>16,C>>8,C),u=5}return d.push({_str:Q,_length:C,_offset:v.length}),u+C}if("number"===n)return Math.floor(Q)===Q&&isFinite(Q)?Q>=0?Q<128?(v.push(Q),1):Q<256?(v.push(204,Q),2):Q<65536?(v.push(205,Q>>8,Q),3):Q<4294967296?(v.push(206,Q>>24,Q>>16,Q>>8,Q),5):(F=Q/Math.pow(2,32)|0,r=Q>>>0,v.push(207,F>>24,F>>16,F>>8,F,r>>24,r>>16,r>>8,r),9):Q>=-32?(v.push(Q),1):Q>=-128?(v.push(208,Q),2):Q>=-32768?(v.push(209,Q>>8,Q),3):Q>=-2147483648?(v.push(210,Q>>24,Q>>16,Q>>8,Q),5):(F=Math.floor(Q/Math.pow(2,32)),r=Q>>>0,v.push(211,F>>24,F>>16,F>>8,F,r>>24,r>>16,r>>8,r),9):(v.push(203),d.push({_float:Q,_length:8,_offset:v.length}),9);if("object"===n){if(null===Q)return v.push(192),1;if(Array.isArray(Q)){if((C=Q.length)<16)v.push(144|C),u=1;else if(C<65536)v.push(220,C>>8,C),u=3;else{if(!(C<4294967296))throw new Error("Array too large");v.push(221,C>>24,C>>16,C>>8,C),u=5}for(L=0;L<C;L++)u+=T(v,d,Q[L]);return u}if(Q instanceof Date){var y=Q.getTime(),z=Math.floor(y/1e3),B=1e6*(y-1e3*z);return z>=0&&B>=0&&z<=17179869183?0===B&&z<=4294967295?(v.push(214,255,z>>24,z>>16,z>>8,z),6):(F=z/4294967296,r=4294967295&z,v.push(215,255,B>>22,B>>14,B>>6,F,r>>24,r>>16,r>>8,r),10):(F=Math.floor(z/4294967296),r=z>>>0,v.push(199,12,255,B>>24,B>>16,B>>8,B,F>>24,F>>16,F>>8,F,r>>24,r>>16,r>>8,r),15)}if(Q instanceof ArrayBuffer){if((C=Q.byteLength)<256)v.push(196,C),u=2;else if(C<65536)v.push(197,C>>8,C),u=3;else{if(!(C<4294967296))throw new Error("Buffer too large");v.push(198,C>>24,C>>16,C>>8,C),u=5}return d.push({_bin:Q,_length:C,_offset:v.length}),u+C}if("function"===typeof Q.toJSON)return T(v,d,Q.toJSON());var X=[],m="",V=Object.keys(Q);for(L=0,e=V.length;L<e;L++)void 0!==Q[m=V[L]]&&"function"!==typeof Q[m]&&X.push(m);if((C=X.length)<16)v.push(128|C),u=1;else if(C<65536)v.push(222,C>>8,C),u=3;else{if(!(C<4294967296))throw new Error("Object too large");v.push(223,C>>24,C>>16,C>>8,C),u=5}for(L=0;L<C;L++)u+=T(v,d,m=X[L]),u+=T(v,d,Q[m]);return u}if("boolean"===n)return v.push(Q?195:194),1;if("undefined"===n)return v.push(192),1;if("function"===typeof Q.toJSON)return T(v,d,Q.toJSON());throw new Error("Could not encode")}d.encode=function(v){var d=[],Q=[],L=T(d,Q,v),e=new ArrayBuffer(L),F=new DataView(e),r=0,C=0,u=-1;Q.length>0&&(u=Q[0]._offset);for(var y,z=0,B=0,X=0,m=d.length;X<m;X++)if(F.setUint8(C+X,d[X]),X+1===u){if(z=(y=Q[r])._length,B=C+u,y._bin)for(var V=new Uint8Array(y._bin),h=0;h<z;h++)F.setUint8(B+h,V[h]);else y._str?n(F,B,y._str):void 0!==y._float&&F.setFloat64(B,y._float);C+=z,Q[++r]&&(u=Q[r]._offset)}return e}},12175:(v,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.NoneSerializer=void 0;d.NoneSerializer=class{setState(v){}getState(){return null}patch(v){}teardown(){}handshake(v){}}},12169:(v,d,Q)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.SchemaSerializer=void 0;const n=Q(12158);d.SchemaSerializer=class{setState(v){return this.state.decode(v)}getState(){return this.state}patch(v){return this.state.decode(v)}teardown(){var v,d;null===(d=null===(v=this.state)||void 0===v?void 0:v.$changes)||void 0===d||d.root.clearRefs()}handshake(v,d){if(this.state){(new n.Reflection).decode(v,d)}else this.state=n.Reflection.decode(v,d)}}},12141:(v,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.getSerializer=d.registerSerializer=void 0;const Q={};d.registerSerializer=function(v,d){Q[v]=d},d.getSerializer=function(v){const d=Q[v];if(!d)throw new Error("missing serializer: "+v);return d}},12134:function(v,d,Q){"use strict";var n=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(d,"__esModule",{value:!0}),d.WebSocketTransport=void 0;const T=n(Q(12137)),L=globalThis.WebSocket||T.default;d.WebSocketTransport=class{constructor(v){this.events=v}send(v){v instanceof ArrayBuffer?this.ws.send(v):Array.isArray(v)&&this.ws.send(new Uint8Array(v).buffer)}connect(v){this.ws=new L(v,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(v,d){this.ws.close(v,d)}get isOpen(){return this.ws.readyState===L.OPEN}}},12137:v=>{"use strict";v.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13226:v=>{"use strict";v.exports=function(v,d,Q,n,T,L){var e=+d[0],F=+d[1],r=+d[2],C=+Q[0],u=+Q[1],y=+Q[2],z=Math.sqrt(C*C+u*u+y*y);if(0===z)throw new Error("Can't raycast along a zero vector");return function(v,d,Q,n,T,L,e,F,r,C){for(var u=0,y=Math.floor,z=0|y(d),B=0|y(Q),X=0|y(n),m=T>0?1:-1,V=L>0?1:-1,h=e>0?1:-1,S=Math.abs(1/T),A=Math.abs(1/L),f=Math.abs(1/e),P=S<1/0?S*(m>0?z+1-d:d-z):1/0,O=A<1/0?A*(V>0?B+1-Q:Q-B):1/0,J=f<1/0?f*(h>0?X+1-n:n-X):1/0,K=-1;u<=F;){var o=v(z,B,X);if(o)return r&&(r[0]=d+u*T,r[1]=Q+u*L,r[2]=n+u*e),C&&(C[0]=C[1]=C[2]=0,0===K&&(C[0]=-m),1===K&&(C[1]=-V),2===K&&(C[2]=-h)),o;P<O?P<J?(z+=m,u=P,P+=S,K=0):(X+=h,u=J,J+=f,K=2):O<J?(B+=V,u=O,O+=A,K=1):(X+=h,u=J,J+=f,K=2)}return r&&(r[0]=d+u*T,r[1]=Q+u*L,r[2]=n+u*e),C&&(C[0]=C[1]=C[2]=0),0}(v,e,F,r,C/=z,u/=z,y/=z,n="undefined"===typeof n?64:+n,T,L)}},13257:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>L});var n=Q(82);function T(){this.Tl=!1,this.stopPropagation=!1,this.Ul=!1,this.disabled=!1}class L{constructor(v,d){this.version="0.7.0";var Q=Object.assign({},new T,d||{});this.element=v||document,this.Tl=!!Q.Tl,this.stopPropagation=!!Q.stopPropagation,this.Ul=!!Q.Ul,this.disabled=!!Q.disabled,this.filterEvents=(v,d)=>!0,this.down=new n.EventEmitter,this.up=new n.EventEmitter,this.state={},this.Gg={dx:0,dy:0,Am:0,Mg:0,Bm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?F(this):document.addEventListener("DOMContentLoaded",(v=>{F(this)}),{once:!0})}bind(v){for(var d=arguments.length,Q=new Array(d>1?d-1:0),n=1;n<d;n++)Q[n-1]=arguments[n];Q.forEach((d=>{var Q=this._keyBindmap[d]||[];Q.includes(v)||(Q.push(v),this._keyBindmap[d]=Q)})),this.state[v]=!!this.state[v],this.pressCount[v]=this.pressCount[v]||0,this.releaseCount[v]=this.releaseCount[v]||0}unbind(v){for(var d in this._keyBindmap){var Q=this._keyBindmap[d],n=Q.indexOf(v);n>-1&&Q.splice(n,1)}}getBindings(){var v={};for(var d in this._keyBindmap){this._keyBindmap[d].forEach((Q=>{v[Q]=v[Q]||[],v[Q].push(d)}))}return v}Pj(){e(this.Gg),e(this.pressCount),e(this.releaseCount)}}function e(v){for(var d in v)v[d]=0}function F(v){window.addEventListener("keydown",X.bind(null,v,!0),!1),window.addEventListener("keyup",X.bind(null,v,!1),!1);var d={passive:!0};v.element.addEventListener("touchstart",y.bind(void 0,v),{passive:!1}),v.element.addEventListener("touchend",B.bind(void 0,v),d),v.element.addEventListener("mousedown",m.bind(null,v,!0),d),window.document.addEventListener("mouseup",m.bind(null,v,!1),d),v.element.addEventListener("touchmove",V.bind(null,v),d),v.element.addEventListener("mousemove",V.bind(null,v),d),window.PointerEvent,v.element.addEventListener("wheel",h.bind(null,v),d),v.element.addEventListener("contextmenu",S.bind(null,v),!1),window.addEventListener("blur",A.bind(null,v),!1)}var r=0,C=0,u=null;function y(v,d){d.preventDefault(),z(d)}function z(v){let d=!1;for(let Q=0;Q<v.touches.length;++Q)if(v.touches[Q].identifier===u){d=!0;break}if(!d){const d=v.changedTouches[0];r=d.clientX,C=d.clientY,u=d.identifier}}function B(v,d){for(var Q=d.changedTouches,n=0;n<Q.length;++n)Q[n].identifier===u&&(u=null)}function X(v,d,Q){f(Q.code,d,v,Q)}function m(v,d,Q){if("pointerId"in Q)if(d){if(null!==v._touches.currID)return;v._touches.currID=Q.pointerId}else{if(v._touches.currID!==Q.pointerId)return;v._touches.currID=null}return f("Mouse"+("button"in Q?Q.button+1:1),d,v,Q),!1}function V(v,d){var Q=d.movementX||d.mozMovementX||0,n=d.movementY||d.mozMovementY||0;if(d.touches&&0===(Q|n)){var T=function(v){z(v);for(let d=0;d<v.changedTouches.length;++d)if(v.changedTouches[d].identifier==u){const Q=v.changedTouches[d],n=[Q.clientX-r,Q.clientY-C];return r=Q.clientX,C=Q.clientY,n}return console.error(`Did not find touch id ${u}`),[0,0]}(d);Q=T[0],n=T[1]}v.Gg.dx+=Q,v.Gg.dy+=n}function h(v,d){var Q=1;switch(d.deltaMode){case 0:Q=1;break;case 1:Q=12;break;case 2:Q=v.element.clientHeight||window.innerHeight}v.Gg.Am+=(d.deltaX||0)*Q,v.Gg.Mg+=(d.deltaY||0)*Q,v.Gg.Bm+=(d.deltaZ||0)*Q}function S(v,d){if(!v.Ul)return d.preventDefault(),!1}function A(v){for(var d in v._keyStates)v._keyStates[d]&&(/^Mouse\d/.test(d)||f(d,!1,v,{code:d,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(v,d,Q,n){var T=Q._keyBindmap[v];T&&(P(Q._keyStates[v],d)&&(Q._keyStates[v]=d,T.forEach((v=>{(!Q.filterEvents||Q.filterEvents(n,v))&&function(v,d,Q,n){var T=d?Q.pressCount:Q.releaseCount;T[v]=(T[v]||0)+1;var L=Q._bindPressCount[v]||0;(L+=d?1:-1)<0&&(L=0);Q._bindPressCount[v]=L;var e=Q.state[v];if(P(e,L)){Q.state[v]=L>0;var F=d?Q.down:Q.up;Q.disabled||F.emit(v,n)}}(v,d,Q,n)}))),"button"in n||(Q.Tl&&!n.defaultPrevented&&n.preventDefault(),Q.stopPropagation&&n.stopPropagation()))}function P(v,d){return v?!d:d}},13230:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>n});class n{constructor(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.$k=!1,this._k=!1,this.gf=30,this.Zk=0,this.gl=!1,this.fullscreen=!1,this.bl=function(v){},this.cl=function(){},this.el=function(){},this.k=function(){},this.dl=function(v){},this.onFullscreenChanged=function(v){},C((()=>{!function(v,d){v._nowObject=performance||Date,v._lastTick=0,v._renderAccum=0,v._rt=0,v._frameCB=F.bind(null,v),requestAnimationFrame(v._frameCB),d>0&&(v._intervalCB=e.bind(null,v),v._interval=setInterval(v._intervalCB,Math.max(d,1e3/v.gf/2)))}(this,d),function(v,d){if(!d)return;var Q=!1,n=!1;document.addEventListener("pointerlockchange",(n=>{Q=document.pointerLockElement===d,v.dl(Q)})),document.addEventListener("fullscreenchange",(Q=>{n=document.fullscreenElement===d,v.onFullscreenChanged(n)})),Object.defineProperty(v,"gl",{get:()=>Q,set:v=>{v&&!Q?r(d):Q&&!v&&function(v){v.exitPointerLock&&v.exitPointerLock()}(document)}}),Object.defineProperty(v,"fullscreen",{get:()=>n,set:v=>{v&&!n?d.requestFullscreen():n&&!v&&document.exitFullscreen()}}),d.addEventListener("click",(T=>{v.$k&&!Q&&r(d),v._k&&!n&&d.requestFullscreen()}));var T=()=>v.k();if(window.ResizeObserver){new ResizeObserver(T).observe(d)}else window.addEventListener("resize",T)}(this,v),this.el()}))}}var T=3,L=20;function e(v){for(var d=1e3/v.gf,Q=v._nowObject.now()+L,n=0;v._nowObject.now()>=v._lastTick+d&&v._nowObject.now()<Q&&++n<=T;)v.bl(d),v._lastTick+=d;var e=5*(d+5),F=v._nowObject.now();if(F-v._lastTick>e)for(;F>=v._lastTick+d;)v._lastTick+=d}function F(v){requestAnimationFrame(v._frameCB),e(v);var d=v._nowObject.now(),Q=d-v._rt;if(v._rt=d,v.Zk>0){v._renderAccum+=Q;var n=1e3/v.Zk;if(v._renderAccum<n)return;v._renderAccum=Math.min(v._renderAccum-n,n)}var T=1e3/v.gf,L=(d-v._lastTick)/T;v.cl(Q,L,T)}function r(v){v.requestPointerLock&&v.requestPointerLock()}var C=v=>{if("loading"===document.readyState){var d=()=>{document.removeEventListener("readystatechange",d),v()};document.addEventListener("readystatechange",d)}else setTimeout(v,1)}},13114:v=>{var d;self,d=()=>(()=>{"use strict";var v={d:(d,Q)=>{for(var n in Q)v.o(Q,n)&&!v.o(d,n)&&Object.defineProperty(d,n,{enumerable:!0,get:Q[n]})},o:(v,d)=>Object.prototype.hasOwnProperty.call(v,d)},d={};v.d(d,{default:()=>Z});var Q,n=function(v,d){var Q=d.x-v.x,n=d.y-v.y;return Math.sqrt(Q*Q+n*n)},T=function(v){return v*(Math.PI/180)},L=new Map,e=function(v){L.has(v)&&clearTimeout(L.get(v)),L.set(v,setTimeout(v,100))},F=function(v,d,Q){for(var n,T=d.split(/[ ,]+/g),L=0;L<T.length;L+=1)n=T[L],v.addEventListener?v.addEventListener(n,Q,!1):v.attachEvent&&v.attachEvent(n,Q)},r=function(v,d,Q){for(var n,T=d.split(/[ ,]+/g),L=0;L<T.length;L+=1)n=T[L],v.removeEventListener?v.removeEventListener(n,Q):v.detachEvent&&v.detachEvent(n,Q)},C=function(v){return v.preventDefault(),v.type.match(/^touch/)?v.changedTouches:v},u=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},y=function(v,d){d.top||d.right||d.bottom||d.left?(v.style.top=d.top,v.style.right=d.right,v.style.bottom=d.bottom,v.style.left=d.left):(v.style.left=d.x+"px",v.style.top=d.y+"px")},z=function(v,d,Q){var n=B(v);for(var T in n)if(n.hasOwnProperty(T))if("string"==typeof d)n[T]=d+" "+Q;else{for(var L="",e=0,F=d.length;e<F;e+=1)L+=d[e]+" "+Q+", ";n[T]=L.slice(0,-2)}return n},B=function(v){var d={};return d[v]="",["webkit","Moz","o"].forEach((function(Q){d[Q+v.charAt(0).toUpperCase()+v.slice(1)]=""})),d},X=function(v,d){for(var Q in d)d.hasOwnProperty(Q)&&(v[Q]=d[Q]);return v},m=function(v,d){if(v.length)for(var Q=0,n=v.length;Q<n;Q+=1)d(v[Q]);else d(v)},V="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,h=window.matchMedia("(any-hover: none)").matches,S=!!("ontouchstart"in window),A=!!window.PointerEvent,f=!!window.MSPointerEvent,P={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},O={start:"mousedown",move:"mousemove",end:"mouseup"},J={};function K(){}V&&!h?Q=P:A?Q={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?Q={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:S?(Q=P,J=O):Q=O,K.prototype.on=function(v,d){var Q,n=this,T=v.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var L=0;L<T.length;L+=1)Q=T[L],n._handlers_[Q]=n._handlers_[Q]||[],n._handlers_[Q].push(d);return n},K.prototype.off=function(v,d){var Q=this;return Q._handlers_=Q._handlers_||{},void 0===v?Q._handlers_={}:void 0===d?Q._handlers_[v]=null:Q._handlers_[v]&&Q._handlers_[v].indexOf(d)>=0&&Q._handlers_[v].splice(Q._handlers_[v].indexOf(d),1),Q},K.prototype.trigger=function(v,d){var Q,n=this,T=v.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var L=0;L<T.length;L+=1)Q=T[L],n._handlers_[Q]&&n._handlers_[Q].length&&n._handlers_[Q].forEach((function(v){v.call(n,{type:Q,target:n},d)}))},K.prototype.config=function(v){var d=this;d.options=d.defaults||{},v&&(d.options=function(v,d){var Q={};for(var n in v)v.hasOwnProperty(n)&&d.hasOwnProperty(n)?Q[n]=d[n]:v.hasOwnProperty(n)&&(Q[n]=v[n]);return Q}(d.options,v))},K.prototype.bindEvt=function(v,d){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[d]=function(){"function"==typeof n["on"+d]?n["on"+d].apply(n,arguments):console.warn('[WARNING] : Missing "on'+d+'" handler.')},F(v,Q[d],n._domHandlers_[d]),J[d]&&F(v,J[d],n._domHandlers_[d]),n},K.prototype.unbindEvt=function(v,d){var n=this;return n._domHandlers_=n._domHandlers_||{},r(v,Q[d],n._domHandlers_[d]),J[d]&&r(v,J[d],n._domHandlers_[d]),delete n._domHandlers_[d],this};const o=K;function g(v,d){return this.identifier=d.identifier,this.position=d.position,this.frontPosition=d.frontPosition,this.collection=v,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(d),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=g.id,g.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}g.prototype=new o,g.constructor=g,g.id=0,g.prototype.buildEl=function(v){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},g.prototype.stylize=function(){if(this.options.dataOnly)return this;var v=this.options.fadeTime+"ms",d=function(){var v=B("borderRadius");for(var d in v)v.hasOwnProperty(d)&&(v[d]="50%");return v}(),Q=z("transition","opacity",v),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},X(n.el,Q),"circle"===this.options.shape&&X(n.back,d),X(n.front,d),this.applyStyles(n),this},g.prototype.applyStyles=function(v){for(var d in this.ui)if(this.ui.hasOwnProperty(d))for(var Q in v[d])this.ui[d].style[Q]=v[d][Q];return this},g.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},g.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},g.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},g.prototype.show=function(v){var d=this;return d.options.dataOnly||(clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.addToDom(),d.restCallback(),setTimeout((function(){d.ui.el.style.opacity=1}),0),d.showTimeout=setTimeout((function(){d.trigger("shown",d.instance),"function"==typeof v&&v.call(this)}),d.options.fadeTime)),d},g.prototype.hide=function(v){var d=this;if(d.options.dataOnly)return d;if(d.ui.el.style.opacity=d.options.restOpacity,clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.removeTimeout=setTimeout((function(){var Q="dynamic"===d.options.mode?"none":"block";d.ui.el.style.display=Q,"function"==typeof v&&v.call(d),d.trigger("hidden",d.instance)}),d.options.fadeTime),d.options.restJoystick){var Q=d.options.restJoystick,n={};n.x=!0===Q||!1!==Q.x?0:d.instance.frontPosition.x,n.y=!0===Q||!1!==Q.y?0:d.instance.frontPosition.y,d.setPosition(v,n)}return d},g.prototype.setPosition=function(v,d){var Q=this;Q.frontPosition={x:d.x,y:d.y};var n=Q.options.fadeTime+"ms",T={};T.front=z("transition",["transform"],n);var L={front:{}};L.front={transform:"translate("+Q.frontPosition.x+"px,"+Q.frontPosition.y+"px)"},Q.applyStyles(T),Q.applyStyles(L),Q.restTimeout=setTimeout((function(){"function"==typeof v&&v.call(Q),Q.restCallback()}),Q.options.fadeTime)},g.prototype.restCallback=function(){var v=this,d={};d.front=z("transition","none",""),v.applyStyles(d),v.trigger("rested",v.instance)},g.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},g.prototype.computeDirection=function(v){var d,Q,n,T=v.angle.radian,L=Math.PI/4,e=Math.PI/2;if(T>L&&T<3*L&&!v.lockX?d="up":T>-L&&T<=L&&!v.lockY?d="left":T>3*-L&&T<=-L&&!v.lockX?d="down":v.lockY||(d="right"),v.lockY||(Q=T>-e&&T<e?"left":"right"),v.lockX||(n=T>0?"up":"down"),v.force>this.options.threshold){var F,r={};for(F in this.direction)this.direction.hasOwnProperty(F)&&(r[F]=this.direction[F]);var C={};for(F in this.direction={x:Q,y:n,angle:d},v.direction=this.direction,r)r[F]===this.direction[F]&&(C[F]=!0);if(C.x&&C.y&&C.angle)return v;C.x&&C.y||this.trigger("plain",v),C.x||this.trigger("plain:"+Q,v),C.y||this.trigger("plain:"+n,v),C.angle||this.trigger("dir dir:"+d,v)}else this.resetDirection();return v};const R=g;function M(v,d){var Q=this;Q.nipples=[],Q.idles=[],Q.actives=[],Q.ids=[],Q.pressureIntervals={},Q.manager=v,Q.id=M.id,M.id+=1,Q.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Q.config(d),"static"!==Q.options.mode&&"semi"!==Q.options.mode||(Q.options.multitouch=!1),Q.options.multitouch||(Q.options.maxNumberOfNipples=1);var n=getComputedStyle(Q.options.zone.parentElement);return n&&"flex"===n.display&&(Q.parentIsFlex=!0),Q.updateBox(),Q.prepareNipples(),Q.Vl(),Q.begin(),Q.nipples}M.prototype=new o,M.constructor=M,M.id=0,M.prototype.prepareNipples=function(){var v=this,d=v.nipples;d.on=v.on.bind(v),d.off=v.off.bind(v),d.options=v.options,d.destroy=v.destroy.bind(v),d.ids=v.ids,d.id=v.id,d.processOnMove=v.processOnMove.bind(v),d.processOnEnd=v.processOnEnd.bind(v),d.get=function(v){if(void 0===v)return d[0];for(var Q=0,n=d.length;Q<n;Q+=1)if(d[Q].identifier===v)return d[Q];return!1}},M.prototype.Vl=function(){var v=this;v.bindEvt(v.options.zone,"start"),v.options.zone.style.touchAction="none",v.options.zone.style.msTouchAction="none"},M.prototype.begin=function(){var v=this,d=v.options;if("static"===d.mode){var Q=v.createNipple(d.position,v.manager.getIdentifier());Q.add(),v.idles.push(Q)}},M.prototype.createNipple=function(v,d){var Q=this,n=Q.manager.scroll,T={},L=Q.options,e=Q.parentIsFlex?n.x:n.x+Q.box.left,F=Q.parentIsFlex?n.y:n.y+Q.box.top;if(v.x&&v.y)T={x:v.x-e,y:v.y-F};else if(v.top||v.right||v.bottom||v.left){var r=document.createElement("DIV");r.style.display="hidden",r.style.top=v.top,r.style.right=v.right,r.style.bottom=v.bottom,r.style.left=v.left,r.style.position="absolute",L.zone.appendChild(r);var C=r.getBoundingClientRect();L.zone.removeChild(r),T=v,v={x:C.left+n.x,y:C.top+n.y}}var u=new R(Q,{color:L.color,size:L.size,threshold:L.threshold,fadeTime:L.fadeTime,dataOnly:L.dataOnly,restJoystick:L.restJoystick,restOpacity:L.restOpacity,mode:L.mode,identifier:d,position:v,zone:L.zone,frontPosition:{x:0,y:0},shape:L.shape});return L.dataOnly||(y(u.ui.el,T),y(u.ui.front,u.frontPosition)),Q.nipples.push(u),Q.trigger("added "+u.identifier+":added",u),Q.manager.trigger("added "+u.identifier+":added",u),Q.bindNipple(u),u},M.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},M.prototype.bindNipple=function(v){var d,Q=this,n=function(v,n){d=v.type+" "+n.id+":"+v.type,Q.trigger(d,n)};v.on("destroyed",Q.onDestroyed.bind(Q)),v.on("shown hidden rested dir plain",n),v.on("dir:up dir:right dir:down dir:left",n),v.on("plain:up plain:right plain:down plain:left",n)},M.prototype.pressureFn=function(v,d,Q){var n=this,T=0;clearInterval(n.pressureIntervals[Q]),n.pressureIntervals[Q]=setInterval(function(){var Q=v.force||v.pressure||v.webkitForce||0;Q!==T&&(d.trigger("pressure",Q),n.trigger("pressure "+d.identifier+":pressure",Q),T=Q)}.bind(n),100)},M.prototype.onstart=function(v){var d=this,Q=d.options,n=v;return v=C(v),d.updateBox(),m(v,(function(T){d.actives.length<Q.maxNumberOfNipples?d.processOnStart(T):n.type.match(/^touch/)&&(Object.keys(d.manager.ids).forEach((function(Q){if(Object.values(n.touches).findIndex((function(v){return v.identifier===Q}))<0){var T=[v[0]];T.identifier=Q,d.processOnEnd(T)}})),d.actives.length<Q.maxNumberOfNipples&&d.processOnStart(T))})),d.manager.bindDocument(),!1},M.prototype.processOnStart=function(v){var d,Q=this,T=Q.options,L=Q.manager.getIdentifier(v),e=v.force||v.pressure||v.webkitForce||0,F={x:v.pageX,y:v.pageY},r=Q.getOrCreate(L,F);r.identifier!==L&&Q.manager.removeIdentifier(r.identifier),r.identifier=L;var C=function(d){d.trigger("start",d),Q.trigger("start "+d.id+":start",d),d.show(),e>0&&Q.pressureFn(v,d,d.identifier),Q.processOnMove(v)};if((d=Q.idles.indexOf(r))>=0&&Q.idles.splice(d,1),Q.actives.push(r),Q.ids.push(r.identifier),"semi"!==T.mode)C(r);else{if(!(n(F,r.position)<=T.catchDistance))return r.destroy(),void Q.processOnStart(v);C(r)}return r},M.prototype.getOrCreate=function(v,d){var Q,n=this,T=n.options;return/(semi|static)/.test(T.mode)?(Q=n.idles[0])?(n.idles.splice(0,1),Q):"semi"===T.mode?n.createNipple(d,v):(console.warn("Coudln't find the needed nipple."),!1):Q=n.createNipple(d,v)},M.prototype.processOnMove=function(v){var d=this,Q=d.options,L=d.manager.getIdentifier(v),e=d.nipples.get(L),F=d.manager.scroll;if(function(v){return isNaN(v.buttons)?0!==v.pressure:0!==v.buttons}(v)){if(!e)return console.error("Found zombie joystick with ID "+L),void d.manager.removeIdentifier(L);if(Q.dynamicPage){var r=e.el.getBoundingClientRect();e.position={x:F.x+r.left,y:F.y+r.top}}e.identifier=L;var C=e.options.size/2,u={x:v.pageX,y:v.pageY};Q.lockX&&(u.y=e.position.y),Q.lockY&&(u.x=e.position.x);var y,z,B,X,m,V,h,S,A,f,P=n(u,e.position),O=(y=u,B=(z=e.position).x-y.x,X=z.y-y.y,function(v){return v*(180/Math.PI)}(Math.atan2(X,B))),J=T(O),K=P/C,o={distance:P,position:u};if("circle"===e.options.shape?(m=Math.min(P,C),h=e.position,S=m,f={x:0,y:0},A=T(A=O),f.x=h.x-S*Math.cos(A),f.y=h.y-S*Math.sin(A),V=f):(V=function(v,d,Q){return{x:Math.min(Math.max(v.x,d.x-Q),d.x+Q),y:Math.min(Math.max(v.y,d.y-Q),d.y+Q)}}(u,e.position,C),m=n(V,e.position)),Q.follow){if(P>C){var g=u.x-V.x,R=u.y-V.y;e.position.x+=g,e.position.y+=R,e.el.style.top=e.position.y-(d.box.top+F.y)+"px",e.el.style.left=e.position.x-(d.box.left+F.x)+"px",P=n(u,e.position)}}else u=V,P=m;var M=u.x-e.position.x,Y=u.y-e.position.y;e.frontPosition={x:M,y:Y},Q.dataOnly||(e.ui.front.style.transform="translate("+M+"px,"+Y+"px)");var D={identifier:e.identifier,position:u,force:K,pressure:v.force||v.pressure||v.webkitForce||0,distance:P,angle:{radian:J,degree:O},vector:{x:M/C,y:-Y/C},raw:o,instance:e,lockX:Q.lockX,lockY:Q.lockY};(D=e.computeDirection(D)).angle={radian:T(180-O),degree:180-O},e.trigger("move",D),d.trigger("move "+e.id+":move",D)}else this.processOnEnd(v)},M.prototype.processOnEnd=function(v){var d=this,Q=d.options,n=d.manager.getIdentifier(v),T=d.nipples.get(n),L=d.manager.removeIdentifier(T.identifier);T&&(Q.dataOnly||T.hide((function(){"dynamic"===Q.mode&&(T.trigger("removed",T),d.trigger("removed "+T.id+":removed",T),d.manager.trigger("removed "+T.id+":removed",T),T.destroy())})),clearInterval(d.pressureIntervals[T.identifier]),T.resetDirection(),T.trigger("end",T),d.trigger("end "+T.id+":end",T),d.ids.indexOf(T.identifier)>=0&&d.ids.splice(d.ids.indexOf(T.identifier),1),d.actives.indexOf(T)>=0&&d.actives.splice(d.actives.indexOf(T),1),/(semi|static)/.test(Q.mode)?d.idles.push(T):d.nipples.indexOf(T)>=0&&d.nipples.splice(d.nipples.indexOf(T),1),d.manager.unbindDocument(),/(semi|static)/.test(Q.mode)&&(d.manager.ids[L.id]=L.identifier))},M.prototype.onDestroyed=function(v,d){var Q=this;Q.nipples.indexOf(d)>=0&&Q.nipples.splice(Q.nipples.indexOf(d),1),Q.actives.indexOf(d)>=0&&Q.actives.splice(Q.actives.indexOf(d),1),Q.idles.indexOf(d)>=0&&Q.idles.splice(Q.idles.indexOf(d),1),Q.ids.indexOf(d.identifier)>=0&&Q.ids.splice(Q.ids.indexOf(d.identifier),1),Q.manager.removeIdentifier(d.identifier),Q.manager.unbindDocument()},M.prototype.destroy=function(){var v=this;for(var d in v.unbindEvt(v.options.zone,"start"),v.nipples.forEach((function(v){v.destroy()})),v.pressureIntervals)v.pressureIntervals.hasOwnProperty(d)&&clearInterval(v.pressureIntervals[d]);v.trigger("destroyed",v.nipples),v.manager.unbindDocument(),v.off()};const Y=M;function D(v){var d=this;d.ids={},d.index=0,d.collections=[],d.scroll=u(),d.config(v),d.prepareCollections();var Q=function(){var v;d.collections.forEach((function(Q){Q.forEach((function(Q){v=Q.el.getBoundingClientRect(),Q.position={x:d.scroll.x+v.left,y:d.scroll.y+v.top}}))}))};F(window,"resize",(function(){e(Q)}));var n=function(){d.scroll=u()};return F(window,"scroll",(function(){e(n)})),d.collections}D.prototype=new o,D.constructor=D,D.prototype.prepareCollections=function(){var v=this;v.collections.create=v.create.bind(v),v.collections.on=v.on.bind(v),v.collections.off=v.off.bind(v),v.collections.destroy=v.destroy.bind(v),v.collections.get=function(d){var Q;return v.collections.every((function(v){return!(Q=v.get(d))})),Q}},D.prototype.create=function(v){return this.createCollection(v)},D.prototype.createCollection=function(v){var d=this,Q=new Y(d,v);return d.bindCollection(Q),d.collections.push(Q),Q},D.prototype.bindCollection=function(v){var d,Q=this,n=function(v,n){d=v.type+" "+n.id+":"+v.type,Q.trigger(d,n)};v.on("destroyed",Q.onDestroyed.bind(Q)),v.on("shown hidden rested dir plain",n),v.on("dir:up dir:right dir:down dir:left",n),v.on("plain:up plain:right plain:down plain:left",n)},D.prototype.bindDocument=function(){var v=this;v.binded||(v.bindEvt(document,"move").bindEvt(document,"end"),v.binded=!0)},D.prototype.unbindDocument=function(v){var d=this;Object.keys(d.ids).length&&!0!==v||(d.unbindEvt(document,"move").unbindEvt(document,"end"),d.binded=!1)},D.prototype.getIdentifier=function(v){var d;return v?void 0===(d=void 0===v.identifier?v.pointerId:v.identifier)&&(d=this.latest||0):d=this.index,void 0===this.ids[d]&&(this.ids[d]=this.index,this.index+=1),this.latest=d,this.ids[d]},D.prototype.removeIdentifier=function(v){var d={};for(var Q in this.ids)if(this.ids[Q]===v){d.id=Q,d.identifier=this.ids[Q],delete this.ids[Q];break}return d},D.prototype.onmove=function(v){return this.onAny("move",v),!1},D.prototype.onend=function(v){return this.onAny("end",v),!1},D.prototype.oncancel=function(v){return this.onAny("end",v),!1},D.prototype.onAny=function(v,d){var Q,n=this,T="processOn"+v.charAt(0).toUpperCase()+v.slice(1);d=C(d);var L=function(v,d,Q){Q.ids.indexOf(d)>=0&&(Q[T](v),v._found_=!0)};return m(d,(function(v){Q=n.getIdentifier(v),m(n.collections,L.bind(null,v,Q)),v._found_||n.removeIdentifier(Q)})),!1},D.prototype.destroy=function(){var v=this;v.unbindDocument(!0),v.ids={},v.index=0,v.collections.forEach((function(v){v.destroy()})),v.off()},D.prototype.onDestroyed=function(v,d){var Q=this;if(Q.collections.indexOf(d)<0)return!1;Q.collections.splice(Q.collections.indexOf(d),1)};var i=new D;const Z={create:function(v){return i.create(v)},factory:i};return d.default})(),v.exports=d()},12296:(v,d,Q)=>{"use strict";const{Deflate:n,deflate:T,deflateRaw:L,gzip:e}=Q(12304),{Inflate:F,inflate:r,inflateRaw:C,ungzip:u}=Q(12355),y=Q(12331);v.exports.Deflate=n,v.exports.deflate=T,v.exports.deflateRaw=L,v.exports.gzip=e,v.exports.Inflate=F,v.exports.inflate=r,v.exports.inflateRaw=C,v.exports.ungzip=u,v.exports.constants=y},12304:(v,d,Q)=>{"use strict";const n=Q(12306),T=Q(12336),L=Q(12343),e=Q(12326),F=Q(12346),r=Object.prototype.toString,{Z_NO_FLUSH:C,Z_SYNC_FLUSH:u,Z_FULL_FLUSH:y,Z_FINISH:z,Z_OK:B,Z_STREAM_END:X,Z_DEFAULT_COMPRESSION:m,Z_DEFAULT_STRATEGY:V,Z_DEFLATED:h}=Q(12331);function S(v){this.options=T.assign({level:m,method:h,Ja:16384,windowBits:15,memLevel:8,strategy:V},v||{});let d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let Q=n.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(Q!==B)throw new Error(e[Q]);if(d.header&&n.deflateSetHeader(this.strm,d.header),d.dictionary){let v;if(v="string"===typeof d.dictionary?L.string2buf(d.dictionary):"[object ArrayBuffer]"===r.call(d.dictionary)?new Uint8Array(d.dictionary):d.dictionary,Q=n.deflateSetDictionary(this.strm,v),Q!==B)throw new Error(e[Q]);this._dict_set=!0}}function A(v,d){const Q=new S(d);if(Q.push(v,!0),Q.err)throw Q.msg||e[Q.err];return Q.result}S.prototype.push=function(v,d){const Q=this.strm,T=this.options.Ja;let e,F;if(this.ended)return!1;for(F=d===~~d?d:!0===d?z:C,"string"===typeof v?Q.input=L.string2buf(v):"[object ArrayBuffer]"===r.call(v)?Q.input=new Uint8Array(v):Q.input=v,Q.next_in=0,Q.avail_in=Q.input.length;;)if(0===Q.avail_out&&(Q.output=new Uint8Array(T),Q.next_out=0,Q.avail_out=T),(F===u||F===y)&&Q.avail_out<=6)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else{if(e=n.deflate(Q,F),e===X)return Q.next_out>0&&this.onData(Q.output.subarray(0,Q.next_out)),e=n.deflateEnd(this.strm),this.onEnd(e),this.ended=!0,e===B;if(0!==Q.avail_out){if(F>0&&Q.next_out>0)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else if(0===Q.avail_in)break}else this.onData(Q.output)}return!0},S.prototype.onData=function(v){this.chunks.push(v)},S.prototype.onEnd=function(v){v===B&&(this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},v.exports.Deflate=S,v.exports.deflate=A,v.exports.deflateRaw=function(v,d){return(d=d||{}).raw=!0,A(v,d)},v.exports.gzip=function(v,d){return(d=d||{}).gzip=!0,A(v,d)},v.exports.constants=Q(12331)},12355:(v,d,Q)=>{"use strict";const n=Q(12362),T=Q(12336),L=Q(12343),e=Q(12326),F=Q(12346),r=Q(12375),C=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:y,Z_OK:z,Z_STREAM_END:B,Z_NEED_DICT:X,Z_STREAM_ERROR:m,Z_DATA_ERROR:V,Z_MEM_ERROR:h}=Q(12331);function S(v){this.options=T.assign({Ja:65536,windowBits:15,to:""},v||{});const d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||v&&v.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0===(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let Q=n.inflateInit2(this.strm,d.windowBits);if(Q!==z)throw new Error(e[Q]);if(this.header=new r,n.inflateGetHeader(this.strm,this.header),d.dictionary&&("string"===typeof d.dictionary?d.dictionary=L.string2buf(d.dictionary):"[object ArrayBuffer]"===C.call(d.dictionary)&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(Q=n.inflateSetDictionary(this.strm,d.dictionary),Q!==z)))throw new Error(e[Q])}function A(v,d){const Q=new S(d);if(Q.push(v),Q.err)throw Q.msg||e[Q.err];return Q.result}S.prototype.push=function(v,d){const Q=this.strm,T=this.options.Ja,e=this.options.dictionary;let F,r,S;if(this.ended)return!1;for(r=d===~~d?d:!0===d?y:u,"[object ArrayBuffer]"===C.call(v)?Q.input=new Uint8Array(v):Q.input=v,Q.next_in=0,Q.avail_in=Q.input.length;;){for(0===Q.avail_out&&(Q.output=new Uint8Array(T),Q.next_out=0,Q.avail_out=T),F=n.inflate(Q,r),F===X&&e&&(F=n.inflateSetDictionary(Q,e),F===z?F=n.inflate(Q,r):F===V&&(F=X));Q.avail_in>0&&F===B&&Q.state.wrap>0&&0!==v[Q.next_in];)n.inflateReset(Q),F=n.inflate(Q,r);switch(F){case m:case V:case X:case h:return this.onEnd(F),this.ended=!0,!1}if(S=Q.avail_out,Q.next_out&&(0===Q.avail_out||F===B))if("string"===this.options.to){let v=L.utf8border(Q.output,Q.next_out),d=Q.next_out-v,n=L.buf2string(Q.output,v);Q.next_out=d,Q.avail_out=T-d,d&&Q.output.set(Q.output.subarray(v,v+d),0),this.onData(n)}else this.onData(Q.output.length===Q.next_out?Q.output:Q.output.subarray(0,Q.next_out));if(F!==z||0!==S){if(F===B)return F=n.inflateEnd(this.strm),this.onEnd(F),this.ended=!0,!0;if(0===Q.avail_in)break}}return!0},S.prototype.onData=function(v){this.chunks.push(v)},S.prototype.onEnd=function(v){v===z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},v.exports.Inflate=S,v.exports.inflate=A,v.exports.inflateRaw=function(v,d){return(d=d||{}).raw=!0,A(v,d)},v.exports.ungzip=A,v.exports.constants=Q(12331)},12336:v=>{"use strict";const d=(v,d)=>Object.prototype.hasOwnProperty.call(v,d);v.exports.assign=function(v){const Q=Array.prototype.slice.call(arguments,1);for(;Q.length;){const n=Q.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const Q in n)d(n,Q)&&(v[Q]=n[Q])}}return v},v.exports.flattenChunks=v=>{let d=0;for(let n=0,T=v.length;n<T;n++)d+=v[n].length;const Q=new Uint8Array(d);for(let n=0,T=0,L=v.length;n<L;n++){let d=v[n];Q.set(d,T),T+=d.length}return Q}},12343:v=>{"use strict";let d=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(n){d=!1}const Q=new Uint8Array(256);for(let T=0;T<256;T++)Q[T]=T>=252?6:T>=248?5:T>=240?4:T>=224?3:T>=192?2:1;Q[254]=Q[254]=1,v.exports.string2buf=v=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(v);let d,Q,n,T,L,e=v.length,F=0;for(T=0;T<e;T++)Q=v.charCodeAt(T),55296===(64512&Q)&&T+1<e&&(n=v.charCodeAt(T+1),56320===(64512&n)&&(Q=65536+(Q-55296<<10)+(n-56320),T++)),F+=Q<128?1:Q<2048?2:Q<65536?3:4;for(d=new Uint8Array(F),L=0,T=0;L<F;T++)Q=v.charCodeAt(T),55296===(64512&Q)&&T+1<e&&(n=v.charCodeAt(T+1),56320===(64512&n)&&(Q=65536+(Q-55296<<10)+(n-56320),T++)),Q<128?d[L++]=Q:Q<2048?(d[L++]=192|Q>>>6,d[L++]=128|63&Q):Q<65536?(d[L++]=224|Q>>>12,d[L++]=128|Q>>>6&63,d[L++]=128|63&Q):(d[L++]=240|Q>>>18,d[L++]=128|Q>>>12&63,d[L++]=128|Q>>>6&63,d[L++]=128|63&Q);return d};v.exports.buf2string=(v,n)=>{const T=n||v.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(v.subarray(0,n));let L,e;const F=new Array(2*T);for(e=0,L=0;L<T;){let d=v[L++];if(d<128){F[e++]=d;continue}let n=Q[d];if(n>4)F[e++]=65533,L+=n-1;else{for(d&=2===n?31:3===n?15:7;n>1&&L<T;)d=d<<6|63&v[L++],n--;n>1?F[e++]=65533:d<65536?F[e++]=d:(d-=65536,F[e++]=55296|d>>10&1023,F[e++]=56320|1023&d)}}return((v,Q)=>{if(Q<65534&&v.subarray&&d)return String.fromCharCode.apply(null,v.length===Q?v:v.subarray(0,Q));let n="";for(let d=0;d<Q;d++)n+=String.fromCharCode(v[d]);return n})(F,e)},v.exports.utf8border=(v,d)=>{(d=d||v.length)>v.length&&(d=v.length);let n=d-1;for(;n>=0&&128===(192&v[n]);)n--;return n<0||0===n?d:n+Q[v[n]]>d?n:d}},12320:v=>{"use strict";v.exports=(v,d,Q,n)=>{let T=65535&v,L=v>>>16&65535,e=0;for(;0!==Q;){e=Q>2e3?2e3:Q,Q-=e;do{T=T+d[n++]|0,L=L+T|0}while(--e);T%=65521,L%=65521}return T|L<<16}},12331:v=>{"use strict";v.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12322:v=>{"use strict";const d=new Uint32Array((()=>{let v,d=[];for(var Q=0;Q<256;Q++){v=Q;for(var n=0;n<8;n++)v=1&v?3988292384^v>>>1:v>>>1;d[Q]=v}return d})());v.exports=(v,Q,n,T)=>{const L=d,e=T+n;v^=-1;for(let d=T;d<e;d++)v=v>>>8^L[255&(v^Q[d])];return~v}},12306:(v,d,Q)=>{"use strict";const{_tr_init:n,_tr_stored_block:T,_tr_flush_block:L,_tr_tally:e,_tr_align:F}=Q(12311),r=Q(12320),C=Q(12322),u=Q(12326),{Z_NO_FLUSH:y,Z_PARTIAL_FLUSH:z,Z_FULL_FLUSH:B,Z_FINISH:X,Z_BLOCK:m,Z_OK:V,Z_STREAM_END:h,Z_STREAM_ERROR:S,Z_DATA_ERROR:A,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:P,Z_FILTERED:O,Z_HUFFMAN_ONLY:J,Z_RLE:K,Z_FIXED:o,Z_DEFAULT_STRATEGY:g,Z_UNKNOWN:R,Z_DEFLATED:M}=Q(12331),Y=258,D=262,i=103,Z=113,j=666,x=(v,d)=>(v.msg=u[d],d),k=v=>(v<<1)-(v>4?9:0),t=v=>{let d=v.length;for(;--d>=0;)v[d]=0};let p=(v,d,Q)=>(d<<v.hash_shift^Q)&v.hash_mask;const W=v=>{const d=v.state;let Q=d.pending;Q>v.avail_out&&(Q=v.avail_out),0!==Q&&(v.output.set(d.pending_buf.subarray(d.pending_out,d.pending_out+Q),v.next_out),v.next_out+=Q,d.pending_out+=Q,v.total_out+=Q,v.avail_out-=Q,d.pending-=Q,0===d.pending&&(d.pending_out=0))},q=(v,d)=>{L(v,v.block_start>=0?v.block_start:-1,v.strstart-v.block_start,d),v.block_start=v.strstart,W(v.strm)},b=(v,d)=>{v.pending_buf[v.pending++]=d},H=(v,d)=>{v.pending_buf[v.pending++]=d>>>8&255,v.pending_buf[v.pending++]=255&d},s=(v,d,Q,n)=>{let T=v.avail_in;return T>n&&(T=n),0===T?0:(v.avail_in-=T,d.set(v.input.subarray(v.next_in,v.next_in+T),Q),1===v.state.wrap?v.adler=r(v.adler,d,T,Q):2===v.state.wrap&&(v.adler=C(v.adler,d,T,Q)),v.next_in+=T,v.total_in+=T,T)},a=(v,d)=>{let Q,n,T=v.max_chain_length,L=v.strstart,e=v.prev_length,F=v.nice_match;const r=v.strstart>v.w_size-D?v.strstart-(v.w_size-D):0,C=v.window,u=v.w_mask,y=v.prev,z=v.strstart+Y;let B=C[L+e-1],X=C[L+e];v.prev_length>=v.good_match&&(T>>=2),F>v.lookahead&&(F=v.lookahead);do{if(Q=d,C[Q+e]===X&&C[Q+e-1]===B&&C[Q]===C[L]&&C[++Q]===C[L+1]){L+=2,Q++;do{}while(C[++L]===C[++Q]&&C[++L]===C[++Q]&&C[++L]===C[++Q]&&C[++L]===C[++Q]&&C[++L]===C[++Q]&&C[++L]===C[++Q]&&C[++L]===C[++Q]&&C[++L]===C[++Q]&&L<z);if(n=Y-(z-L),L=z-Y,n>e){if(v.match_start=d,e=n,n>=F)break;B=C[L+e-1],X=C[L+e]}}}while((d=y[d&u])>r&&0!==--T);return e<=v.lookahead?e:v.lookahead},I=v=>{const d=v.w_size;let Q,n,T,L,e;do{if(L=v.window_size-v.lookahead-v.strstart,v.strstart>=d+(d-D)){v.window.set(v.window.subarray(d,d+d),0),v.match_start-=d,v.strstart-=d,v.block_start-=d,n=v.hash_size,Q=n;do{T=v.head[--Q],v.head[Q]=T>=d?T-d:0}while(--n);n=d,Q=n;do{T=v.prev[--Q],v.prev[Q]=T>=d?T-d:0}while(--n);L+=d}if(0===v.strm.avail_in)break;if(n=s(v.strm,v.window,v.strstart+v.lookahead,L),v.lookahead+=n,v.lookahead+v.insert>=3)for(e=v.strstart-v.insert,v.ins_h=v.window[e],v.ins_h=p(v,v.ins_h,v.window[e+1]);v.insert&&(v.ins_h=p(v,v.ins_h,v.window[e+3-1]),v.prev[e&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=e,e++,v.insert--,!(v.lookahead+v.insert<3)););}while(v.lookahead<D&&0!==v.strm.avail_in)},U=(v,d)=>{let Q,n;for(;;){if(v.lookahead<D){if(I(v),v.lookahead<D&&d===y)return 1;if(0===v.lookahead)break}if(Q=0,v.lookahead>=3&&(v.ins_h=p(v,v.ins_h,v.window[v.strstart+3-1]),Q=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),0!==Q&&v.strstart-Q<=v.w_size-D&&(v.match_length=a(v,Q)),v.match_length>=3)if(n=e(v,v.strstart-v.match_start,v.match_length-3),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=3){v.match_length--;do{v.strstart++,v.ins_h=p(v,v.ins_h,v.window[v.strstart+3-1]),Q=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart}while(0!==--v.match_length);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=p(v,v.ins_h,v.window[v.strstart+1]);else n=e(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(n&&(q(v,!1),0===v.strm.avail_out))return 1}return v.insert=v.strstart<2?v.strstart:2,d===X?(q(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(q(v,!1),0===v.strm.avail_out)?1:2},c=(v,d)=>{let Q,n,T;for(;;){if(v.lookahead<D){if(I(v),v.lookahead<D&&d===y)return 1;if(0===v.lookahead)break}if(Q=0,v.lookahead>=3&&(v.ins_h=p(v,v.ins_h,v.window[v.strstart+3-1]),Q=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=2,0!==Q&&v.prev_length<v.max_lazy_match&&v.strstart-Q<=v.w_size-D&&(v.match_length=a(v,Q),v.match_length<=5&&(v.strategy===O||3===v.match_length&&v.strstart-v.match_start>4096)&&(v.match_length=2)),v.prev_length>=3&&v.match_length<=v.prev_length){T=v.strstart+v.lookahead-3,n=e(v,v.strstart-1-v.prev_match,v.prev_length-3),v.lookahead-=v.prev_length-1,v.prev_length-=2;do{++v.strstart<=T&&(v.ins_h=p(v,v.ins_h,v.window[v.strstart+3-1]),Q=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart)}while(0!==--v.prev_length);if(v.match_available=0,v.match_length=2,v.strstart++,n&&(q(v,!1),0===v.strm.avail_out))return 1}else if(v.match_available){if(n=e(v,0,v.window[v.strstart-1]),n&&q(v,!1),v.strstart++,v.lookahead--,0===v.strm.avail_out)return 1}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(n=e(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<2?v.strstart:2,d===X?(q(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(q(v,!1),0===v.strm.avail_out)?1:2};function w(v,d,Q,n,T){this.good_length=v,this.max_lazy=d,this.nice_length=Q,this.max_chain=n,this.func=T}const G=[new w(0,0,0,0,((v,d)=>{let Q=65535;for(Q>v.pending_buf_size-5&&(Q=v.pending_buf_size-5);;){if(v.lookahead<=1){if(I(v),0===v.lookahead&&d===y)return 1;if(0===v.lookahead)break}v.strstart+=v.lookahead,v.lookahead=0;const n=v.block_start+Q;if((0===v.strstart||v.strstart>=n)&&(v.lookahead=v.strstart-n,v.strstart=n,q(v,!1),0===v.strm.avail_out))return 1;if(v.strstart-v.block_start>=v.w_size-D&&(q(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,d===X?(q(v,!0),0===v.strm.avail_out?3:4):(v.strstart>v.block_start&&(q(v,!1),v.strm.avail_out),1)})),new w(4,4,8,4,U),new w(4,5,16,8,U),new w(4,6,32,32,U),new w(4,4,16,16,c),new w(8,16,32,32,c),new w(8,16,128,128,c),new w(8,32,128,256,c),new w(32,128,258,1024,c),new w(32,258,258,4096,c)];function E(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),t(this.dyn_ltree),t(this.dyn_dtree),t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const N=v=>{if(!v||!v.state)return x(v,S);v.total_in=v.total_out=0,v.data_type=R;const d=v.state;return d.pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap?42:Z,v.adler=2===d.wrap?0:1,d.last_flush=y,n(d),V},l=v=>{const d=N(v);var Q;return d===V&&((Q=v.state).window_size=2*Q.w_size,t(Q.head),Q.max_lazy_match=G[Q.level].max_lazy,Q.good_match=G[Q.level].good_length,Q.nice_match=G[Q.level].nice_length,Q.max_chain_length=G[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=2,Q.match_available=0,Q.ins_h=0),d},vv=(v,d,Q,n,T,L)=>{if(!v)return S;let e=1;if(d===P&&(d=6),n<0?(e=0,n=-n):n>15&&(e=2,n-=16),T<1||T>9||Q!==M||n<8||n>15||d<0||d>9||L<0||L>o)return x(v,S);8===n&&(n=9);const F=new E;return v.state=F,F.strm=v,F.wrap=e,F.gzhead=null,F.w_bits=n,F.w_size=1<<F.w_bits,F.w_mask=F.w_size-1,F.hash_bits=T+7,F.hash_size=1<<F.hash_bits,F.hash_mask=F.hash_size-1,F.hash_shift=~~((F.hash_bits+3-1)/3),F.window=new Uint8Array(2*F.w_size),F.head=new Uint16Array(F.hash_size),F.prev=new Uint16Array(F.w_size),F.lit_bufsize=1<<T+6,F.pending_buf_size=4*F.lit_bufsize,F.pending_buf=new Uint8Array(F.pending_buf_size),F.d_buf=1*F.lit_bufsize,F.l_buf=3*F.lit_bufsize,F.level=d,F.strategy=L,F.method=Q,l(v)};v.exports.deflateInit=(v,d)=>vv(v,d,M,15,8,g),v.exports.deflateInit2=vv,v.exports.deflateReset=l,v.exports.deflateResetKeep=N,v.exports.deflateSetHeader=(v,d)=>v&&v.state?2!==v.state.wrap?S:(v.state.gzhead=d,V):S,v.exports.deflate=(v,d)=>{let Q,n;if(!v||!v.state||d>m||d<0)return v?x(v,S):S;const L=v.state;if(!v.output||!v.input&&0!==v.avail_in||L.status===j&&d!==X)return x(v,0===v.avail_out?f:S);L.strm=v;const r=L.last_flush;if(L.last_flush=d,42===L.status)if(2===L.wrap)v.adler=0,b(L,31),b(L,139),b(L,8),L.gzhead?(b(L,(L.gzhead.text?1:0)+(L.gzhead.hcrc?2:0)+(L.gzhead.extra?4:0)+(L.gzhead.name?8:0)+(L.gzhead.comment?16:0)),b(L,255&L.gzhead.time),b(L,L.gzhead.time>>8&255),b(L,L.gzhead.time>>16&255),b(L,L.gzhead.time>>24&255),b(L,9===L.level?2:L.strategy>=J||L.level<2?4:0),b(L,255&L.gzhead.os),L.gzhead.extra&&L.gzhead.extra.length&&(b(L,255&L.gzhead.extra.length),b(L,L.gzhead.extra.length>>8&255)),L.gzhead.hcrc&&(v.adler=C(v.adler,L.pending_buf,L.pending,0)),L.gzindex=0,L.status=69):(b(L,0),b(L,0),b(L,0),b(L,0),b(L,0),b(L,9===L.level?2:L.strategy>=J||L.level<2?4:0),b(L,3),L.status=Z);else{let d=M+(L.w_bits-8<<4)<<8,Q=-1;Q=L.strategy>=J||L.level<2?0:L.level<6?1:6===L.level?2:3,d|=Q<<6,0!==L.strstart&&(d|=32),d+=31-d%31,L.status=Z,H(L,d),0!==L.strstart&&(H(L,v.adler>>>16),H(L,65535&v.adler)),v.adler=1}if(69===L.status)if(L.gzhead.extra){for(Q=L.pending;L.gzindex<(65535&L.gzhead.extra.length)&&(L.pending!==L.pending_buf_size||(L.gzhead.hcrc&&L.pending>Q&&(v.adler=C(v.adler,L.pending_buf,L.pending-Q,Q)),W(v),Q=L.pending,L.pending!==L.pending_buf_size));)b(L,255&L.gzhead.extra[L.gzindex]),L.gzindex++;L.gzhead.hcrc&&L.pending>Q&&(v.adler=C(v.adler,L.pending_buf,L.pending-Q,Q)),L.gzindex===L.gzhead.extra.length&&(L.gzindex=0,L.status=73)}else L.status=73;if(73===L.status)if(L.gzhead.name){Q=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>Q&&(v.adler=C(v.adler,L.pending_buf,L.pending-Q,Q)),W(v),Q=L.pending,L.pending===L.pending_buf_size)){n=1;break}n=L.gzindex<L.gzhead.name.length?255&L.gzhead.name.charCodeAt(L.gzindex++):0,b(L,n)}while(0!==n);L.gzhead.hcrc&&L.pending>Q&&(v.adler=C(v.adler,L.pending_buf,L.pending-Q,Q)),0===n&&(L.gzindex=0,L.status=91)}else L.status=91;if(91===L.status)if(L.gzhead.comment){Q=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>Q&&(v.adler=C(v.adler,L.pending_buf,L.pending-Q,Q)),W(v),Q=L.pending,L.pending===L.pending_buf_size)){n=1;break}n=L.gzindex<L.gzhead.comment.length?255&L.gzhead.comment.charCodeAt(L.gzindex++):0,b(L,n)}while(0!==n);L.gzhead.hcrc&&L.pending>Q&&(v.adler=C(v.adler,L.pending_buf,L.pending-Q,Q)),0===n&&(L.status=i)}else L.status=i;if(L.status===i&&(L.gzhead.hcrc?(L.pending+2>L.pending_buf_size&&W(v),L.pending+2<=L.pending_buf_size&&(b(L,255&v.adler),b(L,v.adler>>8&255),v.adler=0,L.status=Z)):L.status=Z),0!==L.pending){if(W(v),0===v.avail_out)return L.last_flush=-1,V}else if(0===v.avail_in&&k(d)<=k(r)&&d!==X)return x(v,f);if(L.status===j&&0!==v.avail_in)return x(v,f);if(0!==v.avail_in||0!==L.lookahead||d!==y&&L.status!==j){let Q=L.strategy===J?((v,d)=>{let Q;for(;;){if(0===v.lookahead&&(I(v),0===v.lookahead)){if(d===y)return 1;break}if(v.match_length=0,Q=e(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++,Q&&(q(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,d===X?(q(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(q(v,!1),0===v.strm.avail_out)?1:2})(L,d):L.strategy===K?((v,d)=>{let Q,n,T,L;const F=v.window;for(;;){if(v.lookahead<=Y){if(I(v),v.lookahead<=Y&&d===y)return 1;if(0===v.lookahead)break}if(v.match_length=0,v.lookahead>=3&&v.strstart>0&&(T=v.strstart-1,n=F[T],n===F[++T]&&n===F[++T]&&n===F[++T])){L=v.strstart+Y;do{}while(n===F[++T]&&n===F[++T]&&n===F[++T]&&n===F[++T]&&n===F[++T]&&n===F[++T]&&n===F[++T]&&n===F[++T]&&T<L);v.match_length=Y-(L-T),v.match_length>v.lookahead&&(v.match_length=v.lookahead)}if(v.match_length>=3?(Q=e(v,1,v.match_length-3),v.lookahead-=v.match_length,v.strstart+=v.match_length,v.match_length=0):(Q=e(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++),Q&&(q(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,d===X?(q(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(q(v,!1),0===v.strm.avail_out)?1:2})(L,d):G[L.level].func(L,d);if(3!==Q&&4!==Q||(L.status=j),1===Q||3===Q)return 0===v.avail_out&&(L.last_flush=-1),V;if(2===Q&&(d===z?F(L):d!==m&&(T(L,0,0,!1),d===B&&(t(L.head),0===L.lookahead&&(L.strstart=0,L.block_start=0,L.insert=0))),W(v),0===v.avail_out))return L.last_flush=-1,V}return d!==X?V:L.wrap<=0?h:(2===L.wrap?(b(L,255&v.adler),b(L,v.adler>>8&255),b(L,v.adler>>16&255),b(L,v.adler>>24&255),b(L,255&v.total_in),b(L,v.total_in>>8&255),b(L,v.total_in>>16&255),b(L,v.total_in>>24&255)):(H(L,v.adler>>>16),H(L,65535&v.adler)),W(v),L.wrap>0&&(L.wrap=-L.wrap),0!==L.pending?V:h)},v.exports.deflateEnd=v=>{if(!v||!v.state)return S;const d=v.state.status;return 42!==d&&69!==d&&73!==d&&91!==d&&d!==i&&d!==Z&&d!==j?x(v,S):(v.state=null,d===Z?x(v,A):V)},v.exports.deflateSetDictionary=(v,d)=>{let Q=d.length;if(!v||!v.state)return S;const n=v.state,T=n.wrap;if(2===T||1===T&&42!==n.status||n.lookahead)return S;if(1===T&&(v.adler=r(v.adler,d,Q,0)),n.wrap=0,Q>=n.w_size){0===T&&(t(n.head),n.strstart=0,n.block_start=0,n.insert=0);let v=new Uint8Array(n.w_size);v.set(d.subarray(Q-n.w_size,Q),0),d=v,Q=n.w_size}const L=v.avail_in,e=v.next_in,F=v.input;for(v.avail_in=Q,v.next_in=0,v.input=d,I(n);n.lookahead>=3;){let v=n.strstart,d=n.lookahead-2;do{n.ins_h=p(n,n.ins_h,n.window[v+3-1]),n.prev[v&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=v,v++}while(--d);n.strstart=v,n.lookahead=2,I(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,v.next_in=e,v.input=F,v.avail_in=L,n.wrap=T,V},v.exports.deflateInfo="pako deflate (from Nodeca project)"},12375:v=>{"use strict";v.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12367:v=>{"use strict";v.exports=function(v,d){let Q,n,T,L,e,F,r,C,u,y,z,B,X,m,V,h,S,A,f,P,O,J,K,o;const g=v.state;Q=v.next_in,K=v.input,n=Q+(v.avail_in-5),T=v.next_out,o=v.output,L=T-(d-v.avail_out),e=T+(v.avail_out-257),F=g.dmax,r=g.wsize,C=g.whave,u=g.wnext,y=g.window,z=g.hold,B=g.bits,X=g.lencode,m=g.distcode,V=(1<<g.lenbits)-1,h=(1<<g.distbits)-1;v:do{B<15&&(z+=K[Q++]<<B,B+=8,z+=K[Q++]<<B,B+=8),S=X[z&V];d:for(;;){if(A=S>>>24,z>>>=A,B-=A,A=S>>>16&255,0===A)o[T++]=65535&S;else{if(!(16&A)){if(0===(64&A)){S=X[(65535&S)+(z&(1<<A)-1)];continue d}if(32&A){g.mode=12;break v}v.msg="invalid literal/length code",g.mode=30;break v}f=65535&S,A&=15,A&&(B<A&&(z+=K[Q++]<<B,B+=8),f+=z&(1<<A)-1,z>>>=A,B-=A),B<15&&(z+=K[Q++]<<B,B+=8,z+=K[Q++]<<B,B+=8),S=m[z&h];Q:for(;;){if(A=S>>>24,z>>>=A,B-=A,A=S>>>16&255,!(16&A)){if(0===(64&A)){S=m[(65535&S)+(z&(1<<A)-1)];continue Q}v.msg="invalid distance code",g.mode=30;break v}if(P=65535&S,A&=15,B<A&&(z+=K[Q++]<<B,B+=8,B<A&&(z+=K[Q++]<<B,B+=8)),P+=z&(1<<A)-1,P>F){v.msg="invalid distance too far back",g.mode=30;break v}if(z>>>=A,B-=A,A=T-L,P>A){if(A=P-A,A>C&&g.sane){v.msg="invalid distance too far back",g.mode=30;break v}if(O=0,J=y,0===u){if(O+=r-A,A<f){f-=A;do{o[T++]=y[O++]}while(--A);O=T-P,J=o}}else if(u<A){if(O+=r+u-A,A-=u,A<f){f-=A;do{o[T++]=y[O++]}while(--A);if(O=0,u<f){A=u,f-=A;do{o[T++]=y[O++]}while(--A);O=T-P,J=o}}}else if(O+=u-A,A<f){f-=A;do{o[T++]=y[O++]}while(--A);O=T-P,J=o}for(;f>2;)o[T++]=J[O++],o[T++]=J[O++],o[T++]=J[O++],f-=3;f&&(o[T++]=J[O++],f>1&&(o[T++]=J[O++]))}else{O=T-P;do{o[T++]=o[O++],o[T++]=o[O++],o[T++]=o[O++],f-=3}while(f>2);f&&(o[T++]=o[O++],f>1&&(o[T++]=o[O++]))}break}}break}}while(Q<n&&T<e);f=B>>3,Q-=f,B-=f<<3,z&=(1<<B)-1,v.next_in=Q,v.next_out=T,v.avail_in=Q<n?n-Q+5:5-(Q-n),v.avail_out=T<e?e-T+257:257-(T-e),g.hold=z,g.bits=B}},12362:(v,d,Q)=>{"use strict";const n=Q(12320),T=Q(12322),L=Q(12367),e=Q(12371),{Z_FINISH:F,Z_BLOCK:r,Z_TREES:C,Z_OK:u,Z_STREAM_END:y,Z_NEED_DICT:z,Z_STREAM_ERROR:B,Z_DATA_ERROR:X,Z_MEM_ERROR:m,Z_BUF_ERROR:V,Z_DEFLATED:h}=Q(12331),S=12,A=30,f=v=>(v>>>24&255)+(v>>>8&65280)+((65280&v)<<8)+((255&v)<<24);function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const O=v=>{if(!v||!v.state)return B;const d=v.state;return v.total_in=v.total_out=d.total=0,v.msg="",d.wrap&&(v.adler=1&d.wrap),d.mode=1,d.last=0,d.havedict=0,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new Int32Array(852),d.distcode=d.distdyn=new Int32Array(592),d.sane=1,d.back=-1,u},J=v=>{if(!v||!v.state)return B;const d=v.state;return d.wsize=0,d.whave=0,d.wnext=0,O(v)},K=(v,d)=>{let Q;if(!v||!v.state)return B;const n=v.state;return d<0?(Q=0,d=-d):(Q=1+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?B:(null!==n.window&&n.wbits!==d&&(n.window=null),n.wrap=Q,n.wbits=d,J(v))},o=(v,d)=>{if(!v)return B;const Q=new P;v.state=Q,Q.window=null;const n=K(v,d);return n!==u&&(v.state=null),n};let g,R,M=!0;const Y=v=>{if(M){g=new Int32Array(512),R=new Int32Array(32);let d=0;for(;d<144;)v.lens[d++]=8;for(;d<256;)v.lens[d++]=9;for(;d<280;)v.lens[d++]=7;for(;d<288;)v.lens[d++]=8;for(e(1,v.lens,0,288,g,0,v.work,{bits:9}),d=0;d<32;)v.lens[d++]=5;e(2,v.lens,0,32,R,0,v.work,{bits:5}),M=!1}v.lencode=g,v.lenbits=9,v.distcode=R,v.distbits=5},D=(v,d,Q,n)=>{let T;const L=v.state;return null===L.window&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new Uint8Array(L.wsize)),n>=L.wsize?(L.window.set(d.subarray(Q-L.wsize,Q),0),L.wnext=0,L.whave=L.wsize):(T=L.wsize-L.wnext,T>n&&(T=n),L.window.set(d.subarray(Q-n,Q-n+T),L.wnext),(n-=T)?(L.window.set(d.subarray(Q-n,Q),0),L.wnext=n,L.whave=L.wsize):(L.wnext+=T,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=T))),0};v.exports.inflateReset=J,v.exports.inflateReset2=K,v.exports.inflateResetKeep=O,v.exports.inflateInit=v=>o(v,15),v.exports.inflateInit2=o,v.exports.inflate=(v,d)=>{let Q,P,O,J,K,o,g,R,M,i,Z,j,x,k,t,p,W,q,b,H,s,a,I=0;const U=new Uint8Array(4);let c,w;const G=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!v||!v.state||!v.output||!v.input&&0!==v.avail_in)return B;Q=v.state,Q.mode===S&&(Q.mode=13),K=v.next_out,O=v.output,g=v.avail_out,J=v.next_in,P=v.input,o=v.avail_in,R=Q.hold,M=Q.bits,i=o,Z=g,a=u;v:for(;;)switch(Q.mode){case 1:if(0===Q.wrap){Q.mode=13;break}for(;M<16;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(2&Q.wrap&&35615===R){Q.check=0,U[0]=255&R,U[1]=R>>>8&255,Q.check=T(Q.check,U,2,0),R=0,M=0,Q.mode=2;break}if(Q.flags=0,Q.head&&(Q.head.done=!1),!(1&Q.wrap)||(((255&R)<<8)+(R>>8))%31){v.msg="incorrect header check",Q.mode=A;break}if((15&R)!==h){v.msg="unknown compression method",Q.mode=A;break}if(R>>>=4,M-=4,s=8+(15&R),0===Q.wbits)Q.wbits=s;else if(s>Q.wbits){v.msg="invalid window size",Q.mode=A;break}Q.dmax=1<<Q.wbits,v.adler=Q.check=1,Q.mode=512&R?10:S,R=0,M=0;break;case 2:for(;M<16;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(Q.flags=R,(255&Q.flags)!==h){v.msg="unknown compression method",Q.mode=A;break}if(57344&Q.flags){v.msg="unknown header flags set",Q.mode=A;break}Q.head&&(Q.head.text=R>>8&1),512&Q.flags&&(U[0]=255&R,U[1]=R>>>8&255,Q.check=T(Q.check,U,2,0)),R=0,M=0,Q.mode=3;case 3:for(;M<32;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}Q.head&&(Q.head.time=R),512&Q.flags&&(U[0]=255&R,U[1]=R>>>8&255,U[2]=R>>>16&255,U[3]=R>>>24&255,Q.check=T(Q.check,U,4,0)),R=0,M=0,Q.mode=4;case 4:for(;M<16;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}Q.head&&(Q.head.xflags=255&R,Q.head.os=R>>8),512&Q.flags&&(U[0]=255&R,U[1]=R>>>8&255,Q.check=T(Q.check,U,2,0)),R=0,M=0,Q.mode=5;case 5:if(1024&Q.flags){for(;M<16;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}Q.length=R,Q.head&&(Q.head.extra_len=R),512&Q.flags&&(U[0]=255&R,U[1]=R>>>8&255,Q.check=T(Q.check,U,2,0)),R=0,M=0}else Q.head&&(Q.head.extra=null);Q.mode=6;case 6:if(1024&Q.flags&&(j=Q.length,j>o&&(j=o),j&&(Q.head&&(s=Q.head.extra_len-Q.length,Q.head.extra||(Q.head.extra=new Uint8Array(Q.head.extra_len)),Q.head.extra.set(P.subarray(J,J+j),s)),512&Q.flags&&(Q.check=T(Q.check,P,j,J)),o-=j,J+=j,Q.length-=j),Q.length))break v;Q.length=0,Q.mode=7;case 7:if(2048&Q.flags){if(0===o)break v;j=0;do{s=P[J+j++],Q.head&&s&&Q.length<65536&&(Q.head.name+=String.fromCharCode(s))}while(s&&j<o);if(512&Q.flags&&(Q.check=T(Q.check,P,j,J)),o-=j,J+=j,s)break v}else Q.head&&(Q.head.name=null);Q.length=0,Q.mode=8;case 8:if(4096&Q.flags){if(0===o)break v;j=0;do{s=P[J+j++],Q.head&&s&&Q.length<65536&&(Q.head.comment+=String.fromCharCode(s))}while(s&&j<o);if(512&Q.flags&&(Q.check=T(Q.check,P,j,J)),o-=j,J+=j,s)break v}else Q.head&&(Q.head.comment=null);Q.mode=9;case 9:if(512&Q.flags){for(;M<16;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(R!==(65535&Q.check)){v.msg="header crc mismatch",Q.mode=A;break}R=0,M=0}Q.head&&(Q.head.hcrc=Q.flags>>9&1,Q.head.done=!0),v.adler=Q.check=0,Q.mode=S;break;case 10:for(;M<32;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}v.adler=Q.check=f(R),R=0,M=0,Q.mode=11;case 11:if(0===Q.havedict)return v.next_out=K,v.avail_out=g,v.next_in=J,v.avail_in=o,Q.hold=R,Q.bits=M,z;v.adler=Q.check=1,Q.mode=S;case S:if(d===r||d===C)break v;case 13:if(Q.last){R>>>=7&M,M-=7&M,Q.mode=27;break}for(;M<3;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}switch(Q.last=1&R,R>>>=1,M-=1,3&R){case 0:Q.mode=14;break;case 1:if(Y(Q),Q.mode=20,d===C){R>>>=2,M-=2;break v}break;case 2:Q.mode=17;break;case 3:v.msg="invalid block type",Q.mode=A}R>>>=2,M-=2;break;case 14:for(R>>>=7&M,M-=7&M;M<32;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if((65535&R)!==(R>>>16^65535)){v.msg="invalid stored block lengths",Q.mode=A;break}if(Q.length=65535&R,R=0,M=0,Q.mode=15,d===C)break v;case 15:Q.mode=16;case 16:if(j=Q.length,j){if(j>o&&(j=o),j>g&&(j=g),0===j)break v;O.set(P.subarray(J,J+j),K),o-=j,J+=j,g-=j,K+=j,Q.length-=j;break}Q.mode=S;break;case 17:for(;M<14;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(Q.nlen=257+(31&R),R>>>=5,M-=5,Q.ndist=1+(31&R),R>>>=5,M-=5,Q.ncode=4+(15&R),R>>>=4,M-=4,Q.nlen>286||Q.ndist>30){v.msg="too many length or distance symbols",Q.mode=A;break}Q.have=0,Q.mode=18;case 18:for(;Q.have<Q.ncode;){for(;M<3;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}Q.lens[G[Q.have++]]=7&R,R>>>=3,M-=3}for(;Q.have<19;)Q.lens[G[Q.have++]]=0;if(Q.lencode=Q.lendyn,Q.lenbits=7,c={bits:Q.lenbits},a=e(0,Q.lens,0,19,Q.lencode,0,Q.work,c),Q.lenbits=c.bits,a){v.msg="invalid code lengths set",Q.mode=A;break}Q.have=0,Q.mode=19;case 19:for(;Q.have<Q.nlen+Q.ndist;){for(;I=Q.lencode[R&(1<<Q.lenbits)-1],t=I>>>24,p=I>>>16&255,W=65535&I,!(t<=M);){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(W<16)R>>>=t,M-=t,Q.lens[Q.have++]=W;else{if(16===W){for(w=t+2;M<w;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(R>>>=t,M-=t,0===Q.have){v.msg="invalid bit length repeat",Q.mode=A;break}s=Q.lens[Q.have-1],j=3+(3&R),R>>>=2,M-=2}else if(17===W){for(w=t+3;M<w;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}R>>>=t,M-=t,s=0,j=3+(7&R),R>>>=3,M-=3}else{for(w=t+7;M<w;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}R>>>=t,M-=t,s=0,j=11+(127&R),R>>>=7,M-=7}if(Q.have+j>Q.nlen+Q.ndist){v.msg="invalid bit length repeat",Q.mode=A;break}for(;j--;)Q.lens[Q.have++]=s}}if(Q.mode===A)break;if(0===Q.lens[256]){v.msg="invalid code -- missing end-of-block",Q.mode=A;break}if(Q.lenbits=9,c={bits:Q.lenbits},a=e(1,Q.lens,0,Q.nlen,Q.lencode,0,Q.work,c),Q.lenbits=c.bits,a){v.msg="invalid literal/lengths set",Q.mode=A;break}if(Q.distbits=6,Q.distcode=Q.distdyn,c={bits:Q.distbits},a=e(2,Q.lens,Q.nlen,Q.ndist,Q.distcode,0,Q.work,c),Q.distbits=c.bits,a){v.msg="invalid distances set",Q.mode=A;break}if(Q.mode=20,d===C)break v;case 20:Q.mode=21;case 21:if(o>=6&&g>=258){v.next_out=K,v.avail_out=g,v.next_in=J,v.avail_in=o,Q.hold=R,Q.bits=M,L(v,Z),K=v.next_out,O=v.output,g=v.avail_out,J=v.next_in,P=v.input,o=v.avail_in,R=Q.hold,M=Q.bits,Q.mode===S&&(Q.back=-1);break}for(Q.back=0;I=Q.lencode[R&(1<<Q.lenbits)-1],t=I>>>24,p=I>>>16&255,W=65535&I,!(t<=M);){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(p&&0===(240&p)){for(q=t,b=p,H=W;I=Q.lencode[H+((R&(1<<q+b)-1)>>q)],t=I>>>24,p=I>>>16&255,W=65535&I,!(q+t<=M);){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}R>>>=q,M-=q,Q.back+=q}if(R>>>=t,M-=t,Q.back+=t,Q.length=W,0===p){Q.mode=26;break}if(32&p){Q.back=-1,Q.mode=S;break}if(64&p){v.msg="invalid literal/length code",Q.mode=A;break}Q.extra=15&p,Q.mode=22;case 22:if(Q.extra){for(w=Q.extra;M<w;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}Q.length+=R&(1<<Q.extra)-1,R>>>=Q.extra,M-=Q.extra,Q.back+=Q.extra}Q.was=Q.length,Q.mode=23;case 23:for(;I=Q.distcode[R&(1<<Q.distbits)-1],t=I>>>24,p=I>>>16&255,W=65535&I,!(t<=M);){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(0===(240&p)){for(q=t,b=p,H=W;I=Q.distcode[H+((R&(1<<q+b)-1)>>q)],t=I>>>24,p=I>>>16&255,W=65535&I,!(q+t<=M);){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}R>>>=q,M-=q,Q.back+=q}if(R>>>=t,M-=t,Q.back+=t,64&p){v.msg="invalid distance code",Q.mode=A;break}Q.offset=W,Q.extra=15&p,Q.mode=24;case 24:if(Q.extra){for(w=Q.extra;M<w;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}Q.offset+=R&(1<<Q.extra)-1,R>>>=Q.extra,M-=Q.extra,Q.back+=Q.extra}if(Q.offset>Q.dmax){v.msg="invalid distance too far back",Q.mode=A;break}Q.mode=25;case 25:if(0===g)break v;if(j=Z-g,Q.offset>j){if(j=Q.offset-j,j>Q.whave&&Q.sane){v.msg="invalid distance too far back",Q.mode=A;break}j>Q.wnext?(j-=Q.wnext,x=Q.wsize-j):x=Q.wnext-j,j>Q.length&&(j=Q.length),k=Q.window}else k=O,x=K-Q.offset,j=Q.length;j>g&&(j=g),g-=j,Q.length-=j;do{O[K++]=k[x++]}while(--j);0===Q.length&&(Q.mode=21);break;case 26:if(0===g)break v;O[K++]=Q.length,g--,Q.mode=21;break;case 27:if(Q.wrap){for(;M<32;){if(0===o)break v;o--,R|=P[J++]<<M,M+=8}if(Z-=g,v.total_out+=Z,Q.total+=Z,Z&&(v.adler=Q.check=Q.flags?T(Q.check,O,Z,K-Z):n(Q.check,O,Z,K-Z)),Z=g,(Q.flags?R:f(R))!==Q.check){v.msg="incorrect data check",Q.mode=A;break}R=0,M=0}Q.mode=28;case 28:if(Q.wrap&&Q.flags){for(;M<32;){if(0===o)break v;o--,R+=P[J++]<<M,M+=8}if(R!==(4294967295&Q.total)){v.msg="incorrect length check",Q.mode=A;break}R=0,M=0}Q.mode=29;case 29:a=y;break v;case A:a=X;break v;case 31:return m;default:return B}return v.next_out=K,v.avail_out=g,v.next_in=J,v.avail_in=o,Q.hold=R,Q.bits=M,(Q.wsize||Z!==v.avail_out&&Q.mode<A&&(Q.mode<27||d!==F))&&D(v,v.output,v.next_out,Z-v.avail_out)?(Q.mode=31,m):(i-=v.avail_in,Z-=v.avail_out,v.total_in+=i,v.total_out+=Z,Q.total+=Z,Q.wrap&&Z&&(v.adler=Q.check=Q.flags?T(Q.check,O,Z,v.next_out-Z):n(Q.check,O,Z,v.next_out-Z)),v.data_type=Q.bits+(Q.last?64:0)+(Q.mode===S?128:0)+(20===Q.mode||15===Q.mode?256:0),(0===i&&0===Z||d===F)&&a===u&&(a=V),a)},v.exports.inflateEnd=v=>{if(!v||!v.state)return B;let d=v.state;return d.window&&(d.window=null),v.state=null,u},v.exports.inflateGetHeader=(v,d)=>{if(!v||!v.state)return B;const Q=v.state;return 0===(2&Q.wrap)?B:(Q.head=d,d.done=!1,u)},v.exports.inflateSetDictionary=(v,d)=>{const Q=d.length;let T,L,e;return v&&v.state?(T=v.state,0!==T.wrap&&11!==T.mode?B:11===T.mode&&(L=1,L=n(L,d,Q,0),L!==T.check)?X:(e=D(v,d,Q,Q),e?(T.mode=31,m):(T.havedict=1,u))):B},v.exports.inflateInfo="pako inflate (from Nodeca project)"},12371:v=>{"use strict";const d=15,Q=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),T=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),L=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);v.exports=(v,e,F,r,C,u,y,z)=>{const B=z.bits;let X,m,V,h,S,A,f=0,P=0,O=0,J=0,K=0,o=0,g=0,R=0,M=0,Y=0,D=null,i=0;const Z=new Uint16Array(16),j=new Uint16Array(16);let x,k,t,p=null,W=0;for(f=0;f<=d;f++)Z[f]=0;for(P=0;P<r;P++)Z[e[F+P]]++;for(K=B,J=d;J>=1&&0===Z[J];J--);if(K>J&&(K=J),0===J)return C[u++]=20971520,C[u++]=20971520,z.bits=1,0;for(O=1;O<J&&0===Z[O];O++);for(K<O&&(K=O),R=1,f=1;f<=d;f++)if(R<<=1,R-=Z[f],R<0)return-1;if(R>0&&(0===v||1!==J))return-1;for(j[1]=0,f=1;f<d;f++)j[f+1]=j[f]+Z[f];for(P=0;P<r;P++)0!==e[F+P]&&(y[j[e[F+P]]++]=P);if(0===v?(D=p=y,A=19):1===v?(D=Q,i-=257,p=n,W-=257,A=256):(D=T,p=L,A=-1),Y=0,P=0,f=O,S=u,o=K,g=0,V=-1,M=1<<K,h=M-1,1===v&&M>852||2===v&&M>592)return 1;for(;;){x=f-g,y[P]<A?(k=0,t=y[P]):y[P]>A?(k=p[W+y[P]],t=D[i+y[P]]):(k=96,t=0),X=1<<f-g,m=1<<o,O=m;do{m-=X,C[S+(Y>>g)+m]=x<<24|k<<16|t}while(0!==m);for(X=1<<f-1;Y&X;)X>>=1;if(0!==X?(Y&=X-1,Y+=X):Y=0,P++,0===--Z[f]){if(f===J)break;f=e[F+y[P]]}if(f>K&&(Y&h)!==V){for(0===g&&(g=K),S+=O,o=f-g,R=1<<o;o+g<J&&(R-=Z[o+g],!(R<=0));)o++,R<<=1;if(M+=1<<o,1===v&&M>852||2===v&&M>592)return 1;V=Y&h,C[V]=K<<24|o<<16|S-u}}return 0!==Y&&(C[S+Y]=f-g<<24|64<<16),z.bits=K,0}},12326:v=>{"use strict";v.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12311:v=>{"use strict";function d(v){let d=v.length;for(;--d>=0;)v[d]=0}const Q=256,n=286,T=30,L=15,e=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),F=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new Array(576);d(u);const y=new Array(60);d(y);const z=new Array(512);d(z);const B=new Array(256);d(B);const X=new Array(29);d(X);const m=new Array(T);function V(v,d,Q,n,T){this.static_tree=v,this.extra_bits=d,this.extra_base=Q,this.elems=n,this.max_length=T,this.has_stree=v&&v.length}let h,S,A;function f(v,d){this.dyn_tree=v,this.max_code=0,this.stat_desc=d}d(m);const P=v=>v<256?z[v]:z[256+(v>>>7)],O=(v,d)=>{v.pending_buf[v.pending++]=255&d,v.pending_buf[v.pending++]=d>>>8&255},J=(v,d,Q)=>{v.bi_valid>16-Q?(v.bi_buf|=d<<v.bi_valid&65535,O(v,v.bi_buf),v.bi_buf=d>>16-v.bi_valid,v.bi_valid+=Q-16):(v.bi_buf|=d<<v.bi_valid&65535,v.bi_valid+=Q)},K=(v,d,Q)=>{J(v,Q[2*d],Q[2*d+1])},o=(v,d)=>{let Q=0;do{Q|=1&v,v>>>=1,Q<<=1}while(--d>0);return Q>>>1},g=(v,d,Q)=>{const n=new Array(16);let T,e,F=0;for(T=1;T<=L;T++)n[T]=F=F+Q[T-1]<<1;for(e=0;e<=d;e++){let d=v[2*e+1];0!==d&&(v[2*e]=o(n[d]++,d))}},R=v=>{let d;for(d=0;d<n;d++)v.dyn_ltree[2*d]=0;for(d=0;d<T;d++)v.dyn_dtree[2*d]=0;for(d=0;d<19;d++)v.bl_tree[2*d]=0;v.dyn_ltree[512]=1,v.opt_len=v.static_len=0,v.last_lit=v.matches=0},M=v=>{v.bi_valid>8?O(v,v.bi_buf):v.bi_valid>0&&(v.pending_buf[v.pending++]=v.bi_buf),v.bi_buf=0,v.bi_valid=0},Y=(v,d,Q,n)=>{const T=2*d,L=2*Q;return v[T]<v[L]||v[T]===v[L]&&n[d]<=n[Q]},D=(v,d,Q)=>{const n=v.heap[Q];let T=Q<<1;for(;T<=v.heap_len&&(T<v.heap_len&&Y(d,v.heap[T+1],v.heap[T],v.depth)&&T++,!Y(d,n,v.heap[T],v.depth));)v.heap[Q]=v.heap[T],Q=T,T<<=1;v.heap[Q]=n},i=(v,d,n)=>{let T,L,r,C,u=0;if(0!==v.last_lit)do{T=v.pending_buf[v.d_buf+2*u]<<8|v.pending_buf[v.d_buf+2*u+1],L=v.pending_buf[v.l_buf+u],u++,0===T?K(v,L,d):(r=B[L],K(v,r+Q+1,d),C=e[r],0!==C&&(L-=X[r],J(v,L,C)),T--,r=P(T),K(v,r,n),C=F[r],0!==C&&(T-=m[r],J(v,T,C)))}while(u<v.last_lit);K(v,256,d)},Z=(v,d)=>{const Q=d.dyn_tree,n=d.stat_desc.static_tree,T=d.stat_desc.has_stree,e=d.stat_desc.elems;let F,r,C,u=-1;for(v.heap_len=0,v.heap_max=573,F=0;F<e;F++)0!==Q[2*F]?(v.heap[++v.heap_len]=u=F,v.depth[F]=0):Q[2*F+1]=0;for(;v.heap_len<2;)C=v.heap[++v.heap_len]=u<2?++u:0,Q[2*C]=1,v.depth[C]=0,v.opt_len--,T&&(v.static_len-=n[2*C+1]);for(d.max_code=u,F=v.heap_len>>1;F>=1;F--)D(v,Q,F);C=e;do{F=v.heap[1],v.heap[1]=v.heap[v.heap_len--],D(v,Q,1),r=v.heap[1],v.heap[--v.heap_max]=F,v.heap[--v.heap_max]=r,Q[2*C]=Q[2*F]+Q[2*r],v.depth[C]=(v.depth[F]>=v.depth[r]?v.depth[F]:v.depth[r])+1,Q[2*F+1]=Q[2*r+1]=C,v.heap[1]=C++,D(v,Q,1)}while(v.heap_len>=2);v.heap[--v.heap_max]=v.heap[1],((v,d)=>{const Q=d.dyn_tree,n=d.max_code,T=d.stat_desc.static_tree,e=d.stat_desc.has_stree,F=d.stat_desc.extra_bits,r=d.stat_desc.extra_base,C=d.stat_desc.max_length;let u,y,z,B,X,m,V=0;for(B=0;B<=L;B++)v.bl_count[B]=0;for(Q[2*v.heap[v.heap_max]+1]=0,u=v.heap_max+1;u<573;u++)y=v.heap[u],B=Q[2*Q[2*y+1]+1]+1,B>C&&(B=C,V++),Q[2*y+1]=B,y>n||(v.bl_count[B]++,X=0,y>=r&&(X=F[y-r]),m=Q[2*y],v.opt_len+=m*(B+X),e&&(v.static_len+=m*(T[2*y+1]+X)));if(0!==V){do{for(B=C-1;0===v.bl_count[B];)B--;v.bl_count[B]--,v.bl_count[B+1]+=2,v.bl_count[C]--,V-=2}while(V>0);for(B=C;0!==B;B--)for(y=v.bl_count[B];0!==y;)z=v.heap[--u],z>n||(Q[2*z+1]!==B&&(v.opt_len+=(B-Q[2*z+1])*Q[2*z],Q[2*z+1]=B),y--)}})(v,d),g(Q,u,v.bl_count)},j=(v,d,Q)=>{let n,T,L=-1,e=d[1],F=0,r=7,C=4;for(0===e&&(r=138,C=3),d[2*(Q+1)+1]=65535,n=0;n<=Q;n++)T=e,e=d[2*(n+1)+1],++F<r&&T===e||(F<C?v.bl_tree[2*T]+=F:0!==T?(T!==L&&v.bl_tree[2*T]++,v.bl_tree[32]++):F<=10?v.bl_tree[34]++:v.bl_tree[36]++,F=0,L=T,0===e?(r=138,C=3):T===e?(r=6,C=3):(r=7,C=4))},x=(v,d,Q)=>{let n,T,L=-1,e=d[1],F=0,r=7,C=4;for(0===e&&(r=138,C=3),n=0;n<=Q;n++)if(T=e,e=d[2*(n+1)+1],!(++F<r&&T===e)){if(F<C)do{K(v,T,v.bl_tree)}while(0!==--F);else 0!==T?(T!==L&&(K(v,T,v.bl_tree),F--),K(v,16,v.bl_tree),J(v,F-3,2)):F<=10?(K(v,17,v.bl_tree),J(v,F-3,3)):(K(v,18,v.bl_tree),J(v,F-11,7));F=0,L=T,0===e?(r=138,C=3):T===e?(r=6,C=3):(r=7,C=4)}};let k=!1;const t=(v,d,Q,n)=>{J(v,0+(n?1:0),3),((v,d,Q,n)=>{M(v),n&&(O(v,Q),O(v,~Q)),v.pending_buf.set(v.window.subarray(d,d+Q),v.pending),v.pending+=Q})(v,d,Q,!0)};v.exports._tr_init=v=>{k||((()=>{let v,d,Q,C,f;const P=new Array(16);for(Q=0,C=0;C<28;C++)for(X[C]=Q,v=0;v<1<<e[C];v++)B[Q++]=C;for(B[Q-1]=C,f=0,C=0;C<16;C++)for(m[C]=f,v=0;v<1<<F[C];v++)z[f++]=C;for(f>>=7;C<T;C++)for(m[C]=f<<7,v=0;v<1<<F[C]-7;v++)z[256+f++]=C;for(d=0;d<=L;d++)P[d]=0;for(v=0;v<=143;)u[2*v+1]=8,v++,P[8]++;for(;v<=255;)u[2*v+1]=9,v++,P[9]++;for(;v<=279;)u[2*v+1]=7,v++,P[7]++;for(;v<=287;)u[2*v+1]=8,v++,P[8]++;for(g(u,287,P),v=0;v<T;v++)y[2*v+1]=5,y[2*v]=o(v,5);h=new V(u,e,257,n,L),S=new V(y,F,0,T,L),A=new V(new Array(0),r,0,19,7)})(),k=!0),v.l_desc=new f(v.dyn_ltree,h),v.d_desc=new f(v.dyn_dtree,S),v.bl_desc=new f(v.bl_tree,A),v.bi_buf=0,v.bi_valid=0,R(v)},v.exports._tr_stored_block=t,v.exports._tr_flush_block=(v,d,n,T)=>{let L,e,F=0;v.level>0?(2===v.strm.data_type&&(v.strm.data_type=(v=>{let d,n=4093624447;for(d=0;d<=31;d++,n>>>=1)if(1&n&&0!==v.dyn_ltree[2*d])return 0;if(0!==v.dyn_ltree[18]||0!==v.dyn_ltree[20]||0!==v.dyn_ltree[26])return 1;for(d=32;d<Q;d++)if(0!==v.dyn_ltree[2*d])return 1;return 0})(v)),Z(v,v.l_desc),Z(v,v.d_desc),F=(v=>{let d;for(j(v,v.dyn_ltree,v.l_desc.max_code),j(v,v.dyn_dtree,v.d_desc.max_code),Z(v,v.bl_desc),d=18;d>=3&&0===v.bl_tree[2*C[d]+1];d--);return v.opt_len+=3*(d+1)+5+5+4,d})(v),L=v.opt_len+3+7>>>3,e=v.static_len+3+7>>>3,e<=L&&(L=e)):L=e=n+5,n+4<=L&&-1!==d?t(v,d,n,T):4===v.strategy||e===L?(J(v,2+(T?1:0),3),i(v,u,y)):(J(v,4+(T?1:0),3),((v,d,Q,n)=>{let T;for(J(v,d-257,5),J(v,Q-1,5),J(v,n-4,4),T=0;T<n;T++)J(v,v.bl_tree[2*C[T]+1],3);x(v,v.dyn_ltree,d-1),x(v,v.dyn_dtree,Q-1)})(v,v.l_desc.max_code+1,v.d_desc.max_code+1,F+1),i(v,v.dyn_ltree,v.dyn_dtree)),R(v),T&&M(v)},v.exports._tr_tally=(v,d,n)=>(v.pending_buf[v.d_buf+2*v.last_lit]=d>>>8&255,v.pending_buf[v.d_buf+2*v.last_lit+1]=255&d,v.pending_buf[v.l_buf+v.last_lit]=255&n,v.last_lit++,0===d?v.dyn_ltree[2*n]++:(v.matches++,d--,v.dyn_ltree[2*(B[n]+Q+1)]++,v.dyn_dtree[2*P(d)]++),v.last_lit===v.lit_bufsize-1),v.exports._tr_align=v=>{J(v,2,3),K(v,256,u),(v=>{16===v.bi_valid?(O(v,v.bi_buf),v.bi_buf=0,v.bi_valid=0):v.bi_valid>=8&&(v.pending_buf[v.pending++]=255&v.bi_buf,v.bi_buf>>=8,v.bi_valid-=8)})(v)}},12346:v=>{"use strict";v.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12265:v=>{function d(v,d,Q){for(var n=v.length,T=-1/0,L=1/0,e=0;e<n;e++){var F=(Q[0][e]-v[e])/d[e],r=(Q[1][e]-v[e])/d[e];if(F>r){var C=F;F=r,r=C}if(r<T||F>L)return 1/0;F>T&&(T=F),r<L&&(L=r)}return T>L?1/0:T}v.exports=function(v,Q,n,T){var L=d(Q,n,T);if(L===1/0)v=null;else{v=v||[];for(var e=0;e<Q.length;e++)v[e]=Q[e]+n[e]*L}return v},v.exports.distance=d},13185:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>e});var n=Q(21);const T=n.useLayoutEffect;const L=function(v){var d=(0,n.useRef)(v);return T((function(){d.current=v})),d};var e=function(v){var d=L(v);(0,n.pd)((function(){var v=function(v){var Q;if(null!=d.current&&(Q=d.current(v)),v.defaultPrevented&&(v.returnValue=""),"string"===typeof Q)return v.returnValue=Q,Q};return window.addEventListener("beforeunload",v),function(){window.removeEventListener("beforeunload",v)}}),[])}},13137:(v,d,Q)=>{"use strict";var n=Q(13144),T=Array.prototype.concat,L=Array.prototype.slice,e=v.exports=function(v){for(var d=[],Q=0,e=v.length;Q<e;Q++){var F=v[Q];n(F)?d=T.call(d,L.call(F)):d.push(F)}return d};e.wrap=function(v){return function(){return v(e(arguments))}}},13144:v=>{v.exports=function(v){return!(!v||"string"===typeof v)&&(v instanceof Array||Array.isArray(v)||v.length>=0&&(v.splice instanceof Function||Object.getOwnPropertyDescriptor(v,v.length-1)&&"String"!==v.constructor.name))}},12277:(v,d,Q)=>{var n=Q(12280);function T(v){for(var d,Q,T=0,L=v.length,e=0;e<v.length;){for(d=v[e],Q=0;e<L&&v[e]===d;)++e,++Q;T+=n.log2(Q)/7|0,T+=n.log2(d>>>0)/7|0,T+=2}return T}d.size=T,d.encode=function(v,d){d||(d=new Uint8Array(T(v)));for(var Q,n,L=0,e=d.length,F=0;F<v.length;){for(Q=v[F],n=0;F<v.length&&v[F]===Q;)++F,++n;for(;L<e&&n>=128;)d[L++]=128+(127&n),n>>>=7;if(L>=e)throw new Error("RLE buffer overflow");for(d[L++]=n,Q>>>=0;L<e&&Q>=128;)d[L++]=128+(127&Q),Q>>>=7;if(L>=e)throw new Error("RLE buffer overflow");d[L++]=Q}return d},d.decode=function(v,d){for(var Q,n,T,L,e=d.length,F=v.length,r=0,C=0;C<F;){for(Q=0,n=0;C<F&&v[C]>=128;)Q+=(127&v[C++])<<n,n+=7;if(Q+=v[C++]<<n,C>=F)throw new Error("RLE buffer underrun");if(r+Q>e)throw new Error("Chunk buffer overflow");for(T=0,n=0;C<F&&v[C]>=128;)T+=(127&v[C++])<<n,n+=7;if(C>=F)throw new Error("RLE buffer underrun");for(T+=v[C++]<<n,L=0;L<Q;++L)d[r++]=T}return d}},12280:(v,d)=>{"use strict";function Q(v){var d=32;return(v&=-v)&&d--,65535&v&&(d-=16),16711935&v&&(d-=8),252645135&v&&(d-=4),858993459&v&&(d-=2),1431655765&v&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(v){return(v>0)-(v<0)},d.abs=function(v){var d=v>>31;return(v^d)-d},d.min=function(v,d){return d^(v^d)&-(v<d)},d.max=function(v,d){return v^(v^d)&-(v<d)},d.isPow2=function(v){return!(v&v-1)&&!!v},d.log2=function(v){var d,Q;return d=(v>65535)<<4,d|=Q=((v>>>=d)>255)<<3,d|=Q=((v>>>=Q)>15)<<2,(d|=Q=((v>>>=Q)>3)<<1)|(v>>>=Q)>>1},d.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},d.popCount=function(v){return 16843009*((v=(858993459&(v-=v>>>1&1431655765))+(v>>>2&858993459))+(v>>>4)&252645135)>>>24},d.countTrailingZeros=Q,d.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1},d.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)-(v>>>1)},d.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,27030>>>(v&=15)&1};var n=new Array(256);!function(v){for(var d=0;d<256;++d){var Q=d,n=d,T=7;for(Q>>>=1;Q;Q>>>=1)n<<=1,n|=1&Q,--T;v[d]=n<<T&255}}(n),d.reverse=function(v){return n[255&v]<<24|n[v>>>8&255]<<16|n[v>>>16&255]<<8|n[v>>>24&255]},d.interleave2=function(v,d){return(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(v,d){return(v=65535&((v=16711935&((v=252645135&((v=858993459&((v=v>>>d&1431655765)|v>>>1))|v>>>2))|v>>>4))|v>>>16))<<16>>16},d.interleave3=function(v,d,Q){return v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2),(v|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<2},d.deinterleave3=function(v,d){return(v=1023&((v=4278190335&((v=251719695&((v=3272356035&((v=v>>>d&1227133513)|v>>>2))|v>>>4))|v>>>8))|v>>>16))<<22>>22},d.nextCombination=function(v){var d=v|v-1;return d+1|(~d&-~d)-1>>>Q(v)+1}},13265:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>y});var n=Q(884),T=Q(128);class L{constructor(v,d,Q,L,e,F,r){this.nf=new n(v.base,v.qf),this.mass=d,this.friction=Q,this.restitution=L,this.Zd=e,this.Be=F,this.ae=!!r,this.$i=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.bi=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.rf=T.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=T.create(),this._impulses=T.create(),this._sleepFrameCount=10}loadFromCopy(v){T.i(this.nf.base,v.nf.base),T.i(this.nf.qf,v.nf.qf),T.i(this.nf.max,v.nf.max),this.nf.mag=v.nf.mag,this.mass=v.mass,this.friction=v.friction,this.restitution=v.restitution,this.Zd=v.Zd,this.Be=v.Be,this.ae=v.ae,this.$i=v.$i,this.fluidDrag=v.fluidDrag,this.bi=v.bi,this.preventFallOffEdge=v.preventFallOffEdge,this.rolledBackLastTick=v.rolledBackLastTick,T.i(this.rf,v.rf),T.i(this.resting,v.resting),this.inFluid=v.inFluid,this._ratioInFluid=v._ratioInFluid,T.i(this._forces,v._forces),T.i(this._impulses,v._impulses),this._sleepFrameCount=v._sleepFrameCount}setPosition(v){e(v),T.Wd(v,v,this.nf.base),this.nf.translate(v),this.Th()}pg(){return T.clone(this.nf.base)}applyForce(v){e(v),T.add(this._forces,this._forces,v),this.Th()}applyImpulse(v){e(v),T.add(this._impulses,this._impulses,v),this.Th()}Th(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var e=v=>{};var F=Q(884),r=Q(128),C=Q(887);function u(){this.$i=.1,this.fluidDrag=.4,this.he=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function y(v,d,Q){v=Object.assign(new u,v),this.gravity=v.gravity||[0,-10,0],this.$i=v.$i||.1,this.he=v.he||2,this.fluidDrag=v.fluidDrag||.4,this.minBounceImpulse=v.minBounceImpulse,this.bodies=[],this.sm=v.sm,this.testSolid=d,this.testFluid=Q}y.prototype.af=function(v,d,Q,n,T,e){v=v||new F([0,0,0],[1,1,1]),"undefined"==typeof d&&(d=1),"undefined"==typeof Q&&(Q=1),"undefined"==typeof n&&(n=0),"undefined"==typeof T&&(T=1);var r=new L(v,d,Q,n,T,e);return this.bodies.push(r),r},y.prototype.cf=function(v){var d=this.bodies.indexOf(v);d<0||(this.bodies.splice(d,1),v.nf=v.Be=null)};var z=r.create(),B=r.create(),X=r.create(),m=r.create(),V=r.create(),h=r.create(),S=r.create(),A=new F([0,0,0],[1,1,1]),f=new L(A,1,1,0,1,(()=>{}),!1);function P(v,d,Q){return d=Q,d*=1-(1-v.ratioInFluid)**2}y.prototype.Pj=function(v){v/=1e3;var d=p(0,r.squaredLength(this.gravity));this.bodies.forEach((Q=>function(v,d,Q,n){r.i(V,d.resting),v.sm&&f.loadFromCopy(d);if(d.mass<=0)return r.set(d.rf,0,0,0),r.set(d._forces,0,0,0),void r.set(d._impulses,0,0,0);var T=n||0===d.Zd;if(function(v,d,Q,n){if(d._sleepFrameCount>0)return!1;if(n)return!0;var T=!1,L=.5*Q*Q*d.Zd;return r.scale(t,v.gravity,L),C(v.testSolid,d.nf,t,(function(){return T=!0,!0}),!0),T}(v,d,Q,T))return;d._sleepFrameCount--,function(v,d){var Q=d.nf,n=Math.floor(Q.base[0]),T=Math.floor(Q.base[2]),L=Math.floor(Q.base[1]),e=Math.floor(Q.max[1]);if(!v.testFluid(n,L,T))return d.inFluid=!1,void(d.ratioInFluid=0);var F=1,C=L+1;for(;C<=e&&v.testFluid(n,C,T);)F++,C++;var u=(L+F-Q.base[1])/Q.qf[1];u>1&&(u=1);var y=Q.qf[0]*Q.qf[1]*Q.qf[2]*u,z=J;r.scale(z,v.gravity,-v.he*y*d.Zd),d.applyForce(z),d.inFluid=!0,d.ratioInFluid=u}(v,d),q(d._forces),q(d._impulses),q(d.rf),q(d.resting),r.scale(z,d._forces,1/d.mass),r.sf(z,z,v.gravity,d.Zd),r.scale(B,d._impulses,1/d.mass),r.sf(B,B,z,Q),r.add(d.rf,d.rf,B),d.friction&&(K(v,0,d,B,Q),K(v,1,d,B,Q),K(v,2,d,B,Q));var L=d.fluidDrag>=0?d.fluidDrag:v.fluidDrag,e=d.$i>=0?d.$i:v.$i,F=e,u=e;d.inFluid&&(F=P(d,F,d.fluidDragHoriz>=0?d.fluidDragHoriz:L),u=P(d,u,d.fluidDragVert>=0?d.fluidDragVert:L));F=Math.max(1-F*Q/d.mass,0),u=Math.max(1-u*Q/d.mass,0),r.set(O,F,u,F),r.multiply(d.rf,d.rf,O),r.scale(X,d.rf,Q),r.set(d._forces,0,0,0),r.set(d._impulses,0,0,0),d.ae&&W(R,d.nf);r.i(h,X),r.set(S,0,0,0),d.preventFallOffEdge&&function(v,d,Q,n){if(!d.resting[1]||Q[1]>0)return;var T=j;W(T,d.nf);for(var L=0;L<3;L+=2){r.set(Z,0,0,0),Z[L]=Q[L];var e=!0;(e=(e=(e=(e=e&&!k(v,T.base[0]+Z[0]+1e-5,T.base[1],T.base[2]+Z[2]+1e-5))&&!k(v,T.max[0]+Z[0]-1e-5,T.base[1],T.base[2]+Z[2]+1e-5))&&!k(v,T.base[0]+Z[0]+1e-5,T.base[1],T.max[2]+Z[2]-1e-5))&&!k(v,T.max[0]+Z[0]-1e-5,T.base[1],T.max[2]+Z[2]-1e-5))?(n[L]=Q[L]>0?1:-1,Q[L]=0):0===L&&(r.set(x,Q[0],0,0),g(v,T,x,n,d.slideOnCollision))}}(v,d,X,S);g(v,d.nf,X,d.resting,d.slideOnCollision),d.ae&&function(v,d,Q,n){if(d.resting[1]>=0&&!d.inFluid)return;var T=0!==d.resting[0],L=0!==d.resting[2];if(!T&&!L)return;var e=Math.abs(n[0]/n[2]),F=4;if(!T&&e>F)return;if(!L&&e<1/F)return;r.add(Y,Q.base,n);var u=v.testSolid;C(u,Q,n,(function(v,d,Q,n){if(1!==d)return!0;n[d]=0}));var y=Q.base[1],z=d.inFluid?1.951:1.001,B=Math.floor(y+z)-y;r.set(D,0,B,0);var X=!1;if(C(u,Q,D,(function(v,d,Q,n){return X=!0,!0})),X)return;r.Wd(i,Y,Q.base),i[1]=0,g(v,Q,i,M,!0);var m=p(Q.base[0],Y[0]),V=p(Q.base[2],Y[2]);if(T&&!m&&(!V||!L))return;if(L&&(!m||!T)&&!V)return;var h=!0;if(h=h&&!k(v,Q.base[0]+1e-5,Q.base[1],Q.base[2]+1e-5),h=h&&!k(v,Q.max[0]-1e-5,Q.base[1],Q.base[2]+1e-5),h=h&&!k(v,Q.base[0]+1e-5,Q.base[1],Q.max[2]-1e-5),h=h&&!k(v,Q.max[0]-1e-5,Q.base[1],Q.max[2]-1e-5),h)return;W(d.nf,Q),d.resting[0]=M[0],d.resting[2]=M[2],d.bi&&d.bi()}(v,d,R,h);for(var y=0;y<3;++y)d.resting[y]=d.resting[y]||S[y],m[y]=0,d.resting[y]&&(V[y]||(m[y]=-d.rf[y]),d.rf[y]=0);var A=r.length(m);A>.001&&(r.scale(m,m,d.mass),d.Be&&d.Be(m),d.restitution>0&&A>v.minBounceImpulse&&(r.scale(m,m,d.restitution),d.applyImpulse(m)));var o=r.squaredLength(d.rf);o>1e-5&&d.Th();v.sm&&v.sm(d)?(d.loadFromCopy(f),d.rolledBackLastTick=!0):d.rolledBackLastTick=!1}(this,Q,v,d)))};var O=r.create([0,0,0]);var J=r.create();function K(v,d,Q,n,T){var L=Q.resting[d],e=n[d];if(!Q.alwaysApplyHorizFriction||1!==d){if(0===L)return;if(L*e<=0)return}r.i(o,Q.rf),o[d]=0;var F=r.length(o);if(!p(F,0)){var C=Math.abs(Q.friction*v.gravity[d]*T),u=F>C?(F-C)/F:0;Q.rf[(d+1)%3]*=u,Q.rf[(d+2)%3]*=u}}var o=r.create();function g(v,d,Q,n,T){return r.set(n,0,0,0),C(v.testSolid,d,Q,(function(v,d,Q,L){n[d]=Q,L[d]=0,T||(L[0]=0,L[1]=0,L[2]=0)}))}var R=new F([],[]),M=r.create(),Y=r.create(),D=r.create(),i=r.create();var Z=r.create(),j=new F([],[]),x=r.create();function k(v,d,Q,n){return v.testSolid(Math.floor(d),Math.floor(Q-1),Math.floor(n))}var t=r.create();function p(v,d){return Math.abs(v-d)<1e-5}function W(v,d){for(var Q=0;Q<3;Q++)v.base[Q]=d.base[Q],v.max[Q]=d.max[Q],v.qf[Q]=d.qf[Q]}var q=function(v){}},12293:v=>{"use strict";v.exports=function(v,d,Q,n){var T=self||window;try{try{var L;try{L=new T.Blob([v])}catch(C){(L=new(T.BlobBuilder||T.WebKitBlobBuilder||T.MozBlobBuilder||T.MSBlobBuilder)).append(v),L=L.getBlob()}var e=T.URL||T.webkitURL,F=e.createObjectURL(L),r=new T[d](F,Q);return e.revokeObjectURL(F),r}catch(C){return new T[d]("data:application/javascript,".concat(encodeURIComponent(v)),Q)}}catch(C){if(!n)throw Error("Inline worker is not supported");return new T[d](n,Q)}}},12253:(v,d,Q)=>{"use strict";function n(v,d,Q,n,T){var L={};return Object.keys(n).forEach((function(v){L[v]=n[v]})),L.enumerable=!!L.enumerable,L.configurable=!!L.configurable,("value"in L||L.initializer)&&(L.writable=!0),L=Q.slice().reverse().reduce((function(Q,n){return n(v,d,Q)||Q}),L),T&&void 0!==L.initializer&&(L.value=L.initializer?L.initializer.call(T):void 0,L.initializer=void 0),void 0===L.initializer&&(Object.defineProperty(v,d,L),L=null),L}Q.d(d,{e:()=>n})},12244:(v,d,Q)=>{"use strict";function n(v,d,Q,n){Q&&Object.defineProperty(v,d,{enumerable:Q.enumerable,configurable:Q.configurable,writable:Q.writable,value:Q.initializer?Q.initializer.call(n):void 0})}Q.d(d,{e:()=>n})},13173:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>e,g:()=>y,h:()=>F,j:()=>L,m:()=>r,p:()=>T,t:()=>C,v:()=>u});var n=Q(2017);class T{constructor(){this._easingMode=T.EASINGMODE_EASEIN}setEasingMode(v){const d=Math.min(Math.max(v,0),2);this._easingMode=d}getEasingMode(){return this._easingMode}easeInCore(v){throw new Error("You must implement this method")}ease(v){switch(this._easingMode){case T.EASINGMODE_EASEIN:return this.easeInCore(v);case T.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-v)}return v>=.5?.5*(1-this.easeInCore(2*(1-v)))+.5:.5*this.easeInCore(2*v)}}T.EASINGMODE_EASEIN=0,T.EASINGMODE_EASEOUT=1,T.EASINGMODE_EASEINOUT=2;class L extends T{easeInCore(v){return v=Math.max(0,Math.min(1,v)),1-Math.sqrt(1-v*v)}}class e extends T{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=v}easeInCore(v){const d=Math.max(0,this.amplitude);return Math.pow(v,3)-v*d*Math.sin(3.141592653589793*v)}}class F extends T{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=v,this.bounciness=d}easeInCore(v){const d=Math.max(0,this.bounces);let Q=this.bounciness;Q<=1&&(Q=1.001);const n=Math.pow(Q,d),T=1-Q,L=(1-n)/T+.5*n,e=v*L,F=Math.log(-e*(1-Q)+1)/Math.log(Q),r=Math.floor(F),C=r+1,u=(1-Math.pow(Q,r))/(T*L),y=.5*(u+(1-Math.pow(Q,C))/(T*L)),z=v-y,B=y-u;return-Math.pow(1/Q,d-r)/(B*B)*(z-B)*(z+B)}}class r extends T{easeInCore(v){return v*v*v}}class C extends T{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=v,this.springiness=d}easeInCore(v){let d;const Q=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return d=0==n?v:(Math.exp(n*v)-1)/(Math.exp(n)-1),d*Math.sin((6.283185307179586*Q+1.5707963267948966)*v)}}class u extends T{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=v}easeInCore(v){return this.exponent<=0?v:(Math.exp(this.exponent*v)-1)/(Math.exp(this.exponent)-1)}}class y extends T{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=v,this.y1=d,this.x2=Q,this.y2=n}easeInCore(v){return n.d.Interpolate(v,this.x1,this.y1,this.x2,this.y2)}}},12843:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>e});var n=Q(651),T=Q(660),L=Q(669);class e extends L.d{get _matrix(){return this._compose(),this.Ok}set _matrix(v){(v.updateFlag!==this.Ok.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Ok.p(v),this._markAsDirtyAndDecompose())}constructor(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(v,d.va(),!1),this.name=v,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=d,this.Ok=(null===T||void 0===T?void 0:T.clone())??n.b.Identity(),this._restMatrix=L??this.Ok.clone(),this._bindMatrix=e??this.Ok.clone(),this._index=F,this._absoluteMatrix=new n.b,this._absoluteBindMatrix=new n.b,this._absoluteInverseBindMatrix=new n.b,this._finalMatrix=new n.b,d.bones.push(this),this.setParent(Q,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(v){this.setParent(v)}setParent(v){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==v){if(this.parent){const v=this.parent.children.indexOf(this);-1!==v&&this.parent.children.splice(v,1)}this._parentNode=v,this.parent&&this.parent.children.push(this),d&&this._updateAbsoluteBindMatrices(),this.bk()}}getLocalMatrix(){return this._compose(),this.Ok}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(v){this._restMatrix.p(v)}setRestPose(v){this.setRestMatrix(v)}getBindPose(){return this.getBindMatrix()}setBindMatrix(v){this.tk(v)}setBindPose(v){this.setBindMatrix(v)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const v=n.g.fk[0],d=n.g.Quaternion[0],Q=n.g.fk[1];this.getRestMatrix().decompose(v,d,Q),this._linkedTransformNode.position.p(Q),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??n.c.Identity(),this._linkedTransformNode.rotationQuaternion.p(d),this._linkedTransformNode.md.p(v)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(v){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=v,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.jd}set position(v){this._decompose(),this.jd.p(v),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(v){this.setRotation(v)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(v){this.setRotationQuaternion(v)}get md(){return this.getScale()}set md(v){this.setScale(v)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=n.j.Zero(),this._localRotation=n.c.Zero(),this.jd=n.j.Zero()),this.Ok.decompose(this._localScaling,this._localRotation,this.jd))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,n.b.ComposeToRef(this._localScaling,this._localRotation,this.jd,this.Ok)):this._needToCompose=!1)}tk(v){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(v),d&&this._updateAbsoluteBindMatrices(),Q?this._matrix=v:this.bk()}_updateAbsoluteBindMatrices(v){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(v||(v=this._bindMatrix),this.parent?v.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(v),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),d)for(let Q=0;Q<this.children.length;Q++)this.children[Q]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}bk(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.bk(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.bk(),this._needToDecompose=!0}_updatePosition(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=this.getLocalMatrix();if(0==d)T?(L.addAtIndex(12,v.x),L.addAtIndex(13,v.y),L.addAtIndex(14,v.z)):L.setTranslationFromFloats(v.x,v.y,v.z);else{let d=null;Q&&(d=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const F=e._TmpMats[0],r=e._TmpVecs[0];this.parent?Q&&d?(F.p(this.parent.getAbsoluteMatrix()),F.multiplyToRef(d,F)):F.p(this.parent.getAbsoluteMatrix()):n.b.IdentityToRef(F),T&&F.setTranslationFromFloats(0,0,0),F.invert(),n.j.TransformCoordinatesToRef(v,F,r),T?(L.addAtIndex(12,r.x),L.addAtIndex(13,r.y),L.addAtIndex(14,r.z)):L.setTranslationFromFloats(r.x,r.y,r.z)}this._markAsDirtyAndDecompose()}translate(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(v,d,Q,!0)}setPosition(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(v,d,Q,!1)}setAbsolutePosition(v,d){this.setPosition(v,1,d)}scale(v,d,Q){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=this.getLocalMatrix(),F=e._TmpMats[0];n.b.ScalingToRef(v,d,Q,F),F.multiplyToRef(L,L),F.invert();for(const n of this.children){const T=n.getLocalMatrix();T.multiplyToRef(F,T),T.multiplyAtIndex(12,v),T.multiplyAtIndex(13,d),T.multiplyAtIndex(14,Q),n._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),T)for(const n of this.children)n.scale(v,d,Q,T)}setScale(v){this._decompose(),this._localScaling.p(v),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(v){this._decompose(),v.p(this._localScaling)}setYawPitchRoll(v,d,Q){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4?arguments[4]:void 0;if(0===T){const F=e._TmpQuat;return n.c.RotationYawPitchRollToRef(v,d,Q,F),void this.setRotationQuaternion(F,T,L)}const F=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,L))return;const r=e._TmpMats[1];n.b.RotationYawPitchRollToRef(v,d,Q,r),F.multiplyToRef(r,r),this._rotateWithMatrix(r,T,L)}rotate(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3?arguments[3]:void 0;const L=e._TmpMats[0];L.setTranslationFromFloats(0,0,0),n.b.RotationAxisToRef(v,d,L),this._rotateWithMatrix(L,Q,T)}setAxisAngle(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3?arguments[3]:void 0;if(0===Q){const L=e._TmpQuat;return n.c.RotationAxisToRef(v,d,L),void this.setRotationQuaternion(L,Q,T)}const L=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,T))return;const F=e._TmpMats[1];n.b.RotationAxisToRef(v,d,F),L.multiplyToRef(F,F),this._rotateWithMatrix(F,Q,T)}setRotation(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(v.y,v.x,v.z,d,Q)}setRotationQuaternion(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===d)return this._decompose(),this._localRotation.p(v),void this._markAsDirtyAndCompose();const T=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(T,Q))return;const L=e._TmpMats[1];n.b.FromQuaternionToRef(v,L),T.multiplyToRef(L,L),this._rotateWithMatrix(L,d,Q)}setRotationMatrix(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===d){const T=e._TmpQuat;return n.c.FromRotationMatrixToRef(v,T),void this.setRotationQuaternion(T,d,Q)}const T=e._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(T,Q))return;const L=e._TmpMats[1];L.p(v),T.multiplyToRef(v,L),this._rotateWithMatrix(L,d,Q)}_rotateWithMatrix(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const n=this.getLocalMatrix(),T=n.m[12],L=n.m[13],F=n.m[14],r=this.getParent(),C=e._TmpMats[3],u=e._TmpMats[4];r&&1==d?(Q?(C.p(Q.getWorldMatrix()),r.getAbsoluteMatrix().multiplyToRef(C,C)):C.p(r.getAbsoluteMatrix()),u.p(C),u.invert(),n.multiplyToRef(C,n),n.multiplyToRef(v,n),n.multiplyToRef(u,n)):1==d&&Q?(C.p(Q.getWorldMatrix()),u.p(C),u.invert(),n.multiplyToRef(C,n),n.multiplyToRef(v,n),n.multiplyToRef(u,n)):n.multiplyToRef(v,n),n.setTranslationFromFloats(T,L,F),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(v,d){const Q=e._TmpMats[2];return v.p(this.getAbsoluteMatrix()),d?(v.multiplyToRef(d.getWorldMatrix(),v),n.b.ScalingToRef(d.md.x,d.md.y,d.md.z,Q)):n.b.IdentityToRef(Q),v.invert(),!isNaN(v.m[0])&&(Q.multiplyAtIndex(0,this._scalingDeterminant),v.multiplyToRef(Q,v),!0)}pg(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=n.j.Zero();return this.getPositionToRef(v,d,Q),Q}getPositionToRef(){let v=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const v=this.getLocalMatrix();d.x=v.m[12],d.y=v.m[13],d.z=v.m[14]}else{let Q=null;v&&(Q=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let n=e._TmpMats[0];v&&Q?(n.p(this.getAbsoluteMatrix()),n.multiplyToRef(Q,n)):n=this.getAbsoluteMatrix(),d.x=n.m[12],d.y=n.m[13],d.z=n.m[14]}}getAbsolutePosition(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=n.j.Zero();return this.getPositionToRef(1,v,d),d}getAbsolutePositionToRef(v,d){this.getPositionToRef(1,v,d)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Ok.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Ok);const v=this._skeleton.getPoseMatrix();v&&this._absoluteMatrix.multiplyToRef(v,this._absoluteMatrix)}const v=this.children,d=v.length;for(let Q=0;Q<d;Q++)v[Q].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}zg(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=n.j.Zero();return this.getDirectionToRef(v,d,Q),Q}getDirectionToRef(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,T=null;d&&(T=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=e._TmpMats[0];L.p(this.getAbsoluteMatrix()),d&&T&&L.multiplyToRef(T,L),n.j.TransformNormalToRef(v,L,Q),Q.normalize()}getRotation(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=n.j.Zero();return this.getRotationToRef(v,d,Q),Q}getRotationToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;const n=e._TmpQuat;this.getRotationQuaternionToRef(v,d,n),n.toEulerAnglesToRef(Q)}getRotationQuaternion(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=n.c.Identity();return this.getRotationQuaternionToRef(v,d,Q),Q}getRotationQuaternionToRef(){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),d.p(this._localRotation);else{const Q=e._TmpMats[0],n=this.getAbsoluteMatrix();v?n.multiplyToRef(v.getWorldMatrix(),Q):Q.p(n),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.decompose(void 0,d,void 0)}}getRotationMatrix(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1?arguments[1]:void 0;const Q=n.b.Identity();return this.getRotationMatrixToRef(v,d,Q),Q}getRotationMatrixToRef(){let v=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(d);else{const Q=e._TmpMats[0],n=this.getAbsoluteMatrix();v?n.multiplyToRef(v.getWorldMatrix(),Q):Q.p(n),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.getRotationMatrixToRef(d)}}getAbsolutePositionFromLocal(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=n.j.Zero();return this.getAbsolutePositionFromLocalToRef(v,d,Q),Q}getAbsolutePositionFromLocalToRef(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,T=null;d&&(T=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=e._TmpMats[0];L.p(this.getAbsoluteMatrix()),d&&T&&L.multiplyToRef(T,L),n.j.TransformCoordinatesToRef(v,L,Q)}getLocalPositionFromAbsolute(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=n.j.Zero();return this.getLocalPositionFromAbsoluteToRef(v,d,Q),Q}getLocalPositionFromAbsoluteToRef(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,T=null;d&&(T=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=e._TmpMats[0];L.p(this.getAbsoluteMatrix()),d&&T&&L.multiplyToRef(T,L),L.invert(),n.j.TransformCoordinatesToRef(v,L,Q)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const v=this._skeleton.bones.indexOf(this);if(-1!==v&&this._skeleton.bones.splice(v,1),this._parentNode&&this._parentNode.children){const v=this._parentNode.children,d=v.indexOf(this);-1!==d&&v.splice(d,1)}super.dispose()}}e._TmpVecs=(0,T.d)(2,n.j.Zero),e._TmpQuat=n.c.Identity(),e._TmpMats=(0,T.d)(5,n.b.Identity)},13171:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>Z});var n=Q(620),T=Q(629),L=Q(473),e=Q(651),F=Q(664),r=Q(669),C=Q(470),u=Q(2200),y=Q(488),z=Q(658);class B{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(v){this._zoomStopsAnimation=v}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(v){this._idleRotationSpeed=v}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(v){this._idleRotationWaitTime=v}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(v){this._idleRotationSpinupTime=v}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(v){this._attachedCamera=v;const d=this._attachedCamera.va();this._onPrePointerObservableObserver=d.onPrePointerObservable.add((v=>{v.type!==u.e.POINTERDOWN?v.type===u.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const v=y.b.Now;let d=0;null!=this._lastFrameTime&&(d=v-this._lastFrameTime),this._lastFrameTime=v,this._applyUserInteraction();const Q=v-this._lastInteractionTime-this._idleRotationWaitTime,n=Math.max(Math.min(Q/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*n,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(d/1e3))}))}detach(){if(!this._attachedCamera)return;const v=this._attachedCamera.va();this._onPrePointerObservableObserver&&v.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(v){this._lastInteractionTime=v??y.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<z.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let v=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(v=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?v:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=y.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var X=Q(13173),m=Q(12002);class V{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(v){if(this._autoTransitionRange===v)return;this._autoTransitionRange=v;const d=this._attachedCamera;d&&(v?this._onMeshTargetChangedObserver=d.onMeshTargetChangedObservable.add((v=>{if(v&&(v.ck(!0),v.getBoundingInfo)){const d=v.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*d,this.upperRadiusTransitionRange=.05*d}})):this._onMeshTargetChangedObserver&&d.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(v){this._attachedCamera=v,this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(v){return!!this._attachedCamera&&(this._attachedCamera.radius===v&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(v){if(!this._attachedCamera)return;this._radiusBounceTransition||(V.EasingFunction.setEasingMode(V.EasingMode),this._radiusBounceTransition=m.d.CreateAnimation("radius",m.d.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const d=m.d.TransitionTo("radius",this._attachedCamera.radius+v,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));d&&this._animatables.push(d)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}V.EasingFunction=new X.d(.3),V.EasingMode=X.p.EASINGMODE_EASEOUT;class h{constructor(){this.onTargetFramingAnimationEndObservable=new L.e,this._mode=h.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(v){this._mode=v}get mode(){return this._mode}set radiusScale(v){this._radiusScale=v}get radiusScale(){return this._radiusScale}set positionScale(v){this._positionScale=v}get positionScale(){return this._positionScale}set defaultElevation(v){this._defaultElevation=v}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(v){this._elevationReturnTime=v}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(v){this._elevationReturnWaitTime=v}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(v){this._zoomStopsAnimation=v}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(v){this._framingTime=v}get framingTime(){return this._framingTime}init(){}attach(v){this._attachedCamera=v;const d=this._attachedCamera.va();h.EasingFunction.setEasingMode(h.EasingMode),this._onPrePointerObservableObserver=d.onPrePointerObservable.add((v=>{v.type!==u.e.POINTERDOWN?v.type===u.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((v=>{v&&v.getBoundingInfo&&this.zoomOnMesh(v,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const v=this._attachedCamera.va();this._onPrePointerObservableObserver&&v.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v.ck(!0);const n=v.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(n.minimumWorld,n.maximumWorld,d,Q)}zoomOnMeshHierarchy(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v.ck(!0);const n=v.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(n.min,n.max,d,Q)}zoomOnMeshesHierarchy(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new e.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),T=new e.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let L=0;L<v.length;L++){const d=v[L].getHierarchyBoundingVectors(!0);e.j.CheckExtends(d.min,n,T),e.j.CheckExtends(d.max,n,T)}this.zoomOnBoundingInfo(n,T,d,Q)}zoomOnBoundingInfo(v,d){let Q,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const L=v.y,F=L+(d.y-L)*this._positionScale,r=d.Wd(v).scale(.5);if(!isFinite(F))return!1;if(n)Q=new e.j(0,F,0);else{const d=v.add(r);Q=new e.j(d.x,F,d.z)}this._vectorTransition||(this._vectorTransition=m.d.CreateAnimation("target",m.d.ANIMATIONTYPE_VECTOR3,60,h.EasingFunction)),this._betaIsAnimating=!0;let C=m.d.TransitionTo("target",Q,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);C&&this._animatables.push(C);let u=0;if(this._mode===h.FitFrustumSidesMode){const Q=this._calculateLowerRadiusFromModelBoundingSphere(v,d);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=r.length()+this._attachedCamera.$j),u=Q}else this._mode===h.IgnoreBoundsSizeMode&&(u=this._calculateLowerRadiusFromModelBoundingSphere(v,d),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.$j));if(this.autoCorrectCameraLimitsAndSensibility){const Q=d.Wd(v).length();this._attachedCamera.panningSensibility=5e3/Q,this._attachedCamera.wheelPrecision=100/u}return this._radiusTransition||(this._radiusTransition=m.d.CreateAnimation("radius",m.d.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),C=m.d.TransitionTo("radius",u,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),T&&T(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),C&&this._animatables.push(C),!0}_calculateLowerRadiusFromModelBoundingSphere(v,d){const Q=this._attachedCamera;if(!Q)return 0;let n=Q._calculateLowerRadiusFromModelBoundingSphere(v,d,this._radiusScale);return Q.lowerRadiusLimit&&this._mode===h.IgnoreBoundsSizeMode&&(n=n<Q.lowerRadiusLimit?Q.lowerRadiusLimit:n),Q.upperRadiusLimit&&(n=n>Q.upperRadiusLimit?Q.upperRadiusLimit:n),n}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const v=y.b.Now-this._lastInteractionTime,d=.5*Math.PI-this._defaultElevation,Q=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Q&&v>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=m.d.CreateAnimation("beta",m.d.ANIMATIONTYPE_FLOAT,60,h.EasingFunction));const v=m.d.TransitionTo("beta",d,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));v&&this._animatables.push(v)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=y.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}h.EasingFunction=new X.v,h.EasingMode=X.p.EASINGMODE_EASEINOUT,h.IgnoreBoundsSizeMode=0,h.FitFrustumSidesMode=1;var S=Q(616),A=Q(11916),f=Q(12837),P=Q(475);class O{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(v){v=P.e.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),Q=d.getInputElement();let n=0,T=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=L=>{var e,F;const r=L.event,C="touch"===r.pointerType;if(L.type!==u.e.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const y=r.target;if(this._altKey=r.altKey,this._ctrlKey=r.ctrlKey,this._metaKey=r.metaKey,this._shiftKey=r.shiftKey,this._buttonsPressed=r.buttons,d.isPointerLock){const v=r.movementX,d=r.movementY;this.onTouch(null,v,d),this._pointA=null,this._pointB=null}else{if(L.type!==u.e.POINTERDOWN&&L.type!==u.e.POINTERDOUBLETAP&&C&&(null===(e=this._pointA)||void 0===e?void 0:e.pointerId)!==r.pointerId&&(null===(F=this._pointB)||void 0===F?void 0:F.pointerId)!==r.pointerId)return;if(L.type!==u.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!C)if(L.type===u.e.POINTERDOUBLETAP)this.onDoubleTap(r.pointerType);else if(L.type!==u.e.POINTERUP||this._currentMousePointerIdDown!==r.pointerId&&!C){if(L.type===u.e.POINTERMOVE)if(v||r.preventDefault(),this._pointA&&null===this._pointB){const v=r.clientX-this._pointA.x,d=r.clientY-this._pointA.y;this._pointA.x=r.clientX,this._pointA.y=r.clientY,this.onTouch(this._pointA,v,d)}else if(this._pointA&&this._pointB){const v=this._pointA.pointerId===r.pointerId?this._pointA:this._pointB;v.x=r.clientX,v.y=r.clientY;const d=this._pointA.x-this._pointB.x,Q=this._pointA.y-this._pointB.y,e=d*d+Q*Q,F={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:r.pointerId,type:L.type};this.onMultiTouch(this._pointA,this._pointB,n,e,T,F),T=F,n=e}}else{try{null===y||void 0===y||y.releasePointerCapture(r.pointerId)}catch(z){}C||(this._pointB=null),d._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==r.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==r.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==n||T)&&(this.onMultiTouch(this._pointA,this._pointB,n,0,T,null),n=0,T=null),this._currentMousePointerIdDown=-1,this.onButtonUp(r),v||r.preventDefault()}else{try{null===y||void 0===y||y.setPointerCapture(r.pointerId)}catch(z){}if(null===this._pointA)this._pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType};else{if(null!==this._pointB)return;this._pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}}-1!==this._currentMousePointerIdDown||C||(this._currentMousePointerIdDown=r.pointerId),this.onButtonDown(r),v||(r.preventDefault(),Q&&Q.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,u.e.POINTERDOWN|u.e.POINTERUP|u.e.POINTERMOVE|u.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,n=0,T=null,this.onLostFocus()},this._contextMenuBind=v=>this.onContextMenu(v),Q&&Q.addEventListener("contextmenu",this._contextMenuBind,!1);const L=this.camera.va().getEngine().getHostWindow();L&&P.e.RegisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}ak(){if(this._onLostFocus){const v=this.camera.va().getEngine().getHostWindow();v&&P.e.UnregisterTopRootEvents(v,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const v=this.camera.va().getEngine().getInputElement();v&&v.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(v){}onTouch(v,d,Q){}onMultiTouch(v,d,Q,n,T,L){}onContextMenu(v){v.preventDefault()}onButtonDown(v){}onButtonUp(v){}onLostFocus(){}}(0,n.b)([(0,T.F)()],O.prototype,"buttons",void 0);class J extends O{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(v,d){if(0!==this.panningSensibility&&v&&d){const Q=d.x-v.x,n=d.y-v.y;this.camera.inertialPanningX+=-Q/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility}}_computePinchZoom(v,d){const Q=this.camera.radius||J.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=Q*Math.sqrt(v)/Math.sqrt(d):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(d-v)*Q*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(d-v)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(v,d,Q){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility):(this.camera.inertialAlphaOffset-=d/this.angularSensibilityX,this.camera.inertialBetaOffset-=Q/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(v,d,Q,n,T,L){0===Q&&null===T||0===n&&null===L||(this.multiTouchPanAndZoom?(this._computePinchZoom(Q,n),this._computeMultiTouchPanning(T,L)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(n)-Math.sqrt(Q))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Q,n),this._isPinching=!0):this._computeMultiTouchPanning(T,L)):this.multiTouchPanning?this._computeMultiTouchPanning(T,L):this.pinchZoom&&this._computePinchZoom(Q,n))}onButtonDown(v){this._isPanClick=v.button===this.camera._panningMouseButton}onButtonUp(v){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}J.MinimumRadiusForPinch=.001,(0,n.b)([(0,T.F)()],J.prototype,"buttons",void 0),(0,n.b)([(0,T.F)()],J.prototype,"angularSensibilityX",void 0),(0,n.b)([(0,T.F)()],J.prototype,"angularSensibilityY",void 0),(0,n.b)([(0,T.F)()],J.prototype,"pinchPrecision",void 0),(0,n.b)([(0,T.F)()],J.prototype,"pinchDeltaPercentage",void 0),(0,n.b)([(0,T.F)()],J.prototype,"useNaturalPinchZoom",void 0),(0,n.b)([(0,T.F)()],J.prototype,"pinchZoom",void 0),(0,n.b)([(0,T.F)()],J.prototype,"panningSensibility",void 0),(0,n.b)([(0,T.F)()],J.prototype,"multiTouchPanning",void 0),(0,n.b)([(0,T.F)()],J.prototype,"multiTouchPanAndZoom",void 0),f.c.ArcRotateCameraPointersInput=J;var K=Q(2204);class o{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(v){v=P.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const Q=d.event;if(!Q.metaKey)if(d.type===K.b.KEYDOWN){if(this._ctrlPressed=Q.ctrlKey,this._altPressed=Q.altKey,-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),Q.preventDefault&&(v||Q.preventDefault())}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){const d=this._keys.indexOf(Q.keyCode);d>=0&&this._keys.splice(d,1),Q.preventDefault&&(v||Q.preventDefault())}})))}ak(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const v=this.camera;for(let d=0;d<this._keys.length;d++){const Q=this._keys[d];-1!==this.keysLeft.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningX-=1/this.panningSensibility:v.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?v.inertialRadiusOffset+=1/this.zoomingSensibility:v.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningX+=1/this.panningSensibility:v.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?v.inertialRadiusOffset-=1/this.zoomingSensibility:v.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Q)&&v.useInputToRestoreState&&v.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,n.b)([(0,T.F)()],o.prototype,"keysUp",void 0),(0,n.b)([(0,T.F)()],o.prototype,"keysDown",void 0),(0,n.b)([(0,T.F)()],o.prototype,"keysLeft",void 0),(0,n.b)([(0,T.F)()],o.prototype,"keysRight",void 0),(0,n.b)([(0,T.F)()],o.prototype,"keysReset",void 0),(0,n.b)([(0,T.F)()],o.prototype,"panningSensibility",void 0),(0,n.b)([(0,T.F)()],o.prototype,"zoomingSensibility",void 0),(0,n.b)([(0,T.F)()],o.prototype,"useAltToZoom",void 0),(0,n.b)([(0,T.F)()],o.prototype,"angularSpeed",void 0),f.c.ArcRotateCameraKeyboardMoveInput=o;var g=Q(702),R=Q(2212);class M{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new e.j(0,0,0),this._globalOffset=new e.j(0,0,0),this._inertialPanning=e.j.Zero()}_computeDeltaFromMouseWheelLegacyEvent(v,d){let Q=0;const n=.01*v*this.wheelDeltaPercentage*d;return Q=v>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage),Q}attachControl(v){v=P.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==u.e.POINTERWHEEL)return;const Q=d.event;let n=0;const T=Q.deltaMode===R.d.DOM_DELTA_LINE?40:1,L=-Q.deltaY*T;if(this.customComputeDeltaFromMouseWheel)n=this.customComputeDeltaFromMouseWheel(L,this,Q);else if(this.wheelDeltaPercentage){if(n=this._computeDeltaFromMouseWheelLegacyEvent(L,this.camera.radius),n>0){let v=this.camera.radius,d=this.camera.inertialRadiusOffset+n;for(let Q=0;Q<20&&!(v<=d)&&!(Math.abs(d*this.camera.inertia)<.001);Q++)v-=d,d*=this.camera.inertia;v=(0,F.Clamp)(v,0,Number.MAX_VALUE),n=this._computeDeltaFromMouseWheelLegacyEvent(L,v)}}else n=L/(40*this.wheelPrecision);n&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(n)):this.camera.inertialRadiusOffset+=n),Q.preventDefault&&(v||Q.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,u.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.gk(0)}ak(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const v=this.camera;0+v.inertialAlphaOffset+v.inertialBetaOffset+v.inertialRadiusOffset&&(this._updateHitPlane(),v.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(v.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const v=this.camera,d=v.target.Wd(v.position);this._hitPlane=g.d.FromPositionAndNormal(v.target,d)}_getPosition(){const v=this.camera,d=v.va(),Q=d.createPickingRay(d.pointerX,d.pointerY,e.b.Identity(),v,!1);0===v.targetScreenOffset.x&&0===v.targetScreenOffset.y||(this._viewOffset.set(v.targetScreenOffset.x,v.targetScreenOffset.y,0),v.getViewMatrix().invertToRef(v._cameraTransformMatrix),this._globalOffset=e.j.TransformNormal(this._viewOffset,v._cameraTransformMatrix),Q.origin.addInPlace(this._globalOffset));let n=0;return this._hitPlane&&(n=Q.intersectsPlane(this._hitPlane)??0),Q.origin.addInPlace(Q.direction.scaleInPlace(n))}_zoomToMouse(v){const d=this.camera,Q=1-d.inertia;if(d.lowerRadiusLimit){const n=d.lowerRadiusLimit??0;d.radius-(d.inertialRadiusOffset+v)/Q<n&&(v=(d.radius-n)*Q-d.inertialRadiusOffset)}if(d.upperRadiusLimit){const n=d.upperRadiusLimit??0;d.radius-(d.inertialRadiusOffset+v)/Q>n&&(v=(d.radius-n)*Q-d.inertialRadiusOffset)}const n=v/Q/d.radius,T=this._getPosition(),L=e.g.fk[6];T.subtractToRef(d.target,L),L.scaleInPlace(n),L.scaleInPlace(Q),this._inertialPanning.addInPlace(L),d.inertialRadiusOffset+=v}_zeroIfClose(v){Math.abs(v.x)<z.b&&(v.x=0),Math.abs(v.y)<z.b&&(v.y=0),Math.abs(v.z)<z.b&&(v.z=0)}}(0,n.b)([(0,T.F)()],M.prototype,"wheelPrecision",void 0),(0,n.b)([(0,T.F)()],M.prototype,"zoomToMouseLocation",void 0),(0,n.b)([(0,T.F)()],M.prototype,"wheelDeltaPercentage",void 0),f.c.ArcRotateCameraMouseWheelInput=M;class Y extends f.f{constructor(v){super(v)}addMouseWheel(){return this.add(new M),this}addPointers(){return this.add(new J),this}addKeyboard(){return this.add(new o),this}}var D=Q(591);function i(v,d){return isNaN(v)?d:v}r.d.AddNodeConstructor("ArcRotateCamera",((v,d)=>()=>new Z(v,0,0,1,e.j.Zero(),d)));class Z extends A.e{get target(){return this._target}set target(v){this.setTarget(v)}get targetHost(){return this._targetHost}set targetHost(v){v&&this.setTarget(v)}getTarget(){return this.target}get position(){return this._position}set position(v){this.setPosition(v)}set upVector(v){this._upToYMatrix||(this._yToUpMatrix=new e.b,this._upToYMatrix=new e.b,this._upVector=e.j.Zero()),v.normalize(),this._upVector.p(v),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){e.b.RotationAlignToRef(e.j.UpReadOnly,this._upVector,this._yToUpMatrix),e.b.RotationAlignToRef(this._upVector,e.j.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const v=this.inputs.attached.pointers;return v?v.angularSensibilityX:0}set angularSensibilityX(v){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityX=v)}get angularSensibilityY(){const v=this.inputs.attached.pointers;return v?v.angularSensibilityY:0}set angularSensibilityY(v){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityY=v)}get pinchPrecision(){const v=this.inputs.attached.pointers;return v?v.pinchPrecision:0}set pinchPrecision(v){const d=this.inputs.attached.pointers;d&&(d.pinchPrecision=v)}get pinchDeltaPercentage(){const v=this.inputs.attached.pointers;return v?v.pinchDeltaPercentage:0}set pinchDeltaPercentage(v){const d=this.inputs.attached.pointers;d&&(d.pinchDeltaPercentage=v)}get useNaturalPinchZoom(){const v=this.inputs.attached.pointers;return!!v&&v.useNaturalPinchZoom}set useNaturalPinchZoom(v){const d=this.inputs.attached.pointers;d&&(d.useNaturalPinchZoom=v)}get panningSensibility(){const v=this.inputs.attached.pointers;return v?v.panningSensibility:0}set panningSensibility(v){const d=this.inputs.attached.pointers;d&&(d.panningSensibility=v)}get keysUp(){const v=this.inputs.attached.keyboard;return v?v.keysUp:[]}set keysUp(v){const d=this.inputs.attached.keyboard;d&&(d.keysUp=v)}get keysDown(){const v=this.inputs.attached.keyboard;return v?v.keysDown:[]}set keysDown(v){const d=this.inputs.attached.keyboard;d&&(d.keysDown=v)}get keysLeft(){const v=this.inputs.attached.keyboard;return v?v.keysLeft:[]}set keysLeft(v){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=v)}get keysRight(){const v=this.inputs.attached.keyboard;return v?v.keysRight:[]}set keysRight(v){const d=this.inputs.attached.keyboard;d&&(d.keysRight=v)}get wheelPrecision(){const v=this.inputs.attached.mousewheel;return v?v.wheelPrecision:0}set wheelPrecision(v){const d=this.inputs.attached.mousewheel;d&&(d.wheelPrecision=v)}get zoomToMouseLocation(){const v=this.inputs.attached.mousewheel;return!!v&&v.zoomToMouseLocation}set zoomToMouseLocation(v){const d=this.inputs.attached.mousewheel;d&&(d.zoomToMouseLocation=v)}get wheelDeltaPercentage(){const v=this.inputs.attached.mousewheel;return v?v.wheelDeltaPercentage:0}set wheelDeltaPercentage(v){const d=this.inputs.attached.mousewheel;d&&(d.wheelDeltaPercentage=v)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(v){v!==this.useBouncingBehavior&&(v?(this._bouncingBehavior=new V,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(v){v!==this.useFramingBehavior&&(v?(this._framingBehavior=new h,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(v){v!==this.useAutoRotationBehavior&&(v?(this._autoRotationBehavior=new B,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(v,d,Q,n,T,F){var r;let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(v,e.j.Zero(),F,C),r=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=e.j.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=e.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new e.b,this.panningAxis=new e.j(1,1,0),this._transformedDirection=new e.j,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new L.e,this.checkCollisions=!1,this.collisionRadius=new e.j(.5,.5,.5),this._previousPosition=e.j.Zero(),this._collisionVelocity=e.j.Zero(),this._newPosition=e.j.Zero(),this._computationVector=e.j.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new e.j(NaN,NaN,NaN),this._goalTargetScreenOffset=new e.i(NaN,NaN),this._onCollisionPositionChange=function(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q?(r.setPosition(d),r.Be&&r.Be(Q)):r._previousPosition.p(r._position);const n=Math.cos(r.alpha),T=Math.sin(r.alpha),L=Math.cos(r.beta);let e=Math.sin(r.beta);0===e&&(e=1e-4);const F=r._getTargetPosition();r._computationVector.ld(r.radius*n*e,r.radius*L,r.radius*T*e),F.addToRef(r._computationVector,r._newPosition),r._position.p(r._newPosition);let C=r.upVector;r.allowUpsideDown&&r.beta<0&&(C=C.clone(),C=C.negate()),r._computeViewMatrix(r._position,F,C),r._viewMatrix.addAtIndex(12,r.targetScreenOffset.x),r._viewMatrix.addAtIndex(13,r.targetScreenOffset.y),r._collisionTriggered=!1},this._target=e.j.Zero(),T&&this.setTarget(T),this.alpha=d,this.beta=Q,this.radius=n,this.getViewMatrix(),this.inputs=new Y(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new e.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=e.i.Zero()}_updateCache(v){v||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const v=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?v.addToRef(this._targetBoundingCenter,this._target):this._target.p(v)}const v=this._getLockedTargetPosition();return v||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>z.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,L=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=L?this._currentInterpolationFactor=L:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=i(v,this._goalAlpha),this._goalBeta=i(d,this._goalBeta),this._goalRadius=i(Q,this._goalRadius),this._goalTarget.set(i(n.x,this._goalTarget.x),i(n.y,this._goalTarget.y),i(n.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(i(T.x,this._goalTargetScreenOffset.x),i(T.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,F.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,F.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,F.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,F.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(v,d){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const T=arguments;d=P.e.BackCompatCameraNoPreventDefault(T),this._useCtrlForPanning=Q,this._panningMouseButton=n,"boolean"===typeof T[0]&&(T.length>1&&(this._useCtrlForPanning=T[1]),T.length>2&&(this._panningMouseButton=T[2])),this.inputs.attachElement(d),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}ak(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let v=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){v=!0;const d=this.invertRotation?-1:1,Q=this._calculateHandednessMultiplier();let n=this.inertialAlphaOffset*Q;this.beta<0&&(n*=-1),this.alpha+=n*d,this.beta+=this.inertialBetaOffset*d,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<z.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<z.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*z.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){v=!0;const d=new e.j(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.multiplyInPlace(this.panningAxis),e.j.TransformNormalToRef(d,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const v=this.upVector,d=e.j.CrossToRef(this._transformedDirection,v,this._transformedDirection);e.j.CrossToRef(v,d,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);e.j.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const v=e.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(v),v.transposeToRef(v),e.j.TransformCoordinatesToRef(this._transformedDirection,v,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*z.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*z.b&&(this.inertialPanningY=0)}if(v)this.stopInterpolation();else if(this._isInterpolating){let v=!1;const d=this._scene.getEngine().getDeltaTime()/1e3,Q=1-Math.pow(2,-d/this._currentInterpolationFactor),n=i(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const d=e.g.fk[0].set(i(this._goalTarget.x,this._target.x),i(this._goalTarget.y,this._target.y),i(this._goalTarget.z,this._target.z));e.j.LerpToRef(this.target,d,Q,this._target),10*e.j.Distance(this.target,d)/n<z.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(d),this.setTarget(this.target,!1,!0,!0)):v=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const d=e.c.RotationAlphaBetaGammaToRef(i(this._goalAlpha,this.alpha),i(this._goalBeta,this.beta),0,e.g.Quaternion[0]),n=e.c.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,e.g.Quaternion[1]),T=e.c.SlerpToRef(n,d,Q,e.g.Quaternion[2]);T.normalize();const L=T.toAlphaBetaGammaToRef(e.g.fk[0]);if(this.alpha=L.x,this.beta=L.y,T.isApprox(d,z.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const v=d.toAlphaBetaGammaToRef(e.g.fk[0]);this.alpha=v.x,this.beta=v.y}else v=!0}if(isNaN(this._goalRadius)||(this.radius+=(n-this.radius)*Q,Math.abs(n/this.radius-1)<z.b?(this._goalRadius=NaN,this.radius=n):v=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const d=e.g.Vector2[0].set(i(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),i(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));e.i.LerpToRef(this.targetScreenOffset,d,Q,this.targetScreenOffset),e.i.Distance(this.targetScreenOffset,d)<z.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(d)):v=!0}this._isInterpolating=v}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||e.j.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const v=this.alpha;var d,Q;this.alpha=function(v){let d=Math.PI/2;return 0===v.x&&0===v.z||(d=Math.acos(v.x/Math.sqrt(Math.pow(v.x,2)+Math.pow(v.z,2)))),v.z<0&&(d=2*Math.PI-d),d}(this._computationVector),this.beta=(d=this._computationVector.y,Q=this.radius,Math.acos(d/Q));const n=Math.round((v-this.alpha)/(2*Math.PI));this.alpha+=2*n*Math.PI,this._checkLimits()}setPosition(v){this._position.equals(v)||(this._position.p(v),this.rebuildAnglesAndRadius())}setTarget(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n=this.overrideCloneAlphaBetaRadius??n,v.ck)d&&v.getBoundingInfo?this._targetBoundingCenter=v.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,v.ck(),this._targetHost=v,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const d=v,n=this._getTargetPosition();if(n&&!Q&&n.equals(d))return;this._targetHost=null,this._target=d,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}n||this.rebuildAnglesAndRadius()}_getViewMatrix(){const v=Math.cos(this.alpha),d=Math.sin(this.alpha),Q=Math.cos(this.beta);let n=Math.sin(this.beta);0===n&&(n=1e-4),0===this.radius&&(this.radius=1e-4);const T=this._getTargetPosition();if(this._computationVector.ld(this.radius*v*n,this.radius*Q,this.radius*d*n),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||e.j.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),T.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const v=this.va().collisionCoordinator;this._collider||(this._collider=v.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,v.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let v=this.upVector;this.allowUpsideDown&&n<0&&(v=v.negate()),this._computeViewMatrix(this._position,T,v),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(T),this._viewMatrix}zoomOn(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v=v||this.va().meshes;const Q=C.b.MinMax(v);let n=this._calculateLowerRadiusFromModelBoundingSphere(Q.min,Q.max);if(n=Math.max(Math.min(n,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=n*this.zoomOnFactor,this.mode===S.c.ORTHOGRAPHIC_CAMERA){const v=this.va().getEngine().getAspectRatio(this),d=n*this.zoomOnFactor/2;this.orthoLeft=-d*v,this.orthoRight=d*v,this.orthoBottom=-d,this.orthoTop=d}this.focusOn({min:Q.min,max:Q.max,distance:n},d)}focusOn(v){let d,Q,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===v.min){const n=v||this.va().meshes;d=C.b.MinMax(n),Q=e.j.Distance(d.min,d.max)}else{d=v,Q=v.distance}this._target=C.b.Center(d),n||(this.maxZ=2*Q)}createRigCamera(v,d){let Q=0;switch(this.cameraRigMode){case S.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.c.RIG_MODE_VR:Q=this._cameraRigParams.stereoHalfAngle*(0===d?1:-1);break;case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Q=this._cameraRigParams.stereoHalfAngle*(0===d?-1:1)}const n=new Z(v,this.alpha+Q,this.beta,this.radius,this._target,this.va());return n._cameraRigParams={},n.isRigCamera=!0,n.rigParent=this,n.upVector=this.upVector,n.mode=this.mode,n.orthoLeft=this.orthoLeft,n.orthoRight=this.orthoRight,n.orthoBottom=this.orthoBottom,n.orthoTop=this.orthoTop,n}_updateRigCameras(){const v=this._rigCameras[0],d=this._rigCameras[1];switch(v.beta=d.beta=this.beta,this.cameraRigMode){case S.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case S.c.RIG_MODE_VR:v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const n=e.j.Distance(v,d),T=this.va().getEngine().getAspectRatio(this),L=Math.tan(this.fov/2),F=L*T,r=.5*n*Q,C=r*Math.sqrt(1+1/(F*F)),u=r*Math.sqrt(1+1/(L*L));return Math.max(C,u)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,n.b)([(0,T.F)()],Z.prototype,"alpha",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"beta",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"radius",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,n.b)([(0,T.C)("target")],Z.prototype,"_target",void 0),(0,n.b)([(0,T.s)("targetHost")],Z.prototype,"_targetHost",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"inertialAlphaOffset",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"inertialBetaOffset",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"inertialRadiusOffset",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"lowerAlphaLimit",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"upperAlphaLimit",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"lowerBetaLimit",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"upperBetaLimit",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"lowerRadiusLimit",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"upperRadiusLimit",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"lowerTargetYLimit",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"inertialPanningX",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"inertialPanningY",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"pinchToPanMaxDistance",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"panningDistanceLimit",void 0),(0,n.b)([(0,T.C)()],Z.prototype,"panningOriginTarget",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"panningInertia",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"zoomToMouseLocation",null),(0,n.b)([(0,T.F)()],Z.prototype,"zoomOnFactor",void 0),(0,n.b)([(0,T.B)()],Z.prototype,"targetScreenOffset",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"allowUpsideDown",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"useInputToRestoreState",void 0),(0,n.b)([(0,T.F)()],Z.prototype,"restoreStateInterpolationFactor",void 0),(0,D.f)("BABYLON.ArcRotateCamera",Z)},12837:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>e,f:()=>F});var n=Q(482),T=Q(677),L=Q(616),e={};class F{constructor(v){this.attachedToElement=!1,this.attached={},this.camera=v,this.checkInputs=()=>{}}add(v){const d=v.getSimpleName();this.attached[d]?n.d.Warn("camera input of type "+d+" already exists on camera"):(this.attached[d]=v,v.camera=this.camera,v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v))),this.attachedToElement&&v.attachControl(this.noPreventDefault))}remove(v){for(const d in this.attached){const Q=this.attached[d];if(Q===v)return Q.ak(),Q.camera=null,delete this.attached[d],void this.rebuildInputCheck()}}removeByType(v){for(const d in this.attached){const Q=this.attached[d];Q.getClassName()===v&&(Q.ak(),Q.camera=null,delete this.attached[d],this.rebuildInputCheck())}}_addCheckInputs(v){const d=this.checkInputs;return()=>{d(),v()}}attachInput(v){this.attachedToElement&&v.attachControl(this.noPreventDefault)}attachElement(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){v=!L.c.ForceAttachControlToAlwaysPreventDefault&&v,this.attachedToElement=!0,this.noPreventDefault=v;for(const d in this.attached)this.attached[d].attachControl(v)}}detachElement(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const d in this.attached)this.attached[d].ak(),v&&(this.attached[d].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const v in this.attached){const d=this.attached[v];d.checkInputs&&(this.checkInputs=this._addCheckInputs(d.checkInputs.bind(d)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(v){const d={};for(const Q in this.attached){const v=this.attached[Q],n=T.e.Serialize(v);d[v.getClassName()]=n}v.inputsmgr=d}parse(v){const d=v.inputsmgr;if(d){this.clear();for(const v in d){const Q=e[v];if(Q){const n=d[v],L=T.e.Parse((()=>new Q),n,null);this.add(L)}}}else for(const Q in this.attached){const d=e[this.attached[Q].getClassName()];if(d){const n=T.e.Parse((()=>new d),v,null);this.remove(this.attached[Q]),this.add(n)}}}}},12833:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>O});var n=Q(620),T=Q(629),L=Q(651),e=Q(11916),F=Q(12837),r=Q(2204),C=Q(475);class u{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(v){v=C.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const Q=d.event;if(!Q.metaKey)if(d.type===r.b.KEYDOWN){if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),v||Q.preventDefault()}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){const d=this._keys.indexOf(Q.keyCode);d>=0&&this._keys.splice(d,1),v||Q.preventDefault()}})))}ak(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const v=this.camera;for(let d=0;d<this._keys.length;d++){const Q=this._keys[d],n=v._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Q)?v._localDirection.ld(-n,0,0):-1!==this.keysUp.indexOf(Q)?v._localDirection.ld(0,0,n):-1!==this.keysRight.indexOf(Q)?v._localDirection.ld(n,0,0):-1!==this.keysDown.indexOf(Q)?v._localDirection.ld(0,0,-n):-1!==this.keysUpward.indexOf(Q)?v._localDirection.ld(0,n,0):-1!==this.keysDownward.indexOf(Q)?v._localDirection.ld(0,-n,0):-1!==this.keysRotateLeft.indexOf(Q)?(v._localDirection.ld(0,0,0),v.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Q)?(v._localDirection.ld(0,0,0),v.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Q)?(v._localDirection.ld(0,0,0),v.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Q)&&(v._localDirection.ld(0,0,0),v.cameraRotation.x+=this._getLocalRotation()),v.va().useRightHandedSystem&&(v._localDirection.z*=-1),v.getViewMatrix().invertToRef(v._cameraTransformMatrix),L.j.TransformNormalToRef(v._localDirection,v._cameraTransformMatrix,v._transformedDirection),v.cameraDirection.addInPlace(v._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const v=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*v}}(0,n.b)([(0,T.F)()],u.prototype,"keysUp",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysUpward",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysDown",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysDownward",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysLeft",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysRight",void 0),(0,n.b)([(0,T.F)()],u.prototype,"rotationSpeed",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysRotateLeft",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysRotateRight",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysRotateUp",void 0),(0,n.b)([(0,T.F)()],u.prototype,"keysRotateDown",void 0),F.c.FreeCameraKeyboardMoveInput=u;var y=Q(473),z=Q(2200);class B{constructor(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=v,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new y.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(v){v=C.e.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),Q=d.getInputElement();this._pointerInput||(this._pointerInput=n=>{const T=n.event,L="touch"===T.pointerType;if(!this.touchEnabled&&L)return;if(n.type!==z.e.POINTERMOVE&&-1===this.buttons.indexOf(T.button))return;const e=T.target;if(n.type===z.e.POINTERDOWN){if(L&&-1!==this._activePointerId||!L&&-1!==this._currentActiveButton)return;this._activePointerId=T.pointerId;try{null===e||void 0===e||e.setPointerCapture(T.pointerId)}catch(F){}-1===this._currentActiveButton&&(this._currentActiveButton=T.button),this._previousPosition={x:T.clientX,y:T.clientY},v||(T.preventDefault(),Q&&Q.focus()),d.isPointerLock&&this._onMouseMove&&this._onMouseMove(n.event)}else if(n.type===z.e.POINTERUP){if(L&&this._activePointerId!==T.pointerId||!L&&this._currentActiveButton!==T.button)return;try{null===e||void 0===e||e.releasePointerCapture(T.pointerId)}catch(F){}this._currentActiveButton=-1,this._previousPosition=null,v||T.preventDefault(),this._activePointerId=-1}else if(n.type===z.e.POINTERMOVE&&(this._activePointerId===T.pointerId||!L))if(d.isPointerLock&&this._onMouseMove)this._onMouseMove(n.event);else if(this._previousPosition){const d=this.camera._calculateHandednessMultiplier(),Q=(T.clientX-this._previousPosition.x)*d,n=T.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Q/this.angularSensibility,this.camera.cameraRotation.x+=n/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Q,offsetY:n}),this._previousPosition={x:T.clientX,y:T.clientY},v||T.preventDefault()}}),this._onMouseMove=Q=>{if(!d.isPointerLock)return;const n=this.camera._calculateHandednessMultiplier(),T=Q.movementX*n;this.camera.cameraRotation.y+=T/this.angularSensibility;const L=Q.movementY;this.camera.cameraRotation.x+=L/this.angularSensibility,this._previousPosition=null,v||Q.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,z.e.POINTERDOWN|z.e.POINTERUP|z.e.POINTERMOVE),Q&&(this._contextMenuBind=v=>this.onContextMenu(v),Q.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(v){v.preventDefault()}ak(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const v=this.camera.getEngine().getInputElement();v&&v.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,n.b)([(0,T.F)()],B.prototype,"buttons",void 0),(0,n.b)([(0,T.F)()],B.prototype,"angularSensibility",void 0),F.c.FreeCameraMouseInput=B;var X,m=Q(2212);class V{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new y.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(v){v=C.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==z.e.POINTERWHEEL)return;const Q=d.event,n=Q.deltaMode===m.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*n*Q.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*n*Q.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*n*Q.deltaZ/this._normalize,Q.preventDefault&&(v||Q.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,z.e.POINTERWHEEL)}ak(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,n.b)([(0,T.F)()],V.prototype,"wheelPrecisionX",void 0),(0,n.b)([(0,T.F)()],V.prototype,"wheelPrecisionY",void 0),(0,n.b)([(0,T.F)()],V.prototype,"wheelPrecisionZ",void 0),function(v){v[v.MoveRelative=0]="MoveRelative",v[v.RotateRelative=1]="RotateRelative",v[v.MoveScene=2]="MoveScene"}(X||(X={}));class h extends V{constructor(){super(...arguments),this._moveRelative=L.j.Zero(),this._rotateRelative=L.j.Zero(),this._moveScene=L.j.Zero(),this._wheelXAction=X.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=X.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(v){null===v&&this._wheelXAction!==X.MoveRelative||(this._wheelXAction=X.MoveRelative,this._wheelXActionCoordinate=v)}get wheelXMoveRelative(){return this._wheelXAction!==X.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(v){null===v&&this._wheelYAction!==X.MoveRelative||(this._wheelYAction=X.MoveRelative,this._wheelYActionCoordinate=v)}get wheelYMoveRelative(){return this._wheelYAction!==X.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(v){null===v&&this._wheelZAction!==X.MoveRelative||(this._wheelZAction=X.MoveRelative,this._wheelZActionCoordinate=v)}get wheelZMoveRelative(){return this._wheelZAction!==X.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(v){null===v&&this._wheelXAction!==X.RotateRelative||(this._wheelXAction=X.RotateRelative,this._wheelXActionCoordinate=v)}get wheelXRotateRelative(){return this._wheelXAction!==X.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(v){null===v&&this._wheelYAction!==X.RotateRelative||(this._wheelYAction=X.RotateRelative,this._wheelYActionCoordinate=v)}get wheelYRotateRelative(){return this._wheelYAction!==X.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(v){null===v&&this._wheelZAction!==X.RotateRelative||(this._wheelZAction=X.RotateRelative,this._wheelZActionCoordinate=v)}get wheelZRotateRelative(){return this._wheelZAction!==X.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(v){null===v&&this._wheelXAction!==X.MoveScene||(this._wheelXAction=X.MoveScene,this._wheelXActionCoordinate=v)}get wheelXMoveScene(){return this._wheelXAction!==X.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(v){null===v&&this._wheelYAction!==X.MoveScene||(this._wheelYAction=X.MoveScene,this._wheelYActionCoordinate=v)}get wheelYMoveScene(){return this._wheelYAction!==X.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(v){null===v&&this._wheelZAction!==X.MoveScene||(this._wheelZAction=X.MoveScene,this._wheelZActionCoordinate=v)}get wheelZMoveScene(){return this._wheelZAction!==X.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.gk(0),this._rotateRelative.gk(0),this._moveScene.gk(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const v=L.b.Zero();this.camera.getViewMatrix().invertToRef(v);const d=L.j.Zero();L.j.TransformNormalToRef(this._moveRelative,v,d),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(d),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(v,d,Q){if(0===v)return;if(null===d||null===Q)return;let n=null;switch(d){case X.MoveRelative:n=this._moveRelative;break;case X.RotateRelative:n=this._rotateRelative;break;case X.MoveScene:n=this._moveScene}switch(Q){case 0:n.set(v,0,0);break;case 1:n.set(0,v,0);break;case 2:n.set(0,0,v)}}}(0,n.b)([(0,T.F)()],h.prototype,"wheelXMoveRelative",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelYMoveRelative",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelZMoveRelative",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelXRotateRelative",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelYRotateRelative",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelZRotateRelative",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelXMoveScene",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelYMoveScene",null),(0,n.b)([(0,T.F)()],h.prototype,"wheelZMoveScene",null),F.c.FreeCameraMouseWheelInput=h;class S{constructor(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=v,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=C.e.IsSafari()}attachControl(v){v=C.e.BackCompatCameraNoPreventDefault(arguments);let d=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Q=>{const n=Q.event,T="mouse"===n.pointerType||this._isSafari&&"undefined"===typeof n.pointerType;if(this.allowMouse||!T)if(Q.type===z.e.POINTERDOWN){if(v||n.preventDefault(),this._pointerPressed.push(n.pointerId),1!==this._pointerPressed.length)return;d={x:n.clientX,y:n.clientY}}else if(Q.type===z.e.POINTERUP){v||n.preventDefault();const Q=this._pointerPressed.indexOf(n.pointerId);if(-1===Q)return;if(this._pointerPressed.splice(Q,1),0!=Q)return;d=null,this._offsetX=null,this._offsetY=null}else if(Q.type===z.e.POINTERMOVE){if(v||n.preventDefault(),!d)return;if(0!=this._pointerPressed.indexOf(n.pointerId))return;this._offsetX=n.clientX-d.x,this._offsetY=-(n.clientY-d.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,z.e.POINTERDOWN|z.e.POINTERUP|z.e.POINTERMOVE),this._onLostFocus){const v=this.camera.getEngine().getInputElement();v&&v.addEventListener("blur",this._onLostFocus)}}ak(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const v=this.camera.getEngine().getInputElement();v&&v.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const v=this.camera,d=v._calculateHandednessMultiplier();v.cameraRotation.y=d*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)v.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const d=v._computeLocalCameraSpeed(),Q=new L.j(0,0,0!==this.touchMoveSensibility?d*this._offsetY/this.touchMoveSensibility:0);L.b.RotationYawPitchRollToRef(v.rotation.y,v.rotation.x,0,v._cameraRotationMatrix),v.cameraDirection.addInPlace(L.j.TransformCoordinates(Q,v._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,n.b)([(0,T.F)()],S.prototype,"touchAngularSensibility",void 0),(0,n.b)([(0,T.F)()],S.prototype,"touchMoveSensibility",void 0),F.c.FreeCameraTouchInput=S;class A extends F.f{constructor(v){super(v),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new u),this}addMouse(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new B(v),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new h,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new S),this}clear(){super.clear(),this._mouseInput=null}}var f=Q(591),P=Q(544);class O extends e.e{get angularSensibility(){const v=this.inputs.attached.mouse;return v?v.angularSensibility:0}set angularSensibility(v){const d=this.inputs.attached.mouse;d&&(d.angularSensibility=v)}get keysUp(){const v=this.inputs.attached.keyboard;return v?v.keysUp:[]}set keysUp(v){const d=this.inputs.attached.keyboard;d&&(d.keysUp=v)}get keysUpward(){const v=this.inputs.attached.keyboard;return v?v.keysUpward:[]}set keysUpward(v){const d=this.inputs.attached.keyboard;d&&(d.keysUpward=v)}get keysDown(){const v=this.inputs.attached.keyboard;return v?v.keysDown:[]}set keysDown(v){const d=this.inputs.attached.keyboard;d&&(d.keysDown=v)}get keysDownward(){const v=this.inputs.attached.keyboard;return v?v.keysDownward:[]}set keysDownward(v){const d=this.inputs.attached.keyboard;d&&(d.keysDownward=v)}get keysLeft(){const v=this.inputs.attached.keyboard;return v?v.keysLeft:[]}set keysLeft(v){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=v)}get keysRight(){const v=this.inputs.attached.keyboard;return v?v.keysRight:[]}set keysRight(v){const d=this.inputs.attached.keyboard;d&&(d.keysRight=v)}get keysRotateLeft(){const v=this.inputs.attached.keyboard;return v?v.keysRotateLeft:[]}set keysRotateLeft(v){const d=this.inputs.attached.keyboard;d&&(d.keysRotateLeft=v)}get keysRotateRight(){const v=this.inputs.attached.keyboard;return v?v.keysRotateRight:[]}set keysRotateRight(v){const d=this.inputs.attached.keyboard;d&&(d.keysRotateRight=v)}get keysRotateUp(){const v=this.inputs.attached.keyboard;return v?v.keysRotateUp:[]}set keysRotateUp(v){const d=this.inputs.attached.keyboard;d&&(d.keysRotateUp=v)}get keysRotateDown(){const v=this.inputs.attached.keyboard;return v?v.keysRotateDown:[]}set keysRotateDown(v){const d=this.inputs.attached.keyboard;d&&(d.keysRotateDown=v)}constructor(v,d,Q){var n;super(v,d,Q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),n=this,this.ellipsoid=new L.j(.5,1,.5),this.ellipsoidOffset=new L.j(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=L.j.Zero(),this._diffPosition=L.j.Zero(),this._newPosition=L.j.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n._newPosition.p(d),n._newPosition.subtractToRef(n._oldPosition,n._diffPosition),n._diffPosition.length()>P.d.CollisionsEpsilon&&(n.position.addToRef(n._diffPosition,n._deferredPositionUpdate),n._deferOnly?n._deferredUpdated=!0:n.position.p(n._deferredPositionUpdate),n.Be&&Q&&n.Be(Q))},this.inputs=new A(this),this.inputs.addKeyboard().addMouse()}attachControl(v,d){d=C.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(d)}ak(){this.inputs.detachElement(),this.cameraDirection=new L.j(0,0,0),this.cameraRotation=new L.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(v){this._collisionMask=isNaN(v)?-1:v}_collideWithWorld(v){let d;d=this.parent?L.j.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,d.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Q=this.va().collisionCoordinator;this._collider||(this._collider=Q.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let n=v;this.applyGravity&&(n=v.add(this.va().gravity)),Q.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=L.j.Zero(),this._transformedDirection=L.j.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(v){this._needMoveForGravity=v}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,n.b)([(0,T.C)()],O.prototype,"ellipsoid",void 0),(0,n.b)([(0,T.C)()],O.prototype,"ellipsoidOffset",void 0),(0,n.b)([(0,T.F)()],O.prototype,"checkCollisions",void 0),(0,n.b)([(0,T.F)()],O.prototype,"applyGravity",void 0),(0,f.f)("BABYLON.FreeCamera",O)},13239:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>L});var n=Q(642),T=Q(13245);class L{constructor(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Q,this.jl=[],this._maxBlockCapacity=d||64,this._selectionContent=new n.c(1024),this._creationFunc=v}update(v,d,Q){T.b._CreateBlocks(v,d,Q,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Ak(v){for(let d=0;d<this.Uk.length;d++){this.Uk[d].addEntry(v)}}Bk(v){for(let d=0;d<this.Uk.length;d++){this.Uk[d].removeEntry(v)}}select(v,d){this._selectionContent.reset();for(let Q=0;Q<this.Uk.length;Q++){this.Uk[Q].select(v,this._selectionContent,d)}return d?this._selectionContent.concat(this.jl):this._selectionContent.concatWithNoDuplicate(this.jl),this._selectionContent}intersects(v,d,Q){this._selectionContent.reset();for(let n=0;n<this.Uk.length;n++){this.Uk[n].intersects(v,d,this._selectionContent,Q)}return Q?this._selectionContent.concat(this.jl):this._selectionContent.concatWithNoDuplicate(this.jl),this._selectionContent}intersectsRay(v){this._selectionContent.reset();for(let d=0;d<this.Uk.length;d++){this.Uk[d].intersectsRay(v,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.jl),this._selectionContent}}L.CreationFuncForMeshes=(v,d)=>{const Q=v.getBoundingInfo();!v.isBlocked&&Q.boundingBox.intersectsMinMax(d.ll,d.ml)&&d.entries.push(v)},L.CreationFuncForSubMeshes=(v,d)=>{v.getBoundingInfo().boundingBox.intersectsMinMax(d.ll,d.ml)&&d.entries.push(v)}},13245:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>L});var n=Q(651),T=Q(750);class L{constructor(v,d,Q,n,T,L){this.entries=[],this.nl=new Array,this._capacity=Q,this._depth=n,this._maxDepth=T,this._creationFunc=L,this._minPoint=v,this._maxPoint=d,this.nl.push(v.clone()),this.nl.push(d.clone()),this.nl.push(v.clone()),this.nl[2].x=d.x,this.nl.push(v.clone()),this.nl[3].y=d.y,this.nl.push(v.clone()),this.nl[4].z=d.z,this.nl.push(d.clone()),this.nl[5].z=v.z,this.nl.push(d.clone()),this.nl[6].x=v.x,this.nl.push(d.clone()),this.nl[7].y=v.y}get Nb(){return this._capacity}get ll(){return this._minPoint}get ml(){return this._maxPoint}addEntry(v){if(this.Uk)for(let d=0;d<this.Uk.length;d++){this.Uk[d].addEntry(v)}else this._creationFunc(v,this),this.entries.length>this.Nb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(v){if(this.Uk){for(let d=0;d<this.Uk.length;d++){this.Uk[d].removeEntry(v)}return}const d=this.entries.indexOf(v);d>-1&&this.entries.splice(d,1)}addEntries(v){for(let d=0;d<v.length;d++){const Q=v[d];this.addEntry(Q)}}select(v,d,Q){if(T.d.IsInFrustum(this.nl,v)){if(this.Uk){for(let n=0;n<this.Uk.length;n++){this.Uk[n].select(v,d,Q)}return}Q?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersects(v,d,Q,n){if(T.d.IntersectsSphere(this._minPoint,this._maxPoint,v,d)){if(this.Uk){for(let T=0;T<this.Uk.length;T++){this.Uk[T].intersects(v,d,Q,n)}return}n?Q.concat(this.entries):Q.concatWithNoDuplicate(this.entries)}}intersectsRay(v,d){if(v.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Uk){for(let Q=0;Q<this.Uk.length;Q++){this.Uk[Q].intersectsRay(v,d)}return}d.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){L._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(v,d,Q,T,e,F,r,C){r.Uk=new Array;const u=new n.j((d.x-v.x)/2,(d.y-v.y)/2,(d.z-v.z)/2);for(let n=0;n<2;n++)for(let d=0;d<2;d++)for(let y=0;y<2;y++){const z=v.add(u.multiplyByFloats(n,d,y)),B=v.add(u.multiplyByFloats(n+1,d+1,y+1)),X=new L(z,B,T,e+1,F,C);X.addEntries(Q),r.Uk.push(X)}}}},13249:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>u});var n=Q(2167),T=Q(651),L=Q(800),e=Q(12573),F=Q(857),r=Q(13239),C=Q(508);n.d.prototype.createOrUpdateSelectionOctree=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Q=this._getComponent(F.d.NAME_OCTREE);Q||(Q=new u(this),this.bb(Q)),this.hl||(this.hl=new r.b(r.b.CreationFuncForMeshes,v,d));const n=this.getWorldExtends();return this.hl.update(n.min,n.max,this.meshes),this.hl},Object.defineProperty(n.d.prototype,"selectionOctree",{get:function(){return this.hl},enumerable:!0,configurable:!0}),L.d.prototype.createOrUpdateSubmeshesOctree=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Q=this.va();let n=Q._getComponent(F.d.NAME_OCTREE);n||(n=new u(Q),Q.bb(n)),this._submeshesOctree||(this._submeshesOctree=new r.b(r.b.CreationFuncForSubMeshes,v,d)),this.ck(!0);const T=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(T.minimumWorld,T.maximumWorld,this.rk),this._submeshesOctree};class u{constructor(v){this.name=F.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new e.e(T.j.Zero(),new T.j(1,1,1)),(v=v||C.c.LastCreatedScene)&&(this.yd=v,this.yd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.yd.getActiveSubMeshCandidates=v=>this.getActiveSubMeshCandidates(v),this.yd.getCollidingSubMeshCandidates=(v,d)=>this.getCollidingSubMeshCandidates(v,d),this.yd.getIntersectingSubMeshCandidates=(v,d)=>this.getIntersectingSubMeshCandidates(v,d))}register(){this.yd.onMeshRemovedObservable.add((v=>{const d=this.yd.selectionOctree;if(void 0!==d&&null!==d){const Q=d.jl.indexOf(v);-1!==Q&&d.jl.splice(Q,1)}})),this.yd.onMeshImportedObservable.add((v=>{const d=this.yd.selectionOctree;void 0!==d&&null!==d&&d.Ak(v)}))}getActiveMeshCandidates(){var v;return(null===(v=this.yd.hl)||void 0===v?void 0:v.select(this.yd.frustumPlanes))||this.yd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(v){if(v._submeshesOctree&&v.useOctreeForRenderingSelection){return v._submeshesOctree.select(this.yd.frustumPlanes)}return this.yd._getDefaultSubMeshCandidates(v)}getIntersectingSubMeshCandidates(v,d){if(v._submeshesOctree&&v.useOctreeForPicking){e.e.TransformToRef(d,v.getWorldMatrix(),this._tempRay);return v._submeshesOctree.intersectsRay(this._tempRay)}return this.yd._getDefaultSubMeshCandidates(v)}getCollidingSubMeshCandidates(v,d){if(v._submeshesOctree&&v.useOctreeForCollisions){const Q=d._velocityWorldLength+Math.max(d._radius.x,d._radius.y,d._radius.z);return v._submeshesOctree.intersects(d._basePointWorld,Q)}return this.yd._getDefaultSubMeshCandidates(v)}rebuild(){}dispose(){}}},12573:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>B});var n=Q(2167),T=Q(616),L=Q(658),e=Q(651),F=Q(660),r=Q(733),C=Q(813),u=Q(508),y=Q(2217);const z={internalPickerForMesh:void 0};class B{constructor(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.b;this.origin=v,this.direction=d,this.length=Q,this.epsilon=n}clone(){return new B(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=B._TmpVector3[0].ld(v.x-Q,v.y-Q,v.z-Q),T=B._TmpVector3[1].ld(d.x+Q,d.y+Q,d.z+Q);let L,e,F,r,C=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<n.x||this.origin.x>T.x)return!1}else if(L=1/this.direction.x,e=(n.x-this.origin.x)*L,F=(T.x-this.origin.x)*L,F===-1/0&&(F=1/0),e>F&&(r=e,e=F,F=r),C=Math.max(e,C),u=Math.min(F,u),C>u)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<n.y||this.origin.y>T.y)return!1}else if(L=1/this.direction.y,e=(n.y-this.origin.y)*L,F=(T.y-this.origin.y)*L,F===-1/0&&(F=1/0),e>F&&(r=e,e=F,F=r),C=Math.max(e,C),u=Math.min(F,u),C>u)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<n.z||this.origin.z>T.z)return!1}else if(L=1/this.direction.z,e=(n.z-this.origin.z)*L,F=(T.z-this.origin.z)*L,F===-1/0&&(F=1/0),e>F&&(r=e,e=F,F=r),C=Math.max(e,C),u=Math.min(F,u),C>u)return!1;return!0}intersectsBox(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(v.minimum,v.maximum,d)}intersectsSphere(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=v.center.x-this.origin.x,n=v.center.y-this.origin.y,T=v.center.z-this.origin.z,L=Q*Q+n*n+T*T,e=v.radius+d,F=e*e;if(L<=F)return!0;const r=Q*this.direction.x+n*this.direction.y+T*this.direction.z;if(r<0)return!1;return L-r*r<=F}intersectsTriangle(v,d,Q){const n=B._TmpVector3[0],T=B._TmpVector3[1],L=B._TmpVector3[2],F=B._TmpVector3[3],C=B._TmpVector3[4];d.subtractToRef(v,n),Q.subtractToRef(v,T),e.j.CrossToRef(this.direction,T,L);const u=e.j.Dot(n,L);if(0===u)return null;const y=1/u;this.origin.subtractToRef(v,F);const z=e.j.Dot(F,L)*y;if(z<-this.epsilon||z>1+this.epsilon)return null;e.j.CrossToRef(F,n,C);const X=e.j.Dot(this.direction,C)*y;if(X<-this.epsilon||z+X>1+this.epsilon)return null;const m=e.j.Dot(T,C)*y;return m>this.length?null:new r.e(1-z-X,z,m)}intersectsPlane(v){let d;const Q=e.j.Dot(v.nk,this.direction);if(Math.abs(Q)<9.99999997475243e-7)return null;{const n=e.j.Dot(v.nk,this.origin);return d=(-v.d-n)/Q,d<0?d<-9.99999997475243e-7?null:0:d}}intersectsAxis(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(v){case"y":{const v=(this.origin.y-d)/this.direction.y;return v>0?null:new e.j(this.origin.x+this.direction.x*-v,d,this.origin.z+this.direction.z*-v)}case"x":{const v=(this.origin.x-d)/this.direction.x;return v>0?null:new e.j(d,this.origin.y+this.direction.y*-v,this.origin.z+this.direction.z*-v)}case"z":{const v=(this.origin.z-d)/this.direction.z;return v>0?null:new e.j(this.origin.x+this.direction.x*-v,this.origin.y+this.direction.y*-v,d)}default:return null}}intersectsMesh(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=e.g.Matrix[0];return v.getWorldMatrix().invertToRef(F),this._tmpRay?B.TransformToRef(this,F,this._tmpRay):this._tmpRay=B.Transform(this,F),v.intersects(this._tmpRay,d,Q,n,T,L)}intersectsMeshes(v,d,Q){Q?Q.length=0:Q=[];for(let n=0;n<v.length;n++){const T=this.intersectsMesh(v[n],d);T.hit&&Q.push(T)}return Q.sort(this._comparePickingInfo),Q}_comparePickingInfo(v,d){return v.distance<d.distance?-1:v.distance>d.distance?1:0}intersectionSegment(v,d,Q){const n=this.origin,T=e.g.fk[0],L=e.g.fk[1],F=e.g.fk[2],r=e.g.fk[3];d.subtractToRef(v,T),this.direction.scaleToRef(B._Rayl,F),n.addToRef(F,L),v.subtractToRef(n,r);const C=e.j.Dot(T,T),u=e.j.Dot(T,F),y=e.j.Dot(F,F),z=e.j.Dot(T,r),X=e.j.Dot(F,r),m=C*y-u*u;let V,h,S=m,A=m;m<B._Smallnum?(V=0,S=1,h=X,A=y):(V=u*X-y*z,h=C*X-u*z,V<0?(V=0,h=X,A=y):V>S&&(V=S,h=X+u,A=y)),h<0?(h=0,-z<0?V=0:-z>C?V=S:(V=-z,S=C)):h>A&&(h=A,-z+u<0?V=0:-z+u>C?V=S:(V=-z+u,S=C));const f=Math.abs(V)<B._Smallnum?0:V/S,P=Math.abs(h)<B._Smallnum?0:h/A,O=e.g.fk[4];F.scaleToRef(P,O);const J=e.g.fk[5];T.scaleToRef(f,J),J.addInPlace(r);const K=e.g.fk[6];J.subtractToRef(O,K);return P>0&&P<=this.length&&K.lengthSquared()<Q*Q?J.length():-1}update(v,d,Q,n,T,L,F){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){B._RayDistant||(B._RayDistant=B.Zero()),B._RayDistant.unprojectRayToRef(v,d,Q,n,e.b.IdentityReadOnly,L,F);const r=e.g.Matrix[0];T.invertToRef(r),B.TransformToRef(B._RayDistant,r,this)}else this.unprojectRayToRef(v,d,Q,n,T,L,F);return this}static Zero(){return new B(e.j.Zero(),e.j.Zero())}static CreateNew(v,d,Q,n,T,L,e){return B.Zero().update(v,d,Q,n,T,L,e)}static CreateNewFromTo(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.b.IdentityReadOnly;const n=new B(new e.j(0,0,0),new e.j(0,0,0));return B.CreateFromToToRef(v,d,n,Q)}static CreateFromToToRef(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.b.IdentityReadOnly;Q.origin.p(v);const T=d.subtractToRef(v,Q.direction),L=Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z);return Q.length=L,Q.direction.normalize(),B.TransformToRef(Q,n,Q)}static Transform(v,d){const Q=new B(new e.j(0,0,0),new e.j(0,0,0));return B.TransformToRef(v,d,Q),Q}static TransformToRef(v,d,Q){e.j.TransformCoordinatesToRef(v.origin,d,Q.origin),e.j.TransformNormalToRef(v.direction,d,Q.direction),Q.length=v.length,Q.epsilon=v.epsilon;const n=Q.direction,T=n.length();if(0!==T&&1!==T){const v=1/T;n.x*=v,n.y*=v,n.z*=v,Q.length*=T}return Q}unprojectRayToRef(v,d,Q,n,T,L,F){const r=e.g.Matrix[0];T.multiplyToRef(L,r),r.multiplyToRef(F,r),r.invert();const C=u.c.LastCreatedEngine,y=e.g.fk[0];y.x=v/Q*2-1,y.y=-(d/n*2-1),y.z=null!==C&&void 0!==C&&C.useReverseDepthBuffer?1:null!==C&&void 0!==C&&C.isNDCHalfZRange?0:-1;const z=e.g.fk[1].ld(y.x,y.y,1-1e-8),B=e.g.fk[2],X=e.g.fk[3];e.j._UnprojectFromInvertedMatrixToRef(y,r,B),e.j._UnprojectFromInvertedMatrixToRef(z,r,X),this.origin.p(B),X.subtractToRef(B,this.direction),this.direction.normalize()}}function X(v,d,Q,n,T){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const e=B.Zero();return m(v,d,Q,n,e,T,L),e}function m(v,d,Q,n,T,L){let F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const C=v.getEngine();if(!L&&!(L=v.activeCamera))return v;const u=L.viewport,y=C.getRenderHeight(),{x:z,y:B,width:X,height:m}=u.toGlobal(C.getRenderWidth(),y),V=1/C.getHardwareScalingLevel();return d=d*V-z,Q=Q*V-(y-B-m),T.update(d,Q,X,m,n||e.b.IdentityReadOnly,F?e.b.IdentityReadOnly:L.getViewMatrix(),L.getProjectionMatrix(),r),v}function V(v,d,Q,n,T){if(!C.e)return v;const L=v.getEngine();if(!T&&!(T=v.activeCamera))throw new Error("Active camera not set");const F=T.viewport,r=L.getRenderHeight(),{x:u,y:y,width:z,height:B}=F.toGlobal(L.getRenderWidth(),r),X=e.b.Identity(),m=1/L.getHardwareScalingLevel();return d=d*m-u,Q=Q*m-(r-y-B),n.update(d,Q,z,B,X,X,T.getProjectionMatrix()),v}function h(v,d,Q,n,T,L,e,F){const r=d(n,Q.enableDistantPicking),C=Q.intersects(r,T,e,L,n,F);return C&&C.hit?!T&&null!=v&&C.distance>=v.distance?null:C:null}function S(v,d,Q,n,T,L){let F=null;const r=!!(v.activeCameras&&v.activeCameras.length>1&&v.cameraToUseForPointers!==v.activeCamera),u=v.cameraToUseForPointers||v.activeCamera,y=z.internalPickerForMesh||h;for(let C=0;C<v.meshes.length;C++){const z=v.meshes[C];if(Q){if(!Q(z,-1))continue}else if(!z.isEnabled()||!z.isVisible||!z.We)continue;const B=r&&z.isWorldMatrixCameraDependent(),X=z.ck(B,u);if(z.hasThinInstances&&z.thinInstanceEnablePicking){const v=y(F,d,z,X,!0,!0,L);if(v){if(T)return v;const r=e.g.Matrix[1],C=z.thinInstanceGetWorldMatrices();for(let v=0;v<C.length;v++){if(Q&&!Q(z,v))continue;C[v].multiplyToRef(X,r);const e=y(F,d,z,r,n,T,L,!0);if(e&&(F=e,F.thinInstanceIndex=v,n))return F}}}else{const v=y(F,d,z,X,n,T,L);if(v&&(F=v,n))return F}}return F||new C.e}function A(v,d,Q,n){if(!C.e)return null;const T=[],L=!!(v.activeCameras&&v.activeCameras.length>1&&v.cameraToUseForPointers!==v.activeCamera),F=v.cameraToUseForPointers||v.activeCamera,r=z.internalPickerForMesh||h;for(let C=0;C<v.meshes.length;C++){const u=v.meshes[C];if(Q){if(!Q(u,-1))continue}else if(!u.isEnabled()||!u.isVisible||!u.We)continue;const y=L&&u.isWorldMatrixCameraDependent(),z=u.ck(y,F);if(u.hasThinInstances&&u.thinInstanceEnablePicking){if(r(null,d,u,z,!0,!0,n)){const v=e.g.Matrix[1],L=u.thinInstanceGetWorldMatrices();for(let e=0;e<L.length;e++){if(Q&&!Q(u,e))continue;L[e].multiplyToRef(z,v);const F=r(null,d,u,v,!1,!1,n,!0);F&&(F.thinInstanceIndex=e,T.push(F))}}}else{const v=r(null,d,u,z,!1,!1,n);v&&T.push(v)}}return T}function f(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0;n||(n=v.getWorldMatrix()),d.length=Q,T?d.origin.p(T):d.origin.p(v.position);const L=e.g.fk[2];L.set(0,0,v._scene.useRightHandedSystem?-1:1);const F=e.g.fk[3];return e.j.TransformNormalToRef(L,n,F),e.j.NormalizeToRef(F,d.direction),d}var P,O;B._TmpVector3=(0,F.d)(6,e.j.Zero),B._RayDistant=B.Zero(),B._Smallnum=1e-8,B._Rayl=1e9,P=n.d,(O=T.c)&&(O.prototype.getForwardRay=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,d=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;return f(this,new B(e.j.Zero(),e.j.Zero(),v),v,d,Q)},O.prototype.getForwardRayToRef=function(v){return f(this,v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),P&&(y.d._IsPickingAvailable=!0,P.prototype.createPickingRay=function(v,d,Q,n){return X(this,v,d,Q,n,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),n.d.prototype.createPickingRayToRef=function(v,d,Q,n,T){return m(this,v,d,Q,n,T,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},n.d.prototype.createPickingRayInCameraSpace=function(v,d,Q){return function(v,d,Q,n){const T=B.Zero();return V(v,d,Q,T,n),T}(this,v,d,Q)},n.d.prototype.createPickingRayInCameraSpaceToRef=function(v,d,Q,n){return V(this,v,d,Q,n)},n.d.prototype.pickWithBoundingInfo=function(v,d,Q,n,T){return function(v,d,Q,n,T,L){if(!C.e)return null;const F=S(v,(n=>(v._tempPickingRay||(v._tempPickingRay=B.Zero()),m(v,d,Q,n,v._tempPickingRay,L||null),v._tempPickingRay)),n,T,!0);return F&&(F.ray=X(v,d,Q,e.b.Identity(),L||null)),F}(this,v,d,Q,n,T)},n.d.prototype.Vd=function(v,d,Q,n,T,L){return function(v,d,Q,n,T,L,F){const r=S(v,((n,T)=>(v._tempPickingRay||(v._tempPickingRay=B.Zero()),m(v,d,Q,n,v._tempPickingRay,L||null,!1,T),v._tempPickingRay)),n,T,!1,F);return r&&(r.ray=X(v,d,Q,e.b.Identity(),L||null)),r}(this,v,d,Q,n,T,L)},n.d.prototype.pickWithRay=function(v,d,Q,n){return function(v,d,Q,n,T){const L=S(v,(Q=>(v._pickWithRayInverseMatrix||(v._pickWithRayInverseMatrix=e.b.Identity()),Q.invertToRef(v._pickWithRayInverseMatrix),v._cachedRayForTransform||(v._cachedRayForTransform=B.Zero()),B.TransformToRef(d,v._pickWithRayInverseMatrix,v._cachedRayForTransform),v._cachedRayForTransform)),Q,n,!1,T);return L&&(L.ray=d),L}(this,v,d,Q,n)},n.d.prototype.multiPick=function(v,d,Q,n,T){return function(v,d,Q,n,T,L){return A(v,(n=>X(v,d,Q,n,T||null)),n,L)}(this,v,d,Q,n,T)},n.d.prototype.multiPickWithRay=function(v,d,Q){return function(v,d,Q,n){return A(v,(Q=>(v._pickWithRayInverseMatrix||(v._pickWithRayInverseMatrix=e.b.Identity()),Q.invertToRef(v._pickWithRayInverseMatrix),v._cachedRayForTransform||(v._cachedRayForTransform=B.Zero()),B.TransformToRef(d,v._pickWithRayInverseMatrix,v._cachedRayForTransform),v._cachedRayForTransform)),Q,n)}(this,v,d,Q)}},2147:(v,d,Q)=>{"use strict";var n=Q(573),T=Q(482),L=Q(512),e=Q(593),F=Q(544),r=Q(578);F.d.prototype._partialLoadFile=function(v,d,Q,n){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(v,(v=>{Q[d]=v,Q._internalCount++,6===Q._internalCount&&n(Q)}),void 0,void 0,!0,((v,d)=>{T&&v&&T(v.status+" "+v.statusText,d)}))},F.d.prototype._cascadeLoadFiles=function(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const T=[];T._internalCount=0;for(let L=0;L<6;L++)this._partialLoadFile(Q[L],L,T,d,n)},F.d.prototype._cascadeLoadImgs=function(v,d,Q,n){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5?arguments[5]:void 0;const e=[];e._internalCount=0;for(let F=0;F<6;F++)this._partialLoadImg(n[F],F,e,v,d,Q,T,L)},F.d.prototype._partialLoadImg=function(v,d,Q,n,T,F){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0;const u=(0,e.e)();(0,L.v)(v,(v=>{Q[d]=v,Q._internalCount++,n&&n.removePendingData(u),6===Q._internalCount&&F&&F(T,Q)}),((v,d)=>{n&&n.removePendingData(u),r&&r(v,d)}),n?n.offlineProvider:null,C),n&&n.addPendingData(u)},F.d.prototype.createCubeTextureBase=function(v,d,Q,L){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,B=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,V=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,h=arguments.length>14&&void 0!==arguments[14]&&arguments[14],S=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const A=X||new n.b(this,7);A.isCube=!0,A.url=v,A.generateMipMaps=!L,A._lodGenerationScale=z,A._lodGenerationOffset=B,A._useSRGBBuffer=!!h&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!L),A!==X&&(A.label=v.substring(0,60)),this._doNotHandleContextLost||(A._extension=u,A._files=Q,A._buffer=S);const f=v;this._transformTextureUrl&&!X&&(v=this._transformTextureUrl(v));const P=u??function(v){const d=v.split("?")[0],Q=d.lastIndexOf(".");return Q>-1?d.substring(Q).toLowerCase():""}(v),O=(0,r.e)(P),J=(v,d)=>{A.dispose(),F?F(v,d):v&&T.d.Warn(v)},K=(n,F)=>{v===f?n&&J(n.status+" "+n.statusText,F):(T.d.Warn(`Failed to load ${v}, falling back to the ${f}`),this.createCubeTextureBase(f,d,Q,!!L,e,J,C,u,y,z,B,A,m,V,h,S))};if(O)O.then((n=>{const T=v=>{m&&m(A,v),n.loadCubeData(v,A,y,e,((v,d)=>{J(v,d)}))};S?T(S):Q&&6===Q.length?n.supportCascades?this._cascadeLoadFiles(d,(v=>T(v.map((v=>new Uint8Array(v))))),Q,J):J("Textures type does not support cascades."):this._loadFile(v,(v=>T(new Uint8Array(v))),void 0,void 0,!0,K)}));else{if(!Q||0===Q.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(d,A,((v,d)=>{V&&V(v,d)}),Q,J)}return this._internalTexturesCache.push(A),A}},13253:(v,d,Q)=>{"use strict";Q(482);var n=Q(2072);Q(573),Q(715),Q(566),Q(2132),Q(2083);n.b},12904:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>T});var n=Q(591);class T{constructor(v){this.value=this._toInt(v)}_toInt(v){return 0|v}add(v){return new T(this.value+v.value)}Wd(v){return new T(this.value-v.value)}multiply(v){return new T(Math.imul(this.value,v.value))}divide(v){return new T(this.value/v.value)}getClassName(){return T.ClassName}equals(v){return this.value===v.value}static FromValue(v){return new T(v)}toString(){return this.value.toString()}}T.ClassName="FlowGraphInteger",(0,n.f)("FlowGraphInteger",T)},12916:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>T,f:()=>L});var n=Q(651);class T{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.lk=v}get m(){return this.lk}transformVector(v){return this.transformVectorToRef(v,new n.i)}transformVectorToRef(v,d){return d.x=v.x*this.lk[0]+v.y*this.lk[1],d.y=v.x*this.lk[2]+v.y*this.lk[3],d}mk(){return this.toArray()}toArray(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<4;d++)v[d]=this.lk[d];return v}Yd(v){for(let d=0;d<4;d++)this.lk[d]=v[d];return this}multiplyToRef(v,d){const Q=v.lk,n=this.lk,T=d.lk;return T[0]=Q[0]*n[0]+Q[1]*n[2],T[1]=Q[0]*n[1]+Q[1]*n[3],T[2]=Q[2]*n[0]+Q[3]*n[2],T[3]=Q[2]*n[1]+Q[3]*n[3],d}multiply(v){return this.multiplyToRef(v,new T)}divideToRef(v,d){const Q=this.lk,n=v.lk,T=d.lk;return T[0]=Q[0]/n[0],T[1]=Q[1]/n[1],T[2]=Q[2]/n[2],T[3]=Q[3]/n[3],d}divide(v){return this.divideToRef(v,new T)}addToRef(v,d){const Q=this.lk,n=v.m,T=d.m;return T[0]=Q[0]+n[0],T[1]=Q[1]+n[1],T[2]=Q[2]+n[2],T[3]=Q[3]+n[3],d}add(v){return this.addToRef(v,new T)}subtractToRef(v,d){const Q=this.lk,n=v.m,T=d.m;return T[0]=Q[0]-n[0],T[1]=Q[1]-n[1],T[2]=Q[2]-n[2],T[3]=Q[3]-n[3],d}Wd(v){return this.subtractToRef(v,new T)}transpose(){const v=this.lk;return new T([v[0],v[2],v[1],v[3]])}determinant(){const v=this.lk;return v[0]*v[3]-v[1]*v[2]}inverse(){const v=this.determinant();if(0===v)throw new Error("Matrix is not invertible");const d=this.lk,Q=1/v;return new T([d[3]*Q,-d[1]*Q,-d[2]*Q,d[0]*Q])}equals(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=this.lk,n=v.m;return 0===d?Q[0]===n[0]&&Q[1]===n[1]&&Q[2]===n[2]&&Q[3]===n[3]:Math.abs(Q[0]-n[0])<d&&Math.abs(Q[1]-n[1])<d&&Math.abs(Q[2]-n[2])<d&&Math.abs(Q[3]-n[3])<d}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.lk.join(", ")})`}}class L{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.lk=v}get m(){return this.lk}transformVector(v){return this.transformVectorToRef(v,new n.j)}transformVectorToRef(v,d){const Q=this.lk;return d.x=v.x*Q[0]+v.y*Q[1]+v.z*Q[2],d.y=v.x*Q[3]+v.y*Q[4]+v.z*Q[5],d.z=v.x*Q[6]+v.y*Q[7]+v.z*Q[8],d}multiplyToRef(v,d){const Q=v.lk,n=this.lk,T=d.m;return T[0]=Q[0]*n[0]+Q[1]*n[3]+Q[2]*n[6],T[1]=Q[0]*n[1]+Q[1]*n[4]+Q[2]*n[7],T[2]=Q[0]*n[2]+Q[1]*n[5]+Q[2]*n[8],T[3]=Q[3]*n[0]+Q[4]*n[3]+Q[5]*n[6],T[4]=Q[3]*n[1]+Q[4]*n[4]+Q[5]*n[7],T[5]=Q[3]*n[2]+Q[4]*n[5]+Q[5]*n[8],T[6]=Q[6]*n[0]+Q[7]*n[3]+Q[8]*n[6],T[7]=Q[6]*n[1]+Q[7]*n[4]+Q[8]*n[7],T[8]=Q[6]*n[2]+Q[7]*n[5]+Q[8]*n[8],d}multiply(v){return this.multiplyToRef(v,new L)}divideToRef(v,d){const Q=this.lk,n=v.m,T=d.m;return T[0]=Q[0]/n[0],T[1]=Q[1]/n[1],T[2]=Q[2]/n[2],T[3]=Q[3]/n[3],T[4]=Q[4]/n[4],T[5]=Q[5]/n[5],T[6]=Q[6]/n[6],T[7]=Q[7]/n[7],T[8]=Q[8]/n[8],d}divide(v){return this.divideToRef(v,new L)}addToRef(v,d){const Q=this.lk,n=v.m,T=d.m;return T[0]=Q[0]+n[0],T[1]=Q[1]+n[1],T[2]=Q[2]+n[2],T[3]=Q[3]+n[3],T[4]=Q[4]+n[4],T[5]=Q[5]+n[5],T[6]=Q[6]+n[6],T[7]=Q[7]+n[7],T[8]=Q[8]+n[8],d}add(v){return this.addToRef(v,new L)}subtractToRef(v,d){const Q=this.lk,n=v.m,T=d.m;return T[0]=Q[0]-n[0],T[1]=Q[1]-n[1],T[2]=Q[2]-n[2],T[3]=Q[3]-n[3],T[4]=Q[4]-n[4],T[5]=Q[5]-n[5],T[6]=Q[6]-n[6],T[7]=Q[7]-n[7],T[8]=Q[8]-n[8],d}Wd(v){return this.subtractToRef(v,new L)}toArray(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<9;d++)v[d]=this.lk[d];return v}mk(){return this.toArray()}Yd(v){for(let d=0;d<9;d++)this.lk[d]=v[d];return this}transpose(){const v=this.lk;return new L([v[0],v[3],v[6],v[1],v[4],v[7],v[2],v[5],v[8]])}determinant(){const v=this.lk;return v[0]*(v[4]*v[8]-v[5]*v[7])-v[1]*(v[3]*v[8]-v[5]*v[6])+v[2]*(v[3]*v[7]-v[4]*v[6])}inverse(){const v=this.determinant();if(0===v)throw new Error("Matrix is not invertible");const d=this.lk,Q=1/v;return new L([(d[4]*d[8]-d[5]*d[7])*Q,(d[2]*d[7]-d[1]*d[8])*Q,(d[1]*d[5]-d[2]*d[4])*Q,(d[5]*d[6]-d[3]*d[8])*Q,(d[0]*d[8]-d[2]*d[6])*Q,(d[2]*d[3]-d[0]*d[5])*Q,(d[3]*d[7]-d[4]*d[6])*Q,(d[1]*d[6]-d[0]*d[7])*Q,(d[0]*d[4]-d[1]*d[3])*Q])}equals(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=this.lk,n=v.m;return 0===d?Q[0]===n[0]&&Q[1]===n[1]&&Q[2]===n[2]&&Q[3]===n[3]&&Q[4]===n[4]&&Q[5]===n[5]&&Q[6]===n[6]&&Q[7]===n[7]&&Q[8]===n[8]:Math.abs(Q[0]-n[0])<d&&Math.abs(Q[1]-n[1])<d&&Math.abs(Q[2]-n[2])<d&&Math.abs(Q[3]-n[3])<d&&Math.abs(Q[4]-n[4])<d&&Math.abs(Q[5]-n[5])<d&&Math.abs(Q[6]-n[6])<d&&Math.abs(Q[7]-n[7])<d&&Math.abs(Q[8]-n[8])<d}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.lk.join(", ")})`}}},12921:(v,d,Q)=>{"use strict";var n;function T(v,d,Q,n){switch(d){case"Animation":return n?v.animations.find((v=>v.uniqueId===Q))??null:v.animations[Q]??null;case"AnimationGroup":return n?v.animationGroups.find((v=>v.uniqueId===Q))??null:v.animationGroups[Q]??null;case"Mesh":return n?v.meshes.find((v=>v.uniqueId===Q))??null:v.meshes[Q]??null;case"Material":return n?v.materials.find((v=>v.uniqueId===Q))??null:v.materials[Q]??null;case"_j":return n?v.cameras.find((v=>v.uniqueId===Q))??null:v.cameras[Q]??null;case"Light":return n?v.lights.find((v=>v.uniqueId===Q))??null:v.lights[Q]??null;default:return null}}Q.d(d,{c:()=>T}),function(v){v.Animation="Animation",v.AnimationGroup="AnimationGroup",v.Mesh="Mesh",v.Material="Material",v._j="_j",v.Light="Light"}(n||(n={}))},12962:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>T});var n=Q(12966);class T extends n.d{constructor(v,d){if(super(v),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),d)for(const Q of d)this._eventsSignalOutputs[Q]=this._registerSignalOutput(Q+"Event")}_executeOnTick(v){}_startPendingTasks(v){v._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(v),this._resetAfterCanceled(v)),this._preparePendingTasks(v),v._addPendingBlock(this),this.out._activateSignal(v),v._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(v){v._deleteExecutionVariable(this,"_initialized"),v._removePendingBlock(this)}}},12934:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>C});var n=Q(593),T=Q(591),L=Q(12943),e=Q(473),F=Q(12899);class r extends L.e{constructor(v,d,Q,n){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.defaultValue,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(v,d,Q),this.richType=n,this._defaultValue=T,this._optional=L,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new e.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(v){this._isDisabled!==v&&(this._isDisabled=v,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(v,d){d._getConnectionValue(this)!==v&&(d._setConnectionValue(this,v),this.onValueChangedObservable.notifyObservers(v))}resetToDefaultValue(v){v._setConnectionValue(this,this._defaultValue)}connectTo(v){this._isDisabled||super.connectTo(v)}_getValueOrDefault(v){const d=v._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(d):d}getValue(v){if(1===this.connectionType){v._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(v);const d=this._getValueOrDefault(v);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}const d=this.isConnected()?this._connectedPoint[0].getValue(v):this._getValueOrDefault(v);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.richType={},this.richType.serialize(v.richType),v.optional=this._optional,(0,F.e)("defaultValue",this._defaultValue,v)}}(0,T.f)("FlowGraphDataConnection",r);class C{constructor(v){var d;this.config=v,this.uniqueId=(0,n.e)(),this.name=(null===(d=this.config)||void 0===d?void 0:d.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(v){}registerDataInput(v,d,Q){const n=new r(v,0,this,d,Q);return this.dataInputs.push(n),n}registerDataOutput(v,d,Q){const n=new r(v,1,this,d,Q);return this.dataOutputs.push(n),n}getDataInput(v){return this.dataInputs.find((d=>d.name===v))}getDataOutput(v){return this.dataOutputs.find((d=>d.name===v))}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.e;if(v.uniqueId=this.uniqueId,v.config={},this.config){const Q=this.config,n=Object.keys(Q);for(const T of n)d(T,Q[T],v.config)}v.dataInputs=[],v.dataOutputs=[],v.className=this.getClassName();for(const Q of this.dataInputs){const d={};Q.serialize(d),v.dataInputs.push(d)}for(const Q of this.dataOutputs){const d={};Q.serialize(d),v.dataOutputs.push(d)}}deserialize(v){}_log(v,d,Q){var n;null===(n=v.logger)||void 0===n||n.addLogItem({action:d,payload:Q,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12943:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>L});var n,T=Q(593);!function(v){v[v.Input=0]="Input",v[v.Output=1]="Output"}(n||(n={}));class L{constructor(v,d,Q){this._ownerBlock=Q,this._connectedPoint=[],this.uniqueId=(0,T.e)(),this.connectedPointIds=[],this.name=v,this._connectionType=d}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(v){if(this._connectionType===v._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||v._isSingularConnection()&&v._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(v),v._connectedPoint.push(this)}disconnectFrom(v){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=this._connectedPoint.indexOf(v),n=v._connectedPoint.indexOf(this);-1!==Q&&-1!==n&&(d&&this._connectedPoint.splice(Q,1),v._connectedPoint.splice(n,1))}disconnectFromAll(){for(const v of this._connectedPoint)this.disconnectFrom(v,!1);this._connectedPoint.length=0}dispose(){for(const v of this._connectedPoint)this.disconnectFrom(v)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v.uniqueId=this.uniqueId,v.name=this.name,v._connectionType=this._connectionType,v.connectedPointIds=[],v.className=this.getClassName();for(const d of this._connectedPoint)v.connectedPointIds.push(d.uniqueId)}getClassName(){return"FGConnection"}deserialize(v){this.uniqueId=v.uniqueId,this.name=v.name,this._connectionType=v._connectionType,this.connectedPointIds=v.connectedPointIds}}},12897:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>A});var n,T=Q(473),L=Q(620),e=Q(629),F=Q(593),r=Q(12899),C=Q(12921),u=Q(482);!function(v){v.ExecuteBlock="ExecuteBlock",v.ExecuteEvent="ExecuteEvent",v.TriggerConnection="TriggerConnection",v.ContextVariableSet="ContextVariableSet",v.GlobalVariableSet="GlobalVariableSet",v.GlobalVariableDelete="GlobalVariableDelete",v.GlobalVariableGet="GlobalVariableGet",v.AddConnection="AddConnection",v.GetConnectionValue="GetConnectionValue",v.SetConnectionValue="SetConnectionValue",v.ActivateSignal="ActivateSignal",v.ContextVariableGet="ContextVariableGet"}(n||(n={}));class y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(v){if(v.time||(v.time=Date.now()),this.log.push(v),this.logToConsole){var d;const Q=null===(d=v.payload)||void 0===d?void 0:d.value;"object"===typeof Q&&Q.getClassName?u.d.Log(`[FGLog] ${v.className}:${v.uniqueId.split("-")[0]} ${v.action} - ${JSON.stringify(Q.getClassName())}: ${Q.toString()}`):u.d.Log(`[FGLog] ${v.className}:${v.uniqueId.split("-")[0]} ${v.action} - ${JSON.stringify(v.payload)}`)}}getItemsOfType(v){return this.log.filter((d=>d.action===v))}}class z{get enableLogging(){return this._enableLogging}set enableLogging(v){this._enableLogging!==v&&(this._enableLogging=v,this._enableLogging?(this.logger=new y,this.logger.logToConsole=!0):this.logger=null)}constructor(v){this.uniqueId=(0,F.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new T.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=v,this.assetsContext=v.assetsContext??v.yd}hasVariable(v){return v in this._userVariables}setVariable(v,d){var Q;this._userVariables[v]=d,null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:v,value:d}})}getAsset(v,d){return(0,C.c)(this.assetsContext,v,d)}getVariable(v){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:v,value:this._userVariables[v]}}),this._userVariables[v]}get userVariables(){return this._userVariables}va(){return this._configuration.yd}_getUniqueIdPrefixedName(v,d){return`${v.uniqueId}_${d}`}_getGlobalContextVariable(v,d){var Q;return null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:v,defaultValue:d,possibleValue:this._globalContextVariables[v]}}),this._hasGlobalContextVariable(v)?this._globalContextVariables[v]:d}_setGlobalContextVariable(v,d){var Q;null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:v,value:d}}),this._globalContextVariables[v]=d}_deleteGlobalContextVariable(v){var d;null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:v}}),delete this._globalContextVariables[v]}_hasGlobalContextVariable(v){return v in this._globalContextVariables}_setExecutionVariable(v,d,Q){this._executionVariables[this._getUniqueIdPrefixedName(v,d)]=Q}_getExecutionVariable(v,d,Q){return this._hasExecutionVariable(v,d)?this._executionVariables[this._getUniqueIdPrefixedName(v,d)]:Q}_deleteExecutionVariable(v,d){delete this._executionVariables[this._getUniqueIdPrefixedName(v,d)]}_hasExecutionVariable(v,d){return this._getUniqueIdPrefixedName(v,d)in this._executionVariables}_hasConnectionValue(v){return v.uniqueId in this._connectionValues}_setConnectionValue(v,d){var Q;this._connectionValues[v.uniqueId]=d,null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:v.uniqueId,value:d}})}_setConnectionValueByKey(v,d){this._connectionValues[v]=d}_getConnectionValue(v){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:v.uniqueId,value:this._connectionValues[v.uniqueId]}}),this._connectionValues[v.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(v){this._pendingBlocks.includes(v)||(this._pendingBlocks.push(v),this._pendingBlocks.sort(((v,d)=>v.priority-d.priority)))}_removePendingBlock(v){const d=this._pendingBlocks.indexOf(v);-1!==d&&this._pendingBlocks.splice(d,1)}_clearPendingBlocks(){for(const v of this._pendingBlocks)v._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(v){var d;this.onNodeExecutedObservable.notifyObservers(v),null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:v.getClassName(),uniqueId:v.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(v){this._setGlobalContextVariable("timeSinceStart",v.timeSinceStart),this._setGlobalContextVariable("deltaTime",v.deltaTime);for(const Q of this._pendingBlocks){var d;null===(d=Q._executeOnTick)||void 0===d||d.call(Q,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.e;v.uniqueId=this.uniqueId,v._userVariables={};for(const n in this._userVariables)d(n,this._userVariables[n],v._userVariables);v._connectionValues={};for(const n in this._connectionValues)d(n,this._connectionValues[n],v._connectionValues);var Q;this.assetsContext!==this.va()&&(v._assetsContext={meshes:this.assetsContext.meshes.map((v=>v.id)),materials:this.assetsContext.materials.map((v=>v.id)),textures:this.assetsContext.textures.map((v=>v.name)),animations:this.assetsContext.animations.map((v=>v.name)),lights:this.assetsContext.lights.map((v=>v.id)),cameras:this.assetsContext.cameras.map((v=>v.id)),om:null===(Q=this.assetsContext.om)||void 0===Q?void 0:Q.map((v=>v.name)),skeletons:this.assetsContext.skeletons.map((v=>v.id)),Ck:this.assetsContext.Ck.map((v=>v.name)),geometries:this.assetsContext.geometries.map((v=>v.id)),multiMaterials:this.assetsContext.multiMaterials.map((v=>v.id)),transformNodes:this.assetsContext.transformNodes.map((v=>v.id))})}getClassName(){return"FlowGraphContext"}}(0,L.b)([(0,e.F)()],z.prototype,"uniqueId",void 0);var B=Q(12929),X=Q(2200);class m{constructor(v){this.onEventTriggeredObservable=new T.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=v,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.kk.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const v=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:v}}),this._startingTime+=v})),this._meshPickedObserver=this._scene.onPointerObservable.add((v=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:v})}),X.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((v=>{const d=v.pointerId,Q=v.mesh,n=this._pointerUnderMeshState[d];!n&&Q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:d,mesh:Q}}):n&&!Q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:d,mesh:n}}):n&&Q&&n!==Q&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:d,mesh:n,over:Q}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:d,mesh:Q,out:n}})),this._pointerUnderMeshState[d]=Q}),X.e.POINTERMOVE)}dispose(){var v,d,Q,n,T;null===(v=this._sceneDisposeObserver)||void 0===v||v.remove(),null===(d=this._sceneReadyObserver)||void 0===d||d.remove(),null===(Q=this._sceneOnBeforeRenderObserver)||void 0===Q||Q.remove(),null===(n=this._meshPickedObserver)||void 0===n||n.remove(),null===(T=this._meshUnderPointerObserver)||void 0===T||T.remove(),this.onEventTriggeredObservable.clear()}}var V,h=Q(12950);!function(v){v[v.Stopped=0]="Stopped",v[v.Started=1]="Started"}(V||(V={}));class S{get state(){return this._state}set state(v){this._state=v,this.onStateChangedObservable.notifyObservers(v)}constructor(v){this.onStateChangedObservable=new T.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=v.yd,this._sceneEventCoordinator=new m(this._scene),this._coordinator=v.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((v=>{for(const d of this._executionContexts){const Q=this._getContextualOrder(v.type,d);for(const n of Q)if(!n._executeEvent(d,v.payload))break}switch(v.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const d of this._executionContexts)d._notifyOnTick(v.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const v=new z({yd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(v),v}getContext(v){return this._executionContexts[v]}addEventBlock(v){if("PointerOver"!==v.type&&"PointerOut"!==v.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==v.type&&this._eventBlocks[v.type].push(v),1===this.state)for(const d of this._executionContexts)v._startPendingTasks(d);else this.onStateChangedObservable.addOnce((d=>{if(1===d)for(const Q of this._executionContexts)v._startPendingTasks(Q)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((v=>{1===v&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const v of this._executionContexts)for(const d in this._eventBlocks){const Q=this._getContextualOrder(d,v);for(const d of Q)d._startPendingTasks(v)}}_getContextualOrder(v,d){const Q=this._eventBlocks[v].sort(((v,d)=>d.initPriority-v.initPriority));if("MeshPick"===v){const v=[];for(const n of Q){const T=n.asset.getValue(d);let L=0;for(;L<Q.length;L++){const v=Q[L].asset.getValue(d);if(T&&v&&(0,h.r)(T,v))break}v.splice(L,0,n)}return v}return Q}dispose(){var v;if(0!==this.state){this.state=0;for(const v of this._executionContexts)v._clearPendingBlocks();this._executionContexts.length=0;for(const v in this._eventBlocks)this._eventBlocks[v].length=0;null===(v=this._eventObserver)||void 0===v||v.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(v){const d=[],Q=new Set;for(const n in this._eventBlocks)for(const v of this._eventBlocks[n])d.push(v),Q.add(v.uniqueId);for(;d.length>0;){const n=d.pop();v(n);for(const v of n.dataInputs)for(const n of v._connectedPoint)Q.has(n._ownerBlock.uniqueId)||(d.push(n._ownerBlock),Q.add(n._ownerBlock.uniqueId));if(n instanceof B.b)for(const v of n.signalOutputs)for(const n of v._connectedPoint)Q.has(n._ownerBlock.uniqueId)||(d.push(n._ownerBlock),Q.add(n._ownerBlock.uniqueId))}}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1?arguments[1]:void 0;v.allBlocks=[],this.visitAllBlocks((d=>{const Q={};d.serialize(Q),v.allBlocks.push(Q)})),v.executionContexts=[];for(const Q of this._executionContexts){const n={};Q.serialize(n,d),v.executionContexts.push(n)}}}class A{constructor(v){this.config=v,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.yd.kk.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.yd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const v=this._executeOnNextFrame.slice(0);if(v.length)for(const d of v){this.notifyCustomEvent(d.id,d.data,!1);const v=this._executeOnNextFrame.findIndex((v=>v.uniqueId===d.uniqueId));-1!==v&&this._executeOnNextFrame.splice(v,1)}}));(A.SceneCoordinators.get(this.config.yd)??[]).push(this)}createGraph(){const v=new S({yd:this.config.yd,coordinator:this});return this._flowGraphs.push(v),v}removeGraph(v){const d=this._flowGraphs.indexOf(v);-1!==d&&(v.dispose(),this._flowGraphs.splice(d,1))}start(){for(const v of this._flowGraphs)v.start()}dispose(){var v,d;for(const T of this._flowGraphs)T.dispose();this._flowGraphs.length=0,null===(v=this._disposeObserver)||void 0===v||v.remove(),null===(d=this._onBeforeRenderObserver)||void 0===d||d.remove();const Q=A.SceneCoordinators.get(this.config.yd)??[],n=Q.indexOf(this);-1!==n&&Q.splice(n,1)}serialize(v,d){v._flowGraphs=[];for(const Q of this._flowGraphs){const n={};Q.serialize(n,d),v._flowGraphs.push(n)}v.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(v){let d=this._customEventsMap.get(v);return d||(d=new T.e,this._customEventsMap.set(v,d)),d}notifyCustomEvent(v,d){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:v,data:d,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(v)){const d=this._eventExecutionCounter.get(v);if(this._eventExecutionCounter.set(v,d+1),d>=A.MaxEventTypeExecutionPerFrame)return void(d===A.MaxEventTypeExecutionPerFrame&&u.d.Warn(`FlowGraphCoordinator: Too many executions of event "${v}".`))}else this._eventExecutionCounter.set(v,1);const Q=this._customEventsMap.get(v);Q&&Q.notifyObservers(d)}}A.MaxEventsPerType=30,A.MaxEventTypeExecutionPerFrame=30,A.SceneCoordinators=new Map},12956:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>T});var n=Q(12962);class T extends n.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(v){v._notifyExecuteNode(this),this.done._activateSignal(v)}}},12929:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>F});var n=Q(12934),T=Q(12943),L=Q(591);class e extends T.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(v){super.connectTo(v),this._connectedPoint.sort(((v,d)=>d.priority-v.priority))}_activateSignal(v){var d;if(null===(d=v.logger)||void 0===d||d.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)v._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(v,this),v._increaseExecutionId();else for(const Q of this._connectedPoint)Q._activateSignal(v)}}(0,L.f)("FlowGraphSignalConnection",e);class F extends n.b{constructor(v){super(v),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(v){const d=new e(v,0,this);return this.signalInputs.push(d),d}_registerSignalOutput(v){const d=new e(v,1,this);return this.signalOutputs.push(d),d}_unregisterSignalInput(v){const d=this.signalInputs.findIndex((d=>d.name===v));-1!==d&&(this.signalInputs[d].dispose(),this.signalInputs.splice(d,1))}_unregisterSignalOutput(v){const d=this.signalOutputs.findIndex((d=>d.name===v));-1!==d&&(this.signalOutputs[d].dispose(),this.signalOutputs.splice(d,1))}_reportError(v,d){this.error.payload="string"===typeof d?new Error(d):d,this.error._activateSignal(v)}getSignalInput(v){return this.signalInputs.find((d=>d.name===v))}getSignalOutput(v){return this.signalOutputs.find((d=>d.name===v))}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.signalInputs=[],v.signalOutputs=[];for(const d of this.signalInputs){const Q={};d.serialize(Q),v.signalInputs.push(Q)}for(const d of this.signalOutputs){const Q={};d.serialize(Q),v.signalOutputs.push(Q)}}deserialize(v){for(let d=0;d<v.signalInputs.length;d++){const Q=this.getSignalInput(v.signalInputs[d].name);if(!Q)throw new Error("Could not find signal input with name "+v.signalInputs[d].name+" in block "+v.className);Q.deserialize(v.signalInputs[d])}for(let d=0;d<v.signalOutputs.length;d++){const Q=this.getSignalOutput(v.signalOutputs[d].name);if(!Q)throw new Error("Could not find signal output with name "+v.signalOutputs[d].name+" in block "+v.className);Q.deserialize(v.signalOutputs[d])}}getClassName(){return"FlowGraphExecutionBlock"}}},12966:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>T});var n=Q(12929);class T extends n.b{constructor(v){super(v),this.out=this._registerSignalOutput("out")}}},12908:(v,d,Q)=>{"use strict";Q.d(d,{C:()=>B,E:()=>X,G:()=>m,K:()=>o,O:()=>g,R:()=>K,U:()=>J,c:()=>C,f:()=>z,h:()=>O,l:()=>V,p:()=>h,t:()=>S,u:()=>y,x:()=>P,y:()=>u});var n,T=Q(651),L=Q(686),e=Q(12904),F=Q(12916);!function(v){v.Any="any",v.String="string",v.Number="number",v.Boolean="boolean",v.Object="object",v.Integer="FlowGraphInteger",v.Vector2="Vector2",v.fk="fk",v.Vector4="Vector4",v.Quaternion="Quaternion",v.Matrix="Matrix",v.Matrix2D="Matrix2D",v.Matrix3D="Matrix3D",v.wk="wk",v.xk="xk"}(n||(n={}));class r{constructor(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=v,this.defaultValue=d,this.animationType=Q}serialize(v){v.typeName=this.typeName,v.defaultValue=this.defaultValue}}const C=new r("any",void 0),u=new r("string",""),y=new r("number",0,0),z=new r("boolean",!1),B=new r("Vector2",T.i.Zero(),5),X=new r("fk",T.j.Zero(),1),m=new r("Vector4",T.k.Zero()),V=new r("Matrix",T.b.Identity(),3),h=new r("Matrix2D",new F.c),S=new r("Matrix3D",new F.f),A=new r("wk",L.c.Black(),4),f=new r("xk",new L.f(0,0,0,0),7),P=new r("Quaternion",T.c.Identity(),2);P.typeTransformer=v=>{if(v.getClassName){if("Vector4"===v.getClassName())return T.c.dk(v.mk());if("fk"===v.getClassName())return T.c.FromEulerVector(v);if("Matrix"===v.getClassName())return T.c.FromRotationMatrix(v)}return v};const O=new r("FlowGraphInteger",new e.b(0),0);function J(v){const d=v;switch(typeof v){case"string":return u;case"number":return y;case"boolean":return z;case"object":if(d.getClassName)switch(d.getClassName()){case"Vector2":return B;case"fk":return X;case"Vector4":return m;case"Matrix":return V;case"wk":return A;case"xk":return f;case"Quaternion":return P;case"FlowGraphInteger":return O;case"Matrix2D":return h;case"Matrix3D":return S}return C;default:return C}}function K(v){switch(v){case"string":return u;case"number":return y;case"boolean":return z;case"Vector2":return B;case"fk":return X;case"Vector4":return m;case"Matrix":return V;case"wk":return A;case"xk":return f;case"Quaternion":return P;case"FlowGraphInteger":return O;case"Matrix2D":return h;case"Matrix3D":return S;default:return C}}function o(v){switch(v){case"number":default:return 0;case"Vector2":return 5;case"fk":return 1;case"Matrix":return 3;case"wk":return 4;case"xk":return 7;case"Quaternion":return 2}}function g(v){switch(v){case 0:return y;case 5:return B;case 1:return X;case 3:return V;case 4:return A;case 7:return f;case 2:return P;default:return C}}},12899:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>u,e:()=>C,g:()=>y});var n=Q(686),T=Q(651),L=Q(12904),e=Q(12908),F=Q(12916);function r(v){return"Vector2"===v||"fk"===v||"Vector4"===v||"Quaternion"===v||"wk"===v||"xk"===v}function C(v,d,Q){var n;const T=(null===d||void 0===d||null===(n=d.getClassName)||void 0===n?void 0:n.call(d))??"";if(r(T)||function(v){return"Matrix"===v||"Matrix2D"===v||"Matrix3D"===v}(T))Q[v]={value:d.mk(),className:T};else if("FlowGraphInteger"===T)Q[v]={value:d.value,className:T};else if(T&&(d.id||d.name))Q[v]={id:d.id,name:d.name,className:T};else{if("object"===typeof d)throw new Error(`Could not serialize value ${d}`);Q[v]=d}}function u(v,d,Q,C){const y=d[v];let z;const B=(null===y||void 0===y?void 0:y.type)??(null===y||void 0===y?void 0:y.className);if(function(v){return"Mesh"===v||"AbstractMesh"===v||"GroundMesh"===v||"InstanceMesh"===v||"LinesMesh"===v||"GoldbergMesh"===v||"GreasedLineMesh"===v||"TrailMesh"===v}(B)){let v=C.meshes.filter((v=>y.id?v.id===y.id:v.name===y.name));0===v.length&&(v=C.transformNodes.filter((v=>y.id?v.id===y.id:v.name===y.name))),z=y.uniqueId?v.find((v=>v.uniqueId===y.uniqueId)):v[0]}else if(r(B))z=function(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===v)return T.i.dk(d);if("fk"===v)return Q&&(d[2]*=-1),T.j.dk(d);if("Vector4"===v)return T.k.dk(d);if("Quaternion"===v)return Q&&(d[2]*=-1,d[3]*=-1),T.c.dk(d);if("wk"===v)return new n.c(d[0],d[1],d[2]);if("xk"===v)return new n.f(d[0],d[1],d[2],d[3]);throw new Error(`Unknown vector class name ${v}`)}(B,y.value);else if(function(v){return"AnimationGroup"===v}(B)){const v=C.animationGroups.filter((v=>v.name===y.name));z=1===v.length?v[0]:v.find((v=>v.uniqueId===y.uniqueId))}else z="Matrix"===B?T.b.dk(y.value):"Matrix2D"===B?new F.c(y.value):"Matrix3D"===B?new F.f(y.value):"FlowGraphInteger"===B?L.b.FromValue(y.value):"number"===B||"string"===B||"boolean"===B?y.value[0]:y&&void 0!==y.value?y.value:Array.isArray(y)?y.reduce(((v,d)=>d.eventData?(v[d.id]={type:(0,e.R)(d.type)},"undefined"!==typeof d.value&&(v[d.id].value=u("value",d,Q,C)),v):v),{}):y;return z}function y(v){return"FlowGraphJsonPointerParserBlock"===v}},12950:(v,d,Q)=>{"use strict";function n(v,d){return!(!v.parent||v.parent!==d&&!n(v.parent,d))}function T(v){if(v.getClassName)return v.getClassName()}function L(v,d){return v===d&&("Vector2"===v||"fk"===v||"Vector4"===v||"Quaternion"===v)}function e(v,d){return v===d&&("Matrix"===v||"Matrix2D"===v||"Matrix3D"===v)}function F(v,d){return"FlowGraphInteger"===v&&"FlowGraphInteger"===d}function r(v,d){const Q="number"===typeof v||"number"===typeof(null===v||void 0===v?void 0:v.value);return Q&&!d?!isNaN(C(v)):Q}function C(v){return"number"===typeof v?v:v.value}Q.d(d,{d:()=>F,h:()=>e,k:()=>L,o:()=>T,r:()=>n,v:()=>C,y:()=>r})},12287:(v,d,Q)=>{"use strict";Q.r(d),Q.d(d,{SceneInstrumentation:()=>L});var n=Q(475),T=Q(2145);class L{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(v){v!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=v,v?(this._onBeforeActiveMeshesEvaluationObserver=this.yd.onBeforeActiveMeshesEvaluationObservable.add((()=>{n.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.yd.onAfterActiveMeshesEvaluationObservable.add((()=>{n.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.yd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(v){v!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=v,v?(this._onBeforeRenderTargetsRenderObserver=this.yd.onBeforeRenderTargetsRenderObservable.add((()=>{n.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.yd.onAfterRenderTargetsRenderObservable.add((()=>{n.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(v){v!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=v,v?(this._onBeforeParticlesRenderingObserver=this.yd.onBeforeParticlesRenderingObservable.add((()=>{n.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.yd.onAfterParticlesRenderingObservable.add((()=>{n.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(v){v!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=v,this.yd.spriteManagers&&(v?(this._onBeforeSpritesRenderingObserver=this.yd.onBeforeSpritesRenderingObservable.add((()=>{n.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.yd.onAfterSpritesRenderingObservable.add((()=>{n.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.yd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(v){v!==this._capturePhysicsTime&&this.yd.onBeforePhysicsObservable&&(this._capturePhysicsTime=v,v?(this._onBeforePhysicsObserver=this.yd.onBeforePhysicsObservable.add((()=>{n.e.StartPerformanceCounter("hb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.yd.onAfterPhysicsObservable.add((()=>{n.e.EndPerformanceCounter("hb"),this._physicsTime.endMonitoring()}))):(this.yd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.yd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(v){v!==this._captureAnimationsTime&&(this._captureAnimationsTime=v,v?this._onAfterAnimationsObserver=this.yd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.yd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(v){this._captureFrameTime=v}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(v){this._captureInterFrameTime=v}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(v){v!==this._captureRenderTime&&(this._captureRenderTime=v,v?(this._onBeforeDrawPhaseObserver=this.yd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),n.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.yd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),n.e.EndPerformanceCounter("Main render")}))):(this.yd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(v){v!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=v,v?(this._onBeforeCameraRenderObserver=this.yd.onBeforeCameraRenderObservable.add((v=>{this._cameraRenderTime.beginMonitoring(),n.e.StartPerformanceCounter(`Rendering camera ${v.name}`)})),this._onAfterCameraRenderObserver=this.yd.onAfterCameraRenderObservable.add((v=>{this._cameraRenderTime.endMonitoring(!1),n.e.EndPerformanceCounter(`Rendering camera ${v.name}`)}))):(this.yd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.yd.getEngine()._drawCalls}constructor(v){this.yd=v,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new T.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new T.e,this._captureFrameTime=!1,this._frameTime=new T.e,this._captureRenderTime=!1,this._renderTime=new T.e,this._captureInterFrameTime=!1,this._interFrameTime=new T.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new T.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new T.e,this._capturePhysicsTime=!1,this._physicsTime=new T.e,this._captureAnimationsTime=!1,this._animationsTime=new T.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new T.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=v.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(n.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.yd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=v.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(n.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.jk(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.jk(),this._captureParticlesRenderTime&&this._particlesRenderTime.jk(),this._captureSpritesRenderTime&&this._spritesRenderTime.jk(),this._captureRenderTime&&this._renderTime.jk(),this._captureCameraRenderTime&&this._cameraRenderTime.jk()}))}dispose(){this._disposed||(this.yd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.yd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.yd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.yd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.yd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.yd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.yd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.yd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.yd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.yd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.yd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.yd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.yd=null,this._disposed=!0)}}},12888:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>u});var n=Q(620),T=Q(629),L=Q(651),e=Q(669),F=Q(12023),r=Q(12074),C=Q(591);e.d.AddNodeConstructor("Light_Type_1",((v,d)=>()=>new u(v,L.j.Zero(),d)));class u extends r.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(v){this._shadowFrustumSize=v,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(v){this._shadowOrthoScale=v,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(v){this._orthoLeft=v}get orthoRight(){return this._orthoRight}set orthoRight(v){this._orthoRight=v}get orthoTop(){return this._orthoTop}set orthoTop(v){this._orthoTop=v}get orthoBottom(){return this._orthoBottom}set orthoBottom(v){this._orthoBottom=v}constructor(v,d,Q){super(v,Q),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=d.scale(-1),this.direction=d}getClassName(){return"ib"}getTypeID(){return F.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(v,d,Q){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(v):this._setDefaultAutoExtendShadowProjectionMatrix(v,d,Q)}_setDefaultFixedFrustumShadowProjectionMatrix(v){const d=this.va().activeCamera;d&&L.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:d.$j,void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,v,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(v,d,Q){const n=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const v=L.j.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let n=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let e=0;e<Q.length;e++){const F=Q[e];if(!F)continue;const r=F.getBoundingInfo().boundingBox;for(let Q=0;Q<r.vectorsWorld.length;Q++)L.j.TransformCoordinatesToRef(r.vectorsWorld[Q],d,v),v.x<this._orthoLeft&&(this._orthoLeft=v.x),v.y<this._orthoBottom&&(this._orthoBottom=v.y),v.x>this._orthoRight&&(this._orthoRight=v.x),v.y>this._orthoTop&&(this._orthoTop=v.y),this.autoCalcShadowZBounds&&(v.z<n&&(n=v.z),v.z>T&&(T=v.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=n,this._shadowMaxZ=T)}const T=this._orthoRight-this._orthoLeft,e=this._orthoTop-this._orthoBottom,F=void 0!==this.shadowMinZ?this.shadowMinZ:(null===n||void 0===n?void 0:n.$j)||0,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===n||void 0===n?void 0:n.maxZ)||1e4,C=this.va().getEngine().useReverseDepthBuffer;L.b.OrthoOffCenterLHToRef(this._orthoLeft-T*this.shadowOrthoScale,this._orthoRight+T*this.shadowOrthoScale,this._orthoBottom-e*this.shadowOrthoScale,this._orthoTop+e*this.shadowOrthoScale,C?r:F,C?F:r,v,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(v,d){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,d),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,d),this)}transferToNodeMaterialEffect(v,d){return this.computeTransformedInformation()?(v.setFloat3(d,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(v.setFloat3(d,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(v){const d=this._scene.getEngine();return!d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:1}getDepthMaxZ(v){const d=this._scene.getEngine();return d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:1}prepareLightSpecificDefines(v,d){v["DIRLIGHT"+d]=!0}}(0,n.b)([(0,T.F)()],u.prototype,"shadowFrustumSize",null),(0,n.b)([(0,T.F)()],u.prototype,"shadowOrthoScale",null),(0,n.b)([(0,T.F)()],u.prototype,"autoUpdateExtends",void 0),(0,n.b)([(0,T.F)()],u.prototype,"autoCalcShadowZBounds",void 0),(0,n.b)([(0,T.F)("orthoLeft")],u.prototype,"_orthoLeft",void 0),(0,n.b)([(0,T.F)("orthoRight")],u.prototype,"_orthoRight",void 0),(0,n.b)([(0,T.F)("orthoTop")],u.prototype,"_orthoTop",void 0),(0,n.b)([(0,T.F)("orthoBottom")],u.prototype,"_orthoBottom",void 0),(0,C.f)("BABYLON.DirectionalLight",u)},13180:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>u});var n=Q(620),T=Q(629),L=Q(651),e=Q(686),F=Q(669),r=Q(12023),C=Q(591);F.d.AddNodeConstructor("Light_Type_3",((v,d)=>()=>new u(v,L.j.Zero(),d)));class u extends r.d{constructor(v,d,Q){super(v,Q),this.groundColor=new e.c(0,0,0),this.direction=d||L.j.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(v){return this.direction=L.j.Normalize(v.Wd(L.j.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(v,d){const Q=L.j.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Q.x,Q.y,Q.z,0,d),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.o),d),this}transferToNodeMaterialEffect(v,d){const Q=L.j.Normalize(this.direction);return v.setFloat3(d,Q.x,Q.y,Q.z),this}ck(){return this._worldMatrix||(this._worldMatrix=L.b.Identity()),this._worldMatrix}getTypeID(){return r.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(v,d){v["HEMILIGHT"+d]=!0}}(0,n.b)([(0,T.i)()],u.prototype,"groundColor",void 0),(0,n.b)([(0,T.C)()],u.prototype,"direction",void 0),(0,C.f)("BABYLON.HemisphericLight",u)},12859:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>y});var n=Q(620),T=Q(629),L=Q(651),e=Q(669),F=Q(12023),r=Q(12074),C=Q(2041),u=Q(591);e.d.AddNodeConstructor("Light_Type_2",((v,d)=>()=>new y(v,L.j.Zero(),L.j.Zero(),0,0,d)));class y extends r.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(v){this._iesProfileTexture!==v&&(this._iesProfileTexture=v,this._iesProfileTexture&&y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(v){this._angle=v,this._cosHalfAngle=Math.cos(.5*v),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(v){this._innerAngle=v,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(v){this._shadowAngleScale=v,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(v){this._projectionTextureLightNear=v,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(v){this._projectionTextureLightFar=v,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(v){this._projectionTextureUpDirection=v,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(v){this._projectionTexture!==v&&(this._projectionTexture=v,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(v){return void 0!==v.onGeneratedObservable}static _IsTexture(v){return void 0!==v.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(v){this._projectionTextureProjectionLightMatrix=v,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(v,d,Q,n,T,e){super(v,e),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=L.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=L.j.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=L.j.Zero(),this._projectionTextureViewLightMatrix=L.b.Zero(),this._projectionTextureProjectionLightMatrix=L.b.Zero(),this._projectionTextureScalingMatrix=L.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=d,this.direction=Q,this.angle=n,this.exponent=T}getClassName(){return"SpotLight"}getTypeID(){return F.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(v){super._setDirection(v),this._projectionTextureViewLightDirty=!0}_setPosition(v){super._setPosition(v),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(v,d,Q){const n=this.va().activeCamera;if(!n)return;this._shadowAngleScale=this._shadowAngleScale||1;const T=this._shadowAngleScale*this._angle,e=void 0!==this.shadowMinZ?this.shadowMinZ:n.$j,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,r=this.va().getEngine().useReverseDepthBuffer;L.b.PerspectiveFovLHToRef(T,1,r?F:e,r?e:F,v,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),L.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const v=this.projectionTextureLightFar,d=this.projectionTextureLightNear,Q=v/(v-d),n=-Q*d,T=1/Math.tan(this._angle/2);L.b.FromValuesToRef(T/1,0,0,0,0,T,0,0,0,0,Q,1,0,0,n,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof C.e){const v=this._projectionTexture.uScale/2,d=this._projectionTexture.vScale/2;L.b.FromValuesToRef(v,0,0,0,0,d,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(v,d){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),v.setMatrix("textureProjectionMatrix"+d,this._projectionTextureMatrix),v.setTexture("projectionLightTexture"+d,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&v.setTexture("iesLightTexture"+d,this._iesProfileTexture),this}transferToEffect(v,d){let Q;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,d),Q=L.j.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,d),Q=L.j.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Q.x,Q.y,Q.z,this._cosHalfAngle,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,d),this}transferToNodeMaterialEffect(v,d){let Q;return Q=this.computeTransformedInformation()?L.j.Normalize(this.transformedDirection):L.j.Normalize(this.direction),this.va().useRightHandedSystem?v.setFloat3(d,-Q.x,-Q.y,-Q.z):v.setFloat3(d,Q.x,Q.y,Q.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(v){const d=this._scene.getEngine(),Q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===v||void 0===v?void 0:v.$j)??0;return d.useReverseDepthBuffer&&d.isNDCHalfZRange?Q:this._scene.getEngine().isNDCHalfZRange?0:Q}getDepthMaxZ(v){const d=this._scene.getEngine(),Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===v||void 0===v?void 0:v.maxZ)??1e4;return d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:Q}prepareLightSpecificDefines(v,d){v["SPOTLIGHT"+d]=!0,v["PROJECTEDLIGHTTEXTURE"+d]=!(!this.projectionTexture||!this.projectionTexture.isReady()),v["IESLIGHTTEXTURE"+d]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,n.b)([(0,T.F)()],y.prototype,"angle",null),(0,n.b)([(0,T.F)()],y.prototype,"innerAngle",null),(0,n.b)([(0,T.F)()],y.prototype,"shadowAngleScale",null),(0,n.b)([(0,T.F)()],y.prototype,"exponent",void 0),(0,n.b)([(0,T.F)()],y.prototype,"projectionTextureLightNear",null),(0,n.b)([(0,T.F)()],y.prototype,"projectionTextureLightFar",null),(0,n.b)([(0,T.F)()],y.prototype,"projectionTextureUpDirection",null),(0,n.b)([(0,T.x)("projectedLightTexture")],y.prototype,"_projectionTexture",void 0),(0,u.f)("BABYLON.SpotLight",y)},12568:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>e,f:()=>L,h:()=>F});const n={},T={};function L(v,d){n[v]=d}function e(v,d){T[v]=d}function F(v){return T[v]?T[v]:null}},12463:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>J,f:()=>x});var n,T=Q(475),L=Q(473),e=Q(2167),F=Q(508),r=Q(482),C=Q(786),u=Q(512),y=Q(520),z=Q(593),B=Q(544),X=Q(501);!function(v){v[v.Clean=0]="Clean",v[v.Stop=1]="Stop",v[v.Sync=2]="Sync",v[v.NoSync=3]="NoSync"}(n||(n={}));const m=new L.e,V={};let h=!1;function S(){return V[".babylon"]}function A(v,d){const Q=V[v];return Q||(r.d.Warn("Unable to find a plugin to load "+v+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),d?S():void 0)}function f(v,d,Q){let n="Unable to load from "+(v.rawData?"binary data":v.url);return d?n+=`: ${d}`:Q&&(n+=`: ${Q}`),n}async function P(v,d,Q,n,T,L,e,F,r){var C;const y="data:"===(z=v.url).substring(0,5)?z.substring(5):null;var z;if(v.rawData&&!e)throw"When using ArrayBufferView to load data the file extension must be provided.";const h=y||e?"":function(v){const d=v.indexOf("?");-1!==d&&(v=v.substring(0,d));const Q=v.lastIndexOf(".");return v.substring(Q,v.length).toLowerCase()}(v.url);let f=e?A(e,!0):y?function(v){for(const d in V){const Q=V[d].plugin;if(Q.canDirectLoad&&Q.canDirectLoad(v))return V[d]}return S()}(v.url):A(h,!1);if(!f&&h){if(v.url&&!v.url.startsWith("blob:")){const d=await async function(v,d){const Q=d.method||"GET";return await new Promise(((n,T)=>{const L=new X.b;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const v={};if(d.responseHeaders)for(const Q of d.responseHeaders)v[Q]=L.getResponseHeader(Q)||"";n({response:L.response,headerValues:v})}else T(`Unable to fetch data from ${v}. Error code: ${L.status}`)})),L.open(Q,v),L.send()}))}(v.url,{method:"HEAD",responseHeaders:["Content-Type"]}),Q=d.headerValues?d.headerValues["Content-Type"]:"";Q&&(f=function(v){for(const d in V){const Q=V[d];if(Q.mimeType===v)return Q}}(Q))}f||(f=S())}if(!f)throw new Error(`No plugin or fallback for ${e??v.url}`);if(!1===(null===r||void 0===r||null===(C=r[f.plugin.name])||void 0===C?void 0:C.enabled))throw new Error(`The '${f.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(v.rawData&&!f.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(v=>{if(f.plugin.createPlugin){const d=f.plugin.createPlugin(r??{});return d instanceof Promise?(d.then(v).catch((v=>{T("Error instantiating plugin.",v)})),null):(v(d),d)}return v(f.plugin),f.plugin})((r=>{var C;if(!r)throw`The loader plugin corresponding to the '${e}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(m.notifyObservers(r),y&&(r.canDirectLoad&&r.canDirectLoad(v.url)||!(0,u.l)(v.url))){if(r.directLoad){const v=r.directLoad(d,y);v instanceof Promise?v.then((v=>{Q(r,v)})).catch((v=>{T("Error in directLoad of _loadData: "+v,v)})):Q(r,v)}else Q(r,y);return}const z=f.isBinary,X=(v,n)=>{d.u?T("Scene has been disposed"):Q(r,v,n)};let V=null,h=!1;null===(C=r.kk)||void 0===C||C.add((()=>{h=!0,V&&(V.abort(),V=null),L()}));const S=()=>{if(h)return;const Q=(v,d)=>{T(null===v||void 0===v?void 0:v.statusText,d)};if(!r.loadFile&&v.rawData)throw"Plugin does not support loading ArrayBufferView.";V=r.loadFile?r.loadFile(d,v.rawData||v.file||v.url,v.rootUrl,X,n,z,Q,F):d._loadFile(v.file||v.url,X,n,!0,z,Q)},A=d.getEngine();let P=A.enableOfflineSupport;if(P){let Q=!1;for(const n of d.disableOfflineSupportExceptionRules)if(n.test(v.url)){Q=!0;break}P=!Q}P&&B.d.OfflineProviderFactory?d.offlineProvider=B.d.OfflineProviderFactory(v.url,S,A.disableManifestCheck):S()}))}function O(v,d){let Q,n,L=null,e=null;if(d)if(d.name)Q=`file:${d.name}`,n=d.name,L=d;else if(ArrayBuffer.isView(d))Q="",n=(0,z.e)(),e=d;else if(d.startsWith("data:"))Q=d,n="";else if(v){const L=d;if("/"===L.substring(0,1))return T.e.Error("Wrong sceneFilename parameter"),null;Q=v+L,n=L}else Q=d,n=T.e.GetFilename(d),v=T.e.GetFolderPath(d);else Q=v,n=T.e.GetFilename(v),v=T.e.GetFolderPath(v);return{url:Q,rootUrl:v,name:n,file:L,rawData:e}}function J(v){if("string"===typeof v.extensions){const d=v.extensions;V[d.toLowerCase()]={plugin:v,isBinary:!1}}else{const d=v.extensions,Q=Object.keys(d);for(const n of Q)V[n.toLowerCase()]={plugin:v,isBinary:d[n].isBinary,mimeType:d[n].mimeType}}}async function K(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.c.LastCreatedScene,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!n)return r.d.Error("No scene available to import mesh to"),null;const B=O(d,Q);if(!B)return null;const X={};n.addPendingData(X);const m=()=>{n.removePendingData(X)},V=(v,d)=>{const Q=f(B,v,d);e?e(n,Q,new y.l(Q,y.h.SceneLoaderError,d)):r.d.Error(Q),m()},h=L?v=>{try{L(v)}catch(d){V("Error in onProgress callback: "+d,d)}}:void 0,S=(v,d,Q,L,e,F,r,C)=>{if(n.importedMeshesFiles.push(B.url),T)try{T(v,d,Q,L,e,F,r,C)}catch(u){V("Error in onSuccess callback: "+u,u)}n.removePendingData(X)};return await P(B,n,((d,Q,T)=>{if(d.rewriteRootURL&&(B.rootUrl=d.rewriteRootURL(B.rootUrl,T)),d.importMesh){const T=[],L=[],e=[];if(!d.importMesh(v,n,Q,B.rootUrl,T,L,e,V))return;n.loadingPluginName=d.name,S(T,L,e,[],[],[],[],[])}else{d.importMeshAsync(v,n,Q,B.rootUrl,h,B.name).then((v=>{n.loadingPluginName=d.name,S(v.meshes,v.Ck,v.skeletons,v.animationGroups,v.transformNodes,v.geometries,v.lights,v.spriteManagers)})).catch((v=>{V(v.message,v)}))}}),h,V,m,C,u,z)}async function o(v,d,Q,n,T,L,e,F){return await new Promise(((r,C)=>{try{K(v,d,Q,n,((v,d,Q,n,T,L,e,F)=>{r({meshes:v,Ck:d,skeletons:Q,animationGroups:n,transformNodes:T,geometries:L,lights:e,spriteManagers:F})}),T,((v,d,Q)=>{C(Q||new Error(d))}),L,e,F).catch(C)}catch(y){C(y)}}))}async function g(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.c.LastCreatedEngine,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};Q?await M(v,d,new e.d(Q),n,L,r,C,u,y):T.e.Error("No engine available")}async function R(v,d,Q,n,T,L,e){return await new Promise(((F,r)=>{g(v,d,Q,(v=>{F(v)}),n,((v,d,Q)=>{r(Q||new Error(d))}),T,L,e)}))}async function M(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.c.LastCreatedScene,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return r.d.Error("No scene available to append to"),null;const B=O(v,d);if(!B)return null;const X={};Q.addPendingData(X);const m=()=>{Q.removePendingData(X)};C.e.ShowLoadingScreen&&!h&&(h=!0,Q.getEngine().displayLoadingUI(),Q.executeWhenReady((()=>{Q.getEngine().hideLoadingUI(),h=!1})));const V=(v,d)=>{const n=f(B,v,d);L?L(Q,n,new y.l(n,y.h.SceneLoaderError,d)):r.d.Error(n),m()},S=T?v=>{try{T(v)}catch(d){V("Error in onProgress callback",d)}}:void 0,A=()=>{if(n)try{n(Q)}catch(v){V("Error in onSuccess callback",v)}Q.removePendingData(X)};return await P(B,Q,((v,d)=>{if(v.load){if(!v.load(Q,d,B.rootUrl,V))return;Q.loadingPluginName=v.name,A()}else{v.loadAsync(Q,d,B.rootUrl,S,B.name).then((()=>{Q.loadingPluginName=v.name,A()})).catch((v=>{V(v.message,v)}))}}),S,V,m,e,u,z)}async function Y(v,d,Q,n,T,L,e){return await new Promise(((F,r)=>{try{M(v,d,Q,(v=>{F(v)}),n,((v,d,Q)=>{r(Q||new Error(d))}),T,L,e).catch(r)}catch(y){r(y)}}))}async function D(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.c.LastCreatedScene,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return r.d.Error("No scene available to load asset container to"),null;const z=O(v,d);if(!z)return null;const B={};Q.addPendingData(B);const X=()=>{Q.removePendingData(B)},m=(v,d)=>{const n=f(z,v,d);L?L(Q,n,new y.l(n,y.h.SceneLoaderError,d)):r.d.Error(n),X()},V=T?v=>{try{T(v)}catch(d){m("Error in onProgress callback",d)}}:void 0,h=v=>{if(n)try{n(v)}catch(d){m("Error in onSuccess callback",d)}Q.removePendingData(B)};return await P(z,Q,((v,d)=>{if(v.loadAssetContainer){const n=v.loadAssetContainer(Q,d,z.rootUrl,m);if(!n)return;n.populateRootNodes(),Q.loadingPluginName=v.name,h(n)}else if(v.loadAssetContainerAsync){v.loadAssetContainerAsync(Q,d,z.rootUrl,V,z.name).then((d=>{d.populateRootNodes(),Q.loadingPluginName=v.name,h(d)})).catch((v=>{m(v.message,v)}))}else m("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,m,X,e,C,u)}async function i(v,d,Q,n,T,L,e){return await new Promise(((F,r)=>{try{D(v,d,Q,(v=>{F(v)}),n,((v,d,Q)=>{r(Q||new Error(d))}),T,L,e).catch(r)}catch(y){r(y)}}))}async function Z(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.c.LastCreatedScene,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Q)return void r.d.Error("No scene available to load animations to");if(n){for(const n of Q.animatables)n.reset();Q.stopAllAnimations();const v=Q.animationGroups.slice();for(const Q of v)Q.dispose();const d=Q.getNodes();for(const Q of d)Q.animations&&(Q.animations=[])}else switch(T){case 0:const v=Q.animationGroups.slice();for(const d of v)d.dispose();break;case 1:for(const d of Q.animationGroups)d.stop();break;case 2:for(const d of Q.animationGroups)d.reset(),d.restart();break;case 3:break;default:return void r.d.Error("Unknown animation group loading mode value '"+T+"'")}const X=Q.animatables.length;await D(v,d,Q,(v=>{v.mergeAnimationsTo(Q,Q.animatables.slice(X),L),v.dispose(),Q.onAnimationFileImportedObservable.notifyObservers(Q),e&&e(Q)}),C,u,y,z,B)}async function j(v,d,Q,n,T,L,e,F,r,C){return await new Promise(((u,z)=>{try{Z(v,d,Q,n,T,L,(v=>{u(v)}),e,((v,d,Q)=>{z(Q||new Error(d))}),F,r,C).catch(z)}catch(y){z(y)}}))}class x{static get ForceFullSceneLoadingForIncremental(){return C.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(v){C.e.ForceFullSceneLoadingForIncremental=v}static get ShowLoadingScreen(){return C.e.ShowLoadingScreen}static set ShowLoadingScreen(v){C.e.ShowLoadingScreen=v}static get loggingLevel(){return C.e.loggingLevel}static set loggingLevel(v){C.e.loggingLevel=v}static get CleanBoneMatrixWeights(){return C.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(v){C.e.CleanBoneMatrixWeights=v}static GetDefaultPlugin(){return S()}static GetPluginForExtension(v){var d;return null===(d=A(v,!0))||void 0===d?void 0:d.plugin}static IsPluginForExtensionAvailable(v){return function(v){return!!V[v]}(v)}static RegisterPlugin(v){J(v)}static ImportMesh(v,d,Q,n,T,L,e,r,C){K(v,d,Q,n,T,L,e,r,C).catch((v=>null===e||void 0===e?void 0:e(F.c.LastCreatedScene,null===v||void 0===v?void 0:v.message,v)))}static async ImportMeshAsync(v,d,Q,n,T,L,e){return await o(v,d,Q,n,T,L,e)}static Load(v,d,Q,n,T,L,e,r){g(v,d,Q,n,T,L,e,r).catch((v=>null===L||void 0===L?void 0:L(F.c.LastCreatedScene,null===v||void 0===v?void 0:v.message,v)))}static async LoadAsync(v,d,Q,n,T,L){return await R(v,d,Q,n,T,L)}static Append(v,d,Q,n,T,L,e,r){M(v,d,Q,n,T,L,e,r).catch((v=>null===L||void 0===L?void 0:L(Q??F.c.LastCreatedScene,null===v||void 0===v?void 0:v.message,v)))}static async AppendAsync(v,d,Q,n,T,L){return await Y(v,d,Q,n,T,L)}static LoadAssetContainer(v,d,Q,n,T,L,e,r){D(v,d,Q,n,T,L,e,r).catch((v=>null===L||void 0===L?void 0:L(Q??F.c.LastCreatedScene,null===v||void 0===v?void 0:v.message,v)))}static async LoadAssetContainerAsync(v,d,Q,n,T,L){return await i(v,d,Q,n,T,L)}static ImportAnimations(v,d,Q,n,T,L,e,r,C,u,y){Z(v,d,Q,n,T,L,e,r,C,u,y).catch((v=>null===C||void 0===C?void 0:C(Q??F.c.LastCreatedScene,null===v||void 0===v?void 0:v.message,v)))}static async ImportAnimationsAsync(v,d,Q,n,T,L,e,F,r,C,u){return await j(v,d,Q,n,T,L,F,C,u)}}x.NO_LOGGING=0,x.MINIMAL_LOGGING=1,x.SUMMARY_LOGGING=2,x.DETAILED_LOGGING=3,x.OnPluginActivatedObservable=m},12871:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>z});var n=Q(620),T=Q(629),L=Q(475),e=Q(651),F=Q(2045),r=Q(2041),C=Q(591),u=Q(473),y=Q(677);Q(2147);class z extends F.e{set boundingBoxSize(v){if(this._boundingBoxSize&&this._boundingBoxSize.equals(v))return;this._boundingBoxSize=v;const d=this.va();d&&d.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(v){this._rotationY=v,this.setReflectionTextureMatrix(e.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(v,d,Q){let n="";for(const T of v)n+=T;return new z(n,d,null,Q,v)}static CreateFromPrefilteredData(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const T=d.useDelayedTextureLoading;d.useDelayedTextureLoading=!1;const L=new z(v,d,null,!1,null,null,null,void 0,!0,Q,n);return d.useDelayedTextureLoading=T,L}constructor(v,d){var Q;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],B=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]&&arguments[10],m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,h=arguments.length>13?arguments[13]:void 0,S=arguments.length>14?arguments[14]:void 0;super(d),this.onLoadObservable=new u.e,this.boundingBoxPosition=e.j.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new e.b,this._buffer=null,this.name=v,this.url=v,this._noMipmap=T,this.ui=!1,this.isCube=!0,this._textureMatrix=e.b.Identity(),this.coordinatesMode=r.e.CUBIC_MODE;let A=null,f=null;null===n||Array.isArray(n)?(this._noMipmap=T,this._format=y,this._createPolynomials=X,A=n,this._loaderOptions=h,this._useSRGBBuffer=S,this._lodScale=m,this._lodOffset=V):(A=n.extensions??null,this._noMipmap=n.noMipmap??!1,L=n.files??null,f=n.buffer??null,this._format=n.format??5,z=n.prefiltered??!1,B=n.forcedExtension??null,this._createPolynomials=n.createPolynomials??!1,this._lodScale=n.lodScale??.8,this._lodOffset=n.lodOffset??0,this._loaderOptions=n.loaderOptions,this._useSRGBBuffer=n.useSRGBBuffer,F=n.X??null,C=n.onError??null),(v||L)&&this.updateURL(v,B,F,z,C,A,null===(Q=this.va())||void 0===Q?void 0:Q.useDelayedTextureLoading,L,f)}getClassName(){return"CubeTexture"}updateURL(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=v),this.url=v,d&&(this._forcedExtension=d);const C=v.lastIndexOf("."),u=d||(C>-1?v.substring(C).toLowerCase():""),y=0===u.indexOf(".dds"),z=0===u.indexOf(".env"),B=0===u.indexOf(".basis");if(z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=n,n&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),F)this._files=F;else if(B||z||y||L||(L=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,L){for(let d=0;d<L.length;d++)this._files.push(v+L[d]);this._extensions=L}this._buffer=r,e?(this.delayLoadState=4,this._delayedOnLoad=Q,this._delayedOnError=T):this._loadTexture(Q,T)}delayLoad(v){4===this.delayLoadState&&(v&&(this._forcedExtension=v),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(v){var d,Q;if(v.updateFlag===this._textureMatrix.updateFlag)return;v.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Q=this.va())||void 0===Q||Q.markAllMaterialsAsDirty(1,(v=>-1!==v.getActiveTextures().indexOf(this))));if(this._textureMatrix=v,null===(d=this.va())||void 0===d||!d.useRightHandedSystem)return;const n=e.g.fk[0],T=e.g.Quaternion[0],L=e.g.fk[1];this._textureMatrix.decompose(n,T,L),T.z*=-1,T.w*=-1,e.b.ComposeToRef(n,T,L,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var v;return null!==(v=this.va())&&void 0!==v&&v.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=this.va(),n=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const T=()=>{var d;(this.onLoadObservable.notifyObservers(this),n)&&(n.dispose(),null===(d=this.va())||void 0===d||d.markAllMaterialsAsDirty(1));v&&v()},e=(v,Q)=>{this._loadingError=!0,this._errorObject={message:v,exception:Q},d&&d(v,Q),r.e.OnTextureLoadErrorObservable.notifyObservers(this)};var F;this._texture?this._texture.isReady?L.e.SetImmediate((()=>T())):this._texture.onLoadedObservable.add((()=>T())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Q,this._lodScale,this._lodOffset,v,e,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Q,this._files,this._noMipmap,v,e,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(F=this._texture)||void 0===F||F.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(v,d,Q){const n=y.e.Parse((()=>{let n=!1;return v.prefiltered&&(n=v.prefiltered),new z(Q+(v.url??v.name),d,v.extensions,!1,v.files||null,null,null,void 0,n,v.forcedExtension)}),v,d);if(v.boundingBoxPosition&&(n.boundingBoxPosition=e.j.dk(v.boundingBoxPosition)),v.boundingBoxSize&&(n.boundingBoxSize=e.j.dk(v.boundingBoxSize)),v.animations)for(let T=0;T<v.animations.length;T++){const d=v.animations[T],Q=(0,C.e)("BABYLON.Animation");Q&&n.animations.push(Q.Parse(d))}return n}clone(){let v=0;const d=y.e.Clone((()=>{const d=new z(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return v=d.uniqueId,d}),this);return d.uniqueId=v,d}}(0,n.b)([(0,T.F)()],z.prototype,"url",void 0),(0,n.b)([(0,T.C)()],z.prototype,"boundingBoxPosition",void 0),(0,n.b)([(0,T.C)()],z.prototype,"boundingBoxSize",null),(0,n.b)([(0,T.F)("rotationY")],z.prototype,"rotationY",null),(0,n.b)([(0,T.F)("files")],z.prototype,"_files",void 0),(0,n.b)([(0,T.F)("forcedExtension")],z.prototype,"_forcedExtension",void 0),(0,n.b)([(0,T.F)("extensions")],z.prototype,"_extensions",void 0),(0,n.b)([(0,T.r)("textureMatrix")],z.prototype,"_textureMatrix",void 0),(0,n.b)([(0,T.r)("textureMatrixRefraction")],z.prototype,"_textureMatrixRefraction",void 0),r.e._CubeTextureParser=z.Parse,(0,C.f)("BABYLON.CubeTexture",z)},13191:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>r});var n=Q(482),T=Q(2041),L=Q(601),e=Q(2079),F=Q(573);e.ThinEngine.prototype.createDynamicTexture=function(v,d,Q,n){const T=new F.b(this,4);return T.baseWidth=v,T.baseHeight=d,Q&&(v=this.needPOTTextures?(0,L.e)(v,this._caps.maxTextureSize):v,d=this.needPOTTextures?(0,L.e)(d,this._caps.maxTextureSize):d),T.width=v,T.height=d,T.isReady=!1,T.generateMipMaps=Q,T.samplingMode=n,this.updateTextureSamplingMode(n,T),this._internalTexturesCache.push(T),T},e.ThinEngine.prototype.updateDynamicTexture=function(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!v)return;const e=this._gl,F=e.TEXTURE_2D,r=this._bindTextureDirectly(F,v,!0,L);this._unpackFlipY(void 0===Q?v.invertY:Q),n&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const C=this._getWebGLTextureType(v.type),u=this._getInternalFormat(T||v.format),y=this._getRGBABufferInternalSizedFormat(v.type,u);e.texImage2D(F,0,y,u,C,d),v.generateMipMaps&&e.generateMipmap(F),r||this._bindTextureDirectly(F,null),n&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),T&&(v.format=T),v._dynamicTextureSource=d,v._premulAlpha=n,v.invertY=Q||!1,v.isReady=!0};class r extends T.e{constructor(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,F=arguments.length>6?arguments[6]:void 0;const r=!Q||Q._isScene;super(null,r?Q:null===Q||void 0===Q?void 0:Q.yd,r?!n:Q,F,L,void 0,void 0,void 0,void 0,e),this.name=v,this.wrapU=T.e.CLAMP_ADDRESSMODE,this.wrapV=T.e.CLAMP_ADDRESSMODE,this._generateMipMaps=n;const C=this._getEngine();if(!C)return;if(d.getContext)this._canvas=d,this._ownCanvas=!1,this._texture=C.createDynamicTexture(this._canvas.width,this._canvas.height,n,L);else{this._canvas=C.createCanvas(1,1),this._ownCanvas=!0;const v=d;v.width||0===v.width?this._texture=C.createDynamicTexture(v.width,v.height,n,L):this._texture=C.createDynamicTexture(d,d,n,L)}const u=this.getSize();this._canvas.width!==u.width&&(this._canvas.width=u.width),this._canvas.height!==u.height&&(this._canvas.height=u.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(v){this._canvas.width=v.width,this._canvas.height=v.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(v.width,v.height,this._generateMipMaps,this.samplingMode)}scale(v){const d=this.getSize();d.width*=v,d.height*=v,this._recreate(d)}scaleTo(v,d){const Q=this.getSize();Q.width=v,Q.height=d,this._recreate(Q)}getContext(){return this._context}clear(v){const d=this.getSize();v&&(this._context.fillStyle=v),this._context.clearRect(0,0,d.width,d.height)}update(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===v||v,d,this._format||void 0,void 0,Q)}drawText(v,d,Q,n,T,L,e){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const r=this.getSize();if(L&&(this._context.fillStyle=L,this._context.fillRect(0,0,r.width,r.height)),this._context.font=n,null===d||void 0===d){const Q=this._context.measureText(v);d=(r.width-Q.width)/2}if(null===Q||void 0===Q){const v=parseInt(n.replace(/\D/g,""));Q=r.height/2+v/3.65}this._context.fillStyle=T||"",this._context.fillText(v,d,Q),F&&this.update(e)}dispose(){var v,d;(super.dispose(),this._ownCanvas)&&(null===(v=this._canvas)||void 0===v||null===(d=v.remove)||void 0===d||d.call(v));this._canvas=null,this._context=null}clone(){const v=this.va();if(!v)return this;const d=this.getSize(),Q=new r(this.name,d,v,this._generateMipMaps);return Q.ui=this.ui,Q.level=this.level,Q.wrapU=this.wrapU,Q.wrapV=this.wrapV,Q}serialize(){const v=this.va();v&&!v.isReady()&&n.d.Warn("The scene must be ready before serializing the dynamic texture");const d=super.serialize();return r._IsCanvasElement(this._canvas)&&(d.base64String=this._canvas.toDataURL()),d.invertY=this._invertY,d.samplingMode=this.samplingMode,d}static _IsCanvasElement(v){return void 0!==v.toDataURL}_rebuild(){this.update()}}},12791:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>T});var n=Q(2041);class T extends n.e{get depth(){return this._depth}constructor(v,d,Q,T,L,e){let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n.e.TRILINEAR_SAMPLINGMODE,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10?arguments[10]:void 0;super(null,e,!F,r),this.format=L,this._texture=e.getEngine().createRawTexture2DArray(v,d,Q,T,L,F,r,C,null,u,y),this._depth=T,this.is2DArray=!0}update(v){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,v,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(v,d,Q,n,L){return new T(v,d,Q,n,5,L,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12582:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>F,g:()=>r,h:()=>L,i:()=>e});var n=Q(664),T=Q(651);function L(v,d){return`{X: ${v.x.toFixed(d)} Y: ${v.y.toFixed(d)}}`}function e(v,d){return`{X: ${v._x.toFixed(d)} Y: ${v._y.toFixed(d)} Z: ${v._z.toFixed(d)}}`}function F(v,d){return 2*Math.acos((0,n.Clamp)(T.c.Dot(v,d)))}function r(v,d){const Q=new T.c;return function(v,d,Q){const L=T.j.Cross(v,d),e=Math.acos((0,n.Clamp)(T.j.Dot(v,d),-1,1));T.c.RotationAxisToRef(L,e,Q)}(v,d,Q),Q}},12402:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>C});var n=Q(651),T=Q(686),L=Q(470),e=Q(725),F=Q(791);Q(12411);function r(v){let d=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Q=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],L=[];let r=[];const C=v.width||v.size||1,u=v.height||v.size||1,y=v.depth||v.size||1,z=v.wrap||!1;let B=void 0===v.topBaseAt?1:v.topBaseAt,X=void 0===v.bottomBaseAt?0:v.bottomBaseAt;B=(B+4)%4,X=(X+4)%4;let m=[2,0,3,1][B],V=[2,0,1,3][X],h=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(z){d=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],h=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let v=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Q=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const n=[17,18,19,16],T=[22,23,20,21];for(;m>0;)v.unshift(v.pop()),n.unshift(n.pop()),m--;for(;V>0;)Q.unshift(Q.pop()),T.unshift(T.pop()),V--;v=v.flat(),Q=Q.flat(),h=h.concat(v).concat(Q),d.push(n[0],n[2],n[3],n[0],n[1],n[2]),d.push(T[0],T[2],T[3],T[0],T[1],T[2])}const S=[C/2,u/2,y/2];r=h.reduce(((v,d,Q)=>v.concat(d*S[Q%3])),[]);const A=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE,f=v.faceUV||new Array(6),P=v.faceColors,O=[];for(let e=0;e<6;e++)void 0===f[e]&&(f[e]=new n.k(0,0,1,1)),P&&void 0===P[e]&&(P[e]=new T.f(1,1,1,1));for(let n=0;n<6;n++)if(L.push(f[n].z,F.d?1-f[n].w:f[n].w),L.push(f[n].x,F.d?1-f[n].w:f[n].w),L.push(f[n].x,F.d?1-f[n].y:f[n].y),L.push(f[n].z,F.d?1-f[n].y:f[n].y),P)for(let v=0;v<4;v++)O.push(P[n].r,P[n].g,P[n].b,P[n].a);e.b._ComputeSides(A,r,d,Q,L,v.frontUVs,v.backUVs);const J=new e.b;if(J.indices=d,J.xa=r,J.ya=Q,J.Aa=L,P){const v=A===e.b.DOUBLESIDE?O.concat(O):O;J.za=v}return J}function C(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new L.b(v,Q);d.sideOrientation=L.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return r(d).Ca(n,d.updatable),n}e.b.CreateBox=r,L.b.CreateBox=function(v,d){return C(v,{size:d,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12411:(v,d,Q)=>{"use strict";Q.d(d,{f:()=>V,b:()=>S,i:()=>h});var n=Q(651),T=Q(686),L=Q(470),e=Q(725),F=Q(706);L.b._GroundMeshParser=(v,d)=>r.Parse(v,d);class r extends L.b{constructor(v,d){super(v,d),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=v,this._subdivisionsY=v,this.subdivide(v);const Q=this;Q.createOrUpdateSubmeshesOctree&&Q.createOrUpdateSubmeshesOctree(d)}getHeightAtCoordinates(v,d){const Q=this.getWorldMatrix(),T=n.g.Matrix[5];Q.invertToRef(T);const L=n.g.fk[8];if(n.j.TransformCoordinatesFromFloatsToRef(v,0,d,T,L),v=L.x,d=L.z,v<this._minX||v>=this._maxX||d<=this._minZ||d>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const e=this._getFacetAt(v,d),F=-(e.x*v+e.z*d+e.w)/e.y;return n.j.TransformCoordinatesFromFloatsToRef(0,F,0,Q,L),L.y}getNormalAtCoordinates(v,d){const Q=new n.j(0,1,0);return this.getNormalAtCoordinatesToRef(v,d,Q),Q}getNormalAtCoordinatesToRef(v,d,Q){const T=this.getWorldMatrix(),L=n.g.Matrix[5];T.invertToRef(L);const e=n.g.fk[8];if(n.j.TransformCoordinatesFromFloatsToRef(v,0,d,L,e),v=e.x,d=e.z,v<this._minX||v>this._maxX||d<this._minZ||d>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(v,d);return n.j.TransformNormalFromFloatsToRef(F.x,F.y,F.z,T,Q),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(v,d){const Q=Math.floor((v+this._maxX)*this._subdivisionsX/this._width),n=Math.floor(-(d+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),T=this._heightQuads[n*this._subdivisionsX+Q];let L;return L=d<T.slope.x*v+T.slope.y?T.facet1:T.facet2,L}_initHeightQuads(){const v=this._subdivisionsX,d=this._subdivisionsY;this._heightQuads=[];for(let Q=0;Q<d;Q++)for(let d=0;d<v;d++){const T={slope:n.i.Zero(),facet1:new n.k(0,0,0,0),facet2:new n.k(0,0,0,0)};this._heightQuads[Q*v+d]=T}return this}_computeHeightQuads(){const v=this.getVerticesData(F.e.PositionKind);if(!v)return this;const d=n.g.fk[3],Q=n.g.fk[2],T=n.g.fk[1],L=n.g.fk[0],e=n.g.fk[4],r=n.g.fk[5],C=n.g.fk[6],u=n.g.fk[7],y=n.g.fk[8];let z=0,B=0,X=0,m=0,V=0,h=0,S=0;const A=this._subdivisionsX,f=this._subdivisionsY;for(let F=0;F<f;F++)for(let f=0;f<A;f++){z=3*f,B=F*(A+1)*3,X=(F+1)*(A+1)*3,d.x=v[B+z],d.y=v[B+z+1],d.z=v[B+z+2],Q.x=v[B+z+3],Q.y=v[B+z+4],Q.z=v[B+z+5],T.x=v[X+z],T.y=v[X+z+1],T.z=v[X+z+2],L.x=v[X+z+3],L.y=v[X+z+4],L.z=v[X+z+5],m=(L.z-d.z)/(L.x-d.x),V=d.z-m*d.x,Q.subtractToRef(d,e),T.subtractToRef(d,r),L.subtractToRef(d,C),n.j.CrossToRef(C,r,u),n.j.CrossToRef(e,C,y),u.normalize(),y.normalize(),h=-(u.x*d.x+u.y*d.y+u.z*d.z),S=-(y.x*Q.x+y.y*Q.y+y.z*Q.z);const P=this._heightQuads[F*A+f];P.slope.ld(m,V),P.facet1.ld(u.x,u.y,u.z,h),P.facet2.ld(y.x,y.y,y.z,S)}return this}serialize(v){super.serialize(v),v.subdivisionsX=this._subdivisionsX,v.subdivisionsY=this._subdivisionsY,v.minX=this._minX,v.maxX=this._maxX,v.$j=this._minZ,v.maxZ=this._maxZ,v.width=this._width,v.height=this._height}static Parse(v,d){const Q=new r(v.name,d);return Q._subdivisionsX=v.subdivisionsX||1,Q._subdivisionsY=v.subdivisionsY||1,Q._minX=v.minX,Q._maxX=v.maxX,Q._minZ=v.$j,Q._maxZ=v.maxZ,Q._width=v.width,Q._height=v.height,Q}}var C=Q(475),u=Q(508),y=Q(658),z=Q(791);function B(v){const d=[],Q=[],T=[],L=[];let F,r;const C=v.width||v.size||1,u=v.height||v.size||1,y=0|(v.subdivisionsX||v.subdivisions||1),B=0|(v.subdivisionsY||v.subdivisions||1);for(F=0;F<=B;F++)for(r=0;r<=y;r++){const v=new n.j(r*C/y-C/2,0,(B-F)*u/B-u/2),d=new n.j(0,1,0);Q.push(v.x,v.y,v.z),T.push(d.x,d.y,d.z),L.push(r/y,z.d?F/B:1-F/B)}for(F=0;F<B;F++)for(r=0;r<y;r++)d.push(r+1+(F+1)*(y+1)),d.push(r+1+F*(y+1)),d.push(r+F*(y+1)),d.push(r+(F+1)*(y+1)),d.push(r+1+(F+1)*(y+1)),d.push(r+F*(y+1));const X=new e.b;return X.indices=d,X.xa=Q,X.ya=T,X.Aa=L,X}function X(v){const d=void 0!==v.xmin&&null!==v.xmin?v.xmin:-1,Q=void 0!==v.zmin&&null!==v.zmin?v.zmin:-1,T=void 0!==v.xmax&&null!==v.xmax?v.xmax:1,L=void 0!==v.zmax&&null!==v.zmax?v.zmax:1,F=v.subdivisions||{w:1,h:1},r=v.precision||{w:1,h:1},C=[],u=[],y=[],z=[];let B,X,m,V;F.h=F.h<1?1:F.h,F.w=F.w<1?1:F.w,r.w=r.w<1?1:r.w,r.h=r.h<1?1:r.h;const h=(T-d)/F.w,S=(L-Q)/F.h;function A(v,d,Q,T){const L=u.length/3,e=r.w+1;for(B=0;B<r.h;B++)for(X=0;X<r.w;X++){const v=[L+X+B*e,L+(X+1)+B*e,L+(X+1)+(B+1)*e,L+X+(B+1)*e];C.push(v[1]),C.push(v[2]),C.push(v[3]),C.push(v[0]),C.push(v[1]),C.push(v[3])}const F=n.j.Zero(),m=new n.j(0,1,0);for(B=0;B<=r.h;B++)for(F.z=B*(T-d)/r.h+d,X=0;X<=r.w;X++)F.x=X*(Q-v)/r.w+v,F.y=0,u.push(F.x,F.y,F.z),y.push(m.x,m.y,m.z),z.push(X/r.w,B/r.h)}for(m=0;m<F.h;m++)for(V=0;V<F.w;V++)A(d+V*h,Q+m*S,d+(V+1)*h,Q+(m+1)*S);const f=new e.b;return f.indices=C,f.xa=u,f.ya=y,f.Aa=z,f}function m(v){const d=[],Q=[],L=[],F=[];let r,C;const u=v.colorFilter||new T.c(.3,.59,.11),z=v.alphaFilter||0;let B=!1;if(v.minHeight>v.maxHeight){B=!0;const d=v.maxHeight;v.maxHeight=v.minHeight,v.minHeight=d}for(r=0;r<=v.subdivisions;r++)for(C=0;C<=v.subdivisions;C++){const d=new n.j(C*v.width/v.subdivisions-v.width/2,0,(v.subdivisions-r)*v.height/v.subdivisions-v.height/2),T=4*(((d.x+v.width/2)/v.width*(v.bufferWidth-1)|0)+((1-(d.z+v.height/2)/v.height)*(v.bufferHeight-1)|0)*v.bufferWidth);let e=v.buffer[T]/255,X=v.buffer[T+1]/255,m=v.buffer[T+2]/255;const V=v.buffer[T+3]/255;B&&(e=1-e,X=1-X,m=1-m);const h=e*u.r+X*u.g+m*u.b;d.y=V>=z?v.minHeight+(v.maxHeight-v.minHeight)*h:v.minHeight-y.b,v.heightBuffer&&(v.heightBuffer[r*(v.subdivisions+1)+C]=d.y),Q.push(d.x,d.y,d.z),L.push(0,0,0),F.push(C/v.subdivisions,1-r/v.subdivisions)}for(r=0;r<v.subdivisions;r++)for(C=0;C<v.subdivisions;C++){const n=C+1+(r+1)*(v.subdivisions+1),T=C+1+r*(v.subdivisions+1),L=C+r*(v.subdivisions+1),e=C+(r+1)*(v.subdivisions+1),F=Q[3*n+1]>=v.minHeight,u=Q[3*T+1]>=v.minHeight,y=Q[3*L+1]>=v.minHeight;F&&u&&y&&(d.push(n),d.push(T),d.push(L));Q[3*e+1]>=v.minHeight&&F&&y&&(d.push(e),d.push(n),d.push(L))}e.b.ComputeNormals(Q,d,L);const X=new e.b;return X.indices=d,X.xa=Q,X.ya=L,X.Aa=F,X}function V(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=new r(v,arguments.length>2?arguments[2]:void 0);Q._setReady(!1),Q._subdivisionsX=d.subdivisionsX||d.subdivisions||1,Q._subdivisionsY=d.subdivisionsY||d.subdivisions||1,Q._width=d.width||1,Q._height=d.height||1,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ;return B(d).Ca(Q,d.updatable),Q._setReady(!0),Q}function h(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new L.b(v,Q);return X(d).Ca(n,d.updatable),n}function S(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=Q.width||10,e=Q.height||10,F=Q.subdivisions||1,y=Q.minHeight||0,z=Q.maxHeight||1,B=Q.colorFilter||new T.c(.3,.59,.11),X=Q.alphaFilter||0,V=Q.updatable,h=Q.onReady;n=n||u.c.LastCreatedScene;const S=new r(v,n);let A;S._subdivisionsX=F,S._subdivisionsY=F,S._width=L,S._height=e,S._maxX=S._width/2,S._maxZ=S._height/2,S._minX=-S._maxX,S._minZ=-S._maxZ,S._setReady(!1),Q.passHeightBufferInCallback&&(A=new Float32Array((F+1)*(F+1)));const f=(v,d,Q)=>{m({width:L,height:e,subdivisions:F,minHeight:y,maxHeight:z,colorFilter:B,buffer:v,bufferWidth:d,bufferHeight:Q,alphaFilter:X,heightBuffer:A}).Ca(S,V),h&&h(S,A),S._setReady(!0)};if("string"===typeof d){const v=v=>{var d;const Q=v.width,T=v.height;if(n.u)return;const L=null===(d=n)||void 0===d?void 0:d.getEngine().resizeImageBitmap(v,Q,T);f(L,Q,T)};C.e.LoadImage(d,v,Q.onError?Q.onError:()=>{},n.offlineProvider)}else f(d.data,d.width,d.height);return S}e.b.CreateGround=B,e.b.CreateTiledGround=X,e.b.CreateGroundFromHeightMap=m,L.b.CreateGround=(v,d,Q,n,T,L)=>V(v,{width:d,height:Q,subdivisions:n,updatable:L},T),L.b.CreateTiledGround=(v,d,Q,n,T,L,e,F,r)=>h(v,{xmin:d,zmin:Q,xmax:n,zmax:T,subdivisions:L,precision:e,updatable:r},F),L.b.CreateGroundFromHeightMap=(v,d,Q,n,T,L,e,F,r,C,u)=>S(v,d,{width:Q,height:n,subdivisions:T,minHeight:L,maxHeight:e,updatable:r,onReady:C,alphaFilter:u},F)},13095:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>B,e:()=>y,h:()=>z});var n=Q(651),T=Q(470),L=Q(725),e=Q(12027),F=Q(706),r=Q(482);function C(v){const d=[],Q=[],n=v.lines,T=v.za,e=[];let F=0;for(let L=0;L<n.length;L++){const v=n[L];for(let n=0;n<v.length;n++){const{x:r,y:C,z:u}=v[n];if(Q.push(r,C,u),T){const v=T[L],{r:d,g:Q,b:F,a:r}=v[n];e.push(d,Q,F,r)}n>0&&(d.push(F-1),d.push(F)),F++}}const r=new L.b;return r.indices=d,r.xa=Q,T&&(r.za=e),r}function u(v){const d=v.dashSize||3,Q=v.gapSize||1,T=v.dashNb||200,e=v.points,F=[],r=[],C=n.j.Zero();let u=0,y=0,z=0,B=0,X=0,m=0,V=0;for(V=0;V<e.length-1;V++)e[V+1].subtractToRef(e[V],C),u+=C.length();for(z=u/T,B=d*z/(d+Q),V=0;V<e.length-1;V++){e[V+1].subtractToRef(e[V],C),y=Math.floor(C.length()/z),C.normalize();for(let v=0;v<y;v++)X=z*v,F.push(e[V].x+X*C.x,e[V].y+X*C.y,e[V].z+X*C.z),F.push(e[V].x+(X+B)*C.x,e[V].y+(X+B)*C.y,e[V].z+(X+B)*C.z),r.push(m,m+1),m+=2}const h=new L.b;return h.xa=F,h.indices=r,h}function y(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=d.instance,T=d.lines,L=d.za;if(n){const v=n.getVerticesData(F.e.PositionKind);let d,Q;L&&(d=n.getVerticesData(F.e.ColorKind));let e=0,r=0;for(let n=0;n<T.length;n++){const F=T[n];for(let T=0;T<F.length;T++)v[e]=F[T].x,v[e+1]=F[T].y,v[e+2]=F[T].z,L&&d&&(Q=L[n],d[r]=Q[T].r,d[r+1]=Q[T].g,d[r+2]=Q[T].b,d[r+3]=Q[T].a,r+=4),e+=3}return n.updateVerticesData(F.e.PositionKind,v,!1,!1),L&&d&&n.updateVerticesData(F.e.ColorKind,d,!1,!1),n.refreshBoundingInfo(),n}const r=!!L,u=new e.b(v,Q,null,void 0,void 0,r,d.useVertexAlpha,d.material);return C(d).Ca(u,d.updatable),u}function z(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=d.za?[d.za]:null;return y(v,{lines:[d.points],updatable:d.updatable,instance:d.instance,za:n,useVertexAlpha:d.useVertexAlpha,material:d.material},Q)}function B(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.points,F=d.instance,C=d.gapSize||1,y=d.dashSize||3;if(F){const v=v=>{const d=n.j.Zero(),Q=v.length/6;let T=0,e=0,r=0,C=0,u=0,y=0,z=0,B=0;for(z=0;z<L.length-1;z++)L[z+1].subtractToRef(L[z],d),T+=d.length();r=T/Q;const X=F._creationDataStorage.dashSize;for(C=X*r/(X+F._creationDataStorage.gapSize),z=0;z<L.length-1;z++)for(L[z+1].subtractToRef(L[z],d),e=Math.floor(d.length()/r),d.normalize(),B=0;B<e&&y<v.length;)u=r*B,v[y]=L[z].x+u*d.x,v[y+1]=L[z].y+u*d.y,v[y+2]=L[z].z+u*d.z,v[y+3]=L[z].x+(u+C)*d.x,v[y+4]=L[z].y+(u+C)*d.y,v[y+5]=L[z].z+(u+C)*d.z,y+=6,B++;for(;y<v.length;)v[y]=L[z].x,v[y+1]=L[z].y,v[y+2]=L[z].z,y+=3};return(d.dashNb||d.dashSize||d.gapSize||d.useVertexAlpha||d.material)&&r.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),F.updateMeshPositions(v,!1),F}const z=new e.b(v,Q,null,void 0,void 0,void 0,d.useVertexAlpha,d.material);return u(d).Ca(z,d.updatable),z._creationDataStorage=new T.d,z._creationDataStorage.dashSize=y,z._creationDataStorage.gapSize=C,z}L.b.CreateLineSystem=C,L.b.CreateDashedLines=u,T.b.Jk=function(v,d){return z(v,{points:d,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},T.b.CreateDashedLines=function(v,d,Q,n,T){return B(v,{points:d,dashSize:Q,gapSize:n,dashNb:T,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12472:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>F,f:()=>r});var n=Q(470),T=Q(725),L=Q(791);function e(v){const d=[],Q=[],n=[],e=[],F=void 0!==v.width?v.width:void 0!==v.size?v.size:1,r=void 0!==v.height?v.height:void 0!==v.size?v.size:1,C=0===v.sideOrientation?0:v.sideOrientation||T.b.DEFAULTSIDE,u=F/2,y=r/2;Q.push(-u,-y,0),n.push(0,0,-1),e.push(0,L.d?1:0),Q.push(u,-y,0),n.push(0,0,-1),e.push(1,L.d?1:0),Q.push(u,y,0),n.push(0,0,-1),e.push(1,L.d?0:1),Q.push(-u,y,0),n.push(0,0,-1),e.push(0,L.d?0:1),d.push(0),d.push(1),d.push(2),d.push(0),d.push(2),d.push(3),T.b._ComputeSides(C,Q,d,n,e,v.frontUVs,v.backUVs);const z=new T.b;return z.indices=d,z.xa=Q,z.ya=n,z.Aa=e,z}function F(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new n.b(v,Q);d.sideOrientation=n.b._GetDefaultSideOrientation(d.sideOrientation),T._originalBuilderSideOrientation=d.sideOrientation;return e(d).Ca(T,d.updatable),d.sourcePlane&&(T.translate(d.sourcePlane.nk,-d.sourcePlane.d),T.setDirection(d.sourcePlane.nk.scale(-1))),T}const r={Kk:F};T.b.Kk=e,n.b.Kk=(v,d,Q,n,T)=>F(v,{size:d,width:d,height:d,sideOrientation:T,updatable:n},Q)},12562:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>r});var n=Q(651),T=Q(470),L=Q(725),e=Q(791);function F(v){const d=0|(v.segments||32),Q=v.diameterX||v.diameter||1,T=v.diameterY||v.diameter||1,F=v.diameterZ||v.diameter||1,r=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,C=v.slice&&v.slice<=0?1:v.slice||1,u=0===v.sideOrientation?0:v.sideOrientation||L.b.DEFAULTSIDE,y=!!v.dedupTopBottomIndices,z=new n.j(Q/2,T/2,F/2),B=2+d,X=2*B,m=[],V=[],h=[],S=[];for(let L=0;L<=B;L++){const v=L/B,d=v*Math.PI*C;for(let Q=0;Q<=X;Q++){const T=Q/X,L=T*Math.PI*2*r,F=n.b.RotationZ(-d),C=n.b.RotationY(L),u=n.j.TransformCoordinates(n.j.Up(),F),y=n.j.TransformCoordinates(u,C),B=y.multiply(z),m=y.divide(z).normalize();V.push(B.x,B.y,B.z),h.push(m.x,m.y,m.z),S.push(T,e.d?1-v:v)}if(L>0){const v=V.length/3;for(let d=v-2*(X+1);d+X+2<v;d++)y?(L>1&&(m.push(d),m.push(d+1),m.push(d+X+1)),(L<B||C<1)&&(m.push(d+X+1),m.push(d+1),m.push(d+X+2))):(m.push(d),m.push(d+1),m.push(d+X+1),m.push(d+X+1),m.push(d+1),m.push(d+X+2))}}L.b._ComputeSides(u,V,m,h,S,v.frontUVs,v.backUVs);const A=new L.b;return A.indices=m,A.xa=V,A.ya=h,A.Aa=S,A}function r(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return F(d).Ca(n,d.updatable),n}L.b.CreateSphere=F,T.b.CreateSphere=(v,d,Q,n,T,L)=>r(v,{segments:d,diameterX:Q,diameterY:Q,diameterZ:Q,sideOrientation:L,updatable:T},n)},13205:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>F});var n=Q(12052),T=Q(12879),L=Q(12061),e=Q(725);class F{static get Configuration(){return{get decoder(){return T.e.DefaultConfiguration},set decoder(v){T.e.DefaultConfiguration=v}}}static set Configuration(v){T.e.DefaultConfiguration=v.decoder}static get DecoderAvailable(){return(0,n.h)(T.e.DefaultConfiguration)}static get Default(){return F._Default??(F._Default=new F),F._Default}static ResetDefault(v){F._Default&&(v||F._Default.dispose(),F._Default=null)}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.DefaultNumWorkers;const d="number"===typeof v?{...T.e.DefaultConfiguration,numWorkers:v}:{...T.e.DefaultConfiguration,...v};this._decoder=new T.e(d)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(v,d,Q){return this._decoder.decodeMeshToMeshDataAsync(v,d,Q)}async decodeMeshToGeometryAsync(v,d,Q,n){return await this._decoder.decodeMeshToGeometryAsync(v,d,Q,n)}async _decodeMeshToGeometryForGltfAsync(v,d,Q,n,T,L){return await this._decoder._decodeMeshToGeometryForGltfAsync(v,d,Q,n,T,L)}async decodeMeshAsync(v,d){const Q=await this._decoder.decodeMeshToMeshDataAsync(v,d),n=new e.b;Q.indices&&(n.indices=Q.indices);for(const T of Q.attributes){const v=L.c.GetFloatData(T.data,T.size,L.c.GetDataType(T.data),T.byteOffset,T.byteStride,T.normalized,Q.totalVertices);n.set(v,T.kind)}return n}}F.DefaultNumWorkers=(0,n.g)(),F._Default=null},12879:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>C});var n=Q(12052),T=Q(475),L=Q(778),e=Q(12061),F=Q(482),r=Q(12059);class C extends n.d{static get DefaultAvailable(){return(0,n.h)(C.DefaultConfiguration)}static get Default(){return C._Default??(C._Default=new C),C._Default}static ResetDefault(v){C._Default&&(v||C._Default.dispose(),C._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(v,d){return{module:await(d||DracoDecoderModule)({wasmBinary:v})}}_getWorkerContent(){return`${r.e}(${r.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultConfiguration)}decodeMeshToMeshDataAsync(v,d,Q){const n=v instanceof ArrayBuffer?new Int8Array(v):new Int8Array(v.buffer,v.byteOffset,v.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async v=>await new Promise(((T,L)=>{v.push(((v,e)=>{let r=null;const C=[],u=d=>{v.removeEventListener("error",u),v.removeEventListener("message",y),L(d),e()},y=d=>{const n=d.data;switch(n.id){case"indices":r=n.data;break;case"attribute":C.push({kind:n.kind,data:n.data,size:n.size,byteOffset:n.byteOffset,byteStride:n.byteStride,normalized:(L=n.kind,z=n.normalized,Q&&void 0!==Q[L]?(z!==Q[L]&&F.d.Warn(`Normalized flag from Draco data (${z}) does not match normalized flag from glTF accessor (${Q[L]}). Using flag from glTF accessor.`),Q[L]):z)});break;case"decodeMeshDone":v.removeEventListener("error",u),v.removeEventListener("message",y),T({indices:r,attributes:C,totalVertices:n.totalVertices}),e()}var L,z};v.addEventListener("error",u),v.addEventListener("message",y);const z=n.slice();v.postMessage({id:"decodeMesh",dataView:z,attributes:d},[z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((v=>{let Q=null;const T=[],L=(0,r.e)(v.module,n,d,(v=>{Q=v}),((v,d,Q,n,L,e)=>{T.push({kind:v,data:d,size:Q,byteOffset:n,byteStride:L,normalized:e})}));return{indices:Q,attributes:T,totalVertices:L}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(v,d,Q,n){const T=await this.decodeMeshToMeshDataAsync(Q,n),F=new L.e(v,d);T.indices&&F.setIndices(T.indices);for(const L of T.attributes)F.setVerticesBuffer(new e.c(d.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),T.totalVertices);return F}async _decodeMeshToGeometryForGltfAsync(v,d,Q,n,T,F){const r=await this.decodeMeshToMeshDataAsync(Q,n,T),C=new L.e(v,d);F&&(C._boundingInfo=F,C.useBoundingInfoFromGeometry=!0),r.indices&&C.setIndices(r.indices);for(const L of r.attributes)C.setVerticesBuffer(new e.c(d.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),r.totalVertices);return C}}C.DefaultConfiguration={wasmUrl:`${T.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${T.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${T.e._DefaultCdnUrl}/draco_decoder_gltf.js`},C._Default=null},13086:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>Fv});var n=Q(651),T=Q(470),L=Q(706),e=Q(725),F=Q(791);function r(v){let d=v.pathArray;const Q=v.closeArray||!1,n=v.closePath||!1,T=v.invertUV||!1,r=Math.floor(d[0].length/2);let C=v.offset||r;C=C>r?r:Math.floor(C);const u=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE,y=v.Aa,z=v.za,B=[],X=[],m=[],V=[],h=[],S=[],A=[],f=[];let P;const O=[],J=[];let K,o,g;if(d.length<2){const v=[],Q=[];for(o=0;o<d[0].length-C;o++)v.push(d[0][o]),Q.push(d[0][o+C]);d=[v,Q]}let R=0;const M=n?1:0,Y=Q?1:0;let D,i,Z,j,x,k;for(P=d[0].length,K=0;K<d.length+Y;K++){for(A[K]=0,h[K]=[0],D=K===d.length?d[0]:d[K],i=D.length,P=P<i?P:i,g=0;g<i;)B.push(D[g].x,D[g].y,D[g].z),g>0&&(Z=D[g].Wd(D[g-1]).length(),j=Z+A[K],h[K].push(j),A[K]=j),g++;n&&(g--,B.push(D[0].x,D[0].y,D[0].z),Z=D[g].Wd(D[0]).length(),j=Z+A[K],h[K].push(j),A[K]=j),O[K]=i+M,J[K]=R,R+=i+M}let t,p,W=null,q=null;for(o=0;o<P+M;o++)for(f[o]=0,S[o]=[0],K=0;K<d.length-1+Y;K++)x=d[K],k=K===d.length-1?d[0]:d[K+1],o===P?(W=x[0],q=k[0]):(W=x[o],q=k[o]),Z=q.Wd(W).length(),j=Z+f[o],S[o].push(j),f[o]=j;if(y)for(K=0;K<y.length;K++)V.push(y[K].x,F.d?1-y[K].y:y[K].y);else for(K=0;K<d.length+Y;K++)for(o=0;o<P+M;o++)t=0!=A[K]?h[K][o]/A[K]:0,p=0!=f[o]?S[o][K]/f[o]:0,T?V.push(p,t):V.push(t,F.d?1-p:p);K=0;let b=0,H=O[K]-1,s=O[K+1]-1,a=H<s?H:s,I=J[1]-J[0];const U=O.length-1;for(;b<=a&&K<U;)X.push(b,b+I,b+1),X.push(b+I+1,b+1,b+I),b+=1,b===a&&(K++,I=J[K+1]-J[K],H=O[K]-1,s=O[K+1]-1,b=J[K],a=H<s?H+b:s+b);if(e.b.ComputeNormals(B,X,m),n){let v=0,Q=0;for(K=0;K<d.length;K++){v=3*J[K],Q=K+1<d.length?3*(J[K+1]-1):m.length-3,m[v]=.5*(m[v]+m[Q]),m[v+1]=.5*(m[v+1]+m[Q+1]),m[v+2]=.5*(m[v+2]+m[Q+2]);const n=Math.sqrt(m[v]*m[v]+m[v+1]*m[v+1]+m[v+2]*m[v+2]);m[v]/=n,m[v+1]/=n,m[v+2]/=n,m[Q]=m[v],m[Q+1]=m[v+1],m[Q+2]=m[v+2]}}if(Q){let v=3*J[0],Q=3*J[d.length];for(o=0;o<P+M;o++){m[v]=.5*(m[v]+m[Q]),m[v+1]=.5*(m[v+1]+m[Q+1]),m[v+2]=.5*(m[v+2]+m[Q+2]);const d=Math.sqrt(m[v]*m[v]+m[v+1]*m[v+1]+m[v+2]*m[v+2]);m[v]/=d,m[v+1]/=d,m[v+2]/=d,m[Q]=m[v],m[Q+1]=m[v+1],m[Q+2]=m[v+2],v+=3,Q+=3}}e.b._ComputeSides(u,B,X,m,V,v.frontUVs,v.backUVs);let c=null;if(z){c=new Float32Array(4*z.length);for(let v=0;v<z.length;v++)c[4*v]=z[v].r,c[4*v+1]=z[v].g,c[4*v+2]=z[v].b,c[4*v+3]=z[v].a}const w=new e.b,G=new Float32Array(B),E=new Float32Array(m),N=new Float32Array(V);return w.indices=X,w.xa=G,w.ya=E,w.Aa=N,c&&w.set(c,L.e.ColorKind),n&&(w._idx=J),w}function C(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=d.pathArray,u=d.closeArray,y=d.closePath,z=T.b._GetDefaultSideOrientation(d.sideOrientation),B=d.instance,X=d.updatable;if(B){const v=n.g.fk[0].gk(Number.MAX_VALUE),Q=n.g.fk[1].gk(-Number.MAX_VALUE),r=d=>{let n=C[0].length;const L=B;let e=0;const F=L._originalBuilderSideOrientation===T.b.DOUBLESIDE?2:1;for(let T=1;T<=F;++T)for(let F=0;F<C.length;++F){const T=C[F],r=T.length;n=n<r?n:r;for(let L=0;L<n;++L){const n=T[L];d[e]=n.x,d[e+1]=n.y,d[e+2]=n.z,v.minimizeInPlaceFromFloats(n.x,n.y,n.z),Q.maximizeInPlaceFromFloats(n.x,n.y,n.z),e+=3}if(L._creationDataStorage&&L._creationDataStorage.closePath){const v=T[0];d[e]=v.x,d[e+1]=v.y,d[e+2]=v.z,e+=3}}},u=B.getVerticesData(L.e.PositionKind);if(r(u),B.hasBoundingInfo?B.getBoundingInfo().reConstruct(v,Q,B._worldMatrix):B.buildBoundingInfo(v,Q,B._worldMatrix),B.updateVerticesData(L.e.PositionKind,u,!1,!1),d.za){const v=B.getVerticesData(L.e.ColorKind);for(let Q=0,n=0;Q<d.za.length;Q++,n+=4){const T=d.za[Q];v[n]=T.r,v[n+1]=T.g,v[n+2]=T.b,v[n+3]=T.a}B.updateVerticesData(L.e.ColorKind,v,!1,!1)}if(d.Aa){const v=B.getVerticesData(L.e.UVKind);for(let Q=0;Q<d.Aa.length;Q++)v[2*Q]=d.Aa[Q].x,v[2*Q+1]=F.d?1-d.Aa[Q].y:d.Aa[Q].y;B.updateVerticesData(L.e.UVKind,v,!1,!1)}if(!B.areNormalsFrozen||B.isFacetDataEnabled){const v=B.ek(),d=B.getVerticesData(L.e.NormalKind),Q=B.isFacetDataEnabled?B.getFacetDataParameters():null;if(e.b.ComputeNormals(u,v,d,Q),B._creationDataStorage&&B._creationDataStorage.closePath){let v=0,Q=0;for(let n=0;n<C.length;n++)v=3*B._creationDataStorage.idx[n],Q=n+1<C.length?3*(B._creationDataStorage.idx[n+1]-1):d.length-3,d[v]=.5*(d[v]+d[Q]),d[v+1]=.5*(d[v+1]+d[Q+1]),d[v+2]=.5*(d[v+2]+d[Q+2]),d[Q]=d[v],d[Q+1]=d[v+1],d[Q+2]=d[v+2]}B.areNormalsFrozen||B.updateVerticesData(L.e.NormalKind,d,!1,!1)}return B}{const n=new T.b(v,Q);n._originalBuilderSideOrientation=z,n._creationDataStorage=new T.d;const L=r(d);return y&&(n._creationDataStorage.idx=L._idx),n._creationDataStorage.closePath=y,n._creationDataStorage.closeArray=u,L.Ca(n,X),n}}e.b.CreateRibbon=r,T.b.CreateRibbon=function(v,d){return C(v,{pathArray:d,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var u=Q(859),y=Q(12402),z=Q(686);function B(v){const d=v.pattern||T.b.NO_FLIP,Q=v.tileWidth||v.tileSize||1,n=v.tileHeight||v.tileSize||1,L=v.alignHorizontal||0,F=v.alignVertical||0,r=v.width||v.size||1,C=Math.floor(r/Q);let u=r-C*Q;const y=v.height||v.size||1,z=Math.floor(y/n);let B=y-z*n;const X=Q*C/2,m=n*z/2;let V=0,h=0,S=0,A=0,f=0,P=0;if(u>0||B>0){switch(S=-X,A=-m,f=X,P=m,L){case T.b.CENTER:u/=2,S-=u,f+=u;break;case T.b.LEFT:f+=u,V=-u/2;break;case T.b.RIGHT:S-=u,V=u/2}switch(F){case T.b.CENTER:B/=2,A-=B,P+=B;break;case T.b.BOTTOM:P+=B,h=-B/2;break;case T.b.TOP:A-=B,h=B/2}}const O=[],J=[],K=[];K[0]=[0,0,1,0,1,1,0,1],K[1]=[0,0,1,0,1,1,0,1],d!==T.b.ROTATE_TILE&&d!==T.b.ROTATE_ROW||(K[1]=[1,1,0,1,0,0,1,0]),d!==T.b.FLIP_TILE&&d!==T.b.FLIP_ROW||(K[1]=[1,0,0,0,0,1,1,1]),d!==T.b.FLIP_N_ROTATE_TILE&&d!==T.b.FLIP_N_ROTATE_ROW||(K[1]=[0,1,1,1,1,0,0,0]);let o=[];const g=[],R=[];let M=0;for(let e=0;e<z;e++)for(let v=0;v<C;v++)O.push(v*Q-X+V,e*n-m+h,0),O.push((v+1)*Q-X+V,e*n-m+h,0),O.push((v+1)*Q-X+V,(e+1)*n-m+h,0),O.push(v*Q-X+V,(e+1)*n-m+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),o=d===T.b.FLIP_TILE||d===T.b.ROTATE_TILE||d===T.b.FLIP_N_ROTATE_TILE?o.concat(K[(v%2+e%2)%2]):d===T.b.FLIP_ROW||d===T.b.ROTATE_ROW||d===T.b.FLIP_N_ROTATE_ROW?o.concat(K[e%2]):o.concat(K[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),M+=4;if(u>0||B>0){const v=B>0&&(F===T.b.CENTER||F===T.b.TOP),e=B>0&&(F===T.b.CENTER||F===T.b.BOTTOM),r=u>0&&(L===T.b.CENTER||L===T.b.RIGHT),y=u>0&&(L===T.b.CENTER||L===T.b.LEFT);let K,Y,D,i,Z=[];if(v&&r&&(O.push(S+V,A+h,0),O.push(-X+V,A+h,0),O.push(-X+V,A+B+h,0),O.push(S+V,A+B+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,K=1-u/Q,Y=1-B/n,D=1,i=1,Z=[K,Y,D,Y,D,i,K,i],d===T.b.ROTATE_ROW&&(Z=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),d===T.b.FLIP_ROW&&(Z=[1-K,Y,1-D,Y,1-D,i,1-K,i]),d===T.b.FLIP_N_ROTATE_ROW&&(Z=[K,1-Y,D,1-Y,D,1-i,K,1-i]),o=o.concat(Z),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&y&&(O.push(X+V,A+h,0),O.push(f+V,A+h,0),O.push(f+V,A+B+h,0),O.push(X+V,A+B+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,K=0,Y=1-B/n,D=u/Q,i=1,Z=[K,Y,D,Y,D,i,K,i],(d===T.b.ROTATE_ROW||d===T.b.ROTATE_TILE&&C%2===0)&&(Z=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),(d===T.b.FLIP_ROW||d===T.b.FLIP_TILE&&C%2===0)&&(Z=[1-K,Y,1-D,Y,1-D,i,1-K,i]),(d===T.b.FLIP_N_ROTATE_ROW||d===T.b.FLIP_N_ROTATE_TILE&&C%2===0)&&(Z=[K,1-Y,D,1-Y,D,1-i,K,1-i]),o=o.concat(Z),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&r&&(O.push(S+V,m+h,0),O.push(-X+V,m+h,0),O.push(-X+V,P+h,0),O.push(S+V,P+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,K=1-u/Q,Y=0,D=1,i=B/n,Z=[K,Y,D,Y,D,i,K,i],(d===T.b.ROTATE_ROW&&z%2===1||d===T.b.ROTATE_TILE&&z%1===0)&&(Z=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),(d===T.b.FLIP_ROW&&z%2===1||d===T.b.FLIP_TILE&&z%2===0)&&(Z=[1-K,Y,1-D,Y,1-D,i,1-K,i]),(d===T.b.FLIP_N_ROTATE_ROW&&z%2===1||d===T.b.FLIP_N_ROTATE_TILE&&z%2===0)&&(Z=[K,1-Y,D,1-Y,D,1-i,K,1-i]),o=o.concat(Z),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&y&&(O.push(X+V,m+h,0),O.push(f+V,m+h,0),O.push(f+V,P+h,0),O.push(X+V,P+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,K=0,Y=0,D=u/Q,i=B/n,Z=[K,Y,D,Y,D,i,K,i],(d===T.b.ROTATE_ROW&&z%2===1||d===T.b.ROTATE_TILE&&(z+C)%2===1)&&(Z=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),(d===T.b.FLIP_ROW&&z%2===1||d===T.b.FLIP_TILE&&(z+C)%2===1)&&(Z=[1-K,Y,1-D,Y,1-D,i,1-K,i]),(d===T.b.FLIP_N_ROTATE_ROW&&z%2===1||d===T.b.FLIP_N_ROTATE_TILE&&(z+C)%2===1)&&(Z=[K,1-Y,D,1-Y,D,1-i,K,1-i]),o=o.concat(Z),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v){const v=[];K=0,Y=1-B/n,D=1,i=1,v[0]=[K,Y,D,Y,D,i,K,i],v[1]=[K,Y,D,Y,D,i,K,i],d!==T.b.ROTATE_TILE&&d!==T.b.ROTATE_ROW||(v[1]=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),d!==T.b.FLIP_TILE&&d!==T.b.FLIP_ROW||(v[1]=[1-K,Y,1-D,Y,1-D,i,1-K,i]),d!==T.b.FLIP_N_ROTATE_TILE&&d!==T.b.FLIP_N_ROTATE_ROW||(v[1]=[K,1-Y,D,1-Y,D,1-i,K,1-i]);for(let n=0;n<C;n++)O.push(n*Q-X+V,A+h,0),O.push((n+1)*Q-X+V,A+h,0),O.push((n+1)*Q-X+V,A+B+h,0),O.push(n*Q-X+V,A+B+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,o=d===T.b.FLIP_TILE||d===T.b.ROTATE_TILE||d===T.b.FLIP_N_ROTATE_TILE?o.concat(v[(n+1)%2]):d===T.b.FLIP_ROW||d===T.b.ROTATE_ROW||d===T.b.FLIP_N_ROTATE_ROW?o.concat(v[1]):o.concat(v[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const v=[];K=0,Y=0,D=1,i=B/n,v[0]=[K,Y,D,Y,D,i,K,i],v[1]=[K,Y,D,Y,D,i,K,i],d!==T.b.ROTATE_TILE&&d!==T.b.ROTATE_ROW||(v[1]=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),d!==T.b.FLIP_TILE&&d!==T.b.FLIP_ROW||(v[1]=[1-K,Y,1-D,Y,1-D,i,1-K,i]),d!==T.b.FLIP_N_ROTATE_TILE&&d!==T.b.FLIP_N_ROTATE_ROW||(v[1]=[K,1-Y,D,1-Y,D,1-i,K,1-i]);for(let n=0;n<C;n++)O.push(n*Q-X+V,P-B+h,0),O.push((n+1)*Q-X+V,P-B+h,0),O.push((n+1)*Q-X+V,P+h,0),O.push(n*Q-X+V,P+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,o=d===T.b.FLIP_TILE||d===T.b.ROTATE_TILE||d===T.b.FLIP_N_ROTATE_TILE?o.concat(v[(n+z)%2]):d===T.b.FLIP_ROW||d===T.b.ROTATE_ROW||d===T.b.FLIP_N_ROTATE_ROW?o.concat(v[z%2]):o.concat(v[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const v=[];K=1-u/Q,Y=0,D=1,i=1,v[0]=[K,Y,D,Y,D,i,K,i],v[1]=[K,Y,D,Y,D,i,K,i],d!==T.b.ROTATE_TILE&&d!==T.b.ROTATE_ROW||(v[1]=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),d!==T.b.FLIP_TILE&&d!==T.b.FLIP_ROW||(v[1]=[1-K,Y,1-D,Y,1-D,i,1-K,i]),d!==T.b.FLIP_N_ROTATE_TILE&&d!==T.b.FLIP_N_ROTATE_ROW||(v[1]=[K,1-Y,D,1-Y,D,1-i,K,1-i]);for(let Q=0;Q<z;Q++)O.push(S+V,Q*n-m+h,0),O.push(S+u+V,Q*n-m+h,0),O.push(S+u+V,(Q+1)*n-m+h,0),O.push(S+V,(Q+1)*n-m+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,o=d===T.b.FLIP_TILE||d===T.b.ROTATE_TILE||d===T.b.FLIP_N_ROTATE_TILE?o.concat(v[(Q+1)%2]):d===T.b.FLIP_ROW||d===T.b.ROTATE_ROW||d===T.b.FLIP_N_ROTATE_ROW?o.concat(v[Q%2]):o.concat(v[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const v=[];K=0,Y=0,D=u/n,i=1,v[0]=[K,Y,D,Y,D,i,K,i],v[1]=[K,Y,D,Y,D,i,K,i],d!==T.b.ROTATE_TILE&&d!==T.b.ROTATE_ROW||(v[1]=[1-K,1-Y,1-D,1-Y,1-D,1-i,1-K,1-i]),d!==T.b.FLIP_TILE&&d!==T.b.FLIP_ROW||(v[1]=[1-K,Y,1-D,Y,1-D,i,1-K,i]),d!==T.b.FLIP_N_ROTATE_TILE&&d!==T.b.FLIP_N_ROTATE_ROW||(v[1]=[K,1-Y,D,1-Y,D,1-i,K,1-i]);for(let Q=0;Q<z;Q++)O.push(f-u+V,Q*n-m+h,0),O.push(f+V,Q*n-m+h,0),O.push(f+V,(Q+1)*n-m+h,0),O.push(f-u+V,(Q+1)*n-m+h,0),R.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,o=d===T.b.FLIP_TILE||d===T.b.ROTATE_TILE||d===T.b.FLIP_N_ROTATE_TILE?o.concat(v[(Q+C)%2]):d===T.b.FLIP_ROW||d===T.b.ROTATE_ROW||d===T.b.FLIP_N_ROTATE_ROW?o.concat(v[Q%2]):o.concat(v[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const Y=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE;e.b._ComputeSides(Y,O,R,J,o,v.frontUVs,v.backUVs);const D=new e.b;D.indices=R,D.xa=O,D.ya=J,D.Aa=o;const i=Y===e.b.DOUBLESIDE?g.concat(g):g;return D.za=i,D}function X(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return B(d).Ca(n,d.updatable),n}function m(v){const d=v.faceUV||new Array(6),Q=v.faceColors,L=v.pattern||T.b.NO_FLIP,r=v.width||v.size||1,C=v.height||v.size||1,u=v.depth||v.size||1,y=v.tileWidth||v.tileSize||1,X=v.tileHeight||v.tileSize||1,m=v.alignHorizontal||0,V=v.alignVertical||0,h=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE;for(let T=0;T<6;T++)void 0===d[T]&&(d[T]=new n.k(0,0,1,1)),Q&&void 0===Q[T]&&(Q[T]=new z.f(1,1,1,1));const S=r/2,A=C/2,f=u/2,P=[];for(let n=0;n<2;n++)P[n]=B({pattern:L,tileWidth:y,tileHeight:X,width:r,height:C,alignVertical:V,alignHorizontal:m,sideOrientation:h});for(let n=2;n<4;n++)P[n]=B({pattern:L,tileWidth:y,tileHeight:X,width:u,height:C,alignVertical:V,alignHorizontal:m,sideOrientation:h});let O=V;V===T.b.BOTTOM?O=T.b.TOP:V===T.b.TOP&&(O=T.b.BOTTOM);for(let n=4;n<6;n++)P[n]=B({pattern:L,tileWidth:y,tileHeight:X,width:r,height:u,alignVertical:O,alignHorizontal:m,sideOrientation:h});let J=[],K=[],o=[],g=[];const R=[],M=[],Y=[],D=[];let i=0,Z=0;for(let T=0;T<6;T++){const v=P[T].xa.length;M[T]=[],Y[T]=[];for(let d=0;d<v/3;d++)M[T].push(new n.j(P[T].xa[3*d],P[T].xa[3*d+1],P[T].xa[3*d+2])),Y[T].push(new n.j(P[T].ya[3*d],P[T].ya[3*d+1],P[T].ya[3*d+2]));i=P[T].Aa.length,D[T]=[];for(let Q=0;Q<i;Q+=2)D[T][Q]=d[T].x+(d[T].z-d[T].x)*P[T].Aa[Q],D[T][Q+1]=d[T].y+(d[T].w-d[T].y)*P[T].Aa[Q+1],F.d&&(D[T][Q+1]=1-D[T][Q+1]);if(o=o.concat(D[T]),g=g.concat(P[T].indices.map((v=>v+Z))),Z+=M[T].length,Q)for(let d=0;d<4;d++)R.push(Q[T].r,Q[T].g,Q[T].b,Q[T].a)}const j=new n.j(0,0,f),x=n.b.RotationY(Math.PI);J=M[0].map((v=>n.j.TransformNormal(v,x).add(j))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[]),K=Y[0].map((v=>n.j.TransformNormal(v,x))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[]),J=J.concat(M[1].map((v=>v.Wd(j))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[])),K=K.concat(Y[1].map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[]));const k=new n.j(S,0,0),t=n.b.RotationY(-Math.PI/2);J=J.concat(M[2].map((v=>n.j.TransformNormal(v,t).add(k))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[])),K=K.concat(Y[2].map((v=>n.j.TransformNormal(v,t))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[]));const p=n.b.RotationY(Math.PI/2);J=J.concat(M[3].map((v=>n.j.TransformNormal(v,p).Wd(k))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[])),K=K.concat(Y[3].map((v=>n.j.TransformNormal(v,p))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[]));const W=new n.j(0,A,0),q=n.b.RotationX(Math.PI/2);J=J.concat(M[4].map((v=>n.j.TransformNormal(v,q).add(W))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[])),K=K.concat(Y[4].map((v=>n.j.TransformNormal(v,q))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[]));const b=n.b.RotationX(-Math.PI/2);J=J.concat(M[5].map((v=>n.j.TransformNormal(v,b).Wd(W))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[])),K=K.concat(Y[5].map((v=>n.j.TransformNormal(v,b))).map((v=>[v.x,v.y,v.z])).reduce(((v,d)=>v.concat(d)),[])),e.b._ComputeSides(h,J,g,K,o);const H=new e.b;if(H.indices=g,H.xa=J,H.ya=K,H.Aa=o,Q){const v=h===e.b.DOUBLESIDE?R.concat(R):R;H.za=v}return H}function V(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return m(d).Ca(n,d.updatable),n}e.b.CreateTiledPlane=B;e.b.CreateTiledBox=m;var h=Q(12562),S=Q(2167),A=Q(821);function f(v){const d=v.height||2;let Q=0===v.diameterTop?0:v.diameterTop||v.diameter||1,L=0===v.diameterBottom?0:v.diameterBottom||v.diameter||1;Q=Q||1e-5,L=L||1e-5;const r=0|(v.tessellation||24),C=0|(v.subdivisions||1),u=!!v.hasRings,y=!!v.enclose,B=0===v.cap?0:v.cap||T.b.CAP_ALL,X=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,m=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE,V=v.faceUV||new Array(3),h=v.faceColors,S=2+(1+(1!==X&&y?2:0))*(u?C:1);let f;for(f=0;f<S;f++)h&&void 0===h[f]&&(h[f]=new z.f(1,1,1,1));for(f=0;f<S;f++)V&&void 0===V[f]&&(V[f]=new n.k(0,0,1,1));const P=[],O=[],J=[],K=[],o=[],g=2*Math.PI*X/r;let R,M,Y;const D=(L-Q)/2/d,i=n.j.Zero(),Z=n.j.Zero(),j=n.j.Zero(),x=n.j.Zero(),k=n.j.Zero(),t=A.d.Y;let p,W,q,b=1,H=1,s=0,a=0;for(p=0;p<=C;p++)for(M=p/C,Y=(M*(Q-L)+L)/2,b=u&&0!==p&&p!==C?2:1,q=0;q<b;q++){for(u&&(H+=q),y&&(H+=2*q),W=0;W<=r;W++)R=W*g,i.x=Math.cos(-R)*Y,i.y=-d/2+M*d,i.z=Math.sin(-R)*Y,0===Q&&p===C?(Z.x=J[J.length-3*(r+1)],Z.y=J[J.length-3*(r+1)+1],Z.z=J[J.length-3*(r+1)+2]):(Z.x=i.x,Z.z=i.z,Z.y=Math.sqrt(Z.x*Z.x+Z.z*Z.z)*D,Z.normalize()),0===W&&(j.p(i),x.p(Z)),O.push(i.x,i.y,i.z),J.push(Z.x,Z.y,Z.z),a=u?s!==H?V[H].y:V[H].w:V[H].y+(V[H].w-V[H].y)*M,K.push(V[H].x+(V[H].z-V[H].x)*W/r,F.d?1-a:a),h&&o.push(h[H].r,h[H].g,h[H].b,h[H].a);1!==X&&y&&(O.push(i.x,i.y,i.z),O.push(0,i.y,0),O.push(0,i.y,0),O.push(j.x,j.y,j.z),n.j.CrossToRef(t,Z,k),k.normalize(),J.push(k.x,k.y,k.z,k.x,k.y,k.z),n.j.CrossToRef(x,t,k),k.normalize(),J.push(k.x,k.y,k.z,k.x,k.y,k.z),a=u?s!==H?V[H+1].y:V[H+1].w:V[H+1].y+(V[H+1].w-V[H+1].y)*M,K.push(V[H+1].x,F.d?1-a:a),K.push(V[H+1].z,F.d?1-a:a),a=u?s!==H?V[H+2].y:V[H+2].w:V[H+2].y+(V[H+2].w-V[H+2].y)*M,K.push(V[H+2].x,F.d?1-a:a),K.push(V[H+2].z,F.d?1-a:a),h&&(o.push(h[H+1].r,h[H+1].g,h[H+1].b,h[H+1].a),o.push(h[H+1].r,h[H+1].g,h[H+1].b,h[H+1].a),o.push(h[H+2].r,h[H+2].g,h[H+2].b,h[H+2].a),o.push(h[H+2].r,h[H+2].g,h[H+2].b,h[H+2].a))),s!==H&&(s=H)}const I=1!==X&&y?r+4:r;for(p=0,H=0;H<C;H++){let v=0,d=0,Q=0,n=0;for(W=0;W<r;W++)v=p*(I+1)+W,d=(p+1)*(I+1)+W,Q=p*(I+1)+(W+1),n=(p+1)*(I+1)+(W+1),P.push(v,d,Q),P.push(n,Q,d);1!==X&&y&&(P.push(v+2,d+2,Q+2),P.push(n+2,Q+2,d+2),P.push(v+4,d+4,Q+4),P.push(n+4,Q+4,d+4)),p=u?p+2:p+1}const U=v=>{const T=v?Q/2:L/2;if(0===T)return;let e,C,u;const y=v?V[S-1]:V[0];let z=null;h&&(z=v?h[S-1]:h[0]);const B=O.length/3,m=v?d/2:-d/2,A=new n.j(0,m,0);O.push(A.x,A.y,A.z),J.push(0,v?1:-1,0);const f=y.y+.5*(y.w-y.y);K.push(y.x+.5*(y.z-y.x),F.d?1-f:f),z&&o.push(z.r,z.g,z.b,z.a);const g=new n.i(.5,.5);for(u=0;u<=r;u++){e=2*Math.PI*u*X/r;const d=Math.cos(-e),Q=Math.sin(-e);C=new n.j(d*T,m,Q*T);const L=new n.i(d*g.x+.5,Q*g.y+.5);O.push(C.x,C.y,C.z),J.push(0,v?1:-1,0);const B=y.y+(y.w-y.y)*L.y;K.push(y.x+(y.z-y.x)*L.x,F.d?1-B:B),z&&o.push(z.r,z.g,z.b,z.a)}for(u=0;u<r;u++)v?(P.push(B),P.push(B+(u+2)),P.push(B+(u+1))):(P.push(B),P.push(B+(u+1)),P.push(B+(u+2)))};B!==T.b.CAP_START&&B!==T.b.CAP_ALL||U(!1),B!==T.b.CAP_END&&B!==T.b.CAP_ALL||U(!0),e.b._ComputeSides(m,O,P,J,K,v.frontUVs,v.backUVs);const c=new e.b;return c.indices=P,c.xa=O,c.ya=J,c.Aa=K,h&&(c.za=o),c}function P(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return f(d).Ca(n,d.updatable),n}function O(v){const d=[],Q=[],T=[],L=[],r=v.diameter||1,C=v.thickness||.5,u=0|(v.tessellation||16),y=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE,z=u+1;for(let e=0;e<=u;e++){const v=e/u,y=e*Math.PI*2/u-Math.PI/2,B=n.b.Translation(r/2,0,0).multiply(n.b.RotationY(y));for(let r=0;r<=u;r++){const y=1-r/u,X=r*Math.PI*2/u+Math.PI,m=Math.cos(X),V=Math.sin(X);let h=new n.j(m,V,0),S=h.scale(C/2);const A=new n.i(v,y);S=n.j.TransformCoordinates(S,B),h=n.j.TransformNormal(h,B),Q.push(S.x,S.y,S.z),T.push(h.x,h.y,h.z),L.push(A.x,F.d?1-A.y:A.y);const f=(e+1)%z,P=(r+1)%z;d.push(e*z+r),d.push(e*z+P),d.push(f*z+r),d.push(e*z+P),d.push(f*z+P),d.push(f*z+r)}}e.b._ComputeSides(y,Q,d,T,L,v.frontUVs,v.backUVs);const B=new e.b;return B.indices=d,B.xa=Q,B.ya=T,B.Aa=L,B}function J(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return O(d).Ca(n,d.updatable),n}e.b.CreateCylinder=f,T.b.CreateCylinder=(v,d,Q,n,L,e,F,r,C)=>{void 0!==F&&F instanceof S.d||(void 0!==F&&(C=r||T.b.DEFAULTSIDE,r=F),F=e,e=1);return P(v,{height:d,diameterTop:Q,diameterBottom:n,tessellation:L,subdivisions:e,sideOrientation:C,updatable:r},F)};function K(v){const d=[],Q=[],T=[],L=[],r=v.radius||2,C=v.tube||.5,u=v.radialSegments||32,y=v.tubularSegments||32,z=v.p||2,B=v.q||3,X=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE,m=v=>{const d=Math.cos(v),Q=Math.sin(v),T=B/z*v,L=Math.cos(T),e=r*(2+L)*.5*d,F=r*(2+L)*Q*.5,C=r*Math.sin(T)*.5;return new n.j(e,F,C)};let V,h;for(V=0;V<=u;V++){const v=V%u/u*2*z*Math.PI,d=m(v),T=m(v+.01),e=T.Wd(d);let r=T.add(d);const B=n.j.Cross(e,r);for(r=n.j.Cross(B,e),B.normalize(),r.normalize(),h=0;h<y;h++){const v=h%y/y*2*Math.PI,n=-C*Math.cos(v),T=C*Math.sin(v);Q.push(d.x+n*r.x+T*B.x),Q.push(d.y+n*r.y+T*B.y),Q.push(d.z+n*r.z+T*B.z),L.push(V/u),L.push(F.d?1-h/y:h/y)}}for(V=0;V<u;V++)for(h=0;h<y;h++){const v=(h+1)%y,Q=V*y+h,n=(V+1)*y+h,T=(V+1)*y+v,L=V*y+v;d.push(L),d.push(n),d.push(Q),d.push(L),d.push(T),d.push(n)}e.b.ComputeNormals(Q,d,T),e.b._ComputeSides(X,Q,d,T,L,v.frontUVs,v.backUVs);const S=new e.b;return S.indices=d,S.xa=Q,S.ya=T,S.Aa=L,S}function o(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return K(d).Ca(n,d.updatable),n}e.b.CreateTorus=O,T.b.CreateTorus=(v,d,Q,n,T,L,e)=>J(v,{diameter:d,thickness:Q,tessellation:n,sideOrientation:e,updatable:L},T);e.b.CreateTorusKnot=K,T.b.CreateTorusKnot=(v,d,Q,n,T,L,e,F,r,C)=>o(v,{radius:d,tube:Q,radialSegments:n,tubularSegments:T,p:L,q:e,sideOrientation:C,updatable:r},F);var g=Q(13095),R=Q(12046),M=Q(2017);function Y(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=d.path,L=d.shape,e=d.scale||1,F=d.rotation||0,r=0===d.cap?0:d.cap||T.b.NO_CAP,C=d.updatable,u=T.b._GetDefaultSideOrientation(d.sideOrientation),y=d.instance||null,z=d.invertUV||!1,B=d.closeShape||!1,X=d.closePath||!1,m=d.capFunction||null;return i(v,L,n,e,F,null,null,X,B,r,!1,Q,!!C,u,y,z,d.frontUVs||null,d.backUVs||null,d.firstNormal||null,!!d.adjustFrame,m)}function D(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=d.path,L=d.shape,e=d.scaleFunction||(()=>1),F=d.rotationFunction||(()=>0),r=d.closePath||d.ribbonCloseArray||!1,C=d.closeShape||d.ribbonClosePath||!1,u=0===d.cap?0:d.cap||T.b.NO_CAP,y=d.updatable,z=d.firstNormal||null,B=d.adjustFrame||!1,X=T.b._GetDefaultSideOrientation(d.sideOrientation),m=d.instance,V=d.invertUV||!1,h=d.capFunction||null;return i(v,L,n,null,null,e,F,r,C,u,!0,Q,!!y,X,m||null,V,d.frontUVs||null,d.backUVs||null,z,B,h||null)}function i(v,d,Q,L,e,F,r,u,y,z,B,X,m,V,h,S,A,f,P,O,J){const K=(v,d,Q,L,e,F,r,C,u,y,z)=>{const B=Q.getTangents(),X=Q.getNormals(),m=Q.getBinormals(),V=Q.getDistances();if(z)for(let T=0;T<B.length;T++)if(0==B[T].x&&0==B[T].y&&0==B[T].z&&B[T].p(B[T-1]),0==X[T].x&&0==X[T].y&&0==X[T].z&&X[T].p(X[T-1]),0==m[T].x&&0==m[T].y&&0==m[T].z&&m[T].p(m[T-1]),T>0){let v=B[T-1];n.j.Dot(v,B[T])<0&&B[T].scaleInPlace(-1),v=X[T-1],n.j.Dot(v,X[T])<0&&X[T].scaleInPlace(-1),v=m[T-1],n.j.Dot(v,m[T])<0&&m[T].scaleInPlace(-1)}let h=0;const S=y&&C?C:()=>null!==F?F:0,A=y&&r?r:()=>null!==e?e:1;let f=u===T.b.NO_CAP||u===T.b.CAP_END?0:2;const P=n.g.Matrix[0];for(let T=0;T<d.length;T++){const Q=[],e=S(T,V[T]),F=A(T,V[T]);n.b.RotationAxisToRef(B[T],h,P);for(let L=0;L<v.length;L++){const e=B[T].scale(v[L].z).add(X[T].scale(v[L].x)).add(m[T].scale(v[L].y)),r=n.j.Zero();n.j.TransformCoordinatesToRef(e,P,r),r.scaleInPlace(F).addInPlace(d[T]),Q[L]=r}L[f]=Q,h+=e,f++}const O=J||(v=>{const d=Array(),Q=n.j.Zero();let T;for(T=0;T<v.length;T++)Q.addInPlace(v[T]);for(Q.scaleInPlace(1/v.length),T=0;T<v.length;T++)d.push(Q);return d});switch(u){case T.b.NO_CAP:break;case T.b.CAP_START:L[0]=O(L[2]),L[1]=L[2];break;case T.b.CAP_END:L[f]=L[f-1],L[f+1]=O(L[f-1]);break;case T.b.CAP_ALL:L[0]=O(L[2]),L[1]=L[2],L[f]=L[f-1],L[f+1]=O(L[f-1])}return L};let o,g;if(h){const v=h._creationDataStorage;return o=P?v.path3D.update(Q,P):v.path3D.update(Q),g=K(d,Q,v.path3D,v.pathArray,L,e,F,r,v.cap,B,O),h=C("",{pathArray:g,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:h},X||void 0)}o=P?new M.j(Q,P):new M.j(Q);g=K(d,Q,o,new Array,L,e,F,r,z=z<0||z>3?0:z,B,O);const R=C(v,{pathArray:g,closeArray:u,closePath:y,updatable:m,sideOrientation:V,invertUV:S,frontUVs:A||void 0,backUVs:f||void 0},X);return R._creationDataStorage.pathArray=g,R._creationDataStorage.path3D=o,R._creationDataStorage.cap=z,R}function Z(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.arc?d.arc<=0||d.arc>1?1:d.arc:1,e=void 0===d.closed||d.closed,F=d.shape,r=d.radius||1,u=d.tessellation||64,y=d.clip||0,z=d.updatable,B=T.b._GetDefaultSideOrientation(d.sideOrientation),X=d.cap||T.b.NO_CAP,m=2*Math.PI,V=[],h=d.invertUV||!1;let S=0,A=0;const f=m/u*L;let P,O;for(S=0;S<=u-y;S++){for(O=[],X!=T.b.CAP_START&&X!=T.b.CAP_ALL||(O.push(new n.j(0,F[0].y,0)),O.push(new n.j(Math.cos(S*f)*F[0].x*r,F[0].y,Math.sin(S*f)*F[0].x*r))),A=0;A<F.length;A++)P=new n.j(Math.cos(S*f)*F[A].x*r,F[A].y,Math.sin(S*f)*F[A].x*r),O.push(P);X!=T.b.CAP_END&&X!=T.b.CAP_ALL||(O.push(new n.j(Math.cos(S*f)*F[F.length-1].x*r,F[F.length-1].y,Math.sin(S*f)*F[F.length-1].x*r)),O.push(new n.j(0,F[F.length-1].y,0))),V.push(O)}return C(v,{pathArray:V,closeArray:e,sideOrientation:B,updatable:z,invertUV:h,frontUVs:d.frontUVs,backUVs:d.backUVs},Q)}T.b.ExtrudeShape=function(v,d,Q,n,L,e){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0;return Y(v,{shape:d,path:Q,scale:n,rotation:L,cap:0===e?0:e||T.b.NO_CAP,sideOrientation:C,instance:u,updatable:r},F)},T.b.ExtrudeShapeCustom=(v,d,Q,n,L,e,F,r,C,u,y,z)=>D(v,{shape:d,path:Q,scaleFunction:n,rotationFunction:L,ribbonCloseArray:e,ribbonClosePath:F,cap:0===r?0:r||T.b.NO_CAP,sideOrientation:y,instance:z,updatable:u},C);T.b.CreateLathe=(v,d,Q,n,T,L,e)=>Z(v,{shape:d,radius:Q,tessellation:n,sideOrientation:e,updatable:L},T);var j=Q(12472),x=Q(12411);function k(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.path;let e=d.instance,F=1;void 0!==d.radius?F=d.radius:e&&(F=e._creationDataStorage.radius);const r=d.tessellation||64,u=d.radiusFunction||null;let y=d.cap||T.b.NO_CAP;const z=d.invertUV||!1,B=d.updatable,X=T.b._GetDefaultSideOrientation(d.sideOrientation);d.arc=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1;const m=(v,d,Q,L,e,F,r,C)=>{const u=d.getTangents(),y=d.getNormals(),z=d.getDistances(),B=2*Math.PI/e*C,X=F||(()=>L);let m,V,h,S;const A=n.g.Matrix[0];let f=r===T.b.NO_CAP||r===T.b.CAP_END?0:2;for(let T=0;T<v.length;T++){V=X(T,z[T]),m=Array(),h=y[T];for(let d=0;d<e;d++)n.b.RotationAxisToRef(u[T],B*d,A),S=m[d]?m[d]:n.j.Zero(),n.j.TransformCoordinatesToRef(h,A,S),S.scaleInPlace(V).addInPlace(v[T]),m[d]=S;Q[f]=m,f++}const P=(d,Q)=>{const n=Array();for(let T=0;T<d;T++)n.push(v[Q]);return n};switch(r){case T.b.NO_CAP:break;case T.b.CAP_START:Q[0]=P(e,0),Q[1]=Q[2].slice(0);break;case T.b.CAP_END:Q[f]=Q[f-1].slice(0),Q[f+1]=P(e,v.length-1);break;case T.b.CAP_ALL:Q[0]=P(e,0),Q[1]=Q[2].slice(0),Q[f]=Q[f-1].slice(0),Q[f+1]=P(e,v.length-1)}return Q};let V,h;if(e){const v=e._creationDataStorage,Q=d.arc||v.arc;return V=v.path3D.update(L),h=m(L,V,v.pathArray,F,v.tessellation,u,v.cap,Q),e=C("",{pathArray:h,instance:e}),v.path3D=V,v.pathArray=h,v.arc=Q,v.radius=F,e}V=new M.j(L);y=y<0||y>3?0:y,h=m(L,V,new Array,F,r,u,y,d.arc);const S=C(v,{pathArray:h,closePath:!0,closeArray:!1,updatable:B,sideOrientation:X,invertUV:z,frontUVs:d.frontUVs,backUVs:d.backUVs},Q);return S._creationDataStorage.pathArray=h,S._creationDataStorage.path3D=V,S._creationDataStorage.tessellation=r,S._creationDataStorage.cap=y,S._creationDataStorage.arc=d.arc,S._creationDataStorage.radius=F,S}function t(v){const d=[];d[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},d[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},d[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},d[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},d[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},d[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},d[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},d[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},d[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},d[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},d[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},d[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},d[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},d[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},d[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Q=v.type&&(v.type<0||v.type>=d.length)?0:v.type||0,T=v.size,L=v.sizeX||T||1,r=v.sizeY||T||1,C=v.sizeZ||T||1,u=v.custom||d[Q],y=u.face.length,B=v.faceUV||new Array(y),X=v.faceColors,m=void 0===v.flat||v.flat,V=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE,h=[],S=[],A=[],f=[],P=[];let O=0,J=0;const K=[];let o,g,R,M,Y,D,i=0,Z=0;if(m)for(Z=0;Z<y;Z++)X&&void 0===X[Z]&&(X[Z]=new z.f(1,1,1,1)),B&&void 0===B[Z]&&(B[Z]=new n.k(0,0,1,1));if(m)for(Z=0;Z<y;Z++){const v=u.face[Z].length;for(R=2*Math.PI/v,M=.5*Math.tan(R/2),Y=.5,i=0;i<v;i++)h.push(u.vertex[u.face[Z][i]][0]*L,u.vertex[u.face[Z][i]][1]*r,u.vertex[u.face[Z][i]][2]*C),K.push(O),O++,o=B[Z].x+(B[Z].z-B[Z].x)*(.5+M),g=B[Z].y+(B[Z].w-B[Z].y)*(Y-.5),f.push(o,F.d?1-g:g),D=M*Math.cos(R)-Y*Math.sin(R),Y=M*Math.sin(R)+Y*Math.cos(R),M=D,X&&P.push(X[Z].r,X[Z].g,X[Z].b,X[Z].a);for(i=0;i<v-2;i++)S.push(K[0+J],K[i+2+J],K[i+1+J]);J+=v}else{for(i=0;i<u.vertex.length;i++)h.push(u.vertex[i][0]*L,u.vertex[i][1]*r,u.vertex[i][2]*C),f.push(0,F.d?1:0);for(Z=0;Z<y;Z++)for(i=0;i<u.face[Z].length-2;i++)S.push(u.face[Z][0],u.face[Z][i+2],u.face[Z][i+1])}e.b.ComputeNormals(h,S,A),e.b._ComputeSides(V,h,S,A,f,v.frontUVs,v.backUVs);const j=new e.b;return j.xa=h,j.indices=S,j.ya=A,j.Aa=f,X&&m&&(j.za=P),j}function p(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return t(d).Ca(n,d.updatable),n}T.b.CreateTube=(v,d,Q,n,T,L,e,F,r,C)=>k(v,{path:d,radius:Q,tessellation:n,radiusFunction:T,arc:1,cap:L,updatable:F,sideOrientation:r,instance:C},e);function W(v){const d=v.sideOrientation||e.b.DEFAULTSIDE,Q=v.radius||1,T=void 0===v.flat||v.flat,L=0|(v.subdivisions||4),r=v.radiusX||Q,C=v.radiusY||Q,u=v.radiusZ||Q,y=(1+Math.sqrt(5))/2,z=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],B=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],X=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],m=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],V=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],h=[],S=[],A=[],f=[];let P=0;const O=new Array(3),J=new Array(3);let K;for(K=0;K<3;K++)O[K]=n.j.Zero(),J[K]=n.i.Zero();for(let e=0;e<20;e++){for(K=0;K<3;K++){const v=B[3*e+K];O[K].ld(z[3*X[v]],z[3*X[v]+1],z[3*X[v]+2]),O[K].normalize(),J[K].ld(.134765625*m[2*v]+.05859375+-.0390625*V[e],.2333984375*m[2*v+1]+.025390625+.01953125*V[e])}const v=(v,d,Q,e)=>{const y=n.j.Lerp(O[0],O[2],d/L),z=n.j.Lerp(O[1],O[2],d/L),B=L===d?O[2]:n.j.Lerp(y,z,v/(L-d));let X;if(B.normalize(),T){const v=n.j.Lerp(O[0],O[2],e/L),d=n.j.Lerp(O[1],O[2],e/L);X=n.j.Lerp(v,d,Q/(L-e))}else X=new n.j(B.x,B.y,B.z);X.x/=r,X.y/=C,X.z/=u,X.normalize();const m=n.i.Lerp(J[0],J[2],d/L),V=n.i.Lerp(J[1],J[2],d/L),K=L===d?J[2]:n.i.Lerp(m,V,v/(L-d));S.push(B.x*r,B.y*C,B.z*u),A.push(X.x,X.y,X.z),f.push(K.x,F.d?1-K.y:K.y),h.push(P),P++};for(let d=0;d<L;d++)for(let Q=0;Q+d<L;Q++)v(Q,d,Q+1/3,d+1/3),v(Q+1,d,Q+1/3,d+1/3),v(Q,d+1,Q+1/3,d+1/3),Q+d+1<L&&(v(Q+1,d,Q+2/3,d+2/3),v(Q+1,d+1,Q+2/3,d+2/3),v(Q,d+1,Q+2/3,d+2/3))}e.b._ComputeSides(d,S,h,A,f,v.frontUVs,v.backUVs);const o=new e.b;return o.indices=h,o.xa=S,o.ya=A,o.Aa=f,o}function q(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new T.b(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),n._originalBuilderSideOrientation=d.sideOrientation;return W(d).Ca(n,d.updatable),n}e.b.CreatePolyhedron=t,T.b.CreatePolyhedron=(v,d,Q)=>p(v,d,Q);e.b.CreateIcoSphere=W,T.b.CreateIcoSphere=(v,d,Q)=>q(v,d,Q);var b=Q(664);const H=new n.j(1,0,0),s=new n.j(-1,0,0),a=new n.j(0,1,0),I=new n.j(0,-1,0),U=new n.j(0,0,1),c=new n.j(0,0,-1);class w{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.j.Zero(),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.j.Up(),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.i.Zero(),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=v,this.nk=d,this.uv=Q,this.vertexIdx=T,this.vertexIdxForBones=L,this.localPositionOverride=e,this.localNormalOverride=F,this.matrixIndicesOverride=r,this.matrixWeightsOverride=C}clone(){var v,d,Q,n;return new w(this.position.clone(),this.nk.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(v=this.localPositionOverride)||void 0===v?void 0:v.slice(),null===(d=this.localNormalOverride)||void 0===d?void 0:d.slice(),null===(Q=this.matrixIndicesOverride)||void 0===Q?void 0:Q.slice(),null===(n=this.matrixWeightsOverride)||void 0===n?void 0:n.slice())}}function G(v,d,Q){var r,C,u,y,z;const B=!!d.skeleton,X=!(null===(r=d.morphTargetManager)||void 0===r||!r.numTargets),m=Q.localMode||B,V=d.ek(),h=B||X?d.yc(!0,!0):d.getVerticesData(L.e.PositionKind),S=B||X?d.getNormalsData(!0,!0):d.getVerticesData(L.e.NormalKind),A=m?B?d.getVerticesData(L.e.PositionKind):h:null,f=m?B?d.getVerticesData(L.e.NormalKind):S:null,P=d.getVerticesData(L.e.UVKind),O=B?d.getVerticesData(L.e.MatricesIndicesKind):null,J=B?d.getVerticesData(L.e.MatricesWeightsKind):null,K=B?d.getVerticesData(L.e.MatricesIndicesExtraKind):null,o=B?d.getVerticesData(L.e.MatricesWeightsExtraKind):null,g=Q.position||n.j.Zero();let R=Q.nk||n.j.Up();const M=Q.size||n.j.One(),Y=Q.angle||0;if(!R){const v=new n.j(0,0,1),Q=d.va().activeCamera,T=n.j.TransformCoordinates(v,Q.getWorldMatrix());R=Q.globalPosition.Wd(T)}const D=-Math.atan2(R.z,R.x)-Math.PI/2,i=Math.sqrt(R.x*R.x+R.z*R.z),Z=Math.atan2(R.y,i),j=new e.b;j.indices=[],j.xa=[],j.ya=[],j.Aa=[],j.matricesIndices=B?[]:null,j.matricesWeights=B?[]:null,j.matricesIndicesExtra=K?[]:null,j.matricesWeightsExtra=o?[]:null;let x=0;const k=(v,d)=>{const T=new w;if(!V||!h||!S)return T;const L=V[v];if(T.vertexIdx=3*L,T.vertexIdxForBones=4*L,T.position=new n.j(h[3*L],h[3*L+1],h[3*L+2]),n.j.TransformCoordinatesToRef(T.position,d,T.position),T.nk=new n.j(S[3*L],S[3*L+1],S[3*L+2]),n.j.TransformNormalToRef(T.nk,d,T.nk),Q.captureUVS&&P){const v=P[2*L+1];T.uv=new n.i(P[2*L],F.d?1-v:v)}return T},t=[0,0,0,0],p=(v,d)=>{if(0===v.length)return v;const Q=.5*Math.abs(n.j.Dot(M,d)),T=(v,d,Q,n)=>{for(let T=0;T<n;++T)if(v[Q+T]===d)return Q+T;return-1},L=(v,L)=>{const e=n.j.GetClipFactor(v.position,L.position,d,Q);let F=t,r=t;if(O&&J){const d=v.matrixIndicesOverride?0:v.vertexIdxForBones,Q=v.matrixIndicesOverride??O,n=v.matrixWeightsOverride??J,C=L.matrixIndicesOverride?0:L.vertexIdxForBones,u=L.matrixIndicesOverride??O,y=L.matrixWeightsOverride??J;F=[0,0,0,0],r=[0,0,0,0];let z=0;for(let v=0;v<4;++v)if(n[d+v]>0){const L=T(u,Q[d+v],C,4);F[z]=Q[d+v],r[z]=(0,b.Lerp)(n[d+v],L>=0?y[L]:0,e),z++}for(let v=0;v<4&&z<4;++v){const n=u[C+v];-1===T(Q,n,d,4)&&(F[z]=n,r[z]=(0,b.Lerp)(0,y[C+v],e),z++)}const B=r[0]+r[1]+r[2]+r[3];r[0]/=B,r[1]/=B,r[2]/=B,r[3]/=B}const C=v.localPositionOverride?v.localPositionOverride[0]:(null===A||void 0===A?void 0:A[v.vertexIdx])??0,u=v.localPositionOverride?v.localPositionOverride[1]:(null===A||void 0===A?void 0:A[v.vertexIdx+1])??0,y=v.localPositionOverride?v.localPositionOverride[2]:(null===A||void 0===A?void 0:A[v.vertexIdx+2])??0,z=L.localPositionOverride?L.localPositionOverride[0]:(null===A||void 0===A?void 0:A[L.vertexIdx])??0,B=L.localPositionOverride?L.localPositionOverride[1]:(null===A||void 0===A?void 0:A[L.vertexIdx+1])??0,X=L.localPositionOverride?L.localPositionOverride[2]:(null===A||void 0===A?void 0:A[L.vertexIdx+2])??0,m=v.localNormalOverride?v.localNormalOverride[0]:(null===f||void 0===f?void 0:f[v.vertexIdx])??0,V=v.localNormalOverride?v.localNormalOverride[1]:(null===f||void 0===f?void 0:f[v.vertexIdx+1])??0,h=v.localNormalOverride?v.localNormalOverride[2]:(null===f||void 0===f?void 0:f[v.vertexIdx+2])??0,S=m+((L.localNormalOverride?L.localNormalOverride[0]:(null===f||void 0===f?void 0:f[L.vertexIdx])??0)-m)*e,P=V+((L.localNormalOverride?L.localNormalOverride[1]:(null===f||void 0===f?void 0:f[L.vertexIdx+1])??0)-V)*e,K=h+((L.localNormalOverride?L.localNormalOverride[2]:(null===f||void 0===f?void 0:f[L.vertexIdx+2])??0)-h)*e,o=Math.sqrt(S*S+P*P+K*K);return new w(n.j.Lerp(v.position,L.position,e),n.j.Lerp(v.nk,L.nk,e).normalize(),n.i.Lerp(v.uv,L.uv,e),-1,-1,A?[C+(z-C)*e,u+(B-u)*e,y+(X-y)*e]:null,f?[S/o,P/o,K/o]:null,F,r)};let e=null;v.length>3&&(e=[]);for(let F=0;F<v.length;F+=3){let T=0,r=null,C=null,u=null,y=null;const z=n.j.Dot(v[F].position,d)-Q>0,B=n.j.Dot(v[F+1].position,d)-Q>0,X=n.j.Dot(v[F+2].position,d)-Q>0;switch(T=(z?1:0)+(B?1:0)+(X?1:0),T){case 0:v.length>3?(e.push(v[F]),e.push(v[F+1]),e.push(v[F+2])):e=v;break;case 1:if(e=e??new Array,z&&(r=v[F+1],C=v[F+2],u=L(v[F],r),y=L(v[F],C)),B){r=v[F],C=v[F+2],u=L(v[F+1],r),y=L(v[F+1],C),e.push(u),e.push(C.clone()),e.push(r.clone()),e.push(C.clone()),e.push(u.clone()),e.push(y);break}X&&(r=v[F],C=v[F+1],u=L(v[F+2],r),y=L(v[F+2],C)),r&&C&&u&&y&&(e.push(r.clone()),e.push(C.clone()),e.push(u),e.push(y),e.push(u.clone()),e.push(C.clone()));break;case 2:e=e??new Array,z||(r=v[F].clone(),C=L(r,v[F+1]),u=L(r,v[F+2]),e.push(r),e.push(C),e.push(u)),B||(r=v[F+1].clone(),C=L(r,v[F+2]),u=L(r,v[F]),e.push(r),e.push(C),e.push(u)),X||(r=v[F+2].clone(),C=L(r,v[F]),u=L(r,v[F+1]),e.push(r),e.push(C),e.push(u))}}return e},W=d instanceof T.b?d:null,q=null===W||void 0===W?void 0:W._thinInstanceDataStorage.matrixData,G=(null===W||void 0===W?void 0:W.Mk)||1,E=n.g.Matrix[0];E.p(n.b.IdentityReadOnly);for(let T=0;T<G;++T){if(null!==W&&void 0!==W&&W.hasThinInstances&&q){const v=16*T;E.setRowFromFloats(0,q[v+0],q[v+1],q[v+2],q[v+3]),E.setRowFromFloats(1,q[v+4],q[v+5],q[v+6],q[v+7]),E.setRowFromFloats(2,q[v+8],q[v+9],q[v+10],q[v+11]),E.setRowFromFloats(3,q[v+12],q[v+13],q[v+14],q[v+15])}const v=n.b.RotationYawPitchRoll(D,Z,Y).multiply(n.b.Translation(g.x,g.y,g.z)),L=n.b.Invert(v),e=d.getWorldMatrix(),r=E.multiply(e).multiply(L),C=new Array(3);for(let d=0;d<V.length;d+=3){let v=C;if(v[0]=k(d,r),v[1]=k(d+1,r),v[2]=k(d+2,r),!(Q.cullBackFaces&&-v[0].nk.z<=0&&-v[1].nk.z<=0&&-v[2].nk.z<=0)&&(v=p(v,H),v&&(v=p(v,s),v&&(v=p(v,a),v&&(v=p(v,I),v&&(v=p(v,U),v&&(v=p(v,c),v)))))))for(let d=0;d<v.length;d++){const n=v[d];if(j.indices.push(x),m?(n.localPositionOverride?(j.xa[3*x]=n.localPositionOverride[0],j.xa[3*x+1]=n.localPositionOverride[1],j.xa[3*x+2]=n.localPositionOverride[2]):A&&(j.xa[3*x]=A[n.vertexIdx],j.xa[3*x+1]=A[n.vertexIdx+1],j.xa[3*x+2]=A[n.vertexIdx+2]),n.localNormalOverride?(j.ya[3*x]=n.localNormalOverride[0],j.ya[3*x+1]=n.localNormalOverride[1],j.ya[3*x+2]=n.localNormalOverride[2]):f&&(j.ya[3*x]=f[n.vertexIdx],j.ya[3*x+1]=f[n.vertexIdx+1],j.ya[3*x+2]=f[n.vertexIdx+2])):(n.position.toArray(j.xa,3*x),n.nk.toArray(j.ya,3*x)),j.matricesIndices&&j.matricesWeights&&(n.matrixIndicesOverride?(j.matricesIndices[4*x]=n.matrixIndicesOverride[0],j.matricesIndices[4*x+1]=n.matrixIndicesOverride[1],j.matricesIndices[4*x+2]=n.matrixIndicesOverride[2],j.matricesIndices[4*x+3]=n.matrixIndicesOverride[3]):(O&&(j.matricesIndices[4*x]=O[n.vertexIdxForBones],j.matricesIndices[4*x+1]=O[n.vertexIdxForBones+1],j.matricesIndices[4*x+2]=O[n.vertexIdxForBones+2],j.matricesIndices[4*x+3]=O[n.vertexIdxForBones+3]),K&&j.matricesIndicesExtra&&(j.matricesIndicesExtra[4*x]=K[n.vertexIdxForBones],j.matricesIndicesExtra[4*x+1]=K[n.vertexIdxForBones+1],j.matricesIndicesExtra[4*x+2]=K[n.vertexIdxForBones+2],j.matricesIndicesExtra[4*x+3]=K[n.vertexIdxForBones+3])),n.matrixWeightsOverride?(j.matricesWeights[4*x]=n.matrixWeightsOverride[0],j.matricesWeights[4*x+1]=n.matrixWeightsOverride[1],j.matricesWeights[4*x+2]=n.matrixWeightsOverride[2],j.matricesWeights[4*x+3]=n.matrixWeightsOverride[3]):(J&&(j.matricesWeights[4*x]=J[n.vertexIdxForBones],j.matricesWeights[4*x+1]=J[n.vertexIdxForBones+1],j.matricesWeights[4*x+2]=J[n.vertexIdxForBones+2],j.matricesWeights[4*x+3]=J[n.vertexIdxForBones+3]),o&&j.matricesWeightsExtra&&(j.matricesWeightsExtra[4*x]=o[n.vertexIdxForBones],j.matricesWeightsExtra[4*x+1]=o[n.vertexIdxForBones+1],j.matricesWeightsExtra[4*x+2]=o[n.vertexIdxForBones+2],j.matricesWeightsExtra[4*x+3]=o[n.vertexIdxForBones+3]))),Q.captureUVS)n.uv.toArray(j.Aa,2*x);else{j.Aa.push(.5+n.position.x/M.x);const v=.5+n.position.y/M.y;j.Aa.push(F.d?1-v:v)}x++}}}0===j.indices.length&&(j.indices=null),0===j.xa.length&&(j.xa=null),0===j.ya.length&&(j.ya=null),0===j.Aa.length&&(j.Aa=null),0===(null===(C=j.matricesIndices)||void 0===C?void 0:C.length)&&(j.matricesIndices=null),0===(null===(u=j.matricesWeights)||void 0===u?void 0:u.length)&&(j.matricesWeights=null),0===(null===(y=j.matricesIndicesExtra)||void 0===y?void 0:y.length)&&(j.matricesIndicesExtra=null),0===(null===(z=j.matricesWeightsExtra)||void 0===z?void 0:z.length)&&(j.matricesWeightsExtra=null);const N=new T.b(v,d.va());return j.Ca(N),m?(N.skeleton=d.skeleton,N.parent=d):(N.position=g.clone(),N.rotation=new n.j(Z,D,Y)),N.ck(!0),N.refreshBoundingInfo(!0,!0),N}function E(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const d=0|Math.max(v.subdivisions?v.subdivisions:2,1),Q=0|Math.max(v.tessellation?v.tessellation:16,3),T=Math.max(v.height?v.height:1,0),L=Math.max(v.radius?v.radius:.25,0),r=0|Math.max(v.capSubdivisions?v.capSubdivisions:6,1),C=Q,u=d,y=Math.max(v.radiusTop?v.radiusTop:L,0),z=Math.max(v.radiusBottom?v.radiusBottom:L,0),B=T-(y+z),X=2*Math.PI,m=Math.max(v.topCapSubdivisions?v.topCapSubdivisions:r,1),V=Math.max(v.bottomCapSubdivisions?v.bottomCapSubdivisions:r,1),h=Math.acos((z-y)/T);let S=[];const A=[],f=[],P=[];let O=0;const J=[],K=.5*B,o=.5*Math.PI;let g,R;const M=n.j.Zero(),Y=n.j.Zero(),D=Math.cos(h),i=Math.sin(h),Z=new n.i(y*i,K+y*D).Wd(new n.i(z*i,z*D-K)).length(),j=y*h+Z+z*(o-h);let x=0;for(R=0;R<=m;R++){const v=[],d=o-h*(R/m);x+=y*h/m;const Q=Math.cos(d),n=Math.sin(d),T=Q*y;for(g=0;g<=C;g++){const d=g/C,L=d*X+0,e=Math.sin(L),r=Math.cos(L);Y.x=T*e,Y.y=K+n*y,Y.z=T*r,A.push(Y.x,Y.y,Y.z),M.set(Q*e,n,Q*r),f.push(M.x,M.y,M.z),P.push(d,F.d?x/j:1-x/j),v.push(O),O++}J.push(v)}const k=T-y-z+D*y-D*z,t=i*(z-y)/k;for(R=1;R<=u;R++){const v=[];x+=Z/u;const d=i*(R*(z-y)/u+y);for(g=0;g<=C;g++){const Q=g/C,n=Q*X+0,T=Math.sin(n),L=Math.cos(n);Y.x=d*T,Y.y=K+D*y-R*k/u,Y.z=d*L,A.push(Y.x,Y.y,Y.z),M.set(T,t,L).normalize(),f.push(M.x,M.y,M.z),P.push(Q,F.d?x/j:1-x/j),v.push(O),O++}J.push(v)}for(R=1;R<=V;R++){const v=[],d=o-h-(Math.PI-h)*(R/V);x+=z*h/V;const Q=Math.cos(d),n=Math.sin(d),T=Q*z;for(g=0;g<=C;g++){const d=g/C,L=d*X+0,e=Math.sin(L),r=Math.cos(L);Y.x=T*e,Y.y=n*z-K,Y.z=T*r,A.push(Y.x,Y.y,Y.z),M.set(Q*e,n,Q*r),f.push(M.x,M.y,M.z),P.push(d,F.d?x/j:1-x/j),v.push(O),O++}J.push(v)}for(g=0;g<C;g++)for(R=0;R<m+u+V;R++){const v=J[R][g],d=J[R+1][g],Q=J[R+1][g+1],n=J[R][g+1];S.push(v),S.push(d),S.push(n),S.push(d),S.push(Q),S.push(n)}if(S=S.reverse(),v.orientation&&!v.orientation.equals(n.j.Up())){const d=new n.b;v.orientation.clone().scale(.5*Math.PI).cross(n.j.Up()).toQuaternion().toRotationMatrix(d);const Q=n.j.Zero();for(let v=0;v<A.length;v+=3)Q.set(A[v],A[v+1],A[v+2]),n.j.TransformCoordinatesToRef(Q.clone(),d,Q),A[v]=Q.x,A[v+1]=Q.y,A[v+2]=Q.z}const p=new e.b;return p.xa=A,p.ya=f,p.Aa=P,p.indices=S,p}function N(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:n.j.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new T.b(v,Q);return E(d).Ca(L,d.updatable),L}T.b.CreateDecal=(v,d,Q,n,T,L)=>G(v,d,{position:Q,nk:n,size:T,angle:L});T.b.CreateCapsule=(v,d,Q)=>N(v,d,Q),e.b.CreateCapsule=E;var l=Q(482),vv=Q(658);class dv{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=v,this.y=d,v!==Math.floor(v)&&(v=Math.floor(v),l.d.Warn("x is not an integer, floor(x) used")),d!==Math.floor(d)&&(d=Math.floor(d),l.d.Warn("y is not an integer, floor(y) used"))}clone(){return new dv(this.x,this.y)}rotate60About(v){const d=this.x;return this.x=v.x+v.y-this.y,this.y=d+this.y-v.x,this}rotateNeg60About(v){const d=this.x;return this.x=d+this.y-v.y,this.y=v.x+v.y-d,this}rotate120(v,d){v!==Math.floor(v)&&(v=Math.floor(v),l.d.Warn("m not an integer only floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),l.d.Warn("n not an integer only floor(n) used"));const Q=this.x;return this.x=v-Q-this.y,this.y=d+Q,this}rotateNeg120(v,d){v!==Math.floor(v)&&(v=Math.floor(v),l.d.Warn("m is not an integer, floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),l.d.Warn("n is not an integer,   floor(n) used"));const Q=this.x;return this.x=this.y-d,this.y=v+d-Q-this.y,this}toCartesianOrigin(v,d){const Q=n.j.Zero();return Q.x=v.x+2*this.x*d+this.y*d,Q.y=v.y+Math.sqrt(3)*this.y*d,Q}static Zero(){return new dv(0,0)}}class Qv{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new nv("icosahedron","Regular",[[0,vv.d,-1],[-vv.d,1,0],[-1,0,-vv.d],[1,0,-vv.d],[vv.d,1,0],[0,vv.d,1],[-1,0,vv.d],[-vv.d,-1,0],[0,-vv.d,-1],[vv.d,-1,0],[1,0,vv.d],[0,-vv.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let v=12;const d={},Q=this.m,n=this.n;let T,L,e,F,r,C=Q,u=1,y=0;0!==n&&(C=(0,b.HighestCommonFactor)(Q,n)),u=Q/C,y=n/C;const z=dv.Zero(),B=new dv(Q,n),X=new dv(-n,Q+n),m=dv.Zero(),V=dv.Zero(),h=dv.Zero();let S,A,f,P,O=[];const J=[],K=this.vertByDist,o=(Q,n,T,L)=>{S=Q+"|"+T,A=n+"|"+L,S in d||A in d?S in d&&!(A in d)?d[A]=d[S]:A in d&&!(S in d)&&(d[S]=d[A]):(d[S]=v,d[A]=v,v++),K[T][0]>2?J[d[S]]=[-K[T][0],K[T][1],d[S]]:J[d[S]]=[O[K[T][0]],K[T][1],d[S]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let g=0;g<20;g++){if(O=this.IDATA.face[g],e=O[2],F=O[1],r=O[0],f=z.x+"|"+z.y,S=g+"|"+f,S in d||(d[S]=e,J[e]=[O[K[f][0]],K[f][1]]),f=B.x+"|"+B.y,S=g+"|"+f,S in d||(d[S]=F,J[F]=[O[K[f][0]],K[f][1]]),f=X.x+"|"+X.y,S=g+"|"+f,S in d||(d[S]=r,J[r]=[O[K[f][0]],K[f][1]]),T=this.IDATA.edgematch[g][0],L=this.IDATA.edgematch[g][1],"B"===L)for(let v=1;v<C;v++)V.x=Q-v*(u+y),V.y=n+v*u,h.x=-v*y,h.y=v*(u+y),f=V.x+"|"+V.y,P=h.x+"|"+h.y,o(g,T,f,P);if("O"===L)for(let v=1;v<C;v++)h.x=-v*y,h.y=v*(u+y),m.x=v*u,m.y=v*y,f=h.x+"|"+h.y,P=m.x+"|"+m.y,o(g,T,f,P);if(T=this.IDATA.edgematch[g][2],L=this.IDATA.edgematch[g][3],L&&"A"===L)for(let v=1;v<C;v++)m.x=v*u,m.y=v*y,V.x=Q-(C-v)*(u+y),V.y=n+(C-v)*u,f=m.x+"|"+m.y,P=V.x+"|"+V.y,o(g,T,f,P);for(let Q=0;Q<this.vertices.length;Q++)f=this.vertices[Q].x+"|"+this.vertices[Q].y,S=g+"|"+f,S in d||(d[S]=v++,K[f][0]>2?J[d[S]]=[-K[f][0],K[f][1],d[S]]:J[d[S]]=[O[K[f][0]],K[f][1],d[S]])}this.closestTo=J,this.vecToidx=d}calcCoeffs(){const v=this.m,d=this.n,Q=Math.sqrt(3)/3,n=v*v+d*d+v*d;this.coau=(v+d)/n,this.cobu=-d/n,this.coav=-Q*(v-d)/n,this.cobv=Q*(2*v+d)/n}createInnerFacets(){const v=this.m,d=this.n;for(let Q=0;Q<d+v+1;Q++)for(let v=this.min[Q];v<this.max[Q]+1;v++)v<this.max[Q]&&v<this.max[Q+1]+1&&this.innerFacets.push(["|"+v+"|"+Q,"|"+v+"|"+(Q+1),"|"+(v+1)+"|"+Q]),Q>0&&v<this.max[Q-1]&&v+1<this.max[Q]+1&&this.innerFacets.push(["|"+v+"|"+Q,"|"+(v+1)+"|"+Q,"|"+(v+1)+"|"+(Q-1)])}edgeVecsABOB(){const v=this.m,d=this.n,Q=new dv(-d,v+d);for(let n=1;n<v+d;n++){const v=new dv(this.min[n],n),d=new dv(this.min[n-1],n-1),T=new dv(this.min[n+1],n+1),L=v.clone(),e=d.clone(),F=T.clone();L.rotate60About(Q),e.rotate60About(Q),F.rotate60About(Q);const r=new dv(this.max[L.y],L.y),C=new dv(this.max[L.y-1],L.y-1),u=new dv(this.max[L.y-1]-1,L.y-1);L.x===r.x&&L.y===r.y||(L.x!==C.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,C,u]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,u,r])):L.y===F.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([v,d,C]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([v,C,T])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([v,d,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,C,r])))}}mapABOBtoOBOA(){const v=new dv(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const Q=[];for(let n=0;n<3;n++)v.x=this.isoVecsABOB[d][n].x,v.y=this.isoVecsABOB[d][n].y,0===this.vertexTypes[d][n]&&v.rotateNeg120(this.m,this.n),Q.push(v.clone());this.isoVecsOBOA.push(Q)}}mapABOBtoBAOA(){const v=new dv(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const Q=[];for(let n=0;n<3;n++)v.x=this.isoVecsABOB[d][n].x,v.y=this.isoVecsABOB[d][n].y,1===this.vertexTypes[d][n]&&v.rotate120(this.m,this.n),Q.push(v.clone());this.isoVecsBAOA.push(Q)}}MapToFace(v,d){const Q=this.IDATA.face[v],T=Q[2],L=Q[1],e=Q[0],F=n.j.dk(this.IDATA.vertex[T]),r=n.j.dk(this.IDATA.vertex[L]),C=n.j.dk(this.IDATA.vertex[e]),u=r.Wd(F),y=C.Wd(F),z=u.scale(this.coau).add(y.scale(this.cobu)),B=u.scale(this.coav).add(y.scale(this.cobv)),X=[];let m,V=n.g.fk[0];for(let n=0;n<this.cartesian.length;n++)V=z.scale(this.cartesian[n].x).add(B.scale(this.cartesian[n].y)).add(F),X[n]=[V.x,V.y,V.z],m=v+"|"+this.vertices[n].x+"|"+this.vertices[n].y,d.vertex[this.vecToidx[m]]=[V.x,V.y,V.z]}build(v,d){const Q=[],n=dv.Zero(),T=new dv(v,d),L=new dv(-d,v+d);Q.push(n,T,L);for(let f=d;f<v+1;f++)for(let d=0;d<v+1-f;d++)Q.push(new dv(d,f));if(d>0){const n=(0,b.HighestCommonFactor)(v,d),T=v/n,L=d/n;for(let F=1;F<n;F++)Q.push(new dv(F*T,F*L)),Q.push(new dv(-F*L,F*(T+L))),Q.push(new dv(v-F*(T+L),d+F*T));const e=v/d;for(let F=1;F<d;F++)for(let n=0;n<F*e;n++)Q.push(new dv(n,F)),Q.push(new dv(n,F).rotate120(v,d)),Q.push(new dv(n,F).rotateNeg120(v,d))}Q.sort(((v,d)=>v.x-d.x)),Q.sort(((v,d)=>v.y-d.y));const e=new Array(v+d+1),F=new Array(v+d+1);for(let f=0;f<e.length;f++)e[f]=1/0,F[f]=-1/0;let r=0,C=0;const u=Q.length;for(let f=0;f<u;f++)C=Q[f].x,r=Q[f].y,e[r]=Math.min(C,e[r]),F[r]=Math.max(C,F[r]);const y=(Q,n)=>{const T=Q.clone();return"A"===n&&T.rotateNeg120(v,d),"B"===n&&T.rotate120(v,d),T.x<0?T.y:T.x+T.y},z=[],B=[],X=[],m=[],V={},h=[];let S=-1,A=-1;for(let f=0;f<u;f++)z[f]=Q[f].toCartesianOrigin(new dv(0,0),.5),B[f]=y(Q[f],"O"),X[f]=y(Q[f],"A"),m[f]=y(Q[f],"B"),B[f]===X[f]&&X[f]===m[f]?(S=3,A=B[f]):B[f]===X[f]?(S=4,A=B[f]):X[f]===m[f]?(S=5,A=X[f]):m[f]===B[f]&&(S=6,A=B[f]),B[f]<X[f]&&B[f]<m[f]&&(S=2,A=B[f]),X[f]<B[f]&&X[f]<m[f]&&(S=1,A=X[f]),m[f]<X[f]&&m[f]<B[f]&&(S=0,A=m[f]),h.push([S,A,Q[f].x,Q[f].y]);h.sort(((v,d)=>v[2]-d[2])),h.sort(((v,d)=>v[3]-d[3])),h.sort(((v,d)=>v[1]-d[1])),h.sort(((v,d)=>v[0]-d[0]));for(let f=0;f<h.length;f++)V[h[f][2]+"|"+h[f][3]]=[h[f][0],h[f][1],f];return this.m=v,this.n=d,this.vertices=Q,this.vertByDist=V,this.cartesian=z,this.min=e,this.max=F,this}}class nv{constructor(v,d,Q,n){this.name=v,this.category=d,this.vertex=Q,this.face=n}}class Tv extends nv{innerToData(v,d){for(let Q=0;Q<d.innerFacets.length;Q++)this.face.push(d.innerFacets[Q].map((Q=>d.vecToidx[v+Q])))}mapABOBtoDATA(v,d){const Q=d.IDATA.edgematch[v][0];for(let n=0;n<d.isoVecsABOB.length;n++){const T=[];for(let L=0;L<3;L++)0===d.vertexTypes[n][L]?T.push(v+"|"+d.isoVecsABOB[n][L].x+"|"+d.isoVecsABOB[n][L].y):T.push(Q+"|"+d.isoVecsABOB[n][L].x+"|"+d.isoVecsABOB[n][L].y);this.face.push([d.vecToidx[T[0]],d.vecToidx[T[1]],d.vecToidx[T[2]]])}}mapOBOAtoDATA(v,d){const Q=d.IDATA.edgematch[v][0];for(let n=0;n<d.isoVecsOBOA.length;n++){const T=[];for(let L=0;L<3;L++)1===d.vertexTypes[n][L]?T.push(v+"|"+d.isoVecsOBOA[n][L].x+"|"+d.isoVecsOBOA[n][L].y):T.push(Q+"|"+d.isoVecsOBOA[n][L].x+"|"+d.isoVecsOBOA[n][L].y);this.face.push([d.vecToidx[T[0]],d.vecToidx[T[1]],d.vecToidx[T[2]]])}}mapBAOAtoDATA(v,d){const Q=d.IDATA.edgematch[v][2];for(let n=0;n<d.isoVecsBAOA.length;n++){const T=[];for(let L=0;L<3;L++)1===d.vertexTypes[n][L]?T.push(v+"|"+d.isoVecsBAOA[n][L].x+"|"+d.isoVecsBAOA[n][L].y):T.push(Q+"|"+d.isoVecsBAOA[n][L].x+"|"+d.isoVecsBAOA[n][L].y);this.face.push([d.vecToidx[T[0]],d.vecToidx[T[1]],d.vecToidx[T[2]]])}}orderData(v){const d=[];for(let L=0;L<13;L++)d[L]=[];const Q=v.closestTo;for(let L=0;L<Q.length;L++)Q[L][0]>-1?Q[L][1]>0&&d[Q[L][0]].push([L,Q[L][1]]):d[12].push([L,Q[L][0]]);const n=[];for(let L=0;L<12;L++)n[L]=L;let T=12;for(let L=0;L<12;L++){d[L].sort(((v,d)=>v[1]-d[1]));for(let v=0;v<d[L].length;v++)n[d[L][v][0]]=T++}for(let L=0;L<d[12].length;L++)n[d[12][L][0]]=T++;for(let L=0;L<this.vertex.length;L++)this.vertex[L].push(n[L]);this.vertex.sort(((v,d)=>v[3]-d[3]));for(let L=0;L<this.vertex.length;L++)this.vertex[L].pop();for(let L=0;L<this.face.length;L++)for(let v=0;v<this.face[L].length;v++)this.face[L][v]=n[this.face[L][v]];this.sharedNodes=d[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(v,d){const Q=[],n=[];let T=d.pop();n.push(T);let L=this.face[T].indexOf(v);L=(L+2)%3;let e=this.face[T][L];Q.push(e);let F=0;for(;d.length>0;)T=d[F],this.face[T].indexOf(e)>-1?(L=(this.face[T].indexOf(e)+1)%3,e=this.face[T][L],Q.push(e),n.push(T),d.splice(F,1),F=0):F++;return this.adjacentFaces.push(Q),n}toGoldbergPolyhedronData(){const v=new nv("GeoDual","Goldberg",[],[]);v.name="GD dual";const d=this.vertex.length,Q=new Array(d);for(let r=0;r<d;r++)Q[r]=[];for(let r=0;r<this.face.length;r++)for(let v=0;v<3;v++)Q[this.face[r][v]].push(r);let n=0,T=0,L=0,e=[],F=[];this.adjacentFaces=[];for(let r=0;r<Q.length;r++){v.face[r]=this.setOrder(r,Q[r].concat([]));for(const d of Q[r]){n=0,T=0,L=0,e=this.face[d];for(let v=0;v<3;v++)F=this.vertex[e[v]],n+=F[0],T+=F[1],L+=F[2];v.vertex[d]=[n/3,T/3,L/3]}}return v}static BuildGeodesicData(v){const d=new Tv("Geodesic-m-n","Geodesic",[[0,vv.d,-1],[-vv.d,1,0],[-1,0,-vv.d],[1,0,-vv.d],[vv.d,1,0],[0,vv.d,1],[-1,0,vv.d],[-vv.d,-1,0],[0,-vv.d,-1],[vv.d,-1,0],[1,0,vv.d],[0,-vv.d,1]],[]);v.setIndices(),v.calcCoeffs(),v.createInnerFacets(),v.edgeVecsABOB(),v.mapABOBtoOBOA(),v.mapABOBtoBAOA();for(let Q=0;Q<v.IDATA.face.length;Q++)v.MapToFace(Q,d),d.innerToData(Q,v),"B"===v.IDATA.edgematch[Q][1]&&d.mapABOBtoDATA(Q,v),"O"===v.IDATA.edgematch[Q][1]&&d.mapOBOAtoDATA(Q,v),"A"===v.IDATA.edgematch[Q][3]&&d.mapBAOAtoDATA(Q,v);d.orderData(v);return d.vertex=d.vertex.map((function(v){const d=v[0],Q=v[1],n=v[2],T=Math.sqrt(d*d+Q*Q+n*n);return v[0]*=1/T,v[1]*=1/T,v[2]*=1/T,v})),d}}T.b._GoldbergMeshParser=(v,d)=>Lv.Parse(v,d);class Lv extends T.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(v,d){return void 0===d?(v>this.goldbergData.nbUnsharedFaces-1&&(l.d.Warn("Maximum number of unshared faces used"),v=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+v):(v>11&&(l.d.Warn("Last pole used"),v=11),d>this.goldbergData.nbFacesAtPole-1&&(l.d.Warn("Maximum number of faces at a pole used"),d=this.goldbergData.nbFacesAtPole-1),12+v*this.goldbergData.nbFacesAtPole+d)}_changeGoldbergFaceColors(v){for(let Q=0;Q<v.length;Q++){const d=v[Q][0],n=v[Q][1],T=v[Q][2];for(let v=d;v<n+1;v++)this.goldbergData.faceColors[v]=T}const d=[];for(let Q=0;Q<12;Q++)for(let v=0;v<5;v++)d.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);for(let Q=12;Q<this.goldbergData.faceColors.length;Q++)for(let v=0;v<6;v++)d.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);return d}setGoldbergFaceColors(v){const d=this._changeGoldbergFaceColors(v);this.Ga(L.e.ColorKind,d)}updateGoldbergFaceColors(v){const d=this._changeGoldbergFaceColors(v);this.updateVerticesData(L.e.ColorKind,d)}_changeGoldbergFaceUVs(v){const d=this.getVerticesData(L.e.UVKind);for(let Q=0;Q<v.length;Q++){const n=v[Q][0],T=v[Q][1],L=v[Q][2],e=v[Q][3],F=v[Q][4],r=[],C=[];let u,y;for(let v=0;v<5;v++)u=L.x+e*Math.cos(F+v*Math.PI/2.5),y=L.y+e*Math.sin(F+v*Math.PI/2.5),u<0&&(u=0),u>1&&(u=1),r.push(u,y);for(let v=0;v<6;v++)u=L.x+e*Math.cos(F+v*Math.PI/3),y=L.y+e*Math.sin(F+v*Math.PI/3),u<0&&(u=0),u>1&&(u=1),C.push(u,y);for(let v=n;v<Math.min(12,T+1);v++)for(let Q=0;Q<5;Q++)d[10*v+2*Q]=r[2*Q],d[10*v+2*Q+1]=r[2*Q+1];for(let v=Math.max(12,n);v<T+1;v++)for(let Q=0;Q<6;Q++)d[12*v-24+2*Q]=C[2*Q],d[12*v-23+2*Q]=C[2*Q+1]}return d}setGoldbergFaceUVs(v){const d=this._changeGoldbergFaceUVs(v);this.Ga(L.e.UVKind,d)}updateGoldbergFaceUVs(v){const d=this._changeGoldbergFaceUVs(v);this.updateVerticesData(L.e.UVKind,d)}placeOnGoldbergFaceAt(v,d,Q){const T=n.j.RotationFromAxis(this.goldbergData.faceXaxis[d],this.goldbergData.faceYaxis[d],this.goldbergData.faceZaxis[d]);v.rotation=T,v.position=this.goldbergData.faceCenters[d].add(this.goldbergData.faceXaxis[d].scale(Q.x)).add(this.goldbergData.faceYaxis[d].scale(Q.y)).add(this.goldbergData.faceZaxis[d].scale(Q.z))}serialize(v){super.serialize(v),v.type="GoldbergMesh";const d={};if(d.adjacentFaces=this.goldbergData.adjacentFaces,d.nbSharedFaces=this.goldbergData.nbSharedFaces,d.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,d.nbFaces=this.goldbergData.nbFaces,d.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){d.faceColors=[];for(const v of this.goldbergData.faceColors)d.faceColors.push(v.mk())}if(this.goldbergData.faceCenters){d.faceCenters=[];for(const v of this.goldbergData.faceCenters)d.faceCenters.push(v.mk())}if(this.goldbergData.faceZaxis){d.faceZaxis=[];for(const v of this.goldbergData.faceZaxis)d.faceZaxis.push(v.mk())}if(this.goldbergData.faceYaxis){d.faceYaxis=[];for(const v of this.goldbergData.faceYaxis)d.faceYaxis.push(v.mk())}if(this.goldbergData.faceXaxis){d.faceXaxis=[];for(const v of this.goldbergData.faceXaxis)d.faceXaxis.push(v.mk())}v.goldbergData=d}static Parse(v,d){const Q=v.goldbergData;Q.faceColors=Q.faceColors.map((v=>z.f.dk(v))),Q.faceCenters=Q.faceCenters.map((v=>n.j.dk(v))),Q.faceZaxis=Q.faceZaxis.map((v=>n.j.dk(v))),Q.faceXaxis=Q.faceXaxis.map((v=>n.j.dk(v))),Q.faceYaxis=Q.faceYaxis.map((v=>n.j.dk(v)));const T=new Lv(v.name,d);return T.goldbergData=Q,T}}var ev=Q(12042);const Fv={CreateBox:y.e,CreateTiledBox:V,CreateSphere:h.e,CreateDisc:u.b,CreateIcoSphere:q,CreateRibbon:C,CreateCylinder:P,CreateTorus:J,CreateTorusKnot:o,CreateLineSystem:g.e,Jk:g.h,CreateDashedLines:g.b,ExtrudeShape:Y,ExtrudeShapeCustom:D,CreateLathe:Z,CreateTiledPlane:X,Kk:j.b,CreateGround:x.f,CreateTiledGround:x.i,CreateGroundFromHeightMap:x.b,CreatePolygon:R.c,ExtrudePolygon:R.e,CreateTube:k,CreatePolyhedron:p,CreateGeodesic:function(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=d.m||1;n!==Math.floor(n)&&(n=Math.floor(n),l.d.Warn("m not an integer only floor(m) used"));let T=d.n||0;if(T!==Math.floor(T)&&(T=Math.floor(T),l.d.Warn("n not an integer only floor(n) used")),T>n){const v=T;T=n,n=v,l.d.Warn("n > m therefore m and n swapped")}const L=new Qv;return L.build(n,T),p(v,{custom:Tv.BuildGeodesicData(L),size:d.size,sizeX:d.sizeX,sizeY:d.sizeY,sizeZ:d.sizeZ,faceUV:d.faceUV,faceColors:d.faceColors,flat:d.flat,updatable:d.updatable,sideOrientation:d.sideOrientation,frontUVs:d.frontUVs,backUVs:d.backUVs},Q)},CreateGoldberg:function(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.size,r=d.sizeX||L||1,C=d.sizeY||L||1,u=d.sizeZ||L||1;let y=d.m||1;y!==Math.floor(y)&&(y=Math.floor(y),l.d.Warn("m not an integer only floor(m) used"));let B=d.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),l.d.Warn("n not an integer only floor(n) used")),B>y){const v=B;B=y,y=v,l.d.Warn("n > m therefore m and n swapped")}const X=new Qv;X.build(y,B);const m=Tv.BuildGeodesicData(X),V=m.toGoldbergPolyhedronData(),h=new Lv(v,Q);d.sideOrientation=T.b._GetDefaultSideOrientation(d.sideOrientation),h._originalBuilderSideOrientation=d.sideOrientation;(function(v,d){const Q=v.size,T=v.sizeX||Q||1,L=v.sizeY||Q||1,r=v.sizeZ||Q||1,C=0===v.sideOrientation?0:v.sideOrientation||e.b.DEFAULTSIDE,u=[],y=[],z=[],B=[];let X=1/0,m=-1/0,V=1/0,h=-1/0;for(let n=0;n<d.vertex.length;n++)X=Math.min(X,d.vertex[n][0]*T),m=Math.max(m,d.vertex[n][0]*T),V=Math.min(V,d.vertex[n][1]*L),h=Math.max(h,d.vertex[n][1]*L);let S=0;for(let e=0;e<d.face.length;e++){const v=d.face[e],Q=n.j.dk(d.vertex[v[0]]),C=n.j.dk(d.vertex[v[2]]),A=n.j.dk(d.vertex[v[1]]),f=C.Wd(Q),P=A.Wd(Q),O=n.j.Cross(P,f).normalize();for(let n=0;n<v.length;n++){z.push(O.x,O.y,O.z);const Q=d.vertex[v[n]];u.push(Q[0]*T,Q[1]*L,Q[2]*r);const e=(Q[1]*L-V)/(h-V);B.push((Q[0]*T-X)/(m-X),F.d?1-e:e)}for(let d=0;d<v.length-2;d++)y.push(S,S+d+2,S+d+1);S+=v.length}e.b._ComputeSides(C,u,y,z,B);const A=new e.b;return A.xa=u,A.indices=y,A.ya=z,A.Aa=B,A})(d,V).Ca(h,d.updatable),h.goldbergData.nbSharedFaces=m.sharedNodes,h.goldbergData.nbUnsharedFaces=m.poleNodes,h.goldbergData.adjacentFaces=m.adjacentFaces,h.goldbergData.nbFaces=h.goldbergData.nbSharedFaces+h.goldbergData.nbUnsharedFaces,h.goldbergData.nbFacesAtPole=(h.goldbergData.nbUnsharedFaces-12)/12;for(let T=0;T<m.vertex.length;T++)h.goldbergData.faceCenters.push(n.j.dk(m.vertex[T])),h.goldbergData.faceCenters[T].x*=r,h.goldbergData.faceCenters[T].y*=C,h.goldbergData.faceCenters[T].z*=u,h.goldbergData.faceColors.push(new z.f(1,1,1,1));for(let T=0;T<V.face.length;T++){const v=V.face[T],d=n.j.dk(V.vertex[v[0]]),Q=n.j.dk(V.vertex[v[2]]),L=n.j.dk(V.vertex[v[1]]),e=Q.Wd(d),F=L.Wd(d),r=n.j.Cross(F,e).normalize(),C=n.j.Cross(F,r).normalize();h.goldbergData.faceXaxis.push(F.normalize()),h.goldbergData.faceYaxis.push(r),h.goldbergData.faceZaxis.push(C)}return h},CreateDecal:G,CreateCapsule:N,CreateText:ev.h}},12487:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>Fd});var n=Q(651),T=Q(11939);class L extends T.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var e=Q(686),F=(Q(2116),Q(591));class r{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(v){this._targetStopDuration!==v&&(this._targetStopDuration=v)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(v){this._noiseTexture!==v&&(this._noiseTexture=v,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(v){this._animationSheetEnabled!==v&&(this._animationSheetEnabled=v)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(v){this._isAnimationSheetEnabled!=v&&(this._isAnimationSheetEnabled=v,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(v){this._useLogarithmicDepth=v&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(v){switch(v){case r.BLENDMODE_MULTIPLYADD:return;case r.BLENDMODE_ADD:v=1;break;case r.BLENDMODE_ONEONE:v=6;break;case r.BLENDMODE_STANDARD:v=2;break;case r.BLENDMODE_MULTIPLY:v=4;break;case r.BLENDMODE_SUBTRACT:v=3}this._engine.setAlphaMode(v)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:n.j.Zero()}set direction1(v){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=v)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:n.j.Zero()}set direction2(v){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=v)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:n.j.Zero()}set minEmitBox(v){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=v)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:n.j.Zero()}set maxEmitBox(v){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=v)}get billboardMode(){return this._billboardMode}set billboardMode(v){this._billboardMode!==v&&(this._billboardMode=v,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(v){this._isBillboardBased!==v&&(this._isBillboardBased=v,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(v){this._attachImageProcessingConfiguration(v)}_attachImageProcessingConfiguration(v){v!==this._imageProcessingConfiguration&&(!v&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=v)}_reset(){}_removeGradientAndTexture(v,d,Q){if(!d)return this;let n=0;for(const T of d){if(T.gradient===v){d.splice(n,1);break}n++}return Q&&Q.dispose(),this}constructor(v){this.animations=[],this.renderingGroupId=0,this.j=n.j.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new n.j(10,10,10),this.onAnimationEnd=null,this.blendMode=r.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new n.i(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Eg=new n.j(0,0,0),this._useLogarithmicDepth=!1,this.gravity=n.j.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new e.f(1,1,1,1),this.color2=new e.f(1,1,1,1),this.colorDead=new e.f(0,0,0,1),this.textureMask=new e.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new L,this.id=v,this.name=v}createPointEmitter(v,d){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new n.j(0,1,0),arguments.length>2&&void 0!==arguments[2]||new n.j(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new n.j(0,1,0),arguments.length>4&&void 0!==arguments[4]||new n.j(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new n.j(0,1,0),arguments.length>3&&void 0!==arguments[3]||new n.j(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(v,d,Q,n){throw new Error("Method not implemented.")}}r.BLENDMODE_ONEONE=0,r.BLENDMODE_STANDARD=1,r.BLENDMODE_ADD=2,r.BLENDMODE_MULTIPLY=3,r.BLENDMODE_MULTIPLYADD=4,r.BLENDMODE_SUBTRACT=-1,(0,F.f)("BABYLON.BaseParticleSystem",r);var C=Q(664),u=Q(484);class y{constructor(){this.direction1=new n.j(0,1,0),this.direction2=new n.j(0,1,0),this.minEmitBox=new n.j(-.5,-.5,-.5),this.maxEmitBox=new n.j(.5,.5,.5)}startDirectionFunction(v,d,Q,T){const L=(0,C.RandomRange)(this.direction1.x,this.direction2.x),e=(0,C.RandomRange)(this.direction1.y,this.direction2.y),F=(0,C.RandomRange)(this.direction1.z,this.direction2.z);if(T)return d.x=L,d.y=e,void(d.z=F);n.j.TransformNormalFromFloatsToRef(L,e,F,v,d)}startPositionFunction(v,d,Q,T){const L=(0,C.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),e=(0,C.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),F=(0,C.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(T)return d.x=L,d.y=e,void(d.z=F);n.j.TransformCoordinatesFromFloatsToRef(L,e,F,v,d)}clone(){const v=new y;return u.d.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2),v.setVector3("minEmitBox",this.minEmitBox),v.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3),v.addUniform("minEmitBox",3),v.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.direction1=this.direction1.mk(),v.direction2=this.direction2.mk(),v.minEmitBox=this.minEmitBox.mk(),v.maxEmitBox=this.maxEmitBox.mk(),v}parse(v){n.j.FromArrayToRef(v.direction1,0,this.direction1),n.j.FromArrayToRef(v.direction2,0,this.direction2),n.j.FromArrayToRef(v.minEmitBox,0,this.minEmitBox),n.j.FromArrayToRef(v.maxEmitBox,0,this.maxEmitBox)}}class z{get radius(){return this._radius}set radius(v){this._radius=v,this._buildHeight()}get angle(){return this._angle}set angle(v){this._angle=v,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Q,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=d,this.radius=v}startDirectionFunction(v,d,Q,T){T?n.g.fk[0].p(Q.jd).normalize():Q.position.subtractToRef(v.getTranslation(),n.g.fk[0]).normalize();const L=(0,C.RandomRange)(0,this.directionRandomizer),e=(0,C.RandomRange)(0,this.directionRandomizer),F=(0,C.RandomRange)(0,this.directionRandomizer);d.x=n.g.fk[0].x+L,d.y=n.g.fk[0].y+e,d.z=n.g.fk[0].z+F,d.normalize()}startPositionFunction(v,d,Q,T){const L=(0,C.RandomRange)(0,2*Math.PI);let e;this.emitFromSpawnPointOnly?e=1e-4:(e=(0,C.RandomRange)(0,this.heightRange),e=1-e*e);let F=this._radius-(0,C.RandomRange)(0,this._radius*this.radiusRange);F*=e;const r=F*Math.sin(L),u=F*Math.cos(L),y=e*this._height;if(T)return d.x=r,d.y=y,void(d.z=u);n.j.TransformCoordinatesFromFloatsToRef(r,y,u,v,d)}clone(){const v=new z(this._radius,this._angle,this.directionRandomizer);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat2("radius",this._radius,this.radiusRange),v.setFloat("coneAngle",this._angle),v.setFloat2("height",this._height,this.heightRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",2),v.addUniform("coneAngle",1),v.addUniform("height",2),v.addUniform("directionRandomizer",1)}getEffectDefines(){let v="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(v+="\n#define CONEEMITTERSPAWNPOINT"),v}getClassName(){return"ConeParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this._radius,v.angle=this._angle,v.directionRandomizer=this.directionRandomizer,v.radiusRange=this.radiusRange,v.heightRange=this.heightRange,v.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,v}parse(v){this.radius=v.radius,this.angle=v.angle,this.directionRandomizer=v.directionRandomizer,this.radiusRange=void 0!==v.radiusRange?v.radiusRange:1,this.heightRange=void 0!==v.radiusRange?v.heightRange:1,this.emitFromSpawnPointOnly=void 0!==v.emitFromSpawnPointOnly&&v.emitFromSpawnPointOnly}}class B extends z{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0);super(v,d),this.direction1=Q,this.direction2=T}startDirectionFunction(v,d){const Q=(0,C.RandomRange)(this.direction1.x,this.direction2.x),T=(0,C.RandomRange)(this.direction1.y,this.direction2.y),L=(0,C.RandomRange)(this.direction1.z,this.direction2.z);n.j.TransformNormalFromFloatsToRef(Q,T,L,v,d)}clone(){const v=new B(this.radius,this.angle,this.direction1,this.direction2);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.mk(),v.direction2=this.direction2.mk(),v}parse(v){super.parse(v),this.direction1.p(v.direction1),this.direction2.p(v.direction2)}}class X{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=v,this.height=d,this.radiusRange=Q,this.directionRandomizer=T,this._tempVector=n.j.Zero()}startDirectionFunction(v,d,Q,T,L){Q.position.subtractToRef(v.getTranslation(),this._tempVector),this._tempVector.normalize(),n.j.TransformNormalToRef(this._tempVector,L,this._tempVector);const e=(0,C.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let F=Math.atan2(this._tempVector.x,this._tempVector.z);F+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=e,this._tempVector.x=Math.sin(F),this._tempVector.z=Math.cos(F),this._tempVector.normalize(),T?d.p(this._tempVector):n.j.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,v,d)}startPositionFunction(v,d,Q,T){const L=(0,C.RandomRange)(-this.height/2,this.height/2),e=(0,C.RandomRange)(0,2*Math.PI),F=(0,C.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),r=Math.sqrt(F)*this.radius,u=r*Math.cos(e),y=r*Math.sin(e);T?d.ld(u,L,y):n.j.TransformCoordinatesFromFloatsToRef(u,L,y,v,d)}clone(){const v=new X(this.radius,this.directionRandomizer);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("height",this.height),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("height",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this.radius,v.height=this.height,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.radius=v.radius,this.height=v.height,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class m extends X{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.j(0,1,0);super(v,d,Q),this.direction1=T,this.direction2=L}startDirectionFunction(v,d,Q,T){const L=(0,C.RandomRange)(this.direction1.x,this.direction2.x),e=(0,C.RandomRange)(this.direction1.y,this.direction2.y),F=(0,C.RandomRange)(this.direction1.z,this.direction2.z);T?d.ld(L,e,F):n.j.TransformNormalFromFloatsToRef(L,e,F,v,d)}clone(){const v=new m(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("height",this.height),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("height",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.mk(),v.direction2=this.direction2.mk(),v}parse(v){super.parse(v),n.j.FromArrayToRef(v.direction1,0,this.direction1),n.j.FromArrayToRef(v.direction2,0,this.direction2)}}class V{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=v,this.radiusRange=d,this.directionRandomizer=Q}startDirectionFunction(v,d,Q,T){const L=Q.position.Wd(v.getTranslation()).normalize(),e=(0,C.RandomRange)(0,this.directionRandomizer),F=(0,C.RandomRange)(0,this.directionRandomizer),r=(0,C.RandomRange)(0,this.directionRandomizer);L.x+=e,L.y+=F,L.z+=r,L.normalize(),T?d.p(L):n.j.TransformNormalFromFloatsToRef(L.x,L.y,L.z,v,d)}startPositionFunction(v,d,Q,T){const L=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),e=(0,C.RandomRange)(0,1),F=(0,C.RandomRange)(0,2*Math.PI),r=Math.acos(2*e-1),u=L*Math.cos(F)*Math.sin(r),y=L*Math.cos(r),z=L*Math.sin(F)*Math.sin(r);T?d.ld(u,Math.abs(y),z):n.j.TransformCoordinatesFromFloatsToRef(u,Math.abs(y),z,v,d)}clone(){const v=new V(this.radius,this.directionRandomizer);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this.radius,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.radius=v.radius,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class h{constructor(){this.direction1=new n.j(0,1,0),this.direction2=new n.j(0,1,0)}startDirectionFunction(v,d,Q,T){const L=(0,C.RandomRange)(this.direction1.x,this.direction2.x),e=(0,C.RandomRange)(this.direction1.y,this.direction2.y),F=(0,C.RandomRange)(this.direction1.z,this.direction2.z);T?d.ld(L,e,F):n.j.TransformNormalFromFloatsToRef(L,e,F,v,d)}startPositionFunction(v,d,Q,T){T?d.ld(0,0,0):n.j.TransformCoordinatesFromFloatsToRef(0,0,0,v,d)}clone(){const v=new h;return u.d.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.direction1=this.direction1.mk(),v.direction2=this.direction2.mk(),v}parse(v){n.j.FromArrayToRef(v.direction1,0,this.direction1),n.j.FromArrayToRef(v.direction2,0,this.direction2)}}class S{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=v,this.radiusRange=d,this.directionRandomizer=Q}startDirectionFunction(v,d,Q,T){const L=Q.position.Wd(v.getTranslation()).normalize(),e=(0,C.RandomRange)(0,this.directionRandomizer),F=(0,C.RandomRange)(0,this.directionRandomizer),r=(0,C.RandomRange)(0,this.directionRandomizer);L.x+=e,L.y+=F,L.z+=r,L.normalize(),T?d.p(L):n.j.TransformNormalFromFloatsToRef(L.x,L.y,L.z,v,d)}startPositionFunction(v,d,Q,T){const L=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),e=(0,C.RandomRange)(0,1),F=(0,C.RandomRange)(0,2*Math.PI),r=Math.acos(2*e-1),u=L*Math.cos(F)*Math.sin(r),y=L*Math.cos(r),z=L*Math.sin(F)*Math.sin(r);T?d.ld(u,y,z):n.j.TransformCoordinatesFromFloatsToRef(u,y,z,v,d)}clone(){const v=new S(this.radius,this.directionRandomizer);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this.radius,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.radius=v.radius,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class A extends S{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.j(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0);super(v),this.direction1=d,this.direction2=Q}startDirectionFunction(v,d){const Q=(0,C.RandomRange)(this.direction1.x,this.direction2.x),T=(0,C.RandomRange)(this.direction1.y,this.direction2.y),L=(0,C.RandomRange)(this.direction1.z,this.direction2.z);n.j.TransformNormalFromFloatsToRef(Q,T,L,v,d)}clone(){const v=new A(this.radius,this.direction1,this.direction2);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.mk(),v.direction2=this.direction2.mk(),v}parse(v){super.parse(v),this.direction1.p(v.direction1),this.direction2.p(v.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(v,d,Q,T){const L=n.g.fk[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,Q,L);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Q,L);const v=n.g.fk[1];L.subtractToRef(Q.position,v),v.scaleToRef(1/Q.lifeTime,L)}else L.set(0,0,0);T?d.p(L):n.j.TransformNormalToRef(L,v,d)}startPositionFunction(v,d,Q,T){const L=n.g.fk[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Q,L):L.set(0,0,0),T?d.p(L):n.j.TransformCoordinatesToRef(L,v,d)}clone(){const v=new f;return u.d.DeepCopy(this,v),v}applyToShader(v){}buildUniformLayout(v){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.particlePositionGenerator=this.particlePositionGenerator,v.particleDestinationGenerator=this.particleDestinationGenerator,v}parse(v){v.particlePositionGenerator&&(this.particlePositionGenerator=v.particlePositionGenerator),v.particleDestinationGenerator&&(this.particleDestinationGenerator=v.particleDestinationGenerator)}}var P=Q(706);class O{get mesh(){return this._mesh}set mesh(v){this._mesh!==v&&(this._mesh=v,v?(this._indices=v.ek(),this._positions=v.getVerticesData(P.e.PositionKind),this._normals=v.getVerticesData(P.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=n.j.Zero(),this._mesh=null,this.direction1=new n.j(0,1,0),this.direction2=new n.j(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=v}startDirectionFunction(v,d,Q,T){if(this.useMeshNormalsForDirection&&this._normals)return void n.j.TransformNormalToRef(this._storedNormal,v,d);const L=(0,C.RandomRange)(this.direction1.x,this.direction2.x),e=(0,C.RandomRange)(this.direction1.y,this.direction2.y),F=(0,C.RandomRange)(this.direction1.z,this.direction2.z);T?d.ld(L,e,F):n.j.TransformNormalFromFloatsToRef(L,e,F,v,d)}startPositionFunction(v,d,Q,T){if(!this._indices||!this._positions)return;const L=3*(Math.random()*(this._indices.length/3)|0),e=Math.random(),F=Math.random()*(1-e),r=1-e-F,C=this._indices[L],u=this._indices[L+1],y=this._indices[L+2],z=n.g.fk[0],B=n.g.fk[1],X=n.g.fk[2],m=n.g.fk[3];n.j.FromArrayToRef(this._positions,3*C,z),n.j.FromArrayToRef(this._positions,3*u,B),n.j.FromArrayToRef(this._positions,3*y,X),m.x=e*z.x+F*B.x+r*X.x,m.y=e*z.y+F*B.y+r*X.y,m.z=e*z.z+F*B.z+r*X.z,T?d.ld(m.x,m.y,m.z):n.j.TransformCoordinatesFromFloatsToRef(m.x,m.y,m.z,v,d),this.useMeshNormalsForDirection&&this._normals&&(n.j.FromArrayToRef(this._normals,3*C,z),n.j.FromArrayToRef(this._normals,3*u,B),n.j.FromArrayToRef(this._normals,3*y,X),this._storedNormal.x=e*z.x+F*B.x+r*X.x,this._storedNormal.y=e*z.y+F*B.y+r*X.y,this._storedNormal.z=e*z.z+F*B.z+r*X.z)}clone(){const v=new O(this.mesh);return u.d.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var v;const d={};return d.type=this.getClassName(),d.direction1=this.direction1.mk(),d.direction2=this.direction2.mk(),d.meshId=null===(v=this.mesh)||void 0===v?void 0:v.id,d.useMeshNormalsForDirection=this.useMeshNormalsForDirection,d}parse(v,d){n.j.FromArrayToRef(v.direction1,0,this.direction1),n.j.FromArrayToRef(v.direction2,0,this.direction2),v.meshId&&d&&(this.mesh=d.getLastMeshById(v.meshId)),this.useMeshNormalsForDirection=v.useMeshNormalsForDirection}}class J{_isUbo(v){return void 0!==v.addUniform}constructor(v){this._isUbo(v)?(this.setMatrix3x3=v.updateMatrix3x3.bind(v),this.setMatrix2x2=v.updateMatrix2x2.bind(v),this.setFloat=v.updateFloat.bind(v),this.setFloat2=v.updateFloat2.bind(v),this.setFloat3=v.updateFloat3.bind(v),this.setFloat4=v.updateFloat4.bind(v),this.setFloatArray=v.updateFloatArray.bind(v),this.setArray=v.updateArray.bind(v),this.setIntArray=v.updateIntArray.bind(v),this.setMatrix=v.tk.bind(v),this.setMatrices=v.updateMatrices.bind(v),this.setVector3=v.updateVector3.bind(v),this.setVector4=v.updateVector4.bind(v),this.setColor3=v.updateColor3.bind(v),this.setColor4=v.updateColor4.bind(v),this.setDirectColor4=v.updateDirectColor4.bind(v),this.setInt=v.updateInt.bind(v),this.setInt2=v.updateInt2.bind(v),this.setInt3=v.updateInt3.bind(v),this.setInt4=v.updateInt4.bind(v)):(this.setMatrix3x3=v.setMatrix3x3.bind(v),this.setMatrix2x2=v.setMatrix2x2.bind(v),this.setFloat=v.setFloat.bind(v),this.setFloat2=v.setFloat2.bind(v),this.setFloat3=v.setFloat3.bind(v),this.setFloat4=v.setFloat4.bind(v),this.setFloatArray=v.setFloatArray.bind(v),this.setArray=v.setArray.bind(v),this.setIntArray=v.setIntArray.bind(v),this.setMatrix=v.setMatrix.bind(v),this.setMatrices=v.setMatrices.bind(v),this.setVector3=v.setVector3.bind(v),this.setVector4=v.setVector4.bind(v),this.setColor3=v.setColor3.bind(v),this.setColor4=v.setColor4.bind(v),this.setDirectColor4=v.setDirectColor4.bind(v),this.setInt=v.setInt.bind(v),this.setInt2=v.setInt2.bind(v),this.setInt3=v.setInt3.bind(v),this.setInt4=v.setInt4.bind(v))}}var K=Q(553);const o="gpuUpdateParticlesPixelShader",g="#version 300 es\nvoid main() {discard;}\n";K.e.ShadersStore[o]||(K.e.ShadersStore[o]=g);const R="gpuUpdateParticlesVertexShader",M="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";K.e.ShadersStore[R]||(K.e.ShadersStore[R]=M);(0,F.f)("BABYLON.WebGL2ParticleSystem",class{constructor(v,d){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=v,this._engine=d,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var v;return(null===(v=this._updateEffect)||void 0===v?void 0:v.isReady())??!1}createUpdateBuffer(v){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=v,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new J(this._updateEffect)}createVertexBuffers(v,d){this._updateVAO.push(this._createUpdateVAO(v)),this._renderVAO.push(this._engine.recordVertexArrayObject(d,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=d}createParticleBuffer(v){return v}bindDrawBuffers(v,d,Q){Q?this._engine.bindBuffers(this._renderVertexBuffers,Q,d):this._engine.bindVertexArrayObject(this._renderVAO[v],null)}preUpdateParticleBuffer(){const v=this._engine;if(this._engine.enableEffect(this._updateEffect),!v.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(v,d,Q){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[v],null);const n=this._engine;n.bindTransformFeedbackBuffer(d.getBuffer()),n.setRasterizerState(!1),n.beginTransformFeedback(!0),n.drawArraysType(3,0,Q),n.endTransformFeedback(),n.setRasterizerState(!0),n.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let v=0;v<this._updateVAO.length;v++)this._engine.releaseVertexArrayObject(this._updateVAO[v]);this._updateVAO.length=0;for(let v=0;v<this._renderVAO.length;v++)this._engine.releaseVertexArrayObject(this._renderVAO[v]);this._renderVAO.length=0}_createUpdateVAO(v){const d={};d.position=v.createVertexBuffer("position",0,3);let Q=3;d.age=v.createVertexBuffer("age",Q,1),Q+=1,d.size=v.createVertexBuffer("size",Q,3),Q+=3,d.life=v.createVertexBuffer("life",Q,1),Q+=1,d.seed=v.createVertexBuffer("seed",Q,4),Q+=4,d.direction=v.createVertexBuffer("direction",Q,3),Q+=3,this._parent.particleEmitterType instanceof f&&(d.initialPosition=v.createVertexBuffer("initialPosition",Q,3),Q+=3),this._parent._colorGradientsTexture||(d.color=v.createVertexBuffer("color",Q,4),Q+=4),this._parent._isBillboardBased||(d.initialDirection=v.createVertexBuffer("initialDirection",Q,3),Q+=3),this._parent.noiseTexture&&(d.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",Q,3),Q+=3,d.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",Q,3),Q+=3),this._parent._angularSpeedGradientsTexture?(d.angle=v.createVertexBuffer("angle",Q,1),Q+=1):(d.angle=v.createVertexBuffer("angle",Q,2),Q+=2),this._parent._isAnimationSheetEnabled&&(d.cellIndex=v.createVertexBuffer("cellIndex",Q,1),Q+=1,this._parent.spriteRandomStartCell&&(d.cellStartOffset=v.createVertexBuffer("cellStartOffset",Q,1),Q+=1));const n=this._engine.recordVertexArrayObject(d,null,this._updateEffect);return this._engine.bindArrayBuffer(null),n}});class Y{constructor(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0;this._engine=v,this._label=n,this._engine._storageBuffers.push(this),this._create(d,Q)}_create(v,d){this._bufferSize=v,this._creationFlags=d,this._buffer=this._engine.createStorageBuffer(v,d,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(v,d,Q){this._buffer&&this._engine.updateStorageBuffer(this._buffer,v,d,Q)}async read(v,d,Q,n){return await this._engine.readFromStorageBuffer(this._buffer,v,d,Q,n)}dispose(){const v=this._engine._storageBuffers,d=v.indexOf(this);-1!==d&&(v[d]=v[v.length-1],v.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var D=Q(620),i=Q(629),Z=Q(677),j=Q(2041),x=Q(2223),k=Q(482),t=Q(576),p=Q(2145);class W{constructor(){this._gpuTimeInFrameId=-1,this.counter=new p.e}_addDuration(v,d){v<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==v?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(d,!1),this._gpuTimeInFrameId=v):this.counter.addCount(d,!1))}}var q=Q(539);class b{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=v,this._engine=d,this.uniqueId=x.e.UniqueId,d.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new W),this._engine.getCaps().supportComputeShaders?n.bindingsMapping?(this._context=d.createComputeContext(),this._shaderPath=Q,this._options={bindingsMapping:{},defines:[],...n}):k.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):k.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(v,d){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this._bindings[v];this._bindings[v]={type:Q?0:4,object:d,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!n||n.object!==d||n.type!==this._bindings[v].type)}setStorageTexture(v,d){const Q=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==d),this._bindings[v]={type:1,object:d,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setExternalTexture(v,d){const Q=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==d),this._bindings[v]={type:6,object:d,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setVideoTexture(v,d){return!!d.externalTexture&&(this.setExternalTexture(v,d.externalTexture),!0)}setUniformBuffer(v,d){const Q=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==d),this._bindings[v]={type:b._BufferIsDataBuffer(d)?7:2,object:d,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setStorageBuffer(v,d){const Q=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==d),this._bindings[v]={type:b._BufferIsDataBuffer(d)?7:3,object:d,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setTextureSampler(v,d){const Q=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!Q||!d.compareSampler(Q.object)),this._bindings[v]={type:5,object:d,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}isReady(){let v=this._effect;for(const T in this._bindings){const v=this._bindings[T],d=v.type,Q=v.object;switch(d){case 0:case 4:case 1:if(!Q.isReady())return!1;break;case 6:if(!Q.isReady())return!1;break}}const d=[],Q=this._shaderPath;if(this._options.defines)for(let T=0;T<this._options.defines.length;T++)d.push(this._options.defines[T]);const n=d.join("\n");return this._cachedDefines!==n&&(this._cachedDefines=n,v=this._engine.createComputeEffect(Q,{defines:n,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=v),!!v.isReady()}dispatch(v,d,Q){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,v,d,Q,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Q=b._BufferIsDataBuffer(v)?v:v.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Q,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const d in this._bindings){const Q=this._bindings[d];if(!this._options.bindingsMapping[d])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+d+"'");switch(Q.type){case 0:{const n=this._samplers[d],T=Q.object;var v;if(!n||!T._texture||!n.compareSampler(T._texture))this._samplers[d]=(new t.d).setParameters(T.wrapU,T.wrapV,T.wrapR,T.anisotropicFilteringLevel,T._texture.samplingMode,null===(v=T._texture)||void 0===v?void 0:v._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const v=Q.object;v.getBuffer()!==Q.buffer&&(Q.buffer=v.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((T=>{(0,q.f)((()=>this.dispatch(v,d,Q)),T,void 0,n)}))}serialize(){const v=Z.e.Serialize(this);v.options=this._options,v.shaderPath=this._shaderPath,v.Vl={},v.textures={};for(const d in this._bindings){const Q=this._bindings[d],n=Q.object;switch(Q.type){case 0:case 4:case 1:{const T=n.serialize();T&&(v.textures[d]=T,v.Vl[d]={type:Q.type});break}}}return v}static Parse(v,d,Q){const n=Z.e.Parse((()=>new b(v.name,d.getEngine(),v.shaderPath,v.options)),v,d,Q);for(const T in v.textures){const L=v.Vl[T],e=j.e.Parse(v.textures[T],d,Q);0===L.type?n.setTexture(T,e):4===L.type?n.setTexture(T,e,!1):n.setStorageTexture(T,e)}return n}static _BufferIsDataBuffer(v){return void 0!==v.underlyingResource}}(0,D.b)([(0,i.F)()],b.prototype,"name",void 0),(0,D.b)([(0,i.F)()],b.prototype,"fastMode",void 0),(0,F.f)("BABYLON.ComputeShader",b);var H=Q(817);const s="gpuUpdateParticlesComputeShader",a="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";K.e.ShadersStoreWGSL[s]||(K.e.ShadersStoreWGSL[s]=a);(0,F.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(v,d){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=v,this._engine=d}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var v;return(null===(v=this._updateComputeShader)||void 0===v?void 0:v.isReady())??!1}createUpdateBuffer(v){var d;const Q={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Q.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Q.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Q.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Q.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Q.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Q.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(Q.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new b("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Q,defines:v.split("\n")}),null===(d=this._simParamsComputeShader)||void 0===d||d.dispose(),this._simParamsComputeShader=new H.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new J(this._simParamsComputeShader)}createVertexBuffers(v,d){this._renderVertexBuffers.push(d)}createParticleBuffer(v){const d=new Y(this._engine,4*v.length,11,"ComputeShaderParticleSystemBuffer");return d.update(v),this._bufferComputeShader.push(d),d.getBuffer()}bindDrawBuffers(v,d,Q){this._engine.bindBuffers(this._renderVertexBuffers[v],Q,d)}preUpdateParticleBuffer(){}updateParticleBuffer(v,d,Q){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[v]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^v]),this._updateComputeShader.dispatch(Math.ceil(Q/64))}releaseBuffers(){var v;for(let d=0;d<this._bufferComputeShader.length;++d)this._bufferComputeShader[d].dispose();this._bufferComputeShader.length=0,null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class I{constructor(v,d,Q){this.gradient=v,this.color1=d,this.color2=Q}getColorToRef(v){this.color2?e.f.LerpToRef(this.color1,this.color2,Math.random(),v):v.p(this.color1)}}class U{constructor(v,d){this.gradient=v,this.color=d}}class c{constructor(v,d,Q){this.gradient=v,this.factor1=d,this.factor2=Q}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class w{static GetCurrentGradient(v,d,Q){if(d[0].gradient>v)return void Q(d[0],d[0],1);for(let T=0;T<d.length-1;T++){const n=d[T],L=d[T+1];if(v>=n.gradient&&v<=L.gradient){return void Q(n,L,(v-n.gradient)/(L.gradient-n.gradient))}}const n=d.length-1;Q(d[n],d[n],1)}}var G=Q(473),E=Q(11909),N=Q(508);class l{constructor(v){this.particleSystem=v,this.position=n.j.Zero(),this.direction=n.j.Zero(),this.color=new e.f(0,0,0,0),this.colorStep=new e.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new n.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new e.f(0,0,0,0),this._currentColor2=new e.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=l._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let v=this.age,d=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===d?(d=1,v=this._randomCellOffset):v+=this._randomCellOffset);const Q=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let n;n=this._initialSpriteCellLoop?(0,C.Clamp)(v*d%this.lifeTime/this.lifeTime):(0,C.Clamp)(v*d/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+n*Q|0}_inheritParticleInfoToSubEmitter(v){if(v.particleSystem.j.position){const d=v.particleSystem.j;if(d.position.p(this.position),v.inheritDirection){const v=n.g.fk[0];this.direction.normalizeToRef(v),d.setDirection(v,0,Math.PI/2)}}else{v.particleSystem.j.p(this.position)}this.direction.scaleToRef(v.inheritedVelocityAmount/2,n.g.fk[0]),v.particleSystem._inheritedVelocityOffset.p(n.g.fk[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const v of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(v)}_reset(){this.age=0,this.id=l._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(v){v.position.p(this.position),this._initialDirection?v._initialDirection?v._initialDirection.p(this._initialDirection):v._initialDirection=this._initialDirection.clone():v._initialDirection=null,v.direction.p(this.direction),this.jd&&(v.jd?v.jd.p(this.jd):v.jd=this.jd.clone()),v.color.p(this.color),v.colorStep.p(this.colorStep),v.lifeTime=this.lifeTime,v.age=this.age,v._randomCellOffset=this._randomCellOffset,v.size=this.size,v.scale.p(this.scale),v.angle=this.angle,v.angularSpeed=this.angularSpeed,v.particleSystem=this.particleSystem,v.cellIndex=this.cellIndex,v.id=this.id,v._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(v._currentColorGradient=this._currentColorGradient,v._currentColor1.p(this._currentColor1),v._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(v._currentSizeGradient=this._currentSizeGradient,v._currentSize1=this._currentSize1,v._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(v._currentAngularSpeedGradient=this._currentAngularSpeedGradient,v._currentAngularSpeed1=this._currentAngularSpeed1,v._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(v._currentVelocityGradient=this._currentVelocityGradient,v._currentVelocity1=this._currentVelocity1,v._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(v._currentLimitVelocityGradient=this._currentLimitVelocityGradient,v._currentLimitVelocity1=this._currentLimitVelocity1,v._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(v._currentDragGradient=this._currentDragGradient,v._currentDrag1=this._currentDrag1,v._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(v._initialStartSpriteCellId=this._initialStartSpriteCellId,v._initialEndSpriteCellId=this._initialEndSpriteCellId,v._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(v.remapData&&this.remapData?v.remapData.p(this.remapData):v.remapData=new n.k(0,0,0,0)),this._randomNoiseCoordinates1&&(v._randomNoiseCoordinates1?(v._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),v._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(v._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),v._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}l._Count=0;var vv=Q(770),dv=(Q(2110),Q(847)),Qv=Q(832),nv=Q(2191);function Tv(v,d){const Q=(0,C.RandomRange)(0,1);e.f.LerpToRef(d.color1,d.color2,Q,v.color),d.colorDead.subtractToRef(v.color,d._colorDiff),d._colorDiff.scaleToRef(1/v.lifeTime,v.colorStep)}function Lv(v,d){v._currentColorGradient=d._colorGradients[0],v._currentColorGradient.getColorToRef(v.color),v._currentColor1.p(v.color),d._colorGradients.length>1?d._colorGradients[1].getColorToRef(v._currentColor2):v._currentColor2.p(v.color)}function ev(v,d){const Q=d._colorGradients;w.GetCurrentGradient(d._ratio,Q,((d,Q,n)=>{d!==v._currentColorGradient&&(v._currentColor1.p(v._currentColor2),Q.getColorToRef(v._currentColor2),v._currentColorGradient=d),e.f.LerpToRef(v._currentColor1,v._currentColor2,n,v.color)}))}function Fv(v,d){v.colorStep.scaleToRef(d._scaledUpdateSpeed,d._scaledColorStep),v.color.addInPlace(d._scaledColorStep),v.color.a<0&&(v.color.a=0)}function rv(v,d){w.GetCurrentGradient(d._ratio,d._angularSpeedGradients,((d,Q,n)=>{d!==v._currentAngularSpeedGradient&&(v._currentAngularSpeed1=v._currentAngularSpeed2,v._currentAngularSpeed2=Q.getFactor(),v._currentAngularSpeedGradient=d),v.angularSpeed=(0,C.Lerp)(v._currentAngularSpeed1,v._currentAngularSpeed2,n)}))}function Cv(v,d){v.angle+=v.angularSpeed*d._scaledUpdateSpeed}function uv(v,d){d.particleEmitterType.startDirectionFunction(d._emitterWorldMatrix,v.direction,v,d.isLocal,d._emitterInverseWorldMatrix)}function yv(v,d){d.startDirectionFunction(d._emitterWorldMatrix,v.direction,v,d.isLocal)}function zv(v,d){v._currentVelocityGradient=d._velocityGradients[0],v._currentVelocity1=v._currentVelocityGradient.getFactor(),d._velocityGradients.length>1?v._currentVelocity2=d._velocityGradients[1].getFactor():v._currentVelocity2=v._currentVelocity1}function Bv(v,d){v._currentLimitVelocityGradient=d._limitVelocityGradients[0],v._currentLimitVelocity1=v._currentLimitVelocityGradient.getFactor(),d._limitVelocityGradients.length>1?v._currentLimitVelocity2=d._limitVelocityGradients[1].getFactor():v._currentLimitVelocity2=v._currentLimitVelocity1}function Xv(v,d){w.GetCurrentGradient(d._ratio,d._velocityGradients,((Q,n,T)=>{Q!==v._currentVelocityGradient&&(v._currentVelocity1=v._currentVelocity2,v._currentVelocity2=n.getFactor(),v._currentVelocityGradient=Q),d._directionScale*=(0,C.Lerp)(v._currentVelocity1,v._currentVelocity2,T)}))}function mv(v,d){w.GetCurrentGradient(d._ratio,d._limitVelocityGradients,((Q,n,T)=>{Q!==v._currentLimitVelocityGradient&&(v._currentLimitVelocity1=v._currentLimitVelocity2,v._currentLimitVelocity2=n.getFactor(),v._currentLimitVelocityGradient=Q);const L=(0,C.Lerp)(v._currentLimitVelocity1,v._currentLimitVelocity2,T);v.direction.length()>L&&v.direction.scaleInPlace(d.limitVelocityDamping)}))}function Vv(v,d){v.direction.scaleToRef(d._directionScale,d._scaledDirection)}function hv(v,d){d.particleEmitterType.startPositionFunction(d._emitterWorldMatrix,v.position,v,d.isLocal)}function Sv(v,d){d.startPositionFunction(d._emitterWorldMatrix,v.position,v,d.isLocal)}function Av(v,d){v.jd?v.jd.p(v.position):v.jd=v.position.clone(),n.j.TransformCoordinatesToRef(v.jd,d._emitterWorldMatrix,v.position)}function fv(v,d){d.isLocal&&v.jd?(v.jd.addInPlace(d._scaledDirection),n.j.TransformCoordinatesToRef(v.jd,d._emitterWorldMatrix,v.position)):v.position.addInPlace(d._scaledDirection)}function Pv(v,d){v._currentDragGradient=d._dragGradients[0],v._currentDrag1=v._currentDragGradient.getFactor(),d._dragGradients.length>1?v._currentDrag2=d._dragGradients[1].getFactor():v._currentDrag2=v._currentDrag1}function Ov(v,d){w.GetCurrentGradient(d._ratio,d._dragGradients,((Q,n,T)=>{Q!==v._currentDragGradient&&(v._currentDrag1=v._currentDrag2,v._currentDrag2=n.getFactor(),v._currentDragGradient=Q);const L=(0,C.Lerp)(v._currentDrag1,v._currentDrag2,T);d._scaledDirection.scaleInPlace(1-L)}))}function Jv(v,d){v._randomNoiseCoordinates1?(v._randomNoiseCoordinates1.ld(Math.random(),Math.random(),Math.random()),v._randomNoiseCoordinates2.ld(Math.random(),Math.random(),Math.random())):(v._randomNoiseCoordinates1=new n.j(Math.random(),Math.random(),Math.random()),v._randomNoiseCoordinates2=new n.j(Math.random(),Math.random(),Math.random()))}function Kv(v,d){const Q=d._noiseTextureData,T=d._noiseTextureSize;if(Q&&T&&v._randomNoiseCoordinates1){const L=d._fetchR(v._randomNoiseCoordinates1.x,v._randomNoiseCoordinates1.y,T.width,T.height,Q),e=d._fetchR(v._randomNoiseCoordinates1.z,v._randomNoiseCoordinates2.x,T.width,T.height,Q),F=d._fetchR(v._randomNoiseCoordinates2.y,v._randomNoiseCoordinates2.z,T.width,T.height,Q),r=n.g.fk[0],C=n.g.fk[1];r.ld((2*L-1)*d.noiseStrength.x,(2*e-1)*d.noiseStrength.y,(2*F-1)*d.noiseStrength.z),r.scaleToRef(d._tempScaledUpdateSpeed,C),v.direction.addInPlace(C)}}function ov(v,d){d.gravity.scaleToRef(d._tempScaledUpdateSpeed,d._scaledGravity),v.direction.addInPlace(d._scaledGravity)}function gv(v,d){v.size=(0,C.RandomRange)(d.minSize,d.maxSize),v.scale.ld((0,C.RandomRange)(d.minScaleX,d.maxScaleX),(0,C.RandomRange)(d.minScaleY,d.maxScaleY))}function Rv(v,d){v._currentSizeGradient=d._sizeGradients[0],v._currentSize1=v._currentSizeGradient.getFactor(),v.size=v._currentSize1,d._sizeGradients.length>1?v._currentSize2=d._sizeGradients[1].getFactor():v._currentSize2=v._currentSize1,v.scale.ld((0,C.RandomRange)(d.minScaleX,d.maxScaleX),(0,C.RandomRange)(d.minScaleY,d.maxScaleY))}function Mv(v,d){const Q=d._actualFrame/d.targetStopDuration;w.GetCurrentGradient(Q,d._startSizeGradients,((Q,n,T)=>{Q!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=n.getFactor(),d._currentStartSizeGradient=Q);const L=(0,C.Lerp)(d._currentStartSize1,d._currentStartSize2,T);v.scale.scaleInPlace(L)}))}function Yv(v,d){w.GetCurrentGradient(d._ratio,d._sizeGradients,((d,Q,n)=>{d!==v._currentSizeGradient&&(v._currentSize1=v._currentSize2,v._currentSize2=Q.getFactor(),v._currentSizeGradient=d),v.size=(0,C.Lerp)(v._currentSize1,v._currentSize2,n)}))}function Dv(v,d){v.remapData=new n.k(0,1,0,1)}function iv(v,d){d._colorRemapGradients&&d._colorRemapGradients.length>0&&w.GetCurrentGradient(d._ratio,d._colorRemapGradients,((d,Q,n)=>{const T=(0,C.Lerp)(d.factor1,Q.factor1,n),L=(0,C.Lerp)(d.factor2,Q.factor2,n);v.remapData.x=T,v.remapData.y=L-T})),d._alphaRemapGradients&&d._alphaRemapGradients.length>0&&w.GetCurrentGradient(d._ratio,d._alphaRemapGradients,((d,Q,n)=>{const T=(0,C.Lerp)(d.factor1,Q.factor1,n),L=(0,C.Lerp)(d.factor2,Q.factor2,n);v.remapData.z=T,v.remapData.w=L-T}))}function Zv(v,d){const Q=(0,C.Clamp)(d._actualFrame/d.targetStopDuration);w.GetCurrentGradient(Q,d._lifeTimeGradients,((d,n)=>{const T=d,L=n,e=T.getFactor(),F=L.getFactor(),r=(Q-T.gradient)/(L.gradient-T.gradient);v.lifeTime=(0,C.Lerp)(e,F,r)})),d._emitPower=(0,C.RandomRange)(d.minEmitPower,d.maxEmitPower)}function jv(v,d){v.lifeTime=(0,C.RandomRange)(d.minLifeTime,d.maxLifeTime),d._emitPower=(0,C.RandomRange)(d.minEmitPower,d.maxEmitPower)}function xv(v,d){0===d._emitPower?(v._initialDirection?v._initialDirection.p(v.direction):v._initialDirection=v.direction.clone(),v.direction.set(0,0,0)):(v._initialDirection=null,v.direction.scaleInPlace(d._emitPower)),v.direction.addInPlace(d._inheritedVelocityOffset)}function kv(v,d){v.angularSpeed=(0,C.RandomRange)(d.minAngularSpeed,d.maxAngularSpeed),v.angle=(0,C.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function tv(v,d){v._currentAngularSpeedGradient=d._angularSpeedGradients[0],v.angularSpeed=v._currentAngularSpeedGradient.getFactor(),v._currentAngularSpeed1=v.angularSpeed,d._angularSpeedGradients.length>1?v._currentAngularSpeed2=d._angularSpeedGradients[1].getFactor():v._currentAngularSpeed2=v._currentAngularSpeed1,v.angle=(0,C.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function pv(v,d){v._initialStartSpriteCellId=d.startSpriteCellID,v._initialEndSpriteCellId=d.endSpriteCellID,v._initialSpriteCellLoop=d.spriteCellLoop}function Wv(v,d){v.previousItem=d.previousItem,v.nextItem=d,d.previousItem&&(d.previousItem.nextItem=v),d.previousItem=v}function qv(v,d){v.previousItem=d,v.nextItem=d.nextItem,d.nextItem&&(d.nextItem.previousItem=v),d.nextItem=v}function bv(v,d){let Q=d;for(;Q.nextItem;)Q=Q.nextItem;v.previousItem=Q,v.nextItem=Q.nextItem,Q.nextItem=v}function Hv(v){v.previousItem&&(v.previousItem.nextItem=v.nextItem),v.nextItem&&(v.nextItem.previousItem=v.previousItem)}class sv extends r{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(v){this._startDirectionFunction!==v&&(this._startDirectionFunction=v,this._directionProcessing.process=v?yv:uv)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(v){this._startPositionFunction!==v&&(this._startPositionFunction=v,this._positionCreation.process=v?Sv:hv)}set onDispose(v){this._onDisposeObserver&&this.kk.remove(this._onDisposeObserver),this._onDisposeObserver=this.kk.add(v)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(v){this._useRampGradients!==v&&(this._useRampGradients=v,this._resetEffect(),v?(this._rampCreation={process:Dv,previousItem:null,nextItem:null},qv(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:iv,previousItem:null,nextItem:null},qv(this._remapGradientProcessing,this._gravityProcessing)):(Hv(this._rampCreation),Hv(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(v){this._isLocal!==v&&(this._isLocal=v,v?(this._isLocalCreation={process:Av,previousItem:null,nextItem:null},qv(this._isLocalCreation,this._positionCreation)):Hv(this._isLocalCreation))}get particles(){return this.Ql}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(v){this._animationSheetEnabled!==v&&(this._animationSheetEnabled=v,v?(this._sheetCreation={process:pv,previousItem:null,nextItem:null},qv(this._sheetCreation,this._colorCreation)):Hv(this._sheetCreation),this._reset())}getActiveCount(){return this.Ql.length}getClassName(){return"Rk"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var v;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(v=this._customWrappers[d])||void 0===v?void 0:v.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[v]??this._customWrappers[0]}setCustomEffect(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new vv.b(this._engine),this._customWrappers[d].effect=v,this._customWrappers[d].drawContext&&(this._customWrappers[d].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new G.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(v){if(this.noiseTexture!==v){if(this._noiseTexture=v,!v)return Hv(this._noiseCreation),void Hv(this._noiseProcessing);this._noiseCreation={process:Jv,previousItem:null,nextItem:null},qv(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Kv,previousItem:null,nextItem:null},qv(this._noiseProcessing,this._positionProcessing)}}constructor(v,d,Q){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(v),this._emitterInverseWorldMatrix=n.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new n.j,this.kk=new G.e,this.onStoppedObservable=new G.e,this.onStartedObservable=new G.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ql=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new e.f(0,0,0,0),this._colorDiff=new e.f(0,0,0,0),this._scaledDirection=n.j.Zero(),this._scaledGravity=n.j.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=v=>{},this.recycleParticle=v=>{const d=this.Ql.pop();d!==v&&d.copyTo(v),this._stockParticles.push(d)},this._createParticle=()=>{let v;return 0!==this._stockParticles.length?(v=this._stockParticles.pop(),v._reset()):v=new l(this),this._prepareParticle(v),v},this.paused=!1,this._shadersLoaded=!1,this._capacity=d,this._epsilon=F,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=n.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||N.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ck.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:jv,previousItem:null,nextItem:null},this._positionCreation={process:hv,previousItem:null,nextItem:null},qv(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:uv,previousItem:null,nextItem:null},qv(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:xv,previousItem:null,nextItem:null},qv(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:gv,previousItem:null,nextItem:null},qv(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:kv,previousItem:null,nextItem:null},qv(this._angleCreation,this._sizeCreation),this._colorCreation={process:Tv,previousItem:null,nextItem:null},qv(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,r||(this._colorProcessing={process:Fv,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Cv,previousItem:null,nextItem:null},qv(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Vv,previousItem:null,nextItem:null},qv(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:fv,previousItem:null,nextItem:null},qv(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ov,previousItem:null,nextItem:null},qv(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=L,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new vv.b(this._engine)},this._customWrappers[0].effect=T,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new y,this.updateFunction=v=>{var d;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(d=this.noiseTexture.getContent())||void 0===d||d.then((v=>{this._noiseTextureData=v})));const Q=v===this.Ql;for(let n=0;n<v.length;n++){const d=v[n];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const T=d.age;if(d.age+=this._tempScaledUpdateSpeed,d.age>d.lifeTime){const v=d.age-T,Q=d.lifeTime-T;this._tempScaledUpdateSpeed=Q*this._tempScaledUpdateSpeed/v,d.age=d.lifeTime}this._ratio=d.age/d.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let L=this._updateQueueStart;for(;L;)L.process(d,this),L=L.nextItem;if(this._isAnimationSheetEnabled&&!r&&d.updateCellIndex(),d._inheritParticleInfoToSubEmitters(),d.age>=d.lifeTime){if(this._emitFromParticle(d),d._attachedSubEmitters){for(const v of d._attachedSubEmitters)v.particleSystem.disposeOnStop=!0,v.particleSystem.stop();d._attachedSubEmitters=null}this.recycleParticle(d),Q&&n--}else;}}}serialize(v){throw new Error("Method not implemented.")}clone(v,d){throw new Error("Method not implemented.")}_addFactorGradient(v,d,Q,n){const T=new c(d,Q,n);v.push(T),v.sort(((v,d)=>v.gradient<d.gradient?-1:v.gradient>d.gradient?1:0))}_removeFactorGradient(v,d){if(!v)return;let Q=0;for(const n of v){if(n.gradient===d){v.splice(Q,1);break}Q++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Zv:this._lifeTimeCreation.process=jv}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Mv,previousItem:null,nextItem:null},qv(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Hv(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(v){this.targetStopDuration!==v&&(this._targetStopDuration=v,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(v,d,Q){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,v,d,Q),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(v){return this._removeFactorGradient(this._lifeTimeGradients,v),this._syncLifeTimeCreation(),this}addSizeGradient(v,d,Q){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Rv,this._sizeGradientProcessing={process:Yv,previousItem:null,nextItem:null},Wv(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,v,d,Q),this}removeSizeGradient(v){var d;return this._removeFactorGradient(this._sizeGradients,v),0===(null===(d=this._sizeGradients)||void 0===d?void 0:d.length)&&(Hv(this._sizeGradientProcessing),this._sizeCreation.process=gv),this}addColorRemapGradient(v,d,Q){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,v,d,Q),this}removeColorRemapGradient(v){return this._removeFactorGradient(this._colorRemapGradients,v),this}addAlphaRemapGradient(v,d,Q){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,v,d,Q),this}removeAlphaRemapGradient(v){return this._removeFactorGradient(this._alphaRemapGradients,v),this}addAngularSpeedGradient(v,d,Q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=tv,this._angularSpeedGradientProcessing={process:rv,previousItem:null,nextItem:null},Wv(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,v,d,Q),this}removeAngularSpeedGradient(v){var d;return this._removeFactorGradient(this._angularSpeedGradients,v),0===(null===(d=this._angularSpeedGradients)||void 0===d?void 0:d.length)&&(this._angleCreation.process=kv,Hv(this._angularSpeedGradientProcessing)),this}addVelocityGradient(v,d,Q){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:zv,previousItem:null,nextItem:null},qv(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Xv,previousItem:null,nextItem:null},Wv(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,v,d,Q),this}removeVelocityGradient(v){var d;return this._removeFactorGradient(this._velocityGradients,v),0===(null===(d=this._velocityGradients)||void 0===d?void 0:d.length)&&(Hv(this._velocityCreation),Hv(this._velocityGradientProcessing)),this}addLimitVelocityGradient(v,d,Q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Bv,previousItem:null,nextItem:null},qv(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:mv,previousItem:null,nextItem:null},qv(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,v,d,Q),this}removeLimitVelocityGradient(v){var d;return this._removeFactorGradient(this._limitVelocityGradients,v),0===(null===(d=this._limitVelocityGradients)||void 0===d?void 0:d.length)&&(Hv(this._limitVelocityCreation),Hv(this._limitVelocityGradientProcessing)),this}addDragGradient(v,d,Q){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Pv,previousItem:null,nextItem:null},Wv(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Ov,previousItem:null,nextItem:null},Wv(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,v,d,Q),this}removeDragGradient(v){var d;return this._removeFactorGradient(this._dragGradients,v),0===(null===(d=this._dragGradients)||void 0===d?void 0:d.length)&&(Hv(this._dragCreation),Hv(this._dragGradientProcessing)),this}addEmitRateGradient(v,d,Q){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,v,d,Q),this}removeEmitRateGradient(v){return this._removeFactorGradient(this._emitRateGradients,v),this}addStartSizeGradient(v,d,Q){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,v,d,Q),this._syncStartSizeCreation(),this}removeStartSizeGradient(v){return this._removeFactorGradient(this._startSizeGradients,v),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const v=new Uint8Array(4*this._rawTextureWidth),d=e.j.wk[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const n=Q/this._rawTextureWidth;w.GetCurrentGradient(n,this._rampGradients,((n,T,L)=>{e.c.LerpToRef(n.color,T.color,L,d),v[4*Q]=255*d.r,v[4*Q+1]=255*d.g,v[4*Q+2]=255*d.b,v[4*Q+3]=255}))}this._rampGradientsTexture=E.c.CreateRGBATexture(v,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((v,d)=>v.gradient<d.gradient?-1:v.gradient>d.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(v,d){this._rampGradients||(this._rampGradients=[]);const Q=new U(v,d);return this._rampGradients.push(Q),this._syncRampGradientTexture(),this}removeRampGradient(v){return this._removeGradientAndTexture(v,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(v,d,Q){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Lv,this._colorProcessing.process=ev);const n=new I(v,d,Q);return this._colorGradients.push(n),this._colorGradients.sort(((v,d)=>v.gradient<d.gradient?-1:v.gradient>d.gradient?1:0)),this}removeColorGradient(v){if(!this._colorGradients)return this;let d=0;for(const Q of this._colorGradients){if(Q.gradient===v){this._colorGradients.splice(d,1);break}d++}return 0===this._colorGradients.length&&(this._colorCreation.process=Tv,this._colorProcessing.process=Fv),this}resetDrawCache(){if(this._drawWrappers){for(const v of this._drawWrappers)if(v)for(const d of v)null===d||void 0===d||d.dispose();this._drawWrappers=[]}}_fetchR(v,d,Q,n,T){return T[4*(((v=.5*Math.abs(v)+.5)*Q%Q|0)+((d=.5*Math.abs(d)+.5)*n%n|0)*Q)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const v=this._engine,d=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*d),this._vertexBuffer=new P.c(v,this._vertexData,!0,d);let Q=0;const n=this._vertexBuffer.createVertexBuffer(P.e.PositionKind,Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.e.PositionKind]=n,Q+=3;const T=this._vertexBuffer.createVertexBuffer(P.e.ColorKind,Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.e.ColorKind]=T,Q+=4;const L=this._vertexBuffer.createVertexBuffer("angle",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=L,Q+=1;const e=this._vertexBuffer.createVertexBuffer("size",Q,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=e,Q+=2,this._isAnimationSheetEnabled){const v=this._vertexBuffer.createVertexBuffer("cellIndex",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=v,Q+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const v=this._vertexBuffer.createVertexBuffer("direction",Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=v,Q+=3}if(this._useRampGradients){const v=this._vertexBuffer.createVertexBuffer("remapData",Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=v,Q+=4}let F;if(this._useInstancing){const d=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new P.c(v,d,!1,2),F=this._spriteBuffer.createVertexBuffer("offset",0,2)}else F=this._vertexBuffer.createVertexBuffer("offset",Q,2,this._vertexBufferSize,this._useInstancing),Q+=2;this._vertexBuffers.offset=F,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const v=[],d=[];let Q=0;for(let n=0;n<this._capacity;n++)v.push(Q),v.push(Q+1),v.push(Q+2),v.push(Q),v.push(Q+2),v.push(Q+3),d.push(Q,Q+1,Q+1,Q+2,Q+2,Q+3,Q+3,Q,Q,Q+3),Q+=4;this._indexBuffer=this._engine.createIndexBuffer(v),this._linesIndexBuffer=this._engine.createIndexBuffer(d)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(v)setTimeout((()=>{this.start(0)}),v);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var d;-1!==(null===(d=this.j)||void 0===d?void 0:d.getClassName().indexOf("Mesh"))&&this.j.ck(!0);const v=this.noiseTexture;if(v&&v.onGeneratedObservable)v.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let d=0;d<this.preWarmCycles;d++)this.animate(!0),v.render()}))}));else for(let d=0;d<this.preWarmCycles;d++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(v))}_postStop(v){}reset(){this._stockParticles.length=0,this.Ql.length=0}_appendParticleVertex(v,d,Q,T){let L=v*this._vertexBufferSize;if(this._vertexData[L++]=d.position.x+this.Eg.x,this._vertexData[L++]=d.position.y+this.Eg.y,this._vertexData[L++]=d.position.z+this.Eg.z,this._vertexData[L++]=d.color.r,this._vertexData[L++]=d.color.g,this._vertexData[L++]=d.color.b,this._vertexData[L++]=d.color.a,this._vertexData[L++]=d.angle,this._vertexData[L++]=d.scale.x*d.size,this._vertexData[L++]=d.scale.y*d.size,this._isAnimationSheetEnabled&&(this._vertexData[L++]=d.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[L++]=d.direction.x,this._vertexData[L++]=d.direction.y,this._vertexData[L++]=d.direction.z);else if(d._initialDirection){let v=d._initialDirection;this.isLocal&&(n.j.TransformNormalToRef(v,this._emitterWorldMatrix,n.g.fk[0]),v=n.g.fk[0]),0===v.x&&0===v.z&&(v.x=.001),this._vertexData[L++]=v.x,this._vertexData[L++]=v.y,this._vertexData[L++]=v.z}else{let v=d.direction;this.isLocal&&(n.j.TransformNormalToRef(v,this._emitterWorldMatrix,n.g.fk[0]),v=n.g.fk[0]),0===v.x&&0===v.z&&(v.x=.001),this._vertexData[L++]=v.x,this._vertexData[L++]=v.y,this._vertexData[L++]=v.z}this._useRampGradients&&d.remapData&&(this._vertexData[L++]=d.remapData.x,this._vertexData[L++]=d.remapData.y,this._vertexData[L++]=d.remapData.z,this._vertexData[L++]=d.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon),0===T?T=this._epsilon:1===T&&(T=1-this._epsilon)),this._vertexData[L++]=Q,this._vertexData[L++]=T)}_prepareParticle(v){}_createNewOnes(v){let d;for(let Q=0;Q<v&&this.Ql.length!==this._capacity;Q++){d=this._createParticle(),this.Ql.push(d);let v=this._createQueueStart;for(;v;)v.process(d,this),v=v.nextItem;d._inheritParticleInfoToSubEmitters()}}_update(v){if(this._alive=this.Ql.length>0,this.j.position){const v=this.j;this._emitterWorldMatrix=v.getWorldMatrix()}else{const v=this.j;this._emitterWorldMatrix=n.b.Translation(v.x,v.y,v.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ql),this._createNewOnes(v)}static _GetAttributeNamesOrOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[P.e.PositionKind,P.e.ColorKind,"angle","offset","size"];return v&&n.push("cellIndex"),d||n.push("direction"),Q&&n.push("remapData"),n}static _GetEffectCreationOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,dv.c)(n),v&&n.push("particlesInfos"),d&&n.push("logarithmicDepthConstant"),Q&&(n.push("vFogInfos"),n.push("vFogColor")),n}fillDefines(v,d){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,dv.i)(this,this._scene,v),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&v.push("#define FOG")),this._isAnimationSheetEnabled&&v.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&v.push("#define LOGARITHMICDEPTH"),d===r.BLENDMODE_MULTIPLY&&v.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&v.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(v.push("#define BILLBOARD"),this.billboardMode){case 2:v.push("#define BILLBOARDY");break;case 8:case 9:v.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&v.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:v.push("#define BILLBOARDMODE_ALL")}Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),v.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(v,d,Q){d.push(...sv._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),v.push(...sv._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,nv.i)(v,this._imageProcessingConfigurationDefines),(0,nv.e)(Q,this._imageProcessingConfigurationDefines))}_getWrapper(v){const d=this._getCustomDrawWrapper(v);if(null!==d&&void 0!==d&&d.effect)return d;const Q=[];this.fillDefines(Q,v);const n=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let T=this._drawWrappers[n];T||(T=this._drawWrappers[n]=[]);let L=T[v];L||(L=new vv.b(this._engine),L.drawContext&&(L.drawContext.useInstancing=this._useInstancing),T[v]=L);const e=Q.join("\n");if(L.defines!==e){const v=[],d=[],Q=[];this.fillUniformsAttributesAndSamplerNames(d,v,Q),L.setEffect(this._engine.createEffect("particles",v,d,Q,e,void 0,void 0,void 0,void 0,this._shaderLanguage),e)}return L}animate(){var v;let d,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!Q&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Q?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this.manualEmitCount>-1)d=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let v=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const d=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(d,this._emitRateGradients,((d,Q,n)=>{d!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Q.getFactor(),this._currentEmitRateGradient=d),v=(0,C.Lerp)(this._currentEmitRate1,this._currentEmitRate2,n)}))}d=v*this._scaledUpdateSpeed|0,this._newPartsExcess+=v*this._scaledUpdateSpeed-d}if(this._newPartsExcess>1&&(d+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?d=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(d),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Q){let v=0;for(let d=0;d<this.Ql.length;d++){const Q=this.Ql[d];this._appendParticleVertices(v,Q),v+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ql.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(v,d){this._appendParticleVertex(v++,d,0,0),this._useInstancing||(this._appendParticleVertex(v++,d,1,0),this._appendParticleVertex(v++,d,1,1),this._appendParticleVertex(v++,d,0,1))}rebuild(){var v;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(v=this._spriteBuffer)||void 0===v||v._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!sv.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Q.bind(Q,12677)),Promise.resolve().then(Q.bind(Q,12613))])):await Promise.all([Promise.resolve().then(Q.bind(Q,12603)),Promise.resolve().then(Q.bind(Q,12590))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==r.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(r.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(r.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(v){const d=this._getWrapper(v),Q=d.effect,T=this._engine;T.enableEffect(d);const L=this.defaultViewMatrix??this._scene.getViewMatrix();if(Q.setTexture("diffuseSampler",this.particleTexture),Q.setMatrix("view",L),Q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const v=this.particleTexture.getBaseSize();Q.setFloat3("particlesInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,this.spriteCellWidth/v.width)}if(Q.setVector2("translationPivot",this.translationPivot),Q.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const v=this._scene.activeCamera;Q.setVector3("eyePosition",v.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Q.setTexture("rampSampler",this._rampGradientsTexture));const e=Q.defines;var F,r,C,u,y,z;(this._scene&&((0,dv.f)(Q,this,this._scene),this.applyFog&&(0,Qv.f)(this._scene,void 0,Q)),e.indexOf("#define BILLBOARDMODE_ALL")>=0&&(L.invertToRef(n.g.Matrix[0]),Q.setMatrix("invView",n.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?T.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Q):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Q)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?T.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Q):T.bindBuffers(this._vertexBuffers,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null,Q);(this.useLogarithmicDepth&&this._scene&&(0,Qv.l)(e,Q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Q),this._setEngineBasedOnBlendMode(v),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Q),this._useInstancing)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?T.drawElementsType(6,0,10,this.Ql.length):T.drawArraysType(7,0,4,this.Ql.length):null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?T.drawElementsType(1,0,10*this.Ql.length):T.drawElementsType(0,0,6*this.Ql.length);return this.Ql.length}render(){if(!this.isReady()||!this.Ql.length)return 0;const v=this._engine;v.setState&&(v.setState(!1),this.forceDepthWrite&&v.setDepthWrite(!0));let d=0;return d=this.blendMode===r.BLENDMODE_MULTIPLYADD?this._render(r.BLENDMODE_MULTIPLY)+this._render(r.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),d}_onDispose(){}dispose(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),v&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),v&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(d,Q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const v=this._scene.Ck.indexOf(this);v>-1&&this._scene.Ck.splice(v,1),this._scene._activeParticleSystems.dispose()}this.kk.notifyObservers(this),this.kk.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}sv.ForceGLSL=!1;var av,Iv=Q(497);!function(v){v[v.ATTACHED=0]="ATTACHED",v[v.END=1]="END"}(av||(av={}));class Uv{constructor(v){if(this.particleSystem=v,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!v.j||!v.j.dispose){const d=(0,F.e)("BABYLON.AbstractMesh");v.j=new d("SubemitterSystemEmitter",v.va()),v._disposeEmitterOnDispose=!0}}clone(){let v=this.particleSystem.j;if(v){if(v instanceof n.j)v=v.clone();else if(-1!==v.getClassName().indexOf("Mesh")){v=new((0,F.e)("BABYLON.Mesh"))("",v.va()),v.isVisible=!1}}else v=new n.j;const d=new Uv(this.particleSystem.clone(this.particleSystem.name,v));return d.particleSystem.name+="Clone",d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem._disposeEmitterOnDispose=!0,d.particleSystem.disposeOnStop=!0,d}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem=this.particleSystem.serialize(v),d}static _ParseParticleSystem(v,d,Q){throw(0,Iv.c)("ParseParticle")}static Parse(v,d,Q){const n=v.particleSystem,T=new Uv(Uv._ParseParticleSystem(n,d,Q,!0));return T.type=v.type,T.inheritDirection=v.inheritDirection,T.inheritedVelocityAmount=v.inheritedVelocityAmount,T.particleSystem._isSubEmitter=!0,T}dispose(){this.particleSystem.dispose()}}var cv=Q(544);function wv(v,d){const Q=new h;return Q.direction1=v,Q.direction2=d,Q}function Gv(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ev(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Nv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.j(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0);return new A(v,d,Q)}function lv(){return new X(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function vd(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.j(0,1,0);return new m(v,d,Q,T,L)}function dd(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new z(v,d)}function Qd(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0);return new B(v,d,Q,T)}const nd=n.j.Zero(),Td=n.j.Zero(),Ld=n.j.Zero();class ed{constructor(){this.strength=0,this.position=n.j.Zero()}_processParticle(v,d){this.position.subtractToRef(v.position,nd);const Q=nd.lengthSquared()+1;nd.normalize().scaleToRef(this.strength/Q,Td),Td.scaleToRef(d._tempScaledUpdateSpeed,Ld),v.direction.addInPlace(Ld)}serialize(){return{position:this.position.mk(),strength:this.strength}}}class Fd extends sv{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=v=>{if(!this._subEmitters||0===this._subEmitters.length)return;const d=Math.floor(Math.random()*this._subEmitters.length);for(const Q of this._subEmitters[d])if(1===Q.type){const d=Q.clone();v._inheritParticleInfoToSubEmitter(d),d.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(d.particleSystem),d.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(v,d){const Q=wv(v,d);return this.particleEmitterType=Q,Q}get flowMap(){return this._flowMap}set flowMap(v){this._flowMap!==v&&(this._flowMap=v,this._flowMapUpdate&&(Hv(this._flowMapUpdate),this._flowMapUpdate=null),v&&(this._flowMapUpdate={process:v=>{var d;const Q=null===(d=this.va())||void 0===d?void 0:d.getTransformMatrix();this._flowMap._processParticle(v,this.flowMapStrength*this._tempScaledUpdateSpeed,Q)},previousItem:null,nextItem:null},qv(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(v){this._attractors.push(v),1===this._attractors.length&&(this._attractorUpdate={process:v=>{for(const d of this._attractors)d._processParticle(v,this)},previousItem:null,nextItem:null},qv(this._attractorUpdate,this._directionProcessing))}removeAttractor(v){const d=this._attractors.indexOf(v);-1!==d&&this._attractors.splice(d,1),0===this._attractors.length&&Hv(this._attractorUpdate)}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(v)}createHemisphericEmitter(){const v=Gv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createSphereEmitter(){const v=Ev(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createDirectedSphereEmitter(){const v=Nv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0));return this.particleEmitterType=v,v}createCylinderEmitter(){const v=lv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=v,v}createDirectedCylinderEmitter(){const v=vd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.j(0,1,0));return this.particleEmitterType=v,v}createConeEmitter(){const v=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=v,v}createDirectedConeEmitter(){const v=Qd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0));return this.particleEmitterType=v,v}createBoxEmitter(v,d,Q,n){const T=new y;return this.particleEmitterType=T,this.direction1=v,this.direction2=d,this.minEmitBox=Q,this.maxEmitBox=n,T}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const v of this.subEmitters)v instanceof Fd?this._subEmitters.push([new Uv(v)]):v instanceof Uv?this._subEmitters.push([v]):v instanceof Array&&this._subEmitters.push(v)}_stopSubEmitters(){if(this.activeSubSystems){for(const v of this.activeSubSystems)v.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const v=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==v&&this._rootParticleSystem.activeSubSystems.splice(v,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(v){v&&this._stopSubEmitters()}_prepareParticle(v){if(this._subEmitters&&this._subEmitters.length>0){const d=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];v._attachedSubEmitters=[];for(const Q of d)if(0===Q.type){const d=Q.clone();v._attachedSubEmitters.push(d),d.particleSystem.start()}}}_onDispose(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),v&&this.particles)for(const Q of this.particles)if(Q._attachedSubEmitters)for(let v=Q._attachedSubEmitters.length-1;v>=0;v-=1)Q._attachedSubEmitters[v].dispose();if(d&&this.activeSubSystems)for(let Q=this.activeSubSystems.length-1;Q>=0;Q-=1)this.activeSubSystems[Q].dispose();if(this._subEmitters&&this._subEmitters.length){for(let v=0;v<this._subEmitters.length;v++)for(const d of this._subEmitters[v])d.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(v,d,Q,T){let L;L=Q instanceof cv.d?null:Q;const r=(0,F.e)("BABYLON.Texture");if(r&&L&&(v.texture?d.particleTexture=r.Parse(v.texture,L,T):v.textureName&&(d.particleTexture=new r(T+v.textureName,L,!1,void 0===v.invertY||v.invertY),d.particleTexture.name=v.textureName)),v.emitterId||0===v.emitterId||void 0!==v.j?v.emitterId&&L?d.j=L.getLastMeshById(v.emitterId):d.j=n.j.dk(v.j):d.j=n.j.Zero(),d.isLocal=!!v.isLocal,void 0!==v.renderingGroupId&&(d.renderingGroupId=v.renderingGroupId),void 0!==v.isBillboardBased&&(d.isBillboardBased=v.isBillboardBased),void 0!==v.billboardMode&&(d.billboardMode=v.billboardMode),void 0!==v.useLogarithmicDepth&&(d.useLogarithmicDepth=v.useLogarithmicDepth),v.animations){for(let Q=0;Q<v.animations.length;Q++){const n=v.animations[Q],T=(0,F.e)("BABYLON.Animation");T&&d.animations.push(T.Parse(n))}d.beginAnimationOnStart=v.beginAnimationOnStart,d.beginAnimationFrom=v.beginAnimationFrom,d.beginAnimationTo=v.beginAnimationTo,d.beginAnimationLoop=v.beginAnimationLoop}if(v.autoAnimate&&L&&L.beginAnimation(d,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),d.startDelay=0|v.startDelay,d.minAngularSpeed=v.minAngularSpeed,d.maxAngularSpeed=v.maxAngularSpeed,d.minSize=v.minSize,d.maxSize=v.maxSize,v.minScaleX&&(d.minScaleX=v.minScaleX,d.maxScaleX=v.maxScaleX,d.minScaleY=v.minScaleY,d.maxScaleY=v.maxScaleY),void 0!==v.preWarmCycles&&(d.preWarmCycles=v.preWarmCycles,d.preWarmStepOffset=v.preWarmStepOffset),void 0!==v.minInitialRotation&&(d.minInitialRotation=v.minInitialRotation,d.maxInitialRotation=v.maxInitialRotation),d.minLifeTime=v.minLifeTime,d.maxLifeTime=v.maxLifeTime,d.minEmitPower=v.minEmitPower,d.maxEmitPower=v.maxEmitPower,d.emitRate=v.emitRate,d.gravity=n.j.dk(v.gravity),v.noiseStrength&&(d.noiseStrength=n.j.dk(v.noiseStrength)),d.color1=e.f.dk(v.color1),d.color2=e.f.dk(v.color2),d.colorDead=e.f.dk(v.colorDead),d.updateSpeed=v.updateSpeed,d.targetStopDuration=v.targetStopDuration,d.blendMode=v.blendMode,v.colorGradients)for(const n of v.colorGradients)d.addColorGradient(n.gradient,e.f.dk(n.color1),n.color2?e.f.dk(n.color2):void 0);if(v.rampGradients){for(const Q of v.rampGradients)d.addRampGradient(Q.gradient,e.c.dk(Q.color));d.useRampGradients=v.useRampGradients}if(v.colorRemapGradients)for(const n of v.colorRemapGradients)d.addColorRemapGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.alphaRemapGradients)for(const n of v.alphaRemapGradients)d.addAlphaRemapGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.sizeGradients)for(const n of v.sizeGradients)d.addSizeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.angularSpeedGradients)for(const n of v.angularSpeedGradients)d.addAngularSpeedGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.velocityGradients)for(const n of v.velocityGradients)d.addVelocityGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.dragGradients)for(const n of v.dragGradients)d.addDragGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.emitRateGradients)for(const n of v.emitRateGradients)d.addEmitRateGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.startSizeGradients)for(const n of v.startSizeGradients)d.addStartSizeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.lifeTimeGradients)for(const n of v.lifeTimeGradients)d.addLifeTimeGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);if(v.limitVelocityGradients){for(const Q of v.limitVelocityGradients)d.addLimitVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);d.limitVelocityDamping=v.limitVelocityDamping}if(v.noiseTexture&&L){const Q=(0,F.e)("BABYLON.ProceduralTexture");d.noiseTexture=Q.Parse(v.noiseTexture,L,T)}let C;if(v.particleEmitterType){switch(v.particleEmitterType.type){case"SphereParticleEmitter":C=new S;break;case"SphereDirectedParticleEmitter":C=new A;break;case"ConeEmitter":case"ConeParticleEmitter":C=new z;break;case"ConeDirectedParticleEmitter":C=new B;break;case"CylinderParticleEmitter":C=new X;break;case"CylinderDirectedParticleEmitter":C=new m;break;case"HemisphericParticleEmitter":C=new V;break;case"PointParticleEmitter":C=new h;break;case"MeshParticleEmitter":C=new O;break;case"CustomParticleEmitter":C=new f;break;default:C=new y}C.parse(v.particleEmitterType,L)}else C=new y,C.parse(v,L);d.particleEmitterType=C,d.startSpriteCellID=v.startSpriteCellID,d.endSpriteCellID=v.endSpriteCellID,d.spriteCellLoop=v.spriteCellLoop??!0,d.spriteCellWidth=v.spriteCellWidth,d.spriteCellHeight=v.spriteCellHeight,d.spriteCellChangeSpeed=v.spriteCellChangeSpeed,d.spriteRandomStartCell=v.spriteRandomStartCell,d.disposeOnStop=v.disposeOnStop??!1,d.manualEmitCount=v.manualEmitCount??-1}static Parse(v,d,Q){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const F=v.name;let r,C,u=null,y=null;if(d instanceof cv.d?r=d:(C=d,r=C.getEngine()),v.customShader&&r.createEffectForParticles){y=v.customShader;const d=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"";u=r.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,d)}const z=new Fd(F,L||v.Nb,d,u,v.isAnimationSheetEnabled);if(z.customShader=y,z._rootUrl=Q,v.id&&(z.id=v.id),v.subEmitters){z.subEmitters=[];for(const n of v.subEmitters){const v=[];for(const T of n)v.push(Uv.Parse(T,d,Q));z.subEmitters.push(v)}}if(v.attractors)for(const e of v.attractors){const v=new ed;v.position=n.j.dk(e.position),v.strength=e.strength,z.addAttractor(v)}return Fd._Parse(v,z,d,Q),v.textureMask&&(z.textureMask=e.f.dk(v.textureMask)),v.Eg&&(z.Eg=n.j.dk(v.Eg)),v.preventAutoStart&&(z.preventAutoStart=v.preventAutoStart),T||z.preventAutoStart||z.start(),z}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};if(Fd._Serialize(d,this,v),d.textureMask=this.textureMask.mk(),d.customShader=this.customShader,d.preventAutoStart=this.preventAutoStart,d.Eg=this.Eg.mk(),this.subEmitters){d.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Q of this._subEmitters){const n=[];for(const d of Q)n.push(d.serialize(v));d.subEmitters.push(n)}}if(this._attractors&&this._attractors.length){d.attractors=[];for(const v of this._attractors)d.attractors.push(v.serialize())}return d}static _Serialize(v,d,Q){if(v.name=d.name,v.id=d.id,v.Nb=d.getCapacity(),v.disposeOnStop=d.disposeOnStop,v.manualEmitCount=d.manualEmitCount,d.j.position){const Q=d.j;v.emitterId=Q.id}else{const Q=d.j;v.j=Q.mk()}d.particleEmitterType&&(v.particleEmitterType=d.particleEmitterType.serialize()),d.particleTexture&&(Q?v.texture=d.particleTexture.serialize():(v.textureName=d.particleTexture.name,v.invertY=!!d.particleTexture._invertY)),v.isLocal=d.isLocal,Z.e.AppendSerializedAnimations(d,v),v.beginAnimationOnStart=d.beginAnimationOnStart,v.beginAnimationFrom=d.beginAnimationFrom,v.beginAnimationTo=d.beginAnimationTo,v.beginAnimationLoop=d.beginAnimationLoop,v.startDelay=d.startDelay,v.renderingGroupId=d.renderingGroupId,v.isBillboardBased=d.isBillboardBased,v.billboardMode=d.billboardMode,v.minAngularSpeed=d.minAngularSpeed,v.maxAngularSpeed=d.maxAngularSpeed,v.minSize=d.minSize,v.maxSize=d.maxSize,v.minScaleX=d.minScaleX,v.maxScaleX=d.maxScaleX,v.minScaleY=d.minScaleY,v.maxScaleY=d.maxScaleY,v.minEmitPower=d.minEmitPower,v.maxEmitPower=d.maxEmitPower,v.minLifeTime=d.minLifeTime,v.maxLifeTime=d.maxLifeTime,v.emitRate=d.emitRate,v.gravity=d.gravity.mk(),v.noiseStrength=d.noiseStrength.mk(),v.color1=d.color1.mk(),v.color2=d.color2.mk(),v.colorDead=d.colorDead.mk(),v.updateSpeed=d.updateSpeed,v.targetStopDuration=d.targetStopDuration,v.blendMode=d.blendMode,v.preWarmCycles=d.preWarmCycles,v.preWarmStepOffset=d.preWarmStepOffset,v.minInitialRotation=d.minInitialRotation,v.maxInitialRotation=d.maxInitialRotation,v.startSpriteCellID=d.startSpriteCellID,v.spriteCellLoop=d.spriteCellLoop,v.endSpriteCellID=d.endSpriteCellID,v.spriteCellChangeSpeed=d.spriteCellChangeSpeed,v.spriteCellWidth=d.spriteCellWidth,v.spriteCellHeight=d.spriteCellHeight,v.spriteRandomStartCell=d.spriteRandomStartCell,v.isAnimationSheetEnabled=d.isAnimationSheetEnabled,v.useLogarithmicDepth=d.useLogarithmicDepth;const n=d.getColorGradients();if(n){v.colorGradients=[];for(const d of n){const Q={gradient:d.gradient,color1:d.color1.mk()};d.color2?Q.color2=d.color2.mk():Q.color2=d.color1.mk(),v.colorGradients.push(Q)}}const T=d.getRampGradients();if(T){v.rampGradients=[];for(const d of T){const Q={gradient:d.gradient,color:d.color.mk()};v.rampGradients.push(Q)}v.useRampGradients=d.useRampGradients}const L=d.getColorRemapGradients();if(L){v.colorRemapGradients=[];for(const d of L){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.colorRemapGradients.push(Q)}}const e=d.getAlphaRemapGradients();if(e){v.alphaRemapGradients=[];for(const d of e){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.alphaRemapGradients.push(Q)}}const F=d.getSizeGradients();if(F){v.sizeGradients=[];for(const d of F){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.sizeGradients.push(Q)}}const r=d.getAngularSpeedGradients();if(r){v.angularSpeedGradients=[];for(const d of r){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.angularSpeedGradients.push(Q)}}const C=d.getVelocityGradients();if(C){v.velocityGradients=[];for(const d of C){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.velocityGradients.push(Q)}}const u=d.getDragGradients();if(u){v.dragGradients=[];for(const d of u){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.dragGradients.push(Q)}}const y=d.getEmitRateGradients();if(y){v.emitRateGradients=[];for(const d of y){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.emitRateGradients.push(Q)}}const z=d.getStartSizeGradients();if(z){v.startSizeGradients=[];for(const d of z){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.startSizeGradients.push(Q)}}const B=d.getLifeTimeGradients();if(B){v.lifeTimeGradients=[];for(const d of B){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.lifeTimeGradients.push(Q)}}const X=d.getLimitVelocityGradients();if(X){v.limitVelocityGradients=[];for(const d of X){const Q={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?Q.factor2=d.factor2:Q.factor2=d.factor1,v.limitVelocityGradients.push(Q)}v.limitVelocityDamping=d.limitVelocityDamping}d.noiseTexture&&(v.noiseTexture=d.noiseTexture.serialize())}clone(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n={...this._customWrappers};let T=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){T=this.customShader;const v=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"",d=L.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,v);n[0]?n[0].effect=d:this.setCustomEffect(d,0)}const e=this.serialize(Q),F=Fd.Parse(e,this._scene||this._engine,this._rootUrl);return F.name=v,F.customShader=T,F._customWrappers=n,void 0===d&&(d=this.j),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.j=d,this.preventAutoStart||F.start(),F}}Fd.BILLBOARDMODE_Y=2,Fd.BILLBOARDMODE_ALL=7,Fd.BILLBOARDMODE_STRETCHED=8,Fd.BILLBOARDMODE_STRETCHED_LOCAL=9,Uv._ParseParticleSystem=Fd.Parse;var rd=Q(2175),Cd=Q(2167),ud=Q(2072);ud.b.prototype.createTransformFeedback=function(){const v=this._gl.createTransformFeedback();if(!v)throw new Error("Unable to create Transform Feedback");return v},ud.b.prototype.deleteTransformFeedback=function(v){this._gl.deleteTransformFeedback(v)},ud.b.prototype.bindTransformFeedback=function(v){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,v)},ud.b.prototype.beginTransformFeedback=function(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(v?this._gl.POINTS:this._gl.TRIANGLES)},ud.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},ud.b.prototype.setTranformFeedbackVaryings=function(v,d){this._gl.transformFeedbackVaryings(v,d,this._gl.INTERLEAVED_ATTRIBS)},ud.b.prototype.bindTransformFeedbackBuffer=function(v){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,v?v.underlyingResource:null)},ud.b.prototype.readTransformFeedbackBuffer=function(v){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,v)};const yd="clipPlaneFragmentDeclaration2",zd="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";K.e.IncludesShadersStore[yd]||(K.e.IncludesShadersStore[yd]=zd);Q(12496),Q(12502),Q(12509),Q(12511),Q(12516),Q(12523),Q(12528),Q(12530);const Bd="gpuRenderParticlesPixelShader",Xd="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";K.e.ShadersStore[Bd]||(K.e.ShadersStore[Bd]=Xd);const md="clipPlaneVertexDeclaration2",Vd="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";K.e.IncludesShadersStore[md]||(K.e.IncludesShadersStore[md]=Vd);Q(12539),Q(12542),Q(12550),Q(12554);const hd="gpuRenderParticlesVertexShader",Sd="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";K.e.ShadersStore[hd]||(K.e.ShadersStore[hd]=Sd);class Ad extends r{static get IsSupported(){if(!N.c.LastCreatedEngine)return!1;const v=N.c.LastCreatedEngine.getCaps();return v.supportTransformFeedbacks||v.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(v){this._maxActiveParticleCount=Math.min(v,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(v){this.maxActiveParticleCount=v}createPointEmitter(v,d){const Q=wv(v,d);return this.particleEmitterType=Q,Q}createHemisphericEmitter(){const v=Gv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createSphereEmitter(){const v=Ev(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createDirectedSphereEmitter(){const v=Nv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0));return this.particleEmitterType=v,v}createCylinderEmitter(){const v=lv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=v,v}createDirectedCylinderEmitter(){const v=vd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new n.j(0,1,0));return this.particleEmitterType=v,v}createConeEmitter(){const v=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=v,v}createDirectedConeEmitter(){const v=Qd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.j(0,1,0));return this.particleEmitterType=v,v}createBoxEmitter(v,d,Q,n){const T=new y;return this.particleEmitterType=T,this.direction1=v,this.direction2=d,this.minEmitBox=Q,this.maxEmitBox=n,T}get flowMap(){return this._flowMap}set flowMap(v){this._flowMap!==v&&(this._flowMap=v)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Fd.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Fd.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Fd.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";v?setTimeout((()=>{this.start(0)}),v):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var v;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(v=this._customWrappers[d])||void 0===v?void 0:v.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[v]??this._customWrappers[0]}setCustomEffect(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new vv.b(this._engine),this._customWrappers[d].effect=v}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new G.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(v,d,Q){return super._removeGradientAndTexture(v,d,Q),this._releaseBuffers(),this}addColorGradient(v,d){this._colorGradients||(this._colorGradients=[]);const Q=new I(v,d);return this._colorGradients.push(Q),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(v&&this._colorGradients.sort(((v,d)=>v.gradient<d.gradient?-1:v.gradient>d.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(v){return this._removeGradientAndTexture(v,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const d in this._drawWrappers){var v;null===(v=this._drawWrappers[d].drawContext)||void 0===v||v.reset()}}_addFactorGradient(v,d,Q){const n=new c(d,Q);v.push(n),this._releaseBuffers()}addSizeGradient(v,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,v,d),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(v){return this._removeGradientAndTexture(v,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(v,d){if(!v)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&v.sort(((v,d)=>v.gradient<d.gradient?-1:v.gradient>d.gradient?1:0));const Q=this;Q[d]&&(Q[d].dispose(),Q[d]=null)}addAngularSpeedGradient(v,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,v,d),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(v){return this._removeGradientAndTexture(v,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(v,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,v,d),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(v){return this._removeGradientAndTexture(v,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(v,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,v,d),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(v){return this._removeGradientAndTexture(v,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(v,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,v,d),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(v){return this._removeGradientAndTexture(v,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(v){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(v,d,Q){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(v),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.kk=new G.e,this.onStoppedObservable=new G.e,this.onStartedObservable=new G.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=n.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||N.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ck.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,F.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,F.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new vv.b(this._engine)},this._customWrappers[0].effect=T,this._drawWrappers={0:new vv.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(d=d??{}).randomTextureSize||delete d.randomTextureSize;const e={Nb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...d},r=d;isFinite(r)&&(e.Nb=r),this._capacity=e.Nb,this._maxActiveParticleCount=e.Nb,this._currentActiveCount=0,this._isAnimationSheetEnabled=L,this.particleEmitterType=new y;const C=Math.min(this._engine.getCaps().maxTextureSize,e.randomTextureSize);let u=[];for(let n=0;n<C;++n)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture=new E.c(new Float32Array(u),C,1,5,Q,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,u=[];for(let n=0;n<C;++n)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture2=new E.c(new Float32Array(u),C,1,5,Q,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=C}_reset(){this._releaseBuffers()}_createVertexBuffers(v,d,Q){const n={};n.position=d.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let T=3;n.age=d.createVertexBuffer("age",T,1,this._attributesStrideSize,!0),T+=1,n.size=d.createVertexBuffer("size",T,3,this._attributesStrideSize,!0),T+=3,n.life=d.createVertexBuffer("life",T,1,this._attributesStrideSize,!0),T+=1,T+=4,this.billboardMode===Fd.BILLBOARDMODE_STRETCHED&&(n.direction=d.createVertexBuffer("direction",T,3,this._attributesStrideSize,!0)),T+=3,this._platform.alignDataInBuffer&&(T+=1),this.particleEmitterType instanceof f&&(T+=3,this._platform.alignDataInBuffer&&(T+=1)),this._colorGradientsTexture||(n.color=d.createVertexBuffer("color",T,4,this._attributesStrideSize,!0),T+=4),this._isBillboardBased||(n.initialDirection=d.createVertexBuffer("initialDirection",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1)),this.noiseTexture&&(n.noiseCoordinates1=d.createVertexBuffer("noiseCoordinates1",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1),n.noiseCoordinates2=d.createVertexBuffer("noiseCoordinates2",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1)),n.angle=d.createVertexBuffer("angle",T,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?T++:T+=2,this._isAnimationSheetEnabled&&(n.cellIndex=d.createVertexBuffer("cellIndex",T,1,this._attributesStrideSize,!0),T+=1,this.spriteRandomStartCell&&(n.cellStartOffset=d.createVertexBuffer("cellStartOffset",T,1,this._attributesStrideSize,!0),T+=1)),n.offset=Q.createVertexBuffer("offset",0,2),n.uv=Q.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(n),this._platform.createVertexBuffers(v,n),this.resetDrawCache()}_initialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!v)return;const d=this._engine,Q=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const T=this.particleEmitterType instanceof f,L=n.g.fk[0];let e=0;for(let n=0;n<this._capacity;n++)if(Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),T?(this.particleEmitterType.particleDestinationGenerator(n,null,L),Q.push(L.x),Q.push(L.y),Q.push(L.z)):(Q.push(0),Q.push(0),Q.push(0)),this._platform.alignDataInBuffer&&Q.push(0),e+=16,T&&(this.particleEmitterType.particlePositionGenerator(n,null,L),Q.push(L.x),Q.push(L.y),Q.push(L.z),this._platform.alignDataInBuffer&&Q.push(0),e+=4),this._colorGradientsTexture||(Q.push(0),Q.push(0),Q.push(0),Q.push(0),e+=4),this.isBillboardBased||(Q.push(0),Q.push(0),Q.push(0),this._platform.alignDataInBuffer&&Q.push(0),e+=4),this.noiseTexture&&(Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),e+=8),Q.push(0),e+=1,this._angularSpeedGradientsTexture||(Q.push(0),e+=1),this._isAnimationSheetEnabled&&(Q.push(0),e+=1,this.spriteRandomStartCell&&(Q.push(0),e+=1)),this._platform.alignDataInBuffer){let v=3-(e+3&3);for(e+=v;v-- >0;)Q.push(0)}const F=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),r=this._platform.createParticleBuffer(Q),C=this._platform.createParticleBuffer(Q);this._buffer0=new P.c(d,r,!1,this._attributesStrideSize),this._buffer1=new P.c(d,C,!1,this._attributesStrideSize),this._spriteBuffer=new P.c(d,F,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let v=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(v+="\n#define BILLBOARD"),this._colorGradientsTexture&&(v+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(v+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(v+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(v+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(v+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(v+="\n#define DRAGGRADIENTS"),this._flowMap&&(v+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(v+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(v+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(v+="\n#define NOISE"),this.isLocal&&(v+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===v||(this._cachedUpdateDefines=v,this._updateBuffer=this._platform.createUpdateBuffer(v)),this._platform.isUpdateBufferReady()}_getWrapper(v){const d=this._getCustomDrawWrapper(v);if(null!==d&&void 0!==d&&d.effect)return d;const Q=[];this.fillDefines(Q,v);let n=this._drawWrappers[v];n||(n=new vv.b(this._engine),n.drawContext&&(n.drawContext.useInstancing=!0),this._drawWrappers[v]=n);const T=Q.join("\n");if(n.defines!==T){const v=[],d=[],Q=[];this.fillUniformsAttributesAndSamplerNames(d,v,Q),n.setEffect(this._engine.createEffect("gpuRenderParticles",v,d,Q,T),T)}return n}static _GetAttributeNamesOrOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const T=[P.e.PositionKind,"age","life","size","angle"];return v||T.push(P.e.ColorKind),d&&T.push("cellIndex"),Q||T.push("initialDirection"),n&&T.push("direction"),T.push("offset",P.e.UVKind),T}static _GetEffectCreationOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=["emitterWM","Eg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,dv.c)(n),v&&n.push("sheetInfos"),d&&n.push("logarithmicDepthConstant"),Q&&(n.push("vFogInfos"),n.push("vFogColor")),n}fillDefines(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,dv.i)(this,this._scene,v),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Cd.d.FOGMODE_NONE&&v.push("#define FOG")),d===Fd.BLENDMODE_MULTIPLY&&v.push("#define BLENDMULTIPLYMODE"),this.isLocal&&v.push("#define LOCAL"),this.useLogarithmicDepth&&v.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(v.push("#define BILLBOARD"),this.billboardMode){case Fd.BILLBOARDMODE_Y:v.push("#define BILLBOARDY");break;case Fd.BILLBOARDMODE_STRETCHED:v.push("#define BILLBOARDSTRETCHED");break;case Fd.BILLBOARDMODE_ALL:v.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&v.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&v.push("#define ANIMATESHEET"),Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),v.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(v,d,Q){d.push(...Ad._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Fd.BILLBOARDMODE_STRETCHED)),v.push(...Ad._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(rd.e.PrepareUniforms(v,this._imageProcessingConfigurationDefines),rd.e.PrepareSamplers(Q,this._imageProcessingConfigurationDefines))}animate(){var v;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(d?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(v,d){const Q=this[d];if(!v||!v.length||Q)return;const n=new Float32Array(this._rawTextureWidth);for(let T=0;T<this._rawTextureWidth;T++){const d=T/this._rawTextureWidth;w.GetCurrentGradient(d,v,((v,d,Q)=>{n[T]=(0,C.Lerp)(v.factor1,d.factor1,Q)}))}this[d]=E.c.CreateRTexture(n,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[d].name=d.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const v=new Uint8Array(4*this._rawTextureWidth),d=e.j.xk[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const n=Q/this._rawTextureWidth;w.GetCurrentGradient(n,this._colorGradients,((n,T,L)=>{e.f.LerpToRef(n.color1,T.color1,L,d),v[4*Q]=255*d.r,v[4*Q+1]=255*d.g,v[4*Q+2]=255*d.b,v[4*Q+3]=255*d.a}))}this._colorGradientsTexture=E.c.CreateRGBATexture(v,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(v,d){var Q,T,L,e;const F=this._getWrapper(v),r=F.effect;this._engine.enableEffect(F);const C=(null===(Q=this._scene)||void 0===Q?void 0:Q.getViewMatrix())||n.b.IdentityReadOnly;if(r.setMatrix("view",C),r.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),r.setTexture("diffuseSampler",this.particleTexture),r.setVector2("translationPivot",this.translationPivot),r.setVector3("Eg",this.Eg),this.isLocal&&r.setMatrix("emitterWM",d),this._colorGradientsTexture?r.setTexture("colorGradientSampler",this._colorGradientsTexture):r.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const v=this.particleTexture.getBaseSize();r.setFloat3("sheetInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,v.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const v=this._scene.activeCamera;r.setVector3("eyePosition",v.globalPosition)}const u=r.defines;if(this._scene&&((0,dv.f)(r,this,this._scene),this.applyFog&&(0,Qv.f)(this._scene,void 0,r)),u.indexOf("#define BILLBOARDMODE_ALL")>=0){const v=C.clone();v.invert(),r.setMatrix("invView",v)}return this.useLogarithmicDepth&&this._scene&&(0,Qv.l)(u,r,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(r),this._setEngineBasedOnBlendMode(v),this._platform.bindDrawBuffers(this._targetIndex,r,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(r),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(e=this._scene)&&void 0!==e&&e.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(v){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!v)if(this.j.position){v=this.j.getWorldMatrix()}else{const d=this.j;v=n.g.Matrix[0],n.b.TranslationToRef(d.x,d.y,d.z,v)}const d=this._engine,Q=d.getDepthWrite();if(d.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const v=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",v.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",v),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const T=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=T,d.setDepthWrite(Q)}render(){let v,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!d&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let v=0;v<this.preWarmCycles;v++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const v=0|this._accumulatedCount;this._accumulatedCount-=v,this._currentActiveCount+=v}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){v=this.j.getWorldMatrix()}else{const d=this.j;v=n.g.Matrix[0],n.b.TranslationToRef(d.x,d.y,d.z,v)}const T=this._engine;this.updateInAnimate||this._update(v);let L=0;return d||Q||(T.setState(!1),this.forceDepthWrite&&T.setDepthWrite(!0),L=this.blendMode===Fd.BLENDMODE_MULTIPLYADD?this._render(Fd.BLENDMODE_MULTIPLY,v)+this._render(Fd.BLENDMODE_ADD,v):this._render(this.blendMode,v),this._engine.setAlphaMode(0)),L}rebuild(){const v=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(v,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,v()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const d in this._drawWrappers){this._drawWrappers[d].dispose()}if(this._drawWrappers={},this._scene){const v=this._scene.Ck.indexOf(this);v>-1&&this._scene.Ck.splice(v,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let d=0;d<this._renderVertexBuffers.length;++d){const v=this._renderVertexBuffers[d];for(const d in v)v[d].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),v&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),v&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.kk.notifyObservers(this),this.kk.clear()}clone(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n={...this._customWrappers};let T=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){T=this.customShader;const v=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"";n[0]=L.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,v,void 0,void 0,void 0,this)}const e=this.serialize(Q),F=Ad.Parse(e,this._scene||this._engine,this._rootUrl);return F.name=v,F.customShader=T,F._customWrappers=n,void 0===d&&(d=this.j),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.j=d,F}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return Fd._Serialize(d,this,v),d.activeParticleCount=this.activeParticleCount,d.randomTextureSize=this._randomTextureSize,d.customShader=this.customShader,d}static Parse(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0;const L=v.name;let e,F;d instanceof cv.d?e=d:(F=d,e=F.getEngine());const r=new Ad(L,{Nb:T||v.Nb,randomTextureSize:v.randomTextureSize},d,null,v.isAnimationSheetEnabled);if(r._rootUrl=Q,v.customShader&&e.createEffectForParticles){const d=v.customShader,Q=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"",n=e.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,Q,void 0,void 0,void 0,r);r.setCustomEffect(n,0),r.customShader=d}return v.id&&(r.id=v.id),v.activeParticleCount&&(r.activeParticleCount=v.activeParticleCount),Fd._Parse(v,r,d,Q),v.preventAutoStart&&(r.preventAutoStart=v.preventAutoStart),n||r.preventAutoStart||r.start(),r}}var fd=Q(475),Pd=Q(12562),Od=Q(11993);class Jd{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(v){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const d of this.systems)d.j=v;this._emitterNode=v}setEmitterAsSphere(v,d,Q){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:v,renderingGroupId:d};const n=(0,Pd.e)("emitterSphere",{diameter:v.diameter,segments:v.segments},Q);n.renderingGroupId=d;const T=new Od.e("emitterSphereMaterial",Q);T.emissiveColor=v.color,n.material=T;for(const L of this.systems)L.j=n;this._emitterNode=n}start(v){for(const d of this.systems)v&&(d.j=v),d.start()}dispose(){for(const v of this.systems)v.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={systems:[]};for(const Q of this.systems)d.systems.push(Q.serialize(v));return this._emitterNode&&(d.j=this._emitterCreationOptions),d}static Parse(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const T=new Jd,L=this.BaseAssetsUrl+"/textures/";d=d||N.c.LastCreatedScene;for(const e of v.systems)T.systems.push(Q?Ad.Parse(e,d,L,!0,n):Fd.Parse(e,d,L,!0,n));if(v.j){const Q=v.j.options;if("Sphere"===v.j.kind)T.setEmitterAsSphere({diameter:Q.diameter,segments:Q.segments,color:e.c.dk(Q.color)},v.j.renderingGroupId,d)}return T}}Jd.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Kd=Q(501);class od{static CreateDefault(v){let d,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2?arguments[2]:void 0;d=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Ad("default system",{Nb:Q},n):new Fd("default system",Q,n),d.j=v;const T=fd.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return d.particleTexture=new j.e(T,d.va()),d.createConeEmitter(.1,Math.PI/4),d.color1=new e.f(1,1,1,1),d.color2=new e.f(1,1,1,1),d.colorDead=new e.f(1,1,1,0),d.minSize=.1,d.maxSize=.1,d.minEmitPower=2,d.maxEmitPower=2,d.updateSpeed=1/60,d.emitRate=30,d}static CreateAsync(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;d||(d=N.c.LastCreatedScene);const T={};return d.addPendingData(T),new Promise(((L,e)=>{if(Q&&!Ad.IsSupported)return d.removePendingData(T),e("Particle system with GPU is not supported.");fd.e.LoadFile(`${od.BaseAssetsUrl}/systems/${v}.json`,(v=>{d.removePendingData(T);const e=JSON.parse(v.toString());return L(Jd.Parse(e,d,Q,n))}),void 0,void 0,void 0,(()=>(d.removePendingData(T),e(`An error occurred with the creation of your particle system. Check if your type '${v}' exists.`))))}))}static ExportSet(v){const d=new Jd;for(const Q of v)d.systems.push(Q);return d}static ParseFromFileAsync(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",L=arguments.length>5?arguments[5]:void 0;return new Promise(((e,F)=>{const r=new Kd.b;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const d=JSON.parse(r.responseText);let F;F=n?Ad.Parse(d,Q,T,!1,L):Fd.Parse(d,Q,T,!1,L),v&&(F.name=v),e(F)}else F("Unable to load the particle system")})),r.open("GET",d),r.send()}))}static ParseFromSnippetAsync(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",T=arguments.length>4?arguments[4]:void 0;if("_BLANK"===v){const v=this.CreateDefault(null);return v.start(),Promise.resolve(v)}return new Promise(((L,e)=>{const F=new Kd.b;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const e=JSON.parse(JSON.parse(F.responseText).jsonPayload),r=JSON.parse(e.particleSystem);let C;C=Q?Ad.Parse(r,d,n,!1,T):Fd.Parse(r,d,n,!1,T),C.snippetId=v,L(C)}else e("Unable to load the snippet "+v)})),F.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),F.send()}))}}od.BaseAssetsUrl=Jd.BaseAssetsUrl,od.SnippetUrl="https://snippet.babylonjs.com",od.CreateFromSnippetAsync=od.ParseFromSnippetAsync;var gd=Q(470),Rd=Q(857),Md=Q(12568);(0,Md.f)(Rd.d.NAME_PARTICLESYSTEM,((v,d,Q,n)=>{const T=(0,Md.h)(Rd.d.NAME_PARTICLESYSTEM);if(T&&void 0!==v.Ck&&null!==v.Ck)for(let L=0,e=v.Ck.length;L<e;L++){const e=v.Ck[L];Q.Ck.push(T(e,d,n))}})),(0,Md.d)(Rd.d.NAME_PARTICLESYSTEM,((v,d,Q)=>{if(v.activeParticleCount){return Ad.Parse(v,d,Q)}return Fd.Parse(v,d,Q)})),cv.d.prototype.createEffectForParticles=function(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0,e=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9?arguments[9]:void 0,y=[],z=[];const B=[];return r?r.fillUniformsAttributesAndSamplerNames(z,y,B):(y=Fd._GetAttributeNamesOrOptions(),z=Fd._GetEffectCreationOptions()),-1===T.indexOf(" BILLBOARD")&&(T+="\n#define BILLBOARD\n"),null!==r&&void 0!==r&&r.isAnimationSheetEnabled&&-1===T.indexOf(" ANIMATESHEET")&&(T+="\n#define ANIMATESHEET\n"),-1===n.indexOf("diffuseSampler")&&n.push("diffuseSampler"),this.createEffect({vertex:u??(null===r||void 0===r?void 0:r.vertexShaderName)??"particles",fragmentElement:v},y,z.concat(d),B.concat(n),T,L,e,F,void 0,C,(async()=>{0===C?await Promise.resolve().then(Q.bind(Q,12603)):await Promise.resolve().then(Q.bind(Q,12677))}))},gd.b.prototype.getEmittedParticleSystems=function(){const v=[];for(let d=0;d<this.va().Ck.length;d++){const Q=this.va().Ck[d];Q.j===this&&v.push(Q)}return v},gd.b.prototype.getHierarchyEmittedParticleSystems=function(){const v=[],d=this.getDescendants();d.push(this);for(let Q=0;Q<this.va().Ck.length;Q++){const n=this.va().Ck[Q],T=n.j;T.position&&-1!==d.indexOf(T)&&v.push(n)}return v};Q(742),Q(758),Q(800);Q(725),Q(859),Q(821),Q(729),Q(854);Q(2013);var Yd;Q(12573),Q(2045);!function(v){v[v.Color=2]="Color",v[v.UV=1]="UV",v[v.Random=0]="Random",v[v.Stated=3]="Stated"}(Yd||(Yd={}));var Dd=Q(2033);const id=new n.j(0,0,0),Zd=new n.j(0,0,0),jd=new n.j(0,0,0);class xd{constructor(v,d,Q){this.width=v,this.height=d,this.data=Q}processFlowable(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2?arguments[2]:void 0;if(!Q)return;Q instanceof n.b?n.j.TransformCoordinatesToRef(v.position,Q,jd):(jd.x=Q.x,jd.y=Q.y,jd.z=Q.z);const T=.5*jd.x+.5,L=1-(.5*jd.y+.5),e=Math.floor(T*this.width),F=Math.floor(L*this.height);if(e<0||e>=this.width||F<0||F>=this.height)return;const r=4*(F*this.width+e),C=this.data[r]/255*2-1,u=this.data[r+1]/255*2-1,y=this.data[r+2]/255*2-1,z=this.data[r+3]/255;id.set(C,u,y),id.scaleToRef(d*z,Zd),v.direction.addInPlace(Zd)}_processParticle(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2?arguments[2]:void 0;this.processFlowable(v,d,Q)}static async FromUrlAsync(v){return await new Promise(((d,Q)=>{const n=document.createElement("canvas"),T=n.getContext("2d");let L=null;const e=new Image;e.crossOrigin="anonymous",e.src=v,e.onerror=d=>{Q(new Error(`Failed to load image: ${v} : ${d}`))},e.onload=()=>{n.width=e.width,n.height=e.height,T.drawImage(e,0,0),L=T.getImageData(0,0,n.width,n.height),d(new xd(n.width,n.height,L.data))}}))}static async ExtractFromTextureAsync(v){return await new Promise(((d,Q)=>{if(!v.isReady())return void v.onLoadObservable.addOnce((async()=>{try{const Q=await this.ExtractFromTextureAsync(v);d(Q)}catch(n){Q(n)}}));const n=v.getSize();Dd.j.GetTextureDataAsync(v,n.width,n.height).then((v=>{d(new xd(n.width,n.height,new Uint8ClampedArray(v)))})).catch(Q)}))}}var kd,td,pd,Wd,qd,bd,Hd,sd,ad;!function(v){v[v.Int=1]="Int",v[v.Float=2]="Float",v[v.Vector2=4]="Vector2",v[v.fk=8]="fk",v[v.Matrix=16]="Matrix",v[v.Particle=32]="Particle",v[v.Texture=64]="Texture",v[v.xk=128]="xk",v[v.FloatGradient=256]="FloatGradient",v[v.Vector2Gradient=512]="Vector2Gradient",v[v.Vector3Gradient=1024]="Vector3Gradient",v[v.Color4Gradient=2048]="Color4Gradient",v[v.System=4096]="System",v[v.AutoDetect=8192]="AutoDetect",v[v.BasedOnInput=16384]="BasedOnInput",v[v.Undefined=32768]="Undefined",v[v.All=65535]="All"}(kd||(kd={})),function(v){v[v.Compatible=0]="Compatible",v[v.TypeIncompatible=1]="TypeIncompatible",v[v.HierarchyIssue=2]="HierarchyIssue"}(td||(td={})),function(v){v[v.Input=0]="Input",v[v.Output=1]="Output"}(pd||(pd={}));class Id{get direction(){return this._direction}get type(){if(this._type===kd.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===kd.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(v){this._type=v}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((v=>v.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(v,d,Q){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=kd.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new G.e,this.onDisconnectionObservable=new G.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=d,this.name=v,this._direction=Q}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(v){var d;return this.isConnected?null!==(d=this._connectedPoint)&&void 0!==d&&d._storedFunction?this._connectedPoint._storedFunction(v):this._connectedPoint._storedValue:this.value}canConnectTo(v){return 0===this.checkCompatibilityState(v)}checkCompatibilityState(v){const d=this._ownerBlock,Q=v.ownerBlock;if(this.type!==v.type&&v.innerType!==kd.AutoDetect)return v.acceptedConnectionPointTypes&&-1!==v.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(v.excludedConnectionPointTypes&&-1!==v.excludedConnectionPointTypes.indexOf(this.type))return 1;let n=Q,T=d;return 0===this.direction&&(n=d,T=Q),n.isAnAncestorOf(T)?2:0}connectTo(v){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(v))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${v.ownerBlock.name}".${v.name}`;return this._endpoints.push(v),v._connectedPoint=this,this.onConnectionObservable.notifyObservers(v),v.onConnectionObservable.notifyObservers(this),this}disconnectFrom(v){const d=this._endpoints.indexOf(v);return-1===d||(this._endpoints.splice(d,1),v._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(v),v.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(v){let d=1;for(;d<kd.All;)v&d||this.excludedConnectionPointTypes.push(d),d<<=1}serialize(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d={};return d.name=this.name,d.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.mk?(d.valueType="BABYLON."+this.value.getClassName(),d.value=this.value.mk()):(d.valueType="number",d.value=this.value)),v&&this.connectedPoint&&(d.inputName=this.name,d.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,d.targetConnectionName=this.connectedPoint.name,d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),d}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Ud{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(v){this._name=v}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(v){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new G.e,this.kk=new G.e,this.onInputChangedObservable=new G.e,this.visibleOnFrame=!1,this._name=v,this.uniqueId=x.e.UniqueId}_inputRename(v){return v}_outputRename(v){return v}isAnAncestorOf(v){for(const d of this._outputs)if(d.hasEndpoints)for(const Q of d.endpoints){if(Q.ownerBlock===v)return!0;if(Q.ownerBlock.isAnAncestorOf(v))return!0}return!1}isAnAncestorOfType(v){if(this.getClassName()===v)return!0;for(const d of this._outputs)if(d.hasEndpoints)for(const Q of d.endpoints)if(Q.ownerBlock.isAnAncestorOfType(v))return!0;return!1}getInputByName(v){const d=this._inputs.filter((d=>d.name===v));return d.length?d[0]:null}_linkConnectionTypes(v,d){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[d]._acceptedConnectionPointType=this._inputs[v]:(this._inputs[v]._linkedConnectionSource=this._inputs[d],this._inputs[v]._isMainLinkSource=!0),this._inputs[d]._linkedConnectionSource=this._inputs[v]}registerInput(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;const e=new Id(v,this,0);return e.type=d,e.isOptional=Q,e.defaultValue=n,e.value=n,e.valueMin=T,e.valueMax=L,this._inputs.push(e),this.onInputChangedObservable.notifyObservers(e),this}registerOutput(v,d,Q){return(Q=Q??new Id(v,this,1)).type=d,this._outputs.push(Q),this}_build(v){}_customBuildStep(v){}build(v){if(this._buildId===v.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((v=>v.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=v.buildId;for(const d of this._inputs){if(!d.connectedPoint){d.isOptional||v.notConnectedNonOptionalInputs.push(d);continue}const Q=d.connectedPoint.ownerBlock;Q&&Q!==this&&!Q.isSystem&&Q.build(v)}return this._customBuildStep(v),v.verbose&&k.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(v),this.onBuildObservable.notifyObservers(this),!1}serialize(){const v={};v.customType="BABYLON."+this.getClassName(),v.id=this.uniqueId,v.name=this.name,v.visibleOnFrame=this.visibleOnFrame,v.inputs=[],v.outputs=[];for(const d of this.inputs)v.inputs.push(d.serialize());for(const d of this.outputs)v.outputs.push(d.serialize(!1));return v}_deserialize(v){this._name=v.name,this.comments=v.comments,this.visibleOnFrame=!!v.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(v)}_deserializePortDisplayNamesAndExposedOnFrame(v){const d=v.inputs,Q=v.outputs;if(d)for(const n of d){const v=this.inputs.find((v=>v.name===n.name));if(!v)return;if(n.displayName&&(v.displayName=n.displayName),n.isExposedOnFrame&&(v.isExposedOnFrame=n.isExposedOnFrame,v.exposedPortPosition=n.exposedPortPosition),void 0!==n.value&&null!==n.value)if("number"===n.valueType)v.value=n.value;else{const d=(0,F.e)(n.valueType);d&&(v.value=d.dk(n.value))}}if(Q)for(let n=0;n<Q.length;n++){const v=Q[n];v.displayName&&(this.outputs[n].displayName=v.displayName),v.isExposedOnFrame&&(this.outputs[n].isExposedOnFrame=v.isExposedOnFrame,this.outputs[n].exposedPortPosition=v.exposedPortPosition)}}clone(){const v=this.serialize(),d=(0,F.e)(v.customType);if(d){const Q=new d;return Q._deserialize(v),Q}return null}dispose(){this.kk.notifyObservers(this),this.kk.clear();for(const v of this.inputs)v.dispose();for(const v of this.outputs)v.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function cd(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",n=arguments.length>3?arguments[3]:void 0;return(T,L)=>{let e=T._propStore;e||(e=[],T._propStore=e),e.push({propertyName:L,displayName:v,type:d,groupName:Q,options:n??{},className:T.getClassName()})}}(0,D.b)([(0,i.F)("comment")],Ud.prototype,"comments",void 0),function(v){v[v.Boolean=0]="Boolean",v[v.Float=1]="Float",v[v.Int=2]="Int",v[v.Vector2=3]="Vector2",v[v.List=4]="List",v[v.xk=5]="xk",v[v.SamplingMode=6]="SamplingMode",v[v.TextureFormat=7]="TextureFormat",v[v.TextureType=8]="TextureType"}(Wd||(Wd={})),function(v){v[v.None=0]="None",v[v.Position=1]="Position",v[v.Direction=2]="Direction",v[v.Age=3]="Age",v[v.Lifetime=4]="Lifetime",v[v.Color=5]="Color",v[v.ScaledDirection=6]="ScaledDirection",v[v.Scale=7]="Scale",v[v.AgeGradient=8]="AgeGradient",v[v.Angle=9]="Angle",v[v.SpriteCellIndex=16]="SpriteCellIndex",v[v.SpriteCellStart=17]="SpriteCellStart",v[v.SpriteCellEnd=18]="SpriteCellEnd"}(qd||(qd={})),function(v){v[v.None=0]="None",v[v.Time=1]="Time",v[v.Delta=2]="Delta",v[v.Emitter=3]="Emitter"}(bd||(bd={}));class wd{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let v="";for(const d of this.notConnectedNonOptionalInputs)v+=`input ${d.name} from block ${d.ownerBlock.name}[${d.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(v)throw"Build of Node Particle System Set failed:\n"+v}adapt(v,d){const Q=v.getConnectedValue(this)||0;if(v.type===d)return Q;switch(d){case kd.Vector2:return new n.i(Q,Q);case kd.fk:return new n.j(Q,Q,Q);case kd.xk:return new e.f(Q,Q,Q,Q)}return null}getContextualValue(v){if(!this.particleContext||!this.systemContext)return null;switch(v){case qd.Position:return this.particleContext.position;case qd.Direction:return this.particleContext.direction;case qd.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case qd.Color:return this.particleContext.color;case qd.Age:return this.particleContext.age;case qd.Lifetime:return this.particleContext.lifeTime;case qd.Angle:return this.particleContext.angle;case qd.Scale:return this.particleContext.scale;case qd.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case qd.SpriteCellEnd:return this.systemContext.endSpriteCellID;case qd.SpriteCellIndex:return this.particleContext.cellIndex;case qd.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(v){if(!this.particleContext||!this.systemContext)return null;switch(v){case bd.Time:return this.systemContext._actualFrame;case bd.Delta:return this.systemContext._scaledUpdateSpeed;case bd.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function Gd(v,d,Q){const n=new wd;n.yd=d;const T=v.createSystem(n);return T.canStart=()=>!0,T.j=Q.clone(),T.disposeOnStop=!0,T.start(),T}class Ed extends Ud{constructor(v){super(v),this.blendMode=r.BLENDMODE_ONEONE,this.Nb=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",kd.Particle),this.registerInput("texture",kd.Texture),this.registerInput("onStart",kd.System,!0),this.registerInput("onEnd",kd.System,!0),this.registerOutput("system",kd.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(v){v.Nb=this.Nb,v.buildId=this._buildId++,this.build(v);const d=this.particle.getConnectedValue(v);return d.particleTexture=this.texture.getConnectedValue(v),d.emitRate=this.emitRate,d.blendMode=this.blendMode,d.name=this.name,d._nodeGenerated=!0,d._targetStopDuration=this.targetStopDuration,d.startDelay=this.startDelay,this.system._storedValue=this,d.canStart=()=>!this.doNoStart,d.onStartedObservable.add((Q=>{const n=this.onStart.getConnectedValue(v);n&&Q.onStartedObservable.addOnce((()=>{v.systemContext=d;const Q=Gd(n,v.yd,v.emitterPosition);this.kk.addOnce((()=>{Q.dispose()}))}));const T=this.onEnd.getConnectedValue(v);T&&Q.onStoppedObservable.addOnce((()=>{v.systemContext=d;const Q=Gd(T,v.yd,v.emitterPosition);this.kk.addOnce((()=>{Q.dispose()}))}))})),this.kk.addOnce((()=>{d.dispose()})),d}serialize(){const v=super.serialize();return v.Nb=this.Nb,v.emitRate=this.emitRate,v.blendMode=this.blendMode,v.doNoStart=this.doNoStart,v.targetStopDuration=this.targetStopDuration,v.startDelay=this.startDelay,v}_deserialize(v){super._deserialize(v),this.Nb=v.Nb,this.emitRate=v.emitRate,this.doNoStart=!!v.doNoStart,void 0!==v.blendMode&&(this.blendMode=v.blendMode),void 0!==v.targetStopDuration&&(this.targetStopDuration=v.targetStopDuration),void 0!==v.startDelay&&(this.startDelay=v.startDelay)}}(0,D.b)([cd("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:r.BLENDMODE_ONEONE},{label:"Standard",value:r.BLENDMODE_STANDARD},{label:"Add",value:r.BLENDMODE_ADD},{label:"Multiply",value:r.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:r.BLENDMODE_MULTIPLYADD}]})],Ed.prototype,"blendMode",void 0),(0,D.b)([cd("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Ed.prototype,"Nb",void 0),(0,D.b)([cd("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ed.prototype,"emitRate",void 0),(0,D.b)([cd("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ed.prototype,"targetStopDuration",void 0),(0,D.b)([cd("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ed.prototype,"startDelay",void 0),(0,D.b)([cd("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ed.prototype,"doNoStart",void 0),(0,F.f)("BABYLON.SystemBlock",Ed);class Nd extends Ud{get type(){if(this._type===kd.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=kd.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=kd.Vector2,this._type;case"fk":return this._type=kd.fk,this._type;case"xk":return this._type=kd.xk,this._type;case"Matrix":return this._type=kd.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===qd.None&&this._systemSource!==bd.None}get systemSource(){return this._systemSource}set systemSource(v){if(this._systemSource=v,v!==bd.None){switch(this._contextualSource=qd.None,this._type=kd.Float,v){case bd.Time:case bd.Delta:this._type=kd.Float;break;case bd.Emitter:this._type=kd.fk}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==qd.None}get contextualValue(){return this._contextualSource}set contextualValue(v){if(this._contextualSource=v,v!==qd.None){switch(this._systemSource=bd.None,v){case qd.Scale:this._type=kd.Vector2;break;case qd.Position:case qd.Direction:case qd.ScaledDirection:this._type=kd.fk;break;case qd.Color:this._type=kd.xk;break;case qd.Age:case qd.Lifetime:case qd.Angle:case qd.AgeGradient:this._type=kd.Float;break;case qd.SpriteCellEnd:case qd.SpriteCellStart:case qd.SpriteCellIndex:this._type=kd.Int}this.output&&(this.output.type=this._type)}}constructor(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kd.AutoDetect;super(v),this._type=kd.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new G.e,this._systemSource=bd.None,this._contextualSource=qd.None,this._type=d,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",d)}get value(){return this._storedValue}set value(v){this.type===kd.Float&&this.min!==this.max&&(v=Math.max(this.min,v),v=Math.min(this.max,v)),this._storedValue=v,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(v){this._valueCallback=v}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case kd.Int:case kd.Float:this.value=0;break;case kd.Vector2:this.value=n.i.Zero();break;case kd.fk:this.value=n.j.Zero();break;case kd.xk:this.value=new e.f(1,1,1,1);break;case kd.Matrix:this.value=n.b.Identity()}}_build(v){super._build(v),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=v=>v.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=v=>v.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const v=super.serialize();return v.type=this.type,v.contextualValue=this.contextualValue,v.systemSource=this.systemSource,v.min=this.min,v.max=this.max,v.groupInInspector=this.groupInInspector,v.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.mk?(v.valueType="BABYLON."+this._storedValue.getClassName(),v.value=this._storedValue.mk()):(v.valueType="number",v.value=this._storedValue)),v}_deserialize(v){if(super._deserialize(v),this._type=v.type,this.contextualValue=v.contextualValue,this.systemSource=v.systemSource||bd.None,this.min=v.min||0,this.max=v.max||0,this.groupInInspector=v.groupInInspector||"",void 0!==v.displayInInspector&&(this.displayInInspector=v.displayInInspector),v.valueType)if("number"===v.valueType)this._storedValue=v.value;else{const d=(0,F.e)(v.valueType);d&&(this._storedValue=d.dk(v.value))}}}(0,F.f)("BABYLON.ParticleInputBlock",Nd);class ld extends Ud{get url(){return this._url}set url(v){this._url!==v&&(this._cachedData=null,this._url=v,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(v){this._textureDataUrl!==v&&(this._cachedData=null,this._textureDataUrl=v,this._url="",this._sourceTexture=null)}set sourceTexture(v){this._sourceTexture!==v&&(this._cachedData=null,this._sourceTexture=v,this._url="",this._textureDataUrl="")}constructor(v){super(v),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",kd.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const v=this.texture._storedValue;return await new Promise(((d,Q)=>{if(!v.isReady())return void v.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),d(this._cachedData)}catch(v){Q(v)}}));const n=v.getSize();Dd.j.GetTextureDataAsync(v,n.width,n.height).then((Q=>{this._cachedData={width:n.width,height:n.height,data:new Uint8ClampedArray(Q)},v.dispose(),d(this._cachedData)})).catch(Q)}))}_build(v){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new j.e(this._textureDataUrl,v.yd):this.texture._storedValue=new j.e(this._url,v.yd):this.texture._storedValue=null}serialize(){const v=super.serialize();return v.url=this.url,v.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(v.textureDataUrl=this.textureDataUrl),v}_deserialize(v){super._deserialize(v),this.url=v.url,this.serializedCachedData=!!v.serializedCachedData,v.textureDataUrl&&(this.textureDataUrl=v.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,F.f)("BABYLON.ParticleTextureSourceBlock",ld);class vQ extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("position",kd.fk),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(v){const d=this.particle.getConnectedValue(v);if(this.output._storedValue=d,!this.position.isConnected)return;const Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.position.p(this.position.getConnectedValue(v))},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q}}(0,F.f)("BABYLON.UpdatePositionBlock",vQ),function(v){v[v.Add=0]="Add",v[v.Subtract=1]="Subtract",v[v.Multiply=2]="Multiply",v[v.Divide=3]="Divide",v[v.Max=4]="Max",v[v.Min=5]="Min"}(Hd||(Hd={}));class dQ extends Ud{constructor(v){super(v),this.operation=Hd.Add,this.registerInput("left",kd.AutoDetect),this.registerInput("right",kd.AutoDetect),this.registerOutput("output",kd.BasedOnInput),this.output._typeConnectionSource=this.left;const d=[kd.Matrix,kd.Particle,kd.Texture,kd.System,kd.FloatGradient,kd.Color4Gradient,kd.Vector2Gradient,kd.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...d),this.right.excludedConnectionPointTypes.push(...d),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(v){let d;const Q=this.left,T=this.right;if(!Q.isConnected||!T.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const L=Q.type===kd.Float||Q.type===kd.Int,F=T.type===kd.Float||T.type===kd.Int,r=L&&F;switch(this.operation){case Hd.Add:d=r?v=>Q.getConnectedValue(v)+T.getConnectedValue(v):L?v=>v.adapt(Q,T.type).add(T.getConnectedValue(v)):v=>Q.getConnectedValue(v).add(v.adapt(T,Q.type));break;case Hd.Subtract:d=r?v=>Q.getConnectedValue(v)-T.getConnectedValue(v):L?v=>v.adapt(Q,T.type).Wd(T.getConnectedValue(v)):v=>Q.getConnectedValue(v).Wd(v.adapt(T,Q.type));break;case Hd.Multiply:d=r?v=>Q.getConnectedValue(v)*T.getConnectedValue(v):L?v=>v.adapt(Q,T.type).multiply(T.getConnectedValue(v)):v=>Q.getConnectedValue(v).multiply(v.adapt(T,Q.type));break;case Hd.Divide:d=r?v=>Q.getConnectedValue(v)/T.getConnectedValue(v):L?v=>v.adapt(Q,T.type).divide(T.getConnectedValue(v)):v=>Q.getConnectedValue(v).divide(v.adapt(T,Q.type));break;case Hd.Min:if(r)d=v=>Math.min(Q.getConnectedValue(v),T.getConnectedValue(v));else{const[v,F]=L?[T,Q]:[Q,T];switch(v.type){case kd.Vector2:d=d=>n.i.Minimize(v.getConnectedValue(d),d.adapt(F,v.type));break;case kd.fk:d=d=>n.j.Minimize(v.getConnectedValue(d),d.adapt(F,v.type));break;case kd.xk:d=d=>{const Q=v.getConnectedValue(d),{r:n,g:T,b:L,a:r}=d.adapt(F,v.type);return new e.f(Math.min(Q.r,n),Math.min(Q.g,T),Math.min(Q.b,L),Math.min(Q.a,r))}}}break;case Hd.Max:if(!r){const[v,F]=L?[T,Q]:[Q,T];switch(v.type){case kd.Vector2:d=d=>n.i.Maximize(v.getConnectedValue(d),d.adapt(F,v.type));break;case kd.fk:d=d=>n.j.Maximize(v.getConnectedValue(d),d.adapt(F,v.type));break;case kd.xk:d=d=>{const Q=v.getConnectedValue(d),{r:n,g:T,b:L,a:r}=d.adapt(F,v.type);return new e.f(Math.max(Q.r,n),Math.min(Q.g,T),Math.min(Q.b,L),Math.min(Q.a,r))}}break}d=v=>Math.max(Q.getConnectedValue(v),T.getConnectedValue(v))}this.output._storedFunction=v=>Q.type===kd.Int?0|d(v):d(v)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===kd.Int||this.left.type===kd.Float&&this.right.type!==kd.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[v,d]of[[this.left,this.right],[this.right,this.left]])v.acceptedConnectionPointTypes=[kd.Int,kd.Float],d.isConnected&&(v.acceptedConnectionPointTypes.push(d.type),d.type!==kd.Int&&d.type!==kd.Float||v.acceptedConnectionPointTypes.push(kd.Vector2,kd.fk,kd.xk))}dispose(){super.dispose();for(const v of this._connectionObservers)v.remove();this._connectionObservers.length=0}serialize(){const v=super.serialize();return v.operation=this.operation,v}_deserialize(v){super._deserialize(v),this.operation=v.operation}}(0,D.b)([cd("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Hd.Add},{label:"Subtract",value:Hd.Subtract},{label:"Multiply",value:Hd.Multiply},{label:"Divide",value:Hd.Divide},{label:"Max",value:Hd.Max},{label:"Min",value:Hd.Min}]})],dQ.prototype,"operation",void 0),(0,F.f)("BABYLON.ParticleMathBlock",dQ);class QQ extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("direction1",kd.fk,!0,new n.j(0,1,0)),this.registerInput("direction2",kd.fk,!0,new n.j(0,1,0)),this.registerInput("minEmitBox",kd.fk,!0,new n.j(-.5,-.5,-.5)),this.registerInput("maxEmitBox",kd.fk,!0,new n.j(.5,.5,.5)),this.registerOutput("output",kd.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(v){const d=this.particle.getConnectedValue(v);d._directionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.direction1.getConnectedValue(v),L=this.direction2.getConnectedValue(v),e=(0,C.RandomRange)(T.x,L.x),F=(0,C.RandomRange)(T.y,L.y),r=(0,C.RandomRange)(T.z,L.z);v.isEmitterTransformNode?n.j.TransformNormalFromFloatsToRef(e,F,r,v.emitterWorldMatrix,Q.direction):Q.direction.ld(e,F,r)},d._positionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.minEmitBox.getConnectedValue(v),L=this.maxEmitBox.getConnectedValue(v),e=(0,C.RandomRange)(T.x,L.x),F=(0,C.RandomRange)(T.y,L.y),r=(0,C.RandomRange)(T.z,L.z);v.isEmitterTransformNode?n.j.TransformCoordinatesFromFloatsToRef(e,F,r,v.emitterWorldMatrix,Q.position):(Q.position.ld(e,F,r),Q.position.addInPlace(v.emitterPosition))},this.output._storedValue=d}}(0,F.f)("BABYLON.BoxShapeBlock",QQ);class nQ extends Ud{constructor(v){super(v),this.registerInput("emitPower",kd.Float,!0,1),this.registerInput("lifeTime",kd.Float,!0,1),this.registerInput("color",kd.xk,!0,new e.f(1,1,1,1)),this.registerInput("scale",kd.Vector2,!0,new n.i(1,1)),this.registerInput("angle",kd.Float,!0,0),this.registerOutput("particle",kd.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(v){const d=new Fd(this.name,v.Nb,v.yd,null,!1,void 0,!0);d.particleEmitterType=new h,d._lifeTimeCreation.process=(d,Q)=>{v.particleContext=d,d.lifeTime=this.lifeTime.getConnectedValue(v),Q._emitPower=this.emitPower.getConnectedValue(v)},d._colorCreation.process=d=>{v.particleContext=d,d.color.p(this.color.getConnectedValue(v))},d._sizeCreation.process=d=>{v.particleContext=d,d.size=1,d.scale.p(this.scale.getConnectedValue(v))},d._angleCreation.process=d=>{v.particleContext=d,d.angle=this.angle.getConnectedValue(v)},this.particle._storedValue=d}}(0,F.f)("BABYLON.CreateParticleBlock",nQ);class TQ{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const v=[];for(const d of this.attachedBlocks)d.isInput&&v.push(d);return v}constructor(v){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new G.e,this.name=v}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(v){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(v)&&this.attachedBlocks.push(v);for(const Q of v.inputs){const n=Q.connectedPoint;if(n){const Q=n.ownerBlock;Q!==v&&this._initializeBlock(Q,d)}}}async buildAsync(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((Q=>{const n=new Jd;for(const v of this._systemBlocks)this._initializeBlock(v);for(const T of this.systemBlocks){const Q=new wd;Q.buildId=this._buildId++,Q.yd=v,Q.verbose=d;const L=T.createSystem(Q);Q.emitErrors(),n.systems.push(L)}this.onBuildObservable.notifyObservers(this),Q(n)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const v=new Ed("Particle system"),d=new vQ("Update position");d.output.connectTo(v.particle);const Q=new Nd("Position");Q.contextualValue=qd.Position;const n=new Nd("Scaled direction");n.contextualValue=qd.ScaledDirection;const T=new dQ("Add");T.operation=Hd.Add,Q.output.connectTo(T.left),n.output.connectTo(T.right),T.output.connectTo(d.position);const L=new nQ("Create particle"),e=new QQ("Box shape");L.particle.connectTo(e.particle),e.output.connectTo(d.particle);const F=new ld("Texture");F.texture.connectTo(v.texture),F.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(v)}removeBlock(v){const d=this.attachedBlocks.indexOf(v);if(d>-1&&this.attachedBlocks.splice(d,1),v.isSystem){const d=this._systemBlocks.indexOf(v);d>-1&&this._systemBlocks.splice(d,1)}}parseSerializedObject(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d||this.clear();const Q={};for(const n of v.Uk){const v=(0,F.e)(n.customType);if(v){const d=new v;d._deserialize(n),Q[n.id]=d,this.attachedBlocks.push(d),d.isSystem&&this._systemBlocks.push(d)}}for(const n of this.attachedBlocks)if(n.isTeleportOut){const v=n,d=v._tempEntryPointUniqueId;if(d){const n=Q[d];n&&n.attachToEndpoint(v)}}for(let n=0;n<v.Uk.length;n++){const T=v.Uk[n],L=Q[T.id];L&&(L.inputs.length&&T.inputs.some((v=>v.targetConnectionName))&&!d||this._restoreConnections(L,v,Q))}if(v.locations||v.editorData&&v.editorData.locations){const n=v.locations||v.editorData.locations;for(const v of n)Q[v.blockId]&&(v.blockId=Q[v.blockId].uniqueId);d&&this.editorData&&this.editorData.locations&&n.concat(this.editorData.locations),v.locations?this.editorData={locations:n}:(this.editorData=v.editorData,this.editorData.locations=n);const T=[];for(const v in Q)T[v]=Q[v].uniqueId;this.editorData.map=T}this.comment=v.comment}_restoreConnections(v,d,Q){for(const n of v.outputs)for(const T of d.Uk){const L=Q[T.id];if(L)for(const e of T.inputs)if(Q[e.targetBlockId]!==v||e.targetConnectionName!==n.name);else{const v=L.getInputByName(e.inputName);if(!v||v.isConnected)continue;n.connectTo(v,!0),this._restoreConnections(L,d,Q)}}}serialize(v){const d=v?{}:Z.e.Serialize(this);d.editorData=JSON.parse(JSON.stringify(this.editorData));let Q=[];v?Q=v:d.customType="BABYLON.NodeParticleSystemSet",d.Uk=[];for(const n of Q)d.Uk.push(n.serialize());if(!v)for(const n of this.attachedBlocks)-1===Q.indexOf(n)&&d.Uk.push(n.serialize());return d}dispose(){for(const v of this.attachedBlocks)v.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(v){const d=new TQ(v);return d.setToDefault(),d}static Parse(v){const d=Z.e.Parse((()=>new TQ(v.name)),v,null);return d.parseSerializedObject(v),d}static ParseFromSnippetAsync(v,d){return"_BLANK"===v?Promise.resolve(TQ.CreateDefault("blank")):new Promise(((Q,n)=>{const T=new Kd.b;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const e=JSON.parse(JSON.parse(T.responseText).jsonPayload),F=JSON.parse(e.nodeParticle);d||(d=Z.e.Parse((()=>new TQ(v)),F,null)),d.parseSerializedObject(F),d.snippetId=v;try{Q(d)}catch(L){n(L)}}else n("Unable to load the snippet "+v)})),T.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),T.send()}))}}TQ.EditorURL=`${fd.e._DefaultCdnUrl}/v${cv.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,TQ.SnippetUrl="https://snippet.babylonjs.com",(0,D.b)([(0,i.F)()],TQ.prototype,"name",void 0),(0,D.b)([(0,i.F)("comment")],TQ.prototype,"comment",void 0),function(v){v[v.None=0]="None",v[v.PerParticle=1]="PerParticle",v[v.PerSystem=2]="PerSystem"}(sd||(sd={}));class LQ extends Ud{constructor(v){super(v),this._currentLockId=-2,this.lockMode=sd.PerParticle,this.registerInput("min",kd.AutoDetect,!0,0),this.registerInput("max",kd.AutoDetect,!0,1),this.registerOutput("output",kd.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kd.Float|kd.Int|kd.Vector2|kd.fk|kd.xk),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(kd.Float|kd.Int|kd.Vector2|kd.fk|kd.xk),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=kd.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let v=null;switch(this._currentLockId=-2,this.min.type){case kd.AutoDetect:case kd.Int:case kd.Float:v=v=>{const d=this.min.getConnectedValue(v)||0,Q=this.max.getConnectedValue(v)||1;return d+Math.random()*(Q-d)};break;case kd.Vector2:v=v=>{const d=this.min.getConnectedValue(v)||n.i.Zero(),Q=this.max.getConnectedValue(v)||n.i.One();return new n.i(d.x+Math.random()*(Q.x-d.x),d.y+Math.random()*(Q.y-d.y))};break;case kd.fk:v=v=>{const d=this.min.getConnectedValue(v)||n.j.Zero(),Q=this.max.getConnectedValue(v)||n.j.One();return new n.j(d.x+Math.random()*(Q.x-d.x),d.y+Math.random()*(Q.y-d.y),d.z+Math.random()*(Q.z-d.z))};break;case kd.xk:v=v=>{const d=this.min.getConnectedValue(v)||new e.f(0,0,0,0),Q=this.max.getConnectedValue(v)||new e.f(1,1,1,1);return new e.f(d.x+Math.random()*(Q.x-d.x),d.y+Math.random()*(Q.y-d.y),d.z+Math.random()*(Q.z-d.z),d.w+Math.random()*(Q.w-d.w))}}this.output._storedFunction=d=>{var Q;let n=0;switch(this.lockMode){case sd.PerParticle:n=(null===(Q=d.particleContext)||void 0===Q?void 0:Q.id)||-1;break;case sd.PerSystem:n=d.buildId||0}return this._currentLockId!==n&&(this.lockMode!==sd.None&&(this._currentLockId=n),this.output._storedValue=v(d)),this.output._storedValue}}serialize(){const v=super.serialize();return v.lockMode=this.lockMode,v}_deserialize(v){super._deserialize(v),this.lockMode=v.lockMode}}(0,D.b)([cd("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:sd.None},{label:"Per particle",value:sd.PerParticle},{label:"Per system",value:sd.PerSystem}]})],LQ.prototype,"lockMode",void 0),(0,F.f)("BABYLON.ParticleRandomBlock",LQ);class eQ extends Ud{constructor(v){super(v),this._currentLockId=-2,this.lockMode=sd.PerParticle,this.registerInput("min",kd.AutoDetect),this.registerInput("max",kd.AutoDetect),this.registerOutput("output",kd.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const d=[kd.Matrix,kd.Particle,kd.Texture,kd.System,kd.FloatGradient,kd.Color4Gradient,kd.Vector2Gradient,kd.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...d),this.max.excludedConnectionPointTypes.push(...d)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let v=null;switch(this._currentLockId=-2,this.min.type){case kd.Float:case kd.Int:v=v=>{const d=this.min.getConnectedValue(v),Q=this.max.getConnectedValue(v);return Math.random()*(Q-d)+d};break;case kd.Vector2:v=v=>{const d=this.min.getConnectedValue(v),Q=this.max.getConnectedValue(v);return new n.i(Math.random()*(Q.x-d.x)+d.x,Math.random()*(Q.y-d.y)+d.y)};break;case kd.fk:v=v=>{const d=this.min.getConnectedValue(v),Q=this.max.getConnectedValue(v);return new n.j(Math.random()*(Q.x-d.x)+d.x,Math.random()*(Q.y-d.y)+d.y,Math.random()*(Q.z-d.z)+d.z)};break;case kd.xk:v=v=>{const d=this.min.getConnectedValue(v),Q=this.max.getConnectedValue(v);return new e.f(Math.random()*(Q.r-d.r)+d.r,Math.random()*(Q.g-d.g)+d.g,Math.random()*(Q.b-d.b)+d.b,Math.random()*(Q.a-d.a)+d.a)}}this.output._storedFunction=d=>{var Q;let n=0;switch(this.lockMode){case sd.PerParticle:n=(null===(Q=d.particleContext)||void 0===Q?void 0:Q.id)||-1;break;case sd.PerSystem:n=d.buildId||0}return this._currentLockId!==n&&(this.lockMode!==sd.None&&(this._currentLockId=n),this.output._storedValue=v(d)),this.output._storedValue}}serialize(){const v=super.serialize();return v.lockMode=this.lockMode,v}_deserialize(v){super._deserialize(v),void 0!==v.lockMode&&(this.lockMode=v.lockMode)}}(0,D.b)([cd("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:sd.None},{label:"Per particle",value:sd.PerParticle},{label:"Per system",value:sd.PerSystem}]})],eQ.prototype,"lockMode",void 0),(0,F.f)("BABYLON.RandomRangeBlock",eQ);(0,F.f)("BABYLON.ParticleLerpBlock",class extends Ud{constructor(v){super(v),this.registerInput("left",kd.AutoDetect),this.registerInput("right",kd.AutoDetect),this.registerInput("gradient",kd.Float,!0,0,0,1),this.registerOutput("output",kd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kd.Float|kd.Int|kd.Vector2|kd.fk|kd.xk)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const v=(v,d,Q)=>(1-v)*d+v*Q;this.output._storedFunction=d=>{const Q=this.left.getConnectedValue(d),T=this.right.getConnectedValue(d),L=this.gradient.getConnectedValue(d);switch(this.left.type){case kd.Int:case kd.Float:return v(L,Q,T);case kd.Vector2:return new n.i(v(L,Q.x,T.x),v(L,Q.y,T.y));case kd.fk:return new n.j(v(L,Q.x,T.x),v(L,Q.y,T.y),v(L,Q.z,T.z));case kd.xk:return new e.f(v(L,Q.r,T.r),v(L,Q.g,T.g),v(L,Q.b,T.b),v(L,Q.a,T.a))}return 0}}});(0,F.f)("BABYLON.UpdateDirectionBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("direction",kd.fk),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(v){const d=this.particle.getConnectedValue(v);if(this.output._storedValue=d,!this.direction.isConnected)return;const Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.direction.p(this.direction.getConnectedValue(v))},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q}});(0,F.f)("BABYLON.UpdateColorBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("color",kd.xk),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(v){const d=this.particle.getConnectedValue(v);if(this.output._storedValue=d,!this.color.isConnected)return;const Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.color.p(this.color.getConnectedValue(v))},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q}});(0,F.f)("BABYLON.UpdateScaleBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("scale",kd.Vector2),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(v){const d=this.particle.getConnectedValue(v);if(this.output._storedValue=d,!this.scale.isConnected)return;const Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.scale.p(this.scale.getConnectedValue(v))},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q}});(0,F.f)("BABYLON.UpdateAngleBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("angle",kd.Float),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(v){const d=this.particle.getConnectedValue(v);if(this.output._storedValue=d,!this.angle.isConnected)return;const Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.angle=this.angle.getConnectedValue(v)},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q}});(0,F.f)("BABYLON.BasicPositionUpdateBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(v){const d=this.particle.getConnectedValue(v),Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.direction.scaleToRef(d._directionScale,d._scaledDirection),Q.position.addInPlace(d._scaledDirection)},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q,this.output._storedValue=d}});(0,F.f)("BABYLON.BasicSpriteUpdateBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(v){const d=this.particle.getConnectedValue(v),Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.updateCellIndex()},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q,this.output._storedValue=d}});(0,F.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("cellIndex",kd.Int),this.registerOutput("output",kd.Particle),this.cellIndex.acceptedConnectionPointTypes=[kd.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(v){const d=this.particle.getConnectedValue(v);if(this.output._storedValue=d,!this.cellIndex.isConnected)return;const Q={process:Q=>{v.particleContext=Q,v.systemContext=d,Q.cellIndex=Math.floor(this.cellIndex.getConnectedValue(v))},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q}});class FQ extends Ud{constructor(v){super(v),this.strength=1,this.registerInput("particle",kd.Particle),this.registerInput("flowMap",kd.Texture),this.registerOutput("output",kd.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(v){var d;const Q=this.particle.getConnectedValue(v),n=v.yd;let T;(null===(d=this.flowMap.connectedPoint)||void 0===d?void 0:d.ownerBlock).extractTextureContentAsync().then((v=>{v&&(T=new xd(v.width,v.height,v.data))}));const L={process:v=>{const d=n.getTransformMatrix();T&&T._processParticle(v,this.strength*Q._tempScaledUpdateSpeed,d)},previousItem:null,nextItem:null};Q._updateQueueStart?bv(L,Q._updateQueueStart):Q._updateQueueStart=L,this.output._storedValue=Q}serialize(){const v=super.serialize();return v.strength=this.strength,v}_deserialize(v){super._deserialize(v),this.strength=v.strength}}(0,D.b)([cd("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FQ.prototype,"strength",void 0),(0,F.f)("BABYLON.UpdateFlowMapBlock",FQ);(0,F.f)("BABYLON.SphereShapeBlock",class extends Ud{constructor(v){super(v),this.registerInput("input",kd.Particle),this.registerInput("radius",kd.Float,!0,1),this.registerInput("radiusRange",kd.Float,!0,1,0,1),this.registerInput("directionRandomizer",kd.Float,!0,0,0,1),this.registerOutput("output",kd.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(v){const d=this.input.getConnectedValue(v);d._directionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.directionRandomizer.getConnectedValue(v),L=Q.position.Wd(v.emitterPosition).normalize(),e=(0,C.RandomRange)(0,T),F=(0,C.RandomRange)(0,T),r=(0,C.RandomRange)(0,T);L.x+=e,L.y+=F,L.z+=r,L.normalize(),v.isEmitterTransformNode?n.j.TransformNormalFromFloatsToRef(e,F,r,v.emitterWorldMatrix,Q.direction):Q.direction.ld(e,F,r)},d._positionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.radius.getConnectedValue(v),L=this.radiusRange.getConnectedValue(v),e=T-(0,C.RandomRange)(0,T*L),F=(0,C.RandomRange)(0,1),r=(0,C.RandomRange)(0,2*Math.PI),u=Math.acos(2*F-1),y=e*Math.cos(r)*Math.sin(u),z=e*Math.cos(u),B=e*Math.sin(r)*Math.sin(u);v.isEmitterTransformNode?n.j.TransformCoordinatesFromFloatsToRef(y,z,B,v.emitterWorldMatrix,Q.position):(Q.position.ld(y,z,B),Q.position.addInPlace(v.emitterPosition))},this.output._storedValue=d}});(0,F.f)("BABYLON.PointShapeBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("direction1",kd.fk,!0,new n.j(0,1,0)),this.registerInput("direction2",kd.fk,!0,new n.j(0,1,0)),this.registerOutput("output",kd.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(v){const d=this.particle.getConnectedValue(v);d._directionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.direction1.getConnectedValue(v),L=this.direction2.getConnectedValue(v),e=(0,C.RandomRange)(T.x,L.x),F=(0,C.RandomRange)(T.y,L.y),r=(0,C.RandomRange)(T.z,L.z);v.isEmitterTransformNode?n.j.TransformNormalFromFloatsToRef(e,F,r,v.emitterWorldMatrix,Q.direction):Q.direction.ld(e,F,r)},d._positionCreation.process=Q=>{v.systemContext=d,v.isEmitterTransformNode?n.j.TransformCoordinatesFromFloatsToRef(0,0,0,v.emitterWorldMatrix,Q.position):Q.position.p(v.emitterPosition)},this.output._storedValue=d}});(0,F.f)("BABYLON.CustomShapeBlock",class extends Ud{constructor(v){super(v),this.registerInput("particle",kd.Particle),this.registerInput("position",kd.fk,!0,new n.j(0,0,0)),this.registerInput("direction",kd.fk,!0,new n.j(0,1,0)),this.registerOutput("output",kd.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(v){const d=this.particle.getConnectedValue(v);d._directionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.direction.getConnectedValue(v);v.isEmitterTransformNode?n.j.TransformNormalToRef(T,v.emitterWorldMatrix,Q.direction):Q.direction.p(T)},d._positionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.position.getConnectedValue(v);v.isEmitterTransformNode?n.j.TransformCoordinatesToRef(T,v.emitterWorldMatrix,Q.position):(Q.position.p(T),Q.position.addInPlace(v.emitterPosition))},this.output._storedValue=d}});(0,F.f)("BABYLON.CylinderShapeBlock",class extends Ud{constructor(v){super(v),this._tempVector=n.j.Zero(),this.registerInput("particle",kd.Particle),this.registerInput("radius",kd.Float,!0,1),this.registerInput("height",kd.Float,!0,1,0),this.registerInput("radiusRange",kd.Float,!0,1,0,1),this.registerInput("directionRandomizer",kd.Float,!0,0,0,1),this.registerOutput("output",kd.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(v){const d=this.particle.getConnectedValue(v);d._directionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.directionRandomizer.getConnectedValue(v);Q.position.subtractToRef(v.emitterPosition,this._tempVector),this._tempVector.normalize(),v.isEmitterTransformNode&&n.j.TransformNormalToRef(this._tempVector,v.emitterInverseWorldMatrix,this._tempVector);const L=(0,C.RandomRange)(-T/2,T/2);let e=Math.atan2(this._tempVector.x,this._tempVector.z);e+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*T,this._tempVector.y=L,this._tempVector.x=Math.sin(e),this._tempVector.z=Math.cos(e),this._tempVector.normalize(),v.isEmitterTransformNode?n.j.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,v.emitterWorldMatrix,Q.direction):Q.direction.p(this._tempVector)},d._positionCreation.process=Q=>{v.particleContext=Q,v.systemContext=d;const T=this.height.getConnectedValue(v),L=this.radiusRange.getConnectedValue(v),e=this.radius.getConnectedValue(v),F=(0,C.RandomRange)(-T/2,T/2),r=(0,C.RandomRange)(0,2*Math.PI),u=(0,C.RandomRange)((1-L)*(1-L),1),y=Math.sqrt(u)*e,z=y*Math.cos(r),B=y*Math.sin(r);v.isEmitterTransformNode?n.j.TransformCoordinatesFromFloatsToRef(z,F,B,v.emitterWorldMatrix,Q.position):(Q.position.ld(z,F,B),Q.position.addInPlace(v.emitterPosition))},this.output._storedValue=d}});class rQ extends Ud{constructor(v){super(v),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",kd.Particle),this.registerOutput("output",kd.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(v){super._build(v);const d=this.particle.getConnectedValue(v);d._isAnimationSheetEnabled=!0,d.spriteCellWidth=this.width,d.spriteCellHeight=this.height,d.startSpriteCellID=this.start,d.endSpriteCellID=this.end,d.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=d}serialize(){const v=super.serialize();return v.width=this.width,v.height=this.height,v.start=this.start,v.end=this.end,v.randomStartCell=this.randomStartCell,v}_deserialize(v){super._deserialize(v),this.width=v.width,this.height=v.height,this.start=v.start,this.end=v.end,this.randomStartCell=v.randomStartCell}}(0,D.b)([cd("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rQ.prototype,"start",void 0),(0,D.b)([cd("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rQ.prototype,"end",void 0),(0,D.b)([cd("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rQ.prototype,"width",void 0),(0,D.b)([cd("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rQ.prototype,"height",void 0),(0,D.b)([cd("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rQ.prototype,"loop",void 0),(0,D.b)([cd("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rQ.prototype,"randomStartCell",void 0),(0,F.f)("BABYLON.SetupSpriteSheetBlock",rQ);class CQ extends Ud{constructor(v){super(v),this.reference=0,this.registerInput("value",kd.AutoDetect),this.registerOutput("output",kd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=v=>{switch(v){case kd.Float:return kd.FloatGradient;case kd.Vector2:return kd.Vector2Gradient;case kd.fk:return kd.Vector3Gradient;case kd.xk:return kd.Color4Gradient}return v},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kd.Float|kd.Vector2|kd.fk|kd.xk)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=v=>null}serialize(){const v=super.serialize();return v.reference=this.reference,v}_deserialize(v){super._deserialize(v),this.reference=v.reference}}(0,D.b)([cd("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],CQ.prototype,"reference",void 0),(0,F.f)("BABYLON.ParticleGradientValueBlock",CQ);(0,F.f)("BABYLON.ParticleGradientBlock",class extends Ud{constructor(v){super(v),this._entryCount=1,this.registerInput("gradient",kd.Float,!0,1,0,1),this.registerInput("value0",kd.AutoDetect),this.registerOutput("output",kd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=v=>{switch(v){case kd.FloatGradient:return kd.Float;case kd.Vector2Gradient:return kd.Vector2;case kd.Vector3Gradient:return kd.fk;case kd.Color4Gradient:return kd.xk}return v},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(kd.FloatGradient|kd.Vector2Gradient|kd.Vector3Gradient|kd.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(v){this._inputs[v].onConnectionObservable.add((()=>{this._entryCount>v||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),kd.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const v=[];for(let Q=1;Q<this._inputs.length;Q++){var d;if(this._inputs[Q].isConnected)v.push(null===(d=this._inputs[Q].connectedPoint)||void 0===d?void 0:d.ownerBlock)}v.sort(((v,d)=>v.reference-d.reference)),this.output._storedFunction=d=>{const Q=this.gradient.getConnectedValue(d);if(1===v.length)return v[0].value.getConnectedValue(d);let T=null;for(let L=v.length-1;L>=0;L--){const F=v[L];if(F.reference<=Q){const v=F.value.getConnectedValue(d);if(T){const L=T.value.getConnectedValue(d),r=T.reference,u=F.reference,y=Math.max(0,Math.min(1,(Q-u)/(r-u)));switch(this.output.type){case kd.Float:return(0,C.Lerp)(v,L,y);case kd.Vector2:return n.i.Lerp(v,L,y);case kd.fk:return n.j.Lerp(v,L,y);case kd.xk:return e.f.Lerp(v,L,y)}}return v}T=F}return 0}}});(0,F.f)("BABYLON.ParticleConverterBlock",class extends Ud{constructor(v){super(v),this.registerInput("color ",kd.xk,!0),this.registerInput("xyz ",kd.fk,!0),this.registerInput("xy ",kd.Vector2,!0),this.registerInput("zw ",kd.Vector2,!0),this.registerInput("x ",kd.Float,!0),this.registerInput("y ",kd.Float,!0),this.registerInput("z ",kd.Float,!0),this.registerInput("w ",kd.Float,!0),this.registerOutput("color",kd.xk),this.registerOutput("xyz",kd.fk),this.registerOutput("xy",kd.Vector2),this.registerOutput("zw",kd.Vector2),this.registerOutput("x",kd.Float),this.registerOutput("y",kd.Float),this.registerOutput("z",kd.Float),this.registerOutput("w",kd.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(v){return"color "===v?"colorIn":"xyz "===v?"xyzIn":"xy "===v?"xyIn":"zw "===v?"zwIn":"x "===v?"xIn":"y "===v?"yIn":"z "===v?"zIn":"w "===v?"wIn":v}_outputRename(v){switch(v){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return v}}_build(v){super._build(v);const d=this.xIn,Q=this.yIn,T=this.zIn,L=this.wIn,F=this.xyIn,r=this.zwIn,C=this.xyzIn,u=this.colorIn,y=this.colorOut,z=this.xyzOut,B=this.xyOut,X=this.zwOut,m=this.xOut,V=this.yOut,h=this.zOut,S=this.wOut,A=v=>{if(u.isConnected)return u.getConnectedValue(v);let n=0,y=0,z=0,B=0;if(d.isConnected&&(n=d.getConnectedValue(v)),Q.isConnected&&(y=Q.getConnectedValue(v)),T.isConnected&&(z=T.getConnectedValue(v)),L.isConnected&&(B=L.getConnectedValue(v)),F.isConnected){const d=F.getConnectedValue(v);d&&(n=d.x,y=d.y)}if(r.isConnected){const d=r.getConnectedValue(v);d&&(z=d.x,B=d.y)}if(C.isConnected){const d=C.getConnectedValue(v);d&&(n=d.x,y=d.y,z=d.z)}return new e.f(n,y,z,B)};y._storedFunction=v=>A(v),z._storedFunction=v=>{const d=A(v);return new n.j(d.r,d.g,d.b)},B._storedFunction=v=>{const d=A(v);return new n.i(d.r,d.g)},X._storedFunction=v=>{const d=A(v);return new n.i(d.b,d.a)},m._storedFunction=v=>A(v).r,V._storedFunction=v=>A(v).g,h._storedFunction=v=>A(v).b,S._storedFunction=v=>A(v).a}}),function(v){v[v.Cos=0]="Cos",v[v.Sin=1]="Sin",v[v.Abs=2]="Abs",v[v.Exp=3]="Exp",v[v.Exp2=4]="Exp2",v[v.Round=5]="Round",v[v.Floor=6]="Floor",v[v.Ceiling=7]="Ceiling",v[v.Sqrt=8]="Sqrt",v[v.Log=9]="Log",v[v.Tan=10]="Tan",v[v.ArcTan=11]="ArcTan",v[v.ArcCos=12]="ArcCos",v[v.ArcSin=13]="ArcSin",v[v.Sign=14]="Sign",v[v.Negate=15]="Negate",v[v.OneMinus=16]="OneMinus",v[v.Reciprocal=17]="Reciprocal",v[v.ToDegrees=18]="ToDegrees",v[v.ToRadians=19]="ToRadians",v[v.Fract=20]="Fract"}(ad||(ad={}));class uQ extends Ud{constructor(v){super(v),this.operation=ad.Cos,this.registerInput("input",kd.AutoDetect),this.registerOutput("output",kd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(kd.Float|kd.Int|kd.Vector2|kd.fk|kd.xk)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(v){super._build(v);let d=null;switch(this.operation){case ad.Cos:d=v=>Math.cos(v);break;case ad.Sin:d=v=>Math.sin(v);break;case ad.Abs:d=v=>Math.abs(v);break;case ad.Exp:d=v=>Math.exp(v);break;case ad.Exp2:d=v=>Math.pow(2,v);break;case ad.Round:d=v=>Math.round(v);break;case ad.Floor:d=v=>Math.floor(v);break;case ad.Ceiling:d=v=>Math.ceil(v);break;case ad.Sqrt:d=v=>Math.sqrt(v);break;case ad.Log:d=v=>Math.log(v);break;case ad.Tan:d=v=>Math.tan(v);break;case ad.ArcTan:d=v=>Math.atan(v);break;case ad.ArcCos:d=v=>Math.acos(v);break;case ad.ArcSin:d=v=>Math.asin(v);break;case ad.Sign:d=v=>Math.sign(v);break;case ad.Negate:d=v=>-v;break;case ad.OneMinus:d=v=>1-v;break;case ad.Reciprocal:d=v=>1/v;break;case ad.ToRadians:d=v=>v*Math.PI/180;break;case ad.ToDegrees:d=v=>180*v/Math.PI;break;case ad.Fract:d=v=>v>=0?v-Math.floor(v):v-Math.ceil(v)}if(!d)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case kd.Int:case kd.Float:this.output._storedFunction=v=>{const Q=this.input.getConnectedValue(v);return d(Q)};break;case kd.Vector2:this.output._storedFunction=v=>{const Q=this.input.getConnectedValue(v);return new n.i(d(Q.x),d(Q.y))};break;case kd.fk:this.output._storedFunction=v=>{const Q=this.input.getConnectedValue(v);return new n.j(d(Q.x),d(Q.y),d(Q.z))};break;case kd.xk:this.output._storedFunction=v=>{const Q=this.input.getConnectedValue(v);return new e.f(d(Q.r),d(Q.g),d(Q.b),d(Q.a))}}return this}serialize(){const v=super.serialize();return v.operation=this.operation,v}_deserialize(v){super._deserialize(v),this.operation=v.operation}}(0,D.b)([cd("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ad.Cos},{label:"Sin",value:ad.Sin},{label:"Abs",value:ad.Abs},{label:"Exp",value:ad.Exp},{label:"Exp2",value:ad.Exp2},{label:"Round",value:ad.Round},{label:"Floor",value:ad.Floor},{label:"Ceiling",value:ad.Ceiling},{label:"Sqrt",value:ad.Sqrt},{label:"Log",value:ad.Log},{label:"Tan",value:ad.Tan},{label:"ArcTan",value:ad.ArcTan},{label:"ArcCos",value:ad.ArcCos},{label:"ArcSin",value:ad.ArcSin},{label:"Sign",value:ad.Sign},{label:"Negate",value:ad.Negate},{label:"OneMinus",value:ad.OneMinus},{label:"Reciprocal",value:ad.Reciprocal},{label:"ToDegrees",value:ad.ToDegrees},{label:"ToRadians",value:ad.ToRadians},{label:"Fract",value:ad.Fract}]})],uQ.prototype,"operation",void 0),(0,F.f)("BABYLON.ParticleTrigonometryBlock",uQ);var yQ,zQ=Q(12582);class BQ extends Ud{constructor(v){super(v),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",kd.AutoDetect),this.registerOutput("output",kd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(kd.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(kd.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(kd.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(kd.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(kd.System),this._inputs[0].excludedConnectionPointTypes.push(kd.Particle),this._inputs[0].excludedConnectionPointTypes.push(kd.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(v){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const d=v=>{const d=this.input.getConnectedValue(v);if(this.log.length>=this.stackSize)return d;if(null===d||void 0===d)return this.log.push(["null",""]),d;switch(this.input.type){case kd.Vector2:this.log.push([(0,zQ.h)(d,4),d.toString()]);break;case kd.fk:this.log.push([(0,zQ.i)(d,4),d.toString()]);break;case kd.xk:this.log.push([`{R: ${d.r.toFixed(4)} G: ${d.g.toFixed(4)} B: ${d.b.toFixed(4)} A: ${d.a.toFixed(4)}}`,d.toString()]);break;default:this.log.push([d.toString(),d.toString()])}return d};this.output.isConnected?this.output._storedFunction=d:this.output._storedValue=d(v)}serialize(){const v=super.serialize();return v.stackSize=this.stackSize,v}_deserialize(v){super._deserialize(v),this.stackSize=v.stackSize}}(0,D.b)([cd("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],BQ.prototype,"stackSize",void 0),(0,F.f)("BABYLON.ParticleDebugBlock",BQ);(0,F.f)("BABYLON.ParticleElbowBlock",class extends Ud{constructor(v){super(v),this.registerInput("input",kd.AutoDetect),this.registerOutput("output",kd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(v){super._build(v);const d=this._outputs[0],Q=this._inputs[0];d._storedFunction=v=>Q.getConnectedValue(v)}});(0,F.f)("BABYLON.ParticleTeleportInBlock",class extends Ud{get endpoints(){return this._endpoints}constructor(v){super(v),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",kd.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(v){if(this.getClassName()===v)return!0;for(const d of this.endpoints)if(d.isAnAncestorOfType(v))return!0;return!1}isAnAncestorOf(v){for(const d of this.endpoints){if(d===v)return!0;if(d.isAnAncestorOf(v))return!0}return!1}attachToEndpoint(v){v.detach(),this._endpoints.push(v),v._entryPoint=this,v._outputs[0]._typeConnectionSource=this._inputs[0],v._tempEntryPointUniqueId=null,v.name="> "+this.name}detachFromEndpoint(v){const d=this._endpoints.indexOf(v);-1!==d&&(this._endpoints.splice(d,1),v._outputs[0]._typeConnectionSource=null,v._entryPoint=null)}_build(){for(const v of this._endpoints)v.output._storedFunction=v=>this.input.getConnectedValue(v)}});(0,F.f)("BABYLON.ParticleTeleportOutBlock",class extends Ud{constructor(v){super(v),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",kd.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(v){this.entryPoint&&this.entryPoint.build(v)}clone(){const v=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(v),v}serialize(){var v;const d=super.serialize();return d.entryPoint=(null===(v=this.entryPoint)||void 0===v?void 0:v.uniqueId)??"",d}_deserialize(v){super._deserialize(v),this._tempEntryPointUniqueId=v.entryPoint}}),function(v){v[v.Equal=0]="Equal",v[v.NotEqual=1]="NotEqual",v[v.LessThan=2]="LessThan",v[v.GreaterThan=3]="GreaterThan",v[v.LessOrEqual=4]="LessOrEqual",v[v.GreaterOrEqual=5]="GreaterOrEqual",v[v.Xor=6]="Xor",v[v.Or=7]="Or",v[v.And=8]="And"}(yQ||(yQ={}));class XQ extends Ud{constructor(v){super(v),this.test=yQ.Equal,this.epsilon=0,this.registerInput("left",kd.Float),this.registerInput("right",kd.Float,!0,0),this.registerInput("ifTrue",kd.AutoDetect,!0,1),this.registerInput("ifFalse",kd.AutoDetect,!0,0),this.registerOutput("output",kd.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=kd.Float,this._inputs[0].acceptedConnectionPointTypes.push(kd.Int),this._inputs[1].acceptedConnectionPointTypes.push(kd.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const v=v=>{const d=this.left.getConnectedValue(v),Q=this.right.getConnectedValue(v);let n=!1;switch(this.test){case yQ.Equal:n=(0,C.WithinEpsilon)(d,Q,this.epsilon);break;case yQ.NotEqual:n=!(0,C.WithinEpsilon)(d,Q,this.epsilon);break;case yQ.LessThan:n=d<Q+this.epsilon;break;case yQ.GreaterThan:n=d>Q-this.epsilon;break;case yQ.LessOrEqual:n=d<=Q+this.epsilon;break;case yQ.GreaterOrEqual:n=d>=Q-this.epsilon;break;case yQ.Xor:n=!!d&&!Q||!d&&!!Q;break;case yQ.Or:n=!!d||!!Q;break;case yQ.And:n=!!d&&!!Q}return n};this.output._storedFunction=d=>v(d)?this.ifTrue.getConnectedValue(d):this.ifFalse.getConnectedValue(d)}serialize(){const v=super.serialize();return v.test=this.test,v.epsilon=this.epsilon,v}_deserialize(v){super._deserialize(v),this.test=v.test,void 0!==v.epsilon&&(this.epsilon=v.epsilon)}}(0,D.b)([cd("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:yQ.Equal},{label:"NotEqual",value:yQ.NotEqual},{label:"LessThan",value:yQ.LessThan},{label:"GreaterThan",value:yQ.GreaterThan},{label:"LessOrEqual",value:yQ.LessOrEqual},{label:"GreaterOrEqual",value:yQ.GreaterOrEqual},{label:"Xor",value:yQ.Xor},{label:"Or",value:yQ.Or},{label:"And",value:yQ.And}]})],XQ.prototype,"test",void 0),(0,D.b)([cd("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],XQ.prototype,"epsilon",void 0),(0,F.f)("BABYLON.ParticleConditionBlock",XQ);class mQ extends Ud{constructor(v){super(v),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",kd.Particle),this.registerInput("condition",kd.Float,!0,0),this.registerInput("system",kd.System),this.registerOutput("output",kd.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(v){this._triggerCount=0;const d=this.input.getConnectedValue(v),Q={process:Q=>{if(v.particleContext=Q,v.systemContext=d,0!==this.condition.getConnectedValue(v)&&(0===this.limit||this._triggerCount<this.limit)){const n=(new Date).getTime();if(this._previousOne&&n-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=n;const T=this.system.getConnectedValue(v);if(T){const n=Gd(T,v.yd,Q.position);n.kk.addOnce((()=>{this._triggerCount--})),d.kk.addOnce((()=>{n.dispose()}))}}},previousItem:null,nextItem:null};d._updateQueueStart?bv(Q,d._updateQueueStart):d._updateQueueStart=Q,this.output._storedValue=d}serialize(){const v=super.serialize();return v.limit=this.limit,v.delay=this.delay,v}_deserialize(v){super._deserialize(v),void 0!==v.limit&&(this.limit=v.limit),void 0!==v.delay&&(this.delay=v.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,D.b)([cd("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mQ.prototype,"limit",void 0),(0,D.b)([cd("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mQ.prototype,"delay",void 0),(0,F.f)("BABYLON.ParticleTriggerBlock",mQ);Q(12590),Q(12603),Q(12613),Q(12677)},12662:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12619:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12698:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneVertex",L="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12686:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12669:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogFragment",L="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12656:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12705:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogVertex",L="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12694:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogVertexDeclaration",L="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12640:(v,d,Q)=>{"use strict";var n=Q(553);const T="helperFunctions",L="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12626:(v,d,Q)=>{"use strict";var n=Q(553);const T="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12649:(v,d,Q)=>{"use strict";var n=Q(553);const T="imageProcessingFunctions",L="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12633:(v,d,Q)=>{"use strict";var n=Q(553);const T="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12667:(v,d,Q)=>{"use strict";var n=Q(553);const T="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12713:(v,d,Q)=>{"use strict";var n=Q(553);const T="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";n.e.IncludesShadersStoreWGSL[T]||(n.e.IncludesShadersStoreWGSL[T]=L)},12613:(v,d,Q)=>{"use strict";Q.r(d),Q.d(d,{particlesPixelShaderWGSL:()=>e});var n=Q(553);Q(12619),Q(12626),Q(12633),Q(12640),Q(12649),Q(12656),Q(12662),Q(12667),Q(12669);const T="particlesPixelShader",L="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";n.e.ShadersStoreWGSL[T]||(n.e.ShadersStoreWGSL[T]=L);const e={name:T,shader:L}},12677:(v,d,Q)=>{"use strict";Q.r(d),Q.d(d,{particlesVertexShaderWGSL:()=>e});var n=Q(553);Q(12686),Q(12694),Q(12633),Q(12698),Q(12705),Q(12713);const T="particlesVertexShader",L="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";n.e.ShadersStoreWGSL[T]||(n.e.ShadersStoreWGSL[T]=L);const e={name:T,shader:L}},12523:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12597:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12542:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneVertex",L="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12605:(v,d,Q)=>{"use strict";var n=Q(553);const T="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12530:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogFragment",L="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12516:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12550:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogVertex",L="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12539:(v,d,Q)=>{"use strict";var n=Q(553);const T="fogVertexDeclaration",L="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12509:(v,d,Q)=>{"use strict";var n=Q(553);const T="helperFunctions",L="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12496:(v,d,Q)=>{"use strict";var n=Q(553);const T="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12511:(v,d,Q)=>{"use strict";var n=Q(553);const T="imageProcessingFunctions",L="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12502:(v,d,Q)=>{"use strict";var n=Q(553);const T="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12528:(v,d,Q)=>{"use strict";var n=Q(553);const T="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12554:(v,d,Q)=>{"use strict";var n=Q(553);const T="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";n.e.IncludesShadersStore[T]||(n.e.IncludesShadersStore[T]=L)},12590:(v,d,Q)=>{"use strict";Q.r(d),Q.d(d,{particlesPixelShader:()=>e});var n=Q(553);Q(12597),Q(12496),Q(12502),Q(12509),Q(12511),Q(12516),Q(12523),Q(12528),Q(12530);const T="particlesPixelShader",L="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";n.e.ShadersStore[T]||(n.e.ShadersStore[T]=L);const e={name:T,shader:L}},12603:(v,d,Q)=>{"use strict";Q.r(d),Q.d(d,{particlesVertexShader:()=>e});var n=Q(553);Q(12605),Q(12539),Q(12502),Q(12542),Q(12550),Q(12554);const T="particlesVertexShader",L="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";n.e.ShadersStore[T]||(n.e.ShadersStore[T]=L);const e={name:T,shader:L}},12970:(v,d,Q)=>{"use strict";Q.r(d),Q.d(d,{FlowGraphGLTFDataProvider:()=>L});var n=Q(12934),T=Q(12908);class L extends n.b{constructor(v){var d,Q;super();const n=v.glTF,L=(null===(d=n.animations)||void 0===d?void 0:d.map((v=>v._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",T.c,L);const e=(null===(Q=n.nodes)||void 0===Q?void 0:Q.map((v=>v._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",T.c,e)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12854:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>V,i:()=>X,j:()=>B,k:()=>m});var n=Q(651),T=Q(11913),L=Q(686),e=Q(12859);const F=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class r{constructor(v,d){this._gltf=v,this._infoTree=d}convert(v){let d,Q=this._gltf,n=this._infoTree;if(!v.startsWith("/"))throw new Error("Path must start with a /");const T=v.split("/");if(T.shift(),T[T.length-1].includes(".length")){const v=T[T.length-1].split(".");T.pop(),T.push(...v)}let L=!1;for(const r of T){const T="length"===r;if(T&&!n.__array__)throw new Error(`Path ${v} is invalid`);if(n.__ignoreObjectTree__&&(L=!0),n.__array__&&!T)n=n.__array__;else if(n=n[r],!n)throw new Error(`Path ${v} is invalid`);if(!L)if(void 0===Q){if(!F.find((d=>d.regex.test(v))))throw new Error(`Path ${v} is invalid`)}else if(!T){var e;Q=null===(e=Q)||void 0===e?void 0:e[r]}(n.__target__||T)&&(d=Q)}return{object:d,info:n}}}function C(v,d,Q,n){const T=u(v,d);return n?T[Q][n]:T[Q]}function u(v,d,Q){var n,L;return null===(n=v._data)||void 0===n||null===(L=n[(null===Q||void 0===Q?void 0:Q.fillMode)??T.e.MATERIAL_TriangleFillMode])||void 0===L?void 0:L.babylonMaterial}function y(v,d){return{offset:{componentsCount:2,type:"Vector2",get:(Q,T,L)=>{const e=C(Q,L,v,d);return new n.i(null===e||void 0===e?void 0:e.uOffset,null===e||void 0===e?void 0:e.vOffset)},getTarget:u,set:(Q,n,T,L)=>{const e=C(n,L,v,d);e.uOffset=Q.x,e.vOffset=Q.y},getPropertyName:[()=>`${v}${d?"."+d:""}.uOffset`,()=>`${v}${d?"."+d:""}.vOffset`]},rotation:{type:"number",get:(Q,n,T)=>{var L;return null===(L=C(Q,T,v,d))||void 0===L?void 0:L.wAng},getTarget:u,set:(Q,n,T,L)=>C(n,L,v,d).wAng=Q,getPropertyName:[()=>`${v}${d?"."+d:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(Q,T,L)=>{const e=C(Q,L,v,d);return new n.i(null===e||void 0===e?void 0:e.uScale,null===e||void 0===e?void 0:e.vScale)},getTarget:u,set:(Q,n,T,L)=>{const e=C(n,L,v,d);e.uScale=Q.x,e.vScale=Q.y},getPropertyName:[()=>`${v}${d?"."+d:""}.uScale`,()=>`${v}${d?"."+d:""}.vScale`]}}}const z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:v=>{var d,Q;return new n.i((null===(d=v._babylonCamera)||void 0===d?void 0:d.orthoLeft)??0,(null===(Q=v._babylonCamera)||void 0===Q?void 0:Q.orthoRight)??0)},set:(v,d)=>{d._babylonCamera&&(d._babylonCamera.orthoLeft=v.x,d._babylonCamera.orthoRight=v.y)},getTarget:v=>v,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:v=>{var d,Q;return new n.i((null===(d=v._babylonCamera)||void 0===d?void 0:d.orthoBottom)??0,(null===(Q=v._babylonCamera)||void 0===Q?void 0:Q.orthoTop)??0)},set:(v,d)=>{d._babylonCamera&&(d._babylonCamera.orthoBottom=v.x,d._babylonCamera.orthoTop=v.y)},getTarget:v=>v,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:v=>{var d;return null===(d=v._babylonCamera)||void 0===d?void 0:d.maxZ},set:(v,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=v)},getTarget:v=>v,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:v=>{var d;return null===(d=v._babylonCamera)||void 0===d?void 0:d.$j},set:(v,d)=>{d._babylonCamera&&(d._babylonCamera.$j=v)},getTarget:v=>v,getPropertyName:[()=>"$j"]}},perspective:{aspectRatio:{type:"number",get:v=>{var d;return null===(d=v._babylonCamera)||void 0===d?void 0:d.getEngine().getAspectRatio(v._babylonCamera)},getTarget:v=>v,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:v=>{var d;return null===(d=v._babylonCamera)||void 0===d?void 0:d.fov},set:(v,d)=>{d._babylonCamera&&(d._babylonCamera.fov=v)},getTarget:v=>v,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:v=>{var d;return null===(d=v._babylonCamera)||void 0===d?void 0:d.maxZ},set:(v,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=v)},getTarget:v=>v,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:v=>{var d;return null===(d=v._babylonCamera)||void 0===d?void 0:d.$j},set:(v,d)=>{d._babylonCamera&&(d._babylonCamera.$j=v)},getTarget:v=>v,getPropertyName:[()=>"$j"]}}}},nodes:{length:{type:"number",get:v=>v.length,getTarget:v=>v.map((v=>v._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"fk",get:v=>{var d;return null===(d=v._babylonTransformNode)||void 0===d?void 0:d.position},set:(v,d)=>{var Q;return null===(Q=d._babylonTransformNode)||void 0===Q?void 0:Q.position.p(v)},getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:v=>{var d;return null===(d=v._babylonTransformNode)||void 0===d?void 0:d.rotationQuaternion},set:(v,d)=>{var Q,n;return null===(Q=d._babylonTransformNode)||void 0===Q||null===(n=Q.rotationQuaternion)||void 0===n?void 0:n.p(v)},getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"fk",get:v=>{var d;return null===(d=v._babylonTransformNode)||void 0===d?void 0:d.md},set:(v,d)=>{var Q;return null===(Q=d._babylonTransformNode)||void 0===Q?void 0:Q.md.p(v)},getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"md"]},weights:{length:{type:"number",get:v=>v._numMorphTargets,getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(v,d)=>{var Q,n;return void 0!==d?null===(Q=v._primitiveBabylonMeshes)||void 0===Q||null===(n=Q[0].morphTargetManager)||void 0===n?void 0:n.getTarget(d).influence:void 0},getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(v,d)=>[0],getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:v=>{var d,Q,T;return n.b.Compose(null===(d=v._babylonTransformNode)||void 0===d?void 0:d.md,null===(Q=v._babylonTransformNode)||void 0===Q?void 0:Q.rotationQuaternion,null===(T=v._babylonTransformNode)||void 0===T?void 0:T.position)},getTarget:v=>v._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:v=>{var d,Q,T,L;const e=n.b.Identity();let F=v.parent;for(;F&&F.parent;)F=F.parent;const r=(null===(d=v._babylonTransformNode)||void 0===d?void 0:d.position._isDirty)||(null===(Q=v._babylonTransformNode)||void 0===Q||null===(T=Q.rotationQuaternion)||void 0===T?void 0:T._isDirty)||(null===(L=v._babylonTransformNode)||void 0===L?void 0:L.md._isDirty);if(F){var C;const d=null===(C=F._babylonTransformNode)||void 0===C?void 0:C.ck(!0).invert();var u,y;if(d)null===(u=v._babylonTransformNode)||void 0===u||null===(y=u.ck(r))||void 0===y||y.multiplyToRef(d,e)}else v._babylonTransformNode&&e.p(v._babylonTransformNode.ck(r));return e},getTarget:v=>v._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:v=>{var d,Q;return null===(d=v._babylonTransformNode)||void 0===d||null===(Q=d.getChildren((v=>v instanceof e.b),!0)[0])||void 0===Q?void 0:Q.o},getTarget:v=>{var d;return null===(d=v._babylonTransformNode)||void 0===d?void 0:d.getChildren((v=>v instanceof e.b),!0)[0]},set:(v,d)=>{if(d._babylonTransformNode){const Q=d._babylonTransformNode.getChildren((v=>v instanceof e.b),!0)[0];Q&&(Q.o=v)}}},color:{type:"wk",get:v=>{var d,Q;return null===(d=v._babylonTransformNode)||void 0===d||null===(Q=d.getChildren((v=>v instanceof e.b),!0)[0])||void 0===Q?void 0:Q.cb},getTarget:v=>{var d;return null===(d=v._babylonTransformNode)||void 0===d?void 0:d.getChildren((v=>v instanceof e.b),!0)[0]},set:(v,d)=>{if(d._babylonTransformNode){const Q=d._babylonTransformNode.getChildren((v=>v instanceof e.b),!0)[0];Q&&(Q.cb=v)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"wk",get:(v,d,Q)=>u(v,d,Q).emissiveColor,set:(v,d,Q,n)=>u(d,Q,n).emissiveColor.p(v),getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(v,d,Q)=>{var n;return null===(n=C(v,Q,"bumpTexture"))||void 0===n?void 0:n.level},set:(v,d,Q,n)=>{const T=C(d,n,"bumpTexture");T&&(T.level=v)},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(v,d,Q)=>u(v,d,Q).ambientTextureStrength,set:(v,d,Q,n)=>{const T=u(d,Q,n);T&&(T.ambientTextureStrength=v)},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"xk",get:(v,d,Q)=>{const n=u(v,d,Q);return L.f.FromColor3(n.albedoColor,n.alpha)},set:(v,d,Q,n)=>{const T=u(d,Q,n);T.albedoColor.set(v.r,v.g,v.b),T.alpha=v.a},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:y("albedoTexture")}},metallicFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).metallic,set:(v,d,Q,n)=>{const T=u(d,Q,n);T&&(T.metallic=v)},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).roughness,set:(v,d,Q,n)=>{const T=u(d,Q,n);T&&(T.roughness=v)},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(v,d,Q)=>u(v,d,Q).anisotropy.o,set:(v,d,Q,n)=>{u(d,Q,n).anisotropy.o=v},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(v,d,Q)=>u(v,d,Q).anisotropy.angle,set:(v,d,Q,n)=>{u(d,Q,n).anisotropy.angle=v},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).clearCoat.o,set:(v,d,Q,n)=>{u(d,Q,n).clearCoat.o=v},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).clearCoat.roughness,set:(v,d,Q,n)=>{u(d,Q,n).clearCoat.roughness=v},getTarget:(v,d,Q)=>u(v,d,Q),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(v,d,Q)=>{var n;return null===(n=u(v,d,Q).clearCoat.bumpTexture)||void 0===n?void 0:n.level},getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).clearCoat.bumpTexture.level=v},extensions:{KHR_texture_transform:y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(v,d,Q)=>u(v,d,Q).subSurface.dispersion,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).subSurface.dispersion=v}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(v,d,Q)=>u(v,d,Q).emissiveIntensity,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).emissiveIntensity=v}},KHR_materials_ior:{ior:{type:"number",get:(v,d,Q)=>u(v,d,Q).indexOfRefraction,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).indexOfRefraction=v}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).iridescence.o,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).iridescence.o=v},iridescenceIor:{type:"number",get:(v,d,Q)=>u(v,d,Q).iridescence.indexOfRefraction,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).iridescence.indexOfRefraction=v},iridescenceTexture:{extensions:{KHR_texture_transform:y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(v,d,Q)=>u(v,d,Q).iridescence.maximumThickness,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).iridescence.maximumThickness=v},iridescenceThicknessMinimum:{type:"number",get:(v,d,Q)=>u(v,d,Q).iridescence.minimumThickness,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).iridescence.minimumThickness=v},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"wk",get:(v,d,Q)=>u(v,d,Q).sheen.color,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).sheen.color.p(v)},sheenColorTexture:{extensions:{KHR_texture_transform:y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).sheen.o,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).sheen.o=v},sheenRoughnessTexture:{extensions:{KHR_texture_transform:y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).metallicF0Factor,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).metallicF0Factor=v,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"wk",get:(v,d,Q)=>u(v,d,Q).metallicReflectanceColor,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).metallicReflectanceColor.p(v),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).subSurface.refractionIntensity,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).subSurface.refractionIntensity=v,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).subSurface.translucencyIntensity,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).subSurface.translucencyIntensity=v},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"wk",get:(v,d,Q)=>u(v,d,Q).subSurface.translucencyColor,getTarget:u,set:(v,d,Q,n)=>{var T;return v&&(null===(T=u(d,Q,n).subSurface.translucencyColor)||void 0===T?void 0:T.p(v))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"wk",get:(v,d,Q)=>u(v,d,Q).subSurface.tintColor,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).subSurface.tintColor.p(v)},attenuationDistance:{type:"number",get:(v,d,Q)=>u(v,d,Q).subSurface.tintColorAtDistance,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).subSurface.tintColorAtDistance=v},thicknessFactor:{type:"number",get:(v,d,Q)=>u(v,d,Q).subSurface.maximumThickness,getTarget:u,set:(v,d,Q,n)=>u(d,Q,n).subSurface.maximumThickness=v},thicknessTexture:{extensions:{KHR_texture_transform:y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:v=>v.length,getTarget:v=>v.map((v=>v._babylonLight)),getPropertyName:[v=>"length"]},__array__:{__target__:!0,color:{type:"wk",get:v=>{var d;return null===(d=v._babylonLight)||void 0===d?void 0:d.cb},set:(v,d)=>{var Q;return null===(Q=d._babylonLight)||void 0===Q?void 0:Q.cb.p(v)},getTarget:v=>v._babylonLight,getPropertyName:[v=>"diffuse"]},o:{type:"number",get:v=>{var d;return null===(d=v._babylonLight)||void 0===d?void 0:d.o},set:(v,d)=>d._babylonLight?d._babylonLight.o=v:void 0,getTarget:v=>v._babylonLight,getPropertyName:[v=>"intensity"]},range:{type:"number",get:v=>{var d;return null===(d=v._babylonLight)||void 0===d?void 0:d.range},set:(v,d)=>d._babylonLight?d._babylonLight.range=v:void 0,getTarget:v=>v._babylonLight,getPropertyName:[v=>"range"]},spot:{innerConeAngle:{type:"number",get:v=>{var d;return null===(d=v._babylonLight)||void 0===d?void 0:d.innerAngle},set:(v,d)=>d._babylonLight?d._babylonLight.innerAngle=v:void 0,getTarget:v=>v._babylonLight,getPropertyName:[v=>"innerConeAngle"]},outerConeAngle:{type:"number",get:v=>{var d;return null===(d=v._babylonLight)||void 0===d?void 0:d.angle},set:(v,d)=>d._babylonLight?d._babylonLight.angle=v:void 0,getTarget:v=>v._babylonLight,getPropertyName:[v=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:v=>v.length,getTarget:v=>v.map((v=>v._babylonLight)),getPropertyName:[v=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:v=>v.length,getTarget:v=>v.map((v=>v._babylonTexture)),getPropertyName:[v=>"length"]},__array__:{__target__:!0,o:{type:"number",get:v=>{var d;return null===(d=v._babylonTexture)||void 0===d?void 0:d.level},set:(v,d)=>{d._babylonTexture&&(d._babylonTexture.level=v)},getTarget:v=>v._babylonTexture},rotation:{type:"Quaternion",get:v=>{var d;return v._babylonTexture&&n.c.FromRotationMatrix(null===(d=v._babylonTexture)||void 0===d?void 0:d.getReflectionTextureMatrix())},set:(v,d)=>{var Q;d._babylonTexture&&(null!==(Q=d._babylonTexture.va())&&void 0!==Q&&Q.useRightHandedSystem||(v=n.c.Inverse(v)),n.b.FromQuaternionToRef(v,d._babylonTexture.getReflectionTextureMatrix()))},getTarget:v=>v._babylonTexture}}}}},animations:{length:{type:"number",get:v=>v.length,getTarget:v=>v.map((v=>v._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:v=>v.length,getTarget:v=>v.map((v=>{var d;return null===(d=v.primitives[0]._instanceData)||void 0===d?void 0:d.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function B(v){return new r(v,z)}function X(v){const d=v.split("/").map((v=>v.replace(/{}/g,"__array__")));let Q=z;for(const n of d)n&&(Q=Q[n]);if(Q&&Q.type&&Q.get)return Q}function m(v,d){const Q=v.split("/").map((v=>v.replace(/{}/g,"__array__")));let n=z;for(const T of Q)T&&(n=n[T]);n&&n.type&&n.get&&(n.interpolation=d)}function V(v,d){const Q=v.split("/").map((v=>v.replace(/{}/g,"__array__")));let n=z;for(const T of Q)if(T){if(!n[T]){if("?"===T){n.__ignoreObjectTree__=!0;continue}n[T]={},"__array__"===T&&(n[T].__target__=!0)}n=n[T]}Object.assign(n,d)}},12863:(v,d,Q)=>{"use strict";Q.r(d),Q.d(d,{AnimationPropertyInfo:()=>C,TransformNodeAnimationPropertyInfo:()=>u,WeightAnimationPropertyInfo:()=>y,getQuaternion:()=>F,getVector3:()=>e,getWeights:()=>r});var n=Q(12002),T=Q(651),L=Q(12854);function e(v,d,Q,n){return T.j.dk(d,Q).scaleInPlace(n)}function F(v,d,Q,n){return T.c.dk(d,Q).scaleInPlace(n)}function r(v,d,Q,n){const T=new Array(v._numMorphTargets);for(let L=0;L<T.length;L++)T[L]=d[Q++]*n;return T}class C{constructor(v,d,Q,n){this.type=v,this.name=d,this.getValue=Q,this.getStride=n}_buildAnimation(v,d,Q){const T=new n.d(v,this.name,d,this.type);return T.setKeys(Q),T}}class u extends C{buildAnimations(v,d,Q,n){const T=[];return T.push({babylonAnimatable:v._babylonTransformNode,babylonAnimation:this._buildAnimation(d,Q,n)}),T}}class y extends C{buildAnimations(v,d,Q,T){const L=[];if(v._numMorphTargets)for(let e=0;e<v._numMorphTargets;e++){const F=new n.d(`${d}_${e}`,this.name,Q,this.type);if(F.setKeys(T.map((v=>({frame:v.frame,inTangent:v.inTangent?v.inTangent[e]:void 0,value:v.value[e],outTangent:v.outTangent?v.outTangent[e]:void 0,interpolation:v.interpolation})))),v._primitiveBabylonMeshes)for(const d of v._primitiveBabylonMeshes)if(d.morphTargetManager){const v=d.morphTargetManager.getTarget(e),Q=F.clone();v.animations.push(Q),L.push({babylonAnimatable:v,babylonAnimation:Q})}}return L}}(0,L.k)("/nodes/{}/translation",[new u(n.d.ANIMATIONTYPE_VECTOR3,"position",e,(()=>3))]),(0,L.k)("/nodes/{}/rotation",[new u(n.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",F,(()=>4))]),(0,L.k)("/nodes/{}/scale",[new u(n.d.ANIMATIONTYPE_VECTOR3,"md",e,(()=>3))]),(0,L.k)("/nodes/{}/weights",[new y(n.d.ANIMATIONTYPE_FLOAT,"influence",r,(v=>v._numMorphTargets))])},12831:(v,d,Q)=>{"use strict";class n{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((v,d)=>{this._resolve=v,this._reject=d}))}}var T=Q(651),L=Q(686),e=Q(475),F=Q(616),r=Q(12833),C=Q(12843),u=Q(473),y=Q(11909),z=Q(12002),B=Q(12009),X=Q(508),m=Q(482),V=Q(484);class h{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(v){this._useTextureToStoreBoneMatrices=v,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(v,d,Q){this.name=v,this.id=d,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=T.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new u.e,this.bones=[],this._scene=Q||X.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const n=this._scene.getEngine().getCaps();this._canUseTextureForBones=n.textureFloat&&n.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((v=>!v.getParent()))}getTransformMatrices(v){if(this.needInitialSkinMatrix){if(!v)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return v._bonesTransformMatrices||this.prepare(!0),v._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(v){return this.needInitialSkinMatrix&&v._transformMatrixTexture?v._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(v){let d=`Name: ${this.name}, nBones: ${this.bones.length}`;if(d+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,v){d+=", Ranges: {";let v=!0;for(const Q in this._ranges)v&&(d+=", ",v=!1),d+=Q;d+="}"}return d}getBoneIndexByName(v){for(let d=0,Q=this.bones.length;d<Q;d++)if(this.bones[d].name===v)return d;return-1}createAnimationRange(v,d,Q){if(!this._ranges[v]){this._ranges[v]=new B.e(v,d,Q);for(let n=0,T=this.bones.length;n<T;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].createRange(v,d,Q)}}deleteAnimationRange(v){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Q=0,n=this.bones.length;Q<n;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].deleteRange(v,d);this._ranges[v]=null}getAnimationRange(v){return this._ranges[v]||null}getAnimationRanges(){const v=[];let d;for(d in this._ranges)v.push(this._ranges[d]);return v}copyAnimationRange(v,d){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[d]||!v.getAnimationRange(d))return!1;let n=!0;const T=this._getHighestAnimationFrame()+1,L={},e=v.bones;let F,r;for(r=0,F=e.length;r<F;r++)L[e[r].name]=e[r];this.bones.length!==e.length&&(m.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${e.length}`),n=!1);const C=Q&&this.dimensionsAtRest&&v.dimensionsAtRest?this.dimensionsAtRest.divide(v.dimensionsAtRest):null;for(r=0,F=this.bones.length;r<F;r++){const v=this.bones[r].name,e=L[v];e?n=n&&this.bones[r].copyAnimationRange(e,d,T,Q,C):(m.d.Warn("copyAnimationRange: not same rig, missing source bone "+v),n=!1)}const u=v.getAnimationRange(d);return u&&(this._ranges[d]=new B.e(d,u.from+T,u.to+T)),n}returnToRest(){for(const v of this.bones)-1!==v._index&&v.returnToRest()}_getHighestAnimationFrame(){let v=0;for(let d=0,Q=this.bones.length;d<Q;d++)if(this.bones[d].animations[0]){const Q=this.bones[d].animations[0].getHighestFrame();v<Q&&(v=Q)}return v}beginAnimation(v,d,Q,n){const T=this.getAnimationRange(v);return T?this._scene.beginAnimation(this,T.from,T.to,d,Q,n):null}static MakeAnimationAdditive(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const n=v.getAnimationRange(Q);if(!n)return null;const T=v._scene.getAllAnimatablesByTarget(v);let L=null;for(let F=0;F<T.length;F++){const v=T[F];if(v.fromFrame===(null===n||void 0===n?void 0:n.from)&&v.toFrame===(null===n||void 0===n?void 0:n.to)){L=v;break}}const e=v.getAnimatables();for(let F=0;F<e.length;F++){const v=e[F].animations;if(v)for(let n=0;n<v.length;n++)z.d.MakeAnimationAdditive(v[n],d,Q)}return L&&(L.isAdditive=!0),v}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(v){this._meshesWithPoseMatrix.push(v)}_unregisterMeshWithPoseMatrix(v){const d=this._meshesWithPoseMatrix.indexOf(v);d>-1&&this._meshesWithPoseMatrix.splice(d,1)}_computeTransformMatrices(v,d){this.onBeforeComputeObservable.notifyObservers(this);for(let Q=0;Q<this.bones.length;Q++){const n=this.bones[Q];n._childUpdateId++;const T=n.getParent();if(T?n.getLocalMatrix().multiplyToRef(T.getFinalMatrix(),n.getFinalMatrix()):d?n.getLocalMatrix().multiplyToRef(d,n.getFinalMatrix()):n.getFinalMatrix().p(n.getLocalMatrix()),-1!==n._index){const d=null===n._index?Q:n._index;n.getAbsoluteInverseBindMatrix().multiplyToArray(n.getFinalMatrix(),v,16*d)}}this._identity.copyToArray(v,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const v=this.va().getRenderId();if(this._currentRenderId===v)return;this._currentRenderId=v}if(this._numBonesWithLinkedTransformNode>0)for(const v of this.bones)if(v._linkedTransformNode){const d=v._linkedTransformNode;v.position=d.position,d.rotationQuaternion?v.rotationQuaternion=d.rotationQuaternion:v.rotation=d.rotation,v.md=d.md}if(this.needInitialSkinMatrix)for(const v of this._meshesWithPoseMatrix){const d=v.getPoseMatrix();let Q=this._isDirty;if(v._bonesTransformMatrices&&v._bonesTransformMatrices.length===16*(this.bones.length+1)||(v._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Q=!0),Q){if(this._synchronizedWithMesh!==v){this._synchronizedWithMesh=v;for(const v of this.bones)if(!v.getParent()){v.getBindMatrix().multiplyToRef(d,T.g.Matrix[1]),v._updateAbsoluteBindMatrices(T.g.Matrix[1])}if(this.isUsingTextureForMatrices){const d=4*(this.bones.length+1);v._transformMatrixTexture&&v._transformMatrixTexture.getSize().width===d||(v._transformMatrixTexture&&v._transformMatrixTexture.dispose(),v._transformMatrixTexture=y.c.CreateRGBATexture(v._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(v._bonesTransformMatrices,d),this.isUsingTextureForMatrices&&v._transformMatrixTexture&&v._transformMatrixTexture.update(v._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=y.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let v=0;v<this.bones.length;v++)this._animatables.push(this.bones[v])}return this._animatables}clone(v,d){const Q=new h(v,d||v,this._scene);Q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let n=0;n<this.bones.length;n++){const v=this.bones[n];let d=null;const T=v.getParent();if(T){const v=this.bones.indexOf(T);d=Q.bones[v]}const L=new C.b(v.name,Q,d,v.getBindMatrix().clone(),v.getRestMatrix().clone());L._index=v._index,v._linkedTransformNode&&L.linkTransformNode(v._linkedTransformNode),V.d.DeepCopy(v.animations,L.animations)}if(this._ranges){Q._ranges={};for(const v in this._ranges){const d=this._ranges[v];d&&(Q._ranges[v]=d.clone())}}return this._isDirty=!0,Q.prepare(!0),Q}enableBlending(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const d of this.bones)for(const Q of d.animations)Q.enableBlending=!0,Q.blendingSpeed=v}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const v=this._parentContainer.skeletons.indexOf(this);v>-1&&this._parentContainer.skeletons.splice(v,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const v={};v.name=this.name,v.id=this.id,this.dimensionsAtRest&&(v.dimensionsAtRest=this.dimensionsAtRest.mk()),v.bones=[],v.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){var d;const n=this.bones[Q],T=n.getParent(),L={parentBoneIndex:T?this.bones.indexOf(T):-1,index:n.getIndex(),name:n.name,id:n.id,matrix:n.getBindMatrix().mk(),rest:n.getRestMatrix().mk(),linkedTransformNodeId:null===(d=n.getTransformNode())||void 0===d?void 0:d.id};v.bones.push(L),n.length&&(L.length=n.length),n.metadata&&(L.metadata=n.metadata),n.animations&&n.animations.length>0&&(L.animation=n.animations[0].serialize()),v.ranges=[];for(const d in this._ranges){const Q=this._ranges[d];if(!Q)continue;const n={};n.name=d,n.from=Q.from,n.to=Q.to,v.ranges.push(n)}}return v}static Parse(v,d){const Q=new h(v.name,v.id,d);let n;for(v.dimensionsAtRest&&(Q.dimensionsAtRest=T.j.dk(v.dimensionsAtRest)),Q.needInitialSkinMatrix=v.needInitialSkinMatrix,n=0;n<v.bones.length;n++){const d=v.bones[n],L=v.bones[n].index;let e=null;d.parentBoneIndex>-1&&(e=Q.bones[d.parentBoneIndex]);const F=d.rest?T.b.dk(d.rest):null,r=new C.b(d.name,Q,e,T.b.dk(d.matrix),F,null,L);void 0!==d.id&&null!==d.id&&(r.id=d.id),d.length&&(r.length=d.length),d.metadata&&(r.metadata=d.metadata),d.animation&&r.animations.push(z.d.Parse(d.animation)),void 0!==d.linkedTransformNodeId&&null!==d.linkedTransformNodeId&&(Q._hasWaitingData=!0,r._waitingTransformNodeId=d.linkedTransformNodeId)}if(v.ranges)for(n=0;n<v.ranges.length;n++){const d=v.ranges[n];Q.createAnimationRange(d.name,d.from,d.to)}return Q}computeAbsoluteMatrices(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||v)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(v)}getPoseMatrix(){let v=null;return this._meshesWithPoseMatrix.length>0&&(v=this._meshesWithPoseMatrix[0].getPoseMatrix()),v}sortBones(){const v=[],d=new Array(this.bones.length);for(let Q=0;Q<this.bones.length;Q++)this._sortBones(Q,v,d);this.bones=v}_sortBones(v,d,Q){if(Q[v])return;Q[v]=!0;const n=this.bones[v];if(!n)return;void 0===n._index&&(n._index=v);const T=n.getParent();T&&this._sortBones(this.bones.indexOf(T),d,Q),d.push(n)}setCurrentPoseAsRest(){for(const v of this.bones)v.setCurrentPoseAsRest()}}var S=Q(829),A=Q(11923),f=Q(2041),P=Q(809),O=Q(706),J=Q(778),K=Q(800),o=Q(470),g=Q(12015),R=Q(642),M=Q(12791);class Y{set areUpdatesFrozen(v){v?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new R.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,v||(v=X.c.LastCreatedScene),this._scene=v,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const v=this._scene.getEngine().getCaps();this._canUseTextureForTargets=v.canUseGLVertexID&&v.textureFloat&&v.maxVertexTextureImageUnits>0&&v.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return Y.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?Y.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(v){this._numMaxInfluencers!==v&&(this._numMaxInfluencers=v,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(v){this._useTextureToStoreTargets!==v&&(this._useTextureToStoreTargets=v,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var v;return Y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(v=this._scene)&&void 0!==v&&v.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(v){return this._activeTargets.data[v]}getTarget(v){return this._targets[v]}getTargetByName(v){for(const d of this._targets)if(d.name===v)return d;return null}addTarget(v){this._targets.push(v),this._targetInfluenceChangedObservers.push(v.onInfluenceChanged.add((v=>{this.areUpdatesFrozen&&v&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(v)}))),this._targetDataLayoutChangedObservers.push(v._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(v){const d=this._targets.indexOf(v);d>=0&&(this._targets.splice(d,1),v.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(d,1)[0]),v._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(d,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(v)}_bind(v){v.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),v.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),v.setTexture("morphTargets",this._targetStoreTexture),v.setInt("morphTargetCount",this.numInfluencers)}clone(){const v=new Y(this._scene);for(const d of this._targets)v.addTarget(d.clone());return v.enablePositionMorphing=this.enablePositionMorphing,v.enableNormalMorphing=this.enableNormalMorphing,v.enableTangentMorphing=this.enableTangentMorphing,v.enableUVMorphing=this.enableUVMorphing,v.enableUV2Morphing=this.enableUV2Morphing,v.enableColorMorphing=this.enableColorMorphing,v}serialize(){const v={};v.id=this.uniqueId,v.targets=[];for(const d of this._targets)v.targets.push(d.serialize());return v}_syncActiveTargets(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const d=!!this._targetStoreTexture,Q=this.isUsingTextureForTargets;(this._mustSynchronize||d!==Q)&&(this._mustSynchronize=!1,this.synchronize());let n=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let T=-1;for(const L of this._targets)if(T++,0!==L.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=Y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(L),this._morphTargetTextureIndices[n]=T,this._tempInfluences[n++]=L.influence}this._morphTargetTextureIndices.length!==n&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,n)),this._influences&&this._influences.length===n||(this._influences=new Float32Array(n));for(let L=0;L<n;L++)this._influences[L]=this._tempInfluences[L];if(v&&this._scene)for(const L of this._scene.meshes)L.morphTargetManager===this&&(Q?L._markSubMeshesAsAttributesDirty():L._syncGeometryWithMorphTargetManager())}synchronize(){var v;if(!this._scene||this.areUpdatesFrozen)return;const d=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(v=this._targetStoreTexture)||void 0===v||v.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>d.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const Q of this._targets){this._supportsPositions=this._supportsPositions&&Q.hasPositions,this._supportsNormals=this._supportsNormals&&Q.hasNormals,this._supportsTangents=this._supportsTangents&&Q.hasTangents,this._supportsUVs=this._supportsUVs&&Q.hasUVs,this._supportsUV2s=this._supportsUV2s&&Q.hasUV2s,this._supportsColors=this._supportsColors&&Q.hasColors;const v=Q.vertexCount;if(0===this._vertexCount)this._vertexCount=v;else if(this._vertexCount!==v)return void m.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${Q.name}": ${v}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const v=d.getCaps().maxTextureSize;this._textureWidth>v&&(this._textureHeight=Math.ceil(this._textureWidth/v),this._textureWidth=v);const Q=this._targets.length,n=new Float32Array(Q*this._textureWidth*this._textureHeight*4);let T=0;for(let d=0;d<Q;d++){const v=this._targets[d],Q=v.getPositions(),L=v.getNormals(),e=v.getUVs(),F=v.getTangents(),r=v.getUV2s(),C=v.getColors();T=d*this._textureWidth*this._textureHeight*4;for(let d=0;d<this._vertexCount;d++)this._supportsPositions&&Q&&(n[T]=Q[3*d],n[T+1]=Q[3*d+1],n[T+2]=Q[3*d+2],T+=4),this._supportsNormals&&L&&(n[T]=L[3*d],n[T+1]=L[3*d+1],n[T+2]=L[3*d+2],T+=4),this._supportsUVs&&e&&(n[T]=e[2*d],n[T+1]=e[2*d+1],T+=4),this._supportsTangents&&F&&(n[T]=F[3*d],n[T+1]=F[3*d+1],n[T+2]=F[3*d+2],T+=4),this._supportsUV2s&&r&&(n[T]=r[2*d],n[T+1]=r[2*d+1],T+=4),this._supportsColors&&C&&(n[T]=C[4*d],n[T+1]=C[4*d+1],n[T+2]=C[4*d+2],n[T+3]=C[4*d+3],T+=4)}this._targetStoreTexture=M.d.CreateRGBATexture(n,this._textureWidth,this._textureHeight,Q,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const Q of this._scene.meshes)Q.morphTargetManager===this&&Q._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const v=this._parentContainer.morphTargetManagers.indexOf(this);v>-1&&this._parentContainer.morphTargetManagers.splice(v,1),this._parentContainer=null}for(const v of this._targets)this._scene.stopAnimation(v)}}static Parse(v,d){const Q=new Y(d);for(const n of v.targets)Q.addTarget(g.e.Parse(n,d));return Q}}Y.EnableTextureStorage=!0,Y.MaxActiveMorphTargetsInVertexAttributeMode=8,Y.ConstantTargetCountForTextureMode=0;var D=Q(12847),i=Q(512),Z=Q(742);const j=new Map,x=j;function k(v,d,Q){t(v)&&m.d.Warn(`Extension with the name '${v}' already exists`),j.set(v,{isGLTFExtension:d,factory:Q})}function t(v){return j.delete(v)}var p=Q(12854),W=Q(12070),q=Q(722);class b{static Get(v,d,Q){if(!d||void 0==Q||!d[Q])throw new Error(`${v}: Failed to find index (${Q})`);return d[Q]}static TryGet(v,d){return v&&void 0!=d&&v[d]?v[d]:null}static Assign(v){if(v)for(let d=0;d<v.length;d++)v[d].index=d}}function H(v){if(v.min&&v.max){const d=v.min,Q=v.max,n=T.g.fk[0].ld(d[0],d[1],d[2]),L=T.g.fk[1].ld(Q[0],Q[1],Q[2]);if(v.normalized&&5126!==v.componentType){let d=1;switch(v.componentType){case 5120:d=127;break;case 5121:d=255;break;case 5122:d=32767;break;case 5123:d=65535}const Q=1/d;n.scaleInPlace(Q),L.scaleInPlace(Q)}return new Z.d(n,L)}return null}class s{static RegisterExtension(v,d){k(v,!1,d)}static UnregisterExtension(v){return t(v)}get Qk(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(v){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=v}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((v=>v.dispose&&v.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(v,d,Q,n,T,L){let e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=d,this._assetContainer=Q,this._loadData(n);let L=null;if(v){const d={};if(this._gltf.nodes)for(const v of this._gltf.nodes)v.name&&(d[v.name]=v.index);L=(v instanceof Array?v:[v]).map((v=>{const Q=d[v];if(void 0===Q)throw new Error(`Failed to find node '${v}'`);return Q}))}return await this._loadAsync(T,e,L,(()=>({meshes:this._getMeshes(),Ck:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(v,d,Q,n){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=v,this._loadData(d),await this._loadAsync(Q,T,null,(()=>{}))}async _loadAsync(v,d,Q,n){return await Promise.resolve().then((async()=>{this._rootUrl=v,this._uniqueRootUrl=!v.startsWith("file:")&&d?v:`${v}${Date.now()}/`,this._fileName=d,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const T=`${D.m[D.m.LOADING]} => ${D.m[D.m.READY]}`,L=`${D.m[D.m.LOADING]} => ${D.m[D.m.COMPLETE]}`;this._parent._startPerformanceCounter(T),this._parent._startPerformanceCounter(L),this._parent._setState(D.m.LOADING),this._extensionsOnLoading();const F=new Array;if(!this.parent.loadOnlyMaterials)if(Q)F.push(this.loadSceneAsync("/nodes",{nodes:Q,index:-1}));else if(void 0!=this._gltf.yd||this._gltf.scenes&&this._gltf.scenes[0]){const v=b.Get("/scene",this._gltf.scenes,this._gltf.yd||0);F.push(this.loadSceneAsync(`/scenes/${v.index}`,v))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let v=0;v<this._gltf.materials.length;++v){const d=this._gltf.materials[v],Q="/materials/"+v,n=S.c.TriangleFillMode;F.push(this._loadMaterialAsync(Q,d,null,n,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&F.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&F.push(this._compileShadowGeneratorsAsync());const r=Promise.all(F).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.lc(!0);for(const v of this._babylonScene.materials){const d=v;void 0!==d.maxSimultaneousLights&&(d.maxSimultaneousLights=Math.max(d.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(D.m.READY),this._skipStartAnimationStep||this._startAnimations(),n()}));return await r.then((v=>(this._parent._endPerformanceCounter(T),e.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(L),this._parent._setState(D.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(v=>{this._parent.onErrorObservable.notifyObservers(v),this._parent.onErrorObservable.clear(),this.dispose()}))})),v)))})).catch((v=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(v),this._parent.onErrorObservable.clear(),this.dispose()),v}))}_loadData(v){if(this._gltf=v.json,this._setupData(),v.bin){const d=this._gltf.buffers;if(d&&d[0]&&!d[0].uri){const Q=d[0];(Q.byteLength<v.bin.byteLength-3||Q.byteLength>v.bin.byteLength)&&m.d.Warn(`Binary buffer length (${Q.byteLength}) from JSON does not match chunk length (${v.bin.byteLength})`),this._bin=v.bin}else m.d.Warn("Unexpected BIN chunk")}}_setupData(){if(b.Assign(this._gltf.accessors),b.Assign(this._gltf.animations),b.Assign(this._gltf.buffers),b.Assign(this._gltf.bufferViews),b.Assign(this._gltf.cameras),b.Assign(this._gltf.images),b.Assign(this._gltf.materials),b.Assign(this._gltf.meshes),b.Assign(this._gltf.nodes),b.Assign(this._gltf.samplers),b.Assign(this._gltf.scenes),b.Assign(this._gltf.skins),b.Assign(this._gltf.textures),this._gltf.nodes){const v={};for(const Q of this._gltf.nodes)if(Q.children)for(const d of Q.children)v[d]=Q.index;const d=this._createRootNode();for(const Q of this._gltf.nodes){const n=v[Q.index];Q.parent=void 0===n?d:this._gltf.nodes[n]}}}async _loadExtensionsAsync(){const v=[];if(x.forEach(((d,Q)=>{var n;!1===(null===(n=this.parent.extensionOptions[Q])||void 0===n?void 0:n.enabled)?d.isGLTFExtension&&this.isExtensionUsed(Q)&&m.d.Warn(`Extension ${Q} is used but has been explicitly disabled.`):d.isGLTFExtension&&!this.isExtensionUsed(Q)||v.push((async()=>{const v=await d.factory(this);return v.name!==Q&&m.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${v.name} !== ${Q}`),this._parent.onExtensionLoadedObservable.notifyObservers(v),v})())})),this._extensions.push(...await Promise.all(v)),this._extensions.sort(((v,d)=>(v.order||Number.MAX_VALUE)-(d.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Q of this._gltf.extensionsRequired){if(!this._extensions.some((v=>v.name===Q&&v.enabled))){var d;if(!1===(null===(d=this.parent.extensionOptions[Q])||void 0===d?void 0:d.enabled))throw new Error(`Required extension ${Q} is disabled`);throw new Error(`Required extension ${Q} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new o.b("__root__",this._babylonScene);this._rootBabylonMesh=v,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.lc(!1);const d={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case D.k.AUTO:this._babylonScene.useRightHandedSystem||(d.rotation=[0,1,0,0],d.scale=[1,1,-1],s._LoadTransform(d,this._rootBabylonMesh));break;case D.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(v),d}loadSceneAsync(v,d){const Q=this._extensionsLoadSceneAsync(v,d);if(Q)return Q;const n=new Array;if(this.logOpen(`${v} ${d.name||""}`),d.nodes)for(const T of d.nodes){const d=b.Get(`${v}/nodes/${T}`,this._gltf.nodes,T);n.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(v=>{v.parent=this._rootBabylonMesh})))}for(const T of this._postSceneLoadActions)T();return n.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(n).then((()=>{}))}_forEachPrimitive(v,d){if(v._primitiveBabylonMeshes)for(const Q of v._primitiveBabylonMeshes)d(Q)}_getGeometries(){const v=[],d=this._gltf.nodes;if(d)for(const Q of d)this._forEachPrimitive(Q,(d=>{const Q=d.sk;Q&&-1===v.indexOf(Q)&&v.push(Q)}));return v}_getMeshes(){const v=[];this._rootBabylonMesh instanceof K.d&&v.push(this._rootBabylonMesh);const d=this._gltf.nodes;if(d)for(const Q of d)this._forEachPrimitive(Q,(d=>{v.push(d)}));return v}_getTransformNodes(){const v=[],d=this._gltf.nodes;if(d)for(const Q of d)Q._babylonTransformNode&&"Pk"===Q._babylonTransformNode.getClassName()&&v.push(Q._babylonTransformNode),Q._babylonTransformNodeForSkin&&v.push(Q._babylonTransformNodeForSkin);return v}_getSkeletons(){const v=[],d=this._gltf.skins;if(d)for(const Q of d)Q._data&&v.push(Q._data.babylonSkeleton);return v}_getAnimationGroups(){const v=[],d=this._gltf.animations;if(d)for(const Q of d)Q._babylonAnimationGroup&&v.push(Q._babylonAnimationGroup);return v}_startAnimations(){switch(this._parent.animationStartMode){case D.h.NONE:break;case D.h.FIRST:{const v=this._getAnimationGroups();0!==v.length&&v[0].start(!0);break}case D.h.ALL:{const v=this._getAnimationGroups();for(const d of v)d.start(!0);break}default:return void m.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadNodeAsync(v,d,Q);if(n)return n;if(d._babylonTransformNode)throw new Error(`${v}: Invalid recursive node hierarchy`);const T=new Array;this.logOpen(`${v} ${d.name||""}`);const L=n=>{if(s.AddPointerMetadata(n,v),s._LoadTransform(d,n),void 0!=d.camera){const Q=b.Get(`${v}/camera`,this._gltf.cameras,d.camera);T.push(this.loadCameraAsync(`/cameras/${Q.index}`,Q,(v=>{v.parent=n,this._babylonScene.useRightHandedSystem||(n.md.x=-1)})))}if(d.children)for(const Q of d.children){const d=b.Get(`${v}/children/${Q}`,this._gltf.nodes,Q);T.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(v=>{v.parent=n})))}Q(n)},e=void 0!=d.mesh,F=this._parent.loadSkins&&void 0!=d.skin;if(!e||F){const v=d.name||`node${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new P.d(v,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==d.mesh?d._babylonTransformNode=Q:d._babylonTransformNodeForSkin=Q,L(Q)}if(e)if(F){const Q=b.Get(`${v}/mesh`,this._gltf.meshes,d.mesh);T.push(this._loadMeshAsync(`/meshes/${Q.index}`,d,Q,(Q=>{const n=d._babylonTransformNodeForSkin;Q.metadata=(0,W.d)(n.metadata,Q.metadata||{});const L=b.Get(`${v}/skin`,this._gltf.skins,d.skin);T.push(this._loadSkinAsync(`/skins/${L.index}`,d,L,(v=>{this._forEachPrimitive(d,(d=>{d.skeleton=v})),this._postSceneLoadActions.push((()=>{if(void 0!=L.skeleton){const v=b.Get(`/skins/${L.index}/skeleton`,this._gltf.nodes,L.skeleton).parent;d.index===v.index?Q.parent=n.parent:Q.parent=v._babylonTransformNode}else Q.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:n,skinnedNode:Q})}))})))})))}else{const Q=b.Get(`${v}/mesh`,this._gltf.meshes,d.mesh);T.push(this._loadMeshAsync(`/meshes/${Q.index}`,d,Q,L))}return this.logClose(),Promise.all(T).then((()=>(this._forEachPrimitive(d,(v=>{const d=v;!d.isAnInstance&&d.sk&&d.sk.useBoundingInfoFromGeometry?v.Ea():v.refreshBoundingInfo(!0,!0)})),d._babylonTransformNode)))}_loadMeshAsync(v,d,Q,n){const T=Q.primitives;if(!T||!T.length)throw new Error(`${v}: Primitives are missing`);void 0==T[0].index&&b.Assign(T);const L=new Array;this.logOpen(`${v} ${Q.name||""}`);const e=d.name||`node${d.index}`;if(1===T.length){const n=Q.primitives[0];L.push(this._loadMeshPrimitiveAsync(`${v}/primitives/${n.index}`,e,d,Q,n,(v=>{d._babylonTransformNode=v,d._primitiveBabylonMeshes=[v]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,d._babylonTransformNode=new P.d(e,this._babylonScene),d._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._primitiveBabylonMeshes=[];for(const n of T)L.push(this._loadMeshPrimitiveAsync(`${v}/primitives/${n.index}`,`${e}_primitive${n.index}`,d,Q,n,(v=>{v.parent=d._babylonTransformNode,d._primitiveBabylonMeshes.push(v)})))}return n(d._babylonTransformNode),this.logClose(),Promise.all(L).then((()=>d._babylonTransformNode))}_loadMeshPrimitiveAsync(v,d,Q,n,T,L){const e=this._extensionsLoadMeshPrimitiveAsync(v,d,Q,n,T,L);if(e)return e;this.logOpen(`${v}`);const F=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Q.skin&&!n.primitives[0].targets;let r,C;if(F&&T._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,r=T._instanceData.babylonSourceMesh.createInstance(d),r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C=T._instanceData.promise;else{const L=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new o.b(d,this._babylonScene);e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.sideOrientation=this._babylonScene.useRightHandedSystem?S.c.CounterClockWiseSideOrientation:S.c.ClockWiseSideOrientation,this._createMorphTargets(v,Q,n,T,e),L.push(this._loadVertexDataAsync(v,T,e).then((async d=>await this._loadMorphTargetsAsync(v,T,e,d).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,d.Ca(e),d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const u=s._GetDrawMode(v,T.mode);if(void 0==T.material){let v=this._defaultBabylonMaterialData[u];v||(v=this._createDefaultMaterial("__GLTFLoader._default",u),this._parent.onMaterialLoadedObservable.notifyObservers(v),this._defaultBabylonMaterialData[u]=v),e.material=v}else if(!this.parent.skipMaterials){const d=b.Get(`${v}/material`,this._gltf.materials,T.material);L.push(this._loadMaterialAsync(`/materials/${d.index}`,d,e,u,(v=>{e.material=v})))}C=Promise.all(L),F&&(T._instanceData={babylonSourceMesh:e,promise:C}),r=e}return s.AddPointerMetadata(r,v),this._parent.onMeshLoadedObservable.notifyObservers(r),L(r),this.logClose(),C.then((()=>r))}_loadVertexDataAsync(v,d,Q){const n=this._extensionsLoadVertexDataAsync(v,d,Q);if(n)return n;const T=d.attributes;if(!T)throw new Error(`${v}: Attributes are missing`);const L=new Array,e=new J.e(Q.name,this._babylonScene);if(void 0==d.indices)Q.isUnIndexed=!0;else{const Q=b.Get(`${v}/indices`,this._gltf.accessors,d.indices);L.push(this._loadIndicesAccessorAsync(`/accessors/${Q.index}`,Q).then((v=>{e.setIndices(v)})))}const F=(d,n,F)=>{if(void 0==T[d])return;Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(n)&&Q._delayInfo.push(n);const r=b.Get(`${v}/attributes/${d}`,this._gltf.accessors,T[d]);L.push(this._loadVertexAccessorAsync(`/accessors/${r.index}`,r,n).then((v=>{if(v.getKind()===O.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Q.skeleton){const v=H(r);v&&(e._boundingInfo=v,e.useBoundingInfoFromGeometry=!0)}e.setVerticesBuffer(v,r.count)}))),n==O.e.MatricesIndicesExtraKind&&(Q.numBoneInfluencers=8),F&&F(r)};return F("POSITION",O.e.PositionKind),F("NORMAL",O.e.NormalKind),F("TANGENT",O.e.TangentKind),F("TEXCOORD_0",O.e.UVKind),F("TEXCOORD_1",O.e.UV2Kind),F("TEXCOORD_2",O.e.UV3Kind),F("TEXCOORD_3",O.e.UV4Kind),F("TEXCOORD_4",O.e.UV5Kind),F("TEXCOORD_5",O.e.UV6Kind),F("JOINTS_0",O.e.MatricesIndicesKind),F("WEIGHTS_0",O.e.MatricesWeightsKind),F("JOINTS_1",O.e.MatricesIndicesExtraKind),F("WEIGHTS_1",O.e.MatricesWeightsExtraKind),F("COLOR_0",O.e.ColorKind,(v=>{"VEC4"===v.type&&(Q.hasVertexAlpha=!0)})),Promise.all(L).then((()=>e))}_createMorphTargets(v,d,Q,n,T){if(!n.targets||!this._parent.loadMorphTargets)return;if(void 0==d._numMorphTargets)d._numMorphTargets=n.targets.length;else if(n.targets.length!==d._numMorphTargets)throw new Error(`${v}: Primitives do not have the same number of targets`);const L=Q.extras?Q.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,T.morphTargetManager=new Y(this._babylonScene),T.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.morphTargetManager.areUpdatesFrozen=!0;for(let e=0;e<n.targets.length;e++){const v=d.weights?d.weights[e]:Q.weights?Q.weights[e]:0,n=L?L[e]:`morphTarget${e}`;T.morphTargetManager.addTarget(new g.e(n,v,T.va()))}}_loadMorphTargetsAsync(v,d,Q,n){if(!d.targets||!this._parent.loadMorphTargets)return Promise.resolve();const T=new Array,L=Q.morphTargetManager;for(let e=0;e<L.numTargets;e++){const Q=L.getTarget(e);T.push(this._loadMorphTargetVertexDataAsync(`${v}/targets/${e}`,n,d.targets[e],Q))}return Promise.all(T).then((()=>{L.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(v,d,Q,n){const T=new Array,L=(n,L,e)=>{if(void 0==Q[n])return;const F=d.getVertexBuffer(L);if(!F)return;const r=b.Get(`${v}/${n}`,this._gltf.accessors,Q[n]);T.push(this._loadFloatAccessorAsync(`/accessors/${r.index}`,r).then((v=>{e(F,v)})))};return L("POSITION",O.e.PositionKind,((v,d)=>{const Q=new Float32Array(d.length);v.forEach(d.length,((v,n)=>{Q[n]=d[n]+v})),n.setPositions(Q)})),L("NORMAL",O.e.NormalKind,((v,d)=>{const Q=new Float32Array(d.length);v.forEach(Q.length,((v,n)=>{Q[n]=d[n]+v})),n.setNormals(Q)})),L("TANGENT",O.e.TangentKind,((v,d)=>{const Q=new Float32Array(d.length/3*4);let T=0;v.forEach(d.length/3*4,((v,n)=>{(n+1)%4!==0&&(Q[T]=d[T]+v,T++)})),n.setTangents(Q)})),L("TEXCOORD_0",O.e.UVKind,((v,d)=>{const Q=new Float32Array(d.length);v.forEach(d.length,((v,n)=>{Q[n]=d[n]+v})),n.setUVs(Q)})),L("TEXCOORD_1",O.e.UV2Kind,((v,d)=>{const Q=new Float32Array(d.length);v.forEach(d.length,((v,n)=>{Q[n]=d[n]+v})),n.setUV2s(Q)})),L("COLOR_0",O.e.ColorKind,((d,Q)=>{let T=null;const L=d.getSize();if(3===L){T=new Float32Array(Q.length/3*4),d.forEach(Q.length,((v,d)=>{const n=Math.floor(d/3),L=d%3;T[4*n+L]=Q[3*n+L]+v}));for(let v=0;v<Q.length/3;++v)T[4*v+3]=1}else{if(4!==L)throw new Error(`${v}: Invalid number of components (${L}) for COLOR_0 attribute`);T=new Float32Array(Q.length),d.forEach(Q.length,((v,d)=>{T[d]=Q[d]+v}))}n.setColors(T)})),await Promise.all(T).then((()=>{}))}static _LoadTransform(v,d){if(void 0!=v.skin)return;let Q=T.j.Zero(),n=T.c.Identity(),L=T.j.One();if(v.matrix){T.b.dk(v.matrix).decompose(L,n,Q)}else v.translation&&(Q=T.j.dk(v.translation)),v.rotation&&(n=T.c.dk(v.rotation)),v.scale&&(L=T.j.dk(v.scale));d.position=Q,d.rotationQuaternion=n,d.md=L}_loadSkinAsync(v,d,Q,n){if(!this._parent.loadSkins)return Promise.resolve();const T=this._extensionsLoadSkinAsync(v,d,Q);if(T)return T;if(Q._data)return n(Q._data.babylonSkeleton),Q._data.promise;const L=`skeleton${Q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new h(Q.name||L,L,this._babylonScene);e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(v,Q,e);const F=this._loadSkinInverseBindMatricesDataAsync(v,Q).then((v=>{this._updateBoneMatrices(e,v)}));return Q._data={babylonSkeleton:e,promise:F},n(e),F}_loadBones(v,d,Q){if(void 0==d.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Q=this._findSkeletonRootNode(`${v}/joints`,d.joints);if(Q)if(void 0===d.skeleton)d.skeleton=Q.index;else{const n=(v,d)=>{for(;d.parent;d=d.parent)if(d.parent===v)return!0;return!1},T=b.Get(`${v}/skeleton`,this._gltf.nodes,d.skeleton);T===Q||n(T,Q)||(m.d.Warn(`${v}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),d.skeleton=Q.index)}else m.d.Warn(`${v}: Failed to find common root`)}const n={};for(const T of d.joints){const L=b.Get(`${v}/joints/${T}`,this._gltf.nodes,T);this._loadBone(L,d,Q,n)}}_findSkeletonRootNode(v,d){if(0===d.length)return null;const Q={};for(const T of d){const d=[];let n=b.Get(`${v}/${T}`,this._gltf.nodes,T);for(;-1!==n.index;)d.unshift(n),n=n.parent;Q[T]=d}let n=null;for(let T=0;;++T){let v=Q[d[0]];if(T>=v.length)return n;const L=v[T];for(let e=1;e<d.length;++e)if(v=Q[d[e]],T>=v.length||L!==v[T])return n;n=L}}_loadBone(v,d,Q,n){v._isJoint=!0;let T=n[v.index];if(T)return T;let L=null;v.index!==d.skeleton&&(v.parent&&-1!==v.parent.index?L=this._loadBone(v.parent,d,Q,n):void 0!==d.skeleton&&m.d.Warn(`/skins/${d.index}/skeleton: Skeleton node is not a common root`));const e=d.joints.indexOf(v.index);return T=new C.b(v.name||`joint${v.index}`,Q,L,this._getNodeMatrix(v),null,null,e),n[v.index]=T,this._postSceneLoadActions.push((()=>{T.linkTransformNode(v._babylonTransformNode)})),T}_loadSkinInverseBindMatricesDataAsync(v,d){if(void 0==d.inverseBindMatrices)return Promise.resolve(null);const Q=b.Get(`${v}/inverseBindMatrices`,this._gltf.accessors,d.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q)}_updateBoneMatrices(v,d){for(const Q of v.bones){const v=T.b.Identity(),n=Q._index;d&&-1!==n&&(T.b.FromArrayToRef(d,16*n,v),v.invertToRef(v));const L=Q.getParent();L&&v.multiplyToRef(L.getAbsoluteInverseBindMatrix(),v),Q.tk(v,!1,!1),Q._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(v){return v.matrix?T.b.dk(v.matrix):T.b.Compose(v.scale?T.j.dk(v.scale):T.j.One(),v.rotation?T.c.dk(v.rotation):T.c.Identity(),v.translation?T.j.dk(v.translation):T.j.Zero())}loadCameraAsync(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadCameraAsync(v,d,Q);if(n)return n;const L=new Array;this.logOpen(`${v} ${d.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new r.c(d.name||`camera${d.index}`,T.j.Zero(),this._babylonScene,!1);switch(e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonCamera=e,e.setTarget(new T.j(0,0,-1)),d.type){case"perspective":{const Q=d.perspective;if(!Q)throw new Error(`${v}: Camera perspective properties are missing`);e.fov=Q.yfov,e.$j=Q.znear,e.maxZ=Q.zfar||0;break}case"orthographic":if(!d.orthographic)throw new Error(`${v}: Camera orthographic properties are missing`);e.mode=F.c.ORTHOGRAPHIC_CAMERA,e.orthoLeft=-d.orthographic.xmag,e.orthoRight=d.orthographic.xmag,e.orthoBottom=-d.orthographic.ymag,e.orthoTop=d.orthographic.ymag,e.$j=d.orthographic.znear,e.maxZ=d.orthographic.zfar;break;default:throw new Error(`${v}: Invalid camera type (${d.type})`)}return s.AddPointerMetadata(e,v),this._parent.onCameraLoadedObservable.notifyObservers(e),Q(e),this.logClose(),Promise.all(L).then((()=>e))}_loadAnimationsAsync(){const v=this._gltf.animations;if(!v)return Promise.resolve();const d=new Array;for(let Q=0;Q<v.length;Q++){const n=v[Q];d.push(this.loadAnimationAsync(`/animations/${n.index}`,n).then((v=>{0===v.targetedAnimations.length&&v.dispose()})))}return Promise.all(d).then((()=>{}))}loadAnimationAsync(v,d){const n=this._extensionsLoadAnimationAsync(v,d);return n||Q.e(62).then(Q.bind(Q,14138)).then((Q=>{let{AnimationGroup:n}=Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new n(d.name||`animation${d.index}`,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonAnimationGroup=T;const L=new Array;b.Assign(d.channels),b.Assign(d.samplers);for(const e of d.channels)L.push(this._loadAnimationChannelAsync(`${v}/channels/${e.index}`,v,d,e,((v,d)=>{v.animations=v.animations||[],v.animations.push(d),T.addTargetedAnimation(d,v)})));return Promise.all(L).then((()=>(T.normalize(0),T)))}))}async _loadAnimationChannelAsync(v,d,n,T,L){const e=this._extensionsLoadAnimationChannelAsync(v,d,n,T,L);if(e)return await e;if(void 0==T.target.node)return await Promise.resolve();const F=b.Get(`${v}/target/node`,this._gltf.nodes,T.target.node),r=T.target.path,C="weights"===r;if(C&&!F._numMorphTargets||!C&&!F._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!C&&!F._isJoint)return await Promise.resolve();let u;switch(await Promise.resolve().then(Q.bind(Q,12863)),r){case"translation":var y;u=null===(y=(0,p.i)("/nodes/{}/translation"))||void 0===y?void 0:y.interpolation;break;case"rotation":var z;u=null===(z=(0,p.i)("/nodes/{}/rotation"))||void 0===z?void 0:z.interpolation;break;case"scale":var B;u=null===(B=(0,p.i)("/nodes/{}/scale"))||void 0===B?void 0:B.interpolation;break;case"weights":var X;u=null===(X=(0,p.i)("/nodes/{}/weights"))||void 0===X?void 0:X.interpolation;break;default:throw new Error(`${v}/target/path: Invalid value (${T.target.path})`)}if(!u)throw new Error(`${v}/target/path: Could not find interpolation properties for target path (${T.target.path})`);const m={object:F,info:u};return await this._loadAnimationChannelFromTargetInfoAsync(v,d,n,T,m,L)}_loadAnimationChannelFromTargetInfoAsync(v,d,Q,n,T,L){const e=this.parent.targetFps,F=1/e,r=b.Get(`${v}/sampler`,Q.samplers,n.sampler);return this._loadAnimationSamplerAsync(`${d}/samplers/${n.sampler}`,r).then((v=>{let d=0;const r=T.object,C=T.info;for(const T of C){const C=T.getStride(r),u=v.input,y=v.output,z=new Array(u.length);let B=0;switch(v.interpolation){case"STEP":for(let v=0;v<u.length;v++){const d=T.getValue(r,y,B,1);B+=C,z[v]={frame:u[v]*e,value:d,interpolation:1}}break;case"CUBICSPLINE":for(let v=0;v<u.length;v++){const d=T.getValue(r,y,B,F);B+=C;const Q=T.getValue(r,y,B,1);B+=C;const n=T.getValue(r,y,B,F);B+=C,z[v]={frame:u[v]*e,inTangent:d,value:Q,outTangent:n}}break;case"LINEAR":for(let v=0;v<u.length;v++){const d=T.getValue(r,y,B,1);B+=C,z[v]={frame:u[v]*e,value:d}}}if(B>0){const v=`${Q.name||`animation${Q.index}`}_channel${n.index}_${d}`,F=T.buildAnimations(r,v,e,z);for(const Q of F)d++,L(Q.babylonAnimatable,Q.babylonAnimation)}}}))}_loadAnimationSamplerAsync(v,d){if(d._data)return d._data;const Q=d.interpolation||"LINEAR";switch(Q){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${v}/interpolation: Invalid value (${d.interpolation})`)}const n=b.Get(`${v}/input`,this._gltf.accessors,d.input),T=b.Get(`${v}/output`,this._gltf.accessors,d.output);return d._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${n.index}`,n),this._loadFloatAccessorAsync(`/accessors/${T.index}`,T)]).then((v=>{let[d,n]=v;return{input:d,interpolation:Q,output:n}})),d._data}loadBufferAsync(v,d,Q,n){const T=this._extensionsLoadBufferAsync(v,d,Q,n);if(T)return T;if(!d._data)if(d.uri)d._data=this.loadUriAsync(`${v}/uri`,d,d.uri);else{if(!this._bin)throw new Error(`${v}: Uri is missing or the binary glTF is missing its binary chunk`);d._data=this._bin.readAsync(0,d.byteLength)}return d._data.then((d=>{try{return new Uint8Array(d.buffer,d.byteOffset+Q,n)}catch(T){throw new Error(`${v}: ${T.message}`)}}))}loadBufferViewAsync(v,d){const Q=this._extensionsLoadBufferViewAsync(v,d);if(Q)return Q;if(d._data)return d._data;const n=b.Get(`${v}/buffer`,this._gltf.buffers,d.buffer);return d._data=this.loadBufferAsync(`/buffers/${n.index}`,n,d.byteOffset||0,d.byteLength),d._data}_loadAccessorAsync(v,d,Q){if(d._data)return d._data;const n=s._GetNumComponents(v,d.type),T=n*O.e.GetTypeByteLength(d.componentType),L=n*d.count;if(void 0==d.bufferView)d._data=Promise.resolve(new Q(L));else{const e=b.Get(`${v}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((F=>{if(5126!==d.componentType||d.normalized||e.byteStride&&e.byteStride!==T){const v=new Q(L);return O.e.ForEach(F,d.byteOffset||0,e.byteStride||T,n,d.componentType,v.length,d.normalized||!1,((d,Q)=>{v[Q]=d})),v}return s._GetTypedArray(v,d.componentType,F,d.byteOffset,L)}))}if(d.sparse){const L=d.sparse;d._data=d._data.then((e=>{const F=e,r=b.Get(`${v}/sparse/indices/bufferView`,this._gltf.bufferViews,L.indices.bufferView),C=b.Get(`${v}/sparse/values/bufferView`,this._gltf.bufferViews,L.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${r.index}`,r),this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)]).then((e=>{let[r,C]=e;const u=s._GetTypedArray(`${v}/sparse/indices`,L.indices.componentType,r,L.indices.byteOffset,L.count),y=n*L.count;let z;if(5126!==d.componentType||d.normalized){const e=s._GetTypedArray(`${v}/sparse/values`,d.componentType,C,L.values.byteOffset,y);z=new Q(y),O.e.ForEach(e,0,T,n,d.componentType,z.length,d.normalized||!1,((v,d)=>{z[d]=v}))}else z=s._GetTypedArray(`${v}/sparse/values`,d.componentType,C,L.values.byteOffset,y);let B=0;for(let v=0;v<u.length;v++){let d=u[v]*n;for(let v=0;v<n;v++)F[d++]=z[B++]}return F}))}))}return d._data}_loadFloatAccessorAsync(v,d){return this._loadAccessorAsync(v,d,Float32Array)}_loadIndicesAccessorAsync(v,d){if("SCALAR"!==d.type)throw new Error(`${v}/type: Invalid value ${d.type}`);if(5121!==d.componentType&&5123!==d.componentType&&5125!==d.componentType)throw new Error(`${v}/componentType: Invalid value ${d.componentType}`);if(d._data)return d._data;if(d.sparse){const Q=s._GetTypedArrayConstructor(`${v}/componentType`,d.componentType);d._data=this._loadAccessorAsync(v,d,Q)}else{const Q=b.Get(`${v}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((Q=>s._GetTypedArray(v,d.componentType,Q,d.byteOffset,d.count)))}return d._data}_loadVertexBufferViewAsync(v){if(v._babylonBuffer)return v._babylonBuffer;const d=this._babylonScene.getEngine();return v._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((v=>new O.c(d,v,!1))),v._babylonBuffer}_loadVertexAccessorAsync(v,d,Q){var n;if(null!==(n=d._babylonVertexBuffer)&&void 0!==n&&n[Q])return d._babylonVertexBuffer[Q];d._babylonVertexBuffer||(d._babylonVertexBuffer={});const T=this._babylonScene.getEngine();if(d.sparse||void 0==d.bufferView)d._babylonVertexBuffer[Q]=this._loadFloatAccessorAsync(v,d).then((v=>new O.e(T,v,Q,!1)));else{const n=b.Get(`${v}/bufferView`,this._gltf.bufferViews,d.bufferView);d._babylonVertexBuffer[Q]=this._loadVertexBufferViewAsync(n).then((L=>{const e=s._GetNumComponents(v,d.type);return new O.e(T,L,Q,!1,void 0,n.byteStride,void 0,d.byteOffset,e,d.componentType,d.normalized,!0,void 0,!0)}))}return d._babylonVertexBuffer[Q]}_loadMaterialMetallicRoughnessPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return d&&(d.baseColorFactor?(Q.albedoColor=L.c.dk(d.baseColorFactor),Q.alpha=d.baseColorFactor[3]):Q.albedoColor=L.c.White(),Q.metallic=void 0==d.metallicFactor?1:d.metallicFactor,Q.roughness=void 0==d.roughnessFactor?1:d.roughnessFactor,d.baseColorTexture&&n.push(this.loadTextureInfoAsync(`${v}/baseColorTexture`,d.baseColorTexture,(v=>{v.name=`${Q.name} (Base Color)`,Q.albedoTexture=v}))),d.metallicRoughnessTexture&&(d.metallicRoughnessTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${v}/metallicRoughnessTexture`,d.metallicRoughnessTexture,(v=>{v.name=`${Q.name} (Metallic Roughness)`,Q.metallicTexture=v}))),Q.useMetallnessFromMetallicTextureBlue=!0,Q.useRoughnessFromMetallicTextureGreen=!0,Q.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(n).then((()=>{}))}_loadMaterialAsync(v,d,Q,n){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const L=this._extensionsLoadMaterialAsync(v,d,Q,n,T);if(L)return L;d._data=d._data||{};let e=d._data[n];if(!e){this.logOpen(`${v} ${d.name||""}`);const Q=this.createMaterial(v,d,n);e={babylonMaterial:Q,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(v,d,Q)},d._data[n]=e,s.AddPointerMetadata(Q,v),this._parent.onMaterialLoadedObservable.notifyObservers(Q),this.logClose()}return Q&&(e.babylonMeshes.push(Q),Q.kk.addOnce((()=>{const v=e.babylonMeshes.indexOf(Q);-1!==v&&e.babylonMeshes.splice(v,1)}))),T(e.babylonMaterial),e.promise.then((()=>e.babylonMaterial))}_createDefaultMaterial(v,d){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new A.d(v,this._babylonScene);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.fillMode=d,Q.enableSpecularAntiAliasing=!0,Q.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Q.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Q.transparencyMode=A.d.PBRMATERIAL_OPAQUE,Q.metallic=1,Q.roughness=1,Q}createMaterial(v,d,Q){const n=this._extensionsCreateMaterial(v,d,Q);if(n)return n;const T=d.name||`material${d.index}`;return this._createDefaultMaterial(T,Q)}loadMaterialPropertiesAsync(v,d,Q){const n=this._extensionsLoadMaterialPropertiesAsync(v,d,Q);if(n)return n;const T=new Array;return T.push(this.loadMaterialBasePropertiesAsync(v,d,Q)),d.pbrMetallicRoughness&&T.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${v}/pbrMetallicRoughness`,d.pbrMetallicRoughness,Q)),this.loadMaterialAlphaProperties(v,d,Q),Promise.all(T).then((()=>{}))}loadMaterialBasePropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return Q.emissiveColor=d.emissiveFactor?L.c.dk(d.emissiveFactor):new L.c(0,0,0),d.doubleSided&&(Q.pk=!1,Q.twoSidedLighting=!0),d.normalTexture&&(d.normalTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${v}/normalTexture`,d.normalTexture,(v=>{v.name=`${Q.name} (Normal)`,Q.bumpTexture=v}))),Q.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Q.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=d.normalTexture.scale&&Q.bumpTexture&&(Q.bumpTexture.level=d.normalTexture.scale),Q.forceIrradianceInFragment=!0),d.occlusionTexture&&(d.occlusionTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${v}/occlusionTexture`,d.occlusionTexture,(v=>{v.name=`${Q.name} (Occlusion)`,Q.ambientTexture=v}))),Q.useAmbientInGrayScale=!0,void 0!=d.occlusionTexture.strength&&(Q.ambientTextureStrength=d.occlusionTexture.strength)),d.emissiveTexture&&n.push(this.loadTextureInfoAsync(`${v}/emissiveTexture`,d.emissiveTexture,(v=>{v.name=`${Q.name} (Emissive)`,Q.emissiveTexture=v}))),Promise.all(n).then((()=>{}))}loadMaterialAlphaProperties(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);switch(d.alphaMode||"OPAQUE"){case"OPAQUE":Q.transparencyMode=A.d.PBRMATERIAL_OPAQUE,Q.alpha=1;break;case"MASK":Q.transparencyMode=A.d.PBRMATERIAL_ALPHATEST,Q.alphaCutOff=void 0==d.alphaCutoff?.5:d.alphaCutoff,Q.albedoTexture&&(Q.albedoTexture.ui=!0);break;case"BLEND":Q.transparencyMode=A.d.PBRMATERIAL_ALPHABLEND,Q.albedoTexture&&(Q.albedoTexture.ui=!0,Q.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${v}/alphaMode: Invalid value (${d.alphaMode})`)}}loadTextureInfoAsync(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadTextureInfoAsync(v,d,Q);if(n)return n;if(this.logOpen(`${v}`),d.texCoord>=6)throw new Error(`${v}/texCoord: Invalid value (${d.texCoord})`);const T=b.Get(`${v}/index`,this._gltf.textures,d.index);T._textureInfo=d;const L=this._loadTextureAsync(`/textures/${d.index}`,T,(n=>{n.coordinatesIndex=d.texCoord||0,s.AddPointerMetadata(n,v),this._parent.onTextureLoadedObservable.notifyObservers(n),Q(n)}));return this.logClose(),L}_loadTextureAsync(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=this._extensionsLoadTextureAsync(v,d,Q);if(n)return n;this.logOpen(`${v} ${d.name||""}`);const T=void 0==d.sampler?s.DefaultSampler:b.Get(`${v}/sampler`,this._gltf.samplers,d.sampler),L=b.Get(`${v}/source`,this._gltf.images,d.source),e=this._createTextureAsync(v,T,L,Q,void 0,!d._textureInfo.nonColorData);return this.logClose(),e}_createTextureAsync(v,d,Q){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},L=arguments.length>4?arguments[4]:void 0,e=arguments.length>5?arguments[5]:void 0;const F=this._loadSampler(`/samplers/${d.index}`,d),r=new Array,C=new n;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u={noMipmap:F.noMipMaps,invertY:!1,samplingMode:F.samplingMode,X:()=>{this._disposed||C.resolve()},onError:(d,Q)=>{this._disposed||C.reject(new Error(`${v}: ${Q&&Q.message?Q.message:d||"Failed to load texture"}`))},mimeType:Q.mimeType??(0,i.k)(Q.uri??""),loaderOptions:L,useSRGBBuffer:!!e&&this._parent.useSRGBBuffers},y=new f.e(null,this._babylonScene,u);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.push(C.promise),r.push(this.loadImageAsync(`/images/${Q.index}`,Q).then((v=>{const d=Q.uri||`${this._fileName}#image${Q.index}`,n=`data:${this._uniqueRootUrl}${d}`;y.updateURL(n,v);const T=y.getInternalTexture();T&&(T.label=Q.name)}))),y.wrapU=F.wrapU,y.wrapV=F.wrapV,T(y),this._parent.useGltfTextureNames&&(y.name=Q.name||Q.uri||`image${Q.index}`),Promise.all(r).then((()=>y))}_loadSampler(v,d){return d._data||(d._data={noMipMaps:9728===d.minFilter||9729===d.minFilter,samplingMode:s._GetTextureSamplingMode(v,d),wrapU:s._GetTextureWrapMode(`${v}/wrapS`,d.wrapS),wrapV:s._GetTextureWrapMode(`${v}/wrapT`,d.wrapT)}),d._data}loadImageAsync(v,d){if(!d._data){if(this.logOpen(`${v} ${d.name||""}`),d.uri)d._data=this.loadUriAsync(`${v}/uri`,d,d.uri);else{const Q=b.Get(`${v}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}this.logClose()}return d._data}loadUriAsync(v,d,Q){const n=this._extensionsLoadUriAsync(v,d,Q);if(n)return n;if(!s._ValidateUri(Q))throw new Error(`${v}: '${Q}' is invalid`);if((0,i.l)(Q)){const d=new Uint8Array((0,i.e)(Q));return this.log(`${v}: Decoded ${Q.substring(0,64)}... (${d.length} bytes)`),Promise.resolve(d)}return this.log(`${v}: Loading ${Q}`),this._parent.preprocessUrlAsync(this._rootUrl+Q).then((d=>new Promise(((n,T)=>{this._parent._loadFile(this._babylonScene,d,(d=>{this._disposed||(this.log(`${v}: Loaded ${Q} (${d.byteLength} bytes)`),n(new Uint8Array(d)))}),!0,(d=>{T(new i.p(`${v}: Failed to load '${Q}'${d?": "+d.status+" "+d.statusText:""}`,d))}))}))))}static AddPointerMetadata(v,d){v.metadata=v.metadata||{};const Q=v._internalMetadata=v._internalMetadata||{},n=Q.Qk=Q.Qk||{};(n.pointers=n.pointers||[]).push(d)}static _GetTextureWrapMode(v,d){switch(d=void 0==d?10497:d){case 33071:return f.e.CLAMP_ADDRESSMODE;case 33648:return f.e.MIRROR_ADDRESSMODE;case 10497:return f.e.WRAP_ADDRESSMODE;default:return m.d.Warn(`${v}: Invalid value (${d})`),f.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(v,d){const Q=void 0==d.magFilter?9729:d.magFilter,n=void 0==d.minFilter?9987:d.minFilter;if(9729===Q)switch(n){case 9728:return f.e.LINEAR_NEAREST;case 9729:return f.e.LINEAR_LINEAR;case 9984:return f.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return f.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return f.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return f.e.LINEAR_LINEAR_MIPLINEAR;default:return m.d.Warn(`${v}/minFilter: Invalid value (${n})`),f.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Q&&m.d.Warn(`${v}/magFilter: Invalid value (${Q})`),n){case 9728:return f.e.NEAREST_NEAREST;case 9729:return f.e.NEAREST_LINEAR;case 9984:return f.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return f.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return f.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return f.e.NEAREST_LINEAR_MIPLINEAR;default:return m.d.Warn(`${v}/minFilter: Invalid value (${n})`),f.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(v,d){try{return(0,q.s)(d)}catch(Q){throw new Error(`${v}: ${Q.message}`)}}static _GetTypedArray(v,d,Q,n,T){const L=Q.buffer;n=Q.byteOffset+(n||0);const e=s._GetTypedArrayConstructor(`${v}/componentType`,d),F=O.e.GetTypeByteLength(d);return n%F!==0?(m.d.Warn(`${v}: Copying buffer as byte offset (${n}) is not a multiple of component type byte length (${F})`),new e(L.slice(n,n+T*F),0)):new e(L,n,T)}static _GetNumComponents(v,d){switch(d){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${v}: Invalid type (${d})`)}static _ValidateUri(v){return e.e.IsBase64(v)||-1===v.indexOf("..")}static _GetDrawMode(v,d){switch(void 0==d&&(d=4),d){case 0:return S.c.PointListDrawMode;case 1:return S.c.LineListDrawMode;case 2:return S.c.LineLoopDrawMode;case 3:return S.c.LineStripDrawMode;case 4:return S.c.TriangleFillMode;case 5:return S.c.TriangleStripDrawMode;case 6:return S.c.TriangleFanDrawMode}throw new Error(`${v}: Invalid mesh primitive mode (${d})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const v=new Array;if(this._gltf.materials)for(const d of this._gltf.materials)if(d._data)for(const Q in d._data){const n=d._data[Q];for(const d of n.babylonMeshes){d.ck(!0);const Q=n.babylonMaterial;v.push(Q.forceCompilationAsync(d)),v.push(Q.forceCompilationAsync(d,{useInstances:!0})),this._parent.useClipPlane&&(v.push(Q.forceCompilationAsync(d,{clipPlane:!0})),v.push(Q.forceCompilationAsync(d,{clipPlane:!0,useInstances:!0})))}}return Promise.all(v).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const v=new Array,d=this._babylonScene.lights;for(const Q of d){const d=Q.getShadowGenerator();d&&v.push(d.forceCompilationAsync())}return Promise.all(v).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(v){for(const d of this._extensions)d.enabled&&v(d)}_applyExtensions(v,d,Q){for(const n of this._extensions)if(n.enabled){const T=`${n.name}.${d}`,L=v;L._activeLoaderExtensionFunctions=L._activeLoaderExtensionFunctions||{};const e=L._activeLoaderExtensionFunctions;if(!e[T]){e[T]=!0;try{const v=Q(n);if(v)return v}finally{delete e[T]}}}return null}_extensionsOnLoading(){this._forEachExtensions((v=>v.onLoading&&v.onLoading()))}_extensionsOnReady(){this._forEachExtensions((v=>v.onReady&&v.onReady()))}_extensionsLoadSceneAsync(v,d){return this._applyExtensions(d,"loadScene",(Q=>Q.loadSceneAsync&&Q.loadSceneAsync(v,d)))}_extensionsLoadNodeAsync(v,d,Q){return this._applyExtensions(d,"loadNode",(n=>n.loadNodeAsync&&n.loadNodeAsync(v,d,Q)))}_extensionsLoadCameraAsync(v,d,Q){return this._applyExtensions(d,"loadCamera",(n=>n.loadCameraAsync&&n.loadCameraAsync(v,d,Q)))}_extensionsLoadVertexDataAsync(v,d,Q){return this._applyExtensions(d,"loadVertexData",(n=>n._loadVertexDataAsync&&n._loadVertexDataAsync(v,d,Q)))}_extensionsLoadMeshPrimitiveAsync(v,d,Q,n,T,L){return this._applyExtensions(T,"loadMeshPrimitive",(e=>e._loadMeshPrimitiveAsync&&e._loadMeshPrimitiveAsync(v,d,Q,n,T,L)))}_extensionsLoadMaterialAsync(v,d,Q,n,T){return this._applyExtensions(d,"loadMaterial",(L=>L._loadMaterialAsync&&L._loadMaterialAsync(v,d,Q,n,T)))}_extensionsCreateMaterial(v,d,Q){return this._applyExtensions(d,"createMaterial",(n=>n.createMaterial&&n.createMaterial(v,d,Q)))}_extensionsLoadMaterialPropertiesAsync(v,d,Q){return this._applyExtensions(d,"loadMaterialProperties",(n=>n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(v,d,Q)))}_extensionsLoadTextureInfoAsync(v,d,Q){return this._applyExtensions(d,"loadTextureInfo",(n=>n.loadTextureInfoAsync&&n.loadTextureInfoAsync(v,d,Q)))}_extensionsLoadTextureAsync(v,d,Q){return this._applyExtensions(d,"loadTexture",(n=>n._loadTextureAsync&&n._loadTextureAsync(v,d,Q)))}_extensionsLoadAnimationAsync(v,d){return this._applyExtensions(d,"loadAnimation",(Q=>Q.loadAnimationAsync&&Q.loadAnimationAsync(v,d)))}_extensionsLoadAnimationChannelAsync(v,d,Q,n,T){return this._applyExtensions(Q,"loadAnimationChannel",(L=>L._loadAnimationChannelAsync&&L._loadAnimationChannelAsync(v,d,Q,n,T)))}_extensionsLoadSkinAsync(v,d,Q){return this._applyExtensions(Q,"loadSkin",(n=>n._loadSkinAsync&&n._loadSkinAsync(v,d,Q)))}_extensionsLoadUriAsync(v,d,Q){return this._applyExtensions(d,"loadUri",(n=>n._loadUriAsync&&n._loadUriAsync(v,d,Q)))}_extensionsLoadBufferViewAsync(v,d){return this._applyExtensions(d,"loadBufferView",(Q=>Q.loadBufferViewAsync&&Q.loadBufferViewAsync(v,d)))}_extensionsLoadBufferAsync(v,d,Q,n){return this._applyExtensions(d,"loadBuffer",(T=>T.loadBufferAsync&&T.loadBufferAsync(v,d,Q,n)))}static LoadExtensionAsync(v,d,Q,n){if(!d.extensions)return null;const T=d.extensions[Q];return T?n(`${v}/extensions/${Q}`,T):null}static LoadExtraAsync(v,d,Q,n){if(!d.extras)return null;const T=d.extras[Q];return T?n(`${v}/extras/${Q}`,T):null}isExtensionUsed(v){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(v)}logOpen(v){this._parent._logOpen(v)}logClose(){this._parent._logClose()}log(v){this._parent._log(v)}startPerformanceCounter(v){this._parent._startPerformanceCounter(v)}endPerformanceCounter(v){this._parent._endPerformanceCounter(v)}}s.DefaultSampler={index:-1},D.e._CreateGLTF2Loader=v=>new s(v);var a=Q(12863),I=Q(2007),U=Q(677),c=Q(2162),w=Q(12871);class G extends w.d{constructor(v,d,Q){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",v),this._texture=v.getEngine().createRawCubeTexture(d,Q,n,T,L,e,F,r)}update(v,d,Q,n){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,v,d,Q,n,T)}updateRGBDAsync(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,c.m)(this._texture,v,d,Q,n).then((()=>{}))}clone(){return U.e.Clone((()=>{const v=this.va(),d=this._texture,Q=new G(v,d._bufferViewArray,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression);return 13===d.source&&Q.updateRGBDAsync(d._bufferViewArrayArray,d._sphericalPolynomial,d._lodGenerationScale,d._lodGenerationOffset),Q}),this)}}const E="EXT_lights_image_based";class N{constructor(v){this.name=E,this._loader=v,this.enabled=this._loader.isExtensionUsed(E)}dispose(){this._loader=null,delete this._lights}onLoading(){const v=this._loader.Qk.extensions;if(v&&v[this.name]){const d=v[this.name];this._lights=d.lights}}loadSceneAsync(v,d){return s.LoadExtensionAsync(v,d,this.name,(async(Q,n)=>{this._loader._allMaterialsDirtyRequired=!0;const T=new Array;T.push(this._loader.loadSceneAsync(v,d)),this._loader.logOpen(`${Q}`);const L=b.Get(`${Q}/light`,this._lights,n.ab);return T.push(this._loadLightAsync(`/extensions/${this.name}/lights/${n.ab}`,L).then((v=>{this._loader.babylonScene.environmentTexture=v}))),this._loader.logClose(),await Promise.all(T).then((()=>{}))}))}_loadLightAsync(v,d){if(!d._loaded){const Q=new Array;this._loader.logOpen(`${v}`);const n=new Array(d.specularImages.length);for(let T=0;T<d.specularImages.length;T++){const L=d.specularImages[T];n[T]=new Array(L.length);for(let d=0;d<L.length;d++){const e=`${v}/specularImages/${T}/${d}`;this._loader.logOpen(`${e}`);const F=L[d],r=b.Get(e,this._loader.Qk.images,F);Q.push(this._loader.loadImageAsync(`/images/${F}`,r).then((v=>{n[T][d]=v}))),this._loader.logClose()}}this._loader.logClose(),d._loaded=Promise.all(Q).then((async()=>{const Q=new G(this._loader.babylonScene,null,d.specularImageSize);if(Q.name=d.name||"environment",d._babylonTexture=Q,void 0!=d.o&&(Q.level=d.o),d.rotation){let v=T.c.dk(d.rotation);this._loader.babylonScene.useRightHandedSystem||(v=T.c.Inverse(v)),T.b.FromQuaternionToRef(v,Q.getReflectionTextureMatrix())}if(!d.irradianceCoefficients)throw new Error(`${v}: Irradiance coefficients are missing`);const L=I.c.dk(d.irradianceCoefficients);L.scaleInPlace(d.o),L.convertIrradianceToLambertianRadiance();const e=I.e.FromHarmonics(L),F=(n.length-1)/Math.log2(d.specularImageSize);return await Q.updateRGBDAsync(n,e,F)}))}return d._loaded.then((()=>d._babylonTexture))}}t(E),k(E,!0,(v=>new N(v)));Q(462);const l="EXT_mesh_gpu_instancing";class vv{constructor(v){this.name=l,this._loader=v,this.enabled=this._loader.isExtensionUsed(l)}dispose(){this._loader=null}loadNodeAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(v,n)=>{this._loader._disableInstancedMesh++;const L=this._loader.loadNodeAsync(`/nodes/${d.index}`,d,Q);if(this._loader._disableInstancedMesh--,!d._primitiveBabylonMeshes)return await L;const e=new Array;let F=0;const r=d=>{if(void 0==n.attributes[d])return void e.push(Promise.resolve(null));const Q=b.Get(`${v}/attributes/${d}`,this._loader.Qk.accessors,n.attributes[d]);if(e.push(this._loader._loadFloatAccessorAsync(`/accessors/${Q.bufferView}`,Q)),0===F)F=Q.count;else if(F!==Q.count)throw new Error(`${v}/attributes: Instance buffer accessors do not have the same count.`)};return r("TRANSLATION"),r("ROTATION"),r("SCALE"),await L.then((async v=>{const[Q,n,L]=await Promise.all(e),r=new Float32Array(16*F);T.g.fk[0].ld(0,0,0),T.g.Quaternion[0].ld(0,0,0,1),T.g.fk[1].ld(1,1,1);for(let d=0;d<F;++d)Q&&T.j.FromArrayToRef(Q,3*d,T.g.fk[0]),n&&T.c.FromArrayToRef(n,4*d,T.g.Quaternion[0]),L&&T.j.FromArrayToRef(L,3*d,T.g.fk[1]),T.b.ComposeToRef(T.g.fk[1],T.g.Quaternion[0],T.g.fk[0],T.g.Matrix[0]),T.g.Matrix[0].copyToArray(r,16*d);for(const T of d._primitiveBabylonMeshes)T.Fk("matrix",r,16,!0);return v}))}))}}t(l),k(l,!0,(v=>new vv(v)));let dv=0,Qv=null;class nv{static get Default(){return nv._Default||(nv._Default=new nv),nv._Default}constructor(){const v=nv.Configuration.decoder;this._decoderModulePromise=e.e.LoadBabylonScriptAsync(v.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(v,d,Q,n,T){await this._decoderModulePromise,0===dv&&(MeshoptDecoder.useWorkers(1),dv=1);const L=await MeshoptDecoder.decodeGltfBufferAsync(d,Q,v,n,T);return null!==Qv&&clearTimeout(Qv),Qv=setTimeout((()=>{MeshoptDecoder.useWorkers(0),dv=0,Qv=null}),1e3),L}}nv.Configuration={decoder:{url:`${e.e._DefaultCdnUrl}/meshopt_decoder.js`}},nv._Default=null;const Tv="EXT_meshopt_compression";class Lv{constructor(v){this.name=Tv,this.enabled=v.isExtensionUsed(Tv),this._loader=v}dispose(){this._loader=null}loadBufferViewAsync(v,d){return s.LoadExtensionAsync(v,d,this.name,(async(Q,n)=>{const T=d;if(T._meshOptData)return await T._meshOptData;const L=b.Get(`${v}/buffer`,this._loader.Qk.buffers,n.buffer);return T._meshOptData=this._loader.loadBufferAsync(`/buffers/${L.index}`,L,n.byteOffset||0,n.byteLength).then((async v=>await nv.Default.decodeGltfBufferAsync(v,n.count,n.byteStride,n.mode,n.filter))),await T._meshOptData}))}}t(Tv),k(Tv,!0,(v=>new Lv(v)));const ev="EXT_texture_webp";class Fv{constructor(v){this.name=ev,this._loader=v,this.enabled=v.isExtensionUsed(ev)}dispose(){this._loader=null}_loadTextureAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=void 0==d.sampler?s.DefaultSampler:b.Get(`${v}/sampler`,this._loader.Qk.samplers,d.sampler),e=b.Get(`${n}/source`,this._loader.Qk.images,T.source);return await this._loader._createTextureAsync(v,L,e,(v=>{Q(v)}),void 0,!d._textureInfo.nonColorData)}))}}t(ev),k(ev,!0,(v=>new Fv(v)));const rv="EXT_texture_avif";class Cv{constructor(v){this.name=rv,this._loader=v,this.enabled=v.isExtensionUsed(rv)}dispose(){this._loader=null}_loadTextureAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=void 0==d.sampler?s.DefaultSampler:b.Get(`${v}/sampler`,this._loader.Qk.samplers,d.sampler),e=b.Get(`${n}/source`,this._loader.Qk.images,T.source);return await this._loader._createTextureAsync(v,L,e,(v=>{Q(v)}),void 0,!d._textureInfo.nonColorData)}))}}t(rv),k(rv,!0,(v=>new Cv(v)));var uv=Q(12859),yv=Q(12023);const zv="EXT_lights_ies";class Bv{constructor(v){this.name=zv,this._loader=v,this.enabled=this._loader.isExtensionUsed(zv)}dispose(){this._loader=null,delete this._lights}onLoading(){const v=this._loader.Qk.extensions;if(v&&v[this.name]){const d=v[this.name];this._lights=d.lights,b.Assign(this._lights)}}loadNodeAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,e)=>{let F,r;this._loader._allMaterialsDirtyRequired=!0;const C=await this._loader.loadNodeAsync(v,d,(v=>{r=b.Get(n,this._lights,e.ab);const d=r.name||v.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,F=new uv.b(d,T.j.Zero(),T.j.Backward(),0,1,this._loader.babylonScene),F.angle=Math.PI/2,F.innerAngle=0,F._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,r._babylonLight=F,F.falloffType=yv.d.FALLOFF_GLTF,F.cb=e.color?L.c.dk(e.color):L.c.White(),F.o=e.multiplier||1,F.range=Number.MAX_VALUE,F.parent=v,this._loader._babylonLights.push(F),s.AddPointerMetadata(F,n),Q(v)}));let u;if(r.uri)u=await this._loader.loadUriAsync(v,r,r.uri);else{const d=b.Get(`${v}/bufferView`,this._loader.Qk.bufferViews,r.bufferView);u=await this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return F.iesProfileTexture=new f.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,u,!0,void 0,void 0,void 0,void 0,".ies"),C}))}}t(zv),k(zv,!0,(v=>new Bv(v)));var Xv=Q(12879);const mv="KHR_draco_mesh_compression";class Vv{constructor(v){this.name=mv,this.useNormalizedFlagFromAccessor=!0,this._loader=v,this.enabled=Xv.e.DefaultAvailable&&this._loader.isExtensionUsed(mv)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{if(void 0!=d.mode&&4!==d.mode&&5!==d.mode)throw new Error(`${v}: Unsupported mode ${d.mode}`);const L={},e={},F=(v,n)=>{const F=T.attributes[v];if(void 0!=F&&(Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(n)&&Q._delayInfo.push(n),L[n]=F,this.useNormalizedFlagFromAccessor)){const Q=b.TryGet(this._loader.Qk.accessors,d.attributes[v]);Q&&(e[n]=Q.normalized||!1)}};F("POSITION",O.e.PositionKind),F("NORMAL",O.e.NormalKind),F("TANGENT",O.e.TangentKind),F("TEXCOORD_0",O.e.UVKind),F("TEXCOORD_1",O.e.UV2Kind),F("TEXCOORD_2",O.e.UV3Kind),F("TEXCOORD_3",O.e.UV4Kind),F("TEXCOORD_4",O.e.UV5Kind),F("TEXCOORD_5",O.e.UV6Kind),F("JOINTS_0",O.e.MatricesIndicesKind),F("WEIGHTS_0",O.e.MatricesWeightsKind),F("COLOR_0",O.e.ColorKind);const r=b.Get(n,this._loader.Qk.bufferViews,T.bufferView);return r._dracoBabylonGeometry||(r._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((async n=>{const T=this.dracoDecoder||Xv.e.Default,F=b.TryGet(this._loader.Qk.accessors,d.attributes.POSITION),r=this._loader.parent.alwaysComputeBoundingBox||Q.skeleton||!F?null:H(F);return await T._decodeMeshToGeometryForGltfAsync(Q.name,this._loader.babylonScene,n,L,e,r).catch((d=>{throw new Error(`${v}: ${d.message}`)}))}))),await r._dracoBabylonGeometry}))}}t(mv),k(mv,!0,(v=>new Vv(v)));var hv=Q(12888),Sv=Q(620),Av=Q(629),fv=Q(669),Pv=Q(12074),Ov=Q(591);fv.d.AddNodeConstructor("Light_Type_0",((v,d)=>()=>new Jv(v,T.j.Zero(),d)));class Jv extends Pv.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(v){this._shadowAngle=v,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(v){const d=this.needCube();if(this._direction=v,this.needCube()!==d&&this._shadowGenerators){const v=this._shadowGenerators.values();for(let d=v.next();!0!==d.done;d=v.next()){d.value.recreateShadowMap()}}}constructor(v,d,Q){super(v,Q),this._shadowAngle=Math.PI/2,this.position=d}getClassName(){return"PointLight"}getTypeID(){return yv.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(v){if(this.direction)return super.getShadowDirection(v);switch(v){case 0:return new T.j(1,0,0);case 1:return new T.j(-1,0,0);case 2:return new T.j(0,-1,0);case 3:return new T.j(0,1,0);case 4:return new T.j(0,0,1);case 5:return new T.j(0,0,-1)}return T.j.Zero()}_setDefaultShadowProjectionMatrix(v,d,Q){const n=this.va().activeCamera;if(!n)return;const L=void 0!==this.shadowMinZ?this.shadowMinZ:n.$j,e=void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,F=this.va().getEngine().useReverseDepthBuffer;T.b.PerspectiveFovLHToRef(this.shadowAngle,1,F?e:L,F?L:e,v,!0,this._scene.getEngine().isNDCHalfZRange,void 0,F)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(v,d){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,d):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,d),this}transferToNodeMaterialEffect(v,d){return this.computeTransformedInformation()?v.setFloat3(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):v.setFloat3(d,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(v,d){v["POINTLIGHT"+d]=!0}}(0,Sv.b)([(0,Av.F)()],Jv.prototype,"shadowAngle",null),(0,Ov.f)("BABYLON.PointLight",Jv);const Kv="KHR_lights_punctual";class ov{constructor(v){this.name=Kv,this._loader=v,this.enabled=this._loader.isExtensionUsed(Kv)}dispose(){this._loader=null,delete this._lights}onLoading(){const v=this._loader.Qk.extensions;if(v&&v[this.name]){const d=v[this.name];this._lights=d.lights,b.Assign(this._lights)}}loadNodeAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,e)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(v,d,(v=>{let d;const F=b.Get(n,this._lights,e.ab),r=F.name||v.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,F.type){case"directional":{const v=new hv.b(r,T.j.Backward(),this._loader.babylonScene);v.position.gk(0),d=v;break}case"point":d=new Jv(r,T.j.Zero(),this._loader.babylonScene);break;case"spot":{const v=new uv.b(r,T.j.Zero(),T.j.Backward(),0,1,this._loader.babylonScene);v.angle=2*(F.spot&&F.spot.outerConeAngle||Math.PI/4),v.innerAngle=2*(F.spot&&F.spot.innerConeAngle||0),d=v;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${n}: Invalid light type (${F.type})`)}d._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,F._babylonLight=d,d.falloffType=yv.d.FALLOFF_GLTF,d.cb=F.color?L.c.dk(F.color):L.c.White(),d.o=void 0==F.o?1:F.o,d.range=void 0==F.range?Number.MAX_VALUE:F.range,d.parent=v,this._loader._babylonLights.push(d),s.AddPointerMetadata(d,n),Q(v)})))))}}t(Kv),k(Kv,!0,(v=>new ov(v)));const gv="KHR_materials_pbrSpecularGlossiness";class Rv{constructor(v){this.name=gv,this.order=200,this._loader=v,this.enabled=this._loader.isExtensionUsed(gv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialBasePropertiesAsync(v,d,Q)),L.push(this._loadSpecularGlossinessPropertiesAsync(n,T,Q)),this._loader.loadMaterialAlphaProperties(v,d,Q),await Promise.all(L).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return Q.metallic=null,Q.roughness=null,d.diffuseFactor?(Q.albedoColor=L.c.dk(d.diffuseFactor),Q.alpha=d.diffuseFactor[3]):Q.albedoColor=L.c.White(),Q.reflectivityColor=d.specularFactor?L.c.dk(d.specularFactor):L.c.White(),Q.microSurface=void 0==d.glossinessFactor?1:d.glossinessFactor,d.diffuseTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTexture`,d.diffuseTexture,(v=>{v.name=`${Q.name} (Diffuse)`,Q.albedoTexture=v}))),d.specularGlossinessTexture&&(n.push(this._loader.loadTextureInfoAsync(`${v}/specularGlossinessTexture`,d.specularGlossinessTexture,(v=>{v.name=`${Q.name} (Specular Glossiness)`,Q.reflectivityTexture=v,Q.reflectivityTexture.ui=!0}))),Q.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(n).then((()=>{}))}}t(gv),k(gv,!0,(v=>new Rv(v)));const Mv="KHR_materials_unlit";class Yv{constructor(v){this.name=Mv,this.order=210,this._loader=v,this.enabled=this._loader.isExtensionUsed(Mv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async()=>await this._loadUnlitPropertiesAsync(v,d,Q)))}_loadUnlitPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;Q.unlit=!0;const T=d.pbrMetallicRoughness;return T&&(T.baseColorFactor?(Q.albedoColor=L.c.dk(T.baseColorFactor),Q.alpha=T.baseColorFactor[3]):Q.albedoColor=L.c.White(),T.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/baseColorTexture`,T.baseColorTexture,(v=>{v.name=`${Q.name} (Base Color)`,Q.albedoTexture=v})))),d.doubleSided&&(Q.pk=!1,Q.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(v,d,Q),Promise.all(n).then((()=>{}))}}t(Mv),k(Mv,!0,(v=>new Yv(v)));const Dv="KHR_materials_clearcoat";class iv{constructor(v){this.name=Dv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Dv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadClearCoatPropertiesAsync(n,T,Q)),await Promise.all(L)}))}_loadClearCoatPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return Q.clearCoat.isEnabled=!0,Q.clearCoat.useRoughnessFromMainTexture=!1,Q.clearCoat.remapF0OnInterfaceChange=!1,void 0!=d.clearcoatFactor?Q.clearCoat.o=d.clearcoatFactor:Q.clearCoat.o=0,d.clearcoatTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatTexture`,d.clearcoatTexture,(v=>{v.name=`${Q.name} (ClearCoat)`,Q.clearCoat.texture=v}))),void 0!=d.clearcoatRoughnessFactor?Q.clearCoat.roughness=d.clearcoatRoughnessFactor:Q.clearCoat.roughness=0,d.clearcoatRoughnessTexture&&(d.clearcoatRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatRoughnessTexture`,d.clearcoatRoughnessTexture,(v=>{v.name=`${Q.name} (ClearCoat Roughness)`,Q.clearCoat.textureRoughness=v})))),d.clearcoatNormalTexture&&(d.clearcoatNormalTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatNormalTexture`,d.clearcoatNormalTexture,(v=>{v.name=`${Q.name} (ClearCoat Normal)`,Q.clearCoat.bumpTexture=v}))),Q.invertNormalMapX=!Q.va().useRightHandedSystem,Q.invertNormalMapY=Q.va().useRightHandedSystem,void 0!=d.clearcoatNormalTexture.scale&&(Q.clearCoat.bumpTexture.level=d.clearcoatNormalTexture.scale)),Promise.all(n).then((()=>{}))}}t(Dv),k(Dv,!0,(v=>new iv(v)));const Zv="KHR_materials_iridescence";class jv{constructor(v){this.name=Zv,this.order=195,this._loader=v,this.enabled=this._loader.isExtensionUsed(Zv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadIridescencePropertiesAsync(n,T,Q)),await Promise.all(L).then((()=>{}))}))}_loadIridescencePropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return Q.iridescence.isEnabled=!0,Q.iridescence.o=d.iridescenceFactor??0,Q.iridescence.indexOfRefraction=d.iridescenceIor??d.iridescenceIOR??1.3,Q.iridescence.minimumThickness=d.iridescenceThicknessMinimum??100,Q.iridescence.maximumThickness=d.iridescenceThicknessMaximum??400,d.iridescenceTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/iridescenceTexture`,d.iridescenceTexture,(v=>{v.name=`${Q.name} (Iridescence)`,Q.iridescence.texture=v}))),d.iridescenceThicknessTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/iridescenceThicknessTexture`,d.iridescenceThicknessTexture,(v=>{v.name=`${Q.name} (Iridescence Thickness)`,Q.iridescence.thicknessTexture=v}))),Promise.all(n).then((()=>{}))}}t(Zv),k(Zv,!0,(v=>new jv(v)));const xv="KHR_materials_anisotropy";class kv{constructor(v){this.name=xv,this.order=195,this._loader=v,this.enabled=this._loader.isExtensionUsed(xv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadIridescencePropertiesAsync(n,T,Q)),await Promise.all(L)}))}async _loadIridescencePropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;Q.anisotropy.isEnabled=!0,Q.anisotropy.o=d.anisotropyStrength??0,Q.anisotropy.angle=d.anisotropyRotation??0,d.anisotropyTexture&&(d.anisotropyTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${v}/anisotropyTexture`,d.anisotropyTexture,(v=>{v.name=`${Q.name} (Anisotropy Intensity)`,Q.anisotropy.texture=v})))),await Promise.all(n)}}t(xv),k(xv,!0,(v=>new kv(v)));const tv="KHR_materials_emissive_strength";class pv{constructor(v){this.name=tv,this.order=170,this._loader=v,this.enabled=this._loader.isExtensionUsed(tv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>await this._loader.loadMaterialPropertiesAsync(v,d,Q).then((()=>{this._loadEmissiveProperties(n,T,Q)}))))}_loadEmissiveProperties(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);void 0!==d.emissiveStrength&&(Q.emissiveIntensity=d.emissiveStrength)}}t(tv),k(tv,!0,(v=>new pv(v)));const Wv="KHR_materials_sheen";class qv{constructor(v){this.name=Wv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Wv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadSheenPropertiesAsync(n,T,Q)),await Promise.all(L).then((()=>{}))}))}_loadSheenPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return Q.sheen.isEnabled=!0,Q.sheen.o=1,void 0!=d.sheenColorFactor?Q.sheen.color=L.c.dk(d.sheenColorFactor):Q.sheen.color=L.c.Black(),d.sheenColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/sheenColorTexture`,d.sheenColorTexture,(v=>{v.name=`${Q.name} (Sheen Color)`,Q.sheen.texture=v}))),void 0!==d.sheenRoughnessFactor?Q.sheen.roughness=d.sheenRoughnessFactor:Q.sheen.roughness=0,d.sheenRoughnessTexture&&(d.sheenRoughnessTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${v}/sheenRoughnessTexture`,d.sheenRoughnessTexture,(v=>{v.name=`${Q.name} (Sheen Roughness)`,Q.sheen.textureRoughness=v})))),Q.sheen.albedoScaling=!0,Q.sheen.useRoughnessFromMainTexture=!1,Promise.all(n).then((()=>{}))}}t(Wv),k(Wv,!0,(v=>new qv(v)));var bv=Q(11913);const Hv="KHR_materials_specular";class sv{constructor(v){this.name=Hv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Hv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;if(L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadSpecularPropertiesAsync(n,T,Q)),T.extensions&&T.extensions.EXT_materials_specular_edge_color&&Q instanceof A.d){T.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(Q.brdf.dielectricSpecularModel=bv.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,Q.brdf.conductorSpecularModel=bv.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(L).then((()=>{}))}))}_loadSpecularPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return void 0!==d.specularFactor&&(Q.metallicF0Factor=d.specularFactor),void 0!==d.specularColorFactor&&(Q.metallicReflectanceColor=L.c.dk(d.specularColorFactor)),d.specularTexture&&(d.specularTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${v}/specularTexture`,d.specularTexture,(v=>{v.name=`${Q.name} (Specular)`,Q.metallicReflectanceTexture=v,Q.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),d.specularColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/specularColorTexture`,d.specularColorTexture,(v=>{v.name=`${Q.name} (Specular Color)`,Q.reflectanceTexture=v}))),Promise.all(n).then((()=>{}))}}t(Hv),k(Hv,!0,(v=>new sv(v)));const av="KHR_materials_ior";class Iv{constructor(v){this.name=av,this.order=180,this._loader=v,this.enabled=this._loader.isExtensionUsed(av)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadIorPropertiesAsync(n,T,Q)),await Promise.all(L).then((()=>{}))}))}_loadIorPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);return void 0!==d.ior?Q.indexOfRefraction=d.ior:Q.indexOfRefraction=Iv._DEFAULT_IOR,Promise.resolve()}}Iv._DEFAULT_IOR=1.5,t(av),k(av,!0,(v=>new Iv(v)));const Uv="KHR_materials_variants";class cv{constructor(v){this.name=Uv,this._loader=v,this.enabled=this._loader.isExtensionUsed(Uv)}dispose(){this._loader=null}static GetAvailableVariants(v){const d=this._GetExtensionMetadata(v);return d?Object.keys(d.variants):[]}getAvailableVariants(v){return cv.GetAvailableVariants(v)}static SelectVariant(v,d){const Q=this._GetExtensionMetadata(v);if(!Q)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Uv} extension`);const n=v=>{const d=Q.variants[v];if(d)for(const Q of d)Q.mesh.material=Q.material};if(d instanceof Array)for(const T of d)n(T);else n(d);Q.lastSelected=d}selectVariant(v,d){cv.SelectVariant(v,d)}static Reset(v){const d=this._GetExtensionMetadata(v);if(!d)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Uv} extension`);for(const Q of d.original)Q.mesh.material=Q.material;d.lastSelected=null}reset(v){cv.Reset(v)}static GetLastSelectedVariant(v){const d=this._GetExtensionMetadata(v);if(!d)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Uv} extension`);return d.lastSelected}getLastSelectedVariant(v){return cv.GetLastSelectedVariant(v)}static _GetExtensionMetadata(v){var d,Q;return(null===v||void 0===v||null===(d=v._internalMetadata)||void 0===d||null===(Q=d.Qk)||void 0===Q?void 0:Q[Uv])||null}onLoading(){const v=this._loader.Qk.extensions;if(v&&v[this.name]){const d=v[this.name];this._variants=d.variants}}onReady(){const v=this._loader.rootBabylonMesh;if(v){var d;const Q=this._loader.parent.extensionOptions[Uv];null!==Q&&void 0!==Q&&Q.defaultVariant&&cv.SelectVariant(v,Q.defaultVariant),null===Q||void 0===Q||null===(d=Q.onLoaded)||void 0===d||d.call(Q,{get variants(){return cv.GetAvailableVariants(v)},get selectedVariant(){const d=cv.GetLastSelectedVariant(v);return d?Array.isArray(d)?d[0]:d:cv.GetAvailableVariants(v)[0]},set selectedVariant(d){cv.SelectVariant(v,d)}})}}_loadMeshPrimitiveAsync(v,d,Q,n,T,L){return s.LoadExtensionAsync(v,T,this.name,(async(e,F)=>{const r=new Array;return r.push(this._loader._loadMeshPrimitiveAsync(v,d,Q,n,T,(d=>{if(L(d),d instanceof o.b){const Q=s._GetDrawMode(v,T.mode),n=this._loader.rootBabylonMesh,L=n?n._internalMetadata=n._internalMetadata||{}:{},C=L.Qk=L.Qk||{},u=C[Uv]=C[Uv]||{lastSelected:null,original:[],variants:{}};u.original.push({mesh:d,material:d.material});for(let v=0;v<F.mappings.length;++v){const T=F.mappings[v],L=b.Get(`${e}/mappings/${v}/material`,this._loader.Qk.materials,T.material);r.push(this._loader._loadMaterialAsync(`#/materials/${T.material}`,L,d,Q,(v=>{for(let Q=0;Q<T.variants.length;++Q){const L=T.variants[Q],e=b.Get(`/extensions/${Uv}/variants/${L}`,this._variants,L);u.variants[e.name]=u.variants[e.name]||[],u.variants[e.name].push({mesh:d,material:v}),d.onClonedObservable.add((v=>{const Q=v;let T=null,L=Q;do{if(L=L.parent,!L)return;T=cv._GetExtensionMetadata(L)}while(null===T);if(n&&T===cv._GetExtensionMetadata(n)){L._internalMetadata={};for(const v in n._internalMetadata)L._internalMetadata[v]=n._internalMetadata[v];L._internalMetadata.Qk=[];for(const v in n._internalMetadata.Qk)L._internalMetadata.Qk[v]=n._internalMetadata.Qk[v];L._internalMetadata.Qk[Uv]={lastSelected:null,original:[],variants:{}};for(const v of T.original)L._internalMetadata.Qk[Uv].original.push({mesh:v.mesh,material:v.material});for(const v in T.variants)if(Object.prototype.hasOwnProperty.call(T.variants,v)){L._internalMetadata.Qk[Uv].variants[v]=[];for(const d of T.variants[v])L._internalMetadata.Qk[Uv].variants[v].push({mesh:d.mesh,material:d.material})}T=L._internalMetadata.Qk[Uv]}for(const n of T.original)n.mesh===d&&(n.mesh=Q);for(const n of T.variants[e.name])n.mesh===d&&(n.mesh=Q)}))}})))}}}))),await Promise.all(r).then((v=>{let[d]=v;return d}))}))}}t(Uv),k(Uv,!0,(v=>new cv(v)));var wv=Q(2053);class Gv{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:bv.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(v,d){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Gv._GetDefaultOptions(),...v},this._scene=d,this._scene._transmissionHelper=this,this.onErrorObservable=new u.e,this._scene.kk.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(v){if(!Object.keys(v).filter((d=>this._options[d]!==v[d])).length)return;const d={...this._options,...v},Q=this._options;this._options=d,d.renderSize===Q.renderSize&&d.renderTargetTextureType===Q.renderTargetTextureType&&d.generateMipmaps===Q.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=d.samples,this._opaqueRenderTarget.lodGenerationScale=d.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=d.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(v){return!!v&&!!(v instanceof A.d&&v.subSurface.isRefractionEnabled)}_addMesh(v){this._materialObservers[v.uniqueId]=v.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),e.e.SetImmediate((()=>{this._shouldRenderAsTransmission(v.material)?(v.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(v)&&this._transparentMeshesCache.push(v)):-1===this._opaqueMeshesCache.indexOf(v)&&this._opaqueMeshesCache.push(v)}))}_removeMesh(v){v.onMaterialChangedObservable.remove(this._materialObservers[v.uniqueId]),delete this._materialObservers[v.uniqueId];let d=this._transparentMeshesCache.indexOf(v);-1!==d&&this._transparentMeshesCache.splice(d,1),d=this._opaqueMeshesCache.indexOf(v),-1!==d&&this._opaqueMeshesCache.splice(d,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(v){const d=this._transparentMeshesCache.indexOf(v),Q=this._opaqueMeshesCache.indexOf(v);this._shouldRenderAsTransmission(v.material)?(v.material instanceof A.d&&(v.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Q?(this._opaqueMeshesCache.splice(Q,1),this._transparentMeshesCache.push(v)):-1===d&&this._transparentMeshesCache.push(v)):-1!==d?(this._transparentMeshesCache.splice(d,1),this._opaqueMeshesCache.push(v)):-1===Q&&this._opaqueMeshesCache.push(v)}_isRenderTargetValid(){var v;return null!==(null===(v=this._opaqueRenderTarget)||void 0===v?void 0:v.getInternalTexture())}_setupRenderTargets(){var v;let d;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new wv.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(v=this._options.clearColor)||void 0===v?void 0:v.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((v=>{d=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?v.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(v.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=d}));for(const Q of this._transparentMeshesCache)this._shouldRenderAsTransmission(Q.material)&&(Q.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Ev="KHR_materials_transmission";class Nv{constructor(v){this.name=Ev,this.order=175,this._loader=v,this.enabled=this._loader.isExtensionUsed(Ev),this.enabled&&(v.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadTransparentPropertiesAsync(n,d,Q,T)),await Promise.all(L).then((()=>{}))}))}_loadTransparentPropertiesAsync(v,d,Q,n){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const T=Q;if(T.subSurface.isRefractionEnabled=!0,T.subSurface.volumeIndexOfRefraction=1,T.subSurface.useAlbedoToTintRefraction=!0,void 0===n.transmissionFactor)return T.subSurface.refractionIntensity=0,T.subSurface.isRefractionEnabled=!1,Promise.resolve();{var L;T.subSurface.refractionIntensity=n.transmissionFactor;const v=T.va();if(T.subSurface.refractionIntensity&&!v._transmissionHelper)new Gv({},T.va());else if(T.subSurface.refractionIntensity&&(null===(L=v._transmissionHelper)||void 0===L||!L._isRenderTargetValid())){var e;null===(e=v._transmissionHelper)||void 0===e||e._setupRenderTargets()}}return T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=0,n.transmissionTexture?(n.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${v}/transmissionTexture`,n.transmissionTexture,void 0).then((v=>{v.name=`${Q.name} (Transmission)`,T.subSurface.refractionIntensityTexture=v,T.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(Ev),k(Ev,!0,(v=>new Nv(v)));const lv="KHR_materials_diffuse_transmission";class vd{constructor(v){this.name=lv,this.order=174,this._loader=v,this.enabled=this._loader.isExtensionUsed(lv),this.enabled&&(v.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadTranslucentPropertiesAsync(n,d,Q,T)),await Promise.all(L).then((()=>{}))}))}_loadTranslucentPropertiesAsync(v,d,Q,n){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const T=Q;if(T.subSurface.isTranslucencyEnabled=!0,T.subSurface.volumeIndexOfRefraction=1,T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=0,T.subSurface.useAlbedoToTintTranslucency=!1,void 0===n.diffuseTransmissionFactor)return T.subSurface.translucencyIntensity=0,T.subSurface.isTranslucencyEnabled=!1,Promise.resolve();T.subSurface.translucencyIntensity=n.diffuseTransmissionFactor;const e=new Array;return T.subSurface.useGltfStyleTextures=!0,n.diffuseTransmissionTexture&&(n.diffuseTransmissionTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTransmissionTexture`,n.diffuseTransmissionTexture).then((v=>{v.name=`${Q.name} (Diffuse Transmission)`,T.subSurface.translucencyIntensityTexture=v})))),void 0!==n.diffuseTransmissionColorFactor?T.subSurface.translucencyColor=L.c.dk(n.diffuseTransmissionColorFactor):T.subSurface.translucencyColor=L.c.White(),n.diffuseTransmissionColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTransmissionColorTexture`,n.diffuseTransmissionColorTexture).then((v=>{v.name=`${Q.name} (Diffuse Transmission Color)`,T.subSurface.translucencyColorTexture=v}))),Promise.all(e).then((()=>{}))}}t(lv),k(lv,!0,(v=>new vd(v)));const dd="KHR_materials_volume";class Qd{constructor(v){this.name=dd,this.order=173,this._loader=v,this.enabled=this._loader.isExtensionUsed(dd),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadVolumePropertiesAsync(n,d,Q,T)),await Promise.all(L).then((()=>{}))}))}_loadVolumePropertiesAsync(v,d,Q,n){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);if(!Q.subSurface.isRefractionEnabled&&!Q.subSurface.isTranslucencyEnabled||!n.thicknessFactor)return Promise.resolve();Q.subSurface.volumeIndexOfRefraction=Q.indexOfRefraction;const T=void 0!==n.attenuationDistance?n.attenuationDistance:Number.MAX_VALUE;return Q.subSurface.tintColorAtDistance=T,void 0!==n.attenuationColor&&3==n.attenuationColor.length&&Q.subSurface.tintColor.ld(n.attenuationColor[0],n.attenuationColor[1],n.attenuationColor[2]),Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=n.thicknessFactor,Q.subSurface.useThicknessAsDepth=!0,n.thicknessTexture?(n.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${v}/thicknessTexture`,n.thicknessTexture).then((v=>{v.name=`${Q.name} (Thickness)`,Q.subSurface.thicknessTexture=v,Q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(dd),k(dd,!0,(v=>new Qd(v)));const nd="KHR_materials_dispersion";class Td{constructor(v){this.name=nd,this.order=174,this._loader=v,this.enabled=this._loader.isExtensionUsed(nd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadDispersionPropertiesAsync(n,d,Q,T)),await Promise.all(L).then((()=>{}))}))}_loadDispersionPropertiesAsync(v,d,Q,n){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);return Q.subSurface.isRefractionEnabled&&n.dispersion?(Q.subSurface.isDispersionEnabled=!0,Q.subSurface.dispersion=n.dispersion,Promise.resolve()):Promise.resolve()}}t(nd),k(nd,!0,(v=>new Td(v)));const Ld="EXT_materials_diffuse_roughness";class ed{constructor(v){this.name=Ld,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Ld)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(v,d,Q)),L.push(this._loadDiffuseRoughnessPropertiesAsync(n,T,Q)),await Promise.all(L).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(v,d,Q){if(!(Q instanceof A.d))throw new Error(`${v}: Material type not supported`);const n=new Array;return Q.brdf.baseDiffuseModel=bv.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=d.diffuseRoughnessFactor?Q.baseDiffuseRoughness=d.diffuseRoughnessFactor:Q.baseDiffuseRoughness=0,d.diffuseRoughnessTexture&&n.push(this._loader.loadTextureInfoAsync(`${v}/diffuseRoughnessTexture`,d.diffuseRoughnessTexture,(v=>{v.name=`${Q.name} (Diffuse Roughness)`,Q.baseDiffuseRoughnessTexture=v}))),Promise.all(n).then((()=>{}))}}t(Ld),k(Ld,!0,(v=>new ed(v)));const Fd="KHR_mesh_quantization";class rd{constructor(v){this.name=Fd,this.enabled=v.isExtensionUsed(Fd)}dispose(){}}t(Fd),k(Fd,!0,(v=>new rd(v)));const Cd="KHR_texture_basisu";class ud{constructor(v){this.name=Cd,this._loader=v,this.enabled=v.isExtensionUsed(Cd)}dispose(){this._loader=null}_loadTextureAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>{const L=void 0==d.sampler?s.DefaultSampler:b.Get(`${v}/sampler`,this._loader.Qk.samplers,d.sampler),e=b.Get(`${n}/source`,this._loader.Qk.images,T.source);return await this._loader._createTextureAsync(v,L,e,(v=>{Q(v)}),d._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!d._textureInfo.nonColorData)}))}}t(Cd),k(Cd,!0,(v=>new ud(v)));const yd="KHR_texture_transform";class zd{constructor(v){this.name=yd,this._loader=v,this.enabled=this._loader.isExtensionUsed(yd)}dispose(){this._loader=null}loadTextureInfoAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(n,T)=>await this._loader.loadTextureInfoAsync(v,d,(v=>{if(!(v instanceof f.e))throw new Error(`${n}: Texture type not supported`);T.offset&&(v.uOffset=T.offset[0],v.vOffset=T.offset[1]),v.uRotationCenter=0,v.vRotationCenter=0,T.rotation&&(v.wAng=-T.rotation),T.scale&&(v.uScale=T.scale[0],v.vScale=T.scale[1]),void 0!=T.texCoord&&(v.coordinatesIndex=T.texCoord),Q(v)}))))}}t(yd),k(yd,!0,(v=>new zd(v)));const Bd="KHR_xmp_json_ld";class Xd{constructor(v){this.name=Bd,this.order=100,this._loader=v,this.enabled=this._loader.isExtensionUsed(Bd)}dispose(){this._loader=null}onLoading(){var v,d,Q;if(null===this._loader.rootBabylonMesh)return;const n=null===(v=this._loader.Qk.extensions)||void 0===v?void 0:v.KHR_xmp_json_ld,T=null===(d=this._loader.Qk.asset)||void 0===d||null===(Q=d.extensions)||void 0===Q?void 0:Q.KHR_xmp_json_ld;if(n&&T){const v=+T.packet;n.packets&&v<n.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=n.packets[v])}}}function md(v,d,Q,n){return L.c.dk(d,Q).scale(n)}function Vd(v,d,Q,n){return d[Q]*n}function hd(v,d,Q,n){return-d[Q]*n}function Sd(v,d,Q,n){return d[Q+1]*n}function Ad(v,d,Q,n){return d[Q]*n*2}function fd(v){return{scale:[new Od(z.d.ANIMATIONTYPE_FLOAT,`${v}.uScale`,Vd,(()=>2)),new Od(z.d.ANIMATIONTYPE_FLOAT,`${v}.vScale`,Sd,(()=>2))],offset:[new Od(z.d.ANIMATIONTYPE_FLOAT,`${v}.uOffset`,Vd,(()=>2)),new Od(z.d.ANIMATIONTYPE_FLOAT,`${v}.vOffset`,Sd,(()=>2))],rotation:[new Od(z.d.ANIMATIONTYPE_FLOAT,`${v}.wAng`,hd,(()=>1))]}}t(Bd),k(Bd,!0,(v=>new Xd(v)));class Pd extends a.AnimationPropertyInfo{buildAnimations(v,d,Q,n){return[{babylonAnimatable:v._babylonCamera,babylonAnimation:this._buildAnimation(d,Q,n)}]}}class Od extends a.AnimationPropertyInfo{buildAnimations(v,d,Q,n){const T=[];for(const L in v._data)T.push({babylonAnimatable:v._data[L].babylonMaterial,babylonAnimation:this._buildAnimation(d,Q,n)});return T}}class Jd extends a.AnimationPropertyInfo{buildAnimations(v,d,Q,n){return[{babylonAnimatable:v._babylonLight,babylonAnimation:this._buildAnimation(d,Q,n)}]}}(0,p.k)("/cameras/{}/orthographic/xmag",[new Pd(z.d.ANIMATIONTYPE_FLOAT,"orthoLeft",hd,(()=>1)),new Pd(z.d.ANIMATIONTYPE_FLOAT,"orthoRight",Sd,(()=>1))]),(0,p.k)("/cameras/{}/orthographic/ymag",[new Pd(z.d.ANIMATIONTYPE_FLOAT,"orthoBottom",hd,(()=>1)),new Pd(z.d.ANIMATIONTYPE_FLOAT,"orthoTop",Sd,(()=>1))]),(0,p.k)("/cameras/{}/orthographic/zfar",[new Pd(z.d.ANIMATIONTYPE_FLOAT,"maxZ",Vd,(()=>1))]),(0,p.k)("/cameras/{}/orthographic/znear",[new Pd(z.d.ANIMATIONTYPE_FLOAT,"$j",Vd,(()=>1))]),(0,p.k)("/cameras/{}/perspective/yfov",[new Pd(z.d.ANIMATIONTYPE_FLOAT,"fov",Vd,(()=>1))]),(0,p.k)("/cameras/{}/perspective/zfar",[new Pd(z.d.ANIMATIONTYPE_FLOAT,"maxZ",Vd,(()=>1))]),(0,p.k)("/cameras/{}/perspective/znear",[new Pd(z.d.ANIMATIONTYPE_FLOAT,"$j",Vd,(()=>1))]),(0,p.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Od(z.d.ANIMATIONTYPE_COLOR3,"albedoColor",md,(()=>4)),new Od(z.d.ANIMATIONTYPE_FLOAT,"alpha",(function(v,d,Q,n){return d[Q+3]*n}),(()=>4))]),(0,p.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"metallic",Vd,(()=>1))]),(0,p.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"roughness",Vd,(()=>1))]);const Kd=fd("albedoTexture");(0,p.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Kd.scale),(0,p.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Kd.offset),(0,p.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Kd.rotation);const od=fd("metallicTexture");(0,p.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",od.scale),(0,p.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",od.offset),(0,p.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",od.rotation),(0,p.k)("/materials/{}/emissiveFactor",[new Od(z.d.ANIMATIONTYPE_COLOR3,"emissiveColor",md,(()=>3))]);const gd=fd("bumpTexture");(0,p.k)("/materials/{}/normalTexture/scale",[new Od(z.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Vd,(()=>1))]),(0,p.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",gd.scale),(0,p.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",gd.offset),(0,p.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",gd.rotation),(0,p.k)("/materials/{}/occlusionTexture/strength",[new Od(z.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Vd,(()=>1))]);const Rd=fd("ambientTexture");(0,p.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Rd.scale),(0,p.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Rd.offset),(0,p.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Rd.rotation);const Md=fd("emissiveTexture");(0,p.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Md.scale),(0,p.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Md.offset),(0,p.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Md.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Od(z.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Od(z.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Vd,(()=>1))]);const Yd=fd("anisotropy.texture");(0,p.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Yd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Yd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Yd.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Vd,(()=>1))]);const Dd=fd("clearCoat.texture");(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Dd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Dd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Dd.rotation);const id=fd("clearCoat.bumpTexture");(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Od(z.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",id.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",id.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",id.rotation);const Zd=fd("clearCoat.textureRoughness");(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Zd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Zd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Zd.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Od(z.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new Od(z.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Od(z.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Od(z.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Vd,(()=>1))]);const jd=fd("iridescence.texture");(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",jd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",jd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",jd.rotation);const xd=fd("iridescence.thicknessTexture");(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",xd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",xd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",xd.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Od(z.d.ANIMATIONTYPE_COLOR3,"sheen.color",md,(()=>3))]),(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",Vd,(()=>1))]);const kd=fd("sheen.texture");(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",kd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",kd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",kd.rotation);const td=fd("sheen.textureRoughness");(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",td.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",td.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",td.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Od(z.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",md,(()=>3))]);const pd=fd("metallicReflectanceTexture");(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",pd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",pd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",pd.rotation);const Wd=fd("reflectanceTexture");(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Wd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Wd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Wd.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Vd,(()=>1))]);const qd=fd("subSurface.refractionIntensityTexture");(0,p.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",qd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",qd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",qd.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Od(z.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",md,(()=>3))]),(0,p.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Od(z.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Vd,(()=>1))]),(0,p.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Vd,(()=>1))]);const bd=fd("subSurface.thicknessTexture");(0,p.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",bd.scale),(0,p.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",bd.offset),(0,p.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",bd.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Od(z.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Vd,(()=>1))]);const Hd=fd("subSurface.translucencyIntensityTexture");(0,p.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Hd.scale),(0,p.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Hd.offset),(0,p.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Hd.rotation),(0,p.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Od(z.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",md,(()=>3))]);const sd=fd("subSurface.translucencyColorTexture");(0,p.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",sd.scale),(0,p.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",sd.offset),(0,p.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",sd.rotation),(0,p.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new Jd(z.d.ANIMATIONTYPE_COLOR3,"diffuse",md,(()=>3))]),(0,p.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Jd(z.d.ANIMATIONTYPE_FLOAT,"intensity",Vd,(()=>1))]),(0,p.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new Jd(z.d.ANIMATIONTYPE_FLOAT,"range",Vd,(()=>1))]),(0,p.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Jd(z.d.ANIMATIONTYPE_FLOAT,"innerAngle",Ad,(()=>1))]),(0,p.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Jd(z.d.ANIMATIONTYPE_FLOAT,"angle",Ad,(()=>1))]),(0,p.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new Jd(z.d.ANIMATIONTYPE_COLOR3,"diffuse",md,(()=>3))]),(0,p.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Jd(z.d.ANIMATIONTYPE_FLOAT,"intensity",Vd,(()=>1))]);const ad="KHR_animation_pointer";class Id{constructor(v){this.name=ad,this._loader=v,this._pathToObjectConverter=(0,p.j)(this._loader.Qk)}get enabled(){return this._loader.isExtensionUsed(ad)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(v,d,Q,n,T){var L;const e=null===(L=n.target.extensions)||void 0===L?void 0:L.KHR_animation_pointer;if(!e||!this._pathToObjectConverter)return null;"pointer"!==n.target.path&&m.d.Warn(`${v}/target/path: Value (${n.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=n.target.node&&m.d.Warn(`${v}/target/node: Value (${n.target.node}) must not be present when using the ${this.name} extension`);const F=`${v}/extensions/${this.name}`,r=e.pointer;if(!r)throw new Error(`${F}: Pointer is missing`);try{const L=this._pathToObjectConverter.convert(r);if(!L.info.interpolation)throw new Error(`${F}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(v,d,Q,n,{object:L.object,info:L.info.interpolation},T)}catch(C){return m.d.Warn(`${F}/pointer: Invalid pointer (${r}) skipped`),null}}}t(ad),k(ad,!0,(v=>new Id(v)));class Ud{constructor(v,d,Q){this.frame=v,this.action=d,this.onlyOnce=Q,this.isDone=!1}_clone(){return new Ud(this.frame,this.action,this.onlyOnce)}}var cd=Q(497),wd=Q(544),Gd=Q(539);class Ed{get loop(){return this._loop}set loop(v){v!==this._loop&&(this._loop=v,this.updateOptions({loop:v}))}get currentTime(){var v;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(v=wd.d.audioEngine)&&void 0!==v&&v.audioContext&&(this.isPlaying||this.isPaused)){const v=this.isPaused?0:wd.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+v}return 0}get spatialSound(){return this._spatialSound}set spatialSound(v){if(v==this._spatialSound)return;const d=this.isPlaying;this.pause(),v?(this._spatialSound=v,this._updateSpatialParameters()):this._disableSpatialSound(),d&&this.play()}constructor(v,d,Q){var n;let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new u.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=T.j.Zero(),this._localDirection=new T.j(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=v,Q=Q||X.c.LastCreatedScene)if(this._scene=Q,Ed._SceneComponentInitialization(Q),this._readyToPlayCallback=L,this._customAttenuationFunction=(v,d,Q,n,T)=>d<Q?v*(1-d/Q):0,F&&(this.autoplay=F.autoplay||!1,this._loop=F.loop||!1,void 0!==F.volume&&(this._volume=F.volume),this._spatialSound=F.spatialSound??!1,this.maxDistance=F.maxDistance??100,this.useCustomAttenuation=F.useCustomAttenuation??!1,this.rolloffFactor=F.rolloffFactor||1,this.refDistance=F.refDistance||1,this.distanceModel=F.distanceModel||"linear",this._playbackRate=F.playbackRate||1,this._streaming=F.streaming??!1,this._length=F.length,this._offset=F.offset),null!==(n=wd.d.audioEngine)&&void 0!==n&&n.canUseWebAudio&&wd.d.audioEngine.audioContext){this._soundGain=wd.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let v=!0;if(d)try{"string"===typeof d?(this._urlType="String",this._url=d):d instanceof ArrayBuffer?this._urlType="ArrayBuffer":d instanceof HTMLMediaElement?this._urlType="MediaElement":d instanceof MediaStream?this._urlType="MediaStream":d instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(d)&&(this._urlType="Array");let Q=[],n=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wd.d.audioEngine.audioContext.createMediaElementSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wd.d.audioEngine.audioContext.createMediaStreamSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":d.byteLength>0&&(n=!0,this._soundLoaded(d));break;case"AudioBuffer":this._audioBufferLoaded(d);break;case"String":Q.push(d);case"Array":0===Q.length&&(Q=d);for(let v=0;v<Q.length;v++){const d=Q[v];if(n=F&&F.skipCodecCheck||-1!==d.indexOf(".mp3",d.length-4)&&wd.d.audioEngine.isMP3supported||-1!==d.indexOf(".ogg",d.length-4)&&wd.d.audioEngine.isOGGsupported||-1!==d.indexOf(".wav",d.length-4)||-1!==d.indexOf(".m4a",d.length-4)||-1!==d.indexOf(".mp4",d.length-4)||-1!==d.indexOf("blob:"),n){this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,e.e.SetCorsBehavior(d,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(d,(v=>{this._soundLoaded(v)}),void 0,!0,!0,(v=>{v&&m.d.Error("XHR "+v.status+" error on: "+d+"."),m.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:v=!1}v?n||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):m.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(r){m.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),wd.d.audioEngine&&!wd.d.audioEngine.WarnedWebAudioUnsupported&&(m.d.Error("Web Audio is not supported by your browser."),wd.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var v;null!==(v=wd.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(v){var d;null!==(d=wd.d.audioEngine)&&void 0!==d&&d.audioContext&&(this._audioBuffer=v,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(v){var d;null!==(d=wd.d.audioEngine)&&void 0!==d&&d.audioContext&&wd.d.audioEngine.audioContext.decodeAudioData(v,(v=>{this._audioBufferLoaded(v)}),(v=>{m.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+v)}))}setAudioBuffer(v){var d;null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&(this._audioBuffer=v,this._isReadyToPlay=!0)}updateOptions(v){v&&(this.loop=v.loop??this.loop,this.maxDistance=v.maxDistance??this.maxDistance,this.useCustomAttenuation=v.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=v.rolloffFactor??this.rolloffFactor,this.refDistance=v.refDistance??this.refDistance,this.distanceModel=v.distanceModel??this.distanceModel,this._playbackRate=v.playbackRate??this._playbackRate,this._length=v.length??void 0,this.spatialSound=v.spatialSound??this._spatialSound,this._setOffset(v.offset??void 0),this.setVolume(v.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var v;null!==(v=wd.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&wd.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??wd.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var v;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(v=this._soundPanner)||void 0===v||v.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var v;null!==(v=wd.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(v){var d;null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(v),this._isOutputConnected=!0)}setDirectionalCone(v,d,Q){d<v?m.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=v,this._coneOuterAngle=d,this._coneOuterGain=Q,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(v){if(v!=this._coneInnerAngle){var d;if(this._coneOuterAngle<v)return void m.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=v,null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(v){if(v!=this._coneOuterAngle){var d;if(v<this._coneInnerAngle)return void m.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=v,null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(v){var d;v.equals(this._position)||(this._position.p(v),null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(v){var d;this._localDirection=v,null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const v=this._connectedTransformNode.getWorldMatrix(),d=T.j.TransformNormal(this._localDirection,v);d.normalize(),this._soundPanner.orientationX.value=d.x,this._soundPanner.orientationY.value=d.y,this._soundPanner.orientationZ.value=d.z}updateDistanceFromListener(){var v;if(null!==(v=wd.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const v=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Wd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,v,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(v){this._customAttenuationFunction=v}play(v,d,Q){var n;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(n=wd.d.audioEngine)&&void 0!==n&&n.audioContext)try{var T,L;this._clearTimeoutsAndObservers();let n=v?(null===(T=wd.d.audioEngine)||void 0===T?void 0:T.audioContext.currentTime)+v:null===(L=wd.d.audioEngine)||void 0===L?void 0:L.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=wd.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const v=()=>{var Q;if(null!==(Q=wd.d.audioEngine)&&void 0!==Q&&Q.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=d??0;const Q=this._htmlAudioElement.play();void 0!==Q&&Q.catch((()=>{var d,Q;(null===(d=wd.d.audioEngine)||void 0===d||d.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Q=wd.d.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{v()})))}))}else{var n;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(n=wd.d.audioEngine)||void 0===n?void 0:n.onAudioUnlockedObservable.addOnce((()=>{v()}))}};v()}}else{var e;const T=()=>{var T;if(null!==(T=wd.d.audioEngine)&&void 0!==T&&T.audioContext){var L;if(Q=Q||this._length,void 0!==d&&this._setOffset(d),this._soundSource){const v=this._soundSource;v.onended=()=>{v.disconnect()}}if(this._soundSource=null===(L=wd.d.audioEngine)||void 0===L?void 0:L.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var e;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==d&&(this._soundSource.loopStart=d),void 0!==Q&&(this._soundSource.loopEnd=(0|d)+Q),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},n=v?(null===(e=wd.d.audioEngine)||void 0===e?void 0:e.audioContext.currentTime)+v:wd.d.audioEngine.audioContext.currentTime;const T=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(n,T,this.loop?void 0:Q)}}};"suspended"===(null===(e=wd.d.audioEngine)||void 0===e?void 0:e.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var v;"suspended"===(null===(v=wd.d.audioEngine)||void 0===v?void 0:v.audioContext.state)?(wd.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=wd.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{T()})))):T()}),500):T()}this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(F){m.d.Error("Error while trying to play audio: "+this.name+", "+F.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(v){var d;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Q;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Q=this._streamingSource)||void 0===Q||Q.disconnect();this.isPlaying=!1}else if(null!==(d=wd.d.audioEngine)&&void 0!==d&&d.audioContext&&this._soundSource){const d=v?wd.d.audioEngine.audioContext.currentTime+v:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(d)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var v;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(v=wd.d.audioEngine)&&void 0!==v&&v.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=wd.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(v,d){var Q;null!==(Q=wd.d.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._soundGain&&(d&&wd.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(wd.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,wd.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(v,wd.d.audioEngine.audioContext.currentTime+d)):this._soundGain.gain.value=v),this._volume=v}setPlaybackRate(v){this._playbackRate=v,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(v){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=v,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=v=>this._onRegisterAfterWorldMatrixUpdate(v),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(v){var d;if(v.getBoundingInfo){const d=v.getBoundingInfo();this.setPosition(d.boundingSphere.centerWorld)}else this.setPosition(v.absolutePosition);null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const v=()=>{(0,Gd.f)((()=>this._isReadyToPlay),(()=>{Q._audioBuffer=this.getAudioBuffer(),Q._isReadyToPlay=!0,Q.autoplay&&Q.play(0,this._offset,this._length)}),void 0,300)},d={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Q=new Ed(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,d);return this.useCustomAttenuation&&Q.setAttenuationFunction(this._customAttenuationFunction),Q.setPosition(this._position),Q.setPlaybackRate(this._playbackRate),v(),Q}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const v={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(v.connectedMeshId=this._connectedTransformNode.id),v.position=this._position.mk(),v.refDistance=this.refDistance,v.distanceModel=this.distanceModel,v.isDirectional=this._isDirectional,v.localDirectionToMesh=this._localDirection.mk(),v.coneInnerAngle=this._coneInnerAngle,v.coneOuterAngle=this._coneOuterAngle,v.coneOuterGain=this._coneOuterGain),v}static Parse(v,d,Q,n){const L=v.name;let e;e=v.url?Q+v.url:Q+L;const F={autoplay:v.autoplay,loop:v.loop,volume:v.volume,spatialSound:v.spatialSound,maxDistance:v.maxDistance,rolloffFactor:v.rolloffFactor,refDistance:v.refDistance,distanceModel:v.distanceModel,playbackRate:v.playbackRate};let r;if(n){const v=()=>{(0,Gd.f)((()=>n._isReadyToPlay),(()=>{r._audioBuffer=n.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play(0,r._offset,r._length)}),void 0,300)};r=new Ed(L,new ArrayBuffer(0),d,null,F),v()}else r=new Ed(L,e,d,(()=>{d.removePendingData(r)}),F),d.addPendingData(r);if(v.position){const d=T.j.dk(v.position);r.setPosition(d)}if(v.isDirectional&&(r.setDirectionalCone(v.coneInnerAngle||360,v.coneOuterAngle||360,v.coneOuterGain||0),v.localDirectionToMesh)){const d=T.j.dk(v.localDirectionToMesh);r.setLocalDirectionToMesh(d)}if(v.connectedMeshId){const Q=d.getMeshById(v.connectedMeshId);Q&&r.attachToMesh(Q)}return v.metadata&&(r.metadata=v.metadata),r}_setOffset(v){this._offset!==v&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=v)}_clearTimeoutsAndObservers(){var v;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(v=wd.d.audioEngine)||void 0===v||v.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Ed._SceneComponentInitialization=v=>{throw(0,cd.c)("AudioSceneComponent")},(0,Ov.f)("BABYLON.Sound",Ed);class Nd{constructor(v,d,Q){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],d.length!==Q.length)throw new Error("Sounds length does not equal weights length");this.loop=v,this._weights=Q;let n=0;for(const L of Q)n+=L;const T=n>0?1/n:0;for(let L=0;L<this._weights.length;L++)this._weights[L]*=T;this._sounds=d;for(const L of this._sounds)L.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(v){if(v!==this._coneInnerAngle){if(this._coneOuterAngle<v)return void m.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=v;for(const d of this._sounds)d.directionalConeInnerAngle=v}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(v){if(v!==this._coneOuterAngle){if(v<this._coneInnerAngle)return void m.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=v;for(const d of this._sounds)d.directionalConeOuterAngle=v}}get volume(){return this._volume}set volume(v){if(v!==this._volume)for(const d of this._sounds)d.setVolume(v)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(v){if(!this.isPaused){this.stop();const v=Math.random();let d=0;for(let Q=0;Q<this._weights.length;Q++)if(d+=this._weights[Q],v<=d){this._currentIndex=Q;break}}const d=this._sounds[this._currentIndex??0];d.isReady()?d.play(0,this.isPaused?void 0:v):d.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class ld{constructor(v){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(v=v||X.c.LastCreatedScene)&&(this._scene=v,this.soundCollection=[],this._options=d,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var v;null!==(v=wd.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&wd.d.audioEngine.audioContext&&(this._outputAudioNode=wd.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(wd.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(wd.d.audioEngine&&wd.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(v){var d;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&v.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==v.soundTrackId&&(-1===v.soundTrackId?this._scene.mainSoundTrack.removeSound(v):this._scene.soundTracks&&this._scene.soundTracks[v.soundTrackId].removeSound(v)),this.soundCollection.push(v),v.soundTrackId=this.id}removeSound(v){const d=this.soundCollection.indexOf(v);-1!==d&&this.soundCollection.splice(d,1)}setVolume(v){var d;null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=v)}switchPanningModelToHRTF(){var v;if(null!==(v=wd.d.audioEngine)&&void 0!==v&&v.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var v;if(null!==(v=wd.d.audioEngine)&&void 0!==v&&v.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToEqualPower()}connectToAnalyser(v){var d;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=v,null!==(d=wd.d.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,wd.d.audioEngine.masterGain))}}var vQ=Q(857),dQ=Q(2167),QQ=Q(477);wd.d.AudioEngineFactory=(v,d,Q)=>new nQ(v,d,Q);class nQ{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new u.e,this.onAudioLockedObservable=new u.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,QQ.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const n=document.createElement("audio");this._hostElement=v,this._audioContext=d,this._audioDestination=Q;try{n&&n.canPlayType&&(n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||n.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(T){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(T){}}lock(){this._triggerSuspendedState()}unlock(){var v,d;if("running"===(null===(v=this._audioContext)||void 0===v?void 0:v.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(d=this._audioContext)||void 0===d||d.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{m.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var v;null===(v=this._audioContext)||void 0===v||v.addEventListener("statechange",(()=>{var v;this.unlocked&&"running"!==(null===(v=this._audioContext)||void 0===v?void 0:v.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var v;return null!==(v=this._audioContext)&&void 0!==v&&v.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(v){this.canUseWebAudio=!1,m.d.Error("Web Audio: "+v.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(v){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const v=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",d=document.createElement("style");d.appendChild(document.createTextNode(v)),document.getElementsByTagName("head")[0].appendChild(d),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var v;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(v=this._audioContext)||void 0===v||v.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(v){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=v)}connectToAnalyser(v){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=v,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var TQ=Q(488);(0,Q(12568).f)(vQ.d.NAME_AUDIO,((v,d,Q,n)=>{let T,L=[];if(Q.om=Q.om||[],void 0!==v.om&&null!==v.om)for(let F=0,r=v.om.length;F<r;F++){var e;const r=v.om[F];null!==(e=wd.d.audioEngine)&&void 0!==e&&e.canUseWebAudio?(r.url||(r.url=r.name),L[r.url]?Q.om.push(Ed.Parse(r,d,n,L[r.url])):(T=Ed.Parse(r,d,n),L[r.url]=T,Q.om.push(T))):Q.om.push(new Ed(r.name,null,d))}L=[]})),Object.defineProperty(dQ.d.prototype,"mainSoundTrack",{get:function(){let v=this._getComponent(vQ.d.NAME_AUDIO);return v||(v=new LQ(this),this.bb(v)),this._mainSoundTrack||(this._mainSoundTrack=new ld(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),dQ.d.prototype.getSoundByName=function(v){let d;for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)if(this.mainSoundTrack.soundCollection[d].name===v)return this.mainSoundTrack.soundCollection[d];if(this.soundTracks)for(let Q=0;Q<this.soundTracks.length;Q++)for(d=0;d<this.soundTracks[Q].soundCollection.length;d++)if(this.soundTracks[Q].soundCollection[d].name===v)return this.soundTracks[Q].soundCollection[d];return null},Object.defineProperty(dQ.d.prototype,"audioEnabled",{get:function(){let v=this._getComponent(vQ.d.NAME_AUDIO);return v||(v=new LQ(this),this.bb(v)),v.audioEnabled},set:function(v){let d=this._getComponent(vQ.d.NAME_AUDIO);d||(d=new LQ(this),this.bb(d)),v?d.enableAudio():d.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(dQ.d.prototype,"headphone",{get:function(){let v=this._getComponent(vQ.d.NAME_AUDIO);return v||(v=new LQ(this),this.bb(v)),v.headphone},set:function(v){let d=this._getComponent(vQ.d.NAME_AUDIO);d||(d=new LQ(this),this.bb(d)),v?d.switchAudioModeForHeadphones():d.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(dQ.d.prototype,"audioListenerPositionProvider",{get:function(){let v=this._getComponent(vQ.d.NAME_AUDIO);return v||(v=new LQ(this),this.bb(v)),v.audioListenerPositionProvider},set:function(v){let d=this._getComponent(vQ.d.NAME_AUDIO);if(d||(d=new LQ(this),this.bb(d)),v&&"function"!==typeof v)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");d.audioListenerPositionProvider=v},enumerable:!0,configurable:!0}),Object.defineProperty(dQ.d.prototype,"audioListenerRotationProvider",{get:function(){let v=this._getComponent(vQ.d.NAME_AUDIO);return v||(v=new LQ(this),this.bb(v)),v.audioListenerRotationProvider},set:function(v){let d=this._getComponent(vQ.d.NAME_AUDIO);if(d||(d=new LQ(this),this.bb(d)),v&&"function"!==typeof v)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");d.audioListenerRotationProvider=v},enumerable:!0,configurable:!0}),Object.defineProperty(dQ.d.prototype,"audioPositioningRefreshRate",{get:function(){let v=this._getComponent(vQ.d.NAME_AUDIO);return v||(v=new LQ(this),this.bb(v)),v.audioPositioningRefreshRate},set:function(v){let d=this._getComponent(vQ.d.NAME_AUDIO);d||(d=new LQ(this),this.bb(d)),d.audioPositioningRefreshRate=v},enumerable:!0,configurable:!0});class LQ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(v){this.name=vQ.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new T.j,this._cachedCameraPosition=new T.j,this._lastCheck=0,this._invertMatrixTemp=new T.b,this._cameraDirectionTemp=new T.j,(v=v||X.c.LastCreatedScene)&&(this.yd=v,v.soundTracks=[],v.om=[])}register(){this.yd._afterRenderStage.registerStep(vQ.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(v){if(v.om=[],this.yd.soundTracks)for(let d=0;d<this.yd.soundTracks.length;d++){const Q=this.yd.soundTracks[d];for(let d=0;d<Q.soundCollection.length;d++)v.om.push(Q.soundCollection[d].serialize())}}addFromContainer(v){if(v.om)for(const d of v.om)d.play(),d.autoplay=!0,this.yd.mainSoundTrack.addSound(d)}removeFromContainer(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(v.om)for(const Q of v.om)Q.stop(),Q.autoplay=!1,this.yd.mainSoundTrack.removeSound(Q),d&&Q.dispose()}dispose(){const v=this.yd;if(v._mainSoundTrack&&v.mainSoundTrack.dispose(),v.soundTracks)for(let d=0;d<v.soundTracks.length;d++)v.soundTracks[d].dispose()}disableAudio(){const v=this.yd;let d;for(this._audioEnabled=!1,wd.d.audioEngine&&wd.d.audioEngine.audioContext&&wd.d.audioEngine.audioContext.suspend(),d=0;d<v.mainSoundTrack.soundCollection.length;d++)v.mainSoundTrack.soundCollection[d].pause();if(v.soundTracks)for(d=0;d<v.soundTracks.length;d++)for(let Q=0;Q<v.soundTracks[d].soundCollection.length;Q++)v.soundTracks[d].soundCollection[Q].pause()}enableAudio(){const v=this.yd;let d;for(this._audioEnabled=!0,wd.d.audioEngine&&wd.d.audioEngine.audioContext&&wd.d.audioEngine.audioContext.resume(),d=0;d<v.mainSoundTrack.soundCollection.length;d++)v.mainSoundTrack.soundCollection[d].isPaused&&v.mainSoundTrack.soundCollection[d].play();if(v.soundTracks)for(d=0;d<v.soundTracks.length;d++)for(let Q=0;Q<v.soundTracks[d].soundCollection.length;Q++)v.soundTracks[d].soundCollection[Q].isPaused&&v.soundTracks[d].soundCollection[Q].play()}switchAudioModeForHeadphones(){const v=this.yd;if(this._headphone=!0,v.mainSoundTrack.switchPanningModelToHRTF(),v.soundTracks)for(let d=0;d<v.soundTracks.length;d++)v.soundTracks[d].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const v=this.yd;if(this._headphone=!1,v.mainSoundTrack.switchPanningModelToEqualPower(),v.soundTracks)for(let d=0;d<v.soundTracks.length;d++)v.soundTracks[d].switchPanningModelToEqualPower()}_afterRender(){const v=TQ.b.Now;if(this._lastCheck&&v-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=v;const d=this.yd;if(!this._audioEnabled||!d._mainSoundTrack||!d.soundTracks||0===d._mainSoundTrack.soundCollection.length&&1===d.soundTracks.length)return;const Q=wd.d.audioEngine;if(Q&&Q.audioContext){let v,n=d.activeCamera;if(d.activeCameras&&d.activeCameras.length>0&&(n=d.activeCameras[0]),this.audioListenerPositionProvider){const v=this.audioListenerPositionProvider();Q.audioContext.listener.setPosition(v.x||0,v.y||0,v.z||0)}else n?this._cachedCameraPosition.equals(n.globalPosition)||(this._cachedCameraPosition.p(n.globalPosition),Q.audioContext.listener.setPosition(n.globalPosition.x,n.globalPosition.y,n.globalPosition.z)):Q.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const v=this.audioListenerRotationProvider();Q.audioContext.listener.setOrientation(v.x||0,v.y||0,v.z||0,0,1,0)}else n?(n.rigCameras&&n.rigCameras.length>0&&(n=n.rigCameras[0]),n.getViewMatrix().invertToRef(this._invertMatrixTemp),T.j.TransformNormalToRef(LQ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),Q.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Q.audioContext.listener.setOrientation(0,0,0,0,1,0);for(v=0;v<d.mainSoundTrack.soundCollection.length;v++){const Q=d.mainSoundTrack.soundCollection[v];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}if(d.soundTracks)for(v=0;v<d.soundTracks.length;v++)for(let Q=0;Q<d.soundTracks[v].soundCollection.length;Q++){const n=d.soundTracks[v].soundCollection[Q];n.useCustomAttenuation&&n.updateDistanceFromListener()}}}}LQ._CameraDirection=new T.j(0,0,-1),Ed._SceneComponentInitialization=v=>{let d=v._getComponent(vQ.d.NAME_AUDIO);d||(d=new LQ(v),v.bb(d))};const eQ="MSFT_audio_emitter";class FQ{constructor(v){this.name=eQ,this._loader=v,this.enabled=this._loader.isExtensionUsed(eQ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const v=this._loader.Qk.extensions;if(v&&v[this.name]){const d=v[this.name];this._clips=d.clips,this._emitters=d.emitters,b.Assign(this._clips),b.Assign(this._emitters)}}loadSceneAsync(v,d){return s.LoadExtensionAsync(v,d,this.name,(async(Q,n)=>{const T=new Array;T.push(this._loader.loadSceneAsync(v,d));for(const v of n.emitters){const d=b.Get(`${Q}/emitters`,this._emitters,v);if(void 0!=d.refDistance||void 0!=d.maxDistance||void 0!=d.rolloffFactor||void 0!=d.distanceModel||void 0!=d.innerAngle||void 0!=d.outerAngle)throw new Error(`${Q}: Direction or Distance properties are not allowed on emitters attached to a scene`);T.push(this._loadEmitterAsync(`${Q}/emitters/${d.index}`,d))}await Promise.all(T)}))}loadNodeAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(v,n)=>{const L=new Array,F=await this._loader.loadNodeAsync(v,d,(d=>{for(const Q of n.emitters){const n=b.Get(`${v}/emitters`,this._emitters,Q);L.push(this._loadEmitterAsync(`${v}/emitters/${n.index}`,n).then((()=>{for(const v of n._babylonSounds)v.attachToMesh(d),void 0==n.innerAngle&&void 0==n.outerAngle||(v.setLocalDirectionToMesh(T.j.Forward()),v.setDirectionalCone(2*e.e.ToDegrees(void 0==n.innerAngle?Math.PI:n.innerAngle),2*e.e.ToDegrees(void 0==n.outerAngle?Math.PI:n.outerAngle),0))})))}Q(d)}));return await Promise.all(L),F}))}loadAnimationAsync(v,d){return s.LoadExtensionAsync(v,d,this.name,(async(Q,n)=>{const T=await this._loader.loadAnimationAsync(v,d),L=new Array;b.Assign(n.events);for(const e of n.events)L.push(this._loadAnimationEventAsync(`${Q}/events/${e.index}`,v,d,e,T));return await Promise.all(L),T}))}_loadClipAsync(v,d){if(d._objectURL)return d._objectURL;let Q;if(d.uri)Q=this._loader.loadUriAsync(v,d,d.uri);else{const n=b.Get(`${v}/bufferView`,this._loader.Qk.bufferViews,d.bufferView);Q=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}return d._objectURL=Q.then((v=>URL.createObjectURL(new Blob([v],{type:d.mimeType})))),d._objectURL}_loadEmitterAsync(v,d){if(d._babylonSounds=d._babylonSounds||[],!d._babylonData){const v=new Array,Q=d.name||`emitter${d.index}`,n={loop:!1,autoplay:!1,volume:void 0==d.volume?1:d.volume};for(let L=0;L<d.clips.length;L++){const T=`/extensions/${this.name}/clips`,e=b.Get(T,this._clips,d.clips[L].clip);v.push(this._loadClipAsync(`${T}/${d.clips[L].clip}`,e).then((v=>{const T=d._babylonSounds[L]=new Ed(Q,v,this._loader.babylonScene,null,n);T.refDistance=d.refDistance||1,T.maxDistance=d.maxDistance||256,T.rolloffFactor=d.rolloffFactor||1,T.distanceModel=d.distanceModel||"exponential"})))}const T=Promise.all(v).then((()=>{const v=d.clips.map((v=>v.weight||1)),Q=new Nd(d.loop||!1,d._babylonSounds,v);d.innerAngle&&(Q.directionalConeInnerAngle=2*e.e.ToDegrees(d.innerAngle)),d.outerAngle&&(Q.directionalConeOuterAngle=2*e.e.ToDegrees(d.outerAngle)),d.volume&&(Q.volume=d.volume),d._babylonData.sound=Q}));d._babylonData={loaded:T}}return d._babylonData.loaded}_getEventAction(v,d,Q,n,T){switch(Q){case"play":return v=>{const Q=(T||0)+(v-n);d.play(Q)};case"stop":return()=>{d.stop()};case"pause":return()=>{d.pause()};default:throw new Error(`${v}: Unsupported action ${Q}`)}}_loadAnimationEventAsync(v,d,Q,n,T){if(0==T.targetedAnimations.length)return Promise.resolve();const L=T.targetedAnimations[0],e=n.j,F=b.Get(`/extensions/${this.name}/emitters`,this._emitters,e);return this._loadEmitterAsync(v,F).then((()=>{const d=F._babylonData.sound;if(d){const Q=new Ud(n.time,this._getEventAction(v,d,n.action,n.time,n.startOffset));L.animation.addEvent(Q),T.onAnimationGroupEndObservable.add((()=>{d.stop()})),T.onAnimationGroupPauseObservable.add((()=>{d.pause()}))}}))}}t(eQ),k(eQ,!0,(v=>new FQ(v)));const rQ="MSFT_lod";class CQ{constructor(v){var d;this.name=rQ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new u.e,this.onMaterialLODsLoadedObservable=new u.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=v,this.maxLODsToLoad=(null===(d=this._loader.parent.extensionOptions[rQ])||void 0===d?void 0:d.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(rQ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let v=0;v<this._nodePromiseLODs.length;v++){const d=Promise.all(this._nodePromiseLODs[v]).then((()=>{0!==v&&(this._loader.endPerformanceCounter(`Node LOD ${v}`),this._loader.log(`Loaded node LOD ${v}`)),this.onNodeLODsLoadedObservable.notifyObservers(v),v!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${v+1}`),this._loadBufferLOD(this._nodeBufferLODs,v+1),this._nodeSignalLODs[v]&&this._nodeSignalLODs[v].resolve())}));this._loader._completePromises.push(d)}for(let v=0;v<this._materialPromiseLODs.length;v++){const d=Promise.all(this._materialPromiseLODs[v]).then((()=>{0!==v&&(this._loader.endPerformanceCounter(`Material LOD ${v}`),this._loader.log(`Loaded material LOD ${v}`)),this.onMaterialLODsLoadedObservable.notifyObservers(v),v!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${v+1}`),this._loadBufferLOD(this._materialBufferLODs,v+1),this._materialSignalLODs[v]&&this._materialSignalLODs[v].resolve())}));this._loader._completePromises.push(d)}}loadSceneAsync(v,d){const Q=this._loader.loadSceneAsync(v,d);return this._loadBufferLOD(this._bufferLODs,0),Q}loadNodeAsync(v,d,Q){return s.LoadExtensionAsync(v,d,this.name,(async(v,T)=>{let L;const e=this._getLODs(v,d,this._loader.Qk.nodes,T.ids);this._loader.logOpen(`${v}`);for(let d=0;d<e.length;d++){const v=e[d];0!==d&&(this._nodeIndexLOD=d,this._nodeSignalLODs[d]=this._nodeSignalLODs[d]||new n);const T=v=>{Q(v),v.lc(!1)},F=this._loader.loadNodeAsync(`/nodes/${v.index}`,v,T).then((v=>{if(0!==d){const v=e[d-1];v._babylonTransformNode&&(this._disposeTransformNode(v._babylonTransformNode),delete v._babylonTransformNode)}return v.lc(!0),v}));this._nodePromiseLODs[d]=this._nodePromiseLODs[d]||[],0===d?L=F:(this._nodeIndexLOD=null,this._nodePromiseLODs[d].push(F))}return this._loader.logClose(),await L}))}_loadMaterialAsync(v,d,Q,n,T){return this._nodeIndexLOD?null:s.LoadExtensionAsync(v,d,this.name,(async(v,L)=>{let e;const F=this._getLODs(v,d,this._loader.Qk.materials,L.ids);this._loader.logOpen(`${v}`);for(let d=0;d<F.length;d++){const v=F[d];0!==d&&(this._materialIndexLOD=d);const L=this._loader._loadMaterialAsync(`/materials/${v.index}`,v,Q,n,(v=>{0===d&&T(v)})).then((v=>{if(0!==d){T(v);const Q=F[d-1]._data;Q[n]&&(this._disposeMaterials([Q[n].babylonMaterial]),delete Q[n])}return v}));this._materialPromiseLODs[d]=this._materialPromiseLODs[d]||[],0===d?e=L:(this._materialIndexLOD=null,this._materialPromiseLODs[d].push(L))}return this._loader.logClose(),await e}))}_loadUriAsync(v,d,Q){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const T=this._nodeIndexLOD-1;return this._nodeSignalLODs[T]=this._nodeSignalLODs[T]||new n,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(v,d,Q)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const T=this._materialIndexLOD-1;return this._materialSignalLODs[T]=this._materialSignalLODs[T]||new n,this._materialSignalLODs[T].promise.then((async()=>await this._loader.loadUriAsync(v,d,Q)))}return null}loadBufferAsync(v,d,Q,T){if(this._loader.parent.useRangeRequests&&!d.uri){if(!this._loader.bin)throw new Error(`${v}: Uri is missing or the binary glTF is missing its binary chunk`);const d=async(v,d)=>{const L=Q,e=L+T-1;let F=v[d];return F?(F.start=Math.min(F.start,L),F.end=Math.max(F.end,e)):(F={start:L,end:e,loaded:new n},v[d]=F),await F.loaded.promise.then((v=>new Uint8Array(v.buffer,v.byteOffset+Q-F.start,T)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?d(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?d(this._materialBufferLODs,this._materialIndexLOD):d(this._bufferLODs,0)}return null}_loadBufferLOD(v,d){const Q=v[d];Q&&(this._loader.log(`Loading buffer range [${Q.start}-${Q.end}]`),this._loader.bin.readAsync(Q.start,Q.end-Q.start+1).then((v=>{Q.loaded.resolve(v)}),(v=>{Q.loaded.reject(v)})))}_getLODs(v,d,Q,n){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const T=[];for(let L=n.length-1;L>=0;L--)if(T.push(b.Get(`${v}/ids/${n[L]}`,Q,n[L])),T.length===this.maxLODsToLoad)return T;return T.push(d),T}_disposeTransformNode(v){const d=[],Q=v.material;Q&&d.push(Q);for(const T of v.getChildMeshes())T.material&&d.push(T.material);v.dispose();const n=d.filter((v=>this._loader.babylonScene.meshes.every((d=>d.material!=v))));this._disposeMaterials(n)}_disposeMaterials(v){const d={};for(const Q of v){for(const v of Q.getActiveTextures())d[v.uniqueId]=v;Q.dispose()}for(const Q in d)for(const v of this._loader.babylonScene.materials)v.hasTexture(d[Q])&&delete d[Q];for(const Q in d)d[Q].dispose()}}t(rQ),k(rQ,!0,(v=>new CQ(v)));const uQ="MSFT_minecraftMesh";class yQ{constructor(v){this.name=uQ,this._loader=v,this.enabled=this._loader.isExtensionUsed(uQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtraAsync(v,d,this.name,(async(n,T)=>{if(T){if(!(Q instanceof A.d))throw new Error(`${n}: Material type not supported`);const T=this._loader.loadMaterialPropertiesAsync(v,d,Q);return Q.needAlphaBlending()&&(Q.forceDepthWrite=!0,Q.separateCullingPass=!0),Q.pk=Q.forceDepthWrite,Q.twoSidedLighting=!0,await T}}))}}t(uQ),k(uQ,!0,(v=>new yQ(v)));const zQ="MSFT_sRGBFactors";class BQ{constructor(v){this.name=zQ,this._loader=v,this.enabled=this._loader.isExtensionUsed(zQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,d,Q){return s.LoadExtraAsync(v,d,this.name,(async(n,T)=>{if(T){if(!(Q instanceof A.d))throw new Error(`${n}: Material type not supported`);const T=this._loader.loadMaterialPropertiesAsync(v,d,Q),L=Q.va().getEngine().useExactSrgbConversions;return Q.albedoTexture||Q.albedoColor.toLinearSpaceToRef(Q.albedoColor,L),Q.reflectivityTexture||Q.reflectivityColor.toLinearSpaceToRef(Q.reflectivityColor,L),await T}}))}}t(zQ),k(zQ,!0,(v=>new BQ(v)));var XQ=Q(12897);const mQ={};var VQ=Q(12956),hQ=Q(12929),SQ=Q(12899),AQ=Q(12908);function fQ(v,d){for(const Q of v)for(const v of Q.dataOutputs)if(v.uniqueId===d)return v;throw new Error("Could not find data out connection with unique id "+d)}function PQ(v,d){for(const Q of v)if(Q instanceof hQ.b)for(const v of Q.signalInputs)if(v.uniqueId===d)return v;throw new Error("Could not find signal in connection with unique id "+d)}async function OQ(v,d){const n=await Promise.all(v.allBlocks.map((async v=>{const d=function(v){switch(v){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([Q.e(62),Q.e(63)]).then(Q.bind(Q,14147))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await Q.e(64).then(Q.bind(Q,14153))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await Q.e(65).then(Q.bind(Q,14156))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await Q.e(66).then(Q.bind(Q,14161))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await Q.e(67).then(Q.bind(Q,14168))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await Q.e(68).then(Q.bind(Q,14176))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await Q.e(69).then(Q.bind(Q,14183))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await Q.e(70).then(Q.bind(Q,14186))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await Q.e(71).then(Q.bind(Q,14192))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await Q.e(74).then(Q.bind(Q,14225))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await Q.e(74).then(Q.bind(Q,14225))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await Q.e(74).then(Q.bind(Q,14225))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await Q.e(74).then(Q.bind(Q,14225))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await Q.e(79).then(Q.bind(Q,14231))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await Q.e(80).then(Q.bind(Q,14238))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await Q.e(81).then(Q.bind(Q,14240))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await Q.e(82).then(Q.bind(Q,14247))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await Q.e(83).then(Q.bind(Q,14250))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await Q.e(84).then(Q.bind(Q,14252))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await Q.e(85).then(Q.bind(Q,14254))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await Q.e(86).then(Q.bind(Q,14259))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await Q.e(87).then(Q.bind(Q,14266))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14274))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14280))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await Q.e(90).then(Q.bind(Q,14284))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await Q.e(91).then(Q.bind(Q,14289))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await Q.e(92).then(Q.bind(Q,14291))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await Q.e(93).then(Q.bind(Q,14295))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await Q.e(94).then(Q.bind(Q,14298))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await Q.e(95).then(Q.bind(Q,14300))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await Q.e(96).then(Q.bind(Q,14306))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await Q.e(97).then(Q.bind(Q,14312))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await Q.e(76).then(Q.bind(Q,14317))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await Q.e(98).then(Q.bind(Q,14325))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await Q.e(99).then(Q.bind(Q,14333))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await Q.e(100).then(Q.bind(Q,14335))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await Q.e(77).then(Q.bind(Q,14338))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await Q.e(72).then(Q.bind(Q,14198))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await Q.e(78).then(Q.bind(Q,14340))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await Q.e(73).then(Q.bind(Q,14216))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await Q.e(74).then(Q.bind(Q,14225))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await Q.e(74).then(Q.bind(Q,14225))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await Q.e(75).then(Q.bind(Q,14347))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await Q.e(75).then(Q.bind(Q,14347))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await Q.e(75).then(Q.bind(Q,14347))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await Q.e(75).then(Q.bind(Q,14347))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await Q.e(75).then(Q.bind(Q,14347))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await Q.e(75).then(Q.bind(Q,14347))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await Q.e(101).then(Q.bind(Q,14350))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await Q.e(102).then(Q.bind(Q,14357))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await Q.e(103).then(Q.bind(Q,14363))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await Q.e(104).then(Q.bind(Q,14367))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await Q.e(105).then(Q.bind(Q,14373))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await Q.e(106).then(Q.bind(Q,14375))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await Q.e(107).then(Q.bind(Q,14384))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await Q.e(108).then(Q.bind(Q,14386))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await Q.e(109).then(Q.bind(Q,14391))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await Q.e(110).then(Q.bind(Q,14400))).FlowGraphDataSwitchBlock;default:if(mQ[v])return mQ[v];throw new Error(`Unknown block name ${v}`)}}(v.className);return await d()})));return function(v,d,Q){const n=d.coordinator.createGraph(),T=[],L=d.valueParseFunction??SQ.d;for(let e=0;e<v.allBlocks.length;e++){const F=KQ(v.allBlocks[e],{yd:d.coordinator.config.yd,pathConverter:d.pathConverter,assetsContainer:d.coordinator.config.yd,valueParseFunction:L},Q[e]);T.push(F),F instanceof VQ.d&&n.addEventBlock(F)}for(const e of T){for(const v of e.dataInputs)for(const d of v.connectedPointIds){const Q=fQ(T,d);v.connectTo(Q)}if(e instanceof hQ.b)for(const v of e.signalOutputs)for(const d of v.connectedPointIds){const Q=PQ(T,d);v.connectTo(Q)}}for(const e of v.executionContexts)JQ(e,{graph:n,valueParseFunction:L},v.rightHanded);return n}(v,d,n)}function JQ(v,d,Q){const n=d.graph.createContext();v.enableLogging&&(n.enableLogging=!0),n.treatDataAsRightHanded=Q||!1;const T=d.valueParseFunction??SQ.d;n.uniqueId=v.uniqueId;const L=n.va();if(v._assetsContext){var e,F,r,C,u,y,z,B,X,m;const d=v._assetsContext,Q={meshes:null===(e=d.meshes)||void 0===e?void 0:e.map((v=>L.getMeshById(v))),lights:null===(F=d.lights)||void 0===F?void 0:F.map((v=>L.getLightByName(v))),cameras:null===(r=d.cameras)||void 0===r?void 0:r.map((v=>L.getCameraByName(v))),materials:null===(C=d.materials)||void 0===C?void 0:C.map((v=>L.getMaterialById(v))),textures:null===(u=d.textures)||void 0===u?void 0:u.map((v=>L.getTextureByName(v))),animations:null===(y=d.animations)||void 0===y?void 0:y.map((v=>L.animations.find((d=>d.name===v)))),skeletons:null===(z=d.skeletons)||void 0===z?void 0:z.map((v=>L.getSkeletonByName(v))),Ck:null===(B=d.Ck)||void 0===B?void 0:B.map((v=>L.getParticleSystemById(v))),animationGroups:null===(X=d.animationGroups)||void 0===X?void 0:X.map((v=>L.getAnimationGroupByName(v))),transformNodes:null===(m=d.transformNodes)||void 0===m?void 0:m.map((v=>L.getTransformNodeById(v))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],om:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};n.assetsContext=Q}for(const V in v._userVariables){const d=T(V,v._userVariables,n.assetsContext,L);n.userVariables[V]=d}for(const V in v._connectionValues){const d=T(V,v._connectionValues,n.assetsContext,L);n._setConnectionValueByKey(V,d)}return n}function KQ(v,d,Q){const n={},T=d.valueParseFunction??SQ.d;if(v.config)for(const e in v.config)n[e]=T(e,v.config,d.assetsContainer||d.yd,d.yd);if((0,SQ.g)(v.className)){if(!d.pathConverter)throw new Error("Path converter is required for this block");n.pathConverter=d.pathConverter}const L=new Q(n);L.uniqueId=v.uniqueId;for(let e=0;e<v.dataInputs.length;e++){const d=L.getDataInput(v.dataInputs[e].name);if(!d)throw new Error("Could not find data input with name "+v.dataInputs[e].name+" in block "+v.className);d.deserialize(v.dataInputs[e])}for(let e=0;e<v.dataOutputs.length;e++){const d=L.getDataOutput(v.dataOutputs[e].name);if(!d)throw new Error("Could not find data output with name "+v.dataOutputs[e].name+" in block "+v.className);d.deserialize(v.dataOutputs[e])}return L.metadata=v.metadata,L.deserialize&&L.deserialize(v),L}function oQ(v){const[d,Q]=v.split(":");return gQ({op:d,extension:Q})}function gQ(v){var d;let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=v.extension?null===(d=MQ[v.extension])||void 0===d?void 0:d[v.op]:YQ[v.op];if(!n&&(m.d.Warn(`No mapping found for operation ${v.op} and extension ${v.extension||"KHR_interactivity"}`),Q)){const d={},Q={flows:{}};if(v.inputValueSockets){d.values={};for(const Q in v.inputValueSockets)d.values[Q]={name:Q}}return v.outputValueSockets&&(Q.values={},Object.keys(v.outputValueSockets).forEach((v=>{Q.values[v]={name:v}}))),{Uk:[],inputs:d,outputs:Q}}return n}function RQ(v,d,Q){MQ[d]||(MQ[d]={}),MQ[d][v]=Q}const MQ={BABYLON:{"flow/log":{Uk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},YQ={"event/onStart":{Uk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Uk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Uk:["FlowGraphSendCustomEventBlock"],extraProcessor(v,d,Q,n,T){if("event/send"!==d.op||!v.configuration||1!==Object.keys(v.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=v.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const e=n.arrays.events[L],F=T[0];return F.config||(F.config={}),F.config.eventId=e.eventId,F.config.eventData=e.eventData,T}},"event/receive":{Uk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(v,d){var Q;if(!v.configuration)return m.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const n=v.configuration.event;if(!n)return m.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const T=n.value[0];if("number"!==typeof T)return m.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(Q=d.events)||void 0===Q?void 0:Q[T])?{valid:!0}:(m.d.Error(`Event with id ${T} not found`),{valid:!1,error:`Event with id ${T} not found`})},extraProcessor(v,d,Q,n,T){if("event/receive"!==d.op||!v.configuration||1!==Object.keys(v.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=v.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const e=n.arrays.events[L],F=T[0];return F.config||(F.config={}),F.config.eventId=e.eventId,F.config.eventData=e.eventData,T}},"math/e":DQ("FlowGraphEBlock"),"math/pi":DQ("FlowGraphPIBlock"),"math/inf":DQ("FlowGraphInfBlock"),"math/nan":DQ("FlowGraphNaNBlock"),"math/abs":DQ("FlowGraphAbsBlock"),"math/sign":DQ("FlowGraphSignBlock"),"math/trunc":DQ("FlowGraphTruncBlock"),"math/floor":DQ("FlowGraphFloorBlock"),"math/ceil":DQ("FlowGraphCeilBlock"),"math/round":{Uk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T){var L;return(L=T[0]).config||(L.config={}),T[0].config.roundHalfAwayFromZero=!0,T}},"math/fract":DQ("FlowGraphFractBlock"),"math/neg":DQ("FlowGraphNegationBlock"),"math/add":DQ("FlowGraphAddBlock",["a","b"],!0),"math/sub":DQ("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Uk:["FlowGraphMultiplyBlock"],extraProcessor(v,d,Q,n,T){var L;(L=T[0]).config||(L.config={}),T[0].config.useMatrixPerComponent=!0,T[0].config.preventIntegerFloatArithmetic=!0;let e=-1;return Object.keys(v.values||{}).find((d=>{var Q;return void 0!==(null===(Q=v.values)||void 0===Q?void 0:Q[d].type)&&(e=v.values[d].type,!0)})),-1!==e&&(T[0].config.type=n.arrays.types[e].flowGraphType),T},validation:v=>v.values?iQ(v):{valid:!0}},"math/div":DQ("FlowGraphDivideBlock",["a","b"],!0),"math/rem":DQ("FlowGraphModuloBlock",["a","b"]),"math/min":DQ("FlowGraphMinBlock",["a","b"]),"math/max":DQ("FlowGraphMaxBlock",["a","b"]),"math/clamp":DQ("FlowGraphClampBlock",["a","b","c"]),"math/saturate":DQ("FlowGraphSaturateBlock"),"math/mix":DQ("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":DQ("FlowGraphEqualityBlock",["a","b"]),"math/lt":DQ("FlowGraphLessThanBlock",["a","b"]),"math/le":DQ("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":DQ("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":DQ("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":DQ("FlowGraphIsNaNBlock"),"math/isinf":DQ("FlowGraphIsInfBlock"),"math/select":{Uk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Uk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":DQ("FlowGraphSinBlock"),"math/cos":DQ("FlowGraphCosBlock"),"math/tan":DQ("FlowGraphTanBlock"),"math/asin":DQ("FlowGraphASinBlock"),"math/acos":DQ("FlowGraphACosBlock"),"math/atan":DQ("FlowGraphATanBlock"),"math/atan2":DQ("FlowGraphATan2Block",["a","b"]),"math/sinh":DQ("FlowGraphSinhBlock"),"math/cosh":DQ("FlowGraphCoshBlock"),"math/tanh":DQ("FlowGraphTanhBlock"),"math/asinh":DQ("FlowGraphASinhBlock"),"math/acosh":DQ("FlowGraphACoshBlock"),"math/atanh":DQ("FlowGraphATanhBlock"),"math/exp":DQ("FlowGraphExponentialBlock"),"math/log":DQ("FlowGraphLogBlock"),"math/log2":DQ("FlowGraphLog2Block"),"math/log10":DQ("FlowGraphLog10Block"),"math/sqrt":DQ("FlowGraphSquareRootBlock"),"math/cbrt":DQ("FlowGraphCubeRootBlock"),"math/pow":DQ("FlowGraphPowerBlock",["a","b"]),"math/length":DQ("FlowGraphLengthBlock"),"math/normalize":DQ("FlowGraphNormalizeBlock"),"math/dot":DQ("FlowGraphDotBlock",["a","b"]),"math/cross":DQ("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":DQ("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":DQ("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Uk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Uk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Uk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Uk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Uk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Uk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Uk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":DQ("FlowGraphTransposeBlock"),"math/determinant":DQ("FlowGraphDeterminantBlock"),"math/inverse":DQ("FlowGraphInvertMatrixBlock"),"math/matmul":DQ("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Uk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"md",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T,L){const e=T[0].dataInputs.find((v=>"rotationQuaternion"===v.name));if(!e)throw new Error("Rotation quaternion input not found");return L._connectionValues[e.uniqueId]&&(L._connectionValues[e.uniqueId].type="Quaternion"),T}},"math/matDecompose":{Uk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"md"}}}},"math/quatConjugate":DQ("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Uk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T){var L;return(L=T[0]).config||(L.config={}),T[0].config.type="Quaternion",T}},"math/quatAngleBetween":DQ("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Uk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":DQ("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":DQ("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Uk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T){var L;return(L=T[0]).config||(L.config={}),T[0].config.inputIsColumnMajor=!0,T}},"math/extract2x2":{Uk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Uk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T){var L;return(L=T[0]).config||(L.config={}),T[0].config.inputIsColumnMajor=!0,T}},"math/extract3x3":{Uk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Uk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T){var L;return(L=T[0]).config||(L.config={}),T[0].config.inputIsColumnMajor=!0,T}},"math/extract4x4":{Uk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Uk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T,L){var e,F;(F=T[0]).config||(F.config={});const r=T[0].dataInputs[0];return T[0].config.valueType=(null===(e=L._connectionValues[r.uniqueId])||void 0===e?void 0:e.type)??"FlowGraphInteger",T}},"math/and":{Uk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T,L){var e,F,r;(r=T[0]).config||(r.config={});const C=T[0].dataInputs[0],u=T[0].dataInputs[1];return T[0].config.valueType=(null===(e=L._connectionValues[C.uniqueId])||void 0===e?void 0:e.type)??(null===(F=L._connectionValues[u.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",T}},"math/or":{Uk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T,L){var e,F,r;(r=T[0]).config||(r.config={});const C=T[0].dataInputs[0],u=T[0].dataInputs[1];return T[0].config.valueType=(null===(e=L._connectionValues[C.uniqueId])||void 0===e?void 0:e.type)??(null===(F=L._connectionValues[u.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",T}},"math/xor":{Uk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(v,d,Q,n,T,L){var e,F,r;(r=T[0]).config||(r.config={});const C=T[0].dataInputs[0],u=T[0].dataInputs[1];return T[0].config.valueType=(null===(e=L._connectionValues[C.uniqueId])||void 0===e?void 0:e.type)??(null===(F=L._connectionValues[u.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",T}},"math/asr":DQ("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":DQ("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":DQ("FlowGraphLeadingZerosBlock"),"math/ctz":DQ("FlowGraphTrailingZerosBlock"),"math/popcnt":DQ("FlowGraphOneBitsCounterBlock"),"math/rad":DQ("FlowGraphDegToRadBlock"),"math/deg":DQ("FlowGraphRadToDegBlock"),"type/boolToInt":DQ("FlowGraphBooleanToInt"),"type/boolToFloat":DQ("FlowGraphBooleanToFloat"),"type/intToBool":DQ("FlowGraphIntToBoolean"),"type/intToFloat":DQ("FlowGraphIntToFloat"),"type/floatToInt":DQ("FlowGraphFloatToInt"),"type/floatToBool":DQ("FlowGraphFloatToBoolean"),"flow/sequence":{Uk:["FlowGraphSequenceBlock"],extraProcessor(v,d,Q,n,T){const L=T[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(v.flows||[]).length,L.signalOutputs.forEach(((v,d)=>{v.name="out_"+d})),T}},"flow/branch":{Uk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Uk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(v){if(v.configuration&&v.configuration.cases){const d=v.configuration.cases.value;if(!d.every((v=>"number"===typeof v&&/^-?\d+$/.test(v.toString()))))return m.d.Warn("Switch cases should be integers. Using empty array instead."),v.configuration.cases.value=[],{valid:!0};const Q=new Set(d);v.configuration.cases.value=Array.from(Q)}return{valid:!0}},extraProcessor(v,d,Q,n,T){if("flow/switch"!==d.op||!v.flows||0===Object.keys(v.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return T[0].signalOutputs.forEach((v=>{"default"!==v.name&&(v.name="out_"+v.name)})),T}},"flow/while":{Uk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Uk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(v,d,Q,n,T){const L=T[0];return L.config||(L.config={}),L.config.incrementIndexWhenLoopDone=!0,T}},"flow/doN":{Uk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Uk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(v,d,Q,n,T){if("flow/multiGate"!==d.op||!v.flows||0===Object.keys(v.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const L=T[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(v.flows).length,L.signalOutputs.forEach(((v,d)=>{v.name="out_"+d})),T}},"flow/waitAll":{Uk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(v){var d,Q;return"number"!==typeof(null===(d=v.configuration)||void 0===d||null===(Q=d.inputFlows)||void 0===Q?void 0:Q.value[0])&&(v.configuration=v.configuration||{inputFlows:{value:[0]}},v.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Uk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Uk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Uk:["FlowGraphCancelDelayBlock"]},"variable/get":{Uk:["FlowGraphGetVariableBlock"],validation(v){var d,Q;return null!==(d=v.configuration)&&void 0!==d&&null!==(Q=d.variable)&&void 0!==Q&&Q.value?{valid:!0}:(m.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(v,d)=>[d.getVariableName(v[0])]}}},"variable/set":{Uk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(v,d)=>[d.getVariableName(v[0])]}}},"variable/setMultiple":{Uk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(v,d)=>[v[0].map((v=>d.getVariableName(v)))]}},extraProcessor:(v,d,Q,n,T)=>(T[0].dataInputs.forEach((v=>{v.name=n.getVariableName(+v.name)})),T)},"variable/interpolate":{Uk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(v,d)=>[d.getVariableName(v[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:v=>!0===v[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(v,d,Q,n,T){var L,e,F;const r=T[0],C=null===(L=v.configuration)||void 0===L?void 0:L.variable.value[0];if("number"!==typeof C)throw m.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const u=n.arrays.staticVariables[C];"undefined"===typeof r.config.animationType.value&&(n.arrays.staticVariables,r.config.animationType.value=(0,AQ.K)(u.type));const y=T[4];return y.config||(y.config={}),(e=y.config).variable||(e.variable={}),y.config.variable.value=n.getVariableName(C),(F=T[3]).config||(F.config={}),T}},"pointer/get":{Uk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(v,d,Q,n,T)=>(T.forEach((v=>{"FlowGraphJsonPointerParserBlock"===v.className&&(v.config||(v.config={}),v.config.outputValue=!0)})),T)},"pointer/set":{Uk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(v,d,Q,n,T)=>(T.forEach((v=>{"FlowGraphJsonPointerParserBlock"===v.className&&(v.config||(v.config={}),v.config.outputValue=!0)})),T)},"pointer/interpolate":{Uk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(v,d,Q,n,T)=>(T.forEach((d=>{"FlowGraphJsonPointerParserBlock"===d.className?(d.config||(d.config={}),d.config.outputValue=!0):"FlowGraphInterpolationBlock"===d.className&&(d.config||(d.config={}),Object.keys(v.values||[]).forEach((Q=>{var T;const L=null===(T=v.values)||void 0===T?void 0:T[Q];if("value"===Q&&L){const v=L.type;void 0!==v&&(d.config.animationType=n.arrays.types[v].flowGraphType)}})))})),T)},"animation/start":{Uk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(v,d)=>[v[0]*d._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(v,d)=>[v[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(v,d,Q,n,T,L,e){const F=T[T.length-1];return F.config||(F.config={}),F.config.glTF=e,T}},"animation/stop":{Uk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(v,d,Q,n,T,L,e){const F=T[T.length-1];return F.config||(F.config={}),F.config.glTF=e,T}},"animation/stopAt":{Uk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(v,d)=>[v[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(v,d,Q,n,T,L,e){const F=T[T.length-1];return F.config||(F.config={}),F.config.glTF=e,T}},"math/switch":{Uk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(v){if(v.configuration&&v.configuration.cases){const d=v.configuration.cases.value;if(!d.every((v=>"number"===typeof v&&/^-?\d+$/.test(v.toString()))))return m.d.Warn("Switch cases should be integers. Using empty array instead."),v.configuration.cases.value=[],{valid:!0};const Q=new Set(d);v.configuration.cases.value=Array.from(Q)}return{valid:!0}},extraProcessor(v,d,Q,n,T){const L=T[0];return L.dataInputs.forEach((v=>{"default"!==v.name&&"case"!==v.name&&(v.name="in_"+v.name)})),L.config||(L.config={}),L.config.treatCasesAsIntegers=!0,T}},"debug/log":{Uk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function DQ(v){let d=arguments.length>2?arguments[2]:void 0;return{Uk:[v],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((v,d)=>(v[d]={name:d},v)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(v,Q,n,T,L){var e;if(d){(e=L[0]).config||(e.config={}),L[0].config.preventIntegerFloatArithmetic=!0;let d=-1;Object.keys(v.values||{}).find((Q=>{var n;return void 0!==(null===(n=v.values)||void 0===n?void 0:n[Q].type)&&(d=v.values[Q].type,!0)})),-1!==d&&(L[0].config.type=T.arrays.types[d].flowGraphType)}return L},validation:v=>d?iQ(v):{valid:!0}}}function iQ(v){if(v.values){const d=Object.keys(v.values).map((d=>v.values[d].type)).filter((v=>void 0!==v));if(!d.every((v=>v===d[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}YQ["math/compose"]=YQ["math/matCompose"],YQ["math/decompose"]=YQ["math/matDecompose"];var ZQ=Q(593);const jQ={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"fk",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class xQ{constructor(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=v,this._gltf=d,this._animationTargetFps=Q,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const v of this._interactivityGraph.types)this._types.push(jQ[v.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const v of this._interactivityGraph.declarations){const d=gQ(v);if(!d)throw m.d.Error(["No mapping found for declaration",v]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:d,fullOperationName:v.extension?v.op+":"+v.extension:v.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const v of this._interactivityGraph.variables){const d=this._parseVariable(v);this._staticVariables.push(d)}}_parseVariable(v,d){const Q=this._types[v.type];if(!Q)throw m.d.Error(["No type found for variable",v]),new Error("Error parsing variables");if(v.value&&v.value.length!==Q.length)throw m.d.Error(["Invalid value length for variable",v,Q]),new Error("Error parsing variables");const n=v.value||[];if(!n.length)switch(Q.flowGraphType){case"boolean":n.push(!1);break;case"FlowGraphInteger":n.push(0);break;case"number":n.push(NaN);break;case"Vector2":n.push(NaN,NaN);break;case"fk":n.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":n.fill(NaN,0,4);break;case"Matrix":n.fill(NaN,0,16);break;case"Matrix3D":n.fill(NaN,0,9)}return"number"===Q.elementType&&"string"===typeof n[0]&&(n[0]=parseFloat(n[0])),{type:Q.flowGraphType,value:d?d(n,this):n}}_parseEvents(){if(this._interactivityGraph.events)for(const v of this._interactivityGraph.events){const d={eventId:v.id||"internalEvent_"+this._internalEventsCounter++};v.values&&(d.eventData=Object.keys(v.values).map((d=>{var Q;const n=null===(Q=v.values)||void 0===Q?void 0:Q[d];if(!n)throw m.d.Error(["No value found for event key",d]),new Error("Error parsing events");const T=this._types[n.type];if(!T)throw m.d.Error(["No type found for event value",n]),new Error("Error parsing events");const L="undefined"!==typeof n.value?this._parseVariable(n):void 0;return{id:d,type:T.flowGraphType,eventData:!0,value:L}}))),this._events.push(d)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const d of this._interactivityGraph.nodes){if("number"!==typeof d.declaration)throw m.d.Error(["No declaration found for node",d]),new Error("Error parsing nodes");const Q=this._mappings[d.declaration];if(!Q)throw m.d.Error(["No mapping found for node",d]),new Error("Error parsing nodes");if(Q.flowGraphMapping.validation){const n=Q.flowGraphMapping.validation(d,this._interactivityGraph,this._gltf);var v;if(!n.valid)throw new Error(`Error validating interactivity node ${null===(v=this._interactivityGraph.declarations)||void 0===v?void 0:v[d.declaration].op} - ${n.error}`)}const n=[];for(const v of Q.flowGraphMapping.Uk){const T=this._getEmptyBlock(v,Q.fullOperationName);this._parseNodeConfiguration(d,T,Q.flowGraphMapping,v),n.push(T)}this._nodes.push({Uk:n,fullOperationName:Q.fullOperationName})}}_getEmptyBlock(v,d){return{uniqueId:(0,ZQ.e)(),className:v,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:d,metadata:{}}}_parseNodeConfiguration(v,d,Q,n){const T=d.config;if(v.configuration){const d=Object.keys(v.configuration);for(const F of d){var L,e;const d=null===(L=v.configuration)||void 0===L?void 0:L[F];if(!d)throw m.d.Error(["No value found for node configuration",F]),new Error("Error parsing node configuration");const r=null===(e=Q.configuration)||void 0===e?void 0:e[F];if(r&&r.toBlock?r.toBlock===n:0===Q.Uk.indexOf(n)){const v=(null===r||void 0===r?void 0:r.name)||F;d&&"undefined"!==typeof d.value||"undefined"===typeof(null===r||void 0===r?void 0:r.defaultValue)?d.value.length>=0?T[v]={value:1===d.value.length?d.value[0]:d.value}:m.d.Warn(["Invalid value for node configuration",d]):T[v]={value:r.defaultValue},r&&r.dataTransformer&&(T[v].value=r.dataTransformer([T[v].value],this)[0])}}}}_parseNodeConnections(v){for(let O=0;O<this._nodes.length;O++){var d;const J=null===(d=this._interactivityGraph.nodes)||void 0===d?void 0:d[O];if(!J)throw m.d.Error(["No node found for interactivity node",this._nodes[O]]),new Error("Error parsing node connections");const K=this._nodes[O],o=this._mappings[J.declaration];if(!o)throw m.d.Error(["No mapping found for node",J]),new Error("Error parsing node connections");const g=J.flows||{},R=Object.keys(g).sort();for(const v of R){var Q,n,T,L;const d=g[v],C=null===(Q=o.flowGraphMapping.outputs)||void 0===Q||null===(n=Q.flows)||void 0===n?void 0:n[v],u=(null===C||void 0===C?void 0:C.name)||v,y=this._createNewSocketConnection(u,!0);(C&&C.toBlock&&K.Uk.find((v=>v.className===C.toBlock))||K.Uk[0]).signalOutputs.push(y);const z=d.node,B=this._nodes[z];if(!B)throw m.d.Error(["No node found for input node id",z]),new Error("Error parsing node connections");const X=oQ(B.fullOperationName);if(!X)throw m.d.Error(["No mapping found for input node",B]),new Error("Error parsing node connections");let V=null===(T=X.inputs)||void 0===T||null===(L=T.flows)||void 0===L?void 0:L[d.socket||"in"],h=!1;if(!V)for(const v in null===(e=X.inputs)||void 0===e?void 0:e.flows){var e,F,r;if(v.startsWith("[")&&v.endsWith("]"))h=!0,V=null===(F=X.inputs)||void 0===F||null===(r=F.flows)||void 0===r?void 0:r[v]}const S=V?h?V.name.replace("$1",d.socket||""):V.name:d.socket||"in",A=V&&V.toBlock&&B.Uk.find((v=>v.className===V.toBlock))||B.Uk[0];let f=A.signalInputs.find((v=>v.name===S));f||(f=this._createNewSocketConnection(S),A.signalInputs.push(f)),f.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(f.uniqueId)}const M=J.values||{},Y=Object.keys(M);for(const d of Y){var C,u;const Q=M[d];let n=null===(C=o.flowGraphMapping.inputs)||void 0===C||null===(u=C.values)||void 0===u?void 0:u[d],T=!1;if(!n)for(const v in null===(y=o.flowGraphMapping.inputs)||void 0===y?void 0:y.values){var y,z,B;if(v.startsWith("[")&&v.endsWith("]"))T=!0,n=null===(z=o.flowGraphMapping.inputs)||void 0===z||null===(B=z.values)||void 0===B?void 0:B[v]}const L=n?T?n.name.replace("$1",d):n.name:d,e=this._createNewSocketConnection(L);if((n&&n.toBlock&&K.Uk.find((v=>v.className===n.toBlock))||K.Uk[0]).dataInputs.push(e),void 0!==Q.value){const d=this._parseVariable(Q,n&&n.dataTransformer);v._connectionValues[e.uniqueId]=d}else{if("undefined"===typeof Q.node)throw m.d.Error(["Invalid value for value connection",Q]),new Error("Error parsing node connections");{var X,V,h;const v=Q.node,d=Q.socket||"value",n=this._nodes[v];if(!n)throw m.d.Error(["No node found for output socket reference",Q]),new Error("Error parsing node connections");const T=oQ(n.fullOperationName);if(!T)throw m.d.Error(["No mapping found for output socket reference",Q]),new Error("Error parsing node connections");let L=null===(X=T.outputs)||void 0===X||null===(V=X.values)||void 0===V?void 0:V[d],F=!1;if(!L)for(const Q in null===(S=T.outputs)||void 0===S?void 0:S.values){var S,A,f;if(Q.startsWith("[")&&Q.endsWith("]"))F=!0,L=null===(A=T.outputs)||void 0===A||null===(f=A.values)||void 0===f?void 0:f[Q]}const r=L?F?L.name.replace("$1",d):null===(h=L)||void 0===h?void 0:h.name:d,C=L&&L.toBlock&&n.Uk.find((v=>v.className===L.toBlock))||n.Uk[0];let u=C.dataOutputs.find((v=>v.name===r));u||(u=this._createNewSocketConnection(r,!0),C.dataOutputs.push(u)),e.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(e.uniqueId)}}}if(o.flowGraphMapping.interBlockConnectors)for(const v of o.flowGraphMapping.interBlockConnectors){const d=v.input,Q=v.output,n=v.isVariable;this._connectFlowGraphNodes(d,Q,K.Uk[v.inputBlockIndex],K.Uk[v.outputBlockIndex],n)}if(o.flowGraphMapping.extraProcessor){var P;const d=null===(P=this._interactivityGraph.declarations)||void 0===P?void 0:P[J.declaration];if(!d)throw m.d.Error(["No declaration found for extra processor",J]),new Error("Error parsing node connections");K.Uk=o.flowGraphMapping.extraProcessor(J,d,o.flowGraphMapping,this,K.Uk,v,this._gltf)}}}_createNewSocketConnection(v,d){return{uniqueId:(0,ZQ.e)(),name:v,_connectionType:d?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(v,d,Q,n,T){const L=T?Q.dataInputs:Q.signalInputs,e=T?n.dataOutputs:n.signalOutputs,F=L.find((d=>d.name===v))||this._createNewSocketConnection(v),r=e.find((v=>v.name===d))||this._createNewSocketConnection(d,!0);L.find((d=>d.name===v))||L.push(F),e.find((v=>v.name===d))||e.push(r),F.connectedPointIds.push(r.uniqueId),r.connectedPointIds.push(F.uniqueId)}getVariableName(v){return"staticVariable_"+v}serializeToFlowGraph(){const v={uniqueId:(0,ZQ.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(v);for(let d=0;d<this._staticVariables.length;d++){const Q=this._staticVariables[d];v._userVariables[this.getVariableName(d)]=Q}return{rightHanded:!0,allBlocks:this._nodes.reduce(((v,d)=>v.concat(d.Uk)),[]),executionContexts:[v]}}}const kQ="KHR_interactivity";class tQ{constructor(v){this._loader=v,this.name=kQ,this.enabled=this._loader.isExtensionUsed(kQ),this._pathConverter=(0,p.j)(this._loader.Qk),v._skipStartAnimationStep=!0;const d=v.babylonScene;d&&function(v){(0,p.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!v.activeCamera)return new T.c(NaN,NaN,NaN,NaN);const d=T.c.FromRotationMatrix(v.activeCamera.getWorldMatrix()).normalize();return v.useRightHandedSystem||(d.w*=-1,d.x*=-1),d},type:"Quaternion",getTarget:()=>v.activeCamera}),(0,p.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!v.activeCamera)return new T.j(NaN,NaN,NaN);const d=v.activeCamera.getWorldMatrix().getTranslation();return v.useRightHandedSystem||(d.x*=-1),d},type:"fk",getTarget:()=>v.activeCamera}),(0,p.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:v=>{var d;return(null===(d=v._babylonAnimationGroup)||void 0===d?void 0:d.isPlaying)??!1},type:"boolean",getTarget:v=>v._babylonAnimationGroup}),(0,p.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:v=>{var d;return((null===(d=v._babylonAnimationGroup)||void 0===d?void 0:d.from)??0)/60},type:"number",getTarget:v=>v._babylonAnimationGroup}),(0,p.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:v=>{var d;return((null===(d=v._babylonAnimationGroup)||void 0===d?void 0:d.to)??0)/60},type:"number",getTarget:v=>v._babylonAnimationGroup}),(0,p.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:v=>{var d;return((null===(d=v._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:v=>v._babylonAnimationGroup}),(0,p.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:v=>{var d;return((null===(d=v._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:v=>v._babylonAnimationGroup})}(d)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var v;if(!this._loader.babylonScene||!this._pathConverter)return;const d=this._loader.babylonScene,Q=null===(v=this._loader.Qk.extensions)||void 0===v?void 0:v.KHR_interactivity;if(!Q)return;const n=new XQ.c({yd:d});n.dispatchEventsSynchronously=!1;const T=Q.graphs.map((v=>new xQ(v,this._loader.Qk,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(T.map((async v=>await OQ(v,{coordinator:n,pathConverter:this._pathConverter})))),n.start()}}var pQ;pQ=async()=>(await Promise.resolve().then(Q.bind(Q,12970))).FlowGraphGLTFDataProvider,mQ[`${kQ}/${"FlowGraphGLTFDataProvider"}`]=pQ,t(kQ),k(kQ,!0,(v=>new tQ(v)));const WQ="KHR_node_visibility";(0,p.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:v=>{const d=v._babylonTransformNode;return!d||void 0===d.isVisible||d.isVisible},set:(v,d)=>{var Q,n;null===(Q=d._primitiveBabylonMeshes)||void 0===Q||Q.forEach((v=>{v.inheritVisibility=!0})),d._babylonTransformNode&&(d._babylonTransformNode.isVisible=v),null===(n=d._primitiveBabylonMeshes)||void 0===n||n.forEach((d=>{d.isVisible=v}))},getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class qQ{constructor(v){this.name=WQ,this._loader=v,this.enabled=v.isExtensionUsed(WQ)}async onReady(){var v;null===(v=this._loader.Qk.nodes)||void 0===v||v.forEach((v=>{var d,Q,n,T;(null===(d=v._primitiveBabylonMeshes)||void 0===d||d.forEach((v=>{v.inheritVisibility=!0})),null!==(Q=v.extensions)&&void 0!==Q&&Q.KHR_node_visibility)&&(!1===(null===(n=v.extensions)||void 0===n?void 0:n.KHR_node_visibility.visible)&&(v._babylonTransformNode&&(v._babylonTransformNode.isVisible=!1),null===(T=v._primitiveBabylonMeshes)||void 0===T||T.forEach((v=>{v.isVisible=!1}))))}))}dispose(){this._loader=null}}t(WQ),k(WQ,!0,(v=>new qQ(v)));const bQ="KHR_node_selectability";RQ("event/onSelect",bQ,{Uk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:v=>["pickedMesh_"+v[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(v,d,Q,n,T,L,e){var F,r,C,u,y,z;const B=T[T.length-1];B.config=B.config||{},B.config.glTF=e;const X=null===(F=v.configuration)||void 0===F||null===(r=F.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===X||"number"!==typeof X)throw new Error("nodeIndex not found in configuration");const m="pickedMesh_"+X;return T[1].config.variable=m,L._userVariables[m]={className:"Mesh",id:null===e||void 0===e||null===(C=e.nodes)||void 0===C||null===(u=C[X]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===e||void 0===e||null===(y=e.nodes)||void 0===y||null===(z=y[X]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},T}}),(0,p.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:v=>{const d=v._babylonTransformNode;return!d||void 0===d.We||d.We},set:(v,d)=>{var Q;null===(Q=d._primitiveBabylonMeshes)||void 0===Q||Q.forEach((d=>{d.We=v}))},getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"We"],type:"boolean"});class HQ{constructor(v){this.name=bQ,this._loader=v,this.enabled=v.isExtensionUsed(bQ)}async onReady(){var v;null===(v=this._loader.Qk.nodes)||void 0===v||v.forEach((v=>{var d,Q,n;null!==(d=v.extensions)&&void 0!==d&&d.KHR_node_selectability&&!1===(null===(Q=v.extensions)||void 0===Q?void 0:Q.KHR_node_selectability.selectable)&&(null===(n=v._babylonTransformNode)||void 0===n||n.getChildMeshes().forEach((v=>{v.We=!1})))}))}dispose(){this._loader=null}}t(bQ),k(bQ,!0,(v=>new HQ(v)));const sQ="KHR_node_hoverability",aQ="targetMeshPointerOver_";RQ("event/onHoverIn",sQ,{Uk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:v=>[aQ+v[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(v,d,Q,n,T,L,e){var F,r,C,u,y,z;const B=T[T.length-1];B.config=B.config||{},B.config.glTF=e;const X=null===(F=v.configuration)||void 0===F||null===(r=F.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===X||"number"!==typeof X)throw new Error("nodeIndex not found in configuration");const m=aQ+X;return T[1].config.variable=m,L._userVariables[m]={className:"Mesh",id:null===e||void 0===e||null===(C=e.nodes)||void 0===C||null===(u=C[X]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===e||void 0===e||null===(y=e.nodes)||void 0===y||null===(z=y[X]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},T}});const IQ="targetMeshPointerOut_";RQ("event/onHoverOut",sQ,{Uk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:v=>[IQ+v[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(v,d,Q,n,T,L,e){var F,r,C,u,y,z;const B=T[T.length-1];B.config=B.config||{},B.config.glTF=e;const X=null===(F=v.configuration)||void 0===F||null===(r=F.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===X||"number"!==typeof X)throw new Error("nodeIndex not found in configuration");const m=IQ+X;return T[1].config.variable=m,L._userVariables[m]={className:"Mesh",id:null===e||void 0===e||null===(C=e.nodes)||void 0===C||null===(u=C[X]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===e||void 0===e||null===(y=e.nodes)||void 0===y||null===(z=y[X]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},T}}),(0,p.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:v=>{const d=v._babylonTransformNode;return!d||void 0===d.pointerOverDisableMeshTesting||d.pointerOverDisableMeshTesting},set:(v,d)=>{var Q;null===(Q=d._primitiveBabylonMeshes)||void 0===Q||Q.forEach((d=>{d.pointerOverDisableMeshTesting=!v}))},getTarget:v=>v._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class UQ{constructor(v){this.name=sQ,this._loader=v,this.enabled=v.isExtensionUsed(sQ)}async onReady(){var v;null===(v=this._loader.Qk.nodes)||void 0===v||v.forEach((v=>{var d,Q,n;null!==(d=v.extensions)&&void 0!==d&&d.KHR_node_hoverability&&!1===(null===(Q=v.extensions)||void 0===Q?void 0:Q.KHR_node_hoverability.hoverable)&&(null===(n=v._babylonTransformNode)||void 0===n||n.getChildMeshes().forEach((v=>{v.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}t(sQ),k(sQ,!0,(v=>new UQ(v)));const cQ="ExtrasAsMetadata";class wQ{_assignExtras(v,d){if(d.extras&&Object.keys(d.extras).length>0){const Q=v.metadata=v.metadata||{};(Q.Qk=Q.Qk||{}).extras=d.extras}}constructor(v){this.name=cQ,this.enabled=!0,this._loader=v}dispose(){this._loader=null}loadNodeAsync(v,d,Q){return this._loader.loadNodeAsync(v,d,(v=>{this._assignExtras(v,d),Q(v)}))}loadCameraAsync(v,d,Q){return this._loader.loadCameraAsync(v,d,(v=>{this._assignExtras(v,d),Q(v)}))}createMaterial(v,d,Q){const n=this._loader.createMaterial(v,d,Q);return this._assignExtras(n,d),n}}t(cQ),k(cQ,!1,(v=>new wQ(v)));Q(12970)},12847:(v,d,Q)=>{"use strict";Q.d(d,{e:()=>i,h:()=>o,k:()=>K,m:()=>g});var n=Q(473),T=Q(475),L=Q(12463),e=Q(470),F=Q(809),r=Q(800),C=Q(482),u=Q(508),y=Q(11901),z=Q(12023),B=Q(616),X=Q(608);class m{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ck=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.om=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(v){this._environmentTexture=v}getNodes(){let v=[];v=v.concat(this.meshes),v=v.concat(this.lights),v=v.concat(this.cameras),v=v.concat(this.transformNodes);for(const d of this.skeletons)v=v.concat(d.bones);return v}}class V extends m{}class h{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const v=this.rootNodes;for(const n of v)n.dispose();v.length=0;const d=this.skeletons;for(const n of d)n.dispose();d.length=0;const Q=this.animationGroups;for(const n of Q)n.dispose();Q.length=0}}class S extends m{constructor(v){super(),this._wasAddedToScene=!1,(v=v||u.c.LastCreatedScene)&&(this.yd=v,this.proceduralTextures=[],v.kk.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=v.getEngine().onContextRestoredObservable.add((()=>{for(const v of this.geometries)v._rebuild();for(const v of this.meshes)v._rebuild();for(const v of this.Ck)v.rebuild();for(const v of this.textures)v._rebuild()})))}_topologicalSort(v){const d=new Map;for(const e of v)d.set(e.uniqueId,e);const Q={dependsOn:new Map,dependedBy:new Map};for(const e of v){const v=e.uniqueId;Q.dependsOn.set(v,new Set),Q.dependedBy.set(v,new Set)}for(const e of v){const v=e.uniqueId,n=Q.dependsOn.get(v);if(e instanceof y.b){const T=e.sourceMesh;d.has(T.uniqueId)&&(n.add(T.uniqueId),Q.dependedBy.get(T.uniqueId).add(v))}const T=Q.dependedBy.get(v);for(const L of e.getDescendants()){const n=L.uniqueId;if(d.has(n)){T.add(n);Q.dependsOn.get(n).add(v)}}}const n=[],T=[];for(const e of v){const v=e.uniqueId;0===Q.dependsOn.get(v).size&&(T.push(e),d.delete(v))}const L=T;for(;L.length>0;){const v=L.shift();n.push(v);const T=Q.dependedBy.get(v.uniqueId);for(const n of Array.from(T.values())){const T=Q.dependsOn.get(n);T.delete(v.uniqueId),0===T.size&&d.get(n)&&(L.push(d.get(n)),d.delete(n))}}return d.size>0&&(C.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),d.forEach((v=>{C.d.Error(v.name)}))),n}_addNodeAndDescendantsToList(v,d,Q,n){if(Q&&(!n||n(Q))&&!d.has(Q.uniqueId)){v.push(Q),d.add(Q.uniqueId);for(const T of Q.getDescendants(!0))this._addNodeAndDescendantsToList(v,d,T,n)}}_isNodeInContainer(v){return v instanceof r.d&&-1!==this.meshes.indexOf(v)||(v instanceof F.d&&-1!==this.transformNodes.indexOf(v)||(v instanceof z.d&&-1!==this.lights.indexOf(v)||v instanceof B.c&&-1!==this.cameras.indexOf(v)))}_isValidHierarchy(){for(const v of this.meshes)if(v.parent&&!this._isNodeInContainer(v.parent))return C.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.transformNodes)if(v.parent&&!this._isNodeInContainer(v.parent))return C.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.lights)if(v.parent&&!this._isNodeInContainer(v.parent))return C.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.cameras)if(v.parent&&!this._isNodeInContainer(v.parent))return C.d.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(v){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||T.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const n={},L={},F=new h,r=[],C=[],u={doNotInstantiate:!0,...Q},y=[],z=new Set;for(const T of this.transformNodes)null===T.parent&&this._addNodeAndDescendantsToList(y,z,T,u.predicate);for(const T of this.meshes)null===T.parent&&this._addNodeAndDescendantsToList(y,z,T,u.predicate);const B=this._topologicalSort(y),X=(Q,T)=>{if(((d,Q)=>{if(n[d.uniqueId]=Q.uniqueId,L[Q.uniqueId]=Q,v&&(Q.name=v(d.name)),Q instanceof e.b){const v=Q;if(v.morphTargetManager){const Q=d.morphTargetManager;v.morphTargetManager=Q.clone();for(let d=0;d<Q.numTargets;d++){const T=Q.getTarget(d),e=v.morphTargetManager.getTarget(d);n[T.uniqueId]=e.uniqueId,L[e.uniqueId]=e}}}})(Q,T),Q.parent){const v=n[Q.parent.uniqueId],d=L[v];T.parent=d||Q.parent}if(T.position&&Q.position&&T.position.p(Q.position),T.rotationQuaternion&&Q.rotationQuaternion&&T.rotationQuaternion.p(Q.rotationQuaternion),T.rotation&&Q.rotation&&T.rotation.p(Q.rotation),T.md&&Q.md&&T.md.p(Q.md),T.material){const e=T;if(e.material)if(d){const d=Q.material;if(-1===C.indexOf(d)){let Q=d.clone(v?v(d.name):"Clone of "+d.name);if(C.push(d),n[d.uniqueId]=Q.uniqueId,L[Q.uniqueId]=Q,"MultiMaterial"===d.getClassName()){const T=d;for(const d of T.vk)d&&(Q=d.clone(v?v(d.name):"Clone of "+d.name),C.push(d),n[d.uniqueId]=Q.uniqueId,L[Q.uniqueId]=Q);T.vk=T.vk.map((v=>v&&L[n[v.uniqueId]]))}}"InstancedMesh"!==e.getClassName()&&(e.material=L[n[d.uniqueId]])}else"MultiMaterial"===e.material.getClassName()?-1===this.yd.multiMaterials.indexOf(e.material)&&this.yd.addMultiMaterial(e.material):-1===this.yd.materials.indexOf(e.material)&&this.yd.addMaterial(e.material)}null===T.parent&&F.rootNodes.push(T)};for(const T of B)if("InstancedMesh"===T.getClassName()){const v=T,d=v.sourceMesh,Q=n[d.uniqueId];X(v,("number"===typeof Q?L[Q]:d).createInstance(v.name))}else{let v=!0;"Pk"===T.getClassName()||"Node"===T.getClassName()||T.skeleton||!T.getTotalVertices||0===T.getTotalVertices()?v=!1:u.doNotInstantiate&&(v="function"===typeof u.doNotInstantiate?!u.doNotInstantiate(T):!u.doNotInstantiate);const d=v?T.createInstance(`instance of ${T.name}`):T.clone(`Clone of ${T.name}`,null,!0);if(!d)throw new Error(`Could not clone or instantiate node on Asset Container ${T.name}`);X(T,d)}for(const T of this.skeletons){if(u.predicate&&!u.predicate(T))continue;const d=T.clone(v?v(T.name):"Clone of "+T.name);for(const v of this.meshes)if(v.skeleton===T&&!v.isAnInstance){const Q=L[n[v.uniqueId]];if(!Q||Q.isAnInstance)continue;if(Q.skeleton=d,-1!==r.indexOf(d))continue;r.push(d);for(const v of d.bones)v._linkedTransformNode&&(v._linkedTransformNode=L[n[v._linkedTransformNode.uniqueId]])}F.skeletons.push(d)}for(const T of this.animationGroups){if(u.predicate&&!u.predicate(T))continue;const d=T.clone(v?v(T.name):"Clone of "+T.name,(v=>L[n[v.uniqueId]]||v));F.animationGroups.push(d)}return F}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||T.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.yd.environmentTexture=this.environmentTexture);for(const v of this.yd._serializableComponents)v.addFromContainer(this);this.yd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=[];for(const Q of this.cameras)v&&!v(Q)||(this.yd.addCamera(Q),d.push(Q));for(const Q of this.lights)v&&!v(Q)||(this.yd.addLight(Q),d.push(Q));for(const Q of this.meshes)v&&!v(Q)||(this.yd.Ak(Q),d.push(Q));for(const Q of this.skeletons)v&&!v(Q)||this.yd.addSkeleton(Q);for(const Q of this.animations)v&&!v(Q)||this.yd.addAnimation(Q);for(const Q of this.animationGroups)v&&!v(Q)||this.yd.addAnimationGroup(Q);for(const Q of this.multiMaterials)v&&!v(Q)||this.yd.addMultiMaterial(Q);for(const Q of this.materials)v&&!v(Q)||this.yd.addMaterial(Q);for(const Q of this.morphTargetManagers)v&&!v(Q)||this.yd.addMorphTargetManager(Q);for(const Q of this.geometries)v&&!v(Q)||this.yd.addGeometry(Q);for(const Q of this.transformNodes)v&&!v(Q)||(this.yd.addTransformNode(Q),d.push(Q));for(const Q of this.actionManagers)v&&!v(Q)||this.yd.addActionManager(Q);for(const Q of this.textures)v&&!v(Q)||this.yd.addTexture(Q);for(const Q of this.reflectionProbes)v&&!v(Q)||this.yd.addReflectionProbe(Q);for(const Q of d)Q.parent&&-1===this.yd.getNodes().indexOf(Q.parent)&&(Q.setParent?Q.setParent(null):Q.parent=null)}removeAllFromScene(){this._isValidHierarchy()||T.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.yd.environmentTexture&&(this.yd.environmentTexture=null);for(const v of this.yd._serializableComponents)v.removeFromContainer(this)}removeFromScene(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const d of this.cameras)v&&!v(d)||this.yd.removeCamera(d);for(const d of this.lights)v&&!v(d)||this.yd.removeLight(d);for(const d of this.meshes)v&&!v(d)||this.yd.Bk(d,!0);for(const d of this.skeletons)v&&!v(d)||this.yd.removeSkeleton(d);for(const d of this.animations)v&&!v(d)||this.yd.removeAnimation(d);for(const d of this.animationGroups)v&&!v(d)||this.yd.removeAnimationGroup(d);for(const d of this.multiMaterials)v&&!v(d)||this.yd.removeMultiMaterial(d);for(const d of this.materials)v&&!v(d)||this.yd.removeMaterial(d);for(const d of this.morphTargetManagers)v&&!v(d)||this.yd.removeMorphTargetManager(d);for(const d of this.geometries)v&&!v(d)||this.yd.removeGeometry(d);for(const d of this.transformNodes)v&&!v(d)||this.yd.removeTransformNode(d);for(const d of this.actionManagers)v&&!v(d)||this.yd.removeActionManager(d);for(const d of this.textures)v&&!v(d)||this.yd.removeTexture(d);for(const d of this.reflectionProbes)v&&!v(d)||this.yd.removeReflectionProbe(d)}dispose(){const v=this.cameras.slice(0);for(const B of v)B.dispose();this.cameras.length=0;const d=this.lights.slice(0);for(const B of d)B.dispose();this.lights.length=0;const Q=this.meshes.slice(0);for(const B of Q)B.dispose();this.meshes.length=0;const n=this.skeletons.slice(0);for(const B of n)B.dispose();this.skeletons.length=0;const T=this.animationGroups.slice(0);for(const B of T)B.dispose();this.animationGroups.length=0;const L=this.multiMaterials.slice(0);for(const B of L)B.dispose();this.multiMaterials.length=0;const e=this.materials.slice(0);for(const B of e)B.dispose();this.materials.length=0;const F=this.geometries.slice(0);for(const B of F)B.dispose();this.geometries.length=0;const r=this.transformNodes.slice(0);for(const B of r)B.dispose();this.transformNodes.length=0;const C=this.actionManagers.slice(0);for(const B of C)B.dispose();this.actionManagers.length=0;const u=this.textures.slice(0);for(const B of u)B.dispose();this.textures.length=0;const y=this.reflectionProbes.slice(0);for(const B of y)B.dispose();this.reflectionProbes.length=0;const z=this.morphTargetManagers.slice(0);for(const B of z)B.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const B of this.yd._serializableComponents)B.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.yd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(v,d,Q){if(v&&d)for(const n of v){let v=!0;if(Q)for(const d of Q)if(n===d){v=!1;break}v&&(d.push(n),n._parentContainer=this)}}moveAllFromScene(v){this._wasAddedToScene=!1,void 0===v&&(v=new V);for(const d in this)Object.prototype.hasOwnProperty.call(this,d)&&(this[d]=this[d]||("_environmentTexture"===d?null:[]),this._moveAssets(this.yd[d],this[d],v[d]));this.environmentTexture=this.yd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const v=new e.b("assetContainerRootMesh",this.yd);for(const d of this.meshes)d.parent||v.addChild(d);return this.meshes.unshift(v),v}mergeAnimationsTo(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.c.LastCreatedScene,d=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!v)return C.d.Error("No scene available to merge animations to"),[];const n=Q||(d=>{let Q=null;const n=d.animations.length?d.animations[0].targetProperty:"",T=d.name.split(".").join("").split("_primitive")[0];switch(n){case"position":case"rotationQuaternion":Q=v.getTransformNodeByName(d.name)||v.getTransformNodeByName(T);break;case"influence":Q=v.getMorphTargetByName(d.name)||v.getMorphTargetByName(T);break;default:Q=v.getNodeByName(d.name)||v.getNodeByName(T)}return Q}),T=this.getNodes();for(const F of T){const v=n(F);if(null!==v){for(const d of F.animations){const Q=v.animations.filter((v=>v.targetProperty===d.targetProperty));for(const d of Q){const Q=v.animations.indexOf(d,0);Q>-1&&v.animations.splice(Q,1)}}v.animations=v.animations.concat(F.animations)}}const L=[],e=this.animationGroups.slice();for(const F of e){L.push(F.clone(F.name,n));for(const v of F.animatables)v.stop()}for(const F of d){const d=n(F.target);d&&(v.beginAnimation(d,F.fromFrame,F.toFrame,F.loopAnimation,F.speedRatio,F.onAnimationEnd?F.onAnimationEnd:void 0,void 0,!0,void 0,F.onAnimationLoop?F.onAnimationLoop:void 0),v.stopAnimation(F.target))}return L}populateRootNodes(){this.rootNodes.length=0;for(const v of this.meshes)v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v);for(const v of this.transformNodes)v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v);for(const v of this.lights)v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v);for(const v of this.cameras)v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)}addAllAssetsToContainer(v){if(!v)return;const d=[],Q=new Set;for(d.push(v);d.length>0;){const v=d.pop();if(v instanceof e.b?(v.sk&&-1===this.geometries.indexOf(v.sk)&&this.geometries.push(v.sk),this.meshes.push(v)):v instanceof y.b?this.meshes.push(v):v instanceof F.d?this.transformNodes.push(v):v instanceof z.d?this.lights.push(v):v instanceof B.c&&this.cameras.push(v),v instanceof r.d){if(v.material&&-1===this.materials.indexOf(v.material)){this.materials.push(v.material);for(const d of v.material.getActiveTextures())-1===this.textures.indexOf(d)&&this.textures.push(d)}v.skeleton&&-1===this.skeletons.indexOf(v.skeleton)&&this.skeletons.push(v.skeleton),v.morphTargetManager&&-1===this.morphTargetManagers.indexOf(v.morphTargetManager)&&this.morphTargetManagers.push(v.morphTargetManager)}for(const n of v.getChildren())Q.has(n)||d.push(n);Q.add(v)}this.populateRootNodes()}_getByTags(v,d,Q){if(void 0===d)return v;const n=[];for(const T in v){const L=v[T];X.b&&X.b.MatchesQuery(L,d)&&(!Q||Q(L))&&n.push(L)}return n}getMeshesByTags(v,d){return this._getByTags(this.meshes,v,d)}getCamerasByTags(v,d){return this._getByTags(this.cameras,v,d)}getLightsByTags(v,d){return this._getByTags(this.lights,v,d)}getMaterialsByTags(v,d){return this._getByTags(this.materials,v,d).concat(this._getByTags(this.multiMaterials,v,d))}getTransformNodesByTags(v,d){return this._getByTags(this.transformNodes,v,d)}}var A=Q(522);class f{constructor(v){this.byteOffset=0,this.buffer=v}async loadAsync(v){const d=await this.buffer.readAsync(this.byteOffset,v);this._dataView=new DataView(d.buffer,d.byteOffset,d.byteLength),this._dataByteOffset=0}readUint32(){const v=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,v}readUint8Array(v){const d=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,v);return this._dataByteOffset+=v,this.byteOffset+=v,d}readString(v){return(0,A.e)(this.readUint8Array(v))}skipBytes(v){this._dataByteOffset+=v,this.byteOffset+=v}}var P=Q(12851);const O="Z2xURg",J={name:"Qk",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:v=>-1!==v.indexOf("asset")&&-1!==v.indexOf("version")||v.startsWith("data:base64,"+O)||v.startsWith("data:;base64,"+O)||v.startsWith("data:application/octet-stream;base64,"+O)||v.startsWith("data:model/gltf-binary;base64,"+O)};var K,o,g,R=Q(512),M=Q(520);function Y(v,d,Q){try{return Promise.resolve(new Uint8Array(v,d,Q))}catch(n){return Promise.reject(n)}}!function(v){v[v.AUTO=0]="AUTO",v[v.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(K||(K={})),function(v){v[v.NONE=0]="NONE",v[v.FIRST=1]="FIRST",v[v.ALL=2]="ALL"}(o||(o={})),function(v){v[v.LOADING=0]="LOADING",v[v.READY=1]="READY",v[v.COMPLETE=2]="COMPLETE"}(g||(g={}));class D{constructor(){this.coordinateSystemMode=K.AUTO,this.animationStartMode=o.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=v=>Promise.resolve(v),this.extensionOptions={}}p(v){v&&(this.onParsed=v.onParsed,this.coordinateSystemMode=v.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=v.animationStartMode??this.animationStartMode,this.loadNodeAnimations=v.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=v.loadSkins??this.loadSkins,this.loadMorphTargets=v.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=v.compileMaterials??this.compileMaterials,this.useClipPlane=v.useClipPlane??this.useClipPlane,this.compileShadowGenerators=v.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=v.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=v.useRangeRequests??this.useRangeRequests,this.createInstances=v.createInstances??this.createInstances,this.alwaysComputeBoundingBox=v.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=v.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=v.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=v.skipMaterials??this.skipMaterials,this.useSRGBBuffers=v.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=v.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=v.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=v.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=v.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=v.customRootNode,this.onMeshLoaded=v.onMeshLoaded,this.onSkinLoaded=v.onSkinLoaded,this.onTextureLoaded=v.onTextureLoaded,this.onMaterialLoaded=v.onMaterialLoaded,this.onCameraLoaded=v.onCameraLoaded,this.extensionOptions=v.extensionOptions??this.extensionOptions)}}class i extends D{constructor(v){super(),this.onParsedObservable=new n.e,this.onMeshLoadedObservable=new n.e,this.onSkinLoadedObservable=new n.e,this.onTextureLoadedObservable=new n.e,this.onMaterialLoadedObservable=new n.e,this.onCameraLoadedObservable=new n.e,this.onCompleteObservable=new n.e,this.onErrorObservable=new n.e,this.kk=new n.e,this.onExtensionLoadedObservable=new n.e,this.validate=!1,this.onValidatedObservable=new n.e,this._loader=null,this._state=null,this._requests=new Array,this.name=J.name,this.extensions=J.extensions,this.onLoaderStateChangedObservable=new n.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(v)}set onParsed(v){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),v&&(this._onParsedObserver=this.onParsedObservable.add(v))}set onMeshLoaded(v){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),v&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(v))}set onSkinLoaded(v){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),v&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((d=>v(d.node,d.skinnedNode))))}set onTextureLoaded(v){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),v&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(v))}set onMaterialLoaded(v){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),v&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(v))}set onCameraLoaded(v){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),v&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(v))}set onComplete(v){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(v)}set onError(v){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(v)}set onDispose(v){this._onDisposeObserver&&this.kk.remove(this._onDisposeObserver),this._onDisposeObserver=this.kk.add(v)}set onExtensionLoaded(v){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(v)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(v){this._loggingEnabled!==v&&(this._loggingEnabled=v,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(v){this._capturePerformanceCounters!==v&&(this._capturePerformanceCounters=v,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(v){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(v)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const v of this._requests)v.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=v=>Promise.resolve(v),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.kk.notifyObservers(void 0),this.kk.clear()}loadFile(v,d,Q,L,e,F,r,u){if(ArrayBuffer.isView(d))return this._loadBinary(v,d,Q,L,r,u),null;this._progressCallback=e;const y=d.name||T.e.GetFilename(d);if(F){if(this.useRangeRequests){this.validate&&C.d.Warn("glTF validation is not supported when range requests are enabled");const Q={abort:()=>{},onCompleteObservable:new n.e},T={readAsync:(Q,n)=>new Promise(((T,L)=>{this._loadFile(v,d,(v=>{T(new Uint8Array(v))}),!0,(v=>{L(v)}),(v=>{v.setRequestHeader("Range",`bytes=${Q}-${Q+n-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new f(T)).then((v=>{Q.onCompleteObservable.notifyObservers(Q),L(v)}),r?v=>r(void 0,v):void 0),Q}return this._loadFile(v,d,(d=>{this._validate(v,new Uint8Array(d,0,d.byteLength),Q,y),this._unpackBinaryAsync(new f({readAsync:(v,Q)=>Y(d,v,Q),byteLength:d.byteLength})).then((v=>{L(v)}),r?v=>r(void 0,v):void 0)}),!0,r)}return this._loadFile(v,d,(d=>{try{this._validate(v,d,Q,y),L({json:this._parseJson(d)})}catch{r&&r()}}),!1,r)}_loadBinary(v,d,Q,n,T,L){this._validate(v,new Uint8Array(d.buffer,d.byteOffset,d.byteLength),Q,L),this._unpackBinaryAsync(new f({readAsync:(v,Q)=>function(v,d,Q){try{if(d<0||d>=v.byteLength)throw new RangeError("Offset is out of range.");if(d+Q>v.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(v.buffer,v.byteOffset+d,Q))}catch(n){return Promise.reject(n)}}(d,v,Q),byteLength:d.byteLength})).then((v=>{n(v)}),T?v=>T(void 0,v):void 0)}importMeshAsync(v,d,Q,n,T,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(Q),this._loader.importMeshAsync(v,d,null,Q,n,T,L))))}loadAsync(v,d,Q,n,T){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${T||""}`),this._loader=this._getLoader(d),this._loader.loadAsync(v,d,Q,n,T))))}loadAssetContainerAsync(v,d,Q,n,T){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${T||""}`),this._loader=this._getLoader(d);const L=new S(v),e=[];this.onMaterialLoadedObservable.add((v=>{e.push(v)}));const F=[];this.onTextureLoadedObservable.add((v=>{F.push(v)}));const r=[];this.onCameraLoadedObservable.add((v=>{r.push(v)}));const C=[];return this.onMeshLoadedObservable.add((v=>{v.morphTargetManager&&C.push(v.morphTargetManager)})),this._loader.importMeshAsync(null,v,L,d,Q,n,T).then((v=>(Array.prototype.push.apply(L.geometries,v.geometries),Array.prototype.push.apply(L.meshes,v.meshes),Array.prototype.push.apply(L.Ck,v.Ck),Array.prototype.push.apply(L.skeletons,v.skeletons),Array.prototype.push.apply(L.animationGroups,v.animationGroups),Array.prototype.push.apply(L.materials,e),Array.prototype.push.apply(L.textures,F),Array.prototype.push.apply(L.lights,v.lights),Array.prototype.push.apply(L.transformNodes,v.transformNodes),Array.prototype.push.apply(L.cameras,r),Array.prototype.push.apply(L.morphTargetManagers,C),L)))}))}canDirectLoad(v){return J.canDirectLoad(v)}directLoad(v,d){if(d.startsWith("base64,"+O)||d.startsWith(";base64,"+O)||d.startsWith("application/octet-stream;base64,"+O)||d.startsWith("model/gltf-binary;base64,"+O)){const Q=(0,R.e)(d);return this._validate(v,new Uint8Array(Q,0,Q.byteLength)),this._unpackBinaryAsync(new f({readAsync:(v,d)=>Y(Q,v,d),byteLength:Q.byteLength}))}return this._validate(v,d),Promise.resolve({json:this._parseJson(d)})}createPlugin(v){return new i(v[J.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((v,d)=>{this.onCompleteObservable.addOnce((()=>{v()})),this.onErrorObservable.addOnce((v=>{d(v)}))}))}_setState(v){this._state!==v&&(this._state=v,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(g[this._state]))}_loadFile(v,d,Q,n,T,L){const e=v._loadFile(d,Q,(v=>{this._onProgress(v,e)}),!0,n,T,L);return e.onCompleteObservable.add((()=>{e._lengthComputable=!0,e._total=e._loaded})),this._requests.push(e),e}_onProgress(v,d){if(!this._progressCallback)return;d._lengthComputable=v.lengthComputable,d._loaded=v.loaded,d._total=v.total;let Q=!0,n=0,T=0;for(const L of this._requests){if(void 0===L._lengthComputable||void 0===L._loaded||void 0===L._total)return;Q=Q&&L._lengthComputable,n+=L._loaded,T+=L._total}this._progressCallback({lengthComputable:Q,loaded:n,total:Q?T:0})}_validate(v,d){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),P.c.ValidateAsync(d,Q,n,(d=>this.preprocessUrlAsync(Q+d).then((d=>v._loadFileAsync(d,void 0,!0,!0).then((v=>new Uint8Array(v,0,v.byteLength))))))).then((v=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(v),this.onValidatedObservable.clear()}),(v=>{this._endPerformanceCounter("Validate JSON"),T.e.Warn(`Failed to validate: ${v.message}`),this.onValidatedObservable.clear()})))}_getLoader(v){const d=v.json.asset||{};this._log(`Asset version: ${d.version}`),d.minVersion&&this._log(`Asset minimum version: ${d.minVersion}`),d.generator&&this._log(`Asset generator: ${d.generator}`);const Q=i._parseVersion(d.version);if(!Q)throw new Error("Invalid version: "+d.version);if(void 0!==d.minVersion){const v=i._parseVersion(d.minVersion);if(!v)throw new Error("Invalid minimum version: "+d.minVersion);if(i._compareVersion(v,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+d.minVersion)}const n={1:i._CreateGLTF1Loader,2:i._CreateGLTF2Loader}[Q.major];if(!n)throw new Error("Unsupported version: "+d.version);return n(this)}_parseJson(v){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${v.length}`);const d=JSON.parse(v);return this._endPerformanceCounter("Parse JSON"),d}_unpackBinaryAsync(v){return this._startPerformanceCounter("Unpack Binary"),v.loadAsync(20).then((()=>{const d=v.readUint32();if(1179937895!==d)throw new M.l("Unexpected magic: "+d,M.h.GLTFLoaderUnexpectedMagicError);const Q=v.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Q}`);const n=v.readUint32();let T;switch(this.useRangeRequests||n===v.buffer.byteLength||C.d.Warn(`Length in header does not match actual data length: ${n} != ${v.buffer.byteLength}`),Q){case 1:T=this._unpackBinaryV1Async(v,n);break;case 2:T=this._unpackBinaryV2Async(v,n);break;default:throw new Error("Unsupported version: "+Q)}return this._endPerformanceCounter("Unpack Binary"),T}))}_unpackBinaryV1Async(v,d){const Q=v.readUint32(),n=v.readUint32();if(0!==n)throw new Error(`Unexpected content format: ${n}`);const T=d-v.byteOffset,L={json:this._parseJson(v.readString(Q)),bin:null};if(0!==T){const d=v.byteOffset;L.bin={readAsync:(Q,n)=>v.buffer.readAsync(d+Q,n),byteLength:T}}return Promise.resolve(L)}_unpackBinaryV2Async(v,d){const Q=1313821514,n=5130562,T=v.readUint32();if(v.readUint32()!==Q)throw new Error("First chunk format is not JSON");return v.byteOffset+T===d?v.loadAsync(T).then((()=>({json:this._parseJson(v.readString(T)),bin:null}))):v.loadAsync(T+8).then((()=>{const L={json:this._parseJson(v.readString(T)),bin:null},e=()=>{const T=v.readUint32();switch(v.readUint32()){case Q:throw new Error("Unexpected JSON chunk");case n:{const d=v.byteOffset;L.bin={readAsync:(Q,n)=>v.buffer.readAsync(d+Q,n),byteLength:T},v.skipBytes(T);break}default:v.skipBytes(T)}return v.byteOffset!==d?v.loadAsync(8).then(e):Promise.resolve(L)};return e()}))}static _parseVersion(v){if("1.0"===v||"1.0.1"===v)return{major:1,minor:0};const d=(v+"").match(/^(\d+)\.(\d+)/);return d?{major:parseInt(d[1]),minor:parseInt(d[2])}:null}static _compareVersion(v,d){return v.major>d.major?1:v.major<d.major?-1:v.minor>d.minor?1:v.minor<d.minor?-1:0}_logOpen(v){this._log(v),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(v){const d=i._logSpaces.substring(0,2*this._logIndentLevel);C.d.Log(`${d}${v}`)}_logDisabled(v){}_startPerformanceCounterEnabled(v){T.e.StartPerformanceCounter(v)}_startPerformanceCounterDisabled(v){}_endPerformanceCounterEnabled(v){T.e.EndPerformanceCounter(v)}_endPerformanceCounterDisabled(v){}}i.IncrementalLoading=!0,i.HomogeneousCoordinates=!1,i._logSpaces="                                ",(0,L.c)(new i)},12851:(v,d,Q)=>{"use strict";Q.d(d,{c:()=>e});var n=Q(475);function T(v,d,Q,n){const T={externalResourceFunction:n};return Q&&(T.uri="file:"===d?Q:d+Q),ArrayBuffer.isView(v)?GLTFValidator.validateBytes(v,T):GLTFValidator.validateString(v,T)}function L(){const v=[];onmessage=d=>{const Q=d.data;switch(Q.id){case"init":importScripts(Q.url);break;case"validate":T(Q.data,Q.rootUrl,Q.fileName,(d=>new Promise(((Q,n)=>{const T=v.length;v.push({resolve:Q,reject:n}),postMessage({id:"getExternalResource",index:T,uri:d})})))).then((v=>{postMessage({id:"validate.resolve",value:v})}),(v=>{postMessage({id:"validate.reject",reason:v})}));break;case"getExternalResource.resolve":v[Q.index].resolve(Q.value);break;case"getExternalResource.reject":v[Q.index].reject(Q.reason)}}}class e{static ValidateAsync(v,d,Q,e){return"function"===typeof Worker?new Promise(((F,r)=>{const C=`${T}(${L})()`,u=URL.createObjectURL(new Blob([C],{type:"application/javascript"})),y=new Worker(u),z=v=>{y.removeEventListener("error",z),y.removeEventListener("message",B),r(v)},B=v=>{const d=v.data;switch(d.id){case"getExternalResource":e(d.uri).then((v=>{y.postMessage({id:"getExternalResource.resolve",index:d.index,value:v},[v.buffer])}),(v=>{y.postMessage({id:"getExternalResource.reject",index:d.index,reason:v})}));break;case"validate.resolve":y.removeEventListener("error",z),y.removeEventListener("message",B),F(d.value),y.terminate();break;case"validate.reject":y.removeEventListener("error",z),y.removeEventListener("message",B),r(d.reason),y.terminate()}};if(y.addEventListener("error",z),y.addEventListener("message",B),y.postMessage({id:"init",url:n.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(v)){const n=v.slice();y.postMessage({id:"validate",data:n,rootUrl:d,fileName:Q},[n.buffer])}else y.postMessage({id:"validate",data:v,rootUrl:d,fileName:Q})})):(this._LoadScriptPromise||(this._LoadScriptPromise=n.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>T(v,d,Q,e))))}}e.Configuration={url:`${n.e._DefaultCdnUrl}/gltf_validator.js`}},13199:(v,d,Q)=>{"use strict";Q.d(d,{b:()=>J});var n=Q(620),T=Q(629),L=Q(677),e=Q(651),F=Q(11939),r=Q(11959),C=Q(706),u=Q(2167),y=Q(591),z=Q(553);Q(12597),Q(12502),Q(12516),Q(12509),Q(12523),Q(12528),Q(12530);const B="imageProcessingCompatibility",X="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";z.e.IncludesShadersStore[B]||(z.e.IncludesShadersStore[B]=X);const m="skyPixelShader",V="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";z.e.ShadersStore[m]||(z.e.ShadersStore[m]=V);Q(12605),Q(12539),Q(12542),Q(12554),Q(12550);const h="skyVertexShader",S="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";z.e.ShadersStore[h]||(z.e.ShadersStore[h]=S);var A=Q(11975),f=Q(847),P=Q(832);class O extends F.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class J extends r.e{constructor(v,d){super(v,d),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new e.j(0,100,0),this.useSunPosition=!1,this.cameraOffset=e.j.Zero(),this.up=e.j.Up(),this.dithering=!1,this._cameraPosition=e.j.Zero(),this._skyOrientation=new e.c}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(v,d){const Q=d._drawWrapper;if(this.isFrozen&&Q.effect&&Q._wasPreviouslyReady)return!0;d.materialDefines||(d.materialDefines=new O);const n=d.materialDefines,T=this.va();if(this._isReadyForSubMesh(d))return!0;if((0,P._)(v,T,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,n),(0,P.N)(v,n,!0,!1),n.IMAGEPROCESSINGPOSTPROCESS!==T.imageProcessingConfiguration.applyByPostProcess&&n.markAsMiscDirty(),n.DITHER!==this.dithering&&n.markAsMiscDirty(),n.isDirty){n.markAsProcessed(),T.resetCachedMaterial();const v=new A.e;n.FOG&&v.addFallback(1,"FOG"),n.IMAGEPROCESSINGPOSTPROCESS=T.imageProcessingConfiguration.applyByPostProcess,n.DITHER=this.dithering;const Q=[C.e.PositionKind];n.VERTEXCOLOR&&Q.push(C.e.ColorKind);const L="sky",e=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.c)(e);const F=n.toString();d.setEffect(T.getEngine().createEffect(L,Q,e,[],F,v,this.onCompiled,this.onError),n,this._materialContext)}return!(!d.effect||!d.effect.isReady())&&(n._renderId=T.getRenderId(),Q._wasPreviouslyReady=!0,!0)}bindForSubMesh(v,d,Q){const n=this.va(),T=Q.materialDefines;if(!T)return;const L=Q.effect;if(!L)return;this._activeEffect=L,this.bindOnlyWorldMatrix(v),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),this._mustRebind(n,L,Q)&&((0,f.f)(L,this,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,P.l)(T,L,n)),n.fogEnabled&&d.applyFog&&n.fogMode!==u.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),(0,P.f)(n,d,this._activeEffect);const F=n.activeCamera;if(F){const v=F.getWorldMatrix();this._cameraPosition.x=v.m[12],this._cameraPosition.y=v.m[13],this._cameraPosition.z=v.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const v=Math.PI*(this.inclination-.5),d=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(d)*Math.cos(v),this.sunPosition.y=this.distance*Math.sin(-v),this.sunPosition.z=this.distance*Math.sin(d)*Math.cos(v),e.c.FromUnitVectorsToRef(e.j.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(d,this._activeEffect,Q)}getAnimatables(){return[]}dispose(v){super.dispose(v)}clone(v){return L.e.Clone((()=>new J(v,this.va())),this)}serialize(){const v=super.serialize();return v.customType="BABYLON.SkyMaterial",v}getClassName(){return"SkyMaterial"}static Parse(v,d,Q){return L.e.Parse((()=>new J(v.name,d)),v,d,Q)}}(0,n.b)([(0,T.F)()],J.prototype,"luminance",void 0),(0,n.b)([(0,T.F)()],J.prototype,"turbidity",void 0),(0,n.b)([(0,T.F)()],J.prototype,"rayleigh",void 0),(0,n.b)([(0,T.F)()],J.prototype,"mieCoefficient",void 0),(0,n.b)([(0,T.F)()],J.prototype,"mieDirectionalG",void 0),(0,n.b)([(0,T.F)()],J.prototype,"distance",void 0),(0,n.b)([(0,T.F)()],J.prototype,"inclination",void 0),(0,n.b)([(0,T.F)()],J.prototype,"azimuth",void 0),(0,n.b)([(0,T.C)()],J.prototype,"sunPosition",void 0),(0,n.b)([(0,T.F)()],J.prototype,"useSunPosition",void 0),(0,n.b)([(0,T.C)()],J.prototype,"cameraOffset",void 0),(0,n.b)([(0,T.C)()],J.prototype,"up",void 0),(0,n.b)([(0,T.F)()],J.prototype,"dithering",void 0),(0,y.f)("BABYLON.SkyMaterial",J)},12104:(v,d,Q)=>{"use strict";function n(v,d){d.headers=v.headers||{},d.statusMessage=v.statusText,d.statusCode=v.status,d.data=v.response}function T(v,d,Q){return new Promise((function(T,L){Q=Q||{};var e,F,r,C=new XMLHttpRequest,u=Q.body,y=Q.headers||{};for(e in Q.timeout&&(C.timeout=Q.timeout),C.ontimeout=C.onerror=function(v){v.timeout="timeout"==v.type,L(v)},C.open(v,d.href||d),C.onload=function(){for(r=C.getAllResponseHeaders().trim().split(/[\r\n]+/),n(C,C);F=r.shift();)F=F.split(": "),C.headers[F.shift().toLowerCase()]=F.join(": ");if((F=C.headers["content-type"])&&~F.indexOf("application/json"))try{C.data=JSON.parse(C.data,Q.reviver)}catch(v){return n(C,v),L(v)}(C.status>=400?L:T)(C)},typeof FormData<"u"&&u instanceof FormData||u&&"object"==typeof u&&(y["content-type"]="application/json",u=JSON.stringify(u)),C.withCredentials=!!Q.withCredentials,y)C.setRequestHeader(e,y[e]);C.send(u)}))}Q.r(d),Q.d(d,{del:()=>r,get:()=>L,patch:()=>F,post:()=>e,put:()=>C,send:()=>T});var L=T.bind(T,"GET"),e=T.bind(T,"POST"),F=T.bind(T,"PATCH"),r=T.bind(T,"DELETE"),C=T.bind(T,"PUT")},13315:(v,d,Q)=>{"use strict";Q.d(d,{d:()=>y});const n=.5*(Math.sqrt(3)-1),T=(3-Math.sqrt(3))/6,L=1/3,e=1/6,F=(Math.sqrt(5)-1)/4,r=(5-Math.sqrt(5))/20,C=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),u=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const y=class{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const d="function"==typeof v?v:function(v){let d=0,Q=0,n=0,T=1;const L=function(){let v=4022871197;return function(d){d=d.toString();for(let Q=0;Q<d.length;Q++){v+=d.charCodeAt(Q);let n=.02519603282416938*v;v=n>>>0,n-=v,n*=v,v=n>>>0,n-=v,v+=4294967296*n}return 2.3283064365386963e-10*(v>>>0)}}();d=L(" "),Q=L(" "),n=L(" "),d-=L(v),d<0&&(d+=1);Q-=L(v),Q<0&&(Q+=1);n-=L(v),n<0&&(n+=1);return function(){const v=2091639*d+2.3283064365386963e-10*T;return d=Q,Q=n,n=v-(T=0|v)}}(v);this.p=function(v){const d=new Uint8Array(256);for(let Q=0;Q<256;Q++)d[Q]=Q;for(let Q=0;Q<255;Q++){const n=Q+~~(v()*(256-Q)),T=d[Q];d[Q]=d[n],d[n]=T}return d}(d),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Q=0;Q<512;Q++)this.perm[Q]=this.p[255&Q],this.permMod12[Q]=this.perm[Q]%12}noise2D(v,d){const Q=this.permMod12,L=this.perm;let e=0,F=0,r=0;const u=(v+d)*n,y=Math.floor(v+u),z=Math.floor(d+u),B=(y+z)*T,X=v-(y-B),m=d-(z-B);let V,h;X>m?(V=1,h=0):(V=0,h=1);const S=X-V+T,A=m-h+T,f=X-1+2*T,P=m-1+2*T,O=255&y,J=255&z;let K=.5-X*X-m*m;if(K>=0){const v=3*Q[O+L[J]];K*=K,e=K*K*(C[v]*X+C[v+1]*m)}let o=.5-S*S-A*A;if(o>=0){const v=3*Q[O+V+L[J+h]];o*=o,F=o*o*(C[v]*S+C[v+1]*A)}let g=.5-f*f-P*P;if(g>=0){const v=3*Q[O+1+L[J+1]];g*=g,r=g*g*(C[v]*f+C[v+1]*P)}return 70*(e+F+r)}noise3D(v,d,Q){const n=this.permMod12,T=this.perm;let F,r,u,y;const z=(v+d+Q)*L,B=Math.floor(v+z),X=Math.floor(d+z),m=Math.floor(Q+z),V=(B+X+m)*e,h=v-(B-V),S=d-(X-V),A=Q-(m-V);let f,P,O,J,K,o;h>=S?S>=A?(f=1,P=0,O=0,J=1,K=1,o=0):h>=A?(f=1,P=0,O=0,J=1,K=0,o=1):(f=0,P=0,O=1,J=1,K=0,o=1):S<A?(f=0,P=0,O=1,J=0,K=1,o=1):h<A?(f=0,P=1,O=0,J=0,K=1,o=1):(f=0,P=1,O=0,J=1,K=1,o=0);const g=h-f+e,R=S-P+e,M=A-O+e,Y=h-J+2*e,D=S-K+2*e,i=A-o+2*e,Z=h-1+.5,j=S-1+.5,x=A-1+.5,k=255&B,t=255&X,p=255&m;let W=.6-h*h-S*S-A*A;if(W<0)F=0;else{const v=3*n[k+T[t+T[p]]];W*=W,F=W*W*(C[v]*h+C[v+1]*S+C[v+2]*A)}let q=.6-g*g-R*R-M*M;if(q<0)r=0;else{const v=3*n[k+f+T[t+P+T[p+O]]];q*=q,r=q*q*(C[v]*g+C[v+1]*R+C[v+2]*M)}let b=.6-Y*Y-D*D-i*i;if(b<0)u=0;else{const v=3*n[k+J+T[t+K+T[p+o]]];b*=b,u=b*b*(C[v]*Y+C[v+1]*D+C[v+2]*i)}let H=.6-Z*Z-j*j-x*x;if(H<0)y=0;else{const v=3*n[k+1+T[t+1+T[p+1]]];H*=H,y=H*H*(C[v]*Z+C[v+1]*j+C[v+2]*x)}return 32*(F+r+u+y)}noise4D(v,d,Q,n){const T=this.perm;let L,e,C,y,z;const B=(v+d+Q+n)*F,X=Math.floor(v+B),m=Math.floor(d+B),V=Math.floor(Q+B),h=Math.floor(n+B),S=(X+m+V+h)*r,A=v-(X-S),f=d-(m-S),P=Q-(V-S),O=n-(h-S);let J=0,K=0,o=0,g=0;A>f?J++:K++,A>P?J++:o++,A>O?J++:g++,f>P?K++:o++,f>O?K++:g++,P>O?o++:g++;const R=J>=3?1:0,M=K>=3?1:0,Y=o>=3?1:0,D=g>=3?1:0,i=J>=2?1:0,Z=K>=2?1:0,j=o>=2?1:0,x=g>=2?1:0,k=J>=1?1:0,t=K>=1?1:0,p=o>=1?1:0,W=g>=1?1:0,q=A-R+r,b=f-M+r,H=P-Y+r,s=O-D+r,a=A-i+2*r,I=f-Z+2*r,U=P-j+2*r,c=O-x+2*r,w=A-k+3*r,G=f-t+3*r,E=P-p+3*r,N=O-W+3*r,l=A-1+4*r,vv=f-1+4*r,dv=P-1+4*r,Qv=O-1+4*r,nv=255&X,Tv=255&m,Lv=255&V,ev=255&h;let Fv=.6-A*A-f*f-P*P-O*O;if(Fv<0)L=0;else{const v=T[nv+T[Tv+T[Lv+T[ev]]]]%32*4;Fv*=Fv,L=Fv*Fv*(u[v]*A+u[v+1]*f+u[v+2]*P+u[v+3]*O)}let rv=.6-q*q-b*b-H*H-s*s;if(rv<0)e=0;else{const v=T[nv+R+T[Tv+M+T[Lv+Y+T[ev+D]]]]%32*4;rv*=rv,e=rv*rv*(u[v]*q+u[v+1]*b+u[v+2]*H+u[v+3]*s)}let Cv=.6-a*a-I*I-U*U-c*c;if(Cv<0)C=0;else{const v=T[nv+i+T[Tv+Z+T[Lv+j+T[ev+x]]]]%32*4;Cv*=Cv,C=Cv*Cv*(u[v]*a+u[v+1]*I+u[v+2]*U+u[v+3]*c)}let uv=.6-w*w-G*G-E*E-N*N;if(uv<0)y=0;else{const v=T[nv+k+T[Tv+t+T[Lv+p+T[ev+W]]]]%32*4;uv*=uv,y=uv*uv*(u[v]*w+u[v+1]*G+u[v+2]*E+u[v+3]*N)}let yv=.6-l*l-vv*vv-dv*dv-Qv*Qv;if(yv<0)z=0;else{const v=T[nv+1+T[Tv+1+T[Lv+1+T[ev+1]]]]%32*4;yv*=yv,z=yv*yv*(u[v]*l+u[v+1]*vv+u[v+2]*dv+u[v+3]*Qv)}return 27*(L+e+C+y+z)}}}}]);