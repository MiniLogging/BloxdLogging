"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{10267:(N,Z,d)=>{d.r(Z),d.d(Z,{Dispose:()=>D,DumpData:()=>B,DumpDataAsync:()=>j,DumpFramebuffer:()=>e,DumpTools:()=>v});var X=d(1432),I=d(1133),m=d(994),z=d(986);let w,S=null;async function e(N,Z,d,X){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",m=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0;const w=await d.readPixels(0,0,N,Z);B(N,Z,new Uint8Array(w.buffer),X,I,m,!0,void 0,z)}function j(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",I=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0;return new Promise((S=>{B(N,Z,d,(N=>S(N)),X,I,m,z,w)}))}function B(N,Z,e,j){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;(async function(){return S||(S=new Promise(((N,Z)=>{let I,m=null;const S={Ne:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(d.bind(d,1324)).then((e=>{let{ThinEngine:j}=e;try{I=new OffscreenCanvas(100,100),m=new j(I,!1,S)}catch(v){I=document.createElement("canvas"),m=new j(I,!1,S)}z.e.Instances.pop(),z.e.OnEnginesDisposedObservable.add((N=>{m&&N!==m&&!m.u&&0===z.e.Instances.length&&D()})),m.getCaps().parallelShaderCompile=void 0;const B=new X.e(m);d.e(32).then(d.bind(d,10947)).then((d=>{let{passPixelShader:z}=d;if(!m)return void Z("Engine is not defined");const S=new X.i({kb:m,name:z.name,fragmentShader:z.shader,samplerNames:["textureSampler"]});w={canvas:I,kb:m,renderer:B,wrapper:S},N(w)}))})).catch(Z)}))),await S})().then((d=>{if(d.kb.setSize(N,Z,!0),e instanceof Float32Array){const N=new Uint8Array(e.length);let Z=e.length;for(;Z--;){const d=e[Z];N[Z]=Math.round(255*(0,m.e)(d))}e=N}const X=d.kb.createRawTexture(e,N,Z,5,!1,!T,1);d.renderer.setViewport(),d.renderer.applyEffectWrapper(d.wrapper),d.wrapper.effect._bindTexture("textureSampler",X),d.renderer.draw(),k?I.g.ToBlob(d.canvas,(N=>{const Z=new FileReader;Z.onload=N=>{const Z=N.target.result;j&&j(Z)},Z.readAsArrayBuffer(N)}),B,h):I.g.EncodeScreenshotCanvasData(d.canvas,j,B,v,h),X.dispose()}))}function D(){var N;w?(w.wrapper.dispose(),w.renderer.dispose(),w.kb.dispose()):null===(N=S)||void 0===N||N.then((N=>{N.wrapper.dispose(),N.renderer.dispose(),N.kb.dispose()}));S=null,w=null}const v={DumpData:B,DumpDataAsync:j,DumpFramebuffer:e,Dispose:D};I.g.DumpData=B,I.g.DumpDataAsync=j,I.g.DumpFramebuffer=e}}]);