/*! For license information please see qfl834.7.d9868de1.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{13086:U=>{"use strict";U.exports=function(U,M,b,a,A,H){var W=+M[0],y=+M[1],O=+M[2],e=+b[0],x=+b[1],P=+b[2],Z=Math.sqrt(e*e+x*x+P*P);if(0===Z)throw new Error("Can't raycast along a zero vector");return function(U,M,b,a,A,H,W,y,O,e){for(var x=0,P=Math.floor,Z=0|P(M),C=0|P(b),r=0|P(a),B=A>0?1:-1,J=H>0?1:-1,F=W>0?1:-1,f=Math.abs(1/A),L=Math.abs(1/H),z=Math.abs(1/W),o=f<1/0?f*(B>0?Z+1-M:M-Z):1/0,S=L<1/0?L*(J>0?C+1-b:b-C):1/0,h=z<1/0?z*(F>0?r+1-a:a-r):1/0,i=-1;x<=y;){var Y=U(Z,C,r);if(Y)return O&&(O[0]=M+x*A,O[1]=b+x*H,O[2]=a+x*W),e&&(e[0]=e[1]=e[2]=0,0===i&&(e[0]=-B),1===i&&(e[1]=-J),2===i&&(e[2]=-F)),Y;o<S?o<h?(Z+=B,x=o,o+=f,i=0):(r+=F,x=h,h+=z,i=2):S<h?(C+=J,x=S,S+=L,i=1):(r+=F,x=h,h+=z,i=2)}return O&&(O[0]=M+x*A,O[1]=b+x*H,O[2]=a+x*W),e&&(e[0]=e[1]=e[2]=0),0}(U,W,y,O,e/=Z,x/=Z,P/=Z,a="undefined"===typeof a?64:+a,A,H)}},13116:(U,M,b)=>{"use strict";b.d(M,{c:()=>H});var a=b(94);function A(){this.$l=!1,this.stopPropagation=!1,this._l=!1,this.disabled=!1}class H{constructor(U,M){this.version="0.7.0";var b=Object.assign({},new A,M||{});this.element=U||document,this.$l=!!b.$l,this.stopPropagation=!!b.stopPropagation,this._l=!!b._l,this.disabled=!!b.disabled,this.filterEvents=(U,M)=>!0,this.down=new a.EventEmitter,this.up=new a.EventEmitter,this.state={},this.uh={dx:0,dy:0,Hm:0,ng:0,Im:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?y(this):document.addEventListener("DOMContentLoaded",(U=>{y(this)}),{once:!0})}bind(U){for(var M=arguments.length,b=new Array(M>1?M-1:0),a=1;a<M;a++)b[a-1]=arguments[a];b.forEach((M=>{var b=this._keyBindmap[M]||[];b.includes(U)||(b.push(U),this._keyBindmap[M]=b)})),this.state[U]=!!this.state[U],this.pressCount[U]=this.pressCount[U]||0,this.releaseCount[U]=this.releaseCount[U]||0}unbind(U){for(var M in this._keyBindmap){var b=this._keyBindmap[M],a=b.indexOf(U);a>-1&&b.splice(a,1)}}getBindings(){var U={};for(var M in this._keyBindmap){this._keyBindmap[M].forEach((b=>{U[b]=U[b]||[],U[b].push(M)}))}return U}Re(){W(this.uh),W(this.pressCount),W(this.releaseCount)}}function W(U){for(var M in U)U[M]=0}function y(U){window.addEventListener("keydown",r.bind(null,U,!0),!1),window.addEventListener("keyup",r.bind(null,U,!1),!1);var M={passive:!0};U.element.addEventListener("touchstart",P.bind(void 0,U),{passive:!1}),U.element.addEventListener("touchend",C.bind(void 0,U),M),U.element.addEventListener("mousedown",B.bind(null,U,!0),M),window.document.addEventListener("mouseup",B.bind(null,U,!1),M),U.element.addEventListener("touchmove",J.bind(null,U),M),U.element.addEventListener("mousemove",J.bind(null,U),M),window.PointerEvent,U.element.addEventListener("wheel",F.bind(null,U),M),U.element.addEventListener("contextmenu",f.bind(null,U),!1),window.addEventListener("blur",L.bind(null,U),!1)}var O=0,e=0,x=null;function P(U,M){M.preventDefault(),Z(M)}function Z(U){let M=!1;for(let b=0;b<U.touches.length;++b)if(U.touches[b].identifier===x){M=!0;break}if(!M){const M=U.changedTouches[0];O=M.clientX,e=M.clientY,x=M.identifier}}function C(U,M){for(var b=M.changedTouches,a=0;a<b.length;++a)b[a].identifier===x&&(x=null)}function r(U,M,b){z(b.code,M,U,b)}function B(U,M,b){if("pointerId"in b)if(M){if(null!==U._touches.currID)return;U._touches.currID=b.pointerId}else{if(U._touches.currID!==b.pointerId)return;U._touches.currID=null}return z("Mouse"+("button"in b?b.button+1:1),M,U,b),!1}function J(U,M){var b=M.movementX||M.mozMovementX||0,a=M.movementY||M.mozMovementY||0;if(M.touches&&0===(b|a)){var A=function(U){Z(U);for(let M=0;M<U.changedTouches.length;++M)if(U.changedTouches[M].identifier==x){const b=U.changedTouches[M],a=[b.clientX-O,b.clientY-e];return O=b.clientX,e=b.clientY,a}return console.error(`Did not find touch id ${x}`),[0,0]}(M);b=A[0],a=A[1]}U.uh.dx+=b,U.uh.dy+=a}function F(U,M){var b=1;switch(M.deltaMode){case 0:b=1;break;case 1:b=12;break;case 2:b=U.element.clientHeight||window.innerHeight}U.uh.Hm+=(M.deltaX||0)*b,U.uh.ng+=(M.deltaY||0)*b,U.uh.Im+=(M.deltaZ||0)*b}function f(U,M){if(!U._l)return M.preventDefault(),!1}function L(U){for(var M in U._keyStates)U._keyStates[M]&&(/^Mouse\d/.test(M)||z(M,!1,U,{code:M,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function z(U,M,b,a){var A=b._keyBindmap[U];A&&(o(b._keyStates[U],M)&&(b._keyStates[U]=M,A.forEach((U=>{(!b.filterEvents||b.filterEvents(a,U))&&function(U,M,b,a){var A=M?b.pressCount:b.releaseCount;A[U]=(A[U]||0)+1;var H=b._bindPressCount[U]||0;(H+=M?1:-1)<0&&(H=0);b._bindPressCount[U]=H;var W=b.state[U];if(o(W,H)){b.state[U]=H>0;var y=M?b.down:b.up;b.disabled||y.emit(U,a)}}(U,M,b,a)}))),"button"in a||(b.$l&&!a.defaultPrevented&&a.preventDefault(),b.stopPropagation&&a.stopPropagation()))}function o(U,M){return U?!M:M}},13088:(U,M,b)=>{"use strict";b.d(M,{b:()=>a});class a{constructor(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.el=!1,this.fl=!1,this.Vf=30,this.dl=0,this.ml=!1,this.fullscreen=!1,this.hl=function(U){},this.il=function(){},this.kl=function(){},this.k=function(){},this.jl=function(U){},this.onFullscreenChanged=function(U){},e((()=>{!function(U,M){U._nowObject=performance||Date,U._lastTick=0,U._renderAccum=0,U._rt=0,U._frameCB=y.bind(null,U),requestAnimationFrame(U._frameCB),M>0&&(U._intervalCB=W.bind(null,U),U._interval=setInterval(U._intervalCB,Math.max(M,1e3/U.Vf/2)))}(this,M),function(U,M){if(!M)return;var b=!1,a=!1;document.addEventListener("pointerlockchange",(a=>{b=document.pointerLockElement===M,U.jl(b)})),document.addEventListener("fullscreenchange",(b=>{a=document.fullscreenElement===M,U.onFullscreenChanged(a)})),Object.defineProperty(U,"ml",{get:()=>b,set:U=>{U&&!b?O(M):b&&!U&&function(U){U.exitPointerLock&&U.exitPointerLock()}(document)}}),Object.defineProperty(U,"fullscreen",{get:()=>a,set:U=>{U&&!a?M.requestFullscreen():a&&!U&&document.exitFullscreen()}}),M.addEventListener("click",(A=>{U.el&&!b&&O(M),U.fl&&!a&&M.requestFullscreen()}));var A=()=>U.k();if(window.ResizeObserver){new ResizeObserver(A).observe(M)}else window.addEventListener("resize",A)}(this,U),this.kl()}))}}var A=3,H=20;function W(U){for(var M=1e3/U.Vf,b=U._nowObject.now()+H,a=0;U._nowObject.now()>=U._lastTick+M&&U._nowObject.now()<b&&++a<=A;)U.hl(M),U._lastTick+=M;var W=5*(M+5),y=U._nowObject.now();if(y-U._lastTick>W)for(;y>=U._lastTick+M;)U._lastTick+=M}function y(U){requestAnimationFrame(U._frameCB),W(U);var M=U._nowObject.now(),b=M-U._rt;if(U._rt=M,U.dl>0){U._renderAccum+=b;var a=1e3/U.dl;if(U._renderAccum<a)return;U._renderAccum=Math.min(U._renderAccum-a,a)}var A=1e3/U.Vf,H=(M-U._lastTick)/A;U.il(b,H,A)}function O(U){U.requestPointerLock&&U.requestPointerLock()}var e=U=>{if("loading"===document.readyState){var M=()=>{document.removeEventListener("readystatechange",M),U()};document.addEventListener("readystatechange",M)}else setTimeout(U,1)}},13123:(U,M,b)=>{"use strict";b.d(M,{c:()=>P});var a=b(871),A=b(136);class H{constructor(U,M,b,H,W,y,O){this.ag=new a(U.base,U.Ae),this.mass=M,this.friction=b,this.restitution=H,this.ne=W,this.pf=y,this.oe=!!O,this.nh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ki=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.bg=A.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=A.create(),this._impulses=A.create(),this._sleepFrameCount=10}loadFromCopy(U){A.i(this.ag.base,U.ag.base),A.i(this.ag.Ae,U.ag.Ae),A.i(this.ag.max,U.ag.max),this.ag.mag=U.ag.mag,this.mass=U.mass,this.friction=U.friction,this.restitution=U.restitution,this.ne=U.ne,this.pf=U.pf,this.oe=U.oe,this.nh=U.nh,this.fluidDrag=U.fluidDrag,this.ki=U.ki,this.preventFallOffEdge=U.preventFallOffEdge,this.rolledBackLastTick=U.rolledBackLastTick,A.i(this.bg,U.bg),A.i(this.resting,U.resting),this.inFluid=U.inFluid,this._ratioInFluid=U._ratioInFluid,A.i(this._forces,U._forces),A.i(this._impulses,U._impulses),this._sleepFrameCount=U._sleepFrameCount}setPosition(U){W(U),A.je(U,U,this.ag.base),this.ag.translate(U),this.gi()}Zg(){return A.clone(this.ag.base)}applyForce(U){W(U),A.add(this._forces,this._forces,U),this.gi()}applyImpulse(U){W(U),A.add(this._impulses,this._impulses,U),this.gi()}gi(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var W=U=>{};var y=b(871),O=b(136),e=b(875);function x(){this.nh=.1,this.fluidDrag=.4,this.xe=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function P(U,M,b){U=Object.assign(new x,U),this.gravity=U.gravity||[0,-10,0],this.nh=U.nh||.1,this.xe=U.xe||2,this.fluidDrag=U.fluidDrag||.4,this.minBounceImpulse=U.minBounceImpulse,this.bodies=[],this.zm=U.zm,this.testSolid=M,this.testFluid=b}P.prototype.Qf=function(U,M,b,a,A,W){U=U||new y([0,0,0],[1,1,1]),"undefined"==typeof M&&(M=1),"undefined"==typeof b&&(b=1),"undefined"==typeof a&&(a=0),"undefined"==typeof A&&(A=1);var O=new H(U,M,b,a,A,W);return this.bodies.push(O),O},P.prototype.Sf=function(U){var M=this.bodies.indexOf(U);M<0||(this.bodies.splice(M,1),U.ag=U.pf=null)};var Z=O.create(),C=O.create(),r=O.create(),B=O.create(),J=O.create(),F=O.create(),f=O.create(),L=new y([0,0,0],[1,1,1]),z=new H(L,1,1,0,1,(()=>{}),!1);function o(U,M,b){return M=b,M*=1-(1-U.ratioInFluid)**2}P.prototype.Re=function(U){U/=1e3;var M=V(0,O.squaredLength(this.gravity));this.bodies.forEach((b=>function(U,M,b,a){O.i(J,M.resting),U.zm&&z.loadFromCopy(M);if(M.mass<=0)return O.set(M.bg,0,0,0),O.set(M._forces,0,0,0),void O.set(M._impulses,0,0,0);var A=a||0===M.ne;if(function(U,M,b,a){if(M._sleepFrameCount>0)return!1;if(a)return!0;var A=!1,H=.5*b*b*M.ne;return O.scale(t,U.gravity,H),e(U.testSolid,M.ag,t,(function(){return A=!0,!0}),!0),A}(U,M,b,A))return;M._sleepFrameCount--,function(U,M){var b=M.ag,a=Math.floor(b.base[0]),A=Math.floor(b.base[2]),H=Math.floor(b.base[1]),W=Math.floor(b.max[1]);if(!U.testFluid(a,H,A))return M.inFluid=!1,void(M.ratioInFluid=0);var y=1,e=H+1;for(;e<=W&&U.testFluid(a,e,A);)y++,e++;var x=(H+y-b.base[1])/b.Ae[1];x>1&&(x=1);var P=b.Ae[0]*b.Ae[1]*b.Ae[2]*x,Z=h;O.scale(Z,U.gravity,-U.xe*P*M.ne),M.applyForce(Z),M.inFluid=!0,M.ratioInFluid=x}(U,M),N(M._forces),N(M._impulses),N(M.bg),N(M.resting),O.scale(Z,M._forces,1/M.mass),O.Te(Z,Z,U.gravity,M.ne),O.scale(C,M._impulses,1/M.mass),O.Te(C,C,Z,b),O.add(M.bg,M.bg,C),M.friction&&(i(U,0,M,C,b),i(U,1,M,C,b),i(U,2,M,C,b));var H=M.fluidDrag>=0?M.fluidDrag:U.fluidDrag,W=M.nh>=0?M.nh:U.nh,y=W,x=W;M.inFluid&&(y=o(M,y,M.fluidDragHoriz>=0?M.fluidDragHoriz:H),x=o(M,x,M.fluidDragVert>=0?M.fluidDragVert:H));y=Math.max(1-y*b/M.mass,0),x=Math.max(1-x*b/M.mass,0),O.set(S,y,x,y),O.multiply(M.bg,M.bg,S),O.scale(r,M.bg,b),O.set(M._forces,0,0,0),O.set(M._impulses,0,0,0),M.oe&&k(s,M.ag);O.i(F,r),O.set(f,0,0,0),M.preventFallOffEdge&&function(U,M,b,a){if(!M.resting[1]||b[1]>0)return;var A=Q;k(A,M.ag);for(var H=0;H<3;H+=2){O.set(X,0,0,0),X[H]=b[H];var W=!0;(W=(W=(W=(W=W&&!v(U,A.base[0]+X[0]+1e-5,A.base[1],A.base[2]+X[2]+1e-5))&&!v(U,A.max[0]+X[0]-1e-5,A.base[1],A.base[2]+X[2]+1e-5))&&!v(U,A.base[0]+X[0]+1e-5,A.base[1],A.max[2]+X[2]-1e-5))&&!v(U,A.max[0]+X[0]-1e-5,A.base[1],A.max[2]+X[2]-1e-5))?(a[H]=b[H]>0?1:-1,b[H]=0):0===H&&(O.set(I,b[0],0,0),d(U,A,I,a,M.slideOnCollision))}}(U,M,r,f);d(U,M.ag,r,M.resting,M.slideOnCollision),M.oe&&function(U,M,b,a){if(M.resting[1]>=0&&!M.inFluid)return;var A=0!==M.resting[0],H=0!==M.resting[2];if(!A&&!H)return;var W=Math.abs(a[0]/a[2]),y=4;if(!A&&W>y)return;if(!H&&W<1/y)return;O.add(m,b.base,a);var x=U.testSolid;e(x,b,a,(function(U,M,b,a){if(1!==M)return!0;a[M]=0}));var P=b.base[1],Z=M.inFluid?1.951:1.001,C=Math.floor(P+Z)-P;O.set(n,0,C,0);var r=!1;if(e(x,b,n,(function(U,M,b,a){return r=!0,!0})),r)return;O.je(E,m,b.base),E[1]=0,d(U,b,E,q,!0);var B=V(b.base[0],m[0]),J=V(b.base[2],m[2]);if(A&&!B&&(!J||!H))return;if(H&&(!B||!A)&&!J)return;var F=!0;if(F=F&&!v(U,b.base[0]+1e-5,b.base[1],b.base[2]+1e-5),F=F&&!v(U,b.max[0]-1e-5,b.base[1],b.base[2]+1e-5),F=F&&!v(U,b.base[0]+1e-5,b.base[1],b.max[2]-1e-5),F=F&&!v(U,b.max[0]-1e-5,b.base[1],b.max[2]-1e-5),F)return;k(M.ag,b),M.resting[0]=q[0],M.resting[2]=q[2],M.ki&&M.ki()}(U,M,s,F);for(var P=0;P<3;++P)M.resting[P]=M.resting[P]||f[P],B[P]=0,M.resting[P]&&(J[P]||(B[P]=-M.bg[P]),M.bg[P]=0);var L=O.length(B);L>.001&&(O.scale(B,B,M.mass),M.pf&&M.pf(B),M.restitution>0&&L>U.minBounceImpulse&&(O.scale(B,B,M.restitution),M.applyImpulse(B)));var Y=O.squaredLength(M.bg);Y>1e-5&&M.gi();U.zm&&U.zm(M)?(M.loadFromCopy(z),M.rolledBackLastTick=!0):M.rolledBackLastTick=!1}(this,b,U,M)))};var S=O.create([0,0,0]);var h=O.create();function i(U,M,b,a,A){var H=b.resting[M],W=a[M];if(!b.alwaysApplyHorizFriction||1!==M){if(0===H)return;if(H*W<=0)return}O.i(Y,b.bg),Y[M]=0;var y=O.length(Y);if(!V(y,0)){var e=Math.abs(b.friction*U.gravity[M]*A),x=y>e?(y-e)/y:0;b.bg[(M+1)%3]*=x,b.bg[(M+2)%3]*=x}}var Y=O.create();function d(U,M,b,a,A){return O.set(a,0,0,0),e(U.testSolid,M,b,(function(U,M,b,H){a[M]=b,H[M]=0,A||(H[0]=0,H[1]=0,H[2]=0)}))}var s=new y([],[]),q=O.create(),m=O.create(),n=O.create(),E=O.create();var X=O.create(),Q=new y([],[]),I=O.create();function v(U,M,b,a){return U.testSolid(Math.floor(M),Math.floor(b-1),Math.floor(a))}var t=O.create();function V(U,M){return Math.abs(U-M)<1e-5}function k(U,M){for(var b=0;b<3;b++)U.base[b]=M.base[b],U.max[b]=M.max[b],U.Ae[b]=M.Ae[b]}var N=function(U){}},11944:function(U,M){!function(U){"use strict";var M=function(U,b){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,M){U.__proto__=M}||function(U,M){for(var b in M)Object.prototype.hasOwnProperty.call(M,b)&&(U[b]=M[b])},M(U,b)};function b(U,b){if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function a(){this.constructor=U}M(U,b),U.prototype=null===b?Object.create(b):(a.prototype=b.prototype,new a)}function a(U,M,b,a){var A,H=arguments.length,W=H<3?M:null===a?a=Object.getOwnPropertyDescriptor(M,b):a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)W=Reflect.decorate(U,M,b,a);else for(var y=U.length-1;y>=0;y--)(A=U[y])&&(W=(H<3?A(W):H>3?A(M,b,W):A(M,b))||W);return H>3&&W&&Object.defineProperty(M,b,W),W}function A(U,M,b){if(b||2===arguments.length)for(var a,A=0,H=M.length;A<H;A++)!a&&A in M||(a||(a=Array.prototype.slice.call(M,0,A)),a[A]=M[A]);return U.concat(a||Array.prototype.slice.call(M))}var H,W=255,y=213;U.OPERATION=void 0,(H=U.OPERATION||(U.OPERATION={}))[H.ADD=128]="ADD",H[H.REPLACE=0]="REPLACE",H[H.DELETE=64]="DELETE",H[H.DELETE_AND_ADD=192]="DELETE_AND_ADD",H[H.TOUCH=1]="TOUCH",H[H.CLEAR=10]="CLEAR";var O=function(){function M(U,M,b){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=U,this.setParent(M,b)}return M.prototype.setParent=function(U,M,b){var a=this;if(this.indexes||(this.indexes=this.ref instanceof EU?this.ref._definition.indexes:{}),this.parent=U,this.parentIndex=b,M)if(this.root=M,this.ref instanceof EU){var A=this.ref._definition;for(var H in A.schema){var W=this.ref[H];if(W&&W.$changes){var y=A.indexes[H];W.$changes.setParent(this.ref,M,y)}}}else"object"===typeof this.ref&&this.ref.forEach((function(U,M){if(U instanceof EU){var b=U.$changes,A=a.ref.$changes.indexes[M];b.setParent(a.ref,a.root,A)}}))},M.prototype.operation=function(U){this.changes.set(--this.currentCustomOperation,U)},M.prototype.change=function(M,b){void 0===b&&(b=U.OPERATION.ADD);var a="number"===typeof M?M:this.indexes[M];this.assertValidIndex(a,M);var A=this.changes.get(a);A&&A.op!==U.OPERATION.DELETE&&A.op!==U.OPERATION.TOUCH||this.changes.set(a,{op:A&&A.op===U.OPERATION.DELETE?U.OPERATION.DELETE_AND_ADD:b,index:a}),this.allChanges.add(a),this.changed=!0,this.touchParents()},M.prototype.touch=function(M){var b="number"===typeof M?M:this.indexes[M];this.assertValidIndex(b,M),this.changes.has(b)||this.changes.set(b,{op:U.OPERATION.TOUCH,index:b}),this.allChanges.add(b),this.touchParents()},M.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},M.prototype.getType=function(U){if(this.ref._definition)return(M=this.ref._definition).schema[M.fieldsByIndex[U]];var M,b=(M=this.parent._definition).schema[M.fieldsByIndex[this.parentIndex]];return Object.values(b)[0]},M.prototype.getChildrenFilter=function(){var U=this.parent._definition.childFilters;return U&&U[this.parentIndex]},M.prototype.getValue=function(U){return this.ref.getByIndex(U)},M.prototype.delete=function(M){var b="number"===typeof M?M:this.indexes[M];if(void 0!==b){var a=this.getValue(b);this.changes.set(b,{op:U.OPERATION.DELETE,index:b}),this.allChanges.delete(b),delete this.caches[b],a&&a.$changes&&(a.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(M," (").concat(b,")"))},M.prototype.discard=function(M,b){var a=this;void 0===M&&(M=!1),void 0===b&&(b=!1),this.ref instanceof EU||this.changes.forEach((function(M){if(M.op===U.OPERATION.DELETE){var b=a.ref.getIndex(M.index);delete a.indexes[b]}})),this.changes.clear(),this.changed=M,b&&this.allChanges.clear(),this.currentCustomOperation=0},M.prototype.discardAll=function(){var U=this;this.changes.forEach((function(M){var b=U.getValue(M.index);b&&b.$changes&&b.$changes.discardAll()})),this.discard()},M.prototype.cache=function(U,M){this.caches[U]=M},M.prototype.clone=function(){return new M(this.ref,this.parent,this.root)},M.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},M.prototype.assertValidIndex=function(U,M){if(void 0===U)throw new Error('ChangeTree: missing index for field "'.concat(M,'"'))},M}();function e(U,M,b,a){return U[M]||(U[M]=[]),U[M].push(b),null===a||void 0===a||a.forEach((function(U,M){return b(U,M)})),function(){return P(U[M],U[M].indexOf(b))}}function x(M){var b=this,a="string"!==typeof this.$changes.getType();this.$items.forEach((function(A,H){M.push({refId:b.$changes.refId,op:U.OPERATION.DELETE,field:H,value:void 0,previousValue:A}),a&&b.$changes.root.removeRef(A.$changes.refId)}))}function P(U,M){if(-1===M||M>=U.length)return!1;for(var b=U.length-1,a=M;a<b;a++)U[a]=U[a+1];return U.length=b,!0}var Z=function(U,M){var b=U.toString(),a=M.toString();return b<a?-1:b>a?1:0};function C(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,M){return"symbol"===typeof M||isNaN(M)?U[M]:U.at(M)},set:function(U,M,b){if("symbol"===typeof M||isNaN(M))U[M]=b;else{var a=Array.from(U.$items.keys()),A=parseInt(a[M]||M);void 0===b||null===b?U.deleteAt(A):U.setAt(A,b)}return!0},deleteProperty:function(U,M){return"number"===typeof M?U.deleteAt(M):delete U[M],!0}})}var r=function(){function M(){for(var U=[],M=0;M<arguments.length;M++)U[M]=arguments[M];this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,U)}return M.prototype.Bc=function(M,b){return void 0===b&&(b=!0),e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,M,b?this.$items:void 0)},M.prototype.Mc=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,M)},M.is=function(U){return Array.isArray(U)||void 0!==U.array},Object.defineProperty(M.prototype,"length",{get:function(){return this.$items.size},set:function(U){0===U?this.clear():this.splice(U,this.length-U)},enumerable:!1,configurable:!0}),M.prototype.push=function(){for(var U,M=this,b=[],a=0;a<arguments.length;a++)b[a]=arguments[a];return b.forEach((function(b){U=M.$refId++,M.setAt(U,b)})),U},M.prototype.pop=function(){var U=Array.from(this.$indexes.values()).pop();if(void 0!==U){this.$changes.delete(U),this.$indexes.delete(U);var M=this.$items.get(U);return this.$items.delete(U),M}},M.prototype.at=function(U){var M=Array.from(this.$items.keys())[U];return this.$items.get(M)},M.prototype.setAt=function(M,b){var a,A;if(void 0!==b&&null!==b){if(this.$items.get(M)!==b){void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,M);var H=null!==(A=null===(a=this.$changes.indexes[M])||void 0===a?void 0:a.op)&&void 0!==A?A:U.OPERATION.ADD;this.$changes.indexes[M]=M,this.$indexes.set(M,M),this.$items.set(M,b),this.$changes.change(M,H)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},M.prototype.deleteAt=function(U){var M=Array.from(this.$items.keys())[U];return void 0!==M&&this.$deleteAt(M)},M.prototype.$deleteAt=function(U){return this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U)},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&x.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.concat=function(){for(var U,b=[],a=0;a<arguments.length;a++)b[a]=arguments[a];return new(M.bind.apply(M,A([void 0],(U=Array.from(this.$items.values())).concat.apply(U,b),!1)))},M.prototype.join=function(U){return Array.from(this.$items.values()).join(U)},M.prototype.reverse=function(){var U=this,M=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(b,a){U.setAt(M[a],b)})),this},M.prototype.shift=function(){var U=Array.from(this.$items.keys()).shift();if(void 0!==U){var M=this.$items.get(U);return this.$deleteAt(U),M}},M.prototype.slice=function(U,b){var a=new M;return a.push.apply(a,Array.from(this.$items.values()).slice(U,b)),a},M.prototype.sort=function(U){var M=this;void 0===U&&(U=Z);var b=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(U).forEach((function(U,a){M.setAt(b[a],U)})),this},M.prototype.splice=function(U,M){void 0===M&&(M=this.length-U);for(var b=Array.from(this.$items.keys()),a=[],A=U;A<U+M;A++)a.push(this.$items.get(b[A])),this.$deleteAt(b[A]);return a},M.prototype.unshift=function(){for(var U=this,M=[],b=0;b<arguments.length;b++)M[b]=arguments[b];var a=this.length,A=M.length,H=Array.from(this.$items.values());return M.forEach((function(M,b){U.setAt(b,M)})),H.forEach((function(M,b){U.setAt(A+b,M)})),a+A},M.prototype.indexOf=function(U,M){return Array.from(this.$items.values()).indexOf(U,M)},M.prototype.lastIndexOf=function(U,M){return void 0===M&&(M=this.length-1),Array.from(this.$items.values()).lastIndexOf(U,M)},M.prototype.every=function(U,M){return Array.from(this.$items.values()).every(U,M)},M.prototype.some=function(U,M){return Array.from(this.$items.values()).some(U,M)},M.prototype.forEach=function(U,M){Array.from(this.$items.values()).forEach(U,M)},M.prototype.map=function(U,M){return Array.from(this.$items.values()).map(U,M)},M.prototype.filter=function(U,M){return Array.from(this.$items.values()).filter(U,M)},M.prototype.reduce=function(U,M){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},M.prototype.reduceRight=function(U,M){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},M.prototype.find=function(U,M){return Array.from(this.$items.values()).find(U,M)},M.prototype.findIndex=function(U,M){return Array.from(this.$items.values()).findIndex(U,M)},M.prototype.fill=function(U,M,b){throw new Error("ArraySchema#fill() not implemented")},M.prototype.copyWithin=function(U,M,b){throw new Error("ArraySchema#copyWithin() not implemented")},M.prototype.toString=function(){return this.$items.toString()},M.prototype.toLocaleString=function(){return this.$items.toLocaleString()},M.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(M,Symbol.species,{get:function(){return M},enumerable:!1,configurable:!0}),M.prototype.entries=function(){return this.$items.entries()},M.prototype.keys=function(){return this.$items.keys()},M.prototype.values=function(){return this.$items.values()},M.prototype.includes=function(U,M){return Array.from(this.$items.values()).includes(U,M)},M.prototype.flatMap=function(U,M){throw new Error("ArraySchema#flatMap() is not supported.")},M.prototype.flat=function(U){throw new Error("ArraySchema#flat() is not supported.")},M.prototype.findLast=function(){var U=Array.from(this.$items.values());return U.findLast.apply(U,arguments)},M.prototype.findLastIndex=function(){var U=Array.from(this.$items.values());return U.findLastIndex.apply(U,arguments)},M.prototype.setIndex=function(U,M){this.$indexes.set(U,M)},M.prototype.getIndex=function(U){return this.$indexes.get(U)},M.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},M.prototype.deleteByIndex=function(U){var M=this.$indexes.get(U);this.$items.delete(M),this.$indexes.delete(U)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){return this.toArray().map((function(U){return"function"===typeof U.toJSON?U.toJSON():U}))},M.prototype.clone=function(U){return U?new(M.bind.apply(M,A([void 0],Array.from(this.$items.values()),!1))):new(M.bind.apply(M,A([void 0],this.map((function(U){return U.$changes?U.clone():U})),!1)))},M}();function B(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,M){return"symbol"!==typeof M&&"undefined"===typeof U[M]?U.get(M):U[M]},set:function(U,M,b){return"symbol"!==typeof M&&-1===M.indexOf("$")&&"Bc"!==M&&"Mc"!==M&&"onChange"!==M?U.set(M,b):U[M]=b,!0},deleteProperty:function(U,M){return U.delete(M),!0}})}var J=function(){function M(U){var b=this;if(this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U)if(U instanceof Map||U instanceof M)U.forEach((function(U,M){return b.set(M,U)}));else for(var a in U)this.set(a,U[a])}return M.prototype.Bc=function(M,b){return void 0===b&&(b=!0),e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,M,b?this.$items:void 0)},M.prototype.Mc=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,M)},M.is=function(U){return void 0!==U.map},M.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(M.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(M,Symbol.species,{get:function(){return M},enumerable:!1,configurable:!0}),M.prototype.set=function(M,b){if(void 0===b||null===b)throw new Error("MapSchema#set('".concat(M,"', ").concat(b,"): trying to set ").concat(b," value on '").concat(M,"'."));M=M.toString();var a="undefined"!==typeof this.$changes.indexes[M],A=a?this.$changes.indexes[M]:this.$refId++,H=a?U.OPERATION.REPLACE:U.OPERATION.ADD,W=void 0!==b.$changes;if(W&&b.$changes.setParent(this,this.$changes.root,A),a){if(!W&&this.$items.get(M)===b)return;W&&this.$items.get(M)!==b&&(H=U.OPERATION.ADD)}else this.$changes.indexes[M]=A,this.$indexes.set(A,M);return this.$items.set(M,b),this.$changes.change(M,H),this},M.prototype.get=function(U){return this.$items.get(U)},M.prototype.delete=function(U){return this.$changes.delete(U),this.$items.delete(U)},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&x.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(U){return this.$items.has(U)},M.prototype.forEach=function(U){this.$items.forEach(U)},M.prototype.entries=function(){return this.$items.entries()},M.prototype.keys=function(){return this.$items.keys()},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(U,M){this.$indexes.set(U,M)},M.prototype.getIndex=function(U){return this.$indexes.get(U)},M.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},M.prototype.deleteByIndex=function(U){var M=this.$indexes.get(U);this.$items.delete(M),this.$indexes.delete(U)},M.prototype.toJSON=function(){var U={};return this.forEach((function(M,b){U[b]="function"===typeof M.toJSON?M.toJSON():M})),U},M.prototype.clone=function(U){var b;return U?b=Object.assign(new M,this):(b=new M,this.forEach((function(U,M){U.$changes?b.set(M,U.clone()):b.set(M,U)}))),b},M}(),F={};function f(U,M){F[U]=M}function L(U){return F[U]}var z=function(){function U(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return U.create=function(M){var b=new U;return b.schema=Object.assign({},M&&M.schema||{}),b.indexes=Object.assign({},M&&M.indexes||{}),b.fieldsByIndex=Object.assign({},M&&M.fieldsByIndex||{}),b.descriptors=Object.assign({},M&&M.descriptors||{}),b.deprecated=Object.assign({},M&&M.deprecated||{}),b},U.prototype.addField=function(U,M){var b=this.getNextFieldIndex();this.fieldsByIndex[b]=U,this.indexes[U]=b,this.schema[U]=Array.isArray(M)?{array:M[0]}:M},U.prototype.hasField=function(U){return void 0!==this.indexes[U]},U.prototype.addFilter=function(U,M){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[U]]=M,this.indexesWithFilters.push(this.indexes[U]),!0},U.prototype.addChildrenFilter=function(U,M){var b=this.indexes[U],a=this.schema[U];if(L(Object.keys(a)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[b]=M,!0;console.warn("@filterChildren: field '".concat(U,"' can't have children. Ignoring filter."))},U.prototype.getChildrenFilter=function(U){return this.childFilters&&this.childFilters[this.indexes[U]]},U.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},U}();function o(U){return U._context&&U._context.useFilters}var S=function(){function U(){this.types={},this.schemas=new Map,this.useFilters=!1}return U.prototype.has=function(U){return this.schemas.has(U)},U.prototype.get=function(U){return this.types[U]},U.prototype.add=function(U,M){void 0===M&&(M=this.schemas.size),U._definition=z.create(U._definition),U._typeid=M,this.types[M]=U,this.schemas.set(U,M)},U.create=function(M){return void 0===M&&(M={}),function(b){return M.context||(M.context=new U),i(b,M)}},U}(),h=new S;function i(U,M){return void 0===M&&(M={}),function(b,a){var H=M.context||h,W=b.constructor;if(W._context=H,!U)throw new Error("".concat(W.name,': @type() reference provided for "').concat(a,"\" is undefined. Make sure you don't have any circular dependencies."));H.has(W)||H.add(W);var y=W._definition;if(y.addField(a,U),y.descriptors[a]){if(y.deprecated[a])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(a,"' definition on '").concat(W.name,"'.\nCheck @type() annotation"))}catch(F){var O=F.stack.split("\n")[4].trim();throw new Error("".concat(F.message," ").concat(O))}}var e=r.is(U),x=!e&&J.is(U);if("string"!==typeof U&&!EU.is(U)){var P=Object.values(U)[0];"string"===typeof P||H.has(P)||H.add(P)}if(M.manual)y.descriptors[a]={enumerable:!0,configurable:!0,writable:!0};else{var Z="_".concat(a);y.descriptors[Z]={enumerable:!1,configurable:!1,writable:!0},y.descriptors[a]={get:function(){return this[Z]},set:function(U){U!==this[Z]&&(void 0!==U&&null!==U?(!e||U instanceof r||(U=new(r.bind.apply(r,A([void 0],U,!1)))),!x||U instanceof J||(U=new J(U)),void 0===U.$proxy&&(x?U=B(U):e&&(U=C(U))),this.$changes.change(a),U.$changes&&U.$changes.setParent(this,this.$changes.root,this._definition.indexes[a])):this[Z]&&this.$changes.delete(a),this[Z]=U)},enumerable:!0,configurable:!0}}}}function Y(U){return function(M,b){var a=M.constructor;a._definition.addFilter(b,U)&&(a._context.useFilters=!0)}}function d(U){return function(M,b){var a=M.constructor;a._definition.addChildrenFilter(b,U)&&(a._context.useFilters=!0)}}function s(U){return void 0===U&&(U=!0),function(M,b){var a=M.constructor._definition;a.deprecated[b]=!0,U&&(a.descriptors[b]={get:function(){throw new Error("".concat(b," is deprecated."))},set:function(U){},enumerable:!1,configurable:!0})}}function q(U,M,b){for(var a in void 0===b&&(b={}),b.context||(b.context=U._context||b.context||h),M)i(M[a],b)(U.prototype,a);return U}function m(U){for(var M=0,b=0,a=0,A=U.length;a<A;a++)(M=U.charCodeAt(a))<128?b+=1:M<2048?b+=2:M<55296||M>=57344?b+=3:(a++,b+=4);return b}function n(U,M,b){for(var a=0,A=0,H=b.length;A<H;A++)(a=b.charCodeAt(A))<128?U[M++]=a:a<2048?(U[M++]=192|a>>6,U[M++]=128|63&a):a<55296||a>=57344?(U[M++]=224|a>>12,U[M++]=128|a>>6&63,U[M++]=128|63&a):(A++,a=65536+((1023&a)<<10|1023&b.charCodeAt(A)),U[M++]=240|a>>18,U[M++]=128|a>>12&63,U[M++]=128|a>>6&63,U[M++]=128|63&a)}function E(U,M){U.push(255&M)}function X(U,M){U.push(255&M)}function Q(U,M){U.push(255&M),U.push(M>>8&255)}function I(U,M){U.push(255&M),U.push(M>>8&255)}function v(U,M){U.push(255&M),U.push(M>>8&255),U.push(M>>16&255),U.push(M>>24&255)}function t(U,M){var b=M>>24,a=M>>16,A=M>>8,H=M;U.push(255&H),U.push(255&A),U.push(255&a),U.push(255&b)}function V(U,M){var b=Math.floor(M/Math.pow(2,32));t(U,M>>>0),t(U,b)}function k(U,M){var b=M/Math.pow(2,32)|0;t(U,M>>>0),t(U,b)}function N(U,M){K(U,M)}function R(U,M){w(U,M)}var j=new Int32Array(2),p=new Float32Array(j.buffer),g=new Float64Array(j.buffer);function K(U,M){p[0]=M,v(U,j[0])}function w(U,M){g[0]=M,v(U,j[0]),v(U,j[1])}function T(U,M){return X(U,M?1:0)}function G(U,M){M||(M="");var b=m(M),a=0;if(b<32)U.push(160|b),a=1;else if(b<256)U.push(217),X(U,b),a=2;else if(b<65536)U.push(218),I(U,b),a=3;else{if(!(b<4294967296))throw new Error("String too long");U.push(219),t(U,b),a=5}return n(U,U.length,M),a+b}function l(U,M){return isNaN(M)?l(U,0):isFinite(M)?M!==(0|M)?(U.push(203),w(U,M),9):M>=0?M<128?(X(U,M),1):M<256?(U.push(204),X(U,M),2):M<65536?(U.push(205),I(U,M),3):M<4294967296?(U.push(206),t(U,M),5):(U.push(207),k(U,M),9):M>=-32?(U.push(224|M+32),1):M>=-128?(U.push(208),E(U,M),2):M>=-32768?(U.push(209),Q(U,M),3):M>=-2147483648?(U.push(210),v(U,M),5):(U.push(211),V(U,M),9):l(U,M>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var D=Object.freeze({__proto__:null,utf8Write:n,int8:E,uint8:X,int16:Q,uint16:I,int32:v,uint32:t,int64:V,uint64:k,float32:N,float64:R,writeFloat32:K,writeFloat64:w,boolean:T,string:G,number:l});function u(U,M,b){for(var a="",A=0,H=M,W=M+b;H<W;H++){var y=U[H];0!==(128&y)?192!==(224&y)?224!==(240&y)?240!==(248&y)?console.error("Invalid byte "+y.toString(16)):(A=(7&y)<<18|(63&U[++H])<<12|(63&U[++H])<<6|63&U[++H])>=65536?(A-=65536,a+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):a+=String.fromCharCode(A):a+=String.fromCharCode((15&y)<<12|(63&U[++H])<<6|63&U[++H]):a+=String.fromCharCode((31&y)<<6|63&U[++H]):a+=String.fromCharCode(y)}return a}function c(U,M){return UU(U,M)<<24>>24}function UU(U,M){return U[M.offset++]}function MU(U,M){return bU(U,M)<<16>>16}function bU(U,M){return U[M.offset++]|U[M.offset++]<<8}function aU(U,M){return U[M.offset++]|U[M.offset++]<<8|U[M.offset++]<<16|U[M.offset++]<<24}function AU(U,M){return aU(U,M)>>>0}function HU(U,M){return ZU(U,M)}function WU(U,M){return CU(U,M)}function yU(U,M){var b=AU(U,M);return aU(U,M)*Math.pow(2,32)+b}function OU(U,M){var b=AU(U,M);return AU(U,M)*Math.pow(2,32)+b}var eU=new Int32Array(2),xU=new Float32Array(eU.buffer),PU=new Float64Array(eU.buffer);function ZU(U,M){return eU[0]=aU(U,M),xU[0]}function CU(U,M){return eU[0]=aU(U,M),eU[1]=aU(U,M),PU[0]}function rU(U,M){return UU(U,M)>0}function BU(U,M){var b,a=U[M.offset++];a<192?b=31&a:217===a?b=UU(U,M):218===a?b=bU(U,M):219===a&&(b=AU(U,M));var A=u(U,M.offset,b);return M.offset+=b,A}function JU(U,M){var b=U[M.offset];return b<192&&b>160||217===b||218===b||219===b}function FU(U,M){var b=U[M.offset++];return b<128?b:202===b?ZU(U,M):203===b?CU(U,M):204===b?UU(U,M):205===b?bU(U,M):206===b?AU(U,M):207===b?OU(U,M):208===b?c(U,M):209===b?MU(U,M):210===b?aU(U,M):211===b?yU(U,M):b>223?-1*(255-b+1):void 0}function fU(U,M){var b=U[M.offset];return b<128||b>=202&&b<=211}function LU(U,M){return U[M.offset]<160}function zU(U,M){return U[M.offset-1]===W&&(U[M.offset]<128||U[M.offset]>=202&&U[M.offset]<=211)}var oU=Object.freeze({__proto__:null,int8:c,uint8:UU,int16:MU,uint16:bU,int32:aU,uint32:AU,float32:HU,float64:WU,int64:yU,uint64:OU,readFloat32:ZU,readFloat64:CU,boolean:rU,string:BU,stringCheck:JU,number:FU,numberCheck:fU,arrayCheck:LU,switchStructureCheck:zU}),SU=function(){function M(U){var M=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return M.add(U)}))}return M.prototype.Bc=function(M,b){return void 0===b&&(b=!0),e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,M,b?this.$items:void 0)},M.prototype.Mc=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,M)},M.is=function(U){return void 0!==U.collection},M.prototype.add=function(U){var M=this.$refId++;return void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,M),this.$changes.indexes[M]=M,this.$indexes.set(M,M),this.$items.set(M,U),this.$changes.change(M),M},M.prototype.at=function(U){var M=Array.from(this.$items.keys())[U];return this.$items.get(M)},M.prototype.entries=function(){return this.$items.entries()},M.prototype.delete=function(U){for(var M,b,a=this.$items.entries();(b=a.next())&&!b.done;)if(U===b.value[1]){M=b.value[0];break}return void 0!==M&&(this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M))},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&x.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(U){return Array.from(this.$items.values()).some((function(M){return M===U}))},M.prototype.forEach=function(U){var M=this;this.$items.forEach((function(b,a,A){return U(b,a,M)}))},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(U,M){this.$indexes.set(U,M)},M.prototype.getIndex=function(U){return this.$indexes.get(U)},M.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},M.prototype.deleteByIndex=function(U){var M=this.$indexes.get(U);this.$items.delete(M),this.$indexes.delete(U)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){var U=[];return this.forEach((function(M,b){U.push("function"===typeof M.toJSON?M.toJSON():M)})),U},M.prototype.clone=function(U){var b;return U?b=Object.assign(new M,this):(b=new M,this.forEach((function(U){U.$changes?b.add(U.clone()):b.add(U)}))),b},M}(),hU=function(){function M(U){var M=this;this.$changes=new O(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return M.add(U)}))}return M.prototype.Bc=function(M,b){return void 0===b&&(b=!0),e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,M,b?this.$items:void 0)},M.prototype.Mc=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,M)},M.prototype.onChange=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,M)},M.is=function(U){return void 0!==U.set},M.prototype.add=function(M){var b,a;if(this.has(M))return!1;var A=this.$refId++;void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,A);var H=null!==(a=null===(b=this.$changes.indexes[A])||void 0===b?void 0:b.op)&&void 0!==a?a:U.OPERATION.ADD;return this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,M),this.$changes.change(A,H),A},M.prototype.entries=function(){return this.$items.entries()},M.prototype.delete=function(U){for(var M,b,a=this.$items.entries();(b=a.next())&&!b.done;)if(U===b.value[1]){M=b.value[0];break}return void 0!==M&&(this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M))},M.prototype.clear=function(M){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),M&&x.call(this,M),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},M.prototype.has=function(U){for(var M,b=this.$items.values(),a=!1;(M=b.next())&&!M.done;)if(U===M.value){a=!0;break}return a},M.prototype.forEach=function(U){var M=this;this.$items.forEach((function(b,a,A){return U(b,a,M)}))},M.prototype.values=function(){return this.$items.values()},Object.defineProperty(M.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),M.prototype.setIndex=function(U,M){this.$indexes.set(U,M)},M.prototype.getIndex=function(U){return this.$indexes.get(U)},M.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},M.prototype.deleteByIndex=function(U){var M=this.$indexes.get(U);this.$items.delete(M),this.$indexes.delete(U)},M.prototype.toArray=function(){return Array.from(this.$items.values())},M.prototype.toJSON=function(){var U=[];return this.forEach((function(M,b){U.push("function"===typeof M.toJSON?M.toJSON():M)})),U},M.prototype.clone=function(U){var b;return U?b=Object.assign(new M,this):(b=new M,this.forEach((function(U){U.$changes?b.add(U.clone()):b.add(U)}))),b},M}(),iU=function(){function U(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return U.prototype.addRefId=function(U){this.refIds.has(U)||(this.refIds.add(U),this.containerIndexes.set(U,new Set))},U.get=function(M){return void 0===M.$filterState&&(M.$filterState=new U),M.$filterState},U}(),YU=function(){function U(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return U.prototype.getNextUniqueId=function(){return this.nextUniqueId++},U.prototype.addRef=function(U,M,b){void 0===b&&(b=!0),this.refs.set(U,M),b&&(this.refCounts[U]=(this.refCounts[U]||0)+1)},U.prototype.removeRef=function(U){this.refCounts[U]=this.refCounts[U]-1,this.deletedRefs.add(U)},U.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},U.prototype.garbageCollectDeletedRefs=function(){var U=this;this.deletedRefs.forEach((function(M){if(!(U.refCounts[M]>0)){var b=U.refs.get(M);if(b instanceof EU)for(var a in b._definition.schema)"string"!==typeof b._definition.schema[a]&&b[a]&&b[a].$changes&&U.removeRef(b[a].$changes.refId);else{var A=b.$changes.parent._definition,H=A.schema[A.fieldsByIndex[b.$changes.parentIndex]];"function"===typeof Object.values(H)[0]&&Array.from(b.values()).forEach((function(M){return U.removeRef(M.$changes.refId)}))}U.refs.delete(M),delete U.refCounts[M]}})),this.deletedRefs.clear()},U}(),dU=function(U){function M(){return null!==U&&U.apply(this,arguments)||this}return b(M,U),M}(Error);function sU(U,M,b,a){var A,H=!1;switch(M){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":A="number",isNaN(U)&&console.log('trying to encode "NaN" in '.concat(b.constructor.name,"#").concat(a));break;case"string":A="string",H=!0;break;case"boolean":return}if(typeof U!==A&&(!H||H&&null!==U)){var W="'".concat(JSON.stringify(U),"'").concat(U&&U.constructor&&" (".concat(U.constructor.name,")")||"");throw new dU("a '".concat(A,"' was expected, but ").concat(W," was provided in ").concat(b.constructor.name,"#").concat(a))}}function qU(U,M,b,a){if(!(U instanceof M))throw new dU("a '".concat(M.name,"' was expected, but '").concat(U.constructor.name,"' was provided in ").concat(b.constructor.name,"#").concat(a))}function mU(U,M,b,a,A){sU(b,U,a,A);var H=D[U];if(!H)throw new dU("a '".concat(U,"' was expected, but ").concat(b," was provided in ").concat(a.constructor.name,"#").concat(A));H(M,b)}function nU(U,M,b){return oU[U](M,b)}var EU=function(){function M(){for(var U=[],M=0;M<arguments.length;M++)U[M]=arguments[M];Object.defineProperties(this,{$changes:{value:new O(this,void 0,new YU),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var b=this._definition.descriptors;b&&Object.defineProperties(this,b),U[0]&&this.assign(U[0])}return M.onError=function(U){console.error(U)},M.is=function(U){return U._definition&&void 0!==U._definition.schema},M.prototype.onChange=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,M)},M.prototype.Mc=function(M){return e(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,M)},M.prototype.assign=function(U){return Object.assign(this,U),this},Object.defineProperty(M.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),M.prototype.setDirty=function(U,M){this.$changes.change(U,M)},M.prototype.listen=function(U,M,b){var a=this;return void 0===b&&(b=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[U]||(this.$callbacks[U]=[]),this.$callbacks[U].push(M),b&&void 0!==this[U]&&M(this[U],void 0),function(){return P(a.$callbacks[U],a.$callbacks[U].indexOf(M))}},M.prototype.decode=function(b,a,A){var H;void 0===a&&(a={offset:0}),void 0===A&&(A=this);var y=[],O=this.$changes.root,e=b.length,x=0;for(O.refs.set(x,this);a.offset<e;){var P=b[a.offset++];if(P!=W){var Z=A.$changes,C=void 0!==A._definition,B=C?P>>6<<6:P;if(B!==U.OPERATION.CLEAR){var F=C?P%(B||255):FU(b,a),f=C?A._definition.fieldsByIndex[F]:"",z=Z.getType(F),o=void 0,S=void 0,h=void 0;if(C?S=A["_".concat(f)]:(S=A.getByIndex(F),(B&U.OPERATION.ADD)===U.OPERATION.ADD?(h=A instanceof J?BU(b,a):F,A.setIndex(F,h)):h=A.getIndex(F)),(B&U.OPERATION.DELETE)===U.OPERATION.DELETE&&(B!==U.OPERATION.DELETE_AND_ADD&&A.deleteByIndex(F),S&&S.$changes&&O.removeRef(S.$changes.refId),o=null),void 0!==f){if(B===U.OPERATION.DELETE);else if(M.is(z)){var i=FU(b,a);if(o=O.refs.get(i),B!==U.OPERATION.REPLACE){var Y=this.getSchemaType(b,a,z);o||((o=this.createTypeInstance(Y)).$changes.refId=i,S&&(o.$callbacks=S.$callbacks,S.$changes.refId&&i!==S.$changes.refId&&O.removeRef(S.$changes.refId))),O.addRef(i,o,o!==S)}}else if("string"===typeof z)o=nU(z,b,a);else{var d=L(Object.keys(z)[0]),s=FU(b,a),q=O.refs.has(s)?S||O.refs.get(s):new d.constructor;if((o=q.clone(!0)).$changes.refId=s,S&&(o.$callbacks=S.$callbacks,S.$changes.refId&&s!==S.$changes.refId)){O.removeRef(S.$changes.refId);for(var m=S.entries(),n=void 0;(n=m.next())&&!n.done;){var E=(H=n.value)[0],X=H[1];y.push({refId:s,op:U.OPERATION.DELETE,field:E,value:void 0,previousValue:X})}}O.addRef(s,o,q!==S)}if(null!==o&&void 0!==o)if(o.$changes&&o.$changes.setParent(Z.ref,Z.root,F),A instanceof M)A[f]=o;else if(A instanceof J)E=h,A.$items.set(E,o),A.$changes.allChanges.add(F);else if(A instanceof r)A.setAt(F,o);else if(A instanceof SU){var Q=A.add(o);A.setIndex(F,Q)}else A instanceof hU&&!1!==(Q=A.add(o))&&A.setIndex(F,Q);S!==o&&y.push({refId:x,op:B,field:f,dynamicIndex:h,value:o,previousValue:S})}else{console.warn("@colyseus/schema: definition mismatch");for(var I={offset:a.offset};a.offset<e&&(!zU(b,a)||(I.offset=a.offset+1,!O.refs.has(FU(b,I))));)a.offset++}}else A.clear(y)}else{x=FU(b,a);var v=O.refs.get(x);if(!v)throw new Error('"refId" not found: '.concat(x));A=v}}return this._triggerChanges(y),O.garbageCollectDeletedRefs(),y},M.prototype.encode=function(b,a,A){void 0===b&&(b=!1),void 0===a&&(a=[]),void 0===A&&(A=!1);for(var H=this.$changes,y=new WeakSet,O=[H],e=1,x=0;x<e;x++){var P=O[x],Z=P.ref,C=Z instanceof M;P.ensureRefId(),y.add(P),P!==H&&(P.changed||b)&&(X(a,W),l(a,P.refId));for(var r=b?Array.from(P.allChanges):Array.from(P.changes.values()),B=0,F=r.length;B<F;B++){var f=b?{op:U.OPERATION.ADD,index:r[B]}:r[B],z=f.index,o=C?Z._definition.fieldsByIndex&&Z._definition.fieldsByIndex[z]:z,S=a.length;if(f.op!==U.OPERATION.TOUCH)if(C)X(a,z|f.op);else{if(X(a,f.op),f.op===U.OPERATION.CLEAR)continue;l(a,z)}if(C||(f.op&U.OPERATION.ADD)!=U.OPERATION.ADD||Z instanceof J&&G(a,P.ref.$indexes.get(z)),f.op!==U.OPERATION.DELETE){var h=P.getType(z),i=P.getValue(z);if(i&&i.$changes&&!y.has(i.$changes)&&(O.push(i.$changes),i.$changes.ensureRefId(),e++),f.op!==U.OPERATION.TOUCH){if(M.is(h))qU(i,h,Z,o),l(a,i.$changes.refId),(f.op&U.OPERATION.ADD)===U.OPERATION.ADD&&this.tryEncodeTypeId(a,h,i.constructor);else if("string"===typeof h)mU(h,a,i,Z,o);else{var Y=L(Object.keys(h)[0]);qU(Z["_".concat(o)],Y.constructor,Z,o),l(a,i.$changes.refId)}A&&P.cache(z,a.slice(S))}}}b||A||P.discard()}return a},M.prototype.encodeAll=function(U){return this.encode(!0,[],U)},M.prototype.applyFilters=function(b,a){var A,H;void 0===a&&(a=!1);for(var y=this,O=new Set,e=iU.get(b),x=[this.$changes],P=1,Z=[],C=function(C){var r=x[C];if(O.has(r.refId))return"continue";var B=r.ref,F=B instanceof M;X(Z,W),l(Z,r.refId);var f=e.refIds.has(r),L=a||!f;e.addRefId(r);var z=e.containerIndexes.get(r),o=L?Array.from(r.allChanges):Array.from(r.changes.values());!a&&F&&B._definition.indexesWithFilters&&B._definition.indexesWithFilters.forEach((function(M){!z.has(M)&&r.allChanges.has(M)&&(L?o.push(M):o.push({op:U.OPERATION.ADD,index:M}))}));for(var S=0,h=o.length;S<h;S++){var i=L?{op:U.OPERATION.ADD,index:o[S]}:o[S];if(i.op!==U.OPERATION.CLEAR){var Y=i.index;if(i.op!==U.OPERATION.DELETE){var d=r.getValue(Y),s=r.getType(Y);if(F){if((q=B._definition.filters&&B._definition.filters[Y])&&!q.call(B,b,d,y)){d&&d.$changes&&O.add(d.$changes.refId);continue}}else{var q,m=r.parent;if((q=r.getChildrenFilter())&&!q.call(m,b,B.$indexes.get(Y),d,y)){d&&d.$changes&&O.add(d.$changes.refId);continue}}if(d.$changes&&(x.push(d.$changes),P++),i.op!==U.OPERATION.TOUCH)if(i.op===U.OPERATION.ADD||F)Z.push.apply(Z,null!==(A=r.caches[Y])&&void 0!==A?A:[]),z.add(Y);else if(z.has(Y))Z.push.apply(Z,null!==(H=r.caches[Y])&&void 0!==H?H:[]);else{if(z.add(Y),X(Z,U.OPERATION.ADD),l(Z,Y),B instanceof J){var n=r.ref.$indexes.get(Y);G(Z,n)}d.$changes?l(Z,d.$changes.refId):D[s](Z,d)}else d.$changes&&!F&&(X(Z,U.OPERATION.ADD),l(Z,Y),B instanceof J&&(n=r.ref.$indexes.get(Y),G(Z,n)),l(Z,d.$changes.refId))}else F?X(Z,i.op|Y):(X(Z,i.op),l(Z,Y))}else X(Z,i.op)}},r=0;r<P;r++)C(r);return Z},M.prototype.clone=function(){var U,M=new this.constructor,b=this._definition.schema;for(var a in b)"object"===typeof this[a]&&"function"===typeof(null===(U=this[a])||void 0===U?void 0:U.clone)?M[a]=this[a].clone():M[a]=this[a];return M},M.prototype.toJSON=function(){var U=this._definition.schema,M=this._definition.deprecated,b={};for(var a in U)M[a]||null===this[a]||"undefined"===typeof this[a]||(b[a]="function"===typeof this[a].toJSON?this[a].toJSON():this["_".concat(a)]);return b},M.prototype.discardAllChanges=function(){this.$changes.discardAll()},M.prototype.getByIndex=function(U){return this[this._definition.fieldsByIndex[U]]},M.prototype.deleteByIndex=function(U){this[this._definition.fieldsByIndex[U]]=void 0},M.prototype.tryEncodeTypeId=function(U,M,b){M._typeid!==b._typeid&&(X(U,y),l(U,b._typeid))},M.prototype.getSchemaType=function(U,M,b){var a;return U[M.offset]===y&&(M.offset++,a=this.constructor._context.get(FU(U,M))),a||b},M.prototype.createTypeInstance=function(U){var M=new U;return M.$changes.root=this.$changes.root,M},M.prototype._triggerChanges=function(b){for(var a,A,H,W,y,O,e,x,P,Z=new Set,C=this.$changes.root.refs,r=function(r){var B=b[r],J=B.refId,F=C.get(J),f=F.$callbacks;if((B.op&U.OPERATION.DELETE)===U.OPERATION.DELETE&&B.previousValue instanceof M&&(null===(A=null===(a=B.previousValue.$callbacks)||void 0===a?void 0:a[U.OPERATION.DELETE])||void 0===A||A.forEach((function(U){return U()}))),!f)return"continue";if(F instanceof M){if(!Z.has(J))try{null===(H=null===f||void 0===f?void 0:f[U.OPERATION.REPLACE])||void 0===H||H.forEach((function(U){return U()}))}catch(L){M.onError(L)}try{f.hasOwnProperty(B.field)&&(null===(W=f[B.field])||void 0===W||W.forEach((function(U){return U(B.value,B.previousValue)})))}catch(L){M.onError(L)}}else B.op===U.OPERATION.ADD&&void 0===B.previousValue?null===(y=f[U.OPERATION.ADD])||void 0===y||y.forEach((function(U){var M;return U(B.value,null!==(M=B.dynamicIndex)&&void 0!==M?M:B.field)})):B.op===U.OPERATION.DELETE?void 0!==B.previousValue&&(null===(O=f[U.OPERATION.DELETE])||void 0===O||O.forEach((function(U){var M;return U(B.previousValue,null!==(M=B.dynamicIndex)&&void 0!==M?M:B.field)}))):B.op===U.OPERATION.DELETE_AND_ADD&&(void 0!==B.previousValue&&(null===(e=f[U.OPERATION.DELETE])||void 0===e||e.forEach((function(U){var M;return U(B.previousValue,null!==(M=B.dynamicIndex)&&void 0!==M?M:B.field)}))),null===(x=f[U.OPERATION.ADD])||void 0===x||x.forEach((function(U){var M;return U(B.value,null!==(M=B.dynamicIndex)&&void 0!==M?M:B.field)}))),B.value!==B.previousValue&&(null===(P=f[U.OPERATION.REPLACE])||void 0===P||P.forEach((function(U){var M;return U(B.value,null!==(M=B.dynamicIndex)&&void 0!==M?M:B.field)})));Z.add(J)},B=0;B<b.length;B++)r(B)},M._definition=z.create(),M}();function XU(U){for(var M=[U.$changes],b=1,a={},A=a,H=function(U){var b=M[U];b.changes.forEach((function(U){var M=b.ref,a=U.index,H=M._definition?M._definition.fieldsByIndex[a]:M.$indexes.get(a);A[H]=b.getValue(a)}))},W=0;W<b;W++)H(W);return a}var QU={context:new S},IU=function(U){function M(){return null!==U&&U.apply(this,arguments)||this}return b(M,U),a([i("string",QU)],M.prototype,"name",void 0),a([i("string",QU)],M.prototype,"type",void 0),a([i("number",QU)],M.prototype,"referencedType",void 0),M}(EU),vU=function(U){function M(){var M=null!==U&&U.apply(this,arguments)||this;return M.fields=new r,M}return b(M,U),a([i("number",QU)],M.prototype,"id",void 0),a([i([IU],QU)],M.prototype,"fields",void 0),M}(EU),tU=function(U){function M(){var M=null!==U&&U.apply(this,arguments)||this;return M.types=new r,M}return b(M,U),M.encode=function(U){var b=U.constructor,a=new M;a.rootType=b._typeid;var A=function(U,M){for(var b in M){var A=new IU;A.name=b;var H=void 0;if("string"===typeof M[b])H=M[b];else{var W=M[b],y=void 0;EU.is(W)?(H="ref",y=M[b]):"string"===typeof W[H=Object.keys(W)[0]]?H+=":"+W[H]:y=W[H],A.referencedType=y?y._typeid:-1}A.type=H,U.fields.push(A)}a.types.push(U)},H=b._context.types;for(var W in H){var y=new vU;y.id=Number(W),A(y,H[W]._definition.schema)}return a.encodeAll()},M.decode=function(U,a){var A=new S,H=new M;H.decode(U,a);var W=H.types.reduce((function(U,M){var a=function(U){function M(){return null!==U&&U.apply(this,arguments)||this}return b(M,U),M}(EU),H=M.id;return U[H]=a,A.add(a,H),U}),{});H.types.forEach((function(U){var M=W[U.id];U.fields.forEach((function(U){var b;if(void 0!==U.referencedType){var a=U.type,H=W[U.referencedType];if(!H){var y=U.type.split(":");a=y[0],H=y[1]}"ref"===a?i(H,{context:A})(M.prototype,U.name):i(((b={})[a]=H,b),{context:A})(M.prototype,U.name)}else i(U.type,{context:A})(M.prototype,U.name)}))}));var y=W[H.rootType],O=new y;for(var e in y._definition.schema){var x=y._definition.schema[e];"string"!==typeof x&&(O[e]="function"===typeof x?new x:new(L(Object.keys(x)[0]).constructor))}return O},a([i([vU],QU)],M.prototype,"types",void 0),a([i("number",QU)],M.prototype,"rootType",void 0),M}(EU);f("map",{constructor:J}),f("array",{constructor:r}),f("set",{constructor:hU}),f("collection",{constructor:SU}),U.ArraySchema=r,U.CollectionSchema=SU,U.Context=S,U.MapSchema=J,U.Reflection=tU,U.ReflectionField=IU,U.ReflectionType=vU,U.Schema=EU,U.SchemaDefinition=z,U.SetSchema=hU,U.decode=oU,U.defineTypes=q,U.deprecated=s,U.dumpChanges=XU,U.encode=D,U.filter=Y,U.filterChildren=d,U.hasFilter=o,U.registerType=f,U.type=i,Object.defineProperty(U,"__esModule",{value:!0})}(M)},12983:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12975:(U,M,b)=>{var a=b(12983),A=b(12990),H=Object.hasOwnProperty,W=Object.create(null);for(var y in a)H.call(a,y)&&(W[a[y]]=y);var O=U.exports={to:{},get:{}};function e(U,M,b){return Math.min(Math.max(M,U),b)}function x(U){var M=Math.round(U).toString(16).toUpperCase();return M.length<2?"0"+M:M}O.get=function(U){var M,b;switch(U.substring(0,3).toLowerCase()){case"hsl":M=O.get.hsl(U),b="hsl";break;case"hwb":M=O.get.hwb(U),b="hwb";break;default:M=O.get.rgb(U),b="rgb"}return M?{model:b,value:M}:null},O.get.rgb=function(U){if(!U)return null;var M,b,A,W=[0,0,0,1];if(M=U.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(A=M[2],M=M[1],b=0;b<3;b++){var y=2*b;W[b]=parseInt(M.slice(y,y+2),16)}A&&(W[3]=parseInt(A,16)/255)}else if(M=U.match(/^#([a-f0-9]{3,4})$/i)){for(A=(M=M[1])[3],b=0;b<3;b++)W[b]=parseInt(M[b]+M[b],16);A&&(W[3]=parseInt(A+A,16)/255)}else if(M=U.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(b=0;b<3;b++)W[b]=parseInt(M[b+1],0);M[4]&&(M[5]?W[3]=.01*parseFloat(M[4]):W[3]=parseFloat(M[4]))}else{if(!(M=U.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(M=U.match(/^(\w+)$/))?"transparent"===M[1]?[0,0,0,0]:H.call(a,M[1])?((W=a[M[1]])[3]=1,W):null:null;for(b=0;b<3;b++)W[b]=Math.round(2.55*parseFloat(M[b+1]));M[4]&&(M[5]?W[3]=.01*parseFloat(M[4]):W[3]=parseFloat(M[4]))}for(b=0;b<3;b++)W[b]=e(W[b],0,255);return W[3]=e(W[3],0,1),W},O.get.hsl=function(U){if(!U)return null;var M=U.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(M){var b=parseFloat(M[4]);return[(parseFloat(M[1])%360+360)%360,e(parseFloat(M[2]),0,100),e(parseFloat(M[3]),0,100),e(isNaN(b)?1:b,0,1)]}return null},O.get.hwb=function(U){if(!U)return null;var M=U.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(M){var b=parseFloat(M[4]);return[(parseFloat(M[1])%360+360)%360,e(parseFloat(M[2]),0,100),e(parseFloat(M[3]),0,100),e(isNaN(b)?1:b,0,1)]}return null},O.to.hex=function(){var U=A(arguments);return"#"+x(U[0])+x(U[1])+x(U[2])+(U[3]<1?x(Math.round(255*U[3])):"")},O.to.rgb=function(){var U=A(arguments);return U.length<4||1===U[3]?"rgb("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+")":"rgba("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+", "+U[3]+")"},O.to.rgb.percent=function(){var U=A(arguments),M=Math.round(U[0]/255*100),b=Math.round(U[1]/255*100),a=Math.round(U[2]/255*100);return U.length<4||1===U[3]?"rgb("+M+"%, "+b+"%, "+a+"%)":"rgba("+M+"%, "+b+"%, "+a+"%, "+U[3]+")"},O.to.hsl=function(){var U=A(arguments);return U.length<4||1===U[3]?"hsl("+U[0]+", "+U[1]+"%, "+U[2]+"%)":"hsla("+U[0]+", "+U[1]+"%, "+U[2]+"%, "+U[3]+")"},O.to.hwb=function(){var U=A(arguments),M="";return U.length>=4&&1!==U[3]&&(M=", "+U[3]),"hwb("+U[0]+", "+U[1]+"%, "+U[2]+"%"+M+")"},O.to.keyword=function(U){return W[U.slice(0,3)]}},12972:(U,M,b)=>{const a=b(12975),A=b(13006),H=["keyword","gray","hex"],W={};for(const C of Object.keys(A))W[[...A[C].labels].sort().join("")]=C;const y={};function O(U,M){if(!(this instanceof O))return new O(U,M);if(M&&M in H&&(M=null),M&&!(M in A))throw new Error("Unknown model: "+M);let b,e;if(null==U)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(U instanceof O)this.model=U.model,this.color=[...U.color],this.valpha=U.valpha;else if("string"===typeof U){const M=a.get(U);if(null===M)throw new Error("Unable to parse color from string: "+U);this.model=M.model,e=A[this.model].channels,this.color=M.value.slice(0,e),this.valpha="number"===typeof M.value[e]?M.value[e]:1}else if(U.length>0){this.model=M||"rgb",e=A[this.model].channels;const b=Array.prototype.slice.call(U,0,e);this.color=Z(b,e),this.valpha="number"===typeof U[e]?U[e]:1}else if("number"===typeof U)this.model="rgb",this.color=[U>>16&255,U>>8&255,255&U],this.valpha=1;else{this.valpha=1;const M=Object.keys(U);"alpha"in U&&(M.splice(M.indexOf("alpha"),1),this.valpha="number"===typeof U.alpha?U.alpha:0);const a=M.sort().join("");if(!(a in W))throw new Error("Unable to parse color from object: "+JSON.stringify(U));this.model=W[a];const{labels:H}=A[this.model],y=[];for(b=0;b<H.length;b++)y.push(U[H[b]]);this.color=Z(y)}if(y[this.model])for(e=A[this.model].channels,b=0;b<e;b++){const U=y[this.model][b];U&&(this.color[b]=U(this.color[b]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}O.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(U){let M=this.model in a.to?this:this.rgb();M=M.round("number"===typeof U?U:1);const b=1===M.valpha?M.color:[...M.color,this.valpha];return a.to[M.model](b)},percentString(U){const M=this.rgb().round("number"===typeof U?U:1),b=1===M.valpha?M.color:[...M.color,this.valpha];return a.to.rgb.percent(b)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const U={},{channels:M}=A[this.model],{labels:b}=A[this.model];for(let a=0;a<M;a++)U[b[a]]=this.color[a];return 1!==this.valpha&&(U.alpha=this.valpha),U},unitArray(){const U=this.rgb().color;return U[0]/=255,U[1]/=255,U[2]/=255,1!==this.valpha&&U.push(this.valpha),U},unitObject(){const U=this.rgb().object();return U.r/=255,U.g/=255,U.b/=255,1!==this.valpha&&(U.alpha=this.valpha),U},round(U){return U=Math.max(U||0,0),new O([...this.color.map(e(U)),this.valpha],this.model)},alpha(U){return void 0!==U?new O([...this.color,Math.max(0,Math.min(1,U))],this.model):this.valpha},red:x("rgb",0,P(255)),green:x("rgb",1,P(255)),blue:x("rgb",2,P(255)),hue:x(["hsl","hsv","hsl","hwb","hcg"],0,(U=>(U%360+360)%360)),saturationl:x("hsl",1,P(100)),lightness:x("hsl",2,P(100)),saturationv:x("hsv",1,P(100)),value:x("hsv",2,P(100)),chroma:x("hcg",1,P(100)),gray:x("hcg",2,P(100)),white:x("hwb",1,P(100)),wblack:x("hwb",2,P(100)),cyan:x("cmyk",0,P(100)),magenta:x("cmyk",1,P(100)),yellow:x("cmyk",2,P(100)),black:x("cmyk",3,P(100)),x:x("xyz",0,P(95.047)),y:x("xyz",1,P(100)),z:x("xyz",2,P(108.833)),l:x("lab",0,P(100)),a:x("lab",1),b:x("lab",2),keyword(U){return void 0!==U?new O(U):A[this.model].keyword(this.color)},hex(U){return void 0!==U?new O(U):a.to.hex(this.rgb().round().color)},hexa(U){if(void 0!==U)return new O(U);const M=this.rgb().round().color;let b=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===b.length&&(b="0"+b),a.to.hex(M)+b},rgbNumber(){const U=this.rgb().color;return(255&U[0])<<16|(255&U[1])<<8|255&U[2]},luminosity(){const U=this.rgb().color,M=[];for(const[b,a]of U.entries()){const U=a/255;M[b]=U<=.04045?U/12.92:((U+.055)/1.055)**2.4}return.2126*M[0]+.7152*M[1]+.0722*M[2]},contrast(U){const M=this.luminosity(),b=U.luminosity();return M>b?(M+.05)/(b+.05):(b+.05)/(M+.05)},level(U){const M=this.contrast(U);return M>=7?"AAA":M>=4.5?"AA":""},isDark(){const U=this.rgb().color;return(2126*U[0]+7152*U[1]+722*U[2])/1e4<128},isLight(){return!this.isDark()},negate(){const U=this.rgb();for(let M=0;M<3;M++)U.color[M]=255-U.color[M];return U},lighten(U){const M=this.hsl();return M.color[2]+=M.color[2]*U,M},darken(U){const M=this.hsl();return M.color[2]-=M.color[2]*U,M},saturate(U){const M=this.hsl();return M.color[1]+=M.color[1]*U,M},desaturate(U){const M=this.hsl();return M.color[1]-=M.color[1]*U,M},whiten(U){const M=this.hwb();return M.color[1]+=M.color[1]*U,M},blacken(U){const M=this.hwb();return M.color[2]+=M.color[2]*U,M},grayscale(){const U=this.rgb().color,M=.3*U[0]+.59*U[1]+.11*U[2];return O.rgb(M,M,M)},fade(U){return this.alpha(this.valpha-this.valpha*U)},opaquer(U){return this.alpha(this.valpha+this.valpha*U)},rotate(U){const M=this.hsl();let b=M.color[0];return b=(b+U)%360,b=b<0?360+b:b,M.color[0]=b,M},mix(U,M){if(!U||!U.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof U);const b=U.rgb(),a=this.rgb(),A=void 0===M?.5:M,H=2*A-1,W=b.alpha()-a.alpha(),y=((H*W===-1?H:(H+W)/(1+H*W))+1)/2,e=1-y;return O.rgb(y*b.red()+e*a.red(),y*b.green()+e*a.green(),y*b.blue()+e*a.blue(),b.alpha()*A+a.alpha()*(1-A))}};for(const C of Object.keys(A)){if(H.includes(C))continue;const{channels:U}=A[C];O.prototype[C]=function(){if(this.model===C)return new O(this);for(var U=arguments.length,M=new Array(U),b=0;b<U;b++)M[b]=arguments[b];return M.length>0?new O(M,C):new O([...(a=A[this.model][C].raw(this.color),Array.isArray(a)?a:[a]),this.valpha],C);var a},O[C]=function(){for(var M=arguments.length,b=new Array(M),a=0;a<M;a++)b[a]=arguments[a];let A=b[0];return"number"===typeof A&&(A=Z(b,U)),new O(A,C)}}function e(U){return function(M){return function(U,M){return Number(U.toFixed(M))}(M,U)}}function x(U,M,b){U=Array.isArray(U)?U:[U];for(const a of U)(y[a]||(y[a]=[]))[M]=b;return U=U[0],function(a){let A;return void 0!==a?(b&&(a=b(a)),A=this[U](),A.color[M]=a,A):(A=this[U]().color[M],b&&(A=b(A)),A)}}function P(U){return function(M){return Math.max(0,Math.min(U,M))}}function Z(U,M){for(let b=0;b<M;b++)"number"!==typeof U[b]&&(U[b]=0);return U}U.exports=O},13015:(U,M,b)=>{const a=b(13021),A={};for(const W of Object.keys(a))A[a[W]]=W;const H={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};U.exports=H;for(const W of Object.keys(H)){if(!("channels"in H[W]))throw new Error("missing channels property: "+W);if(!("labels"in H[W]))throw new Error("missing channel labels property: "+W);if(H[W].labels.length!==H[W].channels)throw new Error("channel and label counts mismatch: "+W);const{channels:U,labels:M}=H[W];delete H[W].channels,delete H[W].labels,Object.defineProperty(H[W],"channels",{value:U}),Object.defineProperty(H[W],"labels",{value:M})}H.rgb.hsl=function(U){const M=U[0]/255,b=U[1]/255,a=U[2]/255,A=Math.min(M,b,a),H=Math.max(M,b,a),W=H-A;let y,O;H===A?y=0:M===H?y=(b-a)/W:b===H?y=2+(a-M)/W:a===H&&(y=4+(M-b)/W),y=Math.min(60*y,360),y<0&&(y+=360);const e=(A+H)/2;return O=H===A?0:e<=.5?W/(H+A):W/(2-H-A),[y,100*O,100*e]},H.rgb.hsv=function(U){let M,b,a,A,H;const W=U[0]/255,y=U[1]/255,O=U[2]/255,e=Math.max(W,y,O),x=e-Math.min(W,y,O),P=function(U){return(e-U)/6/x+.5};return 0===x?(A=0,H=0):(H=x/e,M=P(W),b=P(y),a=P(O),W===e?A=a-b:y===e?A=1/3+M-a:O===e&&(A=2/3+b-M),A<0?A+=1:A>1&&(A-=1)),[360*A,100*H,100*e]},H.rgb.hwb=function(U){const M=U[0],b=U[1];let a=U[2];const A=H.rgb.hsl(U)[0],W=1/255*Math.min(M,Math.min(b,a));return a=1-1/255*Math.max(M,Math.max(b,a)),[A,100*W,100*a]},H.rgb.cmyk=function(U){const M=U[0]/255,b=U[1]/255,a=U[2]/255,A=Math.min(1-M,1-b,1-a);return[100*((1-M-A)/(1-A)||0),100*((1-b-A)/(1-A)||0),100*((1-a-A)/(1-A)||0),100*A]},H.rgb.keyword=function(U){const M=A[U];if(M)return M;let b,H=1/0;for(const A of Object.keys(a)){const M=a[A],O=(y=M,((W=U)[0]-y[0])**2+(W[1]-y[1])**2+(W[2]-y[2])**2);O<H&&(H=O,b=A)}var W,y;return b},H.keyword.rgb=function(U){return a[U]},H.rgb.xyz=function(U){let M=U[0]/255,b=U[1]/255,a=U[2]/255;M=M>.04045?((M+.055)/1.055)**2.4:M/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,a=a>.04045?((a+.055)/1.055)**2.4:a/12.92;return[100*(.4124*M+.3576*b+.1805*a),100*(.2126*M+.7152*b+.0722*a),100*(.0193*M+.1192*b+.9505*a)]},H.rgb.lab=function(U){const M=H.rgb.xyz(U);let b=M[0],a=M[1],A=M[2];b/=95.047,a/=100,A/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,a=a>.008856?a**(1/3):7.787*a+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*a-16,500*(b-a),200*(a-A)]},H.hsl.rgb=function(U){const M=U[0]/360,b=U[1]/100,a=U[2]/100;let A,H,W;if(0===b)return W=255*a,[W,W,W];A=a<.5?a*(1+b):a+b-a*b;const y=2*a-A,O=[0,0,0];for(let e=0;e<3;e++)H=M+1/3*-(e-1),H<0&&H++,H>1&&H--,W=6*H<1?y+6*(A-y)*H:2*H<1?A:3*H<2?y+(A-y)*(2/3-H)*6:y,O[e]=255*W;return O},H.hsl.hsv=function(U){const M=U[0];let b=U[1]/100,a=U[2]/100,A=b;const H=Math.max(a,.01);a*=2,b*=a<=1?a:2-a,A*=H<=1?H:2-H;return[M,100*(0===a?2*A/(H+A):2*b/(a+b)),100*((a+b)/2)]},H.hsv.rgb=function(U){const M=U[0]/60,b=U[1]/100;let a=U[2]/100;const A=Math.floor(M)%6,H=M-Math.floor(M),W=255*a*(1-b),y=255*a*(1-b*H),O=255*a*(1-b*(1-H));switch(a*=255,A){case 0:return[a,O,W];case 1:return[y,a,W];case 2:return[W,a,O];case 3:return[W,y,a];case 4:return[O,W,a];case 5:return[a,W,y]}},H.hsv.hsl=function(U){const M=U[0],b=U[1]/100,a=U[2]/100,A=Math.max(a,.01);let H,W;W=(2-b)*a;const y=(2-b)*A;return H=b*A,H/=y<=1?y:2-y,H=H||0,W/=2,[M,100*H,100*W]},H.hwb.rgb=function(U){const M=U[0]/360;let b=U[1]/100,a=U[2]/100;const A=b+a;let H;A>1&&(b/=A,a/=A);const W=Math.floor(6*M),y=1-a;H=6*M-W,0!==(1&W)&&(H=1-H);const O=b+H*(y-b);let e,x,P;switch(W){default:case 6:case 0:e=y,x=O,P=b;break;case 1:e=O,x=y,P=b;break;case 2:e=b,x=y,P=O;break;case 3:e=b,x=O,P=y;break;case 4:e=O,x=b,P=y;break;case 5:e=y,x=b,P=O}return[255*e,255*x,255*P]},H.cmyk.rgb=function(U){const M=U[0]/100,b=U[1]/100,a=U[2]/100,A=U[3]/100;return[255*(1-Math.min(1,M*(1-A)+A)),255*(1-Math.min(1,b*(1-A)+A)),255*(1-Math.min(1,a*(1-A)+A))]},H.xyz.rgb=function(U){const M=U[0]/100,b=U[1]/100,a=U[2]/100;let A,H,W;return A=3.2406*M+-1.5372*b+-.4986*a,H=-.9689*M+1.8758*b+.0415*a,W=.0557*M+-.204*b+1.057*a,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,H=H>.0031308?1.055*H**(1/2.4)-.055:12.92*H,W=W>.0031308?1.055*W**(1/2.4)-.055:12.92*W,A=Math.min(Math.max(0,A),1),H=Math.min(Math.max(0,H),1),W=Math.min(Math.max(0,W),1),[255*A,255*H,255*W]},H.xyz.lab=function(U){let M=U[0],b=U[1],a=U[2];M/=95.047,b/=100,a/=108.883,M=M>.008856?M**(1/3):7.787*M+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,a=a>.008856?a**(1/3):7.787*a+16/116;return[116*b-16,500*(M-b),200*(b-a)]},H.lab.xyz=function(U){let M,b,a;b=(U[0]+16)/116,M=U[1]/500+b,a=b-U[2]/200;const A=b**3,H=M**3,W=a**3;return b=A>.008856?A:(b-16/116)/7.787,M=H>.008856?H:(M-16/116)/7.787,a=W>.008856?W:(a-16/116)/7.787,M*=95.047,b*=100,a*=108.883,[M,b,a]},H.lab.lch=function(U){const M=U[0],b=U[1],a=U[2];let A;A=360*Math.atan2(a,b)/2/Math.PI,A<0&&(A+=360);return[M,Math.sqrt(b*b+a*a),A]},H.lch.lab=function(U){const M=U[0],b=U[1],a=U[2]/360*2*Math.PI;return[M,b*Math.cos(a),b*Math.sin(a)]},H.rgb.ansi16=function(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[b,a,A]=U;let W=null===M?H.rgb.hsv(U)[2]:M;if(W=Math.round(W/50),0===W)return 30;let y=30+(Math.round(A/255)<<2|Math.round(a/255)<<1|Math.round(b/255));return 2===W&&(y+=60),y},H.hsv.ansi16=function(U){return H.rgb.ansi16(H.hsv.rgb(U),U[2])},H.rgb.ansi256=function(U){const M=U[0],b=U[1],a=U[2];if(M===b&&b===a)return M<8?16:M>248?231:Math.round((M-8)/247*24)+232;return 16+36*Math.round(M/255*5)+6*Math.round(b/255*5)+Math.round(a/255*5)},H.ansi16.rgb=function(U){let M=U%10;if(0===M||7===M)return U>50&&(M+=3.5),M=M/10.5*255,[M,M,M];const b=.5*(1+~~(U>50));return[(1&M)*b*255,(M>>1&1)*b*255,(M>>2&1)*b*255]},H.ansi256.rgb=function(U){if(U>=232){const M=10*(U-232)+8;return[M,M,M]}let M;U-=16;return[Math.floor(U/36)/5*255,Math.floor((M=U%36)/6)/5*255,M%6/5*255]},H.rgb.hex=function(U){const M=(((255&Math.round(U[0]))<<16)+((255&Math.round(U[1]))<<8)+(255&Math.round(U[2]))).toString(16).toUpperCase();return"000000".substring(M.length)+M},H.hex.rgb=function(U){const M=U.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!M)return[0,0,0];let b=M[0];3===M[0].length&&(b=b.split("").map((U=>U+U)).join(""));const a=parseInt(b,16);return[a>>16&255,a>>8&255,255&a]},H.rgb.hcg=function(U){const M=U[0]/255,b=U[1]/255,a=U[2]/255,A=Math.max(Math.max(M,b),a),H=Math.min(Math.min(M,b),a),W=A-H;let y,O;return y=W<1?H/(1-W):0,O=W<=0?0:A===M?(b-a)/W%6:A===b?2+(a-M)/W:4+(M-b)/W,O/=6,O%=1,[360*O,100*W,100*y]},H.hsl.hcg=function(U){const M=U[1]/100,b=U[2]/100,a=b<.5?2*M*b:2*M*(1-b);let A=0;return a<1&&(A=(b-.5*a)/(1-a)),[U[0],100*a,100*A]},H.hsv.hcg=function(U){const M=U[1]/100,b=U[2]/100,a=M*b;let A=0;return a<1&&(A=(b-a)/(1-a)),[U[0],100*a,100*A]},H.hcg.rgb=function(U){const M=U[0]/360,b=U[1]/100,a=U[2]/100;if(0===b)return[255*a,255*a,255*a];const A=[0,0,0],H=M%1*6,W=H%1,y=1-W;let O=0;switch(Math.floor(H)){case 0:A[0]=1,A[1]=W,A[2]=0;break;case 1:A[0]=y,A[1]=1,A[2]=0;break;case 2:A[0]=0,A[1]=1,A[2]=W;break;case 3:A[0]=0,A[1]=y,A[2]=1;break;case 4:A[0]=W,A[1]=0,A[2]=1;break;default:A[0]=1,A[1]=0,A[2]=y}return O=(1-b)*a,[255*(b*A[0]+O),255*(b*A[1]+O),255*(b*A[2]+O)]},H.hcg.hsv=function(U){const M=U[1]/100,b=M+U[2]/100*(1-M);let a=0;return b>0&&(a=M/b),[U[0],100*a,100*b]},H.hcg.hsl=function(U){const M=U[1]/100,b=U[2]/100*(1-M)+.5*M;let a=0;return b>0&&b<.5?a=M/(2*b):b>=.5&&b<1&&(a=M/(2*(1-b))),[U[0],100*a,100*b]},H.hcg.hwb=function(U){const M=U[1]/100,b=M+U[2]/100*(1-M);return[U[0],100*(b-M),100*(1-b)]},H.hwb.hcg=function(U){const M=U[1]/100,b=1-U[2]/100,a=b-M;let A=0;return a<1&&(A=(b-a)/(1-a)),[U[0],100*a,100*A]},H.apple.rgb=function(U){return[U[0]/65535*255,U[1]/65535*255,U[2]/65535*255]},H.rgb.apple=function(U){return[U[0]/255*65535,U[1]/255*65535,U[2]/255*65535]},H.gray.rgb=function(U){return[U[0]/100*255,U[0]/100*255,U[0]/100*255]},H.gray.hsl=function(U){return[0,0,U[0]]},H.gray.hsv=H.gray.hsl,H.gray.hwb=function(U){return[0,100,U[0]]},H.gray.cmyk=function(U){return[0,0,0,U[0]]},H.gray.lab=function(U){return[U[0],0,0]},H.gray.hex=function(U){const M=255&Math.round(U[0]/100*255),b=((M<<16)+(M<<8)+M).toString(16).toUpperCase();return"000000".substring(b.length)+b},H.rgb.gray=function(U){return[(U[0]+U[1]+U[2])/3/255*100]}},13006:(U,M,b)=>{const a=b(13015),A=b(13024),H={};Object.keys(a).forEach((U=>{H[U]={},Object.defineProperty(H[U],"channels",{value:a[U].channels}),Object.defineProperty(H[U],"labels",{value:a[U].labels});const M=A(U);Object.keys(M).forEach((b=>{const a=M[b];H[U][b]=function(U){const M=function(){for(var M=arguments.length,b=new Array(M),a=0;a<M;a++)b[a]=arguments[a];const A=b[0];if(void 0===A||null===A)return A;A.length>1&&(b=A);const H=U(b);if("object"===typeof H)for(let U=H.length,W=0;W<U;W++)H[W]=Math.round(H[W]);return H};return"conversion"in U&&(M.conversion=U.conversion),M}(a),H[U][b].raw=function(U){const M=function(){for(var M=arguments.length,b=new Array(M),a=0;a<M;a++)b[a]=arguments[a];const A=b[0];return void 0===A||null===A?A:(A.length>1&&(b=A),U(b))};return"conversion"in U&&(M.conversion=U.conversion),M}(a)}))})),U.exports=H},13024:(U,M,b)=>{const a=b(13015);function A(U){const M=function(){const U={},M=Object.keys(a);for(let b=M.length,a=0;a<b;a++)U[M[a]]={distance:-1,parent:null};return U}(),b=[U];for(M[U].distance=0;b.length;){const U=b.pop(),A=Object.keys(a[U]);for(let a=A.length,H=0;H<a;H++){const a=A[H],W=M[a];-1===W.distance&&(W.distance=M[U].distance+1,W.parent=U,b.unshift(a))}}return M}function H(U,M){return function(b){return M(U(b))}}function W(U,M){const b=[M[U].parent,U];let A=a[M[U].parent][U],W=M[U].parent;for(;M[W].parent;)b.unshift(M[W].parent),A=H(a[M[W].parent][W],A),W=M[W].parent;return A.conversion=b,A}U.exports=function(U){const M=A(U),b={},a=Object.keys(M);for(let A=a.length,H=0;H<A;H++){const U=a[H];null!==M[U].parent&&(b[U]=W(U,M))}return b}},13021:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11952:function(U,M,b){"use strict";var a=this&&this.__createBinding||(Object.create?function(U,M,b,a){void 0===a&&(a=b);var A=Object.getOwnPropertyDescriptor(M,b);A&&!("get"in A?!M.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return M[b]}}),Object.defineProperty(U,a,A)}:function(U,M,b,a){void 0===a&&(a=b),U[a]=M[b]}),A=this&&this.__setModuleDefault||(Object.create?function(U,M){Object.defineProperty(U,"default",{enumerable:!0,value:M})}:function(U,M){U.default=M}),H=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var M={};if(null!=U)for(var b in U)"default"!==b&&Object.prototype.hasOwnProperty.call(U,b)&&a(M,U,b);return A(M,U),M},W=this&&this.__awaiter||function(U,M,b,a){return new(b||(b=Promise))((function(A,H){function W(U){try{O(a.next(U))}catch(M){H(M)}}function y(U){try{O(a.throw(U))}catch(M){H(M)}}function O(U){var M;U.done?A(U.value):(M=U.value,M instanceof b?M:new b((function(U){U(M)}))).then(W,y)}O((a=a.apply(U,M||[])).next())}))};Object.defineProperty(M,"__esModule",{value:!0}),M.Auth=M.Platform=void 0;const y=H(b(11896)),O=b(11955),e="colyseus-auth-token";!function(U){U.ios="ios",U.android="android"}(M.Platform||(M.Platform={}));M.Auth=class{constructor(U){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=U.replace("ws","http"),(0,O.getItem)(e,(U=>this.token=U))}get hasToken(){return!!this.token}login(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return W(this,void 0,void 0,(function*(){const M=Object.assign({},U);this.hasToken&&(M.token=this.token);const b=yield this.request("post","/auth",M);this.token=b.token,(0,O.setItem)(e,this.token);for(let U in b)this.hasOwnProperty(U)&&(this[U]=b[U]);return this.registerPingService(),this}))}save(){return W(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return W(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return W(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return W(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(U){return W(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:U})}))}acceptFriendRequest(U){return W(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:U})}))}declineFriendRequest(U){return W(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:U})}))}blockUser(U){return W(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:U})}))}unblockUser(U){return W(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:U})}))}request(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return W(this,void 0,void 0,(function*(){A.Accept="application/json",this.hasToken&&(A.Authorization="Bearer "+this.token);const H=[];for(const U in b)H.push(`${U}=${b[U]}`);const W=H.length>0?`?${H.join("&")}`:"",O={headers:A};return a&&(O.body=a),(yield y[U](`${this.endpoint}${M}${W}`,O)).data}))}logout(){this.token=void 0,(0,O.removeItem)(e),this.unregisterPingService()}registerPingService(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),U)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11892:function(U,M,b){"use strict";var a,A=this&&this.__awaiter||function(U,M,b,a){return new(b||(b=Promise))((function(A,H){function W(U){try{O(a.next(U))}catch(M){H(M)}}function y(U){try{O(a.throw(U))}catch(M){H(M)}}function O(U){var M;U.done?A(U.value):(M=U.value,M instanceof b?M:new b((function(U){U(M)}))).then(W,y)}O((a=a.apply(U,M||[])).next())}))};Object.defineProperty(M,"__esModule",{value:!0}),M.Client=M.MatchMakeError=void 0;const H=b(11896),W=b(11900),y=b(11905);class O extends Error{constructor(U,M){super(U),this.code=M,Object.setPrototypeOf(this,O.prototype)}}M.MatchMakeError=O;const e="undefined"!==typeof window&&"undefined"!==typeof(null===(a=null===window||void 0===window?void 0:window.location)||void 0===a?void 0:a.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";M.Client=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;if("string"===typeof U){const M=new URL(U),b="https:"===M.protocol||"wss:"===M.protocol,a=Number(M.port||(b?443:80));this.settings={hostname:M.hostname,pathname:"/"!==M.pathname?M.pathname:"",port:a,secure:b}}else void 0===U.port&&(U.port=U.secure?443:80),void 0===U.pathname&&(U.pathname=""),this.settings=U}joinOrCreate(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",U,M,b)}))}create(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",U,M,b)}))}join(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",U,M,b)}))}joinById(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return A(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",U,M,b)}))}reconnect(U,M){return A(this,void 0,void 0,(function*(){if("string"===typeof U&&"string"===typeof M)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[b,a]=U.split(":");return yield this.createMatchMakeRequest("reconnect",b,{reconnectionToken:a},M)}))}getAvailableRooms(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return A(this,void 0,void 0,(function*(){return(yield(0,H.get)(this.getHttpEndpoint(`${U}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(U,M,b){return A(this,void 0,void 0,(function*(){const a=this.createRoom(U.room.name,M);a.roomId=U.room.roomId,a.sessionId=U.sessionId;const H={sessionId:a.sessionId};U.reconnectionToken&&(H.reconnectionToken=U.reconnectionToken);const y=b||a;return a.connect(this.buildEndpoint(U.room,H),U.devMode&&(()=>A(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${a.roomId}'...`);let b=0;const H=()=>A(this,void 0,void 0,(function*(){b++;try{yield this.consumeSeatReservation(U,M,y),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${a.roomId}'`)}catch(A){b<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${b} out of 8)`),setTimeout(H,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(H,2e3)}))),y),new Promise(((U,M)=>{const b=(U,b)=>M(new W.ServerError(U,b));y.onError.once(b),y.onJoin.once((()=>{y.onError.remove(b),U(y)}))}))}))}createMatchMakeRequest(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,W=arguments.length>4?arguments[4]:void 0;return A(this,void 0,void 0,(function*(){const A=(yield(0,H.post)(this.getHttpEndpoint(`${U}/${M}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})).data;if(A.error)throw new O(A.error,A.code);return"reconnect"===U&&(A.reconnectionToken=b.reconnectionToken),yield this.consumeSeatReservation(A,a,W)}))}createRoom(U,M){return new y.Room(U,M)}buildEndpoint(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=[];for(const A in M)M.hasOwnProperty(A)&&b.push(`${A}=${M[A]}`);let a=this.settings.secure?"wss://":"ws://";return U.publicAddress?a+=`${U.publicAddress}`:a+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${a}/${U.processId}/${U.roomId}?${b.join("&")}`}getHttpEndpoint(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${U}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11919:(U,M,b)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.Connection=void 0;const a=b(11921);M.Connection=class{constructor(){this.events={},this.transport=new a.WebSocketTransport(this.events)}send(U){this.transport.send(U)}connect(U){this.transport.connect(U)}close(U,M){this.transport.close(U,M)}get isOpen(){return this.transport.isOpen}}},11930:(U,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.utf8Length=M.utf8Read=M.ErrorCode=M.Protocol=void 0,function(U){U[U.HANDSHAKE=9]="HANDSHAKE",U[U.JOIN_ROOM=10]="JOIN_ROOM",U[U.ERROR=11]="ERROR",U[U.LEAVE_ROOM=12]="LEAVE_ROOM",U[U.ROOM_DATA=13]="ROOM_DATA",U[U.ROOM_STATE=14]="ROOM_STATE",U[U.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",U[U.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",U[U.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(M.Protocol||(M.Protocol={})),function(U){U[U.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",U[U.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",U[U.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",U[U.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",U[U.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",U[U.AUTH_FAILED=4215]="AUTH_FAILED",U[U.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(M.ErrorCode||(M.ErrorCode={})),M.utf8Read=function(U,M){const b=U[M++];for(var a="",A=0,H=M,W=M+b;H<W;H++){var y=U[H];if(0!==(128&y))if(192!==(224&y))if(224!==(240&y)){if(240!==(248&y))throw new Error("Invalid byte "+y.toString(16));(A=(7&y)<<18|(63&U[++H])<<12|(63&U[++H])<<6|63&U[++H])>=65536?(A-=65536,a+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):a+=String.fromCharCode(A)}else a+=String.fromCharCode((15&y)<<12|(63&U[++H])<<6|63&U[++H]);else a+=String.fromCharCode((31&y)<<6|63&U[++H]);else a+=String.fromCharCode(y)}return a},M.utf8Length=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",M=0,b=0;for(let a=0,A=U.length;a<A;a++)M=U.charCodeAt(a),M<128?b+=1:M<2048?b+=2:M<55296||M>=57344?b+=3:(a++,b+=4);return b+1}},11905:function(U,M,b){"use strict";var a=this&&this.__createBinding||(Object.create?function(U,M,b,a){void 0===a&&(a=b);var A=Object.getOwnPropertyDescriptor(M,b);A&&!("get"in A?!M.__esModule:A.writable||A.configurable)||(A={enumerable:!0,get:function(){return M[b]}}),Object.defineProperty(U,a,A)}:function(U,M,b,a){void 0===a&&(a=b),U[a]=M[b]}),A=this&&this.__setModuleDefault||(Object.create?function(U,M){Object.defineProperty(U,"default",{enumerable:!0,value:M})}:function(U,M){U.default=M}),H=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var M={};if(null!=U)for(var b in U)"default"!==b&&Object.prototype.hasOwnProperty.call(U,b)&&a(M,U,b);return A(M,U),M};Object.defineProperty(M,"__esModule",{value:!0}),M.Room=void 0;const W=H(b(11910)),y=b(11919),O=b(11930),e=b(11932),x=b(11934),P=b(11941),Z=b(11944),C=b(11900);class r{constructor(U,M){this.onStateChange=(0,P.createSignal)(),this.onError=(0,P.createSignal)(),this.onLeave=(0,P.createSignal)(),this.onJoin=(0,P.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,x.createNanoEvents)(),this.roomId=null,this.name=U,M&&(this.serializer=new((0,e.getSerializer)("schema")),this.rootSchema=M,this.serializer.state=new M),this.onError(((U,M)=>{var b;return null===(b=console.warn)||void 0===b?void 0:b.call(console,`colyseus.js - onError => (${U}) ${M}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const a=new y.Connection;b.connection=a,a.events.onmessage=r.prototype.onMessageCallback.bind(b),a.events.onclose=function(U){var a;if(!b.hasJoined)return null===(a=console.warn)||void 0===a||a.call(console,`Room connection was closed unexpectedly (${U.code}): ${U.reason}`),void b.onError.invoke(U.code,U.reason);U.code===C.CloseCode.DEVMODE_RESTART&&M?M():(b.onLeave.invoke(U.code),b.destroy())},a.events.onerror=function(U){var M;null===(M=console.warn)||void 0===M||M.call(console,`Room, onError (${U.code}): ${U.reason}`),b.onError.invoke(U.code,U.reason)},a.connect(U)}leave(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((M=>{this.onLeave((U=>M(U))),this.connection?U?this.connection.send([O.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(C.CloseCode.CONSENTED)}))}onMessage(U,M){return this.onMessageHandlers.on(this.getMessageHandlerKey(U),M)}send(U,M){const b=[O.Protocol.ROOM_DATA];let a;if("string"===typeof U?Z.encode.string(b,U):Z.encode.number(b,U),void 0!==M){const U=W.encode(M);a=new Uint8Array(b.length+U.byteLength),a.set(new Uint8Array(b),0),a.set(new Uint8Array(U),b.length)}else a=new Uint8Array(b);this.connection.send(a.buffer)}sendBytes(U,M){const b=[O.Protocol.ROOM_DATA_BYTES];let a;"string"===typeof U?Z.encode.string(b,U):Z.encode.number(b,U),a=new Uint8Array(b.length+(M.byteLength||M.length)),a.set(new Uint8Array(b),0),a.set(new Uint8Array(M),b.length),this.connection.send(a.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(U){const M=Array.from(new Uint8Array(U.data)),b=M[0];if(b===O.Protocol.JOIN_ROOM){let U=1;const b=(0,O.utf8Read)(M,U);if(U+=(0,O.utf8Length)(b),this.serializerId=(0,O.utf8Read)(M,U),U+=(0,O.utf8Length)(this.serializerId),!this.serializer){const U=(0,e.getSerializer)(this.serializerId);this.serializer=new U}M.length>U&&this.serializer.handshake&&this.serializer.handshake(M,{offset:U}),this.reconnectionToken=`${this.roomId}:${b}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([O.Protocol.JOIN_ROOM])}else if(b===O.Protocol.ERROR){const U={offset:1},b=Z.decode.number(M,U),a=Z.decode.string(M,U);this.onError.invoke(b,a)}else if(b===O.Protocol.LEAVE_ROOM)this.leave();else if(b===O.Protocol.ROOM_DATA_SCHEMA){const U={offset:1},b=this.serializer.getState().constructor._context.get(Z.decode.number(M,U)),a=new b;a.decode(M,U),this.dispatchMessage(b,a)}else if(b===O.Protocol.ROOM_STATE)M.shift(),this.setState(M);else if(b===O.Protocol.ROOM_STATE_PATCH)M.shift(),this.patch(M);else if(b===O.Protocol.ROOM_DATA){const b={offset:1},a=Z.decode.stringCheck(M,b)?Z.decode.string(M,b):Z.decode.number(M,b),A=M.length>b.offset?W.decode(U.data,b.offset):void 0;this.dispatchMessage(a,A)}else if(b===O.Protocol.ROOM_DATA_BYTES){const U={offset:1},b=Z.decode.stringCheck(M,U)?Z.decode.string(M,U):Z.decode.number(M,U);this.dispatchMessage(b,new Uint8Array(M.slice(U.offset)))}}setState(U){this.serializer.setState(U),this.onStateChange.invoke(this.serializer.getState())}patch(U){this.serializer.patch(U),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(U,M){var b;const a=this.getMessageHandlerKey(U);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,M):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",U,M):null===(b=console.warn)||void 0===b||b.call(console,`colyseus.js: onMessage() not registered for type '${U}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(U){switch(typeof U){case"function":return`$${U._typeid}`;case"string":return U;case"number":return`i${U}`;default:throw new Error("invalid message type.")}}}M.Room=r},11955:(U,M)=>{"use strict";let b;function a(){return b||(b="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(U,M){this.cache[U]=M},getItem:function(U){this.cache[U]},removeItem:function(U){delete this.cache[U]}}),b}Object.defineProperty(M,"__esModule",{value:!0}),M.getItem=M.removeItem=M.setItem=void 0,M.setItem=function(U,M){a().setItem(U,M)},M.removeItem=function(U){a().removeItem(U)},M.getItem=function(U,M){const b=a().getItem(U);"undefined"!==typeof Promise&&b instanceof Promise?b.then((U=>M(U))):M(b)}},11934:(U,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.createNanoEvents=void 0;M.createNanoEvents=()=>({emit(U){let M=this.events[U]||[];for(var b=arguments.length,a=new Array(b>1?b-1:0),A=1;A<b;A++)a[A-1]=arguments[A];for(let H=0,W=M.length;H<W;H++)M[H](...a)},events:{},on(U,M){var b;return(null===(b=this.events[U])||void 0===b?void 0:b.push(M))||(this.events[U]=[M]),()=>{var b;this.events[U]=null===(b=this.events[U])||void 0===b?void 0:b.filter((U=>M!==U))}}})},11941:(U,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.createSignal=M.EventEmitter=void 0;class b{constructor(){this.handlers=[]}register(U){return this.handlers.push(U),this}invoke(){for(var U=arguments.length,M=new Array(U),b=0;b<U;b++)M[b]=arguments[b];this.handlers.forEach((U=>U.apply(this,M)))}invokeAsync(){for(var U=arguments.length,M=new Array(U),b=0;b<U;b++)M[b]=arguments[b];return Promise.all(this.handlers.map((U=>U.apply(this,M))))}remove(U){const M=this.handlers.indexOf(U);this.handlers[M]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}M.EventEmitter=b,M.createSignal=function(){const U=new b;function M(M){return U.register(M,null===this)}return M.once=M=>{const b=function(){for(var a=arguments.length,A=new Array(a),H=0;H<a;H++)A[H]=arguments[H];M.apply(this,A),U.remove(b)};U.register(b)},M.remove=M=>U.remove(M),M.invoke=function(){return U.invoke(...arguments)},M.invokeAsync=function(){return U.invokeAsync(...arguments)},M.clear=()=>U.clear(),M}},11900:(U,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.ServerError=M.CloseCode=void 0,function(U){U[U.CONSENTED=4e3]="CONSENTED",U[U.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(M.CloseCode||(M.CloseCode={}));class b extends Error{constructor(U,M){super(M),this.name="ServerError",this.code=U}}M.ServerError=b},11875:(U,M,b)=>{"use strict";M.e=void 0,b(11884);var a=b(11892);Object.defineProperty(M,"e",{enumerable:!0,get:function(){return a.Client}});var A=b(11930);var H=b(11905);var W=b(11952);const y=b(11963);const O=b(11965),e=b(11932);(0,e.registerSerializer)("schema",y.SchemaSerializer),(0,e.registerSerializer)("none",O.NoneSerializer)},11884:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=U=>null!==U&&"object"===typeof U&&U.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11910:(U,M)=>{"use strict";function b(U,M){if(this._offset=M,U instanceof ArrayBuffer)this._buffer=U,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(U))throw new Error("Invalid argument");this._buffer=U.buffer,this._view=new DataView(this._buffer,U.byteOffset,U.byteLength)}}Object.defineProperty(M,"__esModule",{value:!0}),M.decode=M.encode=void 0,b.prototype._array=function(U){for(var M=new Array(U),b=0;b<U;b++)M[b]=this._parse();return M},b.prototype._map=function(U){for(var M={},b=0;b<U;b++)M[this._parse()]=this._parse();return M},b.prototype._str=function(U){var M=function(U,M,b){for(var a="",A=0,H=M,W=M+b;H<W;H++){var y=U.getUint8(H);if(0!==(128&y))if(192!==(224&y))if(224!==(240&y)){if(240!==(248&y))throw new Error("Invalid byte "+y.toString(16));(A=(7&y)<<18|(63&U.getUint8(++H))<<12|(63&U.getUint8(++H))<<6|63&U.getUint8(++H))>=65536?(A-=65536,a+=String.fromCharCode(55296+(A>>>10),56320+(1023&A))):a+=String.fromCharCode(A)}else a+=String.fromCharCode((15&y)<<12|(63&U.getUint8(++H))<<6|63&U.getUint8(++H));else a+=String.fromCharCode((31&y)<<6|63&U.getUint8(++H));else a+=String.fromCharCode(y)}return a}(this._view,this._offset,U);return this._offset+=U,M},b.prototype._bin=function(U){var M=this._buffer.slice(this._offset,this._offset+U);return this._offset+=U,M},b.prototype._parse=function(){var U,M=this._view.getUint8(this._offset++),b=0,a=0,A=0,H=0;if(M<192)return M<128?M:M<144?this._map(15&M):M<160?this._array(15&M):this._str(31&M);if(M>223)return-1*(255-M+1);switch(M){case 192:return null;case 194:return!1;case 195:return!0;case 196:return b=this._view.getUint8(this._offset),this._offset+=1,this._bin(b);case 197:return b=this._view.getUint16(this._offset),this._offset+=2,this._bin(b);case 198:return b=this._view.getUint32(this._offset),this._offset+=4,this._bin(b);case 199:if(b=this._view.getUint8(this._offset),a=this._view.getInt8(this._offset+1),this._offset+=2,-1===a){var W=this._view.getUint32(this._offset);return A=this._view.getInt32(this._offset+4),H=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*A+H)+W/1e6)}return[a,this._bin(b)];case 200:return b=this._view.getUint16(this._offset),a=this._view.getInt8(this._offset+2),this._offset+=3,[a,this._bin(b)];case 201:return b=this._view.getUint32(this._offset),a=this._view.getInt8(this._offset+4),this._offset+=5,[a,this._bin(b)];case 202:return U=this._view.getFloat32(this._offset),this._offset+=4,U;case 203:return U=this._view.getFloat64(this._offset),this._offset+=8,U;case 204:return U=this._view.getUint8(this._offset),this._offset+=1,U;case 205:return U=this._view.getUint16(this._offset),this._offset+=2,U;case 206:return U=this._view.getUint32(this._offset),this._offset+=4,U;case 207:return A=this._view.getUint32(this._offset)*Math.pow(2,32),H=this._view.getUint32(this._offset+4),this._offset+=8,A+H;case 208:return U=this._view.getInt8(this._offset),this._offset+=1,U;case 209:return U=this._view.getInt16(this._offset),this._offset+=2,U;case 210:return U=this._view.getInt32(this._offset),this._offset+=4,U;case 211:return A=this._view.getInt32(this._offset)*Math.pow(2,32),H=this._view.getUint32(this._offset+4),this._offset+=8,A+H;case 212:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?void(this._offset+=1):[a,this._bin(1)];case 213:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(2)];case 214:return a=this._view.getInt8(this._offset),this._offset+=1,-1===a?(U=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*U)):[a,this._bin(4)];case 215:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?(A=this._view.getInt32(this._offset)*Math.pow(2,32),H=this._view.getUint32(this._offset+4),this._offset+=8,new Date(A+H)):-1===a?(A=this._view.getUint32(this._offset),H=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&A)+H)+(A>>>2)/1e6)):[a,this._bin(8)];case 216:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(16)];case 217:return b=this._view.getUint8(this._offset),this._offset+=1,this._str(b);case 218:return b=this._view.getUint16(this._offset),this._offset+=2,this._str(b);case 219:return b=this._view.getUint32(this._offset),this._offset+=4,this._str(b);case 220:return b=this._view.getUint16(this._offset),this._offset+=2,this._array(b);case 221:return b=this._view.getUint32(this._offset),this._offset+=4,this._array(b);case 222:return b=this._view.getUint16(this._offset),this._offset+=2,this._map(b);case 223:return b=this._view.getUint32(this._offset),this._offset+=4,this._map(b)}throw new Error("Could not parse")},M.decode=function(U){var M=new b(U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),a=M._parse();if(M._offset!==U.byteLength)throw new Error(U.byteLength-M._offset+" trailing bytes");return a};function a(U,M,b){for(var a=0,A=0,H=b.length;A<H;A++)(a=b.charCodeAt(A))<128?U.setUint8(M++,a):a<2048?(U.setUint8(M++,192|a>>6),U.setUint8(M++,128|63&a)):a<55296||a>=57344?(U.setUint8(M++,224|a>>12),U.setUint8(M++,128|a>>6&63),U.setUint8(M++,128|63&a)):(A++,a=65536+((1023&a)<<10|1023&b.charCodeAt(A)),U.setUint8(M++,240|a>>18),U.setUint8(M++,128|a>>12&63),U.setUint8(M++,128|a>>6&63),U.setUint8(M++,128|63&a))}function A(U,M,b){var a=typeof b,H=0,W=0,y=0,O=0,e=0,x=0;if("string"===a){if(e=function(U){for(var M=0,b=0,a=0,A=U.length;a<A;a++)(M=U.charCodeAt(a))<128?b+=1:M<2048?b+=2:M<55296||M>=57344?b+=3:(a++,b+=4);return b}(b),e<32)U.push(160|e),x=1;else if(e<256)U.push(217,e),x=2;else if(e<65536)U.push(218,e>>8,e),x=3;else{if(!(e<4294967296))throw new Error("String too long");U.push(219,e>>24,e>>16,e>>8,e),x=5}return M.push({_str:b,_length:e,_offset:U.length}),x+e}if("number"===a)return Math.floor(b)===b&&isFinite(b)?b>=0?b<128?(U.push(b),1):b<256?(U.push(204,b),2):b<65536?(U.push(205,b>>8,b),3):b<4294967296?(U.push(206,b>>24,b>>16,b>>8,b),5):(y=b/Math.pow(2,32)|0,O=b>>>0,U.push(207,y>>24,y>>16,y>>8,y,O>>24,O>>16,O>>8,O),9):b>=-32?(U.push(b),1):b>=-128?(U.push(208,b),2):b>=-32768?(U.push(209,b>>8,b),3):b>=-2147483648?(U.push(210,b>>24,b>>16,b>>8,b),5):(y=Math.floor(b/Math.pow(2,32)),O=b>>>0,U.push(211,y>>24,y>>16,y>>8,y,O>>24,O>>16,O>>8,O),9):(U.push(203),M.push({_float:b,_length:8,_offset:U.length}),9);if("object"===a){if(null===b)return U.push(192),1;if(Array.isArray(b)){if((e=b.length)<16)U.push(144|e),x=1;else if(e<65536)U.push(220,e>>8,e),x=3;else{if(!(e<4294967296))throw new Error("Array too large");U.push(221,e>>24,e>>16,e>>8,e),x=5}for(H=0;H<e;H++)x+=A(U,M,b[H]);return x}if(b instanceof Date){var P=b.getTime(),Z=Math.floor(P/1e3),C=1e6*(P-1e3*Z);return Z>=0&&C>=0&&Z<=17179869183?0===C&&Z<=4294967295?(U.push(214,255,Z>>24,Z>>16,Z>>8,Z),6):(y=Z/4294967296,O=4294967295&Z,U.push(215,255,C>>22,C>>14,C>>6,y,O>>24,O>>16,O>>8,O),10):(y=Math.floor(Z/4294967296),O=Z>>>0,U.push(199,12,255,C>>24,C>>16,C>>8,C,y>>24,y>>16,y>>8,y,O>>24,O>>16,O>>8,O),15)}if(b instanceof ArrayBuffer){if((e=b.byteLength)<256)U.push(196,e),x=2;else if(e<65536)U.push(197,e>>8,e),x=3;else{if(!(e<4294967296))throw new Error("Buffer too large");U.push(198,e>>24,e>>16,e>>8,e),x=5}return M.push({_bin:b,_length:e,_offset:U.length}),x+e}if("function"===typeof b.toJSON)return A(U,M,b.toJSON());var r=[],B="",J=Object.keys(b);for(H=0,W=J.length;H<W;H++)void 0!==b[B=J[H]]&&"function"!==typeof b[B]&&r.push(B);if((e=r.length)<16)U.push(128|e),x=1;else if(e<65536)U.push(222,e>>8,e),x=3;else{if(!(e<4294967296))throw new Error("Object too large");U.push(223,e>>24,e>>16,e>>8,e),x=5}for(H=0;H<e;H++)x+=A(U,M,B=r[H]),x+=A(U,M,b[B]);return x}if("boolean"===a)return U.push(b?195:194),1;if("undefined"===a)return U.push(192),1;if("function"===typeof b.toJSON)return A(U,M,b.toJSON());throw new Error("Could not encode")}M.encode=function(U){var M=[],b=[],H=A(M,b,U),W=new ArrayBuffer(H),y=new DataView(W),O=0,e=0,x=-1;b.length>0&&(x=b[0]._offset);for(var P,Z=0,C=0,r=0,B=M.length;r<B;r++)if(y.setUint8(e+r,M[r]),r+1===x){if(Z=(P=b[O])._length,C=e+x,P._bin)for(var J=new Uint8Array(P._bin),F=0;F<Z;F++)y.setUint8(C+F,J[F]);else P._str?a(y,C,P._str):void 0!==P._float&&y.setFloat64(C,P._float);e+=Z,b[++O]&&(x=b[O]._offset)}return W}},11965:(U,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.NoneSerializer=void 0;M.NoneSerializer=class{setState(U){}getState(){return null}patch(U){}teardown(){}handshake(U){}}},11963:(U,M,b)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.SchemaSerializer=void 0;const a=b(11944);M.SchemaSerializer=class{setState(U){return this.state.decode(U)}getState(){return this.state}patch(U){return this.state.decode(U)}teardown(){var U,M;null===(M=null===(U=this.state)||void 0===U?void 0:U.$changes)||void 0===M||M.root.clearRefs()}handshake(U,M){if(this.state){(new a.Reflection).decode(U,M)}else this.state=a.Reflection.decode(U,M)}}},11932:(U,M)=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0}),M.getSerializer=M.registerSerializer=void 0;const b={};M.registerSerializer=function(U,M){b[U]=M},M.getSerializer=function(U){const M=b[U];if(!M)throw new Error("missing serializer: "+U);return M}},11921:function(U,M,b){"use strict";var a=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(M,"__esModule",{value:!0}),M.WebSocketTransport=void 0;const A=a(b(11928)),H=globalThis.WebSocket||A.default;M.WebSocketTransport=class{constructor(U){this.events=U}send(U){U instanceof ArrayBuffer?this.ws.send(U):Array.isArray(U)&&this.ws.send(new Uint8Array(U).buffer)}connect(U){this.ws=new H(U,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(U,M){this.ws.close(U,M)}get isOpen(){return this.ws.readyState===H.OPEN}}},11928:U=>{"use strict";U.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12074:U=>{"use strict";U.exports=function(U){for(var M=new Array(U),b=0;b<U;++b)M[b]=b;return M}},12076:U=>{function M(U){return!!U.constructor&&"function"===typeof U.constructor.isBuffer&&U.constructor.isBuffer(U)}U.exports=function(U){return null!=U&&(M(U)||function(U){return"function"===typeof U.readFloatLE&&"function"===typeof U.slice&&M(U.slice(0,0))}(U)||!!U._isBuffer)}},12072:(U,M,b)=>{var a=b(12074),A=b(12076),H="undefined"!==typeof Float64Array;function W(U,M){return U[0]-M[0]}function y(){var U,M=this.stride,b=new Array(M.length);for(U=0;U<b.length;++U)b[U]=[Math.abs(M[U]),U];b.sort(W);var a=new Array(b.length);for(U=0;U<a.length;++U)a[U]=b[U][1];return a}function O(U,M){var b=["View",M,"d",U].join("");M<0&&(b="View_Nil"+U);var A="generic"===U;if(-1===M){var H="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+U+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(H)()}if(0===M){H="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+U+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(A?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(A?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",H)(e[U][0])}H=["'use strict'"];var W=a(M),O=W.map((function(U){return"i"+U})),x="this.offset+"+W.map((function(U){return"this.stride["+U+"]*i"+U})).join("+"),P=W.map((function(U){return"b"+U})).join(","),Z=W.map((function(U){return"c"+U})).join(",");H.push("function "+b+"(a,"+P+","+Z+",d){this.data=a","this.shape=["+P+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+U+"'","proto.dimension="+M),H.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+W.map((function(U){return"this.shape["+U+"]"})).join("*"),"}})"),1===M?H.push("proto.order=[0]"):(H.push("Object.defineProperty(proto,'order',{get:"),M<4?(H.push("function "+b+"_order(){"),2===M?H.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===M&&H.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):H.push("ORDER})")),H.push("proto.set=function "+b+"_set("+O.join(",")+",v){"),A?H.push("return this.data.set("+x+",v)}"):H.push("return this.data["+x+"]=v}"),H.push("proto.get=function "+b+"_get("+O.join(",")+"){"),A?H.push("return this.data.get("+x+")}"):H.push("return this.data["+x+"]}"),H.push("proto.index=function "+b+"_index(",O.join(),"){return "+x+"}"),H.push("proto.hi=function "+b+"_hi("+O.join(",")+"){return new "+b+"(this.data,"+W.map((function(U){return["(typeof i",U,"!=='number'||i",U,"<0)?this.shape[",U,"]:i",U,"|0"].join("")})).join(",")+","+W.map((function(U){return"this.stride["+U+"]"})).join(",")+",this.offset)}");var C=W.map((function(U){return"a"+U+"=this.shape["+U+"]"})),r=W.map((function(U){return"c"+U+"=this.stride["+U+"]"}));H.push("proto.lo=function "+b+"_lo("+O.join(",")+"){var b=this.offset,d=0,"+C.join(",")+","+r.join(","));for(var B=0;B<M;++B)H.push("if(typeof i"+B+"==='number'&&i"+B+">=0){d=i"+B+"|0;b+=c"+B+"*d;a"+B+"-=d}");H.push("return new "+b+"(this.data,"+W.map((function(U){return"a"+U})).join(",")+","+W.map((function(U){return"c"+U})).join(",")+",b)}"),H.push("proto.step=function "+b+"_step("+O.join(",")+"){var "+W.map((function(U){return"a"+U+"=this.shape["+U+"]"})).join(",")+","+W.map((function(U){return"b"+U+"=this.stride["+U+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(B=0;B<M;++B)H.push("if(typeof i"+B+"==='number'){d=i"+B+"|0;if(d<0){c+=b"+B+"*(a"+B+"-1);a"+B+"=ceil(-a"+B+"/d)}else{a"+B+"=ceil(a"+B+"/d)}b"+B+"*=d}");H.push("return new "+b+"(this.data,"+W.map((function(U){return"a"+U})).join(",")+","+W.map((function(U){return"b"+U})).join(",")+",c)}");var J=new Array(M),F=new Array(M);for(B=0;B<M;++B)J[B]="a[i"+B+"]",F[B]="b[i"+B+"]";H.push("proto.transpose=function "+b+"_transpose("+O+"){"+O.map((function(U,M){return U+"=("+U+"===undefined?"+M+":"+U+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+J.join(",")+","+F.join(",")+",this.offset)}"),H.push("proto.pick=function "+b+"_pick("+O+"){var a=[],b=[],c=this.offset");for(B=0;B<M;++B)H.push("if(typeof i"+B+"==='number'&&i"+B+">=0){c=(c+this.stride["+B+"]*i"+B+")|0}else{a.push(this.shape["+B+"]);b.push(this.stride["+B+"])}");return H.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),H.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+W.map((function(U){return"shape["+U+"]"})).join(",")+","+W.map((function(U){return"stride["+U+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",H.join("\n"))(e[U],y)}var e={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};U.exports=function(U,M,b,a){if(void 0===U)return(0,e.array[0])([]);"number"===typeof U&&(U=[U]),void 0===M&&(M=[U.length]);var W=M.length;if(void 0===b){b=new Array(W);for(var y=W-1,x=1;y>=0;--y)b[y]=x,x*=M[y]}if(void 0===a){a=0;for(y=0;y<W;++y)b[y]<0&&(a-=(M[y]-1)*b[y])}for(var P=function(U){if(A(U))return"buffer";if(H)switch(Object.prototype.toString.call(U)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(U)?"array":"generic"}(U),Z=e[P];Z.length<=W+1;)Z.push(O(P,Z.length-1));return(0,Z[W+1])(U,M,b,a)}},12963:U=>{var M;self,M=()=>(()=>{"use strict";var U={d:(M,b)=>{for(var a in b)U.o(b,a)&&!U.o(M,a)&&Object.defineProperty(M,a,{enumerable:!0,get:b[a]})},o:(U,M)=>Object.prototype.hasOwnProperty.call(U,M)},M={};U.d(M,{default:()=>X});var b,a=function(U,M){var b=M.x-U.x,a=M.y-U.y;return Math.sqrt(b*b+a*a)},A=function(U){return U*(Math.PI/180)},H=new Map,W=function(U){H.has(U)&&clearTimeout(H.get(U)),H.set(U,setTimeout(U,100))},y=function(U,M,b){for(var a,A=M.split(/[ ,]+/g),H=0;H<A.length;H+=1)a=A[H],U.addEventListener?U.addEventListener(a,b,!1):U.attachEvent&&U.attachEvent(a,b)},O=function(U,M,b){for(var a,A=M.split(/[ ,]+/g),H=0;H<A.length;H+=1)a=A[H],U.removeEventListener?U.removeEventListener(a,b):U.detachEvent&&U.detachEvent(a,b)},e=function(U){return U.preventDefault(),U.type.match(/^touch/)?U.changedTouches:U},x=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},P=function(U,M){M.top||M.right||M.bottom||M.left?(U.style.top=M.top,U.style.right=M.right,U.style.bottom=M.bottom,U.style.left=M.left):(U.style.left=M.x+"px",U.style.top=M.y+"px")},Z=function(U,M,b){var a=C(U);for(var A in a)if(a.hasOwnProperty(A))if("string"==typeof M)a[A]=M+" "+b;else{for(var H="",W=0,y=M.length;W<y;W+=1)H+=M[W]+" "+b+", ";a[A]=H.slice(0,-2)}return a},C=function(U){var M={};return M[U]="",["webkit","Moz","o"].forEach((function(b){M[b+U.charAt(0).toUpperCase()+U.slice(1)]=""})),M},r=function(U,M){for(var b in M)M.hasOwnProperty(b)&&(U[b]=M[b]);return U},B=function(U,M){if(U.length)for(var b=0,a=U.length;b<a;b+=1)M(U[b]);else M(U)},J="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,F=window.matchMedia("(any-hover: none)").matches,f=!!("ontouchstart"in window),L=!!window.PointerEvent,z=!!window.MSPointerEvent,o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},S={start:"mousedown",move:"mousemove",end:"mouseup"},h={};function i(){}J&&!F?b=o:L?b={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:z?b={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:f?(b=o,h=S):b=S,i.prototype.on=function(U,M){var b,a=this,A=U.split(/[ ,]+/g);a._handlers_=a._handlers_||{};for(var H=0;H<A.length;H+=1)b=A[H],a._handlers_[b]=a._handlers_[b]||[],a._handlers_[b].push(M);return a},i.prototype.off=function(U,M){var b=this;return b._handlers_=b._handlers_||{},void 0===U?b._handlers_={}:void 0===M?b._handlers_[U]=null:b._handlers_[U]&&b._handlers_[U].indexOf(M)>=0&&b._handlers_[U].splice(b._handlers_[U].indexOf(M),1),b},i.prototype.trigger=function(U,M){var b,a=this,A=U.split(/[ ,]+/g);a._handlers_=a._handlers_||{};for(var H=0;H<A.length;H+=1)b=A[H],a._handlers_[b]&&a._handlers_[b].length&&a._handlers_[b].forEach((function(U){U.call(a,{type:b,target:a},M)}))},i.prototype.config=function(U){var M=this;M.options=M.defaults||{},U&&(M.options=function(U,M){var b={};for(var a in U)U.hasOwnProperty(a)&&M.hasOwnProperty(a)?b[a]=M[a]:U.hasOwnProperty(a)&&(b[a]=U[a]);return b}(M.options,U))},i.prototype.bindEvt=function(U,M){var a=this;return a._domHandlers_=a._domHandlers_||{},a._domHandlers_[M]=function(){"function"==typeof a["on"+M]?a["on"+M].apply(a,arguments):console.warn('[WARNING] : Missing "on'+M+'" handler.')},y(U,b[M],a._domHandlers_[M]),h[M]&&y(U,h[M],a._domHandlers_[M]),a},i.prototype.unbindEvt=function(U,M){var a=this;return a._domHandlers_=a._domHandlers_||{},O(U,b[M],a._domHandlers_[M]),h[M]&&O(U,h[M],a._domHandlers_[M]),delete a._domHandlers_[M],this};const Y=i;function d(U,M){return this.identifier=M.identifier,this.position=M.position,this.frontPosition=M.frontPosition,this.collection=U,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(M),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=d.id,d.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}d.prototype=new Y,d.constructor=d,d.id=0,d.prototype.buildEl=function(U){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},d.prototype.stylize=function(){if(this.options.dataOnly)return this;var U=this.options.fadeTime+"ms",M=function(){var U=C("borderRadius");for(var M in U)U.hasOwnProperty(M)&&(U[M]="50%");return U}(),b=Z("transition","opacity",U),a={};return a.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},a.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},a.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},r(a.el,b),"circle"===this.options.shape&&r(a.back,M),r(a.front,M),this.applyStyles(a),this},d.prototype.applyStyles=function(U){for(var M in this.ui)if(this.ui.hasOwnProperty(M))for(var b in U[M])this.ui[M].style[b]=U[M][b];return this},d.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},d.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},d.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},d.prototype.show=function(U){var M=this;return M.options.dataOnly||(clearTimeout(M.removeTimeout),clearTimeout(M.showTimeout),clearTimeout(M.restTimeout),M.addToDom(),M.restCallback(),setTimeout((function(){M.ui.el.style.opacity=1}),0),M.showTimeout=setTimeout((function(){M.trigger("shown",M.instance),"function"==typeof U&&U.call(this)}),M.options.fadeTime)),M},d.prototype.hide=function(U){var M=this;if(M.options.dataOnly)return M;if(M.ui.el.style.opacity=M.options.restOpacity,clearTimeout(M.removeTimeout),clearTimeout(M.showTimeout),clearTimeout(M.restTimeout),M.removeTimeout=setTimeout((function(){var b="dynamic"===M.options.mode?"none":"block";M.ui.el.style.display=b,"function"==typeof U&&U.call(M),M.trigger("hidden",M.instance)}),M.options.fadeTime),M.options.restJoystick){var b=M.options.restJoystick,a={};a.x=!0===b||!1!==b.x?0:M.instance.frontPosition.x,a.y=!0===b||!1!==b.y?0:M.instance.frontPosition.y,M.setPosition(U,a)}return M},d.prototype.setPosition=function(U,M){var b=this;b.frontPosition={x:M.x,y:M.y};var a=b.options.fadeTime+"ms",A={};A.front=Z("transition",["transform"],a);var H={front:{}};H.front={transform:"translate("+b.frontPosition.x+"px,"+b.frontPosition.y+"px)"},b.applyStyles(A),b.applyStyles(H),b.restTimeout=setTimeout((function(){"function"==typeof U&&U.call(b),b.restCallback()}),b.options.fadeTime)},d.prototype.restCallback=function(){var U=this,M={};M.front=Z("transition","none",""),U.applyStyles(M),U.trigger("rested",U.instance)},d.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},d.prototype.computeDirection=function(U){var M,b,a,A=U.angle.radian,H=Math.PI/4,W=Math.PI/2;if(A>H&&A<3*H&&!U.lockX?M="up":A>-H&&A<=H&&!U.lockY?M="left":A>3*-H&&A<=-H&&!U.lockX?M="down":U.lockY||(M="right"),U.lockY||(b=A>-W&&A<W?"left":"right"),U.lockX||(a=A>0?"up":"down"),U.force>this.options.threshold){var y,O={};for(y in this.direction)this.direction.hasOwnProperty(y)&&(O[y]=this.direction[y]);var e={};for(y in this.direction={x:b,y:a,angle:M},U.direction=this.direction,O)O[y]===this.direction[y]&&(e[y]=!0);if(e.x&&e.y&&e.angle)return U;e.x&&e.y||this.trigger("plain",U),e.x||this.trigger("plain:"+b,U),e.y||this.trigger("plain:"+a,U),e.angle||this.trigger("dir dir:"+M,U)}else this.resetDirection();return U};const s=d;function q(U,M){var b=this;b.nipples=[],b.idles=[],b.actives=[],b.ids=[],b.pressureIntervals={},b.manager=U,b.id=q.id,q.id+=1,b.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},b.config(M),"static"!==b.options.mode&&"semi"!==b.options.mode||(b.options.multitouch=!1),b.options.multitouch||(b.options.maxNumberOfNipples=1);var a=getComputedStyle(b.options.zone.parentElement);return a&&"flex"===a.display&&(b.parentIsFlex=!0),b.updateBox(),b.prepareNipples(),b.am(),b.begin(),b.nipples}q.prototype=new Y,q.constructor=q,q.id=0,q.prototype.prepareNipples=function(){var U=this,M=U.nipples;M.on=U.on.bind(U),M.off=U.off.bind(U),M.options=U.options,M.destroy=U.destroy.bind(U),M.ids=U.ids,M.id=U.id,M.processOnMove=U.processOnMove.bind(U),M.processOnEnd=U.processOnEnd.bind(U),M.get=function(U){if(void 0===U)return M[0];for(var b=0,a=M.length;b<a;b+=1)if(M[b].identifier===U)return M[b];return!1}},q.prototype.am=function(){var U=this;U.bindEvt(U.options.zone,"start"),U.options.zone.style.touchAction="none",U.options.zone.style.msTouchAction="none"},q.prototype.begin=function(){var U=this,M=U.options;if("static"===M.mode){var b=U.createNipple(M.position,U.manager.getIdentifier());b.add(),U.idles.push(b)}},q.prototype.createNipple=function(U,M){var b=this,a=b.manager.scroll,A={},H=b.options,W=b.parentIsFlex?a.x:a.x+b.box.left,y=b.parentIsFlex?a.y:a.y+b.box.top;if(U.x&&U.y)A={x:U.x-W,y:U.y-y};else if(U.top||U.right||U.bottom||U.left){var O=document.createElement("DIV");O.style.display="hidden",O.style.top=U.top,O.style.right=U.right,O.style.bottom=U.bottom,O.style.left=U.left,O.style.position="absolute",H.zone.appendChild(O);var e=O.getBoundingClientRect();H.zone.removeChild(O),A=U,U={x:e.left+a.x,y:e.top+a.y}}var x=new s(b,{color:H.color,size:H.size,threshold:H.threshold,fadeTime:H.fadeTime,dataOnly:H.dataOnly,restJoystick:H.restJoystick,restOpacity:H.restOpacity,mode:H.mode,identifier:M,position:U,zone:H.zone,frontPosition:{x:0,y:0},shape:H.shape});return H.dataOnly||(P(x.ui.el,A),P(x.ui.front,x.frontPosition)),b.nipples.push(x),b.trigger("added "+x.identifier+":added",x),b.manager.trigger("added "+x.identifier+":added",x),b.bindNipple(x),x},q.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},q.prototype.bindNipple=function(U){var M,b=this,a=function(U,a){M=U.type+" "+a.id+":"+U.type,b.trigger(M,a)};U.on("destroyed",b.onDestroyed.bind(b)),U.on("shown hidden rested dir plain",a),U.on("dir:up dir:right dir:down dir:left",a),U.on("plain:up plain:right plain:down plain:left",a)},q.prototype.pressureFn=function(U,M,b){var a=this,A=0;clearInterval(a.pressureIntervals[b]),a.pressureIntervals[b]=setInterval(function(){var b=U.force||U.pressure||U.webkitForce||0;b!==A&&(M.trigger("pressure",b),a.trigger("pressure "+M.identifier+":pressure",b),A=b)}.bind(a),100)},q.prototype.onstart=function(U){var M=this,b=M.options,a=U;return U=e(U),M.updateBox(),B(U,(function(A){M.actives.length<b.maxNumberOfNipples?M.processOnStart(A):a.type.match(/^touch/)&&(Object.keys(M.manager.ids).forEach((function(b){if(Object.values(a.touches).findIndex((function(U){return U.identifier===b}))<0){var A=[U[0]];A.identifier=b,M.processOnEnd(A)}})),M.actives.length<b.maxNumberOfNipples&&M.processOnStart(A))})),M.manager.bindDocument(),!1},q.prototype.processOnStart=function(U){var M,b=this,A=b.options,H=b.manager.getIdentifier(U),W=U.force||U.pressure||U.webkitForce||0,y={x:U.pageX,y:U.pageY},O=b.getOrCreate(H,y);O.identifier!==H&&b.manager.removeIdentifier(O.identifier),O.identifier=H;var e=function(M){M.trigger("start",M),b.trigger("start "+M.id+":start",M),M.show(),W>0&&b.pressureFn(U,M,M.identifier),b.processOnMove(U)};if((M=b.idles.indexOf(O))>=0&&b.idles.splice(M,1),b.actives.push(O),b.ids.push(O.identifier),"semi"!==A.mode)e(O);else{if(!(a(y,O.position)<=A.catchDistance))return O.destroy(),void b.processOnStart(U);e(O)}return O},q.prototype.getOrCreate=function(U,M){var b,a=this,A=a.options;return/(semi|static)/.test(A.mode)?(b=a.idles[0])?(a.idles.splice(0,1),b):"semi"===A.mode?a.createNipple(M,U):(console.warn("Coudln't find the needed nipple."),!1):b=a.createNipple(M,U)},q.prototype.processOnMove=function(U){var M=this,b=M.options,H=M.manager.getIdentifier(U),W=M.nipples.get(H),y=M.manager.scroll;if(function(U){return isNaN(U.buttons)?0!==U.pressure:0!==U.buttons}(U)){if(!W)return console.error("Found zombie joystick with ID "+H),void M.manager.removeIdentifier(H);if(b.dynamicPage){var O=W.el.getBoundingClientRect();W.position={x:y.x+O.left,y:y.y+O.top}}W.identifier=H;var e=W.options.size/2,x={x:U.pageX,y:U.pageY};b.lockX&&(x.y=W.position.y),b.lockY&&(x.x=W.position.x);var P,Z,C,r,B,J,F,f,L,z,o=a(x,W.position),S=(P=x,C=(Z=W.position).x-P.x,r=Z.y-P.y,function(U){return U*(180/Math.PI)}(Math.atan2(r,C))),h=A(S),i=o/e,Y={distance:o,position:x};if("circle"===W.options.shape?(B=Math.min(o,e),F=W.position,f=B,z={x:0,y:0},L=A(L=S),z.x=F.x-f*Math.cos(L),z.y=F.y-f*Math.sin(L),J=z):(J=function(U,M,b){return{x:Math.min(Math.max(U.x,M.x-b),M.x+b),y:Math.min(Math.max(U.y,M.y-b),M.y+b)}}(x,W.position,e),B=a(J,W.position)),b.follow){if(o>e){var d=x.x-J.x,s=x.y-J.y;W.position.x+=d,W.position.y+=s,W.el.style.top=W.position.y-(M.box.top+y.y)+"px",W.el.style.left=W.position.x-(M.box.left+y.x)+"px",o=a(x,W.position)}}else x=J,o=B;var q=x.x-W.position.x,m=x.y-W.position.y;W.frontPosition={x:q,y:m},b.dataOnly||(W.ui.front.style.transform="translate("+q+"px,"+m+"px)");var n={identifier:W.identifier,position:x,force:i,pressure:U.force||U.pressure||U.webkitForce||0,distance:o,angle:{radian:h,degree:S},vector:{x:q/e,y:-m/e},raw:Y,instance:W,lockX:b.lockX,lockY:b.lockY};(n=W.computeDirection(n)).angle={radian:A(180-S),degree:180-S},W.trigger("move",n),M.trigger("move "+W.id+":move",n)}else this.processOnEnd(U)},q.prototype.processOnEnd=function(U){var M=this,b=M.options,a=M.manager.getIdentifier(U),A=M.nipples.get(a),H=M.manager.removeIdentifier(A.identifier);A&&(b.dataOnly||A.hide((function(){"dynamic"===b.mode&&(A.trigger("removed",A),M.trigger("removed "+A.id+":removed",A),M.manager.trigger("removed "+A.id+":removed",A),A.destroy())})),clearInterval(M.pressureIntervals[A.identifier]),A.resetDirection(),A.trigger("end",A),M.trigger("end "+A.id+":end",A),M.ids.indexOf(A.identifier)>=0&&M.ids.splice(M.ids.indexOf(A.identifier),1),M.actives.indexOf(A)>=0&&M.actives.splice(M.actives.indexOf(A),1),/(semi|static)/.test(b.mode)?M.idles.push(A):M.nipples.indexOf(A)>=0&&M.nipples.splice(M.nipples.indexOf(A),1),M.manager.unbindDocument(),/(semi|static)/.test(b.mode)&&(M.manager.ids[H.id]=H.identifier))},q.prototype.onDestroyed=function(U,M){var b=this;b.nipples.indexOf(M)>=0&&b.nipples.splice(b.nipples.indexOf(M),1),b.actives.indexOf(M)>=0&&b.actives.splice(b.actives.indexOf(M),1),b.idles.indexOf(M)>=0&&b.idles.splice(b.idles.indexOf(M),1),b.ids.indexOf(M.identifier)>=0&&b.ids.splice(b.ids.indexOf(M.identifier),1),b.manager.removeIdentifier(M.identifier),b.manager.unbindDocument()},q.prototype.destroy=function(){var U=this;for(var M in U.unbindEvt(U.options.zone,"start"),U.nipples.forEach((function(U){U.destroy()})),U.pressureIntervals)U.pressureIntervals.hasOwnProperty(M)&&clearInterval(U.pressureIntervals[M]);U.trigger("destroyed",U.nipples),U.manager.unbindDocument(),U.off()};const m=q;function n(U){var M=this;M.ids={},M.index=0,M.collections=[],M.scroll=x(),M.config(U),M.prepareCollections();var b=function(){var U;M.collections.forEach((function(b){b.forEach((function(b){U=b.el.getBoundingClientRect(),b.position={x:M.scroll.x+U.left,y:M.scroll.y+U.top}}))}))};y(window,"resize",(function(){W(b)}));var a=function(){M.scroll=x()};return y(window,"scroll",(function(){W(a)})),M.collections}n.prototype=new Y,n.constructor=n,n.prototype.prepareCollections=function(){var U=this;U.collections.create=U.create.bind(U),U.collections.on=U.on.bind(U),U.collections.off=U.off.bind(U),U.collections.destroy=U.destroy.bind(U),U.collections.get=function(M){var b;return U.collections.every((function(U){return!(b=U.get(M))})),b}},n.prototype.create=function(U){return this.createCollection(U)},n.prototype.createCollection=function(U){var M=this,b=new m(M,U);return M.bindCollection(b),M.collections.push(b),b},n.prototype.bindCollection=function(U){var M,b=this,a=function(U,a){M=U.type+" "+a.id+":"+U.type,b.trigger(M,a)};U.on("destroyed",b.onDestroyed.bind(b)),U.on("shown hidden rested dir plain",a),U.on("dir:up dir:right dir:down dir:left",a),U.on("plain:up plain:right plain:down plain:left",a)},n.prototype.bindDocument=function(){var U=this;U.binded||(U.bindEvt(document,"move").bindEvt(document,"end"),U.binded=!0)},n.prototype.unbindDocument=function(U){var M=this;Object.keys(M.ids).length&&!0!==U||(M.unbindEvt(document,"move").unbindEvt(document,"end"),M.binded=!1)},n.prototype.getIdentifier=function(U){var M;return U?void 0===(M=void 0===U.identifier?U.pointerId:U.identifier)&&(M=this.latest||0):M=this.index,void 0===this.ids[M]&&(this.ids[M]=this.index,this.index+=1),this.latest=M,this.ids[M]},n.prototype.removeIdentifier=function(U){var M={};for(var b in this.ids)if(this.ids[b]===U){M.id=b,M.identifier=this.ids[b],delete this.ids[b];break}return M},n.prototype.onmove=function(U){return this.onAny("move",U),!1},n.prototype.onend=function(U){return this.onAny("end",U),!1},n.prototype.oncancel=function(U){return this.onAny("end",U),!1},n.prototype.onAny=function(U,M){var b,a=this,A="processOn"+U.charAt(0).toUpperCase()+U.slice(1);M=e(M);var H=function(U,M,b){b.ids.indexOf(M)>=0&&(b[A](U),U._found_=!0)};return B(M,(function(U){b=a.getIdentifier(U),B(a.collections,H.bind(null,U,b)),U._found_||a.removeIdentifier(b)})),!1},n.prototype.destroy=function(){var U=this;U.unbindDocument(!0),U.ids={},U.index=0,U.collections.forEach((function(U){U.destroy()})),U.off()},n.prototype.onDestroyed=function(U,M){var b=this;if(b.collections.indexOf(M)<0)return!1;b.collections.splice(b.collections.indexOf(M),1)};var E=new n;const X={create:function(U){return E.create(U)},factory:E};return M.default})(),U.exports=M()},12091:(U,M,b)=>{"use strict";const{Deflate:a,deflate:A,deflateRaw:H,gzip:W}=b(12093),{Inflate:y,inflate:O,inflateRaw:e,ungzip:x}=b(12147),P=b(12120);U.exports.Deflate=a,U.exports.deflate=A,U.exports.deflateRaw=H,U.exports.gzip=W,U.exports.Inflate=y,U.exports.inflate=O,U.exports.inflateRaw=e,U.exports.ungzip=x,U.exports.constants=P},12093:(U,M,b)=>{"use strict";const a=b(12098),A=b(12124),H=b(12132),W=b(12118),y=b(12139),O=Object.prototype.toString,{Z_NO_FLUSH:e,Z_SYNC_FLUSH:x,Z_FULL_FLUSH:P,Z_FINISH:Z,Z_OK:C,Z_STREAM_END:r,Z_DEFAULT_COMPRESSION:B,Z_DEFAULT_STRATEGY:J,Z_DEFLATED:F}=b(12120);function f(U){this.options=A.assign({level:B,method:F,Ja:16384,windowBits:15,memLevel:8,strategy:J},U||{});let M=this.options;M.raw&&M.windowBits>0?M.windowBits=-M.windowBits:M.gzip&&M.windowBits>0&&M.windowBits<16&&(M.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;let b=a.deflateInit2(this.strm,M.level,M.method,M.windowBits,M.memLevel,M.strategy);if(b!==C)throw new Error(W[b]);if(M.header&&a.deflateSetHeader(this.strm,M.header),M.dictionary){let U;if(U="string"===typeof M.dictionary?H.string2buf(M.dictionary):"[object ArrayBuffer]"===O.call(M.dictionary)?new Uint8Array(M.dictionary):M.dictionary,b=a.deflateSetDictionary(this.strm,U),b!==C)throw new Error(W[b]);this._dict_set=!0}}function L(U,M){const b=new f(M);if(b.push(U,!0),b.err)throw b.msg||W[b.err];return b.result}f.prototype.push=function(U,M){const b=this.strm,A=this.options.Ja;let W,y;if(this.ended)return!1;for(y=M===~~M?M:!0===M?Z:e,"string"===typeof U?b.input=H.string2buf(U):"[object ArrayBuffer]"===O.call(U)?b.input=new Uint8Array(U):b.input=U,b.next_in=0,b.avail_in=b.input.length;;)if(0===b.avail_out&&(b.output=new Uint8Array(A),b.next_out=0,b.avail_out=A),(y===x||y===P)&&b.avail_out<=6)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else{if(W=a.deflate(b,y),W===r)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),W=a.deflateEnd(this.strm),this.onEnd(W),this.ended=!0,W===C;if(0!==b.avail_out){if(y>0&&b.next_out>0)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else if(0===b.avail_in)break}else this.onData(b.output)}return!0},f.prototype.onData=function(U){this.chunks.push(U)},f.prototype.onEnd=function(U){U===C&&(this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.msg=this.strm.msg},U.exports.Deflate=f,U.exports.deflate=L,U.exports.deflateRaw=function(U,M){return(M=M||{}).raw=!0,L(U,M)},U.exports.gzip=function(U,M){return(M=M||{}).gzip=!0,L(U,M)},U.exports.constants=b(12120)},12147:(U,M,b)=>{"use strict";const a=b(12152),A=b(12124),H=b(12132),W=b(12118),y=b(12139),O=b(12175),e=Object.prototype.toString,{Z_NO_FLUSH:x,Z_FINISH:P,Z_OK:Z,Z_STREAM_END:C,Z_NEED_DICT:r,Z_STREAM_ERROR:B,Z_DATA_ERROR:J,Z_MEM_ERROR:F}=b(12120);function f(U){this.options=A.assign({Ja:65536,windowBits:15,to:""},U||{});const M=this.options;M.raw&&M.windowBits>=0&&M.windowBits<16&&(M.windowBits=-M.windowBits,0===M.windowBits&&(M.windowBits=-15)),!(M.windowBits>=0&&M.windowBits<16)||U&&U.windowBits||(M.windowBits+=32),M.windowBits>15&&M.windowBits<48&&0===(15&M.windowBits)&&(M.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;let b=a.inflateInit2(this.strm,M.windowBits);if(b!==Z)throw new Error(W[b]);if(this.header=new O,a.inflateGetHeader(this.strm,this.header),M.dictionary&&("string"===typeof M.dictionary?M.dictionary=H.string2buf(M.dictionary):"[object ArrayBuffer]"===e.call(M.dictionary)&&(M.dictionary=new Uint8Array(M.dictionary)),M.raw&&(b=a.inflateSetDictionary(this.strm,M.dictionary),b!==Z)))throw new Error(W[b])}function L(U,M){const b=new f(M);if(b.push(U),b.err)throw b.msg||W[b.err];return b.result}f.prototype.push=function(U,M){const b=this.strm,A=this.options.Ja,W=this.options.dictionary;let y,O,f;if(this.ended)return!1;for(O=M===~~M?M:!0===M?P:x,"[object ArrayBuffer]"===e.call(U)?b.input=new Uint8Array(U):b.input=U,b.next_in=0,b.avail_in=b.input.length;;){for(0===b.avail_out&&(b.output=new Uint8Array(A),b.next_out=0,b.avail_out=A),y=a.inflate(b,O),y===r&&W&&(y=a.inflateSetDictionary(b,W),y===Z?y=a.inflate(b,O):y===J&&(y=r));b.avail_in>0&&y===C&&b.state.wrap>0&&0!==U[b.next_in];)a.inflateReset(b),y=a.inflate(b,O);switch(y){case B:case J:case r:case F:return this.onEnd(y),this.ended=!0,!1}if(f=b.avail_out,b.next_out&&(0===b.avail_out||y===C))if("string"===this.options.to){let U=H.utf8border(b.output,b.next_out),M=b.next_out-U,a=H.buf2string(b.output,U);b.next_out=M,b.avail_out=A-M,M&&b.output.set(b.output.subarray(U,U+M),0),this.onData(a)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(y!==Z||0!==f){if(y===C)return y=a.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,!0;if(0===b.avail_in)break}}return!0},f.prototype.onData=function(U){this.chunks.push(U)},f.prototype.onEnd=function(U){U===Z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.msg=this.strm.msg},U.exports.Inflate=f,U.exports.inflate=L,U.exports.inflateRaw=function(U,M){return(M=M||{}).raw=!0,L(U,M)},U.exports.ungzip=L,U.exports.constants=b(12120)},12124:U=>{"use strict";const M=(U,M)=>Object.prototype.hasOwnProperty.call(U,M);U.exports.assign=function(U){const b=Array.prototype.slice.call(arguments,1);for(;b.length;){const a=b.shift();if(a){if("object"!==typeof a)throw new TypeError(a+"must be non-object");for(const b in a)M(a,b)&&(U[b]=a[b])}}return U},U.exports.flattenChunks=U=>{let M=0;for(let a=0,A=U.length;a<A;a++)M+=U[a].length;const b=new Uint8Array(M);for(let a=0,A=0,H=U.length;a<H;a++){let M=U[a];b.set(M,A),A+=M.length}return b}},12132:U=>{"use strict";let M=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){M=!1}const b=new Uint8Array(256);for(let A=0;A<256;A++)b[A]=A>=252?6:A>=248?5:A>=240?4:A>=224?3:A>=192?2:1;b[254]=b[254]=1,U.exports.string2buf=U=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(U);let M,b,a,A,H,W=U.length,y=0;for(A=0;A<W;A++)b=U.charCodeAt(A),55296===(64512&b)&&A+1<W&&(a=U.charCodeAt(A+1),56320===(64512&a)&&(b=65536+(b-55296<<10)+(a-56320),A++)),y+=b<128?1:b<2048?2:b<65536?3:4;for(M=new Uint8Array(y),H=0,A=0;H<y;A++)b=U.charCodeAt(A),55296===(64512&b)&&A+1<W&&(a=U.charCodeAt(A+1),56320===(64512&a)&&(b=65536+(b-55296<<10)+(a-56320),A++)),b<128?M[H++]=b:b<2048?(M[H++]=192|b>>>6,M[H++]=128|63&b):b<65536?(M[H++]=224|b>>>12,M[H++]=128|b>>>6&63,M[H++]=128|63&b):(M[H++]=240|b>>>18,M[H++]=128|b>>>12&63,M[H++]=128|b>>>6&63,M[H++]=128|63&b);return M};U.exports.buf2string=(U,a)=>{const A=a||U.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(U.subarray(0,a));let H,W;const y=new Array(2*A);for(W=0,H=0;H<A;){let M=U[H++];if(M<128){y[W++]=M;continue}let a=b[M];if(a>4)y[W++]=65533,H+=a-1;else{for(M&=2===a?31:3===a?15:7;a>1&&H<A;)M=M<<6|63&U[H++],a--;a>1?y[W++]=65533:M<65536?y[W++]=M:(M-=65536,y[W++]=55296|M>>10&1023,y[W++]=56320|1023&M)}}return((U,b)=>{if(b<65534&&U.subarray&&M)return String.fromCharCode.apply(null,U.length===b?U:U.subarray(0,b));let a="";for(let M=0;M<b;M++)a+=String.fromCharCode(U[M]);return a})(y,W)},U.exports.utf8border=(U,M)=>{(M=M||U.length)>U.length&&(M=U.length);let a=M-1;for(;a>=0&&128===(192&U[a]);)a--;return a<0||0===a?M:a+b[U[a]]>M?a:M}},12109:U=>{"use strict";U.exports=(U,M,b,a)=>{let A=65535&U,H=U>>>16&65535,W=0;for(;0!==b;){W=b>2e3?2e3:b,b-=W;do{A=A+M[a++]|0,H=H+A|0}while(--W);A%=65521,H%=65521}return A|H<<16}},12120:U=>{"use strict";U.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12116:U=>{"use strict";const M=new Uint32Array((()=>{let U,M=[];for(var b=0;b<256;b++){U=b;for(var a=0;a<8;a++)U=1&U?3988292384^U>>>1:U>>>1;M[b]=U}return M})());U.exports=(U,b,a,A)=>{const H=M,W=A+a;U^=-1;for(let M=A;M<W;M++)U=U>>>8^H[255&(U^b[M])];return~U}},12098:(U,M,b)=>{"use strict";const{_tr_init:a,_tr_stored_block:A,_tr_flush_block:H,_tr_tally:W,_tr_align:y}=b(12107),O=b(12109),e=b(12116),x=b(12118),{Z_NO_FLUSH:P,Z_PARTIAL_FLUSH:Z,Z_FULL_FLUSH:C,Z_FINISH:r,Z_BLOCK:B,Z_OK:J,Z_STREAM_END:F,Z_STREAM_ERROR:f,Z_DATA_ERROR:L,Z_BUF_ERROR:z,Z_DEFAULT_COMPRESSION:o,Z_FILTERED:S,Z_HUFFMAN_ONLY:h,Z_RLE:i,Z_FIXED:Y,Z_DEFAULT_STRATEGY:d,Z_UNKNOWN:s,Z_DEFLATED:q}=b(12120),m=258,n=262,E=103,X=113,Q=666,I=(U,M)=>(U.msg=x[M],M),v=U=>(U<<1)-(U>4?9:0),t=U=>{let M=U.length;for(;--M>=0;)U[M]=0};let V=(U,M,b)=>(M<<U.hash_shift^b)&U.hash_mask;const k=U=>{const M=U.state;let b=M.pending;b>U.avail_out&&(b=U.avail_out),0!==b&&(U.output.set(M.pending_buf.subarray(M.pending_out,M.pending_out+b),U.next_out),U.next_out+=b,M.pending_out+=b,U.total_out+=b,U.avail_out-=b,M.pending-=b,0===M.pending&&(M.pending_out=0))},N=(U,M)=>{H(U,U.block_start>=0?U.block_start:-1,U.strstart-U.block_start,M),U.block_start=U.strstart,k(U.strm)},R=(U,M)=>{U.pending_buf[U.pending++]=M},j=(U,M)=>{U.pending_buf[U.pending++]=M>>>8&255,U.pending_buf[U.pending++]=255&M},p=(U,M,b,a)=>{let A=U.avail_in;return A>a&&(A=a),0===A?0:(U.avail_in-=A,M.set(U.input.subarray(U.next_in,U.next_in+A),b),1===U.state.wrap?U.adler=O(U.adler,M,A,b):2===U.state.wrap&&(U.adler=e(U.adler,M,A,b)),U.next_in+=A,U.total_in+=A,A)},g=(U,M)=>{let b,a,A=U.max_chain_length,H=U.strstart,W=U.prev_length,y=U.nice_match;const O=U.strstart>U.w_size-n?U.strstart-(U.w_size-n):0,e=U.window,x=U.w_mask,P=U.prev,Z=U.strstart+m;let C=e[H+W-1],r=e[H+W];U.prev_length>=U.good_match&&(A>>=2),y>U.lookahead&&(y=U.lookahead);do{if(b=M,e[b+W]===r&&e[b+W-1]===C&&e[b]===e[H]&&e[++b]===e[H+1]){H+=2,b++;do{}while(e[++H]===e[++b]&&e[++H]===e[++b]&&e[++H]===e[++b]&&e[++H]===e[++b]&&e[++H]===e[++b]&&e[++H]===e[++b]&&e[++H]===e[++b]&&e[++H]===e[++b]&&H<Z);if(a=m-(Z-H),H=Z-m,a>W){if(U.match_start=M,W=a,a>=y)break;C=e[H+W-1],r=e[H+W]}}}while((M=P[M&x])>O&&0!==--A);return W<=U.lookahead?W:U.lookahead},K=U=>{const M=U.w_size;let b,a,A,H,W;do{if(H=U.window_size-U.lookahead-U.strstart,U.strstart>=M+(M-n)){U.window.set(U.window.subarray(M,M+M),0),U.match_start-=M,U.strstart-=M,U.block_start-=M,a=U.hash_size,b=a;do{A=U.head[--b],U.head[b]=A>=M?A-M:0}while(--a);a=M,b=a;do{A=U.prev[--b],U.prev[b]=A>=M?A-M:0}while(--a);H+=M}if(0===U.strm.avail_in)break;if(a=p(U.strm,U.window,U.strstart+U.lookahead,H),U.lookahead+=a,U.lookahead+U.insert>=3)for(W=U.strstart-U.insert,U.ins_h=U.window[W],U.ins_h=V(U,U.ins_h,U.window[W+1]);U.insert&&(U.ins_h=V(U,U.ins_h,U.window[W+3-1]),U.prev[W&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=W,W++,U.insert--,!(U.lookahead+U.insert<3)););}while(U.lookahead<n&&0!==U.strm.avail_in)},w=(U,M)=>{let b,a;for(;;){if(U.lookahead<n){if(K(U),U.lookahead<n&&M===P)return 1;if(0===U.lookahead)break}if(b=0,U.lookahead>=3&&(U.ins_h=V(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),0!==b&&U.strstart-b<=U.w_size-n&&(U.match_length=g(U,b)),U.match_length>=3)if(a=W(U,U.strstart-U.match_start,U.match_length-3),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=3){U.match_length--;do{U.strstart++,U.ins_h=V(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart}while(0!==--U.match_length);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=V(U,U.ins_h,U.window[U.strstart+1]);else a=W(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(a&&(N(U,!1),0===U.strm.avail_out))return 1}return U.insert=U.strstart<2?U.strstart:2,M===r?(N(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(N(U,!1),0===U.strm.avail_out)?1:2},T=(U,M)=>{let b,a,A;for(;;){if(U.lookahead<n){if(K(U),U.lookahead<n&&M===P)return 1;if(0===U.lookahead)break}if(b=0,U.lookahead>=3&&(U.ins_h=V(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=2,0!==b&&U.prev_length<U.max_lazy_match&&U.strstart-b<=U.w_size-n&&(U.match_length=g(U,b),U.match_length<=5&&(U.strategy===S||3===U.match_length&&U.strstart-U.match_start>4096)&&(U.match_length=2)),U.prev_length>=3&&U.match_length<=U.prev_length){A=U.strstart+U.lookahead-3,a=W(U,U.strstart-1-U.prev_match,U.prev_length-3),U.lookahead-=U.prev_length-1,U.prev_length-=2;do{++U.strstart<=A&&(U.ins_h=V(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart)}while(0!==--U.prev_length);if(U.match_available=0,U.match_length=2,U.strstart++,a&&(N(U,!1),0===U.strm.avail_out))return 1}else if(U.match_available){if(a=W(U,0,U.window[U.strstart-1]),a&&N(U,!1),U.strstart++,U.lookahead--,0===U.strm.avail_out)return 1}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(a=W(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<2?U.strstart:2,M===r?(N(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(N(U,!1),0===U.strm.avail_out)?1:2};function G(U,M,b,a,A){this.good_length=U,this.max_lazy=M,this.nice_length=b,this.max_chain=a,this.func=A}const l=[new G(0,0,0,0,((U,M)=>{let b=65535;for(b>U.pending_buf_size-5&&(b=U.pending_buf_size-5);;){if(U.lookahead<=1){if(K(U),0===U.lookahead&&M===P)return 1;if(0===U.lookahead)break}U.strstart+=U.lookahead,U.lookahead=0;const a=U.block_start+b;if((0===U.strstart||U.strstart>=a)&&(U.lookahead=U.strstart-a,U.strstart=a,N(U,!1),0===U.strm.avail_out))return 1;if(U.strstart-U.block_start>=U.w_size-n&&(N(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,M===r?(N(U,!0),0===U.strm.avail_out?3:4):(U.strstart>U.block_start&&(N(U,!1),U.strm.avail_out),1)})),new G(4,4,8,4,w),new G(4,5,16,8,w),new G(4,6,32,32,w),new G(4,4,16,16,T),new G(8,16,32,32,T),new G(8,16,128,128,T),new G(8,32,128,256,T),new G(32,128,258,1024,T),new G(32,258,258,4096,T)];function D(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),t(this.dyn_ltree),t(this.dyn_dtree),t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const u=U=>{if(!U||!U.state)return I(U,f);U.total_in=U.total_out=0,U.data_type=s;const M=U.state;return M.pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?42:X,U.adler=2===M.wrap?0:1,M.last_flush=P,a(M),J},c=U=>{const M=u(U);var b;return M===J&&((b=U.state).window_size=2*b.w_size,t(b.head),b.max_lazy_match=l[b.level].max_lazy,b.good_match=l[b.level].good_length,b.nice_match=l[b.level].nice_length,b.max_chain_length=l[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),M},UU=(U,M,b,a,A,H)=>{if(!U)return f;let W=1;if(M===o&&(M=6),a<0?(W=0,a=-a):a>15&&(W=2,a-=16),A<1||A>9||b!==q||a<8||a>15||M<0||M>9||H<0||H>Y)return I(U,f);8===a&&(a=9);const y=new D;return U.state=y,y.strm=U,y.wrap=W,y.gzhead=null,y.w_bits=a,y.w_size=1<<y.w_bits,y.w_mask=y.w_size-1,y.hash_bits=A+7,y.hash_size=1<<y.hash_bits,y.hash_mask=y.hash_size-1,y.hash_shift=~~((y.hash_bits+3-1)/3),y.window=new Uint8Array(2*y.w_size),y.head=new Uint16Array(y.hash_size),y.prev=new Uint16Array(y.w_size),y.lit_bufsize=1<<A+6,y.pending_buf_size=4*y.lit_bufsize,y.pending_buf=new Uint8Array(y.pending_buf_size),y.d_buf=1*y.lit_bufsize,y.l_buf=3*y.lit_bufsize,y.level=M,y.strategy=H,y.method=b,c(U)};U.exports.deflateInit=(U,M)=>UU(U,M,q,15,8,d),U.exports.deflateInit2=UU,U.exports.deflateReset=c,U.exports.deflateResetKeep=u,U.exports.deflateSetHeader=(U,M)=>U&&U.state?2!==U.state.wrap?f:(U.state.gzhead=M,J):f,U.exports.deflate=(U,M)=>{let b,a;if(!U||!U.state||M>B||M<0)return U?I(U,f):f;const H=U.state;if(!U.output||!U.input&&0!==U.avail_in||H.status===Q&&M!==r)return I(U,0===U.avail_out?z:f);H.strm=U;const O=H.last_flush;if(H.last_flush=M,42===H.status)if(2===H.wrap)U.adler=0,R(H,31),R(H,139),R(H,8),H.gzhead?(R(H,(H.gzhead.text?1:0)+(H.gzhead.hcrc?2:0)+(H.gzhead.extra?4:0)+(H.gzhead.name?8:0)+(H.gzhead.comment?16:0)),R(H,255&H.gzhead.time),R(H,H.gzhead.time>>8&255),R(H,H.gzhead.time>>16&255),R(H,H.gzhead.time>>24&255),R(H,9===H.level?2:H.strategy>=h||H.level<2?4:0),R(H,255&H.gzhead.os),H.gzhead.extra&&H.gzhead.extra.length&&(R(H,255&H.gzhead.extra.length),R(H,H.gzhead.extra.length>>8&255)),H.gzhead.hcrc&&(U.adler=e(U.adler,H.pending_buf,H.pending,0)),H.gzindex=0,H.status=69):(R(H,0),R(H,0),R(H,0),R(H,0),R(H,0),R(H,9===H.level?2:H.strategy>=h||H.level<2?4:0),R(H,3),H.status=X);else{let M=q+(H.w_bits-8<<4)<<8,b=-1;b=H.strategy>=h||H.level<2?0:H.level<6?1:6===H.level?2:3,M|=b<<6,0!==H.strstart&&(M|=32),M+=31-M%31,H.status=X,j(H,M),0!==H.strstart&&(j(H,U.adler>>>16),j(H,65535&U.adler)),U.adler=1}if(69===H.status)if(H.gzhead.extra){for(b=H.pending;H.gzindex<(65535&H.gzhead.extra.length)&&(H.pending!==H.pending_buf_size||(H.gzhead.hcrc&&H.pending>b&&(U.adler=e(U.adler,H.pending_buf,H.pending-b,b)),k(U),b=H.pending,H.pending!==H.pending_buf_size));)R(H,255&H.gzhead.extra[H.gzindex]),H.gzindex++;H.gzhead.hcrc&&H.pending>b&&(U.adler=e(U.adler,H.pending_buf,H.pending-b,b)),H.gzindex===H.gzhead.extra.length&&(H.gzindex=0,H.status=73)}else H.status=73;if(73===H.status)if(H.gzhead.name){b=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>b&&(U.adler=e(U.adler,H.pending_buf,H.pending-b,b)),k(U),b=H.pending,H.pending===H.pending_buf_size)){a=1;break}a=H.gzindex<H.gzhead.name.length?255&H.gzhead.name.charCodeAt(H.gzindex++):0,R(H,a)}while(0!==a);H.gzhead.hcrc&&H.pending>b&&(U.adler=e(U.adler,H.pending_buf,H.pending-b,b)),0===a&&(H.gzindex=0,H.status=91)}else H.status=91;if(91===H.status)if(H.gzhead.comment){b=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>b&&(U.adler=e(U.adler,H.pending_buf,H.pending-b,b)),k(U),b=H.pending,H.pending===H.pending_buf_size)){a=1;break}a=H.gzindex<H.gzhead.comment.length?255&H.gzhead.comment.charCodeAt(H.gzindex++):0,R(H,a)}while(0!==a);H.gzhead.hcrc&&H.pending>b&&(U.adler=e(U.adler,H.pending_buf,H.pending-b,b)),0===a&&(H.status=E)}else H.status=E;if(H.status===E&&(H.gzhead.hcrc?(H.pending+2>H.pending_buf_size&&k(U),H.pending+2<=H.pending_buf_size&&(R(H,255&U.adler),R(H,U.adler>>8&255),U.adler=0,H.status=X)):H.status=X),0!==H.pending){if(k(U),0===U.avail_out)return H.last_flush=-1,J}else if(0===U.avail_in&&v(M)<=v(O)&&M!==r)return I(U,z);if(H.status===Q&&0!==U.avail_in)return I(U,z);if(0!==U.avail_in||0!==H.lookahead||M!==P&&H.status!==Q){let b=H.strategy===h?((U,M)=>{let b;for(;;){if(0===U.lookahead&&(K(U),0===U.lookahead)){if(M===P)return 1;break}if(U.match_length=0,b=W(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,b&&(N(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,M===r?(N(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(N(U,!1),0===U.strm.avail_out)?1:2})(H,M):H.strategy===i?((U,M)=>{let b,a,A,H;const y=U.window;for(;;){if(U.lookahead<=m){if(K(U),U.lookahead<=m&&M===P)return 1;if(0===U.lookahead)break}if(U.match_length=0,U.lookahead>=3&&U.strstart>0&&(A=U.strstart-1,a=y[A],a===y[++A]&&a===y[++A]&&a===y[++A])){H=U.strstart+m;do{}while(a===y[++A]&&a===y[++A]&&a===y[++A]&&a===y[++A]&&a===y[++A]&&a===y[++A]&&a===y[++A]&&a===y[++A]&&A<H);U.match_length=m-(H-A),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=3?(b=W(U,1,U.match_length-3),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(b=W(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),b&&(N(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,M===r?(N(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(N(U,!1),0===U.strm.avail_out)?1:2})(H,M):l[H.level].func(H,M);if(3!==b&&4!==b||(H.status=Q),1===b||3===b)return 0===U.avail_out&&(H.last_flush=-1),J;if(2===b&&(M===Z?y(H):M!==B&&(A(H,0,0,!1),M===C&&(t(H.head),0===H.lookahead&&(H.strstart=0,H.block_start=0,H.insert=0))),k(U),0===U.avail_out))return H.last_flush=-1,J}return M!==r?J:H.wrap<=0?F:(2===H.wrap?(R(H,255&U.adler),R(H,U.adler>>8&255),R(H,U.adler>>16&255),R(H,U.adler>>24&255),R(H,255&U.total_in),R(H,U.total_in>>8&255),R(H,U.total_in>>16&255),R(H,U.total_in>>24&255)):(j(H,U.adler>>>16),j(H,65535&U.adler)),k(U),H.wrap>0&&(H.wrap=-H.wrap),0!==H.pending?J:F)},U.exports.deflateEnd=U=>{if(!U||!U.state)return f;const M=U.state.status;return 42!==M&&69!==M&&73!==M&&91!==M&&M!==E&&M!==X&&M!==Q?I(U,f):(U.state=null,M===X?I(U,L):J)},U.exports.deflateSetDictionary=(U,M)=>{let b=M.length;if(!U||!U.state)return f;const a=U.state,A=a.wrap;if(2===A||1===A&&42!==a.status||a.lookahead)return f;if(1===A&&(U.adler=O(U.adler,M,b,0)),a.wrap=0,b>=a.w_size){0===A&&(t(a.head),a.strstart=0,a.block_start=0,a.insert=0);let U=new Uint8Array(a.w_size);U.set(M.subarray(b-a.w_size,b),0),M=U,b=a.w_size}const H=U.avail_in,W=U.next_in,y=U.input;for(U.avail_in=b,U.next_in=0,U.input=M,K(a);a.lookahead>=3;){let U=a.strstart,M=a.lookahead-2;do{a.ins_h=V(a,a.ins_h,a.window[U+3-1]),a.prev[U&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=U,U++}while(--M);a.strstart=U,a.lookahead=2,K(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,U.next_in=W,U.input=y,U.avail_in=H,a.wrap=A,J},U.exports.deflateInfo="pako deflate (from Nodeca project)"},12175:U=>{"use strict";U.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12161:U=>{"use strict";U.exports=function(U,M){let b,a,A,H,W,y,O,e,x,P,Z,C,r,B,J,F,f,L,z,o,S,h,i,Y;const d=U.state;b=U.next_in,i=U.input,a=b+(U.avail_in-5),A=U.next_out,Y=U.output,H=A-(M-U.avail_out),W=A+(U.avail_out-257),y=d.dmax,O=d.wsize,e=d.whave,x=d.wnext,P=d.window,Z=d.hold,C=d.bits,r=d.lencode,B=d.distcode,J=(1<<d.lenbits)-1,F=(1<<d.distbits)-1;U:do{C<15&&(Z+=i[b++]<<C,C+=8,Z+=i[b++]<<C,C+=8),f=r[Z&J];M:for(;;){if(L=f>>>24,Z>>>=L,C-=L,L=f>>>16&255,0===L)Y[A++]=65535&f;else{if(!(16&L)){if(0===(64&L)){f=r[(65535&f)+(Z&(1<<L)-1)];continue M}if(32&L){d.mode=12;break U}U.msg="invalid literal/length code",d.mode=30;break U}z=65535&f,L&=15,L&&(C<L&&(Z+=i[b++]<<C,C+=8),z+=Z&(1<<L)-1,Z>>>=L,C-=L),C<15&&(Z+=i[b++]<<C,C+=8,Z+=i[b++]<<C,C+=8),f=B[Z&F];b:for(;;){if(L=f>>>24,Z>>>=L,C-=L,L=f>>>16&255,!(16&L)){if(0===(64&L)){f=B[(65535&f)+(Z&(1<<L)-1)];continue b}U.msg="invalid distance code",d.mode=30;break U}if(o=65535&f,L&=15,C<L&&(Z+=i[b++]<<C,C+=8,C<L&&(Z+=i[b++]<<C,C+=8)),o+=Z&(1<<L)-1,o>y){U.msg="invalid distance too far back",d.mode=30;break U}if(Z>>>=L,C-=L,L=A-H,o>L){if(L=o-L,L>e&&d.sane){U.msg="invalid distance too far back",d.mode=30;break U}if(S=0,h=P,0===x){if(S+=O-L,L<z){z-=L;do{Y[A++]=P[S++]}while(--L);S=A-o,h=Y}}else if(x<L){if(S+=O+x-L,L-=x,L<z){z-=L;do{Y[A++]=P[S++]}while(--L);if(S=0,x<z){L=x,z-=L;do{Y[A++]=P[S++]}while(--L);S=A-o,h=Y}}}else if(S+=x-L,L<z){z-=L;do{Y[A++]=P[S++]}while(--L);S=A-o,h=Y}for(;z>2;)Y[A++]=h[S++],Y[A++]=h[S++],Y[A++]=h[S++],z-=3;z&&(Y[A++]=h[S++],z>1&&(Y[A++]=h[S++]))}else{S=A-o;do{Y[A++]=Y[S++],Y[A++]=Y[S++],Y[A++]=Y[S++],z-=3}while(z>2);z&&(Y[A++]=Y[S++],z>1&&(Y[A++]=Y[S++]))}break}}break}}while(b<a&&A<W);z=C>>3,b-=z,C-=z<<3,Z&=(1<<C)-1,U.next_in=b,U.next_out=A,U.avail_in=b<a?a-b+5:5-(b-a),U.avail_out=A<W?W-A+257:257-(A-W),d.hold=Z,d.bits=C}},12152:(U,M,b)=>{"use strict";const a=b(12109),A=b(12116),H=b(12161),W=b(12166),{Z_FINISH:y,Z_BLOCK:O,Z_TREES:e,Z_OK:x,Z_STREAM_END:P,Z_NEED_DICT:Z,Z_STREAM_ERROR:C,Z_DATA_ERROR:r,Z_MEM_ERROR:B,Z_BUF_ERROR:J,Z_DEFLATED:F}=b(12120),f=12,L=30,z=U=>(U>>>24&255)+(U>>>8&65280)+((65280&U)<<8)+((255&U)<<24);function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const S=U=>{if(!U||!U.state)return C;const M=U.state;return U.total_in=U.total_out=M.total=0,U.msg="",M.wrap&&(U.adler=1&M.wrap),M.mode=1,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new Int32Array(852),M.distcode=M.distdyn=new Int32Array(592),M.sane=1,M.back=-1,x},h=U=>{if(!U||!U.state)return C;const M=U.state;return M.wsize=0,M.whave=0,M.wnext=0,S(U)},i=(U,M)=>{let b;if(!U||!U.state)return C;const a=U.state;return M<0?(b=0,M=-M):(b=1+(M>>4),M<48&&(M&=15)),M&&(M<8||M>15)?C:(null!==a.window&&a.wbits!==M&&(a.window=null),a.wrap=b,a.wbits=M,h(U))},Y=(U,M)=>{if(!U)return C;const b=new o;U.state=b,b.window=null;const a=i(U,M);return a!==x&&(U.state=null),a};let d,s,q=!0;const m=U=>{if(q){d=new Int32Array(512),s=new Int32Array(32);let M=0;for(;M<144;)U.lens[M++]=8;for(;M<256;)U.lens[M++]=9;for(;M<280;)U.lens[M++]=7;for(;M<288;)U.lens[M++]=8;for(W(1,U.lens,0,288,d,0,U.work,{bits:9}),M=0;M<32;)U.lens[M++]=5;W(2,U.lens,0,32,s,0,U.work,{bits:5}),q=!1}U.lencode=d,U.lenbits=9,U.distcode=s,U.distbits=5},n=(U,M,b,a)=>{let A;const H=U.state;return null===H.window&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new Uint8Array(H.wsize)),a>=H.wsize?(H.window.set(M.subarray(b-H.wsize,b),0),H.wnext=0,H.whave=H.wsize):(A=H.wsize-H.wnext,A>a&&(A=a),H.window.set(M.subarray(b-a,b-a+A),H.wnext),(a-=A)?(H.window.set(M.subarray(b-a,b),0),H.wnext=a,H.whave=H.wsize):(H.wnext+=A,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=A))),0};U.exports.inflateReset=h,U.exports.inflateReset2=i,U.exports.inflateResetKeep=S,U.exports.inflateInit=U=>Y(U,15),U.exports.inflateInit2=Y,U.exports.inflate=(U,M)=>{let b,o,S,h,i,Y,d,s,q,E,X,Q,I,v,t,V,k,N,R,j,p,g,K=0;const w=new Uint8Array(4);let T,G;const l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!U||!U.state||!U.output||!U.input&&0!==U.avail_in)return C;b=U.state,b.mode===f&&(b.mode=13),i=U.next_out,S=U.output,d=U.avail_out,h=U.next_in,o=U.input,Y=U.avail_in,s=b.hold,q=b.bits,E=Y,X=d,g=x;U:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;q<16;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(2&b.wrap&&35615===s){b.check=0,w[0]=255&s,w[1]=s>>>8&255,b.check=A(b.check,w,2,0),s=0,q=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&s)<<8)+(s>>8))%31){U.msg="incorrect header check",b.mode=L;break}if((15&s)!==F){U.msg="unknown compression method",b.mode=L;break}if(s>>>=4,q-=4,p=8+(15&s),0===b.wbits)b.wbits=p;else if(p>b.wbits){U.msg="invalid window size",b.mode=L;break}b.dmax=1<<b.wbits,U.adler=b.check=1,b.mode=512&s?10:f,s=0,q=0;break;case 2:for(;q<16;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(b.flags=s,(255&b.flags)!==F){U.msg="unknown compression method",b.mode=L;break}if(57344&b.flags){U.msg="unknown header flags set",b.mode=L;break}b.head&&(b.head.text=s>>8&1),512&b.flags&&(w[0]=255&s,w[1]=s>>>8&255,b.check=A(b.check,w,2,0)),s=0,q=0,b.mode=3;case 3:for(;q<32;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}b.head&&(b.head.time=s),512&b.flags&&(w[0]=255&s,w[1]=s>>>8&255,w[2]=s>>>16&255,w[3]=s>>>24&255,b.check=A(b.check,w,4,0)),s=0,q=0,b.mode=4;case 4:for(;q<16;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}b.head&&(b.head.xflags=255&s,b.head.os=s>>8),512&b.flags&&(w[0]=255&s,w[1]=s>>>8&255,b.check=A(b.check,w,2,0)),s=0,q=0,b.mode=5;case 5:if(1024&b.flags){for(;q<16;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}b.length=s,b.head&&(b.head.extra_len=s),512&b.flags&&(w[0]=255&s,w[1]=s>>>8&255,b.check=A(b.check,w,2,0)),s=0,q=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(Q=b.length,Q>Y&&(Q=Y),Q&&(b.head&&(p=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(o.subarray(h,h+Q),p)),512&b.flags&&(b.check=A(b.check,o,Q,h)),Y-=Q,h+=Q,b.length-=Q),b.length))break U;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(0===Y)break U;Q=0;do{p=o[h+Q++],b.head&&p&&b.length<65536&&(b.head.name+=String.fromCharCode(p))}while(p&&Q<Y);if(512&b.flags&&(b.check=A(b.check,o,Q,h)),Y-=Q,h+=Q,p)break U}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(0===Y)break U;Q=0;do{p=o[h+Q++],b.head&&p&&b.length<65536&&(b.head.comment+=String.fromCharCode(p))}while(p&&Q<Y);if(512&b.flags&&(b.check=A(b.check,o,Q,h)),Y-=Q,h+=Q,p)break U}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;q<16;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(s!==(65535&b.check)){U.msg="header crc mismatch",b.mode=L;break}s=0,q=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),U.adler=b.check=0,b.mode=f;break;case 10:for(;q<32;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}U.adler=b.check=z(s),s=0,q=0,b.mode=11;case 11:if(0===b.havedict)return U.next_out=i,U.avail_out=d,U.next_in=h,U.avail_in=Y,b.hold=s,b.bits=q,Z;U.adler=b.check=1,b.mode=f;case f:if(M===O||M===e)break U;case 13:if(b.last){s>>>=7&q,q-=7&q,b.mode=27;break}for(;q<3;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}switch(b.last=1&s,s>>>=1,q-=1,3&s){case 0:b.mode=14;break;case 1:if(m(b),b.mode=20,M===e){s>>>=2,q-=2;break U}break;case 2:b.mode=17;break;case 3:U.msg="invalid block type",b.mode=L}s>>>=2,q-=2;break;case 14:for(s>>>=7&q,q-=7&q;q<32;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if((65535&s)!==(s>>>16^65535)){U.msg="invalid stored block lengths",b.mode=L;break}if(b.length=65535&s,s=0,q=0,b.mode=15,M===e)break U;case 15:b.mode=16;case 16:if(Q=b.length,Q){if(Q>Y&&(Q=Y),Q>d&&(Q=d),0===Q)break U;S.set(o.subarray(h,h+Q),i),Y-=Q,h+=Q,d-=Q,i+=Q,b.length-=Q;break}b.mode=f;break;case 17:for(;q<14;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(b.nlen=257+(31&s),s>>>=5,q-=5,b.ndist=1+(31&s),s>>>=5,q-=5,b.ncode=4+(15&s),s>>>=4,q-=4,b.nlen>286||b.ndist>30){U.msg="too many length or distance symbols",b.mode=L;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;q<3;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}b.lens[l[b.have++]]=7&s,s>>>=3,q-=3}for(;b.have<19;)b.lens[l[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,T={bits:b.lenbits},g=W(0,b.lens,0,19,b.lencode,0,b.work,T),b.lenbits=T.bits,g){U.msg="invalid code lengths set",b.mode=L;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;K=b.lencode[s&(1<<b.lenbits)-1],t=K>>>24,V=K>>>16&255,k=65535&K,!(t<=q);){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(k<16)s>>>=t,q-=t,b.lens[b.have++]=k;else{if(16===k){for(G=t+2;q<G;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(s>>>=t,q-=t,0===b.have){U.msg="invalid bit length repeat",b.mode=L;break}p=b.lens[b.have-1],Q=3+(3&s),s>>>=2,q-=2}else if(17===k){for(G=t+3;q<G;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}s>>>=t,q-=t,p=0,Q=3+(7&s),s>>>=3,q-=3}else{for(G=t+7;q<G;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}s>>>=t,q-=t,p=0,Q=11+(127&s),s>>>=7,q-=7}if(b.have+Q>b.nlen+b.ndist){U.msg="invalid bit length repeat",b.mode=L;break}for(;Q--;)b.lens[b.have++]=p}}if(b.mode===L)break;if(0===b.lens[256]){U.msg="invalid code -- missing end-of-block",b.mode=L;break}if(b.lenbits=9,T={bits:b.lenbits},g=W(1,b.lens,0,b.nlen,b.lencode,0,b.work,T),b.lenbits=T.bits,g){U.msg="invalid literal/lengths set",b.mode=L;break}if(b.distbits=6,b.distcode=b.distdyn,T={bits:b.distbits},g=W(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,T),b.distbits=T.bits,g){U.msg="invalid distances set",b.mode=L;break}if(b.mode=20,M===e)break U;case 20:b.mode=21;case 21:if(Y>=6&&d>=258){U.next_out=i,U.avail_out=d,U.next_in=h,U.avail_in=Y,b.hold=s,b.bits=q,H(U,X),i=U.next_out,S=U.output,d=U.avail_out,h=U.next_in,o=U.input,Y=U.avail_in,s=b.hold,q=b.bits,b.mode===f&&(b.back=-1);break}for(b.back=0;K=b.lencode[s&(1<<b.lenbits)-1],t=K>>>24,V=K>>>16&255,k=65535&K,!(t<=q);){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(V&&0===(240&V)){for(N=t,R=V,j=k;K=b.lencode[j+((s&(1<<N+R)-1)>>N)],t=K>>>24,V=K>>>16&255,k=65535&K,!(N+t<=q);){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}s>>>=N,q-=N,b.back+=N}if(s>>>=t,q-=t,b.back+=t,b.length=k,0===V){b.mode=26;break}if(32&V){b.back=-1,b.mode=f;break}if(64&V){U.msg="invalid literal/length code",b.mode=L;break}b.extra=15&V,b.mode=22;case 22:if(b.extra){for(G=b.extra;q<G;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}b.length+=s&(1<<b.extra)-1,s>>>=b.extra,q-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;K=b.distcode[s&(1<<b.distbits)-1],t=K>>>24,V=K>>>16&255,k=65535&K,!(t<=q);){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(0===(240&V)){for(N=t,R=V,j=k;K=b.distcode[j+((s&(1<<N+R)-1)>>N)],t=K>>>24,V=K>>>16&255,k=65535&K,!(N+t<=q);){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}s>>>=N,q-=N,b.back+=N}if(s>>>=t,q-=t,b.back+=t,64&V){U.msg="invalid distance code",b.mode=L;break}b.offset=k,b.extra=15&V,b.mode=24;case 24:if(b.extra){for(G=b.extra;q<G;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}b.offset+=s&(1<<b.extra)-1,s>>>=b.extra,q-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){U.msg="invalid distance too far back",b.mode=L;break}b.mode=25;case 25:if(0===d)break U;if(Q=X-d,b.offset>Q){if(Q=b.offset-Q,Q>b.whave&&b.sane){U.msg="invalid distance too far back",b.mode=L;break}Q>b.wnext?(Q-=b.wnext,I=b.wsize-Q):I=b.wnext-Q,Q>b.length&&(Q=b.length),v=b.window}else v=S,I=i-b.offset,Q=b.length;Q>d&&(Q=d),d-=Q,b.length-=Q;do{S[i++]=v[I++]}while(--Q);0===b.length&&(b.mode=21);break;case 26:if(0===d)break U;S[i++]=b.length,d--,b.mode=21;break;case 27:if(b.wrap){for(;q<32;){if(0===Y)break U;Y--,s|=o[h++]<<q,q+=8}if(X-=d,U.total_out+=X,b.total+=X,X&&(U.adler=b.check=b.flags?A(b.check,S,X,i-X):a(b.check,S,X,i-X)),X=d,(b.flags?s:z(s))!==b.check){U.msg="incorrect data check",b.mode=L;break}s=0,q=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;q<32;){if(0===Y)break U;Y--,s+=o[h++]<<q,q+=8}if(s!==(4294967295&b.total)){U.msg="incorrect length check",b.mode=L;break}s=0,q=0}b.mode=29;case 29:g=P;break U;case L:g=r;break U;case 31:return B;default:return C}return U.next_out=i,U.avail_out=d,U.next_in=h,U.avail_in=Y,b.hold=s,b.bits=q,(b.wsize||X!==U.avail_out&&b.mode<L&&(b.mode<27||M!==y))&&n(U,U.output,U.next_out,X-U.avail_out)?(b.mode=31,B):(E-=U.avail_in,X-=U.avail_out,U.total_in+=E,U.total_out+=X,b.total+=X,b.wrap&&X&&(U.adler=b.check=b.flags?A(b.check,S,X,U.next_out-X):a(b.check,S,X,U.next_out-X)),U.data_type=b.bits+(b.last?64:0)+(b.mode===f?128:0)+(20===b.mode||15===b.mode?256:0),(0===E&&0===X||M===y)&&g===x&&(g=J),g)},U.exports.inflateEnd=U=>{if(!U||!U.state)return C;let M=U.state;return M.window&&(M.window=null),U.state=null,x},U.exports.inflateGetHeader=(U,M)=>{if(!U||!U.state)return C;const b=U.state;return 0===(2&b.wrap)?C:(b.head=M,M.done=!1,x)},U.exports.inflateSetDictionary=(U,M)=>{const b=M.length;let A,H,W;return U&&U.state?(A=U.state,0!==A.wrap&&11!==A.mode?C:11===A.mode&&(H=1,H=a(H,M,b,0),H!==A.check)?r:(W=n(U,M,b,b),W?(A.mode=31,B):(A.havedict=1,x))):C},U.exports.inflateInfo="pako inflate (from Nodeca project)"},12166:U=>{"use strict";const M=15,b=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),a=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),A=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),H=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);U.exports=(U,W,y,O,e,x,P,Z)=>{const C=Z.bits;let r,B,J,F,f,L,z=0,o=0,S=0,h=0,i=0,Y=0,d=0,s=0,q=0,m=0,n=null,E=0;const X=new Uint16Array(16),Q=new Uint16Array(16);let I,v,t,V=null,k=0;for(z=0;z<=M;z++)X[z]=0;for(o=0;o<O;o++)X[W[y+o]]++;for(i=C,h=M;h>=1&&0===X[h];h--);if(i>h&&(i=h),0===h)return e[x++]=20971520,e[x++]=20971520,Z.bits=1,0;for(S=1;S<h&&0===X[S];S++);for(i<S&&(i=S),s=1,z=1;z<=M;z++)if(s<<=1,s-=X[z],s<0)return-1;if(s>0&&(0===U||1!==h))return-1;for(Q[1]=0,z=1;z<M;z++)Q[z+1]=Q[z]+X[z];for(o=0;o<O;o++)0!==W[y+o]&&(P[Q[W[y+o]]++]=o);if(0===U?(n=V=P,L=19):1===U?(n=b,E-=257,V=a,k-=257,L=256):(n=A,V=H,L=-1),m=0,o=0,z=S,f=x,Y=i,d=0,J=-1,q=1<<i,F=q-1,1===U&&q>852||2===U&&q>592)return 1;for(;;){I=z-d,P[o]<L?(v=0,t=P[o]):P[o]>L?(v=V[k+P[o]],t=n[E+P[o]]):(v=96,t=0),r=1<<z-d,B=1<<Y,S=B;do{B-=r,e[f+(m>>d)+B]=I<<24|v<<16|t}while(0!==B);for(r=1<<z-1;m&r;)r>>=1;if(0!==r?(m&=r-1,m+=r):m=0,o++,0===--X[z]){if(z===h)break;z=W[y+P[o]]}if(z>i&&(m&F)!==J){for(0===d&&(d=i),f+=S,Y=z-d,s=1<<Y;Y+d<h&&(s-=X[Y+d],!(s<=0));)Y++,s<<=1;if(q+=1<<Y,1===U&&q>852||2===U&&q>592)return 1;J=m&F,e[J]=i<<24|Y<<16|f-x}}return 0!==m&&(e[f+m]=z-d<<24|64<<16),Z.bits=i,0}},12118:U=>{"use strict";U.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12107:U=>{"use strict";function M(U){let M=U.length;for(;--M>=0;)U[M]=0}const b=256,a=286,A=30,H=15,W=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),y=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),O=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),x=new Array(576);M(x);const P=new Array(60);M(P);const Z=new Array(512);M(Z);const C=new Array(256);M(C);const r=new Array(29);M(r);const B=new Array(A);function J(U,M,b,a,A){this.static_tree=U,this.extra_bits=M,this.extra_base=b,this.elems=a,this.max_length=A,this.has_stree=U&&U.length}let F,f,L;function z(U,M){this.dyn_tree=U,this.max_code=0,this.stat_desc=M}M(B);const o=U=>U<256?Z[U]:Z[256+(U>>>7)],S=(U,M)=>{U.pending_buf[U.pending++]=255&M,U.pending_buf[U.pending++]=M>>>8&255},h=(U,M,b)=>{U.bi_valid>16-b?(U.bi_buf|=M<<U.bi_valid&65535,S(U,U.bi_buf),U.bi_buf=M>>16-U.bi_valid,U.bi_valid+=b-16):(U.bi_buf|=M<<U.bi_valid&65535,U.bi_valid+=b)},i=(U,M,b)=>{h(U,b[2*M],b[2*M+1])},Y=(U,M)=>{let b=0;do{b|=1&U,U>>>=1,b<<=1}while(--M>0);return b>>>1},d=(U,M,b)=>{const a=new Array(16);let A,W,y=0;for(A=1;A<=H;A++)a[A]=y=y+b[A-1]<<1;for(W=0;W<=M;W++){let M=U[2*W+1];0!==M&&(U[2*W]=Y(a[M]++,M))}},s=U=>{let M;for(M=0;M<a;M++)U.dyn_ltree[2*M]=0;for(M=0;M<A;M++)U.dyn_dtree[2*M]=0;for(M=0;M<19;M++)U.bl_tree[2*M]=0;U.dyn_ltree[512]=1,U.opt_len=U.static_len=0,U.last_lit=U.matches=0},q=U=>{U.bi_valid>8?S(U,U.bi_buf):U.bi_valid>0&&(U.pending_buf[U.pending++]=U.bi_buf),U.bi_buf=0,U.bi_valid=0},m=(U,M,b,a)=>{const A=2*M,H=2*b;return U[A]<U[H]||U[A]===U[H]&&a[M]<=a[b]},n=(U,M,b)=>{const a=U.heap[b];let A=b<<1;for(;A<=U.heap_len&&(A<U.heap_len&&m(M,U.heap[A+1],U.heap[A],U.depth)&&A++,!m(M,a,U.heap[A],U.depth));)U.heap[b]=U.heap[A],b=A,A<<=1;U.heap[b]=a},E=(U,M,a)=>{let A,H,O,e,x=0;if(0!==U.last_lit)do{A=U.pending_buf[U.d_buf+2*x]<<8|U.pending_buf[U.d_buf+2*x+1],H=U.pending_buf[U.l_buf+x],x++,0===A?i(U,H,M):(O=C[H],i(U,O+b+1,M),e=W[O],0!==e&&(H-=r[O],h(U,H,e)),A--,O=o(A),i(U,O,a),e=y[O],0!==e&&(A-=B[O],h(U,A,e)))}while(x<U.last_lit);i(U,256,M)},X=(U,M)=>{const b=M.dyn_tree,a=M.stat_desc.static_tree,A=M.stat_desc.has_stree,W=M.stat_desc.elems;let y,O,e,x=-1;for(U.heap_len=0,U.heap_max=573,y=0;y<W;y++)0!==b[2*y]?(U.heap[++U.heap_len]=x=y,U.depth[y]=0):b[2*y+1]=0;for(;U.heap_len<2;)e=U.heap[++U.heap_len]=x<2?++x:0,b[2*e]=1,U.depth[e]=0,U.opt_len--,A&&(U.static_len-=a[2*e+1]);for(M.max_code=x,y=U.heap_len>>1;y>=1;y--)n(U,b,y);e=W;do{y=U.heap[1],U.heap[1]=U.heap[U.heap_len--],n(U,b,1),O=U.heap[1],U.heap[--U.heap_max]=y,U.heap[--U.heap_max]=O,b[2*e]=b[2*y]+b[2*O],U.depth[e]=(U.depth[y]>=U.depth[O]?U.depth[y]:U.depth[O])+1,b[2*y+1]=b[2*O+1]=e,U.heap[1]=e++,n(U,b,1)}while(U.heap_len>=2);U.heap[--U.heap_max]=U.heap[1],((U,M)=>{const b=M.dyn_tree,a=M.max_code,A=M.stat_desc.static_tree,W=M.stat_desc.has_stree,y=M.stat_desc.extra_bits,O=M.stat_desc.extra_base,e=M.stat_desc.max_length;let x,P,Z,C,r,B,J=0;for(C=0;C<=H;C++)U.bl_count[C]=0;for(b[2*U.heap[U.heap_max]+1]=0,x=U.heap_max+1;x<573;x++)P=U.heap[x],C=b[2*b[2*P+1]+1]+1,C>e&&(C=e,J++),b[2*P+1]=C,P>a||(U.bl_count[C]++,r=0,P>=O&&(r=y[P-O]),B=b[2*P],U.opt_len+=B*(C+r),W&&(U.static_len+=B*(A[2*P+1]+r)));if(0!==J){do{for(C=e-1;0===U.bl_count[C];)C--;U.bl_count[C]--,U.bl_count[C+1]+=2,U.bl_count[e]--,J-=2}while(J>0);for(C=e;0!==C;C--)for(P=U.bl_count[C];0!==P;)Z=U.heap[--x],Z>a||(b[2*Z+1]!==C&&(U.opt_len+=(C-b[2*Z+1])*b[2*Z],b[2*Z+1]=C),P--)}})(U,M),d(b,x,U.bl_count)},Q=(U,M,b)=>{let a,A,H=-1,W=M[1],y=0,O=7,e=4;for(0===W&&(O=138,e=3),M[2*(b+1)+1]=65535,a=0;a<=b;a++)A=W,W=M[2*(a+1)+1],++y<O&&A===W||(y<e?U.bl_tree[2*A]+=y:0!==A?(A!==H&&U.bl_tree[2*A]++,U.bl_tree[32]++):y<=10?U.bl_tree[34]++:U.bl_tree[36]++,y=0,H=A,0===W?(O=138,e=3):A===W?(O=6,e=3):(O=7,e=4))},I=(U,M,b)=>{let a,A,H=-1,W=M[1],y=0,O=7,e=4;for(0===W&&(O=138,e=3),a=0;a<=b;a++)if(A=W,W=M[2*(a+1)+1],!(++y<O&&A===W)){if(y<e)do{i(U,A,U.bl_tree)}while(0!==--y);else 0!==A?(A!==H&&(i(U,A,U.bl_tree),y--),i(U,16,U.bl_tree),h(U,y-3,2)):y<=10?(i(U,17,U.bl_tree),h(U,y-3,3)):(i(U,18,U.bl_tree),h(U,y-11,7));y=0,H=A,0===W?(O=138,e=3):A===W?(O=6,e=3):(O=7,e=4)}};let v=!1;const t=(U,M,b,a)=>{h(U,0+(a?1:0),3),((U,M,b,a)=>{q(U),a&&(S(U,b),S(U,~b)),U.pending_buf.set(U.window.subarray(M,M+b),U.pending),U.pending+=b})(U,M,b,!0)};U.exports._tr_init=U=>{v||((()=>{let U,M,b,e,z;const o=new Array(16);for(b=0,e=0;e<28;e++)for(r[e]=b,U=0;U<1<<W[e];U++)C[b++]=e;for(C[b-1]=e,z=0,e=0;e<16;e++)for(B[e]=z,U=0;U<1<<y[e];U++)Z[z++]=e;for(z>>=7;e<A;e++)for(B[e]=z<<7,U=0;U<1<<y[e]-7;U++)Z[256+z++]=e;for(M=0;M<=H;M++)o[M]=0;for(U=0;U<=143;)x[2*U+1]=8,U++,o[8]++;for(;U<=255;)x[2*U+1]=9,U++,o[9]++;for(;U<=279;)x[2*U+1]=7,U++,o[7]++;for(;U<=287;)x[2*U+1]=8,U++,o[8]++;for(d(x,287,o),U=0;U<A;U++)P[2*U+1]=5,P[2*U]=Y(U,5);F=new J(x,W,257,a,H),f=new J(P,y,0,A,H),L=new J(new Array(0),O,0,19,7)})(),v=!0),U.l_desc=new z(U.dyn_ltree,F),U.d_desc=new z(U.dyn_dtree,f),U.bl_desc=new z(U.bl_tree,L),U.bi_buf=0,U.bi_valid=0,s(U)},U.exports._tr_stored_block=t,U.exports._tr_flush_block=(U,M,a,A)=>{let H,W,y=0;U.level>0?(2===U.strm.data_type&&(U.strm.data_type=(U=>{let M,a=4093624447;for(M=0;M<=31;M++,a>>>=1)if(1&a&&0!==U.dyn_ltree[2*M])return 0;if(0!==U.dyn_ltree[18]||0!==U.dyn_ltree[20]||0!==U.dyn_ltree[26])return 1;for(M=32;M<b;M++)if(0!==U.dyn_ltree[2*M])return 1;return 0})(U)),X(U,U.l_desc),X(U,U.d_desc),y=(U=>{let M;for(Q(U,U.dyn_ltree,U.l_desc.max_code),Q(U,U.dyn_dtree,U.d_desc.max_code),X(U,U.bl_desc),M=18;M>=3&&0===U.bl_tree[2*e[M]+1];M--);return U.opt_len+=3*(M+1)+5+5+4,M})(U),H=U.opt_len+3+7>>>3,W=U.static_len+3+7>>>3,W<=H&&(H=W)):H=W=a+5,a+4<=H&&-1!==M?t(U,M,a,A):4===U.strategy||W===H?(h(U,2+(A?1:0),3),E(U,x,P)):(h(U,4+(A?1:0),3),((U,M,b,a)=>{let A;for(h(U,M-257,5),h(U,b-1,5),h(U,a-4,4),A=0;A<a;A++)h(U,U.bl_tree[2*e[A]+1],3);I(U,U.dyn_ltree,M-1),I(U,U.dyn_dtree,b-1)})(U,U.l_desc.max_code+1,U.d_desc.max_code+1,y+1),E(U,U.dyn_ltree,U.dyn_dtree)),s(U),A&&q(U)},U.exports._tr_tally=(U,M,a)=>(U.pending_buf[U.d_buf+2*U.last_lit]=M>>>8&255,U.pending_buf[U.d_buf+2*U.last_lit+1]=255&M,U.pending_buf[U.l_buf+U.last_lit]=255&a,U.last_lit++,0===M?U.dyn_ltree[2*a]++:(U.matches++,M--,U.dyn_ltree[2*(C[a]+b+1)]++,U.dyn_dtree[2*o(M)]++),U.last_lit===U.lit_bufsize-1),U.exports._tr_align=U=>{h(U,2,3),i(U,256,x),(U=>{16===U.bi_valid?(S(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):U.bi_valid>=8&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)})(U)}},12139:U=>{"use strict";U.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12049:U=>{function M(U,M,b){for(var a=U.length,A=-1/0,H=1/0,W=0;W<a;W++){var y=(b[0][W]-U[W])/M[W],O=(b[1][W]-U[W])/M[W];if(y>O){var e=y;y=O,O=e}if(O<A||y>H)return 1/0;y>A&&(A=y),O<H&&(H=O)}return A>H?1/0:A}U.exports=function(U,b,a,A){var H=M(b,a,A);if(H===1/0)U=null;else{U=U||[];for(var W=0;W<b.length;W++)U[W]=b[W]+a[W]*H}return U},U.exports.distance=M},13051:(U,M,b)=>{"use strict";b.d(M,{d:()=>W});var a=b(35);const A=a.useLayoutEffect;const H=function(U){var M=(0,a.useRef)(U);return A((function(){M.current=U})),M};var W=function(U){var M=H(U);(0,a.Dd)((function(){var U=function(U){var b;if(null!=M.current&&(b=M.current(U)),U.defaultPrevented&&(U.returnValue=""),"string"===typeof b)return U.returnValue=b,b};return window.addEventListener("beforeunload",U),function(){window.removeEventListener("beforeunload",U)}}),[])}},12990:(U,M,b)=>{"use strict";var a=b(12998),A=Array.prototype.concat,H=Array.prototype.slice,W=U.exports=function(U){for(var M=[],b=0,W=U.length;b<W;b++){var y=U[b];a(y)?M=A.call(M,H.call(y)):M.push(y)}return M};W.wrap=function(U){return function(){return U(W(arguments))}}},12998:U=>{U.exports=function(U){return!(!U||"string"===typeof U)&&(U instanceof Array||Array.isArray(U)||U.length>=0&&(U.splice instanceof Function||Object.getOwnPropertyDescriptor(U,U.length-1)&&"String"!==U.constructor.name))}},12062:(U,M,b)=>{var a=b(12065);function A(U){for(var M,b,A=0,H=U.length,W=0;W<U.length;){for(M=U[W],b=0;W<H&&U[W]===M;)++W,++b;A+=a.log2(b)/7|0,A+=a.log2(M>>>0)/7|0,A+=2}return A}M.size=A,M.encode=function(U,M){M||(M=new Uint8Array(A(U)));for(var b,a,H=0,W=M.length,y=0;y<U.length;){for(b=U[y],a=0;y<U.length&&U[y]===b;)++y,++a;for(;H<W&&a>=128;)M[H++]=128+(127&a),a>>>=7;if(H>=W)throw new Error("RLE buffer overflow");for(M[H++]=a,b>>>=0;H<W&&b>=128;)M[H++]=128+(127&b),b>>>=7;if(H>=W)throw new Error("RLE buffer overflow");M[H++]=b}return M},M.decode=function(U,M){for(var b,a,A,H,W=M.length,y=U.length,O=0,e=0;e<y;){for(b=0,a=0;e<y&&U[e]>=128;)b+=(127&U[e++])<<a,a+=7;if(b+=U[e++]<<a,e>=y)throw new Error("RLE buffer underrun");if(O+b>W)throw new Error("Chunk buffer overflow");for(A=0,a=0;e<y&&U[e]>=128;)A+=(127&U[e++])<<a,a+=7;if(e>=y)throw new Error("RLE buffer underrun");for(A+=U[e++]<<a,H=0;H<b;++H)M[O++]=A}return M}},12065:(U,M)=>{"use strict";function b(U){var M=32;return(U&=-U)&&M--,65535&U&&(M-=16),16711935&U&&(M-=8),252645135&U&&(M-=4),858993459&U&&(M-=2),1431655765&U&&(M-=1),M}M.INT_BITS=32,M.INT_MAX=2147483647,M.INT_MIN=-1<<31,M.sign=function(U){return(U>0)-(U<0)},M.abs=function(U){var M=U>>31;return(U^M)-M},M.min=function(U,M){return M^(U^M)&-(U<M)},M.max=function(U,M){return U^(U^M)&-(U<M)},M.isPow2=function(U){return!(U&U-1)&&!!U},M.log2=function(U){var M,b;return M=(U>65535)<<4,M|=b=((U>>>=M)>255)<<3,M|=b=((U>>>=b)>15)<<2,(M|=b=((U>>>=b)>3)<<1)|(U>>>=b)>>1},M.log10=function(U){return U>=1e9?9:U>=1e8?8:U>=1e7?7:U>=1e6?6:U>=1e5?5:U>=1e4?4:U>=1e3?3:U>=100?2:U>=10?1:0},M.popCount=function(U){return 16843009*((U=(858993459&(U-=U>>>1&1431655765))+(U>>>2&858993459))+(U>>>4)&252645135)>>>24},M.countTrailingZeros=b,M.nextPow2=function(U){return U+=0===U,--U,U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)+1},M.prevPow2=function(U){return U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)-(U>>>1)},M.parity=function(U){return U^=U>>>16,U^=U>>>8,U^=U>>>4,27030>>>(U&=15)&1};var a=new Array(256);!function(U){for(var M=0;M<256;++M){var b=M,a=M,A=7;for(b>>>=1;b;b>>>=1)a<<=1,a|=1&b,--A;U[M]=a<<A&255}}(a),M.reverse=function(U){return a[255&U]<<24|a[U>>>8&255]<<16|a[U>>>16&255]<<8|a[U>>>24&255]},M.interleave2=function(U,M){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))|(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))<<1},M.deinterleave2=function(U,M){return(U=65535&((U=16711935&((U=252645135&((U=858993459&((U=U>>>M&1431655765)|U>>>1))|U>>>2))|U>>>4))|U>>>16))<<16>>16},M.interleave3=function(U,M,b){return U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2),(U|=(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},M.deinterleave3=function(U,M){return(U=1023&((U=4278190335&((U=251719695&((U=3272356035&((U=U>>>M&1227133513)|U>>>2))|U>>>4))|U>>>8))|U>>>16))<<22>>22},M.nextCombination=function(U){var M=U|U-1;return M+1|(~M&-~M)-1>>>b(U)+1}},12083:U=>{"use strict";U.exports=function(U,M,b,a){var A=self||window;try{try{var H;try{H=new A.Blob([U])}catch(e){(H=new(A.BlobBuilder||A.WebKitBlobBuilder||A.MozBlobBuilder||A.MSBlobBuilder)).append(U),H=H.getBlob()}var W=A.URL||A.webkitURL,y=W.createObjectURL(H),O=new A[M](y,b);return W.revokeObjectURL(y),O}catch(e){return new A[M]("data:application/javascript,".concat(encodeURIComponent(U)),b)}}catch(e){if(!a)throw Error("Inline worker is not supported");return new A[M](a,b)}}},12037:(U,M,b)=>{"use strict";function a(U,M,b,a,A){var H={};return Object.keys(a).forEach((function(U){H[U]=a[U]})),H.enumerable=!!H.enumerable,H.configurable=!!H.configurable,("value"in H||H.initializer)&&(H.writable=!0),H=b.slice().reverse().reduce((function(b,a){return a(U,M,b)||b}),H),A&&void 0!==H.initializer&&(H.value=H.initializer?H.initializer.call(A):void 0,H.initializer=void 0),void 0===H.initializer&&(Object.defineProperty(U,M,H),H=null),H}b.d(M,{c:()=>a})},12030:(U,M,b)=>{"use strict";function a(U,M,b,a){b&&Object.defineProperty(U,M,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(a):void 0})}b.d(M,{d:()=>a})},12641:(U,M,b)=>{"use strict";b.d(M,{d:()=>L,g:()=>J,j:()=>F,l:()=>Z,n:()=>B,r:()=>r,v:()=>C});var a=b(670),A=b(707),H=b(682),W=b(609),y=b(12643),O=b(689),e=b(2345),x=b(518),P=b(698);const Z=Object.freeze(new a.e(0,0,0,0)),C=Object.freeze(a.l.Zero()),r=Object.freeze(a.i.Zero()),B=Object.freeze(e.b.Zero()),J=Object.freeze(A.c.Black()),F=Object.freeze(new A.e(0,0,0,0)),f={key:0,repeatCount:0,loopMode:2};class L{static _PrepareAnimation(U,M,b,H,W,y,O,x){let P;if(!isNaN(parseFloat(W))&&isFinite(W)?P=L.ANIMATIONTYPE_FLOAT:W instanceof a.e?P=L.ANIMATIONTYPE_QUATERNION:W instanceof a.l?P=L.ANIMATIONTYPE_VECTOR3:W instanceof a.i?P=L.ANIMATIONTYPE_VECTOR2:W instanceof A.c?P=L.ANIMATIONTYPE_COLOR3:W instanceof A.e?P=L.ANIMATIONTYPE_COLOR4:W instanceof e.b&&(P=L.ANIMATIONTYPE_SIZE),void 0==P)return null;const Z=new L(U,M,b,P,O),C=[{frame:0,value:W},{frame:H,value:y}];return Z.setKeys(C),void 0!==x&&Z.setEasingFunction(x),Z}static CreateAnimation(U,M,b,a){const A=new L(U+"Animation",U,b,M,L.ANIMATIONLOOPMODE_CONSTANT);return A.setEasingFunction(a),A}static CreateAndStartAnimation(U,M,b,a,A,H,W,y,O,e,x){const P=L._PrepareAnimation(U,b,a,A,H,W,y,O);return P?(M.va&&(x=M.va()),x?x.beginDirectAnimation(M,[P],0,A,P.loopMode!==L.ANIMATIONLOOPMODE_CONSTANT,1,e):null):null}static CreateAndStartHierarchyAnimation(U,M,b,a,A,H,W,y,O,e,x){const P=L._PrepareAnimation(U,a,A,H,W,y,O,e);if(!P)return null;return M.va().beginDirectHierarchyAnimation(M,b,[P],0,H,1===P.loopMode,1,x)}static CreateMergeAndStartAnimation(U,M,b,a,A,H,W,y,O,e){const x=L._PrepareAnimation(U,b,a,A,H,W,y,O);return x?(M.animations.push(x),M.va().beginAnimation(M,0,A,1===x.loopMode,1,e)):null}static MakeAnimationAdditive(U,M,b){let A;A="object"===typeof M?M:{referenceFrame:M??0,range:b,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let H=U;if(A.cloneOriginalAnimation&&(H=U.clone(),H.name=A.clonedAnimationName||H.name),!H._keys.length)return H;const W=A.referenceFrame&&A.referenceFrame>=0?A.referenceFrame:0;let y=0;const O=H._keys[0];let e=H._keys.length-1;const x=H._keys[e],P={referenceValue:O.value,referencePosition:a.g.lk[0],referenceQuaternion:a.g.Quaternion[0],referenceScaling:a.g.lk[1],keyPosition:a.g.lk[2],keyQuaternion:a.g.Quaternion[1],keyScaling:a.g.lk[3]};let Z=O.frame,C=x.frame;if(A.range){const U=H.getRange(A.range);U&&(Z=U.from,C=U.to)}else Z=A.fromFrame??Z,C=A.toFrame??C;if(Z!==O.frame&&(y=H.createKeyForFrame(Z)),C!==x.frame&&(e=H.createKeyForFrame(C)),1===H._keys.length){const U=H._getKeyValue(H._keys[0]);P.referenceValue=U.clone?U.clone():U}else if(W<=O.frame){const U=H._getKeyValue(O.value);P.referenceValue=U.clone?U.clone():U}else if(W>=x.frame){const U=H._getKeyValue(x.value);P.referenceValue=U.clone?U.clone():U}else{f.key=0;const U=H._interpolate(W,f);P.referenceValue=U.clone?U.clone():U}H.dataType===L.ANIMATIONTYPE_QUATERNION?P.referenceValue.normalize().conjugateInPlace():H.dataType===L.ANIMATIONTYPE_MATRIX&&(P.referenceValue.decompose(P.referenceScaling,P.referenceQuaternion,P.referencePosition),P.referenceQuaternion.normalize().conjugateInPlace());let r=Number.MAX_VALUE;const B=A.clipKeys?[]:null;for(let J=y;J<=e;J++){let U=H._keys[J];if((B||A.cloneOriginalAnimation)&&(U={frame:U.frame,value:U.value.clone?U.value.clone():U.value,inTangent:U.inTangent,outTangent:U.outTangent,interpolation:U.interpolation,lockedTangent:U.lockedTangent},B&&(r===Number.MAX_VALUE&&(r=U.frame),U.frame-=r,B.push(U))),!J||H.dataType===L.ANIMATIONTYPE_FLOAT||U.value!==O.value)switch(H.dataType){case L.ANIMATIONTYPE_MATRIX:U.value.decompose(P.keyScaling,P.keyQuaternion,P.keyPosition),P.keyPosition.nk(P.referencePosition),P.keyScaling.divideInPlace(P.referenceScaling),P.referenceQuaternion.multiplyToRef(P.keyQuaternion,P.keyQuaternion),a.b.ComposeToRef(P.keyScaling,P.keyQuaternion,P.keyPosition,U.value);break;case L.ANIMATIONTYPE_QUATERNION:P.referenceValue.multiplyToRef(U.value,U.value);break;case L.ANIMATIONTYPE_VECTOR2:case L.ANIMATIONTYPE_VECTOR3:case L.ANIMATIONTYPE_COLOR3:case L.ANIMATIONTYPE_COLOR4:U.value.subtractToRef(P.referenceValue,U.value);break;case L.ANIMATIONTYPE_SIZE:U.value.width-=P.referenceValue.width,U.value.height-=P.referenceValue.height;break;default:U.value-=P.referenceValue}}return B&&H.setKeys(B,!0),H}static TransitionTo(U,M,b,a,A,H,W){let y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(W<=0)return b[U]=M,y&&y(),null;const O=A*(W/1e3);H.setKeys([{frame:0,value:b[U].clone?b[U].clone():b[U]},{frame:O,value:M}]),b.animations||(b.animations=[]),b.animations.push(H);const e=a.beginAnimation(b,0,O,!1);return e.onAnimationEnd=y,e}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const U of this._runtimeAnimations)if(!U.isStopped())return!0;return!1}constructor(U,M,b,a,A,H){this.name=U,this.targetProperty=M,this.framePerSecond=b,this.dataType=a,this.loopMode=A,this.enableBlending=H,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=M.split("."),this.dataType=a,this.loopMode=void 0===A?L.ANIMATIONLOOPMODE_CYCLE:A,this.uniqueId=L._UniqueIdGenerator++}toString(U){let M="Name: "+this.name+", property: "+this.targetProperty;if(M+=", datatype: "+["Float","lk","Quaternion","Matrix","Ck","Vector2"][this.dataType],M+=", nKeys: "+(this._keys?this._keys.length:"none"),M+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),U){M+=", Ranges: {";let U=!0;for(const b in this._ranges)U&&(M+=", ",U=!1),M+=b;M+="}"}return M}addEvent(U){this._events.push(U),this._events.sort(((U,M)=>U.frame-M.frame))}removeEvents(U){for(let M=0;M<this._events.length;M++)this._events[M].frame===U&&(this._events.splice(M,1),M--)}getEvents(){return this._events}createRange(U,M,b){this._ranges[U]||(this._ranges[U]=new y.c(U,M,b))}deleteRange(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._ranges[U];if(b){if(M){const U=b.from,M=b.to;for(let b=this._keys.length-1;b>=0;b--)this._keys[b].frame>=U&&this._keys[b].frame<=M&&this._keys.splice(b,1)}this._ranges[U]=null}}getRange(U){return this._ranges[U]}getKeys(){return this._keys}getHighestFrame(){let U=0;for(let M=0,b=this._keys.length;M<b;M++)U<this._keys[M].frame&&(U=this._keys[M].frame);return U}getEasingFunction(){return this._easingFunction}setEasingFunction(U){this._easingFunction=U}floatInterpolateFunction(U,M,b){return(0,H.n)(U,M,b)}floatInterpolateFunctionWithTangents(U,M,b,a,A){return(0,H.f)(U,M,b,a,A)}quaternionInterpolateFunction(U,M,b){return a.e.Slerp(U,M,b)}quaternionInterpolateFunctionWithTangents(U,M,b,A,H){return a.e.Hermite(U,M,b,A,H).normalize()}vector3InterpolateFunction(U,M,b){return a.l.Lerp(U,M,b)}vector3InterpolateFunctionWithTangents(U,M,b,A,H){return a.l.Hermite(U,M,b,A,H)}vector2InterpolateFunction(U,M,b){return a.i.Lerp(U,M,b)}vector2InterpolateFunctionWithTangents(U,M,b,A,H){return a.i.Hermite(U,M,b,A,H)}sizeInterpolateFunction(U,M,b){return e.b.Lerp(U,M,b)}color3InterpolateFunction(U,M,b){return A.c.Lerp(U,M,b)}color3InterpolateFunctionWithTangents(U,M,b,a,H){return A.c.Hermite(U,M,b,a,H)}color4InterpolateFunction(U,M,b){return A.e.Lerp(U,M,b)}color4InterpolateFunctionWithTangents(U,M,b,a,H){return A.e.Hermite(U,M,b,a,H)}_getKeyValue(U){return"function"===typeof U?U():U}evaluate(U){return f.key=0,this._interpolate(U,f)}_interpolate(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(M.loopMode===L.ANIMATIONLOOPMODE_CONSTANT&&M.repeatCount>0)return M.highLimitValue.clone?M.highLimitValue.clone():M.highLimitValue;const a=this._keys;let A;if(this._coreAnimation)A=this._coreAnimation._key;else{const H=a.length;for(A=M.key;A>=0&&U<a[A].frame;)--A;for(;A+1<=H-1&&U>=a[A+1].frame;)++A;if(M.key=A,A<0)return b?void 0:this._getKeyValue(a[0].value);if(A+1>H-1)return b?void 0:this._getKeyValue(a[H-1].value);this._key=A}const H=a[A],W=a[A+1];if(b&&(U===H.frame||U===W.frame))return;const y=this._getKeyValue(H.value),O=this._getKeyValue(W.value);if(1===H.interpolation)return W.frame>U?y:O;const e=void 0!==H.outTangent&&void 0!==W.inTangent,x=W.frame-H.frame;let P=(U-H.frame)/x;const f=H.easingFunction||this.getEasingFunction();switch(f&&(P=f.ease(P)),this.dataType){case L.ANIMATIONTYPE_FLOAT:{const U=e?this.floatInterpolateFunctionWithTangents(y,H.outTangent*x,O,W.inTangent*x,P):this.floatInterpolateFunction(y,O,P);switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return U;case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(M.offsetValue??0)*M.repeatCount+U}break}case L.ANIMATIONTYPE_QUATERNION:{const U=e?this.quaternionInterpolateFunctionWithTangents(y,H.outTangent.scale(x),O,W.inTangent.scale(x),P):this.quaternionInterpolateFunction(y,O,P);switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return U;case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return U.addInPlace((M.offsetValue||Z).scale(M.repeatCount))}return U}case L.ANIMATIONTYPE_VECTOR3:{const U=e?this.vector3InterpolateFunctionWithTangents(y,H.outTangent.scale(x),O,W.inTangent.scale(x),P):this.vector3InterpolateFunction(y,O,P);switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return U;case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return U.add((M.offsetValue||C).scale(M.repeatCount))}break}case L.ANIMATIONTYPE_VECTOR2:{const U=e?this.vector2InterpolateFunctionWithTangents(y,H.outTangent.scale(x),O,W.inTangent.scale(x),P):this.vector2InterpolateFunction(y,O,P);switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return U;case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return U.add((M.offsetValue||r).scale(M.repeatCount))}break}case L.ANIMATIONTYPE_SIZE:switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(y,O,P);case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(y,O,P).add((M.offsetValue||B).scale(M.repeatCount))}break;case L.ANIMATIONTYPE_COLOR3:{const U=e?this.color3InterpolateFunctionWithTangents(y,H.outTangent.scale(x),O,W.inTangent.scale(x),P):this.color3InterpolateFunction(y,O,P);switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return U;case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return U.add((M.offsetValue||J).scale(M.repeatCount))}break}case L.ANIMATIONTYPE_COLOR4:{const U=e?this.color4InterpolateFunctionWithTangents(y,H.outTangent.scale(x),O,W.inTangent.scale(x),P):this.color4InterpolateFunction(y,O,P);switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return U;case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return U.add((M.offsetValue||F).scale(M.repeatCount))}break}case L.ANIMATIONTYPE_MATRIX:switch(M.loopMode){case L.ANIMATIONLOOPMODE_CYCLE:case L.ANIMATIONLOOPMODE_CONSTANT:case L.ANIMATIONLOOPMODE_YOYO:return L.AllowMatricesInterpolation?this.matrixInterpolateFunction(y,O,P,M.workValue):y;case L.ANIMATIONLOOPMODE_RELATIVE:case L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return y}}return 0}matrixInterpolateFunction(U,M,b,A){return L.AllowMatrixDecomposeForInterpolation?A?(a.b.DecomposeLerpToRef(U,M,b,A),A):a.b.DecomposeLerp(U,M,b):A?(a.b.LerpToRef(U,M,b,A),A):a.b.Lerp(U,M,b)}clone(){const U=new L(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(U.enableBlending=this.enableBlending,U.blendingSpeed=this.blendingSpeed,this._keys&&U.setKeys(this._keys),this._ranges){U._ranges={};for(const M in this._ranges){const b=this._ranges[M];b&&(U._ranges[M]=b.clone())}}return U}setKeys(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=M?U:U.slice(0)}createKeyForFrame(U){f.key=0;const M=this._interpolate(U,f,!0);if(!M)return this._keys[f.key].frame===U?f.key:f.key+1;const b={frame:U,value:M.clone?M.clone():M};return this._keys.splice(f.key+1,0,b),f.key+1}serialize(){const U={};U.name=this.name,U.property=this.targetProperty,U.framePerSecond=this.framePerSecond,U.dataType=this.dataType,U.loopBehavior=this.loopMode,U.enableBlending=this.enableBlending,U.blendingSpeed=this.blendingSpeed;const M=this.dataType;U.keys=[];const b=this.getKeys();for(let a=0;a<b.length;a++){const A=b[a],H={};switch(H.frame=A.frame,M){case L.ANIMATIONTYPE_FLOAT:H.values=[A.value],void 0!==A.inTangent&&H.values.push(A.inTangent),void 0!==A.outTangent&&(void 0===A.inTangent&&H.values.push(void 0),H.values.push(A.outTangent)),void 0!==A.interpolation&&(void 0===A.inTangent&&H.values.push(void 0),void 0===A.outTangent&&H.values.push(void 0),H.values.push(A.interpolation));break;case L.ANIMATIONTYPE_QUATERNION:case L.ANIMATIONTYPE_MATRIX:case L.ANIMATIONTYPE_VECTOR3:case L.ANIMATIONTYPE_COLOR3:case L.ANIMATIONTYPE_COLOR4:H.values=A.value.tk(),void 0!=A.inTangent&&H.values.push(A.inTangent.tk()),void 0!=A.outTangent&&(void 0===A.inTangent&&H.values.push(void 0),H.values.push(A.outTangent.tk())),void 0!==A.interpolation&&(void 0===A.inTangent&&H.values.push(void 0),void 0===A.outTangent&&H.values.push(void 0),H.values.push(A.interpolation))}U.keys.push(H)}U.ranges=[];for(const a in this._ranges){const M=this._ranges[a];if(!M)continue;const b={};b.name=a,b.from=M.from,b.to=M.to,U.ranges.push(b)}return U}static _UniversalLerp(U,M,b){const a=U.constructor;return a.Lerp?a.Lerp(U,M,b):a.Slerp?a.Slerp(U,M,b):U.toFixed?U*(1-b)+b*M:M}static Parse(U){const M=new L(U.name,U.property,U.framePerSecond,U.dataType,U.loopBehavior),b=U.dataType,H=[];let W,y;for(U.enableBlending&&(M.enableBlending=U.enableBlending),U.blendingSpeed&&(M.blendingSpeed=U.blendingSpeed),y=0;y<U.keys.length;y++){const M=U.keys[y];let O,e,x;switch(b){case L.ANIMATIONTYPE_FLOAT:W=M.values[0],M.values.length>=2&&(O=M.values[1]),M.values.length>=3&&(e=M.values[2]),M.values.length>=4&&(x=M.values[3]);break;case L.ANIMATIONTYPE_QUATERNION:if(W=a.e.jk(M.values),M.values.length>=8){const U=a.e.jk(M.values.slice(4,8));U.equals(a.e.Zero())||(O=U)}if(M.values.length>=12){const U=a.e.jk(M.values.slice(8,12));U.equals(a.e.Zero())||(e=U)}M.values.length>=13&&(x=M.values[12]);break;case L.ANIMATIONTYPE_MATRIX:W=a.b.jk(M.values),M.values.length>=17&&(x=M.values[16]);break;case L.ANIMATIONTYPE_COLOR3:W=A.c.jk(M.values),M.values[3]&&(O=A.c.jk(M.values[3])),M.values[4]&&(e=A.c.jk(M.values[4])),M.values[5]&&(x=M.values[5]);break;case L.ANIMATIONTYPE_COLOR4:W=A.e.jk(M.values),M.values[4]&&(O=A.e.jk(M.values[4])),M.values[5]&&(e=A.e.jk(M.values[5])),M.values[6]&&(x=A.e.jk(M.values[6]));break;case L.ANIMATIONTYPE_VECTOR3:default:W=a.l.jk(M.values),M.values[3]&&(O=a.l.jk(M.values[3])),M.values[4]&&(e=a.l.jk(M.values[4])),M.values[5]&&(x=M.values[5])}const P={};P.frame=M.frame,P.value=W,void 0!=O&&(P.inTangent=O),void 0!=e&&(P.outTangent=e),void 0!=x&&(P.interpolation=x),H.push(P)}if(M.setKeys(H),U.ranges)for(y=0;y<U.ranges.length;y++)W=U.ranges[y],M.createRange(W.name,W.from,W.to);return M}static AppendSerializedAnimations(U,M){P.d.AppendSerializedAnimations(U,M)}static async ParseFromFileAsync(U,M){return await new Promise(((b,a)=>{const A=new x.c;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){let M=JSON.parse(A.responseText);if(M.animations&&(M=M.animations),M.length){const U=[];for(const b of M)U.push(this.Parse(b));b(U)}else{const a=this.Parse(M);U&&(a.name=U),b(a)}}else a("Unable to load the animation")})),A.open("GET",M),A.send()}))}static async ParseFromSnippetAsync(U){return await new Promise(((M,b)=>{const a=new x.c;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const b=JSON.parse(JSON.parse(a.responseText).jsonPayload);if(b.animations){const a=JSON.parse(b.animations),A=[];for(const M of a.animations){const b=this.Parse(M);b.snippetId=U,A.push(b)}M(A)}else{const a=JSON.parse(b.animation),A=this.Parse(a);A.snippetId=U,M(A)}}else b("Unable to load the snippet "+U)})),a.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),a.send()}))}}L._UniqueIdGenerator=0,L.AllowMatricesInterpolation=!1,L.AllowMatrixDecomposeForInterpolation=!0,L.SnippetUrl="https://snippet.babylonjs.com",L.ANIMATIONTYPE_FLOAT=0,L.ANIMATIONTYPE_VECTOR3=1,L.ANIMATIONTYPE_QUATERNION=2,L.ANIMATIONTYPE_MATRIX=3,L.ANIMATIONTYPE_COLOR3=4,L.ANIMATIONTYPE_COLOR4=7,L.ANIMATIONTYPE_VECTOR2=5,L.ANIMATIONTYPE_SIZE=6,L.ANIMATIONLOOPMODE_RELATIVE=0,L.ANIMATIONLOOPMODE_CYCLE=1,L.ANIMATIONLOOPMODE_CONSTANT=2,L.ANIMATIONLOOPMODE_YOYO=4,L.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,L.CreateFromSnippetAsync=L.ParseFromSnippetAsync,(0,W.i)("BABYLON.Animation",L),O.e._AnimationRangeFactory=(U,M,b)=>new y.c(U,M,b)},12643:(U,M,b)=>{"use strict";b.d(M,{c:()=>a});class a{constructor(U,M,b){this.name=U,this.from=M,this.to=b}clone(){return new a(this.name,this.from,this.to)}}},13035:(U,M,b)=>{"use strict";b.d(M,{b:()=>W,e:()=>P,g:()=>y,h:()=>H,i:()=>O,l:()=>A,p:()=>e,t:()=>x});var a=b(2340);class A{constructor(){this._easingMode=A.EASINGMODE_EASEIN}setEasingMode(U){const M=Math.min(Math.max(U,0),2);this._easingMode=M}getEasingMode(){return this._easingMode}easeInCore(U){throw new Error("You must implement this method")}ease(U){switch(this._easingMode){case A.EASINGMODE_EASEIN:return this.easeInCore(U);case A.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-U)}return U>=.5?.5*(1-this.easeInCore(2*(1-U)))+.5:.5*this.easeInCore(2*U)}}A.EASINGMODE_EASEIN=0,A.EASINGMODE_EASEOUT=1,A.EASINGMODE_EASEINOUT=2;class H extends A{easeInCore(U){return U=Math.max(0,Math.min(1,U)),1-Math.sqrt(1-U*U)}}class W extends A{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=U}easeInCore(U){const M=Math.max(0,this.amplitude);return Math.pow(U,3)-U*M*Math.sin(3.141592653589793*U)}}class y extends A{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=U,this.bounciness=M}easeInCore(U){const M=Math.max(0,this.bounces);let b=this.bounciness;b<=1&&(b=1.001);const a=Math.pow(b,M),A=1-b,H=(1-a)/A+.5*a,W=U*H,y=Math.log(-W*(1-b)+1)/Math.log(b),O=Math.floor(y),e=O+1,x=(1-Math.pow(b,O))/(A*H),P=.5*(x+(1-Math.pow(b,e))/(A*H)),Z=U-P,C=P-x;return-Math.pow(1/b,M-O)/(C*C)*(Z-C)*(Z+C)}}class O extends A{easeInCore(U){return U*U*U}}class e extends A{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=U,this.springiness=M}easeInCore(U){let M;const b=Math.max(0,this.oscillations),a=Math.max(0,this.springiness);return M=0==a?U:(Math.exp(a*U)-1)/(Math.exp(a)-1),M*Math.sin((6.283185307179586*b+1.5707963267948966)*U)}}class x extends A{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=U}easeInCore(U){return this.exponent<=0?U:(Math.exp(this.exponent*U)-1)/(Math.exp(this.exponent)-1)}}class P extends A{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=U,this.y1=M,this.x2=b,this.y2=a}easeInCore(U){return a.c.Interpolate(U,this.x1,this.y1,this.x2,this.y2)}}},12632:(U,M,b)=>{"use strict";b.d(M,{d:()=>W});var a=b(670),A=b(679),H=b(689);class W extends H.e{get _matrix(){return this._compose(),this.Uk}set _matrix(U){(U.updateFlag!==this.Uk.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Uk.p(U),this._markAsDirtyAndDecompose())}constructor(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(U,M.va(),!1),this.name=U,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=M,this.Uk=(null===A||void 0===A?void 0:A.clone())??a.b.Identity(),this._restMatrix=H??this.Uk.clone(),this._bindMatrix=W??this.Uk.clone(),this._index=y,this._absoluteMatrix=new a.b,this._absoluteBindMatrix=new a.b,this._absoluteInverseBindMatrix=new a.b,this._finalMatrix=new a.b,M.bones.push(this),this.setParent(b,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(U){this.setParent(U)}setParent(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==U){if(this.parent){const U=this.parent.children.indexOf(this);-1!==U&&this.parent.children.splice(U,1)}this._parentNode=U,this.parent&&this.parent.children.push(this),M&&this._updateAbsoluteBindMatrices(),this.hk()}}getLocalMatrix(){return this._compose(),this.Uk}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(U){this._restMatrix.p(U)}setRestPose(U){this.setRestMatrix(U)}getBindPose(){return this.getBindMatrix()}setBindMatrix(U){this.zk(U)}setBindPose(U){this.setBindMatrix(U)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const U=a.g.lk[0],M=a.g.Quaternion[0],b=a.g.lk[1];this.getRestMatrix().decompose(U,M,b),this._linkedTransformNode.position.p(b),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??a.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(M),this._linkedTransformNode.zd.p(U)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(U){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=U,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ud}set position(U){this._decompose(),this.ud.p(U),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(U){this.setRotation(U)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(U){this.setRotationQuaternion(U)}get zd(){return this.getScale()}set zd(U){this.setScale(U)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=a.l.Zero(),this._localRotation=a.e.Zero(),this.ud=a.l.Zero()),this.Uk.decompose(this._localScaling,this._localRotation,this.ud))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,a.b.ComposeToRef(this._localScaling,this._localRotation,this.ud,this.Uk)):this._needToCompose=!1)}zk(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(U),M&&this._updateAbsoluteBindMatrices(),b?this._matrix=U:this.hk()}_updateAbsoluteBindMatrices(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U||(U=this._bindMatrix),this.parent?U.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(U),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),M)for(let b=0;b<this.children.length;b++)this.children[b]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}hk(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.hk(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.hk(),this._needToDecompose=!0}_updatePosition(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const H=this.getLocalMatrix();if(0==M)A?(H.addAtIndex(12,U.x),H.addAtIndex(13,U.y),H.addAtIndex(14,U.z)):H.setTranslationFromFloats(U.x,U.y,U.z);else{let M=null;b&&(M=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=W._TmpMats[0],O=W._TmpVecs[0];this.parent?b&&M?(y.p(this.parent.getAbsoluteMatrix()),y.multiplyToRef(M,y)):y.p(this.parent.getAbsoluteMatrix()):a.b.IdentityToRef(y),A&&y.setTranslationFromFloats(0,0,0),y.invert(),a.l.TransformCoordinatesToRef(U,y,O),A?(H.addAtIndex(12,O.x),H.addAtIndex(13,O.y),H.addAtIndex(14,O.z)):H.setTranslationFromFloats(O.x,O.y,O.z)}this._markAsDirtyAndDecompose()}translate(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,M,b,!0)}setPosition(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,M,b,!1)}setAbsolutePosition(U,M){this.setPosition(U,1,M)}scale(U,M,b){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const H=this.getLocalMatrix(),y=W._TmpMats[0];a.b.ScalingToRef(U,M,b,y),y.multiplyToRef(H,H),y.invert();for(const a of this.children){const A=a.getLocalMatrix();A.multiplyToRef(y,A),A.multiplyAtIndex(12,U),A.multiplyAtIndex(13,M),A.multiplyAtIndex(14,b),a._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),A)for(const a of this.children)a.scale(U,M,b,A)}setScale(U){this._decompose(),this._localScaling.p(U),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(U){this._decompose(),U.p(this._localScaling)}setYawPitchRoll(U,M,b){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4?arguments[4]:void 0;if(0===A){const y=W._TmpQuat;return a.e.RotationYawPitchRollToRef(U,M,b,y),void this.setRotationQuaternion(y,A,H)}const y=W._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(y,H))return;const O=W._TmpMats[1];a.b.RotationYawPitchRollToRef(U,M,b,O),y.multiplyToRef(O,O),this._rotateWithMatrix(O,A,H)}rotate(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;const H=W._TmpMats[0];H.setTranslationFromFloats(0,0,0),a.b.RotationAxisToRef(U,M,H),this._rotateWithMatrix(H,b,A)}setAxisAngle(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3?arguments[3]:void 0;if(0===b){const H=W._TmpQuat;return a.e.RotationAxisToRef(U,M,H),void this.setRotationQuaternion(H,b,A)}const H=W._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(H,A))return;const y=W._TmpMats[1];a.b.RotationAxisToRef(U,M,y),H.multiplyToRef(y,y),this._rotateWithMatrix(y,b,A)}setRotation(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(U.y,U.x,U.z,M,b)}setRotationQuaternion(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===M)return this._decompose(),this._localRotation.p(U),void this._markAsDirtyAndCompose();const A=W._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,b))return;const H=W._TmpMats[1];a.b.FromQuaternionToRef(U,H),A.multiplyToRef(H,H),this._rotateWithMatrix(H,M,b)}setRotationMatrix(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===M){const A=W._TmpQuat;return a.e.FromRotationMatrixToRef(U,A),void this.setRotationQuaternion(A,M,b)}const A=W._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,b))return;const H=W._TmpMats[1];H.p(U),A.multiplyToRef(U,H),this._rotateWithMatrix(H,M,b)}_rotateWithMatrix(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const a=this.getLocalMatrix(),A=a.m[12],H=a.m[13],y=a.m[14],O=this.getParent(),e=W._TmpMats[3],x=W._TmpMats[4];O&&1==M?(b?(e.p(b.getWorldMatrix()),O.getAbsoluteMatrix().multiplyToRef(e,e)):e.p(O.getAbsoluteMatrix()),x.p(e),x.invert(),a.multiplyToRef(e,a),a.multiplyToRef(U,a),a.multiplyToRef(x,a)):1==M&&b?(e.p(b.getWorldMatrix()),x.p(e),x.invert(),a.multiplyToRef(e,a),a.multiplyToRef(U,a),a.multiplyToRef(x,a)):a.multiplyToRef(U,a),a.setTranslationFromFloats(A,H,y),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(U,M){const b=W._TmpMats[2];return U.p(this.getAbsoluteMatrix()),M?(U.multiplyToRef(M.getWorldMatrix(),U),a.b.ScalingToRef(M.zd.x,M.zd.y,M.zd.z,b)):a.b.IdentityToRef(b),U.invert(),!isNaN(U.m[0])&&(b.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyToRef(b,U),!0)}Zg(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=a.l.Zero();return this.getPositionToRef(U,M,b),b}getPositionToRef(){let U=arguments.length>1?arguments[1]:void 0,M=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const U=this.getLocalMatrix();M.x=U.m[12],M.y=U.m[13],M.z=U.m[14]}else{let b=null;U&&(b=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let a=W._TmpMats[0];U&&b?(a.p(this.getAbsoluteMatrix()),a.multiplyToRef(b,a)):a=this.getAbsoluteMatrix(),M.x=a.m[12],M.y=a.m[13],M.z=a.m[14]}}getAbsolutePosition(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const M=a.l.Zero();return this.getPositionToRef(1,U,M),M}getAbsolutePositionToRef(U,M){this.getPositionToRef(1,U,M)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Uk.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Uk);const U=this._skeleton.getPoseMatrix();U&&this._absoluteMatrix.multiplyToRef(U,this._absoluteMatrix)}const U=this.children,M=U.length;for(let b=0;b<M;b++)U[b].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}jh(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=a.l.Zero();return this.getDirectionToRef(U,M,b),b}getDirectionToRef(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,A=null;M&&(A=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=W._TmpMats[0];H.p(this.getAbsoluteMatrix()),M&&A&&H.multiplyToRef(A,H),a.l.TransformNormalToRef(U,H,b),b.normalize()}getRotation(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=a.l.Zero();return this.getRotationToRef(U,M,b),b}getRotationToRef(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const a=W._TmpQuat;this.getRotationQuaternionToRef(U,M,a),a.toEulerAnglesToRef(b)}getRotationQuaternion(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=a.e.Identity();return this.getRotationQuaternionToRef(U,M,b),b}getRotationQuaternionToRef(){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),M.p(this._localRotation);else{const b=W._TmpMats[0],a=this.getAbsoluteMatrix();U?a.multiplyToRef(U.getWorldMatrix(),b):b.p(a),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,M,void 0)}}getRotationMatrix(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1?arguments[1]:void 0;const b=a.b.Identity();return this.getRotationMatrixToRef(U,M,b),b}getRotationMatrixToRef(){let U=arguments.length>1?arguments[1]:void 0,M=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(M);else{const b=W._TmpMats[0],a=this.getAbsoluteMatrix();U?a.multiplyToRef(U.getWorldMatrix(),b):b.p(a),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(M)}}getAbsolutePositionFromLocal(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=a.l.Zero();return this.getAbsolutePositionFromLocalToRef(U,M,b),b}getAbsolutePositionFromLocalToRef(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,A=null;M&&(A=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=W._TmpMats[0];H.p(this.getAbsoluteMatrix()),M&&A&&H.multiplyToRef(A,H),a.l.TransformCoordinatesToRef(U,H,b)}getLocalPositionFromAbsolute(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=a.l.Zero();return this.getLocalPositionFromAbsoluteToRef(U,M,b),b}getLocalPositionFromAbsoluteToRef(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,A=null;M&&(A=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const H=W._TmpMats[0];H.p(this.getAbsoluteMatrix()),M&&A&&H.multiplyToRef(A,H),H.invert(),a.l.TransformCoordinatesToRef(U,H,b)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const U=this._skeleton.bones.indexOf(this);if(-1!==U&&this._skeleton.bones.splice(U,1),this._parentNode&&this._parentNode.children){const U=this._parentNode.children,M=U.indexOf(this);-1!==M&&U.splice(M,1)}super.dispose()}}W._TmpVecs=(0,A.b)(2,a.l.Zero),W._TmpQuat=a.e.Identity(),W._TmpMats=(0,A.b)(5,a.b.Identity)},13029:(U,M,b)=>{"use strict";b.d(M,{b:()=>X});var a=b(645),A=b(652),H=b(474),W=b(670),y=b(682),O=b(689),e=b(470),x=b(2517),P=b(503),Z=b(677);class C{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(U){this._idleRotationSpeed=U}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(U){this._idleRotationWaitTime=U}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(U){this._idleRotationSpinupTime=U}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(U){this._attachedCamera=U;const M=this._attachedCamera.va();this._onPrePointerObservableObserver=M.onPrePointerObservable.add((U=>{U.type!==x.c.POINTERDOWN?U.type===x.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const U=P.b.Now;let M=0;null!=this._lastFrameTime&&(M=U-this._lastFrameTime),this._lastFrameTime=U,this._applyUserInteraction();const b=U-this._lastInteractionTime-this._idleRotationWaitTime,a=Math.max(Math.min(b/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*a,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(M/1e3))}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.va();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(U){this._lastInteractionTime=U??P.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Z.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let U=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(U=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?U:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=P.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var r=b(13035),B=b(12641);class J{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(U){if(this._autoTransitionRange===U)return;this._autoTransitionRange=U;const M=this._attachedCamera;M&&(U?this._onMeshTargetChangedObserver=M.onMeshTargetChangedObservable.add((U=>{if(U&&(U.ik(!0),U.getBoundingInfo)){const M=U.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*M,this.upperRadiusTransitionRange=.05*M}})):this._onMeshTargetChangedObserver&&M.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(U){this._attachedCamera=U,this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(U){return!!this._attachedCamera&&(this._attachedCamera.radius===U&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(U){if(!this._attachedCamera)return;this._radiusBounceTransition||(J.EasingFunction.setEasingMode(J.EasingMode),this._radiusBounceTransition=B.d.CreateAnimation("radius",B.d.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const M=B.d.TransitionTo("radius",this._attachedCamera.radius+U,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));M&&this._animatables.push(M)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}J.EasingFunction=new r.b(.3),J.EasingMode=r.l.EASINGMODE_EASEOUT;class F{constructor(){this.onTargetFramingAnimationEndObservable=new H.e,this._mode=F.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(U){this._mode=U}get mode(){return this._mode}set radiusScale(U){this._radiusScale=U}get radiusScale(){return this._radiusScale}set positionScale(U){this._positionScale=U}get positionScale(){return this._positionScale}set defaultElevation(U){this._defaultElevation=U}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(U){this._elevationReturnTime=U}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(U){this._elevationReturnWaitTime=U}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(U){this._framingTime=U}get framingTime(){return this._framingTime}init(){}attach(U){this._attachedCamera=U;const M=this._attachedCamera.va();F.EasingFunction.setEasingMode(F.EasingMode),this._onPrePointerObservableObserver=M.onPrePointerObservable.add((U=>{U.type!==x.c.POINTERDOWN?U.type===x.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((U=>{U&&U.getBoundingInfo&&this.zoomOnMesh(U,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.va();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.ik(!0);const a=U.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(a.minimumWorld,a.maximumWorld,M,b)}zoomOnMeshHierarchy(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.ik(!0);const a=U.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(a.min,a.max,M,b)}zoomOnMeshesHierarchy(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new W.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new W.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let H=0;H<U.length;H++){const M=U[H].getHierarchyBoundingVectors(!0);W.l.CheckExtends(M.min,a,A),W.l.CheckExtends(M.max,a,A)}this.zoomOnBoundingInfo(a,A,M,b)}zoomOnBoundingInfo(U,M){let b,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const H=U.y,y=H+(M.y-H)*this._positionScale,O=M.je(U).scale(.5);if(!isFinite(y))return!1;if(a)b=new W.l(0,y,0);else{const M=U.add(O);b=new W.l(M.x,y,M.z)}this._vectorTransition||(this._vectorTransition=B.d.CreateAnimation("target",B.d.ANIMATIONTYPE_VECTOR3,60,F.EasingFunction)),this._betaIsAnimating=!0;let e=B.d.TransitionTo("target",b,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);e&&this._animatables.push(e);let x=0;if(this._mode===F.FitFrustumSidesMode){const b=this._calculateLowerRadiusFromModelBoundingSphere(U,M);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=O.length()+this._attachedCamera.ek),x=b}else this._mode===F.IgnoreBoundsSizeMode&&(x=this._calculateLowerRadiusFromModelBoundingSphere(U,M),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ek));if(this.autoCorrectCameraLimitsAndSensibility){const b=M.je(U).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/x}return this._radiusTransition||(this._radiusTransition=B.d.CreateAnimation("radius",B.d.ANIMATIONTYPE_FLOAT,60,F.EasingFunction)),e=B.d.TransitionTo("radius",x,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),A&&A(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),e&&this._animatables.push(e),!0}_calculateLowerRadiusFromModelBoundingSphere(U,M){const b=this._attachedCamera;if(!b)return 0;let a=b._calculateLowerRadiusFromModelBoundingSphere(U,M,this._radiusScale);return b.lowerRadiusLimit&&this._mode===F.IgnoreBoundsSizeMode&&(a=a<b.lowerRadiusLimit?b.lowerRadiusLimit:a),b.upperRadiusLimit&&(a=a>b.upperRadiusLimit?b.upperRadiusLimit:a),a}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const U=P.b.Now-this._lastInteractionTime,M=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&U>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=B.d.CreateAnimation("beta",B.d.ANIMATIONTYPE_FLOAT,60,F.EasingFunction));const U=B.d.TransitionTo("beta",M,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));U&&this._animatables.push(U)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=P.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}F.EasingFunction=new r.t,F.EasingMode=r.l.EASINGMODE_EASEINOUT,F.IgnoreBoundsSizeMode=0,F.FitFrustumSidesMode=1;var f=b(639),L=b(12623),z=b(12630),o=b(479);class S{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(U){U=o.d.BackCompatCameraNoPreventDefault(arguments);const M=this.camera.getEngine(),b=M.getInputElement();let a=0,A=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=H=>{var W,y;const O=H.event,e="touch"===O.pointerType;if(H.type!==x.c.POINTERMOVE&&-1===this.buttons.indexOf(O.button))return;const P=O.target;if(this._altKey=O.altKey,this._ctrlKey=O.ctrlKey,this._metaKey=O.metaKey,this._shiftKey=O.shiftKey,this._buttonsPressed=O.buttons,M.isPointerLock){const U=O.movementX,M=O.movementY;this.onTouch(null,U,M),this._pointA=null,this._pointB=null}else{if(H.type!==x.c.POINTERDOWN&&H.type!==x.c.POINTERDOUBLETAP&&e&&(null===(W=this._pointA)||void 0===W?void 0:W.pointerId)!==O.pointerId&&(null===(y=this._pointB)||void 0===y?void 0:y.pointerId)!==O.pointerId)return;if(H.type!==x.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!e)if(H.type===x.c.POINTERDOUBLETAP)this.onDoubleTap(O.pointerType);else if(H.type!==x.c.POINTERUP||this._currentMousePointerIdDown!==O.pointerId&&!e){if(H.type===x.c.POINTERMOVE)if(U||O.preventDefault(),this._pointA&&null===this._pointB){const U=O.clientX-this._pointA.x,M=O.clientY-this._pointA.y;this._pointA.x=O.clientX,this._pointA.y=O.clientY,this.onTouch(this._pointA,U,M)}else if(this._pointA&&this._pointB){const U=this._pointA.pointerId===O.pointerId?this._pointA:this._pointB;U.x=O.clientX,U.y=O.clientY;const M=this._pointA.x-this._pointB.x,b=this._pointA.y-this._pointB.y,W=M*M+b*b,y={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:O.pointerId,type:H.type};this.onMultiTouch(this._pointA,this._pointB,a,W,A,y),A=y,a=W}}else{try{null===P||void 0===P||P.releasePointerCapture(O.pointerId)}catch(Z){}e||(this._pointB=null),M._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==O.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==O.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==a||A)&&(this.onMultiTouch(this._pointA,this._pointB,a,0,A,null),a=0,A=null),this._currentMousePointerIdDown=-1,this.onButtonUp(O),U||O.preventDefault()}else{try{null===P||void 0===P||P.setPointerCapture(O.pointerId)}catch(Z){}if(null===this._pointA)this._pointA={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType};else{if(null!==this._pointB)return;this._pointB={x:O.clientX,y:O.clientY,pointerId:O.pointerId,type:O.pointerType}}-1!==this._currentMousePointerIdDown||e||(this._currentMousePointerIdDown=O.pointerId),this.onButtonDown(O),U||(O.preventDefault(),b&&b.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,x.c.POINTERDOWN|x.c.POINTERUP|x.c.POINTERMOVE|x.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,a=0,A=null,this.onLostFocus()},this._contextMenuBind=U=>this.onContextMenu(U),b&&b.addEventListener("contextmenu",this._contextMenuBind,!1);const H=this.camera.va().getEngine().getHostWindow();H&&o.d.RegisterTopRootEvents(H,[{name:"blur",handler:this._onLostFocus}])}gk(){if(this._onLostFocus){const U=this.camera.va().getEngine().getHostWindow();U&&o.d.UnregisterTopRootEvents(U,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const U=this.camera.va().getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(U){}onTouch(U,M,b){}onMultiTouch(U,M,b,a,A,H){}onContextMenu(U){U.preventDefault()}onButtonDown(U){}onButtonUp(U){}onLostFocus(){}}(0,a.c)([(0,A.J)()],S.prototype,"buttons",void 0);class h extends S{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(U,M){if(0!==this.panningSensibility&&U&&M){const b=M.x-U.x,a=M.y-U.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=a/this.panningSensibility}}_computePinchZoom(U,M){const b=this.camera.radius||h.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=b*Math.sqrt(U)/Math.sqrt(M):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(M-U)*b*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(M-U)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(U,M,b){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-M/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility):(this.camera.inertialAlphaOffset-=M/this.angularSensibilityX,this.camera.inertialBetaOffset-=b/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(U,M,b,a,A,H){0===b&&null===A||0===a&&null===H||(this.multiTouchPanAndZoom?(this._computePinchZoom(b,a),this._computeMultiTouchPanning(A,H)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(a)-Math.sqrt(b))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(b,a),this._isPinching=!0):this._computeMultiTouchPanning(A,H)):this.multiTouchPanning?this._computeMultiTouchPanning(A,H):this.pinchZoom&&this._computePinchZoom(b,a))}onButtonDown(U){this._isPanClick=U.button===this.camera._panningMouseButton}onButtonUp(U){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}h.MinimumRadiusForPinch=.001,(0,a.c)([(0,A.J)()],h.prototype,"buttons",void 0),(0,a.c)([(0,A.J)()],h.prototype,"angularSensibilityX",void 0),(0,a.c)([(0,A.J)()],h.prototype,"angularSensibilityY",void 0),(0,a.c)([(0,A.J)()],h.prototype,"pinchPrecision",void 0),(0,a.c)([(0,A.J)()],h.prototype,"pinchDeltaPercentage",void 0),(0,a.c)([(0,A.J)()],h.prototype,"useNaturalPinchZoom",void 0),(0,a.c)([(0,A.J)()],h.prototype,"pinchZoom",void 0),(0,a.c)([(0,A.J)()],h.prototype,"panningSensibility",void 0),(0,a.c)([(0,A.J)()],h.prototype,"multiTouchPanning",void 0),(0,a.c)([(0,A.J)()],h.prototype,"multiTouchPanAndZoom",void 0),z.d.ArcRotateCameraPointersInput=h;var i=b(2525);class Y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(U){U=o.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((M=>{const b=M.event;if(!b.metaKey)if(M.type===i.b.KEYDOWN){if(this._ctrlPressed=b.ctrlKey,this._altPressed=b.altKey,-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),b.preventDefault&&(U||b.preventDefault())}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){const M=this._keys.indexOf(b.keyCode);M>=0&&this._keys.splice(M,1),b.preventDefault&&(U||b.preventDefault())}})))}gk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let M=0;M<this._keys.length;M++){const b=this._keys[M];-1!==this.keysLeft.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX-=1/this.panningSensibility:U.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset+=1/this.zoomingSensibility:U.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX+=1/this.panningSensibility:U.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset-=1/this.zoomingSensibility:U.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(b)&&U.useInputToRestoreState&&U.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,a.c)([(0,A.J)()],Y.prototype,"keysUp",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"keysDown",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"keysLeft",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"keysRight",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"keysReset",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"panningSensibility",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"zoomingSensibility",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"useAltToZoom",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"angularSpeed",void 0),z.d.ArcRotateCameraKeyboardMoveInput=Y;var d=b(723),s=b(2528);class q{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new W.l(0,0,0),this._globalOffset=new W.l(0,0,0),this._inertialPanning=W.l.Zero()}_computeDeltaFromMouseWheelLegacyEvent(U,M){let b=0;const a=.01*U*this.wheelDeltaPercentage*M;return b=U>0?a/(1+this.wheelDeltaPercentage):a*(1+this.wheelDeltaPercentage),b}attachControl(U){U=o.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=M=>{if(M.type!==x.c.POINTERWHEEL)return;const b=M.event;let a=0;const A=b.deltaMode===s.c.DOM_DELTA_LINE?40:1,H=-b.deltaY*A;if(this.customComputeDeltaFromMouseWheel)a=this.customComputeDeltaFromMouseWheel(H,this,b);else if(this.wheelDeltaPercentage){if(a=this._computeDeltaFromMouseWheelLegacyEvent(H,this.camera.radius),a>0){let U=this.camera.radius,M=this.camera.inertialRadiusOffset+a;for(let b=0;b<20&&!(U<=M)&&!(Math.abs(M*this.camera.inertia)<.001);b++)U-=M,M*=this.camera.inertia;U=(0,y.b)(U,0,Number.MAX_VALUE),a=this._computeDeltaFromMouseWheelLegacyEvent(H,U)}}else a=H/(40*this.wheelPrecision);a&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(a)):this.camera.inertialRadiusOffset+=a),b.preventDefault&&(U||b.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,x.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.mk(0)}gk(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const U=this.camera;0+U.inertialAlphaOffset+U.inertialBetaOffset+U.inertialRadiusOffset&&(this._updateHitPlane(),U.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(U.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const U=this.camera,M=U.target.je(U.position);this._hitPlane=d.b.FromPositionAndNormal(U.target,M)}_getPosition(){const U=this.camera,M=U.va(),b=M.createPickingRay(M.pointerX,M.pointerY,W.b.Identity(),U,!1);0===U.targetScreenOffset.x&&0===U.targetScreenOffset.y||(this._viewOffset.set(U.targetScreenOffset.x,U.targetScreenOffset.y,0),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),this._globalOffset=W.l.TransformNormal(this._viewOffset,U._cameraTransformMatrix),b.origin.addInPlace(this._globalOffset));let a=0;return this._hitPlane&&(a=b.intersectsPlane(this._hitPlane)??0),b.origin.addInPlace(b.direction.scaleInPlace(a))}_zoomToMouse(U){const M=this.camera,b=1-M.inertia;if(M.lowerRadiusLimit){const a=M.lowerRadiusLimit??0;M.radius-(M.inertialRadiusOffset+U)/b<a&&(U=(M.radius-a)*b-M.inertialRadiusOffset)}if(M.upperRadiusLimit){const a=M.upperRadiusLimit??0;M.radius-(M.inertialRadiusOffset+U)/b>a&&(U=(M.radius-a)*b-M.inertialRadiusOffset)}const a=U/b/M.radius,A=this._getPosition(),H=W.g.lk[6];A.subtractToRef(M.target,H),H.scaleInPlace(a),H.scaleInPlace(b),this._inertialPanning.addInPlace(H),M.inertialRadiusOffset+=U}_zeroIfClose(U){Math.abs(U.x)<Z.b&&(U.x=0),Math.abs(U.y)<Z.b&&(U.y=0),Math.abs(U.z)<Z.b&&(U.z=0)}}(0,a.c)([(0,A.J)()],q.prototype,"wheelPrecision",void 0),(0,a.c)([(0,A.J)()],q.prototype,"zoomToMouseLocation",void 0),(0,a.c)([(0,A.J)()],q.prototype,"wheelDeltaPercentage",void 0),z.d.ArcRotateCameraMouseWheelInput=q;class m extends z.e{constructor(U){super(U)}addMouseWheel(){return this.add(new q),this}addPointers(){return this.add(new h),this}addKeyboard(){return this.add(new Y),this}}var n=b(609);function E(U,M){return isNaN(U)?M:U}O.e.AddNodeConstructor("ArcRotateCamera",((U,M)=>()=>new X(U,0,0,1,W.l.Zero(),M)));class X extends L.c{get target(){return this._target}set target(U){this.setTarget(U)}get targetHost(){return this._targetHost}set targetHost(U){U&&this.setTarget(U)}getTarget(){return this.target}get position(){return this._position}set position(U){this.setPosition(U)}set upVector(U){this._upToYMatrix||(this._yToUpMatrix=new W.b,this._upToYMatrix=new W.b,this._upVector=W.l.Zero()),U.normalize(),this._upVector.p(U),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){W.b.RotationAlignToRef(W.l.UpReadOnly,this._upVector,this._yToUpMatrix),W.b.RotationAlignToRef(this._upVector,W.l.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityX:0}set angularSensibilityX(U){const M=this.inputs.attached.pointers;M&&(M.angularSensibilityX=U)}get angularSensibilityY(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityY:0}set angularSensibilityY(U){const M=this.inputs.attached.pointers;M&&(M.angularSensibilityY=U)}get pinchPrecision(){const U=this.inputs.attached.pointers;return U?U.pinchPrecision:0}set pinchPrecision(U){const M=this.inputs.attached.pointers;M&&(M.pinchPrecision=U)}get pinchDeltaPercentage(){const U=this.inputs.attached.pointers;return U?U.pinchDeltaPercentage:0}set pinchDeltaPercentage(U){const M=this.inputs.attached.pointers;M&&(M.pinchDeltaPercentage=U)}get useNaturalPinchZoom(){const U=this.inputs.attached.pointers;return!!U&&U.useNaturalPinchZoom}set useNaturalPinchZoom(U){const M=this.inputs.attached.pointers;M&&(M.useNaturalPinchZoom=U)}get panningSensibility(){const U=this.inputs.attached.pointers;return U?U.panningSensibility:0}set panningSensibility(U){const M=this.inputs.attached.pointers;M&&(M.panningSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const M=this.inputs.attached.keyboard;M&&(M.keysUp=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const M=this.inputs.attached.keyboard;M&&(M.keysDown=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const M=this.inputs.attached.keyboard;M&&(M.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const M=this.inputs.attached.keyboard;M&&(M.keysRight=U)}get wheelPrecision(){const U=this.inputs.attached.mousewheel;return U?U.wheelPrecision:0}set wheelPrecision(U){const M=this.inputs.attached.mousewheel;M&&(M.wheelPrecision=U)}get zoomToMouseLocation(){const U=this.inputs.attached.mousewheel;return!!U&&U.zoomToMouseLocation}set zoomToMouseLocation(U){const M=this.inputs.attached.mousewheel;M&&(M.zoomToMouseLocation=U)}get wheelDeltaPercentage(){const U=this.inputs.attached.mousewheel;return U?U.wheelDeltaPercentage:0}set wheelDeltaPercentage(U){const M=this.inputs.attached.mousewheel;M&&(M.wheelDeltaPercentage=U)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(U){U!==this.useBouncingBehavior&&(U?(this._bouncingBehavior=new J,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(U){U!==this.useFramingBehavior&&(U?(this._framingBehavior=new F,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(U){U!==this.useAutoRotationBehavior&&(U?(this._autoRotationBehavior=new C,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(U,M,b,a,A,y){var O;let e=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(U,W.l.Zero(),y,e),O=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=W.l.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=W.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new W.b,this.panningAxis=new W.l(1,1,0),this._transformedDirection=new W.l,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new H.e,this.checkCollisions=!1,this.collisionRadius=new W.l(.5,.5,.5),this._previousPosition=W.l.Zero(),this._collisionVelocity=W.l.Zero(),this._newPosition=W.l.Zero(),this._computationVector=W.l.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new W.l(NaN,NaN,NaN),this._goalTargetScreenOffset=new W.i(NaN,NaN),this._onCollisionPositionChange=function(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b?(O.setPosition(M),O.pf&&O.pf(b)):O._previousPosition.p(O._position);const a=Math.cos(O.alpha),A=Math.sin(O.alpha),H=Math.cos(O.beta);let W=Math.sin(O.beta);0===W&&(W=1e-4);const y=O._getTargetPosition();O._computationVector.vd(O.radius*a*W,O.radius*H,O.radius*A*W),y.addToRef(O._computationVector,O._newPosition),O._position.p(O._newPosition);let e=O.upVector;O.allowUpsideDown&&O.beta<0&&(e=e.clone(),e=e.negate()),O._computeViewMatrix(O._position,y,e),O._viewMatrix.addAtIndex(12,O.targetScreenOffset.x),O._viewMatrix.addAtIndex(13,O.targetScreenOffset.y),O._collisionTriggered=!1},this._target=W.l.Zero(),A&&this.setTarget(A),this.alpha=M,this.beta=b,this.radius=a,this.getViewMatrix(),this.inputs=new m(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new W.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=W.i.Zero()}_updateCache(U){U||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const U=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?U.addToRef(this._targetBoundingCenter,this._target):this._target.p(U)}const U=this._getLockedTargetPosition();return U||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Z.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,H=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=H?this._currentInterpolationFactor=H:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=E(U,this._goalAlpha),this._goalBeta=E(M,this._goalBeta),this._goalRadius=E(b,this._goalRadius),this._goalTarget.set(E(a.x,this._goalTarget.x),E(a.y,this._goalTarget.y),E(a.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(E(A.x,this._goalTargetScreenOffset.x),E(A.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,y.b)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,y.b)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,y.b)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,y.b)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(U,M){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const A=arguments;M=o.d.BackCompatCameraNoPreventDefault(A),this._useCtrlForPanning=b,this._panningMouseButton=a,"boolean"===typeof A[0]&&(A.length>1&&(this._useCtrlForPanning=A[1]),A.length>2&&(this._panningMouseButton=A[2])),this.inputs.attachElement(M),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}gk(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let U=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){U=!0;const M=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let a=this.inertialAlphaOffset*b;this.beta<0&&(a*=-1),this.alpha+=a*M,this.beta+=this.inertialBetaOffset*M,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Z.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Z.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Z.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){U=!0;const M=new W.l(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),M.multiplyInPlace(this.panningAxis),W.l.TransformNormalToRef(M,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const U=this.upVector,M=W.l.CrossToRef(this._transformedDirection,U,this._transformedDirection);W.l.CrossToRef(U,M,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);W.l.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const U=W.g.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(U),U.transposeToRef(U),W.l.TransformCoordinatesToRef(this._transformedDirection,U,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Z.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Z.b&&(this.inertialPanningY=0)}if(U)this.stopInterpolation();else if(this._isInterpolating){let U=!1;const M=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-M/this._currentInterpolationFactor),a=E(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const M=W.g.lk[0].set(E(this._goalTarget.x,this._target.x),E(this._goalTarget.y,this._target.y),E(this._goalTarget.z,this._target.z));W.l.LerpToRef(this.target,M,b,this._target),10*W.l.Distance(this.target,M)/a<Z.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(M),this.setTarget(this.target,!1,!0,!0)):U=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const M=W.e.RotationAlphaBetaGammaToRef(E(this._goalAlpha,this.alpha),E(this._goalBeta,this.beta),0,W.g.Quaternion[0]),a=W.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,W.g.Quaternion[1]),A=W.e.SlerpToRef(a,M,b,W.g.Quaternion[2]);A.normalize();const H=A.toAlphaBetaGammaToRef(W.g.lk[0]);if(this.alpha=H.x,this.beta=H.y,A.isApprox(M,Z.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const U=M.toAlphaBetaGammaToRef(W.g.lk[0]);this.alpha=U.x,this.beta=U.y}else U=!0}if(isNaN(this._goalRadius)||(this.radius+=(a-this.radius)*b,Math.abs(a/this.radius-1)<Z.b?(this._goalRadius=NaN,this.radius=a):U=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const M=W.g.Vector2[0].set(E(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),E(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));W.i.LerpToRef(this.targetScreenOffset,M,b,this.targetScreenOffset),W.i.Distance(this.targetScreenOffset,M)<Z.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(M)):U=!0}this._isInterpolating=U}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||W.l.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const U=this.alpha;var M,b;this.alpha=function(U){let M=Math.PI/2;return 0===U.x&&0===U.z||(M=Math.acos(U.x/Math.sqrt(Math.pow(U.x,2)+Math.pow(U.z,2)))),U.z<0&&(M=2*Math.PI-M),M}(this._computationVector),this.beta=(M=this._computationVector.y,b=this.radius,Math.acos(M/b));const a=Math.round((U-this.alpha)/(2*Math.PI));this.alpha+=2*a*Math.PI,this._checkLimits()}setPosition(U){this._position.equals(U)||(this._position.p(U),this.rebuildAnglesAndRadius())}setTarget(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(a=this.overrideCloneAlphaBetaRadius??a,U.ik)M&&U.getBoundingInfo?this._targetBoundingCenter=U.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,U.ik(),this._targetHost=U,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const M=U,a=this._getTargetPosition();if(a&&!b&&a.equals(M))return;this._targetHost=null,this._target=M,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}a||this.rebuildAnglesAndRadius()}_getViewMatrix(){const U=Math.cos(this.alpha),M=Math.sin(this.alpha),b=Math.cos(this.beta);let a=Math.sin(this.beta);0===a&&(a=1e-4),0===this.radius&&(this.radius=1e-4);const A=this._getTargetPosition();if(this._computationVector.vd(this.radius*U*a,this.radius*b,this.radius*M*a),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||W.l.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),A.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const U=this.va().collisionCoordinator;this._collider||(this._collider=U.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,U.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let U=this.upVector;this.allowUpsideDown&&a<0&&(U=U.negate()),this._computeViewMatrix(this._position,A,U),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(A),this._viewMatrix}zoomOn(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U=U||this.va().meshes;const b=e.c.MinMax(U);let a=this._calculateLowerRadiusFromModelBoundingSphere(b.min,b.max);if(a=Math.max(Math.min(a,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=a*this.zoomOnFactor,this.mode===f.c.ORTHOGRAPHIC_CAMERA){const U=this.va().getEngine().getAspectRatio(this),M=a*this.zoomOnFactor/2;this.orthoLeft=-M*U,this.orthoRight=M*U,this.orthoBottom=-M,this.orthoTop=M}this.focusOn({min:b.min,max:b.max,distance:a},M)}focusOn(U){let M,b,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===U.min){const a=U||this.va().meshes;M=e.c.MinMax(a),b=W.l.Distance(M.min,M.max)}else{M=U,b=U.distance}this._target=e.c.Center(M),a||(this.maxZ=2*b)}createRigCamera(U,M){let b=0;switch(this.cameraRigMode){case f.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.c.RIG_MODE_VR:b=this._cameraRigParams.stereoHalfAngle*(0===M?1:-1);break;case f.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b=this._cameraRigParams.stereoHalfAngle*(0===M?-1:1)}const a=new X(U,this.alpha+b,this.beta,this.radius,this._target,this.va());return a._cameraRigParams={},a.isRigCamera=!0,a.rigParent=this,a.upVector=this.upVector,a.mode=this.mode,a.orthoLeft=this.orthoLeft,a.orthoRight=this.orthoRight,a.orthoBottom=this.orthoBottom,a.orthoTop=this.orthoTop,a}_updateRigCameras(){const U=this._rigCameras[0],M=this._rigCameras[1];switch(U.beta=M.beta=this.beta,this.cameraRigMode){case f.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.c.RIG_MODE_VR:U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,M.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case f.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,M.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const a=W.l.Distance(U,M),A=this.va().getEngine().getAspectRatio(this),H=Math.tan(this.fov/2),y=H*A,O=.5*a*b,e=O*Math.sqrt(1+1/(y*y)),x=O*Math.sqrt(1+1/(H*H));return Math.max(e,x)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,a.c)([(0,A.J)()],X.prototype,"alpha",void 0),(0,a.c)([(0,A.J)()],X.prototype,"beta",void 0),(0,a.c)([(0,A.J)()],X.prototype,"radius",void 0),(0,a.c)([(0,A.J)()],X.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,a.c)([(0,A.H)("target")],X.prototype,"_target",void 0),(0,a.c)([(0,A.x)("targetHost")],X.prototype,"_targetHost",void 0),(0,a.c)([(0,A.J)()],X.prototype,"inertialAlphaOffset",void 0),(0,a.c)([(0,A.J)()],X.prototype,"inertialBetaOffset",void 0),(0,a.c)([(0,A.J)()],X.prototype,"inertialRadiusOffset",void 0),(0,a.c)([(0,A.J)()],X.prototype,"lowerAlphaLimit",void 0),(0,a.c)([(0,A.J)()],X.prototype,"upperAlphaLimit",void 0),(0,a.c)([(0,A.J)()],X.prototype,"lowerBetaLimit",void 0),(0,a.c)([(0,A.J)()],X.prototype,"upperBetaLimit",void 0),(0,a.c)([(0,A.J)()],X.prototype,"lowerRadiusLimit",void 0),(0,a.c)([(0,A.J)()],X.prototype,"upperRadiusLimit",void 0),(0,a.c)([(0,A.J)()],X.prototype,"lowerTargetYLimit",void 0),(0,a.c)([(0,A.J)()],X.prototype,"inertialPanningX",void 0),(0,a.c)([(0,A.J)()],X.prototype,"inertialPanningY",void 0),(0,a.c)([(0,A.J)()],X.prototype,"pinchToPanMaxDistance",void 0),(0,a.c)([(0,A.J)()],X.prototype,"panningDistanceLimit",void 0),(0,a.c)([(0,A.H)()],X.prototype,"panningOriginTarget",void 0),(0,a.c)([(0,A.J)()],X.prototype,"panningInertia",void 0),(0,a.c)([(0,A.J)()],X.prototype,"zoomToMouseLocation",null),(0,a.c)([(0,A.J)()],X.prototype,"zoomOnFactor",void 0),(0,a.c)([(0,A.D)()],X.prototype,"targetScreenOffset",void 0),(0,a.c)([(0,A.J)()],X.prototype,"allowUpsideDown",void 0),(0,a.c)([(0,A.J)()],X.prototype,"useInputToRestoreState",void 0),(0,a.c)([(0,A.J)()],X.prototype,"restoreStateInterpolationFactor",void 0),(0,n.i)("BABYLON.ArcRotateCamera",X)},12630:(U,M,b)=>{"use strict";b.d(M,{d:()=>W,e:()=>y});var a=b(497),A=b(698),H=b(639),W={};class y{constructor(U){this.attachedToElement=!1,this.attached={},this.camera=U,this.checkInputs=()=>{}}add(U){const M=U.getSimpleName();this.attached[M]?a.b.Warn("camera input of type "+M+" already exists on camera"):(this.attached[M]=U,U.camera=this.camera,U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U))),this.attachedToElement&&U.attachControl(this.noPreventDefault))}remove(U){for(const M in this.attached){const b=this.attached[M];if(b===U)return b.gk(),b.camera=null,delete this.attached[M],void this.rebuildInputCheck()}}removeByType(U){for(const M in this.attached){const b=this.attached[M];b.getClassName()===U&&(b.gk(),b.camera=null,delete this.attached[M],this.rebuildInputCheck())}}_addCheckInputs(U){const M=this.checkInputs;return()=>{M(),U()}}attachInput(U){this.attachedToElement&&U.attachControl(this.noPreventDefault)}attachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){U=!H.c.ForceAttachControlToAlwaysPreventDefault&&U,this.attachedToElement=!0,this.noPreventDefault=U;for(const M in this.attached)this.attached[M].attachControl(U)}}detachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const M in this.attached)this.attached[M].gk(),U&&(this.attached[M].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const U in this.attached){const M=this.attached[U];M.checkInputs&&(this.checkInputs=this._addCheckInputs(M.checkInputs.bind(M)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(U){const M={};for(const b in this.attached){const U=this.attached[b],a=A.d.Serialize(U);M[U.getClassName()]=a}U.inputsmgr=M}parse(U){const M=U.inputsmgr;if(M){this.clear();for(const U in M){const b=W[U];if(b){const a=M[U],H=A.d.Parse((()=>new b),a,null);this.add(H)}}}else for(const b in this.attached){const M=W[this.attached[b].getClassName()];if(M){const a=A.d.Parse((()=>new M),U,null);this.remove(this.attached[b]),this.add(a)}}}}},12616:(U,M,b)=>{"use strict";b.d(M,{c:()=>S});var a=b(645),A=b(652),H=b(670),W=b(12623),y=b(12630),O=b(2525),e=b(479);class x{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(U){U=e.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((M=>{const b=M.event;if(!b.metaKey)if(M.type===O.b.KEYDOWN){if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),U||b.preventDefault()}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){const M=this._keys.indexOf(b.keyCode);M>=0&&this._keys.splice(M,1),U||b.preventDefault()}})))}gk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let M=0;M<this._keys.length;M++){const b=this._keys[M],a=U._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?U._localDirection.vd(-a,0,0):-1!==this.keysUp.indexOf(b)?U._localDirection.vd(0,0,a):-1!==this.keysRight.indexOf(b)?U._localDirection.vd(a,0,0):-1!==this.keysDown.indexOf(b)?U._localDirection.vd(0,0,-a):-1!==this.keysUpward.indexOf(b)?U._localDirection.vd(0,a,0):-1!==this.keysDownward.indexOf(b)?U._localDirection.vd(0,-a,0):-1!==this.keysRotateLeft.indexOf(b)?(U._localDirection.vd(0,0,0),U.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(b)?(U._localDirection.vd(0,0,0),U.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(b)?(U._localDirection.vd(0,0,0),U.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(b)&&(U._localDirection.vd(0,0,0),U.cameraRotation.x+=this._getLocalRotation()),U.va().useRightHandedSystem&&(U._localDirection.z*=-1),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),H.l.TransformNormalToRef(U._localDirection,U._cameraTransformMatrix,U._transformedDirection),U.cameraDirection.addInPlace(U._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const U=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*U}}(0,a.c)([(0,A.J)()],x.prototype,"keysUp",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysUpward",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysDown",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysDownward",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysLeft",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysRight",void 0),(0,a.c)([(0,A.J)()],x.prototype,"rotationSpeed",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysRotateLeft",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysRotateRight",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysRotateUp",void 0),(0,a.c)([(0,A.J)()],x.prototype,"keysRotateDown",void 0),y.d.FreeCameraKeyboardMoveInput=x;var P=b(474),Z=b(2517);class C{constructor(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=U,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new P.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(U){U=e.d.BackCompatCameraNoPreventDefault(arguments);const M=this.camera.getEngine(),b=M.getInputElement();this._pointerInput||(this._pointerInput=a=>{const A=a.event,H="touch"===A.pointerType;if(!this.touchEnabled&&H)return;if(a.type!==Z.c.POINTERMOVE&&-1===this.buttons.indexOf(A.button))return;const W=A.target;if(a.type===Z.c.POINTERDOWN){if(H&&-1!==this._activePointerId||!H&&-1!==this._currentActiveButton)return;this._activePointerId=A.pointerId;try{null===W||void 0===W||W.setPointerCapture(A.pointerId)}catch(y){}-1===this._currentActiveButton&&(this._currentActiveButton=A.button),this._previousPosition={x:A.clientX,y:A.clientY},U||(A.preventDefault(),b&&b.focus()),M.isPointerLock&&this._onMouseMove&&this._onMouseMove(a.event)}else if(a.type===Z.c.POINTERUP){if(H&&this._activePointerId!==A.pointerId||!H&&this._currentActiveButton!==A.button)return;try{null===W||void 0===W||W.releasePointerCapture(A.pointerId)}catch(y){}this._currentActiveButton=-1,this._previousPosition=null,U||A.preventDefault(),this._activePointerId=-1}else if(a.type===Z.c.POINTERMOVE&&(this._activePointerId===A.pointerId||!H))if(M.isPointerLock&&this._onMouseMove)this._onMouseMove(a.event);else if(this._previousPosition){const M=this.camera._calculateHandednessMultiplier(),b=(A.clientX-this._previousPosition.x)*M,a=A.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=b/this.angularSensibility,this.camera.cameraRotation.x+=a/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:b,offsetY:a}),this._previousPosition={x:A.clientX,y:A.clientY},U||A.preventDefault()}}),this._onMouseMove=b=>{if(!M.isPointerLock)return;const a=this.camera._calculateHandednessMultiplier(),A=b.movementX*a;this.camera.cameraRotation.y+=A/this.angularSensibility;const H=b.movementY;this.camera.cameraRotation.x+=H/this.angularSensibility,this._previousPosition=null,U||b.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Z.c.POINTERDOWN|Z.c.POINTERUP|Z.c.POINTERMOVE),b&&(this._contextMenuBind=U=>this.onContextMenu(U),b.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(U){U.preventDefault()}gk(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,a.c)([(0,A.J)()],C.prototype,"buttons",void 0),(0,a.c)([(0,A.J)()],C.prototype,"angularSensibility",void 0),y.d.FreeCameraMouseInput=C;var r,B=b(2528);class J{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new P.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(U){U=e.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=M=>{if(M.type!==Z.c.POINTERWHEEL)return;const b=M.event,a=b.deltaMode===B.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*a*b.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*a*b.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*a*b.deltaZ/this._normalize,b.preventDefault&&(U||b.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,Z.c.POINTERWHEEL)}gk(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,a.c)([(0,A.J)()],J.prototype,"wheelPrecisionX",void 0),(0,a.c)([(0,A.J)()],J.prototype,"wheelPrecisionY",void 0),(0,a.c)([(0,A.J)()],J.prototype,"wheelPrecisionZ",void 0),function(U){U[U.MoveRelative=0]="MoveRelative",U[U.RotateRelative=1]="RotateRelative",U[U.MoveScene=2]="MoveScene"}(r||(r={}));class F extends J{constructor(){super(...arguments),this._moveRelative=H.l.Zero(),this._rotateRelative=H.l.Zero(),this._moveScene=H.l.Zero(),this._wheelXAction=r.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=r.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(U){null===U&&this._wheelXAction!==r.MoveRelative||(this._wheelXAction=r.MoveRelative,this._wheelXActionCoordinate=U)}get wheelXMoveRelative(){return this._wheelXAction!==r.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(U){null===U&&this._wheelYAction!==r.MoveRelative||(this._wheelYAction=r.MoveRelative,this._wheelYActionCoordinate=U)}get wheelYMoveRelative(){return this._wheelYAction!==r.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(U){null===U&&this._wheelZAction!==r.MoveRelative||(this._wheelZAction=r.MoveRelative,this._wheelZActionCoordinate=U)}get wheelZMoveRelative(){return this._wheelZAction!==r.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(U){null===U&&this._wheelXAction!==r.RotateRelative||(this._wheelXAction=r.RotateRelative,this._wheelXActionCoordinate=U)}get wheelXRotateRelative(){return this._wheelXAction!==r.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(U){null===U&&this._wheelYAction!==r.RotateRelative||(this._wheelYAction=r.RotateRelative,this._wheelYActionCoordinate=U)}get wheelYRotateRelative(){return this._wheelYAction!==r.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(U){null===U&&this._wheelZAction!==r.RotateRelative||(this._wheelZAction=r.RotateRelative,this._wheelZActionCoordinate=U)}get wheelZRotateRelative(){return this._wheelZAction!==r.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(U){null===U&&this._wheelXAction!==r.MoveScene||(this._wheelXAction=r.MoveScene,this._wheelXActionCoordinate=U)}get wheelXMoveScene(){return this._wheelXAction!==r.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(U){null===U&&this._wheelYAction!==r.MoveScene||(this._wheelYAction=r.MoveScene,this._wheelYActionCoordinate=U)}get wheelYMoveScene(){return this._wheelYAction!==r.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(U){null===U&&this._wheelZAction!==r.MoveScene||(this._wheelZAction=r.MoveScene,this._wheelZActionCoordinate=U)}get wheelZMoveScene(){return this._wheelZAction!==r.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.mk(0),this._rotateRelative.mk(0),this._moveScene.mk(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const U=H.b.Zero();this.camera.getViewMatrix().invertToRef(U);const M=H.l.Zero();H.l.TransformNormalToRef(this._moveRelative,U,M),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(M),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(U,M,b){if(0===U)return;if(null===M||null===b)return;let a=null;switch(M){case r.MoveRelative:a=this._moveRelative;break;case r.RotateRelative:a=this._rotateRelative;break;case r.MoveScene:a=this._moveScene}switch(b){case 0:a.set(U,0,0);break;case 1:a.set(0,U,0);break;case 2:a.set(0,0,U)}}}(0,a.c)([(0,A.J)()],F.prototype,"wheelXMoveRelative",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelYMoveRelative",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelZMoveRelative",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelXRotateRelative",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelYRotateRelative",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelZRotateRelative",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelXMoveScene",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelYMoveScene",null),(0,a.c)([(0,A.J)()],F.prototype,"wheelZMoveScene",null),y.d.FreeCameraMouseWheelInput=F;class f{constructor(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=U,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=e.d.IsSafari()}attachControl(U){U=e.d.BackCompatCameraNoPreventDefault(arguments);let M=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=b=>{const a=b.event,A="mouse"===a.pointerType||this._isSafari&&"undefined"===typeof a.pointerType;if(this.allowMouse||!A)if(b.type===Z.c.POINTERDOWN){if(U||a.preventDefault(),this._pointerPressed.push(a.pointerId),1!==this._pointerPressed.length)return;M={x:a.clientX,y:a.clientY}}else if(b.type===Z.c.POINTERUP){U||a.preventDefault();const b=this._pointerPressed.indexOf(a.pointerId);if(-1===b)return;if(this._pointerPressed.splice(b,1),0!=b)return;M=null,this._offsetX=null,this._offsetY=null}else if(b.type===Z.c.POINTERMOVE){if(U||a.preventDefault(),!M)return;if(0!=this._pointerPressed.indexOf(a.pointerId))return;this._offsetX=a.clientX-M.x,this._offsetY=-(a.clientY-M.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Z.c.POINTERDOWN|Z.c.POINTERUP|Z.c.POINTERMOVE),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.addEventListener("blur",this._onLostFocus)}}gk(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const U=this.camera,M=U._calculateHandednessMultiplier();U.cameraRotation.y=M*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)U.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const M=U._computeLocalCameraSpeed(),b=new H.l(0,0,0!==this.touchMoveSensibility?M*this._offsetY/this.touchMoveSensibility:0);H.b.RotationYawPitchRollToRef(U.rotation.y,U.rotation.x,0,U._cameraRotationMatrix),U.cameraDirection.addInPlace(H.l.TransformCoordinates(b,U._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,a.c)([(0,A.J)()],f.prototype,"touchAngularSensibility",void 0),(0,a.c)([(0,A.J)()],f.prototype,"touchMoveSensibility",void 0),y.d.FreeCameraTouchInput=f;class L extends y.e{constructor(U){super(U),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new x),this}addMouse(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new C(U),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new F,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new f),this}clear(){super.clear(),this._mouseInput=null}}var z=b(609),o=b(562);class S extends W.c{get angularSensibility(){const U=this.inputs.attached.mouse;return U?U.angularSensibility:0}set angularSensibility(U){const M=this.inputs.attached.mouse;M&&(M.angularSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const M=this.inputs.attached.keyboard;M&&(M.keysUp=U)}get keysUpward(){const U=this.inputs.attached.keyboard;return U?U.keysUpward:[]}set keysUpward(U){const M=this.inputs.attached.keyboard;M&&(M.keysUpward=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const M=this.inputs.attached.keyboard;M&&(M.keysDown=U)}get keysDownward(){const U=this.inputs.attached.keyboard;return U?U.keysDownward:[]}set keysDownward(U){const M=this.inputs.attached.keyboard;M&&(M.keysDownward=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const M=this.inputs.attached.keyboard;M&&(M.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const M=this.inputs.attached.keyboard;M&&(M.keysRight=U)}get keysRotateLeft(){const U=this.inputs.attached.keyboard;return U?U.keysRotateLeft:[]}set keysRotateLeft(U){const M=this.inputs.attached.keyboard;M&&(M.keysRotateLeft=U)}get keysRotateRight(){const U=this.inputs.attached.keyboard;return U?U.keysRotateRight:[]}set keysRotateRight(U){const M=this.inputs.attached.keyboard;M&&(M.keysRotateRight=U)}get keysRotateUp(){const U=this.inputs.attached.keyboard;return U?U.keysRotateUp:[]}set keysRotateUp(U){const M=this.inputs.attached.keyboard;M&&(M.keysRotateUp=U)}get keysRotateDown(){const U=this.inputs.attached.keyboard;return U?U.keysRotateDown:[]}set keysRotateDown(U){const M=this.inputs.attached.keyboard;M&&(M.keysRotateDown=U)}constructor(U,M,b){var a;super(U,M,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),a=this,this.ellipsoid=new H.l(.5,1,.5),this.ellipsoidOffset=new H.l(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=H.l.Zero(),this._diffPosition=H.l.Zero(),this._newPosition=H.l.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a._newPosition.p(M),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>o.e.CollisionsEpsilon&&(a.position.addToRef(a._diffPosition,a._deferredPositionUpdate),a._deferOnly?a._deferredUpdated=!0:a.position.p(a._deferredPositionUpdate),a.pf&&b&&a.pf(b))},this.inputs=new L(this),this.inputs.addKeyboard().addMouse()}attachControl(U,M){M=e.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(M)}gk(){this.inputs.detachElement(),this.cameraDirection=new H.l(0,0,0),this.cameraRotation=new H.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(U){this._collisionMask=isNaN(U)?-1:U}_collideWithWorld(U){let M;M=this.parent?H.l.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,M.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const b=this.va().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let a=U;this.applyGravity&&(a=U.add(this.va().gravity)),b.getNewPosition(this._oldPosition,a,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=H.l.Zero(),this._transformedDirection=H.l.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(U){this._needMoveForGravity=U}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"eb"}}(0,a.c)([(0,A.H)()],S.prototype,"ellipsoid",void 0),(0,a.c)([(0,A.H)()],S.prototype,"ellipsoidOffset",void 0),(0,a.c)([(0,A.J)()],S.prototype,"checkCollisions",void 0),(0,a.c)([(0,A.J)()],S.prototype,"applyGravity",void 0),(0,z.i)("BABYLON.FreeCamera",S)},12623:(U,M,b)=>{"use strict";b.d(M,{c:()=>P});var a=b(645),A=b(652),H=b(639),W=b(670),y=b(677),O=b(808);b(689).e.AddNodeConstructor("TargetCamera",((U,M)=>()=>new P(U,W.l.Zero(),M)));const e=W.b.Zero(),x=W.e.Identity();class P extends H.c{constructor(U,M,b){super(U,M,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new W.l(0,0,0),this.cameraRotation=new W.i(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=W.l.Zero(),this._initialFocalDistance=1,this._viewMatrix=W.b.Zero(),this._cameraTransformMatrix=W.b.Zero(),this._cameraRotationMatrix=W.b.Zero(),this._transformedReferencePoint=W.l.Zero(),this._deferredPositionUpdate=new W.l,this._deferredRotationQuaternionUpdate=new W.e,this._deferredRotationUpdate=new W.l,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=W.l.Forward(this.va().useRightHandedSystem),this.rotation=new W.l(0,this.va().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(U){this.getWorldMatrix();const M=W.g.lk[0],b=W.g.lk[1];return b.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(b,M),M.scaleInPlace(U),this.globalPosition.add(M)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const U=this.lockedTarget;U.ik().getTranslationToRef(U.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.vd(0,0,0),this.cameraRotation.vd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new W.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new W.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new W.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(U){U||super._updateCache();const M=this._getLockedTargetPosition();M?this._cache.lockedTarget?this._cache.lockedTarget.p(M):this._cache.lockedTarget=M.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const U=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(U):!U)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const U=this.getEngine();return this.speed*Math.sqrt(U.getDeltaTime()/(100*U.getFps()))}setTarget(U){this.upVector.normalize(),this._initialFocalDistance=U.je(this.position).length(),this.position.z===U.z&&(this.position.z+=y.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.va().useRightHandedSystem?W.b.LookAtRHToRef(this.position,U,W.l.UpReadOnly,e):W.b.LookAtLHToRef(this.position,U,W.l.UpReadOnly,e),e.invert();const M=this.rotationQuaternion||x;W.e.FromRotationMatrixToRef(e,M),M.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(U){this.setTarget(U)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(W.g.Matrix[0]),W.l.TransformNormalToRef(this.cameraDirection,W.g.Matrix[0],W.g.lk[0]),this._deferredPositionUpdate.addInPlace(W.g.lk[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const U=this.invertRotation?-this.inverseRotationSpeed:1,M=this._decideIfNeedsToMove(),b=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),M&&this._updatePosition(),b){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*U,this._deferredRotationUpdate.y+=this.cameraRotation.y*U,!this.noRotationConstraint){const U=1.570796;this._deferredRotationUpdate.x>U&&(this._deferredRotationUpdate.x=U),this._deferredRotationUpdate.x<-U&&(this._deferredRotationUpdate.x=-U)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(W.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}M&&(Math.abs(this.cameraDirection.x)<this.speed*y.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*y.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*y.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),b&&(Math.abs(this.cameraRotation.x)<this.speed*y.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*y.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):W.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return W.l.TransformNormalToRef(W.l.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),W.l.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?O.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(W.e.FromEulerVectorToRef(this.rotation,x),O.b.Y.rotateByQuaternionToRef(x,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(U,M,b){if(this.va().useRightHandedSystem?W.b.LookAtRHToRef(U,M,b,this._viewMatrix):W.b.LookAtLHToRef(U,M,b,this._viewMatrix),this.parent){const U=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(U,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(U)}createRigCamera(U,M){if(this.cameraRigMode!==H.c.RIG_MODE_NONE){const M=new P(U,this.position.clone(),this.va());return M.isRigCamera=!0,M.rigParent=this,this.cameraRigMode===H.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new W.e),M._cameraRigParams={},M.rotationQuaternion=new W.e),M.mode=this.mode,M.orthoLeft=this.orthoLeft,M.orthoRight=this.orthoRight,M.orthoTop=this.orthoTop,M.orthoBottom=this.orthoBottom,M}return null}_updateRigCameras(){const U=this._rigCameras[0],M=this._rigCameras[1];switch(this.ik(),this.cameraRigMode){case H.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case H.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case H.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case H.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case H.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const b=this.cameraRigMode===H.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,a=this.cameraRigMode===H.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*b,U),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,M);break}case H.c.RIG_MODE_VR:U.rotationQuaternion?(U.rotationQuaternion.p(this.rotationQuaternion),M.rotationQuaternion.p(this.rotationQuaternion)):(U.rotation.p(this.rotation),M.rotation.p(this.rotation)),U.position.p(this.position),M.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(U,M){this.getTarget().subtractToRef(this.position,P._TargetFocalPoint),P._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const b=P._TargetFocalPoint.addInPlace(this.position);W.b.TranslationToRef(-b.x,-b.y,-b.z,P._TargetTransformMatrix),P._TargetTransformMatrix.multiplyToRef(W.b.RotationAxis(M.upVector,U),P._RigCamTransformMatrix),W.b.TranslationToRef(b.x,b.y,b.z,P._TargetTransformMatrix),P._RigCamTransformMatrix.multiplyToRef(P._TargetTransformMatrix,P._RigCamTransformMatrix),W.l.TransformCoordinatesToRef(this.position,P._RigCamTransformMatrix,M.position),M.setTarget(b)}getClassName(){return"TargetCamera"}}P._RigCamTransformMatrix=new W.b,P._TargetTransformMatrix=new W.b,P._TargetFocalPoint=new W.l,(0,a.c)([(0,A.J)()],P.prototype,"updateUpVectorFromRotation",void 0),(0,a.c)([(0,A.H)()],P.prototype,"rotation",void 0),(0,a.c)([(0,A.J)()],P.prototype,"speed",void 0),(0,a.c)([(0,A.x)("lockedTargetId")],P.prototype,"lockedTarget",void 0)},13095:(U,M,b)=>{"use strict";b.d(M,{e:()=>H});var a=b(661),A=b(13099);class H{constructor(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=b,this.pl=[],this._maxBlockCapacity=M||64,this._selectionContent=new a.d(1024),this._creationFunc=U}update(U,M,b){A.d._CreateBlocks(U,M,b,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Gk(U){for(let M=0;M<this.$k.length;M++){this.$k[M].addEntry(U)}}Hk(U){for(let M=0;M<this.$k.length;M++){this.$k[M].removeEntry(U)}}select(U,M){this._selectionContent.reset();for(let b=0;b<this.$k.length;b++){this.$k[b].select(U,this._selectionContent,M)}return M?this._selectionContent.concat(this.pl):this._selectionContent.concatWithNoDuplicate(this.pl),this._selectionContent}intersects(U,M,b){this._selectionContent.reset();for(let a=0;a<this.$k.length;a++){this.$k[a].intersects(U,M,this._selectionContent,b)}return b?this._selectionContent.concat(this.pl):this._selectionContent.concatWithNoDuplicate(this.pl),this._selectionContent}intersectsRay(U){this._selectionContent.reset();for(let M=0;M<this.$k.length;M++){this.$k[M].intersectsRay(U,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.pl),this._selectionContent}}H.CreationFuncForMeshes=(U,M)=>{const b=U.getBoundingInfo();!U.isBlocked&&b.boundingBox.intersectsMinMax(M.sl,M.tl)&&M.entries.push(U)},H.CreationFuncForSubMeshes=(U,M)=>{U.getBoundingInfo().boundingBox.intersectsMinMax(M.sl,M.tl)&&M.entries.push(U)}},13099:(U,M,b)=>{"use strict";b.d(M,{d:()=>H});var a=b(670),A=b(763);class H{constructor(U,M,b,a,A,H){this.entries=[],this.ul=new Array,this._capacity=b,this._depth=a,this._maxDepth=A,this._creationFunc=H,this._minPoint=U,this._maxPoint=M,this.ul.push(U.clone()),this.ul.push(M.clone()),this.ul.push(U.clone()),this.ul[2].x=M.x,this.ul.push(U.clone()),this.ul[3].y=M.y,this.ul.push(U.clone()),this.ul[4].z=M.z,this.ul.push(M.clone()),this.ul[5].z=U.z,this.ul.push(M.clone()),this.ul[6].x=U.x,this.ul.push(M.clone()),this.ul[7].y=U.y}get Ub(){return this._capacity}get sl(){return this._minPoint}get tl(){return this._maxPoint}addEntry(U){if(this.$k)for(let M=0;M<this.$k.length;M++){this.$k[M].addEntry(U)}else this._creationFunc(U,this),this.entries.length>this.Ub&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(U){if(this.$k){for(let M=0;M<this.$k.length;M++){this.$k[M].removeEntry(U)}return}const M=this.entries.indexOf(U);M>-1&&this.entries.splice(M,1)}addEntries(U){for(let M=0;M<U.length;M++){const b=U[M];this.addEntry(b)}}select(U,M,b){if(A.b.IsInFrustum(this.ul,U)){if(this.$k){for(let a=0;a<this.$k.length;a++){this.$k[a].select(U,M,b)}return}b?M.concat(this.entries):M.concatWithNoDuplicate(this.entries)}}intersects(U,M,b,a){if(A.b.IntersectsSphere(this._minPoint,this._maxPoint,U,M)){if(this.$k){for(let A=0;A<this.$k.length;A++){this.$k[A].intersects(U,M,b,a)}return}a?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersectsRay(U,M){if(U.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.$k){for(let b=0;b<this.$k.length;b++){this.$k[b].intersectsRay(U,M)}return}M.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){H._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(U,M,b,A,W,y,O,e){O.$k=new Array;const x=new a.l((M.x-U.x)/2,(M.y-U.y)/2,(M.z-U.z)/2);for(let a=0;a<2;a++)for(let M=0;M<2;M++)for(let P=0;P<2;P++){const Z=U.add(x.multiplyByFloats(a,M,P)),C=U.add(x.multiplyByFloats(a+1,M+1,P+1)),r=new H(Z,C,A,W+1,y,e);r.addEntries(b),O.$k.push(r)}}}},13108:(U,M,b)=>{"use strict";b.d(M,{c:()=>x});var a=b(2492),A=b(670),H=b(788),W=b(12409),y=b(834),O=b(13095),e=b(524);a.b.prototype.createOrUpdateSelectionOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,b=this._getComponent(y.e.NAME_OCTREE);b||(b=new x(this),this.o(b)),this.nl||(this.nl=new O.e(O.e.CreationFuncForMeshes,U,M));const a=this.getWorldExtends();return this.nl.update(a.min,a.max,this.meshes),this.nl},Object.defineProperty(a.b.prototype,"selectionOctree",{get:function(){return this.nl},enumerable:!0,configurable:!0}),H.e.prototype.createOrUpdateSubmeshesOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=this.va();let a=b._getComponent(y.e.NAME_OCTREE);a||(a=new x(b),b.o(a)),this._submeshesOctree||(this._submeshesOctree=new O.e(O.e.CreationFuncForSubMeshes,U,M)),this.ik(!0);const A=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(A.minimumWorld,A.maximumWorld,this.xk),this._submeshesOctree};class x{constructor(U){this.name=y.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new W.e(A.l.Zero(),new A.l(1,1,1)),(U=U||e.d.LastCreatedScene)&&(this.$e=U,this.$e.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.$e.getActiveSubMeshCandidates=U=>this.getActiveSubMeshCandidates(U),this.$e.getCollidingSubMeshCandidates=(U,M)=>this.getCollidingSubMeshCandidates(U,M),this.$e.getIntersectingSubMeshCandidates=(U,M)=>this.getIntersectingSubMeshCandidates(U,M))}register(){this.$e.onMeshRemovedObservable.add((U=>{const M=this.$e.selectionOctree;if(void 0!==M&&null!==M){const b=M.pl.indexOf(U);-1!==b&&M.pl.splice(b,1)}})),this.$e.onMeshImportedObservable.add((U=>{const M=this.$e.selectionOctree;void 0!==M&&null!==M&&M.Gk(U)}))}getActiveMeshCandidates(){var U;return(null===(U=this.$e.nl)||void 0===U?void 0:U.select(this.$e.frustumPlanes))||this.$e._getDefaultMeshCandidates()}getActiveSubMeshCandidates(U){if(U._submeshesOctree&&U.useOctreeForRenderingSelection){return U._submeshesOctree.select(this.$e.frustumPlanes)}return this.$e._getDefaultSubMeshCandidates(U)}getIntersectingSubMeshCandidates(U,M){if(U._submeshesOctree&&U.useOctreeForPicking){W.e.TransformToRef(M,U.getWorldMatrix(),this._tempRay);return U._submeshesOctree.intersectsRay(this._tempRay)}return this.$e._getDefaultSubMeshCandidates(U)}getCollidingSubMeshCandidates(U,M){if(U._submeshesOctree&&U.useOctreeForCollisions){const b=M._velocityWorldLength+Math.max(M._radius.x,M._radius.y,M._radius.z);return U._submeshesOctree.intersects(M._basePointWorld,b)}return this.$e._getDefaultSubMeshCandidates(U)}rebuild(){}dispose(){}}},12409:(U,M,b)=>{"use strict";b.d(M,{e:()=>C});var a=b(2492),A=b(639),H=b(677),W=b(670),y=b(679),O=b(751),e=b(799),x=b(524),P=b(2530);const Z={internalPickerForMesh:void 0};class C{constructor(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.b;this.origin=U,this.direction=M,this.length=b,this.epsilon=a}clone(){return new C(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=C._TmpVector3[0].vd(U.x-b,U.y-b,U.z-b),A=C._TmpVector3[1].vd(M.x+b,M.y+b,M.z+b);let H,W,y,O,e=0,x=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<a.x||this.origin.x>A.x)return!1}else if(H=1/this.direction.x,W=(a.x-this.origin.x)*H,y=(A.x-this.origin.x)*H,y===-1/0&&(y=1/0),W>y&&(O=W,W=y,y=O),e=Math.max(W,e),x=Math.min(y,x),e>x)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<a.y||this.origin.y>A.y)return!1}else if(H=1/this.direction.y,W=(a.y-this.origin.y)*H,y=(A.y-this.origin.y)*H,y===-1/0&&(y=1/0),W>y&&(O=W,W=y,y=O),e=Math.max(W,e),x=Math.min(y,x),e>x)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<a.z||this.origin.z>A.z)return!1}else if(H=1/this.direction.z,W=(a.z-this.origin.z)*H,y=(A.z-this.origin.z)*H,y===-1/0&&(y=1/0),W>y&&(O=W,W=y,y=O),e=Math.max(W,e),x=Math.min(y,x),e>x)return!1;return!0}intersectsBox(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(U.minimum,U.maximum,M)}intersectsSphere(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=U.center.x-this.origin.x,a=U.center.y-this.origin.y,A=U.center.z-this.origin.z,H=b*b+a*a+A*A,W=U.radius+M,y=W*W;if(H<=y)return!0;const O=b*this.direction.x+a*this.direction.y+A*this.direction.z;if(O<0)return!1;return H-O*O<=y}intersectsTriangle(U,M,b){const a=C._TmpVector3[0],A=C._TmpVector3[1],H=C._TmpVector3[2],y=C._TmpVector3[3],e=C._TmpVector3[4];M.subtractToRef(U,a),b.subtractToRef(U,A),W.l.CrossToRef(this.direction,A,H);const x=W.l.Dot(a,H);if(0===x)return null;const P=1/x;this.origin.subtractToRef(U,y);const Z=W.l.Dot(y,H)*P;if(Z<-this.epsilon||Z>1+this.epsilon)return null;W.l.CrossToRef(y,a,e);const r=W.l.Dot(this.direction,e)*P;if(r<-this.epsilon||Z+r>1+this.epsilon)return null;const B=W.l.Dot(A,e)*P;return B>this.length?null:new O.c(1-Z-r,Z,B)}intersectsPlane(U){let M;const b=W.l.Dot(U.uk,this.direction);if(Math.abs(b)<9.99999997475243e-7)return null;{const a=W.l.Dot(U.uk,this.origin);return M=(-U.d-a)/b,M<0?M<-9.99999997475243e-7?null:0:M}}intersectsAxis(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(U){case"y":{const U=(this.origin.y-M)/this.direction.y;return U>0?null:new W.l(this.origin.x+this.direction.x*-U,M,this.origin.z+this.direction.z*-U)}case"x":{const U=(this.origin.x-M)/this.direction.x;return U>0?null:new W.l(M,this.origin.y+this.direction.y*-U,this.origin.z+this.direction.z*-U)}case"z":{const U=(this.origin.z-M)/this.direction.z;return U>0?null:new W.l(this.origin.x+this.direction.x*-U,this.origin.y+this.direction.y*-U,M)}default:return null}}intersectsMesh(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=W.g.Matrix[0];return U.getWorldMatrix().invertToRef(y),this._tmpRay?C.TransformToRef(this,y,this._tmpRay):this._tmpRay=C.Transform(this,y),U.intersects(this._tmpRay,M,b,a,A,H)}intersectsMeshes(U,M,b){b?b.length=0:b=[];for(let a=0;a<U.length;a++){const A=this.intersectsMesh(U[a],M);A.hit&&b.push(A)}return b.sort(this._comparePickingInfo),b}_comparePickingInfo(U,M){return U.distance<M.distance?-1:U.distance>M.distance?1:0}intersectionSegment(U,M,b){const a=this.origin,A=W.g.lk[0],H=W.g.lk[1],y=W.g.lk[2],O=W.g.lk[3];M.subtractToRef(U,A),this.direction.scaleToRef(C._Rayl,y),a.addToRef(y,H),U.subtractToRef(a,O);const e=W.l.Dot(A,A),x=W.l.Dot(A,y),P=W.l.Dot(y,y),Z=W.l.Dot(A,O),r=W.l.Dot(y,O),B=e*P-x*x;let J,F,f=B,L=B;B<C._Smallnum?(J=0,f=1,F=r,L=P):(J=x*r-P*Z,F=e*r-x*Z,J<0?(J=0,F=r,L=P):J>f&&(J=f,F=r+x,L=P)),F<0?(F=0,-Z<0?J=0:-Z>e?J=f:(J=-Z,f=e)):F>L&&(F=L,-Z+x<0?J=0:-Z+x>e?J=f:(J=-Z+x,f=e));const z=Math.abs(J)<C._Smallnum?0:J/f,o=Math.abs(F)<C._Smallnum?0:F/L,S=W.g.lk[4];y.scaleToRef(o,S);const h=W.g.lk[5];A.scaleToRef(z,h),h.addInPlace(O);const i=W.g.lk[6];h.subtractToRef(S,i);return o>0&&o<=this.length&&i.lengthSquared()<b*b?h.length():-1}update(U,M,b,a,A,H,y){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){C._RayDistant||(C._RayDistant=C.Zero()),C._RayDistant.unprojectRayToRef(U,M,b,a,W.b.IdentityReadOnly,H,y);const O=W.g.Matrix[0];A.invertToRef(O),C.TransformToRef(C._RayDistant,O,this)}else this.unprojectRayToRef(U,M,b,a,A,H,y);return this}static Zero(){return new C(W.l.Zero(),W.l.Zero())}static CreateNew(U,M,b,a,A,H,W){return C.Zero().update(U,M,b,a,A,H,W)}static CreateNewFromTo(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.b.IdentityReadOnly;const a=new C(new W.l(0,0,0),new W.l(0,0,0));return C.CreateFromToToRef(U,M,a,b)}static CreateFromToToRef(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:W.b.IdentityReadOnly;b.origin.p(U);const A=M.subtractToRef(U,b.direction),H=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);return b.length=H,b.direction.normalize(),C.TransformToRef(b,a,b)}static Transform(U,M){const b=new C(new W.l(0,0,0),new W.l(0,0,0));return C.TransformToRef(U,M,b),b}static TransformToRef(U,M,b){W.l.TransformCoordinatesToRef(U.origin,M,b.origin),W.l.TransformNormalToRef(U.direction,M,b.direction),b.length=U.length,b.epsilon=U.epsilon;const a=b.direction,A=a.length();if(0!==A&&1!==A){const U=1/A;a.x*=U,a.y*=U,a.z*=U,b.length*=A}return b}unprojectRayToRef(U,M,b,a,A,H,y){const O=W.g.Matrix[0];A.multiplyToRef(H,O),O.multiplyToRef(y,O),O.invert();const e=x.d.LastCreatedEngine,P=W.g.lk[0];P.x=U/b*2-1,P.y=-(M/a*2-1),P.z=null!==e&&void 0!==e&&e.useReverseDepthBuffer?1:null!==e&&void 0!==e&&e.isNDCHalfZRange?0:-1;const Z=W.g.lk[1].vd(P.x,P.y,1-1e-8),C=W.g.lk[2],r=W.g.lk[3];W.l._UnprojectFromInvertedMatrixToRef(P,O,C),W.l._UnprojectFromInvertedMatrixToRef(Z,O,r),this.origin.p(C),r.subtractToRef(C,this.direction),this.direction.normalize()}}function r(U,M,b,a,A){let H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const W=C.Zero();return B(U,M,b,a,W,A,H),W}function B(U,M,b,a,A,H){let y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const e=U.getEngine();if(!H&&!(H=U.activeCamera))return U;const x=H.viewport,P=e.getRenderHeight(),{x:Z,y:C,width:r,height:B}=x.toGlobal(e.getRenderWidth(),P),J=1/e.getHardwareScalingLevel();return M=M*J-Z,b=b*J-(P-C-B),A.update(M,b,r,B,a||W.b.IdentityReadOnly,y?W.b.IdentityReadOnly:H.getViewMatrix(),H.getProjectionMatrix(),O),U}function J(U,M,b,a,A){if(!e.d)return U;const H=U.getEngine();if(!A&&!(A=U.activeCamera))throw new Error("Active camera not set");const y=A.viewport,O=H.getRenderHeight(),{x:x,y:P,width:Z,height:C}=y.toGlobal(H.getRenderWidth(),O),r=W.b.Identity(),B=1/H.getHardwareScalingLevel();return M=M*B-x,b=b*B-(O-P-C),a.update(M,b,Z,C,r,r,A.getProjectionMatrix()),U}function F(U,M,b,a,A,H,W,y){const O=M(a,b.enableDistantPicking),e=b.intersects(O,A,W,H,a,y);return e&&e.hit?!A&&null!=U&&e.distance>=U.distance?null:e:null}function f(U,M,b,a,A,H){let y=null;const O=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),x=U.cameraToUseForPointers||U.activeCamera,P=Z.internalPickerForMesh||F;for(let e=0;e<U.meshes.length;e++){const Z=U.meshes[e];if(b){if(!b(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.Kf)continue;const C=O&&Z.isWorldMatrixCameraDependent(),r=Z.ik(C,x);if(Z.hasThinInstances&&Z.thinInstanceEnablePicking){const U=P(y,M,Z,r,!0,!0,H);if(U){if(A)return U;const O=W.g.Matrix[1],e=Z.thinInstanceGetWorldMatrices();for(let U=0;U<e.length;U++){if(b&&!b(Z,U))continue;e[U].multiplyToRef(r,O);const W=P(y,M,Z,O,a,A,H,!0);if(W&&(y=W,y.thinInstanceIndex=U,a))return y}}}else{const U=P(y,M,Z,r,a,A,H);if(U&&(y=U,a))return y}}return y||new e.d}function L(U,M,b,a){if(!e.d)return null;const A=[],H=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),y=U.cameraToUseForPointers||U.activeCamera,O=Z.internalPickerForMesh||F;for(let e=0;e<U.meshes.length;e++){const x=U.meshes[e];if(b){if(!b(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.Kf)continue;const P=H&&x.isWorldMatrixCameraDependent(),Z=x.ik(P,y);if(x.hasThinInstances&&x.thinInstanceEnablePicking){if(O(null,M,x,Z,!0,!0,a)){const U=W.g.Matrix[1],H=x.thinInstanceGetWorldMatrices();for(let W=0;W<H.length;W++){if(b&&!b(x,W))continue;H[W].multiplyToRef(Z,U);const y=O(null,M,x,U,!1,!1,a,!0);y&&(y.thinInstanceIndex=W,A.push(y))}}}else{const U=O(null,M,x,Z,!1,!1,a);U&&A.push(U)}}return A}function z(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;a||(a=U.getWorldMatrix()),M.length=b,A?M.origin.p(A):M.origin.p(U.position);const H=W.g.lk[2];H.set(0,0,U._scene.useRightHandedSystem?-1:1);const y=W.g.lk[3];return W.l.TransformNormalToRef(H,a,y),W.l.NormalizeToRef(y,M.direction),M}var o,S;C._TmpVector3=(0,y.b)(6,W.l.Zero),C._RayDistant=C.Zero(),C._Smallnum=1e-8,C._Rayl=1e9,o=a.b,(S=A.c)&&(S.prototype.getForwardRay=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,M=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;return z(this,new C(W.l.Zero(),W.l.Zero(),U),U,M,b)},S.prototype.getForwardRayToRef=function(U){return z(this,U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),o&&(P.d._IsPickingAvailable=!0,o.prototype.createPickingRay=function(U,M,b,a){return r(this,U,M,b,a,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),a.b.prototype.createPickingRayToRef=function(U,M,b,a,A){return B(this,U,M,b,a,A,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},a.b.prototype.createPickingRayInCameraSpace=function(U,M,b){return function(U,M,b,a){const A=C.Zero();return J(U,M,b,A,a),A}(this,U,M,b)},a.b.prototype.createPickingRayInCameraSpaceToRef=function(U,M,b,a){return J(this,U,M,b,a)},a.b.prototype.pickWithBoundingInfo=function(U,M,b,a,A){return function(U,M,b,a,A,H){if(!e.d)return null;const y=f(U,(a=>(U._tempPickingRay||(U._tempPickingRay=C.Zero()),B(U,M,b,a,U._tempPickingRay,H||null),U._tempPickingRay)),a,A,!0);return y&&(y.ray=r(U,M,b,W.b.Identity(),H||null)),y}(this,U,M,b,a,A)},a.b.prototype.ge=function(U,M,b,a,A,H){return function(U,M,b,a,A,H,y){const O=f(U,((a,A)=>(U._tempPickingRay||(U._tempPickingRay=C.Zero()),B(U,M,b,a,U._tempPickingRay,H||null,!1,A),U._tempPickingRay)),a,A,!1,y);return O&&(O.ray=r(U,M,b,W.b.Identity(),H||null)),O}(this,U,M,b,a,A,H)},a.b.prototype.pickWithRay=function(U,M,b,a){return function(U,M,b,a,A){const H=f(U,(b=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=W.b.Identity()),b.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=C.Zero()),C.TransformToRef(M,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),b,a,!1,A);return H&&(H.ray=M),H}(this,U,M,b,a)},a.b.prototype.multiPick=function(U,M,b,a,A){return function(U,M,b,a,A,H){return L(U,(a=>r(U,M,b,a,A||null)),a,H)}(this,U,M,b,a,A)},a.b.prototype.multiPickWithRay=function(U,M,b){return function(U,M,b,a){return L(U,(b=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=W.b.Identity()),b.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=C.Zero()),C.TransformToRef(M,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),b,a)}(this,U,M,b)}},2478:(U,M,b)=>{"use strict";var a=b(591),A=b(497),H=b(531),W=b(614),y=b(562),O=b(601);y.e.prototype._partialLoadFile=function(U,M,b,a){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(U,(U=>{b[M]=U,b._internalCount++,6===b._internalCount&&a(b)}),void 0,void 0,!0,((U,M)=>{A&&U&&A(U.status+" "+U.statusText,M)}))},y.e.prototype._cascadeLoadFiles=function(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=[];A._internalCount=0;for(let H=0;H<6;H++)this._partialLoadFile(b[H],H,A,M,a)},y.e.prototype._cascadeLoadImgs=function(U,M,b,a){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5?arguments[5]:void 0;const W=[];W._internalCount=0;for(let y=0;y<6;y++)this._partialLoadImg(a[y],y,W,U,M,b,A,H)},y.e.prototype._partialLoadImg=function(U,M,b,a,A,y){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7?arguments[7]:void 0;const x=(0,W.d)();(0,H.u)(U,(U=>{b[M]=U,b._internalCount++,a&&a.removePendingData(x),6===b._internalCount&&y&&y(A,b)}),((U,M)=>{a&&a.removePendingData(x),O&&O(U,M)}),a?a.offlineProvider:null,e),a&&a.addPendingData(x)},y.e.prototype.createCubeTextureBase=function(U,M,b,H){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6?arguments[6]:void 0,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,B=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,J=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,F=arguments.length>14&&void 0!==arguments[14]&&arguments[14],f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const L=r||new a.e(this,7);L.isCube=!0,L.url=U,L.generateMipMaps=!H,L._lodGenerationScale=Z,L._lodGenerationOffset=C,L._useSRGBBuffer=!!F&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!H),L!==r&&(L.label=U.substring(0,60)),this._doNotHandleContextLost||(L._extension=x,L._files=b,L._buffer=f);const z=U;this._transformTextureUrl&&!r&&(U=this._transformTextureUrl(U));const o=x??function(U){const M=U.split("?")[0],b=M.lastIndexOf(".");return b>-1?M.substring(b).toLowerCase():""}(U),S=(0,O.e)(o),h=(U,M)=>{L.dispose(),y?y(U,M):U&&A.b.Warn(U)},i=(a,y)=>{U===z?a&&h(a.status+" "+a.statusText,y):(A.b.Warn(`Failed to load ${U}, falling back to the ${z}`),this.createCubeTextureBase(z,M,b,!!H,W,h,e,x,P,Z,C,L,B,J,F,f))};if(S)S.then((a=>{const A=U=>{B&&B(L,U),a.loadCubeData(U,L,P,W,((U,M)=>{h(U,M)}))};f?A(f):b&&6===b.length?a.supportCascades?this._cascadeLoadFiles(M,(U=>A(U.map((U=>new Uint8Array(U))))),b,h):h("Textures type does not support cascades."):this._loadFile(U,(U=>A(new Uint8Array(U))),void 0,void 0,!0,i)}));else{if(!b||0===b.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(M,L,((U,M)=>{J&&J(U,M)}),b,h)}return this._internalTexturesCache.push(L),L}},12696:(U,M,b)=>{"use strict";b.d(M,{c:()=>a});class a{}a.AUTOSAMPLERSUFFIX="Sampler",a.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",a.ALPHA_DISABLE=0,a.ALPHA_ADD=1,a.ALPHA_COMBINE=2,a.ALPHA_SUBTRACT=3,a.ALPHA_MULTIPLY=4,a.ALPHA_MAXIMIZED=5,a.ALPHA_ONEONE=6,a.ALPHA_PREMULTIPLIED=7,a.ALPHA_PREMULTIPLIED_PORTERDUFF=8,a.ALPHA_INTERPOLATE=9,a.ALPHA_SCREENMODE=10,a.ALPHA_ONEONE_ONEONE=11,a.ALPHA_ALPHATOCOLOR=12,a.ALPHA_REVERSEONEMINUS=13,a.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,a.ALPHA_ONEONE_ONEZERO=15,a.ALPHA_EXCLUSION=16,a.ALPHA_LAYER_ACCUMULATE=17,a.ALPHA_EQUATION_ADD=0,a.ALPHA_EQUATION_SUBSTRACT=1,a.ALPHA_EQUATION_REVERSE_SUBTRACT=2,a.ALPHA_EQUATION_MAX=3,a.ALPHA_EQUATION_MIN=4,a.ALPHA_EQUATION_DARKEN=5,a.DELAYLOADSTATE_NONE=0,a.DELAYLOADSTATE_LOADED=1,a.DELAYLOADSTATE_LOADING=2,a.DELAYLOADSTATE_NOTLOADED=4,a.NEVER=512,a.ALWAYS=519,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.GEQUAL=518,a.NOTEQUAL=517,a.KEEP=7680,a.ZERO=0,a.REPLACE=7681,a.INCR=7682,a.DECR=7683,a.INVERT=5386,a.INCR_WRAP=34055,a.DECR_WRAP=34056,a.TEXTURE_CLAMP_ADDRESSMODE=0,a.TEXTURE_WRAP_ADDRESSMODE=1,a.TEXTURE_MIRROR_ADDRESSMODE=2,a.TEXTURE_CREATIONFLAG_STORAGE=1,a.TEXTUREFORMAT_ALPHA=0,a.TEXTUREFORMAT_LUMINANCE=1,a.TEXTUREFORMAT_LUMINANCE_ALPHA=2,a.TEXTUREFORMAT_RGB=4,a.TEXTUREFORMAT_RGBA=5,a.TEXTUREFORMAT_RED=6,a.TEXTUREFORMAT_R=6,a.TEXTUREFORMAT_R16_UNORM=33322,a.TEXTUREFORMAT_RG16_UNORM=33324,a.TEXTUREFORMAT_RGB16_UNORM=32852,a.TEXTUREFORMAT_RGBA16_UNORM=32859,a.TEXTUREFORMAT_R16_SNORM=36760,a.TEXTUREFORMAT_RG16_SNORM=36761,a.TEXTUREFORMAT_RGB16_SNORM=36762,a.TEXTUREFORMAT_RGBA16_SNORM=36763,a.TEXTUREFORMAT_RG=7,a.TEXTUREFORMAT_RED_INTEGER=8,a.TEXTUREFORMAT_R_INTEGER=8,a.TEXTUREFORMAT_RG_INTEGER=9,a.TEXTUREFORMAT_RGB_INTEGER=10,a.TEXTUREFORMAT_RGBA_INTEGER=11,a.TEXTUREFORMAT_BGRA=12,a.TEXTUREFORMAT_DEPTH24_STENCIL8=13,a.TEXTUREFORMAT_DEPTH32_FLOAT=14,a.TEXTUREFORMAT_DEPTH16=15,a.TEXTUREFORMAT_DEPTH24=16,a.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,a.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,a.TEXTUREFORMAT_STENCIL8=19,a.TEXTUREFORMAT_UNDEFINED=4294967295,a.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,a.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,a.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,a.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,a.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,a.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,a.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,a.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,a.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,a.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,a.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,a.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,a.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,a.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,a.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,a.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,a.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,a.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,a.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,a.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,a.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,a.TEXTURETYPE_UNSIGNED_BYTE=0,a.TEXTURETYPE_UNSIGNED_INT=0,a.TEXTURETYPE_FLOAT=1,a.TEXTURETYPE_HALF_FLOAT=2,a.TEXTURETYPE_BYTE=3,a.TEXTURETYPE_SHORT=4,a.TEXTURETYPE_UNSIGNED_SHORT=5,a.TEXTURETYPE_INT=6,a.TEXTURETYPE_UNSIGNED_INTEGER=7,a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,a.TEXTURETYPE_UNSIGNED_INT_24_8=12,a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,a.TEXTURETYPE_UNDEFINED=16,a.TEXTURE_2D=3553,a.TEXTURE_2D_ARRAY=35866,a.TEXTURE_CUBE_MAP=34067,a.TEXTURE_CUBE_MAP_ARRAY=3735928559,a.TEXTURE_3D=32879,a.TEXTURE_NEAREST_SAMPLINGMODE=1,a.TEXTURE_NEAREST_NEAREST=1,a.TEXTURE_BILINEAR_SAMPLINGMODE=2,a.TEXTURE_LINEAR_LINEAR=2,a.TEXTURE_TRILINEAR_SAMPLINGMODE=3,a.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,a.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,a.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,a.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,a.TEXTURE_NEAREST_LINEAR=7,a.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,a.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,a.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,a.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,a.TEXTURE_LINEAR_NEAREST=12,a.TEXTURE_EXPLICIT_MODE=0,a.TEXTURE_SPHERICAL_MODE=1,a.TEXTURE_PLANAR_MODE=2,a.TEXTURE_CUBIC_MODE=3,a.TEXTURE_PROJECTION_MODE=4,a.TEXTURE_SKYBOX_MODE=5,a.TEXTURE_INVCUBIC_MODE=6,a.TEXTURE_EQUIRECTANGULAR_MODE=7,a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,a.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,a.TEXTURE_FILTERING_QUALITY_HIGH=64,a.TEXTURE_FILTERING_QUALITY_MEDIUM=16,a.TEXTURE_FILTERING_QUALITY_LOW=8,a.SCALEMODE_FLOOR=1,a.SCALEMODE_NEAREST=2,a.SCALEMODE_CEILING=3,a.MATERIAL_TextureDirtyFlag=1,a.MATERIAL_LightDirtyFlag=2,a.MATERIAL_FresnelDirtyFlag=4,a.MATERIAL_AttributesDirtyFlag=8,a.MATERIAL_MiscDirtyFlag=16,a.MATERIAL_PrePassDirtyFlag=32,a.MATERIAL_ImageProcessingDirtyFlag=64,a.MATERIAL_AllDirtyFlag=127,a.MATERIAL_TriangleFillMode=0,a.MATERIAL_WireFrameFillMode=1,a.MATERIAL_PointFillMode=2,a.MATERIAL_PointListDrawMode=3,a.MATERIAL_LineListDrawMode=4,a.MATERIAL_LineLoopDrawMode=5,a.MATERIAL_LineStripDrawMode=6,a.MATERIAL_TriangleStripDrawMode=7,a.MATERIAL_TriangleFanDrawMode=8,a.MATERIAL_ClockWiseSideOrientation=0,a.MATERIAL_CounterClockWiseSideOrientation=1,a.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,a.MATERIAL_DIFFUSE_MODEL_BURLEY=1,a.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,a.MATERIAL_DIFFUSE_MODEL_LEGACY=3,a.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,a.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,a.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,a.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,a.ACTION_NothingTrigger=0,a.ACTION_OnPickTrigger=1,a.ACTION_OnLeftPickTrigger=2,a.ACTION_OnRightPickTrigger=3,a.ACTION_OnCenterPickTrigger=4,a.ACTION_OnPickDownTrigger=5,a.ACTION_OnDoublePickTrigger=6,a.ACTION_OnPickUpTrigger=7,a.ACTION_OnPickOutTrigger=16,a.ACTION_OnLongPressTrigger=8,a.ACTION_OnPointerOverTrigger=9,a.ACTION_OnPointerOutTrigger=10,a.ACTION_OnEveryFrameTrigger=11,a.ACTION_OnIntersectionEnterTrigger=12,a.ACTION_OnIntersectionExitTrigger=13,a.ACTION_OnKeyDownTrigger=14,a.ACTION_OnKeyUpTrigger=15,a.PARTICLES_BILLBOARDMODE_Y=2,a.PARTICLES_BILLBOARDMODE_ALL=7,a.PARTICLES_BILLBOARDMODE_STRETCHED=8,a.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,a.MESHES_CULLINGSTRATEGY_STANDARD=0,a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,a.SCENELOADER_NO_LOGGING=0,a.SCENELOADER_MINIMAL_LOGGING=1,a.SCENELOADER_SUMMARY_LOGGING=2,a.SCENELOADER_DETAILED_LOGGING=3,a.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,a.PREPASS_POSITION_TEXTURE_TYPE=1,a.PREPASS_VELOCITY_TEXTURE_TYPE=2,a.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,a.PREPASS_COLOR_TEXTURE_TYPE=4,a.PREPASS_DEPTH_TEXTURE_TYPE=5,a.PREPASS_NORMAL_TEXTURE_TYPE=6,a.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,a.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,a.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,a.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,a.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,a.PREPASS_ALBEDO_TEXTURE_TYPE=12,a.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,a.BUFFER_CREATIONFLAG_READ=1,a.BUFFER_CREATIONFLAG_WRITE=2,a.BUFFER_CREATIONFLAG_READWRITE=3,a.BUFFER_CREATIONFLAG_UNIFORM=4,a.BUFFER_CREATIONFLAG_VERTEX=8,a.BUFFER_CREATIONFLAG_INDEX=16,a.BUFFER_CREATIONFLAG_STORAGE=32,a.BUFFER_CREATIONFLAG_INDIRECT=64,a.RENDERPASS_MAIN=0,a.INPUT_ALT_KEY=18,a.INPUT_CTRL_KEY=17,a.INPUT_META_KEY1=91,a.INPUT_META_KEY2=92,a.INPUT_META_KEY3=93,a.INPUT_SHIFT_KEY=16,a.SNAPSHOTRENDERING_STANDARD=0,a.SNAPSHOTRENDERING_FAST=1,a.PERSPECTIVE_CAMERA=0,a.ORTHOGRAPHIC_CAMERA=1,a.FOVMODE_VERTICAL_FIXED=0,a.FOVMODE_HORIZONTAL_FIXED=1,a.RIG_MODE_NONE=0,a.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,a.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,a.RIG_MODE_STEREOSCOPIC_INTERLACED=14,a.RIG_MODE_VR=20,a.RIG_MODE_CUSTOM=22,a.MAX_SUPPORTED_UV_SETS=6,a.GL_ALPHA_EQUATION_ADD=32774,a.GL_ALPHA_EQUATION_MIN=32775,a.GL_ALPHA_EQUATION_MAX=32776,a.GL_ALPHA_EQUATION_SUBTRACT=32778,a.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,a.GL_ALPHA_FUNCTION_SRC=768,a.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,a.GL_ALPHA_FUNCTION_SRC_ALPHA=770,a.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,a.GL_ALPHA_FUNCTION_DST_ALPHA=772,a.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,a.GL_ALPHA_FUNCTION_DST_COLOR=774,a.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,a.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,a.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,a.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,a.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,a.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,a.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,a.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,a.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,a.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,a.SnippetUrl="https://snippet.babylonjs.com",a.FOGMODE_NONE=0,a.FOGMODE_EXP=1,a.FOGMODE_EXP2=2,a.FOGMODE_LINEAR=3,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="uk",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra",a.ANIMATIONTYPE_FLOAT=0,a.ANIMATIONTYPE_VECTOR3=1,a.ANIMATIONTYPE_QUATERNION=2,a.ANIMATIONTYPE_MATRIX=3,a.ANIMATIONTYPE_COLOR3=4,a.ANIMATIONTYPE_COLOR4=7,a.ANIMATIONTYPE_VECTOR2=5,a.ANIMATIONTYPE_SIZE=6,a.ShadowMinZ=0,a.ShadowMaxZ=1e4},13112:(U,M,b)=>{"use strict";b(497);var a=b(2405);b(591),b(732),b(587),b(2460),b(2417);a.e},12767:(U,M,b)=>{"use strict";b.d(M,{e:()=>A});var a=b(609);class A{constructor(U){this.value=this._toInt(U)}_toInt(U){return 0|U}add(U){return new A(this.value+U.value)}je(U){return new A(this.value-U.value)}multiply(U){return new A(Math.imul(this.value,U.value))}divide(U){return new A(this.value/U.value)}getClassName(){return A.ClassName}equals(U){return this.value===U.value}static FromValue(U){return new A(U)}toString(){return this.value.toString()}}A.ClassName="FlowGraphInteger",(0,a.i)("FlowGraphInteger",A)},12778:(U,M,b)=>{"use strict";b.d(M,{e:()=>A,g:()=>H});var a=b(670);class A{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.sk=U}get m(){return this.sk}transformVector(U){return this.transformVectorToRef(U,new a.i)}transformVectorToRef(U,M){return M.x=U.x*this.sk[0]+U.y*this.sk[1],M.y=U.x*this.sk[2]+U.y*this.sk[3],M}tk(){return this.toArray()}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let M=0;M<4;M++)U[M]=this.sk[M];return U}ke(U){for(let M=0;M<4;M++)this.sk[M]=U[M];return this}multiplyToRef(U,M){const b=U.sk,a=this.sk,A=M.sk;return A[0]=b[0]*a[0]+b[1]*a[2],A[1]=b[0]*a[1]+b[1]*a[3],A[2]=b[2]*a[0]+b[3]*a[2],A[3]=b[2]*a[1]+b[3]*a[3],M}multiply(U){return this.multiplyToRef(U,new A)}divideToRef(U,M){const b=this.sk,a=U.sk,A=M.sk;return A[0]=b[0]/a[0],A[1]=b[1]/a[1],A[2]=b[2]/a[2],A[3]=b[3]/a[3],M}divide(U){return this.divideToRef(U,new A)}addToRef(U,M){const b=this.sk,a=U.m,A=M.m;return A[0]=b[0]+a[0],A[1]=b[1]+a[1],A[2]=b[2]+a[2],A[3]=b[3]+a[3],M}add(U){return this.addToRef(U,new A)}subtractToRef(U,M){const b=this.sk,a=U.m,A=M.m;return A[0]=b[0]-a[0],A[1]=b[1]-a[1],A[2]=b[2]-a[2],A[3]=b[3]-a[3],M}je(U){return this.subtractToRef(U,new A)}transpose(){const U=this.sk;return new A([U[0],U[2],U[1],U[3]])}determinant(){const U=this.sk;return U[0]*U[3]-U[1]*U[2]}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const M=this.sk,b=1/U;return new A([M[3]*b,-M[1]*b,-M[2]*b,M[0]*b])}equals(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.sk,a=U.m;return 0===M?b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]:Math.abs(b[0]-a[0])<M&&Math.abs(b[1]-a[1])<M&&Math.abs(b[2]-a[2])<M&&Math.abs(b[3]-a[3])<M}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.sk.join(", ")})`}}class H{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.sk=U}get m(){return this.sk}transformVector(U){return this.transformVectorToRef(U,new a.l)}transformVectorToRef(U,M){const b=this.sk;return M.x=U.x*b[0]+U.y*b[1]+U.z*b[2],M.y=U.x*b[3]+U.y*b[4]+U.z*b[5],M.z=U.x*b[6]+U.y*b[7]+U.z*b[8],M}multiplyToRef(U,M){const b=U.sk,a=this.sk,A=M.m;return A[0]=b[0]*a[0]+b[1]*a[3]+b[2]*a[6],A[1]=b[0]*a[1]+b[1]*a[4]+b[2]*a[7],A[2]=b[0]*a[2]+b[1]*a[5]+b[2]*a[8],A[3]=b[3]*a[0]+b[4]*a[3]+b[5]*a[6],A[4]=b[3]*a[1]+b[4]*a[4]+b[5]*a[7],A[5]=b[3]*a[2]+b[4]*a[5]+b[5]*a[8],A[6]=b[6]*a[0]+b[7]*a[3]+b[8]*a[6],A[7]=b[6]*a[1]+b[7]*a[4]+b[8]*a[7],A[8]=b[6]*a[2]+b[7]*a[5]+b[8]*a[8],M}multiply(U){return this.multiplyToRef(U,new H)}divideToRef(U,M){const b=this.sk,a=U.m,A=M.m;return A[0]=b[0]/a[0],A[1]=b[1]/a[1],A[2]=b[2]/a[2],A[3]=b[3]/a[3],A[4]=b[4]/a[4],A[5]=b[5]/a[5],A[6]=b[6]/a[6],A[7]=b[7]/a[7],A[8]=b[8]/a[8],M}divide(U){return this.divideToRef(U,new H)}addToRef(U,M){const b=this.sk,a=U.m,A=M.m;return A[0]=b[0]+a[0],A[1]=b[1]+a[1],A[2]=b[2]+a[2],A[3]=b[3]+a[3],A[4]=b[4]+a[4],A[5]=b[5]+a[5],A[6]=b[6]+a[6],A[7]=b[7]+a[7],A[8]=b[8]+a[8],M}add(U){return this.addToRef(U,new H)}subtractToRef(U,M){const b=this.sk,a=U.m,A=M.m;return A[0]=b[0]-a[0],A[1]=b[1]-a[1],A[2]=b[2]-a[2],A[3]=b[3]-a[3],A[4]=b[4]-a[4],A[5]=b[5]-a[5],A[6]=b[6]-a[6],A[7]=b[7]-a[7],A[8]=b[8]-a[8],M}je(U){return this.subtractToRef(U,new H)}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let M=0;M<9;M++)U[M]=this.sk[M];return U}tk(){return this.toArray()}ke(U){for(let M=0;M<9;M++)this.sk[M]=U[M];return this}transpose(){const U=this.sk;return new H([U[0],U[3],U[6],U[1],U[4],U[7],U[2],U[5],U[8]])}determinant(){const U=this.sk;return U[0]*(U[4]*U[8]-U[5]*U[7])-U[1]*(U[3]*U[8]-U[5]*U[6])+U[2]*(U[3]*U[7]-U[4]*U[6])}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const M=this.sk,b=1/U;return new H([(M[4]*M[8]-M[5]*M[7])*b,(M[2]*M[7]-M[1]*M[8])*b,(M[1]*M[5]-M[2]*M[4])*b,(M[5]*M[6]-M[3]*M[8])*b,(M[0]*M[8]-M[2]*M[6])*b,(M[2]*M[3]-M[0]*M[5])*b,(M[3]*M[7]-M[4]*M[6])*b,(M[1]*M[6]-M[0]*M[7])*b,(M[0]*M[4]-M[1]*M[3])*b])}equals(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.sk,a=U.m;return 0===M?b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]&&b[4]===a[4]&&b[5]===a[5]&&b[6]===a[6]&&b[7]===a[7]&&b[8]===a[8]:Math.abs(b[0]-a[0])<M&&Math.abs(b[1]-a[1])<M&&Math.abs(b[2]-a[2])<M&&Math.abs(b[3]-a[3])<M&&Math.abs(b[4]-a[4])<M&&Math.abs(b[5]-a[5])<M&&Math.abs(b[6]-a[6])<M&&Math.abs(b[7]-a[7])<M&&Math.abs(b[8]-a[8])<M}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.sk.join(", ")})`}}},12785:(U,M,b)=>{"use strict";var a;function A(U,M,b,a){switch(M){case"Animation":return a?U.animations.find((U=>U.uniqueId===b))??null:U.animations[b]??null;case"AnimationGroup":return a?U.animationGroups.find((U=>U.uniqueId===b))??null:U.animationGroups[b]??null;case"Mesh":return a?U.meshes.find((U=>U.uniqueId===b))??null:U.meshes[b]??null;case"Material":return a?U.materials.find((U=>U.uniqueId===b))??null:U.materials[b]??null;case"fk":return a?U.cameras.find((U=>U.uniqueId===b))??null:U.cameras[b]??null;case"Light":return a?U.lights.find((U=>U.uniqueId===b))??null:U.lights[b]??null;default:return null}}b.d(M,{d:()=>A}),function(U){U.Animation="Animation",U.AnimationGroup="AnimationGroup",U.Mesh="Mesh",U.Material="Material",U.fk="fk",U.Light="Light"}(a||(a={}))},12823:(U,M,b)=>{"use strict";b.d(M,{d:()=>A});var a=b(12830);class A extends a.e{constructor(U,M){if(super(U),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),M)for(const b of M)this._eventsSignalOutputs[b]=this._registerSignalOutput(b+"Event")}_executeOnTick(U){}_startPendingTasks(U){U._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(U),this._resetAfterCanceled(U)),this._preparePendingTasks(U),U._addPendingBlock(this),this.out._activateSignal(U),U._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(U){U._deleteExecutionVariable(this,"_initialized"),U._removePendingBlock(this)}}},12795:(U,M,b)=>{"use strict";b.d(M,{c:()=>e});var a=b(614),A=b(609),H=b(12800),W=b(474),y=b(12763);class O extends H.d{constructor(U,M,b,a){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.defaultValue,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(U,M,b),this.richType=a,this._defaultValue=A,this._optional=H,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new W.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(U){this._isDisabled!==U&&(this._isDisabled=U,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(U,M){M._getConnectionValue(this)!==U&&(M._setConnectionValue(this,U),this.onValueChangedObservable.notifyObservers(U))}resetToDefaultValue(U){U._setConnectionValue(this,this._defaultValue)}connectTo(U){this._isDisabled||super.connectTo(U)}_getValueOrDefault(U){const M=U._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(M):M}getValue(U){if(1===this.connectionType){U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(U);const M=this._getValueOrDefault(U);return this._lastValue=M,this.richType.typeTransformer?this.richType.typeTransformer(M):M}const M=this.isConnected()?this._connectedPoint[0].getValue(U):this._getValueOrDefault(U);return this._lastValue=M,this.richType.typeTransformer?this.richType.typeTransformer(M):M}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.richType={},this.richType.serialize(U.richType),U.optional=this._optional,(0,y.i)("defaultValue",this._defaultValue,U)}}(0,A.i)("FlowGraphDataConnection",O);class e{constructor(U){var M;this.config=U,this.uniqueId=(0,a.d)(),this.name=(null===(M=this.config)||void 0===M?void 0:M.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(U){}registerDataInput(U,M,b){const a=new O(U,0,this,M,b);return this.dataInputs.push(a),a}registerDataOutput(U,M,b){const a=new O(U,1,this,M,b);return this.dataOutputs.push(a),a}getDataInput(U){return this.dataInputs.find((M=>M.name===U))}getDataOutput(U){return this.dataOutputs.find((M=>M.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.i;if(U.uniqueId=this.uniqueId,U.config={},this.config){const b=this.config,a=Object.keys(b);for(const A of a)M(A,b[A],U.config)}U.dataInputs=[],U.dataOutputs=[],U.className=this.getClassName();for(const b of this.dataInputs){const M={};b.serialize(M),U.dataInputs.push(M)}for(const b of this.dataOutputs){const M={};b.serialize(M),U.dataOutputs.push(M)}}deserialize(U){}_log(U,M,b){var a;null===(a=U.logger)||void 0===a||a.addLogItem({action:M,payload:b,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12800:(U,M,b)=>{"use strict";b.d(M,{d:()=>H});var a,A=b(614);!function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(a||(a={}));class H{constructor(U,M,b){this._ownerBlock=b,this._connectedPoint=[],this.uniqueId=(0,A.d)(),this.connectedPointIds=[],this.name=U,this._connectionType=M}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(U){if(this._connectionType===U._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||U._isSingularConnection()&&U._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(U),U._connectedPoint.push(this)}disconnectFrom(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._connectedPoint.indexOf(U),a=U._connectedPoint.indexOf(this);-1!==b&&-1!==a&&(M&&this._connectedPoint.splice(b,1),U._connectedPoint.splice(a,1))}disconnectFromAll(){for(const U of this._connectedPoint)this.disconnectFrom(U,!1);this._connectedPoint.length=0}dispose(){for(const U of this._connectedPoint)this.disconnectFrom(U)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U.uniqueId=this.uniqueId,U.name=this.name,U._connectionType=this._connectionType,U.connectedPointIds=[],U.className=this.getClassName();for(const M of this._connectedPoint)U.connectedPointIds.push(M.uniqueId)}getClassName(){return"FGConnection"}deserialize(U){this.uniqueId=U.uniqueId,this.name=U.name,this._connectionType=U._connectionType,this.connectedPointIds=U.connectedPointIds}}},12755:(U,M,b)=>{"use strict";b.d(M,{c:()=>L});var a,A=b(474),H=b(645),W=b(652),y=b(614),O=b(12763),e=b(12785),x=b(497);!function(U){U.ExecuteBlock="ExecuteBlock",U.ExecuteEvent="ExecuteEvent",U.TriggerConnection="TriggerConnection",U.ContextVariableSet="ContextVariableSet",U.GlobalVariableSet="GlobalVariableSet",U.GlobalVariableDelete="GlobalVariableDelete",U.GlobalVariableGet="GlobalVariableGet",U.AddConnection="AddConnection",U.GetConnectionValue="GetConnectionValue",U.SetConnectionValue="SetConnectionValue",U.ActivateSignal="ActivateSignal",U.ContextVariableGet="ContextVariableGet"}(a||(a={}));class P{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(U){if(U.time||(U.time=Date.now()),this.log.push(U),this.logToConsole){var M;const b=null===(M=U.payload)||void 0===M?void 0:M.value;"object"===typeof b&&b.getClassName?x.b.Log(`[FGLog] ${U.className}:${U.uniqueId.split("-")[0]} ${U.action} - ${JSON.stringify(b.getClassName())}: ${b.toString()}`):x.b.Log(`[FGLog] ${U.className}:${U.uniqueId.split("-")[0]} ${U.action} - ${JSON.stringify(U.payload)}`)}}getItemsOfType(U){return this.log.filter((M=>M.action===U))}}class Z{get enableLogging(){return this._enableLogging}set enableLogging(U){this._enableLogging!==U&&(this._enableLogging=U,this._enableLogging?(this.logger=new P,this.logger.logToConsole=!0):this.logger=null)}constructor(U){this.uniqueId=(0,y.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new A.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=U,this.assetsContext=U.assetsContext??U.$e}hasVariable(U){return U in this._userVariables}setVariable(U,M){var b;this._userVariables[U]=M,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:U,value:M}})}getAsset(U,M){return(0,e.d)(this.assetsContext,U,M)}getVariable(U){var M;return null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:U,value:this._userVariables[U]}}),this._userVariables[U]}get userVariables(){return this._userVariables}va(){return this._configuration.$e}_getUniqueIdPrefixedName(U,M){return`${U.uniqueId}_${M}`}_getGlobalContextVariable(U,M){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:U,defaultValue:M,possibleValue:this._globalContextVariables[U]}}),this._hasGlobalContextVariable(U)?this._globalContextVariables[U]:M}_setGlobalContextVariable(U,M){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:U,value:M}}),this._globalContextVariables[U]=M}_deleteGlobalContextVariable(U){var M;null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:U}}),delete this._globalContextVariables[U]}_hasGlobalContextVariable(U){return U in this._globalContextVariables}_setExecutionVariable(U,M,b){this._executionVariables[this._getUniqueIdPrefixedName(U,M)]=b}_getExecutionVariable(U,M,b){return this._hasExecutionVariable(U,M)?this._executionVariables[this._getUniqueIdPrefixedName(U,M)]:b}_deleteExecutionVariable(U,M){delete this._executionVariables[this._getUniqueIdPrefixedName(U,M)]}_hasExecutionVariable(U,M){return this._getUniqueIdPrefixedName(U,M)in this._executionVariables}_hasConnectionValue(U){return U.uniqueId in this._connectionValues}_setConnectionValue(U,M){var b;this._connectionValues[U.uniqueId]=M,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:U.uniqueId,value:M}})}_setConnectionValueByKey(U,M){this._connectionValues[U]=M}_getConnectionValue(U){var M;return null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:U.uniqueId,value:this._connectionValues[U.uniqueId]}}),this._connectionValues[U.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(U){this._pendingBlocks.includes(U)||(this._pendingBlocks.push(U),this._pendingBlocks.sort(((U,M)=>U.priority-M.priority)))}_removePendingBlock(U){const M=this._pendingBlocks.indexOf(U);-1!==M&&this._pendingBlocks.splice(M,1)}_clearPendingBlocks(){for(const U of this._pendingBlocks)U._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(U){var M;this.onNodeExecutedObservable.notifyObservers(U),null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:U.getClassName(),uniqueId:U.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(U){this._setGlobalContextVariable("timeSinceStart",U.timeSinceStart),this._setGlobalContextVariable("deltaTime",U.deltaTime);for(const b of this._pendingBlocks){var M;null===(M=b._executeOnTick)||void 0===M||M.call(b,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.i;U.uniqueId=this.uniqueId,U._userVariables={};for(const a in this._userVariables)M(a,this._userVariables[a],U._userVariables);U._connectionValues={};for(const a in this._connectionValues)M(a,this._connectionValues[a],U._connectionValues);var b;this.assetsContext!==this.va()&&(U._assetsContext={meshes:this.assetsContext.meshes.map((U=>U.id)),materials:this.assetsContext.materials.map((U=>U.id)),textures:this.assetsContext.textures.map((U=>U.name)),animations:this.assetsContext.animations.map((U=>U.name)),lights:this.assetsContext.lights.map((U=>U.id)),cameras:this.assetsContext.cameras.map((U=>U.id)),vm:null===(b=this.assetsContext.vm)||void 0===b?void 0:b.map((U=>U.name)),skeletons:this.assetsContext.skeletons.map((U=>U.id)),Ik:this.assetsContext.Ik.map((U=>U.name)),geometries:this.assetsContext.geometries.map((U=>U.id)),multiMaterials:this.assetsContext.multiMaterials.map((U=>U.id)),transformNodes:this.assetsContext.transformNodes.map((U=>U.id))})}getClassName(){return"FlowGraphContext"}}(0,H.c)([(0,W.J)()],Z.prototype,"uniqueId",void 0);var C=b(12793),r=b(2517);class B{constructor(U){this.onEventTriggeredObservable=new A.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=U,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.rk.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const U=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:U}}),this._startingTime+=U})),this._meshPickedObserver=this._scene.onPointerObservable.add((U=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:U})}),r.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((U=>{const M=U.pointerId,b=U.mesh,a=this._pointerUnderMeshState[M];!a&&b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:M,mesh:b}}):a&&!b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:M,mesh:a}}):a&&b&&a!==b&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:M,mesh:a,over:b}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:M,mesh:b,out:a}})),this._pointerUnderMeshState[M]=b}),r.c.POINTERMOVE)}dispose(){var U,M,b,a,A;null===(U=this._sceneDisposeObserver)||void 0===U||U.remove(),null===(M=this._sceneReadyObserver)||void 0===M||M.remove(),null===(b=this._sceneOnBeforeRenderObserver)||void 0===b||b.remove(),null===(a=this._meshPickedObserver)||void 0===a||a.remove(),null===(A=this._meshUnderPointerObserver)||void 0===A||A.remove(),this.onEventTriggeredObservable.clear()}}var J,F=b(12809);!function(U){U[U.Stopped=0]="Stopped",U[U.Started=1]="Started"}(J||(J={}));class f{get state(){return this._state}set state(U){this._state=U,this.onStateChangedObservable.notifyObservers(U)}constructor(U){this.onStateChangedObservable=new A.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=U.$e,this._sceneEventCoordinator=new B(this._scene),this._coordinator=U.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((U=>{for(const M of this._executionContexts){const b=this._getContextualOrder(U.type,M);for(const a of b)if(!a._executeEvent(M,U.payload))break}switch(U.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const M of this._executionContexts)M._notifyOnTick(U.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const U=new Z({$e:this._scene,coordinator:this._coordinator});return this._executionContexts.push(U),U}getContext(U){return this._executionContexts[U]}addEventBlock(U){if("PointerOver"!==U.type&&"PointerOut"!==U.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==U.type&&this._eventBlocks[U.type].push(U),1===this.state)for(const M of this._executionContexts)U._startPendingTasks(M);else this.onStateChangedObservable.addOnce((M=>{if(1===M)for(const b of this._executionContexts)U._startPendingTasks(b)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((U=>{1===U&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const U of this._executionContexts)for(const M in this._eventBlocks){const b=this._getContextualOrder(M,U);for(const M of b)M._startPendingTasks(U)}}_getContextualOrder(U,M){const b=this._eventBlocks[U].sort(((U,M)=>M.initPriority-U.initPriority));if("MeshPick"===U){const U=[];for(const a of b){const A=a.asset.getValue(M);let H=0;for(;H<b.length;H++){const U=b[H].asset.getValue(M);if(A&&U&&(0,F.o)(A,U))break}U.splice(H,0,a)}return U}return b}dispose(){var U;if(0!==this.state){this.state=0;for(const U of this._executionContexts)U._clearPendingBlocks();this._executionContexts.length=0;for(const U in this._eventBlocks)this._eventBlocks[U].length=0;null===(U=this._eventObserver)||void 0===U||U.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(U){const M=[],b=new Set;for(const a in this._eventBlocks)for(const U of this._eventBlocks[a])M.push(U),b.add(U.uniqueId);for(;M.length>0;){const a=M.pop();U(a);for(const U of a.dataInputs)for(const a of U._connectedPoint)b.has(a._ownerBlock.uniqueId)||(M.push(a._ownerBlock),b.add(a._ownerBlock.uniqueId));if(a instanceof C.c)for(const U of a.signalOutputs)for(const a of U._connectedPoint)b.has(a._ownerBlock.uniqueId)||(M.push(a._ownerBlock),b.add(a._ownerBlock.uniqueId))}}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},M=arguments.length>1?arguments[1]:void 0;U.allBlocks=[],this.visitAllBlocks((M=>{const b={};M.serialize(b),U.allBlocks.push(b)})),U.executionContexts=[];for(const b of this._executionContexts){const a={};b.serialize(a,M),U.executionContexts.push(a)}}}class L{constructor(U){this.config=U,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.$e.rk.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.$e.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const U=this._executeOnNextFrame.slice(0);if(U.length)for(const M of U){this.notifyCustomEvent(M.id,M.data,!1);const U=this._executeOnNextFrame.findIndex((U=>U.uniqueId===M.uniqueId));-1!==U&&this._executeOnNextFrame.splice(U,1)}}));(L.SceneCoordinators.get(this.config.$e)??[]).push(this)}createGraph(){const U=new f({$e:this.config.$e,coordinator:this});return this._flowGraphs.push(U),U}removeGraph(U){const M=this._flowGraphs.indexOf(U);-1!==M&&(U.dispose(),this._flowGraphs.splice(M,1))}start(){for(const U of this._flowGraphs)U.start()}dispose(){var U,M;for(const A of this._flowGraphs)A.dispose();this._flowGraphs.length=0,null===(U=this._disposeObserver)||void 0===U||U.remove(),null===(M=this._onBeforeRenderObserver)||void 0===M||M.remove();const b=L.SceneCoordinators.get(this.config.$e)??[],a=b.indexOf(this);-1!==a&&b.splice(a,1)}serialize(U,M){U._flowGraphs=[];for(const b of this._flowGraphs){const a={};b.serialize(a,M),U._flowGraphs.push(a)}U.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(U){let M=this._customEventsMap.get(U);return M||(M=new A.e,this._customEventsMap.set(U,M)),M}notifyCustomEvent(U,M){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:U,data:M,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(U)){const M=this._eventExecutionCounter.get(U);if(this._eventExecutionCounter.set(U,M+1),M>=L.MaxEventTypeExecutionPerFrame)return void(M===L.MaxEventTypeExecutionPerFrame&&x.b.Warn(`FlowGraphCoordinator: Too many executions of event "${U}".`))}else this._eventExecutionCounter.set(U,1);const b=this._customEventsMap.get(U);b&&b.notifyObservers(M)}}L.MaxEventsPerType=30,L.MaxEventTypeExecutionPerFrame=30,L.SceneCoordinators=new Map},12814:(U,M,b)=>{"use strict";b.d(M,{b:()=>A});var a=b(12823);class A extends a.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(U){U._notifyExecuteNode(this),this.done._activateSignal(U)}}},12793:(U,M,b)=>{"use strict";b.d(M,{c:()=>y});var a=b(12795),A=b(12800),H=b(609);class W extends A.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(U){super.connectTo(U),this._connectedPoint.sort(((U,M)=>M.priority-U.priority))}_activateSignal(U){var M;if(null===(M=U.logger)||void 0===M||M.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(U,this),U._increaseExecutionId();else for(const b of this._connectedPoint)b._activateSignal(U)}}(0,H.i)("FlowGraphSignalConnection",W);class y extends a.c{constructor(U){super(U),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(U){const M=new W(U,0,this);return this.signalInputs.push(M),M}_registerSignalOutput(U){const M=new W(U,1,this);return this.signalOutputs.push(M),M}_unregisterSignalInput(U){const M=this.signalInputs.findIndex((M=>M.name===U));-1!==M&&(this.signalInputs[M].dispose(),this.signalInputs.splice(M,1))}_unregisterSignalOutput(U){const M=this.signalOutputs.findIndex((M=>M.name===U));-1!==M&&(this.signalOutputs[M].dispose(),this.signalOutputs.splice(M,1))}_reportError(U,M){this.error.payload="string"===typeof M?new Error(M):M,this.error._activateSignal(U)}getSignalInput(U){return this.signalInputs.find((M=>M.name===U))}getSignalOutput(U){return this.signalOutputs.find((M=>M.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.signalInputs=[],U.signalOutputs=[];for(const M of this.signalInputs){const b={};M.serialize(b),U.signalInputs.push(b)}for(const M of this.signalOutputs){const b={};M.serialize(b),U.signalOutputs.push(b)}}deserialize(U){for(let M=0;M<U.signalInputs.length;M++){const b=this.getSignalInput(U.signalInputs[M].name);if(!b)throw new Error("Could not find signal input with name "+U.signalInputs[M].name+" in block "+U.className);b.deserialize(U.signalInputs[M])}for(let M=0;M<U.signalOutputs.length;M++){const b=this.getSignalOutput(U.signalOutputs[M].name);if(!b)throw new Error("Could not find signal output with name "+U.signalOutputs[M].name+" in block "+U.className);b.deserialize(U.signalOutputs[M])}}getClassName(){return"FlowGraphExecutionBlock"}}},12830:(U,M,b)=>{"use strict";b.d(M,{e:()=>A});var a=b(12793);class A extends a.c{constructor(U){super(U),this.out=this._registerSignalOutput("out")}}},12775:(U,M,b)=>{"use strict";b.d(M,{D:()=>C,G:()=>r,H:()=>B,I:()=>Y,K:()=>d,M:()=>i,Q:()=>h,c:()=>e,f:()=>Z,i:()=>S,m:()=>J,p:()=>F,s:()=>f,t:()=>P,x:()=>o,z:()=>x});var a,A=b(670),H=b(707),W=b(12767),y=b(12778);!function(U){U.Any="any",U.String="string",U.Number="number",U.Boolean="boolean",U.Object="object",U.Integer="FlowGraphInteger",U.Vector2="Vector2",U.lk="lk",U.Vector4="Vector4",U.Quaternion="Quaternion",U.Matrix="Matrix",U.Matrix2D="Matrix2D",U.Matrix3D="Matrix3D",U.Ck="Ck",U.Dk="Dk"}(a||(a={}));class O{constructor(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=U,this.defaultValue=M,this.animationType=b}serialize(U){U.typeName=this.typeName,U.defaultValue=this.defaultValue}}const e=new O("any",void 0),x=new O("string",""),P=new O("number",0,0),Z=new O("boolean",!1),C=new O("Vector2",A.i.Zero(),5),r=new O("lk",A.l.Zero(),1),B=new O("Vector4",A.n.Zero()),J=new O("Matrix",A.b.Identity(),3),F=new O("Matrix2D",new y.e),f=new O("Matrix3D",new y.g),L=new O("Ck",H.c.Black(),4),z=new O("Dk",new H.e(0,0,0,0),7),o=new O("Quaternion",A.e.Identity(),2);o.typeTransformer=U=>{if(U.getClassName){if("Vector4"===U.getClassName())return A.e.jk(U.tk());if("lk"===U.getClassName())return A.e.FromEulerVector(U);if("Matrix"===U.getClassName())return A.e.FromRotationMatrix(U)}return U};const S=new O("FlowGraphInteger",new W.e(0),0);function h(U){const M=U;switch(typeof U){case"string":return x;case"number":return P;case"boolean":return Z;case"object":if(M.getClassName)switch(M.getClassName()){case"Vector2":return C;case"lk":return r;case"Vector4":return B;case"Matrix":return J;case"Ck":return L;case"Dk":return z;case"Quaternion":return o;case"FlowGraphInteger":return S;case"Matrix2D":return F;case"Matrix3D":return f}return e;default:return e}}function i(U){switch(U){case"string":return x;case"number":return P;case"boolean":return Z;case"Vector2":return C;case"lk":return r;case"Vector4":return B;case"Matrix":return J;case"Ck":return L;case"Dk":return z;case"Quaternion":return o;case"FlowGraphInteger":return S;case"Matrix2D":return F;case"Matrix3D":return f;default:return e}}function Y(U){switch(U){case"number":default:return 0;case"Vector2":return 5;case"lk":return 1;case"Matrix":return 3;case"Ck":return 4;case"Dk":return 7;case"Quaternion":return 2}}function d(U){switch(U){case 0:return P;case 5:return C;case 1:return r;case 3:return J;case 4:return L;case 7:return z;case 2:return o;default:return e}}},12763:(U,M,b)=>{"use strict";b.d(M,{e:()=>x,i:()=>e,m:()=>P});var a=b(707),A=b(670),H=b(12767),W=b(12775),y=b(12778);function O(U){return"Vector2"===U||"lk"===U||"Vector4"===U||"Quaternion"===U||"Ck"===U||"Dk"===U}function e(U,M,b){var a;const A=(null===M||void 0===M||null===(a=M.getClassName)||void 0===a?void 0:a.call(M))??"";if(O(A)||function(U){return"Matrix"===U||"Matrix2D"===U||"Matrix3D"===U}(A))b[U]={value:M.tk(),className:A};else if("FlowGraphInteger"===A)b[U]={value:M.value,className:A};else if(A&&(M.id||M.name))b[U]={id:M.id,name:M.name,className:A};else{if("object"===typeof M)throw new Error(`Could not serialize value ${M}`);b[U]=M}}function x(U,M,b,e){const P=M[U];let Z;const C=(null===P||void 0===P?void 0:P.type)??(null===P||void 0===P?void 0:P.className);if(function(U){return"Mesh"===U||"AbstractMesh"===U||"GroundMesh"===U||"InstanceMesh"===U||"LinesMesh"===U||"GoldbergMesh"===U||"GreasedLineMesh"===U||"TrailMesh"===U}(C)){let U=e.meshes.filter((U=>P.id?U.id===P.id:U.name===P.name));0===U.length&&(U=e.transformNodes.filter((U=>P.id?U.id===P.id:U.name===P.name))),Z=P.uniqueId?U.find((U=>U.uniqueId===P.uniqueId)):U[0]}else if(O(C))Z=function(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===U)return A.i.jk(M);if("lk"===U)return b&&(M[2]*=-1),A.l.jk(M);if("Vector4"===U)return A.n.jk(M);if("Quaternion"===U)return b&&(M[2]*=-1,M[3]*=-1),A.e.jk(M);if("Ck"===U)return new a.c(M[0],M[1],M[2]);if("Dk"===U)return new a.e(M[0],M[1],M[2],M[3]);throw new Error(`Unknown vector class name ${U}`)}(C,P.value);else if(function(U){return"AnimationGroup"===U}(C)){const U=e.animationGroups.filter((U=>U.name===P.name));Z=1===U.length?U[0]:U.find((U=>U.uniqueId===P.uniqueId))}else Z="Matrix"===C?A.b.jk(P.value):"Matrix2D"===C?new y.e(P.value):"Matrix3D"===C?new y.g(P.value):"FlowGraphInteger"===C?H.e.FromValue(P.value):"number"===C||"string"===C||"boolean"===C?P.value[0]:P&&void 0!==P.value?P.value:Array.isArray(P)?P.reduce(((U,M)=>M.eventData?(U[M.id]={type:(0,W.M)(M.type)},"undefined"!==typeof M.value&&(U[M.id].value=x("value",M,b,e)),U):U),{}):P;return Z}function P(U){return"FlowGraphJsonPointerParserBlock"===U}},12809:(U,M,b)=>{"use strict";function a(U,M){return!(!U.parent||U.parent!==M&&!a(U.parent,M))}function A(U){if(U.getClassName)return U.getClassName()}function H(U,M){return U===M&&("Vector2"===U||"lk"===U||"Vector4"===U||"Quaternion"===U)}function W(U,M){return U===M&&("Matrix"===U||"Matrix2D"===U||"Matrix3D"===U)}function y(U,M){return"FlowGraphInteger"===U&&"FlowGraphInteger"===M}function O(U,M){const b="number"===typeof U||"number"===typeof(null===U||void 0===U?void 0:U.value);return b&&!M?!isNaN(e(U)):b}function e(U){return"number"===typeof U?U:U.value}b.d(M,{c:()=>y,f:()=>W,j:()=>H,k:()=>A,o:()=>a,r:()=>e,t:()=>O})},12081:(U,M,b)=>{"use strict";b.r(M),b.d(M,{SceneInstrumentation:()=>H});var a=b(479),A=b(2475);class H{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(U){U!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=U,U?(this._onBeforeActiveMeshesEvaluationObserver=this.$e.onBeforeActiveMeshesEvaluationObservable.add((()=>{a.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.$e.onAfterActiveMeshesEvaluationObservable.add((()=>{a.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.$e.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.$e.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(U){U!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=U,U?(this._onBeforeRenderTargetsRenderObserver=this.$e.onBeforeRenderTargetsRenderObservable.add((()=>{a.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.$e.onAfterRenderTargetsRenderObservable.add((()=>{a.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.$e.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.$e.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(U){U!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=U,U?(this._onBeforeParticlesRenderingObserver=this.$e.onBeforeParticlesRenderingObservable.add((()=>{a.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.$e.onAfterParticlesRenderingObservable.add((()=>{a.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.$e.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.$e.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(U){U!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=U,this.$e.spriteManagers&&(U?(this._onBeforeSpritesRenderingObserver=this.$e.onBeforeSpritesRenderingObservable.add((()=>{a.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.$e.onAfterSpritesRenderingObservable.add((()=>{a.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.$e.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.$e.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(U){U!==this._capturePhysicsTime&&this.$e.onBeforePhysicsObservable&&(this._capturePhysicsTime=U,U?(this._onBeforePhysicsObserver=this.$e.onBeforePhysicsObservable.add((()=>{a.d.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.$e.onAfterPhysicsObservable.add((()=>{a.d.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.$e.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.$e.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(U){U!==this._captureAnimationsTime&&(this._captureAnimationsTime=U,U?this._onAfterAnimationsObserver=this.$e.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.$e.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(U){this._captureFrameTime=U}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(U){this._captureInterFrameTime=U}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(U){U!==this._captureRenderTime&&(this._captureRenderTime=U,U?(this._onBeforeDrawPhaseObserver=this.$e.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),a.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.$e.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),a.d.EndPerformanceCounter("Main render")}))):(this.$e.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.$e.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(U){U!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=U,U?(this._onBeforeCameraRenderObserver=this.$e.onBeforeCameraRenderObservable.add((U=>{this._cameraRenderTime.beginMonitoring(),a.d.StartPerformanceCounter(`Rendering camera ${U.name}`)})),this._onAfterCameraRenderObserver=this.$e.onAfterCameraRenderObservable.add((U=>{this._cameraRenderTime.endMonitoring(!1),a.d.EndPerformanceCounter(`Rendering camera ${U.name}`)}))):(this.$e.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.$e.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.$e.getEngine()._drawCalls}constructor(U){this.$e=U,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new A.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new A.e,this._captureFrameTime=!1,this._frameTime=new A.e,this._captureRenderTime=!1,this._renderTime=new A.e,this._captureInterFrameTime=!1,this._interFrameTime=new A.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new A.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new A.e,this._capturePhysicsTime=!1,this._physicsTime=new A.e,this._captureAnimationsTime=!1,this._animationsTime=new A.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new A.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=U.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(a.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.$e.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=U.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(a.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.qk(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.qk(),this._captureParticlesRenderTime&&this._particlesRenderTime.qk(),this._captureSpritesRenderTime&&this._spritesRenderTime.qk(),this._captureRenderTime&&this._renderTime.qk(),this._captureCameraRenderTime&&this._cameraRenderTime.qk()}))}dispose(){this._disposed||(this.$e.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.$e.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.$e.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.$e.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.$e.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.$e.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.$e.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.$e.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.$e.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.$e.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.$e.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.$e.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.$e.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.$e.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.$e.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.$e.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.$e.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.$e=null,this._disposed=!0)}}},12753:(U,M,b)=>{"use strict";b.d(M,{e:()=>x});var a=b(645),A=b(652),H=b(670),W=b(689),y=b(12671),O=b(12713),e=b(609);W.e.AddNodeConstructor("Light_Type_1",((U,M)=>()=>new x(U,H.l.Zero(),M)));class x extends O.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(U){this._shadowFrustumSize=U,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(U){this._shadowOrthoScale=U,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(U){this._orthoLeft=U}get orthoRight(){return this._orthoRight}set orthoRight(U){this._orthoRight=U}get orthoTop(){return this._orthoTop}set orthoTop(U){this._orthoTop=U}get orthoBottom(){return this._orthoBottom}set orthoBottom(U){this._orthoBottom=U}constructor(U,M,b){super(U,b),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=M.scale(-1),this.direction=M}getClassName(){return"ib"}getTypeID(){return y.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(U,M,b){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(U):this._setDefaultAutoExtendShadowProjectionMatrix(U,M,b)}_setDefaultFixedFrustumShadowProjectionMatrix(U){const M=this.va().activeCamera;M&&H.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:M.ek,void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ,U,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(U,M,b){const a=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const U=H.l.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let a=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let W=0;W<b.length;W++){const y=b[W];if(!y)continue;const O=y.getBoundingInfo().boundingBox;for(let b=0;b<O.vectorsWorld.length;b++)H.l.TransformCoordinatesToRef(O.vectorsWorld[b],M,U),U.x<this._orthoLeft&&(this._orthoLeft=U.x),U.y<this._orthoBottom&&(this._orthoBottom=U.y),U.x>this._orthoRight&&(this._orthoRight=U.x),U.y>this._orthoTop&&(this._orthoTop=U.y),this.autoCalcShadowZBounds&&(U.z<a&&(a=U.z),U.z>A&&(A=U.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=a,this._shadowMaxZ=A)}const A=this._orthoRight-this._orthoLeft,W=this._orthoTop-this._orthoBottom,y=void 0!==this.shadowMinZ?this.shadowMinZ:(null===a||void 0===a?void 0:a.ek)||0,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===a||void 0===a?void 0:a.maxZ)||1e4,e=this.va().getEngine().useReverseDepthBuffer;H.b.OrthoOffCenterLHToRef(this._orthoLeft-A*this.shadowOrthoScale,this._orthoRight+A*this.shadowOrthoScale,this._orthoBottom-W*this.shadowOrthoScale,this._orthoTop+W*this.shadowOrthoScale,e?O:y,e?y:O,U,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,M){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,M),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,M),this)}transferToNodeMaterialEffect(U,M){return this.computeTransformedInformation()?(U.setFloat3(M,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(U.setFloat3(M,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(U){const M=this._scene.getEngine();return!M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:1}getDepthMaxZ(U){const M=this._scene.getEngine();return M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:1}prepareLightSpecificDefines(U,M){U["DIRLIGHT"+M]=!0}}(0,a.c)([(0,A.J)()],x.prototype,"shadowFrustumSize",null),(0,a.c)([(0,A.J)()],x.prototype,"shadowOrthoScale",null),(0,a.c)([(0,A.J)()],x.prototype,"autoUpdateExtends",void 0),(0,a.c)([(0,A.J)()],x.prototype,"autoCalcShadowZBounds",void 0),(0,a.c)([(0,A.J)("orthoLeft")],x.prototype,"_orthoLeft",void 0),(0,a.c)([(0,A.J)("orthoRight")],x.prototype,"_orthoRight",void 0),(0,a.c)([(0,A.J)("orthoTop")],x.prototype,"_orthoTop",void 0),(0,a.c)([(0,A.J)("orthoBottom")],x.prototype,"_orthoBottom",void 0),(0,e.i)("BABYLON.DirectionalLight",x)},13043:(U,M,b)=>{"use strict";b.d(M,{b:()=>x});var a=b(645),A=b(652),H=b(670),W=b(707),y=b(689),O=b(12671),e=b(609);y.e.AddNodeConstructor("Light_Type_3",((U,M)=>()=>new x(U,H.l.Zero(),M)));class x extends O.c{constructor(U,M,b){super(U,b),this.groundColor=new W.c(0,0,0),this.direction=M||H.l.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(U){return this.direction=H.l.Normalize(U.je(H.l.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(U,M){const b=H.l.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",b.x,b.y,b.z,0,M),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Rl),M),this}transferToNodeMaterialEffect(U,M){const b=H.l.Normalize(this.direction);return U.setFloat3(M,b.x,b.y,b.z),this}ik(){return this._worldMatrix||(this._worldMatrix=H.b.Identity()),this._worldMatrix}getTypeID(){return O.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(U,M){U["HEMILIGHT"+M]=!0}}(0,a.c)([(0,A.j)()],x.prototype,"groundColor",void 0),(0,a.c)([(0,A.H)()],x.prototype,"direction",void 0),(0,e.i)("BABYLON.HemisphericLight",x)},12671:(U,M,b)=>{"use strict";b.d(M,{c:()=>Z});var a=b(645),A=b(652),H=b(670),W=b(707),y=b(689),O=b(801),e=b(609),x=b(821),P=b(698);class Z extends y.e{get range(){return this._range}set range(U){this._range=U,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(U){this._intensityMode=U,this._computePhotometricScale()}get radius(){return this._radius}set radius(U){this._radius=U,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(U){this._shadowEnabled!==U&&(this._shadowEnabled=U,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(U){this._includedOnlyMeshes=U,this._hookArrayForIncludedOnly(U)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(U){this._excludedMeshes=U,this._hookArrayForExcluded(U)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(U){this._excludeWithLayerMask=U,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(U){this._includeOnlyWithLayerMask=U,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(U){this._lightmapMode!==U&&(this._lightmapMode=U,this._markMeshesAsLightDirty())}getViewMatrix(U){return null}getProjectionMatrix(U,M){return null}constructor(U,M){super(U,M,!1),this.Zk=new W.c(1,1,1),this.Ak=new W.c(1,1,1),this.falloffType=Z.FALLOFF_DEFAULT,this.Rl=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=Z.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new O.c(this.va().getEngine(),void 0,void 0,U),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(U,M){return this}_bindLight(U,M,b,a){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const H=U.toString();let y=!1;if(this._uniformBuffer.bindToEffect(b,"Light"+H),this._renderId!==M.getRenderId()||this._lastUseSpecular!==a||!this._uniformBuffer.useUbo){this._renderId=M.getRenderId(),this._lastUseSpecular=a;const U=this.getScaledIntensity();this.transferToEffect(b,H),this.Zk.scaleToRef(U,W.g.Ck[0]),this._uniformBuffer.updateColor4("vLightDiffuse",W.g.Ck[0],this.range,H),a&&(this.Ak.scaleToRef(U,W.g.Ck[1]),this._uniformBuffer.updateColor4("vLightSpecular",W.g.Ck[1],this.radius,H)),y=!0}if(this.transferTexturesToEffect(b,H),M.shadowsEnabled&&this.shadowEnabled&&A){const U=this.getShadowGenerator(M.activeCamera)??this.getShadowGenerator();U&&(U.bindShadowLight(H,b),y=!0)}y?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(U){let M="Name: "+this.name;if(M+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let b=0;b<this.animations.length;b++)M+=", animation[0]: "+this.animations[b].toString(U);return M}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Kc(U){super.Kc(U),this._resyncMeshes()}getShadowGenerator(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(U)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return H.l.Zero()}canAffectMesh(U){return!U||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(U))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(U))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&U.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&U.layerMask)))}dispose(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const U=this._shadowGenerators.values();for(let M=U.next();!0!==M.done;M=U.next()){M.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const U=this._parentContainer.lights.indexOf(this);U>-1&&this._parentContainer.lights.splice(U,1),this._parentContainer=null}for(const b of this.va().meshes)b._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(U,M)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Rl}clone(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=Z.GetConstructorFromName(this.getTypeID(),U,this.va());if(!b)return null;const a=P.d.Clone(b,this);return U&&(a.name=U),M&&(a.parent=M),a.Kc(this.isEnabled()),this.onClonedObservable.notifyObservers(a),a}serialize(){const U=P.d.Serialize(this);if(U.uniqueId=this.uniqueId,U.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(U),this.excludedMeshes.length>0){U.excludedMeshesIds=[];for(const M of this.excludedMeshes)U.excludedMeshesIds.push(M.id)}if(this.includedOnlyMeshes.length>0){U.includedOnlyMeshesIds=[];for(const M of this.includedOnlyMeshes)U.includedOnlyMeshesIds.push(M.id)}return P.d.AppendSerializedAnimations(this,U),U.ranges=this.serializeAnimationRanges(),U.isEnabled=this.isEnabled(),U}static GetConstructorFromName(U,M,b){const a=y.e.Construct("Light_Type_"+U,M,b);return a||null}static Parse(U,M){const b=Z.GetConstructorFromName(U.type,U.name,M);if(!b)return null;const a=P.d.Parse(b,U,M);if(U.excludedMeshesIds&&(a._excludedMeshesIds=U.excludedMeshesIds),U.includedOnlyMeshesIds&&(a._includedOnlyMeshesIds=U.includedOnlyMeshesIds),void 0!==U.parentId&&(a._waitingParentId=U.parentId),void 0!==U.parentInstanceIndex&&(a._waitingParentInstanceIndex=U.parentInstanceIndex),void 0!==U.falloffType&&(a.falloffType=U.falloffType),void 0!==U.lightmapMode&&(a.lightmapMode=U.lightmapMode),U.animations){for(let M=0;M<U.animations.length;M++){const b=U.animations[M],A=(0,e.e)("BABYLON.Animation");A&&a.animations.push(A.Parse(b))}y.e.ParseAnimationRanges(a,U,M)}return U.autoAnimate&&M.beginAnimation(a,U.autoAnimateFrom,U.autoAnimateTo,U.autoAnimateLoop,U.autoAnimateSpeed||1),void 0!==U.isEnabled&&a.Kc(U.isEnabled),a}_hookArrayForExcluded(U){var M=this;const b=U.push;U.push=function(){for(var a=arguments.length,A=new Array(a),H=0;H<a;H++)A[H]=arguments[H];const W=b.apply(U,A);for(const U of A)U._resyncLightSource(M);return W};const a=U.splice;U.splice=(M,b)=>{const A=a.apply(U,[M,b]);for(const U of A)U._resyncLightSource(this);return A};for(const A of U)A._resyncLightSource(this)}_hookArrayForIncludedOnly(U){var M=this;const b=U.push;U.push=function(){for(var a=arguments.length,A=new Array(a),H=0;H<a;H++)A[H]=arguments[H];const W=b.apply(U,A);return M._resyncMeshes(),W};const a=U.splice;U.splice=(M,b)=>{const A=a.apply(U,[M,b]);return this._resyncMeshes(),A},this._resyncMeshes()}_resyncMeshes(){for(const U of this.va().meshes)U._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const U of this.va().meshes)-1!==U.lightSources.indexOf(this)&&U._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let U=0;const M=this.getTypeID();let b=this.intensityMode;switch(b===Z.INTENSITYMODE_AUTOMATIC&&(b=M===Z.LIGHTTYPEID_DIRECTIONALLIGHT?Z.INTENSITYMODE_ILLUMINANCE:Z.INTENSITYMODE_LUMINOUSINTENSITY),M){case Z.LIGHTTYPEID_POINTLIGHT:case Z.LIGHTTYPEID_SPOTLIGHT:switch(b){case Z.INTENSITYMODE_LUMINOUSPOWER:U=1/(4*Math.PI);break;case Z.INTENSITYMODE_LUMINOUSINTENSITY:U=1;break;case Z.INTENSITYMODE_LUMINANCE:U=this.radius*this.radius}break;case Z.LIGHTTYPEID_DIRECTIONALLIGHT:switch(b){case Z.INTENSITYMODE_ILLUMINANCE:U=1;break;case Z.INTENSITYMODE_LUMINANCE:{let M=this.radius;M=Math.max(M,.001);U=2*Math.PI*(1-Math.cos(M));break}}break;case Z.LIGHTTYPEID_HEMISPHERICLIGHT:U=1}return U}_reorderLightsInScene(){const U=this.va();0!=this._renderPriority&&(U.requireLightSorting=!0),this.va().sortLightsByPriority()}_isReady(){return!0}}Z.FALLOFF_DEFAULT=x.b.FALLOFF_DEFAULT,Z.FALLOFF_PHYSICAL=x.b.FALLOFF_PHYSICAL,Z.FALLOFF_GLTF=x.b.FALLOFF_GLTF,Z.FALLOFF_STANDARD=x.b.FALLOFF_STANDARD,Z.LIGHTMAP_DEFAULT=x.b.LIGHTMAP_DEFAULT,Z.LIGHTMAP_SPECULAR=x.b.LIGHTMAP_SPECULAR,Z.LIGHTMAP_SHADOWSONLY=x.b.LIGHTMAP_SHADOWSONLY,Z.INTENSITYMODE_AUTOMATIC=x.b.INTENSITYMODE_AUTOMATIC,Z.INTENSITYMODE_LUMINOUSPOWER=x.b.INTENSITYMODE_LUMINOUSPOWER,Z.INTENSITYMODE_LUMINOUSINTENSITY=x.b.INTENSITYMODE_LUMINOUSINTENSITY,Z.INTENSITYMODE_ILLUMINANCE=x.b.INTENSITYMODE_ILLUMINANCE,Z.INTENSITYMODE_LUMINANCE=x.b.INTENSITYMODE_LUMINANCE,Z.LIGHTTYPEID_POINTLIGHT=x.b.LIGHTTYPEID_POINTLIGHT,Z.LIGHTTYPEID_DIRECTIONALLIGHT=x.b.LIGHTTYPEID_DIRECTIONALLIGHT,Z.LIGHTTYPEID_SPOTLIGHT=x.b.LIGHTTYPEID_SPOTLIGHT,Z.LIGHTTYPEID_HEMISPHERICLIGHT=x.b.LIGHTTYPEID_HEMISPHERICLIGHT,Z.LIGHTTYPEID_RECT_AREALIGHT=x.b.LIGHTTYPEID_RECT_AREALIGHT,(0,a.c)([(0,A.j)()],Z.prototype,"diffuse",void 0),(0,a.c)([(0,A.j)()],Z.prototype,"specular",void 0),(0,a.c)([(0,A.J)()],Z.prototype,"falloffType",void 0),(0,a.c)([(0,A.J)()],Z.prototype,"intensity",void 0),(0,a.c)([(0,A.J)()],Z.prototype,"range",null),(0,a.c)([(0,A.J)()],Z.prototype,"intensityMode",null),(0,a.c)([(0,A.J)()],Z.prototype,"radius",null),(0,a.c)([(0,A.J)()],Z.prototype,"_renderPriority",void 0),(0,a.c)([(0,A.c)("_reorderLightsInScene")],Z.prototype,"renderPriority",void 0),(0,a.c)([(0,A.J)("shadowEnabled")],Z.prototype,"_shadowEnabled",void 0),(0,a.c)([(0,A.J)("excludeWithLayerMask")],Z.prototype,"_excludeWithLayerMask",void 0),(0,a.c)([(0,A.J)("includeOnlyWithLayerMask")],Z.prototype,"_includeOnlyWithLayerMask",void 0),(0,a.c)([(0,A.J)("lightmapMode")],Z.prototype,"_lightmapMode",void 0)},12713:(U,M,b)=>{"use strict";b.d(M,{b:()=>O});var a=b(645),A=b(652),H=b(670),W=b(12671),y=b(808);class O extends W.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=H.b.Identity(),this._projectionMatrix=H.b.Identity()}_setPosition(U){this._position=U}get position(){return this._position}set position(U){this._setPosition(U)}_setDirection(U){this._direction=U}get direction(){return this._direction}set direction(U){this._setDirection(U)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(U){this._shadowMinZ=U,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(U){this._shadowMaxZ=U,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=H.l.Zero()),H.l.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=H.l.Zero()),H.l.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(U){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(U){return this.direction=H.l.Normalize(U.je(this.position)),this.direction}getRotation(){this.direction.normalize();const U=H.l.Cross(this.direction,y.b.Y),M=H.l.Cross(U,this.direction);return H.l.RotationFromAxis(U,M,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=H.l.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ik(U){return!U&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=H.b.Identity()),H.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(U){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===U||void 0===U?void 0:U.ek)||0}getDepthMaxZ(U){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===U||void 0===U?void 0:U.maxZ)||1e4}setShadowProjectionMatrix(U,M,b){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(M,b,U):this._setDefaultShadowProjectionMatrix(U,M,b),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(U){const M=H.g.lk[0];let b=this.position;this.computeTransformedInformation()&&(b=this.transformedPosition),H.l.NormalizeToRef(this.getShadowDirection(U),M),1===Math.abs(H.l.Dot(M,H.l.Up()))&&(M.z=1e-13);const a=H.g.lk[1];return b.addToRef(M,a),H.b.LookAtLHToRef(b,a,H.l.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(U,M){return this.setShadowProjectionMatrix(this._projectionMatrix,U??this._viewMatrix,M??[]),this._projectionMatrix}}(0,a.c)([(0,A.H)()],O.prototype,"position",null),(0,a.c)([(0,A.H)()],O.prototype,"direction",null),(0,a.c)([(0,A.J)()],O.prototype,"shadowMinZ",null),(0,a.c)([(0,A.J)()],O.prototype,"shadowMaxZ",null)},12705:(U,M,b)=>{"use strict";b.d(M,{c:()=>P});var a=b(645),A=b(652),H=b(670),W=b(689),y=b(12671),O=b(12713),e=b(2371),x=b(609);W.e.AddNodeConstructor("Light_Type_2",((U,M)=>()=>new P(U,H.l.Zero(),H.l.Zero(),0,0,M)));class P extends O.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(U){this._iesProfileTexture!==U&&(this._iesProfileTexture=U,this._iesProfileTexture&&P._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(U){this._angle=U,this._cosHalfAngle=Math.cos(.5*U),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(U){this._innerAngle=U,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(U){this._shadowAngleScale=U,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(U){this._projectionTextureLightNear=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(U){this._projectionTextureLightFar=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(U){this._projectionTextureUpDirection=U,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(U){this._projectionTexture!==U&&(this._projectionTexture=U,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(P._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):P._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(U){return void 0!==U.onGeneratedObservable}static _IsTexture(U){return void 0!==U.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(U){this._projectionTextureProjectionLightMatrix=U,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(U,M,b,a,A,W){super(U,W),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=H.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=H.l.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=H.l.Zero(),this._projectionTextureViewLightMatrix=H.b.Zero(),this._projectionTextureProjectionLightMatrix=H.b.Zero(),this._projectionTextureScalingMatrix=H.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=M,this.direction=b,this.angle=a,this.exponent=A}getClassName(){return"SpotLight"}getTypeID(){return y.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(U){super._setDirection(U),this._projectionTextureViewLightDirty=!0}_setPosition(U){super._setPosition(U),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(U,M,b){const a=this.va().activeCamera;if(!a)return;this._shadowAngleScale=this._shadowAngleScale||1;const A=this._shadowAngleScale*this._angle,W=void 0!==this.shadowMinZ?this.shadowMinZ:a.ek,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,O=this.va().getEngine().useReverseDepthBuffer;H.b.PerspectiveFovLHToRef(A,1,O?y:W,O?W:y,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,O)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),H.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const U=this.projectionTextureLightFar,M=this.projectionTextureLightNear,b=U/(U-M),a=-b*M,A=1/Math.tan(this._angle/2);H.b.FromValuesToRef(A/1,0,0,0,0,A,0,0,0,0,b,1,0,0,a,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof e.e){const U=this._projectionTexture.uScale/2,M=this._projectionTexture.vScale/2;H.b.FromValuesToRef(U,0,0,0,0,M,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(U,M){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),U.setMatrix("textureProjectionMatrix"+M,this._projectionTextureMatrix),U.setTexture("projectionLightTexture"+M,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&U.setTexture("iesLightTexture"+M,this._iesProfileTexture),this}transferToEffect(U,M){let b;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,M),b=H.l.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,M),b=H.l.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",b.x,b.y,b.z,this._cosHalfAngle,M),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,M),this}transferToNodeMaterialEffect(U,M){let b;return b=this.computeTransformedInformation()?H.l.Normalize(this.transformedDirection):H.l.Normalize(this.direction),this.va().useRightHandedSystem?U.setFloat3(M,-b.x,-b.y,-b.z):U.setFloat3(M,b.x,b.y,b.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(U){const M=this._scene.getEngine(),b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===U||void 0===U?void 0:U.ek)??0;return M.useReverseDepthBuffer&&M.isNDCHalfZRange?b:this._scene.getEngine().isNDCHalfZRange?0:b}getDepthMaxZ(U){const M=this._scene.getEngine(),b=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===U||void 0===U?void 0:U.maxZ)??1e4;return M.useReverseDepthBuffer&&M.isNDCHalfZRange?0:b}prepareLightSpecificDefines(U,M){U["SPOTLIGHT"+M]=!0,U["PROJECTEDLIGHTTEXTURE"+M]=!(!this.projectionTexture||!this.projectionTexture.isReady()),U["IESLIGHTTEXTURE"+M]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,a.c)([(0,A.J)()],P.prototype,"angle",null),(0,a.c)([(0,A.J)()],P.prototype,"innerAngle",null),(0,a.c)([(0,A.J)()],P.prototype,"shadowAngleScale",null),(0,a.c)([(0,A.J)()],P.prototype,"exponent",void 0),(0,a.c)([(0,A.J)()],P.prototype,"projectionTextureLightNear",null),(0,a.c)([(0,A.J)()],P.prototype,"projectionTextureLightFar",null),(0,a.c)([(0,A.J)()],P.prototype,"projectionTextureUpDirection",null),(0,a.c)([(0,A.A)("projectedLightTexture")],P.prototype,"_projectionTexture",void 0),(0,x.i)("BABYLON.SpotLight",P)},12406:(U,M,b)=>{"use strict";b.d(M,{c:()=>W,g:()=>H,i:()=>y});const a={},A={};function H(U,M){a[U]=M}function W(U,M){A[U]=M}function y(U){return A[U]?A[U]:null}},12297:(U,M,b)=>{"use strict";b.d(M,{e:()=>h,f:()=>I});var a,A=b(479),H=b(474),W=b(2492),y=b(524),O=b(497),e=b(782),x=b(531),P=b(539),Z=b(614),C=b(562),r=b(518);!function(U){U[U.Clean=0]="Clean",U[U.Stop=1]="Stop",U[U.Sync=2]="Sync",U[U.NoSync=3]="NoSync"}(a||(a={}));const B=new H.e,J={};let F=!1;function f(){return J[".babylon"]}function L(U,M){const b=J[U];return b||(O.b.Warn("Unable to find a plugin to load "+U+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),M?f():void 0)}function z(U,M,b){let a="Unable to load from "+(U.rawData?"binary data":U.url);return M?a+=`: ${M}`:b&&(a+=`: ${b}`),a}async function o(U,M,b,a,A,H,W,y,O){var e;const P="data:"===(Z=U.url).substring(0,5)?Z.substring(5):null;var Z;if(U.rawData&&!W)throw"When using ArrayBufferView to load data the file extension must be provided.";const F=P||W?"":function(U){const M=U.indexOf("?");-1!==M&&(U=U.substring(0,M));const b=U.lastIndexOf(".");return U.substring(b,U.length).toLowerCase()}(U.url);let z=W?L(W,!0):P?function(U){for(const M in J){const b=J[M].plugin;if(b.canDirectLoad&&b.canDirectLoad(U))return J[M]}return f()}(U.url):L(F,!1);if(!z&&F){if(U.url&&!U.url.startsWith("blob:")){const M=await async function(U,M){const b=M.method||"GET";return await new Promise(((a,A)=>{const H=new r.c;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const U={};if(M.responseHeaders)for(const b of M.responseHeaders)U[b]=H.getResponseHeader(b)||"";a({response:H.response,headerValues:U})}else A(`Unable to fetch data from ${U}. Error code: ${H.status}`)})),H.open(b,U),H.send()}))}(U.url,{method:"HEAD",responseHeaders:["Content-Type"]}),b=M.headerValues?M.headerValues["Content-Type"]:"";b&&(z=function(U){for(const M in J){const b=J[M];if(b.mimeType===U)return b}}(b))}z||(z=f())}if(!z)throw new Error(`No plugin or fallback for ${W??U.url}`);if(!1===(null===O||void 0===O||null===(e=O[z.plugin.name])||void 0===e?void 0:e.enabled))throw new Error(`The '${z.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(U.rawData&&!z.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(U=>{if(z.plugin.createPlugin){const M=z.plugin.createPlugin(O??{});return M instanceof Promise?(M.then(U).catch((U=>{A("Error instantiating plugin.",U)})),null):(U(M),M)}return U(z.plugin),z.plugin})((O=>{var e;if(!O)throw`The loader plugin corresponding to the '${W}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(B.notifyObservers(O),P&&(O.canDirectLoad&&O.canDirectLoad(U.url)||!(0,x.l)(U.url))){if(O.directLoad){const U=O.directLoad(M,P);U instanceof Promise?U.then((U=>{b(O,U)})).catch((U=>{A("Error in directLoad of _loadData: "+U,U)})):b(O,U)}else b(O,P);return}const Z=z.isBinary,r=(U,a)=>{M.u?A("Scene has been disposed"):b(O,U,a)};let J=null,F=!1;null===(e=O.rk)||void 0===e||e.add((()=>{F=!0,J&&(J.abort(),J=null),H()}));const f=()=>{if(F)return;const b=(U,M)=>{A(null===U||void 0===U?void 0:U.statusText,M)};if(!O.loadFile&&U.rawData)throw"Plugin does not support loading ArrayBufferView.";J=O.loadFile?O.loadFile(M,U.rawData||U.file||U.url,U.rootUrl,r,a,Z,b,y):M._loadFile(U.file||U.url,r,a,!0,Z,b)},L=M.getEngine();let o=L.enableOfflineSupport;if(o){let b=!1;for(const a of M.disableOfflineSupportExceptionRules)if(a.test(U.url)){b=!0;break}o=!b}o&&C.e.OfflineProviderFactory?M.offlineProvider=C.e.OfflineProviderFactory(U.url,f,L.disableManifestCheck):f()}))}function S(U,M){let b,a,H=null,W=null;if(M)if(M.name)b=`file:${M.name}`,a=M.name,H=M;else if(ArrayBuffer.isView(M))b="",a=(0,Z.d)(),W=M;else if(M.startsWith("data:"))b=M,a="";else if(U){const H=M;if("/"===H.substring(0,1))return A.d.Error("Wrong sceneFilename parameter"),null;b=U+H,a=H}else b=M,a=A.d.GetFilename(M),U=A.d.GetFolderPath(M);else b=U,a=A.d.GetFilename(U),U=A.d.GetFolderPath(U);return{url:b,rootUrl:U,name:a,file:H,rawData:W}}function h(U){if("string"===typeof U.extensions){const M=U.extensions;J[M.toLowerCase()]={plugin:U,isBinary:!1}}else{const M=U.extensions,b=Object.keys(M);for(const a of b)J[a.toLowerCase()]={plugin:U,isBinary:M[a].isBinary,mimeType:M[a].mimeType}}}async function i(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.d.LastCreatedScene,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!a)return O.b.Error("No scene available to import mesh to"),null;const C=S(M,b);if(!C)return null;const r={};a.addPendingData(r);const B=()=>{a.removePendingData(r)},J=(U,M)=>{const b=z(C,U,M);W?W(a,b,new P.i(b,P.h.SceneLoaderError,M)):O.b.Error(b),B()},F=H?U=>{try{H(U)}catch(M){J("Error in onProgress callback: "+M,M)}}:void 0,f=(U,M,b,H,W,y,O,e)=>{if(a.importedMeshesFiles.push(C.url),A)try{A(U,M,b,H,W,y,O,e)}catch(x){J("Error in onSuccess callback: "+x,x)}a.removePendingData(r)};return await o(C,a,((M,b,A)=>{if(M.rewriteRootURL&&(C.rootUrl=M.rewriteRootURL(C.rootUrl,A)),M.importMesh){const A=[],H=[],W=[];if(!M.importMesh(U,a,b,C.rootUrl,A,H,W,J))return;a.loadingPluginName=M.name,f(A,H,W,[],[],[],[],[])}else{M.importMeshAsync(U,a,b,C.rootUrl,F,C.name).then((U=>{a.loadingPluginName=M.name,f(U.meshes,U.Ik,U.skeletons,U.animationGroups,U.transformNodes,U.geometries,U.lights,U.spriteManagers)})).catch((U=>{J(U.message,U)}))}}),F,J,B,e,x,Z)}async function Y(U,M,b,a,A,H,W,y){return await new Promise(((O,e)=>{try{i(U,M,b,a,((U,M,b,a,A,H,W,y)=>{O({meshes:U,Ik:M,skeletons:b,animationGroups:a,transformNodes:A,geometries:H,lights:W,spriteManagers:y})}),A,((U,M,b)=>{e(b||new Error(M))}),H,W,y).catch(e)}catch(P){e(P)}}))}async function d(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.d.LastCreatedEngine,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};b?await q(U,M,new W.b(b),a,H,O,e,x,P):A.d.Error("No engine available")}async function s(U,M,b,a,A,H,W){return await new Promise(((y,O)=>{d(U,M,b,(U=>{y(U)}),a,((U,M,b)=>{O(b||new Error(M))}),A,H,W)}))}async function q(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.d.LastCreatedScene,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return O.b.Error("No scene available to append to"),null;const C=S(U,M);if(!C)return null;const r={};b.addPendingData(r);const B=()=>{b.removePendingData(r)};e.e.ShowLoadingScreen&&!F&&(F=!0,b.getEngine().displayLoadingUI(),b.executeWhenReady((()=>{b.getEngine().hideLoadingUI(),F=!1})));const J=(U,M)=>{const a=z(C,U,M);H?H(b,a,new P.i(a,P.h.SceneLoaderError,M)):O.b.Error(a),B()},f=A?U=>{try{A(U)}catch(M){J("Error in onProgress callback",M)}}:void 0,L=()=>{if(a)try{a(b)}catch(U){J("Error in onSuccess callback",U)}b.removePendingData(r)};return await o(C,b,((U,M)=>{if(U.load){if(!U.load(b,M,C.rootUrl,J))return;b.loadingPluginName=U.name,L()}else{U.loadAsync(b,M,C.rootUrl,f,C.name).then((()=>{b.loadingPluginName=U.name,L()})).catch((U=>{J(U.message,U)}))}}),f,J,B,W,x,Z)}async function m(U,M,b,a,A,H,W){return await new Promise(((y,O)=>{try{q(U,M,b,(U=>{y(U)}),a,((U,M,b)=>{O(b||new Error(M))}),A,H,W).catch(O)}catch(P){O(P)}}))}async function n(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.d.LastCreatedScene,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return O.b.Error("No scene available to load asset container to"),null;const Z=S(U,M);if(!Z)return null;const C={};b.addPendingData(C);const r=()=>{b.removePendingData(C)},B=(U,M)=>{const a=z(Z,U,M);H?H(b,a,new P.i(a,P.h.SceneLoaderError,M)):O.b.Error(a),r()},J=A?U=>{try{A(U)}catch(M){B("Error in onProgress callback",M)}}:void 0,F=U=>{if(a)try{a(U)}catch(M){B("Error in onSuccess callback",M)}b.removePendingData(C)};return await o(Z,b,((U,M)=>{if(U.loadAssetContainer){const a=U.loadAssetContainer(b,M,Z.rootUrl,B);if(!a)return;a.populateRootNodes(),b.loadingPluginName=U.name,F(a)}else if(U.loadAssetContainerAsync){U.loadAssetContainerAsync(b,M,Z.rootUrl,J,Z.name).then((M=>{M.populateRootNodes(),b.loadingPluginName=U.name,F(M)})).catch((U=>{B(U.message,U)}))}else B("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),J,B,r,W,e,x)}async function E(U,M,b,a,A,H,W){return await new Promise(((y,O)=>{try{n(U,M,b,(U=>{y(U)}),a,((U,M,b)=>{O(b||new Error(M))}),A,H,W).catch(O)}catch(P){O(P)}}))}async function X(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.d.LastCreatedScene,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!b)return void O.b.Error("No scene available to load animations to");if(a){for(const a of b.animatables)a.reset();b.stopAllAnimations();const U=b.animationGroups.slice();for(const b of U)b.dispose();const M=b.getNodes();for(const b of M)b.animations&&(b.animations=[])}else switch(A){case 0:const U=b.animationGroups.slice();for(const M of U)M.dispose();break;case 1:for(const M of b.animationGroups)M.stop();break;case 2:for(const M of b.animationGroups)M.reset(),M.restart();break;case 3:break;default:return void O.b.Error("Unknown animation group loading mode value '"+A+"'")}const r=b.animatables.length;await n(U,M,b,(U=>{U.mergeAnimationsTo(b,b.animatables.slice(r),H),U.dispose(),b.onAnimationFileImportedObservable.notifyObservers(b),W&&W(b)}),e,x,P,Z,C)}async function Q(U,M,b,a,A,H,W,y,O,e){return await new Promise(((x,Z)=>{try{X(U,M,b,a,A,H,(U=>{x(U)}),W,((U,M,b)=>{Z(b||new Error(M))}),y,O,e).catch(Z)}catch(P){Z(P)}}))}class I{static get ForceFullSceneLoadingForIncremental(){return e.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(U){e.e.ForceFullSceneLoadingForIncremental=U}static get ShowLoadingScreen(){return e.e.ShowLoadingScreen}static set ShowLoadingScreen(U){e.e.ShowLoadingScreen=U}static get loggingLevel(){return e.e.loggingLevel}static set loggingLevel(U){e.e.loggingLevel=U}static get CleanBoneMatrixWeights(){return e.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(U){e.e.CleanBoneMatrixWeights=U}static GetDefaultPlugin(){return f()}static GetPluginForExtension(U){var M;return null===(M=L(U,!0))||void 0===M?void 0:M.plugin}static IsPluginForExtensionAvailable(U){return function(U){return!!J[U]}(U)}static RegisterPlugin(U){h(U)}static ImportMesh(U,M,b,a,A,H,W,O,e){i(U,M,b,a,A,H,W,O,e).catch((U=>null===W||void 0===W?void 0:W(y.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportMeshAsync(U,M,b,a,A,H,W){return await Y(U,M,b,a,A,H,W)}static Load(U,M,b,a,A,H,W,O){d(U,M,b,a,A,H,W,O).catch((U=>null===H||void 0===H?void 0:H(y.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAsync(U,M,b,a,A,H){return await s(U,M,b,a,A,H)}static Append(U,M,b,a,A,H,W,O){q(U,M,b,a,A,H,W,O).catch((U=>null===H||void 0===H?void 0:H(b??y.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async AppendAsync(U,M,b,a,A,H){return await m(U,M,b,a,A,H)}static LoadAssetContainer(U,M,b,a,A,H,W,O){n(U,M,b,a,A,H,W,O).catch((U=>null===H||void 0===H?void 0:H(b??y.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAssetContainerAsync(U,M,b,a,A,H){return await E(U,M,b,a,A,H)}static ImportAnimations(U,M,b,a,A,H,W,O,e,x,P){X(U,M,b,a,A,H,W,O,e,x,P).catch((U=>null===e||void 0===e?void 0:e(b??y.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportAnimationsAsync(U,M,b,a,A,H,W,y,O,e,x){return await Q(U,M,b,a,A,H,y,e,x)}}I.NO_LOGGING=0,I.MINIMAL_LOGGING=1,I.SUMMARY_LOGGING=2,I.DETAILED_LOGGING=3,I.OnPluginActivatedObservable=B},12651:(U,M,b)=>{"use strict";b.d(M,{e:()=>N});var a=b(645),A=b(652),H=b(497),W=b(661),y=b(12649),O=b(2492),e=b(670),x=b(729),P=b(12213),Z=b(12243);class C extends P.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class r extends Z.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(U,"PBRBRDF",90,new C,M),this._useEnergyConservation=r.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=r.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=r.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=r.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=r.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=r.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=r.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=r.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=r.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=r.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=r.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=r.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=r.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=r.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=r.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=r.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=r.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=r.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=U._dirtyCallbacks[16],this._enable(!0)}prepareDefines(U){U.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,U.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,U.SPHERICAL_HARMONICS=this._useSphericalHarmonics,U.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,U.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,U.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,U.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,U.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,U.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}r.DEFAULT_USE_ENERGY_CONSERVATION=!0,r.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,r.DEFAULT_USE_SPHERICAL_HARMONICS=!0,r.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,r.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,r.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,r.DEFAULT_DIFFUSE_MODEL=0,r.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,r.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"useEnergyConservation",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"useSphericalHarmonics",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"mixIblRadianceWithIrradiance",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"useLegacySpecularEnergyConservation",void 0),(0,a.c)([(0,A.J)("baseDiffuseModel"),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"baseDiffuseModel",void 0),(0,a.c)([(0,A.J)("dielectricSpecularModel"),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"dielectricSpecularModel",void 0),(0,a.c)([(0,A.J)("conductorSpecularModel"),(0,A.c)("_markAllSubMeshesAsMiscDirty")],r.prototype,"conductorSpecularModel",void 0);var B=b(12207),J=b(707),F=b(2499),f=b(811),L=b(12220),z=b(2371),o=b(12227),S=(b(2552),b(12233)),h=b(816);class i extends P.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class Y extends Z.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(U,"PBRClearCoat",100,new i,M),this._isEnabled=!1,this.isEnabled=!1,this.Rl=1,this.roughness=0,this._indexOfRefraction=Y._DefaultIndexOfRefraction,this.indexOfRefraction=Y._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=J.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=U._dirtyCallbacks[1]}isReadyForSubMesh(U,M,b){if(!this._isEnabled)return!0;const a=this._material._disableBumpMap;if(U._areTexturesDirty&&M.texturesEnabled){if(this._texture&&o.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&o.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(b.getCaps().standardDerivatives&&this._bumpTexture&&o.c.ClearCoatBumpTextureEnabled&&!a&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&o.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(U,M){this._isEnabled?(U.CLEARCOAT=!0,U.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,U.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,U._areTexturesDirty&&M.texturesEnabled&&(this._texture&&o.c.ClearCoatTextureEnabled?(0,h.db)(this._texture,U,"CLEARCOAT_TEXTURE"):U.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&o.c.ClearCoatTextureEnabled?(0,h.db)(this._textureRoughness,U,"CLEARCOAT_TEXTURE_ROUGHNESS"):U.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&o.c.ClearCoatBumpTextureEnabled?(0,h.db)(this._bumpTexture,U,"CLEARCOAT_BUMP"):U.CLEARCOAT_BUMP=!1,U.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===Y._DefaultIndexOfRefraction,this._isTintEnabled?(U.CLEARCOAT_TINT=!0,this._tintTexture&&o.c.ClearCoatTintTextureEnabled?((0,h.db)(this._tintTexture,U,"CLEARCOAT_TINT_TEXTURE"),U.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):U.CLEARCOAT_TINT_TEXTURE=!1):(U.CLEARCOAT_TINT=!1,U.CLEARCOAT_TINT_TEXTURE=!1))):(U.CLEARCOAT=!1,U.CLEARCOAT_TEXTURE=!1,U.CLEARCOAT_TEXTURE_ROUGHNESS=!1,U.CLEARCOAT_BUMP=!1,U.CLEARCOAT_TINT=!1,U.CLEARCOAT_TINT_TEXTURE=!1,U.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,U.CLEARCOAT_DEFAULTIOR=!1,U.CLEARCOAT_TEXTUREDIRECTUV=0,U.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,U.CLEARCOAT_BUMPDIRECTUV=0,U.CLEARCOAT_REMAP_F0=!1,U.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,U.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(U,M,b,a){if(!this._isEnabled)return;const A=a.materialDefines,H=this._material.isFrozen,W=this._material._disableBumpMap,y=this._material._invertNormalMapX,O=this._material._invertNormalMapY;if(!U.useUbo||!H||!U.isSync){var e,x,P,Z;if((this._texture||this._textureRoughness)&&o.c.ClearCoatTextureEnabled)U.updateFloat4("vClearCoatInfos",(null===(e=this._texture)||void 0===e?void 0:e.coordinatesIndex)??0,(null===(x=this._texture)||void 0===x?void 0:x.level)??0,(null===(P=this._textureRoughness)||void 0===P?void 0:P.coordinatesIndex)??0,(null===(Z=this._textureRoughness)||void 0===Z?void 0:Z.level)??0),this._texture&&(0,h.A)(this._texture,U,"clearCoat"),this._textureRoughness&&!A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,h.A)(this._textureRoughness,U,"clearCoatRoughness");this._bumpTexture&&b.getCaps().standardDerivatives&&o.c.ClearCoatTextureEnabled&&!W&&(U.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,h.A)(this._bumpTexture,U,"clearCoatBump"),M._mirroredCameraPosition?U.updateFloat2("vClearCoatTangentSpaceParams",y?1:-1,O?1:-1):U.updateFloat2("vClearCoatTangentSpaceParams",y?-1:1,O?-1:1)),this._tintTexture&&o.c.ClearCoatTintTextureEnabled&&(U.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,h.A)(this._tintTexture,U,"clearCoatTint")),U.updateFloat2("vClearCoatParams",this.Rl,this.roughness);const a=1-this._indexOfRefraction,H=1+this._indexOfRefraction,C=Math.pow(-a/H,2),r=1/this._indexOfRefraction;U.updateFloat4("vClearCoatRefractionParams",C,r,a,H),this._isTintEnabled&&(U.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),U.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}M.texturesEnabled&&(this._texture&&o.c.ClearCoatTextureEnabled&&U.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&o.c.ClearCoatTextureEnabled&&U.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&b.getCaps().standardDerivatives&&o.c.ClearCoatBumpTextureEnabled&&!W&&U.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&o.c.ClearCoatTintTextureEnabled&&U.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(U){return this._texture===U||(this._textureRoughness===U||(this._bumpTexture===U||this._tintTexture===U))}getActiveTextures(U){this._texture&&U.push(this._texture),this._textureRoughness&&U.push(this._textureRoughness),this._bumpTexture&&U.push(this._bumpTexture),this._tintTexture&&U.push(this._tintTexture)}getAnimatables(U){this._texture&&this._texture.animations&&this._texture.animations.length>0&&U.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&U.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&U.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&U.push(this._tintTexture)}dispose(U){var M,b,a,A;U&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(b=this._textureRoughness)||void 0===b||b.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(A=this._tintTexture)||void 0===A||A.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(U,M,b){return U.CLEARCOAT_BUMP&&M.addFallback(b++,"CLEARCOAT_BUMP"),U.CLEARCOAT_TINT&&M.addFallback(b++,"CLEARCOAT_TINT"),U.CLEARCOAT&&M.addFallback(b++,"CLEARCOAT"),b}getSamplers(U){U.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}Y._DefaultIndexOfRefraction=1.5,(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"isEnabled",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"intensity",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"roughness",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"indexOfRefraction",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"texture",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRoughnessFromMainTexture",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"textureRoughness",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"remapF0OnInterfaceChange",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"bumpTexture",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"isTintEnabled",void 0),(0,a.c)([(0,A.j)()],Y.prototype,"tintColor",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"tintColorAtDistance",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"tintThickness",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"tintTexture",void 0);class d extends P.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class s extends Z.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(U,"PBRIridescence",110,new d,M),this._isEnabled=!1,this.isEnabled=!1,this.Rl=1,this.minimumThickness=s._DefaultMinimumThickness,this.maximumThickness=s._DefaultMaximumThickness,this.indexOfRefraction=s._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=U._dirtyCallbacks[1]}isReadyForSubMesh(U,M){if(!this._isEnabled)return!0;if(U._areTexturesDirty&&M.texturesEnabled){if(this._texture&&o.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&o.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(U,M){this._isEnabled?(U.IRIDESCENCE=!0,U._areTexturesDirty&&M.texturesEnabled&&(this._texture&&o.c.IridescenceTextureEnabled?(0,h.db)(this._texture,U,"IRIDESCENCE_TEXTURE"):U.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&o.c.IridescenceTextureEnabled?(0,h.db)(this._thicknessTexture,U,"IRIDESCENCE_THICKNESS_TEXTURE"):U.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(U.IRIDESCENCE=!1,U.IRIDESCENCE_TEXTURE=!1,U.IRIDESCENCE_THICKNESS_TEXTURE=!1,U.IRIDESCENCE_TEXTUREDIRECTUV=0,U.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(U,M){if(!this._isEnabled)return;const b=this._material.isFrozen;if(!U.useUbo||!b||!U.isSync){var a,A,H,W;if((this._texture||this._thicknessTexture)&&o.c.IridescenceTextureEnabled)U.updateFloat4("vIridescenceInfos",(null===(a=this._texture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(H=this._thicknessTexture)||void 0===H?void 0:H.coordinatesIndex)??0,(null===(W=this._thicknessTexture)||void 0===W?void 0:W.level)??0),this._texture&&(0,h.A)(this._texture,U,"iridescence"),this._thicknessTexture&&(0,h.A)(this._thicknessTexture,U,"iridescenceThickness");U.updateFloat4("vIridescenceParams",this.Rl,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}M.texturesEnabled&&(this._texture&&o.c.IridescenceTextureEnabled&&U.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&o.c.IridescenceTextureEnabled&&U.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(U){return this._texture===U||this._thicknessTexture===U}getActiveTextures(U){this._texture&&U.push(this._texture),this._thicknessTexture&&U.push(this._thicknessTexture)}getAnimatables(U){this._texture&&this._texture.animations&&this._texture.animations.length>0&&U.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&U.push(this._thicknessTexture)}dispose(U){var M,b;U&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(b=this._thicknessTexture)||void 0===b||b.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(U,M,b){return U.IRIDESCENCE&&M.addFallback(b++,"IRIDESCENCE"),b}getSamplers(U){U.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}s._DefaultMinimumThickness=100,s._DefaultMaximumThickness=400,s._DefaultIndexOfRefraction=1.3,(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isEnabled",void 0),(0,a.c)([(0,A.J)()],s.prototype,"intensity",void 0),(0,a.c)([(0,A.J)()],s.prototype,"minimumThickness",void 0),(0,a.c)([(0,A.J)()],s.prototype,"maximumThickness",void 0),(0,a.c)([(0,A.J)()],s.prototype,"indexOfRefraction",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"texture",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"thicknessTexture",void 0);class q extends P.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class m extends Z.b{set angle(U){this.direction.x=Math.cos(U),this.direction.y=Math.sin(U)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(U,"PBRAnisotropic",110,new q,M),this._isEnabled=!1,this.isEnabled=!1,this.Rl=1,this.direction=new e.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=U._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=U._dirtyCallbacks[16]}isReadyForSubMesh(U,M){return!this._isEnabled||!(U._areTexturesDirty&&M.texturesEnabled&&this._texture&&o.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(U,M,b){this._isEnabled?(U.ANISOTROPIC=this._isEnabled,this._isEnabled&&!b.isVerticesDataPresent(x.e.TangentKind)&&(U._needUVs=!0,U.MAINUV1=!0),U._areTexturesDirty&&M.texturesEnabled&&(this._texture&&o.c.AnisotropicTextureEnabled?(0,h.db)(this._texture,U,"ANISOTROPIC_TEXTURE"):U.ANISOTROPIC_TEXTURE=!1),U._areMiscDirty&&(U.ANISOTROPIC_LEGACY=this._legacy)):(U.ANISOTROPIC=!1,U.ANISOTROPIC_TEXTURE=!1,U.ANISOTROPIC_TEXTUREDIRECTUV=0,U.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(U,M){if(!this._isEnabled)return;const b=this._material.isFrozen;U.useUbo&&b&&U.isSync||(this._texture&&o.c.AnisotropicTextureEnabled&&(U.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,h.A)(this._texture,U,"anisotropy")),U.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Rl)),M.texturesEnabled&&this._texture&&o.c.AnisotropicTextureEnabled&&U.setTexture("anisotropySampler",this._texture)}hasTexture(U){return this._texture===U}getActiveTextures(U){this._texture&&U.push(this._texture)}getAnimatables(U){this._texture&&this._texture.animations&&this._texture.animations.length>0&&U.push(this._texture)}dispose(U){U&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(U,M,b){return U.ANISOTROPIC&&M.addFallback(b++,"ANISOTROPIC"),b}getSamplers(U){U.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(U,M,b){super.parse(U,M,b),void 0===U.legacy&&(this.legacy=!0)}}(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"isEnabled",void 0),(0,a.c)([(0,A.J)()],m.prototype,"intensity",void 0),(0,a.c)([(0,A.D)()],m.prototype,"direction",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"texture",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsMiscDirty")],m.prototype,"legacy",void 0);class n extends P.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class E extends Z.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(U,"Sheen",120,new n,M),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Rl=1,this.color=J.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=U._dirtyCallbacks[1]}isReadyForSubMesh(U,M){if(!this._isEnabled)return!0;if(U._areTexturesDirty&&M.texturesEnabled){if(this._texture&&o.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&o.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(U,M){this._isEnabled?(U.SHEEN=!0,U.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,U.SHEEN_ROUGHNESS=null!==this._roughness,U.SHEEN_ALBEDOSCALING=this._albedoScaling,U.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,U._areTexturesDirty&&M.texturesEnabled&&(this._texture&&o.c.SheenTextureEnabled?((0,h.db)(this._texture,U,"SHEEN_TEXTURE"),U.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):U.SHEEN_TEXTURE=!1,this._textureRoughness&&o.c.SheenTextureEnabled?(0,h.db)(this._textureRoughness,U,"SHEEN_TEXTURE_ROUGHNESS"):U.SHEEN_TEXTURE_ROUGHNESS=!1)):(U.SHEEN=!1,U.SHEEN_TEXTURE=!1,U.SHEEN_TEXTURE_ROUGHNESS=!1,U.SHEEN_LINKWITHALBEDO=!1,U.SHEEN_ROUGHNESS=!1,U.SHEEN_ALBEDOSCALING=!1,U.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,U.SHEEN_GAMMATEXTURE=!1,U.SHEEN_TEXTUREDIRECTUV=0,U.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(U,M,b,a){if(!this._isEnabled)return;const A=a.materialDefines,H=this._material.isFrozen;if(!U.useUbo||!H||!U.isSync){var W,y,O,e;if((this._texture||this._textureRoughness)&&o.c.SheenTextureEnabled)U.updateFloat4("vSheenInfos",(null===(W=this._texture)||void 0===W?void 0:W.coordinatesIndex)??0,(null===(y=this._texture)||void 0===y?void 0:y.level)??0,(null===(O=this._textureRoughness)||void 0===O?void 0:O.coordinatesIndex)??0,(null===(e=this._textureRoughness)||void 0===e?void 0:e.level)??0),this._texture&&(0,h.A)(this._texture,U,"sheen"),this._textureRoughness&&!A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,h.A)(this._textureRoughness,U,"sheenRoughness");U.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Rl),null!==this._roughness&&U.updateFloat("vSheenRoughness",this._roughness)}M.texturesEnabled&&(this._texture&&o.c.SheenTextureEnabled&&U.setTexture("sheenSampler",this._texture),this._textureRoughness&&!A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&o.c.SheenTextureEnabled&&U.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(U){return this._texture===U||this._textureRoughness===U}getActiveTextures(U){this._texture&&U.push(this._texture),this._textureRoughness&&U.push(this._textureRoughness)}getAnimatables(U){this._texture&&this._texture.animations&&this._texture.animations.length>0&&U.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&U.push(this._textureRoughness)}dispose(U){var M,b;U&&(null===(M=this._texture)||void 0===M||M.dispose(),null===(b=this._textureRoughness)||void 0===b||b.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(U,M,b){return U.SHEEN&&M.addFallback(b++,"SHEEN"),b}getSamplers(U){U.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isEnabled",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"linkSheenWithAlbedo",void 0),(0,a.c)([(0,A.J)()],E.prototype,"intensity",void 0),(0,a.c)([(0,A.j)()],E.prototype,"color",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"texture",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useRoughnessFromMainTexture",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"roughness",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"textureRoughness",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"albedoScaling",void 0);class X extends P.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class Q extends Z.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(U){this._scene.enableSubSurfaceForPrePass()&&U&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(U))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(U){this._volumeIndexOfRefraction=U>=1?U:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(U,"PBRSubSurface",130,new X,M),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=J.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=J.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=Q.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=Q.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=U.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=U._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=U._dirtyCallbacks[32]}isReadyForSubMesh(U,M){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(U._areTexturesDirty&&M.texturesEnabled){if(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const U=this._getRefractionTexture(M);if(U&&o.c.RefractionTextureEnabled&&!U.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(U,M){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return U.SUBSURFACE=!1,U.SS_DISPERSION=!1,U.SS_TRANSLUCENCY=!1,U.SS_SCATTERING=!1,U.SS_REFRACTION=!1,U.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,U.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,U.SS_THICKNESSANDMASK_TEXTURE=!1,U.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,U.SS_HAS_THICKNESS=!1,U.SS_REFRACTIONINTENSITY_TEXTURE=!1,U.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,U.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,U.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,U.SS_REFRACTIONMAP_3D=!1,U.SS_REFRACTIONMAP_OPPOSITEZ=!1,U.SS_LODINREFRACTIONALPHA=!1,U.SS_GAMMAREFRACTION=!1,U.SS_RGBDREFRACTION=!1,U.SS_LINEARSPECULARREFRACTION=!1,U.SS_LINKREFRACTIONTOTRANSPARENCY=!1,U.SS_ALBEDOFORREFRACTIONTINT=!1,U.SS_ALBEDOFORTRANSLUCENCYTINT=!1,U.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,U.SS_USE_THICKNESS_AS_DEPTH=!1,U.SS_USE_GLTF_TEXTURES=!1,U.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,U.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,U.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(U.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(U._areTexturesDirty){if(U.SUBSURFACE=!0,U.SS_DISPERSION=this._isDispersionEnabled,U.SS_TRANSLUCENCY=this._isTranslucencyEnabled,U.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,U.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,U.SS_SCATTERING=this._isScatteringEnabled,U.SS_THICKNESSANDMASK_TEXTURE=!1,U.SS_REFRACTIONINTENSITY_TEXTURE=!1,U.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,U.SS_HAS_THICKNESS=!1,U.SS_USE_GLTF_TEXTURES=!1,U.SS_REFRACTION=!1,U.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,U.SS_REFRACTIONMAP_3D=!1,U.SS_GAMMAREFRACTION=!1,U.SS_RGBDREFRACTION=!1,U.SS_LINEARSPECULARREFRACTION=!1,U.SS_REFRACTIONMAP_OPPOSITEZ=!1,U.SS_LODINREFRACTIONALPHA=!1,U.SS_LINKREFRACTIONTOTRANSPARENCY=!1,U.SS_ALBEDOFORREFRACTIONTINT=!1,U.SS_ALBEDOFORTRANSLUCENCYTINT=!1,U.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,U.SS_USE_THICKNESS_AS_DEPTH=!1,U.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,U.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,U._areTexturesDirty&&M.texturesEnabled&&(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&(0,h.db)(this._thicknessTexture,U,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&o.c.RefractionIntensityTextureEnabled&&(0,h.db)(this._refractionIntensityTexture,U,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&(0,h.db)(this._translucencyIntensityTexture,U,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&((0,h.db)(this._translucencyColorTexture,U,"SS_TRANSLUCENCYCOLOR_TEXTURE"),U.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),U.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,U.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,U.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,U.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&M.texturesEnabled){const b=this._getRefractionTexture(M);b&&o.c.RefractionTextureEnabled&&(U.SS_REFRACTION=!0,U.SS_REFRACTIONMAP_3D=b.isCube,U.SS_GAMMAREFRACTION=b.gammaSpace,U.SS_RGBDREFRACTION=b.isRGBD,U.SS_LINEARSPECULARREFRACTION=b.linearSpecularLOD,U.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&b.isCube?!b.invertZ:b.invertZ,U.SS_LODINREFRACTIONALPHA=b.lodLevelInAlpha,U.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,U.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,U.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=b.isCube&&b.boundingBoxSize,U.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(U.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(U,M,b,a){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)U.updateFloat2("vThicknessParam",0,0);else{a.getRenderingMesh().getWorldMatrix().decompose(e.g.lk[0]);const M=Math.max(Math.abs(e.g.lk[0].x),Math.abs(e.g.lk[0].y),Math.abs(e.g.lk[0].z));U.updateFloat2("vThicknessParam",this.minimumThickness*M,(this.maximumThickness-this.minimumThickness)*M)}}bindForSubMesh(U,M,b,a){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const A=a.materialDefines,H=this._material.isFrozen,W=this._material.realTimeFiltering,y=A.LODBASEDMICROSFURACE,O=this._getRefractionTexture(M);if(!U.useUbo||!H||!U.isSync){if(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&(U.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,h.A)(this._thicknessTexture,U,"thickness")),this._refractionIntensityTexture&&o.c.RefractionIntensityTextureEnabled&&A.SS_REFRACTIONINTENSITY_TEXTURE&&(U.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,h.A)(this._refractionIntensityTexture,U,"refractionIntensity")),this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&A.SS_TRANSLUCENCYCOLOR_TEXTURE&&(U.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,h.A)(this._translucencyColorTexture,U,"translucencyColor")),this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&A.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(U.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,h.A)(this._translucencyIntensityTexture,U,"translucencyIntensity")),O&&o.c.RefractionTextureEnabled){U.zk("refractionMatrix",O.getRefractionTextureMatrix());let M=1;O.isCube||O.depth&&(M=O.depth);const b=O.getSize().width,a=this.volumeIndexOfRefraction;if(U.updateFloat4("vRefractionInfos",O.level,1/a,M,this._invertRefractionY?-1:1),U.updateFloat4("vRefractionMicrosurfaceInfos",b,O.lodGenerationScale,O.lodGenerationOffset,1/this.indexOfRefraction),W&&U.updateFloat2("vRefractionFilteringInfo",b,Math.log2(b)),O.boundingBoxSize){const M=O;U.updateVector3("vRefractionPosition",M.boundingBoxPosition),U.updateVector3("vRefractionSize",M.boundingBoxSize)}}this._isScatteringEnabled&&U.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),U.updateColor3("vDiffusionDistance",this.diffusionDistance),U.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),U.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),U.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),U.updateFloat("dispersion",this.dispersion)}M.texturesEnabled&&(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&U.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&o.c.RefractionIntensityTextureEnabled&&A.SS_REFRACTIONINTENSITY_TEXTURE&&U.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&A.SS_TRANSLUCENCYINTENSITY_TEXTURE&&U.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&A.SS_TRANSLUCENCYCOLOR_TEXTURE&&U.setTexture("translucencyColorSampler",this._translucencyColorTexture),O&&o.c.RefractionTextureEnabled&&(y?U.setTexture("refractionSampler",O):(U.setTexture("refractionSampler",O._lodTextureMid||O),U.setTexture("refractionSamplerLow",O._lodTextureLow||O),U.setTexture("refractionSamplerHigh",O._lodTextureHigh||O))))}_getRefractionTexture(U){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?U.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(U){o.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&U.push(this._refractionTexture)}hasTexture(U){return this._thicknessTexture===U||(this._refractionTexture===U||(this._refractionIntensityTexture===U||(this._translucencyIntensityTexture===U||this._translucencyColorTexture===U)))}hasRenderTargetTextures(){return!!(o.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(U){this._thicknessTexture&&U.push(this._thicknessTexture),this._refractionTexture&&U.push(this._refractionTexture),this._translucencyColorTexture&&U.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&U.push(this._translucencyIntensityTexture)}getAnimatables(U){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&U.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&U.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&U.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&U.push(this._translucencyIntensityTexture)}dispose(U){U&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(U,M,b){return U.SS_SCATTERING&&M.addFallback(b++,"SS_SCATTERING"),U.SS_TRANSLUCENCY&&M.addFallback(b++,"SS_TRANSLUCENCY"),b}getSamplers(U){U.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}Q.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,Q.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"isRefractionEnabled",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"isTranslucencyEnabled",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"isDispersionEnabled",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markScenePrePassDirty")],Q.prototype,"isScatteringEnabled",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"refractionIntensity",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"translucencyIntensity",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"useAlbedoToTintRefraction",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"useAlbedoToTintTranslucency",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"thicknessTexture",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"refractionTexture",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"indexOfRefraction",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"_volumeIndexOfRefraction",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"volumeIndexOfRefraction",null),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"invertRefractionY",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"linkRefractionWithTransparency",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"minimumThickness",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"maximumThickness",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"useThicknessAsDepth",void 0),(0,a.c)([(0,A.j)()],Q.prototype,"tintColor",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"tintColorAtDistance",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"dispersion",void 0),(0,a.c)([(0,A.j)()],Q.prototype,"diffusionDistance",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useMaskFromThicknessTexture",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"refractionIntensityTexture",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"translucencyIntensityTexture",void 0),(0,a.c)([(0,A.j)()],Q.prototype,"translucencyColor",void 0),(0,a.c)([(0,A.A)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"translucencyColorTexture",void 0),(0,a.c)([(0,A.J)(),(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Q.prototype,"useGltfStyleTextures",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"applyAlbedoAfterSubSurface",void 0),(0,a.c)([(0,A.J)()],Q.prototype,"legacyTransluceny",void 0);var I=b(12239),v=b(823),t=b(12251);const V={effect:null,subMesh:null};class k extends P.d{constructor(U){super(U),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class N extends L.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(U){this._realTimeFiltering=U,this.hk(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(U){this._realTimeFilteringQuality=U,this.hk(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(U){U!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=U||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(U,M){super(U,M,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||N.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new e.n(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=N.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=J.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new J.c(0,0,0),this._albedoColor=new J.c(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new J.c(1,1,1),this._reflectionColor=new J.c(1,1,1),this._emissiveColor=new J.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=N.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new W.h(16),this._globalAmbientColor=new J.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new r(this),this.clearCoat=new Y(this),this.iridescence=new s(this),this.anisotropy=new m(this),this.sheen=new E(this),this.subSurface=new Q(this),this.detailMap=new I.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),o.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,y.d)(this.va()),this.prePassConfiguration=new B.c}get hasRenderTargetTextures(){return!!(o.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var U;return this._transparencyMode===N.PBRMATERIAL_OPAQUE||this._transparencyMode===N.PBRMATERIAL_ALPHATEST||(null===(U=this.subSurface)||void 0===U?void 0:U.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var U;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(U=this.subSurface)||void 0===U||!U.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===N.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Ei&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==N.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Ei||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(U,M,b){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const a=M._drawWrapper;if(a.effect&&this.isFrozen&&a._wasPreviouslyReady&&a._wasPreviouslyUsingInstances===b)return!0;M.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),M.materialDefines=new k(this._eventInfo.defineNames));const A=M.materialDefines;if(this._isReadyForSubMesh(M))return!0;const W=this.va(),y=W.getEngine();if(A._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,W.texturesEnabled)){if(this._albedoTexture&&o.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&o.c.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&o.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&o.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const U=this._getReflectionTexture();if(U&&o.c.ReflectionTextureEnabled){if(!U.isReadyOrNotBlocking())return!1;var O;if(U.irradianceTexture){if(!U.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!U.sphericalPolynomial&&null!==(O=U.getInternalTexture())&&void 0!==O&&O._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&o.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&o.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(o.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(y.getCaps().standardDerivatives&&this._bumpTexture&&o.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&o.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=A,this._eventInfo.subMesh=M,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(A._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(A.AREALIGHTUSED)for(let H=0;H<U.lightSources.length;H++)if(!U.lightSources[H]._isReady())return!1;y.getCaps().standardDerivatives||U.isVerticesDataPresent(x.e.NormalKind)||(U.createNormals(!0),H.b.Warn("PBRMaterial: Normals have been created for the mesh: "+U.name));const e=M.effect,P=A._areLightsDisposed;let Z=this._prepareEffect(U,A,this.onCompiled,this.onError,b,null,M.getRenderingMesh().hasThinInstances),C=!1;if(Z)if(this._onEffectCreatedObservable&&(V.effect=Z,V.subMesh=M,this._onEffectCreatedObservable.notifyObservers(V)),this.allowShaderHotSwapping&&e&&!Z.isReady()){if(Z=e,A.markAsUnprocessed(),C=this.isFrozen,P)return A._areLightsDisposed=!0,!1}else W.resetCachedMaterial(),M.setEffect(Z,A,this._materialContext);return!(!M.effect||!M.effect.isReady())&&(A._renderId=W.getRenderId(),a._wasPreviouslyReady=!C,a._wasPreviouslyUsingInstances=!!b,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(U,M){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(U,M,H,W,y),!M.isDirty)return null;M.markAsProcessed();const O=this.va().getEngine(),e=new S.e;let P=0;M.USESPHERICALINVERTEX&&e.addFallback(P++,"USESPHERICALINVERTEX"),M.FOG&&e.addFallback(P,"FOG"),M.SPECULARAA&&e.addFallback(P,"SPECULARAA"),M.POINTSIZE&&e.addFallback(P,"POINTSIZE"),M.LOGARITHMICDEPTH&&e.addFallback(P,"LOGARITHMICDEPTH"),M.PARALLAX&&e.addFallback(P,"PARALLAX"),M.PARALLAX_RHS&&e.addFallback(P,"PARALLAX_RHS"),M.PARALLAXOCCLUSION&&e.addFallback(P++,"PARALLAXOCCLUSION"),M.ENVIRONMENTBRDF&&e.addFallback(P++,"ENVIRONMENTBRDF"),M.TANGENT&&e.addFallback(P++,"TANGENT"),M.BUMP&&e.addFallback(P++,"BUMP"),P=(0,h.E)(M,e,this._maxSimultaneousLights,P++),M.SPECULARTERM&&e.addFallback(P++,"SPECULARTERM"),M.USESPHERICALFROMREFLECTIONMAP&&e.addFallback(P++,"USESPHERICALFROMREFLECTIONMAP"),M.USEIRRADIANCEMAP&&e.addFallback(P++,"USEIRRADIANCEMAP"),M.LIGHTMAP&&e.addFallback(P++,"LIGHTMAP"),M.NORMAL&&e.addFallback(P++,"NORMAL"),M.AMBIENT&&e.addFallback(P++,"AMBIENT"),M.EMISSIVE&&e.addFallback(P++,"EMISSIVE"),M.VERTEXCOLOR&&e.addFallback(P++,"VERTEXCOLOR"),M.MORPHTARGETS&&e.addFallback(P++,"MORPHTARGETS"),M.MULTIVIEW&&e.addFallback(0,"MULTIVIEW");const Z=[x.e.PositionKind];M.NORMAL&&Z.push(x.e.NormalKind),M.TANGENT&&Z.push(x.e.TangentKind);for(let b=1;b<=6;++b)M["UV"+b]&&Z.push(`uv${1===b?"":b}`);M.VERTEXCOLOR&&Z.push(x.e.ColorKind),(0,h.M)(Z,U,M,e),(0,h.O)(Z,M),(0,h.S)(Z,U,M),(0,h.I)(Z,U,M);let C="pbr";const r=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],J=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],f=["Material","Scene","Mesh"],L={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:M.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=e,this._eventInfo.fallbackRank=P,this._eventInfo.defines=M,this._eventInfo.uniforms=r,this._eventInfo.attributes=Z,this._eventInfo.samplers=J,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=U,this._eventInfo.indexParameters=L,this._callbackPluginEventGeneric(128,this._eventInfo),t.c.AddUniformsAndSamplers(r,J),B.c.AddUniforms(r),B.c.AddSamplers(J),(0,v.e)(r),F.c&&(F.c.PrepareUniforms(r,M),F.c.PrepareSamplers(J,M)),(0,h.pb)({uniformsNames:r,uniformBuffersNames:f,samplers:J,defines:M,maxSimultaneousLights:this._maxSimultaneousLights});const z={};this.customShaderNameResolve&&(C=this.customShaderNameResolve(C,r,f,J,M,Z,z));const o=M.toString(),i=O.createEffect(C,{attributes:Z,uniformsNames:r,uniformBuffersNames:f,samplers:J,defines:o,fallbacks:e,onCompiled:a,onError:A,indexParameters:L,processFinalCode:z.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:M.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([b.e(41),b.e(50)]).then(b.bind(b,13899)),Promise.all([b.e(42),b.e(51)]).then(b.bind(b,13920))]):await Promise.all([Promise.all([b.e(45),b.e(52)]).then(b.bind(b,13925)),Promise.all([b.e(47),b.e(53)]).then(b.bind(b,13948))]),this._shadersLoaded=!0}},O);return this._eventInfo.customCode=void 0,i}_prepareDefines(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const H=this.va(),W=H.getEngine();(0,h.ab)(H,U,M,!0,this._maxSimultaneousLights,this._disableLighting),M._needNormals=!0,(0,h.hb)(H,M);const y=this.needAlphaBlendingForMesh(U)&&this.va().useOrderIndependentTransparency;if((0,h.nb)(H,M,this.canRenderToMRT&&!y),(0,h.kb)(H,M,y),t.c.PrepareDefines(W.currentRenderPassId,U,M),M.METALLICWORKFLOW=this.isMetallicWorkflow(),M._areTexturesDirty){M._needUVs=!1;for(let U=1;U<=6;++U)M["MAINUV"+U]=!1;if(H.texturesEnabled){M.ALBEDODIRECTUV=0,M.BASE_WEIGHTDIRECTUV=0,M.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,M.AMBIENTDIRECTUV=0,M.OPACITYDIRECTUV=0,M.EMISSIVEDIRECTUV=0,M.REFLECTIVITYDIRECTUV=0,M.MICROSURFACEMAPDIRECTUV=0,M.METALLIC_REFLECTANCEDIRECTUV=0,M.REFLECTANCEDIRECTUV=0,M.BUMPDIRECTUV=0,M.LIGHTMAPDIRECTUV=0,W.getCaps().textureLOD&&(M.LODBASEDMICROSFURACE=!0),this._albedoTexture&&o.c.DiffuseTextureEnabled?((0,h.db)(this._albedoTexture,M,"ALBEDO"),M.GAMMAALBEDO=this._albedoTexture.gammaSpace):M.ALBEDO=!1,this._baseWeightTexture&&o.c.BaseWeightTextureEnabled?(0,h.db)(this._baseWeightTexture,M,"BASE_WEIGHT"):M.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled?(0,h.db)(this._baseDiffuseRoughnessTexture,M,"BASE_DIFFUSE_ROUGHNESS"):M.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&o.c.AmbientTextureEnabled?((0,h.db)(this._ambientTexture,M,"AMBIENT"),M.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):M.AMBIENT=!1,this._opacityTexture&&o.c.OpacityTextureEnabled?((0,h.db)(this._opacityTexture,M,"OPACITY"),M.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):M.OPACITY=!1;const U=this._getReflectionTexture();if(U&&o.c.ReflectionTextureEnabled){switch(M.REFLECTION=!0,M.GAMMAREFLECTION=U.gammaSpace,M.RGBDREFLECTION=U.isRGBD,M.LODINREFLECTIONALPHA=U.lodLevelInAlpha,M.LINEARSPECULARREFLECTION=U.linearSpecularLOD,M.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(M.NUM_SAMPLES=""+this.realTimeFilteringQuality,W._features.needTypeSuffixInShaderConstants&&(M.NUM_SAMPLES=M.NUM_SAMPLES+"u"),M.REALTIME_FILTERING=!0,this.va().iblCdfGenerator&&(M.IBL_CDF_FILTERING=!0)):M.REALTIME_FILTERING=!1,M.INVERTCUBICMAP=U.coordinatesMode===z.e.INVCUBIC_MODE,M.REFLECTIONMAP_3D=U.isCube,M.REFLECTIONMAP_OPPOSITEZ=M.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!U.invertZ:U.invertZ,M.REFLECTIONMAP_CUBIC=!1,M.REFLECTIONMAP_EXPLICIT=!1,M.REFLECTIONMAP_PLANAR=!1,M.REFLECTIONMAP_PROJECTION=!1,M.REFLECTIONMAP_SKYBOX=!1,M.REFLECTIONMAP_SPHERICAL=!1,M.REFLECTIONMAP_EQUIRECTANGULAR=!1,M.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,M.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,U.coordinatesMode){case z.e.EXPLICIT_MODE:M.REFLECTIONMAP_EXPLICIT=!0;break;case z.e.PLANAR_MODE:M.REFLECTIONMAP_PLANAR=!0;break;case z.e.PROJECTION_MODE:M.REFLECTIONMAP_PROJECTION=!0;break;case z.e.SKYBOX_MODE:M.REFLECTIONMAP_SKYBOX=!0;break;case z.e.SPHERICAL_MODE:M.REFLECTIONMAP_SPHERICAL=!0;break;case z.e.EQUIRECTANGULAR_MODE:M.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case z.e.FIXED_EQUIRECTANGULAR_MODE:M.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case z.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:M.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case z.e.CUBIC_MODE:case z.e.INVCUBIC_MODE:default:M.REFLECTIONMAP_CUBIC=!0,M.USE_LOCAL_REFLECTIONMAP_CUBIC=!!U.boundingBoxSize}U.coordinatesMode!==z.e.SKYBOX_MODE&&(U.irradianceTexture?(M.USEIRRADIANCEMAP=!0,M.USESPHERICALFROMREFLECTIONMAP=!1,M.USESPHERICALINVERTEX=!1,U.irradianceTexture._dominantDirection&&(M.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):U.isCube&&(M.USESPHERICALFROMREFLECTIONMAP=!0,M.USEIRRADIANCEMAP=!1,M.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||W.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?M.USESPHERICALINVERTEX=!1:M.USESPHERICALINVERTEX=!0))}else M.REFLECTION=!1,M.REFLECTIONMAP_3D=!1,M.REFLECTIONMAP_SPHERICAL=!1,M.REFLECTIONMAP_PLANAR=!1,M.REFLECTIONMAP_CUBIC=!1,M.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,M.REFLECTIONMAP_PROJECTION=!1,M.REFLECTIONMAP_SKYBOX=!1,M.REFLECTIONMAP_EXPLICIT=!1,M.REFLECTIONMAP_EQUIRECTANGULAR=!1,M.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,M.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,M.INVERTCUBICMAP=!1,M.USESPHERICALFROMREFLECTIONMAP=!1,M.USEIRRADIANCEMAP=!1,M.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,M.USESPHERICALINVERTEX=!1,M.REFLECTIONMAP_OPPOSITEZ=!1,M.LODINREFLECTIONALPHA=!1,M.GAMMAREFLECTION=!1,M.RGBDREFLECTION=!1,M.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&o.c.LightmapTextureEnabled?((0,h.db)(this._lightmapTexture,M,"LIGHTMAP"),M.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,M.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,M.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):M.LIGHTMAP=!1,this._emissiveTexture&&o.c.EmissiveTextureEnabled?((0,h.db)(this._emissiveTexture,M,"EMISSIVE"),M.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):M.EMISSIVE=!1,o.c.SpecularTextureEnabled?(this._metallicTexture?((0,h.db)(this._metallicTexture,M,"REFLECTIVITY"),M.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,M.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,M.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,M.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,M.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,h.db)(this._reflectivityTexture,M,"REFLECTIVITY"),M.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,M.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,M.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):M.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(M.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,h.db)(this._metallicReflectanceTexture,M,"METALLIC_REFLECTANCE"),M.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):M.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,h.db)(this._reflectanceTexture,M,"REFLECTANCE"),M.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):M.REFLECTANCE=!1):(M.METALLIC_REFLECTANCE=!1,M.REFLECTANCE=!1),this._microSurfaceTexture?(0,h.db)(this._microSurfaceTexture,M,"MICROSURFACEMAP"):M.MICROSURFACEMAP=!1):(M.REFLECTIVITY=!1,M.MICROSURFACEMAP=!1),W.getCaps().standardDerivatives&&this._bumpTexture&&o.c.BumpTextureEnabled&&!this._disableBumpMap?((0,h.db)(this._bumpTexture,M,"BUMP"),this._useParallax&&this._albedoTexture&&o.c.DiffuseTextureEnabled?(M.PARALLAX=!0,M.PARALLAX_RHS=H.useRightHandedSystem,M.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):M.PARALLAX=!1,M.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(M.BUMP=!1,M.PARALLAX=!1,M.PARALLAX_RHS=!1,M.PARALLAXOCCLUSION=!1,M.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&o.c.ReflectionTextureEnabled?(M.ENVIRONMENTBRDF=!0,M.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(M.ENVIRONMENTBRDF=!1,M.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?M.ALPHAFROMALBEDO=!0:M.ALPHAFROMALBEDO=!1}M.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===N.LIGHTFALLOFF_STANDARD?(M.USEPHYSICALLIGHTFALLOFF=!1,M.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===N.LIGHTFALLOFF_GLTF?(M.USEPHYSICALLIGHTFALLOFF=!1,M.USEGLTFLIGHTFALLOFF=!0):(M.USEPHYSICALLIGHTFALLOFF=!0,M.USEGLTFLIGHTFALLOFF=!1),M.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.vk&&this._twoSidedLighting?M.TWOSIDEDLIGHTING=!0:M.TWOSIDEDLIGHTING=!1,M.MIRRORED=!!H._mirroredCameraPosition,M.SPECULARAA=W.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(M._areTexturesDirty||M._areMiscDirty)&&(M.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,M.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,M.ALPHABLEND=this.needAlphaBlendingForMesh(U),M.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,M.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),M._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(M),M.FORCENORMALFORWARD=this._forceNormalForward,M.RADIANCEOCCLUSION=this._useRadianceOcclusion,M.HORIZONOCCLUSION=this._useHorizonOcclusion,M._areMiscDirty&&((0,h.fb)(U,H,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(U),M,this._applyDecalMapAfterDetailMap),M.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!U.isVerticesDataPresent(x.e.NormalKind),M.DEBUGMODE=this._debugMode),(0,h.Y)(H,W,this,M,!!b,a,A),this._eventInfo.defines=M,this._eventInfo.mesh=U,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,h.W)(U,M,!0,!0,!0,this._transparencyMode!==N.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(U,M,b){const a={clipPlane:!1,useInstances:!1,...b};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const b=new k(this._eventInfo.defineNames),A=this._prepareEffect(U,b,void 0,void 0,a.useInstances,a.clipPlane,U.hasThinInstances);this._onEffectCreatedObservable&&(V.effect=A,V.subMesh=null,this._onEffectCreatedObservable.notifyObservers(V)),A.isReady()?M&&M(this):A.onCompileObservable.add((()=>{M&&M(this)}))})()}buildUniformLayout(){const U=this._uniformBuffer;U.addUniform("vAlbedoInfos",2),U.addUniform("vBaseWeightInfos",2),U.addUniform("vBaseDiffuseRoughnessInfos",2),U.addUniform("vAmbientInfos",4),U.addUniform("vOpacityInfos",2),U.addUniform("vEmissiveInfos",2),U.addUniform("vLightmapInfos",2),U.addUniform("vReflectivityInfos",3),U.addUniform("vMicroSurfaceSamplerInfos",2),U.addUniform("vReflectionInfos",2),U.addUniform("vReflectionFilteringInfo",2),U.addUniform("vReflectionPosition",3),U.addUniform("vReflectionSize",3),U.addUniform("vBumpInfos",3),U.addUniform("albedoMatrix",16),U.addUniform("baseWeightMatrix",16),U.addUniform("baseDiffuseRoughnessMatrix",16),U.addUniform("ambientMatrix",16),U.addUniform("opacityMatrix",16),U.addUniform("emissiveMatrix",16),U.addUniform("lightmapMatrix",16),U.addUniform("reflectivityMatrix",16),U.addUniform("microSurfaceSamplerMatrix",16),U.addUniform("bumpMatrix",16),U.addUniform("vTangentSpaceParams",2),U.addUniform("reflectionMatrix",16),U.addUniform("vReflectionColor",3),U.addUniform("vAlbedoColor",4),U.addUniform("baseWeight",1),U.addUniform("baseDiffuseRoughness",1),U.addUniform("vLightingIntensity",4),U.addUniform("vReflectionMicrosurfaceInfos",3),U.addUniform("vReflectionDominantDirection",3),U.addUniform("pointSize",1),U.addUniform("vReflectivityColor",4),U.addUniform("vEmissiveColor",3),U.addUniform("vAmbientColor",3),U.addUniform("vDebugMode",2),U.addUniform("vMetallicReflectanceFactors",4),U.addUniform("vMetallicReflectanceInfos",2),U.addUniform("metallicReflectanceMatrix",16),U.addUniform("vReflectanceInfos",2),U.addUniform("reflectanceMatrix",16),U.addUniform("vSphericalL00",3),U.addUniform("vSphericalL1_1",3),U.addUniform("vSphericalL10",3),U.addUniform("vSphericalL11",3),U.addUniform("vSphericalL2_2",3),U.addUniform("vSphericalL2_1",3),U.addUniform("vSphericalL20",3),U.addUniform("vSphericalL21",3),U.addUniform("vSphericalL22",3),U.addUniform("vSphericalX",3),U.addUniform("vSphericalY",3),U.addUniform("vSphericalZ",3),U.addUniform("vSphericalXX_ZZ",3),U.addUniform("vSphericalYY_ZZ",3),U.addUniform("vSphericalZZ",3),U.addUniform("vSphericalXY",3),U.addUniform("vSphericalYZ",3),U.addUniform("vSphericalZX",3),U.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(U,M,b){const a=this.va(),A=b.materialDefines;if(!A)return;const H=b.effect;if(!H)return;this._activeEffect=H,M.getMeshUniformBuffer().bindToEffect(H,"Mesh"),M.transferToEffect(U);const W=a.getEngine();this._uniformBuffer.bindToEffect(H,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,M,U,this.isFrozen),t.c.Bind(W.currentRenderPassId,this._activeEffect,M,U,this);const y=a.activeCamera;y?this._uniformBuffer.updateFloat4("cameraInfo",y.ek,y.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=b,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),A.OBJECTSPACE_NORMALMAP&&(U.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const e=this._mustRebind(a,H,b,M.visibility);(0,h.d)(M,this._activeEffect,this.prePassConfiguration);let x=null;const P=this._uniformBuffer;if(e){if(this.bindViewProjection(H),x=this._getReflectionTexture(),!P.useUbo||!this.isFrozen||!P.isSync||b._drawWrapper._forceRebindOnNextCall){var Z;if(a.texturesEnabled){if(this._albedoTexture&&o.c.DiffuseTextureEnabled&&(P.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,h.A)(this._albedoTexture,P,"albedo")),this._baseWeightTexture&&o.c.BaseWeightTextureEnabled&&(P.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,h.A)(this._baseWeightTexture,P,"baseWeight")),this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled&&(P.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,h.A)(this._baseDiffuseRoughnessTexture,P,"baseDiffuseRoughness")),this._ambientTexture&&o.c.AmbientTextureEnabled&&(P.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,h.A)(this._ambientTexture,P,"ambient")),this._opacityTexture&&o.c.OpacityTextureEnabled&&(P.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,h.A)(this._opacityTexture,P,"opacity")),x&&o.c.ReflectionTextureEnabled){if(P.zk("reflectionMatrix",x.getReflectionTextureMatrix()),P.updateFloat2("vReflectionInfos",x.level*a.iblIntensity,0),x.boundingBoxSize){const U=x;P.updateVector3("vReflectionPosition",U.boundingBoxPosition),P.updateVector3("vReflectionSize",U.boundingBoxSize)}if(this.realTimeFiltering){const U=x.getSize().width;P.updateFloat2("vReflectionFilteringInfo",U,Math.log2(U))}if(A.USEIRRADIANCEMAP)A.USEIRRADIANCEMAP&&A.USE_IRRADIANCE_DOMINANT_DIRECTION&&P.updateVector3("vReflectionDominantDirection",x.irradianceTexture._dominantDirection);else{const U=x.sphericalPolynomial;if(A.USESPHERICALFROMREFLECTIONMAP&&U)if(A.SPHERICAL_HARMONICS){const M=U.preScaledHarmonics;P.updateVector3("vSphericalL00",M.l00),P.updateVector3("vSphericalL1_1",M.l1_1),P.updateVector3("vSphericalL10",M.l10),P.updateVector3("vSphericalL11",M.l11),P.updateVector3("vSphericalL2_2",M.l2_2),P.updateVector3("vSphericalL2_1",M.l2_1),P.updateVector3("vSphericalL20",M.l20),P.updateVector3("vSphericalL21",M.l21),P.updateVector3("vSphericalL22",M.l22)}else P.updateFloat3("vSphericalX",U.x.x,U.x.y,U.x.z),P.updateFloat3("vSphericalY",U.y.x,U.y.y,U.y.z),P.updateFloat3("vSphericalZ",U.z.x,U.z.y,U.z.z),P.updateFloat3("vSphericalXX_ZZ",U.xx.x-U.zz.x,U.xx.y-U.zz.y,U.xx.z-U.zz.z),P.updateFloat3("vSphericalYY_ZZ",U.yy.x-U.zz.x,U.yy.y-U.zz.y,U.yy.z-U.zz.z),P.updateFloat3("vSphericalZZ",U.zz.x,U.zz.y,U.zz.z),P.updateFloat3("vSphericalXY",U.xy.x,U.xy.y,U.xy.z),P.updateFloat3("vSphericalYZ",U.yz.x,U.yz.y,U.yz.z),P.updateFloat3("vSphericalZX",U.zx.x,U.zx.y,U.zx.z)}P.updateFloat3("vReflectionMicrosurfaceInfos",x.getSize().width,x.lodGenerationScale,x.lodGenerationOffset)}this._emissiveTexture&&o.c.EmissiveTextureEnabled&&(P.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,h.A)(this._emissiveTexture,P,"emissive")),this._lightmapTexture&&o.c.LightmapTextureEnabled&&(P.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,h.A)(this._lightmapTexture,P,"lightmap")),o.c.SpecularTextureEnabled&&(this._metallicTexture?(P.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,h.A)(this._metallicTexture,P,"reflectivity")):this._reflectivityTexture&&(P.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,h.A)(this._reflectivityTexture,P,"reflectivity")),this._metallicReflectanceTexture&&(P.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,h.A)(this._metallicReflectanceTexture,P,"metallicReflectance")),this._reflectanceTexture&&A.REFLECTANCE&&(P.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,h.A)(this._reflectanceTexture,P,"reflectance")),this._microSurfaceTexture&&(P.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,h.A)(this._microSurfaceTexture,P,"microSurfaceSampler"))),this._bumpTexture&&W.getCaps().standardDerivatives&&o.c.BumpTextureEnabled&&!this._disableBumpMap&&(P.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,h.A)(this._bumpTexture,P,"bump"),a._mirroredCameraPosition?P.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):P.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&P.updateFloat("pointSize",this.pointSize),A.METALLICWORKFLOW){var C;J.g.Dk[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,J.g.Dk[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const U=(null===(C=this.subSurface)||void 0===C?void 0:C._indexOfRefraction)??1.5,M=1;J.g.Dk[0].b=U;const b=Math.pow((U-M)/(U+M),2);J.g.Dk[0].a=b,P.updateDirectColor4("vReflectivityColor",J.g.Dk[0]),P.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else P.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);P.updateColor3("vEmissiveColor",o.c.EmissiveTextureEnabled?this._emissiveColor:J.c.BlackReadOnly),P.updateColor3("vReflectionColor",this._reflectionColor),!A.SS_REFRACTION&&null!==(Z=this.subSurface)&&void 0!==Z&&Z._linkRefractionWithTransparency?P.updateColor4("vAlbedoColor",this._albedoColor,1):P.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),P.updateFloat("baseWeight",this._baseWeight),P.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*a.environmentIntensity,this._lightingInfos.w=this._specularIntensity,P.updateVector4("vLightingIntensity",this._lightingInfos),a.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),P.updateColor3("vAmbientColor",this._globalAmbientColor),P.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(a.texturesEnabled){if(this._albedoTexture&&o.c.DiffuseTextureEnabled&&P.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&o.c.BaseWeightTextureEnabled&&P.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled&&P.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&o.c.AmbientTextureEnabled&&P.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&o.c.OpacityTextureEnabled&&P.setTexture("opacitySampler",this._opacityTexture),x&&o.c.ReflectionTextureEnabled){A.LODBASEDMICROSFURACE?P.setTexture("reflectionSampler",x):(P.setTexture("reflectionSampler",x._lodTextureMid||x),P.setTexture("reflectionSamplerLow",x._lodTextureLow||x),P.setTexture("reflectionSamplerHigh",x._lodTextureHigh||x)),A.USEIRRADIANCEMAP&&P.setTexture("irradianceSampler",x.irradianceTexture);const U=this.va().iblCdfGenerator;this.realTimeFiltering&&U&&P.setTexture("icdfSampler",U.getIcdfTexture())}A.ENVIRONMENTBRDF&&P.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&o.c.EmissiveTextureEnabled&&P.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&o.c.LightmapTextureEnabled&&P.setTexture("lightmapSampler",this._lightmapTexture),o.c.SpecularTextureEnabled&&(this._metallicTexture?P.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&P.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&P.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&A.REFLECTANCE&&P.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&P.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&W.getCaps().standardDerivatives&&o.c.BumpTextureEnabled&&!this._disableBumpMap&&P.setTexture("bumpSampler",this._bumpTexture)}this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(M)&&this.va().depthPeelingRenderer.bind(H),this._eventInfo.subMesh=b,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,v.f)(this._activeEffect,this,a),this.bindEyePosition(H)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(e||!this.isFrozen){var r;if(a.lightsEnabled&&!this._disableLighting&&(0,h.k)(a,M,this._activeEffect,A,this._maxSimultaneousLights),(a.fogEnabled&&M.applyFog&&a.fogMode!==O.b.FOGMODE_NONE||x||this.subSurface.refractionTexture||M.receiveShadows||A.PREPASS)&&this.bindView(H),(0,h.h)(a,M,this._activeEffect,!0),A.NUM_MORPH_INFLUENCERS&&(0,h.s)(M,this._activeEffect),A.BAKED_VERTEX_ANIMATION_TEXTURE)null===(r=M.bakedVertexAnimationManager)||void 0===r||r.bind(H,A.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,h.o)(A,this._activeEffect,a)}this._afterBind(M,this._activeEffect,b),P.update()}getAnimatables(){const U=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&U.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&U.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&U.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&U.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&U.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&U.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&U.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?U.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&U.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&U.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&U.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&U.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&U.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&U.push(this._microSurfaceTexture),U}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const U=super.getActiveTextures();return this._albedoTexture&&U.push(this._albedoTexture),this._baseWeightTexture&&U.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&U.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&U.push(this._ambientTexture),this._opacityTexture&&U.push(this._opacityTexture),this._reflectionTexture&&U.push(this._reflectionTexture),this._emissiveTexture&&U.push(this._emissiveTexture),this._reflectivityTexture&&U.push(this._reflectivityTexture),this._metallicTexture&&U.push(this._metallicTexture),this._metallicReflectanceTexture&&U.push(this._metallicReflectanceTexture),this._reflectanceTexture&&U.push(this._reflectanceTexture),this._microSurfaceTexture&&U.push(this._microSurfaceTexture),this._bumpTexture&&U.push(this._bumpTexture),this._lightmapTexture&&U.push(this._lightmapTexture),U}hasTexture(U){return!!super.hasTexture(U)||(this._albedoTexture===U||(this._baseWeightTexture===U||(this._baseDiffuseRoughnessTexture===U||(this._ambientTexture===U||(this._opacityTexture===U||(this._reflectionTexture===U||(this._emissiveTexture===U||(this._reflectivityTexture===U||(this._metallicTexture===U||(this._metallicReflectanceTexture===U||(this._reflectanceTexture===U||(this._microSurfaceTexture===U||(this._bumpTexture===U||this._lightmapTexture===U)))))))))))))}setPrePassRenderer(){var U;if(null===(U=this.subSurface)||void 0===U||!U.isScatteringEnabled)return!1;const M=this.va().enableSubSurfaceForPrePass();return M&&(M.enabled=!0),!0}dispose(U,M){var b,a,A,H,W,y,O,e,x,P,Z,C,r,B;(this._breakShaderLoadedCheck=!0,M)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(b=this._albedoTexture)||void 0===b||b.dispose(),null===(a=this._baseWeightTexture)||void 0===a||a.dispose(),null===(A=this._baseDiffuseRoughnessTexture)||void 0===A||A.dispose(),null===(H=this._ambientTexture)||void 0===H||H.dispose(),null===(W=this._opacityTexture)||void 0===W||W.dispose(),null===(y=this._reflectionTexture)||void 0===y||y.dispose(),null===(O=this._emissiveTexture)||void 0===O||O.dispose(),null===(e=this._metallicTexture)||void 0===e||e.dispose(),null===(x=this._reflectivityTexture)||void 0===x||x.dispose(),null===(P=this._bumpTexture)||void 0===P||P.dispose(),null===(Z=this._lightmapTexture)||void 0===Z||Z.dispose(),null===(C=this._metallicReflectanceTexture)||void 0===C||C.dispose(),null===(r=this._reflectanceTexture)||void 0===r||r.dispose(),null===(B=this._microSurfaceTexture)||void 0===B||B.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(U,M)}}N.PBRMATERIAL_OPAQUE=f.c.MATERIAL_OPAQUE,N.PBRMATERIAL_ALPHATEST=f.c.MATERIAL_ALPHATEST,N.PBRMATERIAL_ALPHABLEND=f.c.MATERIAL_ALPHABLEND,N.PBRMATERIAL_ALPHATESTANDBLEND=f.c.MATERIAL_ALPHATESTANDBLEND,N.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,N.LIGHTFALLOFF_PHYSICAL=0,N.LIGHTFALLOFF_GLTF=1,N.LIGHTFALLOFF_STANDARD=2,N.ForceGLSL=!1,(0,a.c)([(0,A.r)()],N.prototype,"_imageProcessingConfiguration",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsMiscDirty")],N.prototype,"debugMode",void 0)},12723:(U,M,b)=>{"use strict";b.d(M,{e:()=>Z});var a=b(645),A=b(652),H=b(479),W=b(670),y=b(2374),O=b(2371),e=b(609),x=b(474),P=b(698);b(2478);class Z extends y.c{set boundingBoxSize(U){if(this._boundingBoxSize&&this._boundingBoxSize.equals(U))return;this._boundingBoxSize=U;const M=this.va();M&&M.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(U){this._rotationY=U,this.setReflectionTextureMatrix(W.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(U,M,b){let a="";for(const A of U)a+=A;return new Z(a,M,null,b,U)}static CreateFromPrefilteredData(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=M.useDelayedTextureLoading;M.useDelayedTextureLoading=!1;const H=new Z(U,M,null,!1,null,null,null,void 0,!0,b,a);return M.useDelayedTextureLoading=A,H}constructor(U,M){var b;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,r=arguments.length>10&&void 0!==arguments[10]&&arguments[10],B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,F=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0;super(M),this.onLoadObservable=new x.e,this.boundingBoxPosition=W.l.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new W.b,this._buffer=null,this.name=U,this.url=U,this._noMipmap=A,this.Ei=!1,this.isCube=!0,this._textureMatrix=W.b.Identity(),this.coordinatesMode=O.e.CUBIC_MODE;let L=null,z=null;null===a||Array.isArray(a)?(this._noMipmap=A,this._format=P,this._createPolynomials=r,L=a,this._loaderOptions=F,this._useSRGBBuffer=f,this._lodScale=B,this._lodOffset=J):(L=a.extensions??null,this._noMipmap=a.noMipmap??!1,H=a.files??null,z=a.buffer??null,this._format=a.format??5,Z=a.prefiltered??!1,C=a.forcedExtension??null,this._createPolynomials=a.createPolynomials??!1,this._lodScale=a.lodScale??.8,this._lodOffset=a.lodOffset??0,this._loaderOptions=a.loaderOptions,this._useSRGBBuffer=a.useSRGBBuffer,y=a.X??null,e=a.onError??null),(U||H)&&this.updateURL(U,C,y,Z,e,L,null===(b=this.va())||void 0===b?void 0:b.useDelayedTextureLoading,H,z)}getClassName(){return"CubeTexture"}updateURL(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=U),this.url=U,M&&(this._forcedExtension=M);const e=U.lastIndexOf("."),x=M||(e>-1?U.substring(e).toLowerCase():""),P=0===x.indexOf(".dds"),Z=0===x.indexOf(".env"),C=0===x.indexOf(".basis");if(Z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=a,a&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),y)this._files=y;else if(C||Z||P||H||(H=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,H){for(let M=0;M<H.length;M++)this._files.push(U+H[M]);this._extensions=H}this._buffer=O,W?(this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=A):this._loadTexture(b,A)}delayLoad(U){4===this.delayLoadState&&(U&&(this._forcedExtension=U),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(U){var M,b;if(U.updateFlag===this._textureMatrix.updateFlag)return;U.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1,(U=>-1!==U.getActiveTextures().indexOf(this))));if(this._textureMatrix=U,null===(M=this.va())||void 0===M||!M.useRightHandedSystem)return;const a=W.g.lk[0],A=W.g.Quaternion[0],H=W.g.lk[1];this._textureMatrix.decompose(a,A,H),A.z*=-1,A.w*=-1,W.b.ComposeToRef(a,A,H,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var U;return null!==(U=this.va())&&void 0!==U&&U.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this.va(),a=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const A=()=>{var M;(this.onLoadObservable.notifyObservers(this),a)&&(a.dispose(),null===(M=this.va())||void 0===M||M.markAllMaterialsAsDirty(1));U&&U()},W=(U,b)=>{this._loadingError=!0,this._errorObject={message:U,exception:b},M&&M(U,b),O.e.OnTextureLoadErrorObservable.notifyObservers(this)};var y;this._texture?this._texture.isReady?H.d.SetImmediate((()=>A())):this._texture.onLoadedObservable.add((()=>A())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,U,W,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,U,W,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(y=this._texture)||void 0===y||y.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(U,M,b){const a=P.d.Parse((()=>{let a=!1;return U.prefiltered&&(a=U.prefiltered),new Z(b+(U.url??U.name),M,U.extensions,!1,U.files||null,null,null,void 0,a,U.forcedExtension)}),U,M);if(U.boundingBoxPosition&&(a.boundingBoxPosition=W.l.jk(U.boundingBoxPosition)),U.boundingBoxSize&&(a.boundingBoxSize=W.l.jk(U.boundingBoxSize)),U.animations)for(let A=0;A<U.animations.length;A++){const M=U.animations[A],b=(0,e.e)("BABYLON.Animation");b&&a.animations.push(b.Parse(M))}return a}clone(){let U=0;const M=P.d.Clone((()=>{const M=new Z(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return U=M.uniqueId,M}),this);return M.uniqueId=U,M}}(0,a.c)([(0,A.J)()],Z.prototype,"url",void 0),(0,a.c)([(0,A.H)()],Z.prototype,"boundingBoxPosition",void 0),(0,a.c)([(0,A.H)()],Z.prototype,"boundingBoxSize",null),(0,a.c)([(0,A.J)("rotationY")],Z.prototype,"rotationY",null),(0,a.c)([(0,A.J)("files")],Z.prototype,"_files",void 0),(0,a.c)([(0,A.J)("forcedExtension")],Z.prototype,"_forcedExtension",void 0),(0,a.c)([(0,A.J)("extensions")],Z.prototype,"_extensions",void 0),(0,a.c)([(0,A.t)("textureMatrix")],Z.prototype,"_textureMatrix",void 0),(0,a.c)([(0,A.t)("textureMatrixRefraction")],Z.prototype,"_textureMatrixRefraction",void 0),O.e._CubeTextureParser=Z.Parse,(0,e.i)("BABYLON.CubeTexture",Z)},13053:(U,M,b)=>{"use strict";b.d(M,{c:()=>O});var a=b(497),A=b(2371),H=b(623),W=b(2413),y=b(591);W.ThinEngine.prototype.createDynamicTexture=function(U,M,b,a){const A=new y.e(this,4);return A.baseWidth=U,A.baseHeight=M,b&&(U=this.needPOTTextures?(0,H.h)(U,this._caps.maxTextureSize):U,M=this.needPOTTextures?(0,H.h)(M,this._caps.maxTextureSize):M),A.width=U,A.height=M,A.isReady=!1,A.generateMipMaps=b,A.samplingMode=a,this.updateTextureSamplingMode(a,A),this._internalTexturesCache.push(A),A},W.ThinEngine.prototype.updateDynamicTexture=function(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!U)return;const W=this._gl,y=W.TEXTURE_2D,O=this._bindTextureDirectly(y,U,!0,H);this._unpackFlipY(void 0===b?U.invertY:b),a&&W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const e=this._getWebGLTextureType(U.type),x=this._getInternalFormat(A||U.format),P=this._getRGBABufferInternalSizedFormat(U.type,x);W.texImage2D(y,0,P,x,e,M),U.generateMipMaps&&W.generateMipmap(y),O||this._bindTextureDirectly(y,null),a&&W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),A&&(U.format=A),U._dynamicTextureSource=M,U._premulAlpha=a,U.invertY=b||!1,U.isReady=!0};class O extends A.e{constructor(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,y=arguments.length>6?arguments[6]:void 0;const O=!b||b._isScene;super(null,O?b:null===b||void 0===b?void 0:b.$e,O?!a:b,y,H,void 0,void 0,void 0,void 0,W),this.name=U,this.wrapU=A.e.CLAMP_ADDRESSMODE,this.wrapV=A.e.CLAMP_ADDRESSMODE,this._generateMipMaps=a;const e=this._getEngine();if(!e)return;if(M.getContext)this._canvas=M,this._ownCanvas=!1,this._texture=e.createDynamicTexture(this._canvas.width,this._canvas.height,a,H);else{this._canvas=e.createCanvas(1,1),this._ownCanvas=!0;const U=M;U.width||0===U.width?this._texture=e.createDynamicTexture(U.width,U.height,a,H):this._texture=e.createDynamicTexture(M,M,a,H)}const x=this.getSize();this._canvas.width!==x.width&&(this._canvas.width=x.width),this._canvas.height!==x.height&&(this._canvas.height=x.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(U){this._canvas.width=U.width,this._canvas.height=U.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(U.width,U.height,this._generateMipMaps,this.samplingMode)}scale(U){const M=this.getSize();M.width*=U,M.height*=U,this._recreate(M)}scaleTo(U,M){const b=this.getSize();b.width=U,b.height=M,this._recreate(b)}getContext(){return this._context}clear(U){const M=this.getSize();U&&(this._context.fillStyle=U),this._context.clearRect(0,0,M.width,M.height)}update(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===U||U,M,this._format||void 0,void 0,b)}drawText(U,M,b,a,A,H,W){let y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const O=this.getSize();if(H&&(this._context.fillStyle=H,this._context.fillRect(0,0,O.width,O.height)),this._context.font=a,null===M||void 0===M){const b=this._context.measureText(U);M=(O.width-b.width)/2}if(null===b||void 0===b){const U=parseInt(a.replace(/\D/g,""));b=O.height/2+U/3.65}this._context.fillStyle=A||"",this._context.fillText(U,M,b),y&&this.update(W)}dispose(){var U,M;(super.dispose(),this._ownCanvas)&&(null===(U=this._canvas)||void 0===U||null===(M=U.remove)||void 0===M||M.call(U));this._canvas=null,this._context=null}clone(){const U=this.va();if(!U)return this;const M=this.getSize(),b=new O(this.name,M,U,this._generateMipMaps);return b.Ei=this.Ei,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b}serialize(){const U=this.va();U&&!U.isReady()&&a.b.Warn("The scene must be ready before serializing the dynamic texture");const M=super.serialize();return O._IsCanvasElement(this._canvas)&&(M.base64String=this._canvas.toDataURL()),M.invertY=this._invertY,M.samplingMode=this.samplingMode,M}static _IsCanvasElement(U){return void 0!==U.toDataURL}_rebuild(){this.update()}}},12326:(U,M,b)=>{"use strict";b.d(M,{d:()=>A});var a=b(2371);class A extends a.e{constructor(U,M,b,A,H){let W=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9?arguments[9]:void 0,P=arguments.length>10?arguments[10]:void 0,Z=arguments.length>11?arguments[11]:void 0;super(null,H,!W,y,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,x),this.format=A,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==e||(O=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==e||(O=1),this._texture=this._engine.createRawTexture(U,M,b,A,W,y,O,null,e,x??0,P??!1),this.wrapU=a.e.CLAMP_ADDRESSMODE,this.wrapV=a.e.CLAMP_ADDRESSMODE,this._waitingForData=!!Z&&!U)}update(U){this._getEngine().updateRawTexture(this._texture,U,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const U=new A(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return U._texture=this._texture,this._texture.incrementReferences(),U}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(U,M,b,a){return new A(U,M,b,1,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(U,M,b,a){return new A(U,M,b,2,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(U,M,b,a){return new A(U,M,b,0,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(U,M,b,a){return new A(U,M,b,4,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(U,M,b,a){return new A(U,M,b,5,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(U,M,b,a){return new A(U,M,b,5,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(U,M,b,H){let W=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.e.TRILINEAR_SAMPLINGMODE;return new A(U,M,b,6,H,W,y,O,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(U,M,b,H){let W=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.e.TRILINEAR_SAMPLINGMODE;return new A(U,M,b,6,H,W,y,O,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12580:(U,M,b)=>{"use strict";b.d(M,{e:()=>A});var a=b(2371);class A extends a.e{get depth(){return this._depth}constructor(U,M,b,A,H,W){let y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:a.e.TRILINEAR_SAMPLINGMODE,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,P=arguments.length>10?arguments[10]:void 0;super(null,W,!y,O),this.format=H,this._texture=W.getEngine().createRawTexture2DArray(U,M,b,A,H,y,O,e,null,x,P),this._depth=A,this.is2DArray=!0}update(U){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,U,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(U,M,b,a,H){return new A(U,M,b,a,5,H,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12233:(U,M,b)=>{"use strict";b.d(M,{e:()=>a});class a{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(U,M){this._defines[U]||(U<this._currentRank&&(this._currentRank=U),U>this._maxRank&&(this._maxRank=U),this._defines[U]=new Array),this._defines[U].push(M)}addCPUSkinningFallback(U,M){this._mesh=M,U<this._currentRank&&(this._currentRank=U),U>this._maxRank&&(this._maxRank=U)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(U,M){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,U=U.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),M._bonesComputationForcedToCPU=!0;const b=this._mesh.va();for(let U=0;U<b.meshes.length;U++){const a=b.meshes[U];if(a.material){if(a.computeBonesUsingShaders&&0!==a.numBoneInfluencers)if(a.material.getEffect()===M)a.computeBonesUsingShaders=!1;else if(a.xk)for(const U of a.xk){if(U.effect===M){a.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&a.computeBonesUsingShaders&&a.numBoneInfluencers>0&&(a.computeBonesUsingShaders=!1)}}else{const M=this._defines[this._currentRank];if(M)for(let b=0;b<M.length;b++)U=U.replace("#define "+M[b],"");this._currentRank++}return U}}},12239:(U,M,b)=>{"use strict";b.d(M,{c:()=>P});var a=b(645),A=b(811),H=b(652),W=b(12227),y=b(12213),O=b(12243),e=b(816);class x extends y.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class P extends O.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(U,"DetailMap",140,new x,M),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=A.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=U._dirtyCallbacks[1]}isReadyForSubMesh(U,M,b){return!this._isEnabled||!(U._areTexturesDirty&&M.texturesEnabled&&b.getCaps().standardDerivatives&&this._texture&&W.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(U,M){if(this._isEnabled){U.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const b=M.getEngine();U._areTexturesDirty&&(b.getCaps().standardDerivatives&&this._texture&&W.c.DetailTextureEnabled&&this._isEnabled?((0,e.db)(this._texture,U,"DETAIL"),U.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):U.DETAIL=!1)}else U.DETAIL=!1}bindForSubMesh(U,M){if(!this._isEnabled)return;const b=this._material.isFrozen;U.useUbo&&b&&U.isSync||this._texture&&W.c.DetailTextureEnabled&&(U.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,e.A)(this._texture,U,"detail")),M.texturesEnabled&&this._texture&&W.c.DetailTextureEnabled&&U.setTexture("detailSampler",this._texture)}hasTexture(U){return this._texture===U}getActiveTextures(U){this._texture&&U.push(this._texture)}getAnimatables(U){this._texture&&this._texture.animations&&this._texture.animations.length>0&&U.push(this._texture)}dispose(U){var M;U&&(null===(M=this._texture)||void 0===M||M.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(U){U.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,a.c)([(0,H.A)("detailTexture"),(0,H.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,a.c)([(0,H.J)()],P.prototype,"diffuseBlendLevel",void 0),(0,a.c)([(0,H.J)()],P.prototype,"roughnessBlendLevel",void 0),(0,a.c)([(0,H.J)()],P.prototype,"bumpLevel",void 0),(0,a.c)([(0,H.J)(),(0,H.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"normalBlendMethod",void 0),(0,a.c)([(0,H.J)(),(0,H.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0)},12213:(U,M,b)=>{"use strict";b.d(M,{d:()=>a});class a{constructor(U){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=U,U)for(const M in U)Object.prototype.hasOwnProperty.call(U,M)&&this._setDefaultValue(M)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||U,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const U of Object.keys(this))"_"!==U[0]&&this._keys.push(U);if(this._externalProperties)for(const U in this._externalProperties)-1===this._keys.indexOf(U)&&this._keys.push(U)}isEqual(U){if(this._keys.length!==U._keys.length)return!1;for(let M=0;M<this._keys.length;M++){const b=this._keys[M];if(this[b]!==U[b])return!1}return!0}cloneTo(U){this._keys.length!==U._keys.length&&(U._keys=this._keys.slice(0));for(let M=0;M<this._keys.length;M++){const b=this._keys[M];U[b]=this[b]}}reset(){for(const U of this._keys)this._setDefaultValue(U)}_setDefaultValue(U){var M,b,a,A;const H=(null===(M=this._externalProperties)||void 0===M||null===(b=M[U])||void 0===b?void 0:b.type)??typeof this[U],W=null===(a=this._externalProperties)||void 0===a||null===(A=a[U])||void 0===A?void 0:A.default;switch(H){case"number":this[U]=W??0;break;case"string":this[U]=W??"";break;default:this[U]=W??!1}}toString(){let U="";for(let M=0;M<this._keys.length;M++){const b=this._keys[M],a=this[b];switch(typeof a){case"number":case"string":U+="#define "+b+" "+a+"\n";break;default:a&&(U+="#define "+b+"\n")}}return U}}},12227:(U,M,b)=>{"use strict";b.d(M,{c:()=>A});var a=b(562);class A{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(U){this._DiffuseTextureEnabled!==U&&(this._DiffuseTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(U){this._BaseWeightTextureEnabled!==U&&(this._BaseWeightTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(U){this._BaseDiffuseRoughnessTextureEnabled!==U&&(this._BaseDiffuseRoughnessTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(U){this._DetailTextureEnabled!==U&&(this._DetailTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(U){this._DecalMapEnabled!==U&&(this._DecalMapEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(U){this._AmbientTextureEnabled!==U&&(this._AmbientTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(U){this._OpacityTextureEnabled!==U&&(this._OpacityTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(U){this._ReflectionTextureEnabled!==U&&(this._ReflectionTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(U){this._EmissiveTextureEnabled!==U&&(this._EmissiveTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(U){this._SpecularTextureEnabled!==U&&(this._SpecularTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(U){this._BumpTextureEnabled!==U&&(this._BumpTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(U){this._LightmapTextureEnabled!==U&&(this._LightmapTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(U){this._RefractionTextureEnabled!==U&&(this._RefractionTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(U){this._ColorGradingTextureEnabled!==U&&(this._ColorGradingTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(U){this._FresnelEnabled!==U&&(this._FresnelEnabled=U,a.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(U){this._ClearCoatTextureEnabled!==U&&(this._ClearCoatTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(U){this._ClearCoatBumpTextureEnabled!==U&&(this._ClearCoatBumpTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(U){this._ClearCoatTintTextureEnabled!==U&&(this._ClearCoatTintTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(U){this._SheenTextureEnabled!==U&&(this._SheenTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(U){this._AnisotropicTextureEnabled!==U&&(this._AnisotropicTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(U){this._ThicknessTextureEnabled!==U&&(this._ThicknessTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(U){this._RefractionIntensityTextureEnabled!==U&&(this._RefractionIntensityTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(U){this._TranslucencyIntensityTextureEnabled!==U&&(this._TranslucencyIntensityTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(U){this._TranslucencyColorTextureEnabled!==U&&(this._TranslucencyColorTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(U){this._IridescenceTextureEnabled!==U&&(this._IridescenceTextureEnabled=U,a.e.MarkAllMaterialsAsDirty(1))}}A._DiffuseTextureEnabled=!0,A._BaseWeightTextureEnabled=!0,A._BaseDiffuseRoughnessTextureEnabled=!0,A._DetailTextureEnabled=!0,A._DecalMapEnabled=!0,A._AmbientTextureEnabled=!0,A._OpacityTextureEnabled=!0,A._ReflectionTextureEnabled=!0,A._EmissiveTextureEnabled=!0,A._SpecularTextureEnabled=!0,A._BumpTextureEnabled=!0,A._LightmapTextureEnabled=!0,A._RefractionTextureEnabled=!0,A._ColorGradingTextureEnabled=!0,A._FresnelEnabled=!0,A._ClearCoatTextureEnabled=!0,A._ClearCoatBumpTextureEnabled=!0,A._ClearCoatTintTextureEnabled=!0,A._SheenTextureEnabled=!0,A._AnisotropicTextureEnabled=!0,A._ThicknessTextureEnabled=!0,A._RefractionIntensityTextureEnabled=!0,A._TranslucencyIntensityTextureEnabled=!0,A._TranslucencyColorTextureEnabled=!0,A._IridescenceTextureEnabled=!0},12251:(U,M,b)=>{"use strict";b.d(M,{c:()=>H});var a,A=b(670);!function(U){U[U.Zero=0]="Zero",U[U.One=1]="One",U[U.MaxViewZ=2]="MaxViewZ"}(a||(a={}));class H{static CreateConfiguration(U){return H._Configurations[U]={defines:{},previousWorldMatrices:{},previousViewProjection:A.b.Zero(),currentViewProjection:A.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},H._Configurations[U]}static DeleteConfiguration(U){delete H._Configurations[U]}static GetConfiguration(U){return H._Configurations[U]}static AddUniformsAndSamplers(U,M){U.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(U,M){for(const b of M)if(b.xk)for(const M of b.xk)M._removeDrawWrapper(U)}static PrepareDefines(U,M,b){if(!b._arePrePassDirty)return;const a=H._Configurations[U];if(!a)return;b.PREPASS=!0,b.PREPASS_COLOR=!1,b.PREPASS_COLOR_INDEX=-1;let A=0;for(let W=0;W<H.GeometryTextureDescriptions.length;W++){const U=H.GeometryTextureDescriptions[W],M=U.define,y=U.defineIndex,O=a.defines[y];void 0!==O?(b[M]=!0,b[y]=O,A++):(b[M]=!1,delete b[y])}b.SCENE_MRT_COUNT=A,b.BONES_VELOCITY_ENABLED=M.useBones&&M.computeBonesUsingShaders&&M.skeleton&&!M.skeleton.isUsingTextureForMatrices&&-1===a.excludedSkinnedMesh.indexOf(M)}static Bind(U,M,b,a,A){const W=H._Configurations[U];if(!W)return;const y=b.va(),O=y.getEngine();if(W.reverseCulling&&O.setStateCullFaceType(y._mirroredCameraPosition?A.cullBackFaces:!A.cullBackFaces),(void 0!==W.defines.PREPASS_VELOCITY_INDEX||void 0!==W.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(W.previousWorldMatrices[b.uniqueId]||(W.previousWorldMatrices[b.uniqueId]=a.clone()),W.previousViewProjection||(W.previousViewProjection=y.getTransformMatrix().clone(),W.currentViewProjection=y.getTransformMatrix().clone()),W.currentViewProjection.updateFlag!==y.getTransformMatrix().updateFlag?(W.lastUpdateFrameId=O.frameId,W.previousViewProjection.p(W.currentViewProjection),W.currentViewProjection.p(y.getTransformMatrix())):W.lastUpdateFrameId!==O.frameId&&(W.lastUpdateFrameId=O.frameId,W.previousViewProjection.p(W.currentViewProjection)),M.setMatrix("previousWorld",W.previousWorldMatrices[b.uniqueId]),M.setMatrix("previousViewProjection",W.previousViewProjection),W.previousWorldMatrices[b.uniqueId]=a.clone(),b.useBones&&b.computeBonesUsingShaders&&b.skeleton)){const U=b.skeleton;if(!U.isUsingTextureForMatrices||-1===M.getUniformIndex("boneTextureWidth")){const a=U.getTransformMatrices(b);a&&(W.previousBones[b.uniqueId]||(W.previousBones[b.uniqueId]=a.slice()),M.setMatrices("mPreviousBones",W.previousBones[b.uniqueId]),W.previousBones[b.uniqueId].set(a))}}}}H.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],H._Configurations={}},12243:(U,M,b)=>{"use strict";b.d(M,{b:()=>F});var a=b(645),A=b(652),H=b(811),W=b(524),y=b(552),O=b(572);const e=new RegExp("^([gimus]+)!");class x{constructor(U){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=U,this._scene=U.va(),this._engine=this._scene.getEngine()}_addPlugin(U){for(let a=0;a<this._plugins.length;++a)if(this._plugins[a].name===U.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!U.isCompatible(this._material.shaderLanguage))throw`The plugin "${U.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const M=U.getClassName();x._MaterialPluginClassToMainDefine[M]||(x._MaterialPluginClassToMainDefine[M]="MATERIALPLUGIN_"+ ++x._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(U,M)=>this._handlePluginEvent(U,M),this._plugins.push(U),this._plugins.sort(((U,M)=>U.priority-M.priority)),this._codeInjectionPoints={};const b={};b[x._MaterialPluginClassToMainDefine[M]]={type:"boolean",default:!0};for(const a of this._plugins)a.collectDefines(b),this._collectPointNames("vertex",a.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",a.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=b,!0}_activatePlugin(U){-1===this._activePlugins.indexOf(U)&&(this._activePlugins.push(U),this._activePlugins.sort(((U,M)=>U.priority-M.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),U.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(U),this._activePluginsForExtraEvents.sort(((U,M)=>U.priority-M.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(U){for(let M=0;M<this._plugins.length;++M)if(this._plugins[M].name===U)return this._plugins[M];return null}_handlePluginEventIsReadyForSubMesh(U){let M=!0;for(const b of this._activePlugins)M=M&&b.isReadyForSubMesh(U.defines,this._scene,this._engine,U.subMesh);U.isReadyForSubMesh=M}_handlePluginEventPrepareDefinesBeforeAttributes(U){for(const M of this._activePlugins)M.prepareDefinesBeforeAttributes(U.defines,this._scene,U.mesh)}_handlePluginEventPrepareDefines(U){for(const M of this._activePlugins)M.prepareDefines(U.defines,this._scene,U.mesh)}_handlePluginEventHardBindForSubMesh(U){for(const M of this._activePluginsForExtraEvents)M.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,U.subMesh)}_handlePluginEventBindForSubMesh(U){for(const M of this._activePlugins)M.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,U.subMesh)}_handlePluginEventHasRenderTargetTextures(U){let M=!1;for(const b of this._activePluginsForExtraEvents)if(M=b.hasRenderTargetTextures(),M)break;U.hasRenderTargetTextures=M}_handlePluginEventFillRenderTargetTextures(U){for(const M of this._activePluginsForExtraEvents)M.fillRenderTargetTextures(U.renderTargets)}_handlePluginEvent(U,M){switch(U){case 512:{const U=M;for(const M of this._activePlugins)M.getActiveTextures(U.activeTextures);break}case 256:{const U=M;for(const M of this._activePlugins)M.getAnimatables(U.animatables);break}case 1024:{const U=M;let b=!1;for(const M of this._activePlugins)if(b=M.hasTexture(U.texture),b)break;U.hasTexture=b;break}case 2:{const U=M;for(const M of this._plugins)M.dispose(U.forceDisposeTextures);break}case 4:M.defineNames=this._defineNamesFromPlugins;break;case 128:{const U=M;for(const M of this._activePlugins)U.fallbackRank=M.addFallbacks(U.defines,U.fallbacks,U.fallbackRank),M.getAttributes(U.attributes,this._scene,U.mesh);this._uniformList.length>0&&U.uniforms.push(...this._uniformList),this._samplerList.length>0&&U.samplers.push(...this._samplerList),this._uboList.length>0&&U.uniformBuffersNames.push(...this._uboList),U.customCode=this._injectCustomCode(U,U.customCode);break}case 8:{const U=M;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const b=1===this._material.shaderLanguage;for(const M of this._plugins){const a=M.getUniforms(this._material.shaderLanguage);if(a){if(a.ubo)for(const M of a.ubo){if(M.size&&M.type){const a=M.arraySize??0;if(U.ubo.addUniform(M.name,M.size,a),b){let U;switch(M.type){case"mat4":U="mat4x4f";break;case"float":U="f32";break;default:U=`${M.type}f`}this._uboDeclaration+=a>0?`uniform ${M.name}: array<${U}, ${a}>;\n`:`uniform ${M.name}: ${U};\n`}else this._uboDeclaration+=`${M.type} ${M.name}${a>0?`[${a}]`:""};\n`}this._uniformList.push(M.name)}a.vertex&&(this._vertexDeclaration+=a.vertex+"\n"),a.fragment&&(this._fragmentDeclaration+=a.fragment+"\n")}M.getSamplers(this._samplerList),M.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(U,M){if(M)for(const b in M)this._codeInjectionPoints[U]||(this._codeInjectionPoints[U]={}),this._codeInjectionPoints[U][b]=!0}_injectCustomCode(U,M){return(b,a)=>{var A;M&&(a=M(b,a)),this._uboDeclaration&&(a=a.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(a=a.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(a=a.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const H=null===(A=this._codeInjectionPoints)||void 0===A?void 0:A[b];if(!H)return a;let W=null;for(let M in H){let A="";for(const a of this._activePlugins){var x;let H=null===(x=a.getCustomCode(b,this._material.shaderLanguage))||void 0===x?void 0:x[M];if(H){if(a.resolveIncludes){if(null===W){const M=0;W={defines:[],indexParameters:U.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:O.c.GetShadersRepository(M),includesShadersStore:O.c.GetIncludesShadersStore(M),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}W.isFragment="fragment"===b,(0,y.j)(H,W,(U=>H=U))}A+=H+"\n"}}if(A.length>0)if("!"===M.charAt(0)){M=M.substring(1);let U="g";if("!"===M.charAt(0))U="",M=M.substring(1);else{const b=e.exec(M);b&&b.length>=2&&(U=b[1],M=M.substring(U.length+1))}U.indexOf("g")<0&&(U+="g");const b=a,H=new RegExp(M,U);let W=H.exec(b);for(;null!==W;){let U=A;for(let M=0;M<W.length;++M)U=U.replace("$"+M,W[M]);a=a.replace(W[0],U),W=H.exec(b)}}else{const U="#define "+M;a=a.replace(U,"\n"+A+"\n"+U)}}return a}}}x._MaterialPluginClassToMainDefine={},x._MaterialPluginCounter=0,W.d.OnEnginesDisposedObservable.add((()=>{r()}));const P=[];let Z=!1,C=null;function r(){P.length=0,Z=!1,H.c.OnEventObservable.remove(C),C=null}var B=b(698),J=b(609);class F{isCompatible(U){return 0===U}_enable(U){U&&this._pluginManager._activatePlugin(this)}constructor(U,M,b,a){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],W=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=U,this.name=M,this.priority=b,this.resolveIncludes=W,U.pluginManager||(U.pluginManager=new x(U),U.rk.add((()=>{U.pluginManager=void 0}))),this._pluginDefineNames=a,this._pluginManager=U.pluginManager,A&&this._pluginManager._addPlugin(this),H&&this._enable(!0),this.markAllDefinesAsDirty=U._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(U,M,b,a){return!0}hardBindForSubMesh(U,M,b,a){}bindForSubMesh(U,M,b,a){}dispose(U){}getCustomCode(U){return null}collectDefines(U){if(this._pluginDefineNames)for(const M of Object.keys(this._pluginDefineNames)){if("_"===M[0])continue;const b=typeof this._pluginDefineNames[M];U[M]={type:"number"===b?"number":"string"===b?"string":"boolean"===b?"boolean":"object",default:this._pluginDefineNames[M]}}}prepareDefinesBeforeAttributes(U,M,b){}prepareDefines(U,M,b){}hasTexture(U){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(U){}getActiveTextures(U){}getAnimatables(U){}addFallbacks(U,M,b){return b}getSamplers(U){}getAttributes(U,M,b){}getUniformBuffersNames(U){}getUniforms(){return{}}copyTo(U){B.d.Clone((()=>U),this)}serialize(){return B.d.Serialize(this)}parse(U,M,b){B.d.Parse((()=>this),U,M,b)}}(0,a.c)([(0,A.J)()],F.prototype,"name",void 0),(0,a.c)([(0,A.J)()],F.prototype,"priority",void 0),(0,a.c)([(0,A.J)()],F.prototype,"resolveIncludes",void 0),(0,a.c)([(0,A.J)()],F.prototype,"registerForExtraEvents",void 0),(0,J.i)("BABYLON.MaterialPluginBase",F)},12207:(U,M,b)=>{"use strict";b.d(M,{c:()=>a});class a{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(U){U.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(U){}bindForSubMesh(U,M,b,a,A){if(M.prePassRenderer&&M.prePassRenderer.enabled&&M.prePassRenderer.currentRTisSceneRT&&(-1!==M.prePassRenderer.getIndex(2)||-1!==M.prePassRenderer.getIndex(11))){this.previousWorldMatrices[b.uniqueId]||(this.previousWorldMatrices[b.uniqueId]=a.clone()),this.previousViewProjection||(this.previousViewProjection=M.getTransformMatrix().clone(),this.currentViewProjection=M.getTransformMatrix().clone());const A=M.getEngine();this.currentViewProjection.updateFlag!==M.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=A.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(M.getTransformMatrix())):this._lastUpdateFrameId!==A.frameId&&(this._lastUpdateFrameId=A.frameId,this.previousViewProjection.p(this.currentViewProjection)),U.setMatrix("previousWorld",this.previousWorldMatrices[b.uniqueId]),U.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[b.uniqueId]=a.clone()}}}},12220:(U,M,b)=>{"use strict";b.d(M,{b:()=>H});var a=b(670),A=b(811);class H extends A.c{constructor(U,M){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(U,M,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new a.b,this._storeEffectOnSubMeshes=b}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(U,M){return!!U&&(!this._storeEffectOnSubMeshes||(!U.xk||0===U.xk.length||this.isReadyForSubMesh(U,U.xk[0],M)))}_isReadyForSubMesh(U){const M=U.materialDefines;return!(this.checkReadyOnEveryCall||!U.effect||!M||M._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(U){this._activeEffect.setMatrix("world",U)}bindOnlyNormalMatrix(U){this._activeEffect.setMatrix("normalMatrix",U)}bind(U,M){M&&this.bindForSubMesh(U,M,M.xk[0])}_afterBind(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;super._afterBind(U,M,b),this.va()._cachedEffect=M,b?b._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return b._drawWrapper._forceRebindOnNextCall||U.isCachedMaterialInvalid(this,M,a)}dispose(U,M,b){this._activeEffect=void 0,super.dispose(U,M,b)}}},12205:(U,M,b)=>{"use strict";b.d(M,{e:()=>Y});var a=b(645),A=b(652),H=b(661),W=b(2492),y=b(707),O=b(729),e=b(12207),x=b(2499),P=b(811),Z=b(12213),C=b(12220),r=b(2371),B=b(609),J=b(12227),F=b(12233),f=b(12239),L=b(823),z=b(816),o=b(698),S=b(12251);const h={effect:null,subMesh:null};class i extends Z.d{constructor(U){super(U),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(U){const M=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const b of M)this[b]=b===U}}class Y extends C.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(U){this._attachImageProcessingConfiguration(U),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(U){U!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=U||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(U){this.imageProcessingConfiguration.colorCurvesEnabled=U}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(U){this.imageProcessingConfiguration.colorGradingEnabled=U}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(U){this._imageProcessingConfiguration.toneMappingEnabled=U}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(U){this._imageProcessingConfiguration.exposure=U}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(U){this._imageProcessingConfiguration.contrast=U}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(U){this._imageProcessingConfiguration.colorGradingTexture=U}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(U){this._imageProcessingConfiguration.colorCurves=U}get canRenderToMRT(){return!0}constructor(U,M){super(U,M,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||Y.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new y.c(0,0,0),this.diffuseColor=new y.c(1,1,1),this.specularColor=new y.c(1,1,1),this.emissiveColor=new y.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new H.h(16),this._globalAmbientColor=new y.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new f.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new e.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),Y.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),Y.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(Y.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(Y.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"cb"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===P.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Ei&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==P.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Ei||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(U,M){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const A=M._drawWrapper;if(A.effect&&this.isFrozen&&A._wasPreviouslyReady&&A._wasPreviouslyUsingInstances===a)return!0;M.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),M.materialDefines=new i(this._eventInfo.defineNames));const H=this.va(),W=M.materialDefines;if(this._isReadyForSubMesh(M))return!0;const y=H.getEngine();W._needNormals=(0,z.ab)(H,U,W,!0,this._maxSimultaneousLights,this._disableLighting),(0,z.hb)(H,W);const P=this.needAlphaBlendingForMesh(U)&&this.va().useOrderIndependentTransparency;if((0,z.nb)(H,W,this.canRenderToMRT&&!P),(0,z.kb)(H,W,P),S.c.PrepareDefines(y.currentRenderPassId,U,W),W._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,W._needUVs=!1;for(let U=1;U<=6;++U)W["MAINUV"+U]=!1;if(H.texturesEnabled){if(W.DIFFUSEDIRECTUV=0,W.BUMPDIRECTUV=0,W.AMBIENTDIRECTUV=0,W.OPACITYDIRECTUV=0,W.EMISSIVEDIRECTUV=0,W.SPECULARDIRECTUV=0,W.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&Y.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,z.db)(this._diffuseTexture,W,"DIFFUSE")}else W.DIFFUSE=!1;if(this._ambientTexture&&Y.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,z.db)(this._ambientTexture,W,"AMBIENT")}else W.AMBIENT=!1;if(this._opacityTexture&&Y.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,z.db)(this._opacityTexture,W,"OPACITY"),W.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else W.OPACITY=!1;if(this._reflectionTexture&&Y.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(W._needNormals=!0,W.REFLECTION=!0,W.ROUGHNESS=this._roughness>0,W.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,W.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===r.e.INVCUBIC_MODE,W.REFLECTIONMAP_3D=this._reflectionTexture.isCube,W.REFLECTIONMAP_OPPOSITEZ=W.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,W.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case r.e.EXPLICIT_MODE:W.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case r.e.PLANAR_MODE:W.setReflectionMode("REFLECTIONMAP_PLANAR");break;case r.e.PROJECTION_MODE:W.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case r.e.SKYBOX_MODE:W.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case r.e.SPHERICAL_MODE:W.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case r.e.EQUIRECTANGULAR_MODE:W.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case r.e.FIXED_EQUIRECTANGULAR_MODE:W.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case r.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:W.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case r.e.CUBIC_MODE:case r.e.INVCUBIC_MODE:default:W.setReflectionMode("REFLECTIONMAP_CUBIC")}W.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else W.REFLECTION=!1,W.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&Y.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,z.db)(this._emissiveTexture,W,"EMISSIVE")}else W.EMISSIVE=!1;if(this._lightmapTexture&&Y.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,z.db)(this._lightmapTexture,W,"LIGHTMAP"),W.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,W.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else W.LIGHTMAP=!1;if(this._specularTexture&&Y.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,z.db)(this._specularTexture,W,"SPECULAR"),W.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else W.SPECULAR=!1;if(H.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Y.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,z.db)(this._bumpTexture,W,"BUMP"),W.PARALLAX=this._useParallax,W.PARALLAX_RHS=H.useRightHandedSystem,W.PARALLAXOCCLUSION=this._useParallaxOcclusion,W.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else W.BUMP=!1,W.PARALLAX=!1,W.PARALLAX_RHS=!1,W.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&Y.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;W._needUVs=!0,W.REFRACTION=!0,W.REFRACTIONMAP_3D=this._refractionTexture.isCube,W.RGBDREFRACTION=this._refractionTexture.isRGBD,W.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else W.REFRACTION=!1;W.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else W.DIFFUSE=!1,W.AMBIENT=!1,W.OPACITY=!1,W.REFLECTION=!1,W.EMISSIVE=!1,W.LIGHTMAP=!1,W.BUMP=!1,W.REFRACTION=!1;W.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),W.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,W.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,W.SPECULAROVERALPHA=this._useSpecularOverAlpha,W.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,W.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,W.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(U)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=W,this._eventInfo.subMesh=M,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(W._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(W),W.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,W.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(W._areFresnelDirty&&(Y.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(W.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,W.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,W.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,W.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,W.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,W.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,W._needNormals=!0,W.FRESNEL=!0):W.FRESNEL=!1),W.AREALIGHTUSED)for(let b=0;b<U.lightSources.length;b++)if(!U.lightSources[b]._isReady())return!1;(0,z.fb)(U,H,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(U),W,this._applyDecalMapAfterDetailMap),(0,z.Y)(H,y,this,W,a,null,M.getRenderingMesh().hasThinInstances),this._eventInfo.defines=W,this._eventInfo.mesh=U,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,z.W)(U,W,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let Z=!1;if(W.isDirty){const a=W._areLightsDisposed;W.markAsProcessed();const A=new F.e;W.REFLECTION&&A.addFallback(0,"REFLECTION"),W.SPECULAR&&A.addFallback(0,"SPECULAR"),W.BUMP&&A.addFallback(0,"BUMP"),W.PARALLAX&&A.addFallback(1,"PARALLAX"),W.PARALLAX_RHS&&A.addFallback(1,"PARALLAX_RHS"),W.PARALLAXOCCLUSION&&A.addFallback(0,"PARALLAXOCCLUSION"),W.SPECULAROVERALPHA&&A.addFallback(0,"SPECULAROVERALPHA"),W.FOG&&A.addFallback(1,"FOG"),W.POINTSIZE&&A.addFallback(0,"POINTSIZE"),W.LOGARITHMICDEPTH&&A.addFallback(0,"LOGARITHMICDEPTH"),(0,z.E)(W,A,this._maxSimultaneousLights),W.SPECULARTERM&&A.addFallback(0,"SPECULARTERM"),W.DIFFUSEFRESNEL&&A.addFallback(1,"DIFFUSEFRESNEL"),W.OPACITYFRESNEL&&A.addFallback(2,"OPACITYFRESNEL"),W.REFLECTIONFRESNEL&&A.addFallback(3,"REFLECTIONFRESNEL"),W.EMISSIVEFRESNEL&&A.addFallback(4,"EMISSIVEFRESNEL"),W.FRESNEL&&A.addFallback(4,"FRESNEL"),W.MULTIVIEW&&A.addFallback(0,"MULTIVIEW");const P=[O.e.PositionKind];W.NORMAL&&P.push(O.e.NormalKind),W.TANGENT&&P.push(O.e.TangentKind);for(let U=1;U<=6;++U)W["UV"+U]&&P.push(`uv${1===U?"":U}`);W.VERTEXCOLOR&&P.push(O.e.ColorKind),(0,z.M)(P,U,W,A),(0,z.O)(P,W),(0,z.S)(P,U,W),(0,z.I)(P,U,W);let C="default";const r=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],B=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],J=["Material","Scene","Mesh"],f={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:W.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=A,this._eventInfo.fallbackRank=0,this._eventInfo.defines=W,this._eventInfo.uniforms=r,this._eventInfo.attributes=P,this._eventInfo.samplers=B,this._eventInfo.uniformBuffersNames=J,this._eventInfo.customCode=void 0,this._eventInfo.mesh=U,this._eventInfo.indexParameters=f,this._callbackPluginEventGeneric(128,this._eventInfo),S.c.AddUniformsAndSamplers(r,B),e.c.AddUniforms(r),e.c.AddSamplers(B),x.c&&(x.c.PrepareUniforms(r,W),x.c.PrepareSamplers(B,W)),(0,z.pb)({uniformsNames:r,uniformBuffersNames:J,samplers:B,defines:W,maxSimultaneousLights:this._maxSimultaneousLights}),(0,L.e)(r);const o={};this.customShaderNameResolve&&(C=this.customShaderNameResolve(C,r,J,B,W,P,o));const i=W.toString(),Y=M.effect;let d=H.getEngine().createEffect(C,{attributes:P,uniformsNames:r,uniformBuffersNames:J,samplers:B,defines:i,fallbacks:A,onCompiled:this.onCompiled,onError:this.onError,indexParameters:f,processFinalCode:o.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:W.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([b.e(41),b.e(39)]).then(b.bind(b,13406)),Promise.all([b.e(42),b.e(40)]).then(b.bind(b,13540))]):await Promise.all([Promise.all([b.e(45),b.e(44)]).then(b.bind(b,13632)),Promise.all([b.e(47),b.e(46)]).then(b.bind(b,13803))]),this._shadersLoaded=!0}},y);if(this._eventInfo.customCode=void 0,d)if(this._onEffectCreatedObservable&&(h.effect=d,h.subMesh=M,this._onEffectCreatedObservable.notifyObservers(h)),this.allowShaderHotSwapping&&Y&&!d.isReady()){if(d=Y,W.markAsUnprocessed(),Z=this.isFrozen,a)return W._areLightsDisposed=!0,!1}else H.resetCachedMaterial(),M.setEffect(d,W,this._materialContext)}return!(!M.effect||!M.effect.isReady())&&(W._renderId=H.getRenderId(),A._wasPreviouslyReady=!Z,A._wasPreviouslyUsingInstances=a,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const U=this._uniformBuffer;U.addUniform("diffuseLeftColor",4),U.addUniform("diffuseRightColor",4),U.addUniform("opacityParts",4),U.addUniform("reflectionLeftColor",4),U.addUniform("reflectionRightColor",4),U.addUniform("refractionLeftColor",4),U.addUniform("refractionRightColor",4),U.addUniform("emissiveLeftColor",4),U.addUniform("emissiveRightColor",4),U.addUniform("vDiffuseInfos",2),U.addUniform("vAmbientInfos",2),U.addUniform("vOpacityInfos",2),U.addUniform("vReflectionInfos",2),U.addUniform("vReflectionPosition",3),U.addUniform("vReflectionSize",3),U.addUniform("vEmissiveInfos",2),U.addUniform("vLightmapInfos",2),U.addUniform("vSpecularInfos",2),U.addUniform("vBumpInfos",3),U.addUniform("diffuseMatrix",16),U.addUniform("ambientMatrix",16),U.addUniform("opacityMatrix",16),U.addUniform("reflectionMatrix",16),U.addUniform("emissiveMatrix",16),U.addUniform("lightmapMatrix",16),U.addUniform("specularMatrix",16),U.addUniform("bumpMatrix",16),U.addUniform("vTangentSpaceParams",2),U.addUniform("pointSize",1),U.addUniform("alphaCutOff",1),U.addUniform("refractionMatrix",16),U.addUniform("vRefractionInfos",4),U.addUniform("vRefractionPosition",3),U.addUniform("vRefractionSize",3),U.addUniform("vSpecularColor",4),U.addUniform("vEmissiveColor",3),U.addUniform("vDiffuseColor",4),U.addUniform("vAmbientColor",3),U.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(U,M,b){const a=this.va(),A=b.materialDefines;if(!A)return;const H=b.effect;if(!H)return;this._activeEffect=H,M.getMeshUniformBuffer().bindToEffect(H,"Mesh"),M.transferToEffect(U),this._uniformBuffer.bindToEffect(H,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,M,U,this.isFrozen),S.c.Bind(a.getEngine().currentRenderPassId,this._activeEffect,M,U,this);const O=a.activeCamera;O?this._uniformBuffer.updateFloat4("cameraInfo",O.ek,O.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=b,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),A.OBJECTSPACE_NORMALMAP&&(U.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const e=this._mustRebind(a,H,b,M.visibility);(0,z.d)(M,H);const x=this._uniformBuffer;if(e){if(this.bindViewProjection(H),!x.useUbo||!this.isFrozen||!x.isSync||b._drawWrapper._forceRebindOnNextCall){if(Y.FresnelEnabled&&A.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(x.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),x.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&x.updateColor4("opacityParts",new y.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(x.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),x.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(x.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),x.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(x.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),x.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&Y.DiffuseTextureEnabled&&(x.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,z.A)(this._diffuseTexture,x,"diffuse")),this._ambientTexture&&Y.AmbientTextureEnabled&&(x.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,z.A)(this._ambientTexture,x,"ambient")),this._opacityTexture&&Y.OpacityTextureEnabled&&(x.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,z.A)(this._opacityTexture,x,"opacity")),this._hasAlphaChannel()&&x.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&Y.ReflectionTextureEnabled){if(x.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),x.zk("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const U=this._reflectionTexture;x.updateVector3("vReflectionPosition",U.boundingBoxPosition),x.updateVector3("vReflectionSize",U.boundingBoxSize)}}else x.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&Y.EmissiveTextureEnabled&&(x.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,z.A)(this._emissiveTexture,x,"emissive")),this._lightmapTexture&&Y.LightmapTextureEnabled&&(x.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,z.A)(this._lightmapTexture,x,"lightmap")),this._specularTexture&&Y.SpecularTextureEnabled&&(x.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,z.A)(this._specularTexture,x,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&Y.BumpTextureEnabled&&(x.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,z.A)(this._bumpTexture,x,"bump"),a._mirroredCameraPosition?x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):x.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&Y.RefractionTextureEnabled){let U=1;if(this._refractionTexture.isCube||(x.zk("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(U=this._refractionTexture.depth)),x.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,U,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const U=this._refractionTexture;x.updateVector3("vRefractionPosition",U.boundingBoxPosition),x.updateVector3("vRefractionSize",U.boundingBoxSize)}}}this.pointsCloud&&x.updateFloat("pointSize",this.pointSize),x.updateColor4("vSpecularColor",this.specularColor,this.specularPower),x.updateColor3("vEmissiveColor",Y.EmissiveTextureEnabled?this.emissiveColor:y.c.BlackReadOnly),x.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),x.updateColor3("vAmbientColor",this._globalAmbientColor)}a.texturesEnabled&&(this._diffuseTexture&&Y.DiffuseTextureEnabled&&H.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&Y.AmbientTextureEnabled&&H.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Y.OpacityTextureEnabled&&H.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&Y.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?H.setTexture("reflectionCubeSampler",this._reflectionTexture):H.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&Y.EmissiveTextureEnabled&&H.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Y.LightmapTextureEnabled&&H.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&Y.SpecularTextureEnabled&&H.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&Y.BumpTextureEnabled&&H.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&Y.RefractionTextureEnabled&&(this._refractionTexture.isCube?H.setTexture("refractionCubeSampler",this._refractionTexture):H.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(M)&&this.va().depthPeelingRenderer.bind(H),this._eventInfo.subMesh=b,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,L.f)(H,this,a),this.bindEyePosition(H)}else a.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(e||!this.isFrozen){var P;if(a.lightsEnabled&&!this._disableLighting&&(0,z.k)(a,M,H,A,this._maxSimultaneousLights),(a.fogEnabled&&M.applyFog&&a.fogMode!==W.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||M.receiveShadows||A.PREPASS)&&this.bindView(H),(0,z.h)(a,M,H),A.NUM_MORPH_INFLUENCERS&&(0,z.s)(M,H),A.BAKED_VERTEX_ANIMATION_TEXTURE)null===(P=M.bakedVertexAnimationManager)||void 0===P||P.bind(H,A.INSTANCES);this.useLogarithmicDepth&&(0,z.o)(A,H,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(M,this._activeEffect,b),x.update()}getAnimatables(){const U=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&U.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&U.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&U.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&U.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&U.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&U.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&U.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&U.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&U.push(this._refractionTexture),U}getActiveTextures(){const U=super.getActiveTextures();return this._diffuseTexture&&U.push(this._diffuseTexture),this._ambientTexture&&U.push(this._ambientTexture),this._opacityTexture&&U.push(this._opacityTexture),this._reflectionTexture&&U.push(this._reflectionTexture),this._emissiveTexture&&U.push(this._emissiveTexture),this._specularTexture&&U.push(this._specularTexture),this._bumpTexture&&U.push(this._bumpTexture),this._lightmapTexture&&U.push(this._lightmapTexture),this._refractionTexture&&U.push(this._refractionTexture),U}hasTexture(U){return!!super.hasTexture(U)||(this._diffuseTexture===U||(this._ambientTexture===U||(this._opacityTexture===U||(this._reflectionTexture===U||(this._emissiveTexture===U||(this._specularTexture===U||(this._bumpTexture===U||(this._lightmapTexture===U||this._refractionTexture===U))))))))}dispose(U,M){var b,a,A,H,W,y,O,e,x;M&&(null===(b=this._diffuseTexture)||void 0===b||b.dispose(),null===(a=this._ambientTexture)||void 0===a||a.dispose(),null===(A=this._opacityTexture)||void 0===A||A.dispose(),null===(H=this._reflectionTexture)||void 0===H||H.dispose(),null===(W=this._emissiveTexture)||void 0===W||W.dispose(),null===(y=this._specularTexture)||void 0===y||y.dispose(),null===(O=this._bumpTexture)||void 0===O||O.dispose(),null===(e=this._lightmapTexture)||void 0===e||e.dispose(),null===(x=this._refractionTexture)||void 0===x||x.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(U,M)}clone(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const a=o.d.Clone((()=>new Y(U,this.va())),this,{cloneTexturesOnlyOnce:M});return a.name=U,a.id=U,this.stencil.copyTo(a.stencil),this._clonePlugins(a,b),a}static Parse(U,M,b){const a=o.d.Parse((()=>new Y(U.name,M)),U,M,b);return U.stencil&&a.stencil.parse(U.stencil,M,b),P.c._ParsePlugins(U,a,M,b),a}static get DiffuseTextureEnabled(){return J.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(U){J.c.DiffuseTextureEnabled=U}static get DetailTextureEnabled(){return J.c.DetailTextureEnabled}static set DetailTextureEnabled(U){J.c.DetailTextureEnabled=U}static get AmbientTextureEnabled(){return J.c.AmbientTextureEnabled}static set AmbientTextureEnabled(U){J.c.AmbientTextureEnabled=U}static get OpacityTextureEnabled(){return J.c.OpacityTextureEnabled}static set OpacityTextureEnabled(U){J.c.OpacityTextureEnabled=U}static get ReflectionTextureEnabled(){return J.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(U){J.c.ReflectionTextureEnabled=U}static get EmissiveTextureEnabled(){return J.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(U){J.c.EmissiveTextureEnabled=U}static get SpecularTextureEnabled(){return J.c.SpecularTextureEnabled}static set SpecularTextureEnabled(U){J.c.SpecularTextureEnabled=U}static get BumpTextureEnabled(){return J.c.BumpTextureEnabled}static set BumpTextureEnabled(U){J.c.BumpTextureEnabled=U}static get LightmapTextureEnabled(){return J.c.LightmapTextureEnabled}static set LightmapTextureEnabled(U){J.c.LightmapTextureEnabled=U}static get RefractionTextureEnabled(){return J.c.RefractionTextureEnabled}static set RefractionTextureEnabled(U){J.c.RefractionTextureEnabled=U}static get ColorGradingTextureEnabled(){return J.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(U){J.c.ColorGradingTextureEnabled=U}static get FresnelEnabled(){return J.c.FresnelEnabled}static set FresnelEnabled(U){J.c.FresnelEnabled=U}}Y.ForceGLSL=!1,(0,a.c)([(0,A.A)("diffuseTexture")],Y.prototype,"_diffuseTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"diffuseTexture",void 0),(0,a.c)([(0,A.A)("ambientTexture")],Y.prototype,"_ambientTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientTexture",void 0),(0,a.c)([(0,A.A)("opacityTexture")],Y.prototype,"_opacityTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"opacityTexture",void 0),(0,a.c)([(0,A.A)("reflectionTexture")],Y.prototype,"_reflectionTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectionTexture",void 0),(0,a.c)([(0,A.A)("emissiveTexture")],Y.prototype,"_emissiveTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"emissiveTexture",void 0),(0,a.c)([(0,A.A)("specularTexture")],Y.prototype,"_specularTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"specularTexture",void 0),(0,a.c)([(0,A.A)("bumpTexture")],Y.prototype,"_bumpTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"bumpTexture",void 0),(0,a.c)([(0,A.A)("lightmapTexture")],Y.prototype,"_lightmapTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"lightmapTexture",void 0),(0,a.c)([(0,A.A)("refractionTexture")],Y.prototype,"_refractionTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"refractionTexture",void 0),(0,a.c)([(0,A.j)("ambient")],Y.prototype,"ambientColor",void 0),(0,a.c)([(0,A.j)("diffuse")],Y.prototype,"diffuseColor",void 0),(0,a.c)([(0,A.j)("specular")],Y.prototype,"specularColor",void 0),(0,a.c)([(0,A.j)("emissive")],Y.prototype,"emissiveColor",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"specularPower",void 0),(0,a.c)([(0,A.J)("useAlphaFromDiffuseTexture")],Y.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"useAlphaFromDiffuseTexture",void 0),(0,a.c)([(0,A.J)("useEmissiveAsIllumination")],Y.prototype,"_useEmissiveAsIllumination",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useEmissiveAsIllumination",void 0),(0,a.c)([(0,A.J)("linkEmissiveWithDiffuse")],Y.prototype,"_linkEmissiveWithDiffuse",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"linkEmissiveWithDiffuse",void 0),(0,a.c)([(0,A.J)("useSpecularOverAlpha")],Y.prototype,"_useSpecularOverAlpha",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useSpecularOverAlpha",void 0),(0,a.c)([(0,A.J)("useReflectionOverAlpha")],Y.prototype,"_useReflectionOverAlpha",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useReflectionOverAlpha",void 0),(0,a.c)([(0,A.J)("disableLighting")],Y.prototype,"_disableLighting",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"disableLighting",void 0),(0,a.c)([(0,A.J)("useObjectSpaceNormalMap")],Y.prototype,"_useObjectSpaceNormalMap",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useObjectSpaceNormalMap",void 0),(0,a.c)([(0,A.J)("useParallax")],Y.prototype,"_useParallax",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useParallax",void 0),(0,a.c)([(0,A.J)("useParallaxOcclusion")],Y.prototype,"_useParallaxOcclusion",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useParallaxOcclusion",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"parallaxScaleBias",void 0),(0,a.c)([(0,A.J)("roughness")],Y.prototype,"_roughness",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"roughness",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"indexOfRefraction",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"invertRefractionY",void 0),(0,a.c)([(0,A.J)()],Y.prototype,"alphaCutOff",void 0),(0,a.c)([(0,A.J)("useLightmapAsShadowmap")],Y.prototype,"_useLightmapAsShadowmap",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useLightmapAsShadowmap",void 0),(0,a.c)([(0,A.o)("diffuseFresnelParameters")],Y.prototype,"_diffuseFresnelParameters",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsFresnelDirty")],Y.prototype,"diffuseFresnelParameters",void 0),(0,a.c)([(0,A.o)("opacityFresnelParameters")],Y.prototype,"_opacityFresnelParameters",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],Y.prototype,"opacityFresnelParameters",void 0),(0,a.c)([(0,A.o)("reflectionFresnelParameters")],Y.prototype,"_reflectionFresnelParameters",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsFresnelDirty")],Y.prototype,"reflectionFresnelParameters",void 0),(0,a.c)([(0,A.o)("refractionFresnelParameters")],Y.prototype,"_refractionFresnelParameters",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsFresnelDirty")],Y.prototype,"refractionFresnelParameters",void 0),(0,a.c)([(0,A.o)("emissiveFresnelParameters")],Y.prototype,"_emissiveFresnelParameters",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsFresnelDirty")],Y.prototype,"emissiveFresnelParameters",void 0),(0,a.c)([(0,A.J)("useReflectionFresnelFromSpecular")],Y.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsFresnelDirty")],Y.prototype,"useReflectionFresnelFromSpecular",void 0),(0,a.c)([(0,A.J)("useGlossinessFromSpecularMapAlpha")],Y.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,a.c)([(0,A.J)("maxSimultaneousLights")],Y.prototype,"_maxSimultaneousLights",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"maxSimultaneousLights",void 0),(0,a.c)([(0,A.J)("invertNormalMapX")],Y.prototype,"_invertNormalMapX",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"invertNormalMapX",void 0),(0,a.c)([(0,A.J)("invertNormalMapY")],Y.prototype,"_invertNormalMapY",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"invertNormalMapY",void 0),(0,a.c)([(0,A.J)("twoSidedLighting")],Y.prototype,"_twoSidedLighting",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"twoSidedLighting",void 0),(0,a.c)([(0,A.J)("applyDecalMapAfterDetailMap")],Y.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,a.c)([(0,A.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"applyDecalMapAfterDetailMap",void 0),(0,B.i)("BABYLON.StandardMaterial",Y),W.b.DefaultMaterialFactory=U=>new Y("default material",U)},12418:(U,M,b)=>{"use strict";b.d(M,{c:()=>y,d:()=>O,h:()=>H,j:()=>W});var a=b(682),A=b(670);function H(U,M){return`{X: ${U.x.toFixed(M)} Y: ${U.y.toFixed(M)}}`}function W(U,M){return`{X: ${U._x.toFixed(M)} Y: ${U._y.toFixed(M)} Z: ${U._z.toFixed(M)}}`}function y(U,M){return 2*Math.acos((0,a.b)(A.e.Dot(U,M)))}function O(U,M){const b=new A.e;return function(U,M,b){const H=A.l.Cross(U,M),W=Math.acos((0,a.b)(A.l.Dot(U,M),-1,1));A.e.RotationAxisToRef(H,W,b)}(U,M,b),b}},12254:(U,M,b)=>{"use strict";b.d(M,{b:()=>e});var a=b(670),A=b(707),H=b(470),W=b(744),y=b(784);b(12262);function O(U){let M=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],H=[];let O=[];const e=U.width||U.size||1,x=U.height||U.size||1,P=U.depth||U.size||1,Z=U.wrap||!1;let C=void 0===U.topBaseAt?1:U.topBaseAt,r=void 0===U.bottomBaseAt?0:U.bottomBaseAt;C=(C+4)%4,r=(r+4)%4;let B=[2,0,3,1][C],J=[2,0,1,3][r],F=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Z){M=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],F=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let U=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],b=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const a=[17,18,19,16],A=[22,23,20,21];for(;B>0;)U.unshift(U.pop()),a.unshift(a.pop()),B--;for(;J>0;)b.unshift(b.pop()),A.unshift(A.pop()),J--;U=U.flat(),b=b.flat(),F=F.concat(U).concat(b),M.push(a[0],a[2],a[3],a[0],a[1],a[2]),M.push(A[0],A[2],A[3],A[0],A[1],A[2])}const f=[e/2,x/2,P/2];O=F.reduce(((U,M,b)=>U.concat(M*f[b%3])),[]);const L=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE,z=U.faceUV||new Array(6),o=U.faceColors,S=[];for(let W=0;W<6;W++)void 0===z[W]&&(z[W]=new a.n(0,0,1,1)),o&&void 0===o[W]&&(o[W]=new A.e(1,1,1,1));for(let a=0;a<6;a++)if(H.push(z[a].z,y.c?1-z[a].w:z[a].w),H.push(z[a].x,y.c?1-z[a].w:z[a].w),H.push(z[a].x,y.c?1-z[a].y:z[a].y),H.push(z[a].z,y.c?1-z[a].y:z[a].y),o)for(let U=0;U<4;U++)S.push(o[a].r,o[a].g,o[a].b,o[a].a);W.c._ComputeSides(L,O,M,b,H,U.frontUVs,U.backUVs);const h=new W.c;if(h.indices=M,h.xa=O,h.ya=b,h.Aa=H,o){const U=L===W.c.DOUBLESIDE?S.concat(S):S;h.za=U}return h}function e(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new H.c(U,b);M.sideOrientation=H.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return O(M).Ca(a,M.updatable),a}W.c.CreateBox=O,H.c.CreateBox=function(U,M){return e(U,{size:M,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12262:(U,M,b)=>{"use strict";b.d(M,{d:()=>J,b:()=>f,e:()=>F});var a=b(670),A=b(707),H=b(470),W=b(744),y=b(729);H.c._GroundMeshParser=(U,M)=>O.Parse(U,M);class O extends H.c{constructor(U,M){super(U,M),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=U,this._subdivisionsY=U,this.subdivide(U);const b=this;b.createOrUpdateSubmeshesOctree&&b.createOrUpdateSubmeshesOctree(M)}getHeightAtCoordinates(U,M){const b=this.getWorldMatrix(),A=a.g.Matrix[5];b.invertToRef(A);const H=a.g.lk[8];if(a.l.TransformCoordinatesFromFloatsToRef(U,0,M,A,H),U=H.x,M=H.z,U<this._minX||U>=this._maxX||M<=this._minZ||M>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const W=this._getFacetAt(U,M),y=-(W.x*U+W.z*M+W.w)/W.y;return a.l.TransformCoordinatesFromFloatsToRef(0,y,0,b,H),H.y}getNormalAtCoordinates(U,M){const b=new a.l(0,1,0);return this.getNormalAtCoordinatesToRef(U,M,b),b}getNormalAtCoordinatesToRef(U,M,b){const A=this.getWorldMatrix(),H=a.g.Matrix[5];A.invertToRef(H);const W=a.g.lk[8];if(a.l.TransformCoordinatesFromFloatsToRef(U,0,M,H,W),U=W.x,M=W.z,U<this._minX||U>this._maxX||M<this._minZ||M>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const y=this._getFacetAt(U,M);return a.l.TransformNormalFromFloatsToRef(y.x,y.y,y.z,A,b),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(U,M){const b=Math.floor((U+this._maxX)*this._subdivisionsX/this._width),a=Math.floor(-(M+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),A=this._heightQuads[a*this._subdivisionsX+b];let H;return H=M<A.slope.x*U+A.slope.y?A.facet1:A.facet2,H}_initHeightQuads(){const U=this._subdivisionsX,M=this._subdivisionsY;this._heightQuads=[];for(let b=0;b<M;b++)for(let M=0;M<U;M++){const A={slope:a.i.Zero(),facet1:new a.n(0,0,0,0),facet2:new a.n(0,0,0,0)};this._heightQuads[b*U+M]=A}return this}_computeHeightQuads(){const U=this.getVerticesData(y.e.PositionKind);if(!U)return this;const M=a.g.lk[3],b=a.g.lk[2],A=a.g.lk[1],H=a.g.lk[0],W=a.g.lk[4],O=a.g.lk[5],e=a.g.lk[6],x=a.g.lk[7],P=a.g.lk[8];let Z=0,C=0,r=0,B=0,J=0,F=0,f=0;const L=this._subdivisionsX,z=this._subdivisionsY;for(let y=0;y<z;y++)for(let z=0;z<L;z++){Z=3*z,C=y*(L+1)*3,r=(y+1)*(L+1)*3,M.x=U[C+Z],M.y=U[C+Z+1],M.z=U[C+Z+2],b.x=U[C+Z+3],b.y=U[C+Z+4],b.z=U[C+Z+5],A.x=U[r+Z],A.y=U[r+Z+1],A.z=U[r+Z+2],H.x=U[r+Z+3],H.y=U[r+Z+4],H.z=U[r+Z+5],B=(H.z-M.z)/(H.x-M.x),J=M.z-B*M.x,b.subtractToRef(M,W),A.subtractToRef(M,O),H.subtractToRef(M,e),a.l.CrossToRef(e,O,x),a.l.CrossToRef(W,e,P),x.normalize(),P.normalize(),F=-(x.x*M.x+x.y*M.y+x.z*M.z),f=-(P.x*b.x+P.y*b.y+P.z*b.z);const o=this._heightQuads[y*L+z];o.slope.vd(B,J),o.facet1.vd(x.x,x.y,x.z,F),o.facet2.vd(P.x,P.y,P.z,f)}return this}serialize(U){super.serialize(U),U.subdivisionsX=this._subdivisionsX,U.subdivisionsY=this._subdivisionsY,U.minX=this._minX,U.maxX=this._maxX,U.ek=this._minZ,U.maxZ=this._maxZ,U.width=this._width,U.height=this._height}static Parse(U,M){const b=new O(U.name,M);return b._subdivisionsX=U.subdivisionsX||1,b._subdivisionsY=U.subdivisionsY||1,b._minX=U.minX,b._maxX=U.maxX,b._minZ=U.ek,b._maxZ=U.maxZ,b._width=U.width,b._height=U.height,b}}var e=b(479),x=b(524),P=b(677),Z=b(784);function C(U){const M=[],b=[],A=[],H=[];let y,O;const e=U.width||U.size||1,x=U.height||U.size||1,P=0|(U.subdivisionsX||U.subdivisions||1),C=0|(U.subdivisionsY||U.subdivisions||1);for(y=0;y<=C;y++)for(O=0;O<=P;O++){const U=new a.l(O*e/P-e/2,0,(C-y)*x/C-x/2),M=new a.l(0,1,0);b.push(U.x,U.y,U.z),A.push(M.x,M.y,M.z),H.push(O/P,Z.c?y/C:1-y/C)}for(y=0;y<C;y++)for(O=0;O<P;O++)M.push(O+1+(y+1)*(P+1)),M.push(O+1+y*(P+1)),M.push(O+y*(P+1)),M.push(O+(y+1)*(P+1)),M.push(O+1+(y+1)*(P+1)),M.push(O+y*(P+1));const r=new W.c;return r.indices=M,r.xa=b,r.ya=A,r.Aa=H,r}function r(U){const M=void 0!==U.xmin&&null!==U.xmin?U.xmin:-1,b=void 0!==U.zmin&&null!==U.zmin?U.zmin:-1,A=void 0!==U.xmax&&null!==U.xmax?U.xmax:1,H=void 0!==U.zmax&&null!==U.zmax?U.zmax:1,y=U.subdivisions||{w:1,h:1},O=U.precision||{w:1,h:1},e=[],x=[],P=[],Z=[];let C,r,B,J;y.h=y.h<1?1:y.h,y.w=y.w<1?1:y.w,O.w=O.w<1?1:O.w,O.h=O.h<1?1:O.h;const F=(A-M)/y.w,f=(H-b)/y.h;function L(U,M,b,A){const H=x.length/3,W=O.w+1;for(C=0;C<O.h;C++)for(r=0;r<O.w;r++){const U=[H+r+C*W,H+(r+1)+C*W,H+(r+1)+(C+1)*W,H+r+(C+1)*W];e.push(U[1]),e.push(U[2]),e.push(U[3]),e.push(U[0]),e.push(U[1]),e.push(U[3])}const y=a.l.Zero(),B=new a.l(0,1,0);for(C=0;C<=O.h;C++)for(y.z=C*(A-M)/O.h+M,r=0;r<=O.w;r++)y.x=r*(b-U)/O.w+U,y.y=0,x.push(y.x,y.y,y.z),P.push(B.x,B.y,B.z),Z.push(r/O.w,C/O.h)}for(B=0;B<y.h;B++)for(J=0;J<y.w;J++)L(M+J*F,b+B*f,M+(J+1)*F,b+(B+1)*f);const z=new W.c;return z.indices=e,z.xa=x,z.ya=P,z.Aa=Z,z}function B(U){const M=[],b=[],H=[],y=[];let O,e;const x=U.colorFilter||new A.c(.3,.59,.11),Z=U.alphaFilter||0;let C=!1;if(U.minHeight>U.maxHeight){C=!0;const M=U.maxHeight;U.maxHeight=U.minHeight,U.minHeight=M}for(O=0;O<=U.subdivisions;O++)for(e=0;e<=U.subdivisions;e++){const M=new a.l(e*U.width/U.subdivisions-U.width/2,0,(U.subdivisions-O)*U.height/U.subdivisions-U.height/2),A=4*(((M.x+U.width/2)/U.width*(U.bufferWidth-1)|0)+((1-(M.z+U.height/2)/U.height)*(U.bufferHeight-1)|0)*U.bufferWidth);let W=U.buffer[A]/255,r=U.buffer[A+1]/255,B=U.buffer[A+2]/255;const J=U.buffer[A+3]/255;C&&(W=1-W,r=1-r,B=1-B);const F=W*x.r+r*x.g+B*x.b;M.y=J>=Z?U.minHeight+(U.maxHeight-U.minHeight)*F:U.minHeight-P.b,U.heightBuffer&&(U.heightBuffer[O*(U.subdivisions+1)+e]=M.y),b.push(M.x,M.y,M.z),H.push(0,0,0),y.push(e/U.subdivisions,1-O/U.subdivisions)}for(O=0;O<U.subdivisions;O++)for(e=0;e<U.subdivisions;e++){const a=e+1+(O+1)*(U.subdivisions+1),A=e+1+O*(U.subdivisions+1),H=e+O*(U.subdivisions+1),W=e+(O+1)*(U.subdivisions+1),y=b[3*a+1]>=U.minHeight,x=b[3*A+1]>=U.minHeight,P=b[3*H+1]>=U.minHeight;y&&x&&P&&(M.push(a),M.push(A),M.push(H));b[3*W+1]>=U.minHeight&&y&&P&&(M.push(W),M.push(a),M.push(H))}W.c.ComputeNormals(b,M,H);const r=new W.c;return r.indices=M,r.xa=b,r.ya=H,r.Aa=y,r}function J(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=new O(U,arguments.length>2?arguments[2]:void 0);b._setReady(!1),b._subdivisionsX=M.subdivisionsX||M.subdivisions||1,b._subdivisionsY=M.subdivisionsY||M.subdivisions||1,b._width=M.width||1,b._height=M.height||1,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;return C(M).Ca(b,M.updatable),b._setReady(!0),b}function F(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new H.c(U,b);return r(M).Ca(a,M.updatable),a}function f(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const H=b.width||10,W=b.height||10,y=b.subdivisions||1,P=b.minHeight||0,Z=b.maxHeight||1,C=b.colorFilter||new A.c(.3,.59,.11),r=b.alphaFilter||0,J=b.updatable,F=b.onReady;a=a||x.d.LastCreatedScene;const f=new O(U,a);let L;f._subdivisionsX=y,f._subdivisionsY=y,f._width=H,f._height=W,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),b.passHeightBufferInCallback&&(L=new Float32Array((y+1)*(y+1)));const z=(U,M,b)=>{B({width:H,height:W,subdivisions:y,minHeight:P,maxHeight:Z,colorFilter:C,buffer:U,bufferWidth:M,bufferHeight:b,alphaFilter:r,heightBuffer:L}).Ca(f,J),F&&F(f,L),f._setReady(!0)};if("string"===typeof M){const U=U=>{var M;const b=U.width,A=U.height;if(a.u)return;const H=null===(M=a)||void 0===M?void 0:M.getEngine().resizeImageBitmap(U,b,A);z(H,b,A)};e.d.LoadImage(M,U,b.onError?b.onError:()=>{},a.offlineProvider)}else z(M.data,M.width,M.height);return f}W.c.CreateGround=C,W.c.CreateTiledGround=r,W.c.CreateGroundFromHeightMap=B,H.c.CreateGround=(U,M,b,a,A,H)=>J(U,{width:M,height:b,subdivisions:a,updatable:H},A),H.c.CreateTiledGround=(U,M,b,a,A,H,W,y,O)=>F(U,{xmin:M,zmin:b,xmax:a,zmax:A,subdivisions:H,precision:W,updatable:O},y),H.c.CreateGroundFromHeightMap=(U,M,b,a,A,H,W,y,O,e,x)=>f(U,M,{width:b,height:a,subdivisions:A,minHeight:H,maxHeight:W,updatable:O,onReady:e,alphaFilter:x},y)},12943:(U,M,b)=>{"use strict";b.d(M,{c:()=>m,d:()=>s,e:()=>q});var a=b(670),A=b(470),H=b(744),W=b(707),y=b(729),O=b(12662),e=b(811),x=b(698),P=b(2492),Z=b(2371),C=b(609),r=b(12233),B=b(518),J=b(12220),F=b(524),f=b(823),L=b(816);const z={effect:null,subMesh:null};class o extends J.b{constructor(U,M,b){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(U,M,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new a.b,this._cachedWorldViewProjectionMatrix=new a.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=b,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","uk","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...A}}get shaderPath(){return this._shaderPath}set shaderPath(U){this._shaderPath=U}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(U){-1===this._options.uniforms.indexOf(U)&&this._options.uniforms.push(U)}setTexture(U,M){return-1===this._options.samplers.indexOf(U)&&this._options.samplers.push(U),this._textures[U]=M,this}removeTexture(U){delete this._textures[U]}setTextureArray(U,M){return-1===this._options.samplers.indexOf(U)&&this._options.samplers.push(U),this._checkUniform(U),this._textureArrays[U]=M,this}setExternalTexture(U,M){return-1===this._options.externalTextures.indexOf(U)&&this._options.externalTextures.push(U),this._externalTextures[U]=M,this}setFloat(U,M){return this._checkUniform(U),this._floats[U]=M,this}setInt(U,M){return this._checkUniform(U),this._ints[U]=M,this}setUInt(U,M){return this._checkUniform(U),this._uints[U]=M,this}setFloats(U,M){return this._checkUniform(U),this._floatsArrays[U]=M,this}setColor3(U,M){return this._checkUniform(U),this._colors3[U]=M,this}setColor3Array(U,M){return this._checkUniform(U),this._colors3Arrays[U]=M.reduce(((U,M)=>(U.push(M.r,M.g,M.b),U)),[]),this}setColor4(U,M){return this._checkUniform(U),this._colors4[U]=M,this}setColor4Array(U,M){return this._checkUniform(U),this._colors4Arrays[U]=M.reduce(((U,M)=>(U.push(M.r,M.g,M.b,M.a),U)),[]),this}setVector2(U,M){return this._checkUniform(U),this._vectors2[U]=M,this}setVector3(U,M){return this._checkUniform(U),this._vectors3[U]=M,this}setVector4(U,M){return this._checkUniform(U),this._vectors4[U]=M,this}setQuaternion(U,M){return this._checkUniform(U),this._quaternions[U]=M,this}setQuaternionArray(U,M){return this._checkUniform(U),this._quaternionsArrays[U]=M.reduce(((U,M)=>(M.toArray(U,U.length),U)),[]),this}setMatrix(U,M){return this._checkUniform(U),this._matrices[U]=M,this}setMatrices(U,M){this._checkUniform(U);const b=new Float32Array(16*M.length);for(let a=0;a<M.length;a++){M[a].copyToArray(b,16*a)}return this._matrixArrays[U]=b,this}setMatrix3x3(U,M){return this._checkUniform(U),this._matrices3x3[U]=M,this}setMatrix2x2(U,M){return this._checkUniform(U),this._matrices2x2[U]=M,this}setArray2(U,M){return this._checkUniform(U),this._vectors2Arrays[U]=M,this}setArray3(U,M){return this._checkUniform(U),this._vectors3Arrays[U]=M,this}setArray4(U,M){return this._checkUniform(U),this._vectors4Arrays[U]=M,this}setUniformBuffer(U,M){return-1===this._options.uniformBuffers.indexOf(U)&&this._options.uniformBuffers.push(U),this._uniformBuffers[U]=M,this}setTextureSampler(U,M){return-1===this._options.samplerObjects.indexOf(U)&&this._options.samplerObjects.push(U),this._textureSamplers[U]=M,this}setStorageBuffer(U,M){return-1===this._options.storageBuffers.indexOf(U)&&this._options.storageBuffers.push(U),this._storageBuffers[U]=M,this}setDefine(U,M){const b=U.trimEnd()+" ",a=this.options.defines.findIndex((M=>M===U||M.startsWith(b)));return a>=0&&this.options.defines.splice(a,1),("boolean"!==typeof M||M)&&this.options.defines.push(b+M),this}isReadyForSubMesh(U,M,b){return this.isReady(U,b,M)}isReady(U,M,b){var a;const A=b&&this._storeEffectOnSubMeshes;if(this.isFrozen){const U=A?b._drawWrapper:this._drawWrapper;if(U.effect&&U._wasPreviouslyReady&&U._wasPreviouslyUsingInstances===M)return!0}const H=this.va(),W=H.getEngine(),O=[],e=[];let x=null,Z=this._shaderPath,C=this._options.uniforms,B=this._options.uniformBuffers,J=this._options.samplers;W.getCaps().multiview&&H.activeCamera&&H.activeCamera.outputRenderTarget&&H.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,O.push("#define MULTIVIEW"),-1!==C.indexOf("viewProjection")&&-1===C.indexOf("viewProjectionR")&&C.push("viewProjectionR"));for(let y=0;y<this._options.defines.length;y++){const U=0===this._options.defines[y].indexOf("#define")?this._options.defines[y]:`#define ${this._options.defines[y]}`;O.push(U)}for(let y=0;y<this._options.attributes.length;y++)e.push(this._options.attributes[y]);if(U&&U.isVerticesDataPresent(y.e.ColorKind)&&(-1===e.indexOf(y.e.ColorKind)&&e.push(y.e.ColorKind),O.push("#define VERTEXCOLOR")),M&&(O.push("#define INSTANCES"),(0,L.sb)(e,this._materialHelperNeedsPreviousMatrices),null!==U&&void 0!==U&&U.hasThinInstances&&(O.push("#define THIN_INSTANCES"),U&&U.isVerticesDataPresent(y.e.ColorInstanceKind)&&(e.push(y.e.ColorInstanceKind),O.push("#define INSTANCESCOLOR")))),U&&U.useBones&&U.computeBonesUsingShaders&&U.skeleton){e.push(y.e.MatricesIndicesKind),e.push(y.e.MatricesWeightsKind),U.numBoneInfluencers>4&&(e.push(y.e.MatricesIndicesExtraKind),e.push(y.e.MatricesWeightsExtraKind));const M=U.skeleton;O.push("#define NUM_BONE_INFLUENCERS "+U.numBoneInfluencers),x=new r.e,x.addCPUSkinningFallback(0,U),M.isUsingTextureForMatrices?(O.push("#define BONETEXTURE"),-1===C.indexOf("boneTextureWidth")&&C.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(O.push("#define BonesPerMesh "+(M.bones.length+1)),-1===C.indexOf("mBones")&&C.push("mBones"))}else O.push("#define NUM_BONE_INFLUENCERS 0");let F=0;const o=U?U.morphTargetManager:null;if(o){const M=-1!==O.indexOf("#define UV1"),b=-1!==O.indexOf("#define UV2"),a=-1!==O.indexOf("#define TANGENT"),A=-1!==O.indexOf("#define NORMAL"),H=-1!==O.indexOf("#define VERTEXCOLOR");F=(0,L.T)(o,O,e,U,!0,A,a,M,b,H),o.isUsingTextureForTargets&&(-1===C.indexOf("morphTargetTextureIndices")&&C.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),F>0&&(C=C.slice(),C.push("morphTargetInfluences"),C.push("morphTargetCount"),C.push("morphTargetTextureInfo"),C.push("morphTargetTextureIndices"))}else O.push("#define NUM_MORPH_INFLUENCERS 0");if(U){const M=U.bakedVertexAnimationManager;M&&M.isEnabled&&(O.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===C.indexOf("bakedVertexAnimationSettings")&&C.push("bakedVertexAnimationSettings"),-1===C.indexOf("bakedVertexAnimationTextureSizeInverted")&&C.push("bakedVertexAnimationTextureSizeInverted"),-1===C.indexOf("bakedVertexAnimationTime")&&C.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,L.I)(e,U,O)}for(const y in this._textures)if(!this._textures[y].isReady())return!1;U&&this.needAlphaTestingForMesh(U)&&O.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,f.e)(C),(0,f.l)(this,H,O)),H.fogEnabled&&null!==U&&void 0!==U&&U.applyFog&&H.fogMode!==P.b.FOGMODE_NONE&&(O.push("#define FOG"),-1===C.indexOf("view")&&C.push("view"),-1===C.indexOf("vFogInfos")&&C.push("vFogInfos"),-1===C.indexOf("vFogColor")&&C.push("vFogColor")),this._useLogarithmicDepth&&(O.push("#define LOGARITHMICDEPTH"),-1===C.indexOf("logarithmicDepthConstant")&&C.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(C=C.slice(),B=B.slice(),J=J.slice(),Z=this.customShaderNameResolve(this.name,C,B,J,O,e));const S=A?b._getDrawWrapper(void 0,!0):this._drawWrapper,h=(null===S||void 0===S?void 0:S.effect)??null,i=(null===S||void 0===S?void 0:S.defines)??null,Y=O.join("\n");let d=h;return i!==Y&&(d=W.createEffect(Z,{attributes:e,uniformsNames:C,uniformBuffersNames:B,samplers:J,defines:Y,fallbacks:x,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:F},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},W),A?b.setEffect(d,Y,this._materialContext):S&&S.setEffect(d,Y),this._onEffectCreatedObservable&&(z.effect=d,z.subMesh=b??(null===U||void 0===U?void 0:U.xk[0])??null,this._onEffectCreatedObservable.notifyObservers(z))),S._wasPreviouslyUsingInstances=!!M,!(null===(a=d)||void 0===a||!a.isReady())&&(h!==d&&H.resetCachedMaterial(),S._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(U,M){const b=M??this.getEffect();if(!b)return;const a=this._options.uniforms;-1!==a.indexOf("world")&&b.setMatrix("world",U);const A=this.va();-1!==a.indexOf("worldView")&&(U.multiplyToRef(A.getViewMatrix(),this._cachedWorldViewMatrix),b.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==a.indexOf("worldViewProjection")&&(U.multiplyToRef(A.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),b.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==a.indexOf("view")&&b.setMatrix("view",A.getViewMatrix())}bindForSubMesh(U,M,b){var a;this.bind(U,M,null===(a=b._drawWrapperOverride)||void 0===a?void 0:a.effect,b)}bind(U,M,b,a){const A=a&&this._storeEffectOnSubMeshes,H=b??(A?a.effect:this.getEffect());if(!H)return;const W=this.va();this._activeEffect=H,this.bindOnlyWorldMatrix(U,b);const y=this._options.uniformBuffers;let O=!1;if(H&&y&&y.length>0&&W.getEngine().supportsUniformBuffers)for(let P=0;P<y.length;++P){switch(y[P]){case"Mesh":M&&(M.getMeshUniformBuffer().bindToEffect(H,"Mesh"),M.transferToEffect(U));break;case"Scene":(0,L.w)(H,W.getSceneUniformBuffer()),W.finalizeSceneUbo(),O=!0}}const e=M&&A?this._mustRebind(W,H,a,M.visibility):W.getCachedMaterial()!==this;if(H&&e){let U;for(U in O||-1===this._options.uniforms.indexOf("view")||H.setMatrix("view",W.getViewMatrix()),O||-1===this._options.uniforms.indexOf("projection")||H.setMatrix("projection",W.getProjectionMatrix()),O||-1===this._options.uniforms.indexOf("viewProjection")||(H.setMatrix("viewProjection",W.getTransformMatrix()),this._multiview&&H.setMatrix("viewProjectionR",W._transformMatrixR)),W.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&H.setVector3("cameraPosition",W.activeCamera.globalPosition),(0,L.d)(M,H),(0,f.f)(H,this,W),this._useLogarithmicDepth&&(0,L.o)(A?a.materialDefines:H.defines,H,W),M&&(0,L.h)(W,M,H),this._textures)H.setTexture(U,this._textures[U]);for(U in this._textureArrays)H.setTextureArray(U,this._textureArrays[U]);for(U in this._ints)H.setInt(U,this._ints[U]);for(U in this._uints)H.setUInt(U,this._uints[U]);for(U in this._floats)H.setFloat(U,this._floats[U]);for(U in this._floatsArrays)H.setArray(U,this._floatsArrays[U]);for(U in this._colors3)H.setColor3(U,this._colors3[U]);for(U in this._colors3Arrays)H.setArray3(U,this._colors3Arrays[U]);for(U in this._colors4){const M=this._colors4[U];H.setFloat4(U,M.r,M.g,M.b,M.a)}for(U in this._colors4Arrays)H.setArray4(U,this._colors4Arrays[U]);for(U in this._vectors2)H.setVector2(U,this._vectors2[U]);for(U in this._vectors3)H.setVector3(U,this._vectors3[U]);for(U in this._vectors4)H.setVector4(U,this._vectors4[U]);for(U in this._quaternions)H.setQuaternion(U,this._quaternions[U]);for(U in this._matrices)H.setMatrix(U,this._matrices[U]);for(U in this._matrixArrays)H.setMatrices(U,this._matrixArrays[U]);for(U in this._matrices3x3)H.setMatrix3x3(U,this._matrices3x3[U]);for(U in this._matrices2x2)H.setMatrix2x2(U,this._matrices2x2[U]);for(U in this._vectors2Arrays)H.setArray2(U,this._vectors2Arrays[U]);for(U in this._vectors3Arrays)H.setArray3(U,this._vectors3Arrays[U]);for(U in this._vectors4Arrays)H.setArray4(U,this._vectors4Arrays[U]);for(U in this._quaternionsArrays)H.setArray4(U,this._quaternionsArrays[U]);for(U in this._uniformBuffers){const M=this._uniformBuffers[U].getBuffer();M&&H.bindUniformBuffer(M,U)}const b=W.getEngine(),y=b.setExternalTexture;if(y)for(U in this._externalTextures)y.call(b,U,this._externalTextures[U]);const e=b.setTextureSampler;if(e)for(U in this._textureSamplers)e.call(b,U,this._textureSamplers[U]);const x=b.setStorageBuffer;if(x)for(U in this._storageBuffers)x.call(b,U,this._storageBuffers[U])}if(H&&M&&(e||!this.isFrozen)){(0,L.s)(M,H),M.morphTargetManager&&M.morphTargetManager.isUsingTextureForTargets&&M.morphTargetManager._bind(H);const U=M.bakedVertexAnimationManager;if(U&&U.isEnabled){var x;const U=A?a._drawWrapper:this._drawWrapper;null===(x=M.bakedVertexAnimationManager)||void 0===x||x.bind(H,!!U._wasPreviouslyUsingInstances)}}this._afterBind(M,H,a)}getActiveTextures(){const U=super.getActiveTextures();for(const M in this._textures)U.push(this._textures[M]);for(const M in this._textureArrays){const b=this._textureArrays[M];for(let M=0;M<b.length;M++)U.push(b[M])}return U}hasTexture(U){if(super.hasTexture(U))return!0;for(const M in this._textures)if(this._textures[M]===U)return!0;for(const M in this._textureArrays){const b=this._textureArrays[M];for(let M=0;M<b.length;M++)if(b[M]===U)return!0}return!1}clone(U){const M=x.d.Clone((()=>new o(U,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);M.name=U,M.id=U,"object"===typeof M._shaderPath&&(M._shaderPath={...M._shaderPath}),this._options={...this._options};const b=Object.keys(this._options);for(const a of b){const U=this._options[a];Array.isArray(U)&&(this._options[a]=U.slice(0))}this.stencil.copyTo(M.stencil);for(const a in this._textures)M.setTexture(a,this._textures[a]);for(const a in this._textureArrays)M.setTextureArray(a,this._textureArrays[a]);for(const a in this._externalTextures)M.setExternalTexture(a,this._externalTextures[a]);for(const a in this._ints)M.setInt(a,this._ints[a]);for(const a in this._uints)M.setUInt(a,this._uints[a]);for(const a in this._floats)M.setFloat(a,this._floats[a]);for(const a in this._floatsArrays)M.setFloats(a,this._floatsArrays[a]);for(const a in this._colors3)M.setColor3(a,this._colors3[a]);for(const a in this._colors3Arrays)M._colors3Arrays[a]=this._colors3Arrays[a];for(const a in this._colors4)M.setColor4(a,this._colors4[a]);for(const a in this._colors4Arrays)M._colors4Arrays[a]=this._colors4Arrays[a];for(const a in this._vectors2)M.setVector2(a,this._vectors2[a]);for(const a in this._vectors3)M.setVector3(a,this._vectors3[a]);for(const a in this._vectors4)M.setVector4(a,this._vectors4[a]);for(const a in this._quaternions)M.setQuaternion(a,this._quaternions[a]);for(const a in this._quaternionsArrays)M._quaternionsArrays[a]=this._quaternionsArrays[a];for(const a in this._matrices)M.setMatrix(a,this._matrices[a]);for(const a in this._matrixArrays)M._matrixArrays[a]=this._matrixArrays[a].slice();for(const a in this._matrices3x3)M.setMatrix3x3(a,this._matrices3x3[a]);for(const a in this._matrices2x2)M.setMatrix2x2(a,this._matrices2x2[a]);for(const a in this._vectors2Arrays)M.setArray2(a,this._vectors2Arrays[a]);for(const a in this._vectors3Arrays)M.setArray3(a,this._vectors3Arrays[a]);for(const a in this._vectors4Arrays)M.setArray4(a,this._vectors4Arrays[a]);for(const a in this._uniformBuffers)M.setUniformBuffer(a,this._uniformBuffers[a]);for(const a in this._textureSamplers)M.setTextureSampler(a,this._textureSamplers[a]);for(const a in this._storageBuffers)M.setStorageBuffer(a,this._storageBuffers[a]);return M}dispose(U,M,b){if(M){let U;for(U in this._textures)this._textures[U].dispose();for(U in this._textureArrays){const M=this._textureArrays[U];for(let U=0;U<M.length;U++)M[U].dispose()}}this._textures={},super.dispose(U,M,b)}serialize(){const U=x.d.Serialize(this);let M;for(M in U.customType="BABYLON.ShaderMaterial",U.uniqueId=this.uniqueId,U.options=this._options,U.shaderPath=this._shaderPath,U.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,U.stencil=this.stencil.serialize(),U.textures={},this._textures)U.textures[M]=this._textures[M].serialize();for(M in U.textureArrays={},this._textureArrays){U.textureArrays[M]=[];const b=this._textureArrays[M];for(let a=0;a<b.length;a++)U.textureArrays[M].push(b[a].serialize())}for(M in U.ints={},this._ints)U.ints[M]=this._ints[M];for(M in U.uints={},this._uints)U.uints[M]=this._uints[M];for(M in U.floats={},this._floats)U.floats[M]=this._floats[M];for(M in U.floatsArrays={},this._floatsArrays)U.floatsArrays[M]=this._floatsArrays[M];for(M in U.colors3={},this._colors3){const b=this._colors3[M];U.colors3[M]=[b.r,b.g,b.b]}for(M in U.colors3Arrays={},this._colors3Arrays)U.colors3Arrays[M]=this._colors3Arrays[M];for(M in U.colors4={},this._colors4){const b=this._colors4[M];U.colors4[M]=[b.r,b.g,b.b,b.a]}for(M in U.colors4Arrays={},this._colors4Arrays)U.colors4Arrays[M]=this._colors4Arrays[M];for(M in U.vectors2={},this._vectors2){const b=this._vectors2[M];U.vectors2[M]=[b.x,b.y]}for(M in U.vectors3={},this._vectors3){const b=this._vectors3[M];U.vectors3[M]=[b.x,b.y,b.z]}for(M in U.vectors4={},this._vectors4){const b=this._vectors4[M];U.vectors4[M]=[b.x,b.y,b.z,b.w]}for(M in U.quaternions={},this._quaternions)U.quaternions[M]=this._quaternions[M].tk();for(M in U.matrices={},this._matrices)U.matrices[M]=this._matrices[M].tk();for(M in U.matrixArray={},this._matrixArrays)U.matrixArray[M]=this._matrixArrays[M];for(M in U.matrices3x3={},this._matrices3x3)U.matrices3x3[M]=this._matrices3x3[M];for(M in U.matrices2x2={},this._matrices2x2)U.matrices2x2[M]=this._matrices2x2[M];for(M in U.vectors2Arrays={},this._vectors2Arrays)U.vectors2Arrays[M]=this._vectors2Arrays[M];for(M in U.vectors3Arrays={},this._vectors3Arrays)U.vectors3Arrays[M]=this._vectors3Arrays[M];for(M in U.vectors4Arrays={},this._vectors4Arrays)U.vectors4Arrays[M]=this._vectors4Arrays[M];for(M in U.quaternionsArrays={},this._quaternionsArrays)U.quaternionsArrays[M]=this._quaternionsArrays[M];return U}static Parse(U,M,b){const A=x.d.Parse((()=>new o(U.name,M,U.shaderPath,U.options,U.storeEffectOnSubMeshes)),U,M,b);let H;for(H in U.stencil&&A.stencil.parse(U.stencil,M,b),U.textures)A.setTexture(H,Z.e.Parse(U.textures[H],M,b));for(H in U.textureArrays){const a=U.textureArrays[H],W=[];for(let U=0;U<a.length;U++)W.push(Z.e.Parse(a[U],M,b));A.setTextureArray(H,W)}for(H in U.ints)A.setInt(H,U.ints[H]);for(H in U.uints)A.setUInt(H,U.uints[H]);for(H in U.floats)A.setFloat(H,U.floats[H]);for(H in U.floatsArrays)A.setFloats(H,U.floatsArrays[H]);for(H in U.colors3){const M=U.colors3[H];A.setColor3(H,{r:M[0],g:M[1],b:M[2]})}for(H in U.colors3Arrays){const M=U.colors3Arrays[H].reduce(((U,M,b)=>(b%3===0?U.push([M]):U[U.length-1].push(M),U)),[]).map((U=>({r:U[0],g:U[1],b:U[2]})));A.setColor3Array(H,M)}for(H in U.colors4){const M=U.colors4[H];A.setColor4(H,{r:M[0],g:M[1],b:M[2],a:M[3]})}for(H in U.colors4Arrays){const M=U.colors4Arrays[H].reduce(((U,M,b)=>(b%4===0?U.push([M]):U[U.length-1].push(M),U)),[]).map((U=>({r:U[0],g:U[1],b:U[2],a:U[3]})));A.setColor4Array(H,M)}for(H in U.vectors2){const M=U.vectors2[H];A.setVector2(H,{x:M[0],y:M[1]})}for(H in U.vectors3){const M=U.vectors3[H];A.setVector3(H,{x:M[0],y:M[1],z:M[2]})}for(H in U.vectors4){const M=U.vectors4[H];A.setVector4(H,{x:M[0],y:M[1],z:M[2],w:M[3]})}for(H in U.quaternions)A.setQuaternion(H,a.e.jk(U.quaternions[H]));for(H in U.matrices)A.setMatrix(H,a.b.jk(U.matrices[H]));for(H in U.matrixArray)A._matrixArrays[H]=new Float32Array(U.matrixArray[H]);for(H in U.matrices3x3)A.setMatrix3x3(H,U.matrices3x3[H]);for(H in U.matrices2x2)A.setMatrix2x2(H,U.matrices2x2[H]);for(H in U.vectors2Arrays)A.setArray2(H,U.vectors2Arrays[H]);for(H in U.vectors3Arrays)A.setArray3(H,U.vectors3Arrays[H]);for(H in U.vectors4Arrays)A.setArray4(H,U.vectors4Arrays[H]);for(H in U.quaternionsArrays)A.setArray4(H,U.quaternionsArrays[H]);return A}static async ParseFromFileAsync(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((A,H)=>{const W=new B.c;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const M=JSON.parse(W.responseText),H=this.Parse(M,b||F.d.LastCreatedScene,a);U&&(H.name=U),A(H)}else H("Unable to load the ShaderMaterial")})),W.open("GET",M),W.send()}))}static async ParseFromSnippetAsync(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((a,A)=>{const H=new B.c;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const A=JSON.parse(JSON.parse(H.responseText).jsonPayload),W=JSON.parse(A.shaderMaterial),y=this.Parse(W,M||F.d.LastCreatedScene,b);y.snippetId=U,a(y)}else A("Unable to load the snippet "+U)})),H.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),H.send()}))}}o.SnippetUrl="https://snippet.babylonjs.com",o.CreateFromSnippetAsync=o.ParseFromSnippetAsync,(0,C.i)("BABYLON.ShaderMaterial",o),A.c._LinesMeshParser=(U,M)=>S.Parse(U,M);class S extends A.c{_isShaderMaterial(U){return"ShaderMaterial"===U.getClassName()}constructor(U){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0;super(U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M,arguments.length>4?arguments[4]:void 0),this.useVertexColor=a,this.useVertexAlpha=A,this.color=new W.c(1,1,1),this.alpha=1,this._shaderLanguage=0,M&&(this.color=M.color.clone(),this.alpha=M.alpha,this.useVertexColor=M.useVertexColor,this.useVertexAlpha=M.useVertexAlpha),this.intersectionThreshold=.1;const O={attributes:[y.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?O.defines.push("#define VERTEXALPHA"):O.needAlphaBlending=!1,this.useVertexColor?(O.defines.push("#define VERTEXCOLOR"),O.attributes.push(y.e.ColorKind)):(O.uniforms.push("color"),this._color4=new W.e),H)this.material=H;else{this.va().getEngine().isWebGPU&&!S.ForceGLSL&&(this._shaderLanguage=1),O.shaderLanguage=this._shaderLanguage,O.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([b.e(43).then(b.bind(b,14218)),b.e(102).then(b.bind(b,14220))]):await Promise.all([b.e(48).then(b.bind(b,14227)),b.e(103).then(b.bind(b,14234))])},this.material=new o("colorShader",this.va(),"color",O,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(U){this._lineMaterial=U,this._lineMaterial.fillMode=e.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(U){}_bind(U,M){if(!this._geometry)return this;const b=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(M,b):this._geometry._bind(M,b,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:U,g:M,b:b}=this.color;this._color4.set(U,M,b,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(U,M,b){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=this.va().getEngine();return this._unIndexed?a.drawArraysType(e.c.LineListDrawMode,U.verticesStart,U.verticesCount,b):a.drawElementsType(e.c.LineListDrawMode,U.indexStart,U.indexCount,b),this}dispose(U){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(U)}clone(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(M&&void 0===M._addToSceneRootNodes){const b=M;return b.source=this,new S(U,this.va(),b.parent,b.source,b.doNotCloneChildren)}return new S(U,this.va(),M,this,b)}createInstance(U){const M=new h(U,this);if(this.instancedBuffers){M.instancedBuffers={};for(const U in this.instancedBuffers)M.instancedBuffers[U]=this.instancedBuffers[U]}return M}serialize(U){super.serialize(U),U.color=this.color.tk(),U.alpha=this.alpha}static Parse(U,M){const b=new S(U.name,M);return b.color=W.c.jk(U.color),b.alpha=U.alpha,b}}S.ForceGLSL=!1;class h extends O.b{constructor(U,M){super(U,M),this.intersectionThreshold=M.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var i=b(497);function Y(U){const M=[],b=[],a=U.lines,A=U.za,W=[];let y=0;for(let H=0;H<a.length;H++){const U=a[H];for(let a=0;a<U.length;a++){const{x:O,y:e,z:x}=U[a];if(b.push(O,e,x),A){const U=A[H],{r:M,g:b,b:y,a:O}=U[a];W.push(M,b,y,O)}a>0&&(M.push(y-1),M.push(y)),y++}}const O=new H.c;return O.indices=M,O.xa=b,A&&(O.za=W),O}function d(U){const M=U.dashSize||3,b=U.gapSize||1,A=U.dashNb||200,W=U.points,y=[],O=[],e=a.l.Zero();let x=0,P=0,Z=0,C=0,r=0,B=0,J=0;for(J=0;J<W.length-1;J++)W[J+1].subtractToRef(W[J],e),x+=e.length();for(Z=x/A,C=M*Z/(M+b),J=0;J<W.length-1;J++){W[J+1].subtractToRef(W[J],e),P=Math.floor(e.length()/Z),e.normalize();for(let U=0;U<P;U++)r=Z*U,y.push(W[J].x+r*e.x,W[J].y+r*e.y,W[J].z+r*e.z),y.push(W[J].x+(r+C)*e.x,W[J].y+(r+C)*e.y,W[J].z+(r+C)*e.z),O.push(B,B+1),B+=2}const F=new H.c;return F.xa=y,F.indices=O,F}function s(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=M.instance,A=M.lines,H=M.za;if(a){const U=a.getVerticesData(y.e.PositionKind);let M,b;H&&(M=a.getVerticesData(y.e.ColorKind));let W=0,O=0;for(let a=0;a<A.length;a++){const y=A[a];for(let A=0;A<y.length;A++)U[W]=y[A].x,U[W+1]=y[A].y,U[W+2]=y[A].z,H&&M&&(b=H[a],M[O]=b[A].r,M[O+1]=b[A].g,M[O+2]=b[A].b,M[O+3]=b[A].a,O+=4),W+=3}return a.updateVerticesData(y.e.PositionKind,U,!1,!1),H&&M&&a.updateVerticesData(y.e.ColorKind,M,!1,!1),a.refreshBoundingInfo(),a}const W=new S(U,b,null,void 0,void 0,!!H,M.useVertexAlpha,M.material);return Y(M).Ca(W,M.updatable),W}function q(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=M.za?[M.za]:null;return s(U,{lines:[M.points],updatable:M.updatable,instance:M.instance,za:a,useVertexAlpha:M.useVertexAlpha,material:M.material},b)}function m(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=M.points,W=M.instance,y=M.gapSize||1,O=M.dashSize||3;if(W){const U=U=>{const M=a.l.Zero(),b=U.length/6;let A=0,y=0,O=0,e=0,x=0,P=0,Z=0,C=0;for(Z=0;Z<H.length-1;Z++)H[Z+1].subtractToRef(H[Z],M),A+=M.length();O=A/b;const r=W._creationDataStorage.dashSize;for(e=r*O/(r+W._creationDataStorage.gapSize),Z=0;Z<H.length-1;Z++)for(H[Z+1].subtractToRef(H[Z],M),y=Math.floor(M.length()/O),M.normalize(),C=0;C<y&&P<U.length;)x=O*C,U[P]=H[Z].x+x*M.x,U[P+1]=H[Z].y+x*M.y,U[P+2]=H[Z].z+x*M.z,U[P+3]=H[Z].x+(x+e)*M.x,U[P+4]=H[Z].y+(x+e)*M.y,U[P+5]=H[Z].z+(x+e)*M.z,P+=6,C++;for(;P<U.length;)U[P]=H[Z].x,U[P+1]=H[Z].y,U[P+2]=H[Z].z,P+=3};return(M.dashNb||M.dashSize||M.gapSize||M.useVertexAlpha||M.material)&&i.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),W.updateMeshPositions(U,!1),W}const e=new S(U,b,null,void 0,void 0,void 0,M.useVertexAlpha,M.material);return d(M).Ca(e,M.updatable),e._creationDataStorage=new A.f,e._creationDataStorage.dashSize=O,e._creationDataStorage.gapSize=y,e}H.c.CreateLineSystem=Y,H.c.CreateDashedLines=d,A.c.Pk=function(U,M){return q(U,{points:M,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},A.c.CreateDashedLines=function(U,M,b,a,A){return m(U,{points:M,dashSize:b,gapSize:a,dashNb:A,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12299:(U,M,b)=>{"use strict";b.d(M,{e:()=>y,g:()=>O});var a=b(470),A=b(744),H=b(784);function W(U){const M=[],b=[],a=[],W=[],y=void 0!==U.width?U.width:void 0!==U.size?U.size:1,O=void 0!==U.height?U.height:void 0!==U.size?U.size:1,e=0===U.sideOrientation?0:U.sideOrientation||A.c.DEFAULTSIDE,x=y/2,P=O/2;b.push(-x,-P,0),a.push(0,0,-1),W.push(0,H.c?1:0),b.push(x,-P,0),a.push(0,0,-1),W.push(1,H.c?1:0),b.push(x,P,0),a.push(0,0,-1),W.push(1,H.c?0:1),b.push(-x,P,0),a.push(0,0,-1),W.push(0,H.c?0:1),M.push(0),M.push(1),M.push(2),M.push(0),M.push(2),M.push(3),A.c._ComputeSides(e,b,M,a,W,U.frontUVs,U.backUVs);const Z=new A.c;return Z.indices=M,Z.xa=b,Z.ya=a,Z.Aa=W,Z}function y(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new a.c(U,b);M.sideOrientation=a.c._GetDefaultSideOrientation(M.sideOrientation),A._originalBuilderSideOrientation=M.sideOrientation;return W(M).Ca(A,M.updatable),M.sourcePlane&&(A.translate(M.sourcePlane.uk,-M.sourcePlane.d),A.setDirection(M.sourcePlane.uk.scale(-1))),A}const O={Qk:y};A.c.Qk=W,a.c.Qk=(U,M,b,a,A)=>y(U,{size:M,width:M,height:M,sideOrientation:A,updatable:a},b)},12398:(U,M,b)=>{"use strict";b.d(M,{e:()=>O});var a=b(670),A=b(470),H=b(744),W=b(784);function y(U){const M=0|(U.segments||32),b=U.diameterX||U.diameter||1,A=U.diameterY||U.diameter||1,y=U.diameterZ||U.diameter||1,O=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,e=U.slice&&U.slice<=0?1:U.slice||1,x=0===U.sideOrientation?0:U.sideOrientation||H.c.DEFAULTSIDE,P=!!U.dedupTopBottomIndices,Z=new a.l(b/2,A/2,y/2),C=2+M,r=2*C,B=[],J=[],F=[],f=[];for(let H=0;H<=C;H++){const U=H/C,M=U*Math.PI*e;for(let b=0;b<=r;b++){const A=b/r,H=A*Math.PI*2*O,y=a.b.RotationZ(-M),e=a.b.RotationY(H),x=a.l.TransformCoordinates(a.l.Up(),y),P=a.l.TransformCoordinates(x,e),C=P.multiply(Z),B=P.divide(Z).normalize();J.push(C.x,C.y,C.z),F.push(B.x,B.y,B.z),f.push(A,W.c?1-U:U)}if(H>0){const U=J.length/3;for(let M=U-2*(r+1);M+r+2<U;M++)P?(H>1&&(B.push(M),B.push(M+1),B.push(M+r+1)),(H<C||e<1)&&(B.push(M+r+1),B.push(M+1),B.push(M+r+2))):(B.push(M),B.push(M+1),B.push(M+r+1),B.push(M+r+1),B.push(M+1),B.push(M+r+2))}}H.c._ComputeSides(x,J,B,F,f,U.frontUVs,U.backUVs);const L=new H.c;return L.indices=B,L.xa=J,L.ya=F,L.Aa=f,L}function O(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return y(M).Ca(a,M.updatable),a}H.c.CreateSphere=y,A.c.CreateSphere=(U,M,b,a,A,H)=>O(U,{segments:M,diameterX:b,diameterY:b,diameterZ:b,sideOrientation:H,updatable:A},a)},12732:(U,M,b)=>{"use strict";b.d(M,{c:()=>O,g:()=>W,h:()=>y});var a=b(479),A=b(2564),H=b(12740);function W(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function y(U){return!!(U.wasmUrl&&(U.wasmBinary||U.wasmBinaryUrl)&&"object"===typeof WebAssembly||U.fallbackUrl)}class O{constructor(U){if(U.workerPool)return void(this._workerPoolPromise=Promise.resolve(U.workerPool));const M=U.wasmBinary,b=U.numWorkers??W(),y=b&&"function"===typeof Worker&&"function"===typeof URL,O=y||!U.jsModule,e=U.wasmUrl&&U.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:O?a.d.GetBabylonScriptURL(U.wasmUrl,!0):"",wasmBinaryPromise:M?Promise.resolve(M):a.d.LoadFileAsync(a.d.GetBabylonScriptURL(U.wasmBinaryUrl,!0))}:{url:O?a.d.GetBabylonScriptURL(U.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};y?this._workerPoolPromise=e.wasmBinaryPromise.then((U=>{const M=this._getWorkerContent(),a=URL.createObjectURL(new Blob([M],{type:"application/javascript"}));return new A.b(b,(()=>{const M=new Worker(a);return(0,H.d)(M,U,e.url)}))})):this._modulePromise=e.wasmBinaryPromise.then((async M=>{if(!this._isModuleAvailable()&&!U.jsModule){if(!e.url)throw new Error("Draco codec module is not available");await a.d.LoadBabylonScriptAsync(e.url)}return await this._createModuleAsync(M,U.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((U=>{U.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},13061:(U,M,b)=>{"use strict";b.d(M,{e:()=>y});var a=b(12732),A=b(12728),H=b(12747),W=b(744);class y{static get Configuration(){return{get decoder(){return A.c.DefaultConfiguration},set decoder(U){A.c.DefaultConfiguration=U}}}static set Configuration(U){A.c.DefaultConfiguration=U.decoder}static get DecoderAvailable(){return(0,a.h)(A.c.DefaultConfiguration)}static get Default(){return y._Default??(y._Default=new y),y._Default}static ResetDefault(U){y._Default&&(U||y._Default.dispose(),y._Default=null)}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.DefaultNumWorkers;const M="number"===typeof U?{...A.c.DefaultConfiguration,numWorkers:U}:{...A.c.DefaultConfiguration,...U};this._decoder=new A.c(M)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(U,M,b){return this._decoder.decodeMeshToMeshDataAsync(U,M,b)}async decodeMeshToGeometryAsync(U,M,b,a){return await this._decoder.decodeMeshToGeometryAsync(U,M,b,a)}async _decodeMeshToGeometryForGltfAsync(U,M,b,a,A,H){return await this._decoder._decodeMeshToGeometryForGltfAsync(U,M,b,a,A,H)}async decodeMeshAsync(U,M){const b=await this._decoder.decodeMeshToMeshDataAsync(U,M),a=new W.c;b.indices&&(a.indices=b.indices);for(const A of b.attributes){const U=H.b.GetFloatData(A.data,A.size,H.b.GetDataType(A.data),A.byteOffset,A.byteStride,A.normalized,b.totalVertices);a.set(U,A.kind)}return a}}y.DefaultNumWorkers=(0,a.g)(),y._Default=null},12740:(U,M,b)=>{"use strict";function a(U,M,b,a,A){const H=U;let W=null,y=null,O=null;try{let U;W=new H.Decoder,y=new H.DecoderBuffer,y.Init(M,M.byteLength);const e=W.GetEncodedGeometryType(y);switch(e){case H.TRIANGULAR_MESH:{const M=new H.Mesh;if(U=W.DecodeBufferToMesh(y,M),!U.ok()||0===M.ptr)throw new Error(U.error_msg());const b=3*M.num_faces(),A=4*b,e=H._malloc(A);try{W.GetTrianglesUInt32Array(M,A,e);const U=new Uint32Array(b);U.set(new Uint32Array(H.HEAPF32.buffer,e,b)),a(U)}finally{H._free(e)}O=M;break}case H.POINT_CLOUD:{const M=new H.PointCloud;if(U=W.DecodeBufferToPointCloud(y,M),!U.ok()||!M.ptr)throw new Error(U.error_msg());O=M;break}default:throw new Error(`Invalid geometry type ${e}`)}const x=O.num_points(),P=(U,M,b,a)=>{const W=a.data_type(),y=a.num_components(),O=a.normalized(),e=a.byte_stride(),P=a.byte_offset(),Z={[H.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:H.HEAPF32},[H.DT_INT8]:{typedArrayConstructor:Int8Array,heap:H.HEAP8},[H.DT_INT16]:{typedArrayConstructor:Int16Array,heap:H.HEAP16},[H.DT_INT32]:{typedArrayConstructor:Int32Array,heap:H.HEAP32},[H.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:H.HEAPU8},[H.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:H.HEAPU16},[H.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:H.HEAPU32}}[W];if(!Z)throw new Error(`Invalid data type ${W}`);const C=x*y,r=C*Z.typedArrayConstructor.BYTES_PER_ELEMENT,B=H._malloc(r);try{U.GetAttributeDataArrayForAllPoints(M,a,W,r,B);const H=new Z.typedArrayConstructor(Z.heap.buffer,B,C);A(b,H.slice(),y,P,e,O)}finally{H._free(B)}};if(b)for(const M in b){const U=b[M],a=W.GetAttributeByUniqueId(O,U);P(W,O,M,a)}else{const U={position:H.POSITION,uk:H.NORMAL,color:H.COLOR,uv:H.TEX_COORD};for(const M in U){const b=W.GetAttributeId(O,U[M]);if(-1!==b){const U=W.GetAttribute(O,b);P(W,O,M,U)}}}return x}finally{O&&H.destroy(O),y&&H.destroy(y),W&&H.destroy(W)}}function A(){let U;onmessage=M=>{const b=M.data;switch(b.id){case"init":{b.url&&importScripts(b.url);const M=b.wasmBinary?{wasmBinary:b.wasmBinary}:{};U=DracoDecoderModule(M),postMessage({id:"initDone"});break}case"decodeMesh":if(!U)throw new Error("Draco decoder module is not available");U.then((U=>{const M=a(U,b.dataView,b.attributes,(U=>{postMessage({id:"indices",data:U},[U.buffer])}),((U,M,b,a,A,H)=>{postMessage({id:"attribute",kind:U,data:M,size:b,byteOffset:a,byteStride:A,normalized:H},[M.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:M})}))}}}async function H(U,M,b){return await new Promise(((a,A)=>{const H=M=>{U.removeEventListener("error",H),U.removeEventListener("message",W),A(M)},W=M=>{"initDone"===M.data.id&&(U.removeEventListener("error",H),U.removeEventListener("message",W),a(U))};if(U.addEventListener("error",H),U.addEventListener("message",W),M){const a=M.slice(0);U.postMessage({id:"init",url:b,wasmBinary:a},[a])}else U.postMessage({id:"init",url:b})}))}b.d(M,{b:()=>a,c:()=>A,d:()=>H})},12728:(U,M,b)=>{"use strict";b.d(M,{c:()=>e});var a=b(12732),A=b(479),H=b(779),W=b(12747),y=b(497),O=b(12740);class e extends a.c{static get DefaultAvailable(){return(0,a.h)(e.DefaultConfiguration)}static get Default(){return e._Default??(e._Default=new e),e._Default}static ResetDefault(U){e._Default&&(U||e._Default.dispose(),e._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(U,M){return{module:await(M||DracoDecoderModule)({wasmBinary:U})}}_getWorkerContent(){return`${O.b}(${O.c})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DefaultConfiguration)}decodeMeshToMeshDataAsync(U,M,b){const a=U instanceof ArrayBuffer?new Int8Array(U):new Int8Array(U.buffer,U.byteOffset,U.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async U=>await new Promise(((A,H)=>{U.push(((U,W)=>{let O=null;const e=[],x=M=>{U.removeEventListener("error",x),U.removeEventListener("message",P),H(M),W()},P=M=>{const a=M.data;switch(a.id){case"indices":O=a.data;break;case"attribute":e.push({kind:a.kind,data:a.data,size:a.size,byteOffset:a.byteOffset,byteStride:a.byteStride,normalized:(H=a.kind,Z=a.normalized,b&&void 0!==b[H]?(Z!==b[H]&&y.b.Warn(`Normalized flag from Draco data (${Z}) does not match normalized flag from glTF accessor (${b[H]}). Using flag from glTF accessor.`),b[H]):Z)});break;case"decodeMeshDone":U.removeEventListener("error",x),U.removeEventListener("message",P),A({indices:O,attributes:e,totalVertices:a.totalVertices}),W()}var H,Z};U.addEventListener("error",x),U.addEventListener("message",P);const Z=a.slice();U.postMessage({id:"decodeMesh",dataView:Z,attributes:M},[Z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((U=>{let b=null;const A=[],H=(0,O.b)(U.module,a,M,(U=>{b=U}),((U,M,b,a,H,W)=>{A.push({kind:U,data:M,size:b,byteOffset:a,byteStride:H,normalized:W})}));return{indices:b,attributes:A,totalVertices:H}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(U,M,b,a){const A=await this.decodeMeshToMeshDataAsync(b,a),y=new H.e(U,M);A.indices&&y.setIndices(A.indices);for(const H of A.attributes)y.setVerticesBuffer(new W.b(M.getEngine(),H.data,H.kind,!1,void 0,H.byteStride,void 0,H.byteOffset,H.size,void 0,H.normalized,!0),A.totalVertices);return y}async _decodeMeshToGeometryForGltfAsync(U,M,b,a,A,y){const O=await this.decodeMeshToMeshDataAsync(b,a,A),e=new H.e(U,M);y&&(e._boundingInfo=y,e.useBoundingInfoFromGeometry=!0),O.indices&&e.setIndices(O.indices);for(const H of O.attributes)e.setVerticesBuffer(new W.b(M.getEngine(),H.data,H.kind,!1,void 0,H.byteStride,void 0,H.byteOffset,H.size,void 0,H.normalized,!0),O.totalVertices);return e}}e.DefaultConfiguration={wasmUrl:`${A.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${A.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${A.d._DefaultCdnUrl}/draco_decoder_gltf.js`},e._Default=null},12747:(U,M,b)=>{"use strict";b.d(M,{b:()=>a.e});var a=b(729)},12662:(U,M,b)=>{"use strict";b.d(M,{b:()=>Z});var a=b(670),A=b(497),H=b(788),W=b(470),y=b(501),O=b(792),e=b(729),x=b(479),P=b(609);W.c._instancedMeshFactory=(U,M)=>{const b=new Z(U,M);if(M.instancedBuffers){b.instancedBuffers={};for(const U in M.instancedBuffers)b.instancedBuffers[U]=M.instancedBuffers[U]}return b};class Z extends H.e{constructor(U,M){super(U,M.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,M.Nk(this),this._sourceMesh=M,this._unIndexed=M._unIndexed,this.position.p(M.position),this.rotation.p(M.rotation),this.zd.p(M.zd),M.rotationQuaternion&&(this.rotationQuaternion=M.rotationQuaternion.clone()),this.animations=M.animations.slice();for(const b of M.getAnimationRanges())null!=b&&this.createAnimationRange(b.name,b.from,b.to);if(this.infiniteDistance=M.infiniteDistance,this.setPivotMatrix(M.getPivotMatrix()),M.skeleton||M.morphTargetManager||!M.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const U=M.getBoundingInfo();this.buildBoundingInfo(U.minimum,U.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(U){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.receiveShadows)!==U&&x.d.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(U){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.material)!==U&&x.d.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(U){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.visibility)!==U&&x.d.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(U){var M;(null===(M=this._sourceMesh)||void 0===M?void 0:M.skeleton)!==U&&x.d.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(U){this._sourceMesh&&U!==this._sourceMesh.renderingGroupId&&A.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get yk(){return this._sourceMesh._geometry}createInstance(U){return this._sourceMesh.createInstance(U)}isReady(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(U,!0)}getVerticesData(U,M,b){return this._sourceMesh.getVerticesData(U,M,b)}copyVerticesData(U,M){this._sourceMesh.copyVerticesData(U,M)}Ga(U,M,b,a){return this.sourceMesh&&this.sourceMesh.Ga(U,M,b,a),this.sourceMesh}updateVerticesData(U,M,b,a){return this.sourceMesh&&this.sourceMesh.updateVerticesData(U,M,b,a),this.sourceMesh}setIndices(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(U,M),this.sourceMesh}isVerticesDataPresent(U){return this._sourceMesh.isVerticesDataPresent(U)}kk(){return this._sourceMesh.kk()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let U,M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;U="object"===typeof M?M:{applySkeleton:M,applyMorph:b};const a=this._sourceMesh.yk?this._sourceMesh.yk.boundingBias:null;return this.Fa(this._sourceMesh._getData(U,null,e.e.PositionKind),a),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(U,M){if(super._activate(U,M),this._sourceMesh.xk||A.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,U),M){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==O.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new a.b);const U=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,a.g.lk[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.ik(!0)),this._currentLOD.position.p(a.g.lk[7]),this._currentLOD._masterMesh=U,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(U){if(!U)return this;const M=this.sourceMesh.getLODLevels();if(M&&0!==M.length){const M=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(U,M.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(U){return this.sourceMesh._preActivateForIntermediateRendering(U)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.xk)for(let U=0;U<this._sourceMesh.xk.length;U++)this._sourceMesh.xk[U].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const a=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(U);if(y.c.DeepCopy(this,a,["name","xk","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Kk","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","yk"],[]),this.refreshBoundingInfo(),M&&(a.parent=M),!b)for(let A=0;A<this.va().meshes.length;A++){const U=this.va().meshes[A];U.parent===this&&U.clone(U.name,a)}return a.ik(!0),this.onClonedObservable.notifyObservers(a),a}dispose(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Ok(this),super.dispose(U,M)}_serializeAsParent(U){super._serializeAsParent(U),U.parentId=this._sourceMesh.uniqueId,U.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;const a=this.clone("Clone of "+(this.name||this.id),U||this.parent,!0,M&&M.newSourcedMesh);a&&b&&b(this,a);for(const A of this.getChildTransformNodes(!0))A.instantiateHierarchy(a,M,b);return a}}W.c.prototype.registerInstancedBuffer=function(U,M){var b,a;if(null===(b=this._userInstancedBuffersStorage)||void 0===b||null===(a=b.vertexBuffers[U])||void 0===a||a.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const U of this.instances)U.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[U]=null,this._userInstancedBuffersStorage.strides[U]=M,this._userInstancedBuffersStorage.sizes[U]=32*M,this._userInstancedBuffersStorage.data[U]=new Float32Array(this._userInstancedBuffersStorage.sizes[U]),this._userInstancedBuffersStorage.vertexBuffers[U]=new e.e(this.getEngine(),this._userInstancedBuffersStorage.data[U],U,!0,!1,M,!0);for(const A of this.instances)A.instancedBuffers[U]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},W.c.prototype._processInstancedBuffers=function(U,M){const b=U?U.length:0;for(const a in this.instancedBuffers){let A=this._userInstancedBuffersStorage.sizes[a];const H=this._userInstancedBuffersStorage.strides[a],W=(b+1)*H;for(;A<W;)A*=2;this._userInstancedBuffersStorage.data[a].length!=A&&(this._userInstancedBuffersStorage.data[a]=new Float32Array(A),this._userInstancedBuffersStorage.sizes[a]=A,this._userInstancedBuffersStorage.vertexBuffers[a]&&(this._userInstancedBuffersStorage.vertexBuffers[a].dispose(),this._userInstancedBuffersStorage.vertexBuffers[a]=null));const y=this._userInstancedBuffersStorage.data[a];let O=0;if(M){const U=this.instancedBuffers[a];U.toArray?U.toArray(y,O):U.copyToArray?U.copyToArray(y,O):y[O]=U,O+=H}for(let M=0;M<b;M++){const b=U[M].instancedBuffers[a];b.toArray?b.toArray(y,O):b.copyToArray?b.copyToArray(y,O):y[O]=b,O+=H}this._userInstancedBuffersStorage.vertexBuffers[a]?this._userInstancedBuffersStorage.vertexBuffers[a].updateDirectly(y,0):(this._userInstancedBuffersStorage.vertexBuffers[a]=new e.e(this.getEngine(),this._userInstancedBuffersStorage.data[a],a,!0,!1,H,!0),this._invalidateInstanceVertexArrayObject())}},W.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const U in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[U]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},W.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const U in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[U]&&this._userInstancedBuffersStorage.vertexBuffers[U].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,P.i)("BABYLON.InstancedMesh",Z)},12936:(U,M,b)=>{"use strict";b.d(M,{c:()=>BU});var a=b(670),A=b(470),H=b(729),W=b(744),y=b(784);function O(U){let M=U.pathArray;const b=U.closeArray||!1,a=U.closePath||!1,A=U.invertUV||!1,O=Math.floor(M[0].length/2);let e=U.offset||O;e=e>O?O:Math.floor(e);const x=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE,P=U.Aa,Z=U.za,C=[],r=[],B=[],J=[],F=[],f=[],L=[],z=[];let o;const S=[],h=[];let i,Y,d;if(M.length<2){const U=[],b=[];for(Y=0;Y<M[0].length-e;Y++)U.push(M[0][Y]),b.push(M[0][Y+e]);M=[U,b]}let s=0;const q=a?1:0,m=b?1:0;let n,E,X,Q,I,v;for(o=M[0].length,i=0;i<M.length+m;i++){for(L[i]=0,F[i]=[0],n=i===M.length?M[0]:M[i],E=n.length,o=o<E?o:E,d=0;d<E;)C.push(n[d].x,n[d].y,n[d].z),d>0&&(X=n[d].je(n[d-1]).length(),Q=X+L[i],F[i].push(Q),L[i]=Q),d++;a&&(d--,C.push(n[0].x,n[0].y,n[0].z),X=n[d].je(n[0]).length(),Q=X+L[i],F[i].push(Q),L[i]=Q),S[i]=E+q,h[i]=s,s+=E+q}let t,V,k=null,N=null;for(Y=0;Y<o+q;Y++)for(z[Y]=0,f[Y]=[0],i=0;i<M.length-1+m;i++)I=M[i],v=i===M.length-1?M[0]:M[i+1],Y===o?(k=I[0],N=v[0]):(k=I[Y],N=v[Y]),X=N.je(k).length(),Q=X+z[Y],f[Y].push(Q),z[Y]=Q;if(P)for(i=0;i<P.length;i++)J.push(P[i].x,y.c?1-P[i].y:P[i].y);else for(i=0;i<M.length+m;i++)for(Y=0;Y<o+q;Y++)t=0!=L[i]?F[i][Y]/L[i]:0,V=0!=z[Y]?f[Y][i]/z[Y]:0,A?J.push(V,t):J.push(t,y.c?1-V:V);i=0;let R=0,j=S[i]-1,p=S[i+1]-1,g=j<p?j:p,K=h[1]-h[0];const w=S.length-1;for(;R<=g&&i<w;)r.push(R,R+K,R+1),r.push(R+K+1,R+1,R+K),R+=1,R===g&&(i++,K=h[i+1]-h[i],j=S[i]-1,p=S[i+1]-1,R=h[i],g=j<p?j+R:p+R);if(W.c.ComputeNormals(C,r,B),a){let U=0,b=0;for(i=0;i<M.length;i++){U=3*h[i],b=i+1<M.length?3*(h[i+1]-1):B.length-3,B[U]=.5*(B[U]+B[b]),B[U+1]=.5*(B[U+1]+B[b+1]),B[U+2]=.5*(B[U+2]+B[b+2]);const a=Math.sqrt(B[U]*B[U]+B[U+1]*B[U+1]+B[U+2]*B[U+2]);B[U]/=a,B[U+1]/=a,B[U+2]/=a,B[b]=B[U],B[b+1]=B[U+1],B[b+2]=B[U+2]}}if(b){let U=3*h[0],b=3*h[M.length];for(Y=0;Y<o+q;Y++){B[U]=.5*(B[U]+B[b]),B[U+1]=.5*(B[U+1]+B[b+1]),B[U+2]=.5*(B[U+2]+B[b+2]);const M=Math.sqrt(B[U]*B[U]+B[U+1]*B[U+1]+B[U+2]*B[U+2]);B[U]/=M,B[U+1]/=M,B[U+2]/=M,B[b]=B[U],B[b+1]=B[U+1],B[b+2]=B[U+2],U+=3,b+=3}}W.c._ComputeSides(x,C,r,B,J,U.frontUVs,U.backUVs);let T=null;if(Z){T=new Float32Array(4*Z.length);for(let U=0;U<Z.length;U++)T[4*U]=Z[U].r,T[4*U+1]=Z[U].g,T[4*U+2]=Z[U].b,T[4*U+3]=Z[U].a}const G=new W.c,l=new Float32Array(C),D=new Float32Array(B),u=new Float32Array(J);return G.indices=r,G.xa=l,G.ya=D,G.Aa=u,T&&G.set(T,H.e.ColorKind),a&&(G._idx=h),G}function e(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=M.pathArray,x=M.closeArray,P=M.closePath,Z=A.c._GetDefaultSideOrientation(M.sideOrientation),C=M.instance,r=M.updatable;if(C){const U=a.g.lk[0].mk(Number.MAX_VALUE),b=a.g.lk[1].mk(-Number.MAX_VALUE),O=M=>{let a=e[0].length;const H=C;let W=0;const y=H._originalBuilderSideOrientation===A.c.DOUBLESIDE?2:1;for(let A=1;A<=y;++A)for(let y=0;y<e.length;++y){const A=e[y],O=A.length;a=a<O?a:O;for(let H=0;H<a;++H){const a=A[H];M[W]=a.x,M[W+1]=a.y,M[W+2]=a.z,U.minimizeInPlaceFromFloats(a.x,a.y,a.z),b.maximizeInPlaceFromFloats(a.x,a.y,a.z),W+=3}if(H._creationDataStorage&&H._creationDataStorage.closePath){const U=A[0];M[W]=U.x,M[W+1]=U.y,M[W+2]=U.z,W+=3}}},x=C.getVerticesData(H.e.PositionKind);if(O(x),C.hasBoundingInfo?C.getBoundingInfo().reConstruct(U,b,C._worldMatrix):C.buildBoundingInfo(U,b,C._worldMatrix),C.updateVerticesData(H.e.PositionKind,x,!1,!1),M.za){const U=C.getVerticesData(H.e.ColorKind);for(let b=0,a=0;b<M.za.length;b++,a+=4){const A=M.za[b];U[a]=A.r,U[a+1]=A.g,U[a+2]=A.b,U[a+3]=A.a}C.updateVerticesData(H.e.ColorKind,U,!1,!1)}if(M.Aa){const U=C.getVerticesData(H.e.UVKind);for(let b=0;b<M.Aa.length;b++)U[2*b]=M.Aa[b].x,U[2*b+1]=y.c?1-M.Aa[b].y:M.Aa[b].y;C.updateVerticesData(H.e.UVKind,U,!1,!1)}if(!C.areNormalsFrozen||C.isFacetDataEnabled){const U=C.kk(),M=C.getVerticesData(H.e.NormalKind),b=C.isFacetDataEnabled?C.getFacetDataParameters():null;if(W.c.ComputeNormals(x,U,M,b),C._creationDataStorage&&C._creationDataStorage.closePath){let U=0,b=0;for(let a=0;a<e.length;a++)U=3*C._creationDataStorage.idx[a],b=a+1<e.length?3*(C._creationDataStorage.idx[a+1]-1):M.length-3,M[U]=.5*(M[U]+M[b]),M[U+1]=.5*(M[U+1]+M[b+1]),M[U+2]=.5*(M[U+2]+M[b+2]),M[b]=M[U],M[b+1]=M[U+1],M[b+2]=M[U+2]}C.areNormalsFrozen||C.updateVerticesData(H.e.NormalKind,M,!1,!1)}return C}{const a=new A.c(U,b);a._originalBuilderSideOrientation=Z,a._creationDataStorage=new A.f;const H=O(M);return P&&(a._creationDataStorage.idx=H._idx),a._creationDataStorage.closePath=P,a._creationDataStorage.closeArray=x,H.Ca(a,r),a}}W.c.CreateRibbon=O,A.c.CreateRibbon=function(U,M){return e(U,{pathArray:M,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var x=b(842),P=b(12254),Z=b(707);function C(U){const M=U.pattern||A.c.NO_FLIP,b=U.tileWidth||U.tileSize||1,a=U.tileHeight||U.tileSize||1,H=U.alignHorizontal||0,y=U.alignVertical||0,O=U.width||U.size||1,e=Math.floor(O/b);let x=O-e*b;const P=U.height||U.size||1,Z=Math.floor(P/a);let C=P-Z*a;const r=b*e/2,B=a*Z/2;let J=0,F=0,f=0,L=0,z=0,o=0;if(x>0||C>0){switch(f=-r,L=-B,z=r,o=B,H){case A.c.CENTER:x/=2,f-=x,z+=x;break;case A.c.LEFT:z+=x,J=-x/2;break;case A.c.RIGHT:f-=x,J=x/2}switch(y){case A.c.CENTER:C/=2,L-=C,o+=C;break;case A.c.BOTTOM:o+=C,F=-C/2;break;case A.c.TOP:L-=C,F=C/2}}const S=[],h=[],i=[];i[0]=[0,0,1,0,1,1,0,1],i[1]=[0,0,1,0,1,1,0,1],M!==A.c.ROTATE_TILE&&M!==A.c.ROTATE_ROW||(i[1]=[1,1,0,1,0,0,1,0]),M!==A.c.FLIP_TILE&&M!==A.c.FLIP_ROW||(i[1]=[1,0,0,0,0,1,1,1]),M!==A.c.FLIP_N_ROTATE_TILE&&M!==A.c.FLIP_N_ROTATE_ROW||(i[1]=[0,1,1,1,1,0,0,0]);let Y=[];const d=[],s=[];let q=0;for(let W=0;W<Z;W++)for(let U=0;U<e;U++)S.push(U*b-r+J,W*a-B+F,0),S.push((U+1)*b-r+J,W*a-B+F,0),S.push((U+1)*b-r+J,(W+1)*a-B+F,0),S.push(U*b-r+J,(W+1)*a-B+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),Y=M===A.c.FLIP_TILE||M===A.c.ROTATE_TILE||M===A.c.FLIP_N_ROTATE_TILE?Y.concat(i[(U%2+W%2)%2]):M===A.c.FLIP_ROW||M===A.c.ROTATE_ROW||M===A.c.FLIP_N_ROTATE_ROW?Y.concat(i[W%2]):Y.concat(i[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),q+=4;if(x>0||C>0){const U=C>0&&(y===A.c.CENTER||y===A.c.TOP),W=C>0&&(y===A.c.CENTER||y===A.c.BOTTOM),O=x>0&&(H===A.c.CENTER||H===A.c.RIGHT),P=x>0&&(H===A.c.CENTER||H===A.c.LEFT);let i,m,n,E,X=[];if(U&&O&&(S.push(f+J,L+F,0),S.push(-r+J,L+F,0),S.push(-r+J,L+C+F,0),S.push(f+J,L+C+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,i=1-x/b,m=1-C/a,n=1,E=1,X=[i,m,n,m,n,E,i,E],M===A.c.ROTATE_ROW&&(X=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),M===A.c.FLIP_ROW&&(X=[1-i,m,1-n,m,1-n,E,1-i,E]),M===A.c.FLIP_N_ROTATE_ROW&&(X=[i,1-m,n,1-m,n,1-E,i,1-E]),Y=Y.concat(X),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&P&&(S.push(r+J,L+F,0),S.push(z+J,L+F,0),S.push(z+J,L+C+F,0),S.push(r+J,L+C+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,i=0,m=1-C/a,n=x/b,E=1,X=[i,m,n,m,n,E,i,E],(M===A.c.ROTATE_ROW||M===A.c.ROTATE_TILE&&e%2===0)&&(X=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),(M===A.c.FLIP_ROW||M===A.c.FLIP_TILE&&e%2===0)&&(X=[1-i,m,1-n,m,1-n,E,1-i,E]),(M===A.c.FLIP_N_ROTATE_ROW||M===A.c.FLIP_N_ROTATE_TILE&&e%2===0)&&(X=[i,1-m,n,1-m,n,1-E,i,1-E]),Y=Y.concat(X),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),W&&O&&(S.push(f+J,B+F,0),S.push(-r+J,B+F,0),S.push(-r+J,o+F,0),S.push(f+J,o+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,i=1-x/b,m=0,n=1,E=C/a,X=[i,m,n,m,n,E,i,E],(M===A.c.ROTATE_ROW&&Z%2===1||M===A.c.ROTATE_TILE&&Z%1===0)&&(X=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),(M===A.c.FLIP_ROW&&Z%2===1||M===A.c.FLIP_TILE&&Z%2===0)&&(X=[1-i,m,1-n,m,1-n,E,1-i,E]),(M===A.c.FLIP_N_ROTATE_ROW&&Z%2===1||M===A.c.FLIP_N_ROTATE_TILE&&Z%2===0)&&(X=[i,1-m,n,1-m,n,1-E,i,1-E]),Y=Y.concat(X),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),W&&P&&(S.push(r+J,B+F,0),S.push(z+J,B+F,0),S.push(z+J,o+F,0),S.push(r+J,o+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,i=0,m=0,n=x/b,E=C/a,X=[i,m,n,m,n,E,i,E],(M===A.c.ROTATE_ROW&&Z%2===1||M===A.c.ROTATE_TILE&&(Z+e)%2===1)&&(X=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),(M===A.c.FLIP_ROW&&Z%2===1||M===A.c.FLIP_TILE&&(Z+e)%2===1)&&(X=[1-i,m,1-n,m,1-n,E,1-i,E]),(M===A.c.FLIP_N_ROTATE_ROW&&Z%2===1||M===A.c.FLIP_N_ROTATE_TILE&&(Z+e)%2===1)&&(X=[i,1-m,n,1-m,n,1-E,i,1-E]),Y=Y.concat(X),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U){const U=[];i=0,m=1-C/a,n=1,E=1,U[0]=[i,m,n,m,n,E,i,E],U[1]=[i,m,n,m,n,E,i,E],M!==A.c.ROTATE_TILE&&M!==A.c.ROTATE_ROW||(U[1]=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),M!==A.c.FLIP_TILE&&M!==A.c.FLIP_ROW||(U[1]=[1-i,m,1-n,m,1-n,E,1-i,E]),M!==A.c.FLIP_N_ROTATE_TILE&&M!==A.c.FLIP_N_ROTATE_ROW||(U[1]=[i,1-m,n,1-m,n,1-E,i,1-E]);for(let a=0;a<e;a++)S.push(a*b-r+J,L+F,0),S.push((a+1)*b-r+J,L+F,0),S.push((a+1)*b-r+J,L+C+F,0),S.push(a*b-r+J,L+C+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,Y=M===A.c.FLIP_TILE||M===A.c.ROTATE_TILE||M===A.c.FLIP_N_ROTATE_TILE?Y.concat(U[(a+1)%2]):M===A.c.FLIP_ROW||M===A.c.ROTATE_ROW||M===A.c.FLIP_N_ROTATE_ROW?Y.concat(U[1]):Y.concat(U[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(W){const U=[];i=0,m=0,n=1,E=C/a,U[0]=[i,m,n,m,n,E,i,E],U[1]=[i,m,n,m,n,E,i,E],M!==A.c.ROTATE_TILE&&M!==A.c.ROTATE_ROW||(U[1]=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),M!==A.c.FLIP_TILE&&M!==A.c.FLIP_ROW||(U[1]=[1-i,m,1-n,m,1-n,E,1-i,E]),M!==A.c.FLIP_N_ROTATE_TILE&&M!==A.c.FLIP_N_ROTATE_ROW||(U[1]=[i,1-m,n,1-m,n,1-E,i,1-E]);for(let a=0;a<e;a++)S.push(a*b-r+J,o-C+F,0),S.push((a+1)*b-r+J,o-C+F,0),S.push((a+1)*b-r+J,o+F,0),S.push(a*b-r+J,o+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,Y=M===A.c.FLIP_TILE||M===A.c.ROTATE_TILE||M===A.c.FLIP_N_ROTATE_TILE?Y.concat(U[(a+Z)%2]):M===A.c.FLIP_ROW||M===A.c.ROTATE_ROW||M===A.c.FLIP_N_ROTATE_ROW?Y.concat(U[Z%2]):Y.concat(U[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const U=[];i=1-x/b,m=0,n=1,E=1,U[0]=[i,m,n,m,n,E,i,E],U[1]=[i,m,n,m,n,E,i,E],M!==A.c.ROTATE_TILE&&M!==A.c.ROTATE_ROW||(U[1]=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),M!==A.c.FLIP_TILE&&M!==A.c.FLIP_ROW||(U[1]=[1-i,m,1-n,m,1-n,E,1-i,E]),M!==A.c.FLIP_N_ROTATE_TILE&&M!==A.c.FLIP_N_ROTATE_ROW||(U[1]=[i,1-m,n,1-m,n,1-E,i,1-E]);for(let b=0;b<Z;b++)S.push(f+J,b*a-B+F,0),S.push(f+x+J,b*a-B+F,0),S.push(f+x+J,(b+1)*a-B+F,0),S.push(f+J,(b+1)*a-B+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,Y=M===A.c.FLIP_TILE||M===A.c.ROTATE_TILE||M===A.c.FLIP_N_ROTATE_TILE?Y.concat(U[(b+1)%2]):M===A.c.FLIP_ROW||M===A.c.ROTATE_ROW||M===A.c.FLIP_N_ROTATE_ROW?Y.concat(U[b%2]):Y.concat(U[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const U=[];i=0,m=0,n=x/a,E=1,U[0]=[i,m,n,m,n,E,i,E],U[1]=[i,m,n,m,n,E,i,E],M!==A.c.ROTATE_TILE&&M!==A.c.ROTATE_ROW||(U[1]=[1-i,1-m,1-n,1-m,1-n,1-E,1-i,1-E]),M!==A.c.FLIP_TILE&&M!==A.c.FLIP_ROW||(U[1]=[1-i,m,1-n,m,1-n,E,1-i,E]),M!==A.c.FLIP_N_ROTATE_TILE&&M!==A.c.FLIP_N_ROTATE_ROW||(U[1]=[i,1-m,n,1-m,n,1-E,i,1-E]);for(let b=0;b<Z;b++)S.push(z-x+J,b*a-B+F,0),S.push(z+J,b*a-B+F,0),S.push(z+J,(b+1)*a-B+F,0),S.push(z-x+J,(b+1)*a-B+F,0),s.push(q,q+1,q+3,q+1,q+2,q+3),q+=4,Y=M===A.c.FLIP_TILE||M===A.c.ROTATE_TILE||M===A.c.FLIP_N_ROTATE_TILE?Y.concat(U[(b+e)%2]):M===A.c.FLIP_ROW||M===A.c.ROTATE_ROW||M===A.c.FLIP_N_ROTATE_ROW?Y.concat(U[b%2]):Y.concat(U[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),h.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const m=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE;W.c._ComputeSides(m,S,s,h,Y,U.frontUVs,U.backUVs);const n=new W.c;n.indices=s,n.xa=S,n.ya=h,n.Aa=Y;const E=m===W.c.DOUBLESIDE?d.concat(d):d;return n.za=E,n}function r(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return C(M).Ca(a,M.updatable),a}function B(U){const M=U.faceUV||new Array(6),b=U.faceColors,H=U.pattern||A.c.NO_FLIP,O=U.width||U.size||1,e=U.height||U.size||1,x=U.depth||U.size||1,P=U.tileWidth||U.tileSize||1,r=U.tileHeight||U.tileSize||1,B=U.alignHorizontal||0,J=U.alignVertical||0,F=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE;for(let A=0;A<6;A++)void 0===M[A]&&(M[A]=new a.n(0,0,1,1)),b&&void 0===b[A]&&(b[A]=new Z.e(1,1,1,1));const f=O/2,L=e/2,z=x/2,o=[];for(let a=0;a<2;a++)o[a]=C({pattern:H,tileWidth:P,tileHeight:r,width:O,height:e,alignVertical:J,alignHorizontal:B,sideOrientation:F});for(let a=2;a<4;a++)o[a]=C({pattern:H,tileWidth:P,tileHeight:r,width:x,height:e,alignVertical:J,alignHorizontal:B,sideOrientation:F});let S=J;J===A.c.BOTTOM?S=A.c.TOP:J===A.c.TOP&&(S=A.c.BOTTOM);for(let a=4;a<6;a++)o[a]=C({pattern:H,tileWidth:P,tileHeight:r,width:O,height:x,alignVertical:S,alignHorizontal:B,sideOrientation:F});let h=[],i=[],Y=[],d=[];const s=[],q=[],m=[],n=[];let E=0,X=0;for(let A=0;A<6;A++){const U=o[A].xa.length;q[A]=[],m[A]=[];for(let M=0;M<U/3;M++)q[A].push(new a.l(o[A].xa[3*M],o[A].xa[3*M+1],o[A].xa[3*M+2])),m[A].push(new a.l(o[A].ya[3*M],o[A].ya[3*M+1],o[A].ya[3*M+2]));E=o[A].Aa.length,n[A]=[];for(let b=0;b<E;b+=2)n[A][b]=M[A].x+(M[A].z-M[A].x)*o[A].Aa[b],n[A][b+1]=M[A].y+(M[A].w-M[A].y)*o[A].Aa[b+1],y.c&&(n[A][b+1]=1-n[A][b+1]);if(Y=Y.concat(n[A]),d=d.concat(o[A].indices.map((U=>U+X))),X+=q[A].length,b)for(let M=0;M<4;M++)s.push(b[A].r,b[A].g,b[A].b,b[A].a)}const Q=new a.l(0,0,z),I=a.b.RotationY(Math.PI);h=q[0].map((U=>a.l.TransformNormal(U,I).add(Q))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[]),i=m[0].map((U=>a.l.TransformNormal(U,I))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[]),h=h.concat(q[1].map((U=>U.je(Q))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[])),i=i.concat(m[1].map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[]));const v=new a.l(f,0,0),t=a.b.RotationY(-Math.PI/2);h=h.concat(q[2].map((U=>a.l.TransformNormal(U,t).add(v))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[])),i=i.concat(m[2].map((U=>a.l.TransformNormal(U,t))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[]));const V=a.b.RotationY(Math.PI/2);h=h.concat(q[3].map((U=>a.l.TransformNormal(U,V).je(v))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[])),i=i.concat(m[3].map((U=>a.l.TransformNormal(U,V))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[]));const k=new a.l(0,L,0),N=a.b.RotationX(Math.PI/2);h=h.concat(q[4].map((U=>a.l.TransformNormal(U,N).add(k))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[])),i=i.concat(m[4].map((U=>a.l.TransformNormal(U,N))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[]));const R=a.b.RotationX(-Math.PI/2);h=h.concat(q[5].map((U=>a.l.TransformNormal(U,R).je(k))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[])),i=i.concat(m[5].map((U=>a.l.TransformNormal(U,R))).map((U=>[U.x,U.y,U.z])).reduce(((U,M)=>U.concat(M)),[])),W.c._ComputeSides(F,h,d,i,Y);const j=new W.c;if(j.indices=d,j.xa=h,j.ya=i,j.Aa=Y,b){const U=F===W.c.DOUBLESIDE?s.concat(s):s;j.za=U}return j}function J(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return B(M).Ca(a,M.updatable),a}W.c.CreateTiledPlane=C;W.c.CreateTiledBox=B;var F=b(12398),f=b(2492),L=b(808);function z(U){const M=U.height||2;let b=0===U.diameterTop?0:U.diameterTop||U.diameter||1,H=0===U.diameterBottom?0:U.diameterBottom||U.diameter||1;b=b||1e-5,H=H||1e-5;const O=0|(U.tessellation||24),e=0|(U.subdivisions||1),x=!!U.hasRings,P=!!U.enclose,C=0===U.cap?0:U.cap||A.c.CAP_ALL,r=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,B=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE,J=U.faceUV||new Array(3),F=U.faceColors,f=2+(1+(1!==r&&P?2:0))*(x?e:1);let z;for(z=0;z<f;z++)F&&void 0===F[z]&&(F[z]=new Z.e(1,1,1,1));for(z=0;z<f;z++)J&&void 0===J[z]&&(J[z]=new a.n(0,0,1,1));const o=[],S=[],h=[],i=[],Y=[],d=2*Math.PI*r/O;let s,q,m;const n=(H-b)/2/M,E=a.l.Zero(),X=a.l.Zero(),Q=a.l.Zero(),I=a.l.Zero(),v=a.l.Zero(),t=L.b.Y;let V,k,N,R=1,j=1,p=0,g=0;for(V=0;V<=e;V++)for(q=V/e,m=(q*(b-H)+H)/2,R=x&&0!==V&&V!==e?2:1,N=0;N<R;N++){for(x&&(j+=N),P&&(j+=2*N),k=0;k<=O;k++)s=k*d,E.x=Math.cos(-s)*m,E.y=-M/2+q*M,E.z=Math.sin(-s)*m,0===b&&V===e?(X.x=h[h.length-3*(O+1)],X.y=h[h.length-3*(O+1)+1],X.z=h[h.length-3*(O+1)+2]):(X.x=E.x,X.z=E.z,X.y=Math.sqrt(X.x*X.x+X.z*X.z)*n,X.normalize()),0===k&&(Q.p(E),I.p(X)),S.push(E.x,E.y,E.z),h.push(X.x,X.y,X.z),g=x?p!==j?J[j].y:J[j].w:J[j].y+(J[j].w-J[j].y)*q,i.push(J[j].x+(J[j].z-J[j].x)*k/O,y.c?1-g:g),F&&Y.push(F[j].r,F[j].g,F[j].b,F[j].a);1!==r&&P&&(S.push(E.x,E.y,E.z),S.push(0,E.y,0),S.push(0,E.y,0),S.push(Q.x,Q.y,Q.z),a.l.CrossToRef(t,X,v),v.normalize(),h.push(v.x,v.y,v.z,v.x,v.y,v.z),a.l.CrossToRef(I,t,v),v.normalize(),h.push(v.x,v.y,v.z,v.x,v.y,v.z),g=x?p!==j?J[j+1].y:J[j+1].w:J[j+1].y+(J[j+1].w-J[j+1].y)*q,i.push(J[j+1].x,y.c?1-g:g),i.push(J[j+1].z,y.c?1-g:g),g=x?p!==j?J[j+2].y:J[j+2].w:J[j+2].y+(J[j+2].w-J[j+2].y)*q,i.push(J[j+2].x,y.c?1-g:g),i.push(J[j+2].z,y.c?1-g:g),F&&(Y.push(F[j+1].r,F[j+1].g,F[j+1].b,F[j+1].a),Y.push(F[j+1].r,F[j+1].g,F[j+1].b,F[j+1].a),Y.push(F[j+2].r,F[j+2].g,F[j+2].b,F[j+2].a),Y.push(F[j+2].r,F[j+2].g,F[j+2].b,F[j+2].a))),p!==j&&(p=j)}const K=1!==r&&P?O+4:O;for(V=0,j=0;j<e;j++){let U=0,M=0,b=0,a=0;for(k=0;k<O;k++)U=V*(K+1)+k,M=(V+1)*(K+1)+k,b=V*(K+1)+(k+1),a=(V+1)*(K+1)+(k+1),o.push(U,M,b),o.push(a,b,M);1!==r&&P&&(o.push(U+2,M+2,b+2),o.push(a+2,b+2,M+2),o.push(U+4,M+4,b+4),o.push(a+4,b+4,M+4)),V=x?V+2:V+1}const w=U=>{const A=U?b/2:H/2;if(0===A)return;let W,e,x;const P=U?J[f-1]:J[0];let Z=null;F&&(Z=U?F[f-1]:F[0]);const C=S.length/3,B=U?M/2:-M/2,L=new a.l(0,B,0);S.push(L.x,L.y,L.z),h.push(0,U?1:-1,0);const z=P.y+.5*(P.w-P.y);i.push(P.x+.5*(P.z-P.x),y.c?1-z:z),Z&&Y.push(Z.r,Z.g,Z.b,Z.a);const d=new a.i(.5,.5);for(x=0;x<=O;x++){W=2*Math.PI*x*r/O;const M=Math.cos(-W),b=Math.sin(-W);e=new a.l(M*A,B,b*A);const H=new a.i(M*d.x+.5,b*d.y+.5);S.push(e.x,e.y,e.z),h.push(0,U?1:-1,0);const C=P.y+(P.w-P.y)*H.y;i.push(P.x+(P.z-P.x)*H.x,y.c?1-C:C),Z&&Y.push(Z.r,Z.g,Z.b,Z.a)}for(x=0;x<O;x++)U?(o.push(C),o.push(C+(x+2)),o.push(C+(x+1))):(o.push(C),o.push(C+(x+1)),o.push(C+(x+2)))};C!==A.c.CAP_START&&C!==A.c.CAP_ALL||w(!1),C!==A.c.CAP_END&&C!==A.c.CAP_ALL||w(!0),W.c._ComputeSides(B,S,o,h,i,U.frontUVs,U.backUVs);const T=new W.c;return T.indices=o,T.xa=S,T.ya=h,T.Aa=i,F&&(T.za=Y),T}function o(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return z(M).Ca(a,M.updatable),a}function S(U){const M=[],b=[],A=[],H=[],O=U.diameter||1,e=U.thickness||.5,x=0|(U.tessellation||16),P=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE,Z=x+1;for(let W=0;W<=x;W++){const U=W/x,P=W*Math.PI*2/x-Math.PI/2,C=a.b.Translation(O/2,0,0).multiply(a.b.RotationY(P));for(let O=0;O<=x;O++){const P=1-O/x,r=O*Math.PI*2/x+Math.PI,B=Math.cos(r),J=Math.sin(r);let F=new a.l(B,J,0),f=F.scale(e/2);const L=new a.i(U,P);f=a.l.TransformCoordinates(f,C),F=a.l.TransformNormal(F,C),b.push(f.x,f.y,f.z),A.push(F.x,F.y,F.z),H.push(L.x,y.c?1-L.y:L.y);const z=(W+1)%Z,o=(O+1)%Z;M.push(W*Z+O),M.push(W*Z+o),M.push(z*Z+O),M.push(W*Z+o),M.push(z*Z+o),M.push(z*Z+O)}}W.c._ComputeSides(P,b,M,A,H,U.frontUVs,U.backUVs);const C=new W.c;return C.indices=M,C.xa=b,C.ya=A,C.Aa=H,C}function h(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return S(M).Ca(a,M.updatable),a}W.c.CreateCylinder=z,A.c.CreateCylinder=(U,M,b,a,H,W,y,O,e)=>{void 0!==y&&y instanceof f.b||(void 0!==y&&(e=O||A.c.DEFAULTSIDE,O=y),y=W,W=1);return o(U,{height:M,diameterTop:b,diameterBottom:a,tessellation:H,subdivisions:W,sideOrientation:e,updatable:O},y)};function i(U){const M=[],b=[],A=[],H=[],O=U.radius||2,e=U.tube||.5,x=U.radialSegments||32,P=U.tubularSegments||32,Z=U.p||2,C=U.q||3,r=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE,B=U=>{const M=Math.cos(U),b=Math.sin(U),A=C/Z*U,H=Math.cos(A),W=O*(2+H)*.5*M,y=O*(2+H)*b*.5,e=O*Math.sin(A)*.5;return new a.l(W,y,e)};let J,F;for(J=0;J<=x;J++){const U=J%x/x*2*Z*Math.PI,M=B(U),A=B(U+.01),W=A.je(M);let O=A.add(M);const C=a.l.Cross(W,O);for(O=a.l.Cross(C,W),C.normalize(),O.normalize(),F=0;F<P;F++){const U=F%P/P*2*Math.PI,a=-e*Math.cos(U),A=e*Math.sin(U);b.push(M.x+a*O.x+A*C.x),b.push(M.y+a*O.y+A*C.y),b.push(M.z+a*O.z+A*C.z),H.push(J/x),H.push(y.c?1-F/P:F/P)}}for(J=0;J<x;J++)for(F=0;F<P;F++){const U=(F+1)%P,b=J*P+F,a=(J+1)*P+F,A=(J+1)*P+U,H=J*P+U;M.push(H),M.push(a),M.push(b),M.push(H),M.push(A),M.push(a)}W.c.ComputeNormals(b,M,A),W.c._ComputeSides(r,b,M,A,H,U.frontUVs,U.backUVs);const f=new W.c;return f.indices=M,f.xa=b,f.ya=A,f.Aa=H,f}function Y(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return i(M).Ca(a,M.updatable),a}W.c.CreateTorus=S,A.c.CreateTorus=(U,M,b,a,A,H,W)=>h(U,{diameter:M,thickness:b,tessellation:a,sideOrientation:W,updatable:H},A);W.c.CreateTorusKnot=i,A.c.CreateTorusKnot=(U,M,b,a,A,H,W,y,O,e)=>Y(U,{radius:M,tube:b,radialSegments:a,tubularSegments:A,p:H,q:W,sideOrientation:e,updatable:O},y);var d=b(12943),s=b(497),q=b(2340),m=b(677),n=b(524);class E extends a.i{constructor(U,M){super(U.x,U.y),this.index=M}}class X{constructor(){this.elements=[]}add(U){const M=[];for(const b of U){const U=new E(b,this.elements.length);M.push(U),this.elements.push(U)}return M}computeBounds(){const U=new a.i(this.elements[0].x,this.elements[0].y),M=new a.i(this.elements[0].x,this.elements[0].y);for(const b of this.elements)b.x<U.x?U.x=b.x:b.x>M.x&&(M.x=b.x),b.y<U.y?U.y=b.y:b.y>M.y&&(M.y=b.y);return{min:U,max:M,width:M.x-U.x,height:M.y-U.y}}}class Q{_addToepoint(U){for(const M of U)this._epoints.push(M.x,M.y)}constructor(U,M,b){let a,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new X,this._outlinepoints=new X,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=A,this._name=U,this._scene=b||n.d.LastCreatedScene,a=M instanceof q.f?M.getPoints():M,this._addToepoint(a),this._points.add(a),this._outlinepoints.add(a),"undefined"===typeof this.bjsEarcut&&s.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(U){this._points.add(U);const M=new X;return M.add(U),this._holes.push(M),this._eholes.push(this._epoints.length/2),this._addToepoint(U),this}build(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const a=new A.c(this._name,this._scene),W=this.buildVertexData(M,b);return a.Ga(H.e.PositionKind,W.xa,U),a.Ga(H.e.NormalKind,W.ya,U),a.Ga(H.e.UVKind,W.Aa,U),a.setIndices(W.indices),a}buildVertexData(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=new W.c,a=[],A=[],H=[],y=this._points.computeBounds();for(const W of this._points.elements)a.push(0,1,0),A.push(W.x,0,W.y),H.push((W.x-y.min.x)/y.width,(W.y-y.min.y)/y.height);const O=[],e=this.bjsEarcut(this._epoints,this._eholes,2);for(let W=0;W<e.length;W++)O.push(e[W]);if(U>0){const b=A.length/3;for(const M of this._points.elements)a.push(0,-1,0),A.push(M.x,-U,M.y),H.push(1-(M.x-y.min.x)/y.width,1-(M.y-y.min.y)/y.height);const W=O.length;for(let U=0;U<W;U+=3){const M=O[U+0],a=O[U+1],A=O[U+2];O.push(A+b),O.push(a+b),O.push(M+b)}this._addSide(A,a,H,O,y,this._outlinepoints,U,!1,M);for(const e of this._holes)this._addSide(A,a,H,O,y,e,U,!0,M)}return b.indices=O,b.xa=A,b.ya=a,b.Aa=H,b}_addSide(U,M,b,A,H,W,y,O,e){let x=U.length/3,P=0;for(let Z=0;Z<W.elements.length;Z++){const C=W.elements[Z],r=W.elements[(Z+1)%W.elements.length];U.push(C.x,0,C.y),U.push(C.x,-y,C.y),U.push(r.x,0,r.y),U.push(r.x,-y,r.y);const B=W.elements[(Z+W.elements.length-1)%W.elements.length],J=W.elements[(Z+2)%W.elements.length];let F=new a.l(-(r.y-C.y),0,r.x-C.x),f=new a.l(-(C.y-B.y),0,C.x-B.x),L=new a.l(-(J.y-r.y),0,J.x-r.x);O||(F=F.scale(-1),f=f.scale(-1),L=L.scale(-1));const z=F.normalizeToNew();let o=f.normalizeToNew(),S=L.normalizeToNew();const h=a.l.Dot(o,z);o=h>e?h<m.b-1?new a.l(C.x,0,C.y).je(new a.l(r.x,0,r.y)).normalize():f.add(F).normalize():z;const i=a.l.Dot(L,F);S=i>e?i<m.b-1?new a.l(r.x,0,r.y).je(new a.l(C.x,0,C.y)).normalize():L.add(F).normalize():z,b.push(P/H.width,0),b.push(P/H.width,1),P+=F.length(),b.push(P/H.width,0),b.push(P/H.width,1),M.push(o.x,o.y,o.z),M.push(o.x,o.y,o.z),M.push(S.x,S.y,S.z),M.push(S.x,S.y,S.z),O?(A.push(x),A.push(x+2),A.push(x+1),A.push(x+1),A.push(x+2),A.push(x+3)):(A.push(x),A.push(x+1),A.push(x+2),A.push(x+1),A.push(x+3),A.push(x+2)),x+=4}}}function I(U,M,b,A,O,e,x){const P=b||new Array(3),C=A,r=[],B=x||!1;for(let H=0;H<3;H++)void 0===P[H]&&(P[H]=new a.n(0,0,1,1)),C&&void 0===C[H]&&(C[H]=new Z.e(1,1,1,1));const J=U.getVerticesData(H.e.PositionKind),F=U.getVerticesData(H.e.NormalKind),f=U.getVerticesData(H.e.UVKind),L=U.kk(),z=J.length/9;let o=0,S=0,h=0,i=0,Y=0;const d=[0];if(B)for(let a=z;a<J.length/3;a+=4)S=J[3*(a+2)]-J[3*a],h=J[3*(a+2)+2]-J[3*a+2],i=Math.sqrt(S*S+h*h),Y+=i,d.push(Y);let s=0,q=0;for(let a=0;a<F.length;a+=3)Math.abs(F[a+1])<.001&&(q=1),Math.abs(F[a+1]-1)<.001&&(q=0),Math.abs(F[a+1]+1)<.001&&(q=2),s=a/3,1===q?(o=s-z,f[2*s]=o%4<1.5?B?P[q].x+(P[q].z-P[q].x)*d[Math.floor(o/4)]/Y:P[q].x:B?P[q].x+(P[q].z-P[q].x)*d[Math.floor(o/4)+1]/Y:P[q].z,f[2*s+1]=o%2===0?y.c?1-P[q].w:P[q].w:y.c?1-P[q].y:P[q].y):(f[2*s]=(1-f[2*s])*P[q].x+f[2*s]*P[q].z,f[2*s+1]=(1-f[2*s+1])*P[q].y+f[2*s+1]*P[q].w,y.c&&(f[2*s+1]=1-f[2*s+1])),C&&r.push(C[q].r,C[q].g,C[q].b,C[q].a);W.c._ComputeSides(M,J,L,F,f,O,e);const m=new W.c;if(m.indices=L,m.xa=J,m.ya=F,m.Aa=f,C){const U=M===W.c.DOUBLESIDE?r.concat(r):r;m.za=U}return m}function v(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation);const W=M.shape,y=M.holes||[],O=M.depth||0,e=M.smoothingThreshold||2,x=[];let P=[];for(let A=0;A<W.length;A++)x[A]=new a.i(W[A].x,W[A].z);x[0].equalsWithEpsilon(x[x.length-1],1e-8)&&x.pop();const Z=new Q(U,x,b||n.d.LastCreatedScene,H);for(let A=0;A<y.length;A++){P=[];for(let U=0;U<y[A].length;U++)P.push(new a.i(y[A][U].x,y[A][U].z));Z.addHole(P)}const C=Z.build(!1,O,e);C._originalBuilderSideOrientation=M.sideOrientation;return I(C,M.sideOrientation,M.faceUV,M.faceColors,M.frontUVs,M.backUVs,M.wrap).Ca(C,M.updatable),C}function t(U,M){return v(U,M,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function V(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=M.path,H=M.shape,W=M.scale||1,y=M.rotation||0,O=0===M.cap?0:M.cap||A.c.NO_CAP,e=M.updatable,x=A.c._GetDefaultSideOrientation(M.sideOrientation),P=M.instance||null,Z=M.invertUV||!1,C=M.closeShape||!1,r=M.closePath||!1,B=M.capFunction||null;return N(U,H,a,W,y,null,null,r,C,O,!1,b,!!e,x,P,Z,M.frontUVs||null,M.backUVs||null,M.firstNormal||null,!!M.adjustFrame,B)}function k(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=M.path,H=M.shape,W=M.scaleFunction||(()=>1),y=M.rotationFunction||(()=>0),O=M.closePath||M.ribbonCloseArray||!1,e=M.closeShape||M.ribbonClosePath||!1,x=0===M.cap?0:M.cap||A.c.NO_CAP,P=M.updatable,Z=M.firstNormal||null,C=M.adjustFrame||!1,r=A.c._GetDefaultSideOrientation(M.sideOrientation),B=M.instance,J=M.invertUV||!1,F=M.capFunction||null;return N(U,H,a,null,null,W,y,O,e,x,!0,b,!!P,r,B||null,J,M.frontUVs||null,M.backUVs||null,Z,C,F||null)}function N(U,M,b,H,W,y,O,x,P,Z,C,r,B,J,F,f,L,z,o,S,h){const i=(U,M,b,H,W,y,O,e,x,P,Z)=>{const C=b.getTangents(),r=b.getNormals(),B=b.getBinormals(),J=b.getDistances();if(Z)for(let A=0;A<C.length;A++)if(0==C[A].x&&0==C[A].y&&0==C[A].z&&C[A].p(C[A-1]),0==r[A].x&&0==r[A].y&&0==r[A].z&&r[A].p(r[A-1]),0==B[A].x&&0==B[A].y&&0==B[A].z&&B[A].p(B[A-1]),A>0){let U=C[A-1];a.l.Dot(U,C[A])<0&&C[A].scaleInPlace(-1),U=r[A-1],a.l.Dot(U,r[A])<0&&r[A].scaleInPlace(-1),U=B[A-1],a.l.Dot(U,B[A])<0&&B[A].scaleInPlace(-1)}let F=0;const f=P&&e?e:()=>null!==y?y:0,L=P&&O?O:()=>null!==W?W:1;let z=x===A.c.NO_CAP||x===A.c.CAP_END?0:2;const o=a.g.Matrix[0];for(let A=0;A<M.length;A++){const b=[],W=f(A,J[A]),y=L(A,J[A]);a.b.RotationAxisToRef(C[A],F,o);for(let H=0;H<U.length;H++){const W=C[A].scale(U[H].z).add(r[A].scale(U[H].x)).add(B[A].scale(U[H].y)),O=a.l.Zero();a.l.TransformCoordinatesToRef(W,o,O),O.scaleInPlace(y).addInPlace(M[A]),b[H]=O}H[z]=b,F+=W,z++}const S=h||(U=>{const M=Array(),b=a.l.Zero();let A;for(A=0;A<U.length;A++)b.addInPlace(U[A]);for(b.scaleInPlace(1/U.length),A=0;A<U.length;A++)M.push(b);return M});switch(x){case A.c.NO_CAP:break;case A.c.CAP_START:H[0]=S(H[2]),H[1]=H[2];break;case A.c.CAP_END:H[z]=H[z-1],H[z+1]=S(H[z-1]);break;case A.c.CAP_ALL:H[0]=S(H[2]),H[1]=H[2],H[z]=H[z-1],H[z+1]=S(H[z-1])}return H};let Y,d;if(F){const U=F._creationDataStorage;return Y=o?U.path3D.update(b,o):U.path3D.update(b),d=i(M,b,U.path3D,U.pathArray,H,W,y,O,U.cap,C,S),F=e("",{pathArray:d,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:F},r||void 0)}Y=o?new q.g(b,o):new q.g(b);d=i(M,b,Y,new Array,H,W,y,O,Z=Z<0||Z>3?0:Z,C,S);const s=e(U,{pathArray:d,closeArray:x,closePath:P,updatable:B,sideOrientation:J,invertUV:f,frontUVs:L||void 0,backUVs:z||void 0},r);return s._creationDataStorage.pathArray=d,s._creationDataStorage.path3D=Y,s._creationDataStorage.cap=Z,s}W.c.CreatePolygon=I,A.c.CreatePolygon=function(U,M,b,a,A,H){return v(U,{shape:M,holes:a,updatable:A,sideOrientation:H},b,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},A.c.ExtrudePolygon=function(U,M,b,a,A,H,W){return t(U,{shape:M,holes:A,depth:b,updatable:H,sideOrientation:W},a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function R(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=M.arc?M.arc<=0||M.arc>1?1:M.arc:1,W=void 0===M.closed||M.closed,y=M.shape,O=M.radius||1,x=M.tessellation||64,P=M.clip||0,Z=M.updatable,C=A.c._GetDefaultSideOrientation(M.sideOrientation),r=M.cap||A.c.NO_CAP,B=2*Math.PI,J=[],F=M.invertUV||!1;let f=0,L=0;const z=B/x*H;let o,S;for(f=0;f<=x-P;f++){for(S=[],r!=A.c.CAP_START&&r!=A.c.CAP_ALL||(S.push(new a.l(0,y[0].y,0)),S.push(new a.l(Math.cos(f*z)*y[0].x*O,y[0].y,Math.sin(f*z)*y[0].x*O))),L=0;L<y.length;L++)o=new a.l(Math.cos(f*z)*y[L].x*O,y[L].y,Math.sin(f*z)*y[L].x*O),S.push(o);r!=A.c.CAP_END&&r!=A.c.CAP_ALL||(S.push(new a.l(Math.cos(f*z)*y[y.length-1].x*O,y[y.length-1].y,Math.sin(f*z)*y[y.length-1].x*O)),S.push(new a.l(0,y[y.length-1].y,0))),J.push(S)}return e(U,{pathArray:J,closeArray:W,sideOrientation:C,updatable:Z,invertUV:F,frontUVs:M.frontUVs,backUVs:M.backUVs},b)}A.c.ExtrudeShape=function(U,M,b,a,H,W){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0,e=arguments.length>8?arguments[8]:void 0,x=arguments.length>9?arguments[9]:void 0;return V(U,{shape:M,path:b,scale:a,rotation:H,cap:0===W?0:W||A.c.NO_CAP,sideOrientation:e,instance:x,updatable:O},y)},A.c.ExtrudeShapeCustom=(U,M,b,a,H,W,y,O,e,x,P,Z)=>k(U,{shape:M,path:b,scaleFunction:a,rotationFunction:H,ribbonCloseArray:W,ribbonClosePath:y,cap:0===O?0:O||A.c.NO_CAP,sideOrientation:P,instance:Z,updatable:x},e);A.c.CreateLathe=(U,M,b,a,A,H,W)=>R(U,{shape:M,radius:b,tessellation:a,sideOrientation:W,updatable:H},A);var j=b(12299),p=b(12262);function g(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=M.path;let W=M.instance,y=1;void 0!==M.radius?y=M.radius:W&&(y=W._creationDataStorage.radius);const O=M.tessellation||64,x=M.radiusFunction||null;let P=M.cap||A.c.NO_CAP;const Z=M.invertUV||!1,C=M.updatable,r=A.c._GetDefaultSideOrientation(M.sideOrientation);M.arc=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1;const B=(U,M,b,H,W,y,O,e)=>{const x=M.getTangents(),P=M.getNormals(),Z=M.getDistances(),C=2*Math.PI/W*e,r=y||(()=>H);let B,J,F,f;const L=a.g.Matrix[0];let z=O===A.c.NO_CAP||O===A.c.CAP_END?0:2;for(let A=0;A<U.length;A++){J=r(A,Z[A]),B=Array(),F=P[A];for(let M=0;M<W;M++)a.b.RotationAxisToRef(x[A],C*M,L),f=B[M]?B[M]:a.l.Zero(),a.l.TransformCoordinatesToRef(F,L,f),f.scaleInPlace(J).addInPlace(U[A]),B[M]=f;b[z]=B,z++}const o=(M,b)=>{const a=Array();for(let A=0;A<M;A++)a.push(U[b]);return a};switch(O){case A.c.NO_CAP:break;case A.c.CAP_START:b[0]=o(W,0),b[1]=b[2].slice(0);break;case A.c.CAP_END:b[z]=b[z-1].slice(0),b[z+1]=o(W,U.length-1);break;case A.c.CAP_ALL:b[0]=o(W,0),b[1]=b[2].slice(0),b[z]=b[z-1].slice(0),b[z+1]=o(W,U.length-1)}return b};let J,F;if(W){const U=W._creationDataStorage,b=M.arc||U.arc;return J=U.path3D.update(H),F=B(H,J,U.pathArray,y,U.tessellation,x,U.cap,b),W=e("",{pathArray:F,instance:W}),U.path3D=J,U.pathArray=F,U.arc=b,U.radius=y,W}J=new q.g(H);P=P<0||P>3?0:P,F=B(H,J,new Array,y,O,x,P,M.arc);const f=e(U,{pathArray:F,closePath:!0,closeArray:!1,updatable:C,sideOrientation:r,invertUV:Z,frontUVs:M.frontUVs,backUVs:M.backUVs},b);return f._creationDataStorage.pathArray=F,f._creationDataStorage.path3D=J,f._creationDataStorage.tessellation=O,f._creationDataStorage.cap=P,f._creationDataStorage.arc=M.arc,f._creationDataStorage.radius=y,f}function K(U){const M=[];M[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},M[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},M[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},M[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},M[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},M[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},M[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},M[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},M[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},M[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},M[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},M[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},M[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},M[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},M[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const b=U.type&&(U.type<0||U.type>=M.length)?0:U.type||0,A=U.size,H=U.sizeX||A||1,O=U.sizeY||A||1,e=U.sizeZ||A||1,x=U.custom||M[b],P=x.face.length,C=U.faceUV||new Array(P),r=U.faceColors,B=void 0===U.flat||U.flat,J=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE,F=[],f=[],L=[],z=[],o=[];let S=0,h=0;const i=[];let Y,d,s,q,m,n,E=0,X=0;if(B)for(X=0;X<P;X++)r&&void 0===r[X]&&(r[X]=new Z.e(1,1,1,1)),C&&void 0===C[X]&&(C[X]=new a.n(0,0,1,1));if(B)for(X=0;X<P;X++){const U=x.face[X].length;for(s=2*Math.PI/U,q=.5*Math.tan(s/2),m=.5,E=0;E<U;E++)F.push(x.vertex[x.face[X][E]][0]*H,x.vertex[x.face[X][E]][1]*O,x.vertex[x.face[X][E]][2]*e),i.push(S),S++,Y=C[X].x+(C[X].z-C[X].x)*(.5+q),d=C[X].y+(C[X].w-C[X].y)*(m-.5),z.push(Y,y.c?1-d:d),n=q*Math.cos(s)-m*Math.sin(s),m=q*Math.sin(s)+m*Math.cos(s),q=n,r&&o.push(r[X].r,r[X].g,r[X].b,r[X].a);for(E=0;E<U-2;E++)f.push(i[0+h],i[E+2+h],i[E+1+h]);h+=U}else{for(E=0;E<x.vertex.length;E++)F.push(x.vertex[E][0]*H,x.vertex[E][1]*O,x.vertex[E][2]*e),z.push(0,y.c?1:0);for(X=0;X<P;X++)for(E=0;E<x.face[X].length-2;E++)f.push(x.face[X][0],x.face[X][E+2],x.face[X][E+1])}W.c.ComputeNormals(F,f,L),W.c._ComputeSides(J,F,f,L,z,U.frontUVs,U.backUVs);const Q=new W.c;return Q.xa=F,Q.indices=f,Q.ya=L,Q.Aa=z,r&&B&&(Q.za=o),Q}function w(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return K(M).Ca(a,M.updatable),a}A.c.CreateTube=(U,M,b,a,A,H,W,y,O,e)=>g(U,{path:M,radius:b,tessellation:a,radiusFunction:A,arc:1,cap:H,updatable:y,sideOrientation:O,instance:e},W);function T(U){const M=U.sideOrientation||W.c.DEFAULTSIDE,b=U.radius||1,A=void 0===U.flat||U.flat,H=0|(U.subdivisions||4),O=U.radiusX||b,e=U.radiusY||b,x=U.radiusZ||b,P=(1+Math.sqrt(5))/2,Z=[-1,P,-0,1,P,0,-1,-P,0,1,-P,0,0,-1,-P,0,1,-P,0,-1,P,0,1,P,P,0,1,P,0,-1,-P,0,1,-P,0,-1],C=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],r=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],B=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],J=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],F=[],f=[],L=[],z=[];let o=0;const S=new Array(3),h=new Array(3);let i;for(i=0;i<3;i++)S[i]=a.l.Zero(),h[i]=a.i.Zero();for(let W=0;W<20;W++){for(i=0;i<3;i++){const U=C[3*W+i];S[i].vd(Z[3*r[U]],Z[3*r[U]+1],Z[3*r[U]+2]),S[i].normalize(),h[i].vd(.134765625*B[2*U]+.05859375+-.0390625*J[W],.2333984375*B[2*U+1]+.025390625+.01953125*J[W])}const U=(U,M,b,W)=>{const P=a.l.Lerp(S[0],S[2],M/H),Z=a.l.Lerp(S[1],S[2],M/H),C=H===M?S[2]:a.l.Lerp(P,Z,U/(H-M));let r;if(C.normalize(),A){const U=a.l.Lerp(S[0],S[2],W/H),M=a.l.Lerp(S[1],S[2],W/H);r=a.l.Lerp(U,M,b/(H-W))}else r=new a.l(C.x,C.y,C.z);r.x/=O,r.y/=e,r.z/=x,r.normalize();const B=a.i.Lerp(h[0],h[2],M/H),J=a.i.Lerp(h[1],h[2],M/H),i=H===M?h[2]:a.i.Lerp(B,J,U/(H-M));f.push(C.x*O,C.y*e,C.z*x),L.push(r.x,r.y,r.z),z.push(i.x,y.c?1-i.y:i.y),F.push(o),o++};for(let M=0;M<H;M++)for(let b=0;b+M<H;b++)U(b,M,b+1/3,M+1/3),U(b+1,M,b+1/3,M+1/3),U(b,M+1,b+1/3,M+1/3),b+M+1<H&&(U(b+1,M,b+2/3,M+2/3),U(b+1,M+1,b+2/3,M+2/3),U(b,M+1,b+2/3,M+2/3))}W.c._ComputeSides(M,f,F,L,z,U.frontUVs,U.backUVs);const Y=new W.c;return Y.indices=F,Y.xa=f,Y.ya=L,Y.Aa=z,Y}function G(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new A.c(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),a._originalBuilderSideOrientation=M.sideOrientation;return T(M).Ca(a,M.updatable),a}W.c.CreatePolyhedron=K,A.c.CreatePolyhedron=(U,M,b)=>w(U,M,b);W.c.CreateIcoSphere=T,A.c.CreateIcoSphere=(U,M,b)=>G(U,M,b);var l=b(682);const D=new a.l(1,0,0),u=new a.l(-1,0,0),c=new a.l(0,1,0),UU=new a.l(0,-1,0),MU=new a.l(0,0,1),bU=new a.l(0,0,-1);class aU{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.l.Zero(),M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.l.Up(),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.i.Zero(),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=U,this.uk=M,this.uv=b,this.vertexIdx=A,this.vertexIdxForBones=H,this.localPositionOverride=W,this.localNormalOverride=y,this.matrixIndicesOverride=O,this.matrixWeightsOverride=e}clone(){var U,M,b,a;return new aU(this.position.clone(),this.uk.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(U=this.localPositionOverride)||void 0===U?void 0:U.slice(),null===(M=this.localNormalOverride)||void 0===M?void 0:M.slice(),null===(b=this.matrixIndicesOverride)||void 0===b?void 0:b.slice(),null===(a=this.matrixWeightsOverride)||void 0===a?void 0:a.slice())}}function AU(U,M,b){var O,e,x,P,Z;const C=!!M.skeleton,r=!(null===(O=M.morphTargetManager)||void 0===O||!O.numTargets),B=b.localMode||C,J=M.kk(),F=C||r?M.Qc(!0,!0):M.getVerticesData(H.e.PositionKind),f=C||r?M.getNormalsData(!0,!0):M.getVerticesData(H.e.NormalKind),L=B?C?M.getVerticesData(H.e.PositionKind):F:null,z=B?C?M.getVerticesData(H.e.NormalKind):f:null,o=M.getVerticesData(H.e.UVKind),S=C?M.getVerticesData(H.e.MatricesIndicesKind):null,h=C?M.getVerticesData(H.e.MatricesWeightsKind):null,i=C?M.getVerticesData(H.e.MatricesIndicesExtraKind):null,Y=C?M.getVerticesData(H.e.MatricesWeightsExtraKind):null,d=b.position||a.l.Zero();let s=b.uk||a.l.Up();const q=b.size||a.l.One(),m=b.angle||0;if(!s){const U=new a.l(0,0,1),b=M.va().activeCamera,A=a.l.TransformCoordinates(U,b.getWorldMatrix());s=b.globalPosition.je(A)}const n=-Math.atan2(s.z,s.x)-Math.PI/2,E=Math.sqrt(s.x*s.x+s.z*s.z),X=Math.atan2(s.y,E),Q=new W.c;Q.indices=[],Q.xa=[],Q.ya=[],Q.Aa=[],Q.matricesIndices=C?[]:null,Q.matricesWeights=C?[]:null,Q.matricesIndicesExtra=i?[]:null,Q.matricesWeightsExtra=Y?[]:null;let I=0;const v=(U,M)=>{const A=new aU;if(!J||!F||!f)return A;const H=J[U];if(A.vertexIdx=3*H,A.vertexIdxForBones=4*H,A.position=new a.l(F[3*H],F[3*H+1],F[3*H+2]),a.l.TransformCoordinatesToRef(A.position,M,A.position),A.uk=new a.l(f[3*H],f[3*H+1],f[3*H+2]),a.l.TransformNormalToRef(A.uk,M,A.uk),b.captureUVS&&o){const U=o[2*H+1];A.uv=new a.i(o[2*H],y.c?1-U:U)}return A},t=[0,0,0,0],V=(U,M)=>{if(0===U.length)return U;const b=.5*Math.abs(a.l.Dot(q,M)),A=(U,M,b,a)=>{for(let A=0;A<a;++A)if(U[b+A]===M)return b+A;return-1},H=(U,H)=>{const W=a.l.GetClipFactor(U.position,H.position,M,b);let y=t,O=t;if(S&&h){const M=U.matrixIndicesOverride?0:U.vertexIdxForBones,b=U.matrixIndicesOverride??S,a=U.matrixWeightsOverride??h,e=H.matrixIndicesOverride?0:H.vertexIdxForBones,x=H.matrixIndicesOverride??S,P=H.matrixWeightsOverride??h;y=[0,0,0,0],O=[0,0,0,0];let Z=0;for(let U=0;U<4;++U)if(a[M+U]>0){const H=A(x,b[M+U],e,4);y[Z]=b[M+U],O[Z]=(0,l.n)(a[M+U],H>=0?P[H]:0,W),Z++}for(let U=0;U<4&&Z<4;++U){const a=x[e+U];-1===A(b,a,M,4)&&(y[Z]=a,O[Z]=(0,l.n)(0,P[e+U],W),Z++)}const C=O[0]+O[1]+O[2]+O[3];O[0]/=C,O[1]/=C,O[2]/=C,O[3]/=C}const e=U.localPositionOverride?U.localPositionOverride[0]:(null===L||void 0===L?void 0:L[U.vertexIdx])??0,x=U.localPositionOverride?U.localPositionOverride[1]:(null===L||void 0===L?void 0:L[U.vertexIdx+1])??0,P=U.localPositionOverride?U.localPositionOverride[2]:(null===L||void 0===L?void 0:L[U.vertexIdx+2])??0,Z=H.localPositionOverride?H.localPositionOverride[0]:(null===L||void 0===L?void 0:L[H.vertexIdx])??0,C=H.localPositionOverride?H.localPositionOverride[1]:(null===L||void 0===L?void 0:L[H.vertexIdx+1])??0,r=H.localPositionOverride?H.localPositionOverride[2]:(null===L||void 0===L?void 0:L[H.vertexIdx+2])??0,B=U.localNormalOverride?U.localNormalOverride[0]:(null===z||void 0===z?void 0:z[U.vertexIdx])??0,J=U.localNormalOverride?U.localNormalOverride[1]:(null===z||void 0===z?void 0:z[U.vertexIdx+1])??0,F=U.localNormalOverride?U.localNormalOverride[2]:(null===z||void 0===z?void 0:z[U.vertexIdx+2])??0,f=B+((H.localNormalOverride?H.localNormalOverride[0]:(null===z||void 0===z?void 0:z[H.vertexIdx])??0)-B)*W,o=J+((H.localNormalOverride?H.localNormalOverride[1]:(null===z||void 0===z?void 0:z[H.vertexIdx+1])??0)-J)*W,i=F+((H.localNormalOverride?H.localNormalOverride[2]:(null===z||void 0===z?void 0:z[H.vertexIdx+2])??0)-F)*W,Y=Math.sqrt(f*f+o*o+i*i);return new aU(a.l.Lerp(U.position,H.position,W),a.l.Lerp(U.uk,H.uk,W).normalize(),a.i.Lerp(U.uv,H.uv,W),-1,-1,L?[e+(Z-e)*W,x+(C-x)*W,P+(r-P)*W]:null,z?[f/Y,o/Y,i/Y]:null,y,O)};let W=null;U.length>3&&(W=[]);for(let y=0;y<U.length;y+=3){let A=0,O=null,e=null,x=null,P=null;const Z=a.l.Dot(U[y].position,M)-b>0,C=a.l.Dot(U[y+1].position,M)-b>0,r=a.l.Dot(U[y+2].position,M)-b>0;switch(A=(Z?1:0)+(C?1:0)+(r?1:0),A){case 0:U.length>3?(W.push(U[y]),W.push(U[y+1]),W.push(U[y+2])):W=U;break;case 1:if(W=W??new Array,Z&&(O=U[y+1],e=U[y+2],x=H(U[y],O),P=H(U[y],e)),C){O=U[y],e=U[y+2],x=H(U[y+1],O),P=H(U[y+1],e),W.push(x),W.push(e.clone()),W.push(O.clone()),W.push(e.clone()),W.push(x.clone()),W.push(P);break}r&&(O=U[y],e=U[y+1],x=H(U[y+2],O),P=H(U[y+2],e)),O&&e&&x&&P&&(W.push(O.clone()),W.push(e.clone()),W.push(x),W.push(P),W.push(x.clone()),W.push(e.clone()));break;case 2:W=W??new Array,Z||(O=U[y].clone(),e=H(O,U[y+1]),x=H(O,U[y+2]),W.push(O),W.push(e),W.push(x)),C||(O=U[y+1].clone(),e=H(O,U[y+2]),x=H(O,U[y]),W.push(O),W.push(e),W.push(x)),r||(O=U[y+2].clone(),e=H(O,U[y]),x=H(O,U[y+1]),W.push(O),W.push(e),W.push(x))}}return W},k=M instanceof A.c?M:null,N=null===k||void 0===k?void 0:k._thinInstanceDataStorage.matrixData,R=(null===k||void 0===k?void 0:k.Sk)||1,j=a.g.Matrix[0];j.p(a.b.IdentityReadOnly);for(let A=0;A<R;++A){if(null!==k&&void 0!==k&&k.hasThinInstances&&N){const U=16*A;j.setRowFromFloats(0,N[U+0],N[U+1],N[U+2],N[U+3]),j.setRowFromFloats(1,N[U+4],N[U+5],N[U+6],N[U+7]),j.setRowFromFloats(2,N[U+8],N[U+9],N[U+10],N[U+11]),j.setRowFromFloats(3,N[U+12],N[U+13],N[U+14],N[U+15])}const U=a.b.RotationYawPitchRoll(n,X,m).multiply(a.b.Translation(d.x,d.y,d.z)),H=a.b.Invert(U),W=M.getWorldMatrix(),O=j.multiply(W).multiply(H),e=new Array(3);for(let M=0;M<J.length;M+=3){let U=e;if(U[0]=v(M,O),U[1]=v(M+1,O),U[2]=v(M+2,O),!(b.cullBackFaces&&-U[0].uk.z<=0&&-U[1].uk.z<=0&&-U[2].uk.z<=0)&&(U=V(U,D),U&&(U=V(U,u),U&&(U=V(U,c),U&&(U=V(U,UU),U&&(U=V(U,MU),U&&(U=V(U,bU),U)))))))for(let M=0;M<U.length;M++){const a=U[M];if(Q.indices.push(I),B?(a.localPositionOverride?(Q.xa[3*I]=a.localPositionOverride[0],Q.xa[3*I+1]=a.localPositionOverride[1],Q.xa[3*I+2]=a.localPositionOverride[2]):L&&(Q.xa[3*I]=L[a.vertexIdx],Q.xa[3*I+1]=L[a.vertexIdx+1],Q.xa[3*I+2]=L[a.vertexIdx+2]),a.localNormalOverride?(Q.ya[3*I]=a.localNormalOverride[0],Q.ya[3*I+1]=a.localNormalOverride[1],Q.ya[3*I+2]=a.localNormalOverride[2]):z&&(Q.ya[3*I]=z[a.vertexIdx],Q.ya[3*I+1]=z[a.vertexIdx+1],Q.ya[3*I+2]=z[a.vertexIdx+2])):(a.position.toArray(Q.xa,3*I),a.uk.toArray(Q.ya,3*I)),Q.matricesIndices&&Q.matricesWeights&&(a.matrixIndicesOverride?(Q.matricesIndices[4*I]=a.matrixIndicesOverride[0],Q.matricesIndices[4*I+1]=a.matrixIndicesOverride[1],Q.matricesIndices[4*I+2]=a.matrixIndicesOverride[2],Q.matricesIndices[4*I+3]=a.matrixIndicesOverride[3]):(S&&(Q.matricesIndices[4*I]=S[a.vertexIdxForBones],Q.matricesIndices[4*I+1]=S[a.vertexIdxForBones+1],Q.matricesIndices[4*I+2]=S[a.vertexIdxForBones+2],Q.matricesIndices[4*I+3]=S[a.vertexIdxForBones+3]),i&&Q.matricesIndicesExtra&&(Q.matricesIndicesExtra[4*I]=i[a.vertexIdxForBones],Q.matricesIndicesExtra[4*I+1]=i[a.vertexIdxForBones+1],Q.matricesIndicesExtra[4*I+2]=i[a.vertexIdxForBones+2],Q.matricesIndicesExtra[4*I+3]=i[a.vertexIdxForBones+3])),a.matrixWeightsOverride?(Q.matricesWeights[4*I]=a.matrixWeightsOverride[0],Q.matricesWeights[4*I+1]=a.matrixWeightsOverride[1],Q.matricesWeights[4*I+2]=a.matrixWeightsOverride[2],Q.matricesWeights[4*I+3]=a.matrixWeightsOverride[3]):(h&&(Q.matricesWeights[4*I]=h[a.vertexIdxForBones],Q.matricesWeights[4*I+1]=h[a.vertexIdxForBones+1],Q.matricesWeights[4*I+2]=h[a.vertexIdxForBones+2],Q.matricesWeights[4*I+3]=h[a.vertexIdxForBones+3]),Y&&Q.matricesWeightsExtra&&(Q.matricesWeightsExtra[4*I]=Y[a.vertexIdxForBones],Q.matricesWeightsExtra[4*I+1]=Y[a.vertexIdxForBones+1],Q.matricesWeightsExtra[4*I+2]=Y[a.vertexIdxForBones+2],Q.matricesWeightsExtra[4*I+3]=Y[a.vertexIdxForBones+3]))),b.captureUVS)a.uv.toArray(Q.Aa,2*I);else{Q.Aa.push(.5+a.position.x/q.x);const U=.5+a.position.y/q.y;Q.Aa.push(y.c?1-U:U)}I++}}}0===Q.indices.length&&(Q.indices=null),0===Q.xa.length&&(Q.xa=null),0===Q.ya.length&&(Q.ya=null),0===Q.Aa.length&&(Q.Aa=null),0===(null===(e=Q.matricesIndices)||void 0===e?void 0:e.length)&&(Q.matricesIndices=null),0===(null===(x=Q.matricesWeights)||void 0===x?void 0:x.length)&&(Q.matricesWeights=null),0===(null===(P=Q.matricesIndicesExtra)||void 0===P?void 0:P.length)&&(Q.matricesIndicesExtra=null),0===(null===(Z=Q.matricesWeightsExtra)||void 0===Z?void 0:Z.length)&&(Q.matricesWeightsExtra=null);const p=new A.c(U,M.va());return Q.Ca(p),B?(p.skeleton=M.skeleton,p.parent=M):(p.position=d.clone(),p.rotation=new a.l(X,n,m)),p.ik(!0),p.refreshBoundingInfo(!0,!0),p}function HU(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const M=0|Math.max(U.subdivisions?U.subdivisions:2,1),b=0|Math.max(U.tessellation?U.tessellation:16,3),A=Math.max(U.height?U.height:1,0),H=Math.max(U.radius?U.radius:.25,0),O=0|Math.max(U.capSubdivisions?U.capSubdivisions:6,1),e=b,x=M,P=Math.max(U.radiusTop?U.radiusTop:H,0),Z=Math.max(U.radiusBottom?U.radiusBottom:H,0),C=A-(P+Z),r=2*Math.PI,B=Math.max(U.topCapSubdivisions?U.topCapSubdivisions:O,1),J=Math.max(U.bottomCapSubdivisions?U.bottomCapSubdivisions:O,1),F=Math.acos((Z-P)/A);let f=[];const L=[],z=[],o=[];let S=0;const h=[],i=.5*C,Y=.5*Math.PI;let d,s;const q=a.l.Zero(),m=a.l.Zero(),n=Math.cos(F),E=Math.sin(F),X=new a.i(P*E,i+P*n).je(new a.i(Z*E,Z*n-i)).length(),Q=P*F+X+Z*(Y-F);let I=0;for(s=0;s<=B;s++){const U=[],M=Y-F*(s/B);I+=P*F/B;const b=Math.cos(M),a=Math.sin(M),A=b*P;for(d=0;d<=e;d++){const M=d/e,H=M*r+0,W=Math.sin(H),O=Math.cos(H);m.x=A*W,m.y=i+a*P,m.z=A*O,L.push(m.x,m.y,m.z),q.set(b*W,a,b*O),z.push(q.x,q.y,q.z),o.push(M,y.c?I/Q:1-I/Q),U.push(S),S++}h.push(U)}const v=A-P-Z+n*P-n*Z,t=E*(Z-P)/v;for(s=1;s<=x;s++){const U=[];I+=X/x;const M=E*(s*(Z-P)/x+P);for(d=0;d<=e;d++){const b=d/e,a=b*r+0,A=Math.sin(a),H=Math.cos(a);m.x=M*A,m.y=i+n*P-s*v/x,m.z=M*H,L.push(m.x,m.y,m.z),q.set(A,t,H).normalize(),z.push(q.x,q.y,q.z),o.push(b,y.c?I/Q:1-I/Q),U.push(S),S++}h.push(U)}for(s=1;s<=J;s++){const U=[],M=Y-F-(Math.PI-F)*(s/J);I+=Z*F/J;const b=Math.cos(M),a=Math.sin(M),A=b*Z;for(d=0;d<=e;d++){const M=d/e,H=M*r+0,W=Math.sin(H),O=Math.cos(H);m.x=A*W,m.y=a*Z-i,m.z=A*O,L.push(m.x,m.y,m.z),q.set(b*W,a,b*O),z.push(q.x,q.y,q.z),o.push(M,y.c?I/Q:1-I/Q),U.push(S),S++}h.push(U)}for(d=0;d<e;d++)for(s=0;s<B+x+J;s++){const U=h[s][d],M=h[s+1][d],b=h[s+1][d+1],a=h[s][d+1];f.push(U),f.push(M),f.push(a),f.push(M),f.push(b),f.push(a)}if(f=f.reverse(),U.orientation&&!U.orientation.equals(a.l.Up())){const M=new a.b;U.orientation.clone().scale(.5*Math.PI).cross(a.l.Up()).toQuaternion().toRotationMatrix(M);const b=a.l.Zero();for(let U=0;U<L.length;U+=3)b.set(L[U],L[U+1],L[U+2]),a.l.TransformCoordinatesToRef(b.clone(),M,b),L[U]=b.x,L[U+1]=b.y,L[U+2]=b.z}const V=new W.c;return V.xa=L,V.ya=z,V.Aa=o,V.indices=f,V}function WU(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:a.l.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new A.c(U,b);return HU(M).Ca(H,M.updatable),H}A.c.CreateDecal=(U,M,b,a,A,H)=>AU(U,M,{position:b,uk:a,size:A,angle:H});A.c.CreateCapsule=(U,M,b)=>WU(U,M,b),W.c.CreateCapsule=HU;class yU{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=U,this.y=M,U!==Math.floor(U)&&(U=Math.floor(U),s.b.Warn("x is not an integer, floor(x) used")),M!==Math.floor(M)&&(M=Math.floor(M),s.b.Warn("y is not an integer, floor(y) used"))}clone(){return new yU(this.x,this.y)}rotate60About(U){const M=this.x;return this.x=U.x+U.y-this.y,this.y=M+this.y-U.x,this}rotateNeg60About(U){const M=this.x;return this.x=M+this.y-U.y,this.y=U.x+U.y-M,this}rotate120(U,M){U!==Math.floor(U)&&(U=Math.floor(U),s.b.Warn("m not an integer only floor(m) used")),M!==Math.floor(M)&&(M=Math.floor(M),s.b.Warn("n not an integer only floor(n) used"));const b=this.x;return this.x=U-b-this.y,this.y=M+b,this}rotateNeg120(U,M){U!==Math.floor(U)&&(U=Math.floor(U),s.b.Warn("m is not an integer, floor(m) used")),M!==Math.floor(M)&&(M=Math.floor(M),s.b.Warn("n is not an integer,   floor(n) used"));const b=this.x;return this.x=this.y-M,this.y=U+M-b-this.y,this}toCartesianOrigin(U,M){const b=a.l.Zero();return b.x=U.x+2*this.x*M+this.y*M,b.y=U.y+Math.sqrt(3)*this.y*M,b}static Zero(){return new yU(0,0)}}class OU{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new eU("icosahedron","Regular",[[0,m.d,-1],[-m.d,1,0],[-1,0,-m.d],[1,0,-m.d],[m.d,1,0],[0,m.d,1],[-1,0,m.d],[-m.d,-1,0],[0,-m.d,-1],[m.d,-1,0],[1,0,m.d],[0,-m.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let U=12;const M={},b=this.m,a=this.n;let A,H,W,y,O,e=b,x=1,P=0;0!==a&&(e=(0,l.i)(b,a)),x=b/e,P=a/e;const Z=yU.Zero(),C=new yU(b,a),r=new yU(-a,b+a),B=yU.Zero(),J=yU.Zero(),F=yU.Zero();let f,L,z,o,S=[];const h=[],i=this.vertByDist,Y=(b,a,A,H)=>{f=b+"|"+A,L=a+"|"+H,f in M||L in M?f in M&&!(L in M)?M[L]=M[f]:L in M&&!(f in M)&&(M[f]=M[L]):(M[f]=U,M[L]=U,U++),i[A][0]>2?h[M[f]]=[-i[A][0],i[A][1],M[f]]:h[M[f]]=[S[i[A][0]],i[A][1],M[f]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let d=0;d<20;d++){if(S=this.IDATA.face[d],W=S[2],y=S[1],O=S[0],z=Z.x+"|"+Z.y,f=d+"|"+z,f in M||(M[f]=W,h[W]=[S[i[z][0]],i[z][1]]),z=C.x+"|"+C.y,f=d+"|"+z,f in M||(M[f]=y,h[y]=[S[i[z][0]],i[z][1]]),z=r.x+"|"+r.y,f=d+"|"+z,f in M||(M[f]=O,h[O]=[S[i[z][0]],i[z][1]]),A=this.IDATA.edgematch[d][0],H=this.IDATA.edgematch[d][1],"B"===H)for(let U=1;U<e;U++)J.x=b-U*(x+P),J.y=a+U*x,F.x=-U*P,F.y=U*(x+P),z=J.x+"|"+J.y,o=F.x+"|"+F.y,Y(d,A,z,o);if("O"===H)for(let U=1;U<e;U++)F.x=-U*P,F.y=U*(x+P),B.x=U*x,B.y=U*P,z=F.x+"|"+F.y,o=B.x+"|"+B.y,Y(d,A,z,o);if(A=this.IDATA.edgematch[d][2],H=this.IDATA.edgematch[d][3],H&&"A"===H)for(let U=1;U<e;U++)B.x=U*x,B.y=U*P,J.x=b-(e-U)*(x+P),J.y=a+(e-U)*x,z=B.x+"|"+B.y,o=J.x+"|"+J.y,Y(d,A,z,o);for(let b=0;b<this.vertices.length;b++)z=this.vertices[b].x+"|"+this.vertices[b].y,f=d+"|"+z,f in M||(M[f]=U++,i[z][0]>2?h[M[f]]=[-i[z][0],i[z][1],M[f]]:h[M[f]]=[S[i[z][0]],i[z][1],M[f]])}this.closestTo=h,this.vecToidx=M}calcCoeffs(){const U=this.m,M=this.n,b=Math.sqrt(3)/3,a=U*U+M*M+U*M;this.coau=(U+M)/a,this.cobu=-M/a,this.coav=-b*(U-M)/a,this.cobv=b*(2*U+M)/a}createInnerFacets(){const U=this.m,M=this.n;for(let b=0;b<M+U+1;b++)for(let U=this.min[b];U<this.max[b]+1;U++)U<this.max[b]&&U<this.max[b+1]+1&&this.innerFacets.push(["|"+U+"|"+b,"|"+U+"|"+(b+1),"|"+(U+1)+"|"+b]),b>0&&U<this.max[b-1]&&U+1<this.max[b]+1&&this.innerFacets.push(["|"+U+"|"+b,"|"+(U+1)+"|"+b,"|"+(U+1)+"|"+(b-1)])}edgeVecsABOB(){const U=this.m,M=this.n,b=new yU(-M,U+M);for(let a=1;a<U+M;a++){const U=new yU(this.min[a],a),M=new yU(this.min[a-1],a-1),A=new yU(this.min[a+1],a+1),H=U.clone(),W=M.clone(),y=A.clone();H.rotate60About(b),W.rotate60About(b),y.rotate60About(b);const O=new yU(this.max[H.y],H.y),e=new yU(this.max[H.y-1],H.y-1),x=new yU(this.max[H.y-1]-1,H.y-1);H.x===O.x&&H.y===O.y||(H.x!==e.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,e,x]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,x,O])):H.y===y.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,M,e]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([U,e,A])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,M,e]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,e,O])))}}mapABOBtoOBOA(){const U=new yU(0,0);for(let M=0;M<this.isoVecsABOB.length;M++){const b=[];for(let a=0;a<3;a++)U.x=this.isoVecsABOB[M][a].x,U.y=this.isoVecsABOB[M][a].y,0===this.vertexTypes[M][a]&&U.rotateNeg120(this.m,this.n),b.push(U.clone());this.isoVecsOBOA.push(b)}}mapABOBtoBAOA(){const U=new yU(0,0);for(let M=0;M<this.isoVecsABOB.length;M++){const b=[];for(let a=0;a<3;a++)U.x=this.isoVecsABOB[M][a].x,U.y=this.isoVecsABOB[M][a].y,1===this.vertexTypes[M][a]&&U.rotate120(this.m,this.n),b.push(U.clone());this.isoVecsBAOA.push(b)}}MapToFace(U,M){const b=this.IDATA.face[U],A=b[2],H=b[1],W=b[0],y=a.l.jk(this.IDATA.vertex[A]),O=a.l.jk(this.IDATA.vertex[H]),e=a.l.jk(this.IDATA.vertex[W]),x=O.je(y),P=e.je(y),Z=x.scale(this.coau).add(P.scale(this.cobu)),C=x.scale(this.coav).add(P.scale(this.cobv)),r=[];let B,J=a.g.lk[0];for(let a=0;a<this.cartesian.length;a++)J=Z.scale(this.cartesian[a].x).add(C.scale(this.cartesian[a].y)).add(y),r[a]=[J.x,J.y,J.z],B=U+"|"+this.vertices[a].x+"|"+this.vertices[a].y,M.vertex[this.vecToidx[B]]=[J.x,J.y,J.z]}build(U,M){const b=[],a=yU.Zero(),A=new yU(U,M),H=new yU(-M,U+M);b.push(a,A,H);for(let z=M;z<U+1;z++)for(let M=0;M<U+1-z;M++)b.push(new yU(M,z));if(M>0){const a=(0,l.i)(U,M),A=U/a,H=M/a;for(let y=1;y<a;y++)b.push(new yU(y*A,y*H)),b.push(new yU(-y*H,y*(A+H))),b.push(new yU(U-y*(A+H),M+y*A));const W=U/M;for(let y=1;y<M;y++)for(let a=0;a<y*W;a++)b.push(new yU(a,y)),b.push(new yU(a,y).rotate120(U,M)),b.push(new yU(a,y).rotateNeg120(U,M))}b.sort(((U,M)=>U.x-M.x)),b.sort(((U,M)=>U.y-M.y));const W=new Array(U+M+1),y=new Array(U+M+1);for(let z=0;z<W.length;z++)W[z]=1/0,y[z]=-1/0;let O=0,e=0;const x=b.length;for(let z=0;z<x;z++)e=b[z].x,O=b[z].y,W[O]=Math.min(e,W[O]),y[O]=Math.max(e,y[O]);const P=(b,a)=>{const A=b.clone();return"A"===a&&A.rotateNeg120(U,M),"B"===a&&A.rotate120(U,M),A.x<0?A.y:A.x+A.y},Z=[],C=[],r=[],B=[],J={},F=[];let f=-1,L=-1;for(let z=0;z<x;z++)Z[z]=b[z].toCartesianOrigin(new yU(0,0),.5),C[z]=P(b[z],"O"),r[z]=P(b[z],"A"),B[z]=P(b[z],"B"),C[z]===r[z]&&r[z]===B[z]?(f=3,L=C[z]):C[z]===r[z]?(f=4,L=C[z]):r[z]===B[z]?(f=5,L=r[z]):B[z]===C[z]&&(f=6,L=C[z]),C[z]<r[z]&&C[z]<B[z]&&(f=2,L=C[z]),r[z]<C[z]&&r[z]<B[z]&&(f=1,L=r[z]),B[z]<r[z]&&B[z]<C[z]&&(f=0,L=B[z]),F.push([f,L,b[z].x,b[z].y]);F.sort(((U,M)=>U[2]-M[2])),F.sort(((U,M)=>U[3]-M[3])),F.sort(((U,M)=>U[1]-M[1])),F.sort(((U,M)=>U[0]-M[0]));for(let z=0;z<F.length;z++)J[F[z][2]+"|"+F[z][3]]=[F[z][0],F[z][1],z];return this.m=U,this.n=M,this.vertices=b,this.vertByDist=J,this.cartesian=Z,this.min=W,this.max=y,this}}class eU{constructor(U,M,b,a){this.name=U,this.category=M,this.vertex=b,this.face=a}}class xU extends eU{innerToData(U,M){for(let b=0;b<M.innerFacets.length;b++)this.face.push(M.innerFacets[b].map((b=>M.vecToidx[U+b])))}mapABOBtoDATA(U,M){const b=M.IDATA.edgematch[U][0];for(let a=0;a<M.isoVecsABOB.length;a++){const A=[];for(let H=0;H<3;H++)0===M.vertexTypes[a][H]?A.push(U+"|"+M.isoVecsABOB[a][H].x+"|"+M.isoVecsABOB[a][H].y):A.push(b+"|"+M.isoVecsABOB[a][H].x+"|"+M.isoVecsABOB[a][H].y);this.face.push([M.vecToidx[A[0]],M.vecToidx[A[1]],M.vecToidx[A[2]]])}}mapOBOAtoDATA(U,M){const b=M.IDATA.edgematch[U][0];for(let a=0;a<M.isoVecsOBOA.length;a++){const A=[];for(let H=0;H<3;H++)1===M.vertexTypes[a][H]?A.push(U+"|"+M.isoVecsOBOA[a][H].x+"|"+M.isoVecsOBOA[a][H].y):A.push(b+"|"+M.isoVecsOBOA[a][H].x+"|"+M.isoVecsOBOA[a][H].y);this.face.push([M.vecToidx[A[0]],M.vecToidx[A[1]],M.vecToidx[A[2]]])}}mapBAOAtoDATA(U,M){const b=M.IDATA.edgematch[U][2];for(let a=0;a<M.isoVecsBAOA.length;a++){const A=[];for(let H=0;H<3;H++)1===M.vertexTypes[a][H]?A.push(U+"|"+M.isoVecsBAOA[a][H].x+"|"+M.isoVecsBAOA[a][H].y):A.push(b+"|"+M.isoVecsBAOA[a][H].x+"|"+M.isoVecsBAOA[a][H].y);this.face.push([M.vecToidx[A[0]],M.vecToidx[A[1]],M.vecToidx[A[2]]])}}orderData(U){const M=[];for(let H=0;H<13;H++)M[H]=[];const b=U.closestTo;for(let H=0;H<b.length;H++)b[H][0]>-1?b[H][1]>0&&M[b[H][0]].push([H,b[H][1]]):M[12].push([H,b[H][0]]);const a=[];for(let H=0;H<12;H++)a[H]=H;let A=12;for(let H=0;H<12;H++){M[H].sort(((U,M)=>U[1]-M[1]));for(let U=0;U<M[H].length;U++)a[M[H][U][0]]=A++}for(let H=0;H<M[12].length;H++)a[M[12][H][0]]=A++;for(let H=0;H<this.vertex.length;H++)this.vertex[H].push(a[H]);this.vertex.sort(((U,M)=>U[3]-M[3]));for(let H=0;H<this.vertex.length;H++)this.vertex[H].pop();for(let H=0;H<this.face.length;H++)for(let U=0;U<this.face[H].length;U++)this.face[H][U]=a[this.face[H][U]];this.sharedNodes=M[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(U,M){const b=[],a=[];let A=M.pop();a.push(A);let H=this.face[A].indexOf(U);H=(H+2)%3;let W=this.face[A][H];b.push(W);let y=0;for(;M.length>0;)A=M[y],this.face[A].indexOf(W)>-1?(H=(this.face[A].indexOf(W)+1)%3,W=this.face[A][H],b.push(W),a.push(A),M.splice(y,1),y=0):y++;return this.adjacentFaces.push(b),a}toGoldbergPolyhedronData(){const U=new eU("GeoDual","Goldberg",[],[]);U.name="GD dual";const M=this.vertex.length,b=new Array(M);for(let O=0;O<M;O++)b[O]=[];for(let O=0;O<this.face.length;O++)for(let U=0;U<3;U++)b[this.face[O][U]].push(O);let a=0,A=0,H=0,W=[],y=[];this.adjacentFaces=[];for(let O=0;O<b.length;O++){U.face[O]=this.setOrder(O,b[O].concat([]));for(const M of b[O]){a=0,A=0,H=0,W=this.face[M];for(let U=0;U<3;U++)y=this.vertex[W[U]],a+=y[0],A+=y[1],H+=y[2];U.vertex[M]=[a/3,A/3,H/3]}}return U}static BuildGeodesicData(U){const M=new xU("Geodesic-m-n","Geodesic",[[0,m.d,-1],[-m.d,1,0],[-1,0,-m.d],[1,0,-m.d],[m.d,1,0],[0,m.d,1],[-1,0,m.d],[-m.d,-1,0],[0,-m.d,-1],[m.d,-1,0],[1,0,m.d],[0,-m.d,1]],[]);U.setIndices(),U.calcCoeffs(),U.createInnerFacets(),U.edgeVecsABOB(),U.mapABOBtoOBOA(),U.mapABOBtoBAOA();for(let b=0;b<U.IDATA.face.length;b++)U.MapToFace(b,M),M.innerToData(b,U),"B"===U.IDATA.edgematch[b][1]&&M.mapABOBtoDATA(b,U),"O"===U.IDATA.edgematch[b][1]&&M.mapOBOAtoDATA(b,U),"A"===U.IDATA.edgematch[b][3]&&M.mapBAOAtoDATA(b,U);M.orderData(U);return M.vertex=M.vertex.map((function(U){const M=U[0],b=U[1],a=U[2],A=Math.sqrt(M*M+b*b+a*a);return U[0]*=1/A,U[1]*=1/A,U[2]*=1/A,U})),M}}A.c._GoldbergMeshParser=(U,M)=>PU.Parse(U,M);class PU extends A.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(U,M){return void 0===M?(U>this.goldbergData.nbUnsharedFaces-1&&(s.b.Warn("Maximum number of unshared faces used"),U=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+U):(U>11&&(s.b.Warn("Last pole used"),U=11),M>this.goldbergData.nbFacesAtPole-1&&(s.b.Warn("Maximum number of faces at a pole used"),M=this.goldbergData.nbFacesAtPole-1),12+U*this.goldbergData.nbFacesAtPole+M)}_changeGoldbergFaceColors(U){for(let b=0;b<U.length;b++){const M=U[b][0],a=U[b][1],A=U[b][2];for(let U=M;U<a+1;U++)this.goldbergData.faceColors[U]=A}const M=[];for(let b=0;b<12;b++)for(let U=0;U<5;U++)M.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);for(let b=12;b<this.goldbergData.faceColors.length;b++)for(let U=0;U<6;U++)M.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);return M}setGoldbergFaceColors(U){const M=this._changeGoldbergFaceColors(U);this.Ga(H.e.ColorKind,M)}updateGoldbergFaceColors(U){const M=this._changeGoldbergFaceColors(U);this.updateVerticesData(H.e.ColorKind,M)}_changeGoldbergFaceUVs(U){const M=this.getVerticesData(H.e.UVKind);for(let b=0;b<U.length;b++){const a=U[b][0],A=U[b][1],H=U[b][2],W=U[b][3],y=U[b][4],O=[],e=[];let x,P;for(let U=0;U<5;U++)x=H.x+W*Math.cos(y+U*Math.PI/2.5),P=H.y+W*Math.sin(y+U*Math.PI/2.5),x<0&&(x=0),x>1&&(x=1),O.push(x,P);for(let U=0;U<6;U++)x=H.x+W*Math.cos(y+U*Math.PI/3),P=H.y+W*Math.sin(y+U*Math.PI/3),x<0&&(x=0),x>1&&(x=1),e.push(x,P);for(let U=a;U<Math.min(12,A+1);U++)for(let b=0;b<5;b++)M[10*U+2*b]=O[2*b],M[10*U+2*b+1]=O[2*b+1];for(let U=Math.max(12,a);U<A+1;U++)for(let b=0;b<6;b++)M[12*U-24+2*b]=e[2*b],M[12*U-23+2*b]=e[2*b+1]}return M}setGoldbergFaceUVs(U){const M=this._changeGoldbergFaceUVs(U);this.Ga(H.e.UVKind,M)}updateGoldbergFaceUVs(U){const M=this._changeGoldbergFaceUVs(U);this.updateVerticesData(H.e.UVKind,M)}placeOnGoldbergFaceAt(U,M,b){const A=a.l.RotationFromAxis(this.goldbergData.faceXaxis[M],this.goldbergData.faceYaxis[M],this.goldbergData.faceZaxis[M]);U.rotation=A,U.position=this.goldbergData.faceCenters[M].add(this.goldbergData.faceXaxis[M].scale(b.x)).add(this.goldbergData.faceYaxis[M].scale(b.y)).add(this.goldbergData.faceZaxis[M].scale(b.z))}serialize(U){super.serialize(U),U.type="GoldbergMesh";const M={};if(M.adjacentFaces=this.goldbergData.adjacentFaces,M.nbSharedFaces=this.goldbergData.nbSharedFaces,M.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,M.nbFaces=this.goldbergData.nbFaces,M.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){M.faceColors=[];for(const U of this.goldbergData.faceColors)M.faceColors.push(U.tk())}if(this.goldbergData.faceCenters){M.faceCenters=[];for(const U of this.goldbergData.faceCenters)M.faceCenters.push(U.tk())}if(this.goldbergData.faceZaxis){M.faceZaxis=[];for(const U of this.goldbergData.faceZaxis)M.faceZaxis.push(U.tk())}if(this.goldbergData.faceYaxis){M.faceYaxis=[];for(const U of this.goldbergData.faceYaxis)M.faceYaxis.push(U.tk())}if(this.goldbergData.faceXaxis){M.faceXaxis=[];for(const U of this.goldbergData.faceXaxis)M.faceXaxis.push(U.tk())}U.goldbergData=M}static Parse(U,M){const b=U.goldbergData;b.faceColors=b.faceColors.map((U=>Z.e.jk(U))),b.faceCenters=b.faceCenters.map((U=>a.l.jk(U))),b.faceZaxis=b.faceZaxis.map((U=>a.l.jk(U))),b.faceXaxis=b.faceXaxis.map((U=>a.l.jk(U))),b.faceYaxis=b.faceYaxis.map((U=>a.l.jk(U)));const A=new PU(U.name,M);return A.goldbergData=b,A}}var ZU=b(792);class CU{constructor(U){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=U}moveTo(U,M){this._currentPath=new q.f(U,M),this._tempPaths.push(this._currentPath)}lineTo(U,M){this._currentPath.addLineTo(U,M)}quadraticCurveTo(U,M,b,a){this._currentPath.addQuadraticCurveTo(U,M,b,a,this._resolution)}bezierCurveTo(U,M,b,a,A,H){this._currentPath.addBezierCurveTo(U,M,b,a,A,H,this._resolution)}extractHoles(){for(const U of this._tempPaths)U.area()>0?this._holes.push(U):this._paths.push(U);if(!this._paths.length&&this._holes.length){const U=this._holes;this._holes=this._paths,this._paths=U}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function rU(U,M,b,a,A,H){const W=H.glyphs[U]||H.glyphs["?"];if(!W)return null;const y=new CU(A);if(W.o){const U=W.o.split(" ");for(let A=0,H=U.length;A<H;){switch(U[A++]){case"m":{const H=parseInt(U[A++])*M+b,W=parseInt(U[A++])*M+a;y.moveTo(H,W);break}case"l":{const H=parseInt(U[A++])*M+b,W=parseInt(U[A++])*M+a;y.lineTo(H,W);break}case"q":{const H=parseInt(U[A++])*M+b,W=parseInt(U[A++])*M+a,O=parseInt(U[A++])*M+b,e=parseInt(U[A++])*M+a;y.quadraticCurveTo(O,e,H,W);break}case"b":{const H=parseInt(U[A++])*M+b,W=parseInt(U[A++])*M+a,O=parseInt(U[A++])*M+b,e=parseInt(U[A++])*M+a,x=parseInt(U[A++])*M+b,P=parseInt(U[A++])*M+a;y.bezierCurveTo(O,e,x,P,H,W);break}}}}return y.extractHoles(),{offsetX:W.ha*M,shapePath:y}}const BU={CreateBox:P.b,CreateTiledBox:J,CreateSphere:F.e,CreateDisc:x.e,CreateIcoSphere:G,CreateRibbon:e,CreateCylinder:o,CreateTorus:h,CreateTorusKnot:Y,CreateLineSystem:d.d,Pk:d.e,CreateDashedLines:d.c,ExtrudeShape:V,ExtrudeShapeCustom:k,CreateLathe:R,CreateTiledPlane:r,Qk:j.e,CreateGround:p.d,CreateTiledGround:p.e,CreateGroundFromHeightMap:p.b,CreatePolygon:v,ExtrudePolygon:t,CreateTube:g,CreatePolyhedron:w,CreateGeodesic:function(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=M.m||1;a!==Math.floor(a)&&(a=Math.floor(a),s.b.Warn("m not an integer only floor(m) used"));let A=M.n||0;if(A!==Math.floor(A)&&(A=Math.floor(A),s.b.Warn("n not an integer only floor(n) used")),A>a){const U=A;A=a,a=U,s.b.Warn("n > m therefore m and n swapped")}const H=new OU;return H.build(a,A),w(U,{custom:xU.BuildGeodesicData(H),size:M.size,sizeX:M.sizeX,sizeY:M.sizeY,sizeZ:M.sizeZ,faceUV:M.faceUV,faceColors:M.faceColors,flat:M.flat,updatable:M.updatable,sideOrientation:M.sideOrientation,frontUVs:M.frontUVs,backUVs:M.backUVs},b)},CreateGoldberg:function(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=M.size,O=M.sizeX||H||1,e=M.sizeY||H||1,x=M.sizeZ||H||1;let P=M.m||1;P!==Math.floor(P)&&(P=Math.floor(P),s.b.Warn("m not an integer only floor(m) used"));let C=M.n||0;if(C!==Math.floor(C)&&(C=Math.floor(C),s.b.Warn("n not an integer only floor(n) used")),C>P){const U=C;C=P,P=U,s.b.Warn("n > m therefore m and n swapped")}const r=new OU;r.build(P,C);const B=xU.BuildGeodesicData(r),J=B.toGoldbergPolyhedronData(),F=new PU(U,b);M.sideOrientation=A.c._GetDefaultSideOrientation(M.sideOrientation),F._originalBuilderSideOrientation=M.sideOrientation;(function(U,M){const b=U.size,A=U.sizeX||b||1,H=U.sizeY||b||1,O=U.sizeZ||b||1,e=0===U.sideOrientation?0:U.sideOrientation||W.c.DEFAULTSIDE,x=[],P=[],Z=[],C=[];let r=1/0,B=-1/0,J=1/0,F=-1/0;for(let a=0;a<M.vertex.length;a++)r=Math.min(r,M.vertex[a][0]*A),B=Math.max(B,M.vertex[a][0]*A),J=Math.min(J,M.vertex[a][1]*H),F=Math.max(F,M.vertex[a][1]*H);let f=0;for(let W=0;W<M.face.length;W++){const U=M.face[W],b=a.l.jk(M.vertex[U[0]]),e=a.l.jk(M.vertex[U[2]]),L=a.l.jk(M.vertex[U[1]]),z=e.je(b),o=L.je(b),S=a.l.Cross(o,z).normalize();for(let a=0;a<U.length;a++){Z.push(S.x,S.y,S.z);const b=M.vertex[U[a]];x.push(b[0]*A,b[1]*H,b[2]*O);const W=(b[1]*H-J)/(F-J);C.push((b[0]*A-r)/(B-r),y.c?1-W:W)}for(let M=0;M<U.length-2;M++)P.push(f,f+M+2,f+M+1);f+=U.length}W.c._ComputeSides(e,x,P,Z,C);const L=new W.c;return L.xa=x,L.indices=P,L.ya=Z,L.Aa=C,L})(M,J).Ca(F,M.updatable),F.goldbergData.nbSharedFaces=B.sharedNodes,F.goldbergData.nbUnsharedFaces=B.poleNodes,F.goldbergData.adjacentFaces=B.adjacentFaces,F.goldbergData.nbFaces=F.goldbergData.nbSharedFaces+F.goldbergData.nbUnsharedFaces,F.goldbergData.nbFacesAtPole=(F.goldbergData.nbUnsharedFaces-12)/12;for(let A=0;A<B.vertex.length;A++)F.goldbergData.faceCenters.push(a.l.jk(B.vertex[A])),F.goldbergData.faceCenters[A].x*=O,F.goldbergData.faceCenters[A].y*=e,F.goldbergData.faceCenters[A].z*=x,F.goldbergData.faceColors.push(new Z.e(1,1,1,1));for(let A=0;A<J.face.length;A++){const U=J.face[A],M=a.l.jk(J.vertex[U[0]]),b=a.l.jk(J.vertex[U[2]]),H=a.l.jk(J.vertex[U[1]]),W=b.je(M),y=H.je(M),O=a.l.Cross(y,W).normalize(),e=a.l.Cross(y,O).normalize();F.goldbergData.faceXaxis.push(y.normalize()),F.goldbergData.faceYaxis.push(O),F.goldbergData.faceZaxis.push(e)}return F},CreateDecal:AU,CreateCapsule:WU,CreateText:function(U,M,b){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const O=function(U,M,b,a){const A=Array.from(U),H=M/a.resolution,W=(a.boundingBox.yMax-a.boundingBox.yMin+a.underlineThickness)*H,y=[];let O=0,e=0;for(let x=0;x<A.length;x++){const U=A[x];if("\n"===U)O=0,e-=W;else{const M=rU(U,H,O,e,b,a);M&&(O+=M.offsetX,y.push(M.shapePath))}}return y}(M,H.size||50,H.resolution||8,b),e=[];let x=0;for(const r of O){if(!r.paths.length)continue;const M=r.holes.slice();for(const b of r.paths){var P,Z;const O=[],C=[],r=b.getPoints();for(const U of r)C.push(new a.l(U.x,0,U.y));const B=M.slice();for(const U of B){const A=U.getPoints();let H=!1;for(const U of A)if(b.isPointInside(U)){H=!0;break}if(!H)continue;const W=[];for(const U of A)W.push(new a.l(U.x,0,U.y));O.push(W),M.splice(M.indexOf(U),1)}if(!O.length&&M.length)for(const U of M){const M=U.getPoints(),b=[];for(const U of M)b.push(new a.l(U.x,0,U.y));O.push(b)}const J=t(U,{shape:C,holes:O.length?O:void 0,depth:H.depth||1,faceUV:H.faceUV||(null===(P=H.perLetterFaceUV)||void 0===P?void 0:P.call(H,x)),faceColors:H.faceColors||(null===(Z=H.perLetterFaceColors)||void 0===Z?void 0:Z.call(H,x)),sideOrientation:A.c._GetDefaultSideOrientation(H.sideOrientation||A.c.DOUBLESIDE)},W,y);e.push(J),x++}}const C=A.c.MergeMeshes(e,!0,!0);if(C){const M=C.getBoundingInfo().boundingBox;C.position.x+=-(M.minimumWorld.x+M.maximumWorld.x)/2,C.position.y+=-(M.minimumWorld.y+M.maximumWorld.y)/2,C.position.z+=-(M.minimumWorld.z+M.maximumWorld.z)/2+M.extendSize.z,C.name=U;const b=new ZU.c("pivot",W);b.rotation.x=-Math.PI/2,C.parent=b,C.bakeCurrentTransformIntoVertices(),C.parent=null,b.dispose()}return C}}},12649:(U,M,b)=>{"use strict";b.d(M,{d:()=>W});var a=b(2371),A=b(2541);let H=0;const W=U=>{if(!U.environmentBRDFTexture){const M=U.useDelayedTextureLoading;U.useDelayedTextureLoading=!1;const b=U._blockEntityCollection;U._blockEntityCollection=!1;const W=a.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+H++,U,!0,!1,a.e.BILINEAR_SAMPLINGMODE);U._blockEntityCollection=b;const y=U.getEngine().getLoadedTexturesCache(),O=y.indexOf(W.getInternalTexture());-1!==O&&y.splice(O,1),W.isRGBD=!0,W.wrapU=a.e.CLAMP_ADDRESSMODE,W.wrapV=a.e.CLAMP_ADDRESSMODE,U.environmentBRDFTexture=W,U.useDelayedTextureLoading=M,A.b.ExpandRGBDTexture(W);const e=U.getEngine().onContextRestoredObservable.add((()=>{W.isRGBD=!0;const M=U.onBeforeRenderObservable.add((()=>{W.isReady()&&(U.onBeforeRenderObservable.remove(M),A.b.ExpandRGBDTexture(W))}))}));U.rk.add((()=>{U.getEngine().onContextRestoredObservable.remove(e)}))}return U.environmentBRDFTexture}},2564:(U,M,b)=>{"use strict";b.d(M,{b:()=>A});class a{constructor(U){this._pendingActions=new Array,this._workerInfos=U.map((U=>({workerPromise:Promise.resolve(U),idle:!0})))}dispose(){for(const U of this._workerInfos)U.workerPromise.then((U=>{U.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(U){this._executeOnIdleWorker(U)||this._pendingActions.push(U)}_executeOnIdleWorker(U){for(const M of this._workerInfos)if(M.idle)return this._execute(M,U),!0;return!1}_execute(U,M){U.idle=!1,U.workerPromise.then((b=>{M(b,(()=>{const M=this._pendingActions.shift();M?this._execute(U,M):U.idle=!0}))}))}}class A extends a{constructor(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.DefaultOptions;super([]),this._maxWorkers=U,this._createWorkerAsync=M,this._options=b}push(U){if(!this._executeOnIdleWorker(U))if(this._workerInfos.length<this._maxWorkers){const M={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(M),this._execute(M,U)}else this._pendingActions.push(U)}_execute(U,M){U.timeoutId&&(clearTimeout(U.timeoutId),delete U.timeoutId),super._execute(U,((b,a)=>{M(b,(()=>{a(),U.idle&&(U.timeoutId=setTimeout((()=>{U.workerPromise.then((U=>{U.terminate()}));const M=this._workerInfos.indexOf(U);-1!==M&&this._workerInfos.splice(M,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}A.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12318:(U,M,b)=>{"use strict";b.d(M,{c:()=>yM});var a=b(670),A=b(12213);class H extends A.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var W=b(707),y=(b(2448),b(609));class O{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this._targetStopDuration!==U&&(this._targetStopDuration=U)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){this._noiseTexture!==U&&(this._noiseTexture=U,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(U){this._isAnimationSheetEnabled!=U&&(this._isAnimationSheetEnabled=U,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(U){this._useLogarithmicDepth=U&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(U){switch(U){case O.BLENDMODE_MULTIPLYADD:return;case O.BLENDMODE_ADD:U=1;break;case O.BLENDMODE_ONEONE:U=6;break;case O.BLENDMODE_STANDARD:U=2;break;case O.BLENDMODE_MULTIPLY:U=4;break;case O.BLENDMODE_SUBTRACT:U=3}this._engine.setAlphaMode(U)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:a.l.Zero()}set direction1(U){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=U)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:a.l.Zero()}set direction2(U){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=U)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:a.l.Zero()}set minEmitBox(U){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=U)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:a.l.Zero()}set maxEmitBox(U){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=U)}get billboardMode(){return this._billboardMode}set billboardMode(U){this._billboardMode!==U&&(this._billboardMode=U,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(U){this._isBillboardBased!==U&&(this._isBillboardBased=U,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(U){this._attachImageProcessingConfiguration(U)}_attachImageProcessingConfiguration(U){U!==this._imageProcessingConfiguration&&(!U&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=U)}_reset(){}_removeGradientAndTexture(U,M,b){if(!M)return this;let a=0;for(const A of M){if(A.gradient===U){M.splice(a,1);break}a++}return b&&b.dispose(),this}constructor(U){this.animations=[],this.renderingGroupId=0,this.j=a.l.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new a.l(10,10,10),this.onAnimationEnd=null,this.blendMode=O.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new a.i(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Le=new a.l(0,0,0),this._useLogarithmicDepth=!1,this.gravity=a.l.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new W.e(1,1,1,1),this.color2=new W.e(1,1,1,1),this.colorDead=new W.e(0,0,0,1),this.textureMask=new W.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new H,this.id=U,this.name=U}createPointEmitter(U,M){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new a.l(0,1,0),arguments.length>2&&void 0!==arguments[2]||new a.l(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new a.l(0,1,0),arguments.length>4&&void 0!==arguments[4]||new a.l(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new a.l(0,1,0),arguments.length>3&&void 0!==arguments[3]||new a.l(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(U,M,b,a){throw new Error("Method not implemented.")}}O.BLENDMODE_ONEONE=0,O.BLENDMODE_STANDARD=1,O.BLENDMODE_ADD=2,O.BLENDMODE_MULTIPLY=3,O.BLENDMODE_MULTIPLYADD=4,O.BLENDMODE_SUBTRACT=-1,(0,y.i)("BABYLON.BaseParticleSystem",O);var e=b(682),x=b(501);class P{constructor(){this.direction1=new a.l(0,1,0),this.direction2=new a.l(0,1,0),this.minEmitBox=new a.l(-.5,-.5,-.5),this.maxEmitBox=new a.l(.5,.5,.5)}startDirectionFunction(U,M,b,A){const H=(0,e.u)(this.direction1.x,this.direction2.x),W=(0,e.u)(this.direction1.y,this.direction2.y),y=(0,e.u)(this.direction1.z,this.direction2.z);if(A)return M.x=H,M.y=W,void(M.z=y);a.l.TransformNormalFromFloatsToRef(H,W,y,U,M)}startPositionFunction(U,M,b,A){const H=(0,e.u)(this.minEmitBox.x,this.maxEmitBox.x),W=(0,e.u)(this.minEmitBox.y,this.maxEmitBox.y),y=(0,e.u)(this.minEmitBox.z,this.maxEmitBox.z);if(A)return M.x=H,M.y=W,void(M.z=y);a.l.TransformCoordinatesFromFloatsToRef(H,W,y,U,M)}clone(){const U=new P;return x.c.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2),U.setVector3("minEmitBox",this.minEmitBox),U.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3),U.addUniform("minEmitBox",3),U.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.tk(),U.direction2=this.direction2.tk(),U.minEmitBox=this.minEmitBox.tk(),U.maxEmitBox=this.maxEmitBox.tk(),U}parse(U){a.l.FromArrayToRef(U.direction1,0,this.direction1),a.l.FromArrayToRef(U.direction2,0,this.direction2),a.l.FromArrayToRef(U.minEmitBox,0,this.minEmitBox),a.l.FromArrayToRef(U.maxEmitBox,0,this.maxEmitBox)}}class Z{get radius(){return this._radius}set radius(U){this._radius=U,this._buildHeight()}get angle(){return this._angle}set angle(U){this._angle=U,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=b,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=M,this.radius=U}startDirectionFunction(U,M,b,A){A?a.g.lk[0].p(b.ud).normalize():b.position.subtractToRef(U.getTranslation(),a.g.lk[0]).normalize();const H=(0,e.u)(0,this.directionRandomizer),W=(0,e.u)(0,this.directionRandomizer),y=(0,e.u)(0,this.directionRandomizer);M.x=a.g.lk[0].x+H,M.y=a.g.lk[0].y+W,M.z=a.g.lk[0].z+y,M.normalize()}startPositionFunction(U,M,b,A){const H=(0,e.u)(0,2*Math.PI);let W;this.emitFromSpawnPointOnly?W=1e-4:(W=(0,e.u)(0,this.heightRange),W=1-W*W);let y=this._radius-(0,e.u)(0,this._radius*this.radiusRange);y*=W;const O=y*Math.sin(H),x=y*Math.cos(H),P=W*this._height;if(A)return M.x=O,M.y=P,void(M.z=x);a.l.TransformCoordinatesFromFloatsToRef(O,P,x,U,M)}clone(){const U=new Z(this._radius,this._angle,this.directionRandomizer);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setFloat2("radius",this._radius,this.radiusRange),U.setFloat("coneAngle",this._angle),U.setFloat2("height",this._height,this.heightRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",2),U.addUniform("coneAngle",1),U.addUniform("height",2),U.addUniform("directionRandomizer",1)}getEffectDefines(){let U="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(U+="\n#define CONEEMITTERSPAWNPOINT"),U}getClassName(){return"ConeParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this._radius,U.angle=this._angle,U.directionRandomizer=this.directionRandomizer,U.radiusRange=this.radiusRange,U.heightRange=this.heightRange,U.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,U}parse(U){this.radius=U.radius,this.angle=U.angle,this.directionRandomizer=U.directionRandomizer,this.radiusRange=void 0!==U.radiusRange?U.radiusRange:1,this.heightRange=void 0!==U.radiusRange?U.heightRange:1,this.emitFromSpawnPointOnly=void 0!==U.emitFromSpawnPointOnly&&U.emitFromSpawnPointOnly}}class C extends Z{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0);super(U,M),this.direction1=b,this.direction2=A}startDirectionFunction(U,M){const b=(0,e.u)(this.direction1.x,this.direction2.x),A=(0,e.u)(this.direction1.y,this.direction2.y),H=(0,e.u)(this.direction1.z,this.direction2.z);a.l.TransformNormalFromFloatsToRef(b,A,H,U,M)}clone(){const U=new C(this.radius,this.angle,this.direction1,this.direction2);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.tk(),U.direction2=this.direction2.tk(),U}parse(U){super.parse(U),this.direction1.p(U.direction1),this.direction2.p(U.direction2)}}class r{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=U,this.height=M,this.radiusRange=b,this.directionRandomizer=A,this._tempVector=a.l.Zero()}startDirectionFunction(U,M,b,A,H){b.position.subtractToRef(U.getTranslation(),this._tempVector),this._tempVector.normalize(),a.l.TransformNormalToRef(this._tempVector,H,this._tempVector);const W=(0,e.u)(-this.directionRandomizer/2,this.directionRandomizer/2);let y=Math.atan2(this._tempVector.x,this._tempVector.z);y+=(0,e.u)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=W,this._tempVector.x=Math.sin(y),this._tempVector.z=Math.cos(y),this._tempVector.normalize(),A?M.p(this._tempVector):a.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U,M)}startPositionFunction(U,M,b,A){const H=(0,e.u)(-this.height/2,this.height/2),W=(0,e.u)(0,2*Math.PI),y=(0,e.u)((1-this.radiusRange)*(1-this.radiusRange),1),O=Math.sqrt(y)*this.radius,x=O*Math.cos(W),P=O*Math.sin(W);A?M.vd(x,H,P):a.l.TransformCoordinatesFromFloatsToRef(x,H,P,U,M)}clone(){const U=new r(this.radius,this.directionRandomizer);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.height=this.height,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.height=U.height,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class B extends r{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0),H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.l(0,1,0);super(U,M,b),this.direction1=A,this.direction2=H}startDirectionFunction(U,M,b,A){const H=(0,e.u)(this.direction1.x,this.direction2.x),W=(0,e.u)(this.direction1.y,this.direction2.y),y=(0,e.u)(this.direction1.z,this.direction2.z);A?M.vd(H,W,y):a.l.TransformNormalFromFloatsToRef(H,W,y,U,M)}clone(){const U=new B(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.tk(),U.direction2=this.direction2.tk(),U}parse(U){super.parse(U),a.l.FromArrayToRef(U.direction1,0,this.direction1),a.l.FromArrayToRef(U.direction2,0,this.direction2)}}class J{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=M,this.directionRandomizer=b}startDirectionFunction(U,M,b,A){const H=b.position.je(U.getTranslation()).normalize(),W=(0,e.u)(0,this.directionRandomizer),y=(0,e.u)(0,this.directionRandomizer),O=(0,e.u)(0,this.directionRandomizer);H.x+=W,H.y+=y,H.z+=O,H.normalize(),A?M.p(H):a.l.TransformNormalFromFloatsToRef(H.x,H.y,H.z,U,M)}startPositionFunction(U,M,b,A){const H=this.radius-(0,e.u)(0,this.radius*this.radiusRange),W=(0,e.u)(0,1),y=(0,e.u)(0,2*Math.PI),O=Math.acos(2*W-1),x=H*Math.cos(y)*Math.sin(O),P=H*Math.cos(O),Z=H*Math.sin(y)*Math.sin(O);A?M.vd(x,Math.abs(P),Z):a.l.TransformCoordinatesFromFloatsToRef(x,Math.abs(P),Z,U,M)}clone(){const U=new J(this.radius,this.directionRandomizer);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class F{constructor(){this.direction1=new a.l(0,1,0),this.direction2=new a.l(0,1,0)}startDirectionFunction(U,M,b,A){const H=(0,e.u)(this.direction1.x,this.direction2.x),W=(0,e.u)(this.direction1.y,this.direction2.y),y=(0,e.u)(this.direction1.z,this.direction2.z);A?M.vd(H,W,y):a.l.TransformNormalFromFloatsToRef(H,W,y,U,M)}startPositionFunction(U,M,b,A){A?M.vd(0,0,0):a.l.TransformCoordinatesFromFloatsToRef(0,0,0,U,M)}clone(){const U=new F;return x.c.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.tk(),U.direction2=this.direction2.tk(),U}parse(U){a.l.FromArrayToRef(U.direction1,0,this.direction1),a.l.FromArrayToRef(U.direction2,0,this.direction2)}}class f{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=M,this.directionRandomizer=b}startDirectionFunction(U,M,b,A){const H=b.position.je(U.getTranslation()).normalize(),W=(0,e.u)(0,this.directionRandomizer),y=(0,e.u)(0,this.directionRandomizer),O=(0,e.u)(0,this.directionRandomizer);H.x+=W,H.y+=y,H.z+=O,H.normalize(),A?M.p(H):a.l.TransformNormalFromFloatsToRef(H.x,H.y,H.z,U,M)}startPositionFunction(U,M,b,A){const H=this.radius-(0,e.u)(0,this.radius*this.radiusRange),W=(0,e.u)(0,1),y=(0,e.u)(0,2*Math.PI),O=Math.acos(2*W-1),x=H*Math.cos(y)*Math.sin(O),P=H*Math.cos(O),Z=H*Math.sin(y)*Math.sin(O);A?M.vd(x,P,Z):a.l.TransformCoordinatesFromFloatsToRef(x,P,Z,U,M)}clone(){const U=new f(this.radius,this.directionRandomizer);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class L extends f{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.l(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0);super(U),this.direction1=M,this.direction2=b}startDirectionFunction(U,M){const b=(0,e.u)(this.direction1.x,this.direction2.x),A=(0,e.u)(this.direction1.y,this.direction2.y),H=(0,e.u)(this.direction1.z,this.direction2.z);a.l.TransformNormalFromFloatsToRef(b,A,H,U,M)}clone(){const U=new L(this.radius,this.direction1,this.direction2);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.tk(),U.direction2=this.direction2.tk(),U}parse(U){super.parse(U),this.direction1.p(U.direction1),this.direction2.p(U.direction2)}}class z{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(U,M,b,A){const H=a.g.lk[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,b,H);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,b,H);const U=a.g.lk[1];H.subtractToRef(b.position,U),U.scaleToRef(1/b.lifeTime,H)}else H.set(0,0,0);A?M.p(H):a.l.TransformNormalToRef(H,U,M)}startPositionFunction(U,M,b,A){const H=a.g.lk[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,b,H):H.set(0,0,0),A?M.p(H):a.l.TransformCoordinatesToRef(H,U,M)}clone(){const U=new z;return x.c.DeepCopy(this,U),U}applyToShader(U){}buildUniformLayout(U){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.particlePositionGenerator=this.particlePositionGenerator,U.particleDestinationGenerator=this.particleDestinationGenerator,U}parse(U){U.particlePositionGenerator&&(this.particlePositionGenerator=U.particlePositionGenerator),U.particleDestinationGenerator&&(this.particleDestinationGenerator=U.particleDestinationGenerator)}}var o=b(729);class S{get mesh(){return this._mesh}set mesh(U){this._mesh!==U&&(this._mesh=U,U?(this._indices=U.kk(),this._positions=U.getVerticesData(o.e.PositionKind),this._normals=U.getVerticesData(o.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=a.l.Zero(),this._mesh=null,this.direction1=new a.l(0,1,0),this.direction2=new a.l(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=U}startDirectionFunction(U,M,b,A){if(this.useMeshNormalsForDirection&&this._normals)return void a.l.TransformNormalToRef(this._storedNormal,U,M);const H=(0,e.u)(this.direction1.x,this.direction2.x),W=(0,e.u)(this.direction1.y,this.direction2.y),y=(0,e.u)(this.direction1.z,this.direction2.z);A?M.vd(H,W,y):a.l.TransformNormalFromFloatsToRef(H,W,y,U,M)}startPositionFunction(U,M,b,A){if(!this._indices||!this._positions)return;const H=3*(Math.random()*(this._indices.length/3)|0),W=Math.random(),y=Math.random()*(1-W),O=1-W-y,e=this._indices[H],x=this._indices[H+1],P=this._indices[H+2],Z=a.g.lk[0],C=a.g.lk[1],r=a.g.lk[2],B=a.g.lk[3];a.l.FromArrayToRef(this._positions,3*e,Z),a.l.FromArrayToRef(this._positions,3*x,C),a.l.FromArrayToRef(this._positions,3*P,r),B.x=W*Z.x+y*C.x+O*r.x,B.y=W*Z.y+y*C.y+O*r.y,B.z=W*Z.z+y*C.z+O*r.z,A?M.vd(B.x,B.y,B.z):a.l.TransformCoordinatesFromFloatsToRef(B.x,B.y,B.z,U,M),this.useMeshNormalsForDirection&&this._normals&&(a.l.FromArrayToRef(this._normals,3*e,Z),a.l.FromArrayToRef(this._normals,3*x,C),a.l.FromArrayToRef(this._normals,3*P,r),this._storedNormal.x=W*Z.x+y*C.x+O*r.x,this._storedNormal.y=W*Z.y+y*C.y+O*r.y,this._storedNormal.z=W*Z.z+y*C.z+O*r.z)}clone(){const U=new S(this.mesh);return x.c.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var U;const M={};return M.type=this.getClassName(),M.direction1=this.direction1.tk(),M.direction2=this.direction2.tk(),M.meshId=null===(U=this.mesh)||void 0===U?void 0:U.id,M.useMeshNormalsForDirection=this.useMeshNormalsForDirection,M}parse(U,M){a.l.FromArrayToRef(U.direction1,0,this.direction1),a.l.FromArrayToRef(U.direction2,0,this.direction2),U.meshId&&M&&(this.mesh=M.getLastMeshById(U.meshId)),this.useMeshNormalsForDirection=U.useMeshNormalsForDirection}}class h{_isUbo(U){return void 0!==U.addUniform}constructor(U){this._isUbo(U)?(this.setMatrix3x3=U.updateMatrix3x3.bind(U),this.setMatrix2x2=U.updateMatrix2x2.bind(U),this.setFloat=U.updateFloat.bind(U),this.setFloat2=U.updateFloat2.bind(U),this.setFloat3=U.updateFloat3.bind(U),this.setFloat4=U.updateFloat4.bind(U),this.setFloatArray=U.updateFloatArray.bind(U),this.setArray=U.updateArray.bind(U),this.setIntArray=U.updateIntArray.bind(U),this.setMatrix=U.zk.bind(U),this.setMatrices=U.updateMatrices.bind(U),this.setVector3=U.updateVector3.bind(U),this.setVector4=U.updateVector4.bind(U),this.setColor3=U.updateColor3.bind(U),this.setColor4=U.updateColor4.bind(U),this.setDirectColor4=U.updateDirectColor4.bind(U),this.setInt=U.updateInt.bind(U),this.setInt2=U.updateInt2.bind(U),this.setInt3=U.updateInt3.bind(U),this.setInt4=U.updateInt4.bind(U)):(this.setMatrix3x3=U.setMatrix3x3.bind(U),this.setMatrix2x2=U.setMatrix2x2.bind(U),this.setFloat=U.setFloat.bind(U),this.setFloat2=U.setFloat2.bind(U),this.setFloat3=U.setFloat3.bind(U),this.setFloat4=U.setFloat4.bind(U),this.setFloatArray=U.setFloatArray.bind(U),this.setArray=U.setArray.bind(U),this.setIntArray=U.setIntArray.bind(U),this.setMatrix=U.setMatrix.bind(U),this.setMatrices=U.setMatrices.bind(U),this.setVector3=U.setVector3.bind(U),this.setVector4=U.setVector4.bind(U),this.setColor3=U.setColor3.bind(U),this.setColor4=U.setColor4.bind(U),this.setDirectColor4=U.setDirectColor4.bind(U),this.setInt=U.setInt.bind(U),this.setInt2=U.setInt2.bind(U),this.setInt3=U.setInt3.bind(U),this.setInt4=U.setInt4.bind(U))}}var i=b(572);const Y="gpuUpdateParticlesPixelShader",d="#version 300 es\nvoid main() {discard;}\n";i.c.ShadersStore[Y]||(i.c.ShadersStore[Y]=d);const s="gpuUpdateParticlesVertexShader",q="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";i.c.ShadersStore[s]||(i.c.ShadersStore[s]=q);(0,y.i)("BABYLON.WebGL2ParticleSystem",class{constructor(U,M){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=U,this._engine=M,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var U;return(null===(U=this._updateEffect)||void 0===U?void 0:U.isReady())??!1}createUpdateBuffer(U){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof z&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=U,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new h(this._updateEffect)}createVertexBuffers(U,M){this._updateVAO.push(this._createUpdateVAO(U)),this._renderVAO.push(this._engine.recordVertexArrayObject(M,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=M}createParticleBuffer(U){return U}bindDrawBuffers(U,M,b){b?this._engine.bindBuffers(this._renderVertexBuffers,b,M):this._engine.bindVertexArrayObject(this._renderVAO[U],null)}preUpdateParticleBuffer(){const U=this._engine;if(this._engine.enableEffect(this._updateEffect),!U.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(U,M,b){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[U],null);const a=this._engine;a.bindTransformFeedbackBuffer(M.getBuffer()),a.setRasterizerState(!1),a.beginTransformFeedback(!0),a.drawArraysType(3,0,b),a.endTransformFeedback(),a.setRasterizerState(!0),a.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let U=0;U<this._updateVAO.length;U++)this._engine.releaseVertexArrayObject(this._updateVAO[U]);this._updateVAO.length=0;for(let U=0;U<this._renderVAO.length;U++)this._engine.releaseVertexArrayObject(this._renderVAO[U]);this._renderVAO.length=0}_createUpdateVAO(U){const M={};M.position=U.createVertexBuffer("position",0,3);let b=3;M.age=U.createVertexBuffer("age",b,1),b+=1,M.size=U.createVertexBuffer("size",b,3),b+=3,M.life=U.createVertexBuffer("life",b,1),b+=1,M.seed=U.createVertexBuffer("seed",b,4),b+=4,M.direction=U.createVertexBuffer("direction",b,3),b+=3,this._parent.particleEmitterType instanceof z&&(M.initialPosition=U.createVertexBuffer("initialPosition",b,3),b+=3),this._parent._colorGradientsTexture||(M.color=U.createVertexBuffer("color",b,4),b+=4),this._parent._isBillboardBased||(M.initialDirection=U.createVertexBuffer("initialDirection",b,3),b+=3),this._parent.noiseTexture&&(M.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",b,3),b+=3,M.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",b,3),b+=3),this._parent._angularSpeedGradientsTexture?(M.angle=U.createVertexBuffer("angle",b,1),b+=1):(M.angle=U.createVertexBuffer("angle",b,2),b+=2),this._parent._isAnimationSheetEnabled&&(M.cellIndex=U.createVertexBuffer("cellIndex",b,1),b+=1,this._parent.spriteRandomStartCell&&(M.cellStartOffset=U.createVertexBuffer("cellStartOffset",b,1),b+=1));const a=this._engine.recordVertexArrayObject(M,null,this._updateEffect);return this._engine.bindArrayBuffer(null),a}});class m{constructor(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=arguments.length>3?arguments[3]:void 0;this._engine=U,this._label=a,this._engine._storageBuffers.push(this),this._create(M,b)}_create(U,M){this._bufferSize=U,this._creationFlags=M,this._buffer=this._engine.createStorageBuffer(U,M,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(U,M,b){this._buffer&&this._engine.updateStorageBuffer(this._buffer,U,M,b)}async read(U,M,b,a){return await this._engine.readFromStorageBuffer(this._buffer,U,M,b,a)}dispose(){const U=this._engine._storageBuffers,M=U.indexOf(this);-1!==M&&(U[M]=U[U.length-1],U.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var n=b(645),E=b(652),X=b(698),Q=b(2371),I=b(2536),v=b(497),t=b(594),V=b(2475);class k{constructor(){this._gpuTimeInFrameId=-1,this.counter=new V.e}_addDuration(U,M){U<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==U?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(M,!1),this._gpuTimeInFrameId=U):this.counter.addCount(M,!1))}}var N=b(557);class R{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=U,this._engine=M,this.uniqueId=I.b.UniqueId,M.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new k),this._engine.getCaps().supportComputeShaders?a.bindingsMapping?(this._context=M.createComputeContext(),this._shaderPath=b,this._options={bindingsMapping:{},defines:[],...a}):v.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):v.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(U,M){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const a=this._bindings[U];this._bindings[U]={type:b?0:4,object:M,indexInGroupEntries:null===a||void 0===a?void 0:a.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!a||a.object!==M||a.type!==this._bindings[U].type)}setStorageTexture(U,M){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==M),this._bindings[U]={type:1,object:M,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setExternalTexture(U,M){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==M),this._bindings[U]={type:6,object:M,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setVideoTexture(U,M){return!!M.externalTexture&&(this.setExternalTexture(U,M.externalTexture),!0)}setUniformBuffer(U,M){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==M),this._bindings[U]={type:R._BufferIsDataBuffer(M)?7:2,object:M,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setStorageBuffer(U,M){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==M),this._bindings[U]={type:R._BufferIsDataBuffer(M)?7:3,object:M,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setTextureSampler(U,M){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||!M.compareSampler(b.object)),this._bindings[U]={type:5,object:M,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}isReady(){let U=this._effect;for(const A in this._bindings){const U=this._bindings[A],M=U.type,b=U.object;switch(M){case 0:case 4:case 1:if(!b.isReady())return!1;break;case 6:if(!b.isReady())return!1;break}}const M=[],b=this._shaderPath;if(this._options.defines)for(let A=0;A<this._options.defines.length;A++)M.push(this._options.defines[A]);const a=M.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,U=this._engine.createComputeEffect(b,{defines:a,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=U),!!U.isReady()}dispatch(U,M,b){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,U,M,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const b=R._BufferIsDataBuffer(U)?U:U.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,M,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const M in this._bindings){const b=this._bindings[M];if(!this._options.bindingsMapping[M])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+M+"'");switch(b.type){case 0:{const a=this._samplers[M],A=b.object;var U;if(!a||!A._texture||!a.compareSampler(A._texture))this._samplers[M]=(new t.c).setParameters(A.wrapU,A.wrapV,A.wrapR,A.anisotropicFilteringLevel,A._texture.samplingMode,null===(U=A._texture)||void 0===U?void 0:U._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const U=b.object;U.getBuffer()!==b.buffer&&(b.buffer=U.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((A=>{(0,N.h)((()=>this.dispatch(U,M,b)),A,void 0,a)}))}serialize(){const U=X.d.Serialize(this);U.options=this._options,U.shaderPath=this._shaderPath,U.am={},U.textures={};for(const M in this._bindings){const b=this._bindings[M],a=b.object;switch(b.type){case 0:case 4:case 1:{const A=a.serialize();A&&(U.textures[M]=A,U.am[M]={type:b.type});break}}}return U}static Parse(U,M,b){const a=X.d.Parse((()=>new R(U.name,M.getEngine(),U.shaderPath,U.options)),U,M,b);for(const A in U.textures){const H=U.am[A],W=Q.e.Parse(U.textures[A],M,b);0===H.type?a.setTexture(A,W):4===H.type?a.setTexture(A,W,!1):a.setStorageTexture(A,W)}return a}static _BufferIsDataBuffer(U){return void 0!==U.underlyingResource}}(0,n.c)([(0,E.J)()],R.prototype,"name",void 0),(0,n.c)([(0,E.J)()],R.prototype,"fastMode",void 0),(0,y.i)("BABYLON.ComputeShader",R);var j=b(801);const p="gpuUpdateParticlesComputeShader",g="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";i.c.ShadersStoreWGSL[p]||(i.c.ShadersStoreWGSL[p]=g);(0,y.i)("BABYLON.ComputeShaderParticleSystem",class{constructor(U,M){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=U,this._engine=M}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var U;return(null===(U=this._updateComputeShader)||void 0===U?void 0:U.isReady())??!1}createUpdateBuffer(U){var M;const b={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(b.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(b.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(b.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(b.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(b.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(b.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(b.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new R("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:b,defines:U.split("\n")}),null===(M=this._simParamsComputeShader)||void 0===M||M.dispose(),this._simParamsComputeShader=new j.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new h(this._simParamsComputeShader)}createVertexBuffers(U,M){this._renderVertexBuffers.push(M)}createParticleBuffer(U){const M=new m(this._engine,4*U.length,11,"ComputeShaderParticleSystemBuffer");return M.update(U),this._bufferComputeShader.push(M),M.getBuffer()}bindDrawBuffers(U,M,b){this._engine.bindBuffers(this._renderVertexBuffers[U],b,M)}preUpdateParticleBuffer(){}updateParticleBuffer(U,M,b){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[U]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^U]),this._updateComputeShader.dispatch(Math.ceil(b/64))}releaseBuffers(){var U;for(let M=0;M<this._bufferComputeShader.length;++M)this._bufferComputeShader[M].dispose();this._bufferComputeShader.length=0,null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class K{constructor(U,M,b){this.gradient=U,this.color1=M,this.color2=b}getColorToRef(U){this.color2?W.e.LerpToRef(this.color1,this.color2,Math.random(),U):U.p(this.color1)}}class w{constructor(U,M){this.gradient=U,this.color=M}}class T{constructor(U,M,b){this.gradient=U,this.factor1=M,this.factor2=b}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class G{static GetCurrentGradient(U,M,b){if(M[0].gradient>U)return void b(M[0],M[0],1);for(let A=0;A<M.length-1;A++){const a=M[A],H=M[A+1];if(U>=a.gradient&&U<=H.gradient){return void b(a,H,(U-a.gradient)/(H.gradient-a.gradient))}}const a=M.length-1;b(M[a],M[a],1)}}var l=b(474),D=b(12326),u=b(524);class c{constructor(U){this.particleSystem=U,this.position=a.l.Zero(),this.direction=a.l.Zero(),this.color=new W.e(0,0,0,0),this.colorStep=new W.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new a.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new W.e(0,0,0,0),this._currentColor2=new W.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=c._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let U=this.age,M=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===M?(M=1,U=this._randomCellOffset):U+=this._randomCellOffset);const b=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let a;a=this._initialSpriteCellLoop?(0,e.b)(U*M%this.lifeTime/this.lifeTime):(0,e.b)(U*M/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+a*b|0}_inheritParticleInfoToSubEmitter(U){if(U.particleSystem.j.position){const M=U.particleSystem.j;if(M.position.p(this.position),U.inheritDirection){const U=a.g.lk[0];this.direction.normalizeToRef(U),M.setDirection(U,0,Math.PI/2)}}else{U.particleSystem.j.p(this.position)}this.direction.scaleToRef(U.inheritedVelocityAmount/2,a.g.lk[0]),U.particleSystem._inheritedVelocityOffset.p(a.g.lk[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const U of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(U)}_reset(){this.age=0,this.id=c._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(U){U.position.p(this.position),this._initialDirection?U._initialDirection?U._initialDirection.p(this._initialDirection):U._initialDirection=this._initialDirection.clone():U._initialDirection=null,U.direction.p(this.direction),this.ud&&(U.ud?U.ud.p(this.ud):U.ud=this.ud.clone()),U.color.p(this.color),U.colorStep.p(this.colorStep),U.lifeTime=this.lifeTime,U.age=this.age,U._randomCellOffset=this._randomCellOffset,U.size=this.size,U.scale.p(this.scale),U.angle=this.angle,U.angularSpeed=this.angularSpeed,U.particleSystem=this.particleSystem,U.cellIndex=this.cellIndex,U.id=this.id,U._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(U._currentColorGradient=this._currentColorGradient,U._currentColor1.p(this._currentColor1),U._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(U._currentSizeGradient=this._currentSizeGradient,U._currentSize1=this._currentSize1,U._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(U._currentAngularSpeedGradient=this._currentAngularSpeedGradient,U._currentAngularSpeed1=this._currentAngularSpeed1,U._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(U._currentVelocityGradient=this._currentVelocityGradient,U._currentVelocity1=this._currentVelocity1,U._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(U._currentLimitVelocityGradient=this._currentLimitVelocityGradient,U._currentLimitVelocity1=this._currentLimitVelocity1,U._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(U._currentDragGradient=this._currentDragGradient,U._currentDrag1=this._currentDrag1,U._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(U._initialStartSpriteCellId=this._initialStartSpriteCellId,U._initialEndSpriteCellId=this._initialEndSpriteCellId,U._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(U.remapData&&this.remapData?U.remapData.p(this.remapData):U.remapData=new a.n(0,0,0,0)),this._randomNoiseCoordinates1&&(U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),U._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(U._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),U._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}c._Count=0;var UU=b(777),MU=(b(2443),b(823)),bU=b(816),aU=b(2511);function AU(U,M){const b=(0,e.u)(0,1);W.e.LerpToRef(M.color1,M.color2,b,U.color),M.colorDead.subtractToRef(U.color,M._colorDiff),M._colorDiff.scaleToRef(1/U.lifeTime,U.colorStep)}function HU(U,M){U._currentColorGradient=M._colorGradients[0],U._currentColorGradient.getColorToRef(U.color),U._currentColor1.p(U.color),M._colorGradients.length>1?M._colorGradients[1].getColorToRef(U._currentColor2):U._currentColor2.p(U.color)}function WU(U,M){const b=M._colorGradients;G.GetCurrentGradient(M._ratio,b,((M,b,a)=>{M!==U._currentColorGradient&&(U._currentColor1.p(U._currentColor2),b.getColorToRef(U._currentColor2),U._currentColorGradient=M),W.e.LerpToRef(U._currentColor1,U._currentColor2,a,U.color)}))}function yU(U,M){U.colorStep.scaleToRef(M._scaledUpdateSpeed,M._scaledColorStep),U.color.addInPlace(M._scaledColorStep),U.color.a<0&&(U.color.a=0)}function OU(U,M){G.GetCurrentGradient(M._ratio,M._angularSpeedGradients,((M,b,a)=>{M!==U._currentAngularSpeedGradient&&(U._currentAngularSpeed1=U._currentAngularSpeed2,U._currentAngularSpeed2=b.getFactor(),U._currentAngularSpeedGradient=M),U.angularSpeed=(0,e.n)(U._currentAngularSpeed1,U._currentAngularSpeed2,a)}))}function eU(U,M){U.angle+=U.angularSpeed*M._scaledUpdateSpeed}function xU(U,M){M.particleEmitterType.startDirectionFunction(M._emitterWorldMatrix,U.direction,U,M.isLocal,M._emitterInverseWorldMatrix)}function PU(U,M){M.startDirectionFunction(M._emitterWorldMatrix,U.direction,U,M.isLocal)}function ZU(U,M){U._currentVelocityGradient=M._velocityGradients[0],U._currentVelocity1=U._currentVelocityGradient.getFactor(),M._velocityGradients.length>1?U._currentVelocity2=M._velocityGradients[1].getFactor():U._currentVelocity2=U._currentVelocity1}function CU(U,M){U._currentLimitVelocityGradient=M._limitVelocityGradients[0],U._currentLimitVelocity1=U._currentLimitVelocityGradient.getFactor(),M._limitVelocityGradients.length>1?U._currentLimitVelocity2=M._limitVelocityGradients[1].getFactor():U._currentLimitVelocity2=U._currentLimitVelocity1}function rU(U,M){G.GetCurrentGradient(M._ratio,M._velocityGradients,((b,a,A)=>{b!==U._currentVelocityGradient&&(U._currentVelocity1=U._currentVelocity2,U._currentVelocity2=a.getFactor(),U._currentVelocityGradient=b),M._directionScale*=(0,e.n)(U._currentVelocity1,U._currentVelocity2,A)}))}function BU(U,M){G.GetCurrentGradient(M._ratio,M._limitVelocityGradients,((b,a,A)=>{b!==U._currentLimitVelocityGradient&&(U._currentLimitVelocity1=U._currentLimitVelocity2,U._currentLimitVelocity2=a.getFactor(),U._currentLimitVelocityGradient=b);const H=(0,e.n)(U._currentLimitVelocity1,U._currentLimitVelocity2,A);U.direction.length()>H&&U.direction.scaleInPlace(M.limitVelocityDamping)}))}function JU(U,M){U.direction.scaleToRef(M._directionScale,M._scaledDirection)}function FU(U,M){M.particleEmitterType.startPositionFunction(M._emitterWorldMatrix,U.position,U,M.isLocal)}function fU(U,M){M.startPositionFunction(M._emitterWorldMatrix,U.position,U,M.isLocal)}function LU(U,M){U.ud?U.ud.p(U.position):U.ud=U.position.clone(),a.l.TransformCoordinatesToRef(U.ud,M._emitterWorldMatrix,U.position)}function zU(U,M){M.isLocal&&U.ud?(U.ud.addInPlace(M._scaledDirection),a.l.TransformCoordinatesToRef(U.ud,M._emitterWorldMatrix,U.position)):U.position.addInPlace(M._scaledDirection)}function oU(U,M){U._currentDragGradient=M._dragGradients[0],U._currentDrag1=U._currentDragGradient.getFactor(),M._dragGradients.length>1?U._currentDrag2=M._dragGradients[1].getFactor():U._currentDrag2=U._currentDrag1}function SU(U,M){G.GetCurrentGradient(M._ratio,M._dragGradients,((b,a,A)=>{b!==U._currentDragGradient&&(U._currentDrag1=U._currentDrag2,U._currentDrag2=a.getFactor(),U._currentDragGradient=b);const H=(0,e.n)(U._currentDrag1,U._currentDrag2,A);M._scaledDirection.scaleInPlace(1-H)}))}function hU(U,M){U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.vd(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2.vd(Math.random(),Math.random(),Math.random())):(U._randomNoiseCoordinates1=new a.l(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2=new a.l(Math.random(),Math.random(),Math.random()))}function iU(U,M){const b=M._noiseTextureData,A=M._noiseTextureSize;if(b&&A&&U._randomNoiseCoordinates1){const H=M._fetchR(U._randomNoiseCoordinates1.x,U._randomNoiseCoordinates1.y,A.width,A.height,b),W=M._fetchR(U._randomNoiseCoordinates1.z,U._randomNoiseCoordinates2.x,A.width,A.height,b),y=M._fetchR(U._randomNoiseCoordinates2.y,U._randomNoiseCoordinates2.z,A.width,A.height,b),O=a.g.lk[0],e=a.g.lk[1];O.vd((2*H-1)*M.noiseStrength.x,(2*W-1)*M.noiseStrength.y,(2*y-1)*M.noiseStrength.z),O.scaleToRef(M._tempScaledUpdateSpeed,e),U.direction.addInPlace(e)}}function YU(U,M){M.gravity.scaleToRef(M._tempScaledUpdateSpeed,M._scaledGravity),U.direction.addInPlace(M._scaledGravity)}function dU(U,M){U.size=(0,e.u)(M.minSize,M.maxSize),U.scale.vd((0,e.u)(M.minScaleX,M.maxScaleX),(0,e.u)(M.minScaleY,M.maxScaleY))}function sU(U,M){U._currentSizeGradient=M._sizeGradients[0],U._currentSize1=U._currentSizeGradient.getFactor(),U.size=U._currentSize1,M._sizeGradients.length>1?U._currentSize2=M._sizeGradients[1].getFactor():U._currentSize2=U._currentSize1,U.scale.vd((0,e.u)(M.minScaleX,M.maxScaleX),(0,e.u)(M.minScaleY,M.maxScaleY))}function qU(U,M){const b=M._actualFrame/M.targetStopDuration;G.GetCurrentGradient(b,M._startSizeGradients,((b,a,A)=>{b!==M._currentStartSizeGradient&&(M._currentStartSize1=M._currentStartSize2,M._currentStartSize2=a.getFactor(),M._currentStartSizeGradient=b);const H=(0,e.n)(M._currentStartSize1,M._currentStartSize2,A);U.scale.scaleInPlace(H)}))}function mU(U,M){G.GetCurrentGradient(M._ratio,M._sizeGradients,((M,b,a)=>{M!==U._currentSizeGradient&&(U._currentSize1=U._currentSize2,U._currentSize2=b.getFactor(),U._currentSizeGradient=M),U.size=(0,e.n)(U._currentSize1,U._currentSize2,a)}))}function nU(U,M){U.remapData=new a.n(0,1,0,1)}function EU(U,M){M._colorRemapGradients&&M._colorRemapGradients.length>0&&G.GetCurrentGradient(M._ratio,M._colorRemapGradients,((M,b,a)=>{const A=(0,e.n)(M.factor1,b.factor1,a),H=(0,e.n)(M.factor2,b.factor2,a);U.remapData.x=A,U.remapData.y=H-A})),M._alphaRemapGradients&&M._alphaRemapGradients.length>0&&G.GetCurrentGradient(M._ratio,M._alphaRemapGradients,((M,b,a)=>{const A=(0,e.n)(M.factor1,b.factor1,a),H=(0,e.n)(M.factor2,b.factor2,a);U.remapData.z=A,U.remapData.w=H-A}))}function XU(U,M){const b=(0,e.b)(M._actualFrame/M.targetStopDuration);G.GetCurrentGradient(b,M._lifeTimeGradients,((M,a)=>{const A=M,H=a,W=A.getFactor(),y=H.getFactor(),O=(b-A.gradient)/(H.gradient-A.gradient);U.lifeTime=(0,e.n)(W,y,O)})),M._emitPower=(0,e.u)(M.minEmitPower,M.maxEmitPower)}function QU(U,M){U.lifeTime=(0,e.u)(M.minLifeTime,M.maxLifeTime),M._emitPower=(0,e.u)(M.minEmitPower,M.maxEmitPower)}function IU(U,M){0===M._emitPower?(U._initialDirection?U._initialDirection.p(U.direction):U._initialDirection=U.direction.clone(),U.direction.set(0,0,0)):(U._initialDirection=null,U.direction.scaleInPlace(M._emitPower)),U.direction.addInPlace(M._inheritedVelocityOffset)}function vU(U,M){U.angularSpeed=(0,e.u)(M.minAngularSpeed,M.maxAngularSpeed),U.angle=(0,e.u)(M.minInitialRotation,M.maxInitialRotation)}function tU(U,M){U._currentAngularSpeedGradient=M._angularSpeedGradients[0],U.angularSpeed=U._currentAngularSpeedGradient.getFactor(),U._currentAngularSpeed1=U.angularSpeed,M._angularSpeedGradients.length>1?U._currentAngularSpeed2=M._angularSpeedGradients[1].getFactor():U._currentAngularSpeed2=U._currentAngularSpeed1,U.angle=(0,e.u)(M.minInitialRotation,M.maxInitialRotation)}function VU(U,M){U._initialStartSpriteCellId=M.startSpriteCellID,U._initialEndSpriteCellId=M.endSpriteCellID,U._initialSpriteCellLoop=M.spriteCellLoop}function kU(U,M){U.previousItem=M.previousItem,U.nextItem=M,M.previousItem&&(M.previousItem.nextItem=U),M.previousItem=U}function NU(U,M){U.previousItem=M,U.nextItem=M.nextItem,M.nextItem&&(M.nextItem.previousItem=U),M.nextItem=U}function RU(U,M){let b=M;for(;b.nextItem;)b=b.nextItem;U.previousItem=b,U.nextItem=b.nextItem,b.nextItem=U}function jU(U){U.previousItem&&(U.previousItem.nextItem=U.nextItem),U.nextItem&&(U.nextItem.previousItem=U.previousItem)}class pU extends O{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(U){this._startDirectionFunction!==U&&(this._startDirectionFunction=U,this._directionProcessing.process=U?PU:xU)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(U){this._startPositionFunction!==U&&(this._startPositionFunction=U,this._positionCreation.process=U?fU:FU)}set onDispose(U){this._onDisposeObserver&&this.rk.remove(this._onDisposeObserver),this._onDisposeObserver=this.rk.add(U)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(U){this._useRampGradients!==U&&(this._useRampGradients=U,this._resetEffect(),U?(this._rampCreation={process:nU,previousItem:null,nextItem:null},NU(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:EU,previousItem:null,nextItem:null},NU(this._remapGradientProcessing,this._gravityProcessing)):(jU(this._rampCreation),jU(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(U){this._isLocal!==U&&(this._isLocal=U,U?(this._isLocalCreation={process:LU,previousItem:null,nextItem:null},NU(this._isLocalCreation,this._positionCreation)):jU(this._isLocalCreation))}get particles(){return this.Xl}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U,U?(this._sheetCreation={process:VU,previousItem:null,nextItem:null},NU(this._sheetCreation,this._colorCreation)):jU(this._sheetCreation),this._reset())}getActiveCount(){return this.Xl.length}getClassName(){return"Xk"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var U;let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(U=this._customWrappers[M])||void 0===U?void 0:U.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[U]??this._customWrappers[0]}setCustomEffect(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[M]=new UU.d(this._engine),this._customWrappers[M].effect=U,this._customWrappers[M].drawContext&&(this._customWrappers[M].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){if(this.noiseTexture!==U){if(this._noiseTexture=U,!U)return jU(this._noiseCreation),void jU(this._noiseProcessing);this._noiseCreation={process:hU,previousItem:null,nextItem:null},NU(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:iU,previousItem:null,nextItem:null},NU(this._noiseProcessing,this._positionProcessing)}}constructor(U,M,b){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]&&arguments[4],y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(U),this._emitterInverseWorldMatrix=a.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new a.l,this.rk=new l.e,this.onStoppedObservable=new l.e,this.onStartedObservable=new l.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Xl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new W.e(0,0,0,0),this._colorDiff=new W.e(0,0,0,0),this._scaledDirection=a.l.Zero(),this._scaledGravity=a.l.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=U=>{},this.recycleParticle=U=>{const M=this.Xl.pop();M!==U&&M.copyTo(U),this._stockParticles.push(M)},this._createParticle=()=>{let U;return 0!==this._stockParticles.length?(U=this._stockParticles.pop(),U._reset()):U=new c(this),this._prepareParticle(U),U},this.paused=!1,this._shadersLoaded=!1,this._capacity=M,this._epsilon=y,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=a.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||u.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ik.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:QU,previousItem:null,nextItem:null},this._positionCreation={process:FU,previousItem:null,nextItem:null},NU(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:xU,previousItem:null,nextItem:null},NU(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:IU,previousItem:null,nextItem:null},NU(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:dU,previousItem:null,nextItem:null},NU(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:vU,previousItem:null,nextItem:null},NU(this._angleCreation,this._sizeCreation),this._colorCreation={process:AU,previousItem:null,nextItem:null},NU(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,O||(this._colorProcessing={process:yU,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:eU,previousItem:null,nextItem:null},NU(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:JU,previousItem:null,nextItem:null},NU(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:zU,previousItem:null,nextItem:null},NU(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:YU,previousItem:null,nextItem:null},NU(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=H,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new UU.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new P,this.updateFunction=U=>{var M;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(M=this.noiseTexture.getContent())||void 0===M||M.then((U=>{this._noiseTextureData=U})));const b=U===this.Xl;for(let a=0;a<U.length;a++){const M=U[a];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const A=M.age;if(M.age+=this._tempScaledUpdateSpeed,M.age>M.lifeTime){const U=M.age-A,b=M.lifeTime-A;this._tempScaledUpdateSpeed=b*this._tempScaledUpdateSpeed/U,M.age=M.lifeTime}this._ratio=M.age/M.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let H=this._updateQueueStart;for(;H;)H.process(M,this),H=H.nextItem;if(this._isAnimationSheetEnabled&&!O&&M.updateCellIndex(),M._inheritParticleInfoToSubEmitters(),M.age>=M.lifeTime){if(this._emitFromParticle(M),M._attachedSubEmitters){for(const U of M._attachedSubEmitters)U.particleSystem.disposeOnStop=!0,U.particleSystem.stop();M._attachedSubEmitters=null}this.recycleParticle(M),b&&a--}else;}}}serialize(U){throw new Error("Method not implemented.")}clone(U,M){throw new Error("Method not implemented.")}_addFactorGradient(U,M,b,a){const A=new T(M,b,a);U.push(A),U.sort(((U,M)=>U.gradient<M.gradient?-1:U.gradient>M.gradient?1:0))}_removeFactorGradient(U,M){if(!U)return;let b=0;for(const a of U){if(a.gradient===M){U.splice(b,1);break}b++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=XU:this._lifeTimeCreation.process=QU}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:qU,previousItem:null,nextItem:null},NU(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(jU(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this.targetStopDuration!==U&&(this._targetStopDuration=U,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(U,M,b){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,U,M,b),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(U){return this._removeFactorGradient(this._lifeTimeGradients,U),this._syncLifeTimeCreation(),this}addSizeGradient(U,M,b){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=sU,this._sizeGradientProcessing={process:mU,previousItem:null,nextItem:null},kU(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,U,M,b),this}removeSizeGradient(U){var M;return this._removeFactorGradient(this._sizeGradients,U),0===(null===(M=this._sizeGradients)||void 0===M?void 0:M.length)&&(jU(this._sizeGradientProcessing),this._sizeCreation.process=dU),this}addColorRemapGradient(U,M,b){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,U,M,b),this}removeColorRemapGradient(U){return this._removeFactorGradient(this._colorRemapGradients,U),this}addAlphaRemapGradient(U,M,b){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,U,M,b),this}removeAlphaRemapGradient(U){return this._removeFactorGradient(this._alphaRemapGradients,U),this}addAngularSpeedGradient(U,M,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=tU,this._angularSpeedGradientProcessing={process:OU,previousItem:null,nextItem:null},kU(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,U,M,b),this}removeAngularSpeedGradient(U){var M;return this._removeFactorGradient(this._angularSpeedGradients,U),0===(null===(M=this._angularSpeedGradients)||void 0===M?void 0:M.length)&&(this._angleCreation.process=vU,jU(this._angularSpeedGradientProcessing)),this}addVelocityGradient(U,M,b){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ZU,previousItem:null,nextItem:null},NU(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:rU,previousItem:null,nextItem:null},kU(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,U,M,b),this}removeVelocityGradient(U){var M;return this._removeFactorGradient(this._velocityGradients,U),0===(null===(M=this._velocityGradients)||void 0===M?void 0:M.length)&&(jU(this._velocityCreation),jU(this._velocityGradientProcessing)),this}addLimitVelocityGradient(U,M,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:CU,previousItem:null,nextItem:null},NU(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:BU,previousItem:null,nextItem:null},NU(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,U,M,b),this}removeLimitVelocityGradient(U){var M;return this._removeFactorGradient(this._limitVelocityGradients,U),0===(null===(M=this._limitVelocityGradients)||void 0===M?void 0:M.length)&&(jU(this._limitVelocityCreation),jU(this._limitVelocityGradientProcessing)),this}addDragGradient(U,M,b){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:oU,previousItem:null,nextItem:null},kU(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:SU,previousItem:null,nextItem:null},kU(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,U,M,b),this}removeDragGradient(U){var M;return this._removeFactorGradient(this._dragGradients,U),0===(null===(M=this._dragGradients)||void 0===M?void 0:M.length)&&(jU(this._dragCreation),jU(this._dragGradientProcessing)),this}addEmitRateGradient(U,M,b){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,U,M,b),this}removeEmitRateGradient(U){return this._removeFactorGradient(this._emitRateGradients,U),this}addStartSizeGradient(U,M,b){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,U,M,b),this._syncStartSizeCreation(),this}removeStartSizeGradient(U){return this._removeFactorGradient(this._startSizeGradients,U),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const U=new Uint8Array(4*this._rawTextureWidth),M=W.g.Ck[0];for(let b=0;b<this._rawTextureWidth;b++){const a=b/this._rawTextureWidth;G.GetCurrentGradient(a,this._rampGradients,((a,A,H)=>{W.c.LerpToRef(a.color,A.color,H,M),U[4*b]=255*M.r,U[4*b+1]=255*M.g,U[4*b+2]=255*M.b,U[4*b+3]=255}))}this._rampGradientsTexture=D.d.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((U,M)=>U.gradient<M.gradient?-1:U.gradient>M.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(U,M){this._rampGradients||(this._rampGradients=[]);const b=new w(U,M);return this._rampGradients.push(b),this._syncRampGradientTexture(),this}removeRampGradient(U){return this._removeGradientAndTexture(U,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(U,M,b){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=HU,this._colorProcessing.process=WU);const a=new K(U,M,b);return this._colorGradients.push(a),this._colorGradients.sort(((U,M)=>U.gradient<M.gradient?-1:U.gradient>M.gradient?1:0)),this}removeColorGradient(U){if(!this._colorGradients)return this;let M=0;for(const b of this._colorGradients){if(b.gradient===U){this._colorGradients.splice(M,1);break}M++}return 0===this._colorGradients.length&&(this._colorCreation.process=AU,this._colorProcessing.process=yU),this}resetDrawCache(){if(this._drawWrappers){for(const U of this._drawWrappers)if(U)for(const M of U)null===M||void 0===M||M.dispose();this._drawWrappers=[]}}_fetchR(U,M,b,a,A){return A[4*(((U=.5*Math.abs(U)+.5)*b%b|0)+((M=.5*Math.abs(M)+.5)*a%a|0)*b)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const U=this._engine,M=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*M),this._vertexBuffer=new o.c(U,this._vertexData,!0,M);let b=0;const a=this._vertexBuffer.createVertexBuffer(o.e.PositionKind,b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.e.PositionKind]=a,b+=3;const A=this._vertexBuffer.createVertexBuffer(o.e.ColorKind,b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.e.ColorKind]=A,b+=4;const H=this._vertexBuffer.createVertexBuffer("angle",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=H,b+=1;const W=this._vertexBuffer.createVertexBuffer("size",b,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=W,b+=2,this._isAnimationSheetEnabled){const U=this._vertexBuffer.createVertexBuffer("cellIndex",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=U,b+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const U=this._vertexBuffer.createVertexBuffer("direction",b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=U,b+=3}if(this._useRampGradients){const U=this._vertexBuffer.createVertexBuffer("remapData",b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=U,b+=4}let y;if(this._useInstancing){const M=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new o.c(U,M,!1,2),y=this._spriteBuffer.createVertexBuffer("offset",0,2)}else y=this._vertexBuffer.createVertexBuffer("offset",b,2,this._vertexBufferSize,this._useInstancing),b+=2;this._vertexBuffers.offset=y,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const U=[],M=[];let b=0;for(let a=0;a<this._capacity;a++)U.push(b),U.push(b+1),U.push(b+2),U.push(b),U.push(b+2),U.push(b+3),M.push(b,b+1,b+1,b+2,b+2,b+3,b+3,b,b,b+3),b+=4;this._indexBuffer=this._engine.createIndexBuffer(U),this._linesIndexBuffer=this._engine.createIndexBuffer(M)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(U)setTimeout((()=>{this.start(0)}),U);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var M;-1!==(null===(M=this.j)||void 0===M?void 0:M.getClassName().indexOf("Mesh"))&&this.j.ik(!0);const U=this.noiseTexture;if(U&&U.onGeneratedObservable)U.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let M=0;M<this.preWarmCycles;M++)this.animate(!0),U.render()}))}));else for(let M=0;M<this.preWarmCycles;M++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(U))}_postStop(U){}reset(){this._stockParticles.length=0,this.Xl.length=0}_appendParticleVertex(U,M,b,A){let H=U*this._vertexBufferSize;if(this._vertexData[H++]=M.position.x+this.Le.x,this._vertexData[H++]=M.position.y+this.Le.y,this._vertexData[H++]=M.position.z+this.Le.z,this._vertexData[H++]=M.color.r,this._vertexData[H++]=M.color.g,this._vertexData[H++]=M.color.b,this._vertexData[H++]=M.color.a,this._vertexData[H++]=M.angle,this._vertexData[H++]=M.scale.x*M.size,this._vertexData[H++]=M.scale.y*M.size,this._isAnimationSheetEnabled&&(this._vertexData[H++]=M.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[H++]=M.direction.x,this._vertexData[H++]=M.direction.y,this._vertexData[H++]=M.direction.z);else if(M._initialDirection){let U=M._initialDirection;this.isLocal&&(a.l.TransformNormalToRef(U,this._emitterWorldMatrix,a.g.lk[0]),U=a.g.lk[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[H++]=U.x,this._vertexData[H++]=U.y,this._vertexData[H++]=U.z}else{let U=M.direction;this.isLocal&&(a.l.TransformNormalToRef(U,this._emitterWorldMatrix,a.g.lk[0]),U=a.g.lk[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[H++]=U.x,this._vertexData[H++]=U.y,this._vertexData[H++]=U.z}this._useRampGradients&&M.remapData&&(this._vertexData[H++]=M.remapData.x,this._vertexData[H++]=M.remapData.y,this._vertexData[H++]=M.remapData.z,this._vertexData[H++]=M.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===A?A=this._epsilon:1===A&&(A=1-this._epsilon)),this._vertexData[H++]=b,this._vertexData[H++]=A)}_prepareParticle(U){}_createNewOnes(U){let M;for(let b=0;b<U&&this.Xl.length!==this._capacity;b++){M=this._createParticle(),this.Xl.push(M);let U=this._createQueueStart;for(;U;)U.process(M,this),U=U.nextItem;M._inheritParticleInfoToSubEmitters()}}_update(U){if(this._alive=this.Xl.length>0,this.j.position){const U=this.j;this._emitterWorldMatrix=U.getWorldMatrix()}else{const U=this.j;this._emitterWorldMatrix=a.b.Translation(U.x,U.y,U.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Xl),this._createNewOnes(U)}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=[o.e.PositionKind,o.e.ColorKind,"angle","offset","size"];return U&&a.push("cellIndex"),M||a.push("direction"),b&&a.push("remapData"),a}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,MU.e)(a),U&&a.push("particlesInfos"),M&&a.push("logarithmicDepthConstant"),b&&(a.push("vFogInfos"),a.push("vFogColor")),a}fillDefines(U,M){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,MU.l)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&U.push("#define FOG")),this._isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),M===O.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&U.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case 2:U.push("#define BILLBOARDY");break;case 8:case 9:U.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&U.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:U.push("#define BILLBOARDMODE_ALL")}b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,M,b){M.push(...pU._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),U.push(...pU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,aU.f)(U,this._imageProcessingConfigurationDefines),(0,aU.c)(b,this._imageProcessingConfigurationDefines))}_getWrapper(U){const M=this._getCustomDrawWrapper(U);if(null!==M&&void 0!==M&&M.effect)return M;const b=[];this.fillDefines(b,U);const a=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let A=this._drawWrappers[a];A||(A=this._drawWrappers[a]=[]);let H=A[U];H||(H=new UU.d(this._engine),H.drawContext&&(H.drawContext.useInstancing=this._useInstancing),A[U]=H);const W=b.join("\n");if(H.defines!==W){const U=[],M=[],b=[];this.fillUniformsAttributesAndSamplerNames(M,U,b),H.setEffect(this._engine.createEffect("particles",U,M,b,W,void 0,void 0,void 0,void 0,this._shaderLanguage),W)}return H}animate(){var U;let M,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!b&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this.manualEmitCount>-1)M=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let U=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const M=this._actualFrame/this.targetStopDuration;G.GetCurrentGradient(M,this._emitRateGradients,((M,b,a)=>{M!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=b.getFactor(),this._currentEmitRateGradient=M),U=(0,e.n)(this._currentEmitRate1,this._currentEmitRate2,a)}))}M=U*this._scaledUpdateSpeed|0,this._newPartsExcess+=U*this._scaledUpdateSpeed-M}if(this._newPartsExcess>1&&(M+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?M=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(M),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!b){let U=0;for(let M=0;M<this.Xl.length;M++){const b=this.Xl[M];this._appendParticleVertices(U,b),U+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Xl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(U,M){this._appendParticleVertex(U++,M,0,0),this._useInstancing||(this._appendParticleVertex(U++,M,1,0),this._appendParticleVertex(U++,M,1,1),this._appendParticleVertex(U++,M,0,1))}rebuild(){var U;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(U=this._spriteBuffer)||void 0===U||U._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!pU.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(b.bind(b,12495)),Promise.resolve().then(b.bind(b,12443))])):await Promise.all([Promise.resolve().then(b.bind(b,12432)),Promise.resolve().then(b.bind(b,12423))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==O.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(O.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(O.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(U){const M=this._getWrapper(U),b=M.effect,A=this._engine;A.enableEffect(M);const H=this.defaultViewMatrix??this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",H),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();b.setFloat3("particlesInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,this.spriteCellWidth/U.width)}if(b.setVector2("translationPivot",this.translationPivot),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;b.setVector3("eyePosition",U.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),b.setTexture("rampSampler",this._rampGradientsTexture));const W=b.defines;var y,O,e,x,P,Z;(this._scene&&((0,MU.f)(b,this,this._scene),this.applyFog&&(0,bU.h)(this._scene,void 0,b)),W.indexOf("#define BILLBOARDMODE_ALL")>=0&&(H.invertToRef(a.g.Matrix[0]),b.setMatrix("invView",a.g.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?A.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,b):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,b)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?A.bindBuffers(this._vertexBuffers,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBuffer:this._indexBuffer,b):A.bindBuffers(this._vertexBuffers,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null,b);(this.useLogarithmicDepth&&this._scene&&(0,bU.o)(W,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),this._setEngineBasedOnBlendMode(U),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),this._useInstancing)?null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?A.drawElementsType(6,0,10,this.Xl.length):A.drawArraysType(7,0,4,this.Xl.length):null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?A.drawElementsType(1,0,10*this.Xl.length):A.drawElementsType(0,0,6*this.Xl.length);return this.Xl.length}render(){if(!this.isReady()||!this.Xl.length)return 0;const U=this._engine;U.setState&&(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0));let M=0;return M=this.blendMode===O.BLENDMODE_MULTIPLYADD?this._render(O.BLENDMODE_MULTIPLY)+this._render(O.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),M}_onDispose(){}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(M,b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const U=this._scene.Ik.indexOf(this);U>-1&&this._scene.Ik.splice(U,1),this._scene._activeParticleSystems.dispose()}this.rk.notifyObservers(this),this.rk.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}pU.ForceGLSL=!1;var gU,KU=b(509);!function(U){U[U.ATTACHED=0]="ATTACHED",U[U.END=1]="END"}(gU||(gU={}));class wU{constructor(U){if(this.particleSystem=U,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!U.j||!U.j.dispose){const M=(0,y.e)("BABYLON.AbstractMesh");U.j=new M("SubemitterSystemEmitter",U.va()),U._disposeEmitterOnDispose=!0}}clone(){let U=this.particleSystem.j;if(U){if(U instanceof a.l)U=U.clone();else if(-1!==U.getClassName().indexOf("Mesh")){U=new((0,y.e)("BABYLON.Mesh"))("",U.va()),U.isVisible=!1}}else U=new a.l;const M=new wU(this.particleSystem.clone(this.particleSystem.name,U));return M.particleSystem.name+="Clone",M.type=this.type,M.inheritDirection=this.inheritDirection,M.inheritedVelocityAmount=this.inheritedVelocityAmount,M.particleSystem._disposeEmitterOnDispose=!0,M.particleSystem.disposeOnStop=!0,M}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={};return M.type=this.type,M.inheritDirection=this.inheritDirection,M.inheritedVelocityAmount=this.inheritedVelocityAmount,M.particleSystem=this.particleSystem.serialize(U),M}static _ParseParticleSystem(U,M,b){throw(0,KU.c)("ParseParticle")}static Parse(U,M,b){const a=U.particleSystem,A=new wU(wU._ParseParticleSystem(a,M,b,!0));return A.type=U.type,A.inheritDirection=U.inheritDirection,A.inheritedVelocityAmount=U.inheritedVelocityAmount,A.particleSystem._isSubEmitter=!0,A}dispose(){this.particleSystem.dispose()}}var TU=b(562);function GU(U,M){const b=new F;return b.direction1=U,b.direction2=M,b}function lU(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function DU(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function uU(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.l(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0);return new L(U,M,b)}function cU(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function UM(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0),H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.l(0,1,0);return new B(U,M,b,A,H)}function MM(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Z(U,M)}function bM(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0),A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0);return new C(U,M,b,A)}const aM=a.l.Zero(),AM=a.l.Zero(),HM=a.l.Zero();class WM{constructor(){this.strength=0,this.position=a.l.Zero()}_processParticle(U,M){this.position.subtractToRef(U.position,aM);const b=aM.lengthSquared()+1;aM.normalize().scaleToRef(this.strength/b,AM),AM.scaleToRef(M._tempScaledUpdateSpeed,HM),U.direction.addInPlace(HM)}serialize(){return{position:this.position.tk(),strength:this.strength}}}class yM extends pU{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=U=>{if(!this._subEmitters||0===this._subEmitters.length)return;const M=Math.floor(Math.random()*this._subEmitters.length);for(const b of this._subEmitters[M])if(1===b.type){const M=b.clone();U._inheritParticleInfoToSubEmitter(M),M.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(M.particleSystem),M.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(U,M){const b=GU(U,M);return this.particleEmitterType=b,b}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U,this._flowMapUpdate&&(jU(this._flowMapUpdate),this._flowMapUpdate=null),U&&(this._flowMapUpdate={process:U=>{var M;const b=null===(M=this.va())||void 0===M?void 0:M.getTransformMatrix();this._flowMap._processParticle(U,this.flowMapStrength*this._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null},NU(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(U){this._attractors.push(U),1===this._attractors.length&&(this._attractorUpdate={process:U=>{for(const M of this._attractors)M._processParticle(U,this)},previousItem:null,nextItem:null},NU(this._attractorUpdate,this._directionProcessing))}removeAttractor(U){const M=this._attractors.indexOf(U);-1!==M&&this._attractors.splice(M,1),0===this._attractors.length&&jU(this._attractorUpdate)}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(U)}createHemisphericEmitter(){const U=lU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=DU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=uU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=cU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=UM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.l(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=MM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=bM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,M,b,a){const A=new P;return this.particleEmitterType=A,this.direction1=U,this.direction2=M,this.minEmitBox=b,this.maxEmitBox=a,A}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const U of this.subEmitters)U instanceof yM?this._subEmitters.push([new wU(U)]):U instanceof wU?this._subEmitters.push([U]):U instanceof Array&&this._subEmitters.push(U)}_stopSubEmitters(){if(this.activeSubSystems){for(const U of this.activeSubSystems)U.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const U=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==U&&this._rootParticleSystem.activeSubSystems.splice(U,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(U){U&&this._stopSubEmitters()}_prepareParticle(U){if(this._subEmitters&&this._subEmitters.length>0){const M=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];U._attachedSubEmitters=[];for(const b of M)if(0===b.type){const M=b.clone();U._attachedSubEmitters.push(M),M.particleSystem.start()}}}_onDispose(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),U&&this.particles)for(const b of this.particles)if(b._attachedSubEmitters)for(let U=b._attachedSubEmitters.length-1;U>=0;U-=1)b._attachedSubEmitters[U].dispose();if(M&&this.activeSubSystems)for(let b=this.activeSubSystems.length-1;b>=0;b-=1)this.activeSubSystems[b].dispose();if(this._subEmitters&&this._subEmitters.length){for(let U=0;U<this._subEmitters.length;U++)for(const M of this._subEmitters[U])M.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(U,M,b,A){let H;H=b instanceof TU.e?null:b;const O=(0,y.e)("BABYLON.Texture");if(O&&H&&(U.texture?M.particleTexture=O.Parse(U.texture,H,A):U.textureName&&(M.particleTexture=new O(A+U.textureName,H,!1,void 0===U.invertY||U.invertY),M.particleTexture.name=U.textureName)),U.emitterId||0===U.emitterId||void 0!==U.j?U.emitterId&&H?M.j=H.getLastMeshById(U.emitterId):M.j=a.l.jk(U.j):M.j=a.l.Zero(),M.isLocal=!!U.isLocal,void 0!==U.renderingGroupId&&(M.renderingGroupId=U.renderingGroupId),void 0!==U.isBillboardBased&&(M.isBillboardBased=U.isBillboardBased),void 0!==U.billboardMode&&(M.billboardMode=U.billboardMode),void 0!==U.useLogarithmicDepth&&(M.useLogarithmicDepth=U.useLogarithmicDepth),U.animations){for(let b=0;b<U.animations.length;b++){const a=U.animations[b],A=(0,y.e)("BABYLON.Animation");A&&M.animations.push(A.Parse(a))}M.beginAnimationOnStart=U.beginAnimationOnStart,M.beginAnimationFrom=U.beginAnimationFrom,M.beginAnimationTo=U.beginAnimationTo,M.beginAnimationLoop=U.beginAnimationLoop}if(U.autoAnimate&&H&&H.beginAnimation(M,U.autoAnimateFrom,U.autoAnimateTo,U.autoAnimateLoop,U.autoAnimateSpeed||1),M.startDelay=0|U.startDelay,M.minAngularSpeed=U.minAngularSpeed,M.maxAngularSpeed=U.maxAngularSpeed,M.minSize=U.minSize,M.maxSize=U.maxSize,U.minScaleX&&(M.minScaleX=U.minScaleX,M.maxScaleX=U.maxScaleX,M.minScaleY=U.minScaleY,M.maxScaleY=U.maxScaleY),void 0!==U.preWarmCycles&&(M.preWarmCycles=U.preWarmCycles,M.preWarmStepOffset=U.preWarmStepOffset),void 0!==U.minInitialRotation&&(M.minInitialRotation=U.minInitialRotation,M.maxInitialRotation=U.maxInitialRotation),M.minLifeTime=U.minLifeTime,M.maxLifeTime=U.maxLifeTime,M.minEmitPower=U.minEmitPower,M.maxEmitPower=U.maxEmitPower,M.emitRate=U.emitRate,M.gravity=a.l.jk(U.gravity),U.noiseStrength&&(M.noiseStrength=a.l.jk(U.noiseStrength)),M.color1=W.e.jk(U.color1),M.color2=W.e.jk(U.color2),M.colorDead=W.e.jk(U.colorDead),M.updateSpeed=U.updateSpeed,M.targetStopDuration=U.targetStopDuration,M.blendMode=U.blendMode,U.colorGradients)for(const a of U.colorGradients)M.addColorGradient(a.gradient,W.e.jk(a.color1),a.color2?W.e.jk(a.color2):void 0);if(U.rampGradients){for(const b of U.rampGradients)M.addRampGradient(b.gradient,W.c.jk(b.color));M.useRampGradients=U.useRampGradients}if(U.colorRemapGradients)for(const a of U.colorRemapGradients)M.addColorRemapGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.alphaRemapGradients)for(const a of U.alphaRemapGradients)M.addAlphaRemapGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.sizeGradients)for(const a of U.sizeGradients)M.addSizeGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.angularSpeedGradients)for(const a of U.angularSpeedGradients)M.addAngularSpeedGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.velocityGradients)for(const a of U.velocityGradients)M.addVelocityGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.dragGradients)for(const a of U.dragGradients)M.addDragGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.emitRateGradients)for(const a of U.emitRateGradients)M.addEmitRateGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.startSizeGradients)for(const a of U.startSizeGradients)M.addStartSizeGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.lifeTimeGradients)for(const a of U.lifeTimeGradients)M.addLifeTimeGradient(a.gradient,void 0!==a.factor1?a.factor1:a.factor,a.factor2);if(U.limitVelocityGradients){for(const b of U.limitVelocityGradients)M.addLimitVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);M.limitVelocityDamping=U.limitVelocityDamping}if(U.noiseTexture&&H){const b=(0,y.e)("BABYLON.ProceduralTexture");M.noiseTexture=b.Parse(U.noiseTexture,H,A)}let e;if(U.particleEmitterType){switch(U.particleEmitterType.type){case"SphereParticleEmitter":e=new f;break;case"SphereDirectedParticleEmitter":e=new L;break;case"ConeEmitter":case"ConeParticleEmitter":e=new Z;break;case"ConeDirectedParticleEmitter":e=new C;break;case"CylinderParticleEmitter":e=new r;break;case"CylinderDirectedParticleEmitter":e=new B;break;case"HemisphericParticleEmitter":e=new J;break;case"PointParticleEmitter":e=new F;break;case"MeshParticleEmitter":e=new S;break;case"CustomParticleEmitter":e=new z;break;default:e=new P}e.parse(U.particleEmitterType,H)}else e=new P,e.parse(U,H);M.particleEmitterType=e,M.startSpriteCellID=U.startSpriteCellID,M.endSpriteCellID=U.endSpriteCellID,M.spriteCellLoop=U.spriteCellLoop??!0,M.spriteCellWidth=U.spriteCellWidth,M.spriteCellHeight=U.spriteCellHeight,M.spriteCellChangeSpeed=U.spriteCellChangeSpeed,M.spriteRandomStartCell=U.spriteRandomStartCell,M.disposeOnStop=U.disposeOnStop??!1,M.manualEmitCount=U.manualEmitCount??-1}static Parse(U,M,b){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],H=arguments.length>4?arguments[4]:void 0;const y=U.name;let O,e,x=null,P=null;if(M instanceof TU.e?O=M:(e=M,O=e.getEngine()),U.customShader&&O.createEffectForParticles){P=U.customShader;const M=P.shaderOptions.defines.length>0?P.shaderOptions.defines.join("\n"):"";x=O.createEffectForParticles(P.shaderPath.fragmentElement,P.shaderOptions.uniforms,P.shaderOptions.samplers,M)}const Z=new yM(y,H||U.Ub,M,x,U.isAnimationSheetEnabled);if(Z.customShader=P,Z._rootUrl=b,U.id&&(Z.id=U.id),U.subEmitters){Z.subEmitters=[];for(const a of U.subEmitters){const U=[];for(const A of a)U.push(wU.Parse(A,M,b));Z.subEmitters.push(U)}}if(U.attractors)for(const W of U.attractors){const U=new WM;U.position=a.l.jk(W.position),U.strength=W.strength,Z.addAttractor(U)}return yM._Parse(U,Z,M,b),U.textureMask&&(Z.textureMask=W.e.jk(U.textureMask)),U.Le&&(Z.Le=a.l.jk(U.Le)),U.preventAutoStart&&(Z.preventAutoStart=U.preventAutoStart),A||Z.preventAutoStart||Z.start(),Z}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={};if(yM._Serialize(M,this,U),M.textureMask=this.textureMask.tk(),M.customShader=this.customShader,M.preventAutoStart=this.preventAutoStart,M.Le=this.Le.tk(),this.subEmitters){M.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const b of this._subEmitters){const a=[];for(const M of b)a.push(M.serialize(U));M.subEmitters.push(a)}}if(this._attractors&&this._attractors.length){M.attractors=[];for(const U of this._attractors)M.attractors.push(U.serialize())}return M}static _Serialize(U,M,b){if(U.name=M.name,U.id=M.id,U.Ub=M.getCapacity(),U.disposeOnStop=M.disposeOnStop,U.manualEmitCount=M.manualEmitCount,M.j.position){const b=M.j;U.emitterId=b.id}else{const b=M.j;U.j=b.tk()}M.particleEmitterType&&(U.particleEmitterType=M.particleEmitterType.serialize()),M.particleTexture&&(b?U.texture=M.particleTexture.serialize():(U.textureName=M.particleTexture.name,U.invertY=!!M.particleTexture._invertY)),U.isLocal=M.isLocal,X.d.AppendSerializedAnimations(M,U),U.beginAnimationOnStart=M.beginAnimationOnStart,U.beginAnimationFrom=M.beginAnimationFrom,U.beginAnimationTo=M.beginAnimationTo,U.beginAnimationLoop=M.beginAnimationLoop,U.startDelay=M.startDelay,U.renderingGroupId=M.renderingGroupId,U.isBillboardBased=M.isBillboardBased,U.billboardMode=M.billboardMode,U.minAngularSpeed=M.minAngularSpeed,U.maxAngularSpeed=M.maxAngularSpeed,U.minSize=M.minSize,U.maxSize=M.maxSize,U.minScaleX=M.minScaleX,U.maxScaleX=M.maxScaleX,U.minScaleY=M.minScaleY,U.maxScaleY=M.maxScaleY,U.minEmitPower=M.minEmitPower,U.maxEmitPower=M.maxEmitPower,U.minLifeTime=M.minLifeTime,U.maxLifeTime=M.maxLifeTime,U.emitRate=M.emitRate,U.gravity=M.gravity.tk(),U.noiseStrength=M.noiseStrength.tk(),U.color1=M.color1.tk(),U.color2=M.color2.tk(),U.colorDead=M.colorDead.tk(),U.updateSpeed=M.updateSpeed,U.targetStopDuration=M.targetStopDuration,U.blendMode=M.blendMode,U.preWarmCycles=M.preWarmCycles,U.preWarmStepOffset=M.preWarmStepOffset,U.minInitialRotation=M.minInitialRotation,U.maxInitialRotation=M.maxInitialRotation,U.startSpriteCellID=M.startSpriteCellID,U.spriteCellLoop=M.spriteCellLoop,U.endSpriteCellID=M.endSpriteCellID,U.spriteCellChangeSpeed=M.spriteCellChangeSpeed,U.spriteCellWidth=M.spriteCellWidth,U.spriteCellHeight=M.spriteCellHeight,U.spriteRandomStartCell=M.spriteRandomStartCell,U.isAnimationSheetEnabled=M.isAnimationSheetEnabled,U.useLogarithmicDepth=M.useLogarithmicDepth;const a=M.getColorGradients();if(a){U.colorGradients=[];for(const M of a){const b={gradient:M.gradient,color1:M.color1.tk()};M.color2?b.color2=M.color2.tk():b.color2=M.color1.tk(),U.colorGradients.push(b)}}const A=M.getRampGradients();if(A){U.rampGradients=[];for(const M of A){const b={gradient:M.gradient,color:M.color.tk()};U.rampGradients.push(b)}U.useRampGradients=M.useRampGradients}const H=M.getColorRemapGradients();if(H){U.colorRemapGradients=[];for(const M of H){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.colorRemapGradients.push(b)}}const W=M.getAlphaRemapGradients();if(W){U.alphaRemapGradients=[];for(const M of W){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.alphaRemapGradients.push(b)}}const y=M.getSizeGradients();if(y){U.sizeGradients=[];for(const M of y){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.sizeGradients.push(b)}}const O=M.getAngularSpeedGradients();if(O){U.angularSpeedGradients=[];for(const M of O){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.angularSpeedGradients.push(b)}}const e=M.getVelocityGradients();if(e){U.velocityGradients=[];for(const M of e){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.velocityGradients.push(b)}}const x=M.getDragGradients();if(x){U.dragGradients=[];for(const M of x){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.dragGradients.push(b)}}const P=M.getEmitRateGradients();if(P){U.emitRateGradients=[];for(const M of P){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.emitRateGradients.push(b)}}const Z=M.getStartSizeGradients();if(Z){U.startSizeGradients=[];for(const M of Z){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.startSizeGradients.push(b)}}const C=M.getLifeTimeGradients();if(C){U.lifeTimeGradients=[];for(const M of C){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.lifeTimeGradients.push(b)}}const r=M.getLimitVelocityGradients();if(r){U.limitVelocityGradients=[];for(const M of r){const b={gradient:M.gradient,factor1:M.factor1};void 0!==M.factor2?b.factor2=M.factor2:b.factor2=M.factor1,U.limitVelocityGradients.push(b)}U.limitVelocityDamping=M.limitVelocityDamping}M.noiseTexture&&(U.noiseTexture=M.noiseTexture.serialize())}clone(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={...this._customWrappers};let A=null;const H=this._engine;if(H.createEffectForParticles&&null!=this.customShader){A=this.customShader;const U=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",M=H.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,U);a[0]?a[0].effect=M:this.setCustomEffect(M,0)}const W=this.serialize(b),y=yM.Parse(W,this._scene||this._engine,this._rootUrl);return y.name=U,y.customShader=A,y._customWrappers=a,void 0===M&&(M=this.j),this.noiseTexture&&(y.noiseTexture=this.noiseTexture.clone()),y.j=M,this.preventAutoStart||y.start(),y}}yM.BILLBOARDMODE_Y=2,yM.BILLBOARDMODE_ALL=7,yM.BILLBOARDMODE_STRETCHED=8,yM.BILLBOARDMODE_STRETCHED_LOCAL=9,wU._ParseParticleSystem=yM.Parse;var OM=b(2499),eM=b(2492),xM=b(2405);xM.e.prototype.createTransformFeedback=function(){const U=this._gl.createTransformFeedback();if(!U)throw new Error("Unable to create Transform Feedback");return U},xM.e.prototype.deleteTransformFeedback=function(U){this._gl.deleteTransformFeedback(U)},xM.e.prototype.bindTransformFeedback=function(U){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,U)},xM.e.prototype.beginTransformFeedback=function(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(U?this._gl.POINTS:this._gl.TRIANGLES)},xM.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},xM.e.prototype.setTranformFeedbackVaryings=function(U,M){this._gl.transformFeedbackVaryings(U,M,this._gl.INTERLEAVED_ATTRIBS)},xM.e.prototype.bindTransformFeedbackBuffer=function(U){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U?U.underlyingResource:null)},xM.e.prototype.readTransformFeedbackBuffer=function(U){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U)};const PM="clipPlaneFragmentDeclaration2",ZM="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";i.c.IncludesShadersStore[PM]||(i.c.IncludesShadersStore[PM]=ZM);b(12334),b(12338),b(12346),b(12351),b(12358),b(12360),b(12369),b(12372);const CM="gpuRenderParticlesPixelShader",rM="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";i.c.ShadersStore[CM]||(i.c.ShadersStore[CM]=rM);const BM="clipPlaneVertexDeclaration2",JM="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";i.c.IncludesShadersStore[BM]||(i.c.IncludesShadersStore[BM]=JM);b(12381),b(12383),b(12391),b(12394);const FM="gpuRenderParticlesVertexShader",fM="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";i.c.ShadersStore[FM]||(i.c.ShadersStore[FM]=fM);class LM extends O{static get IsSupported(){if(!u.d.LastCreatedEngine)return!1;const U=u.d.LastCreatedEngine.getCaps();return U.supportTransformFeedbacks||U.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(U){this._maxActiveParticleCount=Math.min(U,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(U){this.maxActiveParticleCount=U}createPointEmitter(U,M){const b=GU(U,M);return this.particleEmitterType=b,b}createHemisphericEmitter(){const U=lU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=DU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=uU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=cU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=UM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new a.l(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=MM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=bM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.l(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,M,b,a){const A=new P;return this.particleEmitterType=A,this.direction1=U,this.direction2=M,this.minEmitBox=b,this.maxEmitBox=a,A}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==yM.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(yM.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(yM.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";U?setTimeout((()=>{this.start(0)}),U):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var U;let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(U=this._customWrappers[M])||void 0===U?void 0:U.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[U]??this._customWrappers[0]}setCustomEffect(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[M]=new UU.d(this._engine),this._customWrappers[M].effect=U}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(U,M,b){return super._removeGradientAndTexture(U,M,b),this._releaseBuffers(),this}addColorGradient(U,M){this._colorGradients||(this._colorGradients=[]);const b=new K(U,M);return this._colorGradients.push(b),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(U&&this._colorGradients.sort(((U,M)=>U.gradient<M.gradient?-1:U.gradient>M.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(U){return this._removeGradientAndTexture(U,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const M in this._drawWrappers){var U;null===(U=this._drawWrappers[M].drawContext)||void 0===U||U.reset()}}_addFactorGradient(U,M,b){const a=new T(M,b);U.push(a),this._releaseBuffers()}addSizeGradient(U,M){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,U,M),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(U){return this._removeGradientAndTexture(U,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(U,M){if(!U)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&U.sort(((U,M)=>U.gradient<M.gradient?-1:U.gradient>M.gradient?1:0));const b=this;b[M]&&(b[M].dispose(),b[M]=null)}addAngularSpeedGradient(U,M){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,U,M),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(U){return this._removeGradientAndTexture(U,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(U,M){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,U,M),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(U){return this._removeGradientAndTexture(U,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(U,M){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,U,M),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(U){return this._removeGradientAndTexture(U,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(U,M){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,U,M),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(U){return this._removeGradientAndTexture(U,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(U){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(U,M,b){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(U),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.rk=new l.e,this.onStoppedObservable=new l.e,this.onStartedObservable=new l.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=a.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||u.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ik.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,y.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,y.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,y.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,y.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new UU.d(this._engine)},this._customWrappers[0].effect=A,this._drawWrappers={0:new UU.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(M=M??{}).randomTextureSize||delete M.randomTextureSize;const W={Ub:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...M},O=M;isFinite(O)&&(W.Ub=O),this._capacity=W.Ub,this._maxActiveParticleCount=W.Ub,this._currentActiveCount=0,this._isAnimationSheetEnabled=H,this.particleEmitterType=new P;const e=Math.min(this._engine.getCaps().maxTextureSize,W.randomTextureSize);let x=[];for(let a=0;a<e;++a)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture=new D.d(new Float32Array(x),e,1,5,b,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,x=[];for(let a=0;a<e;++a)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture2=new D.d(new Float32Array(x),e,1,5,b,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=e}_reset(){this._releaseBuffers()}_createVertexBuffers(U,M,b){const a={};a.position=M.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let A=3;a.age=M.createVertexBuffer("age",A,1,this._attributesStrideSize,!0),A+=1,a.size=M.createVertexBuffer("size",A,3,this._attributesStrideSize,!0),A+=3,a.life=M.createVertexBuffer("life",A,1,this._attributesStrideSize,!0),A+=1,A+=4,this.billboardMode===yM.BILLBOARDMODE_STRETCHED&&(a.direction=M.createVertexBuffer("direction",A,3,this._attributesStrideSize,!0)),A+=3,this._platform.alignDataInBuffer&&(A+=1),this.particleEmitterType instanceof z&&(A+=3,this._platform.alignDataInBuffer&&(A+=1)),this._colorGradientsTexture||(a.color=M.createVertexBuffer("color",A,4,this._attributesStrideSize,!0),A+=4),this._isBillboardBased||(a.initialDirection=M.createVertexBuffer("initialDirection",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),this.noiseTexture&&(a.noiseCoordinates1=M.createVertexBuffer("noiseCoordinates1",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1),a.noiseCoordinates2=M.createVertexBuffer("noiseCoordinates2",A,3,this._attributesStrideSize,!0),A+=3,this._platform.alignDataInBuffer&&(A+=1)),a.angle=M.createVertexBuffer("angle",A,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?A++:A+=2,this._isAnimationSheetEnabled&&(a.cellIndex=M.createVertexBuffer("cellIndex",A,1,this._attributesStrideSize,!0),A+=1,this.spriteRandomStartCell&&(a.cellStartOffset=M.createVertexBuffer("cellStartOffset",A,1,this._attributesStrideSize,!0),A+=1)),a.offset=b.createVertexBuffer("offset",0,2),a.uv=b.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(a),this._platform.createVertexBuffers(U,a),this.resetDrawCache()}_initialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!U)return;const M=this._engine,b=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof z&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const A=this.particleEmitterType instanceof z,H=a.g.lk[0];let W=0;for(let a=0;a<this._capacity;a++)if(b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),A?(this.particleEmitterType.particleDestinationGenerator(a,null,H),b.push(H.x),b.push(H.y),b.push(H.z)):(b.push(0),b.push(0),b.push(0)),this._platform.alignDataInBuffer&&b.push(0),W+=16,A&&(this.particleEmitterType.particlePositionGenerator(a,null,H),b.push(H.x),b.push(H.y),b.push(H.z),this._platform.alignDataInBuffer&&b.push(0),W+=4),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),b.push(0),W+=4),this.isBillboardBased||(b.push(0),b.push(0),b.push(0),this._platform.alignDataInBuffer&&b.push(0),W+=4),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),W+=8),b.push(0),W+=1,this._angularSpeedGradientsTexture||(b.push(0),W+=1),this._isAnimationSheetEnabled&&(b.push(0),W+=1,this.spriteRandomStartCell&&(b.push(0),W+=1)),this._platform.alignDataInBuffer){let U=3-(W+3&3);for(W+=U;U-- >0;)b.push(0)}const y=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),O=this._platform.createParticleBuffer(b),e=this._platform.createParticleBuffer(b);this._buffer0=new o.c(M,O,!1,this._attributesStrideSize),this._buffer1=new o.c(M,e,!1,this._attributesStrideSize),this._spriteBuffer=new o.c(M,y,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let U=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(U+="\n#define BILLBOARD"),this._colorGradientsTexture&&(U+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(U+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(U+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(U+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(U+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(U+="\n#define DRAGGRADIENTS"),this._flowMap&&(U+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(U+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(U+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(U+="\n#define NOISE"),this.isLocal&&(U+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===U||(this._cachedUpdateDefines=U,this._updateBuffer=this._platform.createUpdateBuffer(U)),this._platform.isUpdateBufferReady()}_getWrapper(U){const M=this._getCustomDrawWrapper(U);if(null!==M&&void 0!==M&&M.effect)return M;const b=[];this.fillDefines(b,U);let a=this._drawWrappers[U];a||(a=new UU.d(this._engine),a.drawContext&&(a.drawContext.useInstancing=!0),this._drawWrappers[U]=a);const A=b.join("\n");if(a.defines!==A){const U=[],M=[],b=[];this.fillUniformsAttributesAndSamplerNames(M,U,b),a.setEffect(this._engine.createEffect("gpuRenderParticles",U,M,b,A),A)}return a}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=[o.e.PositionKind,"age","life","size","angle"];return U||A.push(o.e.ColorKind),M&&A.push("cellIndex"),b||A.push("initialDirection"),a&&A.push("direction"),A.push("offset",o.e.UVKind),A}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=["emitterWM","Le","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,MU.e)(a),U&&a.push("sheetInfos"),M&&a.push("logarithmicDepthConstant"),b&&(a.push("vFogInfos"),a.push("vFogColor")),a}fillDefines(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,MU.l)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==eM.b.FOGMODE_NONE&&U.push("#define FOG")),M===yM.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this.isLocal&&U.push("#define LOCAL"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case yM.BILLBOARDMODE_Y:U.push("#define BILLBOARDY");break;case yM.BILLBOARDMODE_STRETCHED:U.push("#define BILLBOARDSTRETCHED");break;case yM.BILLBOARDMODE_ALL:U.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&U.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,M,b){M.push(...LM._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===yM.BILLBOARDMODE_STRETCHED)),U.push(...LM._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(OM.c.PrepareUniforms(U,this._imageProcessingConfigurationDefines),OM.c.PrepareSamplers(b,this._imageProcessingConfigurationDefines))}animate(){var U;let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(M?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(U,M){const b=this[M];if(!U||!U.length||b)return;const a=new Float32Array(this._rawTextureWidth);for(let A=0;A<this._rawTextureWidth;A++){const M=A/this._rawTextureWidth;G.GetCurrentGradient(M,U,((U,M,b)=>{a[A]=(0,e.n)(U.factor1,M.factor1,b)}))}this[M]=D.d.CreateRTexture(a,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[M].name=M.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const U=new Uint8Array(4*this._rawTextureWidth),M=W.g.Dk[0];for(let b=0;b<this._rawTextureWidth;b++){const a=b/this._rawTextureWidth;G.GetCurrentGradient(a,this._colorGradients,((a,A,H)=>{W.e.LerpToRef(a.color1,A.color1,H,M),U[4*b]=255*M.r,U[4*b+1]=255*M.g,U[4*b+2]=255*M.b,U[4*b+3]=255*M.a}))}this._colorGradientsTexture=D.d.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(U,M){var b,A,H,W;const y=this._getWrapper(U),O=y.effect;this._engine.enableEffect(y);const e=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||a.b.IdentityReadOnly;if(O.setMatrix("view",e),O.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),O.setTexture("diffuseSampler",this.particleTexture),O.setVector2("translationPivot",this.translationPivot),O.setVector3("Le",this.Le),this.isLocal&&O.setMatrix("emitterWM",M),this._colorGradientsTexture?O.setTexture("colorGradientSampler",this._colorGradientsTexture):O.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();O.setFloat3("sheetInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,U.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;O.setVector3("eyePosition",U.globalPosition)}const x=O.defines;if(this._scene&&((0,MU.f)(O,this,this._scene),this.applyFog&&(0,bU.h)(this._scene,void 0,O)),x.indexOf("#define BILLBOARDMODE_ALL")>=0){const U=e.clone();U.invert(),O.setMatrix("invView",U)}return this.useLogarithmicDepth&&this._scene&&(0,bU.o)(x,O,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(O),this._setEngineBasedOnBlendMode(U),this._platform.bindDrawBuffers(this._targetIndex,O,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(O),null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(W=this._scene)&&void 0!==W&&W.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(U){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!U)if(this.j.position){U=this.j.getWorldMatrix()}else{const M=this.j;U=a.g.Matrix[0],a.b.TranslationToRef(M.x,M.y,M.z,U)}const M=this._engine,b=M.getDepthWrite();if(M.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const U=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",U.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",U),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const A=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=A,M.setDepthWrite(b)}render(){let U,M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!M&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const U=0|this._accumulatedCount;this._accumulatedCount-=U,this._currentActiveCount+=U}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){U=this.j.getWorldMatrix()}else{const M=this.j;U=a.g.Matrix[0],a.b.TranslationToRef(M.x,M.y,M.z,U)}const A=this._engine;this.updateInAnimate||this._update(U);let H=0;return M||b||(A.setState(!1),this.forceDepthWrite&&A.setDepthWrite(!0),H=this.blendMode===yM.BLENDMODE_MULTIPLYADD?this._render(yM.BLENDMODE_MULTIPLY,U)+this._render(yM.BLENDMODE_ADD,U):this._render(this.blendMode,U),this._engine.setAlphaMode(0)),H}rebuild(){const U=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(U,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,U()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const M in this._drawWrappers){this._drawWrappers[M].dispose()}if(this._drawWrappers={},this._scene){const U=this._scene.Ik.indexOf(this);U>-1&&this._scene.Ik.splice(U,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let M=0;M<this._renderVertexBuffers.length;++M){const U=this._renderVertexBuffers[M];for(const M in U)U[M].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.rk.notifyObservers(this),this.rk.clear()}clone(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a={...this._customWrappers};let A=null;const H=this._engine;if(H.createEffectForParticles&&null!=this.customShader){A=this.customShader;const U=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"";a[0]=H.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,U,void 0,void 0,void 0,this)}const W=this.serialize(b),y=LM.Parse(W,this._scene||this._engine,this._rootUrl);return y.name=U,y.customShader=A,y._customWrappers=a,void 0===M&&(M=this.j),this.noiseTexture&&(y.noiseTexture=this.noiseTexture.clone()),y.j=M,y}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={};return yM._Serialize(M,this,U),M.activeParticleCount=this.activeParticleCount,M.randomTextureSize=this._randomTextureSize,M.customShader=this.customShader,M}static Parse(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const H=U.name;let W,y;M instanceof TU.e?W=M:(y=M,W=y.getEngine());const O=new LM(H,{Ub:A||U.Ub,randomTextureSize:U.randomTextureSize},M,null,U.isAnimationSheetEnabled);if(O._rootUrl=b,U.customShader&&W.createEffectForParticles){const M=U.customShader,b=M.shaderOptions.defines.length>0?M.shaderOptions.defines.join("\n"):"",a=W.createEffectForParticles(M.shaderPath.fragmentElement,M.shaderOptions.uniforms,M.shaderOptions.samplers,b,void 0,void 0,void 0,O);O.setCustomEffect(a,0),O.customShader=M}return U.id&&(O.id=U.id),U.activeParticleCount&&(O.activeParticleCount=U.activeParticleCount),yM._Parse(U,O,M,b),U.preventAutoStart&&(O.preventAutoStart=U.preventAutoStart),a||O.preventAutoStart||O.start(),O}}var zM=b(479),oM=b(12398),SM=b(12205);class hM{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(U){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const M of this.systems)M.j=U;this._emitterNode=U}setEmitterAsSphere(U,M,b){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:U,renderingGroupId:M};const a=(0,oM.e)("emitterSphere",{diameter:U.diameter,segments:U.segments},b);a.renderingGroupId=M;const A=new SM.e("emitterSphereMaterial",b);A.emissiveColor=U.color,a.material=A;for(const H of this.systems)H.j=a;this._emitterNode=a}start(U){for(const M of this.systems)U&&(M.j=U),M.start()}dispose(){for(const U of this.systems)U.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const M={systems:[]};for(const b of this.systems)M.systems.push(b.serialize(U));return this._emitterNode&&(M.j=this._emitterCreationOptions),M}static Parse(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;const A=new hM,H=this.BaseAssetsUrl+"/textures/";M=M||u.d.LastCreatedScene;for(const W of U.systems)A.systems.push(b?LM.Parse(W,M,H,!0,a):yM.Parse(W,M,H,!0,a));if(U.j){const b=U.j.options;if("Sphere"===U.j.kind)A.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:W.c.jk(b.color)},U.j.renderingGroupId,M)}return A}}hM.BaseAssetsUrl="https://assets.babylonjs.com/particles";var iM=b(518);class YM{static CreateDefault(U){let M,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,a=arguments.length>2?arguments[2]:void 0;M=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new LM("default system",{Ub:b},a):new yM("default system",b,a),M.j=U;const A=zM.d.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return M.particleTexture=new Q.e(A,M.va()),M.createConeEmitter(.1,Math.PI/4),M.color1=new W.e(1,1,1,1),M.color2=new W.e(1,1,1,1),M.colorDead=new W.e(1,1,1,0),M.minSize=.1,M.maxSize=.1,M.minEmitPower=2,M.maxEmitPower=2,M.updateSpeed=1/60,M.emitRate=30,M}static CreateAsync(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;M||(M=u.d.LastCreatedScene);const A={};return M.addPendingData(A),new Promise(((H,W)=>{if(b&&!LM.IsSupported)return M.removePendingData(A),W("Particle system with GPU is not supported.");zM.d.LoadFile(`${YM.BaseAssetsUrl}/systems/${U}.json`,(U=>{M.removePendingData(A);const W=JSON.parse(U.toString());return H(hM.Parse(W,M,b,a))}),void 0,void 0,void 0,(()=>(M.removePendingData(A),W(`An error occurred with the creation of your particle system. Check if your type '${U}' exists.`))))}))}static ExportSet(U){const M=new hM;for(const b of U)M.systems.push(b);return M}static ParseFromFileAsync(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",H=arguments.length>5?arguments[5]:void 0;return new Promise(((W,y)=>{const O=new iM.c;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const M=JSON.parse(O.responseText);let y;y=a?LM.Parse(M,b,A,!1,H):yM.Parse(M,b,A,!1,H),U&&(y.name=U),W(y)}else y("Unable to load the particle system")})),O.open("GET",M),O.send()}))}static ParseFromSnippetAsync(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0;if("_BLANK"===U){const U=this.CreateDefault(null);return U.start(),Promise.resolve(U)}return new Promise(((H,W)=>{const y=new iM.c;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const W=JSON.parse(JSON.parse(y.responseText).jsonPayload),O=JSON.parse(W.particleSystem);let e;e=b?LM.Parse(O,M,a,!1,A):yM.Parse(O,M,a,!1,A),e.snippetId=U,H(e)}else W("Unable to load the snippet "+U)})),y.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),y.send()}))}}YM.BaseAssetsUrl=hM.BaseAssetsUrl,YM.SnippetUrl="https://snippet.babylonjs.com",YM.CreateFromSnippetAsync=YM.ParseFromSnippetAsync;var dM=b(470),sM=b(834),qM=b(12406);(0,qM.g)(sM.e.NAME_PARTICLESYSTEM,((U,M,b,a)=>{const A=(0,qM.i)(sM.e.NAME_PARTICLESYSTEM);if(A&&void 0!==U.Ik&&null!==U.Ik)for(let H=0,W=U.Ik.length;H<W;H++){const W=U.Ik[H];b.Ik.push(A(W,M,a))}})),(0,qM.c)(sM.e.NAME_PARTICLESYSTEM,((U,M,b)=>{if(U.activeParticleCount){return LM.Parse(U,M,b)}return yM.Parse(U,M,b)})),TU.e.prototype.createEffectForParticles=function(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",H=arguments.length>4?arguments[4]:void 0,W=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0,O=arguments.length>7?arguments[7]:void 0,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9?arguments[9]:void 0,P=[],Z=[];const C=[];return O?O.fillUniformsAttributesAndSamplerNames(Z,P,C):(P=yM._GetAttributeNamesOrOptions(),Z=yM._GetEffectCreationOptions()),-1===A.indexOf(" BILLBOARD")&&(A+="\n#define BILLBOARD\n"),null!==O&&void 0!==O&&O.isAnimationSheetEnabled&&-1===A.indexOf(" ANIMATESHEET")&&(A+="\n#define ANIMATESHEET\n"),-1===a.indexOf("diffuseSampler")&&a.push("diffuseSampler"),this.createEffect({vertex:x??(null===O||void 0===O?void 0:O.vertexShaderName)??"particles",fragmentElement:U},P,Z.concat(M),C.concat(a),A,H,W,y,void 0,e,(async()=>{0===e?await Promise.resolve().then(b.bind(b,12432)):await Promise.resolve().then(b.bind(b,12495))}))},dM.c.prototype.getEmittedParticleSystems=function(){const U=[];for(let M=0;M<this.va().Ik.length;M++){const b=this.va().Ik[M];b.j===this&&U.push(b)}return U},dM.c.prototype.getHierarchyEmittedParticleSystems=function(){const U=[],M=this.getDescendants();M.push(this);for(let b=0;b<this.va().Ik.length;b++){const a=this.va().Ik[b],A=a.j;A.position&&-1!==M.indexOf(A)&&U.push(a)}return U};b(754),b(772),b(788);b(744),b(842),b(808),b(746),b(825);b(2331);var mM;b(12409),b(2374);!function(U){U[U.Color=2]="Color",U[U.UV=1]="UV",U[U.Random=0]="Random",U[U.Stated=3]="Stated"}(mM||(mM={}));var nM=b(2362);const EM=new a.l(0,0,0),XM=new a.l(0,0,0),QM=new a.l(0,0,0);class IM{constructor(U,M,b){this.width=U,this.height=M,this.data=b}processFlowable(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;if(!b)return;b instanceof a.b?a.l.TransformCoordinatesToRef(U.position,b,QM):(QM.x=b.x,QM.y=b.y,QM.z=b.z);const A=.5*QM.x+.5,H=1-(.5*QM.y+.5),W=Math.floor(A*this.width),y=Math.floor(H*this.height);if(W<0||W>=this.width||y<0||y>=this.height)return;const O=4*(y*this.width+W),e=this.data[O]/255*2-1,x=this.data[O+1]/255*2-1,P=this.data[O+2]/255*2-1,Z=this.data[O+3]/255;EM.set(e,x,P),EM.scaleToRef(M*Z,XM),U.direction.addInPlace(XM)}_processParticle(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;this.processFlowable(U,M,b)}static async FromUrlAsync(U){return await new Promise(((M,b)=>{const a=document.createElement("canvas"),A=a.getContext("2d");let H=null;const W=new Image;W.crossOrigin="anonymous",W.src=U,W.onerror=M=>{b(new Error(`Failed to load image: ${U} : ${M}`))},W.onload=()=>{a.width=W.width,a.height=W.height,A.drawImage(W,0,0),H=A.getImageData(0,0,a.width,a.height),M(new IM(a.width,a.height,H.data))}}))}static async ExtractFromTextureAsync(U){return await new Promise(((M,b)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{const b=await this.ExtractFromTextureAsync(U);M(b)}catch(a){b(a)}}));const a=U.getSize();nM.l.GetTextureDataAsync(U,a.width,a.height).then((U=>{M(new IM(a.width,a.height,new Uint8ClampedArray(U)))})).catch(b)}))}}var vM,tM,VM,kM,NM,RM,jM,pM,gM;!function(U){U[U.Int=1]="Int",U[U.Float=2]="Float",U[U.Vector2=4]="Vector2",U[U.lk=8]="lk",U[U.Matrix=16]="Matrix",U[U.Particle=32]="Particle",U[U.Texture=64]="Texture",U[U.Dk=128]="Dk",U[U.FloatGradient=256]="FloatGradient",U[U.Vector2Gradient=512]="Vector2Gradient",U[U.Vector3Gradient=1024]="Vector3Gradient",U[U.Color4Gradient=2048]="Color4Gradient",U[U.System=4096]="System",U[U.AutoDetect=8192]="AutoDetect",U[U.BasedOnInput=16384]="BasedOnInput",U[U.Undefined=32768]="Undefined",U[U.All=65535]="All"}(vM||(vM={})),function(U){U[U.Compatible=0]="Compatible",U[U.TypeIncompatible=1]="TypeIncompatible",U[U.HierarchyIssue=2]="HierarchyIssue"}(tM||(tM={})),function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(VM||(VM={}));class KM{get direction(){return this._direction}get type(){if(this._type===vM.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===vM.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(U){this._type=U}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((U=>U.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(U,M,b){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=vM.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new l.e,this.onDisconnectionObservable=new l.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=M,this.name=U,this._direction=b}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(U){var M;return this.isConnected?null!==(M=this._connectedPoint)&&void 0!==M&&M._storedFunction?this._connectedPoint._storedFunction(U):this._connectedPoint._storedValue:this.value}canConnectTo(U){return 0===this.checkCompatibilityState(U)}checkCompatibilityState(U){const M=this._ownerBlock,b=U.ownerBlock;if(this.type!==U.type&&U.innerType!==vM.AutoDetect)return U.acceptedConnectionPointTypes&&-1!==U.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(U.excludedConnectionPointTypes&&-1!==U.excludedConnectionPointTypes.indexOf(this.type))return 1;let a=b,A=M;return 0===this.direction&&(a=M,A=b),a.isAnAncestorOf(A)?2:0}connectTo(U){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(U))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${U.ownerBlock.name}".${U.name}`;return this._endpoints.push(U),U._connectedPoint=this,this.onConnectionObservable.notifyObservers(U),U.onConnectionObservable.notifyObservers(this),this}disconnectFrom(U){const M=this._endpoints.indexOf(U);return-1===M||(this._endpoints.splice(M,1),U._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(U),U.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(U){let M=1;for(;M<vM.All;)U&M||this.excludedConnectionPointTypes.push(M),M<<=1}serialize(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const M={};return M.name=this.name,M.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.tk?(M.valueType="BABYLON."+this.value.getClassName(),M.value=this.value.tk()):(M.valueType="number",M.value=this.value)),U&&this.connectedPoint&&(M.inputName=this.name,M.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,M.targetConnectionName=this.connectedPoint.name,M.isExposedOnFrame=!0,M.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(M.isExposedOnFrame=!0,M.exposedPortPosition=this.exposedPortPosition),M}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class wM{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(U){this._name=U}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(U){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new l.e,this.rk=new l.e,this.onInputChangedObservable=new l.e,this.visibleOnFrame=!1,this._name=U,this.uniqueId=I.b.UniqueId}_inputRename(U){return U}_outputRename(U){return U}isAnAncestorOf(U){for(const M of this._outputs)if(M.hasEndpoints)for(const b of M.endpoints){if(b.ownerBlock===U)return!0;if(b.ownerBlock.isAnAncestorOf(U))return!0}return!1}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const M of this._outputs)if(M.hasEndpoints)for(const b of M.endpoints)if(b.ownerBlock.isAnAncestorOfType(U))return!0;return!1}getInputByName(U){const M=this._inputs.filter((M=>M.name===U));return M.length?M[0]:null}_linkConnectionTypes(U,M){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[M]._acceptedConnectionPointType=this._inputs[U]:(this._inputs[U]._linkedConnectionSource=this._inputs[M],this._inputs[U]._isMainLinkSource=!0),this._inputs[M]._linkedConnectionSource=this._inputs[U]}registerInput(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5?arguments[5]:void 0;const W=new KM(U,this,0);return W.type=M,W.isOptional=b,W.defaultValue=a,W.value=a,W.valueMin=A,W.valueMax=H,this._inputs.push(W),this.onInputChangedObservable.notifyObservers(W),this}registerOutput(U,M,b){return(b=b??new KM(U,this,1)).type=M,this._outputs.push(b),this}_build(U){}_customBuildStep(U){}build(U){if(this._buildId===U.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((U=>U.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=U.buildId;for(const M of this._inputs){if(!M.connectedPoint){M.isOptional||U.notConnectedNonOptionalInputs.push(M);continue}const b=M.connectedPoint.ownerBlock;b&&b!==this&&!b.isSystem&&b.build(U)}return this._customBuildStep(U),U.verbose&&v.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(U),this.onBuildObservable.notifyObservers(this),!1}serialize(){const U={};U.customType="BABYLON."+this.getClassName(),U.id=this.uniqueId,U.name=this.name,U.visibleOnFrame=this.visibleOnFrame,U.inputs=[],U.outputs=[];for(const M of this.inputs)U.inputs.push(M.serialize());for(const M of this.outputs)U.outputs.push(M.serialize(!1));return U}_deserialize(U){this._name=U.name,this.comments=U.comments,this.visibleOnFrame=!!U.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(U)}_deserializePortDisplayNamesAndExposedOnFrame(U){const M=U.inputs,b=U.outputs;if(M)for(const a of M){const U=this.inputs.find((U=>U.name===a.name));if(!U)return;if(a.displayName&&(U.displayName=a.displayName),a.isExposedOnFrame&&(U.isExposedOnFrame=a.isExposedOnFrame,U.exposedPortPosition=a.exposedPortPosition),void 0!==a.value&&null!==a.value)if("number"===a.valueType)U.value=a.value;else{const M=(0,y.e)(a.valueType);M&&(U.value=M.jk(a.value))}}if(b)for(let a=0;a<b.length;a++){const U=b[a];U.displayName&&(this.outputs[a].displayName=U.displayName),U.isExposedOnFrame&&(this.outputs[a].isExposedOnFrame=U.isExposedOnFrame,this.outputs[a].exposedPortPosition=U.exposedPortPosition)}}clone(){const U=this.serialize(),M=(0,y.e)(U.customType);if(M){const b=new M;return b._deserialize(U),b}return null}dispose(){this.rk.notifyObservers(this),this.rk.clear();for(const U of this.inputs)U.dispose();for(const U of this.outputs)U.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function TM(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",a=arguments.length>3?arguments[3]:void 0;return(A,H)=>{let W=A._propStore;W||(W=[],A._propStore=W),W.push({propertyName:H,displayName:U,type:M,groupName:b,options:a??{},className:A.getClassName()})}}(0,n.c)([(0,E.J)("comment")],wM.prototype,"comments",void 0),function(U){U[U.Boolean=0]="Boolean",U[U.Float=1]="Float",U[U.Int=2]="Int",U[U.Vector2=3]="Vector2",U[U.List=4]="List",U[U.Dk=5]="Dk",U[U.SamplingMode=6]="SamplingMode",U[U.TextureFormat=7]="TextureFormat",U[U.TextureType=8]="TextureType"}(kM||(kM={})),function(U){U[U.None=0]="None",U[U.Position=1]="Position",U[U.Direction=2]="Direction",U[U.Age=3]="Age",U[U.Lifetime=4]="Lifetime",U[U.Color=5]="Color",U[U.ScaledDirection=6]="ScaledDirection",U[U.Scale=7]="Scale",U[U.AgeGradient=8]="AgeGradient",U[U.Angle=9]="Angle",U[U.SpriteCellIndex=16]="SpriteCellIndex",U[U.SpriteCellStart=17]="SpriteCellStart",U[U.SpriteCellEnd=18]="SpriteCellEnd"}(NM||(NM={})),function(U){U[U.None=0]="None",U[U.Time=1]="Time",U[U.Delta=2]="Delta",U[U.Emitter=3]="Emitter"}(RM||(RM={}));class GM{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let U="";for(const M of this.notConnectedNonOptionalInputs)U+=`input ${M.name} from block ${M.ownerBlock.name}[${M.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(U)throw"Build of Node Particle System Set failed:\n"+U}adapt(U,M){const b=U.getConnectedValue(this)||0;if(U.type===M)return b;switch(M){case vM.Vector2:return new a.i(b,b);case vM.lk:return new a.l(b,b,b);case vM.Dk:return new W.e(b,b,b,b)}return null}getContextualValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case NM.Position:return this.particleContext.position;case NM.Direction:return this.particleContext.direction;case NM.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case NM.Color:return this.particleContext.color;case NM.Age:return this.particleContext.age;case NM.Lifetime:return this.particleContext.lifeTime;case NM.Angle:return this.particleContext.angle;case NM.Scale:return this.particleContext.scale;case NM.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case NM.SpriteCellEnd:return this.systemContext.endSpriteCellID;case NM.SpriteCellIndex:return this.particleContext.cellIndex;case NM.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case RM.Time:return this.systemContext._actualFrame;case RM.Delta:return this.systemContext._scaledUpdateSpeed;case RM.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function lM(U,M,b){const a=new GM;a.$e=M;const A=U.createSystem(a);return A.canStart=()=>!0,A.j=b.clone(),A.disposeOnStop=!0,A.start(),A}class DM extends wM{constructor(U){super(U),this.blendMode=O.BLENDMODE_ONEONE,this.Ub=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",vM.Particle),this.registerInput("texture",vM.Texture),this.registerInput("onStart",vM.System,!0),this.registerInput("onEnd",vM.System,!0),this.registerOutput("system",vM.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(U){U.Ub=this.Ub,U.buildId=this._buildId++,this.build(U);const M=this.particle.getConnectedValue(U);return M.particleTexture=this.texture.getConnectedValue(U),M.emitRate=this.emitRate,M.blendMode=this.blendMode,M.name=this.name,M._nodeGenerated=!0,M._targetStopDuration=this.targetStopDuration,M.startDelay=this.startDelay,this.system._storedValue=this,M.canStart=()=>!this.doNoStart,M.onStartedObservable.add((b=>{const a=this.onStart.getConnectedValue(U);a&&b.onStartedObservable.addOnce((()=>{U.systemContext=M;const b=lM(a,U.$e,U.emitterPosition);this.rk.addOnce((()=>{b.dispose()}))}));const A=this.onEnd.getConnectedValue(U);A&&b.onStoppedObservable.addOnce((()=>{U.systemContext=M;const b=lM(A,U.$e,U.emitterPosition);this.rk.addOnce((()=>{b.dispose()}))}))})),this.rk.addOnce((()=>{M.dispose()})),M}serialize(){const U=super.serialize();return U.Ub=this.Ub,U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.doNoStart=this.doNoStart,U.targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,U}_deserialize(U){super._deserialize(U),this.Ub=U.Ub,this.emitRate=U.emitRate,this.doNoStart=!!U.doNoStart,void 0!==U.blendMode&&(this.blendMode=U.blendMode),void 0!==U.targetStopDuration&&(this.targetStopDuration=U.targetStopDuration),void 0!==U.startDelay&&(this.startDelay=U.startDelay)}}(0,n.c)([TM("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:O.BLENDMODE_ONEONE},{label:"Standard",value:O.BLENDMODE_STANDARD},{label:"Add",value:O.BLENDMODE_ADD},{label:"Multiply",value:O.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:O.BLENDMODE_MULTIPLYADD}]})],DM.prototype,"blendMode",void 0),(0,n.c)([TM("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],DM.prototype,"Ub",void 0),(0,n.c)([TM("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DM.prototype,"emitRate",void 0),(0,n.c)([TM("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DM.prototype,"targetStopDuration",void 0),(0,n.c)([TM("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],DM.prototype,"startDelay",void 0),(0,n.c)([TM("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],DM.prototype,"doNoStart",void 0),(0,y.i)("BABYLON.SystemBlock",DM);class uM extends wM{get type(){if(this._type===vM.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=vM.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=vM.Vector2,this._type;case"lk":return this._type=vM.lk,this._type;case"Dk":return this._type=vM.Dk,this._type;case"Matrix":return this._type=vM.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===NM.None&&this._systemSource!==RM.None}get systemSource(){return this._systemSource}set systemSource(U){if(this._systemSource=U,U!==RM.None){switch(this._contextualSource=NM.None,this._type=vM.Float,U){case RM.Time:case RM.Delta:this._type=vM.Float;break;case RM.Emitter:this._type=vM.lk}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==NM.None}get contextualValue(){return this._contextualSource}set contextualValue(U){if(this._contextualSource=U,U!==NM.None){switch(this._systemSource=RM.None,U){case NM.Scale:this._type=vM.Vector2;break;case NM.Position:case NM.Direction:case NM.ScaledDirection:this._type=vM.lk;break;case NM.Color:this._type=vM.Dk;break;case NM.Age:case NM.Lifetime:case NM.Angle:case NM.AgeGradient:this._type=vM.Float;break;case NM.SpriteCellEnd:case NM.SpriteCellStart:case NM.SpriteCellIndex:this._type=vM.Int}this.output&&(this.output.type=this._type)}}constructor(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vM.AutoDetect;super(U),this._type=vM.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new l.e,this._systemSource=RM.None,this._contextualSource=NM.None,this._type=M,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",M)}get value(){return this._storedValue}set value(U){this.type===vM.Float&&this.min!==this.max&&(U=Math.max(this.min,U),U=Math.min(this.max,U)),this._storedValue=U,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(U){this._valueCallback=U}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case vM.Int:case vM.Float:this.value=0;break;case vM.Vector2:this.value=a.i.Zero();break;case vM.lk:this.value=a.l.Zero();break;case vM.Dk:this.value=new W.e(1,1,1,1);break;case vM.Matrix:this.value=a.b.Identity()}}_build(U){super._build(U),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=U=>U.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=U=>U.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const U=super.serialize();return U.type=this.type,U.contextualValue=this.contextualValue,U.systemSource=this.systemSource,U.min=this.min,U.max=this.max,U.groupInInspector=this.groupInInspector,U.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.tk?(U.valueType="BABYLON."+this._storedValue.getClassName(),U.value=this._storedValue.tk()):(U.valueType="number",U.value=this._storedValue)),U}_deserialize(U){if(super._deserialize(U),this._type=U.type,this.contextualValue=U.contextualValue,this.systemSource=U.systemSource||RM.None,this.min=U.min||0,this.max=U.max||0,this.groupInInspector=U.groupInInspector||"",void 0!==U.displayInInspector&&(this.displayInInspector=U.displayInInspector),U.valueType)if("number"===U.valueType)this._storedValue=U.value;else{const M=(0,y.e)(U.valueType);M&&(this._storedValue=M.jk(U.value))}}}(0,y.i)("BABYLON.ParticleInputBlock",uM);class cM extends wM{get url(){return this._url}set url(U){this._url!==U&&(this._cachedData=null,this._url=U,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(U){this._textureDataUrl!==U&&(this._cachedData=null,this._textureDataUrl=U,this._url="",this._sourceTexture=null)}set sourceTexture(U){this._sourceTexture!==U&&(this._cachedData=null,this._sourceTexture=U,this._url="",this._textureDataUrl="")}constructor(U){super(U),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",vM.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const U=this.texture._storedValue;return await new Promise(((M,b)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),M(this._cachedData)}catch(U){b(U)}}));const a=U.getSize();nM.l.GetTextureDataAsync(U,a.width,a.height).then((b=>{this._cachedData={width:a.width,height:a.height,data:new Uint8ClampedArray(b)},U.dispose(),M(this._cachedData)})).catch(b)}))}_build(U){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new Q.e(this._textureDataUrl,U.$e):this.texture._storedValue=new Q.e(this._url,U.$e):this.texture._storedValue=null}serialize(){const U=super.serialize();return U.url=this.url,U.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(U.textureDataUrl=this.textureDataUrl),U}_deserialize(U){super._deserialize(U),this.url=U.url,this.serializedCachedData=!!U.serializedCachedData,U.textureDataUrl&&(this.textureDataUrl=U.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,y.i)("BABYLON.ParticleTextureSourceBlock",cM);class Ub extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("position",vM.lk),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(U){const M=this.particle.getConnectedValue(U);if(this.output._storedValue=M,!this.position.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=M,b.position.p(this.position.getConnectedValue(U))},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b}}(0,y.i)("BABYLON.UpdatePositionBlock",Ub),function(U){U[U.Add=0]="Add",U[U.Subtract=1]="Subtract",U[U.Multiply=2]="Multiply",U[U.Divide=3]="Divide",U[U.Max=4]="Max",U[U.Min=5]="Min"}(jM||(jM={}));class Mb extends wM{constructor(U){super(U),this.operation=jM.Add,this.registerInput("left",vM.AutoDetect),this.registerInput("right",vM.AutoDetect),this.registerOutput("output",vM.BasedOnInput),this.output._typeConnectionSource=this.left;const M=[vM.Matrix,vM.Particle,vM.Texture,vM.System,vM.FloatGradient,vM.Color4Gradient,vM.Vector2Gradient,vM.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...M),this.right.excludedConnectionPointTypes.push(...M),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(U){let M;const b=this.left,A=this.right;if(!b.isConnected||!A.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const H=b.type===vM.Float||b.type===vM.Int,y=A.type===vM.Float||A.type===vM.Int,O=H&&y;switch(this.operation){case jM.Add:M=O?U=>b.getConnectedValue(U)+A.getConnectedValue(U):H?U=>U.adapt(b,A.type).add(A.getConnectedValue(U)):U=>b.getConnectedValue(U).add(U.adapt(A,b.type));break;case jM.Subtract:M=O?U=>b.getConnectedValue(U)-A.getConnectedValue(U):H?U=>U.adapt(b,A.type).je(A.getConnectedValue(U)):U=>b.getConnectedValue(U).je(U.adapt(A,b.type));break;case jM.Multiply:M=O?U=>b.getConnectedValue(U)*A.getConnectedValue(U):H?U=>U.adapt(b,A.type).multiply(A.getConnectedValue(U)):U=>b.getConnectedValue(U).multiply(U.adapt(A,b.type));break;case jM.Divide:M=O?U=>b.getConnectedValue(U)/A.getConnectedValue(U):H?U=>U.adapt(b,A.type).divide(A.getConnectedValue(U)):U=>b.getConnectedValue(U).divide(U.adapt(A,b.type));break;case jM.Min:if(O)M=U=>Math.min(b.getConnectedValue(U),A.getConnectedValue(U));else{const[U,y]=H?[A,b]:[b,A];switch(U.type){case vM.Vector2:M=M=>a.i.Minimize(U.getConnectedValue(M),M.adapt(y,U.type));break;case vM.lk:M=M=>a.l.Minimize(U.getConnectedValue(M),M.adapt(y,U.type));break;case vM.Dk:M=M=>{const b=U.getConnectedValue(M),{r:a,g:A,b:H,a:O}=M.adapt(y,U.type);return new W.e(Math.min(b.r,a),Math.min(b.g,A),Math.min(b.b,H),Math.min(b.a,O))}}}break;case jM.Max:if(!O){const[U,y]=H?[A,b]:[b,A];switch(U.type){case vM.Vector2:M=M=>a.i.Maximize(U.getConnectedValue(M),M.adapt(y,U.type));break;case vM.lk:M=M=>a.l.Maximize(U.getConnectedValue(M),M.adapt(y,U.type));break;case vM.Dk:M=M=>{const b=U.getConnectedValue(M),{r:a,g:A,b:H,a:O}=M.adapt(y,U.type);return new W.e(Math.max(b.r,a),Math.min(b.g,A),Math.min(b.b,H),Math.min(b.a,O))}}break}M=U=>Math.max(b.getConnectedValue(U),A.getConnectedValue(U))}this.output._storedFunction=U=>b.type===vM.Int?0|M(U):M(U)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===vM.Int||this.left.type===vM.Float&&this.right.type!==vM.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[U,M]of[[this.left,this.right],[this.right,this.left]])U.acceptedConnectionPointTypes=[vM.Int,vM.Float],M.isConnected&&(U.acceptedConnectionPointTypes.push(M.type),M.type!==vM.Int&&M.type!==vM.Float||U.acceptedConnectionPointTypes.push(vM.Vector2,vM.lk,vM.Dk))}dispose(){super.dispose();for(const U of this._connectionObservers)U.remove();this._connectionObservers.length=0}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,n.c)([TM("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:jM.Add},{label:"Subtract",value:jM.Subtract},{label:"Multiply",value:jM.Multiply},{label:"Divide",value:jM.Divide},{label:"Max",value:jM.Max},{label:"Min",value:jM.Min}]})],Mb.prototype,"operation",void 0),(0,y.i)("BABYLON.ParticleMathBlock",Mb);class bb extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("direction1",vM.lk,!0,new a.l(0,1,0)),this.registerInput("direction2",vM.lk,!0,new a.l(0,1,0)),this.registerInput("minEmitBox",vM.lk,!0,new a.l(-.5,-.5,-.5)),this.registerInput("maxEmitBox",vM.lk,!0,new a.l(.5,.5,.5)),this.registerOutput("output",vM.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const M=this.particle.getConnectedValue(U);M._directionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.direction1.getConnectedValue(U),H=this.direction2.getConnectedValue(U),W=(0,e.u)(A.x,H.x),y=(0,e.u)(A.y,H.y),O=(0,e.u)(A.z,H.z);U.isEmitterTransformNode?a.l.TransformNormalFromFloatsToRef(W,y,O,U.emitterWorldMatrix,b.direction):b.direction.vd(W,y,O)},M._positionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.minEmitBox.getConnectedValue(U),H=this.maxEmitBox.getConnectedValue(U),W=(0,e.u)(A.x,H.x),y=(0,e.u)(A.y,H.y),O=(0,e.u)(A.z,H.z);U.isEmitterTransformNode?a.l.TransformCoordinatesFromFloatsToRef(W,y,O,U.emitterWorldMatrix,b.position):(b.position.vd(W,y,O),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=M}}(0,y.i)("BABYLON.BoxShapeBlock",bb);class ab extends wM{constructor(U){super(U),this.registerInput("emitPower",vM.Float,!0,1),this.registerInput("lifeTime",vM.Float,!0,1),this.registerInput("color",vM.Dk,!0,new W.e(1,1,1,1)),this.registerInput("scale",vM.Vector2,!0,new a.i(1,1)),this.registerInput("angle",vM.Float,!0,0),this.registerOutput("particle",vM.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(U){const M=new yM(this.name,U.Ub,U.$e,null,!1,void 0,!0);M.particleEmitterType=new F,M._lifeTimeCreation.process=(M,b)=>{U.particleContext=M,M.lifeTime=this.lifeTime.getConnectedValue(U),b._emitPower=this.emitPower.getConnectedValue(U)},M._colorCreation.process=M=>{U.particleContext=M,M.color.p(this.color.getConnectedValue(U))},M._sizeCreation.process=M=>{U.particleContext=M,M.size=1,M.scale.p(this.scale.getConnectedValue(U))},M._angleCreation.process=M=>{U.particleContext=M,M.angle=this.angle.getConnectedValue(U)},this.particle._storedValue=M}}(0,y.i)("BABYLON.CreateParticleBlock",ab);class Ab{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const U=[];for(const M of this.attachedBlocks)M.isInput&&U.push(M);return U}constructor(U){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new l.e,this.name=U}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(U)&&this.attachedBlocks.push(U);for(const b of U.inputs){const a=b.connectedPoint;if(a){const b=a.ownerBlock;b!==U&&this._initializeBlock(b,M)}}}async buildAsync(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((b=>{const a=new hM;for(const U of this._systemBlocks)this._initializeBlock(U);for(const A of this.systemBlocks){const b=new GM;b.buildId=this._buildId++,b.$e=U,b.verbose=M;const H=A.createSystem(b);b.emitErrors(),a.systems.push(H)}this.onBuildObservable.notifyObservers(this),b(a)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const U=new DM("Particle system"),M=new Ub("Update position");M.output.connectTo(U.particle);const b=new uM("Position");b.contextualValue=NM.Position;const a=new uM("Scaled direction");a.contextualValue=NM.ScaledDirection;const A=new Mb("Add");A.operation=jM.Add,b.output.connectTo(A.left),a.output.connectTo(A.right),A.output.connectTo(M.position);const H=new ab("Create particle"),W=new bb("Box shape");H.particle.connectTo(W.particle),W.output.connectTo(M.particle);const y=new cM("Texture");y.texture.connectTo(U.texture),y.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(U)}removeBlock(U){const M=this.attachedBlocks.indexOf(U);if(M>-1&&this.attachedBlocks.splice(M,1),U.isSystem){const M=this._systemBlocks.indexOf(U);M>-1&&this._systemBlocks.splice(M,1)}}parseSerializedObject(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M||this.clear();const b={};for(const a of U.$k){const U=(0,y.e)(a.customType);if(U){const M=new U;M._deserialize(a),b[a.id]=M,this.attachedBlocks.push(M),M.isSystem&&this._systemBlocks.push(M)}}for(const a of this.attachedBlocks)if(a.isTeleportOut){const U=a,M=U._tempEntryPointUniqueId;if(M){const a=b[M];a&&a.attachToEndpoint(U)}}for(let a=0;a<U.$k.length;a++){const A=U.$k[a],H=b[A.id];H&&(H.inputs.length&&A.inputs.some((U=>U.targetConnectionName))&&!M||this._restoreConnections(H,U,b))}if(U.locations||U.editorData&&U.editorData.locations){const a=U.locations||U.editorData.locations;for(const U of a)b[U.blockId]&&(U.blockId=b[U.blockId].uniqueId);M&&this.editorData&&this.editorData.locations&&a.concat(this.editorData.locations),U.locations?this.editorData={locations:a}:(this.editorData=U.editorData,this.editorData.locations=a);const A=[];for(const U in b)A[U]=b[U].uniqueId;this.editorData.map=A}this.comment=U.comment}_restoreConnections(U,M,b){for(const a of U.outputs)for(const A of M.$k){const H=b[A.id];if(H)for(const W of A.inputs)if(b[W.targetBlockId]!==U||W.targetConnectionName!==a.name);else{const U=H.getInputByName(W.inputName);if(!U||U.isConnected)continue;a.connectTo(U,!0),this._restoreConnections(H,M,b)}}}serialize(U){const M=U?{}:X.d.Serialize(this);M.editorData=JSON.parse(JSON.stringify(this.editorData));let b=[];U?b=U:M.customType="BABYLON.NodeParticleSystemSet",M.$k=[];for(const a of b)M.$k.push(a.serialize());if(!U)for(const a of this.attachedBlocks)-1===b.indexOf(a)&&M.$k.push(a.serialize());return M}dispose(){for(const U of this.attachedBlocks)U.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(U){const M=new Ab(U);return M.setToDefault(),M}static Parse(U){const M=X.d.Parse((()=>new Ab(U.name)),U,null);return M.parseSerializedObject(U),M}static ParseFromSnippetAsync(U,M){return"_BLANK"===U?Promise.resolve(Ab.CreateDefault("blank")):new Promise(((b,a)=>{const A=new iM.c;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const W=JSON.parse(JSON.parse(A.responseText).jsonPayload),y=JSON.parse(W.nodeParticle);M||(M=X.d.Parse((()=>new Ab(U)),y,null)),M.parseSerializedObject(y),M.snippetId=U;try{b(M)}catch(H){a(H)}}else a("Unable to load the snippet "+U)})),A.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),A.send()}))}}Ab.EditorURL=`${zM.d._DefaultCdnUrl}/v${TU.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Ab.SnippetUrl="https://snippet.babylonjs.com",(0,n.c)([(0,E.J)()],Ab.prototype,"name",void 0),(0,n.c)([(0,E.J)("comment")],Ab.prototype,"comment",void 0),function(U){U[U.None=0]="None",U[U.PerParticle=1]="PerParticle",U[U.PerSystem=2]="PerSystem"}(pM||(pM={}));class Hb extends wM{constructor(U){super(U),this._currentLockId=-2,this.lockMode=pM.PerParticle,this.registerInput("min",vM.AutoDetect,!0,0),this.registerInput("max",vM.AutoDetect,!0,1),this.registerOutput("output",vM.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vM.Float|vM.Int|vM.Vector2|vM.lk|vM.Dk),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(vM.Float|vM.Int|vM.Vector2|vM.lk|vM.Dk),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=vM.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case vM.AutoDetect:case vM.Int:case vM.Float:U=U=>{const M=this.min.getConnectedValue(U)||0,b=this.max.getConnectedValue(U)||1;return M+Math.random()*(b-M)};break;case vM.Vector2:U=U=>{const M=this.min.getConnectedValue(U)||a.i.Zero(),b=this.max.getConnectedValue(U)||a.i.One();return new a.i(M.x+Math.random()*(b.x-M.x),M.y+Math.random()*(b.y-M.y))};break;case vM.lk:U=U=>{const M=this.min.getConnectedValue(U)||a.l.Zero(),b=this.max.getConnectedValue(U)||a.l.One();return new a.l(M.x+Math.random()*(b.x-M.x),M.y+Math.random()*(b.y-M.y),M.z+Math.random()*(b.z-M.z))};break;case vM.Dk:U=U=>{const M=this.min.getConnectedValue(U)||new W.e(0,0,0,0),b=this.max.getConnectedValue(U)||new W.e(1,1,1,1);return new W.e(M.x+Math.random()*(b.x-M.x),M.y+Math.random()*(b.y-M.y),M.z+Math.random()*(b.z-M.z),M.w+Math.random()*(b.w-M.w))}}this.output._storedFunction=M=>{var b;let a=0;switch(this.lockMode){case pM.PerParticle:a=(null===(b=M.particleContext)||void 0===b?void 0:b.id)||-1;break;case pM.PerSystem:a=M.buildId||0}return this._currentLockId!==a&&(this.lockMode!==pM.None&&(this._currentLockId=a),this.output._storedValue=U(M)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),this.lockMode=U.lockMode}}(0,n.c)([TM("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:pM.None},{label:"Per particle",value:pM.PerParticle},{label:"Per system",value:pM.PerSystem}]})],Hb.prototype,"lockMode",void 0),(0,y.i)("BABYLON.ParticleRandomBlock",Hb);class Wb extends wM{constructor(U){super(U),this._currentLockId=-2,this.lockMode=pM.PerParticle,this.registerInput("min",vM.AutoDetect),this.registerInput("max",vM.AutoDetect),this.registerOutput("output",vM.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const M=[vM.Matrix,vM.Particle,vM.Texture,vM.System,vM.FloatGradient,vM.Color4Gradient,vM.Vector2Gradient,vM.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...M),this.max.excludedConnectionPointTypes.push(...M)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case vM.Float:case vM.Int:U=U=>{const M=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return Math.random()*(b-M)+M};break;case vM.Vector2:U=U=>{const M=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return new a.i(Math.random()*(b.x-M.x)+M.x,Math.random()*(b.y-M.y)+M.y)};break;case vM.lk:U=U=>{const M=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return new a.l(Math.random()*(b.x-M.x)+M.x,Math.random()*(b.y-M.y)+M.y,Math.random()*(b.z-M.z)+M.z)};break;case vM.Dk:U=U=>{const M=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return new W.e(Math.random()*(b.r-M.r)+M.r,Math.random()*(b.g-M.g)+M.g,Math.random()*(b.b-M.b)+M.b,Math.random()*(b.a-M.a)+M.a)}}this.output._storedFunction=M=>{var b;let a=0;switch(this.lockMode){case pM.PerParticle:a=(null===(b=M.particleContext)||void 0===b?void 0:b.id)||-1;break;case pM.PerSystem:a=M.buildId||0}return this._currentLockId!==a&&(this.lockMode!==pM.None&&(this._currentLockId=a),this.output._storedValue=U(M)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),void 0!==U.lockMode&&(this.lockMode=U.lockMode)}}(0,n.c)([TM("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:pM.None},{label:"Per particle",value:pM.PerParticle},{label:"Per system",value:pM.PerSystem}]})],Wb.prototype,"lockMode",void 0),(0,y.i)("BABYLON.RandomRangeBlock",Wb);(0,y.i)("BABYLON.ParticleLerpBlock",class extends wM{constructor(U){super(U),this.registerInput("left",vM.AutoDetect),this.registerInput("right",vM.AutoDetect),this.registerInput("gradient",vM.Float,!0,0,0,1),this.registerOutput("output",vM.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vM.Float|vM.Int|vM.Vector2|vM.lk|vM.Dk)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const U=(U,M,b)=>(1-U)*M+U*b;this.output._storedFunction=M=>{const b=this.left.getConnectedValue(M),A=this.right.getConnectedValue(M),H=this.gradient.getConnectedValue(M);switch(this.left.type){case vM.Int:case vM.Float:return U(H,b,A);case vM.Vector2:return new a.i(U(H,b.x,A.x),U(H,b.y,A.y));case vM.lk:return new a.l(U(H,b.x,A.x),U(H,b.y,A.y),U(H,b.z,A.z));case vM.Dk:return new W.e(U(H,b.r,A.r),U(H,b.g,A.g),U(H,b.b,A.b),U(H,b.a,A.a))}return 0}}});(0,y.i)("BABYLON.UpdateDirectionBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("direction",vM.lk),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(U){const M=this.particle.getConnectedValue(U);if(this.output._storedValue=M,!this.direction.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=M,b.direction.p(this.direction.getConnectedValue(U))},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b}});(0,y.i)("BABYLON.UpdateColorBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("color",vM.Dk),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(U){const M=this.particle.getConnectedValue(U);if(this.output._storedValue=M,!this.color.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=M,b.color.p(this.color.getConnectedValue(U))},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b}});(0,y.i)("BABYLON.UpdateScaleBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("scale",vM.Vector2),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(U){const M=this.particle.getConnectedValue(U);if(this.output._storedValue=M,!this.scale.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=M,b.scale.p(this.scale.getConnectedValue(U))},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b}});(0,y.i)("BABYLON.UpdateAngleBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("angle",vM.Float),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(U){const M=this.particle.getConnectedValue(U);if(this.output._storedValue=M,!this.angle.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=M,b.angle=this.angle.getConnectedValue(U)},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b}});(0,y.i)("BABYLON.BasicPositionUpdateBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(U){const M=this.particle.getConnectedValue(U),b={process:b=>{U.particleContext=b,U.systemContext=M,b.direction.scaleToRef(M._directionScale,M._scaledDirection),b.position.addInPlace(M._scaledDirection)},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b,this.output._storedValue=M}});(0,y.i)("BABYLON.BasicSpriteUpdateBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(U){const M=this.particle.getConnectedValue(U),b={process:b=>{U.particleContext=b,U.systemContext=M,b.updateCellIndex()},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b,this.output._storedValue=M}});(0,y.i)("BABYLON.UpdateSpriteCellIndexBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("cellIndex",vM.Int),this.registerOutput("output",vM.Particle),this.cellIndex.acceptedConnectionPointTypes=[vM.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(U){const M=this.particle.getConnectedValue(U);if(this.output._storedValue=M,!this.cellIndex.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=M,b.cellIndex=Math.floor(this.cellIndex.getConnectedValue(U))},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b}});class yb extends wM{constructor(U){super(U),this.strength=1,this.registerInput("particle",vM.Particle),this.registerInput("flowMap",vM.Texture),this.registerOutput("output",vM.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(U){var M;const b=this.particle.getConnectedValue(U),a=U.$e;let A;(null===(M=this.flowMap.connectedPoint)||void 0===M?void 0:M.ownerBlock).extractTextureContentAsync().then((U=>{U&&(A=new IM(U.width,U.height,U.data))}));const H={process:U=>{const M=a.getTransformMatrix();A&&A._processParticle(U,this.strength*b._tempScaledUpdateSpeed,M)},previousItem:null,nextItem:null};b._updateQueueStart?RU(H,b._updateQueueStart):b._updateQueueStart=H,this.output._storedValue=b}serialize(){const U=super.serialize();return U.strength=this.strength,U}_deserialize(U){super._deserialize(U),this.strength=U.strength}}(0,n.c)([TM("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yb.prototype,"strength",void 0),(0,y.i)("BABYLON.UpdateFlowMapBlock",yb);(0,y.i)("BABYLON.SphereShapeBlock",class extends wM{constructor(U){super(U),this.registerInput("input",vM.Particle),this.registerInput("radius",vM.Float,!0,1),this.registerInput("radiusRange",vM.Float,!0,1,0,1),this.registerInput("directionRandomizer",vM.Float,!0,0,0,1),this.registerOutput("output",vM.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(U){const M=this.input.getConnectedValue(U);M._directionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.directionRandomizer.getConnectedValue(U),H=b.position.je(U.emitterPosition).normalize(),W=(0,e.u)(0,A),y=(0,e.u)(0,A),O=(0,e.u)(0,A);H.x+=W,H.y+=y,H.z+=O,H.normalize(),U.isEmitterTransformNode?a.l.TransformNormalFromFloatsToRef(W,y,O,U.emitterWorldMatrix,b.direction):b.direction.vd(W,y,O)},M._positionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.radius.getConnectedValue(U),H=this.radiusRange.getConnectedValue(U),W=A-(0,e.u)(0,A*H),y=(0,e.u)(0,1),O=(0,e.u)(0,2*Math.PI),x=Math.acos(2*y-1),P=W*Math.cos(O)*Math.sin(x),Z=W*Math.cos(x),C=W*Math.sin(O)*Math.sin(x);U.isEmitterTransformNode?a.l.TransformCoordinatesFromFloatsToRef(P,Z,C,U.emitterWorldMatrix,b.position):(b.position.vd(P,Z,C),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=M}});(0,y.i)("BABYLON.PointShapeBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("direction1",vM.lk,!0,new a.l(0,1,0)),this.registerInput("direction2",vM.lk,!0,new a.l(0,1,0)),this.registerOutput("output",vM.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const M=this.particle.getConnectedValue(U);M._directionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.direction1.getConnectedValue(U),H=this.direction2.getConnectedValue(U),W=(0,e.u)(A.x,H.x),y=(0,e.u)(A.y,H.y),O=(0,e.u)(A.z,H.z);U.isEmitterTransformNode?a.l.TransformNormalFromFloatsToRef(W,y,O,U.emitterWorldMatrix,b.direction):b.direction.vd(W,y,O)},M._positionCreation.process=b=>{U.systemContext=M,U.isEmitterTransformNode?a.l.TransformCoordinatesFromFloatsToRef(0,0,0,U.emitterWorldMatrix,b.position):b.position.p(U.emitterPosition)},this.output._storedValue=M}});(0,y.i)("BABYLON.CustomShapeBlock",class extends wM{constructor(U){super(U),this.registerInput("particle",vM.Particle),this.registerInput("position",vM.lk,!0,new a.l(0,0,0)),this.registerInput("direction",vM.lk,!0,new a.l(0,1,0)),this.registerOutput("output",vM.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const M=this.particle.getConnectedValue(U);M._directionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.direction.getConnectedValue(U);U.isEmitterTransformNode?a.l.TransformNormalToRef(A,U.emitterWorldMatrix,b.direction):b.direction.p(A)},M._positionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.position.getConnectedValue(U);U.isEmitterTransformNode?a.l.TransformCoordinatesToRef(A,U.emitterWorldMatrix,b.position):(b.position.p(A),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=M}});(0,y.i)("BABYLON.CylinderShapeBlock",class extends wM{constructor(U){super(U),this._tempVector=a.l.Zero(),this.registerInput("particle",vM.Particle),this.registerInput("radius",vM.Float,!0,1),this.registerInput("height",vM.Float,!0,1,0),this.registerInput("radiusRange",vM.Float,!0,1,0,1),this.registerInput("directionRandomizer",vM.Float,!0,0,0,1),this.registerOutput("output",vM.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const M=this.particle.getConnectedValue(U);M._directionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.directionRandomizer.getConnectedValue(U);b.position.subtractToRef(U.emitterPosition,this._tempVector),this._tempVector.normalize(),U.isEmitterTransformNode&&a.l.TransformNormalToRef(this._tempVector,U.emitterInverseWorldMatrix,this._tempVector);const H=(0,e.u)(-A/2,A/2);let W=Math.atan2(this._tempVector.x,this._tempVector.z);W+=(0,e.u)(-Math.PI/2,Math.PI/2)*A,this._tempVector.y=H,this._tempVector.x=Math.sin(W),this._tempVector.z=Math.cos(W),this._tempVector.normalize(),U.isEmitterTransformNode?a.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U.emitterWorldMatrix,b.direction):b.direction.p(this._tempVector)},M._positionCreation.process=b=>{U.particleContext=b,U.systemContext=M;const A=this.height.getConnectedValue(U),H=this.radiusRange.getConnectedValue(U),W=this.radius.getConnectedValue(U),y=(0,e.u)(-A/2,A/2),O=(0,e.u)(0,2*Math.PI),x=(0,e.u)((1-H)*(1-H),1),P=Math.sqrt(x)*W,Z=P*Math.cos(O),C=P*Math.sin(O);U.isEmitterTransformNode?a.l.TransformCoordinatesFromFloatsToRef(Z,y,C,U.emitterWorldMatrix,b.position):(b.position.vd(Z,y,C),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=M}});class Ob extends wM{constructor(U){super(U),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",vM.Particle),this.registerOutput("output",vM.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const M=this.particle.getConnectedValue(U);M._isAnimationSheetEnabled=!0,M.spriteCellWidth=this.width,M.spriteCellHeight=this.height,M.startSpriteCellID=this.start,M.endSpriteCellID=this.end,M.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=M}serialize(){const U=super.serialize();return U.width=this.width,U.height=this.height,U.start=this.start,U.end=this.end,U.randomStartCell=this.randomStartCell,U}_deserialize(U){super._deserialize(U),this.width=U.width,this.height=U.height,this.start=U.start,this.end=U.end,this.randomStartCell=U.randomStartCell}}(0,n.c)([TM("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ob.prototype,"start",void 0),(0,n.c)([TM("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ob.prototype,"end",void 0),(0,n.c)([TM("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ob.prototype,"width",void 0),(0,n.c)([TM("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ob.prototype,"height",void 0),(0,n.c)([TM("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ob.prototype,"loop",void 0),(0,n.c)([TM("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ob.prototype,"randomStartCell",void 0),(0,y.i)("BABYLON.SetupSpriteSheetBlock",Ob);class eb extends wM{constructor(U){super(U),this.reference=0,this.registerInput("value",vM.AutoDetect),this.registerOutput("output",vM.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case vM.Float:return vM.FloatGradient;case vM.Vector2:return vM.Vector2Gradient;case vM.lk:return vM.Vector3Gradient;case vM.Dk:return vM.Color4Gradient}return U},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vM.Float|vM.Vector2|vM.lk|vM.Dk)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=U=>null}serialize(){const U=super.serialize();return U.reference=this.reference,U}_deserialize(U){super._deserialize(U),this.reference=U.reference}}(0,n.c)([TM("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],eb.prototype,"reference",void 0),(0,y.i)("BABYLON.ParticleGradientValueBlock",eb);(0,y.i)("BABYLON.ParticleGradientBlock",class extends wM{constructor(U){super(U),this._entryCount=1,this.registerInput("gradient",vM.Float,!0,1,0,1),this.registerInput("value0",vM.AutoDetect),this.registerOutput("output",vM.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case vM.FloatGradient:return vM.Float;case vM.Vector2Gradient:return vM.Vector2;case vM.Vector3Gradient:return vM.lk;case vM.Color4Gradient:return vM.Dk}return U},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(vM.FloatGradient|vM.Vector2Gradient|vM.Vector3Gradient|vM.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(U){this._inputs[U].onConnectionObservable.add((()=>{this._entryCount>U||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),vM.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const U=[];for(let b=1;b<this._inputs.length;b++){var M;if(this._inputs[b].isConnected)U.push(null===(M=this._inputs[b].connectedPoint)||void 0===M?void 0:M.ownerBlock)}U.sort(((U,M)=>U.reference-M.reference)),this.output._storedFunction=M=>{const b=this.gradient.getConnectedValue(M);if(1===U.length)return U[0].value.getConnectedValue(M);let A=null;for(let H=U.length-1;H>=0;H--){const y=U[H];if(y.reference<=b){const U=y.value.getConnectedValue(M);if(A){const H=A.value.getConnectedValue(M),O=A.reference,x=y.reference,P=Math.max(0,Math.min(1,(b-x)/(O-x)));switch(this.output.type){case vM.Float:return(0,e.n)(U,H,P);case vM.Vector2:return a.i.Lerp(U,H,P);case vM.lk:return a.l.Lerp(U,H,P);case vM.Dk:return W.e.Lerp(U,H,P)}}return U}A=y}return 0}}});(0,y.i)("BABYLON.ParticleConverterBlock",class extends wM{constructor(U){super(U),this.registerInput("color ",vM.Dk,!0),this.registerInput("xyz ",vM.lk,!0),this.registerInput("xy ",vM.Vector2,!0),this.registerInput("zw ",vM.Vector2,!0),this.registerInput("x ",vM.Float,!0),this.registerInput("y ",vM.Float,!0),this.registerInput("z ",vM.Float,!0),this.registerInput("w ",vM.Float,!0),this.registerOutput("color",vM.Dk),this.registerOutput("xyz",vM.lk),this.registerOutput("xy",vM.Vector2),this.registerOutput("zw",vM.Vector2),this.registerOutput("x",vM.Float),this.registerOutput("y",vM.Float),this.registerOutput("z",vM.Float),this.registerOutput("w",vM.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(U){return"color "===U?"colorIn":"xyz "===U?"xyzIn":"xy "===U?"xyIn":"zw "===U?"zwIn":"x "===U?"xIn":"y "===U?"yIn":"z "===U?"zIn":"w "===U?"wIn":U}_outputRename(U){switch(U){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return U}}_build(U){super._build(U);const M=this.xIn,b=this.yIn,A=this.zIn,H=this.wIn,y=this.xyIn,O=this.zwIn,e=this.xyzIn,x=this.colorIn,P=this.colorOut,Z=this.xyzOut,C=this.xyOut,r=this.zwOut,B=this.xOut,J=this.yOut,F=this.zOut,f=this.wOut,L=U=>{if(x.isConnected)return x.getConnectedValue(U);let a=0,P=0,Z=0,C=0;if(M.isConnected&&(a=M.getConnectedValue(U)),b.isConnected&&(P=b.getConnectedValue(U)),A.isConnected&&(Z=A.getConnectedValue(U)),H.isConnected&&(C=H.getConnectedValue(U)),y.isConnected){const M=y.getConnectedValue(U);M&&(a=M.x,P=M.y)}if(O.isConnected){const M=O.getConnectedValue(U);M&&(Z=M.x,C=M.y)}if(e.isConnected){const M=e.getConnectedValue(U);M&&(a=M.x,P=M.y,Z=M.z)}return new W.e(a,P,Z,C)};P._storedFunction=U=>L(U),Z._storedFunction=U=>{const M=L(U);return new a.l(M.r,M.g,M.b)},C._storedFunction=U=>{const M=L(U);return new a.i(M.r,M.g)},r._storedFunction=U=>{const M=L(U);return new a.i(M.b,M.a)},B._storedFunction=U=>L(U).r,J._storedFunction=U=>L(U).g,F._storedFunction=U=>L(U).b,f._storedFunction=U=>L(U).a}}),function(U){U[U.Cos=0]="Cos",U[U.Sin=1]="Sin",U[U.Abs=2]="Abs",U[U.Exp=3]="Exp",U[U.Exp2=4]="Exp2",U[U.Round=5]="Round",U[U.Floor=6]="Floor",U[U.Ceiling=7]="Ceiling",U[U.Sqrt=8]="Sqrt",U[U.Log=9]="Log",U[U.Tan=10]="Tan",U[U.ArcTan=11]="ArcTan",U[U.ArcCos=12]="ArcCos",U[U.ArcSin=13]="ArcSin",U[U.Sign=14]="Sign",U[U.Negate=15]="Negate",U[U.OneMinus=16]="OneMinus",U[U.Reciprocal=17]="Reciprocal",U[U.ToDegrees=18]="ToDegrees",U[U.ToRadians=19]="ToRadians",U[U.Fract=20]="Fract"}(gM||(gM={}));class xb extends wM{constructor(U){super(U),this.operation=gM.Cos,this.registerInput("input",vM.AutoDetect),this.registerOutput("output",vM.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vM.Float|vM.Int|vM.Vector2|vM.lk|vM.Dk)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);let M=null;switch(this.operation){case gM.Cos:M=U=>Math.cos(U);break;case gM.Sin:M=U=>Math.sin(U);break;case gM.Abs:M=U=>Math.abs(U);break;case gM.Exp:M=U=>Math.exp(U);break;case gM.Exp2:M=U=>Math.pow(2,U);break;case gM.Round:M=U=>Math.round(U);break;case gM.Floor:M=U=>Math.floor(U);break;case gM.Ceiling:M=U=>Math.ceil(U);break;case gM.Sqrt:M=U=>Math.sqrt(U);break;case gM.Log:M=U=>Math.log(U);break;case gM.Tan:M=U=>Math.tan(U);break;case gM.ArcTan:M=U=>Math.atan(U);break;case gM.ArcCos:M=U=>Math.acos(U);break;case gM.ArcSin:M=U=>Math.asin(U);break;case gM.Sign:M=U=>Math.sign(U);break;case gM.Negate:M=U=>-U;break;case gM.OneMinus:M=U=>1-U;break;case gM.Reciprocal:M=U=>1/U;break;case gM.ToRadians:M=U=>U*Math.PI/180;break;case gM.ToDegrees:M=U=>180*U/Math.PI;break;case gM.Fract:M=U=>U>=0?U-Math.floor(U):U-Math.ceil(U)}if(!M)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case vM.Int:case vM.Float:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return M(b)};break;case vM.Vector2:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return new a.i(M(b.x),M(b.y))};break;case vM.lk:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return new a.l(M(b.x),M(b.y),M(b.z))};break;case vM.Dk:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return new W.e(M(b.r),M(b.g),M(b.b),M(b.a))}}return this}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,n.c)([TM("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:gM.Cos},{label:"Sin",value:gM.Sin},{label:"Abs",value:gM.Abs},{label:"Exp",value:gM.Exp},{label:"Exp2",value:gM.Exp2},{label:"Round",value:gM.Round},{label:"Floor",value:gM.Floor},{label:"Ceiling",value:gM.Ceiling},{label:"Sqrt",value:gM.Sqrt},{label:"Log",value:gM.Log},{label:"Tan",value:gM.Tan},{label:"ArcTan",value:gM.ArcTan},{label:"ArcCos",value:gM.ArcCos},{label:"ArcSin",value:gM.ArcSin},{label:"Sign",value:gM.Sign},{label:"Negate",value:gM.Negate},{label:"OneMinus",value:gM.OneMinus},{label:"Reciprocal",value:gM.Reciprocal},{label:"ToDegrees",value:gM.ToDegrees},{label:"ToRadians",value:gM.ToRadians},{label:"Fract",value:gM.Fract}]})],xb.prototype,"operation",void 0),(0,y.i)("BABYLON.ParticleTrigonometryBlock",xb);var Pb,Zb=b(12418);class Cb extends wM{constructor(U){super(U),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",vM.AutoDetect),this.registerOutput("output",vM.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(vM.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(vM.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(vM.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(vM.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(vM.System),this._inputs[0].excludedConnectionPointTypes.push(vM.Particle),this._inputs[0].excludedConnectionPointTypes.push(vM.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const M=U=>{const M=this.input.getConnectedValue(U);if(this.log.length>=this.stackSize)return M;if(null===M||void 0===M)return this.log.push(["null",""]),M;switch(this.input.type){case vM.Vector2:this.log.push([(0,Zb.h)(M,4),M.toString()]);break;case vM.lk:this.log.push([(0,Zb.j)(M,4),M.toString()]);break;case vM.Dk:this.log.push([`{R: ${M.r.toFixed(4)} G: ${M.g.toFixed(4)} B: ${M.b.toFixed(4)} A: ${M.a.toFixed(4)}}`,M.toString()]);break;default:this.log.push([M.toString(),M.toString()])}return M};this.output.isConnected?this.output._storedFunction=M:this.output._storedValue=M(U)}serialize(){const U=super.serialize();return U.stackSize=this.stackSize,U}_deserialize(U){super._deserialize(U),this.stackSize=U.stackSize}}(0,n.c)([TM("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Cb.prototype,"stackSize",void 0),(0,y.i)("BABYLON.ParticleDebugBlock",Cb);(0,y.i)("BABYLON.ParticleElbowBlock",class extends wM{constructor(U){super(U),this.registerInput("input",vM.AutoDetect),this.registerOutput("output",vM.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const M=this._outputs[0],b=this._inputs[0];M._storedFunction=U=>b.getConnectedValue(U)}});(0,y.i)("BABYLON.ParticleTeleportInBlock",class extends wM{get endpoints(){return this._endpoints}constructor(U){super(U),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",vM.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const M of this.endpoints)if(M.isAnAncestorOfType(U))return!0;return!1}isAnAncestorOf(U){for(const M of this.endpoints){if(M===U)return!0;if(M.isAnAncestorOf(U))return!0}return!1}attachToEndpoint(U){U.detach(),this._endpoints.push(U),U._entryPoint=this,U._outputs[0]._typeConnectionSource=this._inputs[0],U._tempEntryPointUniqueId=null,U.name="> "+this.name}detachFromEndpoint(U){const M=this._endpoints.indexOf(U);-1!==M&&(this._endpoints.splice(M,1),U._outputs[0]._typeConnectionSource=null,U._entryPoint=null)}_build(){for(const U of this._endpoints)U.output._storedFunction=U=>this.input.getConnectedValue(U)}});(0,y.i)("BABYLON.ParticleTeleportOutBlock",class extends wM{constructor(U){super(U),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",vM.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(U){this.entryPoint&&this.entryPoint.build(U)}clone(){const U=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(U),U}serialize(){var U;const M=super.serialize();return M.entryPoint=(null===(U=this.entryPoint)||void 0===U?void 0:U.uniqueId)??"",M}_deserialize(U){super._deserialize(U),this._tempEntryPointUniqueId=U.entryPoint}}),function(U){U[U.Equal=0]="Equal",U[U.NotEqual=1]="NotEqual",U[U.LessThan=2]="LessThan",U[U.GreaterThan=3]="GreaterThan",U[U.LessOrEqual=4]="LessOrEqual",U[U.GreaterOrEqual=5]="GreaterOrEqual",U[U.Xor=6]="Xor",U[U.Or=7]="Or",U[U.And=8]="And"}(Pb||(Pb={}));class rb extends wM{constructor(U){super(U),this.test=Pb.Equal,this.epsilon=0,this.registerInput("left",vM.Float),this.registerInput("right",vM.Float,!0,0),this.registerInput("ifTrue",vM.AutoDetect,!0,1),this.registerInput("ifFalse",vM.AutoDetect,!0,0),this.registerOutput("output",vM.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=vM.Float,this._inputs[0].acceptedConnectionPointTypes.push(vM.Int),this._inputs[1].acceptedConnectionPointTypes.push(vM.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const U=U=>{const M=this.left.getConnectedValue(U),b=this.right.getConnectedValue(U);let a=!1;switch(this.test){case Pb.Equal:a=(0,e.x)(M,b,this.epsilon);break;case Pb.NotEqual:a=!(0,e.x)(M,b,this.epsilon);break;case Pb.LessThan:a=M<b+this.epsilon;break;case Pb.GreaterThan:a=M>b-this.epsilon;break;case Pb.LessOrEqual:a=M<=b+this.epsilon;break;case Pb.GreaterOrEqual:a=M>=b-this.epsilon;break;case Pb.Xor:a=!!M&&!b||!M&&!!b;break;case Pb.Or:a=!!M||!!b;break;case Pb.And:a=!!M&&!!b}return a};this.output._storedFunction=M=>U(M)?this.ifTrue.getConnectedValue(M):this.ifFalse.getConnectedValue(M)}serialize(){const U=super.serialize();return U.test=this.test,U.epsilon=this.epsilon,U}_deserialize(U){super._deserialize(U),this.test=U.test,void 0!==U.epsilon&&(this.epsilon=U.epsilon)}}(0,n.c)([TM("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Pb.Equal},{label:"NotEqual",value:Pb.NotEqual},{label:"LessThan",value:Pb.LessThan},{label:"GreaterThan",value:Pb.GreaterThan},{label:"LessOrEqual",value:Pb.LessOrEqual},{label:"GreaterOrEqual",value:Pb.GreaterOrEqual},{label:"Xor",value:Pb.Xor},{label:"Or",value:Pb.Or},{label:"And",value:Pb.And}]})],rb.prototype,"test",void 0),(0,n.c)([TM("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rb.prototype,"epsilon",void 0),(0,y.i)("BABYLON.ParticleConditionBlock",rb);class Bb extends wM{constructor(U){super(U),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",vM.Particle),this.registerInput("condition",vM.Float,!0,0),this.registerInput("system",vM.System),this.registerOutput("output",vM.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){this._triggerCount=0;const M=this.input.getConnectedValue(U),b={process:b=>{if(U.particleContext=b,U.systemContext=M,0!==this.condition.getConnectedValue(U)&&(0===this.limit||this._triggerCount<this.limit)){const a=(new Date).getTime();if(this._previousOne&&a-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=a;const A=this.system.getConnectedValue(U);if(A){const a=lM(A,U.$e,b.position);a.rk.addOnce((()=>{this._triggerCount--})),M.rk.addOnce((()=>{a.dispose()}))}}},previousItem:null,nextItem:null};M._updateQueueStart?RU(b,M._updateQueueStart):M._updateQueueStart=b,this.output._storedValue=M}serialize(){const U=super.serialize();return U.limit=this.limit,U.delay=this.delay,U}_deserialize(U){super._deserialize(U),void 0!==U.limit&&(this.limit=U.limit),void 0!==U.delay&&(this.delay=U.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,n.c)([TM("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bb.prototype,"limit",void 0),(0,n.c)([TM("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bb.prototype,"delay",void 0),(0,y.i)("BABYLON.ParticleTriggerBlock",Bb);b(12423),b(12432),b(12443),b(12495)},12489:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneFragment",H="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12448:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneFragmentDeclaration",H="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12506:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneVertex",H="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12497:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneVertexDeclaration",H="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12493:(U,M,b)=>{"use strict";var a=b(572);const A="fogFragment",H="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12484:(U,M,b)=>{"use strict";var a=b(572);const A="fogFragmentDeclaration",H="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12508:(U,M,b)=>{"use strict";var a=b(572);const A="fogVertex",H="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12504:(U,M,b)=>{"use strict";var a=b(572);const A="fogVertexDeclaration",H="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12467:(U,M,b)=>{"use strict";var a=b(572);const A="helperFunctions",H="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12456:(U,M,b)=>{"use strict";var a=b(572);const A="imageProcessingDeclaration",H="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12475:(U,M,b)=>{"use strict";var a=b(572);const A="imageProcessingFunctions",H="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12463:(U,M,b)=>{"use strict";var a=b(572);const A="logDepthDeclaration",H="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12491:(U,M,b)=>{"use strict";var a=b(572);const A="logDepthFragment",H="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12516:(U,M,b)=>{"use strict";var a=b(572);const A="logDepthVertex",H="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";a.c.IncludesShadersStoreWGSL[A]||(a.c.IncludesShadersStoreWGSL[A]=H)},12443:(U,M,b)=>{"use strict";b.r(M),b.d(M,{particlesPixelShaderWGSL:()=>W});var a=b(572);b(12448),b(12456),b(12463),b(12467),b(12475),b(12484),b(12489),b(12491),b(12493);const A="particlesPixelShader",H="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";a.c.ShadersStoreWGSL[A]||(a.c.ShadersStoreWGSL[A]=H);const W={name:A,shader:H}},12495:(U,M,b)=>{"use strict";b.r(M),b.d(M,{particlesVertexShaderWGSL:()=>W});var a=b(572);b(12497),b(12504),b(12463),b(12506),b(12508),b(12516);const A="particlesVertexShader",H="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";a.c.ShadersStoreWGSL[A]||(a.c.ShadersStoreWGSL[A]=H);const W={name:A,shader:H}},12360:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneFragment",H="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12428:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneFragmentDeclaration",H="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12383:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneVertex",H="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12438:(U,M,b)=>{"use strict";var a=b(572);const A="clipPlaneVertexDeclaration",H="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12372:(U,M,b)=>{"use strict";var a=b(572);const A="fogFragment",H="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12358:(U,M,b)=>{"use strict";var a=b(572);const A="fogFragmentDeclaration",H="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12391:(U,M,b)=>{"use strict";var a=b(572);const A="fogVertex",H="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12381:(U,M,b)=>{"use strict";var a=b(572);const A="fogVertexDeclaration",H="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12346:(U,M,b)=>{"use strict";var a=b(572);const A="helperFunctions",H="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12334:(U,M,b)=>{"use strict";var a=b(572);const A="imageProcessingDeclaration",H="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12351:(U,M,b)=>{"use strict";var a=b(572);const A="imageProcessingFunctions",H="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12338:(U,M,b)=>{"use strict";var a=b(572);const A="logDepthDeclaration",H="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12369:(U,M,b)=>{"use strict";var a=b(572);const A="logDepthFragment",H="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12394:(U,M,b)=>{"use strict";var a=b(572);const A="logDepthVertex",H="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";a.c.IncludesShadersStore[A]||(a.c.IncludesShadersStore[A]=H)},12423:(U,M,b)=>{"use strict";b.r(M),b.d(M,{particlesPixelShader:()=>W});var a=b(572);b(12428),b(12334),b(12338),b(12346),b(12351),b(12358),b(12360),b(12369),b(12372);const A="particlesPixelShader",H="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";a.c.ShadersStore[A]||(a.c.ShadersStore[A]=H);const W={name:A,shader:H}},12432:(U,M,b)=>{"use strict";b.r(M),b.d(M,{particlesVertexShader:()=>W});var a=b(572);b(12438),b(12381),b(12338),b(12383),b(12391),b(12394);const A="particlesVertexShader",H="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";a.c.ShadersStore[A]||(a.c.ShadersStore[A]=H);const W={name:A,shader:H}},12833:(U,M,b)=>{"use strict";b.r(M),b.d(M,{FlowGraphGLTFDataProvider:()=>H});var a=b(12795),A=b(12775);class H extends a.c{constructor(U){var M,b;super();const a=U.glTF,H=(null===(M=a.animations)||void 0===M?void 0:M.map((U=>U._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",A.c,H);const W=(null===(b=a.nodes)||void 0===b?void 0:b.map((U=>U._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",A.c,W)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12688:(U,M,b)=>{"use strict";b.d(M,{d:()=>J,f:()=>r,j:()=>C,l:()=>B});var a=b(670),A=b(12696),H=b(707),W=b(12705);const y=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class O{constructor(U,M){this._gltf=U,this._infoTree=M}convert(U){let M,b=this._gltf,a=this._infoTree;if(!U.startsWith("/"))throw new Error("Path must start with a /");const A=U.split("/");if(A.shift(),A[A.length-1].includes(".length")){const U=A[A.length-1].split(".");A.pop(),A.push(...U)}let H=!1;for(const O of A){const A="length"===O;if(A&&!a.__array__)throw new Error(`Path ${U} is invalid`);if(a.__ignoreObjectTree__&&(H=!0),a.__array__&&!A)a=a.__array__;else if(a=a[O],!a)throw new Error(`Path ${U} is invalid`);if(!H)if(void 0===b){if(!y.find((M=>M.regex.test(U))))throw new Error(`Path ${U} is invalid`)}else if(!A){var W;b=null===(W=b)||void 0===W?void 0:W[O]}(a.__target__||A)&&(M=b)}return{object:M,info:a}}}function e(U,M,b,a){const A=x(U,M);return a?A[b][a]:A[b]}function x(U,M,b){var a,H;return null===(a=U._data)||void 0===a||null===(H=a[(null===b||void 0===b?void 0:b.fillMode)??A.c.MATERIAL_TriangleFillMode])||void 0===H?void 0:H.babylonMaterial}function P(U,M){return{offset:{componentsCount:2,type:"Vector2",get:(b,A,H)=>{const W=e(b,H,U,M);return new a.i(null===W||void 0===W?void 0:W.uOffset,null===W||void 0===W?void 0:W.vOffset)},getTarget:x,set:(b,a,A,H)=>{const W=e(a,H,U,M);W.uOffset=b.x,W.vOffset=b.y},getPropertyName:[()=>`${U}${M?"."+M:""}.uOffset`,()=>`${U}${M?"."+M:""}.vOffset`]},rotation:{type:"number",get:(b,a,A)=>{var H;return null===(H=e(b,A,U,M))||void 0===H?void 0:H.wAng},getTarget:x,set:(b,a,A,H)=>e(a,H,U,M).wAng=b,getPropertyName:[()=>`${U}${M?"."+M:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(b,A,H)=>{const W=e(b,H,U,M);return new a.i(null===W||void 0===W?void 0:W.uScale,null===W||void 0===W?void 0:W.vScale)},getTarget:x,set:(b,a,A,H)=>{const W=e(a,H,U,M);W.uScale=b.x,W.vScale=b.y},getPropertyName:[()=>`${U}${M?"."+M:""}.uScale`,()=>`${U}${M?"."+M:""}.vScale`]}}}const Z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:U=>{var M,b;return new a.i((null===(M=U._babylonCamera)||void 0===M?void 0:M.orthoLeft)??0,(null===(b=U._babylonCamera)||void 0===b?void 0:b.orthoRight)??0)},set:(U,M)=>{M._babylonCamera&&(M._babylonCamera.orthoLeft=U.x,M._babylonCamera.orthoRight=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:U=>{var M,b;return new a.i((null===(M=U._babylonCamera)||void 0===M?void 0:M.orthoBottom)??0,(null===(b=U._babylonCamera)||void 0===b?void 0:b.orthoTop)??0)},set:(U,M)=>{M._babylonCamera&&(M._babylonCamera.orthoBottom=U.x,M._babylonCamera.orthoTop=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:U=>{var M;return null===(M=U._babylonCamera)||void 0===M?void 0:M.maxZ},set:(U,M)=>{M._babylonCamera&&(M._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var M;return null===(M=U._babylonCamera)||void 0===M?void 0:M.ek},set:(U,M)=>{M._babylonCamera&&(M._babylonCamera.ek=U)},getTarget:U=>U,getPropertyName:[()=>"ek"]}},perspective:{aspectRatio:{type:"number",get:U=>{var M;return null===(M=U._babylonCamera)||void 0===M?void 0:M.getEngine().getAspectRatio(U._babylonCamera)},getTarget:U=>U,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:U=>{var M;return null===(M=U._babylonCamera)||void 0===M?void 0:M.fov},set:(U,M)=>{M._babylonCamera&&(M._babylonCamera.fov=U)},getTarget:U=>U,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:U=>{var M;return null===(M=U._babylonCamera)||void 0===M?void 0:M.maxZ},set:(U,M)=>{M._babylonCamera&&(M._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var M;return null===(M=U._babylonCamera)||void 0===M?void 0:M.ek},set:(U,M)=>{M._babylonCamera&&(M._babylonCamera.ek=U)},getTarget:U=>U,getPropertyName:[()=>"ek"]}}}},nodes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"lk",get:U=>{var M;return null===(M=U._babylonTransformNode)||void 0===M?void 0:M.position},set:(U,M)=>{var b;return null===(b=M._babylonTransformNode)||void 0===b?void 0:b.position.p(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:U=>{var M;return null===(M=U._babylonTransformNode)||void 0===M?void 0:M.rotationQuaternion},set:(U,M)=>{var b,a;return null===(b=M._babylonTransformNode)||void 0===b||null===(a=b.rotationQuaternion)||void 0===a?void 0:a.p(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"lk",get:U=>{var M;return null===(M=U._babylonTransformNode)||void 0===M?void 0:M.zd},set:(U,M)=>{var b;return null===(b=M._babylonTransformNode)||void 0===b?void 0:b.zd.p(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"zd"]},weights:{length:{type:"number",get:U=>U._numMorphTargets,getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(U,M)=>{var b,a;return void 0!==M?null===(b=U._primitiveBabylonMeshes)||void 0===b||null===(a=b[0].morphTargetManager)||void 0===a?void 0:a.getTarget(M).influence:void 0},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(U,M)=>[0],getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:U=>{var M,b,A;return a.b.Compose(null===(M=U._babylonTransformNode)||void 0===M?void 0:M.zd,null===(b=U._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion,null===(A=U._babylonTransformNode)||void 0===A?void 0:A.position)},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:U=>{var M,b,A,H;const W=a.b.Identity();let y=U.parent;for(;y&&y.parent;)y=y.parent;const O=(null===(M=U._babylonTransformNode)||void 0===M?void 0:M.position._isDirty)||(null===(b=U._babylonTransformNode)||void 0===b||null===(A=b.rotationQuaternion)||void 0===A?void 0:A._isDirty)||(null===(H=U._babylonTransformNode)||void 0===H?void 0:H.zd._isDirty);if(y){var e;const M=null===(e=y._babylonTransformNode)||void 0===e?void 0:e.ik(!0).invert();var x,P;if(M)null===(x=U._babylonTransformNode)||void 0===x||null===(P=x.ik(O))||void 0===P||P.multiplyToRef(M,W)}else U._babylonTransformNode&&W.p(U._babylonTransformNode.ik(O));return W},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:U=>{var M,b;return null===(M=U._babylonTransformNode)||void 0===M||null===(b=M.getChildren((U=>U instanceof W.c),!0)[0])||void 0===b?void 0:b.Rl},getTarget:U=>{var M;return null===(M=U._babylonTransformNode)||void 0===M?void 0:M.getChildren((U=>U instanceof W.c),!0)[0]},set:(U,M)=>{if(M._babylonTransformNode){const b=M._babylonTransformNode.getChildren((U=>U instanceof W.c),!0)[0];b&&(b.Rl=U)}}},color:{type:"Ck",get:U=>{var M,b;return null===(M=U._babylonTransformNode)||void 0===M||null===(b=M.getChildren((U=>U instanceof W.c),!0)[0])||void 0===b?void 0:b.Zk},getTarget:U=>{var M;return null===(M=U._babylonTransformNode)||void 0===M?void 0:M.getChildren((U=>U instanceof W.c),!0)[0]},set:(U,M)=>{if(M._babylonTransformNode){const b=M._babylonTransformNode.getChildren((U=>U instanceof W.c),!0)[0];b&&(b.Zk=U)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Ck",get:(U,M,b)=>x(U,M,b).emissiveColor,set:(U,M,b,a)=>x(M,b,a).emissiveColor.p(U),getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:P("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(U,M,b)=>{var a;return null===(a=e(U,b,"bumpTexture"))||void 0===a?void 0:a.level},set:(U,M,b,a)=>{const A=e(M,a,"bumpTexture");A&&(A.level=U)},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:P("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(U,M,b)=>x(U,M,b).ambientTextureStrength,set:(U,M,b,a)=>{const A=x(M,b,a);A&&(A.ambientTextureStrength=U)},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:P("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Dk",get:(U,M,b)=>{const a=x(U,M,b);return H.e.FromColor3(a.albedoColor,a.alpha)},set:(U,M,b,a)=>{const A=x(M,b,a);A.albedoColor.set(U.r,U.g,U.b),A.alpha=U.a},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:P("albedoTexture")}},metallicFactor:{type:"number",get:(U,M,b)=>x(U,M,b).metallic,set:(U,M,b,a)=>{const A=x(M,b,a);A&&(A.metallic=U)},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(U,M,b)=>x(U,M,b).roughness,set:(U,M,b,a)=>{const A=x(M,b,a);A&&(A.roughness=U)},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:P("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(U,M,b)=>x(U,M,b).anisotropy.Rl,set:(U,M,b,a)=>{x(M,b,a).anisotropy.Rl=U},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(U,M,b)=>x(U,M,b).anisotropy.angle,set:(U,M,b,a)=>{x(M,b,a).anisotropy.angle=U},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:P("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(U,M,b)=>x(U,M,b).clearCoat.Rl,set:(U,M,b,a)=>{x(M,b,a).clearCoat.Rl=U},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(U,M,b)=>x(U,M,b).clearCoat.roughness,set:(U,M,b,a)=>{x(M,b,a).clearCoat.roughness=U},getTarget:(U,M,b)=>x(U,M,b),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:P("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(U,M,b)=>{var a;return null===(a=x(U,M,b).clearCoat.bumpTexture)||void 0===a?void 0:a.level},getTarget:x,set:(U,M,b,a)=>x(M,b,a).clearCoat.bumpTexture.level=U},extensions:{KHR_texture_transform:P("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:P("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(U,M,b)=>x(U,M,b).subSurface.dispersion,getTarget:x,set:(U,M,b,a)=>x(M,b,a).subSurface.dispersion=U}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(U,M,b)=>x(U,M,b).emissiveIntensity,getTarget:x,set:(U,M,b,a)=>x(M,b,a).emissiveIntensity=U}},KHR_materials_ior:{ior:{type:"number",get:(U,M,b)=>x(U,M,b).indexOfRefraction,getTarget:x,set:(U,M,b,a)=>x(M,b,a).indexOfRefraction=U}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(U,M,b)=>x(U,M,b).iridescence.Rl,getTarget:x,set:(U,M,b,a)=>x(M,b,a).iridescence.Rl=U},iridescenceIor:{type:"number",get:(U,M,b)=>x(U,M,b).iridescence.indexOfRefraction,getTarget:x,set:(U,M,b,a)=>x(M,b,a).iridescence.indexOfRefraction=U},iridescenceTexture:{extensions:{KHR_texture_transform:P("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(U,M,b)=>x(U,M,b).iridescence.maximumThickness,getTarget:x,set:(U,M,b,a)=>x(M,b,a).iridescence.maximumThickness=U},iridescenceThicknessMinimum:{type:"number",get:(U,M,b)=>x(U,M,b).iridescence.minimumThickness,getTarget:x,set:(U,M,b,a)=>x(M,b,a).iridescence.minimumThickness=U},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:P("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Ck",get:(U,M,b)=>x(U,M,b).sheen.color,getTarget:x,set:(U,M,b,a)=>x(M,b,a).sheen.color.p(U)},sheenColorTexture:{extensions:{KHR_texture_transform:P("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(U,M,b)=>x(U,M,b).sheen.Rl,getTarget:x,set:(U,M,b,a)=>x(M,b,a).sheen.Rl=U},sheenRoughnessTexture:{extensions:{KHR_texture_transform:P("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(U,M,b)=>x(U,M,b).metallicF0Factor,getTarget:x,set:(U,M,b,a)=>x(M,b,a).metallicF0Factor=U,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Ck",get:(U,M,b)=>x(U,M,b).metallicReflectanceColor,getTarget:x,set:(U,M,b,a)=>x(M,b,a).metallicReflectanceColor.p(U),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:P("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:P("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(U,M,b)=>x(U,M,b).subSurface.refractionIntensity,getTarget:x,set:(U,M,b,a)=>x(M,b,a).subSurface.refractionIntensity=U,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(U,M,b)=>x(U,M,b).subSurface.translucencyIntensity,getTarget:x,set:(U,M,b,a)=>x(M,b,a).subSurface.translucencyIntensity=U},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Ck",get:(U,M,b)=>x(U,M,b).subSurface.translucencyColor,getTarget:x,set:(U,M,b,a)=>{var A;return U&&(null===(A=x(M,b,a).subSurface.translucencyColor)||void 0===A?void 0:A.p(U))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Ck",get:(U,M,b)=>x(U,M,b).subSurface.tintColor,getTarget:x,set:(U,M,b,a)=>x(M,b,a).subSurface.tintColor.p(U)},attenuationDistance:{type:"number",get:(U,M,b)=>x(U,M,b).subSurface.tintColorAtDistance,getTarget:x,set:(U,M,b,a)=>x(M,b,a).subSurface.tintColorAtDistance=U},thicknessFactor:{type:"number",get:(U,M,b)=>x(U,M,b).subSurface.maximumThickness,getTarget:x,set:(U,M,b,a)=>x(M,b,a).subSurface.maximumThickness=U},thicknessTexture:{extensions:{KHR_texture_transform:P("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,color:{type:"Ck",get:U=>{var M;return null===(M=U._babylonLight)||void 0===M?void 0:M.Zk},set:(U,M)=>{var b;return null===(b=M._babylonLight)||void 0===b?void 0:b.Zk.p(U)},getTarget:U=>U._babylonLight,getPropertyName:[U=>"diffuse"]},Rl:{type:"number",get:U=>{var M;return null===(M=U._babylonLight)||void 0===M?void 0:M.Rl},set:(U,M)=>M._babylonLight?M._babylonLight.Rl=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"intensity"]},range:{type:"number",get:U=>{var M;return null===(M=U._babylonLight)||void 0===M?void 0:M.range},set:(U,M)=>M._babylonLight?M._babylonLight.range=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"range"]},spot:{innerConeAngle:{type:"number",get:U=>{var M;return null===(M=U._babylonLight)||void 0===M?void 0:M.innerAngle},set:(U,M)=>M._babylonLight?M._babylonLight.innerAngle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"innerConeAngle"]},outerConeAngle:{type:"number",get:U=>{var M;return null===(M=U._babylonLight)||void 0===M?void 0:M.angle},set:(U,M)=>M._babylonLight?M._babylonLight.angle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTexture)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,Rl:{type:"number",get:U=>{var M;return null===(M=U._babylonTexture)||void 0===M?void 0:M.level},set:(U,M)=>{M._babylonTexture&&(M._babylonTexture.level=U)},getTarget:U=>U._babylonTexture},rotation:{type:"Quaternion",get:U=>{var M;return U._babylonTexture&&a.e.FromRotationMatrix(null===(M=U._babylonTexture)||void 0===M?void 0:M.getReflectionTextureMatrix())},set:(U,M)=>{var b;M._babylonTexture&&(null!==(b=M._babylonTexture.va())&&void 0!==b&&b.useRightHandedSystem||(U=a.e.Inverse(U)),a.b.FromQuaternionToRef(U,M._babylonTexture.getReflectionTextureMatrix()))},getTarget:U=>U._babylonTexture}}}}},animations:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>{var M;return null===(M=U.primitives[0]._instanceData)||void 0===M?void 0:M.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function C(U){return new O(U,Z)}function r(U){const M=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let b=Z;for(const a of M)a&&(b=b[a]);if(b&&b.type&&b.get)return b}function B(U,M){const b=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let a=Z;for(const A of b)A&&(a=a[A]);a&&a.type&&a.get&&(a.interpolation=M)}function J(U,M){const b=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let a=Z;for(const A of b)if(A){if(!a[A]){if("?"===A){a.__ignoreObjectTree__=!0;continue}a[A]={},"__array__"===A&&(a[A].__target__=!0)}a=a[A]}Object.assign(a,M)}},12716:(U,M,b)=>{"use strict";b.r(M),b.d(M,{AnimationPropertyInfo:()=>e,TransformNodeAnimationPropertyInfo:()=>x,WeightAnimationPropertyInfo:()=>P,getQuaternion:()=>y,getVector3:()=>W,getWeights:()=>O});var a=b(12641),A=b(670),H=b(12688);function W(U,M,b,a){return A.l.jk(M,b).scaleInPlace(a)}function y(U,M,b,a){return A.e.jk(M,b).scaleInPlace(a)}function O(U,M,b,a){const A=new Array(U._numMorphTargets);for(let H=0;H<A.length;H++)A[H]=M[b++]*a;return A}class e{constructor(U,M,b,a){this.type=U,this.name=M,this.getValue=b,this.getStride=a}_buildAnimation(U,M,b){const A=new a.d(U,this.name,M,this.type);return A.setKeys(b),A}}class x extends e{buildAnimations(U,M,b,a){const A=[];return A.push({babylonAnimatable:U._babylonTransformNode,babylonAnimation:this._buildAnimation(M,b,a)}),A}}class P extends e{buildAnimations(U,M,b,A){const H=[];if(U._numMorphTargets)for(let W=0;W<U._numMorphTargets;W++){const y=new a.d(`${M}_${W}`,this.name,b,this.type);if(y.setKeys(A.map((U=>({frame:U.frame,inTangent:U.inTangent?U.inTangent[W]:void 0,value:U.value[W],outTangent:U.outTangent?U.outTangent[W]:void 0,interpolation:U.interpolation})))),U._primitiveBabylonMeshes)for(const M of U._primitiveBabylonMeshes)if(M.morphTargetManager){const U=M.morphTargetManager.getTarget(W),b=y.clone();U.animations.push(b),H.push({babylonAnimatable:U,babylonAnimation:b})}}return H}}(0,H.l)("/nodes/{}/translation",[new x(a.d.ANIMATIONTYPE_VECTOR3,"position",W,(()=>3))]),(0,H.l)("/nodes/{}/rotation",[new x(a.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",y,(()=>4))]),(0,H.l)("/nodes/{}/scale",[new x(a.d.ANIMATIONTYPE_VECTOR3,"zd",W,(()=>3))]),(0,H.l)("/nodes/{}/weights",[new P(a.d.ANIMATIONTYPE_FLOAT,"influence",O,(U=>U._numMorphTargets))])},12613:(U,M,b)=>{"use strict";class a{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((U,M)=>{this._resolve=U,this._reject=M}))}}var A=b(670),H=b(707),W=b(479),y=b(639),O=b(12616),e=b(12632),x=b(474),P=b(12326),Z=b(12641),C=b(12643),r=b(524),B=b(497),J=b(501);class F{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(U){this._useTextureToStoreBoneMatrices=U,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(U){this._animationPropertiesOverride=U}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(U,M,b){this.name=U,this.id=M,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=A.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new x.e,this.bones=[],this._scene=b||r.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const a=this._scene.getEngine().getCaps();this._canUseTextureForBones=a.textureFloat&&a.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((U=>!U.getParent()))}getTransformMatrices(U){if(this.needInitialSkinMatrix){if(!U)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return U._bonesTransformMatrices||this.prepare(!0),U._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(U){return this.needInitialSkinMatrix&&U._transformMatrixTexture?U._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(U){let M=`Name: ${this.name}, nBones: ${this.bones.length}`;if(M+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,U){M+=", Ranges: {";let U=!0;for(const b in this._ranges)U&&(M+=", ",U=!1),M+=b;M+="}"}return M}getBoneIndexByName(U){for(let M=0,b=this.bones.length;M<b;M++)if(this.bones[M].name===U)return M;return-1}createAnimationRange(U,M,b){if(!this._ranges[U]){this._ranges[U]=new C.c(U,M,b);for(let a=0,A=this.bones.length;a<A;a++)this.bones[a].animations[0]&&this.bones[a].animations[0].createRange(U,M,b)}}deleteAnimationRange(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,a=this.bones.length;b<a;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].deleteRange(U,M);this._ranges[U]=null}getAnimationRange(U){return this._ranges[U]||null}getAnimationRanges(){const U=[];let M;for(M in this._ranges)U.push(this._ranges[M]);return U}copyAnimationRange(U,M){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[M]||!U.getAnimationRange(M))return!1;let a=!0;const A=this._getHighestAnimationFrame()+1,H={},W=U.bones;let y,O;for(O=0,y=W.length;O<y;O++)H[W[O].name]=W[O];this.bones.length!==W.length&&(B.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${W.length}`),a=!1);const e=b&&this.dimensionsAtRest&&U.dimensionsAtRest?this.dimensionsAtRest.divide(U.dimensionsAtRest):null;for(O=0,y=this.bones.length;O<y;O++){const U=this.bones[O].name,W=H[U];W?a=a&&this.bones[O].copyAnimationRange(W,M,A,b,e):(B.b.Warn("copyAnimationRange: not same rig, missing source bone "+U),a=!1)}const x=U.getAnimationRange(M);return x&&(this._ranges[M]=new C.c(M,x.from+A,x.to+A)),a}returnToRest(){for(const U of this.bones)-1!==U._index&&U.returnToRest()}_getHighestAnimationFrame(){let U=0;for(let M=0,b=this.bones.length;M<b;M++)if(this.bones[M].animations[0]){const b=this.bones[M].animations[0].getHighestFrame();U<b&&(U=b)}return U}beginAnimation(U,M,b,a){const A=this.getAnimationRange(U);return A?this._scene.beginAnimation(this,A.from,A.to,M,b,a):null}static MakeAnimationAdditive(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const a=U.getAnimationRange(b);if(!a)return null;const A=U._scene.getAllAnimatablesByTarget(U);let H=null;for(let y=0;y<A.length;y++){const U=A[y];if(U.fromFrame===(null===a||void 0===a?void 0:a.from)&&U.toFrame===(null===a||void 0===a?void 0:a.to)){H=U;break}}const W=U.getAnimatables();for(let y=0;y<W.length;y++){const U=W[y].animations;if(U)for(let a=0;a<U.length;a++)Z.d.MakeAnimationAdditive(U[a],M,b)}return H&&(H.isAdditive=!0),U}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(U){this._meshesWithPoseMatrix.push(U)}_unregisterMeshWithPoseMatrix(U){const M=this._meshesWithPoseMatrix.indexOf(U);M>-1&&this._meshesWithPoseMatrix.splice(M,1)}_computeTransformMatrices(U,M){this.onBeforeComputeObservable.notifyObservers(this);for(let b=0;b<this.bones.length;b++){const a=this.bones[b];a._childUpdateId++;const A=a.getParent();if(A?a.getLocalMatrix().multiplyToRef(A.getFinalMatrix(),a.getFinalMatrix()):M?a.getLocalMatrix().multiplyToRef(M,a.getFinalMatrix()):a.getFinalMatrix().p(a.getLocalMatrix()),-1!==a._index){const M=null===a._index?b:a._index;a.getAbsoluteInverseBindMatrix().multiplyToArray(a.getFinalMatrix(),U,16*M)}}this._identity.copyToArray(U,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const U=this.va().getRenderId();if(this._currentRenderId===U)return;this._currentRenderId=U}if(this._numBonesWithLinkedTransformNode>0)for(const U of this.bones)if(U._linkedTransformNode){const M=U._linkedTransformNode;U.position=M.position,M.rotationQuaternion?U.rotationQuaternion=M.rotationQuaternion:U.rotation=M.rotation,U.zd=M.zd}if(this.needInitialSkinMatrix)for(const U of this._meshesWithPoseMatrix){const M=U.getPoseMatrix();let b=this._isDirty;if(U._bonesTransformMatrices&&U._bonesTransformMatrices.length===16*(this.bones.length+1)||(U._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),b=!0),b){if(this._synchronizedWithMesh!==U){this._synchronizedWithMesh=U;for(const U of this.bones)if(!U.getParent()){U.getBindMatrix().multiplyToRef(M,A.g.Matrix[1]),U._updateAbsoluteBindMatrices(A.g.Matrix[1])}if(this.isUsingTextureForMatrices){const M=4*(this.bones.length+1);U._transformMatrixTexture&&U._transformMatrixTexture.getSize().width===M||(U._transformMatrixTexture&&U._transformMatrixTexture.dispose(),U._transformMatrixTexture=P.d.CreateRGBATexture(U._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(U._bonesTransformMatrices,M),this.isUsingTextureForMatrices&&U._transformMatrixTexture&&U._transformMatrixTexture.update(U._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=P.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let U=0;U<this.bones.length;U++)this._animatables.push(this.bones[U])}return this._animatables}clone(U,M){const b=new F(U,M||U,this._scene);b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let a=0;a<this.bones.length;a++){const U=this.bones[a];let M=null;const A=U.getParent();if(A){const U=this.bones.indexOf(A);M=b.bones[U]}const H=new e.d(U.name,b,M,U.getBindMatrix().clone(),U.getRestMatrix().clone());H._index=U._index,U._linkedTransformNode&&H.linkTransformNode(U._linkedTransformNode),J.c.DeepCopy(U.animations,H.animations)}if(this._ranges){b._ranges={};for(const U in this._ranges){const M=this._ranges[U];M&&(b._ranges[U]=M.clone())}}return this._isDirty=!0,b.prepare(!0),b}enableBlending(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const M of this.bones)for(const b of M.animations)b.enableBlending=!0,b.blendingSpeed=U}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const U=this._parentContainer.skeletons.indexOf(this);U>-1&&this._parentContainer.skeletons.splice(U,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const U={};U.name=this.name,U.id=this.id,this.dimensionsAtRest&&(U.dimensionsAtRest=this.dimensionsAtRest.tk()),U.bones=[],U.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){var M;const a=this.bones[b],A=a.getParent(),H={parentBoneIndex:A?this.bones.indexOf(A):-1,index:a.getIndex(),name:a.name,id:a.id,matrix:a.getBindMatrix().tk(),rest:a.getRestMatrix().tk(),linkedTransformNodeId:null===(M=a.getTransformNode())||void 0===M?void 0:M.id};U.bones.push(H),a.length&&(H.length=a.length),a.metadata&&(H.metadata=a.metadata),a.animations&&a.animations.length>0&&(H.animation=a.animations[0].serialize()),U.ranges=[];for(const M in this._ranges){const b=this._ranges[M];if(!b)continue;const a={};a.name=M,a.from=b.from,a.to=b.to,U.ranges.push(a)}}return U}static Parse(U,M){const b=new F(U.name,U.id,M);let a;for(U.dimensionsAtRest&&(b.dimensionsAtRest=A.l.jk(U.dimensionsAtRest)),b.needInitialSkinMatrix=U.needInitialSkinMatrix,a=0;a<U.bones.length;a++){const M=U.bones[a],H=U.bones[a].index;let W=null;M.parentBoneIndex>-1&&(W=b.bones[M.parentBoneIndex]);const y=M.rest?A.b.jk(M.rest):null,O=new e.d(M.name,b,W,A.b.jk(M.matrix),y,null,H);void 0!==M.id&&null!==M.id&&(O.id=M.id),M.length&&(O.length=M.length),M.metadata&&(O.metadata=M.metadata),M.animation&&O.animations.push(Z.d.Parse(M.animation)),void 0!==M.linkedTransformNodeId&&null!==M.linkedTransformNodeId&&(b._hasWaitingData=!0,O._waitingTransformNodeId=M.linkedTransformNodeId)}if(U.ranges)for(a=0;a<U.ranges.length;a++){const M=U.ranges[a];b.createAnimationRange(M.name,M.from,M.to)}return b}computeAbsoluteMatrices(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||U)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(U)}getPoseMatrix(){let U=null;return this._meshesWithPoseMatrix.length>0&&(U=this._meshesWithPoseMatrix[0].getPoseMatrix()),U}sortBones(){const U=[],M=new Array(this.bones.length);for(let b=0;b<this.bones.length;b++)this._sortBones(b,U,M);this.bones=U}_sortBones(U,M,b){if(b[U])return;b[U]=!0;const a=this.bones[U];if(!a)return;void 0===a._index&&(a._index=U);const A=a.getParent();A&&this._sortBones(this.bones.indexOf(A),M,b),M.push(a)}setCurrentPoseAsRest(){for(const U of this.bones)U.setCurrentPoseAsRest()}}var f=b(811),L=b(645),z=b(652),o=b(12649),S=b(12651),h=b(609),i=b(698);class Y extends S.e{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(U){this.subSurface.refractionTexture=U,U?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(U){this.subSurface.indexOfRefraction=U}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(U){this.subSurface.invertRefractionY=U}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(U){this.subSurface.linkRefractionWithTransparency=U,U&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===S.e.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(U){U!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=U?S.e.LIGHTFALLOFF_PHYSICAL:S.e.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===S.e.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(U){U!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=U?S.e.LIGHTFALLOFF_GLTF:S.e.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(U){this._attachImageProcessingConfiguration(U),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(U){this.imageProcessingConfiguration.colorCurvesEnabled=U}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(U){this.imageProcessingConfiguration.colorGradingEnabled=U}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(U){this._imageProcessingConfiguration.toneMappingEnabled=U}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(U){this._imageProcessingConfiguration.exposure=U}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(U){this._imageProcessingConfiguration.contrast=U}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(U){this._imageProcessingConfiguration.colorGradingTexture=U}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(U){this._imageProcessingConfiguration.colorCurves=U}constructor(U,M){super(U,M,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=H.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new H.c(0,0,0),this.albedoColor=new H.c(1,1,1),this.baseWeight=1,this.reflectivityColor=new H.c(1,1,1),this.reflectionColor=new H.c(1,1,1),this.emissiveColor=new H.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,o.d)(this.va())}getClassName(){return"PBRMaterial"}clone(U){let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const a=i.d.Clone((()=>new Y(U,this.va())),this,{cloneTexturesOnlyOnce:M});return a.id=U,a.name=U,this.stencil.copyTo(a.stencil),this._clonePlugins(a,b),a}serialize(){const U=super.serialize();return U.customType="BABYLON.PBRMaterial",U}static Parse(U,M,b){const a=i.d.Parse((()=>new Y(U.name,M)),U,M,b);return U.stencil&&a.stencil.parse(U.stencil,M,b),f.c._ParsePlugins(U,a,M,b),U.clearCoat&&a.clearCoat.parse(U.clearCoat,M,b),U.anisotropy&&a.anisotropy.parse(U.anisotropy,M,b),U.brdf&&a.brdf.parse(U.brdf,M,b),U.sheen&&a.sheen.parse(U.sheen,M,b),U.subSurface&&a.subSurface.parse(U.subSurface,M,b),U.iridescence&&a.iridescence.parse(U.iridescence,M,b),a}}Y.PBRMATERIAL_OPAQUE=S.e.PBRMATERIAL_OPAQUE,Y.PBRMATERIAL_ALPHATEST=S.e.PBRMATERIAL_ALPHATEST,Y.PBRMATERIAL_ALPHABLEND=S.e.PBRMATERIAL_ALPHABLEND,Y.PBRMATERIAL_ALPHATESTANDBLEND=S.e.PBRMATERIAL_ALPHATESTANDBLEND,Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=S.e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"directIntensity",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"emissiveIntensity",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"environmentIntensity",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"specularIntensity",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"disableBumpMap",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"albedoTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseWeightTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseDiffuseRoughnessTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientTexture",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientTextureStrength",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"opacityTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectionTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"emissiveTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectivityTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicTexture",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallic",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"roughness",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicF0Factor",void 0),(0,L.c)([(0,z.j)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicReflectanceColor",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"metallicReflectanceTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectanceTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"microSurfaceTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"bumpTexture",void 0),(0,L.c)([(0,z.A)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty",null)],Y.prototype,"lightmapTexture",void 0),(0,L.c)([(0,z.j)("ambient"),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"ambientColor",void 0),(0,L.c)([(0,z.j)("albedo"),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"albedoColor",void 0),(0,L.c)([(0,z.J)("baseWeight"),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseWeight",void 0),(0,L.c)([(0,z.J)("baseDiffuseRoughness"),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"baseDiffuseRoughness",void 0),(0,L.c)([(0,z.j)("reflectivity"),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectivityColor",void 0),(0,L.c)([(0,z.j)("reflection"),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"reflectionColor",void 0),(0,L.c)([(0,z.j)("emissive"),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"emissiveColor",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"microSurface",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useLightmapAsShadowmap",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"useAlphaFromAlbedoTexture",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"forceAlphaTest",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],Y.prototype,"alphaCutOff",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useSpecularOverAlpha",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAmbientInGrayScale",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,L.c)([(0,z.J)()],Y.prototype,"usePhysicalLightFalloff",null),(0,L.c)([(0,z.J)()],Y.prototype,"useGLTFLightFalloff",null),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRadianceOverAlpha",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useObjectSpaceNormalMap",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useParallax",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useParallaxOcclusion",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"parallaxScaleBias",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"disableLighting",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"forceIrradianceInFragment",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsLightsDirty")],Y.prototype,"maxSimultaneousLights",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"invertNormalMapX",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"invertNormalMapY",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"twoSidedLighting",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useAlphaFresnel",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useLinearAlphaFresnel",void 0),(0,L.c)([(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"environmentBRDFTexture",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"forceNormalForward",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"enableSpecularAntiAliasing",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useHorizonOcclusion",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"useRadianceOcclusion",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"unlit",void 0),(0,L.c)([(0,z.J)(),(0,z.c)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"applyDecalMapAfterDetailMap",void 0),(0,h.i)("BABYLON.PBRMaterial",Y);var d=b(2371),s=b(792),q=b(729),m=b(779),n=b(788),E=b(470);class X{get influence(){return this._influence}set influence(U){if(this._influence===U)return;const M=this._influence;this._influence=U,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===M||0===U)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(U){this._animationPropertiesOverride=U}constructor(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=U,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new x.e,this._onDataLayoutChanged=new x.e,this._animationPropertiesOverride=null,this.id=U,this._scene=b||r.d.LastCreatedScene,this.influence=M,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(U){const M=this.hasPositions;this._positions=U,M!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(U){const M=this.hasNormals;this._normals=U,M!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(U){const M=this.hasTangents;this._tangents=U,M!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(U){const M=this.hasUVs;this._uvs=U,M!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(U){const M=this.hasUV2s;this._uv2s=U,M!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(U){const M=this.hasColors;this._colors=U,M!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const U=i.d.Clone((()=>new X(this.name,this.influence,this._scene)),this);return U._positions=this._positions,U._normals=this._normals,U._tangents=this._tangents,U._uvs=this._uvs,U._uv2s=this._uv2s,U._colors=this._colors,U}serialize(){const U={};return U.name=this.name,U.influence=this.influence,U.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(U.id=this.id),this.hasNormals&&(U.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(U.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(U.Aa=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(U.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(U.za=Array.prototype.slice.call(this.getColors())),i.d.AppendSerializedAnimations(this,U),U}getClassName(){return"MorphTarget"}static Parse(U,M){const b=new X(U.name,U.influence);if(b.setPositions(U.xa),null!=U.id&&(b.id=U.id),U.ya&&b.setNormals(U.ya),U.tangents&&b.setTangents(U.tangents),U.Aa&&b.setUVs(U.Aa),U.uv2s&&b.setUV2s(U.uv2s),U.za&&b.setColors(U.za),U.animations){for(let M=0;M<U.animations.length;M++){const a=U.animations[M],A=(0,h.e)("BABYLON.Animation");A&&b.animations.push(A.Parse(a))}U.autoAnimate&&M&&M.beginAnimation(b,U.autoAnimateFrom,U.autoAnimateTo,U.autoAnimateLoop,U.autoAnimateSpeed||1)}return b}static FromMesh(U,M,b){M||(M=U.name);const a=new X(M,b,U.va());return a.setPositions(U.getVerticesData(q.e.PositionKind)),U.isVerticesDataPresent(q.e.NormalKind)&&a.setNormals(U.getVerticesData(q.e.NormalKind)),U.isVerticesDataPresent(q.e.TangentKind)&&a.setTangents(U.getVerticesData(q.e.TangentKind)),U.isVerticesDataPresent(q.e.UVKind)&&a.setUVs(U.getVerticesData(q.e.UVKind)),U.isVerticesDataPresent(q.e.UV2Kind)&&a.setUV2s(U.getVerticesData(q.e.UV2Kind)),U.isVerticesDataPresent(q.e.ColorKind)&&a.setColors(U.getVerticesData(q.e.ColorKind)),a}}(0,L.c)([(0,z.J)()],X.prototype,"id",void 0);var Q=b(661),I=b(12580);class v{set areUpdatesFrozen(U){U?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Q.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,U||(U=r.d.LastCreatedScene),this._scene=U,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const U=this._scene.getEngine().getCaps();this._canUseTextureForTargets=U.canUseGLVertexID&&U.textureFloat&&U.maxVertexTextureImageUnits>0&&U.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return v.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?v.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(U){this._numMaxInfluencers!==U&&(this._numMaxInfluencers=U,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(U){this._useTextureToStoreTargets!==U&&(this._useTextureToStoreTargets=U,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var U;return v.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(U=this._scene)&&void 0!==U&&U.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(U){return this._activeTargets.data[U]}getTarget(U){return this._targets[U]}getTargetByName(U){for(const M of this._targets)if(M.name===U)return M;return null}addTarget(U){this._targets.push(U),this._targetInfluenceChangedObservers.push(U.onInfluenceChanged.add((U=>{this.areUpdatesFrozen&&U&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(U)}))),this._targetDataLayoutChangedObservers.push(U._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(U){const M=this._targets.indexOf(U);M>=0&&(this._targets.splice(M,1),U.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(M,1)[0]),U._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(M,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(U)}_bind(U){U.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),U.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),U.setTexture("morphTargets",this._targetStoreTexture),U.setInt("morphTargetCount",this.numInfluencers)}clone(){const U=new v(this._scene);for(const M of this._targets)U.addTarget(M.clone());return U.enablePositionMorphing=this.enablePositionMorphing,U.enableNormalMorphing=this.enableNormalMorphing,U.enableTangentMorphing=this.enableTangentMorphing,U.enableUVMorphing=this.enableUVMorphing,U.enableUV2Morphing=this.enableUV2Morphing,U.enableColorMorphing=this.enableColorMorphing,U}serialize(){const U={};U.id=this.uniqueId,U.targets=[];for(const M of this._targets)U.targets.push(M.serialize());return U}_syncActiveTargets(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const M=!!this._targetStoreTexture,b=this.isUsingTextureForTargets;(this._mustSynchronize||M!==b)&&(this._mustSynchronize=!1,this.synchronize());let a=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let A=-1;for(const H of this._targets)if(A++,0!==H.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=v.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(H),this._morphTargetTextureIndices[a]=A,this._tempInfluences[a++]=H.influence}this._morphTargetTextureIndices.length!==a&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,a)),this._influences&&this._influences.length===a||(this._influences=new Float32Array(a));for(let H=0;H<a;H++)this._influences[H]=this._tempInfluences[H];if(U&&this._scene)for(const H of this._scene.meshes)H.morphTargetManager===this&&(b?H._markSubMeshesAsAttributesDirty():H._syncGeometryWithMorphTargetManager())}synchronize(){var U;if(!this._scene||this.areUpdatesFrozen)return;const M=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(U=this._targetStoreTexture)||void 0===U||U.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>M.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const b of this._targets){this._supportsPositions=this._supportsPositions&&b.hasPositions,this._supportsNormals=this._supportsNormals&&b.hasNormals,this._supportsTangents=this._supportsTangents&&b.hasTangents,this._supportsUVs=this._supportsUVs&&b.hasUVs,this._supportsUV2s=this._supportsUV2s&&b.hasUV2s,this._supportsColors=this._supportsColors&&b.hasColors;const U=b.vertexCount;if(0===this._vertexCount)this._vertexCount=U;else if(this._vertexCount!==U)return void B.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${b.name}": ${U}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const U=M.getCaps().maxTextureSize;this._textureWidth>U&&(this._textureHeight=Math.ceil(this._textureWidth/U),this._textureWidth=U);const b=this._targets.length,a=new Float32Array(b*this._textureWidth*this._textureHeight*4);let A=0;for(let M=0;M<b;M++){const U=this._targets[M],b=U.getPositions(),H=U.getNormals(),W=U.getUVs(),y=U.getTangents(),O=U.getUV2s(),e=U.getColors();A=M*this._textureWidth*this._textureHeight*4;for(let M=0;M<this._vertexCount;M++)this._supportsPositions&&b&&(a[A]=b[3*M],a[A+1]=b[3*M+1],a[A+2]=b[3*M+2],A+=4),this._supportsNormals&&H&&(a[A]=H[3*M],a[A+1]=H[3*M+1],a[A+2]=H[3*M+2],A+=4),this._supportsUVs&&W&&(a[A]=W[2*M],a[A+1]=W[2*M+1],A+=4),this._supportsTangents&&y&&(a[A]=y[3*M],a[A+1]=y[3*M+1],a[A+2]=y[3*M+2],A+=4),this._supportsUV2s&&O&&(a[A]=O[2*M],a[A+1]=O[2*M+1],A+=4),this._supportsColors&&e&&(a[A]=e[4*M],a[A+1]=e[4*M+1],a[A+2]=e[4*M+2],a[A+3]=e[4*M+3],A+=4)}this._targetStoreTexture=I.e.CreateRGBATexture(a,this._textureWidth,this._textureHeight,b,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const b of this._scene.meshes)b.morphTargetManager===this&&b._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const U=this._parentContainer.morphTargetManagers.indexOf(this);U>-1&&this._parentContainer.morphTargetManagers.splice(U,1),this._parentContainer=null}for(const U of this._targets)this._scene.stopAnimation(U)}}static Parse(U,M){const b=new v(M);for(const a of U.targets)b.addTarget(X.Parse(a,M));return b}}v.EnableTextureStorage=!0,v.MaxActiveMorphTargetsInVertexAttributeMode=8,v.ConstantTargetCountForTextureMode=0;var t=b(12658),V=b(531),k=b(754);const N=new Map,R=N;function j(U,M,b){p(U)&&B.b.Warn(`Extension with the name '${U}' already exists`),N.set(U,{isGLTFExtension:M,factory:b})}function p(U){return N.delete(U)}var g=b(12688);function K(){const U=U=>!!U&&"object"===typeof U;for(var M=arguments.length,b=new Array(M),a=0;a<M;a++)b[a]=arguments[a];return b.reduce(((M,b)=>{const a=Object.keys(b);for(const A of a){const a=M[A],H=b[A];Array.isArray(a)&&Array.isArray(H)?M[A]=a.concat(...H):U(a)&&U(H)?M[A]=K(a,H):M[A]=H}return M}),{})}var w=b(737);class T{static Get(U,M,b){if(!M||void 0==b||!M[b])throw new Error(`${U}: Failed to find index (${b})`);return M[b]}static TryGet(U,M){return U&&void 0!=M&&U[M]?U[M]:null}static Assign(U){if(U)for(let M=0;M<U.length;M++)U[M].index=M}}function G(U){if(U.min&&U.max){const M=U.min,b=U.max,a=A.g.lk[0].vd(M[0],M[1],M[2]),H=A.g.lk[1].vd(b[0],b[1],b[2]);if(U.normalized&&5126!==U.componentType){let M=1;switch(U.componentType){case 5120:M=127;break;case 5121:M=255;break;case 5122:M=32767;break;case 5123:M=65535}const b=1/M;a.scaleInPlace(b),H.scaleInPlace(b)}return new k.b(a,H)}return null}class l{static RegisterExtension(U,M){j(U,!1,M)}static UnregisterExtension(U){return p(U)}get Wk(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(U){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=U}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((U=>U.dispose&&U.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(U,M,b,a,A,H){let W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=M,this._assetContainer=b,this._loadData(a);let H=null;if(U){const M={};if(this._gltf.nodes)for(const U of this._gltf.nodes)U.name&&(M[U.name]=U.index);H=(U instanceof Array?U:[U]).map((U=>{const b=M[U];if(void 0===b)throw new Error(`Failed to find node '${U}'`);return b}))}return await this._loadAsync(A,W,H,(()=>({meshes:this._getMeshes(),Ik:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(U,M,b,a){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=U,this._loadData(M),await this._loadAsync(b,A,null,(()=>{}))}async _loadAsync(U,M,b,a){return await Promise.resolve().then((async()=>{this._rootUrl=U,this._uniqueRootUrl=!U.startsWith("file:")&&M?U:`${U}${Date.now()}/`,this._fileName=M,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const A=`${t.m[t.m.LOADING]} => ${t.m[t.m.READY]}`,H=`${t.m[t.m.LOADING]} => ${t.m[t.m.COMPLETE]}`;this._parent._startPerformanceCounter(A),this._parent._startPerformanceCounter(H),this._parent._setState(t.m.LOADING),this._extensionsOnLoading();const y=new Array;if(!this.parent.loadOnlyMaterials)if(b)y.push(this.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=this._gltf.$e||this._gltf.scenes&&this._gltf.scenes[0]){const U=T.Get("/scene",this._gltf.scenes,this._gltf.$e||0);y.push(this.loadSceneAsync(`/scenes/${U.index}`,U))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let U=0;U<this._gltf.materials.length;++U){const M=this._gltf.materials[U],b="/materials/"+U,a=f.c.TriangleFillMode;y.push(this._loadMaterialAsync(b,M,null,a,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&y.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&y.push(this._compileShadowGeneratorsAsync());const O=Promise.all(y).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Kc(!0);for(const U of this._babylonScene.materials){const M=U;void 0!==M.maxSimultaneousLights&&(M.maxSimultaneousLights=Math.max(M.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(t.m.READY),this._skipStartAnimationStep||this._startAnimations(),a()}));return await O.then((U=>(this._parent._endPerformanceCounter(A),W.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(H),this._parent._setState(t.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(U=>{this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()}))})),U)))})).catch((U=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()),U}))}_loadData(U){if(this._gltf=U.json,this._setupData(),U.bin){const M=this._gltf.buffers;if(M&&M[0]&&!M[0].uri){const b=M[0];(b.byteLength<U.bin.byteLength-3||b.byteLength>U.bin.byteLength)&&B.b.Warn(`Binary buffer length (${b.byteLength}) from JSON does not match chunk length (${U.bin.byteLength})`),this._bin=U.bin}else B.b.Warn("Unexpected BIN chunk")}}_setupData(){if(T.Assign(this._gltf.accessors),T.Assign(this._gltf.animations),T.Assign(this._gltf.buffers),T.Assign(this._gltf.bufferViews),T.Assign(this._gltf.cameras),T.Assign(this._gltf.images),T.Assign(this._gltf.materials),T.Assign(this._gltf.meshes),T.Assign(this._gltf.nodes),T.Assign(this._gltf.samplers),T.Assign(this._gltf.scenes),T.Assign(this._gltf.skins),T.Assign(this._gltf.textures),this._gltf.nodes){const U={};for(const b of this._gltf.nodes)if(b.children)for(const M of b.children)U[M]=b.index;const M=this._createRootNode();for(const b of this._gltf.nodes){const a=U[b.index];b.parent=void 0===a?M:this._gltf.nodes[a]}}}async _loadExtensionsAsync(){const U=[];if(R.forEach(((M,b)=>{var a;!1===(null===(a=this.parent.extensionOptions[b])||void 0===a?void 0:a.enabled)?M.isGLTFExtension&&this.isExtensionUsed(b)&&B.b.Warn(`Extension ${b} is used but has been explicitly disabled.`):M.isGLTFExtension&&!this.isExtensionUsed(b)||U.push((async()=>{const U=await M.factory(this);return U.name!==b&&B.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${U.name} !== ${b}`),this._parent.onExtensionLoadedObservable.notifyObservers(U),U})())})),this._extensions.push(...await Promise.all(U)),this._extensions.sort(((U,M)=>(U.order||Number.MAX_VALUE)-(M.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const b of this._gltf.extensionsRequired){if(!this._extensions.some((U=>U.name===b&&U.enabled))){var M;if(!1===(null===(M=this.parent.extensionOptions[b])||void 0===M?void 0:M.enabled))throw new Error(`Required extension ${b} is disabled`);throw new Error(`Required extension ${b} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new E.c("__root__",this._babylonScene);this._rootBabylonMesh=U,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Kc(!1);const M={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case t.i.AUTO:this._babylonScene.useRightHandedSystem||(M.rotation=[0,1,0,0],M.scale=[1,1,-1],l._LoadTransform(M,this._rootBabylonMesh));break;case t.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(U),M}loadSceneAsync(U,M){const b=this._extensionsLoadSceneAsync(U,M);if(b)return b;const a=new Array;if(this.logOpen(`${U} ${M.name||""}`),M.nodes)for(const A of M.nodes){const M=T.Get(`${U}/nodes/${A}`,this._gltf.nodes,A);a.push(this.loadNodeAsync(`/nodes/${M.index}`,M,(U=>{U.parent=this._rootBabylonMesh})))}for(const A of this._postSceneLoadActions)A();return a.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(a).then((()=>{}))}_forEachPrimitive(U,M){if(U._primitiveBabylonMeshes)for(const b of U._primitiveBabylonMeshes)M(b)}_getGeometries(){const U=[],M=this._gltf.nodes;if(M)for(const b of M)this._forEachPrimitive(b,(M=>{const b=M.yk;b&&-1===U.indexOf(b)&&U.push(b)}));return U}_getMeshes(){const U=[];this._rootBabylonMesh instanceof n.e&&U.push(this._rootBabylonMesh);const M=this._gltf.nodes;if(M)for(const b of M)this._forEachPrimitive(b,(M=>{U.push(M)}));return U}_getTransformNodes(){const U=[],M=this._gltf.nodes;if(M)for(const b of M)b._babylonTransformNode&&"Vk"===b._babylonTransformNode.getClassName()&&U.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&U.push(b._babylonTransformNodeForSkin);return U}_getSkeletons(){const U=[],M=this._gltf.skins;if(M)for(const b of M)b._data&&U.push(b._data.babylonSkeleton);return U}_getAnimationGroups(){const U=[],M=this._gltf.animations;if(M)for(const b of M)b._babylonAnimationGroup&&U.push(b._babylonAnimationGroup);return U}_startAnimations(){switch(this._parent.animationStartMode){case t.h.NONE:break;case t.h.FIRST:{const U=this._getAnimationGroups();0!==U.length&&U[0].start(!0);break}case t.h.ALL:{const U=this._getAnimationGroups();for(const M of U)M.start(!0);break}default:return void B.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadNodeAsync(U,M,b);if(a)return a;if(M._babylonTransformNode)throw new Error(`${U}: Invalid recursive node hierarchy`);const A=new Array;this.logOpen(`${U} ${M.name||""}`);const H=a=>{if(l.AddPointerMetadata(a,U),l._LoadTransform(M,a),void 0!=M.camera){const b=T.Get(`${U}/camera`,this._gltf.cameras,M.camera);A.push(this.loadCameraAsync(`/cameras/${b.index}`,b,(U=>{U.parent=a,this._babylonScene.useRightHandedSystem||(a.zd.x=-1)})))}if(M.children)for(const b of M.children){const M=T.Get(`${U}/children/${b}`,this._gltf.nodes,b);A.push(this.loadNodeAsync(`/nodes/${M.index}`,M,(U=>{U.parent=a})))}b(a)},W=void 0!=M.mesh,y=this._parent.loadSkins&&void 0!=M.skin;if(!W||y){const U=M.name||`node${M.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new s.c(U,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==M.mesh?M._babylonTransformNode=b:M._babylonTransformNodeForSkin=b,H(b)}if(W)if(y){const b=T.Get(`${U}/mesh`,this._gltf.meshes,M.mesh);A.push(this._loadMeshAsync(`/meshes/${b.index}`,M,b,(b=>{const a=M._babylonTransformNodeForSkin;b.metadata=K(a.metadata,b.metadata||{});const H=T.Get(`${U}/skin`,this._gltf.skins,M.skin);A.push(this._loadSkinAsync(`/skins/${H.index}`,M,H,(U=>{this._forEachPrimitive(M,(M=>{M.skeleton=U})),this._postSceneLoadActions.push((()=>{if(void 0!=H.skeleton){const U=T.Get(`/skins/${H.index}/skeleton`,this._gltf.nodes,H.skeleton).parent;M.index===U.index?b.parent=a.parent:b.parent=U._babylonTransformNode}else b.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:a,skinnedNode:b})}))})))})))}else{const b=T.Get(`${U}/mesh`,this._gltf.meshes,M.mesh);A.push(this._loadMeshAsync(`/meshes/${b.index}`,M,b,H))}return this.logClose(),Promise.all(A).then((()=>(this._forEachPrimitive(M,(U=>{const M=U;!M.isAnInstance&&M.yk&&M.yk.useBoundingInfoFromGeometry?U.Ea():U.refreshBoundingInfo(!0,!0)})),M._babylonTransformNode)))}_loadMeshAsync(U,M,b,a){const A=b.primitives;if(!A||!A.length)throw new Error(`${U}: Primitives are missing`);void 0==A[0].index&&T.Assign(A);const H=new Array;this.logOpen(`${U} ${b.name||""}`);const W=M.name||`node${M.index}`;if(1===A.length){const a=b.primitives[0];H.push(this._loadMeshPrimitiveAsync(`${U}/primitives/${a.index}`,W,M,b,a,(U=>{M._babylonTransformNode=U,M._primitiveBabylonMeshes=[U]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,M._babylonTransformNode=new s.c(W,this._babylonScene),M._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M._primitiveBabylonMeshes=[];for(const a of A)H.push(this._loadMeshPrimitiveAsync(`${U}/primitives/${a.index}`,`${W}_primitive${a.index}`,M,b,a,(U=>{U.parent=M._babylonTransformNode,M._primitiveBabylonMeshes.push(U)})))}return a(M._babylonTransformNode),this.logClose(),Promise.all(H).then((()=>M._babylonTransformNode))}_loadMeshPrimitiveAsync(U,M,b,a,A,H){const W=this._extensionsLoadMeshPrimitiveAsync(U,M,b,a,A,H);if(W)return W;this.logOpen(`${U}`);const y=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==b.skin&&!a.primitives[0].targets;let O,e;if(y&&A._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,O=A._instanceData.babylonSourceMesh.createInstance(M),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e=A._instanceData.promise;else{const H=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new E.c(M,this._babylonScene);W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.sideOrientation=this._babylonScene.useRightHandedSystem?f.c.CounterClockWiseSideOrientation:f.c.ClockWiseSideOrientation,this._createMorphTargets(U,b,a,A,W),H.push(this._loadVertexDataAsync(U,A,W).then((async M=>await this._loadMorphTargetsAsync(U,A,W,M).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,M.Ca(W),M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const x=l._GetDrawMode(U,A.mode);if(void 0==A.material){let U=this._defaultBabylonMaterialData[x];U||(U=this._createDefaultMaterial("__GLTFLoader._default",x),this._parent.onMaterialLoadedObservable.notifyObservers(U),this._defaultBabylonMaterialData[x]=U),W.material=U}else if(!this.parent.skipMaterials){const M=T.Get(`${U}/material`,this._gltf.materials,A.material);H.push(this._loadMaterialAsync(`/materials/${M.index}`,M,W,x,(U=>{W.material=U})))}e=Promise.all(H),y&&(A._instanceData={babylonSourceMesh:W,promise:e}),O=W}return l.AddPointerMetadata(O,U),this._parent.onMeshLoadedObservable.notifyObservers(O),H(O),this.logClose(),e.then((()=>O))}_loadVertexDataAsync(U,M,b){const a=this._extensionsLoadVertexDataAsync(U,M,b);if(a)return a;const A=M.attributes;if(!A)throw new Error(`${U}: Attributes are missing`);const H=new Array,W=new m.e(b.name,this._babylonScene);if(void 0==M.indices)b.isUnIndexed=!0;else{const b=T.Get(`${U}/indices`,this._gltf.accessors,M.indices);H.push(this._loadIndicesAccessorAsync(`/accessors/${b.index}`,b).then((U=>{W.setIndices(U)})))}const y=(M,a,y)=>{if(void 0==A[M])return;b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(a)&&b._delayInfo.push(a);const O=T.Get(`${U}/attributes/${M}`,this._gltf.accessors,A[M]);H.push(this._loadVertexAccessorAsync(`/accessors/${O.index}`,O,a).then((U=>{if(U.getKind()===q.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!b.skeleton){const U=G(O);U&&(W._boundingInfo=U,W.useBoundingInfoFromGeometry=!0)}W.setVerticesBuffer(U,O.count)}))),a==q.e.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),y&&y(O)};return y("POSITION",q.e.PositionKind),y("NORMAL",q.e.NormalKind),y("TANGENT",q.e.TangentKind),y("TEXCOORD_0",q.e.UVKind),y("TEXCOORD_1",q.e.UV2Kind),y("TEXCOORD_2",q.e.UV3Kind),y("TEXCOORD_3",q.e.UV4Kind),y("TEXCOORD_4",q.e.UV5Kind),y("TEXCOORD_5",q.e.UV6Kind),y("JOINTS_0",q.e.MatricesIndicesKind),y("WEIGHTS_0",q.e.MatricesWeightsKind),y("JOINTS_1",q.e.MatricesIndicesExtraKind),y("WEIGHTS_1",q.e.MatricesWeightsExtraKind),y("COLOR_0",q.e.ColorKind,(U=>{"VEC4"===U.type&&(b.hasVertexAlpha=!0)})),Promise.all(H).then((()=>W))}_createMorphTargets(U,M,b,a,A){if(!a.targets||!this._parent.loadMorphTargets)return;if(void 0==M._numMorphTargets)M._numMorphTargets=a.targets.length;else if(a.targets.length!==M._numMorphTargets)throw new Error(`${U}: Primitives do not have the same number of targets`);const H=b.extras?b.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,A.morphTargetManager=new v(this._babylonScene),A.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.morphTargetManager.areUpdatesFrozen=!0;for(let W=0;W<a.targets.length;W++){const U=M.weights?M.weights[W]:b.weights?b.weights[W]:0,a=H?H[W]:`morphTarget${W}`;A.morphTargetManager.addTarget(new X(a,U,A.va()))}}_loadMorphTargetsAsync(U,M,b,a){if(!M.targets||!this._parent.loadMorphTargets)return Promise.resolve();const A=new Array,H=b.morphTargetManager;for(let W=0;W<H.numTargets;W++){const b=H.getTarget(W);A.push(this._loadMorphTargetVertexDataAsync(`${U}/targets/${W}`,a,M.targets[W],b))}return Promise.all(A).then((()=>{H.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(U,M,b,a){const A=new Array,H=(a,H,W)=>{if(void 0==b[a])return;const y=M.getVertexBuffer(H);if(!y)return;const O=T.Get(`${U}/${a}`,this._gltf.accessors,b[a]);A.push(this._loadFloatAccessorAsync(`/accessors/${O.index}`,O).then((U=>{W(y,U)})))};return H("POSITION",q.e.PositionKind,((U,M)=>{const b=new Float32Array(M.length);U.forEach(M.length,((U,a)=>{b[a]=M[a]+U})),a.setPositions(b)})),H("NORMAL",q.e.NormalKind,((U,M)=>{const b=new Float32Array(M.length);U.forEach(b.length,((U,a)=>{b[a]=M[a]+U})),a.setNormals(b)})),H("TANGENT",q.e.TangentKind,((U,M)=>{const b=new Float32Array(M.length/3*4);let A=0;U.forEach(M.length/3*4,((U,a)=>{(a+1)%4!==0&&(b[A]=M[A]+U,A++)})),a.setTangents(b)})),H("TEXCOORD_0",q.e.UVKind,((U,M)=>{const b=new Float32Array(M.length);U.forEach(M.length,((U,a)=>{b[a]=M[a]+U})),a.setUVs(b)})),H("TEXCOORD_1",q.e.UV2Kind,((U,M)=>{const b=new Float32Array(M.length);U.forEach(M.length,((U,a)=>{b[a]=M[a]+U})),a.setUV2s(b)})),H("COLOR_0",q.e.ColorKind,((M,b)=>{let A=null;const H=M.getSize();if(3===H){A=new Float32Array(b.length/3*4),M.forEach(b.length,((U,M)=>{const a=Math.floor(M/3),H=M%3;A[4*a+H]=b[3*a+H]+U}));for(let U=0;U<b.length/3;++U)A[4*U+3]=1}else{if(4!==H)throw new Error(`${U}: Invalid number of components (${H}) for COLOR_0 attribute`);A=new Float32Array(b.length),M.forEach(b.length,((U,M)=>{A[M]=b[M]+U}))}a.setColors(A)})),await Promise.all(A).then((()=>{}))}static _LoadTransform(U,M){if(void 0!=U.skin)return;let b=A.l.Zero(),a=A.e.Identity(),H=A.l.One();if(U.matrix){A.b.jk(U.matrix).decompose(H,a,b)}else U.translation&&(b=A.l.jk(U.translation)),U.rotation&&(a=A.e.jk(U.rotation)),U.scale&&(H=A.l.jk(U.scale));M.position=b,M.rotationQuaternion=a,M.zd=H}_loadSkinAsync(U,M,b,a){if(!this._parent.loadSkins)return Promise.resolve();const A=this._extensionsLoadSkinAsync(U,M,b);if(A)return A;if(b._data)return a(b._data.babylonSkeleton),b._data.promise;const H=`skeleton${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new F(b.name||H,H,this._babylonScene);W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(U,b,W);const y=this._loadSkinInverseBindMatricesDataAsync(U,b).then((U=>{this._updateBoneMatrices(W,U)}));return b._data={babylonSkeleton:W,promise:y},a(W),y}_loadBones(U,M,b){if(void 0==M.skeleton||this._parent.alwaysComputeSkeletonRootNode){const b=this._findSkeletonRootNode(`${U}/joints`,M.joints);if(b)if(void 0===M.skeleton)M.skeleton=b.index;else{const a=(U,M)=>{for(;M.parent;M=M.parent)if(M.parent===U)return!0;return!1},A=T.Get(`${U}/skeleton`,this._gltf.nodes,M.skeleton);A===b||a(A,b)||(B.b.Warn(`${U}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),M.skeleton=b.index)}else B.b.Warn(`${U}: Failed to find common root`)}const a={};for(const A of M.joints){const H=T.Get(`${U}/joints/${A}`,this._gltf.nodes,A);this._loadBone(H,M,b,a)}}_findSkeletonRootNode(U,M){if(0===M.length)return null;const b={};for(const A of M){const M=[];let a=T.Get(`${U}/${A}`,this._gltf.nodes,A);for(;-1!==a.index;)M.unshift(a),a=a.parent;b[A]=M}let a=null;for(let A=0;;++A){let U=b[M[0]];if(A>=U.length)return a;const H=U[A];for(let W=1;W<M.length;++W)if(U=b[M[W]],A>=U.length||H!==U[A])return a;a=H}}_loadBone(U,M,b,a){U._isJoint=!0;let A=a[U.index];if(A)return A;let H=null;U.index!==M.skeleton&&(U.parent&&-1!==U.parent.index?H=this._loadBone(U.parent,M,b,a):void 0!==M.skeleton&&B.b.Warn(`/skins/${M.index}/skeleton: Skeleton node is not a common root`));const W=M.joints.indexOf(U.index);return A=new e.d(U.name||`joint${U.index}`,b,H,this._getNodeMatrix(U),null,null,W),a[U.index]=A,this._postSceneLoadActions.push((()=>{A.linkTransformNode(U._babylonTransformNode)})),A}_loadSkinInverseBindMatricesDataAsync(U,M){if(void 0==M.inverseBindMatrices)return Promise.resolve(null);const b=T.Get(`${U}/inverseBindMatrices`,this._gltf.accessors,M.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)}_updateBoneMatrices(U,M){for(const b of U.bones){const U=A.b.Identity(),a=b._index;M&&-1!==a&&(A.b.FromArrayToRef(M,16*a,U),U.invertToRef(U));const H=b.getParent();H&&U.multiplyToRef(H.getAbsoluteInverseBindMatrix(),U),b.zk(U,!1,!1),b._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(U){return U.matrix?A.b.jk(U.matrix):A.b.Compose(U.scale?A.l.jk(U.scale):A.l.One(),U.rotation?A.e.jk(U.rotation):A.e.Identity(),U.translation?A.l.jk(U.translation):A.l.Zero())}loadCameraAsync(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadCameraAsync(U,M,b);if(a)return a;const H=new Array;this.logOpen(`${U} ${M.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new O.c(M.name||`camera${M.index}`,A.l.Zero(),this._babylonScene,!1);switch(W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M._babylonCamera=W,W.setTarget(new A.l(0,0,-1)),M.type){case"perspective":{const b=M.perspective;if(!b)throw new Error(`${U}: Camera perspective properties are missing`);W.fov=b.yfov,W.ek=b.znear,W.maxZ=b.zfar||0;break}case"orthographic":if(!M.orthographic)throw new Error(`${U}: Camera orthographic properties are missing`);W.mode=y.c.ORTHOGRAPHIC_CAMERA,W.orthoLeft=-M.orthographic.xmag,W.orthoRight=M.orthographic.xmag,W.orthoBottom=-M.orthographic.ymag,W.orthoTop=M.orthographic.ymag,W.ek=M.orthographic.znear,W.maxZ=M.orthographic.zfar;break;default:throw new Error(`${U}: Invalid camera type (${M.type})`)}return l.AddPointerMetadata(W,U),this._parent.onCameraLoadedObservable.notifyObservers(W),b(W),this.logClose(),Promise.all(H).then((()=>W))}_loadAnimationsAsync(){const U=this._gltf.animations;if(!U)return Promise.resolve();const M=new Array;for(let b=0;b<U.length;b++){const a=U[b];M.push(this.loadAnimationAsync(`/animations/${a.index}`,a).then((U=>{0===U.targetedAnimations.length&&U.dispose()})))}return Promise.all(M).then((()=>{}))}loadAnimationAsync(U,M){const a=this._extensionsLoadAnimationAsync(U,M);return a||b.e(49).then(b.bind(b,13892)).then((b=>{let{AnimationGroup:a}=b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new a(M.name||`animation${M.index}`,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M._babylonAnimationGroup=A;const H=new Array;T.Assign(M.channels),T.Assign(M.samplers);for(const W of M.channels)H.push(this._loadAnimationChannelAsync(`${U}/channels/${W.index}`,U,M,W,((U,M)=>{U.animations=U.animations||[],U.animations.push(M),A.addTargetedAnimation(M,U)})));return Promise.all(H).then((()=>(A.normalize(0),A)))}))}async _loadAnimationChannelAsync(U,M,a,A,H){const W=this._extensionsLoadAnimationChannelAsync(U,M,a,A,H);if(W)return await W;if(void 0==A.target.node)return await Promise.resolve();const y=T.Get(`${U}/target/node`,this._gltf.nodes,A.target.node),O=A.target.path,e="weights"===O;if(e&&!y._numMorphTargets||!e&&!y._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!e&&!y._isJoint)return await Promise.resolve();let x;switch(await Promise.resolve().then(b.bind(b,12716)),O){case"translation":var P;x=null===(P=(0,g.f)("/nodes/{}/translation"))||void 0===P?void 0:P.interpolation;break;case"rotation":var Z;x=null===(Z=(0,g.f)("/nodes/{}/rotation"))||void 0===Z?void 0:Z.interpolation;break;case"scale":var C;x=null===(C=(0,g.f)("/nodes/{}/scale"))||void 0===C?void 0:C.interpolation;break;case"weights":var r;x=null===(r=(0,g.f)("/nodes/{}/weights"))||void 0===r?void 0:r.interpolation;break;default:throw new Error(`${U}/target/path: Invalid value (${A.target.path})`)}if(!x)throw new Error(`${U}/target/path: Could not find interpolation properties for target path (${A.target.path})`);const B={object:y,info:x};return await this._loadAnimationChannelFromTargetInfoAsync(U,M,a,A,B,H)}_loadAnimationChannelFromTargetInfoAsync(U,M,b,a,A,H){const W=this.parent.targetFps,y=1/W,O=T.Get(`${U}/sampler`,b.samplers,a.sampler);return this._loadAnimationSamplerAsync(`${M}/samplers/${a.sampler}`,O).then((U=>{let M=0;const O=A.object,e=A.info;for(const A of e){const e=A.getStride(O),x=U.input,P=U.output,Z=new Array(x.length);let C=0;switch(U.interpolation){case"STEP":for(let U=0;U<x.length;U++){const M=A.getValue(O,P,C,1);C+=e,Z[U]={frame:x[U]*W,value:M,interpolation:1}}break;case"CUBICSPLINE":for(let U=0;U<x.length;U++){const M=A.getValue(O,P,C,y);C+=e;const b=A.getValue(O,P,C,1);C+=e;const a=A.getValue(O,P,C,y);C+=e,Z[U]={frame:x[U]*W,inTangent:M,value:b,outTangent:a}}break;case"LINEAR":for(let U=0;U<x.length;U++){const M=A.getValue(O,P,C,1);C+=e,Z[U]={frame:x[U]*W,value:M}}}if(C>0){const U=`${b.name||`animation${b.index}`}_channel${a.index}_${M}`,y=A.buildAnimations(O,U,W,Z);for(const b of y)M++,H(b.babylonAnimatable,b.babylonAnimation)}}}))}_loadAnimationSamplerAsync(U,M){if(M._data)return M._data;const b=M.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${U}/interpolation: Invalid value (${M.interpolation})`)}const a=T.Get(`${U}/input`,this._gltf.accessors,M.input),A=T.Get(`${U}/output`,this._gltf.accessors,M.output);return M._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${a.index}`,a),this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)]).then((U=>{let[M,a]=U;return{input:M,interpolation:b,output:a}})),M._data}loadBufferAsync(U,M,b,a){const A=this._extensionsLoadBufferAsync(U,M,b,a);if(A)return A;if(!M._data)if(M.uri)M._data=this.loadUriAsync(`${U}/uri`,M,M.uri);else{if(!this._bin)throw new Error(`${U}: Uri is missing or the binary glTF is missing its binary chunk`);M._data=this._bin.readAsync(0,M.byteLength)}return M._data.then((M=>{try{return new Uint8Array(M.buffer,M.byteOffset+b,a)}catch(A){throw new Error(`${U}: ${A.message}`)}}))}loadBufferViewAsync(U,M){const b=this._extensionsLoadBufferViewAsync(U,M);if(b)return b;if(M._data)return M._data;const a=T.Get(`${U}/buffer`,this._gltf.buffers,M.buffer);return M._data=this.loadBufferAsync(`/buffers/${a.index}`,a,M.byteOffset||0,M.byteLength),M._data}_loadAccessorAsync(U,M,b){if(M._data)return M._data;const a=l._GetNumComponents(U,M.type),A=a*q.e.GetTypeByteLength(M.componentType),H=a*M.count;if(void 0==M.bufferView)M._data=Promise.resolve(new b(H));else{const W=T.Get(`${U}/bufferView`,this._gltf.bufferViews,M.bufferView);M._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((y=>{if(5126!==M.componentType||M.normalized||W.byteStride&&W.byteStride!==A){const U=new b(H);return q.e.ForEach(y,M.byteOffset||0,W.byteStride||A,a,M.componentType,U.length,M.normalized||!1,((M,b)=>{U[b]=M})),U}return l._GetTypedArray(U,M.componentType,y,M.byteOffset,H)}))}if(M.sparse){const H=M.sparse;M._data=M._data.then((W=>{const y=W,O=T.Get(`${U}/sparse/indices/bufferView`,this._gltf.bufferViews,H.indices.bufferView),e=T.Get(`${U}/sparse/values/bufferView`,this._gltf.bufferViews,H.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${O.index}`,O),this.loadBufferViewAsync(`/bufferViews/${e.index}`,e)]).then((W=>{let[O,e]=W;const x=l._GetTypedArray(`${U}/sparse/indices`,H.indices.componentType,O,H.indices.byteOffset,H.count),P=a*H.count;let Z;if(5126!==M.componentType||M.normalized){const W=l._GetTypedArray(`${U}/sparse/values`,M.componentType,e,H.values.byteOffset,P);Z=new b(P),q.e.ForEach(W,0,A,a,M.componentType,Z.length,M.normalized||!1,((U,M)=>{Z[M]=U}))}else Z=l._GetTypedArray(`${U}/sparse/values`,M.componentType,e,H.values.byteOffset,P);let C=0;for(let U=0;U<x.length;U++){let M=x[U]*a;for(let U=0;U<a;U++)y[M++]=Z[C++]}return y}))}))}return M._data}_loadFloatAccessorAsync(U,M){return this._loadAccessorAsync(U,M,Float32Array)}_loadIndicesAccessorAsync(U,M){if("SCALAR"!==M.type)throw new Error(`${U}/type: Invalid value ${M.type}`);if(5121!==M.componentType&&5123!==M.componentType&&5125!==M.componentType)throw new Error(`${U}/componentType: Invalid value ${M.componentType}`);if(M._data)return M._data;if(M.sparse){const b=l._GetTypedArrayConstructor(`${U}/componentType`,M.componentType);M._data=this._loadAccessorAsync(U,M,b)}else{const b=T.Get(`${U}/bufferView`,this._gltf.bufferViews,M.bufferView);M._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>l._GetTypedArray(U,M.componentType,b,M.byteOffset,M.count)))}return M._data}_loadVertexBufferViewAsync(U){if(U._babylonBuffer)return U._babylonBuffer;const M=this._babylonScene.getEngine();return U._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((U=>new q.c(M,U,!1))),U._babylonBuffer}_loadVertexAccessorAsync(U,M,b){var a;if(null!==(a=M._babylonVertexBuffer)&&void 0!==a&&a[b])return M._babylonVertexBuffer[b];M._babylonVertexBuffer||(M._babylonVertexBuffer={});const A=this._babylonScene.getEngine();if(M.sparse||void 0==M.bufferView)M._babylonVertexBuffer[b]=this._loadFloatAccessorAsync(U,M).then((U=>new q.e(A,U,b,!1)));else{const a=T.Get(`${U}/bufferView`,this._gltf.bufferViews,M.bufferView);M._babylonVertexBuffer[b]=this._loadVertexBufferViewAsync(a).then((H=>{const W=l._GetNumComponents(U,M.type);return new q.e(A,H,b,!1,void 0,a.byteStride,void 0,M.byteOffset,W,M.componentType,M.normalized,!0,void 0,!0)}))}return M._babylonVertexBuffer[b]}_loadMaterialMetallicRoughnessPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return M&&(M.baseColorFactor?(b.albedoColor=H.c.jk(M.baseColorFactor),b.alpha=M.baseColorFactor[3]):b.albedoColor=H.c.White(),b.metallic=void 0==M.metallicFactor?1:M.metallicFactor,b.roughness=void 0==M.roughnessFactor?1:M.roughnessFactor,M.baseColorTexture&&a.push(this.loadTextureInfoAsync(`${U}/baseColorTexture`,M.baseColorTexture,(U=>{U.name=`${b.name} (Base Color)`,b.albedoTexture=U}))),M.metallicRoughnessTexture&&(M.metallicRoughnessTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${U}/metallicRoughnessTexture`,M.metallicRoughnessTexture,(U=>{U.name=`${b.name} (Metallic Roughness)`,b.metallicTexture=U}))),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(a).then((()=>{}))}_loadMaterialAsync(U,M,b,a){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const H=this._extensionsLoadMaterialAsync(U,M,b,a,A);if(H)return H;M._data=M._data||{};let W=M._data[a];if(!W){this.logOpen(`${U} ${M.name||""}`);const b=this.createMaterial(U,M,a);W={babylonMaterial:b,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(U,M,b)},M._data[a]=W,l.AddPointerMetadata(b,U),this._parent.onMaterialLoadedObservable.notifyObservers(b),this.logClose()}return b&&(W.babylonMeshes.push(b),b.rk.addOnce((()=>{const U=W.babylonMeshes.indexOf(b);-1!==U&&W.babylonMeshes.splice(U,1)}))),A(W.babylonMaterial),W.promise.then((()=>W.babylonMaterial))}_createDefaultMaterial(U,M){this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new Y(U,this._babylonScene);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.fillMode=M,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=Y.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b}createMaterial(U,M,b){const a=this._extensionsCreateMaterial(U,M,b);if(a)return a;const A=M.name||`material${M.index}`;return this._createDefaultMaterial(A,b)}loadMaterialPropertiesAsync(U,M,b){const a=this._extensionsLoadMaterialPropertiesAsync(U,M,b);if(a)return a;const A=new Array;return A.push(this.loadMaterialBasePropertiesAsync(U,M,b)),M.pbrMetallicRoughness&&A.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${U}/pbrMetallicRoughness`,M.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(U,M,b),Promise.all(A).then((()=>{}))}loadMaterialBasePropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return b.emissiveColor=M.emissiveFactor?H.c.jk(M.emissiveFactor):new H.c(0,0,0),M.doubleSided&&(b.vk=!1,b.twoSidedLighting=!0),M.normalTexture&&(M.normalTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${U}/normalTexture`,M.normalTexture,(U=>{U.name=`${b.name} (Normal)`,b.bumpTexture=U}))),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=M.normalTexture.scale&&b.bumpTexture&&(b.bumpTexture.level=M.normalTexture.scale),b.forceIrradianceInFragment=!0),M.occlusionTexture&&(M.occlusionTexture.nonColorData=!0,a.push(this.loadTextureInfoAsync(`${U}/occlusionTexture`,M.occlusionTexture,(U=>{U.name=`${b.name} (Occlusion)`,b.ambientTexture=U}))),b.useAmbientInGrayScale=!0,void 0!=M.occlusionTexture.strength&&(b.ambientTextureStrength=M.occlusionTexture.strength)),M.emissiveTexture&&a.push(this.loadTextureInfoAsync(`${U}/emissiveTexture`,M.emissiveTexture,(U=>{U.name=`${b.name} (Emissive)`,b.emissiveTexture=U}))),Promise.all(a).then((()=>{}))}loadMaterialAlphaProperties(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);switch(M.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=Y.PBRMATERIAL_OPAQUE,b.alpha=1;break;case"MASK":b.transparencyMode=Y.PBRMATERIAL_ALPHATEST,b.alphaCutOff=void 0==M.alphaCutoff?.5:M.alphaCutoff,b.albedoTexture&&(b.albedoTexture.Ei=!0);break;case"BLEND":b.transparencyMode=Y.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.Ei=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${U}/alphaMode: Invalid value (${M.alphaMode})`)}}loadTextureInfoAsync(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadTextureInfoAsync(U,M,b);if(a)return a;if(this.logOpen(`${U}`),M.texCoord>=6)throw new Error(`${U}/texCoord: Invalid value (${M.texCoord})`);const A=T.Get(`${U}/index`,this._gltf.textures,M.index);A._textureInfo=M;const H=this._loadTextureAsync(`/textures/${M.index}`,A,(a=>{a.coordinatesIndex=M.texCoord||0,l.AddPointerMetadata(a,U),this._parent.onTextureLoadedObservable.notifyObservers(a),b(a)}));return this.logClose(),H}_loadTextureAsync(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const a=this._extensionsLoadTextureAsync(U,M,b);if(a)return a;this.logOpen(`${U} ${M.name||""}`);const A=void 0==M.sampler?l.DefaultSampler:T.Get(`${U}/sampler`,this._gltf.samplers,M.sampler),H=T.Get(`${U}/source`,this._gltf.images,M.source),W=this._createTextureAsync(U,A,H,b,void 0,!M._textureInfo.nonColorData);return this.logClose(),W}_createTextureAsync(U,M,b){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},H=arguments.length>4?arguments[4]:void 0,W=arguments.length>5?arguments[5]:void 0;const y=this._loadSampler(`/samplers/${M.index}`,M),O=new Array,e=new a;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x={noMipmap:y.noMipMaps,invertY:!1,samplingMode:y.samplingMode,X:()=>{this._disposed||e.resolve()},onError:(M,b)=>{this._disposed||e.reject(new Error(`${U}: ${b&&b.message?b.message:M||"Failed to load texture"}`))},mimeType:b.mimeType??(0,V.h)(b.uri??""),loaderOptions:H,useSRGBBuffer:!!W&&this._parent.useSRGBBuffers},P=new d.e(null,this._babylonScene,x);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.push(e.promise),O.push(this.loadImageAsync(`/images/${b.index}`,b).then((U=>{const M=b.uri||`${this._fileName}#image${b.index}`,a=`data:${this._uniqueRootUrl}${M}`;P.updateURL(a,U);const A=P.getInternalTexture();A&&(A.label=b.name)}))),P.wrapU=y.wrapU,P.wrapV=y.wrapV,A(P),this._parent.useGltfTextureNames&&(P.name=b.name||b.uri||`image${b.index}`),Promise.all(O).then((()=>P))}_loadSampler(U,M){return M._data||(M._data={noMipMaps:9728===M.minFilter||9729===M.minFilter,samplingMode:l._GetTextureSamplingMode(U,M),wrapU:l._GetTextureWrapMode(`${U}/wrapS`,M.wrapS),wrapV:l._GetTextureWrapMode(`${U}/wrapT`,M.wrapT)}),M._data}loadImageAsync(U,M){if(!M._data){if(this.logOpen(`${U} ${M.name||""}`),M.uri)M._data=this.loadUriAsync(`${U}/uri`,M,M.uri);else{const b=T.Get(`${U}/bufferView`,this._gltf.bufferViews,M.bufferView);M._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}this.logClose()}return M._data}loadUriAsync(U,M,b){const a=this._extensionsLoadUriAsync(U,M,b);if(a)return a;if(!l._ValidateUri(b))throw new Error(`${U}: '${b}' is invalid`);if((0,V.l)(b)){const M=new Uint8Array((0,V.b)(b));return this.log(`${U}: Decoded ${b.substring(0,64)}... (${M.length} bytes)`),Promise.resolve(M)}return this.log(`${U}: Loading ${b}`),this._parent.preprocessUrlAsync(this._rootUrl+b).then((M=>new Promise(((a,A)=>{this._parent._loadFile(this._babylonScene,M,(M=>{this._disposed||(this.log(`${U}: Loaded ${b} (${M.byteLength} bytes)`),a(new Uint8Array(M)))}),!0,(M=>{A(new V.p(`${U}: Failed to load '${b}'${M?": "+M.status+" "+M.statusText:""}`,M))}))}))))}static AddPointerMetadata(U,M){U.metadata=U.metadata||{};const b=U._internalMetadata=U._internalMetadata||{},a=b.Wk=b.Wk||{};(a.pointers=a.pointers||[]).push(M)}static _GetTextureWrapMode(U,M){switch(M=void 0==M?10497:M){case 33071:return d.e.CLAMP_ADDRESSMODE;case 33648:return d.e.MIRROR_ADDRESSMODE;case 10497:return d.e.WRAP_ADDRESSMODE;default:return B.b.Warn(`${U}: Invalid value (${M})`),d.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(U,M){const b=void 0==M.magFilter?9729:M.magFilter,a=void 0==M.minFilter?9987:M.minFilter;if(9729===b)switch(a){case 9728:return d.e.LINEAR_NEAREST;case 9729:return d.e.LINEAR_LINEAR;case 9984:return d.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return d.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return d.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return d.e.LINEAR_LINEAR_MIPLINEAR;default:return B.b.Warn(`${U}/minFilter: Invalid value (${a})`),d.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&B.b.Warn(`${U}/magFilter: Invalid value (${b})`),a){case 9728:return d.e.NEAREST_NEAREST;case 9729:return d.e.NEAREST_LINEAR;case 9984:return d.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return d.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return d.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return d.e.NEAREST_LINEAR_MIPLINEAR;default:return B.b.Warn(`${U}/minFilter: Invalid value (${a})`),d.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(U,M){try{return(0,w.l)(M)}catch(b){throw new Error(`${U}: ${b.message}`)}}static _GetTypedArray(U,M,b,a,A){const H=b.buffer;a=b.byteOffset+(a||0);const W=l._GetTypedArrayConstructor(`${U}/componentType`,M),y=q.e.GetTypeByteLength(M);return a%y!==0?(B.b.Warn(`${U}: Copying buffer as byte offset (${a}) is not a multiple of component type byte length (${y})`),new W(H.slice(a,a+A*y),0)):new W(H,a,A)}static _GetNumComponents(U,M){switch(M){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${U}: Invalid type (${M})`)}static _ValidateUri(U){return W.d.IsBase64(U)||-1===U.indexOf("..")}static _GetDrawMode(U,M){switch(void 0==M&&(M=4),M){case 0:return f.c.PointListDrawMode;case 1:return f.c.LineListDrawMode;case 2:return f.c.LineLoopDrawMode;case 3:return f.c.LineStripDrawMode;case 4:return f.c.TriangleFillMode;case 5:return f.c.TriangleStripDrawMode;case 6:return f.c.TriangleFanDrawMode}throw new Error(`${U}: Invalid mesh primitive mode (${M})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const U=new Array;if(this._gltf.materials)for(const M of this._gltf.materials)if(M._data)for(const b in M._data){const a=M._data[b];for(const M of a.babylonMeshes){M.ik(!0);const b=a.babylonMaterial;U.push(b.forceCompilationAsync(M)),U.push(b.forceCompilationAsync(M,{useInstances:!0})),this._parent.useClipPlane&&(U.push(b.forceCompilationAsync(M,{clipPlane:!0})),U.push(b.forceCompilationAsync(M,{clipPlane:!0,useInstances:!0})))}}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const U=new Array,M=this._babylonScene.lights;for(const b of M){const M=b.getShadowGenerator();M&&U.push(M.forceCompilationAsync())}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(U){for(const M of this._extensions)M.enabled&&U(M)}_applyExtensions(U,M,b){for(const a of this._extensions)if(a.enabled){const A=`${a.name}.${M}`,H=U;H._activeLoaderExtensionFunctions=H._activeLoaderExtensionFunctions||{};const W=H._activeLoaderExtensionFunctions;if(!W[A]){W[A]=!0;try{const U=b(a);if(U)return U}finally{delete W[A]}}}return null}_extensionsOnLoading(){this._forEachExtensions((U=>U.onLoading&&U.onLoading()))}_extensionsOnReady(){this._forEachExtensions((U=>U.onReady&&U.onReady()))}_extensionsLoadSceneAsync(U,M){return this._applyExtensions(M,"loadScene",(b=>b.loadSceneAsync&&b.loadSceneAsync(U,M)))}_extensionsLoadNodeAsync(U,M,b){return this._applyExtensions(M,"loadNode",(a=>a.loadNodeAsync&&a.loadNodeAsync(U,M,b)))}_extensionsLoadCameraAsync(U,M,b){return this._applyExtensions(M,"loadCamera",(a=>a.loadCameraAsync&&a.loadCameraAsync(U,M,b)))}_extensionsLoadVertexDataAsync(U,M,b){return this._applyExtensions(M,"loadVertexData",(a=>a._loadVertexDataAsync&&a._loadVertexDataAsync(U,M,b)))}_extensionsLoadMeshPrimitiveAsync(U,M,b,a,A,H){return this._applyExtensions(A,"loadMeshPrimitive",(W=>W._loadMeshPrimitiveAsync&&W._loadMeshPrimitiveAsync(U,M,b,a,A,H)))}_extensionsLoadMaterialAsync(U,M,b,a,A){return this._applyExtensions(M,"loadMaterial",(H=>H._loadMaterialAsync&&H._loadMaterialAsync(U,M,b,a,A)))}_extensionsCreateMaterial(U,M,b){return this._applyExtensions(M,"createMaterial",(a=>a.createMaterial&&a.createMaterial(U,M,b)))}_extensionsLoadMaterialPropertiesAsync(U,M,b){return this._applyExtensions(M,"loadMaterialProperties",(a=>a.loadMaterialPropertiesAsync&&a.loadMaterialPropertiesAsync(U,M,b)))}_extensionsLoadTextureInfoAsync(U,M,b){return this._applyExtensions(M,"loadTextureInfo",(a=>a.loadTextureInfoAsync&&a.loadTextureInfoAsync(U,M,b)))}_extensionsLoadTextureAsync(U,M,b){return this._applyExtensions(M,"loadTexture",(a=>a._loadTextureAsync&&a._loadTextureAsync(U,M,b)))}_extensionsLoadAnimationAsync(U,M){return this._applyExtensions(M,"loadAnimation",(b=>b.loadAnimationAsync&&b.loadAnimationAsync(U,M)))}_extensionsLoadAnimationChannelAsync(U,M,b,a,A){return this._applyExtensions(b,"loadAnimationChannel",(H=>H._loadAnimationChannelAsync&&H._loadAnimationChannelAsync(U,M,b,a,A)))}_extensionsLoadSkinAsync(U,M,b){return this._applyExtensions(b,"loadSkin",(a=>a._loadSkinAsync&&a._loadSkinAsync(U,M,b)))}_extensionsLoadUriAsync(U,M,b){return this._applyExtensions(M,"loadUri",(a=>a._loadUriAsync&&a._loadUriAsync(U,M,b)))}_extensionsLoadBufferViewAsync(U,M){return this._applyExtensions(M,"loadBufferView",(b=>b.loadBufferViewAsync&&b.loadBufferViewAsync(U,M)))}_extensionsLoadBufferAsync(U,M,b,a){return this._applyExtensions(M,"loadBuffer",(A=>A.loadBufferAsync&&A.loadBufferAsync(U,M,b,a)))}static LoadExtensionAsync(U,M,b,a){if(!M.extensions)return null;const A=M.extensions[b];return A?a(`${U}/extensions/${b}`,A):null}static LoadExtraAsync(U,M,b,a){if(!M.extras)return null;const A=M.extras[b];return A?a(`${U}/extras/${b}`,A):null}isExtensionUsed(U){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(U)}logOpen(U){this._parent._logOpen(U)}logClose(){this._parent._logClose()}log(U){this._parent._log(U)}startPerformanceCounter(U){this._parent._startPerformanceCounter(U)}endPerformanceCounter(U){this._parent._endPerformanceCounter(U)}}l.DefaultSampler={index:-1},t.e._CreateGLTF2Loader=U=>new l(U);var D=b(12716),u=b(2322),c=b(2490),UU=b(12723);class MU extends UU.e{constructor(U,M,b){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",U),this._texture=U.getEngine().createRawCubeTexture(M,b,a,A,H,W,y,O)}update(U,M,b,a){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,U,M,b,a,A)}updateRGBDAsync(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,c.m)(this._texture,U,M,b,a).then((()=>{}))}clone(){return i.d.Clone((()=>{const U=this.va(),M=this._texture,b=new MU(U,M._bufferViewArray,M.width,M.format,M.type,M.generateMipMaps,M.invertY,M.samplingMode,M._compression);return 13===M.source&&b.updateRGBDAsync(M._bufferViewArrayArray,M._sphericalPolynomial,M._lodGenerationScale,M._lodGenerationOffset),b}),this)}}const bU="EXT_lights_image_based";class aU{constructor(U){this.name=bU,this._loader=U,this.enabled=this._loader.isExtensionUsed(bU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Wk.extensions;if(U&&U[this.name]){const M=U[this.name];this._lights=M.lights}}loadSceneAsync(U,M){return l.LoadExtensionAsync(U,M,this.name,(async(b,a)=>{this._loader._allMaterialsDirtyRequired=!0;const A=new Array;A.push(this._loader.loadSceneAsync(U,M)),this._loader.logOpen(`${b}`);const H=T.Get(`${b}/light`,this._lights,a.ab);return A.push(this._loadLightAsync(`/extensions/${this.name}/lights/${a.ab}`,H).then((U=>{this._loader.babylonScene.environmentTexture=U}))),this._loader.logClose(),await Promise.all(A).then((()=>{}))}))}_loadLightAsync(U,M){if(!M._loaded){const b=new Array;this._loader.logOpen(`${U}`);const a=new Array(M.specularImages.length);for(let A=0;A<M.specularImages.length;A++){const H=M.specularImages[A];a[A]=new Array(H.length);for(let M=0;M<H.length;M++){const W=`${U}/specularImages/${A}/${M}`;this._loader.logOpen(`${W}`);const y=H[M],O=T.Get(W,this._loader.Wk.images,y);b.push(this._loader.loadImageAsync(`/images/${y}`,O).then((U=>{a[A][M]=U}))),this._loader.logClose()}}this._loader.logClose(),M._loaded=Promise.all(b).then((async()=>{const b=new MU(this._loader.babylonScene,null,M.specularImageSize);if(b.name=M.name||"environment",M._babylonTexture=b,void 0!=M.Rl&&(b.level=M.Rl),M.rotation){let U=A.e.jk(M.rotation);this._loader.babylonScene.useRightHandedSystem||(U=A.e.Inverse(U)),A.b.FromQuaternionToRef(U,b.getReflectionTextureMatrix())}if(!M.irradianceCoefficients)throw new Error(`${U}: Irradiance coefficients are missing`);const H=u.c.jk(M.irradianceCoefficients);H.scaleInPlace(M.Rl),H.convertIrradianceToLambertianRadiance();const W=u.d.FromHarmonics(H),y=(a.length-1)/Math.log2(M.specularImageSize);return await b.updateRGBDAsync(a,W,y)}))}return M._loaded.then((()=>M._babylonTexture))}}p(bU),j(bU,!0,(U=>new aU(U)));b(466);const AU="EXT_mesh_gpu_instancing";class HU{constructor(U){this.name=AU,this._loader=U,this.enabled=this._loader.isExtensionUsed(AU)}dispose(){this._loader=null}loadNodeAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(U,a)=>{this._loader._disableInstancedMesh++;const H=this._loader.loadNodeAsync(`/nodes/${M.index}`,M,b);if(this._loader._disableInstancedMesh--,!M._primitiveBabylonMeshes)return await H;const W=new Array;let y=0;const O=M=>{if(void 0==a.attributes[M])return void W.push(Promise.resolve(null));const b=T.Get(`${U}/attributes/${M}`,this._loader.Wk.accessors,a.attributes[M]);if(W.push(this._loader._loadFloatAccessorAsync(`/accessors/${b.bufferView}`,b)),0===y)y=b.count;else if(y!==b.count)throw new Error(`${U}/attributes: Instance buffer accessors do not have the same count.`)};return O("TRANSLATION"),O("ROTATION"),O("SCALE"),await H.then((async U=>{const[b,a,H]=await Promise.all(W),O=new Float32Array(16*y);A.g.lk[0].vd(0,0,0),A.g.Quaternion[0].vd(0,0,0,1),A.g.lk[1].vd(1,1,1);for(let M=0;M<y;++M)b&&A.l.FromArrayToRef(b,3*M,A.g.lk[0]),a&&A.e.FromArrayToRef(a,4*M,A.g.Quaternion[0]),H&&A.l.FromArrayToRef(H,3*M,A.g.lk[1]),A.b.ComposeToRef(A.g.lk[1],A.g.Quaternion[0],A.g.lk[0],A.g.Matrix[0]),A.g.Matrix[0].copyToArray(O,16*M);for(const A of M._primitiveBabylonMeshes)A.Lk("matrix",O,16,!0);return U}))}))}}p(AU),j(AU,!0,(U=>new HU(U)));let WU=0,yU=null;class OU{static get Default(){return OU._Default||(OU._Default=new OU),OU._Default}constructor(){const U=OU.Configuration.decoder;this._decoderModulePromise=W.d.LoadBabylonScriptAsync(U.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(U,M,b,a,A){await this._decoderModulePromise,0===WU&&(MeshoptDecoder.useWorkers(1),WU=1);const H=await MeshoptDecoder.decodeGltfBufferAsync(M,b,U,a,A);return null!==yU&&clearTimeout(yU),yU=setTimeout((()=>{MeshoptDecoder.useWorkers(0),WU=0,yU=null}),1e3),H}}OU.Configuration={decoder:{url:`${W.d._DefaultCdnUrl}/meshopt_decoder.js`}},OU._Default=null;const eU="EXT_meshopt_compression";class xU{constructor(U){this.name=eU,this.enabled=U.isExtensionUsed(eU),this._loader=U}dispose(){this._loader=null}loadBufferViewAsync(U,M){return l.LoadExtensionAsync(U,M,this.name,(async(b,a)=>{const A=M;if(A._meshOptData)return await A._meshOptData;const H=T.Get(`${U}/buffer`,this._loader.Wk.buffers,a.buffer);return A._meshOptData=this._loader.loadBufferAsync(`/buffers/${H.index}`,H,a.byteOffset||0,a.byteLength).then((async U=>await OU.Default.decodeGltfBufferAsync(U,a.count,a.byteStride,a.mode,a.filter))),await A._meshOptData}))}}p(eU),j(eU,!0,(U=>new xU(U)));const PU="EXT_texture_webp";class ZU{constructor(U){this.name=PU,this._loader=U,this.enabled=U.isExtensionUsed(PU)}dispose(){this._loader=null}_loadTextureAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=void 0==M.sampler?l.DefaultSampler:T.Get(`${U}/sampler`,this._loader.Wk.samplers,M.sampler),W=T.Get(`${a}/source`,this._loader.Wk.images,A.source);return await this._loader._createTextureAsync(U,H,W,(U=>{b(U)}),void 0,!M._textureInfo.nonColorData)}))}}p(PU),j(PU,!0,(U=>new ZU(U)));const CU="EXT_texture_avif";class rU{constructor(U){this.name=CU,this._loader=U,this.enabled=U.isExtensionUsed(CU)}dispose(){this._loader=null}_loadTextureAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=void 0==M.sampler?l.DefaultSampler:T.Get(`${U}/sampler`,this._loader.Wk.samplers,M.sampler),W=T.Get(`${a}/source`,this._loader.Wk.images,A.source);return await this._loader._createTextureAsync(U,H,W,(U=>{b(U)}),void 0,!M._textureInfo.nonColorData)}))}}p(CU),j(CU,!0,(U=>new rU(U)));var BU=b(12705),JU=b(12671);const FU="EXT_lights_ies";class fU{constructor(U){this.name=FU,this._loader=U,this.enabled=this._loader.isExtensionUsed(FU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Wk.extensions;if(U&&U[this.name]){const M=U[this.name];this._lights=M.lights,T.Assign(this._lights)}}loadNodeAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,W)=>{let y,O;this._loader._allMaterialsDirtyRequired=!0;const e=await this._loader.loadNodeAsync(U,M,(U=>{O=T.Get(a,this._lights,W.ab);const M=O.name||U.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,y=new BU.c(M,A.l.Zero(),A.l.Backward(),0,1,this._loader.babylonScene),y.angle=Math.PI/2,y.innerAngle=0,y._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,O._babylonLight=y,y.falloffType=JU.c.FALLOFF_GLTF,y.Zk=W.color?H.c.jk(W.color):H.c.White(),y.Rl=W.multiplier||1,y.range=Number.MAX_VALUE,y.parent=U,this._loader._babylonLights.push(y),l.AddPointerMetadata(y,a),b(U)}));let x;if(O.uri)x=await this._loader.loadUriAsync(U,O,O.uri);else{const M=T.Get(`${U}/bufferView`,this._loader.Wk.bufferViews,O.bufferView);x=await this._loader.loadBufferViewAsync(`/bufferViews/${M.index}`,M)}return y.iesProfileTexture=new d.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,x,!0,void 0,void 0,void 0,void 0,".ies"),e}))}}p(FU),j(FU,!0,(U=>new fU(U)));var LU=b(12728);const zU="KHR_draco_mesh_compression";class oU{constructor(U){this.name=zU,this.useNormalizedFlagFromAccessor=!0,this._loader=U,this.enabled=LU.c.DefaultAvailable&&this._loader.isExtensionUsed(zU)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{if(void 0!=M.mode&&4!==M.mode&&5!==M.mode)throw new Error(`${U}: Unsupported mode ${M.mode}`);const H={},W={},y=(U,a)=>{const y=A.attributes[U];if(void 0!=y&&(b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(a)&&b._delayInfo.push(a),H[a]=y,this.useNormalizedFlagFromAccessor)){const b=T.TryGet(this._loader.Wk.accessors,M.attributes[U]);b&&(W[a]=b.normalized||!1)}};y("POSITION",q.e.PositionKind),y("NORMAL",q.e.NormalKind),y("TANGENT",q.e.TangentKind),y("TEXCOORD_0",q.e.UVKind),y("TEXCOORD_1",q.e.UV2Kind),y("TEXCOORD_2",q.e.UV3Kind),y("TEXCOORD_3",q.e.UV4Kind),y("TEXCOORD_4",q.e.UV5Kind),y("TEXCOORD_5",q.e.UV6Kind),y("JOINTS_0",q.e.MatricesIndicesKind),y("WEIGHTS_0",q.e.MatricesWeightsKind),y("COLOR_0",q.e.ColorKind);const O=T.Get(a,this._loader.Wk.bufferViews,A.bufferView);return O._dracoBabylonGeometry||(O._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O).then((async a=>{const A=this.dracoDecoder||LU.c.Default,y=T.TryGet(this._loader.Wk.accessors,M.attributes.POSITION),O=this._loader.parent.alwaysComputeBoundingBox||b.skeleton||!y?null:G(y);return await A._decodeMeshToGeometryForGltfAsync(b.name,this._loader.babylonScene,a,H,W,O).catch((M=>{throw new Error(`${U}: ${M.message}`)}))}))),await O._dracoBabylonGeometry}))}}p(zU),j(zU,!0,(U=>new oU(U)));var SU=b(12753),hU=b(689),iU=b(12713);hU.e.AddNodeConstructor("Light_Type_0",((U,M)=>()=>new YU(U,A.l.Zero(),M)));class YU extends iU.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(U){this._shadowAngle=U,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(U){const M=this.needCube();if(this._direction=U,this.needCube()!==M&&this._shadowGenerators){const U=this._shadowGenerators.values();for(let M=U.next();!0!==M.done;M=U.next()){M.value.recreateShadowMap()}}}constructor(U,M,b){super(U,b),this._shadowAngle=Math.PI/2,this.position=M}getClassName(){return"PointLight"}getTypeID(){return JU.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(U){if(this.direction)return super.getShadowDirection(U);switch(U){case 0:return new A.l(1,0,0);case 1:return new A.l(-1,0,0);case 2:return new A.l(0,-1,0);case 3:return new A.l(0,1,0);case 4:return new A.l(0,0,1);case 5:return new A.l(0,0,-1)}return A.l.Zero()}_setDefaultShadowProjectionMatrix(U,M,b){const a=this.va().activeCamera;if(!a)return;const H=void 0!==this.shadowMinZ?this.shadowMinZ:a.ek,W=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,y=this.va().getEngine().useReverseDepthBuffer;A.b.PerspectiveFovLHToRef(this.shadowAngle,1,y?W:H,y?H:W,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,y)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,M){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,M):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,M),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,M),this}transferToNodeMaterialEffect(U,M){return this.computeTransformedInformation()?U.setFloat3(M,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):U.setFloat3(M,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(U,M){U["POINTLIGHT"+M]=!0}}(0,L.c)([(0,z.J)()],YU.prototype,"shadowAngle",null),(0,h.i)("BABYLON.PointLight",YU);const dU="KHR_lights_punctual";class sU{constructor(U){this.name=dU,this._loader=U,this.enabled=this._loader.isExtensionUsed(dU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Wk.extensions;if(U&&U[this.name]){const M=U[this.name];this._lights=M.lights,T.Assign(this._lights)}}loadNodeAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,W)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(U,M,(U=>{let M;const y=T.Get(a,this._lights,W.ab),O=y.name||U.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,y.type){case"directional":{const U=new SU.e(O,A.l.Backward(),this._loader.babylonScene);U.position.mk(0),M=U;break}case"point":M=new YU(O,A.l.Zero(),this._loader.babylonScene);break;case"spot":{const U=new BU.c(O,A.l.Zero(),A.l.Backward(),0,1,this._loader.babylonScene);U.angle=2*(y.spot&&y.spot.outerConeAngle||Math.PI/4),U.innerAngle=2*(y.spot&&y.spot.innerConeAngle||0),M=U;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${a}: Invalid light type (${y.type})`)}M._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,y._babylonLight=M,M.falloffType=JU.c.FALLOFF_GLTF,M.Zk=y.color?H.c.jk(y.color):H.c.White(),M.Rl=void 0==y.Rl?1:y.Rl,M.range=void 0==y.range?Number.MAX_VALUE:y.range,M.parent=U,this._loader._babylonLights.push(M),l.AddPointerMetadata(M,a),b(U)})))))}}p(dU),j(dU,!0,(U=>new sU(U)));const qU="KHR_materials_pbrSpecularGlossiness";class mU{constructor(U){this.name=qU,this.order=200,this._loader=U,this.enabled=this._loader.isExtensionUsed(qU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialBasePropertiesAsync(U,M,b)),H.push(this._loadSpecularGlossinessPropertiesAsync(a,A,b)),this._loader.loadMaterialAlphaProperties(U,M,b),await Promise.all(H).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return b.metallic=null,b.roughness=null,M.diffuseFactor?(b.albedoColor=H.c.jk(M.diffuseFactor),b.alpha=M.diffuseFactor[3]):b.albedoColor=H.c.White(),b.reflectivityColor=M.specularFactor?H.c.jk(M.specularFactor):H.c.White(),b.microSurface=void 0==M.glossinessFactor?1:M.glossinessFactor,M.diffuseTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTexture`,M.diffuseTexture,(U=>{U.name=`${b.name} (Diffuse)`,b.albedoTexture=U}))),M.specularGlossinessTexture&&(a.push(this._loader.loadTextureInfoAsync(`${U}/specularGlossinessTexture`,M.specularGlossinessTexture,(U=>{U.name=`${b.name} (Specular Glossiness)`,b.reflectivityTexture=U,b.reflectivityTexture.Ei=!0}))),b.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(a).then((()=>{}))}}p(qU),j(qU,!0,(U=>new mU(U)));const nU="KHR_materials_unlit";class EU{constructor(U){this.name=nU,this.order=210,this._loader=U,this.enabled=this._loader.isExtensionUsed(nU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async()=>await this._loadUnlitPropertiesAsync(U,M,b)))}_loadUnlitPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;b.unlit=!0;const A=M.pbrMetallicRoughness;return A&&(A.baseColorFactor?(b.albedoColor=H.c.jk(A.baseColorFactor),b.alpha=A.baseColorFactor[3]):b.albedoColor=H.c.White(),A.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/baseColorTexture`,A.baseColorTexture,(U=>{U.name=`${b.name} (Base Color)`,b.albedoTexture=U})))),M.doubleSided&&(b.vk=!1,b.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(U,M,b),Promise.all(a).then((()=>{}))}}p(nU),j(nU,!0,(U=>new EU(U)));const XU="KHR_materials_clearcoat";class QU{constructor(U){this.name=XU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(XU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadClearCoatPropertiesAsync(a,A,b)),await Promise.all(H)}))}_loadClearCoatPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return b.clearCoat.isEnabled=!0,b.clearCoat.useRoughnessFromMainTexture=!1,b.clearCoat.remapF0OnInterfaceChange=!1,void 0!=M.clearcoatFactor?b.clearCoat.Rl=M.clearcoatFactor:b.clearCoat.Rl=0,M.clearcoatTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatTexture`,M.clearcoatTexture,(U=>{U.name=`${b.name} (ClearCoat)`,b.clearCoat.texture=U}))),void 0!=M.clearcoatRoughnessFactor?b.clearCoat.roughness=M.clearcoatRoughnessFactor:b.clearCoat.roughness=0,M.clearcoatRoughnessTexture&&(M.clearcoatRoughnessTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatRoughnessTexture`,M.clearcoatRoughnessTexture,(U=>{U.name=`${b.name} (ClearCoat Roughness)`,b.clearCoat.textureRoughness=U})))),M.clearcoatNormalTexture&&(M.clearcoatNormalTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatNormalTexture`,M.clearcoatNormalTexture,(U=>{U.name=`${b.name} (ClearCoat Normal)`,b.clearCoat.bumpTexture=U}))),b.invertNormalMapX=!b.va().useRightHandedSystem,b.invertNormalMapY=b.va().useRightHandedSystem,void 0!=M.clearcoatNormalTexture.scale&&(b.clearCoat.bumpTexture.level=M.clearcoatNormalTexture.scale)),Promise.all(a).then((()=>{}))}}p(XU),j(XU,!0,(U=>new QU(U)));const IU="KHR_materials_iridescence";class vU{constructor(U){this.name=IU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(IU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadIridescencePropertiesAsync(a,A,b)),await Promise.all(H).then((()=>{}))}))}_loadIridescencePropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return b.iridescence.isEnabled=!0,b.iridescence.Rl=M.iridescenceFactor??0,b.iridescence.indexOfRefraction=M.iridescenceIor??M.iridescenceIOR??1.3,b.iridescence.minimumThickness=M.iridescenceThicknessMinimum??100,b.iridescence.maximumThickness=M.iridescenceThicknessMaximum??400,M.iridescenceTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/iridescenceTexture`,M.iridescenceTexture,(U=>{U.name=`${b.name} (Iridescence)`,b.iridescence.texture=U}))),M.iridescenceThicknessTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/iridescenceThicknessTexture`,M.iridescenceThicknessTexture,(U=>{U.name=`${b.name} (Iridescence Thickness)`,b.iridescence.thicknessTexture=U}))),Promise.all(a).then((()=>{}))}}p(IU),j(IU,!0,(U=>new vU(U)));const tU="KHR_materials_anisotropy";class VU{constructor(U){this.name=tU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(tU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadIridescencePropertiesAsync(a,A,b)),await Promise.all(H)}))}async _loadIridescencePropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;b.anisotropy.isEnabled=!0,b.anisotropy.Rl=M.anisotropyStrength??0,b.anisotropy.angle=M.anisotropyRotation??0,M.anisotropyTexture&&(M.anisotropyTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${U}/anisotropyTexture`,M.anisotropyTexture,(U=>{U.name=`${b.name} (Anisotropy Intensity)`,b.anisotropy.texture=U})))),await Promise.all(a)}}p(tU),j(tU,!0,(U=>new VU(U)));const kU="KHR_materials_emissive_strength";class NU{constructor(U){this.name=kU,this.order=170,this._loader=U,this.enabled=this._loader.isExtensionUsed(kU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>await this._loader.loadMaterialPropertiesAsync(U,M,b).then((()=>{this._loadEmissiveProperties(a,A,b)}))))}_loadEmissiveProperties(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);void 0!==M.emissiveStrength&&(b.emissiveIntensity=M.emissiveStrength)}}p(kU),j(kU,!0,(U=>new NU(U)));const RU="KHR_materials_sheen";class jU{constructor(U){this.name=RU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(RU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadSheenPropertiesAsync(a,A,b)),await Promise.all(H).then((()=>{}))}))}_loadSheenPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return b.sheen.isEnabled=!0,b.sheen.Rl=1,void 0!=M.sheenColorFactor?b.sheen.color=H.c.jk(M.sheenColorFactor):b.sheen.color=H.c.Black(),M.sheenColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/sheenColorTexture`,M.sheenColorTexture,(U=>{U.name=`${b.name} (Sheen Color)`,b.sheen.texture=U}))),void 0!==M.sheenRoughnessFactor?b.sheen.roughness=M.sheenRoughnessFactor:b.sheen.roughness=0,M.sheenRoughnessTexture&&(M.sheenRoughnessTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${U}/sheenRoughnessTexture`,M.sheenRoughnessTexture,(U=>{U.name=`${b.name} (Sheen Roughness)`,b.sheen.textureRoughness=U})))),b.sheen.albedoScaling=!0,b.sheen.useRoughnessFromMainTexture=!1,Promise.all(a).then((()=>{}))}}p(RU),j(RU,!0,(U=>new jU(U)));var pU=b(12696);const gU="KHR_materials_specular";class KU{constructor(U){this.name=gU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(gU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;if(H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadSpecularPropertiesAsync(a,A,b)),A.extensions&&A.extensions.EXT_materials_specular_edge_color&&b instanceof Y){A.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(b.brdf.dielectricSpecularModel=pU.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,b.brdf.conductorSpecularModel=pU.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(H).then((()=>{}))}))}_loadSpecularPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return void 0!==M.specularFactor&&(b.metallicF0Factor=M.specularFactor),void 0!==M.specularColorFactor&&(b.metallicReflectanceColor=H.c.jk(M.specularColorFactor)),M.specularTexture&&(M.specularTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${U}/specularTexture`,M.specularTexture,(U=>{U.name=`${b.name} (Specular)`,b.metallicReflectanceTexture=U,b.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),M.specularColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/specularColorTexture`,M.specularColorTexture,(U=>{U.name=`${b.name} (Specular Color)`,b.reflectanceTexture=U}))),Promise.all(a).then((()=>{}))}}p(gU),j(gU,!0,(U=>new KU(U)));const wU="KHR_materials_ior";class TU{constructor(U){this.name=wU,this.order=180,this._loader=U,this.enabled=this._loader.isExtensionUsed(wU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadIorPropertiesAsync(a,A,b)),await Promise.all(H).then((()=>{}))}))}_loadIorPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);return void 0!==M.ior?b.indexOfRefraction=M.ior:b.indexOfRefraction=TU._DEFAULT_IOR,Promise.resolve()}}TU._DEFAULT_IOR=1.5,p(wU),j(wU,!0,(U=>new TU(U)));const GU="KHR_materials_variants";class lU{constructor(U){this.name=GU,this._loader=U,this.enabled=this._loader.isExtensionUsed(GU)}dispose(){this._loader=null}static GetAvailableVariants(U){const M=this._GetExtensionMetadata(U);return M?Object.keys(M.variants):[]}getAvailableVariants(U){return lU.GetAvailableVariants(U)}static SelectVariant(U,M){const b=this._GetExtensionMetadata(U);if(!b)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${GU} extension`);const a=U=>{const M=b.variants[U];if(M)for(const b of M)b.mesh.material=b.material};if(M instanceof Array)for(const A of M)a(A);else a(M);b.lastSelected=M}selectVariant(U,M){lU.SelectVariant(U,M)}static Reset(U){const M=this._GetExtensionMetadata(U);if(!M)throw new Error(`Cannot reset on a glTF mesh that does not have the ${GU} extension`);for(const b of M.original)b.mesh.material=b.material;M.lastSelected=null}reset(U){lU.Reset(U)}static GetLastSelectedVariant(U){const M=this._GetExtensionMetadata(U);if(!M)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${GU} extension`);return M.lastSelected}getLastSelectedVariant(U){return lU.GetLastSelectedVariant(U)}static _GetExtensionMetadata(U){var M,b;return(null===U||void 0===U||null===(M=U._internalMetadata)||void 0===M||null===(b=M.Wk)||void 0===b?void 0:b[GU])||null}onLoading(){const U=this._loader.Wk.extensions;if(U&&U[this.name]){const M=U[this.name];this._variants=M.variants}}onReady(){const U=this._loader.rootBabylonMesh;if(U){var M;const b=this._loader.parent.extensionOptions[GU];null!==b&&void 0!==b&&b.defaultVariant&&lU.SelectVariant(U,b.defaultVariant),null===b||void 0===b||null===(M=b.onLoaded)||void 0===M||M.call(b,{get variants(){return lU.GetAvailableVariants(U)},get selectedVariant(){const M=lU.GetLastSelectedVariant(U);return M?Array.isArray(M)?M[0]:M:lU.GetAvailableVariants(U)[0]},set selectedVariant(M){lU.SelectVariant(U,M)}})}}_loadMeshPrimitiveAsync(U,M,b,a,A,H){return l.LoadExtensionAsync(U,A,this.name,(async(W,y)=>{const O=new Array;return O.push(this._loader._loadMeshPrimitiveAsync(U,M,b,a,A,(M=>{if(H(M),M instanceof E.c){const b=l._GetDrawMode(U,A.mode),a=this._loader.rootBabylonMesh,H=a?a._internalMetadata=a._internalMetadata||{}:{},e=H.Wk=H.Wk||{},x=e[GU]=e[GU]||{lastSelected:null,original:[],variants:{}};x.original.push({mesh:M,material:M.material});for(let U=0;U<y.mappings.length;++U){const A=y.mappings[U],H=T.Get(`${W}/mappings/${U}/material`,this._loader.Wk.materials,A.material);O.push(this._loader._loadMaterialAsync(`#/materials/${A.material}`,H,M,b,(U=>{for(let b=0;b<A.variants.length;++b){const H=A.variants[b],W=T.Get(`/extensions/${GU}/variants/${H}`,this._variants,H);x.variants[W.name]=x.variants[W.name]||[],x.variants[W.name].push({mesh:M,material:U}),M.onClonedObservable.add((U=>{const b=U;let A=null,H=b;do{if(H=H.parent,!H)return;A=lU._GetExtensionMetadata(H)}while(null===A);if(a&&A===lU._GetExtensionMetadata(a)){H._internalMetadata={};for(const U in a._internalMetadata)H._internalMetadata[U]=a._internalMetadata[U];H._internalMetadata.Wk=[];for(const U in a._internalMetadata.Wk)H._internalMetadata.Wk[U]=a._internalMetadata.Wk[U];H._internalMetadata.Wk[GU]={lastSelected:null,original:[],variants:{}};for(const U of A.original)H._internalMetadata.Wk[GU].original.push({mesh:U.mesh,material:U.material});for(const U in A.variants)if(Object.prototype.hasOwnProperty.call(A.variants,U)){H._internalMetadata.Wk[GU].variants[U]=[];for(const M of A.variants[U])H._internalMetadata.Wk[GU].variants[U].push({mesh:M.mesh,material:M.material})}A=H._internalMetadata.Wk[GU]}for(const a of A.original)a.mesh===M&&(a.mesh=b);for(const a of A.variants[W.name])a.mesh===M&&(a.mesh=b)}))}})))}}}))),await Promise.all(O).then((U=>{let[M]=U;return M}))}))}}p(GU),j(GU,!0,(U=>new lU(U)));var DU=b(2378);class uU{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:pU.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(U,M){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...uU._GetDefaultOptions(),...U},this._scene=M,this._scene._transmissionHelper=this,this.onErrorObservable=new x.e,this._scene.rk.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(U){if(!Object.keys(U).filter((M=>this._options[M]!==U[M])).length)return;const M={...this._options,...U},b=this._options;this._options=M,M.renderSize===b.renderSize&&M.renderTargetTextureType===b.renderTargetTextureType&&M.generateMipmaps===b.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=M.samples,this._opaqueRenderTarget.lodGenerationScale=M.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=M.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(U){return!!U&&!!(U instanceof Y&&U.subSurface.isRefractionEnabled)}_addMesh(U){this._materialObservers[U.uniqueId]=U.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),W.d.SetImmediate((()=>{this._shouldRenderAsTransmission(U.material)?(U.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(U)&&this._transparentMeshesCache.push(U)):-1===this._opaqueMeshesCache.indexOf(U)&&this._opaqueMeshesCache.push(U)}))}_removeMesh(U){U.onMaterialChangedObservable.remove(this._materialObservers[U.uniqueId]),delete this._materialObservers[U.uniqueId];let M=this._transparentMeshesCache.indexOf(U);-1!==M&&this._transparentMeshesCache.splice(M,1),M=this._opaqueMeshesCache.indexOf(U),-1!==M&&this._opaqueMeshesCache.splice(M,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(U){const M=this._transparentMeshesCache.indexOf(U),b=this._opaqueMeshesCache.indexOf(U);this._shouldRenderAsTransmission(U.material)?(U.material instanceof Y&&(U.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==b?(this._opaqueMeshesCache.splice(b,1),this._transparentMeshesCache.push(U)):-1===M&&this._transparentMeshesCache.push(U)):-1!==M?(this._transparentMeshesCache.splice(M,1),this._opaqueMeshesCache.push(U)):-1===b&&this._opaqueMeshesCache.push(U)}_isRenderTargetValid(){var U;return null!==(null===(U=this._opaqueRenderTarget)||void 0===U?void 0:U.getInternalTexture())}_setupRenderTargets(){var U;let M;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new DU.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(U=this._options.clearColor)||void 0===U?void 0:U.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((U=>{M=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?U.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(U.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=M}));for(const b of this._transparentMeshesCache)this._shouldRenderAsTransmission(b.material)&&(b.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const cU="KHR_materials_transmission";class UM{constructor(U){this.name=cU,this.order=175,this._loader=U,this.enabled=this._loader.isExtensionUsed(cU),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadTransparentPropertiesAsync(a,M,b,A)),await Promise.all(H).then((()=>{}))}))}_loadTransparentPropertiesAsync(U,M,b,a){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const A=b;if(A.subSurface.isRefractionEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.useAlbedoToTintRefraction=!0,void 0===a.transmissionFactor)return A.subSurface.refractionIntensity=0,A.subSurface.isRefractionEnabled=!1,Promise.resolve();{var H;A.subSurface.refractionIntensity=a.transmissionFactor;const U=A.va();if(A.subSurface.refractionIntensity&&!U._transmissionHelper)new uU({},A.va());else if(A.subSurface.refractionIntensity&&(null===(H=U._transmissionHelper)||void 0===H||!H._isRenderTargetValid())){var W;null===(W=U._transmissionHelper)||void 0===W||W._setupRenderTargets()}}return A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,a.transmissionTexture?(a.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${U}/transmissionTexture`,a.transmissionTexture,void 0).then((U=>{U.name=`${b.name} (Transmission)`,A.subSurface.refractionIntensityTexture=U,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}p(cU),j(cU,!0,(U=>new UM(U)));const MM="KHR_materials_diffuse_transmission";class bM{constructor(U){this.name=MM,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(MM),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadTranslucentPropertiesAsync(a,M,b,A)),await Promise.all(H).then((()=>{}))}))}_loadTranslucentPropertiesAsync(U,M,b,a){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const A=b;if(A.subSurface.isTranslucencyEnabled=!0,A.subSurface.volumeIndexOfRefraction=1,A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=0,A.subSurface.useAlbedoToTintTranslucency=!1,void 0===a.diffuseTransmissionFactor)return A.subSurface.translucencyIntensity=0,A.subSurface.isTranslucencyEnabled=!1,Promise.resolve();A.subSurface.translucencyIntensity=a.diffuseTransmissionFactor;const W=new Array;return A.subSurface.useGltfStyleTextures=!0,a.diffuseTransmissionTexture&&(a.diffuseTransmissionTexture.nonColorData=!0,W.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTransmissionTexture`,a.diffuseTransmissionTexture).then((U=>{U.name=`${b.name} (Diffuse Transmission)`,A.subSurface.translucencyIntensityTexture=U})))),void 0!==a.diffuseTransmissionColorFactor?A.subSurface.translucencyColor=H.c.jk(a.diffuseTransmissionColorFactor):A.subSurface.translucencyColor=H.c.White(),a.diffuseTransmissionColorTexture&&W.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTransmissionColorTexture`,a.diffuseTransmissionColorTexture).then((U=>{U.name=`${b.name} (Diffuse Transmission Color)`,A.subSurface.translucencyColorTexture=U}))),Promise.all(W).then((()=>{}))}}p(MM),j(MM,!0,(U=>new bM(U)));const aM="KHR_materials_volume";class AM{constructor(U){this.name=aM,this.order=173,this._loader=U,this.enabled=this._loader.isExtensionUsed(aM),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadVolumePropertiesAsync(a,M,b,A)),await Promise.all(H).then((()=>{}))}))}_loadVolumePropertiesAsync(U,M,b,a){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);if(!b.subSurface.isRefractionEnabled&&!b.subSurface.isTranslucencyEnabled||!a.thicknessFactor)return Promise.resolve();b.subSurface.volumeIndexOfRefraction=b.indexOfRefraction;const A=void 0!==a.attenuationDistance?a.attenuationDistance:Number.MAX_VALUE;return b.subSurface.tintColorAtDistance=A,void 0!==a.attenuationColor&&3==a.attenuationColor.length&&b.subSurface.tintColor.vd(a.attenuationColor[0],a.attenuationColor[1],a.attenuationColor[2]),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=a.thicknessFactor,b.subSurface.useThicknessAsDepth=!0,a.thicknessTexture?(a.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${U}/thicknessTexture`,a.thicknessTexture).then((U=>{U.name=`${b.name} (Thickness)`,b.subSurface.thicknessTexture=U,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}p(aM),j(aM,!0,(U=>new AM(U)));const HM="KHR_materials_dispersion";class WM{constructor(U){this.name=HM,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(HM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadDispersionPropertiesAsync(a,M,b,A)),await Promise.all(H).then((()=>{}))}))}_loadDispersionPropertiesAsync(U,M,b,a){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);return b.subSurface.isRefractionEnabled&&a.dispersion?(b.subSurface.isDispersionEnabled=!0,b.subSurface.dispersion=a.dispersion,Promise.resolve()):Promise.resolve()}}p(HM),j(HM,!0,(U=>new WM(U)));const yM="EXT_materials_diffuse_roughness";class OM{constructor(U){this.name=yM,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(yM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=new Array;return H.push(this._loader.loadMaterialPropertiesAsync(U,M,b)),H.push(this._loadDiffuseRoughnessPropertiesAsync(a,A,b)),await Promise.all(H).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(U,M,b){if(!(b instanceof Y))throw new Error(`${U}: Material type not supported`);const a=new Array;return b.brdf.baseDiffuseModel=pU.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=M.diffuseRoughnessFactor?b.baseDiffuseRoughness=M.diffuseRoughnessFactor:b.baseDiffuseRoughness=0,M.diffuseRoughnessTexture&&a.push(this._loader.loadTextureInfoAsync(`${U}/diffuseRoughnessTexture`,M.diffuseRoughnessTexture,(U=>{U.name=`${b.name} (Diffuse Roughness)`,b.baseDiffuseRoughnessTexture=U}))),Promise.all(a).then((()=>{}))}}p(yM),j(yM,!0,(U=>new OM(U)));const eM="KHR_mesh_quantization";class xM{constructor(U){this.name=eM,this.enabled=U.isExtensionUsed(eM)}dispose(){}}p(eM),j(eM,!0,(U=>new xM(U)));const PM="KHR_texture_basisu";class ZM{constructor(U){this.name=PM,this._loader=U,this.enabled=U.isExtensionUsed(PM)}dispose(){this._loader=null}_loadTextureAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>{const H=void 0==M.sampler?l.DefaultSampler:T.Get(`${U}/sampler`,this._loader.Wk.samplers,M.sampler),W=T.Get(`${a}/source`,this._loader.Wk.images,A.source);return await this._loader._createTextureAsync(U,H,W,(U=>{b(U)}),M._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!M._textureInfo.nonColorData)}))}}p(PM),j(PM,!0,(U=>new ZM(U)));const CM="KHR_texture_transform";class rM{constructor(U){this.name=CM,this._loader=U,this.enabled=this._loader.isExtensionUsed(CM)}dispose(){this._loader=null}loadTextureInfoAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(a,A)=>await this._loader.loadTextureInfoAsync(U,M,(U=>{if(!(U instanceof d.e))throw new Error(`${a}: Texture type not supported`);A.offset&&(U.uOffset=A.offset[0],U.vOffset=A.offset[1]),U.uRotationCenter=0,U.vRotationCenter=0,A.rotation&&(U.wAng=-A.rotation),A.scale&&(U.uScale=A.scale[0],U.vScale=A.scale[1]),void 0!=A.texCoord&&(U.coordinatesIndex=A.texCoord),b(U)}))))}}p(CM),j(CM,!0,(U=>new rM(U)));const BM="KHR_xmp_json_ld";class JM{constructor(U){this.name=BM,this.order=100,this._loader=U,this.enabled=this._loader.isExtensionUsed(BM)}dispose(){this._loader=null}onLoading(){var U,M,b;if(null===this._loader.rootBabylonMesh)return;const a=null===(U=this._loader.Wk.extensions)||void 0===U?void 0:U.KHR_xmp_json_ld,A=null===(M=this._loader.Wk.asset)||void 0===M||null===(b=M.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld;if(a&&A){const U=+A.packet;a.packets&&U<a.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=a.packets[U])}}}function FM(U,M,b,a){return H.c.jk(M,b).scale(a)}function fM(U,M,b,a){return M[b]*a}function LM(U,M,b,a){return-M[b]*a}function zM(U,M,b,a){return M[b+1]*a}function oM(U,M,b,a){return M[b]*a*2}function SM(U){return{scale:[new iM(Z.d.ANIMATIONTYPE_FLOAT,`${U}.uScale`,fM,(()=>2)),new iM(Z.d.ANIMATIONTYPE_FLOAT,`${U}.vScale`,zM,(()=>2))],offset:[new iM(Z.d.ANIMATIONTYPE_FLOAT,`${U}.uOffset`,fM,(()=>2)),new iM(Z.d.ANIMATIONTYPE_FLOAT,`${U}.vOffset`,zM,(()=>2))],rotation:[new iM(Z.d.ANIMATIONTYPE_FLOAT,`${U}.wAng`,LM,(()=>1))]}}p(BM),j(BM,!0,(U=>new JM(U)));class hM extends D.AnimationPropertyInfo{buildAnimations(U,M,b,a){return[{babylonAnimatable:U._babylonCamera,babylonAnimation:this._buildAnimation(M,b,a)}]}}class iM extends D.AnimationPropertyInfo{buildAnimations(U,M,b,a){const A=[];for(const H in U._data)A.push({babylonAnimatable:U._data[H].babylonMaterial,babylonAnimation:this._buildAnimation(M,b,a)});return A}}class YM extends D.AnimationPropertyInfo{buildAnimations(U,M,b,a){return[{babylonAnimatable:U._babylonLight,babylonAnimation:this._buildAnimation(M,b,a)}]}}(0,g.l)("/cameras/{}/orthographic/xmag",[new hM(Z.d.ANIMATIONTYPE_FLOAT,"orthoLeft",LM,(()=>1)),new hM(Z.d.ANIMATIONTYPE_FLOAT,"orthoRight",zM,(()=>1))]),(0,g.l)("/cameras/{}/orthographic/ymag",[new hM(Z.d.ANIMATIONTYPE_FLOAT,"orthoBottom",LM,(()=>1)),new hM(Z.d.ANIMATIONTYPE_FLOAT,"orthoTop",zM,(()=>1))]),(0,g.l)("/cameras/{}/orthographic/zfar",[new hM(Z.d.ANIMATIONTYPE_FLOAT,"maxZ",fM,(()=>1))]),(0,g.l)("/cameras/{}/orthographic/znear",[new hM(Z.d.ANIMATIONTYPE_FLOAT,"ek",fM,(()=>1))]),(0,g.l)("/cameras/{}/perspective/yfov",[new hM(Z.d.ANIMATIONTYPE_FLOAT,"fov",fM,(()=>1))]),(0,g.l)("/cameras/{}/perspective/zfar",[new hM(Z.d.ANIMATIONTYPE_FLOAT,"maxZ",fM,(()=>1))]),(0,g.l)("/cameras/{}/perspective/znear",[new hM(Z.d.ANIMATIONTYPE_FLOAT,"ek",fM,(()=>1))]),(0,g.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new iM(Z.d.ANIMATIONTYPE_COLOR3,"albedoColor",FM,(()=>4)),new iM(Z.d.ANIMATIONTYPE_FLOAT,"alpha",(function(U,M,b,a){return M[b+3]*a}),(()=>4))]),(0,g.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"metallic",fM,(()=>1))]),(0,g.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"roughness",fM,(()=>1))]);const dM=SM("albedoTexture");(0,g.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",dM.scale),(0,g.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",dM.offset),(0,g.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",dM.rotation);const sM=SM("metallicTexture");(0,g.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",sM.scale),(0,g.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",sM.offset),(0,g.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",sM.rotation),(0,g.l)("/materials/{}/emissiveFactor",[new iM(Z.d.ANIMATIONTYPE_COLOR3,"emissiveColor",FM,(()=>3))]);const qM=SM("bumpTexture");(0,g.l)("/materials/{}/normalTexture/scale",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",fM,(()=>1))]),(0,g.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",qM.scale),(0,g.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",qM.offset),(0,g.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",qM.rotation),(0,g.l)("/materials/{}/occlusionTexture/strength",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",fM,(()=>1))]);const mM=SM("ambientTexture");(0,g.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",mM.scale),(0,g.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",mM.offset),(0,g.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",mM.rotation);const nM=SM("emissiveTexture");(0,g.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",nM.scale),(0,g.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",nM.offset),(0,g.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",nM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",fM,(()=>1))]);const EM=SM("anisotropy.texture");(0,g.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",EM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",EM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",EM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",fM,(()=>1))]);const XM=SM("clearCoat.texture");(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",XM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",XM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",XM.rotation);const QM=SM("clearCoat.bumpTexture");(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",QM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",QM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",QM.rotation);const IM=SM("clearCoat.textureRoughness");(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",IM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",IM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",IM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",fM,(()=>1))]);const vM=SM("iridescence.texture");(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",vM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",vM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",vM.rotation);const tM=SM("iridescence.thicknessTexture");(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",tM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",tM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",tM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new iM(Z.d.ANIMATIONTYPE_COLOR3,"sheen.color",FM,(()=>3))]),(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",fM,(()=>1))]);const VM=SM("sheen.texture");(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",VM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",VM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",VM.rotation);const kM=SM("sheen.textureRoughness");(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",kM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",kM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",kM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new iM(Z.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",FM,(()=>3))]);const NM=SM("metallicReflectanceTexture");(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",NM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",NM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",NM.rotation);const RM=SM("reflectanceTexture");(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",RM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",RM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",RM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",fM,(()=>1))]);const jM=SM("subSurface.refractionIntensityTexture");(0,g.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",jM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",jM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",jM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new iM(Z.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",FM,(()=>3))]),(0,g.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",fM,(()=>1))]),(0,g.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",fM,(()=>1))]);const pM=SM("subSurface.thicknessTexture");(0,g.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",pM.scale),(0,g.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",pM.offset),(0,g.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",pM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new iM(Z.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",fM,(()=>1))]);const gM=SM("subSurface.translucencyIntensityTexture");(0,g.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",gM.scale),(0,g.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",gM.offset),(0,g.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",gM.rotation),(0,g.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new iM(Z.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",FM,(()=>3))]);const KM=SM("subSurface.translucencyColorTexture");(0,g.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",KM.scale),(0,g.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",KM.offset),(0,g.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",KM.rotation),(0,g.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new YM(Z.d.ANIMATIONTYPE_COLOR3,"diffuse",FM,(()=>3))]),(0,g.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new YM(Z.d.ANIMATIONTYPE_FLOAT,"intensity",fM,(()=>1))]),(0,g.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new YM(Z.d.ANIMATIONTYPE_FLOAT,"range",fM,(()=>1))]),(0,g.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new YM(Z.d.ANIMATIONTYPE_FLOAT,"innerAngle",oM,(()=>1))]),(0,g.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new YM(Z.d.ANIMATIONTYPE_FLOAT,"angle",oM,(()=>1))]),(0,g.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new YM(Z.d.ANIMATIONTYPE_COLOR3,"diffuse",FM,(()=>3))]),(0,g.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new YM(Z.d.ANIMATIONTYPE_FLOAT,"intensity",fM,(()=>1))]);const wM="KHR_animation_pointer";class TM{constructor(U){this.name=wM,this._loader=U,this._pathToObjectConverter=(0,g.j)(this._loader.Wk)}get enabled(){return this._loader.isExtensionUsed(wM)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(U,M,b,a,A){var H;const W=null===(H=a.target.extensions)||void 0===H?void 0:H.KHR_animation_pointer;if(!W||!this._pathToObjectConverter)return null;"pointer"!==a.target.path&&B.b.Warn(`${U}/target/path: Value (${a.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=a.target.node&&B.b.Warn(`${U}/target/node: Value (${a.target.node}) must not be present when using the ${this.name} extension`);const y=`${U}/extensions/${this.name}`,O=W.pointer;if(!O)throw new Error(`${y}: Pointer is missing`);try{const H=this._pathToObjectConverter.convert(O);if(!H.info.interpolation)throw new Error(`${y}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(U,M,b,a,{object:H.object,info:H.info.interpolation},A)}catch(e){return B.b.Warn(`${y}/pointer: Invalid pointer (${O}) skipped`),null}}}p(wM),j(wM,!0,(U=>new TM(U)));class GM{constructor(U,M,b){this.frame=U,this.action=M,this.onlyOnce=b,this.isDone=!1}_clone(){return new GM(this.frame,this.action,this.onlyOnce)}}var lM=b(509),DM=b(562),uM=b(557);class cM{get loop(){return this._loop}set loop(U){U!==this._loop&&(this._loop=U,this.updateOptions({loop:U}))}get currentTime(){var U;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(U=DM.e.audioEngine)&&void 0!==U&&U.audioContext&&(this.isPlaying||this.isPaused)){const U=this.isPaused?0:DM.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+U}return 0}get spatialSound(){return this._spatialSound}set spatialSound(U){if(U==this._spatialSound)return;const M=this.isPlaying;this.pause(),U?(this._spatialSound=U,this._updateSpatialParameters()):this._disableSpatialSound(),M&&this.play()}constructor(U,M,b){var a;let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new x.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=A.l.Zero(),this._localDirection=new A.l(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=U,b=b||r.d.LastCreatedScene)if(this._scene=b,cM._SceneComponentInitialization(b),this._readyToPlayCallback=H,this._customAttenuationFunction=(U,M,b,a,A)=>M<b?U*(1-M/b):0,y&&(this.autoplay=y.autoplay||!1,this._loop=y.loop||!1,void 0!==y.volume&&(this._volume=y.volume),this._spatialSound=y.spatialSound??!1,this.maxDistance=y.maxDistance??100,this.useCustomAttenuation=y.useCustomAttenuation??!1,this.rolloffFactor=y.rolloffFactor||1,this.refDistance=y.refDistance||1,this.distanceModel=y.distanceModel||"linear",this._playbackRate=y.playbackRate||1,this._streaming=y.streaming??!1,this._length=y.length,this._offset=y.offset),null!==(a=DM.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&DM.e.audioEngine.audioContext){this._soundGain=DM.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let U=!0;if(M)try{"string"===typeof M?(this._urlType="String",this._url=M):M instanceof ArrayBuffer?this._urlType="ArrayBuffer":M instanceof HTMLMediaElement?this._urlType="MediaElement":M instanceof MediaStream?this._urlType="MediaStream":M instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(M)&&(this._urlType="Array");let b=[],a=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=DM.e.audioEngine.audioContext.createMediaElementSource(M),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=DM.e.audioEngine.audioContext.createMediaStreamSource(M),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":M.byteLength>0&&(a=!0,this._soundLoaded(M));break;case"AudioBuffer":this._audioBufferLoaded(M);break;case"String":b.push(M);case"Array":0===b.length&&(b=M);for(let U=0;U<b.length;U++){const M=b[U];if(a=y&&y.skipCodecCheck||-1!==M.indexOf(".mp3",M.length-4)&&DM.e.audioEngine.isMP3supported||-1!==M.indexOf(".ogg",M.length-4)&&DM.e.audioEngine.isOGGsupported||-1!==M.indexOf(".wav",M.length-4)||-1!==M.indexOf(".m4a",M.length-4)||-1!==M.indexOf(".mp4",M.length-4)||-1!==M.indexOf("blob:"),a){this._streaming?(this._htmlAudioElement=new Audio(M),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,W.d.SetCorsBehavior(M,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(M,(U=>{this._soundLoaded(U)}),void 0,!0,!0,(U=>{U&&B.b.Error("XHR "+U.status+" error on: "+M+"."),B.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:U=!1}U?a||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):B.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(O){B.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),DM.e.audioEngine&&!DM.e.audioEngine.WarnedWebAudioUnsupported&&(B.b.Error("Web Audio is not supported by your browser."),DM.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var U;null!==(U=DM.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(U){var M;null!==(M=DM.e.audioEngine)&&void 0!==M&&M.audioContext&&(this._audioBuffer=U,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(U){var M;null!==(M=DM.e.audioEngine)&&void 0!==M&&M.audioContext&&DM.e.audioEngine.audioContext.decodeAudioData(U,(U=>{this._audioBufferLoaded(U)}),(U=>{B.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+U)}))}setAudioBuffer(U){var M;null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&(this._audioBuffer=U,this._isReadyToPlay=!0)}updateOptions(U){U&&(this.loop=U.loop??this.loop,this.maxDistance=U.maxDistance??this.maxDistance,this.useCustomAttenuation=U.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=U.rolloffFactor??this.rolloffFactor,this.refDistance=U.refDistance??this.refDistance,this.distanceModel=U.distanceModel??this.distanceModel,this._playbackRate=U.playbackRate??this._playbackRate,this._length=U.length??void 0,this.spatialSound=U.spatialSound??this._spatialSound,this._setOffset(U.offset??void 0),this.setVolume(U.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var U;null!==(U=DM.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&DM.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??DM.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var U;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(U=this._soundPanner)||void 0===U||U.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var U;null!==(U=DM.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(U){var M;null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(U),this._isOutputConnected=!0)}setDirectionalCone(U,M,b){M<U?B.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=U,this._coneOuterAngle=M,this._coneOuterGain=b,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!=this._coneInnerAngle){var M;if(this._coneOuterAngle<U)return void B.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U,null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!=this._coneOuterAngle){var M;if(U<this._coneInnerAngle)return void B.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U,null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(U){var M;U.equals(this._position)||(this._position.p(U),null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(U){var M;this._localDirection=U,null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const U=this._connectedTransformNode.getWorldMatrix(),M=A.l.TransformNormal(this._localDirection,U);M.normalize(),this._soundPanner.orientationX.value=M.x,this._soundPanner.orientationY.value=M.y,this._soundPanner.orientationZ.value=M.z}updateDistanceFromListener(){var U;if(null!==(U=DM.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const U=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.je(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,U,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(U){this._customAttenuationFunction=U}play(U,M,b){var a;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(a=DM.e.audioEngine)&&void 0!==a&&a.audioContext)try{var A,H;this._clearTimeoutsAndObservers();let a=U?(null===(A=DM.e.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+U:null===(H=DM.e.audioEngine)||void 0===H?void 0:H.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=DM.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const U=()=>{var b;if(null!==(b=DM.e.audioEngine)&&void 0!==b&&b.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=M??0;const b=this._htmlAudioElement.play();void 0!==b&&b.catch((()=>{var M,b;(null===(M=DM.e.audioEngine)||void 0===M||M.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(b=DM.e.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{U()})))}))}else{var a;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(a=DM.e.audioEngine)||void 0===a?void 0:a.onAudioUnlockedObservable.addOnce((()=>{U()}))}};U()}}else{var W;const A=()=>{var A;if(null!==(A=DM.e.audioEngine)&&void 0!==A&&A.audioContext){var H;if(b=b||this._length,void 0!==M&&this._setOffset(M),this._soundSource){const U=this._soundSource;U.onended=()=>{U.disconnect()}}if(this._soundSource=null===(H=DM.e.audioEngine)||void 0===H?void 0:H.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var W;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==M&&(this._soundSource.loopStart=M),void 0!==b&&(this._soundSource.loopEnd=(0|M)+b),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},a=U?(null===(W=DM.e.audioEngine)||void 0===W?void 0:W.audioContext.currentTime)+U:DM.e.audioEngine.audioContext.currentTime;const A=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(a,A,this.loop?void 0:b)}}};"suspended"===(null===(W=DM.e.audioEngine)||void 0===W?void 0:W.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var U;"suspended"===(null===(U=DM.e.audioEngine)||void 0===U?void 0:U.audioContext.state)?(DM.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=DM.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{A()})))):A()}),500):A()}this._startTime=a,this.isPlaying=!0,this.isPaused=!1}catch(y){B.b.Error("Error while trying to play audio: "+this.name+", "+y.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(U){var M;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1}else if(null!==(M=DM.e.audioEngine)&&void 0!==M&&M.audioContext&&this._soundSource){const M=U?DM.e.audioEngine.audioContext.currentTime+U:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(M)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var M;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(M=this._streamingSource)||void 0===M||M.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(U=DM.e.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=DM.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(U,M){var b;null!==(b=DM.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._soundGain&&(M&&DM.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(DM.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,DM.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(U,DM.e.audioEngine.audioContext.currentTime+M)):this._soundGain.gain.value=U),this._volume=U}setPlaybackRate(U){this._playbackRate=U,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(U){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=U,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=U=>this._onRegisterAfterWorldMatrixUpdate(U),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(U){var M;if(U.getBoundingInfo){const M=U.getBoundingInfo();this.setPosition(M.boundingSphere.centerWorld)}else this.setPosition(U.absolutePosition);null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const U=()=>{(0,uM.h)((()=>this._isReadyToPlay),(()=>{b._audioBuffer=this.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,this._offset,this._length)}),void 0,300)},M={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},b=new cM(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,M);return this.useCustomAttenuation&&b.setAttenuationFunction(this._customAttenuationFunction),b.setPosition(this._position),b.setPlaybackRate(this._playbackRate),U(),b}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const U={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(U.connectedMeshId=this._connectedTransformNode.id),U.position=this._position.tk(),U.refDistance=this.refDistance,U.distanceModel=this.distanceModel,U.isDirectional=this._isDirectional,U.localDirectionToMesh=this._localDirection.tk(),U.coneInnerAngle=this._coneInnerAngle,U.coneOuterAngle=this._coneOuterAngle,U.coneOuterGain=this._coneOuterGain),U}static Parse(U,M,b,a){const H=U.name;let W;W=U.url?b+U.url:b+H;const y={autoplay:U.autoplay,loop:U.loop,volume:U.volume,spatialSound:U.spatialSound,maxDistance:U.maxDistance,rolloffFactor:U.rolloffFactor,refDistance:U.refDistance,distanceModel:U.distanceModel,playbackRate:U.playbackRate};let O;if(a){const U=()=>{(0,uM.h)((()=>a._isReadyToPlay),(()=>{O._audioBuffer=a.getAudioBuffer(),O._isReadyToPlay=!0,O.autoplay&&O.play(0,O._offset,O._length)}),void 0,300)};O=new cM(H,new ArrayBuffer(0),M,null,y),U()}else O=new cM(H,W,M,(()=>{M.removePendingData(O)}),y),M.addPendingData(O);if(U.position){const M=A.l.jk(U.position);O.setPosition(M)}if(U.isDirectional&&(O.setDirectionalCone(U.coneInnerAngle||360,U.coneOuterAngle||360,U.coneOuterGain||0),U.localDirectionToMesh)){const M=A.l.jk(U.localDirectionToMesh);O.setLocalDirectionToMesh(M)}if(U.connectedMeshId){const b=M.getMeshById(U.connectedMeshId);b&&O.attachToMesh(b)}return U.metadata&&(O.metadata=U.metadata),O}_setOffset(U){this._offset!==U&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=U)}_clearTimeoutsAndObservers(){var U;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(U=DM.e.audioEngine)||void 0===U||U.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}cM._SceneComponentInitialization=U=>{throw(0,lM.c)("AudioSceneComponent")},(0,h.i)("BABYLON.Sound",cM);class Ub{constructor(U,M,b){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],M.length!==b.length)throw new Error("Sounds length does not equal weights length");this.loop=U,this._weights=b;let a=0;for(const H of b)a+=H;const A=a>0?1/a:0;for(let H=0;H<this._weights.length;H++)this._weights[H]*=A;this._sounds=M;for(const H of this._sounds)H.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!==this._coneInnerAngle){if(this._coneOuterAngle<U)return void B.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U;for(const M of this._sounds)M.directionalConeInnerAngle=U}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!==this._coneOuterAngle){if(U<this._coneInnerAngle)return void B.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U;for(const M of this._sounds)M.directionalConeOuterAngle=U}}get volume(){return this._volume}set volume(U){if(U!==this._volume)for(const M of this._sounds)M.setVolume(U)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(U){if(!this.isPaused){this.stop();const U=Math.random();let M=0;for(let b=0;b<this._weights.length;b++)if(M+=this._weights[b],U<=M){this._currentIndex=b;break}}const M=this._sounds[this._currentIndex??0];M.isReady()?M.play(0,this.isPaused?void 0:U):M.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Mb{constructor(U){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(U=U||r.d.LastCreatedScene)&&(this._scene=U,this.soundCollection=[],this._options=M,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var U;null!==(U=DM.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&DM.e.audioEngine.audioContext&&(this._outputAudioNode=DM.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(DM.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(DM.e.audioEngine&&DM.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(U){var M;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&U.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==U.soundTrackId&&(-1===U.soundTrackId?this._scene.mainSoundTrack.removeSound(U):this._scene.soundTracks&&this._scene.soundTracks[U.soundTrackId].removeSound(U)),this.soundCollection.push(U),U.soundTrackId=this.id}removeSound(U){const M=this.soundCollection.indexOf(U);-1!==M&&this.soundCollection.splice(M,1)}setVolume(U){var M;null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=U)}switchPanningModelToHRTF(){var U;if(null!==(U=DM.e.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let M=0;M<this.soundCollection.length;M++)this.soundCollection[M].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var U;if(null!==(U=DM.e.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let M=0;M<this.soundCollection.length;M++)this.soundCollection[M].switchPanningModelToEqualPower()}connectToAnalyser(U){var M;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=U,null!==(M=DM.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,DM.e.audioEngine.masterGain))}}var bb=b(834),ab=b(2492),Ab=b(488);DM.e.AudioEngineFactory=(U,M,b)=>new Hb(U,M,b);class Hb{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new x.e,this.onAudioLockedObservable=new x.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,Ab.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const a=document.createElement("audio");this._hostElement=U,this._audioContext=M,this._audioDestination=b;try{a&&a.canPlayType&&(a.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||a.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(A){}try{a&&a.canPlayType&&a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(A){}}lock(){this._triggerSuspendedState()}unlock(){var U,M;if("running"===(null===(U=this._audioContext)||void 0===U?void 0:U.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(M=this._audioContext)||void 0===M||M.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{B.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var U;null===(U=this._audioContext)||void 0===U||U.addEventListener("statechange",(()=>{var U;this.unlocked&&"running"!==(null===(U=this._audioContext)||void 0===U?void 0:U.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var U;return null!==(U=this._audioContext)&&void 0!==U&&U.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(U){this.canUseWebAudio=!1,B.b.Error("Web Audio: "+U.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(U){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const U=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",M=document.createElement("style");M.appendChild(document.createTextNode(U)),document.getElementsByTagName("head")[0].appendChild(M),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var U;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(U=this._audioContext)||void 0===U||U.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(U){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=U)}connectToAnalyser(U){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=U,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Wb=b(503);(0,b(12406).g)(bb.e.NAME_AUDIO,((U,M,b,a)=>{let A,H=[];if(b.vm=b.vm||[],void 0!==U.vm&&null!==U.vm)for(let y=0,O=U.vm.length;y<O;y++){var W;const O=U.vm[y];null!==(W=DM.e.audioEngine)&&void 0!==W&&W.canUseWebAudio?(O.url||(O.url=O.name),H[O.url]?b.vm.push(cM.Parse(O,M,a,H[O.url])):(A=cM.Parse(O,M,a),H[O.url]=A,b.vm.push(A))):b.vm.push(new cM(O.name,null,M))}H=[]})),Object.defineProperty(ab.b.prototype,"mainSoundTrack",{get:function(){let U=this._getComponent(bb.e.NAME_AUDIO);return U||(U=new yb(this),this.o(U)),this._mainSoundTrack||(this._mainSoundTrack=new Mb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ab.b.prototype.getSoundByName=function(U){let M;for(M=0;M<this.mainSoundTrack.soundCollection.length;M++)if(this.mainSoundTrack.soundCollection[M].name===U)return this.mainSoundTrack.soundCollection[M];if(this.soundTracks)for(let b=0;b<this.soundTracks.length;b++)for(M=0;M<this.soundTracks[b].soundCollection.length;M++)if(this.soundTracks[b].soundCollection[M].name===U)return this.soundTracks[b].soundCollection[M];return null},Object.defineProperty(ab.b.prototype,"audioEnabled",{get:function(){let U=this._getComponent(bb.e.NAME_AUDIO);return U||(U=new yb(this),this.o(U)),U.audioEnabled},set:function(U){let M=this._getComponent(bb.e.NAME_AUDIO);M||(M=new yb(this),this.o(M)),U?M.enableAudio():M.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ab.b.prototype,"headphone",{get:function(){let U=this._getComponent(bb.e.NAME_AUDIO);return U||(U=new yb(this),this.o(U)),U.headphone},set:function(U){let M=this._getComponent(bb.e.NAME_AUDIO);M||(M=new yb(this),this.o(M)),U?M.switchAudioModeForHeadphones():M.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ab.b.prototype,"audioListenerPositionProvider",{get:function(){let U=this._getComponent(bb.e.NAME_AUDIO);return U||(U=new yb(this),this.o(U)),U.audioListenerPositionProvider},set:function(U){let M=this._getComponent(bb.e.NAME_AUDIO);if(M||(M=new yb(this),this.o(M)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");M.audioListenerPositionProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(ab.b.prototype,"audioListenerRotationProvider",{get:function(){let U=this._getComponent(bb.e.NAME_AUDIO);return U||(U=new yb(this),this.o(U)),U.audioListenerRotationProvider},set:function(U){let M=this._getComponent(bb.e.NAME_AUDIO);if(M||(M=new yb(this),this.o(M)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");M.audioListenerRotationProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(ab.b.prototype,"audioPositioningRefreshRate",{get:function(){let U=this._getComponent(bb.e.NAME_AUDIO);return U||(U=new yb(this),this.o(U)),U.audioPositioningRefreshRate},set:function(U){let M=this._getComponent(bb.e.NAME_AUDIO);M||(M=new yb(this),this.o(M)),M.audioPositioningRefreshRate=U},enumerable:!0,configurable:!0});class yb{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(U){this.name=bb.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new A.l,this._cachedCameraPosition=new A.l,this._lastCheck=0,this._invertMatrixTemp=new A.b,this._cameraDirectionTemp=new A.l,(U=U||r.d.LastCreatedScene)&&(this.$e=U,U.soundTracks=[],U.vm=[])}register(){this.$e._afterRenderStage.registerStep(bb.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(U){if(U.vm=[],this.$e.soundTracks)for(let M=0;M<this.$e.soundTracks.length;M++){const b=this.$e.soundTracks[M];for(let M=0;M<b.soundCollection.length;M++)U.vm.push(b.soundCollection[M].serialize())}}addFromContainer(U){if(U.vm)for(const M of U.vm)M.play(),M.autoplay=!0,this.$e.mainSoundTrack.addSound(M)}removeFromContainer(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(U.vm)for(const b of U.vm)b.stop(),b.autoplay=!1,this.$e.mainSoundTrack.removeSound(b),M&&b.dispose()}dispose(){const U=this.$e;if(U._mainSoundTrack&&U.mainSoundTrack.dispose(),U.soundTracks)for(let M=0;M<U.soundTracks.length;M++)U.soundTracks[M].dispose()}disableAudio(){const U=this.$e;let M;for(this._audioEnabled=!1,DM.e.audioEngine&&DM.e.audioEngine.audioContext&&DM.e.audioEngine.audioContext.suspend(),M=0;M<U.mainSoundTrack.soundCollection.length;M++)U.mainSoundTrack.soundCollection[M].pause();if(U.soundTracks)for(M=0;M<U.soundTracks.length;M++)for(let b=0;b<U.soundTracks[M].soundCollection.length;b++)U.soundTracks[M].soundCollection[b].pause()}enableAudio(){const U=this.$e;let M;for(this._audioEnabled=!0,DM.e.audioEngine&&DM.e.audioEngine.audioContext&&DM.e.audioEngine.audioContext.resume(),M=0;M<U.mainSoundTrack.soundCollection.length;M++)U.mainSoundTrack.soundCollection[M].isPaused&&U.mainSoundTrack.soundCollection[M].play();if(U.soundTracks)for(M=0;M<U.soundTracks.length;M++)for(let b=0;b<U.soundTracks[M].soundCollection.length;b++)U.soundTracks[M].soundCollection[b].isPaused&&U.soundTracks[M].soundCollection[b].play()}switchAudioModeForHeadphones(){const U=this.$e;if(this._headphone=!0,U.mainSoundTrack.switchPanningModelToHRTF(),U.soundTracks)for(let M=0;M<U.soundTracks.length;M++)U.soundTracks[M].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const U=this.$e;if(this._headphone=!1,U.mainSoundTrack.switchPanningModelToEqualPower(),U.soundTracks)for(let M=0;M<U.soundTracks.length;M++)U.soundTracks[M].switchPanningModelToEqualPower()}_afterRender(){const U=Wb.b.Now;if(this._lastCheck&&U-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=U;const M=this.$e;if(!this._audioEnabled||!M._mainSoundTrack||!M.soundTracks||0===M._mainSoundTrack.soundCollection.length&&1===M.soundTracks.length)return;const b=DM.e.audioEngine;if(b&&b.audioContext){let U,a=M.activeCamera;if(M.activeCameras&&M.activeCameras.length>0&&(a=M.activeCameras[0]),this.audioListenerPositionProvider){const U=this.audioListenerPositionProvider();b.audioContext.listener.setPosition(U.x||0,U.y||0,U.z||0)}else a?this._cachedCameraPosition.equals(a.globalPosition)||(this._cachedCameraPosition.p(a.globalPosition),b.audioContext.listener.setPosition(a.globalPosition.x,a.globalPosition.y,a.globalPosition.z)):b.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const U=this.audioListenerRotationProvider();b.audioContext.listener.setOrientation(U.x||0,U.y||0,U.z||0,0,1,0)}else a?(a.rigCameras&&a.rigCameras.length>0&&(a=a.rigCameras[0]),a.getViewMatrix().invertToRef(this._invertMatrixTemp),A.l.TransformNormalToRef(yb._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),b.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):b.audioContext.listener.setOrientation(0,0,0,0,1,0);for(U=0;U<M.mainSoundTrack.soundCollection.length;U++){const b=M.mainSoundTrack.soundCollection[U];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(M.soundTracks)for(U=0;U<M.soundTracks.length;U++)for(let b=0;b<M.soundTracks[U].soundCollection.length;b++){const a=M.soundTracks[U].soundCollection[b];a.useCustomAttenuation&&a.updateDistanceFromListener()}}}}yb._CameraDirection=new A.l(0,0,-1),cM._SceneComponentInitialization=U=>{let M=U._getComponent(bb.e.NAME_AUDIO);M||(M=new yb(U),U.o(M))};const Ob="MSFT_audio_emitter";class eb{constructor(U){this.name=Ob,this._loader=U,this.enabled=this._loader.isExtensionUsed(Ob)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const U=this._loader.Wk.extensions;if(U&&U[this.name]){const M=U[this.name];this._clips=M.clips,this._emitters=M.emitters,T.Assign(this._clips),T.Assign(this._emitters)}}loadSceneAsync(U,M){return l.LoadExtensionAsync(U,M,this.name,(async(b,a)=>{const A=new Array;A.push(this._loader.loadSceneAsync(U,M));for(const U of a.emitters){const M=T.Get(`${b}/emitters`,this._emitters,U);if(void 0!=M.refDistance||void 0!=M.maxDistance||void 0!=M.rolloffFactor||void 0!=M.distanceModel||void 0!=M.innerAngle||void 0!=M.outerAngle)throw new Error(`${b}: Direction or Distance properties are not allowed on emitters attached to a scene`);A.push(this._loadEmitterAsync(`${b}/emitters/${M.index}`,M))}await Promise.all(A)}))}loadNodeAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(U,a)=>{const H=new Array,y=await this._loader.loadNodeAsync(U,M,(M=>{for(const b of a.emitters){const a=T.Get(`${U}/emitters`,this._emitters,b);H.push(this._loadEmitterAsync(`${U}/emitters/${a.index}`,a).then((()=>{for(const U of a._babylonSounds)U.attachToMesh(M),void 0==a.innerAngle&&void 0==a.outerAngle||(U.setLocalDirectionToMesh(A.l.Forward()),U.setDirectionalCone(2*W.d.ToDegrees(void 0==a.innerAngle?Math.PI:a.innerAngle),2*W.d.ToDegrees(void 0==a.outerAngle?Math.PI:a.outerAngle),0))})))}b(M)}));return await Promise.all(H),y}))}loadAnimationAsync(U,M){return l.LoadExtensionAsync(U,M,this.name,(async(b,a)=>{const A=await this._loader.loadAnimationAsync(U,M),H=new Array;T.Assign(a.events);for(const W of a.events)H.push(this._loadAnimationEventAsync(`${b}/events/${W.index}`,U,M,W,A));return await Promise.all(H),A}))}_loadClipAsync(U,M){if(M._objectURL)return M._objectURL;let b;if(M.uri)b=this._loader.loadUriAsync(U,M,M.uri);else{const a=T.Get(`${U}/bufferView`,this._loader.Wk.bufferViews,M.bufferView);b=this._loader.loadBufferViewAsync(`/bufferViews/${a.index}`,a)}return M._objectURL=b.then((U=>URL.createObjectURL(new Blob([U],{type:M.mimeType})))),M._objectURL}_loadEmitterAsync(U,M){if(M._babylonSounds=M._babylonSounds||[],!M._babylonData){const U=new Array,b=M.name||`emitter${M.index}`,a={loop:!1,autoplay:!1,volume:void 0==M.volume?1:M.volume};for(let H=0;H<M.clips.length;H++){const A=`/extensions/${this.name}/clips`,W=T.Get(A,this._clips,M.clips[H].clip);U.push(this._loadClipAsync(`${A}/${M.clips[H].clip}`,W).then((U=>{const A=M._babylonSounds[H]=new cM(b,U,this._loader.babylonScene,null,a);A.refDistance=M.refDistance||1,A.maxDistance=M.maxDistance||256,A.rolloffFactor=M.rolloffFactor||1,A.distanceModel=M.distanceModel||"exponential"})))}const A=Promise.all(U).then((()=>{const U=M.clips.map((U=>U.weight||1)),b=new Ub(M.loop||!1,M._babylonSounds,U);M.innerAngle&&(b.directionalConeInnerAngle=2*W.d.ToDegrees(M.innerAngle)),M.outerAngle&&(b.directionalConeOuterAngle=2*W.d.ToDegrees(M.outerAngle)),M.volume&&(b.volume=M.volume),M._babylonData.sound=b}));M._babylonData={loaded:A}}return M._babylonData.loaded}_getEventAction(U,M,b,a,A){switch(b){case"play":return U=>{const b=(A||0)+(U-a);M.play(b)};case"stop":return()=>{M.stop()};case"pause":return()=>{M.pause()};default:throw new Error(`${U}: Unsupported action ${b}`)}}_loadAnimationEventAsync(U,M,b,a,A){if(0==A.targetedAnimations.length)return Promise.resolve();const H=A.targetedAnimations[0],W=a.j,y=T.Get(`/extensions/${this.name}/emitters`,this._emitters,W);return this._loadEmitterAsync(U,y).then((()=>{const M=y._babylonData.sound;if(M){const b=new GM(a.time,this._getEventAction(U,M,a.action,a.time,a.startOffset));H.animation.addEvent(b),A.onAnimationGroupEndObservable.add((()=>{M.stop()})),A.onAnimationGroupPauseObservable.add((()=>{M.pause()}))}}))}}p(Ob),j(Ob,!0,(U=>new eb(U)));const xb="MSFT_lod";class Pb{constructor(U){var M;this.name=xb,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new x.e,this.onMaterialLODsLoadedObservable=new x.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=U,this.maxLODsToLoad=(null===(M=this._loader.parent.extensionOptions[xb])||void 0===M?void 0:M.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(xb)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let U=0;U<this._nodePromiseLODs.length;U++){const M=Promise.all(this._nodePromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter(`Node LOD ${U}`),this._loader.log(`Loaded node LOD ${U}`)),this.onNodeLODsLoadedObservable.notifyObservers(U),U!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${U+1}`),this._loadBufferLOD(this._nodeBufferLODs,U+1),this._nodeSignalLODs[U]&&this._nodeSignalLODs[U].resolve())}));this._loader._completePromises.push(M)}for(let U=0;U<this._materialPromiseLODs.length;U++){const M=Promise.all(this._materialPromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter(`Material LOD ${U}`),this._loader.log(`Loaded material LOD ${U}`)),this.onMaterialLODsLoadedObservable.notifyObservers(U),U!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${U+1}`),this._loadBufferLOD(this._materialBufferLODs,U+1),this._materialSignalLODs[U]&&this._materialSignalLODs[U].resolve())}));this._loader._completePromises.push(M)}}loadSceneAsync(U,M){const b=this._loader.loadSceneAsync(U,M);return this._loadBufferLOD(this._bufferLODs,0),b}loadNodeAsync(U,M,b){return l.LoadExtensionAsync(U,M,this.name,(async(U,A)=>{let H;const W=this._getLODs(U,M,this._loader.Wk.nodes,A.ids);this._loader.logOpen(`${U}`);for(let M=0;M<W.length;M++){const U=W[M];0!==M&&(this._nodeIndexLOD=M,this._nodeSignalLODs[M]=this._nodeSignalLODs[M]||new a);const A=U=>{b(U),U.Kc(!1)},y=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,A).then((U=>{if(0!==M){const U=W[M-1];U._babylonTransformNode&&(this._disposeTransformNode(U._babylonTransformNode),delete U._babylonTransformNode)}return U.Kc(!0),U}));this._nodePromiseLODs[M]=this._nodePromiseLODs[M]||[],0===M?H=y:(this._nodeIndexLOD=null,this._nodePromiseLODs[M].push(y))}return this._loader.logClose(),await H}))}_loadMaterialAsync(U,M,b,a,A){return this._nodeIndexLOD?null:l.LoadExtensionAsync(U,M,this.name,(async(U,H)=>{let W;const y=this._getLODs(U,M,this._loader.Wk.materials,H.ids);this._loader.logOpen(`${U}`);for(let M=0;M<y.length;M++){const U=y[M];0!==M&&(this._materialIndexLOD=M);const H=this._loader._loadMaterialAsync(`/materials/${U.index}`,U,b,a,(U=>{0===M&&A(U)})).then((U=>{if(0!==M){A(U);const b=y[M-1]._data;b[a]&&(this._disposeMaterials([b[a].babylonMaterial]),delete b[a])}return U}));this._materialPromiseLODs[M]=this._materialPromiseLODs[M]||[],0===M?W=H:(this._materialIndexLOD=null,this._materialPromiseLODs[M].push(H))}return this._loader.logClose(),await W}))}_loadUriAsync(U,M,b){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const A=this._nodeIndexLOD-1;return this._nodeSignalLODs[A]=this._nodeSignalLODs[A]||new a,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(U,M,b)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const A=this._materialIndexLOD-1;return this._materialSignalLODs[A]=this._materialSignalLODs[A]||new a,this._materialSignalLODs[A].promise.then((async()=>await this._loader.loadUriAsync(U,M,b)))}return null}loadBufferAsync(U,M,b,A){if(this._loader.parent.useRangeRequests&&!M.uri){if(!this._loader.bin)throw new Error(`${U}: Uri is missing or the binary glTF is missing its binary chunk`);const M=async(U,M)=>{const H=b,W=H+A-1;let y=U[M];return y?(y.start=Math.min(y.start,H),y.end=Math.max(y.end,W)):(y={start:H,end:W,loaded:new a},U[M]=y),await y.loaded.promise.then((U=>new Uint8Array(U.buffer,U.byteOffset+b-y.start,A)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?M(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?M(this._materialBufferLODs,this._materialIndexLOD):M(this._bufferLODs,0)}return null}_loadBufferLOD(U,M){const b=U[M];b&&(this._loader.log(`Loading buffer range [${b.start}-${b.end}]`),this._loader.bin.readAsync(b.start,b.end-b.start+1).then((U=>{b.loaded.resolve(U)}),(U=>{b.loaded.reject(U)})))}_getLODs(U,M,b,a){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const A=[];for(let H=a.length-1;H>=0;H--)if(A.push(T.Get(`${U}/ids/${a[H]}`,b,a[H])),A.length===this.maxLODsToLoad)return A;return A.push(M),A}_disposeTransformNode(U){const M=[],b=U.material;b&&M.push(b);for(const A of U.getChildMeshes())A.material&&M.push(A.material);U.dispose();const a=M.filter((U=>this._loader.babylonScene.meshes.every((M=>M.material!=U))));this._disposeMaterials(a)}_disposeMaterials(U){const M={};for(const b of U){for(const U of b.getActiveTextures())M[U.uniqueId]=U;b.dispose()}for(const b in M)for(const U of this._loader.babylonScene.materials)U.hasTexture(M[b])&&delete M[b];for(const b in M)M[b].dispose()}}p(xb),j(xb,!0,(U=>new Pb(U)));const Zb="MSFT_minecraftMesh";class Cb{constructor(U){this.name=Zb,this._loader=U,this.enabled=this._loader.isExtensionUsed(Zb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtraAsync(U,M,this.name,(async(a,A)=>{if(A){if(!(b instanceof Y))throw new Error(`${a}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(U,M,b);return b.needAlphaBlending()&&(b.forceDepthWrite=!0,b.separateCullingPass=!0),b.vk=b.forceDepthWrite,b.twoSidedLighting=!0,await A}}))}}p(Zb),j(Zb,!0,(U=>new Cb(U)));const rb="MSFT_sRGBFactors";class Bb{constructor(U){this.name=rb,this._loader=U,this.enabled=this._loader.isExtensionUsed(rb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,M,b){return l.LoadExtraAsync(U,M,this.name,(async(a,A)=>{if(A){if(!(b instanceof Y))throw new Error(`${a}: Material type not supported`);const A=this._loader.loadMaterialPropertiesAsync(U,M,b),H=b.va().getEngine().useExactSrgbConversions;return b.albedoTexture||b.albedoColor.toLinearSpaceToRef(b.albedoColor,H),b.reflectivityTexture||b.reflectivityColor.toLinearSpaceToRef(b.reflectivityColor,H),await A}}))}}p(rb),j(rb,!0,(U=>new Bb(U)));var Jb=b(12755);const Fb={};var fb=b(12814),Lb=b(12793),zb=b(12763),ob=b(12775);function Sb(U,M){for(const b of U)for(const U of b.dataOutputs)if(U.uniqueId===M)return U;throw new Error("Could not find data out connection with unique id "+M)}function hb(U,M){for(const b of U)if(b instanceof Lb.c)for(const U of b.signalInputs)if(U.uniqueId===M)return U;throw new Error("Could not find signal in connection with unique id "+M)}async function ib(U,M){const a=await Promise.all(U.allBlocks.map((async U=>{const M=function(U){switch(U){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([b.e(49),b.e(54)]).then(b.bind(b,13954))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await b.e(55).then(b.bind(b,13959))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await b.e(56).then(b.bind(b,13966))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await b.e(57).then(b.bind(b,13975))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await b.e(58).then(b.bind(b,13983))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await b.e(59).then(b.bind(b,13985))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await b.e(60).then(b.bind(b,13987))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await b.e(61).then(b.bind(b,13990))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await b.e(62).then(b.bind(b,13992))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await b.e(65).then(b.bind(b,14023))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await b.e(65).then(b.bind(b,14023))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await b.e(65).then(b.bind(b,14023))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await b.e(65).then(b.bind(b,14023))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await b.e(70).then(b.bind(b,14032))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await b.e(71).then(b.bind(b,14038))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await b.e(72).then(b.bind(b,14042))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await b.e(73).then(b.bind(b,14050))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await b.e(74).then(b.bind(b,14052))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await b.e(75).then(b.bind(b,14058))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await b.e(76).then(b.bind(b,14067))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await b.e(77).then(b.bind(b,14071))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await b.e(78).then(b.bind(b,14075))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await b.e(79).then(b.bind(b,14084))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await b.e(80).then(b.bind(b,14093))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await b.e(81).then(b.bind(b,14098))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await b.e(82).then(b.bind(b,14107))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await b.e(83).then(b.bind(b,14110))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await b.e(84).then(b.bind(b,14114))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await b.e(85).then(b.bind(b,14116))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await b.e(86).then(b.bind(b,14118))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await b.e(87).then(b.bind(b,14125))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await b.e(88).then(b.bind(b,14131))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await b.e(67).then(b.bind(b,14134))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await b.e(89).then(b.bind(b,14140))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await b.e(90).then(b.bind(b,14142))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await b.e(91).then(b.bind(b,14149))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await b.e(68).then(b.bind(b,14157))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await b.e(63).then(b.bind(b,13997))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await b.e(69).then(b.bind(b,14159))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await b.e(64).then(b.bind(b,14021))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await b.e(65).then(b.bind(b,14023))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await b.e(65).then(b.bind(b,14023))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await b.e(66).then(b.bind(b,14161))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await b.e(66).then(b.bind(b,14161))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await b.e(66).then(b.bind(b,14161))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await b.e(66).then(b.bind(b,14161))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await b.e(66).then(b.bind(b,14161))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await b.e(66).then(b.bind(b,14161))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await b.e(92).then(b.bind(b,14163))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await b.e(93).then(b.bind(b,14167))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await b.e(94).then(b.bind(b,14172))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await b.e(95).then(b.bind(b,14178))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await b.e(96).then(b.bind(b,14181))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await b.e(97).then(b.bind(b,14189))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await b.e(98).then(b.bind(b,14194))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await b.e(99).then(b.bind(b,14201))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await b.e(100).then(b.bind(b,14204))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await b.e(101).then(b.bind(b,14212))).FlowGraphDataSwitchBlock;default:if(Fb[U])return Fb[U];throw new Error(`Unknown block name ${U}`)}}(U.className);return await M()})));return function(U,M,b){const a=M.coordinator.createGraph(),A=[],H=M.valueParseFunction??zb.e;for(let W=0;W<U.allBlocks.length;W++){const y=db(U.allBlocks[W],{$e:M.coordinator.config.$e,pathConverter:M.pathConverter,assetsContainer:M.coordinator.config.$e,valueParseFunction:H},b[W]);A.push(y),y instanceof fb.b&&a.addEventBlock(y)}for(const W of A){for(const U of W.dataInputs)for(const M of U.connectedPointIds){const b=Sb(A,M);U.connectTo(b)}if(W instanceof Lb.c)for(const U of W.signalOutputs)for(const M of U.connectedPointIds){const b=hb(A,M);U.connectTo(b)}}for(const W of U.executionContexts)Yb(W,{graph:a,valueParseFunction:H},U.rightHanded);return a}(U,M,a)}function Yb(U,M,b){const a=M.graph.createContext();U.enableLogging&&(a.enableLogging=!0),a.treatDataAsRightHanded=b||!1;const A=M.valueParseFunction??zb.e;a.uniqueId=U.uniqueId;const H=a.va();if(U._assetsContext){var W,y,O,e,x,P,Z,C,r,B;const M=U._assetsContext,b={meshes:null===(W=M.meshes)||void 0===W?void 0:W.map((U=>H.getMeshById(U))),lights:null===(y=M.lights)||void 0===y?void 0:y.map((U=>H.getLightByName(U))),cameras:null===(O=M.cameras)||void 0===O?void 0:O.map((U=>H.getCameraByName(U))),materials:null===(e=M.materials)||void 0===e?void 0:e.map((U=>H.getMaterialById(U))),textures:null===(x=M.textures)||void 0===x?void 0:x.map((U=>H.getTextureByName(U))),animations:null===(P=M.animations)||void 0===P?void 0:P.map((U=>H.animations.find((M=>M.name===U)))),skeletons:null===(Z=M.skeletons)||void 0===Z?void 0:Z.map((U=>H.getSkeletonByName(U))),Ik:null===(C=M.Ik)||void 0===C?void 0:C.map((U=>H.getParticleSystemById(U))),animationGroups:null===(r=M.animationGroups)||void 0===r?void 0:r.map((U=>H.getAnimationGroupByName(U))),transformNodes:null===(B=M.transformNodes)||void 0===B?void 0:B.map((U=>H.getTransformNodeById(U))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],vm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};a.assetsContext=b}for(const J in U._userVariables){const M=A(J,U._userVariables,a.assetsContext,H);a.userVariables[J]=M}for(const J in U._connectionValues){const M=A(J,U._connectionValues,a.assetsContext,H);a._setConnectionValueByKey(J,M)}return a}function db(U,M,b){const a={},A=M.valueParseFunction??zb.e;if(U.config)for(const W in U.config)a[W]=A(W,U.config,M.assetsContainer||M.$e,M.$e);if((0,zb.m)(U.className)){if(!M.pathConverter)throw new Error("Path converter is required for this block");a.pathConverter=M.pathConverter}const H=new b(a);H.uniqueId=U.uniqueId;for(let W=0;W<U.dataInputs.length;W++){const M=H.getDataInput(U.dataInputs[W].name);if(!M)throw new Error("Could not find data input with name "+U.dataInputs[W].name+" in block "+U.className);M.deserialize(U.dataInputs[W])}for(let W=0;W<U.dataOutputs.length;W++){const M=H.getDataOutput(U.dataOutputs[W].name);if(!M)throw new Error("Could not find data output with name "+U.dataOutputs[W].name+" in block "+U.className);M.deserialize(U.dataOutputs[W])}return H.metadata=U.metadata,H.deserialize&&H.deserialize(U),H}function sb(U){const[M,b]=U.split(":");return qb({op:M,extension:b})}function qb(U){var M;let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const a=U.extension?null===(M=nb[U.extension])||void 0===M?void 0:M[U.op]:Eb[U.op];if(!a&&(B.b.Warn(`No mapping found for operation ${U.op} and extension ${U.extension||"KHR_interactivity"}`),b)){const M={},b={flows:{}};if(U.inputValueSockets){M.values={};for(const b in U.inputValueSockets)M.values[b]={name:b}}return U.outputValueSockets&&(b.values={},Object.keys(U.outputValueSockets).forEach((U=>{b.values[U]={name:U}}))),{$k:[],inputs:M,outputs:b}}return a}function mb(U,M,b){nb[M]||(nb[M]={}),nb[M][U]=b}const nb={BABYLON:{"flow/log":{$k:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Eb={"event/onStart":{$k:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{$k:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{$k:["FlowGraphSendCustomEventBlock"],extraProcessor(U,M,b,a,A){if("event/send"!==M.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const H=U.configuration.event.value[0];if("number"!==typeof H)throw new Error("Event id should be a number");const W=a.arrays.events[H],y=A[0];return y.config||(y.config={}),y.config.eventId=W.eventId,y.config.eventData=W.eventData,A}},"event/receive":{$k:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(U,M){var b;if(!U.configuration)return B.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const a=U.configuration.event;if(!a)return B.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const A=a.value[0];if("number"!==typeof A)return B.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(b=M.events)||void 0===b?void 0:b[A])?{valid:!0}:(B.b.Error(`Event with id ${A} not found`),{valid:!1,error:`Event with id ${A} not found`})},extraProcessor(U,M,b,a,A){if("event/receive"!==M.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const H=U.configuration.event.value[0];if("number"!==typeof H)throw new Error("Event id should be a number");const W=a.arrays.events[H],y=A[0];return y.config||(y.config={}),y.config.eventId=W.eventId,y.config.eventData=W.eventData,A}},"math/e":Xb("FlowGraphEBlock"),"math/pi":Xb("FlowGraphPIBlock"),"math/inf":Xb("FlowGraphInfBlock"),"math/nan":Xb("FlowGraphNaNBlock"),"math/abs":Xb("FlowGraphAbsBlock"),"math/sign":Xb("FlowGraphSignBlock"),"math/trunc":Xb("FlowGraphTruncBlock"),"math/floor":Xb("FlowGraphFloorBlock"),"math/ceil":Xb("FlowGraphCeilBlock"),"math/round":{$k:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.roundHalfAwayFromZero=!0,A}},"math/fract":Xb("FlowGraphFractBlock"),"math/neg":Xb("FlowGraphNegationBlock"),"math/add":Xb("FlowGraphAddBlock",["a","b"],!0),"math/sub":Xb("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{$k:["FlowGraphMultiplyBlock"],extraProcessor(U,M,b,a,A){var H;(H=A[0]).config||(H.config={}),A[0].config.useMatrixPerComponent=!0,A[0].config.preventIntegerFloatArithmetic=!0;let W=-1;return Object.keys(U.values||{}).find((M=>{var b;return void 0!==(null===(b=U.values)||void 0===b?void 0:b[M].type)&&(W=U.values[M].type,!0)})),-1!==W&&(A[0].config.type=a.arrays.types[W].flowGraphType),A},validation:U=>U.values?Qb(U):{valid:!0}},"math/div":Xb("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Xb("FlowGraphModuloBlock",["a","b"]),"math/min":Xb("FlowGraphMinBlock",["a","b"]),"math/max":Xb("FlowGraphMaxBlock",["a","b"]),"math/clamp":Xb("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Xb("FlowGraphSaturateBlock"),"math/mix":Xb("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Xb("FlowGraphEqualityBlock",["a","b"]),"math/lt":Xb("FlowGraphLessThanBlock",["a","b"]),"math/le":Xb("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Xb("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Xb("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Xb("FlowGraphIsNaNBlock"),"math/isinf":Xb("FlowGraphIsInfBlock"),"math/select":{$k:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{$k:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Xb("FlowGraphSinBlock"),"math/cos":Xb("FlowGraphCosBlock"),"math/tan":Xb("FlowGraphTanBlock"),"math/asin":Xb("FlowGraphASinBlock"),"math/acos":Xb("FlowGraphACosBlock"),"math/atan":Xb("FlowGraphATanBlock"),"math/atan2":Xb("FlowGraphATan2Block",["a","b"]),"math/sinh":Xb("FlowGraphSinhBlock"),"math/cosh":Xb("FlowGraphCoshBlock"),"math/tanh":Xb("FlowGraphTanhBlock"),"math/asinh":Xb("FlowGraphASinhBlock"),"math/acosh":Xb("FlowGraphACoshBlock"),"math/atanh":Xb("FlowGraphATanhBlock"),"math/exp":Xb("FlowGraphExponentialBlock"),"math/log":Xb("FlowGraphLogBlock"),"math/log2":Xb("FlowGraphLog2Block"),"math/log10":Xb("FlowGraphLog10Block"),"math/sqrt":Xb("FlowGraphSquareRootBlock"),"math/cbrt":Xb("FlowGraphCubeRootBlock"),"math/pow":Xb("FlowGraphPowerBlock",["a","b"]),"math/length":Xb("FlowGraphLengthBlock"),"math/normalize":Xb("FlowGraphNormalizeBlock"),"math/dot":Xb("FlowGraphDotBlock",["a","b"]),"math/cross":Xb("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Xb("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Xb("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{$k:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{$k:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{$k:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{$k:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{$k:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{$k:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{$k:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Xb("FlowGraphTransposeBlock"),"math/determinant":Xb("FlowGraphDeterminantBlock"),"math/inverse":Xb("FlowGraphInvertMatrixBlock"),"math/matmul":Xb("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{$k:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"zd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A,H){const W=A[0].dataInputs.find((U=>"rotationQuaternion"===U.name));if(!W)throw new Error("Rotation quaternion input not found");return H._connectionValues[W.uniqueId]&&(H._connectionValues[W.uniqueId].type="Quaternion"),A}},"math/matDecompose":{$k:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"zd"}}}},"math/quatConjugate":Xb("FlowGraphConjugateBlock",["a"]),"math/quatMul":{$k:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.type="Quaternion",A}},"math/quatAngleBetween":Xb("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{$k:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Xb("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Xb("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{$k:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract2x2":{$k:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{$k:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract3x3":{$k:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{$k:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A){var H;return(H=A[0]).config||(H.config={}),A[0].config.inputIsColumnMajor=!0,A}},"math/extract4x4":{$k:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{$k:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A,H){var W,y;(y=A[0]).config||(y.config={});const O=A[0].dataInputs[0];return A[0].config.valueType=(null===(W=H._connectionValues[O.uniqueId])||void 0===W?void 0:W.type)??"FlowGraphInteger",A}},"math/and":{$k:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A,H){var W,y,O;(O=A[0]).config||(O.config={});const e=A[0].dataInputs[0],x=A[0].dataInputs[1];return A[0].config.valueType=(null===(W=H._connectionValues[e.uniqueId])||void 0===W?void 0:W.type)??(null===(y=H._connectionValues[x.uniqueId])||void 0===y?void 0:y.type)??"FlowGraphInteger",A}},"math/or":{$k:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A,H){var W,y,O;(O=A[0]).config||(O.config={});const e=A[0].dataInputs[0],x=A[0].dataInputs[1];return A[0].config.valueType=(null===(W=H._connectionValues[e.uniqueId])||void 0===W?void 0:W.type)??(null===(y=H._connectionValues[x.uniqueId])||void 0===y?void 0:y.type)??"FlowGraphInteger",A}},"math/xor":{$k:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,M,b,a,A,H){var W,y,O;(O=A[0]).config||(O.config={});const e=A[0].dataInputs[0],x=A[0].dataInputs[1];return A[0].config.valueType=(null===(W=H._connectionValues[e.uniqueId])||void 0===W?void 0:W.type)??(null===(y=H._connectionValues[x.uniqueId])||void 0===y?void 0:y.type)??"FlowGraphInteger",A}},"math/asr":Xb("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Xb("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Xb("FlowGraphLeadingZerosBlock"),"math/ctz":Xb("FlowGraphTrailingZerosBlock"),"math/popcnt":Xb("FlowGraphOneBitsCounterBlock"),"math/rad":Xb("FlowGraphDegToRadBlock"),"math/deg":Xb("FlowGraphRadToDegBlock"),"type/boolToInt":Xb("FlowGraphBooleanToInt"),"type/boolToFloat":Xb("FlowGraphBooleanToFloat"),"type/intToBool":Xb("FlowGraphIntToBoolean"),"type/intToFloat":Xb("FlowGraphIntToFloat"),"type/floatToInt":Xb("FlowGraphFloatToInt"),"type/floatToBool":Xb("FlowGraphFloatToBoolean"),"flow/sequence":{$k:["FlowGraphSequenceBlock"],extraProcessor(U,M,b,a,A){const H=A[0];return H.config||(H.config={}),H.config.outputSignalCount=Object.keys(U.flows||[]).length,H.signalOutputs.forEach(((U,M)=>{U.name="out_"+M})),A}},"flow/branch":{$k:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{$k:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(U){if(U.configuration&&U.configuration.cases){const M=U.configuration.cases.value;if(!M.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return B.b.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const b=new Set(M);U.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(U,M,b,a,A){if("flow/switch"!==M.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return A[0].signalOutputs.forEach((U=>{"default"!==U.name&&(U.name="out_"+U.name)})),A}},"flow/while":{$k:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{$k:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(U,M,b,a,A){const H=A[0];return H.config||(H.config={}),H.config.incrementIndexWhenLoopDone=!0,A}},"flow/doN":{$k:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{$k:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(U,M,b,a,A){if("flow/multiGate"!==M.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const H=A[0];return H.config||(H.config={}),H.config.outputSignalCount=Object.keys(U.flows).length,H.signalOutputs.forEach(((U,M)=>{U.name="out_"+M})),A}},"flow/waitAll":{$k:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(U){var M,b;return"number"!==typeof(null===(M=U.configuration)||void 0===M||null===(b=M.inputFlows)||void 0===b?void 0:b.value[0])&&(U.configuration=U.configuration||{inputFlows:{value:[0]}},U.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{$k:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{$k:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{$k:["FlowGraphCancelDelayBlock"]},"variable/get":{$k:["FlowGraphGetVariableBlock"],validation(U){var M,b;return null!==(M=U.configuration)&&void 0!==M&&null!==(b=M.variable)&&void 0!==b&&b.value?{valid:!0}:(B.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,M)=>[M.getVariableName(U[0])]}}},"variable/set":{$k:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,M)=>[M.getVariableName(U[0])]}}},"variable/setMultiple":{$k:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(U,M)=>[U[0].map((U=>M.getVariableName(U)))]}},extraProcessor:(U,M,b,a,A)=>(A[0].dataInputs.forEach((U=>{U.name=a.getVariableName(+U.name)})),A)},"variable/interpolate":{$k:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(U,M)=>[M.getVariableName(U[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:U=>!0===U[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(U,M,b,a,A){var H,W,y;const O=A[0],e=null===(H=U.configuration)||void 0===H?void 0:H.variable.value[0];if("number"!==typeof e)throw B.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const x=a.arrays.staticVariables[e];"undefined"===typeof O.config.animationType.value&&(a.arrays.staticVariables,O.config.animationType.value=(0,ob.I)(x.type));const P=A[4];return P.config||(P.config={}),(W=P.config).variable||(W.variable={}),P.config.variable.value=a.getVariableName(e),(y=A[3]).config||(y.config={}),A}},"pointer/get":{$k:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,M,b,a,A)=>(A.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),A)},"pointer/set":{$k:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,M,b,a,A)=>(A.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),A)},"pointer/interpolate":{$k:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,M,b,a,A)=>(A.forEach((M=>{"FlowGraphJsonPointerParserBlock"===M.className?(M.config||(M.config={}),M.config.outputValue=!0):"FlowGraphInterpolationBlock"===M.className&&(M.config||(M.config={}),Object.keys(U.values||[]).forEach((b=>{var A;const H=null===(A=U.values)||void 0===A?void 0:A[b];if("value"===b&&H){const U=H.type;void 0!==U&&(M.config.animationType=a.arrays.types[U].flowGraphType)}})))})),A)},"animation/start":{$k:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(U,M)=>[U[0]*M._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(U,M)=>[U[0]*M._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,M,b,a,A,H,W){const y=A[A.length-1];return y.config||(y.config={}),y.config.glTF=W,A}},"animation/stop":{$k:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,M,b,a,A,H,W){const y=A[A.length-1];return y.config||(y.config={}),y.config.glTF=W,A}},"animation/stopAt":{$k:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(U,M)=>[U[0]*M._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,M,b,a,A,H,W){const y=A[A.length-1];return y.config||(y.config={}),y.config.glTF=W,A}},"math/switch":{$k:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(U){if(U.configuration&&U.configuration.cases){const M=U.configuration.cases.value;if(!M.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return B.b.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const b=new Set(M);U.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(U,M,b,a,A){const H=A[0];return H.dataInputs.forEach((U=>{"default"!==U.name&&"case"!==U.name&&(U.name="in_"+U.name)})),H.config||(H.config={}),H.config.treatCasesAsIntegers=!0,A}},"debug/log":{$k:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Xb(U){let M=arguments.length>2?arguments[2]:void 0;return{$k:[U],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((U,M)=>(U[M]={name:M},U)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(U,b,a,A,H){var W;if(M){(W=H[0]).config||(W.config={}),H[0].config.preventIntegerFloatArithmetic=!0;let M=-1;Object.keys(U.values||{}).find((b=>{var a;return void 0!==(null===(a=U.values)||void 0===a?void 0:a[b].type)&&(M=U.values[b].type,!0)})),-1!==M&&(H[0].config.type=A.arrays.types[M].flowGraphType)}return H},validation:U=>M?Qb(U):{valid:!0}}}function Qb(U){if(U.values){const M=Object.keys(U.values).map((M=>U.values[M].type)).filter((U=>void 0!==U));if(!M.every((U=>U===M[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Eb["math/compose"]=Eb["math/matCompose"],Eb["math/decompose"]=Eb["math/matDecompose"];var Ib=b(614);const vb={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"lk",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class tb{constructor(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=U,this._gltf=M,this._animationTargetFps=b,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const U of this._interactivityGraph.types)this._types.push(vb[U.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const U of this._interactivityGraph.declarations){const M=qb(U);if(!M)throw B.b.Error(["No mapping found for declaration",U]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:M,fullOperationName:U.extension?U.op+":"+U.extension:U.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const U of this._interactivityGraph.variables){const M=this._parseVariable(U);this._staticVariables.push(M)}}_parseVariable(U,M){const b=this._types[U.type];if(!b)throw B.b.Error(["No type found for variable",U]),new Error("Error parsing variables");if(U.value&&U.value.length!==b.length)throw B.b.Error(["Invalid value length for variable",U,b]),new Error("Error parsing variables");const a=U.value||[];if(!a.length)switch(b.flowGraphType){case"boolean":a.push(!1);break;case"FlowGraphInteger":a.push(0);break;case"number":a.push(NaN);break;case"Vector2":a.push(NaN,NaN);break;case"lk":a.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":a.fill(NaN,0,4);break;case"Matrix":a.fill(NaN,0,16);break;case"Matrix3D":a.fill(NaN,0,9)}return"number"===b.elementType&&"string"===typeof a[0]&&(a[0]=parseFloat(a[0])),{type:b.flowGraphType,value:M?M(a,this):a}}_parseEvents(){if(this._interactivityGraph.events)for(const U of this._interactivityGraph.events){const M={eventId:U.id||"internalEvent_"+this._internalEventsCounter++};U.values&&(M.eventData=Object.keys(U.values).map((M=>{var b;const a=null===(b=U.values)||void 0===b?void 0:b[M];if(!a)throw B.b.Error(["No value found for event key",M]),new Error("Error parsing events");const A=this._types[a.type];if(!A)throw B.b.Error(["No type found for event value",a]),new Error("Error parsing events");const H="undefined"!==typeof a.value?this._parseVariable(a):void 0;return{id:M,type:A.flowGraphType,eventData:!0,value:H}}))),this._events.push(M)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const M of this._interactivityGraph.nodes){if("number"!==typeof M.declaration)throw B.b.Error(["No declaration found for node",M]),new Error("Error parsing nodes");const b=this._mappings[M.declaration];if(!b)throw B.b.Error(["No mapping found for node",M]),new Error("Error parsing nodes");if(b.flowGraphMapping.validation){const a=b.flowGraphMapping.validation(M,this._interactivityGraph,this._gltf);var U;if(!a.valid)throw new Error(`Error validating interactivity node ${null===(U=this._interactivityGraph.declarations)||void 0===U?void 0:U[M.declaration].op} - ${a.error}`)}const a=[];for(const U of b.flowGraphMapping.$k){const A=this._getEmptyBlock(U,b.fullOperationName);this._parseNodeConfiguration(M,A,b.flowGraphMapping,U),a.push(A)}this._nodes.push({$k:a,fullOperationName:b.fullOperationName})}}_getEmptyBlock(U,M){return{uniqueId:(0,Ib.d)(),className:U,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:M,metadata:{}}}_parseNodeConfiguration(U,M,b,a){const A=M.config;if(U.configuration){const M=Object.keys(U.configuration);for(const y of M){var H,W;const M=null===(H=U.configuration)||void 0===H?void 0:H[y];if(!M)throw B.b.Error(["No value found for node configuration",y]),new Error("Error parsing node configuration");const O=null===(W=b.configuration)||void 0===W?void 0:W[y];if(O&&O.toBlock?O.toBlock===a:0===b.$k.indexOf(a)){const U=(null===O||void 0===O?void 0:O.name)||y;M&&"undefined"!==typeof M.value||"undefined"===typeof(null===O||void 0===O?void 0:O.defaultValue)?M.value.length>=0?A[U]={value:1===M.value.length?M.value[0]:M.value}:B.b.Warn(["Invalid value for node configuration",M]):A[U]={value:O.defaultValue},O&&O.dataTransformer&&(A[U].value=O.dataTransformer([A[U].value],this)[0])}}}}_parseNodeConnections(U){for(let S=0;S<this._nodes.length;S++){var M;const h=null===(M=this._interactivityGraph.nodes)||void 0===M?void 0:M[S];if(!h)throw B.b.Error(["No node found for interactivity node",this._nodes[S]]),new Error("Error parsing node connections");const i=this._nodes[S],Y=this._mappings[h.declaration];if(!Y)throw B.b.Error(["No mapping found for node",h]),new Error("Error parsing node connections");const d=h.flows||{},s=Object.keys(d).sort();for(const U of s){var b,a,A,H;const M=d[U],e=null===(b=Y.flowGraphMapping.outputs)||void 0===b||null===(a=b.flows)||void 0===a?void 0:a[U],x=(null===e||void 0===e?void 0:e.name)||U,P=this._createNewSocketConnection(x,!0);(e&&e.toBlock&&i.$k.find((U=>U.className===e.toBlock))||i.$k[0]).signalOutputs.push(P);const Z=M.node,C=this._nodes[Z];if(!C)throw B.b.Error(["No node found for input node id",Z]),new Error("Error parsing node connections");const r=sb(C.fullOperationName);if(!r)throw B.b.Error(["No mapping found for input node",C]),new Error("Error parsing node connections");let J=null===(A=r.inputs)||void 0===A||null===(H=A.flows)||void 0===H?void 0:H[M.socket||"in"],F=!1;if(!J)for(const U in null===(W=r.inputs)||void 0===W?void 0:W.flows){var W,y,O;if(U.startsWith("[")&&U.endsWith("]"))F=!0,J=null===(y=r.inputs)||void 0===y||null===(O=y.flows)||void 0===O?void 0:O[U]}const f=J?F?J.name.replace("$1",M.socket||""):J.name:M.socket||"in",L=J&&J.toBlock&&C.$k.find((U=>U.className===J.toBlock))||C.$k[0];let z=L.signalInputs.find((U=>U.name===f));z||(z=this._createNewSocketConnection(f),L.signalInputs.push(z)),z.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(z.uniqueId)}const q=h.values||{},m=Object.keys(q);for(const M of m){var e,x;const b=q[M];let a=null===(e=Y.flowGraphMapping.inputs)||void 0===e||null===(x=e.values)||void 0===x?void 0:x[M],A=!1;if(!a)for(const U in null===(P=Y.flowGraphMapping.inputs)||void 0===P?void 0:P.values){var P,Z,C;if(U.startsWith("[")&&U.endsWith("]"))A=!0,a=null===(Z=Y.flowGraphMapping.inputs)||void 0===Z||null===(C=Z.values)||void 0===C?void 0:C[U]}const H=a?A?a.name.replace("$1",M):a.name:M,W=this._createNewSocketConnection(H);if((a&&a.toBlock&&i.$k.find((U=>U.className===a.toBlock))||i.$k[0]).dataInputs.push(W),void 0!==b.value){const M=this._parseVariable(b,a&&a.dataTransformer);U._connectionValues[W.uniqueId]=M}else{if("undefined"===typeof b.node)throw B.b.Error(["Invalid value for value connection",b]),new Error("Error parsing node connections");{var r,J,F;const U=b.node,M=b.socket||"value",a=this._nodes[U];if(!a)throw B.b.Error(["No node found for output socket reference",b]),new Error("Error parsing node connections");const A=sb(a.fullOperationName);if(!A)throw B.b.Error(["No mapping found for output socket reference",b]),new Error("Error parsing node connections");let H=null===(r=A.outputs)||void 0===r||null===(J=r.values)||void 0===J?void 0:J[M],y=!1;if(!H)for(const b in null===(f=A.outputs)||void 0===f?void 0:f.values){var f,L,z;if(b.startsWith("[")&&b.endsWith("]"))y=!0,H=null===(L=A.outputs)||void 0===L||null===(z=L.values)||void 0===z?void 0:z[b]}const O=H?y?H.name.replace("$1",M):null===(F=H)||void 0===F?void 0:F.name:M,e=H&&H.toBlock&&a.$k.find((U=>U.className===H.toBlock))||a.$k[0];let x=e.dataOutputs.find((U=>U.name===O));x||(x=this._createNewSocketConnection(O,!0),e.dataOutputs.push(x)),W.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(W.uniqueId)}}}if(Y.flowGraphMapping.interBlockConnectors)for(const U of Y.flowGraphMapping.interBlockConnectors){const M=U.input,b=U.output,a=U.isVariable;this._connectFlowGraphNodes(M,b,i.$k[U.inputBlockIndex],i.$k[U.outputBlockIndex],a)}if(Y.flowGraphMapping.extraProcessor){var o;const M=null===(o=this._interactivityGraph.declarations)||void 0===o?void 0:o[h.declaration];if(!M)throw B.b.Error(["No declaration found for extra processor",h]),new Error("Error parsing node connections");i.$k=Y.flowGraphMapping.extraProcessor(h,M,Y.flowGraphMapping,this,i.$k,U,this._gltf)}}}_createNewSocketConnection(U,M){return{uniqueId:(0,Ib.d)(),name:U,_connectionType:M?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(U,M,b,a,A){const H=A?b.dataInputs:b.signalInputs,W=A?a.dataOutputs:a.signalOutputs,y=H.find((M=>M.name===U))||this._createNewSocketConnection(U),O=W.find((U=>U.name===M))||this._createNewSocketConnection(M,!0);H.find((M=>M.name===U))||H.push(y),W.find((U=>U.name===M))||W.push(O),y.connectedPointIds.push(O.uniqueId),O.connectedPointIds.push(y.uniqueId)}getVariableName(U){return"staticVariable_"+U}serializeToFlowGraph(){const U={uniqueId:(0,Ib.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(U);for(let M=0;M<this._staticVariables.length;M++){const b=this._staticVariables[M];U._userVariables[this.getVariableName(M)]=b}return{rightHanded:!0,allBlocks:this._nodes.reduce(((U,M)=>U.concat(M.$k)),[]),executionContexts:[U]}}}const Vb="KHR_interactivity";class kb{constructor(U){this._loader=U,this.name=Vb,this.enabled=this._loader.isExtensionUsed(Vb),this._pathConverter=(0,g.j)(this._loader.Wk),U._skipStartAnimationStep=!0;const M=U.babylonScene;M&&function(U){(0,g.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!U.activeCamera)return new A.e(NaN,NaN,NaN,NaN);const M=A.e.FromRotationMatrix(U.activeCamera.getWorldMatrix()).normalize();return U.useRightHandedSystem||(M.w*=-1,M.x*=-1),M},type:"Quaternion",getTarget:()=>U.activeCamera}),(0,g.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!U.activeCamera)return new A.l(NaN,NaN,NaN);const M=U.activeCamera.getWorldMatrix().getTranslation();return U.useRightHandedSystem||(M.x*=-1),M},type:"lk",getTarget:()=>U.activeCamera}),(0,g.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:U=>{var M;return(null===(M=U._babylonAnimationGroup)||void 0===M?void 0:M.isPlaying)??!1},type:"boolean",getTarget:U=>U._babylonAnimationGroup}),(0,g.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:U=>{var M;return((null===(M=U._babylonAnimationGroup)||void 0===M?void 0:M.from)??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,g.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:U=>{var M;return((null===(M=U._babylonAnimationGroup)||void 0===M?void 0:M.to)??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,g.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:U=>{var M;return((null===(M=U._babylonAnimationGroup)||void 0===M?void 0:M.getCurrentFrame())??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,g.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:U=>{var M;return((null===(M=U._babylonAnimationGroup)||void 0===M?void 0:M.getCurrentFrame())??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup})}(M)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var U;if(!this._loader.babylonScene||!this._pathConverter)return;const M=this._loader.babylonScene,b=null===(U=this._loader.Wk.extensions)||void 0===U?void 0:U.KHR_interactivity;if(!b)return;const a=new Jb.c({$e:M});a.dispatchEventsSynchronously=!1;const A=b.graphs.map((U=>new tb(U,this._loader.Wk,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(A.map((async U=>await ib(U,{coordinator:a,pathConverter:this._pathConverter})))),a.start()}}var Nb;Nb=async()=>(await Promise.resolve().then(b.bind(b,12833))).FlowGraphGLTFDataProvider,Fb[`${Vb}/${"FlowGraphGLTFDataProvider"}`]=Nb,p(Vb),j(Vb,!0,(U=>new kb(U)));const Rb="KHR_node_visibility";(0,g.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:U=>{const M=U._babylonTransformNode;return!M||void 0===M.isVisible||M.isVisible},set:(U,M)=>{var b,a;null===(b=M._primitiveBabylonMeshes)||void 0===b||b.forEach((U=>{U.inheritVisibility=!0})),M._babylonTransformNode&&(M._babylonTransformNode.isVisible=U),null===(a=M._primitiveBabylonMeshes)||void 0===a||a.forEach((M=>{M.isVisible=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class jb{constructor(U){this.name=Rb,this._loader=U,this.enabled=U.isExtensionUsed(Rb)}async onReady(){var U;null===(U=this._loader.Wk.nodes)||void 0===U||U.forEach((U=>{var M,b,a,A;(null===(M=U._primitiveBabylonMeshes)||void 0===M||M.forEach((U=>{U.inheritVisibility=!0})),null!==(b=U.extensions)&&void 0!==b&&b.KHR_node_visibility)&&(!1===(null===(a=U.extensions)||void 0===a?void 0:a.KHR_node_visibility.visible)&&(U._babylonTransformNode&&(U._babylonTransformNode.isVisible=!1),null===(A=U._primitiveBabylonMeshes)||void 0===A||A.forEach((U=>{U.isVisible=!1}))))}))}dispose(){this._loader=null}}p(Rb),j(Rb,!0,(U=>new jb(U)));const pb="KHR_node_selectability";mb("event/onSelect",pb,{$k:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:U=>["pickedMesh_"+U[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,M,b,a,A,H,W){var y,O,e,x,P,Z;const C=A[A.length-1];C.config=C.config||{},C.config.glTF=W;const r=null===(y=U.configuration)||void 0===y||null===(O=y.nodeIndex)||void 0===O?void 0:O.value[0];if(void 0===r||"number"!==typeof r)throw new Error("nodeIndex not found in configuration");const B="pickedMesh_"+r;return A[1].config.variable=B,H._userVariables[B]={className:"Mesh",id:null===W||void 0===W||null===(e=W.nodes)||void 0===e||null===(x=e[r]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===W||void 0===W||null===(P=W.nodes)||void 0===P||null===(Z=P[r]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},A}}),(0,g.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:U=>{const M=U._babylonTransformNode;return!M||void 0===M.Kf||M.Kf},set:(U,M)=>{var b;null===(b=M._primitiveBabylonMeshes)||void 0===b||b.forEach((M=>{M.Kf=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"Kf"],type:"boolean"});class gb{constructor(U){this.name=pb,this._loader=U,this.enabled=U.isExtensionUsed(pb)}async onReady(){var U;null===(U=this._loader.Wk.nodes)||void 0===U||U.forEach((U=>{var M,b,a;null!==(M=U.extensions)&&void 0!==M&&M.KHR_node_selectability&&!1===(null===(b=U.extensions)||void 0===b?void 0:b.KHR_node_selectability.selectable)&&(null===(a=U._babylonTransformNode)||void 0===a||a.getChildMeshes().forEach((U=>{U.Kf=!1})))}))}dispose(){this._loader=null}}p(pb),j(pb,!0,(U=>new gb(U)));const Kb="KHR_node_hoverability",wb="targetMeshPointerOver_";mb("event/onHoverIn",Kb,{$k:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:U=>[wb+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,M,b,a,A,H,W){var y,O,e,x,P,Z;const C=A[A.length-1];C.config=C.config||{},C.config.glTF=W;const r=null===(y=U.configuration)||void 0===y||null===(O=y.nodeIndex)||void 0===O?void 0:O.value[0];if(void 0===r||"number"!==typeof r)throw new Error("nodeIndex not found in configuration");const B=wb+r;return A[1].config.variable=B,H._userVariables[B]={className:"Mesh",id:null===W||void 0===W||null===(e=W.nodes)||void 0===e||null===(x=e[r]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===W||void 0===W||null===(P=W.nodes)||void 0===P||null===(Z=P[r]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},A}});const Tb="targetMeshPointerOut_";mb("event/onHoverOut",Kb,{$k:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:U=>[Tb+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,M,b,a,A,H,W){var y,O,e,x,P,Z;const C=A[A.length-1];C.config=C.config||{},C.config.glTF=W;const r=null===(y=U.configuration)||void 0===y||null===(O=y.nodeIndex)||void 0===O?void 0:O.value[0];if(void 0===r||"number"!==typeof r)throw new Error("nodeIndex not found in configuration");const B=Tb+r;return A[1].config.variable=B,H._userVariables[B]={className:"Mesh",id:null===W||void 0===W||null===(e=W.nodes)||void 0===e||null===(x=e[r]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===W||void 0===W||null===(P=W.nodes)||void 0===P||null===(Z=P[r]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},A}}),(0,g.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:U=>{const M=U._babylonTransformNode;return!M||void 0===M.pointerOverDisableMeshTesting||M.pointerOverDisableMeshTesting},set:(U,M)=>{var b;null===(b=M._primitiveBabylonMeshes)||void 0===b||b.forEach((M=>{M.pointerOverDisableMeshTesting=!U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Gb{constructor(U){this.name=Kb,this._loader=U,this.enabled=U.isExtensionUsed(Kb)}async onReady(){var U;null===(U=this._loader.Wk.nodes)||void 0===U||U.forEach((U=>{var M,b,a;null!==(M=U.extensions)&&void 0!==M&&M.KHR_node_hoverability&&!1===(null===(b=U.extensions)||void 0===b?void 0:b.KHR_node_hoverability.hoverable)&&(null===(a=U._babylonTransformNode)||void 0===a||a.getChildMeshes().forEach((U=>{U.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}p(Kb),j(Kb,!0,(U=>new Gb(U)));const lb="ExtrasAsMetadata";class Db{_assignExtras(U,M){if(M.extras&&Object.keys(M.extras).length>0){const b=U.metadata=U.metadata||{};(b.Wk=b.Wk||{}).extras=M.extras}}constructor(U){this.name=lb,this.enabled=!0,this._loader=U}dispose(){this._loader=null}loadNodeAsync(U,M,b){return this._loader.loadNodeAsync(U,M,(U=>{this._assignExtras(U,M),b(U)}))}loadCameraAsync(U,M,b){return this._loader.loadCameraAsync(U,M,(U=>{this._assignExtras(U,M),b(U)}))}createMaterial(U,M,b){const a=this._loader.createMaterial(U,M,b);return this._assignExtras(a,M),a}}p(lb),j(lb,!1,(U=>new Db(U)));b(12833)},12658:(U,M,b)=>{"use strict";b.d(M,{e:()=>E,h:()=>Y,i:()=>i,m:()=>d});var a=b(474),A=b(479),H=b(12297),W=b(470),y=b(792),O=b(788),e=b(497),x=b(524),P=b(12662),Z=b(12671),C=b(639),r=b(632);class B{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ik=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.vm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(U){this._environmentTexture=U}getNodes(){let U=[];U=U.concat(this.meshes),U=U.concat(this.lights),U=U.concat(this.cameras),U=U.concat(this.transformNodes);for(const M of this.skeletons)U=U.concat(M.bones);return U}}class J extends B{}class F{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const U=this.rootNodes;for(const a of U)a.dispose();U.length=0;const M=this.skeletons;for(const a of M)a.dispose();M.length=0;const b=this.animationGroups;for(const a of b)a.dispose();b.length=0}}class f extends B{constructor(U){super(),this._wasAddedToScene=!1,(U=U||x.d.LastCreatedScene)&&(this.$e=U,this.proceduralTextures=[],U.rk.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=U.getEngine().onContextRestoredObservable.add((()=>{for(const U of this.geometries)U._rebuild();for(const U of this.meshes)U._rebuild();for(const U of this.Ik)U.rebuild();for(const U of this.textures)U._rebuild()})))}_topologicalSort(U){const M=new Map;for(const W of U)M.set(W.uniqueId,W);const b={dependsOn:new Map,dependedBy:new Map};for(const W of U){const U=W.uniqueId;b.dependsOn.set(U,new Set),b.dependedBy.set(U,new Set)}for(const W of U){const U=W.uniqueId,a=b.dependsOn.get(U);if(W instanceof P.b){const A=W.sourceMesh;M.has(A.uniqueId)&&(a.add(A.uniqueId),b.dependedBy.get(A.uniqueId).add(U))}const A=b.dependedBy.get(U);for(const H of W.getDescendants()){const a=H.uniqueId;if(M.has(a)){A.add(a);b.dependsOn.get(a).add(U)}}}const a=[],A=[];for(const W of U){const U=W.uniqueId;0===b.dependsOn.get(U).size&&(A.push(W),M.delete(U))}const H=A;for(;H.length>0;){const U=H.shift();a.push(U);const A=b.dependedBy.get(U.uniqueId);for(const a of Array.from(A.values())){const A=b.dependsOn.get(a);A.delete(U.uniqueId),0===A.size&&M.get(a)&&(H.push(M.get(a)),M.delete(a))}}return M.size>0&&(e.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),M.forEach((U=>{e.b.Error(U.name)}))),a}_addNodeAndDescendantsToList(U,M,b,a){if(b&&(!a||a(b))&&!M.has(b.uniqueId)){U.push(b),M.add(b.uniqueId);for(const A of b.getDescendants(!0))this._addNodeAndDescendantsToList(U,M,A,a)}}_isNodeInContainer(U){return U instanceof O.e&&-1!==this.meshes.indexOf(U)||(U instanceof y.c&&-1!==this.transformNodes.indexOf(U)||(U instanceof Z.c&&-1!==this.lights.indexOf(U)||U instanceof C.c&&-1!==this.cameras.indexOf(U)))}_isValidHierarchy(){for(const U of this.meshes)if(U.parent&&!this._isNodeInContainer(U.parent))return e.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.transformNodes)if(U.parent&&!this._isNodeInContainer(U.parent))return e.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.lights)if(U.parent&&!this._isNodeInContainer(U.parent))return e.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.cameras)if(U.parent&&!this._isNodeInContainer(U.parent))return e.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(U){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||A.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const a={},H={},y=new F,O=[],e=[],x={doNotInstantiate:!0,...b},P=[],Z=new Set;for(const A of this.transformNodes)null===A.parent&&this._addNodeAndDescendantsToList(P,Z,A,x.predicate);for(const A of this.meshes)null===A.parent&&this._addNodeAndDescendantsToList(P,Z,A,x.predicate);const C=this._topologicalSort(P),r=(b,A)=>{if(((M,b)=>{if(a[M.uniqueId]=b.uniqueId,H[b.uniqueId]=b,U&&(b.name=U(M.name)),b instanceof W.c){const U=b;if(U.morphTargetManager){const b=M.morphTargetManager;U.morphTargetManager=b.clone();for(let M=0;M<b.numTargets;M++){const A=b.getTarget(M),W=U.morphTargetManager.getTarget(M);a[A.uniqueId]=W.uniqueId,H[W.uniqueId]=W}}}})(b,A),b.parent){const U=a[b.parent.uniqueId],M=H[U];A.parent=M||b.parent}if(A.position&&b.position&&A.position.p(b.position),A.rotationQuaternion&&b.rotationQuaternion&&A.rotationQuaternion.p(b.rotationQuaternion),A.rotation&&b.rotation&&A.rotation.p(b.rotation),A.zd&&b.zd&&A.zd.p(b.zd),A.material){const W=A;if(W.material)if(M){const M=b.material;if(-1===e.indexOf(M)){let b=M.clone(U?U(M.name):"Clone of "+M.name);if(e.push(M),a[M.uniqueId]=b.uniqueId,H[b.uniqueId]=b,"MultiMaterial"===M.getClassName()){const A=M;for(const M of A.Bk)M&&(b=M.clone(U?U(M.name):"Clone of "+M.name),e.push(M),a[M.uniqueId]=b.uniqueId,H[b.uniqueId]=b);A.Bk=A.Bk.map((U=>U&&H[a[U.uniqueId]]))}}"InstancedMesh"!==W.getClassName()&&(W.material=H[a[M.uniqueId]])}else"MultiMaterial"===W.material.getClassName()?-1===this.$e.multiMaterials.indexOf(W.material)&&this.$e.addMultiMaterial(W.material):-1===this.$e.materials.indexOf(W.material)&&this.$e.addMaterial(W.material)}null===A.parent&&y.rootNodes.push(A)};for(const A of C)if("InstancedMesh"===A.getClassName()){const U=A,M=U.sourceMesh,b=a[M.uniqueId];r(U,("number"===typeof b?H[b]:M).createInstance(U.name))}else{let U=!0;"Vk"===A.getClassName()||"Node"===A.getClassName()||A.skeleton||!A.getTotalVertices||0===A.getTotalVertices()?U=!1:x.doNotInstantiate&&(U="function"===typeof x.doNotInstantiate?!x.doNotInstantiate(A):!x.doNotInstantiate);const M=U?A.createInstance(`instance of ${A.name}`):A.clone(`Clone of ${A.name}`,null,!0);if(!M)throw new Error(`Could not clone or instantiate node on Asset Container ${A.name}`);r(A,M)}for(const A of this.skeletons){if(x.predicate&&!x.predicate(A))continue;const M=A.clone(U?U(A.name):"Clone of "+A.name);for(const U of this.meshes)if(U.skeleton===A&&!U.isAnInstance){const b=H[a[U.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=M,-1!==O.indexOf(M))continue;O.push(M);for(const U of M.bones)U._linkedTransformNode&&(U._linkedTransformNode=H[a[U._linkedTransformNode.uniqueId]])}y.skeletons.push(M)}for(const A of this.animationGroups){if(x.predicate&&!x.predicate(A))continue;const M=A.clone(U?U(A.name):"Clone of "+A.name,(U=>H[a[U.uniqueId]]||U));y.animationGroups.push(M)}return y}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||A.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.$e.environmentTexture=this.environmentTexture);for(const U of this.$e._serializableComponents)U.addFromContainer(this);this.$e.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const M=[];for(const b of this.cameras)U&&!U(b)||(this.$e.addCamera(b),M.push(b));for(const b of this.lights)U&&!U(b)||(this.$e.addLight(b),M.push(b));for(const b of this.meshes)U&&!U(b)||(this.$e.Gk(b),M.push(b));for(const b of this.skeletons)U&&!U(b)||this.$e.addSkeleton(b);for(const b of this.animations)U&&!U(b)||this.$e.addAnimation(b);for(const b of this.animationGroups)U&&!U(b)||this.$e.addAnimationGroup(b);for(const b of this.multiMaterials)U&&!U(b)||this.$e.addMultiMaterial(b);for(const b of this.materials)U&&!U(b)||this.$e.addMaterial(b);for(const b of this.morphTargetManagers)U&&!U(b)||this.$e.addMorphTargetManager(b);for(const b of this.geometries)U&&!U(b)||this.$e.addGeometry(b);for(const b of this.transformNodes)U&&!U(b)||(this.$e.addTransformNode(b),M.push(b));for(const b of this.actionManagers)U&&!U(b)||this.$e.addActionManager(b);for(const b of this.textures)U&&!U(b)||this.$e.addTexture(b);for(const b of this.reflectionProbes)U&&!U(b)||this.$e.addReflectionProbe(b);for(const b of M)b.parent&&-1===this.$e.getNodes().indexOf(b.parent)&&(b.setParent?b.setParent(null):b.parent=null)}removeAllFromScene(){this._isValidHierarchy()||A.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.$e.environmentTexture&&(this.$e.environmentTexture=null);for(const U of this.$e._serializableComponents)U.removeFromContainer(this)}removeFromScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const M of this.cameras)U&&!U(M)||this.$e.removeCamera(M);for(const M of this.lights)U&&!U(M)||this.$e.removeLight(M);for(const M of this.meshes)U&&!U(M)||this.$e.Hk(M,!0);for(const M of this.skeletons)U&&!U(M)||this.$e.removeSkeleton(M);for(const M of this.animations)U&&!U(M)||this.$e.removeAnimation(M);for(const M of this.animationGroups)U&&!U(M)||this.$e.removeAnimationGroup(M);for(const M of this.multiMaterials)U&&!U(M)||this.$e.removeMultiMaterial(M);for(const M of this.materials)U&&!U(M)||this.$e.removeMaterial(M);for(const M of this.morphTargetManagers)U&&!U(M)||this.$e.removeMorphTargetManager(M);for(const M of this.geometries)U&&!U(M)||this.$e.removeGeometry(M);for(const M of this.transformNodes)U&&!U(M)||this.$e.removeTransformNode(M);for(const M of this.actionManagers)U&&!U(M)||this.$e.removeActionManager(M);for(const M of this.textures)U&&!U(M)||this.$e.removeTexture(M);for(const M of this.reflectionProbes)U&&!U(M)||this.$e.removeReflectionProbe(M)}dispose(){const U=this.cameras.slice(0);for(const C of U)C.dispose();this.cameras.length=0;const M=this.lights.slice(0);for(const C of M)C.dispose();this.lights.length=0;const b=this.meshes.slice(0);for(const C of b)C.dispose();this.meshes.length=0;const a=this.skeletons.slice(0);for(const C of a)C.dispose();this.skeletons.length=0;const A=this.animationGroups.slice(0);for(const C of A)C.dispose();this.animationGroups.length=0;const H=this.multiMaterials.slice(0);for(const C of H)C.dispose();this.multiMaterials.length=0;const W=this.materials.slice(0);for(const C of W)C.dispose();this.materials.length=0;const y=this.geometries.slice(0);for(const C of y)C.dispose();this.geometries.length=0;const O=this.transformNodes.slice(0);for(const C of O)C.dispose();this.transformNodes.length=0;const e=this.actionManagers.slice(0);for(const C of e)C.dispose();this.actionManagers.length=0;const x=this.textures.slice(0);for(const C of x)C.dispose();this.textures.length=0;const P=this.reflectionProbes.slice(0);for(const C of P)C.dispose();this.reflectionProbes.length=0;const Z=this.morphTargetManagers.slice(0);for(const C of Z)C.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const C of this.$e._serializableComponents)C.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.$e.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(U,M,b){if(U&&M)for(const a of U){let U=!0;if(b)for(const M of b)if(a===M){U=!1;break}U&&(M.push(a),a._parentContainer=this)}}moveAllFromScene(U){this._wasAddedToScene=!1,void 0===U&&(U=new J);for(const M in this)Object.prototype.hasOwnProperty.call(this,M)&&(this[M]=this[M]||("_environmentTexture"===M?null:[]),this._moveAssets(this.$e[M],this[M],U[M]));this.environmentTexture=this.$e.environmentTexture,this.removeAllFromScene()}createRootMesh(){const U=new W.c("assetContainerRootMesh",this.$e);for(const M of this.meshes)M.parent||U.addChild(M);return this.meshes.unshift(U),U}mergeAnimationsTo(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.d.LastCreatedScene,M=arguments.length>1?arguments[1]:void 0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!U)return e.b.Error("No scene available to merge animations to"),[];const a=b||(M=>{let b=null;const a=M.animations.length?M.animations[0].targetProperty:"",A=M.name.split(".").join("").split("_primitive")[0];switch(a){case"position":case"rotationQuaternion":b=U.getTransformNodeByName(M.name)||U.getTransformNodeByName(A);break;case"influence":b=U.getMorphTargetByName(M.name)||U.getMorphTargetByName(A);break;default:b=U.getNodeByName(M.name)||U.getNodeByName(A)}return b}),A=this.getNodes();for(const y of A){const U=a(y);if(null!==U){for(const M of y.animations){const b=U.animations.filter((U=>U.targetProperty===M.targetProperty));for(const M of b){const b=U.animations.indexOf(M,0);b>-1&&U.animations.splice(b,1)}}U.animations=U.animations.concat(y.animations)}}const H=[],W=this.animationGroups.slice();for(const y of W){H.push(y.clone(y.name,a));for(const U of y.animatables)U.stop()}for(const y of M){const M=a(y.target);M&&(U.beginAnimation(M,y.fromFrame,y.toFrame,y.loopAnimation,y.speedRatio,y.onAnimationEnd?y.onAnimationEnd:void 0,void 0,!0,void 0,y.onAnimationLoop?y.onAnimationLoop:void 0),U.stopAnimation(y.target))}return H}populateRootNodes(){this.rootNodes.length=0;for(const U of this.meshes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.transformNodes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.lights)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.cameras)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U)}addAllAssetsToContainer(U){if(!U)return;const M=[],b=new Set;for(M.push(U);M.length>0;){const U=M.pop();if(U instanceof W.c?(U.yk&&-1===this.geometries.indexOf(U.yk)&&this.geometries.push(U.yk),this.meshes.push(U)):U instanceof P.b?this.meshes.push(U):U instanceof y.c?this.transformNodes.push(U):U instanceof Z.c?this.lights.push(U):U instanceof C.c&&this.cameras.push(U),U instanceof O.e){if(U.material&&-1===this.materials.indexOf(U.material)){this.materials.push(U.material);for(const M of U.material.getActiveTextures())-1===this.textures.indexOf(M)&&this.textures.push(M)}U.skeleton&&-1===this.skeletons.indexOf(U.skeleton)&&this.skeletons.push(U.skeleton),U.morphTargetManager&&-1===this.morphTargetManagers.indexOf(U.morphTargetManager)&&this.morphTargetManagers.push(U.morphTargetManager)}for(const a of U.getChildren())b.has(a)||M.push(a);b.add(U)}this.populateRootNodes()}_getByTags(U,M,b){if(void 0===M)return U;const a=[];for(const A in U){const H=U[A];r.d&&r.d.MatchesQuery(H,M)&&(!b||b(H))&&a.push(H)}return a}getMeshesByTags(U,M){return this._getByTags(this.meshes,U,M)}getCamerasByTags(U,M){return this._getByTags(this.cameras,U,M)}getLightsByTags(U,M){return this._getByTags(this.lights,U,M)}getMaterialsByTags(U,M){return this._getByTags(this.materials,U,M).concat(this._getByTags(this.multiMaterials,U,M))}getTransformNodesByTags(U,M){return this._getByTags(this.transformNodes,U,M)}}var L=b(543);class z{constructor(U){this.byteOffset=0,this.buffer=U}async loadAsync(U){const M=await this.buffer.readAsync(this.byteOffset,U);this._dataView=new DataView(M.buffer,M.byteOffset,M.byteLength),this._dataByteOffset=0}readUint32(){const U=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,U}readUint8Array(U){const M=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,U);return this._dataByteOffset+=U,this.byteOffset+=U,M}readString(U){return(0,L.k)(this.readUint8Array(U))}skipBytes(U){this._dataByteOffset+=U,this.byteOffset+=U}}var o=b(12679);const S="Z2xURg",h={name:"Wk",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:U=>-1!==U.indexOf("asset")&&-1!==U.indexOf("version")||U.startsWith("data:base64,"+S)||U.startsWith("data:;base64,"+S)||U.startsWith("data:application/octet-stream;base64,"+S)||U.startsWith("data:model/gltf-binary;base64,"+S)};var i,Y,d,s=b(531),q=b(539);function m(U,M,b){try{return Promise.resolve(new Uint8Array(U,M,b))}catch(a){return Promise.reject(a)}}!function(U){U[U.AUTO=0]="AUTO",U[U.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(i||(i={})),function(U){U[U.NONE=0]="NONE",U[U.FIRST=1]="FIRST",U[U.ALL=2]="ALL"}(Y||(Y={})),function(U){U[U.LOADING=0]="LOADING",U[U.READY=1]="READY",U[U.COMPLETE=2]="COMPLETE"}(d||(d={}));class n{constructor(){this.coordinateSystemMode=i.AUTO,this.animationStartMode=Y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=U=>Promise.resolve(U),this.extensionOptions={}}p(U){U&&(this.onParsed=U.onParsed,this.coordinateSystemMode=U.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=U.animationStartMode??this.animationStartMode,this.loadNodeAnimations=U.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=U.loadSkins??this.loadSkins,this.loadMorphTargets=U.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=U.compileMaterials??this.compileMaterials,this.useClipPlane=U.useClipPlane??this.useClipPlane,this.compileShadowGenerators=U.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=U.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=U.useRangeRequests??this.useRangeRequests,this.createInstances=U.createInstances??this.createInstances,this.alwaysComputeBoundingBox=U.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=U.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=U.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=U.skipMaterials??this.skipMaterials,this.useSRGBBuffers=U.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=U.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=U.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=U.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=U.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=U.customRootNode,this.onMeshLoaded=U.onMeshLoaded,this.onSkinLoaded=U.onSkinLoaded,this.onTextureLoaded=U.onTextureLoaded,this.onMaterialLoaded=U.onMaterialLoaded,this.onCameraLoaded=U.onCameraLoaded,this.extensionOptions=U.extensionOptions??this.extensionOptions)}}class E extends n{constructor(U){super(),this.onParsedObservable=new a.e,this.onMeshLoadedObservable=new a.e,this.onSkinLoadedObservable=new a.e,this.onTextureLoadedObservable=new a.e,this.onMaterialLoadedObservable=new a.e,this.onCameraLoadedObservable=new a.e,this.onCompleteObservable=new a.e,this.onErrorObservable=new a.e,this.rk=new a.e,this.onExtensionLoadedObservable=new a.e,this.validate=!1,this.onValidatedObservable=new a.e,this._loader=null,this._state=null,this._requests=new Array,this.name=h.name,this.extensions=h.extensions,this.onLoaderStateChangedObservable=new a.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(U)}set onParsed(U){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),U&&(this._onParsedObserver=this.onParsedObservable.add(U))}set onMeshLoaded(U){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),U&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(U))}set onSkinLoaded(U){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),U&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((M=>U(M.node,M.skinnedNode))))}set onTextureLoaded(U){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),U&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(U))}set onMaterialLoaded(U){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),U&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(U))}set onCameraLoaded(U){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),U&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(U))}set onComplete(U){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(U)}set onError(U){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(U)}set onDispose(U){this._onDisposeObserver&&this.rk.remove(this._onDisposeObserver),this._onDisposeObserver=this.rk.add(U)}set onExtensionLoaded(U){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(U)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(U){this._loggingEnabled!==U&&(this._loggingEnabled=U,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(U){this._capturePerformanceCounters!==U&&(this._capturePerformanceCounters=U,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(U){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(U)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const U of this._requests)U.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=U=>Promise.resolve(U),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.rk.notifyObservers(void 0),this.rk.clear()}loadFile(U,M,b,H,W,y,O,x){if(ArrayBuffer.isView(M))return this._loadBinary(U,M,b,H,O,x),null;this._progressCallback=W;const P=M.name||A.d.GetFilename(M);if(y){if(this.useRangeRequests){this.validate&&e.b.Warn("glTF validation is not supported when range requests are enabled");const b={abort:()=>{},onCompleteObservable:new a.e},A={readAsync:(b,a)=>new Promise(((A,H)=>{this._loadFile(U,M,(U=>{A(new Uint8Array(U))}),!0,(U=>{H(U)}),(U=>{U.setRequestHeader("Range",`bytes=${b}-${b+a-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new z(A)).then((U=>{b.onCompleteObservable.notifyObservers(b),H(U)}),O?U=>O(void 0,U):void 0),b}return this._loadFile(U,M,(M=>{this._validate(U,new Uint8Array(M,0,M.byteLength),b,P),this._unpackBinaryAsync(new z({readAsync:(U,b)=>m(M,U,b),byteLength:M.byteLength})).then((U=>{H(U)}),O?U=>O(void 0,U):void 0)}),!0,O)}return this._loadFile(U,M,(M=>{try{this._validate(U,M,b,P),H({json:this._parseJson(M)})}catch{O&&O()}}),!1,O)}_loadBinary(U,M,b,a,A,H){this._validate(U,new Uint8Array(M.buffer,M.byteOffset,M.byteLength),b,H),this._unpackBinaryAsync(new z({readAsync:(U,b)=>function(U,M,b){try{if(M<0||M>=U.byteLength)throw new RangeError("Offset is out of range.");if(M+b>U.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(U.buffer,U.byteOffset+M,b))}catch(a){return Promise.reject(a)}}(M,U,b),byteLength:M.byteLength})).then((U=>{a(U)}),A?U=>A(void 0,U):void 0)}importMeshAsync(U,M,b,a,A,H){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${H||""}`),this._loader=this._getLoader(b),this._loader.importMeshAsync(U,M,null,b,a,A,H))))}loadAsync(U,M,b,a,A){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(M),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(M),this._loader.loadAsync(U,M,b,a,A))))}loadAssetContainerAsync(U,M,b,a,A){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(M),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(M);const H=new f(U),W=[];this.onMaterialLoadedObservable.add((U=>{W.push(U)}));const y=[];this.onTextureLoadedObservable.add((U=>{y.push(U)}));const O=[];this.onCameraLoadedObservable.add((U=>{O.push(U)}));const e=[];return this.onMeshLoadedObservable.add((U=>{U.morphTargetManager&&e.push(U.morphTargetManager)})),this._loader.importMeshAsync(null,U,H,M,b,a,A).then((U=>(Array.prototype.push.apply(H.geometries,U.geometries),Array.prototype.push.apply(H.meshes,U.meshes),Array.prototype.push.apply(H.Ik,U.Ik),Array.prototype.push.apply(H.skeletons,U.skeletons),Array.prototype.push.apply(H.animationGroups,U.animationGroups),Array.prototype.push.apply(H.materials,W),Array.prototype.push.apply(H.textures,y),Array.prototype.push.apply(H.lights,U.lights),Array.prototype.push.apply(H.transformNodes,U.transformNodes),Array.prototype.push.apply(H.cameras,O),Array.prototype.push.apply(H.morphTargetManagers,e),H)))}))}canDirectLoad(U){return h.canDirectLoad(U)}directLoad(U,M){if(M.startsWith("base64,"+S)||M.startsWith(";base64,"+S)||M.startsWith("application/octet-stream;base64,"+S)||M.startsWith("model/gltf-binary;base64,"+S)){const b=(0,s.b)(M);return this._validate(U,new Uint8Array(b,0,b.byteLength)),this._unpackBinaryAsync(new z({readAsync:(U,M)=>m(b,U,M),byteLength:b.byteLength}))}return this._validate(U,M),Promise.resolve({json:this._parseJson(M)})}createPlugin(U){return new E(U[h.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((U,M)=>{this.onCompleteObservable.addOnce((()=>{U()})),this.onErrorObservable.addOnce((U=>{M(U)}))}))}_setState(U){this._state!==U&&(this._state=U,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(d[this._state]))}_loadFile(U,M,b,a,A,H){const W=U._loadFile(M,b,(U=>{this._onProgress(U,W)}),!0,a,A,H);return W.onCompleteObservable.add((()=>{W._lengthComputable=!0,W._total=W._loaded})),this._requests.push(W),W}_onProgress(U,M){if(!this._progressCallback)return;M._lengthComputable=U.lengthComputable,M._loaded=U.loaded,M._total=U.total;let b=!0,a=0,A=0;for(const H of this._requests){if(void 0===H._lengthComputable||void 0===H._loaded||void 0===H._total)return;b=b&&H._lengthComputable,a+=H._loaded,A+=H._total}this._progressCallback({lengthComputable:b,loaded:a,total:b?A:0})}_validate(U,M){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),o.c.ValidateAsync(M,b,a,(M=>this.preprocessUrlAsync(b+M).then((M=>U._loadFileAsync(M,void 0,!0,!0).then((U=>new Uint8Array(U,0,U.byteLength))))))).then((U=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(U),this.onValidatedObservable.clear()}),(U=>{this._endPerformanceCounter("Validate JSON"),A.d.Warn(`Failed to validate: ${U.message}`),this.onValidatedObservable.clear()})))}_getLoader(U){const M=U.json.asset||{};this._log(`Asset version: ${M.version}`),M.minVersion&&this._log(`Asset minimum version: ${M.minVersion}`),M.generator&&this._log(`Asset generator: ${M.generator}`);const b=E._parseVersion(M.version);if(!b)throw new Error("Invalid version: "+M.version);if(void 0!==M.minVersion){const U=E._parseVersion(M.minVersion);if(!U)throw new Error("Invalid minimum version: "+M.minVersion);if(E._compareVersion(U,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+M.minVersion)}const a={1:E._CreateGLTF1Loader,2:E._CreateGLTF2Loader}[b.major];if(!a)throw new Error("Unsupported version: "+M.version);return a(this)}_parseJson(U){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${U.length}`);const M=JSON.parse(U);return this._endPerformanceCounter("Parse JSON"),M}_unpackBinaryAsync(U){return this._startPerformanceCounter("Unpack Binary"),U.loadAsync(20).then((()=>{const M=U.readUint32();if(1179937895!==M)throw new q.i("Unexpected magic: "+M,q.h.GLTFLoaderUnexpectedMagicError);const b=U.readUint32();this.loggingEnabled&&this._log(`Binary version: ${b}`);const a=U.readUint32();let A;switch(this.useRangeRequests||a===U.buffer.byteLength||e.b.Warn(`Length in header does not match actual data length: ${a} != ${U.buffer.byteLength}`),b){case 1:A=this._unpackBinaryV1Async(U,a);break;case 2:A=this._unpackBinaryV2Async(U,a);break;default:throw new Error("Unsupported version: "+b)}return this._endPerformanceCounter("Unpack Binary"),A}))}_unpackBinaryV1Async(U,M){const b=U.readUint32(),a=U.readUint32();if(0!==a)throw new Error(`Unexpected content format: ${a}`);const A=M-U.byteOffset,H={json:this._parseJson(U.readString(b)),bin:null};if(0!==A){const M=U.byteOffset;H.bin={readAsync:(b,a)=>U.buffer.readAsync(M+b,a),byteLength:A}}return Promise.resolve(H)}_unpackBinaryV2Async(U,M){const b=1313821514,a=5130562,A=U.readUint32();if(U.readUint32()!==b)throw new Error("First chunk format is not JSON");return U.byteOffset+A===M?U.loadAsync(A).then((()=>({json:this._parseJson(U.readString(A)),bin:null}))):U.loadAsync(A+8).then((()=>{const H={json:this._parseJson(U.readString(A)),bin:null},W=()=>{const A=U.readUint32();switch(U.readUint32()){case b:throw new Error("Unexpected JSON chunk");case a:{const M=U.byteOffset;H.bin={readAsync:(b,a)=>U.buffer.readAsync(M+b,a),byteLength:A},U.skipBytes(A);break}default:U.skipBytes(A)}return U.byteOffset!==M?U.loadAsync(8).then(W):Promise.resolve(H)};return W()}))}static _parseVersion(U){if("1.0"===U||"1.0.1"===U)return{major:1,minor:0};const M=(U+"").match(/^(\d+)\.(\d+)/);return M?{major:parseInt(M[1]),minor:parseInt(M[2])}:null}static _compareVersion(U,M){return U.major>M.major?1:U.major<M.major?-1:U.minor>M.minor?1:U.minor<M.minor?-1:0}_logOpen(U){this._log(U),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(U){const M=E._logSpaces.substring(0,2*this._logIndentLevel);e.b.Log(`${M}${U}`)}_logDisabled(U){}_startPerformanceCounterEnabled(U){A.d.StartPerformanceCounter(U)}_startPerformanceCounterDisabled(U){}_endPerformanceCounterEnabled(U){A.d.EndPerformanceCounter(U)}_endPerformanceCounterDisabled(U){}}E.IncrementalLoading=!0,E.HomogeneousCoordinates=!1,E._logSpaces="                                ",(0,H.e)(new E)},12679:(U,M,b)=>{"use strict";b.d(M,{c:()=>W});var a=b(479);function A(U,M,b,a){const A={externalResourceFunction:a};return b&&(A.uri="file:"===M?b:M+b),ArrayBuffer.isView(U)?GLTFValidator.validateBytes(U,A):GLTFValidator.validateString(U,A)}function H(){const U=[];onmessage=M=>{const b=M.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":A(b.data,b.rootUrl,b.fileName,(M=>new Promise(((b,a)=>{const A=U.length;U.push({resolve:b,reject:a}),postMessage({id:"getExternalResource",index:A,uri:M})})))).then((U=>{postMessage({id:"validate.resolve",value:U})}),(U=>{postMessage({id:"validate.reject",reason:U})}));break;case"getExternalResource.resolve":U[b.index].resolve(b.value);break;case"getExternalResource.reject":U[b.index].reject(b.reason)}}}class W{static ValidateAsync(U,M,b,W){return"function"===typeof Worker?new Promise(((y,O)=>{const e=`${A}(${H})()`,x=URL.createObjectURL(new Blob([e],{type:"application/javascript"})),P=new Worker(x),Z=U=>{P.removeEventListener("error",Z),P.removeEventListener("message",C),O(U)},C=U=>{const M=U.data;switch(M.id){case"getExternalResource":W(M.uri).then((U=>{P.postMessage({id:"getExternalResource.resolve",index:M.index,value:U},[U.buffer])}),(U=>{P.postMessage({id:"getExternalResource.reject",index:M.index,reason:U})}));break;case"validate.resolve":P.removeEventListener("error",Z),P.removeEventListener("message",C),y(M.value),P.terminate();break;case"validate.reject":P.removeEventListener("error",Z),P.removeEventListener("message",C),O(M.reason),P.terminate()}};if(P.addEventListener("error",Z),P.addEventListener("message",C),P.postMessage({id:"init",url:a.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(U)){const a=U.slice();P.postMessage({id:"validate",data:a,rootUrl:M,fileName:b},[a.buffer])}else P.postMessage({id:"validate",data:U,rootUrl:M,fileName:b})})):(this._LoadScriptPromise||(this._LoadScriptPromise=a.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>A(U,M,b,W))))}}W.Configuration={url:`${a.d._DefaultCdnUrl}/gltf_validator.js`}},13055:(U,M,b)=>{"use strict";b.d(M,{e:()=>h});var a=b(645),A=b(652),H=b(698),W=b(670),y=b(12213),O=b(12220),e=b(729),x=b(2492),P=b(609),Z=b(572);b(12428),b(12338),b(12358),b(12346),b(12360),b(12369),b(12372);const C="imageProcessingCompatibility",r="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Z.c.IncludesShadersStore[C]||(Z.c.IncludesShadersStore[C]=r);const B="skyPixelShader",J="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Z.c.ShadersStore[B]||(Z.c.ShadersStore[B]=J);b(12438),b(12381),b(12383),b(12394),b(12391);const F="skyVertexShader",f="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Z.c.ShadersStore[F]||(Z.c.ShadersStore[F]=f);var L=b(12233),z=b(823),o=b(816);class S extends y.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class h extends O.b{constructor(U,M){super(U,M),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new W.l(0,100,0),this.useSunPosition=!1,this.cameraOffset=W.l.Zero(),this.up=W.l.Up(),this.dithering=!1,this._cameraPosition=W.l.Zero(),this._skyOrientation=new W.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(U,M){const b=M._drawWrapper;if(this.isFrozen&&b.effect&&b._wasPreviouslyReady)return!0;M.materialDefines||(M.materialDefines=new S);const a=M.materialDefines,A=this.va();if(this._isReadyForSubMesh(M))return!0;if((0,o.fb)(U,A,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,a),(0,o.W)(U,a,!0,!1),a.IMAGEPROCESSINGPOSTPROCESS!==A.imageProcessingConfiguration.applyByPostProcess&&a.markAsMiscDirty(),a.DITHER!==this.dithering&&a.markAsMiscDirty(),a.isDirty){a.markAsProcessed(),A.resetCachedMaterial();const U=new L.e;a.FOG&&U.addFallback(1,"FOG"),a.IMAGEPROCESSINGPOSTPROCESS=A.imageProcessingConfiguration.applyByPostProcess,a.DITHER=this.dithering;const b=[e.e.PositionKind];a.VERTEXCOLOR&&b.push(e.e.ColorKind);const H="sky",W=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,z.e)(W);const y=a.toString();M.setEffect(A.getEngine().createEffect(H,b,W,[],y,U,this.onCompiled,this.onError),a,this._materialContext)}return!(!M.effect||!M.effect.isReady())&&(a._renderId=A.getRenderId(),b._wasPreviouslyReady=!0,!0)}bindForSubMesh(U,M,b){const a=this.va(),A=b.materialDefines;if(!A)return;const H=b.effect;if(!H)return;this._activeEffect=H,this.bindOnlyWorldMatrix(U),this._activeEffect.setMatrix("viewProjection",a.getTransformMatrix()),this._mustRebind(a,H,b)&&((0,z.f)(H,this,a),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,o.o)(A,H,a)),a.fogEnabled&&M.applyFog&&a.fogMode!==x.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",a.getViewMatrix()),(0,o.h)(a,M,this._activeEffect);const y=a.activeCamera;if(y){const U=y.getWorldMatrix();this._cameraPosition.x=U.m[12],this._cameraPosition.y=U.m[13],this._cameraPosition.z=U.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const U=Math.PI*(this.inclination-.5),M=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(M)*Math.cos(U),this.sunPosition.y=this.distance*Math.sin(-U),this.sunPosition.z=this.distance*Math.sin(M)*Math.cos(U),W.e.FromUnitVectorsToRef(W.l.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(M,this._activeEffect,b)}getAnimatables(){return[]}dispose(U){super.dispose(U)}clone(U){return H.d.Clone((()=>new h(U,this.va())),this)}serialize(){const U=super.serialize();return U.customType="BABYLON.SkyMaterial",U}getClassName(){return"SkyMaterial"}static Parse(U,M,b){return H.d.Parse((()=>new h(U.name,M)),U,M,b)}}(0,a.c)([(0,A.J)()],h.prototype,"luminance",void 0),(0,a.c)([(0,A.J)()],h.prototype,"turbidity",void 0),(0,a.c)([(0,A.J)()],h.prototype,"rayleigh",void 0),(0,a.c)([(0,A.J)()],h.prototype,"mieCoefficient",void 0),(0,a.c)([(0,A.J)()],h.prototype,"mieDirectionalG",void 0),(0,a.c)([(0,A.J)()],h.prototype,"distance",void 0),(0,a.c)([(0,A.J)()],h.prototype,"inclination",void 0),(0,a.c)([(0,A.J)()],h.prototype,"azimuth",void 0),(0,a.c)([(0,A.H)()],h.prototype,"sunPosition",void 0),(0,a.c)([(0,A.J)()],h.prototype,"useSunPosition",void 0),(0,a.c)([(0,A.H)()],h.prototype,"cameraOffset",void 0),(0,a.c)([(0,A.H)()],h.prototype,"up",void 0),(0,a.c)([(0,A.J)()],h.prototype,"dithering",void 0),(0,P.i)("BABYLON.SkyMaterial",h)},11896:(U,M,b)=>{"use strict";function a(U,M){M.headers=U.headers||{},M.statusMessage=U.statusText,M.statusCode=U.status,M.data=U.response}function A(U,M,b){return new Promise((function(A,H){b=b||{};var W,y,O,e=new XMLHttpRequest,x=b.body,P=b.headers||{};for(W in b.timeout&&(e.timeout=b.timeout),e.ontimeout=e.onerror=function(U){U.timeout="timeout"==U.type,H(U)},e.open(U,M.href||M),e.onload=function(){for(O=e.getAllResponseHeaders().trim().split(/[\r\n]+/),a(e,e);y=O.shift();)y=y.split(": "),e.headers[y.shift().toLowerCase()]=y.join(": ");if((y=e.headers["content-type"])&&~y.indexOf("application/json"))try{e.data=JSON.parse(e.data,b.reviver)}catch(U){return a(e,U),H(U)}(e.status>=400?H:A)(e)},typeof FormData<"u"&&x instanceof FormData||x&&"object"==typeof x&&(P["content-type"]="application/json",x=JSON.stringify(x)),e.withCredentials=!!b.withCredentials,P)e.setRequestHeader(W,P[W]);e.send(x)}))}b.r(M),b.d(M,{del:()=>O,get:()=>H,patch:()=>y,post:()=>W,put:()=>e,send:()=>A});var H=A.bind(A,"GET"),W=A.bind(A,"POST"),y=A.bind(A,"PATCH"),O=A.bind(A,"DELETE"),e=A.bind(A,"PUT")},13175:(U,M,b)=>{"use strict";b.d(M,{e:()=>P});const a=.5*(Math.sqrt(3)-1),A=(3-Math.sqrt(3))/6,H=1/3,W=1/6,y=(Math.sqrt(5)-1)/4,O=(5-Math.sqrt(5))/20,e=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),x=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const P=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const M="function"==typeof U?U:function(U){let M=0,b=0,a=0,A=1;const H=function(){let U=4022871197;return function(M){M=M.toString();for(let b=0;b<M.length;b++){U+=M.charCodeAt(b);let a=.02519603282416938*U;U=a>>>0,a-=U,a*=U,U=a>>>0,a-=U,U+=4294967296*a}return 2.3283064365386963e-10*(U>>>0)}}();M=H(" "),b=H(" "),a=H(" "),M-=H(U),M<0&&(M+=1);b-=H(U),b<0&&(b+=1);a-=H(U),a<0&&(a+=1);return function(){const U=2091639*M+2.3283064365386963e-10*A;return M=b,b=a,a=U-(A=0|U)}}(U);this.p=function(U){const M=new Uint8Array(256);for(let b=0;b<256;b++)M[b]=b;for(let b=0;b<255;b++){const a=b+~~(U()*(256-b)),A=M[b];M[b]=M[a],M[a]=A}return M}(M),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let b=0;b<512;b++)this.perm[b]=this.p[255&b],this.permMod12[b]=this.perm[b]%12}noise2D(U,M){const b=this.permMod12,H=this.perm;let W=0,y=0,O=0;const x=(U+M)*a,P=Math.floor(U+x),Z=Math.floor(M+x),C=(P+Z)*A,r=U-(P-C),B=M-(Z-C);let J,F;r>B?(J=1,F=0):(J=0,F=1);const f=r-J+A,L=B-F+A,z=r-1+2*A,o=B-1+2*A,S=255&P,h=255&Z;let i=.5-r*r-B*B;if(i>=0){const U=3*b[S+H[h]];i*=i,W=i*i*(e[U]*r+e[U+1]*B)}let Y=.5-f*f-L*L;if(Y>=0){const U=3*b[S+J+H[h+F]];Y*=Y,y=Y*Y*(e[U]*f+e[U+1]*L)}let d=.5-z*z-o*o;if(d>=0){const U=3*b[S+1+H[h+1]];d*=d,O=d*d*(e[U]*z+e[U+1]*o)}return 70*(W+y+O)}noise3D(U,M,b){const a=this.permMod12,A=this.perm;let y,O,x,P;const Z=(U+M+b)*H,C=Math.floor(U+Z),r=Math.floor(M+Z),B=Math.floor(b+Z),J=(C+r+B)*W,F=U-(C-J),f=M-(r-J),L=b-(B-J);let z,o,S,h,i,Y;F>=f?f>=L?(z=1,o=0,S=0,h=1,i=1,Y=0):F>=L?(z=1,o=0,S=0,h=1,i=0,Y=1):(z=0,o=0,S=1,h=1,i=0,Y=1):f<L?(z=0,o=0,S=1,h=0,i=1,Y=1):F<L?(z=0,o=1,S=0,h=0,i=1,Y=1):(z=0,o=1,S=0,h=1,i=1,Y=0);const d=F-z+W,s=f-o+W,q=L-S+W,m=F-h+2*W,n=f-i+2*W,E=L-Y+2*W,X=F-1+.5,Q=f-1+.5,I=L-1+.5,v=255&C,t=255&r,V=255&B;let k=.6-F*F-f*f-L*L;if(k<0)y=0;else{const U=3*a[v+A[t+A[V]]];k*=k,y=k*k*(e[U]*F+e[U+1]*f+e[U+2]*L)}let N=.6-d*d-s*s-q*q;if(N<0)O=0;else{const U=3*a[v+z+A[t+o+A[V+S]]];N*=N,O=N*N*(e[U]*d+e[U+1]*s+e[U+2]*q)}let R=.6-m*m-n*n-E*E;if(R<0)x=0;else{const U=3*a[v+h+A[t+i+A[V+Y]]];R*=R,x=R*R*(e[U]*m+e[U+1]*n+e[U+2]*E)}let j=.6-X*X-Q*Q-I*I;if(j<0)P=0;else{const U=3*a[v+1+A[t+1+A[V+1]]];j*=j,P=j*j*(e[U]*X+e[U+1]*Q+e[U+2]*I)}return 32*(y+O+x+P)}noise4D(U,M,b,a){const A=this.perm;let H,W,e,P,Z;const C=(U+M+b+a)*y,r=Math.floor(U+C),B=Math.floor(M+C),J=Math.floor(b+C),F=Math.floor(a+C),f=(r+B+J+F)*O,L=U-(r-f),z=M-(B-f),o=b-(J-f),S=a-(F-f);let h=0,i=0,Y=0,d=0;L>z?h++:i++,L>o?h++:Y++,L>S?h++:d++,z>o?i++:Y++,z>S?i++:d++,o>S?Y++:d++;const s=h>=3?1:0,q=i>=3?1:0,m=Y>=3?1:0,n=d>=3?1:0,E=h>=2?1:0,X=i>=2?1:0,Q=Y>=2?1:0,I=d>=2?1:0,v=h>=1?1:0,t=i>=1?1:0,V=Y>=1?1:0,k=d>=1?1:0,N=L-s+O,R=z-q+O,j=o-m+O,p=S-n+O,g=L-E+2*O,K=z-X+2*O,w=o-Q+2*O,T=S-I+2*O,G=L-v+3*O,l=z-t+3*O,D=o-V+3*O,u=S-k+3*O,c=L-1+4*O,UU=z-1+4*O,MU=o-1+4*O,bU=S-1+4*O,aU=255&r,AU=255&B,HU=255&J,WU=255&F;let yU=.6-L*L-z*z-o*o-S*S;if(yU<0)H=0;else{const U=A[aU+A[AU+A[HU+A[WU]]]]%32*4;yU*=yU,H=yU*yU*(x[U]*L+x[U+1]*z+x[U+2]*o+x[U+3]*S)}let OU=.6-N*N-R*R-j*j-p*p;if(OU<0)W=0;else{const U=A[aU+s+A[AU+q+A[HU+m+A[WU+n]]]]%32*4;OU*=OU,W=OU*OU*(x[U]*N+x[U+1]*R+x[U+2]*j+x[U+3]*p)}let eU=.6-g*g-K*K-w*w-T*T;if(eU<0)e=0;else{const U=A[aU+E+A[AU+X+A[HU+Q+A[WU+I]]]]%32*4;eU*=eU,e=eU*eU*(x[U]*g+x[U+1]*K+x[U+2]*w+x[U+3]*T)}let xU=.6-G*G-l*l-D*D-u*u;if(xU<0)P=0;else{const U=A[aU+v+A[AU+t+A[HU+V+A[WU+k]]]]%32*4;xU*=xU,P=xU*xU*(x[U]*G+x[U+1]*l+x[U+2]*D+x[U+3]*u)}let PU=.6-c*c-UU*UU-MU*MU-bU*bU;if(PU<0)Z=0;else{const U=A[aU+1+A[AU+1+A[HU+1+A[WU+1]]]]%32*4;PU*=PU,Z=PU*PU*(x[U]*c+x[U+1]*UU+x[U+2]*MU+x[U+3]*bU)}return 27*(H+W+e+P+Z)}}}}]);