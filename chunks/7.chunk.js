/*! For license information please see v12e8b.7.34e45272.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{12982:A=>{"use strict";A.exports=function(A,X,s,N,f,E){var g=+X[0],K=+X[1],r=+X[2],i=+s[0],Y=+s[1],v=+s[2],c=Math.sqrt(i*i+Y*Y+v*v);if(0===c)throw new Error("Can't raycast along a zero vector");return function(A,X,s,N,f,E,g,K,r,i){for(var Y=0,v=Math.floor,c=0|v(X),M=0|v(s),d=0|v(N),Q=f>0?1:-1,w=E>0?1:-1,R=g>0?1:-1,C=Math.abs(1/f),J=Math.abs(1/E),a=Math.abs(1/g),u=C<1/0?C*(Q>0?c+1-X:X-c):1/0,z=J<1/0?J*(w>0?M+1-s:s-M):1/0,m=a<1/0?a*(R>0?d+1-N:N-d):1/0,b=-1;Y<=K;){var y=A(c,M,d);if(y)return r&&(r[0]=X+Y*f,r[1]=s+Y*E,r[2]=N+Y*g),i&&(i[0]=i[1]=i[2]=0,0===b&&(i[0]=-Q),1===b&&(i[1]=-w),2===b&&(i[2]=-R)),y;u<z?u<m?(c+=Q,Y=u,u+=C,b=0):(d+=R,Y=m,m+=a,b=2):z<m?(M+=w,Y=z,z+=J,b=1):(d+=R,Y=m,m+=a,b=2)}return r&&(r[0]=X+Y*f,r[1]=s+Y*E,r[2]=N+Y*g),i&&(i[0]=i[1]=i[2]=0),0}(A,g,K,r,i/=c,Y/=c,v/=c,N="undefined"===typeof N?64:+N,f,E)}},13014:(A,X,s)=>{"use strict";s.d(X,{d:()=>E});var N=s(70);function f(){this.Rl=!1,this.stopPropagation=!1,this.Sl=!1,this.disabled=!1}class E{constructor(A,X){this.version="0.7.0";var s=Object.assign({},new f,X||{});this.element=A||document,this.Rl=!!s.Rl,this.stopPropagation=!!s.stopPropagation,this.Sl=!!s.Sl,this.disabled=!!s.disabled,this.filterEvents=(A,X)=>!0,this.down=new N.EventEmitter,this.up=new N.EventEmitter,this.state={},this.wk={dx:0,dy:0,ym:0,rg:0,zm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?K(this):document.addEventListener("DOMContentLoaded",(A=>{K(this)}),{once:!0})}bind(A){for(var X=arguments.length,s=new Array(X>1?X-1:0),N=1;N<X;N++)s[N-1]=arguments[N];s.forEach((X=>{var s=this._keyBindmap[X]||[];s.includes(A)||(s.push(A),this._keyBindmap[X]=s)})),this.state[A]=!!this.state[A],this.pressCount[A]=this.pressCount[A]||0,this.releaseCount[A]=this.releaseCount[A]||0}unbind(A){for(var X in this._keyBindmap){var s=this._keyBindmap[X],N=s.indexOf(A);N>-1&&s.splice(N,1)}}getBindings(){var A={};for(var X in this._keyBindmap){this._keyBindmap[X].forEach((s=>{A[s]=A[s]||[],A[s].push(X)}))}return A}ff(){g(this.wk),g(this.pressCount),g(this.releaseCount)}}function g(A){for(var X in A)A[X]=0}function K(A){window.addEventListener("keydown",d.bind(null,A,!0),!1),window.addEventListener("keyup",d.bind(null,A,!1),!1);var X={passive:!0};A.element.addEventListener("touchstart",v.bind(void 0,A),{passive:!1}),A.element.addEventListener("touchend",M.bind(void 0,A),X),A.element.addEventListener("mousedown",Q.bind(null,A,!0),X),window.document.addEventListener("mouseup",Q.bind(null,A,!1),X),A.element.addEventListener("touchmove",w.bind(null,A),X),A.element.addEventListener("mousemove",w.bind(null,A),X),window.PointerEvent,A.element.addEventListener("wheel",R.bind(null,A),X),A.element.addEventListener("contextmenu",C.bind(null,A),!1),window.addEventListener("blur",J.bind(null,A),!1)}var r=0,i=0,Y=null;function v(A,X){X.preventDefault(),c(X)}function c(A){let X=!1;for(let s=0;s<A.touches.length;++s)if(A.touches[s].identifier===Y){X=!0;break}if(!X){const X=A.changedTouches[0];r=X.clientX,i=X.clientY,Y=X.identifier}}function M(A,X){for(var s=X.changedTouches,N=0;N<s.length;++N)s[N].identifier===Y&&(Y=null)}function d(A,X,s){a(s.code,X,A,s)}function Q(A,X,s){if("pointerId"in s)if(X){if(null!==A._touches.currID)return;A._touches.currID=s.pointerId}else{if(A._touches.currID!==s.pointerId)return;A._touches.currID=null}return a("Mouse"+("button"in s?s.button+1:1),X,A,s),!1}function w(A,X){var s=X.movementX||X.mozMovementX||0,N=X.movementY||X.mozMovementY||0;if(X.touches&&0===(s|N)){var f=function(A){c(A);for(let X=0;X<A.changedTouches.length;++X)if(A.changedTouches[X].identifier==Y){const s=A.changedTouches[X],N=[s.clientX-r,s.clientY-i];return r=s.clientX,i=s.clientY,N}return console.error(`Did not find touch id ${Y}`),[0,0]}(X);s=f[0],N=f[1]}A.wk.dx+=s,A.wk.dy+=N}function R(A,X){var s=1;switch(X.deltaMode){case 0:s=1;break;case 1:s=12;break;case 2:s=A.element.clientHeight||window.innerHeight}A.wk.ym+=(X.deltaX||0)*s,A.wk.rg+=(X.deltaY||0)*s,A.wk.zm+=(X.deltaZ||0)*s}function C(A,X){if(!A.Sl)return X.preventDefault(),!1}function J(A){for(var X in A._keyStates)A._keyStates[X]&&(/^Mouse\d/.test(X)||a(X,!1,A,{code:X,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function a(A,X,s,N){var f=s._keyBindmap[A];f&&(u(s._keyStates[A],X)&&(s._keyStates[A]=X,f.forEach((A=>{(!s.filterEvents||s.filterEvents(N,A))&&function(A,X,s,N){var f=X?s.pressCount:s.releaseCount;f[A]=(f[A]||0)+1;var E=s._bindPressCount[A]||0;(E+=X?1:-1)<0&&(E=0);s._bindPressCount[A]=E;var g=s.state[A];if(u(g,E)){s.state[A]=E>0;var K=X?s.down:s.up;s.disabled||K.emit(A,N)}}(A,X,s,N)}))),"button"in N||(s.Rl&&!N.defaultPrevented&&N.preventDefault(),s.stopPropagation&&N.stopPropagation()))}function u(A,X){return A?!X:X}},12989:(A,X,s)=>{"use strict";s.d(X,{c:()=>N});class N{constructor(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Xk=!1,this.Yk=!1,this.Ih=30,this.Wk=0,this.dl=!1,this.fullscreen=!1,this.$k=function(A){},this._k=function(){},this.bl=function(){},this.k=function(){},this.al=function(A){},this.onFullscreenChanged=function(A){},i((()=>{!function(A,X){A._nowObject=performance||Date,A._lastTick=0,A._renderAccum=0,A._rt=0,A._frameCB=K.bind(null,A),requestAnimationFrame(A._frameCB),X>0&&(A._intervalCB=g.bind(null,A),A._interval=setInterval(A._intervalCB,Math.max(X,1e3/A.Ih/2)))}(this,X),function(A,X){if(!X)return;var s=!1,N=!1;document.addEventListener("pointerlockchange",(N=>{s=document.pointerLockElement===X,A.al(s)})),document.addEventListener("fullscreenchange",(s=>{N=document.fullscreenElement===X,A.onFullscreenChanged(N)})),Object.defineProperty(A,"dl",{get:()=>s,set:A=>{A&&!s?r(X):s&&!A&&function(A){A.exitPointerLock&&A.exitPointerLock()}(document)}}),Object.defineProperty(A,"fullscreen",{get:()=>N,set:A=>{A&&!N?X.requestFullscreen():N&&!A&&document.exitFullscreen()}}),X.addEventListener("click",(f=>{A.Xk&&!s&&r(X),A.Yk&&!N&&X.requestFullscreen()}));var f=()=>A.k();if(window.ResizeObserver){new ResizeObserver(f).observe(X)}else window.addEventListener("resize",f)}(this,A),this.bl()}))}}var f=3,E=20;function g(A){for(var X=1e3/A.Ih,s=A._nowObject.now()+E,N=0;A._nowObject.now()>=A._lastTick+X&&A._nowObject.now()<s&&++N<=f;)A.$k(X),A._lastTick+=X;var g=5*(X+5),K=A._nowObject.now();if(K-A._lastTick>g)for(;K>=A._lastTick+X;)A._lastTick+=X}function K(A){requestAnimationFrame(A._frameCB),g(A);var X=A._nowObject.now(),s=X-A._rt;if(A._rt=X,A.Wk>0){A._renderAccum+=s;var N=1e3/A.Wk;if(A._renderAccum<N)return;A._renderAccum=Math.min(A._renderAccum-N,N)}var f=1e3/A.Ih,E=(X-A._lastTick)/f;A._k(s,E,f)}function r(A){A.requestPointerLock&&A.requestPointerLock()}var i=A=>{if("loading"===document.readyState){var X=()=>{document.removeEventListener("readystatechange",X),A()};document.addEventListener("readystatechange",X)}else setTimeout(A,1)}},13016:(A,X,s)=>{"use strict";s.d(X,{c:()=>v});var N=s(881),f=s(122);class E{constructor(A,X,s,E,g,K,r){this.Lh=new N(A.base,A.Mh),this.mass=X,this.friction=s,this.restitution=E,this.Bk=g,this.Th=K,this.Ck=!!r,this.Ok=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.rh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Nh=f.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=f.create(),this._impulses=f.create(),this._sleepFrameCount=10}loadFromCopy(A){f.i(this.Lh.base,A.Lh.base),f.i(this.Lh.Mh,A.Lh.Mh),f.i(this.Lh.max,A.Lh.max),this.Lh.mag=A.Lh.mag,this.mass=A.mass,this.friction=A.friction,this.restitution=A.restitution,this.Bk=A.Bk,this.Th=A.Th,this.Ck=A.Ck,this.Ok=A.Ok,this.fluidDrag=A.fluidDrag,this.rh=A.rh,this.preventFallOffEdge=A.preventFallOffEdge,this.rolledBackLastTick=A.rolledBackLastTick,f.i(this.Nh,A.Nh),f.i(this.resting,A.resting),this.inFluid=A.inFluid,this._ratioInFluid=A._ratioInFluid,f.i(this._forces,A._forces),f.i(this._impulses,A._impulses),this._sleepFrameCount=A._sleepFrameCount}setPosition(A){g(A),f.Pg(A,A,this.Lh.base),this.Lh.translate(A),this.Qg()}$e(){return f.clone(this.Lh.base)}applyForce(A){g(A),f.add(this._forces,this._forces,A),this.Qg()}applyImpulse(A){g(A),f.add(this._impulses,this._impulses,A),this.Qg()}Qg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var g=A=>{};var K=s(881),r=s(122),i=s(885);function Y(){this.Ok=.1,this.fluidDrag=.4,this.sj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function v(A,X,s){A=Object.assign(new Y,A),this.gravity=A.gravity||[0,-10,0],this.Ok=A.Ok||.1,this.sj=A.sj||2,this.fluidDrag=A.fluidDrag||.4,this.minBounceImpulse=A.minBounceImpulse,this.bodies=[],this.qm=A.qm,this.testSolid=X,this.testFluid=s}v.prototype.Eh=function(A,X,s,N,f,g){A=A||new K([0,0,0],[1,1,1]),"undefined"==typeof X&&(X=1),"undefined"==typeof s&&(s=1),"undefined"==typeof N&&(N=0),"undefined"==typeof f&&(f=1);var r=new E(A,X,s,N,f,g);return this.bodies.push(r),r},v.prototype.Gh=function(A){var X=this.bodies.indexOf(A);X<0||(this.bodies.splice(X,1),A.Lh=A.Th=null)};var c=r.create(),M=r.create(),d=r.create(),Q=r.create(),w=r.create(),R=r.create(),C=r.create(),J=new K([0,0,0],[1,1,1]),a=new E(J,1,1,0,1,(()=>{}),!1);function u(A,X,s){return X=s,X*=1-(1-A.ratioInFluid)**2}v.prototype.ff=function(A){A/=1e3;var X=T(0,r.squaredLength(this.gravity));this.bodies.forEach((s=>function(A,X,s,N){r.i(w,X.resting),A.qm&&a.loadFromCopy(X);if(X.mass<=0)return r.set(X.Nh,0,0,0),r.set(X._forces,0,0,0),void r.set(X._impulses,0,0,0);var f=N||0===X.Bk;if(function(A,X,s,N){if(X._sleepFrameCount>0)return!1;if(N)return!0;var f=!1,E=.5*s*s*X.Bk;return r.scale(e,A.gravity,E),i(A.testSolid,X.Lh,e,(function(){return f=!0,!0}),!0),f}(A,X,s,f))return;X._sleepFrameCount--,function(A,X){var s=X.Lh,N=Math.floor(s.base[0]),f=Math.floor(s.base[2]),E=Math.floor(s.base[1]),g=Math.floor(s.max[1]);if(!A.testFluid(N,E,f))return X.inFluid=!1,void(X.ratioInFluid=0);var K=1,i=E+1;for(;i<=g&&A.testFluid(N,i,f);)K++,i++;var Y=(E+K-s.base[1])/s.Mh[1];Y>1&&(Y=1);var v=s.Mh[0]*s.Mh[1]*s.Mh[2]*Y,c=m;r.scale(c,A.gravity,-A.sj*v*X.Bk),X.applyForce(c),X.inFluid=!0,X.ratioInFluid=Y}(A,X),L(X._forces),L(X._impulses),L(X.Nh),L(X.resting),r.scale(c,X._forces,1/X.mass),r.xh(c,c,A.gravity,X.Bk),r.scale(M,X._impulses,1/X.mass),r.xh(M,M,c,s),r.add(X.Nh,X.Nh,M),X.friction&&(b(A,0,X,M,s),b(A,1,X,M,s),b(A,2,X,M,s));var E=X.fluidDrag>=0?X.fluidDrag:A.fluidDrag,g=X.Ok>=0?X.Ok:A.Ok,K=g,Y=g;X.inFluid&&(K=u(X,K,X.fluidDragHoriz>=0?X.fluidDragHoriz:E),Y=u(X,Y,X.fluidDragVert>=0?X.fluidDragVert:E));K=Math.max(1-K*s/X.mass,0),Y=Math.max(1-Y*s/X.mass,0),r.set(z,K,Y,K),r.multiply(X.Nh,X.Nh,z),r.scale(d,X.Nh,s),r.set(X._forces,0,0,0),r.set(X._impulses,0,0,0),X.Ck&&I(G,X.Lh);r.i(R,d),r.set(C,0,0,0),X.preventFallOffEdge&&function(A,X,s,N){if(!X.resting[1]||s[1]>0)return;var f=n;I(f,X.Lh);for(var E=0;E<3;E+=2){r.set(l,0,0,0),l[E]=s[E];var g=!0;(g=(g=(g=(g=g&&!t(A,f.base[0]+l[0]+1e-5,f.base[1],f.base[2]+l[2]+1e-5))&&!t(A,f.max[0]+l[0]-1e-5,f.base[1],f.base[2]+l[2]+1e-5))&&!t(A,f.base[0]+l[0]+1e-5,f.base[1],f.max[2]+l[2]-1e-5))&&!t(A,f.max[0]+l[0]-1e-5,f.base[1],f.max[2]+l[2]-1e-5))?(N[E]=s[E]>0?1:-1,s[E]=0):0===E&&(r.set(U,s[0],0,0),j(A,f,U,N,X.slideOnCollision))}}(A,X,d,C);j(A,X.Lh,d,X.resting,X.slideOnCollision),X.Ck&&function(A,X,s,N){if(X.resting[1]>=0&&!X.inFluid)return;var f=0!==X.resting[0],E=0!==X.resting[2];if(!f&&!E)return;var g=Math.abs(N[0]/N[2]),K=4;if(!f&&g>K)return;if(!E&&g<1/K)return;r.add(D,s.base,N);var Y=A.testSolid;i(Y,s,N,(function(A,X,s,N){if(1!==X)return!0;N[X]=0}));var v=s.base[1],c=X.inFluid?1.951:1.001,M=Math.floor(v+c)-v;r.set(O,0,M,0);var d=!1;if(i(Y,s,O,(function(A,X,s,N){return d=!0,!0})),d)return;r.Pg(P,D,s.base),P[1]=0,j(A,s,P,V,!0);var Q=T(s.base[0],D[0]),w=T(s.base[2],D[2]);if(f&&!Q&&(!w||!E))return;if(E&&(!Q||!f)&&!w)return;var R=!0;if(R=R&&!t(A,s.base[0]+1e-5,s.base[1],s.base[2]+1e-5),R=R&&!t(A,s.max[0]-1e-5,s.base[1],s.base[2]+1e-5),R=R&&!t(A,s.base[0]+1e-5,s.base[1],s.max[2]-1e-5),R=R&&!t(A,s.max[0]-1e-5,s.base[1],s.max[2]-1e-5),R)return;I(X.Lh,s),X.resting[0]=V[0],X.resting[2]=V[2],X.rh&&X.rh()}(A,X,G,R);for(var v=0;v<3;++v)X.resting[v]=X.resting[v]||C[v],Q[v]=0,X.resting[v]&&(w[v]||(Q[v]=-X.Nh[v]),X.Nh[v]=0);var J=r.length(Q);J>.001&&(r.scale(Q,Q,X.mass),X.Th&&X.Th(Q),X.restitution>0&&J>A.minBounceImpulse&&(r.scale(Q,Q,X.restitution),X.applyImpulse(Q)));var y=r.squaredLength(X.Nh);y>1e-5&&X.Qg();A.qm&&A.qm(X)?(X.loadFromCopy(a),X.rolledBackLastTick=!0):X.rolledBackLastTick=!1}(this,s,A,X)))};var z=r.create([0,0,0]);var m=r.create();function b(A,X,s,N,f){var E=s.resting[X],g=N[X];if(!s.alwaysApplyHorizFriction||1!==X){if(0===E)return;if(E*g<=0)return}r.i(y,s.Nh),y[X]=0;var K=r.length(y);if(!T(K,0)){var i=Math.abs(s.friction*A.gravity[X]*f),Y=K>i?(K-i)/K:0;s.Nh[(X+1)%3]*=Y,s.Nh[(X+2)%3]*=Y}}var y=r.create();function j(A,X,s,N,f){return r.set(N,0,0,0),i(A.testSolid,X,s,(function(A,X,s,E){N[X]=s,E[X]=0,f||(E[0]=0,E[1]=0,E[2]=0)}))}var G=new K([],[]),V=r.create(),D=r.create(),O=r.create(),P=r.create();var l=r.create(),n=new K([],[]),U=r.create();function t(A,X,s,N){return A.testSolid(Math.floor(X),Math.floor(s-1),Math.floor(N))}var e=r.create();function T(A,X){return Math.abs(A-X)<1e-5}function I(A,X){for(var s=0;s<3;s++)A.base[s]=X.base[s],A.max[s]=X.max[s],A.Mh[s]=X.Mh[s]}var L=function(A){}},11831:function(A,X){!function(A){"use strict";var X=function(A,s){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,X){A.__proto__=X}||function(A,X){for(var s in X)Object.prototype.hasOwnProperty.call(X,s)&&(A[s]=X[s])},X(A,s)};function s(A,s){if("function"!==typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function N(){this.constructor=A}X(A,s),A.prototype=null===s?Object.create(s):(N.prototype=s.prototype,new N)}function N(A,X,s,N){var f,E=arguments.length,g=E<3?X:null===N?N=Object.getOwnPropertyDescriptor(X,s):N;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(A,X,s,N);else for(var K=A.length-1;K>=0;K--)(f=A[K])&&(g=(E<3?f(g):E>3?f(X,s,g):f(X,s))||g);return E>3&&g&&Object.defineProperty(X,s,g),g}function f(A,X,s){if(s||2===arguments.length)for(var N,f=0,E=X.length;f<E;f++)!N&&f in X||(N||(N=Array.prototype.slice.call(X,0,f)),N[f]=X[f]);return A.concat(N||Array.prototype.slice.call(X))}var E,g=255,K=213;A.OPERATION=void 0,(E=A.OPERATION||(A.OPERATION={}))[E.ADD=128]="ADD",E[E.REPLACE=0]="REPLACE",E[E.DELETE=64]="DELETE",E[E.DELETE_AND_ADD=192]="DELETE_AND_ADD",E[E.TOUCH=1]="TOUCH",E[E.CLEAR=10]="CLEAR";var r=function(){function X(A,X,s){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=A,this.setParent(X,s)}return X.prototype.setParent=function(A,X,s){var N=this;if(this.indexes||(this.indexes=this.ref instanceof PA?this.ref._definition.indexes:{}),this.parent=A,this.parentIndex=s,X)if(this.root=X,this.ref instanceof PA){var f=this.ref._definition;for(var E in f.schema){var g=this.ref[E];if(g&&g.$changes){var K=f.indexes[E];g.$changes.setParent(this.ref,X,K)}}}else"object"===typeof this.ref&&this.ref.forEach((function(A,X){if(A instanceof PA){var s=A.$changes,f=N.ref.$changes.indexes[X];s.setParent(N.ref,N.root,f)}}))},X.prototype.operation=function(A){this.changes.set(--this.currentCustomOperation,A)},X.prototype.change=function(X,s){void 0===s&&(s=A.OPERATION.ADD);var N="number"===typeof X?X:this.indexes[X];this.assertValidIndex(N,X);var f=this.changes.get(N);f&&f.op!==A.OPERATION.DELETE&&f.op!==A.OPERATION.TOUCH||this.changes.set(N,{op:f&&f.op===A.OPERATION.DELETE?A.OPERATION.DELETE_AND_ADD:s,index:N}),this.allChanges.add(N),this.changed=!0,this.touchParents()},X.prototype.touch=function(X){var s="number"===typeof X?X:this.indexes[X];this.assertValidIndex(s,X),this.changes.has(s)||this.changes.set(s,{op:A.OPERATION.TOUCH,index:s}),this.allChanges.add(s),this.touchParents()},X.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},X.prototype.getType=function(A){if(this.ref._definition)return(X=this.ref._definition).schema[X.fieldsByIndex[A]];var X,s=(X=this.parent._definition).schema[X.fieldsByIndex[this.parentIndex]];return Object.values(s)[0]},X.prototype.getChildrenFilter=function(){var A=this.parent._definition.childFilters;return A&&A[this.parentIndex]},X.prototype.getValue=function(A){return this.ref.getByIndex(A)},X.prototype.delete=function(X){var s="number"===typeof X?X:this.indexes[X];if(void 0!==s){var N=this.getValue(s);this.changes.set(s,{op:A.OPERATION.DELETE,index:s}),this.allChanges.delete(s),delete this.caches[s],N&&N.$changes&&(N.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(X," (").concat(s,")"))},X.prototype.discard=function(X,s){var N=this;void 0===X&&(X=!1),void 0===s&&(s=!1),this.ref instanceof PA||this.changes.forEach((function(X){if(X.op===A.OPERATION.DELETE){var s=N.ref.getIndex(X.index);delete N.indexes[s]}})),this.changes.clear(),this.changed=X,s&&this.allChanges.clear(),this.currentCustomOperation=0},X.prototype.discardAll=function(){var A=this;this.changes.forEach((function(X){var s=A.getValue(X.index);s&&s.$changes&&s.$changes.discardAll()})),this.discard()},X.prototype.cache=function(A,X){this.caches[A]=X},X.prototype.clone=function(){return new X(this.ref,this.parent,this.root)},X.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},X.prototype.assertValidIndex=function(A,X){if(void 0===A)throw new Error('ChangeTree: missing index for field "'.concat(X,'"'))},X}();function i(A,X,s,N){return A[X]||(A[X]=[]),A[X].push(s),null===N||void 0===N||N.forEach((function(A,X){return s(A,X)})),function(){return v(A[X],A[X].indexOf(s))}}function Y(X){var s=this,N="string"!==typeof this.$changes.getType();this.$items.forEach((function(f,E){X.push({refId:s.$changes.refId,op:A.OPERATION.DELETE,field:E,value:void 0,previousValue:f}),N&&s.$changes.root.removeRef(f.$changes.refId)}))}function v(A,X){if(-1===X||X>=A.length)return!1;for(var s=A.length-1,N=X;N<s;N++)A[N]=A[N+1];return A.length=s,!0}var c=function(A,X){var s=A.toString(),N=X.toString();return s<N?-1:s>N?1:0};function M(A){return A.$proxy=!0,A=new Proxy(A,{get:function(A,X){return"symbol"===typeof X||isNaN(X)?A[X]:A.at(X)},set:function(A,X,s){if("symbol"===typeof X||isNaN(X))A[X]=s;else{var N=Array.from(A.$items.keys()),f=parseInt(N[X]||X);void 0===s||null===s?A.deleteAt(f):A.setAt(f,s)}return!0},deleteProperty:function(A,X){return"number"===typeof X?A.deleteAt(X):delete A[X],!0}})}var d=function(){function X(){for(var A=[],X=0;X<arguments.length;X++)A[X]=arguments[X];this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,A)}return X.prototype.th=function(X,s){return void 0===s&&(s=!0),i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.ADD,X,s?this.$items:void 0)},X.prototype.sh=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.REPLACE,X)},X.is=function(A){return Array.isArray(A)||void 0!==A.array},Object.defineProperty(X.prototype,"length",{get:function(){return this.$items.size},set:function(A){0===A?this.clear():this.splice(A,this.length-A)},enumerable:!1,configurable:!0}),X.prototype.push=function(){for(var A,X=this,s=[],N=0;N<arguments.length;N++)s[N]=arguments[N];return s.forEach((function(s){A=X.$refId++,X.setAt(A,s)})),A},X.prototype.pop=function(){var A=Array.from(this.$indexes.values()).pop();if(void 0!==A){this.$changes.delete(A),this.$indexes.delete(A);var X=this.$items.get(A);return this.$items.delete(A),X}},X.prototype.at=function(A){var X=Array.from(this.$items.keys())[A];return this.$items.get(X)},X.prototype.setAt=function(X,s){var N,f;if(void 0!==s&&null!==s){if(this.$items.get(X)!==s){void 0!==s.$changes&&s.$changes.setParent(this,this.$changes.root,X);var E=null!==(f=null===(N=this.$changes.indexes[X])||void 0===N?void 0:N.op)&&void 0!==f?f:A.OPERATION.ADD;this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,s),this.$changes.change(X,E)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},X.prototype.deleteAt=function(A){var X=Array.from(this.$items.keys())[A];return void 0!==X&&this.$deleteAt(X)},X.prototype.$deleteAt=function(A){return this.$changes.delete(A),this.$indexes.delete(A),this.$items.delete(A)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&Y.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:A.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.concat=function(){for(var A,s=[],N=0;N<arguments.length;N++)s[N]=arguments[N];return new(X.bind.apply(X,f([void 0],(A=Array.from(this.$items.values())).concat.apply(A,s),!1)))},X.prototype.join=function(A){return Array.from(this.$items.values()).join(A)},X.prototype.reverse=function(){var A=this,X=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(s,N){A.setAt(X[N],s)})),this},X.prototype.shift=function(){var A=Array.from(this.$items.keys()).shift();if(void 0!==A){var X=this.$items.get(A);return this.$deleteAt(A),X}},X.prototype.slice=function(A,s){var N=new X;return N.push.apply(N,Array.from(this.$items.values()).slice(A,s)),N},X.prototype.sort=function(A){var X=this;void 0===A&&(A=c);var s=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(A).forEach((function(A,N){X.setAt(s[N],A)})),this},X.prototype.splice=function(A,X){void 0===X&&(X=this.length-A);for(var s=Array.from(this.$items.keys()),N=[],f=A;f<A+X;f++)N.push(this.$items.get(s[f])),this.$deleteAt(s[f]);return N},X.prototype.unshift=function(){for(var A=this,X=[],s=0;s<arguments.length;s++)X[s]=arguments[s];var N=this.length,f=X.length,E=Array.from(this.$items.values());return X.forEach((function(X,s){A.setAt(s,X)})),E.forEach((function(X,s){A.setAt(f+s,X)})),N+f},X.prototype.indexOf=function(A,X){return Array.from(this.$items.values()).indexOf(A,X)},X.prototype.lastIndexOf=function(A,X){return void 0===X&&(X=this.length-1),Array.from(this.$items.values()).lastIndexOf(A,X)},X.prototype.every=function(A,X){return Array.from(this.$items.values()).every(A,X)},X.prototype.some=function(A,X){return Array.from(this.$items.values()).some(A,X)},X.prototype.forEach=function(A,X){Array.from(this.$items.values()).forEach(A,X)},X.prototype.map=function(A,X){return Array.from(this.$items.values()).map(A,X)},X.prototype.filter=function(A,X){return Array.from(this.$items.values()).filter(A,X)},X.prototype.reduce=function(A,X){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},X.prototype.reduceRight=function(A,X){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},X.prototype.find=function(A,X){return Array.from(this.$items.values()).find(A,X)},X.prototype.findIndex=function(A,X){return Array.from(this.$items.values()).findIndex(A,X)},X.prototype.fill=function(A,X,s){throw new Error("ArraySchema#fill() not implemented")},X.prototype.copyWithin=function(A,X,s){throw new Error("ArraySchema#copyWithin() not implemented")},X.prototype.toString=function(){return this.$items.toString()},X.prototype.toLocaleString=function(){return this.$items.toLocaleString()},X.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},X.prototype.includes=function(A,X){return Array.from(this.$items.values()).includes(A,X)},X.prototype.flatMap=function(A,X){throw new Error("ArraySchema#flatMap() is not supported.")},X.prototype.flat=function(A){throw new Error("ArraySchema#flat() is not supported.")},X.prototype.findLast=function(){var A=Array.from(this.$items.values());return A.findLast.apply(A,arguments)},X.prototype.findLastIndex=function(){var A=Array.from(this.$items.values());return A.findLastIndex.apply(A,arguments)},X.prototype.setIndex=function(A,X){this.$indexes.set(A,X)},X.prototype.getIndex=function(A){return this.$indexes.get(A)},X.prototype.getByIndex=function(A){return this.$items.get(this.$indexes.get(A))},X.prototype.deleteByIndex=function(A){var X=this.$indexes.get(A);this.$items.delete(X),this.$indexes.delete(A)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){return this.toArray().map((function(A){return"function"===typeof A.toJSON?A.toJSON():A}))},X.prototype.clone=function(A){return A?new(X.bind.apply(X,f([void 0],Array.from(this.$items.values()),!1))):new(X.bind.apply(X,f([void 0],this.map((function(A){return A.$changes?A.clone():A})),!1)))},X}();function Q(A){return A.$proxy=!0,A=new Proxy(A,{get:function(A,X){return"symbol"!==typeof X&&"undefined"===typeof A[X]?A.get(X):A[X]},set:function(A,X,s){return"symbol"!==typeof X&&-1===X.indexOf("$")&&"th"!==X&&"sh"!==X&&"onChange"!==X?A.set(X,s):A[X]=s,!0},deleteProperty:function(A,X){return A.delete(X),!0}})}var w=function(){function X(A){var s=this;if(this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,A)if(A instanceof Map||A instanceof X)A.forEach((function(A,X){return s.set(X,A)}));else for(var N in A)this.set(N,A[N])}return X.prototype.th=function(X,s){return void 0===s&&(s=!0),i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.ADD,X,s?this.$items:void 0)},X.prototype.sh=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.REPLACE,X)},X.is=function(A){return void 0!==A.map},X.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(X.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.set=function(X,s){if(void 0===s||null===s)throw new Error("MapSchema#set('".concat(X,"', ").concat(s,"): trying to set ").concat(s," value on '").concat(X,"'."));X=X.toString();var N="undefined"!==typeof this.$changes.indexes[X],f=N?this.$changes.indexes[X]:this.$refId++,E=N?A.OPERATION.REPLACE:A.OPERATION.ADD,g=void 0!==s.$changes;if(g&&s.$changes.setParent(this,this.$changes.root,f),N){if(!g&&this.$items.get(X)===s)return;g&&this.$items.get(X)!==s&&(E=A.OPERATION.ADD)}else this.$changes.indexes[X]=f,this.$indexes.set(f,X);return this.$items.set(X,s),this.$changes.change(X,E),this},X.prototype.get=function(A){return this.$items.get(A)},X.prototype.delete=function(A){return this.$changes.delete(A),this.$items.delete(A)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&Y.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:A.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(A){return this.$items.has(A)},X.prototype.forEach=function(A){this.$items.forEach(A)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(A,X){this.$indexes.set(A,X)},X.prototype.getIndex=function(A){return this.$indexes.get(A)},X.prototype.getByIndex=function(A){return this.$items.get(this.$indexes.get(A))},X.prototype.deleteByIndex=function(A){var X=this.$indexes.get(A);this.$items.delete(X),this.$indexes.delete(A)},X.prototype.toJSON=function(){var A={};return this.forEach((function(X,s){A[s]="function"===typeof X.toJSON?X.toJSON():X})),A},X.prototype.clone=function(A){var s;return A?s=Object.assign(new X,this):(s=new X,this.forEach((function(A,X){A.$changes?s.set(X,A.clone()):s.set(X,A)}))),s},X}(),R={};function C(A,X){R[A]=X}function J(A){return R[A]}var a=function(){function A(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return A.create=function(X){var s=new A;return s.schema=Object.assign({},X&&X.schema||{}),s.indexes=Object.assign({},X&&X.indexes||{}),s.fieldsByIndex=Object.assign({},X&&X.fieldsByIndex||{}),s.descriptors=Object.assign({},X&&X.descriptors||{}),s.deprecated=Object.assign({},X&&X.deprecated||{}),s},A.prototype.addField=function(A,X){var s=this.getNextFieldIndex();this.fieldsByIndex[s]=A,this.indexes[A]=s,this.schema[A]=Array.isArray(X)?{array:X[0]}:X},A.prototype.hasField=function(A){return void 0!==this.indexes[A]},A.prototype.addFilter=function(A,X){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[A]]=X,this.indexesWithFilters.push(this.indexes[A]),!0},A.prototype.addChildrenFilter=function(A,X){var s=this.indexes[A],N=this.schema[A];if(J(Object.keys(N)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[s]=X,!0;console.warn("@filterChildren: field '".concat(A,"' can't have children. Ignoring filter."))},A.prototype.getChildrenFilter=function(A){return this.childFilters&&this.childFilters[this.indexes[A]]},A.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},A}();function u(A){return A._context&&A._context.useFilters}var z=function(){function A(){this.types={},this.schemas=new Map,this.useFilters=!1}return A.prototype.has=function(A){return this.schemas.has(A)},A.prototype.get=function(A){return this.types[A]},A.prototype.add=function(A,X){void 0===X&&(X=this.schemas.size),A._definition=a.create(A._definition),A._typeid=X,this.types[X]=A,this.schemas.set(A,X)},A.create=function(X){return void 0===X&&(X={}),function(s){return X.context||(X.context=new A),b(s,X)}},A}(),m=new z;function b(A,X){return void 0===X&&(X={}),function(s,N){var E=X.context||m,g=s.constructor;if(g._context=E,!A)throw new Error("".concat(g.name,': @type() reference provided for "').concat(N,"\" is undefined. Make sure you don't have any circular dependencies."));E.has(g)||E.add(g);var K=g._definition;if(K.addField(N,A),K.descriptors[N]){if(K.deprecated[N])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(N,"' definition on '").concat(g.name,"'.\nCheck @type() annotation"))}catch(R){var r=R.stack.split("\n")[4].trim();throw new Error("".concat(R.message," ").concat(r))}}var i=d.is(A),Y=!i&&w.is(A);if("string"!==typeof A&&!PA.is(A)){var v=Object.values(A)[0];"string"===typeof v||E.has(v)||E.add(v)}if(X.manual)K.descriptors[N]={enumerable:!0,configurable:!0,writable:!0};else{var c="_".concat(N);K.descriptors[c]={enumerable:!1,configurable:!1,writable:!0},K.descriptors[N]={get:function(){return this[c]},set:function(A){A!==this[c]&&(void 0!==A&&null!==A?(!i||A instanceof d||(A=new(d.bind.apply(d,f([void 0],A,!1)))),!Y||A instanceof w||(A=new w(A)),void 0===A.$proxy&&(Y?A=Q(A):i&&(A=M(A))),this.$changes.change(N),A.$changes&&A.$changes.setParent(this,this.$changes.root,this._definition.indexes[N])):this[c]&&this.$changes.delete(N),this[c]=A)},enumerable:!0,configurable:!0}}}}function y(A){return function(X,s){var N=X.constructor;N._definition.addFilter(s,A)&&(N._context.useFilters=!0)}}function j(A){return function(X,s){var N=X.constructor;N._definition.addChildrenFilter(s,A)&&(N._context.useFilters=!0)}}function G(A){return void 0===A&&(A=!0),function(X,s){var N=X.constructor._definition;N.deprecated[s]=!0,A&&(N.descriptors[s]={get:function(){throw new Error("".concat(s," is deprecated."))},set:function(A){},enumerable:!1,configurable:!0})}}function V(A,X,s){for(var N in void 0===s&&(s={}),s.context||(s.context=A._context||s.context||m),X)b(X[N],s)(A.prototype,N);return A}function D(A){for(var X=0,s=0,N=0,f=A.length;N<f;N++)(X=A.charCodeAt(N))<128?s+=1:X<2048?s+=2:X<55296||X>=57344?s+=3:(N++,s+=4);return s}function O(A,X,s){for(var N=0,f=0,E=s.length;f<E;f++)(N=s.charCodeAt(f))<128?A[X++]=N:N<2048?(A[X++]=192|N>>6,A[X++]=128|63&N):N<55296||N>=57344?(A[X++]=224|N>>12,A[X++]=128|N>>6&63,A[X++]=128|63&N):(f++,N=65536+((1023&N)<<10|1023&s.charCodeAt(f)),A[X++]=240|N>>18,A[X++]=128|N>>12&63,A[X++]=128|N>>6&63,A[X++]=128|63&N)}function P(A,X){A.push(255&X)}function l(A,X){A.push(255&X)}function n(A,X){A.push(255&X),A.push(X>>8&255)}function U(A,X){A.push(255&X),A.push(X>>8&255)}function t(A,X){A.push(255&X),A.push(X>>8&255),A.push(X>>16&255),A.push(X>>24&255)}function e(A,X){var s=X>>24,N=X>>16,f=X>>8,E=X;A.push(255&E),A.push(255&f),A.push(255&N),A.push(255&s)}function T(A,X){var s=Math.floor(X/Math.pow(2,32));e(A,X>>>0),e(A,s)}function I(A,X){var s=X/Math.pow(2,32)|0;e(A,X>>>0),e(A,s)}function L(A,X){q(A,X)}function k(A,X){S(A,X)}var x=new Int32Array(2),H=new Float32Array(x.buffer),F=new Float64Array(x.buffer);function q(A,X){H[0]=X,t(A,x[0])}function S(A,X){F[0]=X,t(A,x[0]),t(A,x[1])}function p(A,X){return l(A,X?1:0)}function B(A,X){X||(X="");var s=D(X),N=0;if(s<32)A.push(160|s),N=1;else if(s<256)A.push(217),l(A,s),N=2;else if(s<65536)A.push(218),U(A,s),N=3;else{if(!(s<4294967296))throw new Error("String too long");A.push(219),e(A,s),N=5}return O(A,A.length,X),N+s}function Z(A,X){return isNaN(X)?Z(A,0):isFinite(X)?X!==(0|X)?(A.push(203),S(A,X),9):X>=0?X<128?(l(A,X),1):X<256?(A.push(204),l(A,X),2):X<65536?(A.push(205),U(A,X),3):X<4294967296?(A.push(206),e(A,X),5):(A.push(207),I(A,X),9):X>=-32?(A.push(224|X+32),1):X>=-128?(A.push(208),P(A,X),2):X>=-32768?(A.push(209),n(A,X),3):X>=-2147483648?(A.push(210),t(A,X),5):(A.push(211),T(A,X),9):Z(A,X>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var o=Object.freeze({__proto__:null,utf8Write:O,int8:P,uint8:l,int16:n,uint16:U,int32:t,uint32:e,int64:T,uint64:I,float32:L,float64:k,writeFloat32:q,writeFloat64:S,boolean:p,string:B,number:Z});function W(A,X,s){for(var N="",f=0,E=X,g=X+s;E<g;E++){var K=A[E];0!==(128&K)?192!==(224&K)?224!==(240&K)?240!==(248&K)?console.error("Invalid byte "+K.toString(16)):(f=(7&K)<<18|(63&A[++E])<<12|(63&A[++E])<<6|63&A[++E])>=65536?(f-=65536,N+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):N+=String.fromCharCode(f):N+=String.fromCharCode((15&K)<<12|(63&A[++E])<<6|63&A[++E]):N+=String.fromCharCode((31&K)<<6|63&A[++E]):N+=String.fromCharCode(K)}return N}function h(A,X){return AA(A,X)<<24>>24}function AA(A,X){return A[X.offset++]}function XA(A,X){return sA(A,X)<<16>>16}function sA(A,X){return A[X.offset++]|A[X.offset++]<<8}function NA(A,X){return A[X.offset++]|A[X.offset++]<<8|A[X.offset++]<<16|A[X.offset++]<<24}function fA(A,X){return NA(A,X)>>>0}function EA(A,X){return cA(A,X)}function gA(A,X){return MA(A,X)}function KA(A,X){var s=fA(A,X);return NA(A,X)*Math.pow(2,32)+s}function rA(A,X){var s=fA(A,X);return fA(A,X)*Math.pow(2,32)+s}var iA=new Int32Array(2),YA=new Float32Array(iA.buffer),vA=new Float64Array(iA.buffer);function cA(A,X){return iA[0]=NA(A,X),YA[0]}function MA(A,X){return iA[0]=NA(A,X),iA[1]=NA(A,X),vA[0]}function dA(A,X){return AA(A,X)>0}function QA(A,X){var s,N=A[X.offset++];N<192?s=31&N:217===N?s=AA(A,X):218===N?s=sA(A,X):219===N&&(s=fA(A,X));var f=W(A,X.offset,s);return X.offset+=s,f}function wA(A,X){var s=A[X.offset];return s<192&&s>160||217===s||218===s||219===s}function RA(A,X){var s=A[X.offset++];return s<128?s:202===s?cA(A,X):203===s?MA(A,X):204===s?AA(A,X):205===s?sA(A,X):206===s?fA(A,X):207===s?rA(A,X):208===s?h(A,X):209===s?XA(A,X):210===s?NA(A,X):211===s?KA(A,X):s>223?-1*(255-s+1):void 0}function CA(A,X){var s=A[X.offset];return s<128||s>=202&&s<=211}function JA(A,X){return A[X.offset]<160}function aA(A,X){return A[X.offset-1]===g&&(A[X.offset]<128||A[X.offset]>=202&&A[X.offset]<=211)}var uA=Object.freeze({__proto__:null,int8:h,uint8:AA,int16:XA,uint16:sA,int32:NA,uint32:fA,float32:EA,float64:gA,int64:KA,uint64:rA,readFloat32:cA,readFloat64:MA,boolean:dA,string:QA,stringCheck:wA,number:RA,numberCheck:CA,arrayCheck:JA,switchStructureCheck:aA}),zA=function(){function X(A){var X=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,A&&A.forEach((function(A){return X.add(A)}))}return X.prototype.th=function(X,s){return void 0===s&&(s=!0),i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.ADD,X,s?this.$items:void 0)},X.prototype.sh=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.REPLACE,X)},X.is=function(A){return void 0!==A.collection},X.prototype.add=function(A){var X=this.$refId++;return void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,X),this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,A),this.$changes.change(X),X},X.prototype.at=function(A){var X=Array.from(this.$items.keys())[A];return this.$items.get(X)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(A){for(var X,s,N=this.$items.entries();(s=N.next())&&!s.done;)if(A===s.value[1]){X=s.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&Y.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:A.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(A){return Array.from(this.$items.values()).some((function(X){return X===A}))},X.prototype.forEach=function(A){var X=this;this.$items.forEach((function(s,N,f){return A(s,N,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(A,X){this.$indexes.set(A,X)},X.prototype.getIndex=function(A){return this.$indexes.get(A)},X.prototype.getByIndex=function(A){return this.$items.get(this.$indexes.get(A))},X.prototype.deleteByIndex=function(A){var X=this.$indexes.get(A);this.$items.delete(X),this.$indexes.delete(A)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var A=[];return this.forEach((function(X,s){A.push("function"===typeof X.toJSON?X.toJSON():X)})),A},X.prototype.clone=function(A){var s;return A?s=Object.assign(new X,this):(s=new X,this.forEach((function(A){A.$changes?s.add(A.clone()):s.add(A)}))),s},X}(),mA=function(){function X(A){var X=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,A&&A.forEach((function(A){return X.add(A)}))}return X.prototype.th=function(X,s){return void 0===s&&(s=!0),i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.ADD,X,s?this.$items:void 0)},X.prototype.sh=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.REPLACE,X)},X.is=function(A){return void 0!==A.set},X.prototype.add=function(X){var s,N;if(this.has(X))return!1;var f=this.$refId++;void 0!==X.$changes&&X.$changes.setParent(this,this.$changes.root,f);var E=null!==(N=null===(s=this.$changes.indexes[f])||void 0===s?void 0:s.op)&&void 0!==N?N:A.OPERATION.ADD;return this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,X),this.$changes.change(f,E),f},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(A){for(var X,s,N=this.$items.entries();(s=N.next())&&!s.done;)if(A===s.value[1]){X=s.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&Y.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:A.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(A){for(var X,s=this.$items.values(),N=!1;(X=s.next())&&!X.done;)if(A===X.value){N=!0;break}return N},X.prototype.forEach=function(A){var X=this;this.$items.forEach((function(s,N,f){return A(s,N,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(A,X){this.$indexes.set(A,X)},X.prototype.getIndex=function(A){return this.$indexes.get(A)},X.prototype.getByIndex=function(A){return this.$items.get(this.$indexes.get(A))},X.prototype.deleteByIndex=function(A){var X=this.$indexes.get(A);this.$items.delete(X),this.$indexes.delete(A)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var A=[];return this.forEach((function(X,s){A.push("function"===typeof X.toJSON?X.toJSON():X)})),A},X.prototype.clone=function(A){var s;return A?s=Object.assign(new X,this):(s=new X,this.forEach((function(A){A.$changes?s.add(A.clone()):s.add(A)}))),s},X}(),bA=function(){function A(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return A.prototype.addRefId=function(A){this.refIds.has(A)||(this.refIds.add(A),this.containerIndexes.set(A,new Set))},A.get=function(X){return void 0===X.$filterState&&(X.$filterState=new A),X.$filterState},A}(),yA=function(){function A(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return A.prototype.getNextUniqueId=function(){return this.nextUniqueId++},A.prototype.addRef=function(A,X,s){void 0===s&&(s=!0),this.refs.set(A,X),s&&(this.refCounts[A]=(this.refCounts[A]||0)+1)},A.prototype.removeRef=function(A){this.refCounts[A]=this.refCounts[A]-1,this.deletedRefs.add(A)},A.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},A.prototype.garbageCollectDeletedRefs=function(){var A=this;this.deletedRefs.forEach((function(X){if(!(A.refCounts[X]>0)){var s=A.refs.get(X);if(s instanceof PA)for(var N in s._definition.schema)"string"!==typeof s._definition.schema[N]&&s[N]&&s[N].$changes&&A.removeRef(s[N].$changes.refId);else{var f=s.$changes.parent._definition,E=f.schema[f.fieldsByIndex[s.$changes.parentIndex]];"function"===typeof Object.values(E)[0]&&Array.from(s.values()).forEach((function(X){return A.removeRef(X.$changes.refId)}))}A.refs.delete(X),delete A.refCounts[X]}})),this.deletedRefs.clear()},A}(),jA=function(A){function X(){return null!==A&&A.apply(this,arguments)||this}return s(X,A),X}(Error);function GA(A,X,s,N){var f,E=!1;switch(X){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":f="number",isNaN(A)&&console.log('trying to encode "NaN" in '.concat(s.constructor.name,"#").concat(N));break;case"string":f="string",E=!0;break;case"boolean":return}if(typeof A!==f&&(!E||E&&null!==A)){var g="'".concat(JSON.stringify(A),"'").concat(A&&A.constructor&&" (".concat(A.constructor.name,")")||"");throw new jA("a '".concat(f,"' was expected, but ").concat(g," was provided in ").concat(s.constructor.name,"#").concat(N))}}function VA(A,X,s,N){if(!(A instanceof X))throw new jA("a '".concat(X.name,"' was expected, but '").concat(A.constructor.name,"' was provided in ").concat(s.constructor.name,"#").concat(N))}function DA(A,X,s,N,f){GA(s,A,N,f);var E=o[A];if(!E)throw new jA("a '".concat(A,"' was expected, but ").concat(s," was provided in ").concat(N.constructor.name,"#").concat(f));E(X,s)}function OA(A,X,s){return uA[A](X,s)}var PA=function(){function X(){for(var A=[],X=0;X<arguments.length;X++)A[X]=arguments[X];Object.defineProperties(this,{$changes:{value:new r(this,void 0,new yA),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var s=this._definition.descriptors;s&&Object.defineProperties(this,s),A[0]&&this.assign(A[0])}return X.onError=function(A){console.error(A)},X.is=function(A){return A._definition&&void 0!==A._definition.schema},X.prototype.onChange=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.REPLACE,X)},X.prototype.sh=function(X){return i(this.$callbacks||(this.$callbacks=[]),A.OPERATION.DELETE,X)},X.prototype.assign=function(A){return Object.assign(this,A),this},Object.defineProperty(X.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),X.prototype.setDirty=function(A,X){this.$changes.change(A,X)},X.prototype.listen=function(A,X,s){var N=this;return void 0===s&&(s=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[A]||(this.$callbacks[A]=[]),this.$callbacks[A].push(X),s&&void 0!==this[A]&&X(this[A],void 0),function(){return v(N.$callbacks[A],N.$callbacks[A].indexOf(X))}},X.prototype.decode=function(s,N,f){var E;void 0===N&&(N={offset:0}),void 0===f&&(f=this);var K=[],r=this.$changes.root,i=s.length,Y=0;for(r.refs.set(Y,this);N.offset<i;){var v=s[N.offset++];if(v!=g){var c=f.$changes,M=void 0!==f._definition,Q=M?v>>6<<6:v;if(Q!==A.OPERATION.CLEAR){var R=M?v%(Q||255):RA(s,N),C=M?f._definition.fieldsByIndex[R]:"",a=c.getType(R),u=void 0,z=void 0,m=void 0;if(M?z=f["_".concat(C)]:(z=f.getByIndex(R),(Q&A.OPERATION.ADD)===A.OPERATION.ADD?(m=f instanceof w?QA(s,N):R,f.setIndex(R,m)):m=f.getIndex(R)),(Q&A.OPERATION.DELETE)===A.OPERATION.DELETE&&(Q!==A.OPERATION.DELETE_AND_ADD&&f.deleteByIndex(R),z&&z.$changes&&r.removeRef(z.$changes.refId),u=null),void 0!==C){if(Q===A.OPERATION.DELETE);else if(X.is(a)){var b=RA(s,N);if(u=r.refs.get(b),Q!==A.OPERATION.REPLACE){var y=this.getSchemaType(s,N,a);u||((u=this.createTypeInstance(y)).$changes.refId=b,z&&(u.$callbacks=z.$callbacks,z.$changes.refId&&b!==z.$changes.refId&&r.removeRef(z.$changes.refId))),r.addRef(b,u,u!==z)}}else if("string"===typeof a)u=OA(a,s,N);else{var j=J(Object.keys(a)[0]),G=RA(s,N),V=r.refs.has(G)?z||r.refs.get(G):new j.constructor;if((u=V.clone(!0)).$changes.refId=G,z&&(u.$callbacks=z.$callbacks,z.$changes.refId&&G!==z.$changes.refId)){r.removeRef(z.$changes.refId);for(var D=z.entries(),O=void 0;(O=D.next())&&!O.done;){var P=(E=O.value)[0],l=E[1];K.push({refId:G,op:A.OPERATION.DELETE,field:P,value:void 0,previousValue:l})}}r.addRef(G,u,V!==z)}if(null!==u&&void 0!==u)if(u.$changes&&u.$changes.setParent(c.ref,c.root,R),f instanceof X)f[C]=u;else if(f instanceof w)P=m,f.$items.set(P,u),f.$changes.allChanges.add(R);else if(f instanceof d)f.setAt(R,u);else if(f instanceof zA){var n=f.add(u);f.setIndex(R,n)}else f instanceof mA&&!1!==(n=f.add(u))&&f.setIndex(R,n);z!==u&&K.push({refId:Y,op:Q,field:C,dynamicIndex:m,value:u,previousValue:z})}else{console.warn("@colyseus/schema: definition mismatch");for(var U={offset:N.offset};N.offset<i&&(!aA(s,N)||(U.offset=N.offset+1,!r.refs.has(RA(s,U))));)N.offset++}}else f.clear(K)}else{Y=RA(s,N);var t=r.refs.get(Y);if(!t)throw new Error('"refId" not found: '.concat(Y));f=t}}return this._triggerChanges(K),r.garbageCollectDeletedRefs(),K},X.prototype.encode=function(s,N,f){void 0===s&&(s=!1),void 0===N&&(N=[]),void 0===f&&(f=!1);for(var E=this.$changes,K=new WeakSet,r=[E],i=1,Y=0;Y<i;Y++){var v=r[Y],c=v.ref,M=c instanceof X;v.ensureRefId(),K.add(v),v!==E&&(v.changed||s)&&(l(N,g),Z(N,v.refId));for(var d=s?Array.from(v.allChanges):Array.from(v.changes.values()),Q=0,R=d.length;Q<R;Q++){var C=s?{op:A.OPERATION.ADD,index:d[Q]}:d[Q],a=C.index,u=M?c._definition.fieldsByIndex&&c._definition.fieldsByIndex[a]:a,z=N.length;if(C.op!==A.OPERATION.TOUCH)if(M)l(N,a|C.op);else{if(l(N,C.op),C.op===A.OPERATION.CLEAR)continue;Z(N,a)}if(M||(C.op&A.OPERATION.ADD)!=A.OPERATION.ADD||c instanceof w&&B(N,v.ref.$indexes.get(a)),C.op!==A.OPERATION.DELETE){var m=v.getType(a),b=v.getValue(a);if(b&&b.$changes&&!K.has(b.$changes)&&(r.push(b.$changes),b.$changes.ensureRefId(),i++),C.op!==A.OPERATION.TOUCH){if(X.is(m))VA(b,m,c,u),Z(N,b.$changes.refId),(C.op&A.OPERATION.ADD)===A.OPERATION.ADD&&this.tryEncodeTypeId(N,m,b.constructor);else if("string"===typeof m)DA(m,N,b,c,u);else{var y=J(Object.keys(m)[0]);VA(c["_".concat(u)],y.constructor,c,u),Z(N,b.$changes.refId)}f&&v.cache(a,N.slice(z))}}}s||f||v.discard()}return N},X.prototype.encodeAll=function(A){return this.encode(!0,[],A)},X.prototype.applyFilters=function(s,N){var f,E;void 0===N&&(N=!1);for(var K=this,r=new Set,i=bA.get(s),Y=[this.$changes],v=1,c=[],M=function(M){var d=Y[M];if(r.has(d.refId))return"continue";var Q=d.ref,R=Q instanceof X;l(c,g),Z(c,d.refId);var C=i.refIds.has(d),J=N||!C;i.addRefId(d);var a=i.containerIndexes.get(d),u=J?Array.from(d.allChanges):Array.from(d.changes.values());!N&&R&&Q._definition.indexesWithFilters&&Q._definition.indexesWithFilters.forEach((function(X){!a.has(X)&&d.allChanges.has(X)&&(J?u.push(X):u.push({op:A.OPERATION.ADD,index:X}))}));for(var z=0,m=u.length;z<m;z++){var b=J?{op:A.OPERATION.ADD,index:u[z]}:u[z];if(b.op!==A.OPERATION.CLEAR){var y=b.index;if(b.op!==A.OPERATION.DELETE){var j=d.getValue(y),G=d.getType(y);if(R){if((V=Q._definition.filters&&Q._definition.filters[y])&&!V.call(Q,s,j,K)){j&&j.$changes&&r.add(j.$changes.refId);continue}}else{var V,D=d.parent;if((V=d.getChildrenFilter())&&!V.call(D,s,Q.$indexes.get(y),j,K)){j&&j.$changes&&r.add(j.$changes.refId);continue}}if(j.$changes&&(Y.push(j.$changes),v++),b.op!==A.OPERATION.TOUCH)if(b.op===A.OPERATION.ADD||R)c.push.apply(c,null!==(f=d.caches[y])&&void 0!==f?f:[]),a.add(y);else if(a.has(y))c.push.apply(c,null!==(E=d.caches[y])&&void 0!==E?E:[]);else{if(a.add(y),l(c,A.OPERATION.ADD),Z(c,y),Q instanceof w){var O=d.ref.$indexes.get(y);B(c,O)}j.$changes?Z(c,j.$changes.refId):o[G](c,j)}else j.$changes&&!R&&(l(c,A.OPERATION.ADD),Z(c,y),Q instanceof w&&(O=d.ref.$indexes.get(y),B(c,O)),Z(c,j.$changes.refId))}else R?l(c,b.op|y):(l(c,b.op),Z(c,y))}else l(c,b.op)}},d=0;d<v;d++)M(d);return c},X.prototype.clone=function(){var A,X=new this.constructor,s=this._definition.schema;for(var N in s)"object"===typeof this[N]&&"function"===typeof(null===(A=this[N])||void 0===A?void 0:A.clone)?X[N]=this[N].clone():X[N]=this[N];return X},X.prototype.toJSON=function(){var A=this._definition.schema,X=this._definition.deprecated,s={};for(var N in A)X[N]||null===this[N]||"undefined"===typeof this[N]||(s[N]="function"===typeof this[N].toJSON?this[N].toJSON():this["_".concat(N)]);return s},X.prototype.discardAllChanges=function(){this.$changes.discardAll()},X.prototype.getByIndex=function(A){return this[this._definition.fieldsByIndex[A]]},X.prototype.deleteByIndex=function(A){this[this._definition.fieldsByIndex[A]]=void 0},X.prototype.tryEncodeTypeId=function(A,X,s){X._typeid!==s._typeid&&(l(A,K),Z(A,s._typeid))},X.prototype.getSchemaType=function(A,X,s){var N;return A[X.offset]===K&&(X.offset++,N=this.constructor._context.get(RA(A,X))),N||s},X.prototype.createTypeInstance=function(A){var X=new A;return X.$changes.root=this.$changes.root,X},X.prototype._triggerChanges=function(s){for(var N,f,E,g,K,r,i,Y,v,c=new Set,M=this.$changes.root.refs,d=function(d){var Q=s[d],w=Q.refId,R=M.get(w),C=R.$callbacks;if((Q.op&A.OPERATION.DELETE)===A.OPERATION.DELETE&&Q.previousValue instanceof X&&(null===(f=null===(N=Q.previousValue.$callbacks)||void 0===N?void 0:N[A.OPERATION.DELETE])||void 0===f||f.forEach((function(A){return A()}))),!C)return"continue";if(R instanceof X){if(!c.has(w))try{null===(E=null===C||void 0===C?void 0:C[A.OPERATION.REPLACE])||void 0===E||E.forEach((function(A){return A()}))}catch(J){X.onError(J)}try{C.hasOwnProperty(Q.field)&&(null===(g=C[Q.field])||void 0===g||g.forEach((function(A){return A(Q.value,Q.previousValue)})))}catch(J){X.onError(J)}}else Q.op===A.OPERATION.ADD&&void 0===Q.previousValue?null===(K=C[A.OPERATION.ADD])||void 0===K||K.forEach((function(A){var X;return A(Q.value,null!==(X=Q.dynamicIndex)&&void 0!==X?X:Q.field)})):Q.op===A.OPERATION.DELETE?void 0!==Q.previousValue&&(null===(r=C[A.OPERATION.DELETE])||void 0===r||r.forEach((function(A){var X;return A(Q.previousValue,null!==(X=Q.dynamicIndex)&&void 0!==X?X:Q.field)}))):Q.op===A.OPERATION.DELETE_AND_ADD&&(void 0!==Q.previousValue&&(null===(i=C[A.OPERATION.DELETE])||void 0===i||i.forEach((function(A){var X;return A(Q.previousValue,null!==(X=Q.dynamicIndex)&&void 0!==X?X:Q.field)}))),null===(Y=C[A.OPERATION.ADD])||void 0===Y||Y.forEach((function(A){var X;return A(Q.value,null!==(X=Q.dynamicIndex)&&void 0!==X?X:Q.field)}))),Q.value!==Q.previousValue&&(null===(v=C[A.OPERATION.REPLACE])||void 0===v||v.forEach((function(A){var X;return A(Q.value,null!==(X=Q.dynamicIndex)&&void 0!==X?X:Q.field)})));c.add(w)},Q=0;Q<s.length;Q++)d(Q)},X._definition=a.create(),X}();function lA(A){for(var X=[A.$changes],s=1,N={},f=N,E=function(A){var s=X[A];s.changes.forEach((function(A){var X=s.ref,N=A.index,E=X._definition?X._definition.fieldsByIndex[N]:X.$indexes.get(N);f[E]=s.getValue(N)}))},g=0;g<s;g++)E(g);return N}var nA={context:new z},UA=function(A){function X(){return null!==A&&A.apply(this,arguments)||this}return s(X,A),N([b("string",nA)],X.prototype,"name",void 0),N([b("string",nA)],X.prototype,"type",void 0),N([b("number",nA)],X.prototype,"referencedType",void 0),X}(PA),tA=function(A){function X(){var X=null!==A&&A.apply(this,arguments)||this;return X.fields=new d,X}return s(X,A),N([b("number",nA)],X.prototype,"id",void 0),N([b([UA],nA)],X.prototype,"fields",void 0),X}(PA),eA=function(A){function X(){var X=null!==A&&A.apply(this,arguments)||this;return X.types=new d,X}return s(X,A),X.encode=function(A){var s=A.constructor,N=new X;N.rootType=s._typeid;var f=function(A,X){for(var s in X){var f=new UA;f.name=s;var E=void 0;if("string"===typeof X[s])E=X[s];else{var g=X[s],K=void 0;PA.is(g)?(E="ref",K=X[s]):"string"===typeof g[E=Object.keys(g)[0]]?E+=":"+g[E]:K=g[E],f.referencedType=K?K._typeid:-1}f.type=E,A.fields.push(f)}N.types.push(A)},E=s._context.types;for(var g in E){var K=new tA;K.id=Number(g),f(K,E[g]._definition.schema)}return N.encodeAll()},X.decode=function(A,N){var f=new z,E=new X;E.decode(A,N);var g=E.types.reduce((function(A,X){var N=function(A){function X(){return null!==A&&A.apply(this,arguments)||this}return s(X,A),X}(PA),E=X.id;return A[E]=N,f.add(N,E),A}),{});E.types.forEach((function(A){var X=g[A.id];A.fields.forEach((function(A){var s;if(void 0!==A.referencedType){var N=A.type,E=g[A.referencedType];if(!E){var K=A.type.split(":");N=K[0],E=K[1]}"ref"===N?b(E,{context:f})(X.prototype,A.name):b(((s={})[N]=E,s),{context:f})(X.prototype,A.name)}else b(A.type,{context:f})(X.prototype,A.name)}))}));var K=g[E.rootType],r=new K;for(var i in K._definition.schema){var Y=K._definition.schema[i];"string"!==typeof Y&&(r[i]="function"===typeof Y?new Y:new(J(Object.keys(Y)[0]).constructor))}return r},N([b([tA],nA)],X.prototype,"types",void 0),N([b("number",nA)],X.prototype,"rootType",void 0),X}(PA);C("map",{constructor:w}),C("array",{constructor:d}),C("set",{constructor:mA}),C("collection",{constructor:zA}),A.ArraySchema=d,A.CollectionSchema=zA,A.Context=z,A.MapSchema=w,A.Reflection=eA,A.ReflectionField=UA,A.ReflectionType=tA,A.Schema=PA,A.SchemaDefinition=a,A.SetSchema=mA,A.decode=uA,A.defineTypes=V,A.deprecated=G,A.dumpChanges=lA,A.encode=o,A.filter=y,A.filterChildren=j,A.hasFilter=u,A.registerType=C,A.type=b,Object.defineProperty(A,"__esModule",{value:!0})}(X)},12890:A=>{"use strict";A.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12881:(A,X,s)=>{var N=s(12890),f=s(12898),E=Object.hasOwnProperty,g=Object.create(null);for(var K in N)E.call(N,K)&&(g[N[K]]=K);var r=A.exports={to:{},get:{}};function i(A,X,s){return Math.min(Math.max(X,A),s)}function Y(A){var X=Math.round(A).toString(16).toUpperCase();return X.length<2?"0"+X:X}r.get=function(A){var X,s;switch(A.substring(0,3).toLowerCase()){case"hsl":X=r.get.hsl(A),s="hsl";break;case"hwb":X=r.get.hwb(A),s="hwb";break;default:X=r.get.rgb(A),s="rgb"}return X?{model:s,value:X}:null},r.get.rgb=function(A){if(!A)return null;var X,s,f,g=[0,0,0,1];if(X=A.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(f=X[2],X=X[1],s=0;s<3;s++){var K=2*s;g[s]=parseInt(X.slice(K,K+2),16)}f&&(g[3]=parseInt(f,16)/255)}else if(X=A.match(/^#([a-f0-9]{3,4})$/i)){for(f=(X=X[1])[3],s=0;s<3;s++)g[s]=parseInt(X[s]+X[s],16);f&&(g[3]=parseInt(f+f,16)/255)}else if(X=A.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(s=0;s<3;s++)g[s]=parseInt(X[s+1],0);X[4]&&(X[5]?g[3]=.01*parseFloat(X[4]):g[3]=parseFloat(X[4]))}else{if(!(X=A.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(X=A.match(/^(\w+)$/))?"transparent"===X[1]?[0,0,0,0]:E.call(N,X[1])?((g=N[X[1]])[3]=1,g):null:null;for(s=0;s<3;s++)g[s]=Math.round(2.55*parseFloat(X[s+1]));X[4]&&(X[5]?g[3]=.01*parseFloat(X[4]):g[3]=parseFloat(X[4]))}for(s=0;s<3;s++)g[s]=i(g[s],0,255);return g[3]=i(g[3],0,1),g},r.get.hsl=function(A){if(!A)return null;var X=A.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var s=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,i(parseFloat(X[2]),0,100),i(parseFloat(X[3]),0,100),i(isNaN(s)?1:s,0,1)]}return null},r.get.hwb=function(A){if(!A)return null;var X=A.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var s=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,i(parseFloat(X[2]),0,100),i(parseFloat(X[3]),0,100),i(isNaN(s)?1:s,0,1)]}return null},r.to.hex=function(){var A=f(arguments);return"#"+Y(A[0])+Y(A[1])+Y(A[2])+(A[3]<1?Y(Math.round(255*A[3])):"")},r.to.rgb=function(){var A=f(arguments);return A.length<4||1===A[3]?"rgb("+Math.round(A[0])+", "+Math.round(A[1])+", "+Math.round(A[2])+")":"rgba("+Math.round(A[0])+", "+Math.round(A[1])+", "+Math.round(A[2])+", "+A[3]+")"},r.to.rgb.percent=function(){var A=f(arguments),X=Math.round(A[0]/255*100),s=Math.round(A[1]/255*100),N=Math.round(A[2]/255*100);return A.length<4||1===A[3]?"rgb("+X+"%, "+s+"%, "+N+"%)":"rgba("+X+"%, "+s+"%, "+N+"%, "+A[3]+")"},r.to.hsl=function(){var A=f(arguments);return A.length<4||1===A[3]?"hsl("+A[0]+", "+A[1]+"%, "+A[2]+"%)":"hsla("+A[0]+", "+A[1]+"%, "+A[2]+"%, "+A[3]+")"},r.to.hwb=function(){var A=f(arguments),X="";return A.length>=4&&1!==A[3]&&(X=", "+A[3]),"hwb("+A[0]+", "+A[1]+"%, "+A[2]+"%"+X+")"},r.to.keyword=function(A){return g[A.slice(0,3)]}},12879:(A,X,s)=>{const N=s(12881),f=s(12908),E=["keyword","gray","hex"],g={};for(const M of Object.keys(f))g[[...f[M].labels].sort().join("")]=M;const K={};function r(A,X){if(!(this instanceof r))return new r(A,X);if(X&&X in E&&(X=null),X&&!(X in f))throw new Error("Unknown model: "+X);let s,i;if(null==A)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(A instanceof r)this.model=A.model,this.color=[...A.color],this.valpha=A.valpha;else if("string"===typeof A){const X=N.get(A);if(null===X)throw new Error("Unable to parse color from string: "+A);this.model=X.model,i=f[this.model].channels,this.color=X.value.slice(0,i),this.valpha="number"===typeof X.value[i]?X.value[i]:1}else if(A.length>0){this.model=X||"rgb",i=f[this.model].channels;const s=Array.prototype.slice.call(A,0,i);this.color=c(s,i),this.valpha="number"===typeof A[i]?A[i]:1}else if("number"===typeof A)this.model="rgb",this.color=[A>>16&255,A>>8&255,255&A],this.valpha=1;else{this.valpha=1;const X=Object.keys(A);"alpha"in A&&(X.splice(X.indexOf("alpha"),1),this.valpha="number"===typeof A.alpha?A.alpha:0);const N=X.sort().join("");if(!(N in g))throw new Error("Unable to parse color from object: "+JSON.stringify(A));this.model=g[N];const{labels:E}=f[this.model],K=[];for(s=0;s<E.length;s++)K.push(A[E[s]]);this.color=c(K)}if(K[this.model])for(i=f[this.model].channels,s=0;s<i;s++){const A=K[this.model][s];A&&(this.color[s]=A(this.color[s]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}r.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(A){let X=this.model in N.to?this:this.rgb();X=X.round("number"===typeof A?A:1);const s=1===X.valpha?X.color:[...X.color,this.valpha];return N.to[X.model](s)},percentString(A){const X=this.rgb().round("number"===typeof A?A:1),s=1===X.valpha?X.color:[...X.color,this.valpha];return N.to.rgb.percent(s)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const A={},{channels:X}=f[this.model],{labels:s}=f[this.model];for(let N=0;N<X;N++)A[s[N]]=this.color[N];return 1!==this.valpha&&(A.alpha=this.valpha),A},unitArray(){const A=this.rgb().color;return A[0]/=255,A[1]/=255,A[2]/=255,1!==this.valpha&&A.push(this.valpha),A},unitObject(){const A=this.rgb().object();return A.r/=255,A.g/=255,A.b/=255,1!==this.valpha&&(A.alpha=this.valpha),A},round(A){return A=Math.max(A||0,0),new r([...this.color.map(i(A)),this.valpha],this.model)},alpha(A){return void 0!==A?new r([...this.color,Math.max(0,Math.min(1,A))],this.model):this.valpha},red:Y("rgb",0,v(255)),green:Y("rgb",1,v(255)),blue:Y("rgb",2,v(255)),hue:Y(["hsl","hsv","hsl","hwb","hcg"],0,(A=>(A%360+360)%360)),saturationl:Y("hsl",1,v(100)),lightness:Y("hsl",2,v(100)),saturationv:Y("hsv",1,v(100)),value:Y("hsv",2,v(100)),chroma:Y("hcg",1,v(100)),gray:Y("hcg",2,v(100)),white:Y("hwb",1,v(100)),wblack:Y("hwb",2,v(100)),cyan:Y("cmyk",0,v(100)),magenta:Y("cmyk",1,v(100)),yellow:Y("cmyk",2,v(100)),black:Y("cmyk",3,v(100)),x:Y("xyz",0,v(95.047)),y:Y("xyz",1,v(100)),z:Y("xyz",2,v(108.833)),l:Y("lab",0,v(100)),a:Y("lab",1),b:Y("lab",2),keyword(A){return void 0!==A?new r(A):f[this.model].keyword(this.color)},hex(A){return void 0!==A?new r(A):N.to.hex(this.rgb().round().color)},hexa(A){if(void 0!==A)return new r(A);const X=this.rgb().round().color;let s=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===s.length&&(s="0"+s),N.to.hex(X)+s},rgbNumber(){const A=this.rgb().color;return(255&A[0])<<16|(255&A[1])<<8|255&A[2]},luminosity(){const A=this.rgb().color,X=[];for(const[s,N]of A.entries()){const A=N/255;X[s]=A<=.04045?A/12.92:((A+.055)/1.055)**2.4}return.2126*X[0]+.7152*X[1]+.0722*X[2]},contrast(A){const X=this.luminosity(),s=A.luminosity();return X>s?(X+.05)/(s+.05):(s+.05)/(X+.05)},level(A){const X=this.contrast(A);return X>=7?"AAA":X>=4.5?"AA":""},isDark(){const A=this.rgb().color;return(2126*A[0]+7152*A[1]+722*A[2])/1e4<128},isLight(){return!this.isDark()},negate(){const A=this.rgb();for(let X=0;X<3;X++)A.color[X]=255-A.color[X];return A},lighten(A){const X=this.hsl();return X.color[2]+=X.color[2]*A,X},darken(A){const X=this.hsl();return X.color[2]-=X.color[2]*A,X},saturate(A){const X=this.hsl();return X.color[1]+=X.color[1]*A,X},desaturate(A){const X=this.hsl();return X.color[1]-=X.color[1]*A,X},whiten(A){const X=this.hwb();return X.color[1]+=X.color[1]*A,X},blacken(A){const X=this.hwb();return X.color[2]+=X.color[2]*A,X},grayscale(){const A=this.rgb().color,X=.3*A[0]+.59*A[1]+.11*A[2];return r.rgb(X,X,X)},fade(A){return this.alpha(this.valpha-this.valpha*A)},opaquer(A){return this.alpha(this.valpha+this.valpha*A)},rotate(A){const X=this.hsl();let s=X.color[0];return s=(s+A)%360,s=s<0?360+s:s,X.color[0]=s,X},mix(A,X){if(!A||!A.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof A);const s=A.rgb(),N=this.rgb(),f=void 0===X?.5:X,E=2*f-1,g=s.alpha()-N.alpha(),K=((E*g===-1?E:(E+g)/(1+E*g))+1)/2,i=1-K;return r.rgb(K*s.red()+i*N.red(),K*s.green()+i*N.green(),K*s.blue()+i*N.blue(),s.alpha()*f+N.alpha()*(1-f))}};for(const M of Object.keys(f)){if(E.includes(M))continue;const{channels:A}=f[M];r.prototype[M]=function(){if(this.model===M)return new r(this);for(var A=arguments.length,X=new Array(A),s=0;s<A;s++)X[s]=arguments[s];return X.length>0?new r(X,M):new r([...(N=f[this.model][M].raw(this.color),Array.isArray(N)?N:[N]),this.valpha],M);var N},r[M]=function(){for(var X=arguments.length,s=new Array(X),N=0;N<X;N++)s[N]=arguments[N];let f=s[0];return"number"===typeof f&&(f=c(s,A)),new r(f,M)}}function i(A){return function(X){return function(A,X){return Number(A.toFixed(X))}(X,A)}}function Y(A,X,s){A=Array.isArray(A)?A:[A];for(const N of A)(K[N]||(K[N]=[]))[X]=s;return A=A[0],function(N){let f;return void 0!==N?(s&&(N=s(N)),f=this[A](),f.color[X]=N,f):(f=this[A]().color[X],s&&(f=s(f)),f)}}function v(A){return function(X){return Math.max(0,Math.min(A,X))}}function c(A,X){for(let s=0;s<X;s++)"number"!==typeof A[s]&&(A[s]=0);return A}A.exports=r},12910:(A,X,s)=>{const N=s(12917),f={};for(const g of Object.keys(N))f[N[g]]=g;const E={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};A.exports=E;for(const g of Object.keys(E)){if(!("channels"in E[g]))throw new Error("missing channels property: "+g);if(!("labels"in E[g]))throw new Error("missing channel labels property: "+g);if(E[g].labels.length!==E[g].channels)throw new Error("channel and label counts mismatch: "+g);const{channels:A,labels:X}=E[g];delete E[g].channels,delete E[g].labels,Object.defineProperty(E[g],"channels",{value:A}),Object.defineProperty(E[g],"labels",{value:X})}E.rgb.hsl=function(A){const X=A[0]/255,s=A[1]/255,N=A[2]/255,f=Math.min(X,s,N),E=Math.max(X,s,N),g=E-f;let K,r;E===f?K=0:X===E?K=(s-N)/g:s===E?K=2+(N-X)/g:N===E&&(K=4+(X-s)/g),K=Math.min(60*K,360),K<0&&(K+=360);const i=(f+E)/2;return r=E===f?0:i<=.5?g/(E+f):g/(2-E-f),[K,100*r,100*i]},E.rgb.hsv=function(A){let X,s,N,f,E;const g=A[0]/255,K=A[1]/255,r=A[2]/255,i=Math.max(g,K,r),Y=i-Math.min(g,K,r),v=function(A){return(i-A)/6/Y+.5};return 0===Y?(f=0,E=0):(E=Y/i,X=v(g),s=v(K),N=v(r),g===i?f=N-s:K===i?f=1/3+X-N:r===i&&(f=2/3+s-X),f<0?f+=1:f>1&&(f-=1)),[360*f,100*E,100*i]},E.rgb.hwb=function(A){const X=A[0],s=A[1];let N=A[2];const f=E.rgb.hsl(A)[0],g=1/255*Math.min(X,Math.min(s,N));return N=1-1/255*Math.max(X,Math.max(s,N)),[f,100*g,100*N]},E.rgb.cmyk=function(A){const X=A[0]/255,s=A[1]/255,N=A[2]/255,f=Math.min(1-X,1-s,1-N);return[100*((1-X-f)/(1-f)||0),100*((1-s-f)/(1-f)||0),100*((1-N-f)/(1-f)||0),100*f]},E.rgb.keyword=function(A){const X=f[A];if(X)return X;let s,E=1/0;for(const f of Object.keys(N)){const X=N[f],r=(K=X,((g=A)[0]-K[0])**2+(g[1]-K[1])**2+(g[2]-K[2])**2);r<E&&(E=r,s=f)}var g,K;return s},E.keyword.rgb=function(A){return N[A]},E.rgb.xyz=function(A){let X=A[0]/255,s=A[1]/255,N=A[2]/255;X=X>.04045?((X+.055)/1.055)**2.4:X/12.92,s=s>.04045?((s+.055)/1.055)**2.4:s/12.92,N=N>.04045?((N+.055)/1.055)**2.4:N/12.92;return[100*(.4124*X+.3576*s+.1805*N),100*(.2126*X+.7152*s+.0722*N),100*(.0193*X+.1192*s+.9505*N)]},E.rgb.lab=function(A){const X=E.rgb.xyz(A);let s=X[0],N=X[1],f=X[2];s/=95.047,N/=100,f/=108.883,s=s>.008856?s**(1/3):7.787*s+16/116,N=N>.008856?N**(1/3):7.787*N+16/116,f=f>.008856?f**(1/3):7.787*f+16/116;return[116*N-16,500*(s-N),200*(N-f)]},E.hsl.rgb=function(A){const X=A[0]/360,s=A[1]/100,N=A[2]/100;let f,E,g;if(0===s)return g=255*N,[g,g,g];f=N<.5?N*(1+s):N+s-N*s;const K=2*N-f,r=[0,0,0];for(let i=0;i<3;i++)E=X+1/3*-(i-1),E<0&&E++,E>1&&E--,g=6*E<1?K+6*(f-K)*E:2*E<1?f:3*E<2?K+(f-K)*(2/3-E)*6:K,r[i]=255*g;return r},E.hsl.hsv=function(A){const X=A[0];let s=A[1]/100,N=A[2]/100,f=s;const E=Math.max(N,.01);N*=2,s*=N<=1?N:2-N,f*=E<=1?E:2-E;return[X,100*(0===N?2*f/(E+f):2*s/(N+s)),100*((N+s)/2)]},E.hsv.rgb=function(A){const X=A[0]/60,s=A[1]/100;let N=A[2]/100;const f=Math.floor(X)%6,E=X-Math.floor(X),g=255*N*(1-s),K=255*N*(1-s*E),r=255*N*(1-s*(1-E));switch(N*=255,f){case 0:return[N,r,g];case 1:return[K,N,g];case 2:return[g,N,r];case 3:return[g,K,N];case 4:return[r,g,N];case 5:return[N,g,K]}},E.hsv.hsl=function(A){const X=A[0],s=A[1]/100,N=A[2]/100,f=Math.max(N,.01);let E,g;g=(2-s)*N;const K=(2-s)*f;return E=s*f,E/=K<=1?K:2-K,E=E||0,g/=2,[X,100*E,100*g]},E.hwb.rgb=function(A){const X=A[0]/360;let s=A[1]/100,N=A[2]/100;const f=s+N;let E;f>1&&(s/=f,N/=f);const g=Math.floor(6*X),K=1-N;E=6*X-g,0!==(1&g)&&(E=1-E);const r=s+E*(K-s);let i,Y,v;switch(g){default:case 6:case 0:i=K,Y=r,v=s;break;case 1:i=r,Y=K,v=s;break;case 2:i=s,Y=K,v=r;break;case 3:i=s,Y=r,v=K;break;case 4:i=r,Y=s,v=K;break;case 5:i=K,Y=s,v=r}return[255*i,255*Y,255*v]},E.cmyk.rgb=function(A){const X=A[0]/100,s=A[1]/100,N=A[2]/100,f=A[3]/100;return[255*(1-Math.min(1,X*(1-f)+f)),255*(1-Math.min(1,s*(1-f)+f)),255*(1-Math.min(1,N*(1-f)+f))]},E.xyz.rgb=function(A){const X=A[0]/100,s=A[1]/100,N=A[2]/100;let f,E,g;return f=3.2406*X+-1.5372*s+-.4986*N,E=-.9689*X+1.8758*s+.0415*N,g=.0557*X+-.204*s+1.057*N,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,f=Math.min(Math.max(0,f),1),E=Math.min(Math.max(0,E),1),g=Math.min(Math.max(0,g),1),[255*f,255*E,255*g]},E.xyz.lab=function(A){let X=A[0],s=A[1],N=A[2];X/=95.047,s/=100,N/=108.883,X=X>.008856?X**(1/3):7.787*X+16/116,s=s>.008856?s**(1/3):7.787*s+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*s-16,500*(X-s),200*(s-N)]},E.lab.xyz=function(A){let X,s,N;s=(A[0]+16)/116,X=A[1]/500+s,N=s-A[2]/200;const f=s**3,E=X**3,g=N**3;return s=f>.008856?f:(s-16/116)/7.787,X=E>.008856?E:(X-16/116)/7.787,N=g>.008856?g:(N-16/116)/7.787,X*=95.047,s*=100,N*=108.883,[X,s,N]},E.lab.lch=function(A){const X=A[0],s=A[1],N=A[2];let f;f=360*Math.atan2(N,s)/2/Math.PI,f<0&&(f+=360);return[X,Math.sqrt(s*s+N*N),f]},E.lch.lab=function(A){const X=A[0],s=A[1],N=A[2]/360*2*Math.PI;return[X,s*Math.cos(N),s*Math.sin(N)]},E.rgb.ansi16=function(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[s,N,f]=A;let g=null===X?E.rgb.hsv(A)[2]:X;if(g=Math.round(g/50),0===g)return 30;let K=30+(Math.round(f/255)<<2|Math.round(N/255)<<1|Math.round(s/255));return 2===g&&(K+=60),K},E.hsv.ansi16=function(A){return E.rgb.ansi16(E.hsv.rgb(A),A[2])},E.rgb.ansi256=function(A){const X=A[0],s=A[1],N=A[2];if(X===s&&s===N)return X<8?16:X>248?231:Math.round((X-8)/247*24)+232;return 16+36*Math.round(X/255*5)+6*Math.round(s/255*5)+Math.round(N/255*5)},E.ansi16.rgb=function(A){let X=A%10;if(0===X||7===X)return A>50&&(X+=3.5),X=X/10.5*255,[X,X,X];const s=.5*(1+~~(A>50));return[(1&X)*s*255,(X>>1&1)*s*255,(X>>2&1)*s*255]},E.ansi256.rgb=function(A){if(A>=232){const X=10*(A-232)+8;return[X,X,X]}let X;A-=16;return[Math.floor(A/36)/5*255,Math.floor((X=A%36)/6)/5*255,X%6/5*255]},E.rgb.hex=function(A){const X=(((255&Math.round(A[0]))<<16)+((255&Math.round(A[1]))<<8)+(255&Math.round(A[2]))).toString(16).toUpperCase();return"000000".substring(X.length)+X},E.hex.rgb=function(A){const X=A.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!X)return[0,0,0];let s=X[0];3===X[0].length&&(s=s.split("").map((A=>A+A)).join(""));const N=parseInt(s,16);return[N>>16&255,N>>8&255,255&N]},E.rgb.hcg=function(A){const X=A[0]/255,s=A[1]/255,N=A[2]/255,f=Math.max(Math.max(X,s),N),E=Math.min(Math.min(X,s),N),g=f-E;let K,r;return K=g<1?E/(1-g):0,r=g<=0?0:f===X?(s-N)/g%6:f===s?2+(N-X)/g:4+(X-s)/g,r/=6,r%=1,[360*r,100*g,100*K]},E.hsl.hcg=function(A){const X=A[1]/100,s=A[2]/100,N=s<.5?2*X*s:2*X*(1-s);let f=0;return N<1&&(f=(s-.5*N)/(1-N)),[A[0],100*N,100*f]},E.hsv.hcg=function(A){const X=A[1]/100,s=A[2]/100,N=X*s;let f=0;return N<1&&(f=(s-N)/(1-N)),[A[0],100*N,100*f]},E.hcg.rgb=function(A){const X=A[0]/360,s=A[1]/100,N=A[2]/100;if(0===s)return[255*N,255*N,255*N];const f=[0,0,0],E=X%1*6,g=E%1,K=1-g;let r=0;switch(Math.floor(E)){case 0:f[0]=1,f[1]=g,f[2]=0;break;case 1:f[0]=K,f[1]=1,f[2]=0;break;case 2:f[0]=0,f[1]=1,f[2]=g;break;case 3:f[0]=0,f[1]=K,f[2]=1;break;case 4:f[0]=g,f[1]=0,f[2]=1;break;default:f[0]=1,f[1]=0,f[2]=K}return r=(1-s)*N,[255*(s*f[0]+r),255*(s*f[1]+r),255*(s*f[2]+r)]},E.hcg.hsv=function(A){const X=A[1]/100,s=X+A[2]/100*(1-X);let N=0;return s>0&&(N=X/s),[A[0],100*N,100*s]},E.hcg.hsl=function(A){const X=A[1]/100,s=A[2]/100*(1-X)+.5*X;let N=0;return s>0&&s<.5?N=X/(2*s):s>=.5&&s<1&&(N=X/(2*(1-s))),[A[0],100*N,100*s]},E.hcg.hwb=function(A){const X=A[1]/100,s=X+A[2]/100*(1-X);return[A[0],100*(s-X),100*(1-s)]},E.hwb.hcg=function(A){const X=A[1]/100,s=1-A[2]/100,N=s-X;let f=0;return N<1&&(f=(s-N)/(1-N)),[A[0],100*N,100*f]},E.apple.rgb=function(A){return[A[0]/65535*255,A[1]/65535*255,A[2]/65535*255]},E.rgb.apple=function(A){return[A[0]/255*65535,A[1]/255*65535,A[2]/255*65535]},E.gray.rgb=function(A){return[A[0]/100*255,A[0]/100*255,A[0]/100*255]},E.gray.hsl=function(A){return[0,0,A[0]]},E.gray.hsv=E.gray.hsl,E.gray.hwb=function(A){return[0,100,A[0]]},E.gray.cmyk=function(A){return[0,0,0,A[0]]},E.gray.lab=function(A){return[A[0],0,0]},E.gray.hex=function(A){const X=255&Math.round(A[0]/100*255),s=((X<<16)+(X<<8)+X).toString(16).toUpperCase();return"000000".substring(s.length)+s},E.rgb.gray=function(A){return[(A[0]+A[1]+A[2])/3/255*100]}},12908:(A,X,s)=>{const N=s(12910),f=s(12925),E={};Object.keys(N).forEach((A=>{E[A]={},Object.defineProperty(E[A],"channels",{value:N[A].channels}),Object.defineProperty(E[A],"labels",{value:N[A].labels});const X=f(A);Object.keys(X).forEach((s=>{const N=X[s];E[A][s]=function(A){const X=function(){for(var X=arguments.length,s=new Array(X),N=0;N<X;N++)s[N]=arguments[N];const f=s[0];if(void 0===f||null===f)return f;f.length>1&&(s=f);const E=A(s);if("object"===typeof E)for(let A=E.length,g=0;g<A;g++)E[g]=Math.round(E[g]);return E};return"conversion"in A&&(X.conversion=A.conversion),X}(N),E[A][s].raw=function(A){const X=function(){for(var X=arguments.length,s=new Array(X),N=0;N<X;N++)s[N]=arguments[N];const f=s[0];return void 0===f||null===f?f:(f.length>1&&(s=f),A(s))};return"conversion"in A&&(X.conversion=A.conversion),X}(N)}))})),A.exports=E},12925:(A,X,s)=>{const N=s(12910);function f(A){const X=function(){const A={},X=Object.keys(N);for(let s=X.length,N=0;N<s;N++)A[X[N]]={distance:-1,parent:null};return A}(),s=[A];for(X[A].distance=0;s.length;){const A=s.pop(),f=Object.keys(N[A]);for(let N=f.length,E=0;E<N;E++){const N=f[E],g=X[N];-1===g.distance&&(g.distance=X[A].distance+1,g.parent=A,s.unshift(N))}}return X}function E(A,X){return function(s){return X(A(s))}}function g(A,X){const s=[X[A].parent,A];let f=N[X[A].parent][A],g=X[A].parent;for(;X[g].parent;)s.unshift(X[g].parent),f=E(N[X[g].parent][g],f),g=X[g].parent;return f.conversion=s,f}A.exports=function(A){const X=f(A),s={},N=Object.keys(X);for(let f=N.length,E=0;E<f;E++){const A=N[E];null!==X[A].parent&&(s[A]=g(A,X))}return s}},12917:A=>{"use strict";A.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11839:function(A,X,s){"use strict";var N=this&&this.__createBinding||(Object.create?function(A,X,s,N){void 0===N&&(N=s);var f=Object.getOwnPropertyDescriptor(X,s);f&&!("get"in f?!X.__esModule:f.writable||f.configurable)||(f={enumerable:!0,get:function(){return X[s]}}),Object.defineProperty(A,N,f)}:function(A,X,s,N){void 0===N&&(N=s),A[N]=X[s]}),f=this&&this.__setModuleDefault||(Object.create?function(A,X){Object.defineProperty(A,"default",{enumerable:!0,value:X})}:function(A,X){A.default=X}),E=this&&this.__importStar||function(A){if(A&&A.__esModule)return A;var X={};if(null!=A)for(var s in A)"default"!==s&&Object.prototype.hasOwnProperty.call(A,s)&&N(X,A,s);return f(X,A),X},g=this&&this.__awaiter||function(A,X,s,N){return new(s||(s=Promise))((function(f,E){function g(A){try{r(N.next(A))}catch(X){E(X)}}function K(A){try{r(N.throw(A))}catch(X){E(X)}}function r(A){var X;A.done?f(A.value):(X=A.value,X instanceof s?X:new s((function(A){A(X)}))).then(g,K)}r((N=N.apply(A,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Auth=X.Platform=void 0;const K=E(s(11784)),r=s(11844),i="colyseus-auth-token";!function(A){A.ios="ios",A.android="android"}(X.Platform||(X.Platform={}));X.Auth=class{constructor(A){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=A.replace("ws","http"),(0,r.getItem)(i,(A=>this.token=A))}get hasToken(){return!!this.token}login(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g(this,void 0,void 0,(function*(){const X=Object.assign({},A);this.hasToken&&(X.token=this.token);const s=yield this.request("post","/auth",X);this.token=s.token,(0,r.setItem)(i,this.token);for(let A in s)this.hasOwnProperty(A)&&(this[A]=s[A]);return this.registerPingService(),this}))}save(){return g(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return g(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(A){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:A})}))}acceptFriendRequest(A){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:A})}))}declineFriendRequest(A){return g(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:A})}))}blockUser(A){return g(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:A})}))}unblockUser(A){return g(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:A})}))}request(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3?arguments[3]:void 0,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return g(this,void 0,void 0,(function*(){f.Accept="application/json",this.hasToken&&(f.Authorization="Bearer "+this.token);const E=[];for(const A in s)E.push(`${A}=${s[A]}`);const g=E.length>0?`?${E.join("&")}`:"",r={headers:f};return N&&(r.body=N),(yield K[A](`${this.endpoint}${X}${g}`,r)).data}))}logout(){this.token=void 0,(0,r.removeItem)(i),this.unregisterPingService()}registerPingService(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),A)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11779:function(A,X,s){"use strict";var N,f=this&&this.__awaiter||function(A,X,s,N){return new(s||(s=Promise))((function(f,E){function g(A){try{r(N.next(A))}catch(X){E(X)}}function K(A){try{r(N.throw(A))}catch(X){E(X)}}function r(A){var X;A.done?f(A.value):(X=A.value,X instanceof s?X:new s((function(A){A(X)}))).then(g,K)}r((N=N.apply(A,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Client=X.MatchMakeError=void 0;const E=s(11784),g=s(11787),K=s(11791);class r extends Error{constructor(A,X){super(A),this.code=X,Object.setPrototypeOf(this,r.prototype)}}X.MatchMakeError=r;const i="undefined"!==typeof window&&"undefined"!==typeof(null===(N=null===window||void 0===window?void 0:window.location)||void 0===N?void 0:N.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";X.Client=class{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;if("string"===typeof A){const X=new URL(A),s="https:"===X.protocol||"wss:"===X.protocol,N=Number(X.port||(s?443:80));this.settings={hostname:X.hostname,pathname:"/"!==X.pathname?X.pathname:"",port:N,secure:s}}else void 0===A.port&&(A.port=A.secure?443:80),void 0===A.pathname&&(A.pathname=""),this.settings=A}joinOrCreate(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return f(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",A,X,s)}))}create(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return f(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",A,X,s)}))}join(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return f(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",A,X,s)}))}joinById(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;return f(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",A,X,s)}))}reconnect(A,X){return f(this,void 0,void 0,(function*(){if("string"===typeof A&&"string"===typeof X)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[s,N]=A.split(":");return yield this.createMatchMakeRequest("reconnect",s,{reconnectionToken:N},X)}))}getAvailableRooms(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return f(this,void 0,void 0,(function*(){return(yield(0,E.get)(this.getHttpEndpoint(`${A}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(A,X,s){return f(this,void 0,void 0,(function*(){const N=this.createRoom(A.room.name,X);N.roomId=A.room.roomId,N.sessionId=A.sessionId;const E={sessionId:N.sessionId};A.reconnectionToken&&(E.reconnectionToken=A.reconnectionToken);const K=s||N;return N.connect(this.buildEndpoint(A.room,E),A.devMode&&(()=>f(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${N.roomId}'...`);let s=0;const E=()=>f(this,void 0,void 0,(function*(){s++;try{yield this.consumeSeatReservation(A,X,K),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${N.roomId}'`)}catch(f){s<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${s} out of 8)`),setTimeout(E,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(E,2e3)}))),K),new Promise(((A,X)=>{const s=(A,s)=>X(new g.ServerError(A,s));K.onError.once(s),K.onJoin.once((()=>{K.onError.remove(s),A(K)}))}))}))}createMatchMakeRequest(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;return f(this,void 0,void 0,(function*(){const f=(yield(0,E.post)(this.getHttpEndpoint(`${A}/${X}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).data;if(f.error)throw new r(f.error,f.code);return"reconnect"===A&&(f.reconnectionToken=s.reconnectionToken),yield this.consumeSeatReservation(f,N,g)}))}createRoom(A,X){return new K.Room(A,X)}buildEndpoint(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[];for(const f in X)X.hasOwnProperty(f)&&s.push(`${f}=${X[f]}`);let N=this.settings.secure?"wss://":"ws://";return A.publicAddress?N+=`${A.publicAddress}`:N+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${N}/${A.processId}/${A.roomId}?${s.join("&")}`}getHttpEndpoint(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${A}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11803:(A,X,s)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Connection=void 0;const N=s(11806);X.Connection=class{constructor(){this.events={},this.transport=new N.WebSocketTransport(this.events)}send(A){this.transport.send(A)}connect(A){this.transport.connect(A)}close(A,X){this.transport.close(A,X)}get isOpen(){return this.transport.isOpen}}},11817:(A,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.utf8Length=X.utf8Read=X.ErrorCode=X.Protocol=void 0,function(A){A[A.HANDSHAKE=9]="HANDSHAKE",A[A.JOIN_ROOM=10]="JOIN_ROOM",A[A.ERROR=11]="ERROR",A[A.LEAVE_ROOM=12]="LEAVE_ROOM",A[A.ROOM_DATA=13]="ROOM_DATA",A[A.ROOM_STATE=14]="ROOM_STATE",A[A.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",A[A.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",A[A.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(X.Protocol||(X.Protocol={})),function(A){A[A.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",A[A.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",A[A.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",A[A.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",A[A.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",A[A.AUTH_FAILED=4215]="AUTH_FAILED",A[A.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(X.ErrorCode||(X.ErrorCode={})),X.utf8Read=function(A,X){const s=A[X++];for(var N="",f=0,E=X,g=X+s;E<g;E++){var K=A[E];if(0!==(128&K))if(192!==(224&K))if(224!==(240&K)){if(240!==(248&K))throw new Error("Invalid byte "+K.toString(16));(f=(7&K)<<18|(63&A[++E])<<12|(63&A[++E])<<6|63&A[++E])>=65536?(f-=65536,N+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):N+=String.fromCharCode(f)}else N+=String.fromCharCode((15&K)<<12|(63&A[++E])<<6|63&A[++E]);else N+=String.fromCharCode((31&K)<<6|63&A[++E]);else N+=String.fromCharCode(K)}return N},X.utf8Length=function(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",X=0,s=0;for(let N=0,f=A.length;N<f;N++)X=A.charCodeAt(N),X<128?s+=1:X<2048?s+=2:X<55296||X>=57344?s+=3:(N++,s+=4);return s+1}},11791:function(A,X,s){"use strict";var N=this&&this.__createBinding||(Object.create?function(A,X,s,N){void 0===N&&(N=s);var f=Object.getOwnPropertyDescriptor(X,s);f&&!("get"in f?!X.__esModule:f.writable||f.configurable)||(f={enumerable:!0,get:function(){return X[s]}}),Object.defineProperty(A,N,f)}:function(A,X,s,N){void 0===N&&(N=s),A[N]=X[s]}),f=this&&this.__setModuleDefault||(Object.create?function(A,X){Object.defineProperty(A,"default",{enumerable:!0,value:X})}:function(A,X){A.default=X}),E=this&&this.__importStar||function(A){if(A&&A.__esModule)return A;var X={};if(null!=A)for(var s in A)"default"!==s&&Object.prototype.hasOwnProperty.call(A,s)&&N(X,A,s);return f(X,A),X};Object.defineProperty(X,"__esModule",{value:!0}),X.Room=void 0;const g=E(s(11800)),K=s(11803),r=s(11817),i=s(11821),Y=s(11824),v=s(11829),c=s(11831),M=s(11787);class d{constructor(A,X){this.onStateChange=(0,v.createSignal)(),this.onError=(0,v.createSignal)(),this.onLeave=(0,v.createSignal)(),this.onJoin=(0,v.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,Y.createNanoEvents)(),this.roomId=null,this.name=A,X&&(this.serializer=new((0,i.getSerializer)("schema")),this.rootSchema=X,this.serializer.state=new X),this.onError(((A,X)=>{var s;return null===(s=console.warn)||void 0===s?void 0:s.call(console,`colyseus.js - onError => (${A}) ${X}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const N=new K.Connection;s.connection=N,N.events.onmessage=d.prototype.onMessageCallback.bind(s),N.events.onclose=function(A){var N;if(!s.hasJoined)return null===(N=console.warn)||void 0===N||N.call(console,`Room connection was closed unexpectedly (${A.code}): ${A.reason}`),void s.onError.invoke(A.code,A.reason);A.code===M.CloseCode.DEVMODE_RESTART&&X?X():(s.onLeave.invoke(A.code),s.destroy())},N.events.onerror=function(A){var X;null===(X=console.warn)||void 0===X||X.call(console,`Room, onError (${A.code}): ${A.reason}`),s.onError.invoke(A.code,A.reason)},N.connect(A)}leave(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((X=>{this.onLeave((A=>X(A))),this.connection?A?this.connection.send([r.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(M.CloseCode.CONSENTED)}))}onMessage(A,X){return this.onMessageHandlers.on(this.getMessageHandlerKey(A),X)}send(A,X){const s=[r.Protocol.ROOM_DATA];let N;if("string"===typeof A?c.encode.string(s,A):c.encode.number(s,A),void 0!==X){const A=g.encode(X);N=new Uint8Array(s.length+A.byteLength),N.set(new Uint8Array(s),0),N.set(new Uint8Array(A),s.length)}else N=new Uint8Array(s);this.connection.send(N.buffer)}sendBytes(A,X){const s=[r.Protocol.ROOM_DATA_BYTES];let N;"string"===typeof A?c.encode.string(s,A):c.encode.number(s,A),N=new Uint8Array(s.length+(X.byteLength||X.length)),N.set(new Uint8Array(s),0),N.set(new Uint8Array(X),s.length),this.connection.send(N.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(A){const X=Array.from(new Uint8Array(A.data)),s=X[0];if(s===r.Protocol.JOIN_ROOM){let A=1;const s=(0,r.utf8Read)(X,A);if(A+=(0,r.utf8Length)(s),this.serializerId=(0,r.utf8Read)(X,A),A+=(0,r.utf8Length)(this.serializerId),!this.serializer){const A=(0,i.getSerializer)(this.serializerId);this.serializer=new A}X.length>A&&this.serializer.handshake&&this.serializer.handshake(X,{offset:A}),this.reconnectionToken=`${this.roomId}:${s}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([r.Protocol.JOIN_ROOM])}else if(s===r.Protocol.ERROR){const A={offset:1},s=c.decode.number(X,A),N=c.decode.string(X,A);this.onError.invoke(s,N)}else if(s===r.Protocol.LEAVE_ROOM)this.leave();else if(s===r.Protocol.ROOM_DATA_SCHEMA){const A={offset:1},s=this.serializer.getState().constructor._context.get(c.decode.number(X,A)),N=new s;N.decode(X,A),this.dispatchMessage(s,N)}else if(s===r.Protocol.ROOM_STATE)X.shift(),this.setState(X);else if(s===r.Protocol.ROOM_STATE_PATCH)X.shift(),this.patch(X);else if(s===r.Protocol.ROOM_DATA){const s={offset:1},N=c.decode.stringCheck(X,s)?c.decode.string(X,s):c.decode.number(X,s),f=X.length>s.offset?g.decode(A.data,s.offset):void 0;this.dispatchMessage(N,f)}else if(s===r.Protocol.ROOM_DATA_BYTES){const A={offset:1},s=c.decode.stringCheck(X,A)?c.decode.string(X,A):c.decode.number(X,A);this.dispatchMessage(s,new Uint8Array(X.slice(A.offset)))}}setState(A){this.serializer.setState(A),this.onStateChange.invoke(this.serializer.getState())}patch(A){this.serializer.patch(A),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(A,X){var s;const N=this.getMessageHandlerKey(A);this.onMessageHandlers.events[N]?this.onMessageHandlers.emit(N,X):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",A,X):null===(s=console.warn)||void 0===s||s.call(console,`colyseus.js: onMessage() not registered for type '${A}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(A){switch(typeof A){case"function":return`$${A._typeid}`;case"string":return A;case"number":return`i${A}`;default:throw new Error("invalid message type.")}}}X.Room=d},11844:(A,X)=>{"use strict";let s;function N(){return s||(s="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(A,X){this.cache[A]=X},getItem:function(A){this.cache[A]},removeItem:function(A){delete this.cache[A]}}),s}Object.defineProperty(X,"__esModule",{value:!0}),X.getItem=X.removeItem=X.setItem=void 0,X.setItem=function(A,X){N().setItem(A,X)},X.removeItem=function(A){N().removeItem(A)},X.getItem=function(A,X){const s=N().getItem(A);"undefined"!==typeof Promise&&s instanceof Promise?s.then((A=>X(A))):X(s)}},11824:(A,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createNanoEvents=void 0;X.createNanoEvents=()=>({emit(A){let X=this.events[A]||[];for(var s=arguments.length,N=new Array(s>1?s-1:0),f=1;f<s;f++)N[f-1]=arguments[f];for(let E=0,g=X.length;E<g;E++)X[E](...N)},events:{},on(A,X){var s;return(null===(s=this.events[A])||void 0===s?void 0:s.push(X))||(this.events[A]=[X]),()=>{var s;this.events[A]=null===(s=this.events[A])||void 0===s?void 0:s.filter((A=>X!==A))}}})},11829:(A,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createSignal=X.EventEmitter=void 0;class s{constructor(){this.handlers=[]}register(A){return this.handlers.push(A),this}invoke(){for(var A=arguments.length,X=new Array(A),s=0;s<A;s++)X[s]=arguments[s];this.handlers.forEach((A=>A.apply(this,X)))}invokeAsync(){for(var A=arguments.length,X=new Array(A),s=0;s<A;s++)X[s]=arguments[s];return Promise.all(this.handlers.map((A=>A.apply(this,X))))}remove(A){const X=this.handlers.indexOf(A);this.handlers[X]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}X.EventEmitter=s,X.createSignal=function(){const A=new s;function X(X){return A.register(X,null===this)}return X.once=X=>{const s=function(){for(var N=arguments.length,f=new Array(N),E=0;E<N;E++)f[E]=arguments[E];X.apply(this,f),A.remove(s)};A.register(s)},X.remove=X=>A.remove(X),X.invoke=function(){return A.invoke(...arguments)},X.invokeAsync=function(){return A.invokeAsync(...arguments)},X.clear=()=>A.clear(),X}},11787:(A,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.ServerError=X.CloseCode=void 0,function(A){A[A.CONSENTED=4e3]="CONSENTED",A[A.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(X.CloseCode||(X.CloseCode={}));class s extends Error{constructor(A,X){super(X),this.name="ServerError",this.code=A}}X.ServerError=s},11767:(A,X,s)=>{"use strict";X.e=void 0,s(11773);var N=s(11779);Object.defineProperty(X,"e",{enumerable:!0,get:function(){return N.Client}});var f=s(11817);var E=s(11791);var g=s(11839);const K=s(11847);const r=s(11853),i=s(11821);(0,i.registerSerializer)("schema",K.SchemaSerializer),(0,i.registerSerializer)("none",r.NoneSerializer)},11773:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=A=>null!==A&&"object"===typeof A&&A.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11800:(A,X)=>{"use strict";function s(A,X){if(this._offset=X,A instanceof ArrayBuffer)this._buffer=A,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(A))throw new Error("Invalid argument");this._buffer=A.buffer,this._view=new DataView(this._buffer,A.byteOffset,A.byteLength)}}Object.defineProperty(X,"__esModule",{value:!0}),X.decode=X.encode=void 0,s.prototype._array=function(A){for(var X=new Array(A),s=0;s<A;s++)X[s]=this._parse();return X},s.prototype._map=function(A){for(var X={},s=0;s<A;s++)X[this._parse()]=this._parse();return X},s.prototype._str=function(A){var X=function(A,X,s){for(var N="",f=0,E=X,g=X+s;E<g;E++){var K=A.getUint8(E);if(0!==(128&K))if(192!==(224&K))if(224!==(240&K)){if(240!==(248&K))throw new Error("Invalid byte "+K.toString(16));(f=(7&K)<<18|(63&A.getUint8(++E))<<12|(63&A.getUint8(++E))<<6|63&A.getUint8(++E))>=65536?(f-=65536,N+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):N+=String.fromCharCode(f)}else N+=String.fromCharCode((15&K)<<12|(63&A.getUint8(++E))<<6|63&A.getUint8(++E));else N+=String.fromCharCode((31&K)<<6|63&A.getUint8(++E));else N+=String.fromCharCode(K)}return N}(this._view,this._offset,A);return this._offset+=A,X},s.prototype._bin=function(A){var X=this._buffer.slice(this._offset,this._offset+A);return this._offset+=A,X},s.prototype._parse=function(){var A,X=this._view.getUint8(this._offset++),s=0,N=0,f=0,E=0;if(X<192)return X<128?X:X<144?this._map(15&X):X<160?this._array(15&X):this._str(31&X);if(X>223)return-1*(255-X+1);switch(X){case 192:return null;case 194:return!1;case 195:return!0;case 196:return s=this._view.getUint8(this._offset),this._offset+=1,this._bin(s);case 197:return s=this._view.getUint16(this._offset),this._offset+=2,this._bin(s);case 198:return s=this._view.getUint32(this._offset),this._offset+=4,this._bin(s);case 199:if(s=this._view.getUint8(this._offset),N=this._view.getInt8(this._offset+1),this._offset+=2,-1===N){var g=this._view.getUint32(this._offset);return f=this._view.getInt32(this._offset+4),E=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*f+E)+g/1e6)}return[N,this._bin(s)];case 200:return s=this._view.getUint16(this._offset),N=this._view.getInt8(this._offset+2),this._offset+=3,[N,this._bin(s)];case 201:return s=this._view.getUint32(this._offset),N=this._view.getInt8(this._offset+4),this._offset+=5,[N,this._bin(s)];case 202:return A=this._view.getFloat32(this._offset),this._offset+=4,A;case 203:return A=this._view.getFloat64(this._offset),this._offset+=8,A;case 204:return A=this._view.getUint8(this._offset),this._offset+=1,A;case 205:return A=this._view.getUint16(this._offset),this._offset+=2,A;case 206:return A=this._view.getUint32(this._offset),this._offset+=4,A;case 207:return f=this._view.getUint32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,f+E;case 208:return A=this._view.getInt8(this._offset),this._offset+=1,A;case 209:return A=this._view.getInt16(this._offset),this._offset+=2,A;case 210:return A=this._view.getInt32(this._offset),this._offset+=4,A;case 211:return f=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,f+E;case 212:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?void(this._offset+=1):[N,this._bin(1)];case 213:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(2)];case 214:return N=this._view.getInt8(this._offset),this._offset+=1,-1===N?(A=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*A)):[N,this._bin(4)];case 215:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?(f=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(f+E)):-1===N?(f=this._view.getUint32(this._offset),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&f)+E)+(f>>>2)/1e6)):[N,this._bin(8)];case 216:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(16)];case 217:return s=this._view.getUint8(this._offset),this._offset+=1,this._str(s);case 218:return s=this._view.getUint16(this._offset),this._offset+=2,this._str(s);case 219:return s=this._view.getUint32(this._offset),this._offset+=4,this._str(s);case 220:return s=this._view.getUint16(this._offset),this._offset+=2,this._array(s);case 221:return s=this._view.getUint32(this._offset),this._offset+=4,this._array(s);case 222:return s=this._view.getUint16(this._offset),this._offset+=2,this._map(s);case 223:return s=this._view.getUint32(this._offset),this._offset+=4,this._map(s)}throw new Error("Could not parse")},X.decode=function(A){var X=new s(A,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),N=X._parse();if(X._offset!==A.byteLength)throw new Error(A.byteLength-X._offset+" trailing bytes");return N};function N(A,X,s){for(var N=0,f=0,E=s.length;f<E;f++)(N=s.charCodeAt(f))<128?A.setUint8(X++,N):N<2048?(A.setUint8(X++,192|N>>6),A.setUint8(X++,128|63&N)):N<55296||N>=57344?(A.setUint8(X++,224|N>>12),A.setUint8(X++,128|N>>6&63),A.setUint8(X++,128|63&N)):(f++,N=65536+((1023&N)<<10|1023&s.charCodeAt(f)),A.setUint8(X++,240|N>>18),A.setUint8(X++,128|N>>12&63),A.setUint8(X++,128|N>>6&63),A.setUint8(X++,128|63&N))}function f(A,X,s){var N=typeof s,E=0,g=0,K=0,r=0,i=0,Y=0;if("string"===N){if(i=function(A){for(var X=0,s=0,N=0,f=A.length;N<f;N++)(X=A.charCodeAt(N))<128?s+=1:X<2048?s+=2:X<55296||X>=57344?s+=3:(N++,s+=4);return s}(s),i<32)A.push(160|i),Y=1;else if(i<256)A.push(217,i),Y=2;else if(i<65536)A.push(218,i>>8,i),Y=3;else{if(!(i<4294967296))throw new Error("String too long");A.push(219,i>>24,i>>16,i>>8,i),Y=5}return X.push({_str:s,_length:i,_offset:A.length}),Y+i}if("number"===N)return Math.floor(s)===s&&isFinite(s)?s>=0?s<128?(A.push(s),1):s<256?(A.push(204,s),2):s<65536?(A.push(205,s>>8,s),3):s<4294967296?(A.push(206,s>>24,s>>16,s>>8,s),5):(K=s/Math.pow(2,32)|0,r=s>>>0,A.push(207,K>>24,K>>16,K>>8,K,r>>24,r>>16,r>>8,r),9):s>=-32?(A.push(s),1):s>=-128?(A.push(208,s),2):s>=-32768?(A.push(209,s>>8,s),3):s>=-2147483648?(A.push(210,s>>24,s>>16,s>>8,s),5):(K=Math.floor(s/Math.pow(2,32)),r=s>>>0,A.push(211,K>>24,K>>16,K>>8,K,r>>24,r>>16,r>>8,r),9):(A.push(203),X.push({_float:s,_length:8,_offset:A.length}),9);if("object"===N){if(null===s)return A.push(192),1;if(Array.isArray(s)){if((i=s.length)<16)A.push(144|i),Y=1;else if(i<65536)A.push(220,i>>8,i),Y=3;else{if(!(i<4294967296))throw new Error("Array too large");A.push(221,i>>24,i>>16,i>>8,i),Y=5}for(E=0;E<i;E++)Y+=f(A,X,s[E]);return Y}if(s instanceof Date){var v=s.getTime(),c=Math.floor(v/1e3),M=1e6*(v-1e3*c);return c>=0&&M>=0&&c<=17179869183?0===M&&c<=4294967295?(A.push(214,255,c>>24,c>>16,c>>8,c),6):(K=c/4294967296,r=4294967295&c,A.push(215,255,M>>22,M>>14,M>>6,K,r>>24,r>>16,r>>8,r),10):(K=Math.floor(c/4294967296),r=c>>>0,A.push(199,12,255,M>>24,M>>16,M>>8,M,K>>24,K>>16,K>>8,K,r>>24,r>>16,r>>8,r),15)}if(s instanceof ArrayBuffer){if((i=s.byteLength)<256)A.push(196,i),Y=2;else if(i<65536)A.push(197,i>>8,i),Y=3;else{if(!(i<4294967296))throw new Error("Buffer too large");A.push(198,i>>24,i>>16,i>>8,i),Y=5}return X.push({_bin:s,_length:i,_offset:A.length}),Y+i}if("function"===typeof s.toJSON)return f(A,X,s.toJSON());var d=[],Q="",w=Object.keys(s);for(E=0,g=w.length;E<g;E++)void 0!==s[Q=w[E]]&&"function"!==typeof s[Q]&&d.push(Q);if((i=d.length)<16)A.push(128|i),Y=1;else if(i<65536)A.push(222,i>>8,i),Y=3;else{if(!(i<4294967296))throw new Error("Object too large");A.push(223,i>>24,i>>16,i>>8,i),Y=5}for(E=0;E<i;E++)Y+=f(A,X,Q=d[E]),Y+=f(A,X,s[Q]);return Y}if("boolean"===N)return A.push(s?195:194),1;if("undefined"===N)return A.push(192),1;if("function"===typeof s.toJSON)return f(A,X,s.toJSON());throw new Error("Could not encode")}X.encode=function(A){var X=[],s=[],E=f(X,s,A),g=new ArrayBuffer(E),K=new DataView(g),r=0,i=0,Y=-1;s.length>0&&(Y=s[0]._offset);for(var v,c=0,M=0,d=0,Q=X.length;d<Q;d++)if(K.setUint8(i+d,X[d]),d+1===Y){if(c=(v=s[r])._length,M=i+Y,v._bin)for(var w=new Uint8Array(v._bin),R=0;R<c;R++)K.setUint8(M+R,w[R]);else v._str?N(K,M,v._str):void 0!==v._float&&K.setFloat64(M,v._float);i+=c,s[++r]&&(Y=s[r]._offset)}return g}},11853:(A,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.NoneSerializer=void 0;X.NoneSerializer=class{setState(A){}getState(){return null}patch(A){}teardown(){}handshake(A){}}},11847:(A,X,s)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.SchemaSerializer=void 0;const N=s(11831);X.SchemaSerializer=class{setState(A){return this.state.decode(A)}getState(){return this.state}patch(A){return this.state.decode(A)}teardown(){var A,X;null===(X=null===(A=this.state)||void 0===A?void 0:A.$changes)||void 0===X||X.root.clearRefs()}handshake(A,X){if(this.state){(new N.Reflection).decode(A,X)}else this.state=N.Reflection.decode(A,X)}}},11821:(A,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.getSerializer=X.registerSerializer=void 0;const s={};X.registerSerializer=function(A,X){s[A]=X},X.getSerializer=function(A){const X=s[A];if(!X)throw new Error("missing serializer: "+A);return X}},11806:function(A,X,s){"use strict";var N=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(X,"__esModule",{value:!0}),X.WebSocketTransport=void 0;const f=N(s(11809)),E=globalThis.WebSocket||f.default;X.WebSocketTransport=class{constructor(A){this.events=A}send(A){A instanceof ArrayBuffer?this.ws.send(A):Array.isArray(A)&&this.ws.send(new Uint8Array(A).buffer)}connect(A){this.ws=new E(A,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(A,X){this.ws.close(A,X)}get isOpen(){return this.ws.readyState===E.OPEN}}},11809:A=>{"use strict";A.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11969:A=>{"use strict";A.exports=function(A){for(var X=new Array(A),s=0;s<A;++s)X[s]=s;return X}},11977:A=>{function X(A){return!!A.constructor&&"function"===typeof A.constructor.isBuffer&&A.constructor.isBuffer(A)}A.exports=function(A){return null!=A&&(X(A)||function(A){return"function"===typeof A.readFloatLE&&"function"===typeof A.slice&&X(A.slice(0,0))}(A)||!!A._isBuffer)}},11967:(A,X,s)=>{var N=s(11969),f=s(11977),E="undefined"!==typeof Float64Array;function g(A,X){return A[0]-X[0]}function K(){var A,X=this.stride,s=new Array(X.length);for(A=0;A<s.length;++A)s[A]=[Math.abs(X[A]),A];s.sort(g);var N=new Array(s.length);for(A=0;A<N.length;++A)N[A]=s[A][1];return N}function r(A,X){var s=["View",X,"d",A].join("");X<0&&(s="View_Nil"+A);var f="generic"===A;if(-1===X){var E="function "+s+"(a){this.data=a;};var proto="+s+".prototype;proto.dtype='"+A+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+s+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+s+"(a){return new "+s+"(a);}";return new Function(E)()}if(0===X){E="function "+s+"(a,d) {this.data = a;this.offset = d};var proto="+s+".prototype;proto.dtype='"+A+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+s+"_copy() {return new "+s+"(this.data,this.offset)};proto.pick=function "+s+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+s+"_get(){return "+(f?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+s+"_set(v){return "+(f?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+s+"(a,b,c,d){return new "+s+"(a,d)}";return new Function("TrivialArray",E)(i[A][0])}E=["'use strict'"];var g=N(X),r=g.map((function(A){return"i"+A})),Y="this.offset+"+g.map((function(A){return"this.stride["+A+"]*i"+A})).join("+"),v=g.map((function(A){return"b"+A})).join(","),c=g.map((function(A){return"c"+A})).join(",");E.push("function "+s+"(a,"+v+","+c+",d){this.data=a","this.shape=["+v+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+s+".prototype","proto.dtype='"+A+"'","proto.dimension="+X),E.push("Object.defineProperty(proto,'size',{get:function "+s+"_size(){return "+g.map((function(A){return"this.shape["+A+"]"})).join("*"),"}})"),1===X?E.push("proto.order=[0]"):(E.push("Object.defineProperty(proto,'order',{get:"),X<4?(E.push("function "+s+"_order(){"),2===X?E.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&E.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):E.push("ORDER})")),E.push("proto.set=function "+s+"_set("+r.join(",")+",v){"),f?E.push("return this.data.set("+Y+",v)}"):E.push("return this.data["+Y+"]=v}"),E.push("proto.get=function "+s+"_get("+r.join(",")+"){"),f?E.push("return this.data.get("+Y+")}"):E.push("return this.data["+Y+"]}"),E.push("proto.index=function "+s+"_index(",r.join(),"){return "+Y+"}"),E.push("proto.hi=function "+s+"_hi("+r.join(",")+"){return new "+s+"(this.data,"+g.map((function(A){return["(typeof i",A,"!=='number'||i",A,"<0)?this.shape[",A,"]:i",A,"|0"].join("")})).join(",")+","+g.map((function(A){return"this.stride["+A+"]"})).join(",")+",this.offset)}");var M=g.map((function(A){return"a"+A+"=this.shape["+A+"]"})),d=g.map((function(A){return"c"+A+"=this.stride["+A+"]"}));E.push("proto.lo=function "+s+"_lo("+r.join(",")+"){var b=this.offset,d=0,"+M.join(",")+","+d.join(","));for(var Q=0;Q<X;++Q)E.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){d=i"+Q+"|0;b+=c"+Q+"*d;a"+Q+"-=d}");E.push("return new "+s+"(this.data,"+g.map((function(A){return"a"+A})).join(",")+","+g.map((function(A){return"c"+A})).join(",")+",b)}"),E.push("proto.step=function "+s+"_step("+r.join(",")+"){var "+g.map((function(A){return"a"+A+"=this.shape["+A+"]"})).join(",")+","+g.map((function(A){return"b"+A+"=this.stride["+A+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Q=0;Q<X;++Q)E.push("if(typeof i"+Q+"==='number'){d=i"+Q+"|0;if(d<0){c+=b"+Q+"*(a"+Q+"-1);a"+Q+"=ceil(-a"+Q+"/d)}else{a"+Q+"=ceil(a"+Q+"/d)}b"+Q+"*=d}");E.push("return new "+s+"(this.data,"+g.map((function(A){return"a"+A})).join(",")+","+g.map((function(A){return"b"+A})).join(",")+",c)}");var w=new Array(X),R=new Array(X);for(Q=0;Q<X;++Q)w[Q]="a[i"+Q+"]",R[Q]="b[i"+Q+"]";E.push("proto.transpose=function "+s+"_transpose("+r+"){"+r.map((function(A,X){return A+"=("+A+"===undefined?"+X+":"+A+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+s+"(this.data,"+w.join(",")+","+R.join(",")+",this.offset)}"),E.push("proto.pick=function "+s+"_pick("+r+"){var a=[],b=[],c=this.offset");for(Q=0;Q<X;++Q)E.push("if(typeof i"+Q+"==='number'&&i"+Q+">=0){c=(c+this.stride["+Q+"]*i"+Q+")|0}else{a.push(this.shape["+Q+"]);b.push(this.stride["+Q+"])}");return E.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),E.push("return function construct_"+s+"(data,shape,stride,offset){return new "+s+"(data,"+g.map((function(A){return"shape["+A+"]"})).join(",")+","+g.map((function(A){return"stride["+A+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",E.join("\n"))(i[A],K)}var i={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};A.exports=function(A,X,s,N){if(void 0===A)return(0,i.array[0])([]);"number"===typeof A&&(A=[A]),void 0===X&&(X=[A.length]);var g=X.length;if(void 0===s){s=new Array(g);for(var K=g-1,Y=1;K>=0;--K)s[K]=Y,Y*=X[K]}if(void 0===N){N=0;for(K=0;K<g;++K)s[K]<0&&(N-=(X[K]-1)*s[K])}for(var v=function(A){if(f(A))return"buffer";if(E)switch(Object.prototype.toString.call(A)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(A)?"array":"generic"}(A),c=i[v];c.length<=g+1;)c.push(r(v,c.length-1));return(0,c[g+1])(A,X,s,N)}},12869:A=>{var X;self,X=()=>(()=>{"use strict";var A={d:(X,s)=>{for(var N in s)A.o(s,N)&&!A.o(X,N)&&Object.defineProperty(X,N,{enumerable:!0,get:s[N]})},o:(A,X)=>Object.prototype.hasOwnProperty.call(A,X)},X={};A.d(X,{default:()=>l});var s,N=function(A,X){var s=X.x-A.x,N=X.y-A.y;return Math.sqrt(s*s+N*N)},f=function(A){return A*(Math.PI/180)},E=new Map,g=function(A){E.has(A)&&clearTimeout(E.get(A)),E.set(A,setTimeout(A,100))},K=function(A,X,s){for(var N,f=X.split(/[ ,]+/g),E=0;E<f.length;E+=1)N=f[E],A.addEventListener?A.addEventListener(N,s,!1):A.attachEvent&&A.attachEvent(N,s)},r=function(A,X,s){for(var N,f=X.split(/[ ,]+/g),E=0;E<f.length;E+=1)N=f[E],A.removeEventListener?A.removeEventListener(N,s):A.detachEvent&&A.detachEvent(N,s)},i=function(A){return A.preventDefault(),A.type.match(/^touch/)?A.changedTouches:A},Y=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},v=function(A,X){X.top||X.right||X.bottom||X.left?(A.style.top=X.top,A.style.right=X.right,A.style.bottom=X.bottom,A.style.left=X.left):(A.style.left=X.x+"px",A.style.top=X.y+"px")},c=function(A,X,s){var N=M(A);for(var f in N)if(N.hasOwnProperty(f))if("string"==typeof X)N[f]=X+" "+s;else{for(var E="",g=0,K=X.length;g<K;g+=1)E+=X[g]+" "+s+", ";N[f]=E.slice(0,-2)}return N},M=function(A){var X={};return X[A]="",["webkit","Moz","o"].forEach((function(s){X[s+A.charAt(0).toUpperCase()+A.slice(1)]=""})),X},d=function(A,X){for(var s in X)X.hasOwnProperty(s)&&(A[s]=X[s]);return A},Q=function(A,X){if(A.length)for(var s=0,N=A.length;s<N;s+=1)X(A[s]);else X(A)},w="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,R=window.matchMedia("(any-hover: none)").matches,C=!!("ontouchstart"in window),J=!!window.PointerEvent,a=!!window.MSPointerEvent,u={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},z={start:"mousedown",move:"mousemove",end:"mouseup"},m={};function b(){}w&&!R?s=u:J?s={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:a?s={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:C?(s=u,m=z):s=z,b.prototype.on=function(A,X){var s,N=this,f=A.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var E=0;E<f.length;E+=1)s=f[E],N._handlers_[s]=N._handlers_[s]||[],N._handlers_[s].push(X);return N},b.prototype.off=function(A,X){var s=this;return s._handlers_=s._handlers_||{},void 0===A?s._handlers_={}:void 0===X?s._handlers_[A]=null:s._handlers_[A]&&s._handlers_[A].indexOf(X)>=0&&s._handlers_[A].splice(s._handlers_[A].indexOf(X),1),s},b.prototype.trigger=function(A,X){var s,N=this,f=A.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var E=0;E<f.length;E+=1)s=f[E],N._handlers_[s]&&N._handlers_[s].length&&N._handlers_[s].forEach((function(A){A.call(N,{type:s,target:N},X)}))},b.prototype.config=function(A){var X=this;X.options=X.defaults||{},A&&(X.options=function(A,X){var s={};for(var N in A)A.hasOwnProperty(N)&&X.hasOwnProperty(N)?s[N]=X[N]:A.hasOwnProperty(N)&&(s[N]=A[N]);return s}(X.options,A))},b.prototype.bindEvt=function(A,X){var N=this;return N._domHandlers_=N._domHandlers_||{},N._domHandlers_[X]=function(){"function"==typeof N["on"+X]?N["on"+X].apply(N,arguments):console.warn('[WARNING] : Missing "on'+X+'" handler.')},K(A,s[X],N._domHandlers_[X]),m[X]&&K(A,m[X],N._domHandlers_[X]),N},b.prototype.unbindEvt=function(A,X){var N=this;return N._domHandlers_=N._domHandlers_||{},r(A,s[X],N._domHandlers_[X]),m[X]&&r(A,m[X],N._domHandlers_[X]),delete N._domHandlers_[X],this};const y=b;function j(A,X){return this.identifier=X.identifier,this.position=X.position,this.frontPosition=X.frontPosition,this.collection=A,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(X),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=j.id,j.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}j.prototype=new y,j.constructor=j,j.id=0,j.prototype.buildEl=function(A){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},j.prototype.stylize=function(){if(this.options.dataOnly)return this;var A=this.options.fadeTime+"ms",X=function(){var A=M("borderRadius");for(var X in A)A.hasOwnProperty(X)&&(A[X]="50%");return A}(),s=c("transition","opacity",A),N={};return N.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},N.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},N.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},d(N.el,s),"circle"===this.options.shape&&d(N.back,X),d(N.front,X),this.applyStyles(N),this},j.prototype.applyStyles=function(A){for(var X in this.ui)if(this.ui.hasOwnProperty(X))for(var s in A[X])this.ui[X].style[s]=A[X][s];return this},j.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},j.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},j.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},j.prototype.show=function(A){var X=this;return X.options.dataOnly||(clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.addToDom(),X.restCallback(),setTimeout((function(){X.ui.el.style.opacity=1}),0),X.showTimeout=setTimeout((function(){X.trigger("shown",X.instance),"function"==typeof A&&A.call(this)}),X.options.fadeTime)),X},j.prototype.hide=function(A){var X=this;if(X.options.dataOnly)return X;if(X.ui.el.style.opacity=X.options.restOpacity,clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.removeTimeout=setTimeout((function(){var s="dynamic"===X.options.mode?"none":"block";X.ui.el.style.display=s,"function"==typeof A&&A.call(X),X.trigger("hidden",X.instance)}),X.options.fadeTime),X.options.restJoystick){var s=X.options.restJoystick,N={};N.x=!0===s||!1!==s.x?0:X.instance.frontPosition.x,N.y=!0===s||!1!==s.y?0:X.instance.frontPosition.y,X.setPosition(A,N)}return X},j.prototype.setPosition=function(A,X){var s=this;s.frontPosition={x:X.x,y:X.y};var N=s.options.fadeTime+"ms",f={};f.front=c("transition",["transform"],N);var E={front:{}};E.front={transform:"translate("+s.frontPosition.x+"px,"+s.frontPosition.y+"px)"},s.applyStyles(f),s.applyStyles(E),s.restTimeout=setTimeout((function(){"function"==typeof A&&A.call(s),s.restCallback()}),s.options.fadeTime)},j.prototype.restCallback=function(){var A=this,X={};X.front=c("transition","none",""),A.applyStyles(X),A.trigger("rested",A.instance)},j.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},j.prototype.computeDirection=function(A){var X,s,N,f=A.angle.radian,E=Math.PI/4,g=Math.PI/2;if(f>E&&f<3*E&&!A.lockX?X="up":f>-E&&f<=E&&!A.lockY?X="left":f>3*-E&&f<=-E&&!A.lockX?X="down":A.lockY||(X="right"),A.lockY||(s=f>-g&&f<g?"left":"right"),A.lockX||(N=f>0?"up":"down"),A.force>this.options.threshold){var K,r={};for(K in this.direction)this.direction.hasOwnProperty(K)&&(r[K]=this.direction[K]);var i={};for(K in this.direction={x:s,y:N,angle:X},A.direction=this.direction,r)r[K]===this.direction[K]&&(i[K]=!0);if(i.x&&i.y&&i.angle)return A;i.x&&i.y||this.trigger("plain",A),i.x||this.trigger("plain:"+s,A),i.y||this.trigger("plain:"+N,A),i.angle||this.trigger("dir dir:"+X,A)}else this.resetDirection();return A};const G=j;function V(A,X){var s=this;s.nipples=[],s.idles=[],s.actives=[],s.ids=[],s.pressureIntervals={},s.manager=A,s.id=V.id,V.id+=1,s.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},s.config(X),"static"!==s.options.mode&&"semi"!==s.options.mode||(s.options.multitouch=!1),s.options.multitouch||(s.options.maxNumberOfNipples=1);var N=getComputedStyle(s.options.zone.parentElement);return N&&"flex"===N.display&&(s.parentIsFlex=!0),s.updateBox(),s.prepareNipples(),s.Tl(),s.begin(),s.nipples}V.prototype=new y,V.constructor=V,V.id=0,V.prototype.prepareNipples=function(){var A=this,X=A.nipples;X.on=A.on.bind(A),X.off=A.off.bind(A),X.options=A.options,X.destroy=A.destroy.bind(A),X.ids=A.ids,X.id=A.id,X.processOnMove=A.processOnMove.bind(A),X.processOnEnd=A.processOnEnd.bind(A),X.get=function(A){if(void 0===A)return X[0];for(var s=0,N=X.length;s<N;s+=1)if(X[s].identifier===A)return X[s];return!1}},V.prototype.Tl=function(){var A=this;A.bindEvt(A.options.zone,"start"),A.options.zone.style.touchAction="none",A.options.zone.style.msTouchAction="none"},V.prototype.begin=function(){var A=this,X=A.options;if("static"===X.mode){var s=A.createNipple(X.position,A.manager.getIdentifier());s.add(),A.idles.push(s)}},V.prototype.createNipple=function(A,X){var s=this,N=s.manager.scroll,f={},E=s.options,g=s.parentIsFlex?N.x:N.x+s.box.left,K=s.parentIsFlex?N.y:N.y+s.box.top;if(A.x&&A.y)f={x:A.x-g,y:A.y-K};else if(A.top||A.right||A.bottom||A.left){var r=document.createElement("DIV");r.style.display="hidden",r.style.top=A.top,r.style.right=A.right,r.style.bottom=A.bottom,r.style.left=A.left,r.style.position="absolute",E.zone.appendChild(r);var i=r.getBoundingClientRect();E.zone.removeChild(r),f=A,A={x:i.left+N.x,y:i.top+N.y}}var Y=new G(s,{color:E.color,size:E.size,threshold:E.threshold,fadeTime:E.fadeTime,dataOnly:E.dataOnly,restJoystick:E.restJoystick,restOpacity:E.restOpacity,mode:E.mode,identifier:X,position:A,zone:E.zone,frontPosition:{x:0,y:0},shape:E.shape});return E.dataOnly||(v(Y.ui.el,f),v(Y.ui.front,Y.frontPosition)),s.nipples.push(Y),s.trigger("added "+Y.identifier+":added",Y),s.manager.trigger("added "+Y.identifier+":added",Y),s.bindNipple(Y),Y},V.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},V.prototype.bindNipple=function(A){var X,s=this,N=function(A,N){X=A.type+" "+N.id+":"+A.type,s.trigger(X,N)};A.on("destroyed",s.onDestroyed.bind(s)),A.on("shown hidden rested dir plain",N),A.on("dir:up dir:right dir:down dir:left",N),A.on("plain:up plain:right plain:down plain:left",N)},V.prototype.pressureFn=function(A,X,s){var N=this,f=0;clearInterval(N.pressureIntervals[s]),N.pressureIntervals[s]=setInterval(function(){var s=A.force||A.pressure||A.webkitForce||0;s!==f&&(X.trigger("pressure",s),N.trigger("pressure "+X.identifier+":pressure",s),f=s)}.bind(N),100)},V.prototype.onstart=function(A){var X=this,s=X.options,N=A;return A=i(A),X.updateBox(),Q(A,(function(f){X.actives.length<s.maxNumberOfNipples?X.processOnStart(f):N.type.match(/^touch/)&&(Object.keys(X.manager.ids).forEach((function(s){if(Object.values(N.touches).findIndex((function(A){return A.identifier===s}))<0){var f=[A[0]];f.identifier=s,X.processOnEnd(f)}})),X.actives.length<s.maxNumberOfNipples&&X.processOnStart(f))})),X.manager.bindDocument(),!1},V.prototype.processOnStart=function(A){var X,s=this,f=s.options,E=s.manager.getIdentifier(A),g=A.force||A.pressure||A.webkitForce||0,K={x:A.pageX,y:A.pageY},r=s.getOrCreate(E,K);r.identifier!==E&&s.manager.removeIdentifier(r.identifier),r.identifier=E;var i=function(X){X.trigger("start",X),s.trigger("start "+X.id+":start",X),X.show(),g>0&&s.pressureFn(A,X,X.identifier),s.processOnMove(A)};if((X=s.idles.indexOf(r))>=0&&s.idles.splice(X,1),s.actives.push(r),s.ids.push(r.identifier),"semi"!==f.mode)i(r);else{if(!(N(K,r.position)<=f.catchDistance))return r.destroy(),void s.processOnStart(A);i(r)}return r},V.prototype.getOrCreate=function(A,X){var s,N=this,f=N.options;return/(semi|static)/.test(f.mode)?(s=N.idles[0])?(N.idles.splice(0,1),s):"semi"===f.mode?N.createNipple(X,A):(console.warn("Coudln't find the needed nipple."),!1):s=N.createNipple(X,A)},V.prototype.processOnMove=function(A){var X=this,s=X.options,E=X.manager.getIdentifier(A),g=X.nipples.get(E),K=X.manager.scroll;if(function(A){return isNaN(A.buttons)?0!==A.pressure:0!==A.buttons}(A)){if(!g)return console.error("Found zombie joystick with ID "+E),void X.manager.removeIdentifier(E);if(s.dynamicPage){var r=g.el.getBoundingClientRect();g.position={x:K.x+r.left,y:K.y+r.top}}g.identifier=E;var i=g.options.size/2,Y={x:A.pageX,y:A.pageY};s.lockX&&(Y.y=g.position.y),s.lockY&&(Y.x=g.position.x);var v,c,M,d,Q,w,R,C,J,a,u=N(Y,g.position),z=(v=Y,M=(c=g.position).x-v.x,d=c.y-v.y,function(A){return A*(180/Math.PI)}(Math.atan2(d,M))),m=f(z),b=u/i,y={distance:u,position:Y};if("circle"===g.options.shape?(Q=Math.min(u,i),R=g.position,C=Q,a={x:0,y:0},J=f(J=z),a.x=R.x-C*Math.cos(J),a.y=R.y-C*Math.sin(J),w=a):(w=function(A,X,s){return{x:Math.min(Math.max(A.x,X.x-s),X.x+s),y:Math.min(Math.max(A.y,X.y-s),X.y+s)}}(Y,g.position,i),Q=N(w,g.position)),s.follow){if(u>i){var j=Y.x-w.x,G=Y.y-w.y;g.position.x+=j,g.position.y+=G,g.el.style.top=g.position.y-(X.box.top+K.y)+"px",g.el.style.left=g.position.x-(X.box.left+K.x)+"px",u=N(Y,g.position)}}else Y=w,u=Q;var V=Y.x-g.position.x,D=Y.y-g.position.y;g.frontPosition={x:V,y:D},s.dataOnly||(g.ui.front.style.transform="translate("+V+"px,"+D+"px)");var O={identifier:g.identifier,position:Y,force:b,pressure:A.force||A.pressure||A.webkitForce||0,distance:u,angle:{radian:m,degree:z},vector:{x:V/i,y:-D/i},raw:y,instance:g,lockX:s.lockX,lockY:s.lockY};(O=g.computeDirection(O)).angle={radian:f(180-z),degree:180-z},g.trigger("move",O),X.trigger("move "+g.id+":move",O)}else this.processOnEnd(A)},V.prototype.processOnEnd=function(A){var X=this,s=X.options,N=X.manager.getIdentifier(A),f=X.nipples.get(N),E=X.manager.removeIdentifier(f.identifier);f&&(s.dataOnly||f.hide((function(){"dynamic"===s.mode&&(f.trigger("removed",f),X.trigger("removed "+f.id+":removed",f),X.manager.trigger("removed "+f.id+":removed",f),f.destroy())})),clearInterval(X.pressureIntervals[f.identifier]),f.resetDirection(),f.trigger("end",f),X.trigger("end "+f.id+":end",f),X.ids.indexOf(f.identifier)>=0&&X.ids.splice(X.ids.indexOf(f.identifier),1),X.actives.indexOf(f)>=0&&X.actives.splice(X.actives.indexOf(f),1),/(semi|static)/.test(s.mode)?X.idles.push(f):X.nipples.indexOf(f)>=0&&X.nipples.splice(X.nipples.indexOf(f),1),X.manager.unbindDocument(),/(semi|static)/.test(s.mode)&&(X.manager.ids[E.id]=E.identifier))},V.prototype.onDestroyed=function(A,X){var s=this;s.nipples.indexOf(X)>=0&&s.nipples.splice(s.nipples.indexOf(X),1),s.actives.indexOf(X)>=0&&s.actives.splice(s.actives.indexOf(X),1),s.idles.indexOf(X)>=0&&s.idles.splice(s.idles.indexOf(X),1),s.ids.indexOf(X.identifier)>=0&&s.ids.splice(s.ids.indexOf(X.identifier),1),s.manager.removeIdentifier(X.identifier),s.manager.unbindDocument()},V.prototype.destroy=function(){var A=this;for(var X in A.unbindEvt(A.options.zone,"start"),A.nipples.forEach((function(A){A.destroy()})),A.pressureIntervals)A.pressureIntervals.hasOwnProperty(X)&&clearInterval(A.pressureIntervals[X]);A.trigger("destroyed",A.nipples),A.manager.unbindDocument(),A.off()};const D=V;function O(A){var X=this;X.ids={},X.index=0,X.collections=[],X.scroll=Y(),X.config(A),X.prepareCollections();var s=function(){var A;X.collections.forEach((function(s){s.forEach((function(s){A=s.el.getBoundingClientRect(),s.position={x:X.scroll.x+A.left,y:X.scroll.y+A.top}}))}))};K(window,"resize",(function(){g(s)}));var N=function(){X.scroll=Y()};return K(window,"scroll",(function(){g(N)})),X.collections}O.prototype=new y,O.constructor=O,O.prototype.prepareCollections=function(){var A=this;A.collections.create=A.create.bind(A),A.collections.on=A.on.bind(A),A.collections.off=A.off.bind(A),A.collections.destroy=A.destroy.bind(A),A.collections.get=function(X){var s;return A.collections.every((function(A){return!(s=A.get(X))})),s}},O.prototype.create=function(A){return this.createCollection(A)},O.prototype.createCollection=function(A){var X=this,s=new D(X,A);return X.bindCollection(s),X.collections.push(s),s},O.prototype.bindCollection=function(A){var X,s=this,N=function(A,N){X=A.type+" "+N.id+":"+A.type,s.trigger(X,N)};A.on("destroyed",s.onDestroyed.bind(s)),A.on("shown hidden rested dir plain",N),A.on("dir:up dir:right dir:down dir:left",N),A.on("plain:up plain:right plain:down plain:left",N)},O.prototype.bindDocument=function(){var A=this;A.binded||(A.bindEvt(document,"move").bindEvt(document,"end"),A.binded=!0)},O.prototype.unbindDocument=function(A){var X=this;Object.keys(X.ids).length&&!0!==A||(X.unbindEvt(document,"move").unbindEvt(document,"end"),X.binded=!1)},O.prototype.getIdentifier=function(A){var X;return A?void 0===(X=void 0===A.identifier?A.pointerId:A.identifier)&&(X=this.latest||0):X=this.index,void 0===this.ids[X]&&(this.ids[X]=this.index,this.index+=1),this.latest=X,this.ids[X]},O.prototype.removeIdentifier=function(A){var X={};for(var s in this.ids)if(this.ids[s]===A){X.id=s,X.identifier=this.ids[s],delete this.ids[s];break}return X},O.prototype.onmove=function(A){return this.onAny("move",A),!1},O.prototype.onend=function(A){return this.onAny("end",A),!1},O.prototype.oncancel=function(A){return this.onAny("end",A),!1},O.prototype.onAny=function(A,X){var s,N=this,f="processOn"+A.charAt(0).toUpperCase()+A.slice(1);X=i(X);var E=function(A,X,s){s.ids.indexOf(X)>=0&&(s[f](A),A._found_=!0)};return Q(X,(function(A){s=N.getIdentifier(A),Q(N.collections,E.bind(null,A,s)),A._found_||N.removeIdentifier(s)})),!1},O.prototype.destroy=function(){var A=this;A.unbindDocument(!0),A.ids={},A.index=0,A.collections.forEach((function(A){A.destroy()})),A.off()},O.prototype.onDestroyed=function(A,X){var s=this;if(s.collections.indexOf(X)<0)return!1;s.collections.splice(s.collections.indexOf(X),1)};var P=new O;const l={create:function(A){return P.create(A)},factory:P};return X.default})(),A.exports=X()},11993:(A,X,s)=>{"use strict";const{Deflate:N,deflate:f,deflateRaw:E,gzip:g}=s(11995),{Inflate:K,inflate:r,inflateRaw:i,ungzip:Y}=s(12065),v=s(12034);A.exports.Deflate=N,A.exports.deflate=f,A.exports.deflateRaw=E,A.exports.gzip=g,A.exports.Inflate=K,A.exports.inflate=r,A.exports.inflateRaw=i,A.exports.ungzip=Y,A.exports.constants=v},11995:(A,X,s)=>{"use strict";const N=s(12002),f=s(12042),E=s(12050),g=s(12030),K=s(12058),r=Object.prototype.toString,{Z_NO_FLUSH:i,Z_SYNC_FLUSH:Y,Z_FULL_FLUSH:v,Z_FINISH:c,Z_OK:M,Z_STREAM_END:d,Z_DEFAULT_COMPRESSION:Q,Z_DEFAULT_STRATEGY:w,Z_DEFLATED:R}=s(12034);function C(A){this.options=f.assign({level:Q,method:R,Ja:16384,windowBits:15,memLevel:8,strategy:w},A||{});let X=this.options;X.raw&&X.windowBits>0?X.windowBits=-X.windowBits:X.gzip&&X.windowBits>0&&X.windowBits<16&&(X.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new K,this.strm.avail_out=0;let s=N.deflateInit2(this.strm,X.level,X.method,X.windowBits,X.memLevel,X.strategy);if(s!==M)throw new Error(g[s]);if(X.header&&N.deflateSetHeader(this.strm,X.header),X.dictionary){let A;if(A="string"===typeof X.dictionary?E.string2buf(X.dictionary):"[object ArrayBuffer]"===r.call(X.dictionary)?new Uint8Array(X.dictionary):X.dictionary,s=N.deflateSetDictionary(this.strm,A),s!==M)throw new Error(g[s]);this._dict_set=!0}}function J(A,X){const s=new C(X);if(s.push(A,!0),s.err)throw s.msg||g[s.err];return s.result}C.prototype.push=function(A,X){const s=this.strm,f=this.options.Ja;let g,K;if(this.ended)return!1;for(K=X===~~X?X:!0===X?c:i,"string"===typeof A?s.input=E.string2buf(A):"[object ArrayBuffer]"===r.call(A)?s.input=new Uint8Array(A):s.input=A,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(f),s.next_out=0,s.avail_out=f),(K===Y||K===v)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(g=N.deflate(s,K),g===d)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),g=N.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===M;if(0!==s.avail_out){if(K>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},C.prototype.onData=function(A){this.chunks.push(A)},C.prototype.onEnd=function(A){A===M&&(this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg},A.exports.Deflate=C,A.exports.deflate=J,A.exports.deflateRaw=function(A,X){return(X=X||{}).raw=!0,J(A,X)},A.exports.gzip=function(A,X){return(X=X||{}).gzip=!0,J(A,X)},A.exports.constants=s(12034)},12065:(A,X,s)=>{"use strict";const N=s(12074),f=s(12042),E=s(12050),g=s(12030),K=s(12058),r=s(12092),i=Object.prototype.toString,{Z_NO_FLUSH:Y,Z_FINISH:v,Z_OK:c,Z_STREAM_END:M,Z_NEED_DICT:d,Z_STREAM_ERROR:Q,Z_DATA_ERROR:w,Z_MEM_ERROR:R}=s(12034);function C(A){this.options=f.assign({Ja:65536,windowBits:15,to:""},A||{});const X=this.options;X.raw&&X.windowBits>=0&&X.windowBits<16&&(X.windowBits=-X.windowBits,0===X.windowBits&&(X.windowBits=-15)),!(X.windowBits>=0&&X.windowBits<16)||A&&A.windowBits||(X.windowBits+=32),X.windowBits>15&&X.windowBits<48&&0===(15&X.windowBits)&&(X.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new K,this.strm.avail_out=0;let s=N.inflateInit2(this.strm,X.windowBits);if(s!==c)throw new Error(g[s]);if(this.header=new r,N.inflateGetHeader(this.strm,this.header),X.dictionary&&("string"===typeof X.dictionary?X.dictionary=E.string2buf(X.dictionary):"[object ArrayBuffer]"===i.call(X.dictionary)&&(X.dictionary=new Uint8Array(X.dictionary)),X.raw&&(s=N.inflateSetDictionary(this.strm,X.dictionary),s!==c)))throw new Error(g[s])}function J(A,X){const s=new C(X);if(s.push(A),s.err)throw s.msg||g[s.err];return s.result}C.prototype.push=function(A,X){const s=this.strm,f=this.options.Ja,g=this.options.dictionary;let K,r,C;if(this.ended)return!1;for(r=X===~~X?X:!0===X?v:Y,"[object ArrayBuffer]"===i.call(A)?s.input=new Uint8Array(A):s.input=A,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(f),s.next_out=0,s.avail_out=f),K=N.inflate(s,r),K===d&&g&&(K=N.inflateSetDictionary(s,g),K===c?K=N.inflate(s,r):K===w&&(K=d));s.avail_in>0&&K===M&&s.state.wrap>0&&0!==A[s.next_in];)N.inflateReset(s),K=N.inflate(s,r);switch(K){case Q:case w:case d:case R:return this.onEnd(K),this.ended=!0,!1}if(C=s.avail_out,s.next_out&&(0===s.avail_out||K===M))if("string"===this.options.to){let A=E.utf8border(s.output,s.next_out),X=s.next_out-A,N=E.buf2string(s.output,A);s.next_out=X,s.avail_out=f-X,X&&s.output.set(s.output.subarray(A,A+X),0),this.onData(N)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(K!==c||0!==C){if(K===M)return K=N.inflateEnd(this.strm),this.onEnd(K),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},C.prototype.onData=function(A){this.chunks.push(A)},C.prototype.onEnd=function(A){A===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg},A.exports.Inflate=C,A.exports.inflate=J,A.exports.inflateRaw=function(A,X){return(X=X||{}).raw=!0,J(A,X)},A.exports.ungzip=J,A.exports.constants=s(12034)},12042:A=>{"use strict";const X=(A,X)=>Object.prototype.hasOwnProperty.call(A,X);A.exports.assign=function(A){const s=Array.prototype.slice.call(arguments,1);for(;s.length;){const N=s.shift();if(N){if("object"!==typeof N)throw new TypeError(N+"must be non-object");for(const s in N)X(N,s)&&(A[s]=N[s])}}return A},A.exports.flattenChunks=A=>{let X=0;for(let N=0,f=A.length;N<f;N++)X+=A[N].length;const s=new Uint8Array(X);for(let N=0,f=0,E=A.length;N<E;N++){let X=A[N];s.set(X,f),f+=X.length}return s}},12050:A=>{"use strict";let X=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(N){X=!1}const s=new Uint8Array(256);for(let f=0;f<256;f++)s[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;s[254]=s[254]=1,A.exports.string2buf=A=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(A);let X,s,N,f,E,g=A.length,K=0;for(f=0;f<g;f++)s=A.charCodeAt(f),55296===(64512&s)&&f+1<g&&(N=A.charCodeAt(f+1),56320===(64512&N)&&(s=65536+(s-55296<<10)+(N-56320),f++)),K+=s<128?1:s<2048?2:s<65536?3:4;for(X=new Uint8Array(K),E=0,f=0;E<K;f++)s=A.charCodeAt(f),55296===(64512&s)&&f+1<g&&(N=A.charCodeAt(f+1),56320===(64512&N)&&(s=65536+(s-55296<<10)+(N-56320),f++)),s<128?X[E++]=s:s<2048?(X[E++]=192|s>>>6,X[E++]=128|63&s):s<65536?(X[E++]=224|s>>>12,X[E++]=128|s>>>6&63,X[E++]=128|63&s):(X[E++]=240|s>>>18,X[E++]=128|s>>>12&63,X[E++]=128|s>>>6&63,X[E++]=128|63&s);return X};A.exports.buf2string=(A,N)=>{const f=N||A.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(A.subarray(0,N));let E,g;const K=new Array(2*f);for(g=0,E=0;E<f;){let X=A[E++];if(X<128){K[g++]=X;continue}let N=s[X];if(N>4)K[g++]=65533,E+=N-1;else{for(X&=2===N?31:3===N?15:7;N>1&&E<f;)X=X<<6|63&A[E++],N--;N>1?K[g++]=65533:X<65536?K[g++]=X:(X-=65536,K[g++]=55296|X>>10&1023,K[g++]=56320|1023&X)}}return((A,s)=>{if(s<65534&&A.subarray&&X)return String.fromCharCode.apply(null,A.length===s?A:A.subarray(0,s));let N="";for(let X=0;X<s;X++)N+=String.fromCharCode(A[X]);return N})(K,g)},A.exports.utf8border=(A,X)=>{(X=X||A.length)>A.length&&(X=A.length);let N=X-1;for(;N>=0&&128===(192&A[N]);)N--;return N<0||0===N?X:N+s[A[N]]>X?N:X}},12014:A=>{"use strict";A.exports=(A,X,s,N)=>{let f=65535&A,E=A>>>16&65535,g=0;for(;0!==s;){g=s>2e3?2e3:s,s-=g;do{f=f+X[N++]|0,E=E+f|0}while(--g);f%=65521,E%=65521}return f|E<<16}},12034:A=>{"use strict";A.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12021:A=>{"use strict";const X=new Uint32Array((()=>{let A,X=[];for(var s=0;s<256;s++){A=s;for(var N=0;N<8;N++)A=1&A?3988292384^A>>>1:A>>>1;X[s]=A}return X})());A.exports=(A,s,N,f)=>{const E=X,g=f+N;A^=-1;for(let X=f;X<g;X++)A=A>>>8^E[255&(A^s[X])];return~A}},12002:(A,X,s)=>{"use strict";const{_tr_init:N,_tr_stored_block:f,_tr_flush_block:E,_tr_tally:g,_tr_align:K}=s(12005),r=s(12014),i=s(12021),Y=s(12030),{Z_NO_FLUSH:v,Z_PARTIAL_FLUSH:c,Z_FULL_FLUSH:M,Z_FINISH:d,Z_BLOCK:Q,Z_OK:w,Z_STREAM_END:R,Z_STREAM_ERROR:C,Z_DATA_ERROR:J,Z_BUF_ERROR:a,Z_DEFAULT_COMPRESSION:u,Z_FILTERED:z,Z_HUFFMAN_ONLY:m,Z_RLE:b,Z_FIXED:y,Z_DEFAULT_STRATEGY:j,Z_UNKNOWN:G,Z_DEFLATED:V}=s(12034),D=258,O=262,P=103,l=113,n=666,U=(A,X)=>(A.msg=Y[X],X),t=A=>(A<<1)-(A>4?9:0),e=A=>{let X=A.length;for(;--X>=0;)A[X]=0};let T=(A,X,s)=>(X<<A.hash_shift^s)&A.hash_mask;const I=A=>{const X=A.state;let s=X.pending;s>A.avail_out&&(s=A.avail_out),0!==s&&(A.output.set(X.pending_buf.subarray(X.pending_out,X.pending_out+s),A.next_out),A.next_out+=s,X.pending_out+=s,A.total_out+=s,A.avail_out-=s,X.pending-=s,0===X.pending&&(X.pending_out=0))},L=(A,X)=>{E(A,A.block_start>=0?A.block_start:-1,A.strstart-A.block_start,X),A.block_start=A.strstart,I(A.strm)},k=(A,X)=>{A.pending_buf[A.pending++]=X},x=(A,X)=>{A.pending_buf[A.pending++]=X>>>8&255,A.pending_buf[A.pending++]=255&X},H=(A,X,s,N)=>{let f=A.avail_in;return f>N&&(f=N),0===f?0:(A.avail_in-=f,X.set(A.input.subarray(A.next_in,A.next_in+f),s),1===A.state.wrap?A.adler=r(A.adler,X,f,s):2===A.state.wrap&&(A.adler=i(A.adler,X,f,s)),A.next_in+=f,A.total_in+=f,f)},F=(A,X)=>{let s,N,f=A.max_chain_length,E=A.strstart,g=A.prev_length,K=A.nice_match;const r=A.strstart>A.w_size-O?A.strstart-(A.w_size-O):0,i=A.window,Y=A.w_mask,v=A.prev,c=A.strstart+D;let M=i[E+g-1],d=i[E+g];A.prev_length>=A.good_match&&(f>>=2),K>A.lookahead&&(K=A.lookahead);do{if(s=X,i[s+g]===d&&i[s+g-1]===M&&i[s]===i[E]&&i[++s]===i[E+1]){E+=2,s++;do{}while(i[++E]===i[++s]&&i[++E]===i[++s]&&i[++E]===i[++s]&&i[++E]===i[++s]&&i[++E]===i[++s]&&i[++E]===i[++s]&&i[++E]===i[++s]&&i[++E]===i[++s]&&E<c);if(N=D-(c-E),E=c-D,N>g){if(A.match_start=X,g=N,N>=K)break;M=i[E+g-1],d=i[E+g]}}}while((X=v[X&Y])>r&&0!==--f);return g<=A.lookahead?g:A.lookahead},q=A=>{const X=A.w_size;let s,N,f,E,g;do{if(E=A.window_size-A.lookahead-A.strstart,A.strstart>=X+(X-O)){A.window.set(A.window.subarray(X,X+X),0),A.match_start-=X,A.strstart-=X,A.block_start-=X,N=A.hash_size,s=N;do{f=A.head[--s],A.head[s]=f>=X?f-X:0}while(--N);N=X,s=N;do{f=A.prev[--s],A.prev[s]=f>=X?f-X:0}while(--N);E+=X}if(0===A.strm.avail_in)break;if(N=H(A.strm,A.window,A.strstart+A.lookahead,E),A.lookahead+=N,A.lookahead+A.insert>=3)for(g=A.strstart-A.insert,A.ins_h=A.window[g],A.ins_h=T(A,A.ins_h,A.window[g+1]);A.insert&&(A.ins_h=T(A,A.ins_h,A.window[g+3-1]),A.prev[g&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=g,g++,A.insert--,!(A.lookahead+A.insert<3)););}while(A.lookahead<O&&0!==A.strm.avail_in)},S=(A,X)=>{let s,N;for(;;){if(A.lookahead<O){if(q(A),A.lookahead<O&&X===v)return 1;if(0===A.lookahead)break}if(s=0,A.lookahead>=3&&(A.ins_h=T(A,A.ins_h,A.window[A.strstart+3-1]),s=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),0!==s&&A.strstart-s<=A.w_size-O&&(A.match_length=F(A,s)),A.match_length>=3)if(N=g(A,A.strstart-A.match_start,A.match_length-3),A.lookahead-=A.match_length,A.match_length<=A.max_lazy_match&&A.lookahead>=3){A.match_length--;do{A.strstart++,A.ins_h=T(A,A.ins_h,A.window[A.strstart+3-1]),s=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart}while(0!==--A.match_length);A.strstart++}else A.strstart+=A.match_length,A.match_length=0,A.ins_h=A.window[A.strstart],A.ins_h=T(A,A.ins_h,A.window[A.strstart+1]);else N=g(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++;if(N&&(L(A,!1),0===A.strm.avail_out))return 1}return A.insert=A.strstart<2?A.strstart:2,X===d?(L(A,!0),0===A.strm.avail_out?3:4):A.last_lit&&(L(A,!1),0===A.strm.avail_out)?1:2},p=(A,X)=>{let s,N,f;for(;;){if(A.lookahead<O){if(q(A),A.lookahead<O&&X===v)return 1;if(0===A.lookahead)break}if(s=0,A.lookahead>=3&&(A.ins_h=T(A,A.ins_h,A.window[A.strstart+3-1]),s=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),A.prev_length=A.match_length,A.prev_match=A.match_start,A.match_length=2,0!==s&&A.prev_length<A.max_lazy_match&&A.strstart-s<=A.w_size-O&&(A.match_length=F(A,s),A.match_length<=5&&(A.strategy===z||3===A.match_length&&A.strstart-A.match_start>4096)&&(A.match_length=2)),A.prev_length>=3&&A.match_length<=A.prev_length){f=A.strstart+A.lookahead-3,N=g(A,A.strstart-1-A.prev_match,A.prev_length-3),A.lookahead-=A.prev_length-1,A.prev_length-=2;do{++A.strstart<=f&&(A.ins_h=T(A,A.ins_h,A.window[A.strstart+3-1]),s=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart)}while(0!==--A.prev_length);if(A.match_available=0,A.match_length=2,A.strstart++,N&&(L(A,!1),0===A.strm.avail_out))return 1}else if(A.match_available){if(N=g(A,0,A.window[A.strstart-1]),N&&L(A,!1),A.strstart++,A.lookahead--,0===A.strm.avail_out)return 1}else A.match_available=1,A.strstart++,A.lookahead--}return A.match_available&&(N=g(A,0,A.window[A.strstart-1]),A.match_available=0),A.insert=A.strstart<2?A.strstart:2,X===d?(L(A,!0),0===A.strm.avail_out?3:4):A.last_lit&&(L(A,!1),0===A.strm.avail_out)?1:2};function B(A,X,s,N,f){this.good_length=A,this.max_lazy=X,this.nice_length=s,this.max_chain=N,this.func=f}const Z=[new B(0,0,0,0,((A,X)=>{let s=65535;for(s>A.pending_buf_size-5&&(s=A.pending_buf_size-5);;){if(A.lookahead<=1){if(q(A),0===A.lookahead&&X===v)return 1;if(0===A.lookahead)break}A.strstart+=A.lookahead,A.lookahead=0;const N=A.block_start+s;if((0===A.strstart||A.strstart>=N)&&(A.lookahead=A.strstart-N,A.strstart=N,L(A,!1),0===A.strm.avail_out))return 1;if(A.strstart-A.block_start>=A.w_size-O&&(L(A,!1),0===A.strm.avail_out))return 1}return A.insert=0,X===d?(L(A,!0),0===A.strm.avail_out?3:4):(A.strstart>A.block_start&&(L(A,!1),A.strm.avail_out),1)})),new B(4,4,8,4,S),new B(4,5,16,8,S),new B(4,6,32,32,S),new B(4,4,16,16,p),new B(8,16,32,32,p),new B(8,16,128,128,p),new B(8,32,128,256,p),new B(32,128,258,1024,p),new B(32,258,258,4096,p)];function o(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=V,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),e(this.dyn_ltree),e(this.dyn_dtree),e(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),e(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),e(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const W=A=>{if(!A||!A.state)return U(A,C);A.total_in=A.total_out=0,A.data_type=G;const X=A.state;return X.pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?42:l,A.adler=2===X.wrap?0:1,X.last_flush=v,N(X),w},h=A=>{const X=W(A);var s;return X===w&&((s=A.state).window_size=2*s.w_size,e(s.head),s.max_lazy_match=Z[s.level].max_lazy,s.good_match=Z[s.level].good_length,s.nice_match=Z[s.level].nice_length,s.max_chain_length=Z[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),X},AA=(A,X,s,N,f,E)=>{if(!A)return C;let g=1;if(X===u&&(X=6),N<0?(g=0,N=-N):N>15&&(g=2,N-=16),f<1||f>9||s!==V||N<8||N>15||X<0||X>9||E<0||E>y)return U(A,C);8===N&&(N=9);const K=new o;return A.state=K,K.strm=A,K.wrap=g,K.gzhead=null,K.w_bits=N,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=f+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+3-1)/3),K.window=new Uint8Array(2*K.w_size),K.head=new Uint16Array(K.hash_size),K.prev=new Uint16Array(K.w_size),K.lit_bufsize=1<<f+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new Uint8Array(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=X,K.strategy=E,K.method=s,h(A)};A.exports.deflateInit=(A,X)=>AA(A,X,V,15,8,j),A.exports.deflateInit2=AA,A.exports.deflateReset=h,A.exports.deflateResetKeep=W,A.exports.deflateSetHeader=(A,X)=>A&&A.state?2!==A.state.wrap?C:(A.state.gzhead=X,w):C,A.exports.deflate=(A,X)=>{let s,N;if(!A||!A.state||X>Q||X<0)return A?U(A,C):C;const E=A.state;if(!A.output||!A.input&&0!==A.avail_in||E.status===n&&X!==d)return U(A,0===A.avail_out?a:C);E.strm=A;const r=E.last_flush;if(E.last_flush=X,42===E.status)if(2===E.wrap)A.adler=0,k(E,31),k(E,139),k(E,8),E.gzhead?(k(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),k(E,255&E.gzhead.time),k(E,E.gzhead.time>>8&255),k(E,E.gzhead.time>>16&255),k(E,E.gzhead.time>>24&255),k(E,9===E.level?2:E.strategy>=m||E.level<2?4:0),k(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(k(E,255&E.gzhead.extra.length),k(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(A.adler=i(A.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(k(E,0),k(E,0),k(E,0),k(E,0),k(E,0),k(E,9===E.level?2:E.strategy>=m||E.level<2?4:0),k(E,3),E.status=l);else{let X=V+(E.w_bits-8<<4)<<8,s=-1;s=E.strategy>=m||E.level<2?0:E.level<6?1:6===E.level?2:3,X|=s<<6,0!==E.strstart&&(X|=32),X+=31-X%31,E.status=l,x(E,X),0!==E.strstart&&(x(E,A.adler>>>16),x(E,65535&A.adler)),A.adler=1}if(69===E.status)if(E.gzhead.extra){for(s=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>s&&(A.adler=i(A.adler,E.pending_buf,E.pending-s,s)),I(A),s=E.pending,E.pending!==E.pending_buf_size));)k(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>s&&(A.adler=i(A.adler,E.pending_buf,E.pending-s,s)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(73===E.status)if(E.gzhead.name){s=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>s&&(A.adler=i(A.adler,E.pending_buf,E.pending-s,s)),I(A),s=E.pending,E.pending===E.pending_buf_size)){N=1;break}N=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,k(E,N)}while(0!==N);E.gzhead.hcrc&&E.pending>s&&(A.adler=i(A.adler,E.pending_buf,E.pending-s,s)),0===N&&(E.gzindex=0,E.status=91)}else E.status=91;if(91===E.status)if(E.gzhead.comment){s=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>s&&(A.adler=i(A.adler,E.pending_buf,E.pending-s,s)),I(A),s=E.pending,E.pending===E.pending_buf_size)){N=1;break}N=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,k(E,N)}while(0!==N);E.gzhead.hcrc&&E.pending>s&&(A.adler=i(A.adler,E.pending_buf,E.pending-s,s)),0===N&&(E.status=P)}else E.status=P;if(E.status===P&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&I(A),E.pending+2<=E.pending_buf_size&&(k(E,255&A.adler),k(E,A.adler>>8&255),A.adler=0,E.status=l)):E.status=l),0!==E.pending){if(I(A),0===A.avail_out)return E.last_flush=-1,w}else if(0===A.avail_in&&t(X)<=t(r)&&X!==d)return U(A,a);if(E.status===n&&0!==A.avail_in)return U(A,a);if(0!==A.avail_in||0!==E.lookahead||X!==v&&E.status!==n){let s=E.strategy===m?((A,X)=>{let s;for(;;){if(0===A.lookahead&&(q(A),0===A.lookahead)){if(X===v)return 1;break}if(A.match_length=0,s=g(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++,s&&(L(A,!1),0===A.strm.avail_out))return 1}return A.insert=0,X===d?(L(A,!0),0===A.strm.avail_out?3:4):A.last_lit&&(L(A,!1),0===A.strm.avail_out)?1:2})(E,X):E.strategy===b?((A,X)=>{let s,N,f,E;const K=A.window;for(;;){if(A.lookahead<=D){if(q(A),A.lookahead<=D&&X===v)return 1;if(0===A.lookahead)break}if(A.match_length=0,A.lookahead>=3&&A.strstart>0&&(f=A.strstart-1,N=K[f],N===K[++f]&&N===K[++f]&&N===K[++f])){E=A.strstart+D;do{}while(N===K[++f]&&N===K[++f]&&N===K[++f]&&N===K[++f]&&N===K[++f]&&N===K[++f]&&N===K[++f]&&N===K[++f]&&f<E);A.match_length=D-(E-f),A.match_length>A.lookahead&&(A.match_length=A.lookahead)}if(A.match_length>=3?(s=g(A,1,A.match_length-3),A.lookahead-=A.match_length,A.strstart+=A.match_length,A.match_length=0):(s=g(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++),s&&(L(A,!1),0===A.strm.avail_out))return 1}return A.insert=0,X===d?(L(A,!0),0===A.strm.avail_out?3:4):A.last_lit&&(L(A,!1),0===A.strm.avail_out)?1:2})(E,X):Z[E.level].func(E,X);if(3!==s&&4!==s||(E.status=n),1===s||3===s)return 0===A.avail_out&&(E.last_flush=-1),w;if(2===s&&(X===c?K(E):X!==Q&&(f(E,0,0,!1),X===M&&(e(E.head),0===E.lookahead&&(E.strstart=0,E.block_start=0,E.insert=0))),I(A),0===A.avail_out))return E.last_flush=-1,w}return X!==d?w:E.wrap<=0?R:(2===E.wrap?(k(E,255&A.adler),k(E,A.adler>>8&255),k(E,A.adler>>16&255),k(E,A.adler>>24&255),k(E,255&A.total_in),k(E,A.total_in>>8&255),k(E,A.total_in>>16&255),k(E,A.total_in>>24&255)):(x(E,A.adler>>>16),x(E,65535&A.adler)),I(A),E.wrap>0&&(E.wrap=-E.wrap),0!==E.pending?w:R)},A.exports.deflateEnd=A=>{if(!A||!A.state)return C;const X=A.state.status;return 42!==X&&69!==X&&73!==X&&91!==X&&X!==P&&X!==l&&X!==n?U(A,C):(A.state=null,X===l?U(A,J):w)},A.exports.deflateSetDictionary=(A,X)=>{let s=X.length;if(!A||!A.state)return C;const N=A.state,f=N.wrap;if(2===f||1===f&&42!==N.status||N.lookahead)return C;if(1===f&&(A.adler=r(A.adler,X,s,0)),N.wrap=0,s>=N.w_size){0===f&&(e(N.head),N.strstart=0,N.block_start=0,N.insert=0);let A=new Uint8Array(N.w_size);A.set(X.subarray(s-N.w_size,s),0),X=A,s=N.w_size}const E=A.avail_in,g=A.next_in,K=A.input;for(A.avail_in=s,A.next_in=0,A.input=X,q(N);N.lookahead>=3;){let A=N.strstart,X=N.lookahead-2;do{N.ins_h=T(N,N.ins_h,N.window[A+3-1]),N.prev[A&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=A,A++}while(--X);N.strstart=A,N.lookahead=2,q(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=2,N.match_available=0,A.next_in=g,A.input=K,A.avail_in=E,N.wrap=f,w},A.exports.deflateInfo="pako deflate (from Nodeca project)"},12092:A=>{"use strict";A.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12081:A=>{"use strict";A.exports=function(A,X){let s,N,f,E,g,K,r,i,Y,v,c,M,d,Q,w,R,C,J,a,u,z,m,b,y;const j=A.state;s=A.next_in,b=A.input,N=s+(A.avail_in-5),f=A.next_out,y=A.output,E=f-(X-A.avail_out),g=f+(A.avail_out-257),K=j.dmax,r=j.wsize,i=j.whave,Y=j.wnext,v=j.window,c=j.hold,M=j.bits,d=j.lencode,Q=j.distcode,w=(1<<j.lenbits)-1,R=(1<<j.distbits)-1;A:do{M<15&&(c+=b[s++]<<M,M+=8,c+=b[s++]<<M,M+=8),C=d[c&w];X:for(;;){if(J=C>>>24,c>>>=J,M-=J,J=C>>>16&255,0===J)y[f++]=65535&C;else{if(!(16&J)){if(0===(64&J)){C=d[(65535&C)+(c&(1<<J)-1)];continue X}if(32&J){j.mode=12;break A}A.msg="invalid literal/length code",j.mode=30;break A}a=65535&C,J&=15,J&&(M<J&&(c+=b[s++]<<M,M+=8),a+=c&(1<<J)-1,c>>>=J,M-=J),M<15&&(c+=b[s++]<<M,M+=8,c+=b[s++]<<M,M+=8),C=Q[c&R];s:for(;;){if(J=C>>>24,c>>>=J,M-=J,J=C>>>16&255,!(16&J)){if(0===(64&J)){C=Q[(65535&C)+(c&(1<<J)-1)];continue s}A.msg="invalid distance code",j.mode=30;break A}if(u=65535&C,J&=15,M<J&&(c+=b[s++]<<M,M+=8,M<J&&(c+=b[s++]<<M,M+=8)),u+=c&(1<<J)-1,u>K){A.msg="invalid distance too far back",j.mode=30;break A}if(c>>>=J,M-=J,J=f-E,u>J){if(J=u-J,J>i&&j.sane){A.msg="invalid distance too far back",j.mode=30;break A}if(z=0,m=v,0===Y){if(z+=r-J,J<a){a-=J;do{y[f++]=v[z++]}while(--J);z=f-u,m=y}}else if(Y<J){if(z+=r+Y-J,J-=Y,J<a){a-=J;do{y[f++]=v[z++]}while(--J);if(z=0,Y<a){J=Y,a-=J;do{y[f++]=v[z++]}while(--J);z=f-u,m=y}}}else if(z+=Y-J,J<a){a-=J;do{y[f++]=v[z++]}while(--J);z=f-u,m=y}for(;a>2;)y[f++]=m[z++],y[f++]=m[z++],y[f++]=m[z++],a-=3;a&&(y[f++]=m[z++],a>1&&(y[f++]=m[z++]))}else{z=f-u;do{y[f++]=y[z++],y[f++]=y[z++],y[f++]=y[z++],a-=3}while(a>2);a&&(y[f++]=y[z++],a>1&&(y[f++]=y[z++]))}break}}break}}while(s<N&&f<g);a=M>>3,s-=a,M-=a<<3,c&=(1<<M)-1,A.next_in=s,A.next_out=f,A.avail_in=s<N?N-s+5:5-(s-N),A.avail_out=f<g?g-f+257:257-(f-g),j.hold=c,j.bits=M}},12074:(A,X,s)=>{"use strict";const N=s(12014),f=s(12021),E=s(12081),g=s(12088),{Z_FINISH:K,Z_BLOCK:r,Z_TREES:i,Z_OK:Y,Z_STREAM_END:v,Z_NEED_DICT:c,Z_STREAM_ERROR:M,Z_DATA_ERROR:d,Z_MEM_ERROR:Q,Z_BUF_ERROR:w,Z_DEFLATED:R}=s(12034),C=12,J=30,a=A=>(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24);function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const z=A=>{if(!A||!A.state)return M;const X=A.state;return A.total_in=A.total_out=X.total=0,A.msg="",X.wrap&&(A.adler=1&X.wrap),X.mode=1,X.last=0,X.havedict=0,X.dmax=32768,X.head=null,X.hold=0,X.bits=0,X.lencode=X.lendyn=new Int32Array(852),X.distcode=X.distdyn=new Int32Array(592),X.sane=1,X.back=-1,Y},m=A=>{if(!A||!A.state)return M;const X=A.state;return X.wsize=0,X.whave=0,X.wnext=0,z(A)},b=(A,X)=>{let s;if(!A||!A.state)return M;const N=A.state;return X<0?(s=0,X=-X):(s=1+(X>>4),X<48&&(X&=15)),X&&(X<8||X>15)?M:(null!==N.window&&N.wbits!==X&&(N.window=null),N.wrap=s,N.wbits=X,m(A))},y=(A,X)=>{if(!A)return M;const s=new u;A.state=s,s.window=null;const N=b(A,X);return N!==Y&&(A.state=null),N};let j,G,V=!0;const D=A=>{if(V){j=new Int32Array(512),G=new Int32Array(32);let X=0;for(;X<144;)A.lens[X++]=8;for(;X<256;)A.lens[X++]=9;for(;X<280;)A.lens[X++]=7;for(;X<288;)A.lens[X++]=8;for(g(1,A.lens,0,288,j,0,A.work,{bits:9}),X=0;X<32;)A.lens[X++]=5;g(2,A.lens,0,32,G,0,A.work,{bits:5}),V=!1}A.lencode=j,A.lenbits=9,A.distcode=G,A.distbits=5},O=(A,X,s,N)=>{let f;const E=A.state;return null===E.window&&(E.wsize=1<<E.wbits,E.wnext=0,E.whave=0,E.window=new Uint8Array(E.wsize)),N>=E.wsize?(E.window.set(X.subarray(s-E.wsize,s),0),E.wnext=0,E.whave=E.wsize):(f=E.wsize-E.wnext,f>N&&(f=N),E.window.set(X.subarray(s-N,s-N+f),E.wnext),(N-=f)?(E.window.set(X.subarray(s-N,s),0),E.wnext=N,E.whave=E.wsize):(E.wnext+=f,E.wnext===E.wsize&&(E.wnext=0),E.whave<E.wsize&&(E.whave+=f))),0};A.exports.inflateReset=m,A.exports.inflateReset2=b,A.exports.inflateResetKeep=z,A.exports.inflateInit=A=>y(A,15),A.exports.inflateInit2=y,A.exports.inflate=(A,X)=>{let s,u,z,m,b,y,j,G,V,P,l,n,U,t,e,T,I,L,k,x,H,F,q=0;const S=new Uint8Array(4);let p,B;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!A||!A.state||!A.output||!A.input&&0!==A.avail_in)return M;s=A.state,s.mode===C&&(s.mode=13),b=A.next_out,z=A.output,j=A.avail_out,m=A.next_in,u=A.input,y=A.avail_in,G=s.hold,V=s.bits,P=y,l=j,F=Y;A:for(;;)switch(s.mode){case 1:if(0===s.wrap){s.mode=13;break}for(;V<16;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(2&s.wrap&&35615===G){s.check=0,S[0]=255&G,S[1]=G>>>8&255,s.check=f(s.check,S,2,0),G=0,V=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&G)<<8)+(G>>8))%31){A.msg="incorrect header check",s.mode=J;break}if((15&G)!==R){A.msg="unknown compression method",s.mode=J;break}if(G>>>=4,V-=4,H=8+(15&G),0===s.wbits)s.wbits=H;else if(H>s.wbits){A.msg="invalid window size",s.mode=J;break}s.dmax=1<<s.wbits,A.adler=s.check=1,s.mode=512&G?10:C,G=0,V=0;break;case 2:for(;V<16;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(s.flags=G,(255&s.flags)!==R){A.msg="unknown compression method",s.mode=J;break}if(57344&s.flags){A.msg="unknown header flags set",s.mode=J;break}s.head&&(s.head.text=G>>8&1),512&s.flags&&(S[0]=255&G,S[1]=G>>>8&255,s.check=f(s.check,S,2,0)),G=0,V=0,s.mode=3;case 3:for(;V<32;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}s.head&&(s.head.time=G),512&s.flags&&(S[0]=255&G,S[1]=G>>>8&255,S[2]=G>>>16&255,S[3]=G>>>24&255,s.check=f(s.check,S,4,0)),G=0,V=0,s.mode=4;case 4:for(;V<16;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}s.head&&(s.head.xflags=255&G,s.head.os=G>>8),512&s.flags&&(S[0]=255&G,S[1]=G>>>8&255,s.check=f(s.check,S,2,0)),G=0,V=0,s.mode=5;case 5:if(1024&s.flags){for(;V<16;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}s.length=G,s.head&&(s.head.extra_len=G),512&s.flags&&(S[0]=255&G,S[1]=G>>>8&255,s.check=f(s.check,S,2,0)),G=0,V=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&(n=s.length,n>y&&(n=y),n&&(s.head&&(H=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(u.subarray(m,m+n),H)),512&s.flags&&(s.check=f(s.check,u,n,m)),y-=n,m+=n,s.length-=n),s.length))break A;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===y)break A;n=0;do{H=u[m+n++],s.head&&H&&s.length<65536&&(s.head.name+=String.fromCharCode(H))}while(H&&n<y);if(512&s.flags&&(s.check=f(s.check,u,n,m)),y-=n,m+=n,H)break A}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===y)break A;n=0;do{H=u[m+n++],s.head&&H&&s.length<65536&&(s.head.comment+=String.fromCharCode(H))}while(H&&n<y);if(512&s.flags&&(s.check=f(s.check,u,n,m)),y-=n,m+=n,H)break A}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;V<16;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(G!==(65535&s.check)){A.msg="header crc mismatch",s.mode=J;break}G=0,V=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),A.adler=s.check=0,s.mode=C;break;case 10:for(;V<32;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}A.adler=s.check=a(G),G=0,V=0,s.mode=11;case 11:if(0===s.havedict)return A.next_out=b,A.avail_out=j,A.next_in=m,A.avail_in=y,s.hold=G,s.bits=V,c;A.adler=s.check=1,s.mode=C;case C:if(X===r||X===i)break A;case 13:if(s.last){G>>>=7&V,V-=7&V,s.mode=27;break}for(;V<3;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}switch(s.last=1&G,G>>>=1,V-=1,3&G){case 0:s.mode=14;break;case 1:if(D(s),s.mode=20,X===i){G>>>=2,V-=2;break A}break;case 2:s.mode=17;break;case 3:A.msg="invalid block type",s.mode=J}G>>>=2,V-=2;break;case 14:for(G>>>=7&V,V-=7&V;V<32;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if((65535&G)!==(G>>>16^65535)){A.msg="invalid stored block lengths",s.mode=J;break}if(s.length=65535&G,G=0,V=0,s.mode=15,X===i)break A;case 15:s.mode=16;case 16:if(n=s.length,n){if(n>y&&(n=y),n>j&&(n=j),0===n)break A;z.set(u.subarray(m,m+n),b),y-=n,m+=n,j-=n,b+=n,s.length-=n;break}s.mode=C;break;case 17:for(;V<14;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(s.nlen=257+(31&G),G>>>=5,V-=5,s.ndist=1+(31&G),G>>>=5,V-=5,s.ncode=4+(15&G),G>>>=4,V-=4,s.nlen>286||s.ndist>30){A.msg="too many length or distance symbols",s.mode=J;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;V<3;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}s.lens[Z[s.have++]]=7&G,G>>>=3,V-=3}for(;s.have<19;)s.lens[Z[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,p={bits:s.lenbits},F=g(0,s.lens,0,19,s.lencode,0,s.work,p),s.lenbits=p.bits,F){A.msg="invalid code lengths set",s.mode=J;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;q=s.lencode[G&(1<<s.lenbits)-1],e=q>>>24,T=q>>>16&255,I=65535&q,!(e<=V);){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(I<16)G>>>=e,V-=e,s.lens[s.have++]=I;else{if(16===I){for(B=e+2;V<B;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(G>>>=e,V-=e,0===s.have){A.msg="invalid bit length repeat",s.mode=J;break}H=s.lens[s.have-1],n=3+(3&G),G>>>=2,V-=2}else if(17===I){for(B=e+3;V<B;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}G>>>=e,V-=e,H=0,n=3+(7&G),G>>>=3,V-=3}else{for(B=e+7;V<B;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}G>>>=e,V-=e,H=0,n=11+(127&G),G>>>=7,V-=7}if(s.have+n>s.nlen+s.ndist){A.msg="invalid bit length repeat",s.mode=J;break}for(;n--;)s.lens[s.have++]=H}}if(s.mode===J)break;if(0===s.lens[256]){A.msg="invalid code -- missing end-of-block",s.mode=J;break}if(s.lenbits=9,p={bits:s.lenbits},F=g(1,s.lens,0,s.nlen,s.lencode,0,s.work,p),s.lenbits=p.bits,F){A.msg="invalid literal/lengths set",s.mode=J;break}if(s.distbits=6,s.distcode=s.distdyn,p={bits:s.distbits},F=g(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,p),s.distbits=p.bits,F){A.msg="invalid distances set",s.mode=J;break}if(s.mode=20,X===i)break A;case 20:s.mode=21;case 21:if(y>=6&&j>=258){A.next_out=b,A.avail_out=j,A.next_in=m,A.avail_in=y,s.hold=G,s.bits=V,E(A,l),b=A.next_out,z=A.output,j=A.avail_out,m=A.next_in,u=A.input,y=A.avail_in,G=s.hold,V=s.bits,s.mode===C&&(s.back=-1);break}for(s.back=0;q=s.lencode[G&(1<<s.lenbits)-1],e=q>>>24,T=q>>>16&255,I=65535&q,!(e<=V);){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(T&&0===(240&T)){for(L=e,k=T,x=I;q=s.lencode[x+((G&(1<<L+k)-1)>>L)],e=q>>>24,T=q>>>16&255,I=65535&q,!(L+e<=V);){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}G>>>=L,V-=L,s.back+=L}if(G>>>=e,V-=e,s.back+=e,s.length=I,0===T){s.mode=26;break}if(32&T){s.back=-1,s.mode=C;break}if(64&T){A.msg="invalid literal/length code",s.mode=J;break}s.extra=15&T,s.mode=22;case 22:if(s.extra){for(B=s.extra;V<B;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}s.length+=G&(1<<s.extra)-1,G>>>=s.extra,V-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;q=s.distcode[G&(1<<s.distbits)-1],e=q>>>24,T=q>>>16&255,I=65535&q,!(e<=V);){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(0===(240&T)){for(L=e,k=T,x=I;q=s.distcode[x+((G&(1<<L+k)-1)>>L)],e=q>>>24,T=q>>>16&255,I=65535&q,!(L+e<=V);){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}G>>>=L,V-=L,s.back+=L}if(G>>>=e,V-=e,s.back+=e,64&T){A.msg="invalid distance code",s.mode=J;break}s.offset=I,s.extra=15&T,s.mode=24;case 24:if(s.extra){for(B=s.extra;V<B;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}s.offset+=G&(1<<s.extra)-1,G>>>=s.extra,V-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){A.msg="invalid distance too far back",s.mode=J;break}s.mode=25;case 25:if(0===j)break A;if(n=l-j,s.offset>n){if(n=s.offset-n,n>s.whave&&s.sane){A.msg="invalid distance too far back",s.mode=J;break}n>s.wnext?(n-=s.wnext,U=s.wsize-n):U=s.wnext-n,n>s.length&&(n=s.length),t=s.window}else t=z,U=b-s.offset,n=s.length;n>j&&(n=j),j-=n,s.length-=n;do{z[b++]=t[U++]}while(--n);0===s.length&&(s.mode=21);break;case 26:if(0===j)break A;z[b++]=s.length,j--,s.mode=21;break;case 27:if(s.wrap){for(;V<32;){if(0===y)break A;y--,G|=u[m++]<<V,V+=8}if(l-=j,A.total_out+=l,s.total+=l,l&&(A.adler=s.check=s.flags?f(s.check,z,l,b-l):N(s.check,z,l,b-l)),l=j,(s.flags?G:a(G))!==s.check){A.msg="incorrect data check",s.mode=J;break}G=0,V=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;V<32;){if(0===y)break A;y--,G+=u[m++]<<V,V+=8}if(G!==(4294967295&s.total)){A.msg="incorrect length check",s.mode=J;break}G=0,V=0}s.mode=29;case 29:F=v;break A;case J:F=d;break A;case 31:return Q;default:return M}return A.next_out=b,A.avail_out=j,A.next_in=m,A.avail_in=y,s.hold=G,s.bits=V,(s.wsize||l!==A.avail_out&&s.mode<J&&(s.mode<27||X!==K))&&O(A,A.output,A.next_out,l-A.avail_out)?(s.mode=31,Q):(P-=A.avail_in,l-=A.avail_out,A.total_in+=P,A.total_out+=l,s.total+=l,s.wrap&&l&&(A.adler=s.check=s.flags?f(s.check,z,l,A.next_out-l):N(s.check,z,l,A.next_out-l)),A.data_type=s.bits+(s.last?64:0)+(s.mode===C?128:0)+(20===s.mode||15===s.mode?256:0),(0===P&&0===l||X===K)&&F===Y&&(F=w),F)},A.exports.inflateEnd=A=>{if(!A||!A.state)return M;let X=A.state;return X.window&&(X.window=null),A.state=null,Y},A.exports.inflateGetHeader=(A,X)=>{if(!A||!A.state)return M;const s=A.state;return 0===(2&s.wrap)?M:(s.head=X,X.done=!1,Y)},A.exports.inflateSetDictionary=(A,X)=>{const s=X.length;let f,E,g;return A&&A.state?(f=A.state,0!==f.wrap&&11!==f.mode?M:11===f.mode&&(E=1,E=N(E,X,s,0),E!==f.check)?d:(g=O(A,X,s,s),g?(f.mode=31,Q):(f.havedict=1,Y))):M},A.exports.inflateInfo="pako inflate (from Nodeca project)"},12088:A=>{"use strict";const X=15,s=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),N=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),f=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),E=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);A.exports=(A,g,K,r,i,Y,v,c)=>{const M=c.bits;let d,Q,w,R,C,J,a=0,u=0,z=0,m=0,b=0,y=0,j=0,G=0,V=0,D=0,O=null,P=0;const l=new Uint16Array(16),n=new Uint16Array(16);let U,t,e,T=null,I=0;for(a=0;a<=X;a++)l[a]=0;for(u=0;u<r;u++)l[g[K+u]]++;for(b=M,m=X;m>=1&&0===l[m];m--);if(b>m&&(b=m),0===m)return i[Y++]=20971520,i[Y++]=20971520,c.bits=1,0;for(z=1;z<m&&0===l[z];z++);for(b<z&&(b=z),G=1,a=1;a<=X;a++)if(G<<=1,G-=l[a],G<0)return-1;if(G>0&&(0===A||1!==m))return-1;for(n[1]=0,a=1;a<X;a++)n[a+1]=n[a]+l[a];for(u=0;u<r;u++)0!==g[K+u]&&(v[n[g[K+u]]++]=u);if(0===A?(O=T=v,J=19):1===A?(O=s,P-=257,T=N,I-=257,J=256):(O=f,T=E,J=-1),D=0,u=0,a=z,C=Y,y=b,j=0,w=-1,V=1<<b,R=V-1,1===A&&V>852||2===A&&V>592)return 1;for(;;){U=a-j,v[u]<J?(t=0,e=v[u]):v[u]>J?(t=T[I+v[u]],e=O[P+v[u]]):(t=96,e=0),d=1<<a-j,Q=1<<y,z=Q;do{Q-=d,i[C+(D>>j)+Q]=U<<24|t<<16|e}while(0!==Q);for(d=1<<a-1;D&d;)d>>=1;if(0!==d?(D&=d-1,D+=d):D=0,u++,0===--l[a]){if(a===m)break;a=g[K+v[u]]}if(a>b&&(D&R)!==w){for(0===j&&(j=b),C+=z,y=a-j,G=1<<y;y+j<m&&(G-=l[y+j],!(G<=0));)y++,G<<=1;if(V+=1<<y,1===A&&V>852||2===A&&V>592)return 1;w=D&R,i[w]=b<<24|y<<16|C-Y}}return 0!==D&&(i[C+D]=a-j<<24|64<<16),c.bits=b,0}},12030:A=>{"use strict";A.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12005:A=>{"use strict";function X(A){let X=A.length;for(;--X>=0;)A[X]=0}const s=256,N=286,f=30,E=15,g=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),K=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),i=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Y=new Array(576);X(Y);const v=new Array(60);X(v);const c=new Array(512);X(c);const M=new Array(256);X(M);const d=new Array(29);X(d);const Q=new Array(f);function w(A,X,s,N,f){this.static_tree=A,this.extra_bits=X,this.extra_base=s,this.elems=N,this.max_length=f,this.has_stree=A&&A.length}let R,C,J;function a(A,X){this.dyn_tree=A,this.max_code=0,this.stat_desc=X}X(Q);const u=A=>A<256?c[A]:c[256+(A>>>7)],z=(A,X)=>{A.pending_buf[A.pending++]=255&X,A.pending_buf[A.pending++]=X>>>8&255},m=(A,X,s)=>{A.bi_valid>16-s?(A.bi_buf|=X<<A.bi_valid&65535,z(A,A.bi_buf),A.bi_buf=X>>16-A.bi_valid,A.bi_valid+=s-16):(A.bi_buf|=X<<A.bi_valid&65535,A.bi_valid+=s)},b=(A,X,s)=>{m(A,s[2*X],s[2*X+1])},y=(A,X)=>{let s=0;do{s|=1&A,A>>>=1,s<<=1}while(--X>0);return s>>>1},j=(A,X,s)=>{const N=new Array(16);let f,g,K=0;for(f=1;f<=E;f++)N[f]=K=K+s[f-1]<<1;for(g=0;g<=X;g++){let X=A[2*g+1];0!==X&&(A[2*g]=y(N[X]++,X))}},G=A=>{let X;for(X=0;X<N;X++)A.dyn_ltree[2*X]=0;for(X=0;X<f;X++)A.dyn_dtree[2*X]=0;for(X=0;X<19;X++)A.bl_tree[2*X]=0;A.dyn_ltree[512]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0},V=A=>{A.bi_valid>8?z(A,A.bi_buf):A.bi_valid>0&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0},D=(A,X,s,N)=>{const f=2*X,E=2*s;return A[f]<A[E]||A[f]===A[E]&&N[X]<=N[s]},O=(A,X,s)=>{const N=A.heap[s];let f=s<<1;for(;f<=A.heap_len&&(f<A.heap_len&&D(X,A.heap[f+1],A.heap[f],A.depth)&&f++,!D(X,N,A.heap[f],A.depth));)A.heap[s]=A.heap[f],s=f,f<<=1;A.heap[s]=N},P=(A,X,N)=>{let f,E,r,i,Y=0;if(0!==A.last_lit)do{f=A.pending_buf[A.d_buf+2*Y]<<8|A.pending_buf[A.d_buf+2*Y+1],E=A.pending_buf[A.l_buf+Y],Y++,0===f?b(A,E,X):(r=M[E],b(A,r+s+1,X),i=g[r],0!==i&&(E-=d[r],m(A,E,i)),f--,r=u(f),b(A,r,N),i=K[r],0!==i&&(f-=Q[r],m(A,f,i)))}while(Y<A.last_lit);b(A,256,X)},l=(A,X)=>{const s=X.dyn_tree,N=X.stat_desc.static_tree,f=X.stat_desc.has_stree,g=X.stat_desc.elems;let K,r,i,Y=-1;for(A.heap_len=0,A.heap_max=573,K=0;K<g;K++)0!==s[2*K]?(A.heap[++A.heap_len]=Y=K,A.depth[K]=0):s[2*K+1]=0;for(;A.heap_len<2;)i=A.heap[++A.heap_len]=Y<2?++Y:0,s[2*i]=1,A.depth[i]=0,A.opt_len--,f&&(A.static_len-=N[2*i+1]);for(X.max_code=Y,K=A.heap_len>>1;K>=1;K--)O(A,s,K);i=g;do{K=A.heap[1],A.heap[1]=A.heap[A.heap_len--],O(A,s,1),r=A.heap[1],A.heap[--A.heap_max]=K,A.heap[--A.heap_max]=r,s[2*i]=s[2*K]+s[2*r],A.depth[i]=(A.depth[K]>=A.depth[r]?A.depth[K]:A.depth[r])+1,s[2*K+1]=s[2*r+1]=i,A.heap[1]=i++,O(A,s,1)}while(A.heap_len>=2);A.heap[--A.heap_max]=A.heap[1],((A,X)=>{const s=X.dyn_tree,N=X.max_code,f=X.stat_desc.static_tree,g=X.stat_desc.has_stree,K=X.stat_desc.extra_bits,r=X.stat_desc.extra_base,i=X.stat_desc.max_length;let Y,v,c,M,d,Q,w=0;for(M=0;M<=E;M++)A.bl_count[M]=0;for(s[2*A.heap[A.heap_max]+1]=0,Y=A.heap_max+1;Y<573;Y++)v=A.heap[Y],M=s[2*s[2*v+1]+1]+1,M>i&&(M=i,w++),s[2*v+1]=M,v>N||(A.bl_count[M]++,d=0,v>=r&&(d=K[v-r]),Q=s[2*v],A.opt_len+=Q*(M+d),g&&(A.static_len+=Q*(f[2*v+1]+d)));if(0!==w){do{for(M=i-1;0===A.bl_count[M];)M--;A.bl_count[M]--,A.bl_count[M+1]+=2,A.bl_count[i]--,w-=2}while(w>0);for(M=i;0!==M;M--)for(v=A.bl_count[M];0!==v;)c=A.heap[--Y],c>N||(s[2*c+1]!==M&&(A.opt_len+=(M-s[2*c+1])*s[2*c],s[2*c+1]=M),v--)}})(A,X),j(s,Y,A.bl_count)},n=(A,X,s)=>{let N,f,E=-1,g=X[1],K=0,r=7,i=4;for(0===g&&(r=138,i=3),X[2*(s+1)+1]=65535,N=0;N<=s;N++)f=g,g=X[2*(N+1)+1],++K<r&&f===g||(K<i?A.bl_tree[2*f]+=K:0!==f?(f!==E&&A.bl_tree[2*f]++,A.bl_tree[32]++):K<=10?A.bl_tree[34]++:A.bl_tree[36]++,K=0,E=f,0===g?(r=138,i=3):f===g?(r=6,i=3):(r=7,i=4))},U=(A,X,s)=>{let N,f,E=-1,g=X[1],K=0,r=7,i=4;for(0===g&&(r=138,i=3),N=0;N<=s;N++)if(f=g,g=X[2*(N+1)+1],!(++K<r&&f===g)){if(K<i)do{b(A,f,A.bl_tree)}while(0!==--K);else 0!==f?(f!==E&&(b(A,f,A.bl_tree),K--),b(A,16,A.bl_tree),m(A,K-3,2)):K<=10?(b(A,17,A.bl_tree),m(A,K-3,3)):(b(A,18,A.bl_tree),m(A,K-11,7));K=0,E=f,0===g?(r=138,i=3):f===g?(r=6,i=3):(r=7,i=4)}};let t=!1;const e=(A,X,s,N)=>{m(A,0+(N?1:0),3),((A,X,s,N)=>{V(A),N&&(z(A,s),z(A,~s)),A.pending_buf.set(A.window.subarray(X,X+s),A.pending),A.pending+=s})(A,X,s,!0)};A.exports._tr_init=A=>{t||((()=>{let A,X,s,i,a;const u=new Array(16);for(s=0,i=0;i<28;i++)for(d[i]=s,A=0;A<1<<g[i];A++)M[s++]=i;for(M[s-1]=i,a=0,i=0;i<16;i++)for(Q[i]=a,A=0;A<1<<K[i];A++)c[a++]=i;for(a>>=7;i<f;i++)for(Q[i]=a<<7,A=0;A<1<<K[i]-7;A++)c[256+a++]=i;for(X=0;X<=E;X++)u[X]=0;for(A=0;A<=143;)Y[2*A+1]=8,A++,u[8]++;for(;A<=255;)Y[2*A+1]=9,A++,u[9]++;for(;A<=279;)Y[2*A+1]=7,A++,u[7]++;for(;A<=287;)Y[2*A+1]=8,A++,u[8]++;for(j(Y,287,u),A=0;A<f;A++)v[2*A+1]=5,v[2*A]=y(A,5);R=new w(Y,g,257,N,E),C=new w(v,K,0,f,E),J=new w(new Array(0),r,0,19,7)})(),t=!0),A.l_desc=new a(A.dyn_ltree,R),A.d_desc=new a(A.dyn_dtree,C),A.bl_desc=new a(A.bl_tree,J),A.bi_buf=0,A.bi_valid=0,G(A)},A.exports._tr_stored_block=e,A.exports._tr_flush_block=(A,X,N,f)=>{let E,g,K=0;A.level>0?(2===A.strm.data_type&&(A.strm.data_type=(A=>{let X,N=4093624447;for(X=0;X<=31;X++,N>>>=1)if(1&N&&0!==A.dyn_ltree[2*X])return 0;if(0!==A.dyn_ltree[18]||0!==A.dyn_ltree[20]||0!==A.dyn_ltree[26])return 1;for(X=32;X<s;X++)if(0!==A.dyn_ltree[2*X])return 1;return 0})(A)),l(A,A.l_desc),l(A,A.d_desc),K=(A=>{let X;for(n(A,A.dyn_ltree,A.l_desc.max_code),n(A,A.dyn_dtree,A.d_desc.max_code),l(A,A.bl_desc),X=18;X>=3&&0===A.bl_tree[2*i[X]+1];X--);return A.opt_len+=3*(X+1)+5+5+4,X})(A),E=A.opt_len+3+7>>>3,g=A.static_len+3+7>>>3,g<=E&&(E=g)):E=g=N+5,N+4<=E&&-1!==X?e(A,X,N,f):4===A.strategy||g===E?(m(A,2+(f?1:0),3),P(A,Y,v)):(m(A,4+(f?1:0),3),((A,X,s,N)=>{let f;for(m(A,X-257,5),m(A,s-1,5),m(A,N-4,4),f=0;f<N;f++)m(A,A.bl_tree[2*i[f]+1],3);U(A,A.dyn_ltree,X-1),U(A,A.dyn_dtree,s-1)})(A,A.l_desc.max_code+1,A.d_desc.max_code+1,K+1),P(A,A.dyn_ltree,A.dyn_dtree)),G(A),f&&V(A)},A.exports._tr_tally=(A,X,N)=>(A.pending_buf[A.d_buf+2*A.last_lit]=X>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&X,A.pending_buf[A.l_buf+A.last_lit]=255&N,A.last_lit++,0===X?A.dyn_ltree[2*N]++:(A.matches++,X--,A.dyn_ltree[2*(M[N]+s+1)]++,A.dyn_dtree[2*u(X)]++),A.last_lit===A.lit_bufsize-1),A.exports._tr_align=A=>{m(A,2,3),b(A,256,Y),(A=>{16===A.bi_valid?(z(A,A.bi_buf),A.bi_buf=0,A.bi_valid=0):A.bi_valid>=8&&(A.pending_buf[A.pending++]=255&A.bi_buf,A.bi_buf>>=8,A.bi_valid-=8)})(A)}},12058:A=>{"use strict";A.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11941:A=>{function X(A,X,s){for(var N=A.length,f=-1/0,E=1/0,g=0;g<N;g++){var K=(s[0][g]-A[g])/X[g],r=(s[1][g]-A[g])/X[g];if(K>r){var i=K;K=r,r=i}if(r<f||K>E)return 1/0;K>f&&(f=K),r<E&&(E=r)}return f>E?1/0:f}A.exports=function(A,s,N,f){var E=X(s,N,f);if(E===1/0)A=null;else{A=A||[];for(var g=0;g<s.length;g++)A[g]=s[g]+N[g]*E}return A},A.exports.distance=X},12946:(A,X,s)=>{"use strict";s.d(X,{d:()=>g});var N=s(23);const f=N.useLayoutEffect;const E=function(A){var X=(0,N.useRef)(A);return f((function(){X.current=A})),X};var g=function(A){var X=E(A);(0,N.Nb)((function(){var A=function(A){var s;if(null!=X.current&&(s=X.current(A)),A.defaultPrevented&&(A.returnValue=""),"string"===typeof s)return A.returnValue=s,s};return window.addEventListener("beforeunload",A),function(){window.removeEventListener("beforeunload",A)}}),[])}},12898:(A,X,s)=>{"use strict";var N=s(12902),f=Array.prototype.concat,E=Array.prototype.slice,g=A.exports=function(A){for(var X=[],s=0,g=A.length;s<g;s++){var K=A[s];N(K)?X=f.call(X,E.call(K)):X.push(K)}return X};g.wrap=function(A){return function(){return A(g(arguments))}}},12902:A=>{A.exports=function(A){return!(!A||"string"===typeof A)&&(A instanceof Array||Array.isArray(A)||A.length>=0&&(A.splice instanceof Function||Object.getOwnPropertyDescriptor(A,A.length-1)&&"String"!==A.constructor.name))}},11958:(A,X,s)=>{var N=s(11960);function f(A){for(var X,s,f=0,E=A.length,g=0;g<A.length;){for(X=A[g],s=0;g<E&&A[g]===X;)++g,++s;f+=N.log2(s)/7|0,f+=N.log2(X>>>0)/7|0,f+=2}return f}X.size=f,X.encode=function(A,X){X||(X=new Uint8Array(f(A)));for(var s,N,E=0,g=X.length,K=0;K<A.length;){for(s=A[K],N=0;K<A.length&&A[K]===s;)++K,++N;for(;E<g&&N>=128;)X[E++]=128+(127&N),N>>>=7;if(E>=g)throw new Error("RLE buffer overflow");for(X[E++]=N,s>>>=0;E<g&&s>=128;)X[E++]=128+(127&s),s>>>=7;if(E>=g)throw new Error("RLE buffer overflow");X[E++]=s}return X},X.decode=function(A,X){for(var s,N,f,E,g=X.length,K=A.length,r=0,i=0;i<K;){for(s=0,N=0;i<K&&A[i]>=128;)s+=(127&A[i++])<<N,N+=7;if(s+=A[i++]<<N,i>=K)throw new Error("RLE buffer underrun");if(r+s>g)throw new Error("Chunk buffer overflow");for(f=0,N=0;i<K&&A[i]>=128;)f+=(127&A[i++])<<N,N+=7;if(i>=K)throw new Error("RLE buffer underrun");for(f+=A[i++]<<N,E=0;E<s;++E)X[r++]=f}return X}},11960:(A,X)=>{"use strict";function s(A){var X=32;return(A&=-A)&&X--,65535&A&&(X-=16),16711935&A&&(X-=8),252645135&A&&(X-=4),858993459&A&&(X-=2),1431655765&A&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(A){return(A>0)-(A<0)},X.abs=function(A){var X=A>>31;return(A^X)-X},X.min=function(A,X){return X^(A^X)&-(A<X)},X.max=function(A,X){return A^(A^X)&-(A<X)},X.isPow2=function(A){return!(A&A-1)&&!!A},X.log2=function(A){var X,s;return X=(A>65535)<<4,X|=s=((A>>>=X)>255)<<3,X|=s=((A>>>=s)>15)<<2,(X|=s=((A>>>=s)>3)<<1)|(A>>>=s)>>1},X.log10=function(A){return A>=1e9?9:A>=1e8?8:A>=1e7?7:A>=1e6?6:A>=1e5?5:A>=1e4?4:A>=1e3?3:A>=100?2:A>=10?1:0},X.popCount=function(A){return 16843009*((A=(858993459&(A-=A>>>1&1431655765))+(A>>>2&858993459))+(A>>>4)&252645135)>>>24},X.countTrailingZeros=s,X.nextPow2=function(A){return A+=0===A,--A,A|=A>>>1,A|=A>>>2,A|=A>>>4,A|=A>>>8,(A|=A>>>16)+1},X.prevPow2=function(A){return A|=A>>>1,A|=A>>>2,A|=A>>>4,A|=A>>>8,(A|=A>>>16)-(A>>>1)},X.parity=function(A){return A^=A>>>16,A^=A>>>8,A^=A>>>4,27030>>>(A&=15)&1};var N=new Array(256);!function(A){for(var X=0;X<256;++X){var s=X,N=X,f=7;for(s>>>=1;s;s>>>=1)N<<=1,N|=1&s,--f;A[X]=N<<f&255}}(N),X.reverse=function(A){return N[255&A]<<24|N[A>>>8&255]<<16|N[A>>>16&255]<<8|N[A>>>24&255]},X.interleave2=function(A,X){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A&=65535)|A<<8))|A<<4))|A<<2))|A<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(A,X){return(A=65535&((A=16711935&((A=252645135&((A=858993459&((A=A>>>X&1431655765)|A>>>1))|A>>>2))|A>>>4))|A>>>16))<<16>>16},X.interleave3=function(A,X,s){return A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2),(A|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(s=1227133513&((s=3272356035&((s=251719695&((s=4278190335&((s&=1023)|s<<16))|s<<8))|s<<4))|s<<2))<<2},X.deinterleave3=function(A,X){return(A=1023&((A=4278190335&((A=251719695&((A=3272356035&((A=A>>>X&1227133513)|A>>>2))|A>>>4))|A>>>8))|A>>>16))<<22>>22},X.nextCombination=function(A){var X=A|A-1;return X+1|(~X&-~X)-1>>>s(A)+1}},11990:A=>{"use strict";A.exports=function(A,X,s,N){var f=self||window;try{try{var E;try{E=new f.Blob([A])}catch(i){(E=new(f.BlobBuilder||f.WebKitBlobBuilder||f.MozBlobBuilder||f.MSBlobBuilder)).append(A),E=E.getBlob()}var g=f.URL||f.webkitURL,K=g.createObjectURL(E),r=new f[X](K,s);return g.revokeObjectURL(K),r}catch(i){return new f[X]("data:application/javascript,".concat(encodeURIComponent(A)),s)}}catch(i){if(!N)throw Error("Inline worker is not supported");return new f[X](N,s)}}},11917:(A,X,s)=>{"use strict";function N(A,X,s,N,f){var E={};return Object.keys(N).forEach((function(A){E[A]=N[A]})),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=s.slice().reverse().reduce((function(s,N){return N(A,X,s)||s}),E),f&&void 0!==E.initializer&&(E.value=E.initializer?E.initializer.call(f):void 0,E.initializer=void 0),void 0===E.initializer&&(Object.defineProperty(A,X,E),E=null),E}s.d(X,{c:()=>N})},11913:(A,X,s)=>{"use strict";function N(A,X,s,N){s&&Object.defineProperty(A,X,{enumerable:s.enumerable,configurable:s.configurable,writable:s.writable,value:s.initializer?s.initializer.call(N):void 0})}s.d(X,{d:()=>N})},12567:(A,X,s)=>{"use strict";s.d(X,{e:()=>J,i:()=>w,l:()=>R,m:()=>c,p:()=>Q,t:()=>d,w:()=>M});var N=s(678),f=s(709),E=s(696),g=s(616),K=s(12573),r=s(705),i=s(2257),Y=s(499),v=s(707);const c=Object.freeze(new N.d(0,0,0,0)),M=Object.freeze(N.k.Zero()),d=Object.freeze(N.i.Zero()),Q=Object.freeze(i.e.Zero()),w=Object.freeze(f.e.Black()),R=Object.freeze(new f.h(0,0,0,0)),C={key:0,repeatCount:0,loopMode:2};class J{static _PrepareAnimation(A,X,s,E,g,K,r,Y){let v;if(!isNaN(parseFloat(g))&&isFinite(g)?v=J.ANIMATIONTYPE_FLOAT:g instanceof N.d?v=J.ANIMATIONTYPE_QUATERNION:g instanceof N.k?v=J.ANIMATIONTYPE_VECTOR3:g instanceof N.i?v=J.ANIMATIONTYPE_VECTOR2:g instanceof f.e?v=J.ANIMATIONTYPE_COLOR3:g instanceof f.h?v=J.ANIMATIONTYPE_COLOR4:g instanceof i.e&&(v=J.ANIMATIONTYPE_SIZE),void 0==v)return null;const c=new J(A,X,s,v,r),M=[{frame:0,value:g},{frame:E,value:K}];return c.setKeys(M),void 0!==Y&&c.setEasingFunction(Y),c}static CreateAnimation(A,X,s,N){const f=new J(A+"Animation",A,s,X,J.ANIMATIONLOOPMODE_CONSTANT);return f.setEasingFunction(N),f}static CreateAndStartAnimation(A,X,s,N,f,E,g,K,r,i,Y){const v=J._PrepareAnimation(A,s,N,f,E,g,K,r);return v?(X.va&&(Y=X.va()),Y?Y.beginDirectAnimation(X,[v],0,f,v.loopMode!==J.ANIMATIONLOOPMODE_CONSTANT,1,i):null):null}static CreateAndStartHierarchyAnimation(A,X,s,N,f,E,g,K,r,i,Y){const v=J._PrepareAnimation(A,N,f,E,g,K,r,i);if(!v)return null;return X.va().beginDirectHierarchyAnimation(X,s,[v],0,E,1===v.loopMode,1,Y)}static CreateMergeAndStartAnimation(A,X,s,N,f,E,g,K,r,i){const Y=J._PrepareAnimation(A,s,N,f,E,g,K,r);return Y?(X.animations.push(Y),X.va().beginAnimation(X,0,f,1===Y.loopMode,1,i)):null}static MakeAnimationAdditive(A,X,s){let f;f="object"===typeof X?X:{referenceFrame:X??0,range:s,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let E=A;if(f.cloneOriginalAnimation&&(E=A.clone(),E.name=f.clonedAnimationName||E.name),!E._keys.length)return E;const g=f.referenceFrame&&f.referenceFrame>=0?f.referenceFrame:0;let K=0;const r=E._keys[0];let i=E._keys.length-1;const Y=E._keys[i],v={referenceValue:r.value,referencePosition:N.f.oi[0],referenceQuaternion:N.f.Quaternion[0],referenceScaling:N.f.oi[1],keyPosition:N.f.oi[2],keyQuaternion:N.f.Quaternion[1],keyScaling:N.f.oi[3]};let c=r.frame,M=Y.frame;if(f.range){const A=E.getRange(f.range);A&&(c=A.from,M=A.to)}else c=f.fromFrame??c,M=f.toFrame??M;if(c!==r.frame&&(K=E.createKeyForFrame(c)),M!==Y.frame&&(i=E.createKeyForFrame(M)),1===E._keys.length){const A=E._getKeyValue(E._keys[0]);v.referenceValue=A.clone?A.clone():A}else if(g<=r.frame){const A=E._getKeyValue(r.value);v.referenceValue=A.clone?A.clone():A}else if(g>=Y.frame){const A=E._getKeyValue(Y.value);v.referenceValue=A.clone?A.clone():A}else{C.key=0;const A=E._interpolate(g,C);v.referenceValue=A.clone?A.clone():A}E.dataType===J.ANIMATIONTYPE_QUATERNION?v.referenceValue.normalize().conjugateInPlace():E.dataType===J.ANIMATIONTYPE_MATRIX&&(v.referenceValue.decompose(v.referenceScaling,v.referenceQuaternion,v.referencePosition),v.referenceQuaternion.normalize().conjugateInPlace());let d=Number.MAX_VALUE;const Q=f.clipKeys?[]:null;for(let w=K;w<=i;w++){let A=E._keys[w];if((Q||f.cloneOriginalAnimation)&&(A={frame:A.frame,value:A.value.clone?A.value.clone():A.value,inTangent:A.inTangent,outTangent:A.outTangent,interpolation:A.interpolation,lockedTangent:A.lockedTangent},Q&&(d===Number.MAX_VALUE&&(d=A.frame),A.frame-=d,Q.push(A))),!w||E.dataType===J.ANIMATIONTYPE_FLOAT||A.value!==r.value)switch(E.dataType){case J.ANIMATIONTYPE_MATRIX:A.value.decompose(v.keyScaling,v.keyQuaternion,v.keyPosition),v.keyPosition.Ri(v.referencePosition),v.keyScaling.divideInPlace(v.referenceScaling),v.referenceQuaternion.multiplyToRef(v.keyQuaternion,v.keyQuaternion),N.c.ComposeToRef(v.keyScaling,v.keyQuaternion,v.keyPosition,A.value);break;case J.ANIMATIONTYPE_QUATERNION:v.referenceValue.multiplyToRef(A.value,A.value);break;case J.ANIMATIONTYPE_VECTOR2:case J.ANIMATIONTYPE_VECTOR3:case J.ANIMATIONTYPE_COLOR3:case J.ANIMATIONTYPE_COLOR4:A.value.subtractToRef(v.referenceValue,A.value);break;case J.ANIMATIONTYPE_SIZE:A.value.width-=v.referenceValue.width,A.value.height-=v.referenceValue.height;break;default:A.value-=v.referenceValue}}return Q&&E.setKeys(Q,!0),E}static TransitionTo(A,X,s,N,f,E,g){let K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(g<=0)return s[A]=X,K&&K(),null;const r=f*(g/1e3);E.setKeys([{frame:0,value:s[A].clone?s[A].clone():s[A]},{frame:r,value:X}]),s.animations||(s.animations=[]),s.animations.push(E);const i=N.beginAnimation(s,0,r,!1);return i.onAnimationEnd=K,i}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const A of this._runtimeAnimations)if(!A.isStopped())return!0;return!1}constructor(A,X,s,N,f,E){this.name=A,this.targetProperty=X,this.framePerSecond=s,this.dataType=N,this.loopMode=f,this.enableBlending=E,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=X.split("."),this.dataType=N,this.loopMode=void 0===f?J.ANIMATIONLOOPMODE_CYCLE:f,this.uniqueId=J._UniqueIdGenerator++}toString(A){let X="Name: "+this.name+", property: "+this.targetProperty;if(X+=", datatype: "+["Float","oi","Quaternion","Matrix","Ui","Vector2"][this.dataType],X+=", nKeys: "+(this._keys?this._keys.length:"none"),X+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),A){X+=", Ranges: {";let A=!0;for(const s in this._ranges)A&&(X+=", ",A=!1),X+=s;X+="}"}return X}addEvent(A){this._events.push(A),this._events.sort(((A,X)=>A.frame-X.frame))}removeEvents(A){for(let X=0;X<this._events.length;X++)this._events[X].frame===A&&(this._events.splice(X,1),X--)}getEvents(){return this._events}createRange(A,X,s){this._ranges[A]||(this._ranges[A]=new K.c(A,X,s))}deleteRange(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this._ranges[A];if(s){if(X){const A=s.from,X=s.to;for(let s=this._keys.length-1;s>=0;s--)this._keys[s].frame>=A&&this._keys[s].frame<=X&&this._keys.splice(s,1)}this._ranges[A]=null}}getRange(A){return this._ranges[A]}getKeys(){return this._keys}getHighestFrame(){let A=0;for(let X=0,s=this._keys.length;X<s;X++)A<this._keys[X].frame&&(A=this._keys[X].frame);return A}getEasingFunction(){return this._easingFunction}setEasingFunction(A){this._easingFunction=A}floatInterpolateFunction(A,X,s){return(0,E.l)(A,X,s)}floatInterpolateFunctionWithTangents(A,X,s,N,f){return(0,E.e)(A,X,s,N,f)}quaternionInterpolateFunction(A,X,s){return N.d.Slerp(A,X,s)}quaternionInterpolateFunctionWithTangents(A,X,s,f,E){return N.d.Hermite(A,X,s,f,E).normalize()}vector3InterpolateFunction(A,X,s){return N.k.Lerp(A,X,s)}vector3InterpolateFunctionWithTangents(A,X,s,f,E){return N.k.Hermite(A,X,s,f,E)}vector2InterpolateFunction(A,X,s){return N.i.Lerp(A,X,s)}vector2InterpolateFunctionWithTangents(A,X,s,f,E){return N.i.Hermite(A,X,s,f,E)}sizeInterpolateFunction(A,X,s){return i.e.Lerp(A,X,s)}color3InterpolateFunction(A,X,s){return f.e.Lerp(A,X,s)}color3InterpolateFunctionWithTangents(A,X,s,N,E){return f.e.Hermite(A,X,s,N,E)}color4InterpolateFunction(A,X,s){return f.h.Lerp(A,X,s)}color4InterpolateFunctionWithTangents(A,X,s,N,E){return f.h.Hermite(A,X,s,N,E)}_getKeyValue(A){return"function"===typeof A?A():A}evaluate(A){return C.key=0,this._interpolate(A,C)}_interpolate(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(X.loopMode===J.ANIMATIONLOOPMODE_CONSTANT&&X.repeatCount>0)return X.highLimitValue.clone?X.highLimitValue.clone():X.highLimitValue;const N=this._keys;let f;if(this._coreAnimation)f=this._coreAnimation._key;else{const E=N.length;for(f=X.key;f>=0&&A<N[f].frame;)--f;for(;f+1<=E-1&&A>=N[f+1].frame;)++f;if(X.key=f,f<0)return s?void 0:this._getKeyValue(N[0].value);if(f+1>E-1)return s?void 0:this._getKeyValue(N[E-1].value);this._key=f}const E=N[f],g=N[f+1];if(s&&(A===E.frame||A===g.frame))return;const K=this._getKeyValue(E.value),r=this._getKeyValue(g.value);if(1===E.interpolation)return g.frame>A?K:r;const i=void 0!==E.outTangent&&void 0!==g.inTangent,Y=g.frame-E.frame;let v=(A-E.frame)/Y;const C=E.easingFunction||this.getEasingFunction();switch(C&&(v=C.ease(v)),this.dataType){case J.ANIMATIONTYPE_FLOAT:{const A=i?this.floatInterpolateFunctionWithTangents(K,E.outTangent*Y,r,g.inTangent*Y,v):this.floatInterpolateFunction(K,r,v);switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return A;case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(X.offsetValue??0)*X.repeatCount+A}break}case J.ANIMATIONTYPE_QUATERNION:{const A=i?this.quaternionInterpolateFunctionWithTangents(K,E.outTangent.scale(Y),r,g.inTangent.scale(Y),v):this.quaternionInterpolateFunction(K,r,v);switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return A;case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.addInPlace((X.offsetValue||c).scale(X.repeatCount))}return A}case J.ANIMATIONTYPE_VECTOR3:{const A=i?this.vector3InterpolateFunctionWithTangents(K,E.outTangent.scale(Y),r,g.inTangent.scale(Y),v):this.vector3InterpolateFunction(K,r,v);switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return A;case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((X.offsetValue||M).scale(X.repeatCount))}break}case J.ANIMATIONTYPE_VECTOR2:{const A=i?this.vector2InterpolateFunctionWithTangents(K,E.outTangent.scale(Y),r,g.inTangent.scale(Y),v):this.vector2InterpolateFunction(K,r,v);switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return A;case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((X.offsetValue||d).scale(X.repeatCount))}break}case J.ANIMATIONTYPE_SIZE:switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(K,r,v);case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(K,r,v).add((X.offsetValue||Q).scale(X.repeatCount))}break;case J.ANIMATIONTYPE_COLOR3:{const A=i?this.color3InterpolateFunctionWithTangents(K,E.outTangent.scale(Y),r,g.inTangent.scale(Y),v):this.color3InterpolateFunction(K,r,v);switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return A;case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((X.offsetValue||w).scale(X.repeatCount))}break}case J.ANIMATIONTYPE_COLOR4:{const A=i?this.color4InterpolateFunctionWithTangents(K,E.outTangent.scale(Y),r,g.inTangent.scale(Y),v):this.color4InterpolateFunction(K,r,v);switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return A;case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((X.offsetValue||R).scale(X.repeatCount))}break}case J.ANIMATIONTYPE_MATRIX:switch(X.loopMode){case J.ANIMATIONLOOPMODE_CYCLE:case J.ANIMATIONLOOPMODE_CONSTANT:case J.ANIMATIONLOOPMODE_YOYO:return J.AllowMatricesInterpolation?this.matrixInterpolateFunction(K,r,v,X.workValue):K;case J.ANIMATIONLOOPMODE_RELATIVE:case J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K}}return 0}matrixInterpolateFunction(A,X,s,f){return J.AllowMatrixDecomposeForInterpolation?f?(N.c.DecomposeLerpToRef(A,X,s,f),f):N.c.DecomposeLerp(A,X,s):f?(N.c.LerpToRef(A,X,s,f),f):N.c.Lerp(A,X,s)}clone(){const A=new J(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(A.enableBlending=this.enableBlending,A.blendingSpeed=this.blendingSpeed,this._keys&&A.setKeys(this._keys),this._ranges){A._ranges={};for(const X in this._ranges){const s=this._ranges[X];s&&(A._ranges[X]=s.clone())}}return A}setKeys(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=X?A:A.slice(0)}createKeyForFrame(A){C.key=0;const X=this._interpolate(A,C,!0);if(!X)return this._keys[C.key].frame===A?C.key:C.key+1;const s={frame:A,value:X.clone?X.clone():X};return this._keys.splice(C.key+1,0,s),C.key+1}serialize(){const A={};A.name=this.name,A.property=this.targetProperty,A.framePerSecond=this.framePerSecond,A.dataType=this.dataType,A.loopBehavior=this.loopMode,A.enableBlending=this.enableBlending,A.blendingSpeed=this.blendingSpeed;const X=this.dataType;A.keys=[];const s=this.getKeys();for(let N=0;N<s.length;N++){const f=s[N],E={};switch(E.frame=f.frame,X){case J.ANIMATIONTYPE_FLOAT:E.values=[f.value],void 0!==f.inTangent&&E.values.push(f.inTangent),void 0!==f.outTangent&&(void 0===f.inTangent&&E.values.push(void 0),E.values.push(f.outTangent)),void 0!==f.interpolation&&(void 0===f.inTangent&&E.values.push(void 0),void 0===f.outTangent&&E.values.push(void 0),E.values.push(f.interpolation));break;case J.ANIMATIONTYPE_QUATERNION:case J.ANIMATIONTYPE_MATRIX:case J.ANIMATIONTYPE_VECTOR3:case J.ANIMATIONTYPE_COLOR3:case J.ANIMATIONTYPE_COLOR4:E.values=f.value.zi(),void 0!=f.inTangent&&E.values.push(f.inTangent.zi()),void 0!=f.outTangent&&(void 0===f.inTangent&&E.values.push(void 0),E.values.push(f.outTangent.zi())),void 0!==f.interpolation&&(void 0===f.inTangent&&E.values.push(void 0),void 0===f.outTangent&&E.values.push(void 0),E.values.push(f.interpolation))}A.keys.push(E)}A.ranges=[];for(const N in this._ranges){const X=this._ranges[N];if(!X)continue;const s={};s.name=N,s.from=X.from,s.to=X.to,A.ranges.push(s)}return A}static _UniversalLerp(A,X,s){const N=A.constructor;return N.Lerp?N.Lerp(A,X,s):N.Slerp?N.Slerp(A,X,s):A.toFixed?A*(1-s)+s*X:X}static Parse(A){const X=new J(A.name,A.property,A.framePerSecond,A.dataType,A.loopBehavior),s=A.dataType,E=[];let g,K;for(A.enableBlending&&(X.enableBlending=A.enableBlending),A.blendingSpeed&&(X.blendingSpeed=A.blendingSpeed),K=0;K<A.keys.length;K++){const X=A.keys[K];let r,i,Y;switch(s){case J.ANIMATIONTYPE_FLOAT:g=X.values[0],X.values.length>=2&&(r=X.values[1]),X.values.length>=3&&(i=X.values[2]),X.values.length>=4&&(Y=X.values[3]);break;case J.ANIMATIONTYPE_QUATERNION:if(g=N.d.mi(X.values),X.values.length>=8){const A=N.d.mi(X.values.slice(4,8));A.equals(N.d.Zero())||(r=A)}if(X.values.length>=12){const A=N.d.mi(X.values.slice(8,12));A.equals(N.d.Zero())||(i=A)}X.values.length>=13&&(Y=X.values[12]);break;case J.ANIMATIONTYPE_MATRIX:g=N.c.mi(X.values),X.values.length>=17&&(Y=X.values[16]);break;case J.ANIMATIONTYPE_COLOR3:g=f.e.mi(X.values),X.values[3]&&(r=f.e.mi(X.values[3])),X.values[4]&&(i=f.e.mi(X.values[4])),X.values[5]&&(Y=X.values[5]);break;case J.ANIMATIONTYPE_COLOR4:g=f.h.mi(X.values),X.values[4]&&(r=f.h.mi(X.values[4])),X.values[5]&&(i=f.h.mi(X.values[5])),X.values[6]&&(Y=f.h.mi(X.values[6]));break;case J.ANIMATIONTYPE_VECTOR3:default:g=N.k.mi(X.values),X.values[3]&&(r=N.k.mi(X.values[3])),X.values[4]&&(i=N.k.mi(X.values[4])),X.values[5]&&(Y=X.values[5])}const v={};v.frame=X.frame,v.value=g,void 0!=r&&(v.inTangent=r),void 0!=i&&(v.outTangent=i),void 0!=Y&&(v.interpolation=Y),E.push(v)}if(X.setKeys(E),A.ranges)for(K=0;K<A.ranges.length;K++)g=A.ranges[K],X.createRange(g.name,g.from,g.to);return X}static AppendSerializedAnimations(A,X){v.c.AppendSerializedAnimations(A,X)}static async ParseFromFileAsync(A,X){return await new Promise(((s,N)=>{const f=new Y.b;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){let X=JSON.parse(f.responseText);if(X.animations&&(X=X.animations),X.length){const A=[];for(const s of X)A.push(this.Parse(s));s(A)}else{const N=this.Parse(X);A&&(N.name=A),s(N)}}else N("Unable to load the animation")})),f.open("GET",X),f.send()}))}static async ParseFromSnippetAsync(A){return await new Promise(((X,s)=>{const N=new Y.b;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const s=JSON.parse(JSON.parse(N.responseText).jsonPayload);if(s.animations){const N=JSON.parse(s.animations),f=[];for(const X of N.animations){const s=this.Parse(X);s.snippetId=A,f.push(s)}X(f)}else{const N=JSON.parse(s.animation),f=this.Parse(N);f.snippetId=A,X(f)}}else s("Unable to load the snippet "+A)})),N.open("GET",this.SnippetUrl+"/"+A.replace(/#/g,"/")),N.send()}))}}J._UniqueIdGenerator=0,J.AllowMatricesInterpolation=!1,J.AllowMatrixDecomposeForInterpolation=!0,J.SnippetUrl="https://snippet.babylonjs.com",J.ANIMATIONTYPE_FLOAT=0,J.ANIMATIONTYPE_VECTOR3=1,J.ANIMATIONTYPE_QUATERNION=2,J.ANIMATIONTYPE_MATRIX=3,J.ANIMATIONTYPE_COLOR3=4,J.ANIMATIONTYPE_COLOR4=7,J.ANIMATIONTYPE_VECTOR2=5,J.ANIMATIONTYPE_SIZE=6,J.ANIMATIONLOOPMODE_RELATIVE=0,J.ANIMATIONLOOPMODE_CYCLE=1,J.ANIMATIONLOOPMODE_CONSTANT=2,J.ANIMATIONLOOPMODE_YOYO=4,J.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,J.CreateFromSnippetAsync=J.ParseFromSnippetAsync,(0,g.f)("BABYLON.Animation",J),r.c._AnimationRangeFactory=(A,X,s)=>new K.c(A,X,s)},12573:(A,X,s)=>{"use strict";s.d(X,{c:()=>N});class N{constructor(A,X,s){this.name=A,this.from=X,this.to=s}clone(){return new N(this.name,this.from,this.to)}}},12940:(A,X,s)=>{"use strict";s.d(X,{b:()=>g,e:()=>v,f:()=>K,j:()=>E,k:()=>r,m:()=>f,p:()=>i,q:()=>Y});var N=s(2249);class f{constructor(){this._easingMode=f.EASINGMODE_EASEIN}setEasingMode(A){const X=Math.min(Math.max(A,0),2);this._easingMode=X}getEasingMode(){return this._easingMode}easeInCore(A){throw new Error("You must implement this method")}ease(A){switch(this._easingMode){case f.EASINGMODE_EASEIN:return this.easeInCore(A);case f.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-A)}return A>=.5?.5*(1-this.easeInCore(2*(1-A)))+.5:.5*this.easeInCore(2*A)}}f.EASINGMODE_EASEIN=0,f.EASINGMODE_EASEOUT=1,f.EASINGMODE_EASEINOUT=2;class E extends f{easeInCore(A){return A=Math.max(0,Math.min(1,A)),1-Math.sqrt(1-A*A)}}class g extends f{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=A}easeInCore(A){const X=Math.max(0,this.amplitude);return Math.pow(A,3)-A*X*Math.sin(3.141592653589793*A)}}class K extends f{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=A,this.bounciness=X}easeInCore(A){const X=Math.max(0,this.bounces);let s=this.bounciness;s<=1&&(s=1.001);const N=Math.pow(s,X),f=1-s,E=(1-N)/f+.5*N,g=A*E,K=Math.log(-g*(1-s)+1)/Math.log(s),r=Math.floor(K),i=r+1,Y=(1-Math.pow(s,r))/(f*E),v=.5*(Y+(1-Math.pow(s,i))/(f*E)),c=A-v,M=v-Y;return-Math.pow(1/s,X-r)/(M*M)*(c-M)*(c+M)}}class r extends f{easeInCore(A){return A*A*A}}class i extends f{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=A,this.springiness=X}easeInCore(A){let X;const s=Math.max(0,this.oscillations),N=Math.max(0,this.springiness);return X=0==N?A:(Math.exp(N*A)-1)/(Math.exp(N)-1),X*Math.sin((6.283185307179586*s+1.5707963267948966)*A)}}class Y extends f{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=A}easeInCore(A){return this.exponent<=0?A:(Math.exp(this.exponent*A)-1)/(Math.exp(this.exponent)-1)}}class v extends f{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=A,this.y1=X,this.x2=s,this.y2=N}easeInCore(A){return N.c.Interpolate(A,this.x1,this.y1,this.x2,this.y2)}}},12563:(A,X,s)=>{"use strict";s.d(X,{b:()=>g});var N=s(678),f=s(687),E=s(705);class g extends E.c{get _matrix(){return this._compose(),this.aj}set _matrix(A){(A.updateFlag!==this.aj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.aj.p(A),this._markAsDirtyAndDecompose())}constructor(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(A,X.va(),!1),this.name=A,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=X,this.aj=(null===f||void 0===f?void 0:f.clone())??N.c.Identity(),this._restMatrix=E??this.aj.clone(),this._bindMatrix=g??this.aj.clone(),this._index=K,this._absoluteMatrix=new N.c,this._absoluteBindMatrix=new N.c,this._absoluteInverseBindMatrix=new N.c,this._finalMatrix=new N.c,X.bones.push(this),this.setParent(s,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(A){this.setParent(A)}setParent(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==A){if(this.parent){const A=this.parent.children.indexOf(this);-1!==A&&this.parent.children.splice(A,1)}this._parentNode=A,this.parent&&this.parent.children.push(this),X&&this._updateAbsoluteBindMatrices(),this.Oi()}}getLocalMatrix(){return this._compose(),this.aj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(A){this._restMatrix.p(A)}setRestPose(A){this.setRestMatrix(A)}getBindPose(){return this.getBindMatrix()}setBindMatrix(A){this.Yi(A)}setBindPose(A){this.setBindMatrix(A)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const A=N.f.oi[0],X=N.f.Quaternion[0],s=N.f.oi[1];this.getRestMatrix().decompose(A,X,s),this._linkedTransformNode.position.p(s),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??N.d.Identity(),this._linkedTransformNode.rotationQuaternion.p(X),this._linkedTransformNode.hi.p(A)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(A){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=A,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Kg}set position(A){this._decompose(),this.Kg.p(A),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(A){this.setRotation(A)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(A){this.setRotationQuaternion(A)}get hi(){return this.getScale()}set hi(A){this.setScale(A)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=N.k.Zero(),this._localRotation=N.d.Zero(),this.Kg=N.k.Zero()),this.aj.decompose(this._localScaling,this._localRotation,this.Kg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,N.c.ComposeToRef(this._localScaling,this._localRotation,this.Kg,this.aj)):this._needToCompose=!1)}Yi(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(A),X&&this._updateAbsoluteBindMatrices(),s?this._matrix=A:this.Oi()}_updateAbsoluteBindMatrices(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(A||(A=this._bindMatrix),this.parent?A.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(A),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),X)for(let s=0;s<this.children.length;s++)this.children[s]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Oi(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Oi(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Oi(),this._needToDecompose=!0}_updatePosition(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this.getLocalMatrix();if(0==X)f?(E.addAtIndex(12,A.x),E.addAtIndex(13,A.y),E.addAtIndex(14,A.z)):E.setTranslationFromFloats(A.x,A.y,A.z);else{let X=null;s&&(X=s.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=g._TmpMats[0],r=g._TmpVecs[0];this.parent?s&&X?(K.p(this.parent.getAbsoluteMatrix()),K.multiplyToRef(X,K)):K.p(this.parent.getAbsoluteMatrix()):N.c.IdentityToRef(K),f&&K.setTranslationFromFloats(0,0,0),K.invert(),N.k.TransformCoordinatesToRef(A,K,r),f?(E.addAtIndex(12,r.x),E.addAtIndex(13,r.y),E.addAtIndex(14,r.z)):E.setTranslationFromFloats(r.x,r.y,r.z)}this._markAsDirtyAndDecompose()}translate(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;this._updatePosition(A,X,s,!0)}setPosition(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;this._updatePosition(A,X,s,!1)}setAbsolutePosition(A,X){this.setPosition(A,1,X)}scale(A,X,s){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.getLocalMatrix(),K=g._TmpMats[0];N.c.ScalingToRef(A,X,s,K),K.multiplyToRef(E,E),K.invert();for(const N of this.children){const f=N.getLocalMatrix();f.multiplyToRef(K,f),f.multiplyAtIndex(12,A),f.multiplyAtIndex(13,X),f.multiplyAtIndex(14,s),N._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),f)for(const N of this.children)N.scale(A,X,s,f)}setScale(A){this._decompose(),this._localScaling.p(A),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(A){this._decompose(),A.p(this._localScaling)}setYawPitchRoll(A,X,s){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4?arguments[4]:void 0;if(0===f){const K=g._TmpQuat;return N.d.RotationYawPitchRollToRef(A,X,s,K),void this.setRotationQuaternion(K,f,E)}const K=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,E))return;const r=g._TmpMats[1];N.c.RotationYawPitchRollToRef(A,X,s,r),K.multiplyToRef(r,r),this._rotateWithMatrix(r,f,E)}rotate(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3?arguments[3]:void 0;const E=g._TmpMats[0];E.setTranslationFromFloats(0,0,0),N.c.RotationAxisToRef(A,X,E),this._rotateWithMatrix(E,s,f)}setAxisAngle(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3?arguments[3]:void 0;if(0===s){const E=g._TmpQuat;return N.d.RotationAxisToRef(A,X,E),void this.setRotationQuaternion(E,s,f)}const E=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,f))return;const K=g._TmpMats[1];N.c.RotationAxisToRef(A,X,K),E.multiplyToRef(K,K),this._rotateWithMatrix(K,s,f)}setRotation(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(A.y,A.x,A.z,X,s)}setRotationQuaternion(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(0===X)return this._decompose(),this._localRotation.p(A),void this._markAsDirtyAndCompose();const f=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(f,s))return;const E=g._TmpMats[1];N.c.FromQuaternionToRef(A,E),f.multiplyToRef(E,E),this._rotateWithMatrix(E,X,s)}setRotationMatrix(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(0===X){const f=g._TmpQuat;return N.d.FromRotationMatrixToRef(A,f),void this.setRotationQuaternion(f,X,s)}const f=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(f,s))return;const E=g._TmpMats[1];E.p(A),f.multiplyToRef(A,E),this._rotateWithMatrix(E,X,s)}_rotateWithMatrix(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;const N=this.getLocalMatrix(),f=N.m[12],E=N.m[13],K=N.m[14],r=this.getParent(),i=g._TmpMats[3],Y=g._TmpMats[4];r&&1==X?(s?(i.p(s.getWorldMatrix()),r.getAbsoluteMatrix().multiplyToRef(i,i)):i.p(r.getAbsoluteMatrix()),Y.p(i),Y.invert(),N.multiplyToRef(i,N),N.multiplyToRef(A,N),N.multiplyToRef(Y,N)):1==X&&s?(i.p(s.getWorldMatrix()),Y.p(i),Y.invert(),N.multiplyToRef(i,N),N.multiplyToRef(A,N),N.multiplyToRef(Y,N)):N.multiplyToRef(A,N),N.setTranslationFromFloats(f,E,K),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(A,X){const s=g._TmpMats[2];return A.p(this.getAbsoluteMatrix()),X?(A.multiplyToRef(X.getWorldMatrix(),A),N.c.ScalingToRef(X.hi.x,X.hi.y,X.hi.z,s)):N.c.IdentityToRef(s),A.invert(),!isNaN(A.m[0])&&(s.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyToRef(s,A),!0)}$e(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=N.k.Zero();return this.getPositionToRef(A,X,s),s}getPositionToRef(){let A=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const A=this.getLocalMatrix();X.x=A.m[12],X.y=A.m[13],X.z=A.m[14]}else{let s=null;A&&(s=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let N=g._TmpMats[0];A&&s?(N.p(this.getAbsoluteMatrix()),N.multiplyToRef(s,N)):N=this.getAbsoluteMatrix(),X.x=N.m[12],X.y=N.m[13],X.z=N.m[14]}}getAbsolutePosition(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=N.k.Zero();return this.getPositionToRef(1,A,X),X}getAbsolutePositionToRef(A,X){this.getPositionToRef(1,A,X)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.aj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.aj);const A=this._skeleton.getPoseMatrix();A&&this._absoluteMatrix.multiplyToRef(A,this._absoluteMatrix)}const A=this.children,X=A.length;for(let s=0;s<X;s++)A[s].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Pi(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=N.k.Zero();return this.getDirectionToRef(A,X,s),s}getDirectionToRef(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,f=null;X&&(f=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=g._TmpMats[0];E.p(this.getAbsoluteMatrix()),X&&f&&E.multiplyToRef(f,E),N.k.TransformNormalToRef(A,E,s),s.normalize()}getRotation(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=N.k.Zero();return this.getRotationToRef(A,X,s),s}getRotationToRef(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;const N=g._TmpQuat;this.getRotationQuaternionToRef(A,X,N),N.toEulerAnglesToRef(s)}getRotationQuaternion(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=N.d.Identity();return this.getRotationQuaternionToRef(A,X,s),s}getRotationQuaternionToRef(){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),X.p(this._localRotation);else{const s=g._TmpMats[0],N=this.getAbsoluteMatrix();A?N.multiplyToRef(A.getWorldMatrix(),s):s.p(N),s.multiplyAtIndex(0,this._scalingDeterminant),s.multiplyAtIndex(1,this._scalingDeterminant),s.multiplyAtIndex(2,this._scalingDeterminant),s.decompose(void 0,X,void 0)}}getRotationMatrix(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1?arguments[1]:void 0;const s=N.c.Identity();return this.getRotationMatrixToRef(A,X,s),s}getRotationMatrixToRef(){let A=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(X);else{const s=g._TmpMats[0],N=this.getAbsoluteMatrix();A?N.multiplyToRef(A.getWorldMatrix(),s):s.p(N),s.multiplyAtIndex(0,this._scalingDeterminant),s.multiplyAtIndex(1,this._scalingDeterminant),s.multiplyAtIndex(2,this._scalingDeterminant),s.getRotationMatrixToRef(X)}}getAbsolutePositionFromLocal(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=N.k.Zero();return this.getAbsolutePositionFromLocalToRef(A,X,s),s}getAbsolutePositionFromLocalToRef(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,f=null;X&&(f=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=g._TmpMats[0];E.p(this.getAbsoluteMatrix()),X&&f&&E.multiplyToRef(f,E),N.k.TransformCoordinatesToRef(A,E,s)}getLocalPositionFromAbsolute(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=N.k.Zero();return this.getLocalPositionFromAbsoluteToRef(A,X,s),s}getLocalPositionFromAbsoluteToRef(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0,f=null;X&&(f=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=g._TmpMats[0];E.p(this.getAbsoluteMatrix()),X&&f&&E.multiplyToRef(f,E),E.invert(),N.k.TransformCoordinatesToRef(A,E,s)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const A=this._skeleton.bones.indexOf(this);if(-1!==A&&this._skeleton.bones.splice(A,1),this._parentNode&&this._parentNode.children){const A=this._parentNode.children,X=A.indexOf(this);-1!==X&&A.splice(X,1)}super.dispose()}}g._TmpVecs=(0,f.c)(2,N.k.Zero),g._TmpQuat=N.d.Identity(),g._TmpMats=(0,f.c)(5,N.c.Identity)},12932:(A,X,s)=>{"use strict";s.d(X,{c:()=>l});var N=s(657),f=s(666),E=s(454),g=s(678),K=s(696),r=s(705),i=s(452),Y=s(2450),v=s(486),c=s(683);class M{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(A){this._zoomStopsAnimation=A}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(A){this._idleRotationSpeed=A}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(A){this._idleRotationWaitTime=A}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(A){this._idleRotationSpinupTime=A}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(A){this._attachedCamera=A;const X=this._attachedCamera.va();this._onPrePointerObservableObserver=X.onPrePointerObservable.add((A=>{A.type!==Y.b.POINTERDOWN?A.type===Y.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=A.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const A=v.e.Now;let X=0;null!=this._lastFrameTime&&(X=A-this._lastFrameTime),this._lastFrameTime=A,this._applyUserInteraction();const s=A-this._lastInteractionTime-this._idleRotationWaitTime,N=Math.max(Math.min(s/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*N,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(X/1e3))}))}detach(){if(!this._attachedCamera)return;const A=this._attachedCamera.va();this._onPrePointerObservableObserver&&A.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(A){this._lastInteractionTime=A??v.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<c.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let A=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(A=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?A:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=v.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var d=s(12940),Q=s(12567);class w{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(A){if(this._autoTransitionRange===A)return;this._autoTransitionRange=A;const X=this._attachedCamera;X&&(A?this._onMeshTargetChangedObserver=X.onMeshTargetChangedObservable.add((A=>{if(A&&(A.si(!0),A.getBoundingInfo)){const X=A.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*X,this.upperRadiusTransitionRange=.05*X}})):this._onMeshTargetChangedObserver&&X.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(A){this._attachedCamera=A,this._onAfterCheckInputsObserver=A.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(A){return!!this._attachedCamera&&(this._attachedCamera.radius===A&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(A){if(!this._attachedCamera)return;this._radiusBounceTransition||(w.EasingFunction.setEasingMode(w.EasingMode),this._radiusBounceTransition=Q.e.CreateAnimation("radius",Q.e.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const X=Q.e.TransitionTo("radius",this._attachedCamera.radius+A,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));X&&this._animatables.push(X)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}w.EasingFunction=new d.b(.3),w.EasingMode=d.m.EASINGMODE_EASEOUT;class R{constructor(){this.onTargetFramingAnimationEndObservable=new E.b,this._mode=R.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(A){this._mode=A}get mode(){return this._mode}set radiusScale(A){this._radiusScale=A}get radiusScale(){return this._radiusScale}set positionScale(A){this._positionScale=A}get positionScale(){return this._positionScale}set defaultElevation(A){this._defaultElevation=A}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(A){this._elevationReturnTime=A}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(A){this._elevationReturnWaitTime=A}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(A){this._zoomStopsAnimation=A}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(A){this._framingTime=A}get framingTime(){return this._framingTime}init(){}attach(A){this._attachedCamera=A;const X=this._attachedCamera.va();R.EasingFunction.setEasingMode(R.EasingMode),this._onPrePointerObservableObserver=X.onPrePointerObservable.add((A=>{A.type!==Y.b.POINTERDOWN?A.type===Y.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=A.onMeshTargetChangedObservable.add((A=>{A&&A.getBoundingInfo&&this.zoomOnMesh(A,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=A.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const A=this._attachedCamera.va();this._onPrePointerObservableObserver&&A.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A.si(!0);const N=A.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(N.minimumWorld,N.maximumWorld,X,s)}zoomOnMeshHierarchy(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A.si(!0);const N=A.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(N.min,N.max,X,s)}zoomOnMeshesHierarchy(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new g.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new g.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let E=0;E<A.length;E++){const X=A[E].getHierarchyBoundingVectors(!0);g.k.CheckExtends(X.min,N,f),g.k.CheckExtends(X.max,N,f)}this.zoomOnBoundingInfo(N,f,X,s)}zoomOnBoundingInfo(A,X){let s,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const E=A.y,K=E+(X.y-E)*this._positionScale,r=X.Pg(A).scale(.5);if(!isFinite(K))return!1;if(N)s=new g.k(0,K,0);else{const X=A.add(r);s=new g.k(X.x,K,X.z)}this._vectorTransition||(this._vectorTransition=Q.e.CreateAnimation("target",Q.e.ANIMATIONTYPE_VECTOR3,60,R.EasingFunction)),this._betaIsAnimating=!0;let i=Q.e.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);i&&this._animatables.push(i);let Y=0;if(this._mode===R.FitFrustumSidesMode){const s=this._calculateLowerRadiusFromModelBoundingSphere(A,X);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=r.length()+this._attachedCamera.ui),Y=s}else this._mode===R.IgnoreBoundsSizeMode&&(Y=this._calculateLowerRadiusFromModelBoundingSphere(A,X),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ui));if(this.autoCorrectCameraLimitsAndSensibility){const s=X.Pg(A).length();this._attachedCamera.panningSensibility=5e3/s,this._attachedCamera.wheelPrecision=100/Y}return this._radiusTransition||(this._radiusTransition=Q.e.CreateAnimation("radius",Q.e.ANIMATIONTYPE_FLOAT,60,R.EasingFunction)),i=Q.e.TransitionTo("radius",Y,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),f&&f(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),i&&this._animatables.push(i),!0}_calculateLowerRadiusFromModelBoundingSphere(A,X){const s=this._attachedCamera;if(!s)return 0;let N=s._calculateLowerRadiusFromModelBoundingSphere(A,X,this._radiusScale);return s.lowerRadiusLimit&&this._mode===R.IgnoreBoundsSizeMode&&(N=N<s.lowerRadiusLimit?s.lowerRadiusLimit:N),s.upperRadiusLimit&&(N=N>s.upperRadiusLimit?s.upperRadiusLimit:N),N}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const A=v.e.Now-this._lastInteractionTime,X=.5*Math.PI-this._defaultElevation,s=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>s&&A>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Q.e.CreateAnimation("beta",Q.e.ANIMATIONTYPE_FLOAT,60,R.EasingFunction));const A=Q.e.TransitionTo("beta",X,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));A&&this._animatables.push(A)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=v.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}R.EasingFunction=new d.q,R.EasingMode=d.m.EASINGMODE_EASEINOUT,R.IgnoreBoundsSizeMode=0,R.FitFrustumSidesMode=1;var C=s(653),J=s(12551),a=s(12557),u=s(456);class z{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(A){A=u.d.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),s=X.getInputElement();let N=0,f=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=E=>{var g,K;const r=E.event,i="touch"===r.pointerType;if(E.type!==Y.b.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const v=r.target;if(this._altKey=r.altKey,this._ctrlKey=r.ctrlKey,this._metaKey=r.metaKey,this._shiftKey=r.shiftKey,this._buttonsPressed=r.buttons,X.isPointerLock){const A=r.movementX,X=r.movementY;this.onTouch(null,A,X),this._pointA=null,this._pointB=null}else{if(E.type!==Y.b.POINTERDOWN&&E.type!==Y.b.POINTERDOUBLETAP&&i&&(null===(g=this._pointA)||void 0===g?void 0:g.pointerId)!==r.pointerId&&(null===(K=this._pointB)||void 0===K?void 0:K.pointerId)!==r.pointerId)return;if(E.type!==Y.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!i)if(E.type===Y.b.POINTERDOUBLETAP)this.onDoubleTap(r.pointerType);else if(E.type!==Y.b.POINTERUP||this._currentMousePointerIdDown!==r.pointerId&&!i){if(E.type===Y.b.POINTERMOVE)if(A||r.preventDefault(),this._pointA&&null===this._pointB){const A=r.clientX-this._pointA.x,X=r.clientY-this._pointA.y;this._pointA.x=r.clientX,this._pointA.y=r.clientY,this.onTouch(this._pointA,A,X)}else if(this._pointA&&this._pointB){const A=this._pointA.pointerId===r.pointerId?this._pointA:this._pointB;A.x=r.clientX,A.y=r.clientY;const X=this._pointA.x-this._pointB.x,s=this._pointA.y-this._pointB.y,g=X*X+s*s,K={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:r.pointerId,type:E.type};this.onMultiTouch(this._pointA,this._pointB,N,g,f,K),f=K,N=g}}else{try{null===v||void 0===v||v.releasePointerCapture(r.pointerId)}catch(c){}i||(this._pointB=null),X._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==r.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==r.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==N||f)&&(this.onMultiTouch(this._pointA,this._pointB,N,0,f,null),N=0,f=null),this._currentMousePointerIdDown=-1,this.onButtonUp(r),A||r.preventDefault()}else{try{null===v||void 0===v||v.setPointerCapture(r.pointerId)}catch(c){}if(null===this._pointA)this._pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType};else{if(null!==this._pointB)return;this._pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}}-1!==this._currentMousePointerIdDown||i||(this._currentMousePointerIdDown=r.pointerId),this.onButtonDown(r),A||(r.preventDefault(),s&&s.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Y.b.POINTERDOWN|Y.b.POINTERUP|Y.b.POINTERMOVE|Y.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,N=0,f=null,this.onLostFocus()},this._contextMenuBind=A=>this.onContextMenu(A),s&&s.addEventListener("contextmenu",this._contextMenuBind,!1);const E=this.camera.va().getEngine().getHostWindow();E&&u.d.RegisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}Ni(){if(this._onLostFocus){const A=this.camera.va().getEngine().getHostWindow();A&&u.d.UnregisterTopRootEvents(A,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const A=this.camera.va().getEngine().getInputElement();A&&A.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(A){}onTouch(A,X,s){}onMultiTouch(A,X,s,N,f,E){}onContextMenu(A){A.preventDefault()}onButtonDown(A){}onButtonUp(A){}onLostFocus(){}}(0,N.e)([(0,f.M)()],z.prototype,"buttons",void 0);class m extends z{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(A,X){if(0!==this.panningSensibility&&A&&X){const s=X.x-A.x,N=X.y-A.y;this.camera.inertialPanningX+=-s/this.panningSensibility,this.camera.inertialPanningY+=N/this.panningSensibility}}_computePinchZoom(A,X){const s=this.camera.radius||m.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=s*Math.sqrt(A)/Math.sqrt(X):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(X-A)*s*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(X-A)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(A,X,s){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-X/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility):(this.camera.inertialAlphaOffset-=X/this.angularSensibilityX,this.camera.inertialBetaOffset-=s/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(A,X,s,N,f,E){0===s&&null===f||0===N&&null===E||(this.multiTouchPanAndZoom?(this._computePinchZoom(s,N),this._computeMultiTouchPanning(f,E)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(N)-Math.sqrt(s))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(s,N),this._isPinching=!0):this._computeMultiTouchPanning(f,E)):this.multiTouchPanning?this._computeMultiTouchPanning(f,E):this.pinchZoom&&this._computePinchZoom(s,N))}onButtonDown(A){this._isPanClick=A.button===this.camera._panningMouseButton}onButtonUp(A){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}m.MinimumRadiusForPinch=.001,(0,N.e)([(0,f.M)()],m.prototype,"buttons",void 0),(0,N.e)([(0,f.M)()],m.prototype,"angularSensibilityX",void 0),(0,N.e)([(0,f.M)()],m.prototype,"angularSensibilityY",void 0),(0,N.e)([(0,f.M)()],m.prototype,"pinchPrecision",void 0),(0,N.e)([(0,f.M)()],m.prototype,"pinchDeltaPercentage",void 0),(0,N.e)([(0,f.M)()],m.prototype,"useNaturalPinchZoom",void 0),(0,N.e)([(0,f.M)()],m.prototype,"pinchZoom",void 0),(0,N.e)([(0,f.M)()],m.prototype,"panningSensibility",void 0),(0,N.e)([(0,f.M)()],m.prototype,"multiTouchPanning",void 0),(0,N.e)([(0,f.M)()],m.prototype,"multiTouchPanAndZoom",void 0),a.b.ArcRotateCameraPointersInput=m;var b=s(2456);class y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(A){A=u.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const s=X.event;if(!s.metaKey)if(X.type===b.c.KEYDOWN){if(this._ctrlPressed=s.ctrlKey,this._altPressed=s.altKey,-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysReset.indexOf(s.keyCode)){-1===this._keys.indexOf(s.keyCode)&&this._keys.push(s.keyCode),s.preventDefault&&(A||s.preventDefault())}}else if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysReset.indexOf(s.keyCode)){const X=this._keys.indexOf(s.keyCode);X>=0&&this._keys.splice(X,1),s.preventDefault&&(A||s.preventDefault())}})))}Ni(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const A=this.camera;for(let X=0;X<this._keys.length;X++){const s=this._keys[X];-1!==this.keysLeft.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?A.inertialPanningX-=1/this.panningSensibility:A.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?A.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?A.inertialRadiusOffset+=1/this.zoomingSensibility:A.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?A.inertialPanningX+=1/this.panningSensibility:A.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?A.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?A.inertialRadiusOffset-=1/this.zoomingSensibility:A.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(s)&&A.useInputToRestoreState&&A.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,N.e)([(0,f.M)()],y.prototype,"keysUp",void 0),(0,N.e)([(0,f.M)()],y.prototype,"keysDown",void 0),(0,N.e)([(0,f.M)()],y.prototype,"keysLeft",void 0),(0,N.e)([(0,f.M)()],y.prototype,"keysRight",void 0),(0,N.e)([(0,f.M)()],y.prototype,"keysReset",void 0),(0,N.e)([(0,f.M)()],y.prototype,"panningSensibility",void 0),(0,N.e)([(0,f.M)()],y.prototype,"zoomingSensibility",void 0),(0,N.e)([(0,f.M)()],y.prototype,"useAltToZoom",void 0),(0,N.e)([(0,f.M)()],y.prototype,"angularSpeed",void 0),a.b.ArcRotateCameraKeyboardMoveInput=y;var j=s(725),G=s(2462);class V{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new g.k(0,0,0),this._globalOffset=new g.k(0,0,0),this._inertialPanning=g.k.Zero()}_computeDeltaFromMouseWheelLegacyEvent(A,X){let s=0;const N=.01*A*this.wheelDeltaPercentage*X;return s=A>0?N/(1+this.wheelDeltaPercentage):N*(1+this.wheelDeltaPercentage),s}attachControl(A){A=u.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==Y.b.POINTERWHEEL)return;const s=X.event;let N=0;const f=s.deltaMode===G.e.DOM_DELTA_LINE?40:1,E=-s.deltaY*f;if(this.customComputeDeltaFromMouseWheel)N=this.customComputeDeltaFromMouseWheel(E,this,s);else if(this.wheelDeltaPercentage){if(N=this._computeDeltaFromMouseWheelLegacyEvent(E,this.camera.radius),N>0){let A=this.camera.radius,X=this.camera.inertialRadiusOffset+N;for(let s=0;s<20&&!(A<=X)&&!(Math.abs(X*this.camera.inertia)<.001);s++)A-=X,X*=this.camera.inertia;A=(0,K.c)(A,0,Number.MAX_VALUE),N=this._computeDeltaFromMouseWheelLegacyEvent(E,A)}}else N=E/(40*this.wheelPrecision);N&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(N)):this.camera.inertialRadiusOffset+=N),s.preventDefault&&(A||s.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,Y.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ni(0)}Ni(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const A=this.camera;0+A.inertialAlphaOffset+A.inertialBetaOffset+A.inertialRadiusOffset&&(this._updateHitPlane(),A.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(A.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const A=this.camera,X=A.target.Pg(A.position);this._hitPlane=j.e.FromPositionAndNormal(A.target,X)}_getPosition(){const A=this.camera,X=A.va(),s=X.createPickingRay(X.pointerX,X.pointerY,g.c.Identity(),A,!1);0===A.targetScreenOffset.x&&0===A.targetScreenOffset.y||(this._viewOffset.set(A.targetScreenOffset.x,A.targetScreenOffset.y,0),A.getViewMatrix().invertToRef(A._cameraTransformMatrix),this._globalOffset=g.k.TransformNormal(this._viewOffset,A._cameraTransformMatrix),s.origin.addInPlace(this._globalOffset));let N=0;return this._hitPlane&&(N=s.intersectsPlane(this._hitPlane)??0),s.origin.addInPlace(s.direction.scaleInPlace(N))}_zoomToMouse(A){const X=this.camera,s=1-X.inertia;if(X.lowerRadiusLimit){const N=X.lowerRadiusLimit??0;X.radius-(X.inertialRadiusOffset+A)/s<N&&(A=(X.radius-N)*s-X.inertialRadiusOffset)}if(X.upperRadiusLimit){const N=X.upperRadiusLimit??0;X.radius-(X.inertialRadiusOffset+A)/s>N&&(A=(X.radius-N)*s-X.inertialRadiusOffset)}const N=A/s/X.radius,f=this._getPosition(),E=g.f.oi[6];f.subtractToRef(X.target,E),E.scaleInPlace(N),E.scaleInPlace(s),this._inertialPanning.addInPlace(E),X.inertialRadiusOffset+=A}_zeroIfClose(A){Math.abs(A.x)<c.b&&(A.x=0),Math.abs(A.y)<c.b&&(A.y=0),Math.abs(A.z)<c.b&&(A.z=0)}}(0,N.e)([(0,f.M)()],V.prototype,"wheelPrecision",void 0),(0,N.e)([(0,f.M)()],V.prototype,"zoomToMouseLocation",void 0),(0,N.e)([(0,f.M)()],V.prototype,"wheelDeltaPercentage",void 0),a.b.ArcRotateCameraMouseWheelInput=V;class D extends a.e{constructor(A){super(A)}addMouseWheel(){return this.add(new V),this}addPointers(){return this.add(new m),this}addKeyboard(){return this.add(new y),this}}var O=s(616);function P(A,X){return isNaN(A)?X:A}r.c.AddNodeConstructor("ArcRotateCamera",((A,X)=>()=>new l(A,0,0,1,g.k.Zero(),X)));class l extends J.e{get target(){return this._target}set target(A){this.setTarget(A)}get targetHost(){return this._targetHost}set targetHost(A){A&&this.setTarget(A)}getTarget(){return this.target}get position(){return this._position}set position(A){this.setPosition(A)}set upVector(A){this._upToYMatrix||(this._yToUpMatrix=new g.c,this._upToYMatrix=new g.c,this._upVector=g.k.Zero()),A.normalize(),this._upVector.p(A),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){g.c.RotationAlignToRef(g.k.UpReadOnly,this._upVector,this._yToUpMatrix),g.c.RotationAlignToRef(this._upVector,g.k.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const A=this.inputs.attached.pointers;return A?A.angularSensibilityX:0}set angularSensibilityX(A){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityX=A)}get angularSensibilityY(){const A=this.inputs.attached.pointers;return A?A.angularSensibilityY:0}set angularSensibilityY(A){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityY=A)}get pinchPrecision(){const A=this.inputs.attached.pointers;return A?A.pinchPrecision:0}set pinchPrecision(A){const X=this.inputs.attached.pointers;X&&(X.pinchPrecision=A)}get pinchDeltaPercentage(){const A=this.inputs.attached.pointers;return A?A.pinchDeltaPercentage:0}set pinchDeltaPercentage(A){const X=this.inputs.attached.pointers;X&&(X.pinchDeltaPercentage=A)}get useNaturalPinchZoom(){const A=this.inputs.attached.pointers;return!!A&&A.useNaturalPinchZoom}set useNaturalPinchZoom(A){const X=this.inputs.attached.pointers;X&&(X.useNaturalPinchZoom=A)}get panningSensibility(){const A=this.inputs.attached.pointers;return A?A.panningSensibility:0}set panningSensibility(A){const X=this.inputs.attached.pointers;X&&(X.panningSensibility=A)}get keysUp(){const A=this.inputs.attached.keyboard;return A?A.keysUp:[]}set keysUp(A){const X=this.inputs.attached.keyboard;X&&(X.keysUp=A)}get keysDown(){const A=this.inputs.attached.keyboard;return A?A.keysDown:[]}set keysDown(A){const X=this.inputs.attached.keyboard;X&&(X.keysDown=A)}get keysLeft(){const A=this.inputs.attached.keyboard;return A?A.keysLeft:[]}set keysLeft(A){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=A)}get keysRight(){const A=this.inputs.attached.keyboard;return A?A.keysRight:[]}set keysRight(A){const X=this.inputs.attached.keyboard;X&&(X.keysRight=A)}get wheelPrecision(){const A=this.inputs.attached.mousewheel;return A?A.wheelPrecision:0}set wheelPrecision(A){const X=this.inputs.attached.mousewheel;X&&(X.wheelPrecision=A)}get zoomToMouseLocation(){const A=this.inputs.attached.mousewheel;return!!A&&A.zoomToMouseLocation}set zoomToMouseLocation(A){const X=this.inputs.attached.mousewheel;X&&(X.zoomToMouseLocation=A)}get wheelDeltaPercentage(){const A=this.inputs.attached.mousewheel;return A?A.wheelDeltaPercentage:0}set wheelDeltaPercentage(A){const X=this.inputs.attached.mousewheel;X&&(X.wheelDeltaPercentage=A)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(A){A!==this.useBouncingBehavior&&(A?(this._bouncingBehavior=new w,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(A){A!==this.useFramingBehavior&&(A?(this._framingBehavior=new R,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(A){A!==this.useAutoRotationBehavior&&(A?(this._autoRotationBehavior=new M,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(A,X,s,N,f,K){var r;let i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(A,g.k.Zero(),K,i),r=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=g.k.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=g.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new g.c,this.panningAxis=new g.k(1,1,0),this._transformedDirection=new g.k,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new E.b,this.checkCollisions=!1,this.collisionRadius=new g.k(.5,.5,.5),this._previousPosition=g.k.Zero(),this._collisionVelocity=g.k.Zero(),this._newPosition=g.k.Zero(),this._computationVector=g.k.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new g.k(NaN,NaN,NaN),this._goalTargetScreenOffset=new g.i(NaN,NaN),this._onCollisionPositionChange=function(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s?(r.setPosition(X),r.Th&&r.Th(s)):r._previousPosition.p(r._position);const N=Math.cos(r.alpha),f=Math.sin(r.alpha),E=Math.cos(r.beta);let g=Math.sin(r.beta);0===g&&(g=1e-4);const K=r._getTargetPosition();r._computationVector.gi(r.radius*N*g,r.radius*E,r.radius*f*g),K.addToRef(r._computationVector,r._newPosition),r._position.p(r._newPosition);let i=r.upVector;r.allowUpsideDown&&r.beta<0&&(i=i.clone(),i=i.negate()),r._computeViewMatrix(r._position,K,i),r._viewMatrix.addAtIndex(12,r.targetScreenOffset.x),r._viewMatrix.addAtIndex(13,r.targetScreenOffset.y),r._collisionTriggered=!1},this._target=g.k.Zero(),f&&this.setTarget(f),this.alpha=X,this.beta=s,this.radius=N,this.getViewMatrix(),this.inputs=new D(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new g.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=g.i.Zero()}_updateCache(A){A||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const A=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?A.addToRef(this._targetBoundingCenter,this._target):this._target.p(A)}const A=this._getLockedTargetPosition();return A||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>c.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,E=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=E?this._currentInterpolationFactor=E:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=P(A,this._goalAlpha),this._goalBeta=P(X,this._goalBeta),this._goalRadius=P(s,this._goalRadius),this._goalTarget.set(P(N.x,this._goalTarget.x),P(N.y,this._goalTarget.y),P(N.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(P(f.x,this._goalTargetScreenOffset.x),P(f.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,K.c)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,K.c)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,K.c)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,K.c)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(A,X){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const f=arguments;X=u.d.BackCompatCameraNoPreventDefault(f),this._useCtrlForPanning=s,this._panningMouseButton=N,"boolean"===typeof f[0]&&(f.length>1&&(this._useCtrlForPanning=f[1]),f.length>2&&(this._panningMouseButton=f[2])),this.inputs.attachElement(X),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ni(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let A=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){A=!0;const X=this.invertRotation?-1:1,s=this._calculateHandednessMultiplier();let N=this.inertialAlphaOffset*s;this.beta<0&&(N*=-1),this.alpha+=N*X,this.beta+=this.inertialBetaOffset*X,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<c.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<c.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*c.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){A=!0;const X=new g.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),X.multiplyInPlace(this.panningAxis),g.k.TransformNormalToRef(X,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const A=this.upVector,X=g.k.CrossToRef(this._transformedDirection,A,this._transformedDirection);g.k.CrossToRef(A,X,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);g.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const A=g.f.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(A),A.transposeToRef(A),g.k.TransformCoordinatesToRef(this._transformedDirection,A,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*c.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*c.b&&(this.inertialPanningY=0)}if(A)this.stopInterpolation();else if(this._isInterpolating){let A=!1;const X=this._scene.getEngine().getDeltaTime()/1e3,s=1-Math.pow(2,-X/this._currentInterpolationFactor),N=P(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const X=g.f.oi[0].set(P(this._goalTarget.x,this._target.x),P(this._goalTarget.y,this._target.y),P(this._goalTarget.z,this._target.z));g.k.LerpToRef(this.target,X,s,this._target),10*g.k.Distance(this.target,X)/N<c.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(X),this.setTarget(this.target,!1,!0,!0)):A=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const X=g.d.RotationAlphaBetaGammaToRef(P(this._goalAlpha,this.alpha),P(this._goalBeta,this.beta),0,g.f.Quaternion[0]),N=g.d.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,g.f.Quaternion[1]),f=g.d.SlerpToRef(N,X,s,g.f.Quaternion[2]);f.normalize();const E=f.toAlphaBetaGammaToRef(g.f.oi[0]);if(this.alpha=E.x,this.beta=E.y,f.isApprox(X,c.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const A=X.toAlphaBetaGammaToRef(g.f.oi[0]);this.alpha=A.x,this.beta=A.y}else A=!0}if(isNaN(this._goalRadius)||(this.radius+=(N-this.radius)*s,Math.abs(N/this.radius-1)<c.b?(this._goalRadius=NaN,this.radius=N):A=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const X=g.f.Vector2[0].set(P(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),P(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));g.i.LerpToRef(this.targetScreenOffset,X,s,this.targetScreenOffset),g.i.Distance(this.targetScreenOffset,X)<c.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(X)):A=!0}this._isInterpolating=A}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const A=this.alpha;var X,s;this.alpha=function(A){let X=Math.PI/2;return 0===A.x&&0===A.z||(X=Math.acos(A.x/Math.sqrt(Math.pow(A.x,2)+Math.pow(A.z,2)))),A.z<0&&(X=2*Math.PI-X),X}(this._computationVector),this.beta=(X=this._computationVector.y,s=this.radius,Math.acos(X/s));const N=Math.round((A-this.alpha)/(2*Math.PI));this.alpha+=2*N*Math.PI,this._checkLimits()}setPosition(A){this._position.equals(A)||(this._position.p(A),this.rebuildAnglesAndRadius())}setTarget(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(N=this.overrideCloneAlphaBetaRadius??N,A.si)X&&A.getBoundingInfo?this._targetBoundingCenter=A.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,A.si(),this._targetHost=A,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const X=A,N=this._getTargetPosition();if(N&&!s&&N.equals(X))return;this._targetHost=null,this._target=X,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}N||this.rebuildAnglesAndRadius()}_getViewMatrix(){const A=Math.cos(this.alpha),X=Math.sin(this.alpha),s=Math.cos(this.beta);let N=Math.sin(this.beta);0===N&&(N=1e-4),0===this.radius&&(this.radius=1e-4);const f=this._getTargetPosition();if(this._computationVector.gi(this.radius*A*N,this.radius*s,this.radius*X*N),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),f.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const A=this.va().collisionCoordinator;this._collider||(this._collider=A.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,A.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let A=this.upVector;this.allowUpsideDown&&N<0&&(A=A.negate()),this._computeViewMatrix(this._position,f,A),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(f),this._viewMatrix}zoomOn(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];A=A||this.va().meshes;const s=i.d.MinMax(A);let N=this._calculateLowerRadiusFromModelBoundingSphere(s.min,s.max);if(N=Math.max(Math.min(N,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=N*this.zoomOnFactor,this.mode===C.b.ORTHOGRAPHIC_CAMERA){const A=this.va().getEngine().getAspectRatio(this),X=N*this.zoomOnFactor/2;this.orthoLeft=-X*A,this.orthoRight=X*A,this.orthoBottom=-X,this.orthoTop=X}this.focusOn({min:s.min,max:s.max,distance:N},X)}focusOn(A){let X,s,N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===A.min){const N=A||this.va().meshes;X=i.d.MinMax(N),s=g.k.Distance(X.min,X.max)}else{X=A,s=A.distance}this._target=i.d.Center(X),N||(this.maxZ=2*s)}createRigCamera(A,X){let s=0;switch(this.cameraRigMode){case C.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.b.RIG_MODE_VR:s=this._cameraRigParams.stereoHalfAngle*(0===X?1:-1);break;case C.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:s=this._cameraRigParams.stereoHalfAngle*(0===X?-1:1)}const N=new l(A,this.alpha+s,this.beta,this.radius,this._target,this.va());return N._cameraRigParams={},N.isRigCamera=!0,N.rigParent=this,N.upVector=this.upVector,N.mode=this.mode,N.orthoLeft=this.orthoLeft,N.orthoRight=this.orthoRight,N.orthoBottom=this.orthoBottom,N.orthoTop=this.orthoTop,N}_updateRigCameras(){const A=this._rigCameras[0],X=this._rigCameras[1];switch(A.beta=X.beta=this.beta,this.cameraRigMode){case C.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.b.RIG_MODE_VR:A.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case C.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:A.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const N=g.k.Distance(A,X),f=this.va().getEngine().getAspectRatio(this),E=Math.tan(this.fov/2),K=E*f,r=.5*N*s,i=r*Math.sqrt(1+1/(K*K)),Y=r*Math.sqrt(1+1/(E*E));return Math.max(i,Y)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,N.e)([(0,f.M)()],l.prototype,"alpha",void 0),(0,N.e)([(0,f.M)()],l.prototype,"beta",void 0),(0,N.e)([(0,f.M)()],l.prototype,"radius",void 0),(0,N.e)([(0,f.M)()],l.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,N.e)([(0,f.K)("target")],l.prototype,"_target",void 0),(0,N.e)([(0,f.z)("targetHost")],l.prototype,"_targetHost",void 0),(0,N.e)([(0,f.M)()],l.prototype,"inertialAlphaOffset",void 0),(0,N.e)([(0,f.M)()],l.prototype,"inertialBetaOffset",void 0),(0,N.e)([(0,f.M)()],l.prototype,"inertialRadiusOffset",void 0),(0,N.e)([(0,f.M)()],l.prototype,"lowerAlphaLimit",void 0),(0,N.e)([(0,f.M)()],l.prototype,"upperAlphaLimit",void 0),(0,N.e)([(0,f.M)()],l.prototype,"lowerBetaLimit",void 0),(0,N.e)([(0,f.M)()],l.prototype,"upperBetaLimit",void 0),(0,N.e)([(0,f.M)()],l.prototype,"lowerRadiusLimit",void 0),(0,N.e)([(0,f.M)()],l.prototype,"upperRadiusLimit",void 0),(0,N.e)([(0,f.M)()],l.prototype,"lowerTargetYLimit",void 0),(0,N.e)([(0,f.M)()],l.prototype,"inertialPanningX",void 0),(0,N.e)([(0,f.M)()],l.prototype,"inertialPanningY",void 0),(0,N.e)([(0,f.M)()],l.prototype,"pinchToPanMaxDistance",void 0),(0,N.e)([(0,f.M)()],l.prototype,"panningDistanceLimit",void 0),(0,N.e)([(0,f.K)()],l.prototype,"panningOriginTarget",void 0),(0,N.e)([(0,f.M)()],l.prototype,"panningInertia",void 0),(0,N.e)([(0,f.M)()],l.prototype,"zoomToMouseLocation",null),(0,N.e)([(0,f.M)()],l.prototype,"zoomOnFactor",void 0),(0,N.e)([(0,f.J)()],l.prototype,"targetScreenOffset",void 0),(0,N.e)([(0,f.M)()],l.prototype,"allowUpsideDown",void 0),(0,N.e)([(0,f.M)()],l.prototype,"useInputToRestoreState",void 0),(0,N.e)([(0,f.M)()],l.prototype,"restoreStateInterpolationFactor",void 0),(0,O.f)("BABYLON.ArcRotateCamera",l)},12557:(A,X,s)=>{"use strict";s.d(X,{b:()=>g,e:()=>K});var N=s(470),f=s(707),E=s(653),g={};class K{constructor(A){this.attachedToElement=!1,this.attached={},this.camera=A,this.checkInputs=()=>{}}add(A){const X=A.getSimpleName();this.attached[X]?N.b.Warn("camera input of type "+X+" already exists on camera"):(this.attached[X]=A,A.camera=this.camera,A.checkInputs&&(this.checkInputs=this._addCheckInputs(A.checkInputs.bind(A))),this.attachedToElement&&A.attachControl(this.noPreventDefault))}remove(A){for(const X in this.attached){const s=this.attached[X];if(s===A)return s.Ni(),s.camera=null,delete this.attached[X],void this.rebuildInputCheck()}}removeByType(A){for(const X in this.attached){const s=this.attached[X];s.getClassName()===A&&(s.Ni(),s.camera=null,delete this.attached[X],this.rebuildInputCheck())}}_addCheckInputs(A){const X=this.checkInputs;return()=>{X(),A()}}attachInput(A){this.attachedToElement&&A.attachControl(this.noPreventDefault)}attachElement(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){A=!E.b.ForceAttachControlToAlwaysPreventDefault&&A,this.attachedToElement=!0,this.noPreventDefault=A;for(const X in this.attached)this.attached[X].attachControl(A)}}detachElement(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const X in this.attached)this.attached[X].Ni(),A&&(this.attached[X].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const A in this.attached){const X=this.attached[A];X.checkInputs&&(this.checkInputs=this._addCheckInputs(X.checkInputs.bind(X)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(A){const X={};for(const s in this.attached){const A=this.attached[s],N=f.c.Serialize(A);X[A.getClassName()]=N}A.inputsmgr=X}parse(A){const X=A.inputsmgr;if(X){this.clear();for(const A in X){const s=g[A];if(s){const N=X[A],E=f.c.Parse((()=>new s),N,null);this.add(E)}}}else for(const s in this.attached){const X=g[this.attached[s].getClassName()];if(X){const N=f.c.Parse((()=>new X),A,null);this.remove(this.attached[s]),this.add(N)}}}}},12545:(A,X,s)=>{"use strict";s.d(X,{b:()=>z});var N=s(657),f=s(666),E=s(678),g=s(12551),K=s(12557),r=s(2456),i=s(456);class Y{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(A){A=i.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const s=X.event;if(!s.metaKey)if(X.type===r.c.KEYDOWN){if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysUpward.indexOf(s.keyCode)||-1!==this.keysDownward.indexOf(s.keyCode)||-1!==this.keysRotateLeft.indexOf(s.keyCode)||-1!==this.keysRotateRight.indexOf(s.keyCode)||-1!==this.keysRotateUp.indexOf(s.keyCode)||-1!==this.keysRotateDown.indexOf(s.keyCode)){-1===this._keys.indexOf(s.keyCode)&&this._keys.push(s.keyCode),A||s.preventDefault()}}else if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysUpward.indexOf(s.keyCode)||-1!==this.keysDownward.indexOf(s.keyCode)||-1!==this.keysRotateLeft.indexOf(s.keyCode)||-1!==this.keysRotateRight.indexOf(s.keyCode)||-1!==this.keysRotateUp.indexOf(s.keyCode)||-1!==this.keysRotateDown.indexOf(s.keyCode)){const X=this._keys.indexOf(s.keyCode);X>=0&&this._keys.splice(X,1),A||s.preventDefault()}})))}Ni(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const A=this.camera;for(let X=0;X<this._keys.length;X++){const s=this._keys[X],N=A._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(s)?A._localDirection.gi(-N,0,0):-1!==this.keysUp.indexOf(s)?A._localDirection.gi(0,0,N):-1!==this.keysRight.indexOf(s)?A._localDirection.gi(N,0,0):-1!==this.keysDown.indexOf(s)?A._localDirection.gi(0,0,-N):-1!==this.keysUpward.indexOf(s)?A._localDirection.gi(0,N,0):-1!==this.keysDownward.indexOf(s)?A._localDirection.gi(0,-N,0):-1!==this.keysRotateLeft.indexOf(s)?(A._localDirection.gi(0,0,0),A.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(s)?(A._localDirection.gi(0,0,0),A.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(s)?(A._localDirection.gi(0,0,0),A.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(s)&&(A._localDirection.gi(0,0,0),A.cameraRotation.x+=this._getLocalRotation()),A.va().useRightHandedSystem&&(A._localDirection.z*=-1),A.getViewMatrix().invertToRef(A._cameraTransformMatrix),E.k.TransformNormalToRef(A._localDirection,A._cameraTransformMatrix,A._transformedDirection),A.cameraDirection.addInPlace(A._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const A=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*A}}(0,N.e)([(0,f.M)()],Y.prototype,"keysUp",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysUpward",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysDown",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysDownward",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysLeft",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysRight",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"rotationSpeed",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysRotateLeft",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysRotateRight",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysRotateUp",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"keysRotateDown",void 0),K.b.FreeCameraKeyboardMoveInput=Y;var v=s(454),c=s(2450);class M{constructor(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=A,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new v.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(A){A=i.d.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),s=X.getInputElement();this._pointerInput||(this._pointerInput=N=>{const f=N.event,E="touch"===f.pointerType;if(!this.touchEnabled&&E)return;if(N.type!==c.b.POINTERMOVE&&-1===this.buttons.indexOf(f.button))return;const g=f.target;if(N.type===c.b.POINTERDOWN){if(E&&-1!==this._activePointerId||!E&&-1!==this._currentActiveButton)return;this._activePointerId=f.pointerId;try{null===g||void 0===g||g.setPointerCapture(f.pointerId)}catch(K){}-1===this._currentActiveButton&&(this._currentActiveButton=f.button),this._previousPosition={x:f.clientX,y:f.clientY},A||(f.preventDefault(),s&&s.focus()),X.isPointerLock&&this._onMouseMove&&this._onMouseMove(N.event)}else if(N.type===c.b.POINTERUP){if(E&&this._activePointerId!==f.pointerId||!E&&this._currentActiveButton!==f.button)return;try{null===g||void 0===g||g.releasePointerCapture(f.pointerId)}catch(K){}this._currentActiveButton=-1,this._previousPosition=null,A||f.preventDefault(),this._activePointerId=-1}else if(N.type===c.b.POINTERMOVE&&(this._activePointerId===f.pointerId||!E))if(X.isPointerLock&&this._onMouseMove)this._onMouseMove(N.event);else if(this._previousPosition){const X=this.camera._calculateHandednessMultiplier(),s=(f.clientX-this._previousPosition.x)*X,N=f.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=s/this.angularSensibility,this.camera.cameraRotation.x+=N/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:s,offsetY:N}),this._previousPosition={x:f.clientX,y:f.clientY},A||f.preventDefault()}}),this._onMouseMove=s=>{if(!X.isPointerLock)return;const N=this.camera._calculateHandednessMultiplier(),f=s.movementX*N;this.camera.cameraRotation.y+=f/this.angularSensibility;const E=s.movementY;this.camera.cameraRotation.x+=E/this.angularSensibility,this._previousPosition=null,A||s.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,c.b.POINTERDOWN|c.b.POINTERUP|c.b.POINTERMOVE),s&&(this._contextMenuBind=A=>this.onContextMenu(A),s.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(A){A.preventDefault()}Ni(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const A=this.camera.getEngine().getInputElement();A&&A.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,N.e)([(0,f.M)()],M.prototype,"buttons",void 0),(0,N.e)([(0,f.M)()],M.prototype,"angularSensibility",void 0),K.b.FreeCameraMouseInput=M;var d,Q=s(2462);class w{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new v.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(A){A=i.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==c.b.POINTERWHEEL)return;const s=X.event,N=s.deltaMode===Q.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*N*s.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*N*s.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*N*s.deltaZ/this._normalize,s.preventDefault&&(A||s.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,c.b.POINTERWHEEL)}Ni(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,N.e)([(0,f.M)()],w.prototype,"wheelPrecisionX",void 0),(0,N.e)([(0,f.M)()],w.prototype,"wheelPrecisionY",void 0),(0,N.e)([(0,f.M)()],w.prototype,"wheelPrecisionZ",void 0),function(A){A[A.MoveRelative=0]="MoveRelative",A[A.RotateRelative=1]="RotateRelative",A[A.MoveScene=2]="MoveScene"}(d||(d={}));class R extends w{constructor(){super(...arguments),this._moveRelative=E.k.Zero(),this._rotateRelative=E.k.Zero(),this._moveScene=E.k.Zero(),this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(A){null===A&&this._wheelXAction!==d.MoveRelative||(this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=A)}get wheelXMoveRelative(){return this._wheelXAction!==d.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(A){null===A&&this._wheelYAction!==d.MoveRelative||(this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=A)}get wheelYMoveRelative(){return this._wheelYAction!==d.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(A){null===A&&this._wheelZAction!==d.MoveRelative||(this._wheelZAction=d.MoveRelative,this._wheelZActionCoordinate=A)}get wheelZMoveRelative(){return this._wheelZAction!==d.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(A){null===A&&this._wheelXAction!==d.RotateRelative||(this._wheelXAction=d.RotateRelative,this._wheelXActionCoordinate=A)}get wheelXRotateRelative(){return this._wheelXAction!==d.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(A){null===A&&this._wheelYAction!==d.RotateRelative||(this._wheelYAction=d.RotateRelative,this._wheelYActionCoordinate=A)}get wheelYRotateRelative(){return this._wheelYAction!==d.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(A){null===A&&this._wheelZAction!==d.RotateRelative||(this._wheelZAction=d.RotateRelative,this._wheelZActionCoordinate=A)}get wheelZRotateRelative(){return this._wheelZAction!==d.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(A){null===A&&this._wheelXAction!==d.MoveScene||(this._wheelXAction=d.MoveScene,this._wheelXActionCoordinate=A)}get wheelXMoveScene(){return this._wheelXAction!==d.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(A){null===A&&this._wheelYAction!==d.MoveScene||(this._wheelYAction=d.MoveScene,this._wheelYActionCoordinate=A)}get wheelYMoveScene(){return this._wheelYAction!==d.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(A){null===A&&this._wheelZAction!==d.MoveScene||(this._wheelZAction=d.MoveScene,this._wheelZActionCoordinate=A)}get wheelZMoveScene(){return this._wheelZAction!==d.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ni(0),this._rotateRelative.ni(0),this._moveScene.ni(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const A=E.c.Zero();this.camera.getViewMatrix().invertToRef(A);const X=E.k.Zero();E.k.TransformNormalToRef(this._moveRelative,A,X),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(X),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(A,X,s){if(0===A)return;if(null===X||null===s)return;let N=null;switch(X){case d.MoveRelative:N=this._moveRelative;break;case d.RotateRelative:N=this._rotateRelative;break;case d.MoveScene:N=this._moveScene}switch(s){case 0:N.set(A,0,0);break;case 1:N.set(0,A,0);break;case 2:N.set(0,0,A)}}}(0,N.e)([(0,f.M)()],R.prototype,"wheelXMoveRelative",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelYMoveRelative",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelZMoveRelative",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelXRotateRelative",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelYRotateRelative",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelZRotateRelative",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelXMoveScene",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelYMoveScene",null),(0,N.e)([(0,f.M)()],R.prototype,"wheelZMoveScene",null),K.b.FreeCameraMouseWheelInput=R;class C{constructor(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=A,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=i.d.IsSafari()}attachControl(A){A=i.d.BackCompatCameraNoPreventDefault(arguments);let X=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=s=>{const N=s.event,f="mouse"===N.pointerType||this._isSafari&&"undefined"===typeof N.pointerType;if(this.allowMouse||!f)if(s.type===c.b.POINTERDOWN){if(A||N.preventDefault(),this._pointerPressed.push(N.pointerId),1!==this._pointerPressed.length)return;X={x:N.clientX,y:N.clientY}}else if(s.type===c.b.POINTERUP){A||N.preventDefault();const s=this._pointerPressed.indexOf(N.pointerId);if(-1===s)return;if(this._pointerPressed.splice(s,1),0!=s)return;X=null,this._offsetX=null,this._offsetY=null}else if(s.type===c.b.POINTERMOVE){if(A||N.preventDefault(),!X)return;if(0!=this._pointerPressed.indexOf(N.pointerId))return;this._offsetX=N.clientX-X.x,this._offsetY=-(N.clientY-X.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,c.b.POINTERDOWN|c.b.POINTERUP|c.b.POINTERMOVE),this._onLostFocus){const A=this.camera.getEngine().getInputElement();A&&A.addEventListener("blur",this._onLostFocus)}}Ni(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const A=this.camera.getEngine().getInputElement();A&&A.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const A=this.camera,X=A._calculateHandednessMultiplier();A.cameraRotation.y=X*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)A.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const X=A._computeLocalCameraSpeed(),s=new E.k(0,0,0!==this.touchMoveSensibility?X*this._offsetY/this.touchMoveSensibility:0);E.c.RotationYawPitchRollToRef(A.rotation.y,A.rotation.x,0,A._cameraRotationMatrix),A.cameraDirection.addInPlace(E.k.TransformCoordinates(s,A._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,N.e)([(0,f.M)()],C.prototype,"touchAngularSensibility",void 0),(0,N.e)([(0,f.M)()],C.prototype,"touchMoveSensibility",void 0),K.b.FreeCameraTouchInput=C;class J extends K.e{constructor(A){super(A),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new Y),this}addMouse(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new M(A),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new R,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new C),this}clear(){super.clear(),this._mouseInput=null}}var a=s(616),u=s(547);class z extends g.e{get angularSensibility(){const A=this.inputs.attached.mouse;return A?A.angularSensibility:0}set angularSensibility(A){const X=this.inputs.attached.mouse;X&&(X.angularSensibility=A)}get keysUp(){const A=this.inputs.attached.keyboard;return A?A.keysUp:[]}set keysUp(A){const X=this.inputs.attached.keyboard;X&&(X.keysUp=A)}get keysUpward(){const A=this.inputs.attached.keyboard;return A?A.keysUpward:[]}set keysUpward(A){const X=this.inputs.attached.keyboard;X&&(X.keysUpward=A)}get keysDown(){const A=this.inputs.attached.keyboard;return A?A.keysDown:[]}set keysDown(A){const X=this.inputs.attached.keyboard;X&&(X.keysDown=A)}get keysDownward(){const A=this.inputs.attached.keyboard;return A?A.keysDownward:[]}set keysDownward(A){const X=this.inputs.attached.keyboard;X&&(X.keysDownward=A)}get keysLeft(){const A=this.inputs.attached.keyboard;return A?A.keysLeft:[]}set keysLeft(A){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=A)}get keysRight(){const A=this.inputs.attached.keyboard;return A?A.keysRight:[]}set keysRight(A){const X=this.inputs.attached.keyboard;X&&(X.keysRight=A)}get keysRotateLeft(){const A=this.inputs.attached.keyboard;return A?A.keysRotateLeft:[]}set keysRotateLeft(A){const X=this.inputs.attached.keyboard;X&&(X.keysRotateLeft=A)}get keysRotateRight(){const A=this.inputs.attached.keyboard;return A?A.keysRotateRight:[]}set keysRotateRight(A){const X=this.inputs.attached.keyboard;X&&(X.keysRotateRight=A)}get keysRotateUp(){const A=this.inputs.attached.keyboard;return A?A.keysRotateUp:[]}set keysRotateUp(A){const X=this.inputs.attached.keyboard;X&&(X.keysRotateUp=A)}get keysRotateDown(){const A=this.inputs.attached.keyboard;return A?A.keysRotateDown:[]}set keysRotateDown(A){const X=this.inputs.attached.keyboard;X&&(X.keysRotateDown=A)}constructor(A,X,s){var N;super(A,X,s,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),N=this,this.ellipsoid=new E.k(.5,1,.5),this.ellipsoidOffset=new E.k(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=E.k.Zero(),this._diffPosition=E.k.Zero(),this._newPosition=E.k.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N._newPosition.p(X),N._newPosition.subtractToRef(N._oldPosition,N._diffPosition),N._diffPosition.length()>u.d.CollisionsEpsilon&&(N.position.addToRef(N._diffPosition,N._deferredPositionUpdate),N._deferOnly?N._deferredUpdated=!0:N.position.p(N._deferredPositionUpdate),N.Th&&s&&N.Th(s))},this.inputs=new J(this),this.inputs.addKeyboard().addMouse()}attachControl(A,X){X=i.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(X)}Ni(){this.inputs.detachElement(),this.cameraDirection=new E.k(0,0,0),this.cameraRotation=new E.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(A){this._collisionMask=isNaN(A)?-1:A}_collideWithWorld(A){let X;X=this.parent?E.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,X.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const s=this.va().collisionCoordinator;this._collider||(this._collider=s.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let N=A;this.applyGravity&&(N=A.add(this.va().gravity)),s.getNewPosition(this._oldPosition,N,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=E.k.Zero(),this._transformedDirection=E.k.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(A){this._needMoveForGravity=A}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"eb"}}(0,N.e)([(0,f.K)()],z.prototype,"ellipsoid",void 0),(0,N.e)([(0,f.K)()],z.prototype,"ellipsoidOffset",void 0),(0,N.e)([(0,f.M)()],z.prototype,"checkCollisions",void 0),(0,N.e)([(0,f.M)()],z.prototype,"applyGravity",void 0),(0,a.f)("BABYLON.FreeCamera",z)},12551:(A,X,s)=>{"use strict";s.d(X,{e:()=>v});var N=s(657),f=s(666),E=s(653),g=s(678),K=s(683),r=s(824);s(705).c.AddNodeConstructor("TargetCamera",((A,X)=>()=>new v(A,g.k.Zero(),X)));const i=g.c.Zero(),Y=g.d.Identity();class v extends E.b{constructor(A,X,s){super(A,X,s,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new g.k(0,0,0),this.cameraRotation=new g.i(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=g.k.Zero(),this._initialFocalDistance=1,this._viewMatrix=g.c.Zero(),this._cameraTransformMatrix=g.c.Zero(),this._cameraRotationMatrix=g.c.Zero(),this._transformedReferencePoint=g.k.Zero(),this._deferredPositionUpdate=new g.k,this._deferredRotationQuaternionUpdate=new g.d,this._deferredRotationUpdate=new g.k,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=g.k.Forward(this.va().useRightHandedSystem),this.rotation=new g.k(0,this.va().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(A){this.getWorldMatrix();const X=g.f.oi[0],s=g.f.oi[1];return s.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(s,X),X.scaleInPlace(A),this.globalPosition.add(X)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const A=this.lockedTarget;A.si().getTranslationToRef(A.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.gi(0,0,0),this.cameraRotation.gi(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new g.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new g.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new g.d(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(A){A||super._updateCache();const X=this._getLockedTargetPosition();X?this._cache.lockedTarget?this._cache.lockedTarget.p(X):this._cache.lockedTarget=X.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const A=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(A):!A)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const A=this.getEngine();return this.speed*Math.sqrt(A.getDeltaTime()/(100*A.getFps()))}setTarget(A){this.upVector.normalize(),this._initialFocalDistance=A.Pg(this.position).length(),this.position.z===A.z&&(this.position.z+=K.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.va().useRightHandedSystem?g.c.LookAtRHToRef(this.position,A,g.k.UpReadOnly,i):g.c.LookAtLHToRef(this.position,A,g.k.UpReadOnly,i),i.invert();const X=this.rotationQuaternion||Y;g.d.FromRotationMatrixToRef(i,X),X.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(A){this.setTarget(A)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(g.f.Matrix[0]),g.k.TransformNormalToRef(this.cameraDirection,g.f.Matrix[0],g.f.oi[0]),this._deferredPositionUpdate.addInPlace(g.f.oi[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const A=this.invertRotation?-this.inverseRotationSpeed:1,X=this._decideIfNeedsToMove(),s=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),X&&this._updatePosition(),s){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*A,this._deferredRotationUpdate.y+=this.cameraRotation.y*A,!this.noRotationConstraint){const A=1.570796;this._deferredRotationUpdate.x>A&&(this._deferredRotationUpdate.x=A),this._deferredRotationUpdate.x<-A&&(this._deferredRotationUpdate.x=-A)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(g.d.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}X&&(Math.abs(this.cameraDirection.x)<this.speed*K.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*K.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*K.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),s&&(Math.abs(this.cameraRotation.x)<this.speed*K.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*K.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):g.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return g.k.TransformNormalToRef(g.k.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),g.k.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?r.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(g.d.FromEulerVectorToRef(this.rotation,Y),r.b.Y.rotateByQuaternionToRef(Y,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(A,X,s){if(this.va().useRightHandedSystem?g.c.LookAtRHToRef(A,X,s,this._viewMatrix):g.c.LookAtLHToRef(A,X,s,this._viewMatrix),this.parent){const A=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(A,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(A)}createRigCamera(A,X){if(this.cameraRigMode!==E.b.RIG_MODE_NONE){const X=new v(A,this.position.clone(),this.va());return X.isRigCamera=!0,X.rigParent=this,this.cameraRigMode===E.b.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new g.d),X._cameraRigParams={},X.rotationQuaternion=new g.d),X.mode=this.mode,X.orthoLeft=this.orthoLeft,X.orthoRight=this.orthoRight,X.orthoTop=this.orthoTop,X.orthoBottom=this.orthoBottom,X}return null}_updateRigCameras(){const A=this._rigCameras[0],X=this._rigCameras[1];switch(this.si(),this.cameraRigMode){case E.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case E.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case E.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case E.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case E.b.RIG_MODE_STEREOSCOPIC_INTERLACED:{const s=this.cameraRigMode===E.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,N=this.cameraRigMode===E.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,A),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*N,X);break}case E.b.RIG_MODE_VR:A.rotationQuaternion?(A.rotationQuaternion.p(this.rotationQuaternion),X.rotationQuaternion.p(this.rotationQuaternion)):(A.rotation.p(this.rotation),X.rotation.p(this.rotation)),A.position.p(this.position),X.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(A,X){this.getTarget().subtractToRef(this.position,v._TargetFocalPoint),v._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const s=v._TargetFocalPoint.addInPlace(this.position);g.c.TranslationToRef(-s.x,-s.y,-s.z,v._TargetTransformMatrix),v._TargetTransformMatrix.multiplyToRef(g.c.RotationAxis(X.upVector,A),v._RigCamTransformMatrix),g.c.TranslationToRef(s.x,s.y,s.z,v._TargetTransformMatrix),v._RigCamTransformMatrix.multiplyToRef(v._TargetTransformMatrix,v._RigCamTransformMatrix),g.k.TransformCoordinatesToRef(this.position,v._RigCamTransformMatrix,X.position),X.setTarget(s)}getClassName(){return"TargetCamera"}}v._RigCamTransformMatrix=new g.c,v._TargetTransformMatrix=new g.c,v._TargetFocalPoint=new g.k,(0,N.e)([(0,f.M)()],v.prototype,"updateUpVectorFromRotation",void 0),(0,N.e)([(0,f.K)()],v.prototype,"rotation",void 0),(0,N.e)([(0,f.M)()],v.prototype,"speed",void 0),(0,N.e)([(0,f.z)("lockedTargetId")],v.prototype,"lockedTarget",void 0)},12993:(A,X,s)=>{"use strict";s.d(X,{b:()=>E});var N=s(672),f=s(13002);class E{constructor(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=s,this.gl=[],this._maxBlockCapacity=X||64,this._selectionContent=new N.d(1024),this._creationFunc=A}update(A,X,s){f.e._CreateBlocks(A,X,s,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Xi(A){for(let X=0;X<this.Rk.length;X++){this.Rk[X].addEntry(A)}}Zi(A){for(let X=0;X<this.Rk.length;X++){this.Rk[X].removeEntry(A)}}select(A,X){this._selectionContent.reset();for(let s=0;s<this.Rk.length;s++){this.Rk[s].select(A,this._selectionContent,X)}return X?this._selectionContent.concat(this.gl):this._selectionContent.concatWithNoDuplicate(this.gl),this._selectionContent}intersects(A,X,s){this._selectionContent.reset();for(let N=0;N<this.Rk.length;N++){this.Rk[N].intersects(A,X,this._selectionContent,s)}return s?this._selectionContent.concat(this.gl):this._selectionContent.concatWithNoDuplicate(this.gl),this._selectionContent}intersectsRay(A){this._selectionContent.reset();for(let X=0;X<this.Rk.length;X++){this.Rk[X].intersectsRay(A,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.gl),this._selectionContent}}E.CreationFuncForMeshes=(A,X)=>{const s=A.getBoundingInfo();!A.isBlocked&&s.boundingBox.intersectsMinMax(X.il,X.jl)&&X.entries.push(A)},E.CreationFuncForSubMeshes=(A,X)=>{A.getBoundingInfo().boundingBox.intersectsMinMax(X.il,X.jl)&&X.entries.push(A)}},13002:(A,X,s)=>{"use strict";s.d(X,{e:()=>E});var N=s(678),f=s(763);class E{constructor(A,X,s,N,f,E){this.entries=[],this.kl=new Array,this._capacity=s,this._depth=N,this._maxDepth=f,this._creationFunc=E,this._minPoint=A,this._maxPoint=X,this.kl.push(A.clone()),this.kl.push(X.clone()),this.kl.push(A.clone()),this.kl[2].x=X.x,this.kl.push(A.clone()),this.kl[3].y=X.y,this.kl.push(A.clone()),this.kl[4].z=X.z,this.kl.push(X.clone()),this.kl[5].z=A.z,this.kl.push(X.clone()),this.kl[6].x=A.x,this.kl.push(X.clone()),this.kl[7].y=A.y}get Yh(){return this._capacity}get il(){return this._minPoint}get jl(){return this._maxPoint}addEntry(A){if(this.Rk)for(let X=0;X<this.Rk.length;X++){this.Rk[X].addEntry(A)}else this._creationFunc(A,this),this.entries.length>this.Yh&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(A){if(this.Rk){for(let X=0;X<this.Rk.length;X++){this.Rk[X].removeEntry(A)}return}const X=this.entries.indexOf(A);X>-1&&this.entries.splice(X,1)}addEntries(A){for(let X=0;X<A.length;X++){const s=A[X];this.addEntry(s)}}select(A,X,s){if(f.c.IsInFrustum(this.kl,A)){if(this.Rk){for(let N=0;N<this.Rk.length;N++){this.Rk[N].select(A,X,s)}return}s?X.concat(this.entries):X.concatWithNoDuplicate(this.entries)}}intersects(A,X,s,N){if(f.c.IntersectsSphere(this._minPoint,this._maxPoint,A,X)){if(this.Rk){for(let f=0;f<this.Rk.length;f++){this.Rk[f].intersects(A,X,s,N)}return}N?s.concat(this.entries):s.concatWithNoDuplicate(this.entries)}}intersectsRay(A,X){if(A.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Rk){for(let s=0;s<this.Rk.length;s++){this.Rk[s].intersectsRay(A,X)}return}X.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){E._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(A,X,s,f,g,K,r,i){r.Rk=new Array;const Y=new N.k((X.x-A.x)/2,(X.y-A.y)/2,(X.z-A.z)/2);for(let N=0;N<2;N++)for(let X=0;X<2;X++)for(let v=0;v<2;v++){const c=A.add(Y.multiplyByFloats(N,X,v)),M=A.add(Y.multiplyByFloats(N+1,X+1,v+1)),d=new E(c,M,f,g+1,K,i);d.addEntries(s),r.Rk.push(d)}}}},13010:(A,X,s)=>{"use strict";s.d(X,{e:()=>Y});var N=s(2418),f=s(678),E=s(804),g=s(12323),K=s(850),r=s(12993),i=s(503);N.d.prototype.createOrUpdateSelectionOctree=function(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=this._getComponent(K.b.NAME_OCTREE);s||(s=new Y(this),this.bb(s)),this.el||(this.el=new r.b(r.b.CreationFuncForMeshes,A,X));const N=this.getWorldExtends();return this.el.update(N.min,N.max,this.meshes),this.el},Object.defineProperty(N.d.prototype,"selectionOctree",{get:function(){return this.el},enumerable:!0,configurable:!0}),E.e.prototype.createOrUpdateSubmeshesOctree=function(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const s=this.va();let N=s._getComponent(K.b.NAME_OCTREE);N||(N=new Y(s),s.bb(N)),this._submeshesOctree||(this._submeshesOctree=new r.b(r.b.CreationFuncForSubMeshes,A,X)),this.si(!0);const f=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(f.minimumWorld,f.maximumWorld,this.wi),this._submeshesOctree};class Y{constructor(A){this.name=K.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new g.b(f.k.Zero(),new f.k(1,1,1)),(A=A||i.b.LastCreatedScene)&&(this.eg=A,this.eg.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.eg.getActiveSubMeshCandidates=A=>this.getActiveSubMeshCandidates(A),this.eg.getCollidingSubMeshCandidates=(A,X)=>this.getCollidingSubMeshCandidates(A,X),this.eg.getIntersectingSubMeshCandidates=(A,X)=>this.getIntersectingSubMeshCandidates(A,X))}register(){this.eg.onMeshRemovedObservable.add((A=>{const X=this.eg.selectionOctree;if(void 0!==X&&null!==X){const s=X.gl.indexOf(A);-1!==s&&X.gl.splice(s,1)}})),this.eg.onMeshImportedObservable.add((A=>{const X=this.eg.selectionOctree;void 0!==X&&null!==X&&X.Xi(A)}))}getActiveMeshCandidates(){var A;return(null===(A=this.eg.el)||void 0===A?void 0:A.select(this.eg.frustumPlanes))||this.eg._getDefaultMeshCandidates()}getActiveSubMeshCandidates(A){if(A._submeshesOctree&&A.useOctreeForRenderingSelection){return A._submeshesOctree.select(this.eg.frustumPlanes)}return this.eg._getDefaultSubMeshCandidates(A)}getIntersectingSubMeshCandidates(A,X){if(A._submeshesOctree&&A.useOctreeForPicking){g.b.TransformToRef(X,A.getWorldMatrix(),this._tempRay);return A._submeshesOctree.intersectsRay(this._tempRay)}return this.eg._getDefaultSubMeshCandidates(A)}getCollidingSubMeshCandidates(A,X){if(A._submeshesOctree&&A.useOctreeForCollisions){const s=X._velocityWorldLength+Math.max(X._radius.x,X._radius.y,X._radius.z);return A._submeshesOctree.intersects(X._basePointWorld,s)}return this.eg._getDefaultSubMeshCandidates(A)}rebuild(){}dispose(){}}},12323:(A,X,s)=>{"use strict";s.d(X,{b:()=>M});var N=s(2418),f=s(653),E=s(683),g=s(678),K=s(687),r=s(755),i=s(813),Y=s(503),v=s(2468);const c={internalPickerForMesh:void 0};class M{constructor(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.b;this.origin=A,this.direction=X,this.length=s,this.epsilon=N}clone(){return new M(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const N=M._TmpVector3[0].gi(A.x-s,A.y-s,A.z-s),f=M._TmpVector3[1].gi(X.x+s,X.y+s,X.z+s);let E,g,K,r,i=0,Y=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<N.x||this.origin.x>f.x)return!1}else if(E=1/this.direction.x,g=(N.x-this.origin.x)*E,K=(f.x-this.origin.x)*E,K===-1/0&&(K=1/0),g>K&&(r=g,g=K,K=r),i=Math.max(g,i),Y=Math.min(K,Y),i>Y)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<N.y||this.origin.y>f.y)return!1}else if(E=1/this.direction.y,g=(N.y-this.origin.y)*E,K=(f.y-this.origin.y)*E,K===-1/0&&(K=1/0),g>K&&(r=g,g=K,K=r),i=Math.max(g,i),Y=Math.min(K,Y),i>Y)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<N.z||this.origin.z>f.z)return!1}else if(E=1/this.direction.z,g=(N.z-this.origin.z)*E,K=(f.z-this.origin.z)*E,K===-1/0&&(K=1/0),g>K&&(r=g,g=K,K=r),i=Math.max(g,i),Y=Math.min(K,Y),i>Y)return!1;return!0}intersectsBox(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(A.minimum,A.maximum,X)}intersectsSphere(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=A.center.x-this.origin.x,N=A.center.y-this.origin.y,f=A.center.z-this.origin.z,E=s*s+N*N+f*f,g=A.radius+X,K=g*g;if(E<=K)return!0;const r=s*this.direction.x+N*this.direction.y+f*this.direction.z;if(r<0)return!1;return E-r*r<=K}intersectsTriangle(A,X,s){const N=M._TmpVector3[0],f=M._TmpVector3[1],E=M._TmpVector3[2],K=M._TmpVector3[3],i=M._TmpVector3[4];X.subtractToRef(A,N),s.subtractToRef(A,f),g.k.CrossToRef(this.direction,f,E);const Y=g.k.Dot(N,E);if(0===Y)return null;const v=1/Y;this.origin.subtractToRef(A,K);const c=g.k.Dot(K,E)*v;if(c<-this.epsilon||c>1+this.epsilon)return null;g.k.CrossToRef(K,N,i);const d=g.k.Dot(this.direction,i)*v;if(d<-this.epsilon||c+d>1+this.epsilon)return null;const Q=g.k.Dot(f,i)*v;return Q>this.length?null:new r.e(1-c-d,c,Q)}intersectsPlane(A){let X;const s=g.k.Dot(A.Si,this.direction);if(Math.abs(s)<9.99999997475243e-7)return null;{const N=g.k.Dot(A.Si,this.origin);return X=(-A.d-N)/s,X<0?X<-9.99999997475243e-7?null:0:X}}intersectsAxis(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(A){case"y":{const A=(this.origin.y-X)/this.direction.y;return A>0?null:new g.k(this.origin.x+this.direction.x*-A,X,this.origin.z+this.direction.z*-A)}case"x":{const A=(this.origin.x-X)/this.direction.x;return A>0?null:new g.k(X,this.origin.y+this.direction.y*-A,this.origin.z+this.direction.z*-A)}case"z":{const A=(this.origin.z-X)/this.direction.z;return A>0?null:new g.k(this.origin.x+this.direction.x*-A,this.origin.y+this.direction.y*-A,X)}default:return null}}intersectsMesh(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const K=g.f.Matrix[0];return A.getWorldMatrix().invertToRef(K),this._tmpRay?M.TransformToRef(this,K,this._tmpRay):this._tmpRay=M.Transform(this,K),A.intersects(this._tmpRay,X,s,N,f,E)}intersectsMeshes(A,X,s){s?s.length=0:s=[];for(let N=0;N<A.length;N++){const f=this.intersectsMesh(A[N],X);f.hit&&s.push(f)}return s.sort(this._comparePickingInfo),s}_comparePickingInfo(A,X){return A.distance<X.distance?-1:A.distance>X.distance?1:0}intersectionSegment(A,X,s){const N=this.origin,f=g.f.oi[0],E=g.f.oi[1],K=g.f.oi[2],r=g.f.oi[3];X.subtractToRef(A,f),this.direction.scaleToRef(M._Rayl,K),N.addToRef(K,E),A.subtractToRef(N,r);const i=g.k.Dot(f,f),Y=g.k.Dot(f,K),v=g.k.Dot(K,K),c=g.k.Dot(f,r),d=g.k.Dot(K,r),Q=i*v-Y*Y;let w,R,C=Q,J=Q;Q<M._Smallnum?(w=0,C=1,R=d,J=v):(w=Y*d-v*c,R=i*d-Y*c,w<0?(w=0,R=d,J=v):w>C&&(w=C,R=d+Y,J=v)),R<0?(R=0,-c<0?w=0:-c>i?w=C:(w=-c,C=i)):R>J&&(R=J,-c+Y<0?w=0:-c+Y>i?w=C:(w=-c+Y,C=i));const a=Math.abs(w)<M._Smallnum?0:w/C,u=Math.abs(R)<M._Smallnum?0:R/J,z=g.f.oi[4];K.scaleToRef(u,z);const m=g.f.oi[5];f.scaleToRef(a,m),m.addInPlace(r);const b=g.f.oi[6];m.subtractToRef(z,b);return u>0&&u<=this.length&&b.lengthSquared()<s*s?m.length():-1}update(A,X,s,N,f,E,K){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){M._RayDistant||(M._RayDistant=M.Zero()),M._RayDistant.unprojectRayToRef(A,X,s,N,g.c.IdentityReadOnly,E,K);const r=g.f.Matrix[0];f.invertToRef(r),M.TransformToRef(M._RayDistant,r,this)}else this.unprojectRayToRef(A,X,s,N,f,E,K);return this}static Zero(){return new M(g.k.Zero(),g.k.Zero())}static CreateNew(A,X,s,N,f,E,g){return M.Zero().update(A,X,s,N,f,E,g)}static CreateNewFromTo(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.c.IdentityReadOnly;const N=new M(new g.k(0,0,0),new g.k(0,0,0));return M.CreateFromToToRef(A,X,N,s)}static CreateFromToToRef(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.c.IdentityReadOnly;s.origin.p(A);const f=X.subtractToRef(A,s.direction),E=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);return s.length=E,s.direction.normalize(),M.TransformToRef(s,N,s)}static Transform(A,X){const s=new M(new g.k(0,0,0),new g.k(0,0,0));return M.TransformToRef(A,X,s),s}static TransformToRef(A,X,s){g.k.TransformCoordinatesToRef(A.origin,X,s.origin),g.k.TransformNormalToRef(A.direction,X,s.direction),s.length=A.length,s.epsilon=A.epsilon;const N=s.direction,f=N.length();if(0!==f&&1!==f){const A=1/f;N.x*=A,N.y*=A,N.z*=A,s.length*=f}return s}unprojectRayToRef(A,X,s,N,f,E,K){const r=g.f.Matrix[0];f.multiplyToRef(E,r),r.multiplyToRef(K,r),r.invert();const i=Y.b.LastCreatedEngine,v=g.f.oi[0];v.x=A/s*2-1,v.y=-(X/N*2-1),v.z=null!==i&&void 0!==i&&i.useReverseDepthBuffer?1:null!==i&&void 0!==i&&i.isNDCHalfZRange?0:-1;const c=g.f.oi[1].gi(v.x,v.y,1-1e-8),M=g.f.oi[2],d=g.f.oi[3];g.k._UnprojectFromInvertedMatrixToRef(v,r,M),g.k._UnprojectFromInvertedMatrixToRef(c,r,d),this.origin.p(M),d.subtractToRef(M,this.direction),this.direction.normalize()}}function d(A,X,s,N,f){let E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=M.Zero();return Q(A,X,s,N,g,f,E),g}function Q(A,X,s,N,f,E){let K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const i=A.getEngine();if(!E&&!(E=A.activeCamera))return A;const Y=E.viewport,v=i.getRenderHeight(),{x:c,y:M,width:d,height:Q}=Y.toGlobal(i.getRenderWidth(),v),w=1/i.getHardwareScalingLevel();return X=X*w-c,s=s*w-(v-M-Q),f.update(X,s,d,Q,N||g.c.IdentityReadOnly,K?g.c.IdentityReadOnly:E.getViewMatrix(),E.getProjectionMatrix(),r),A}function w(A,X,s,N,f){if(!i.c)return A;const E=A.getEngine();if(!f&&!(f=A.activeCamera))throw new Error("Active camera not set");const K=f.viewport,r=E.getRenderHeight(),{x:Y,y:v,width:c,height:M}=K.toGlobal(E.getRenderWidth(),r),d=g.c.Identity(),Q=1/E.getHardwareScalingLevel();return X=X*Q-Y,s=s*Q-(r-v-M),N.update(X,s,c,M,d,d,f.getProjectionMatrix()),A}function R(A,X,s,N,f,E,g,K){const r=X(N,s.enableDistantPicking),i=s.intersects(r,f,g,E,N,K);return i&&i.hit?!f&&null!=A&&i.distance>=A.distance?null:i:null}function C(A,X,s,N,f,E){let K=null;const r=!!(A.activeCameras&&A.activeCameras.length>1&&A.cameraToUseForPointers!==A.activeCamera),Y=A.cameraToUseForPointers||A.activeCamera,v=c.internalPickerForMesh||R;for(let i=0;i<A.meshes.length;i++){const c=A.meshes[i];if(s){if(!s(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.Ai)continue;const M=r&&c.isWorldMatrixCameraDependent(),d=c.si(M,Y);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const A=v(K,X,c,d,!0,!0,E);if(A){if(f)return A;const r=g.f.Matrix[1],i=c.thinInstanceGetWorldMatrices();for(let A=0;A<i.length;A++){if(s&&!s(c,A))continue;i[A].multiplyToRef(d,r);const g=v(K,X,c,r,N,f,E,!0);if(g&&(K=g,K.thinInstanceIndex=A,N))return K}}}else{const A=v(K,X,c,d,N,f,E);if(A&&(K=A,N))return K}}return K||new i.c}function J(A,X,s,N){if(!i.c)return null;const f=[],E=!!(A.activeCameras&&A.activeCameras.length>1&&A.cameraToUseForPointers!==A.activeCamera),K=A.cameraToUseForPointers||A.activeCamera,r=c.internalPickerForMesh||R;for(let i=0;i<A.meshes.length;i++){const Y=A.meshes[i];if(s){if(!s(Y,-1))continue}else if(!Y.isEnabled()||!Y.isVisible||!Y.Ai)continue;const v=E&&Y.isWorldMatrixCameraDependent(),c=Y.si(v,K);if(Y.hasThinInstances&&Y.thinInstanceEnablePicking){if(r(null,X,Y,c,!0,!0,N)){const A=g.f.Matrix[1],E=Y.thinInstanceGetWorldMatrices();for(let g=0;g<E.length;g++){if(s&&!s(Y,g))continue;E[g].multiplyToRef(c,A);const K=r(null,X,Y,A,!1,!1,N,!0);K&&(K.thinInstanceIndex=g,f.push(K))}}}else{const A=r(null,X,Y,c,!1,!1,N);A&&f.push(A)}}return f}function a(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,N=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;N||(N=A.getWorldMatrix()),X.length=s,f?X.origin.p(f):X.origin.p(A.position);const E=g.f.oi[2];E.set(0,0,A._scene.useRightHandedSystem?-1:1);const K=g.f.oi[3];return g.k.TransformNormalToRef(E,N,K),g.k.NormalizeToRef(K,X.direction),X}var u,z;M._TmpVector3=(0,K.c)(6,g.k.Zero),M._RayDistant=M.Zero(),M._Smallnum=1e-8,M._Rayl=1e9,u=N.d,(z=f.b)&&(z.prototype.getForwardRay=function(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,X=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;return a(this,new M(g.k.Zero(),g.k.Zero(),A),A,X,s)},z.prototype.getForwardRayToRef=function(A){return a(this,A,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),u&&(v.e._IsPickingAvailable=!0,u.prototype.createPickingRay=function(A,X,s,N){return d(this,A,X,s,N,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),N.d.prototype.createPickingRayToRef=function(A,X,s,N,f){return Q(this,A,X,s,N,f,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},N.d.prototype.createPickingRayInCameraSpace=function(A,X,s){return function(A,X,s,N){const f=M.Zero();return w(A,X,s,f,N),f}(this,A,X,s)},N.d.prototype.createPickingRayInCameraSpaceToRef=function(A,X,s,N){return w(this,A,X,s,N)},N.d.prototype.pickWithBoundingInfo=function(A,X,s,N,f){return function(A,X,s,N,f,E){if(!i.c)return null;const K=C(A,(N=>(A._tempPickingRay||(A._tempPickingRay=M.Zero()),Q(A,X,s,N,A._tempPickingRay,E||null),A._tempPickingRay)),N,f,!0);return K&&(K.ray=d(A,X,s,g.c.Identity(),E||null)),K}(this,A,X,s,N,f)},N.d.prototype.Lk=function(A,X,s,N,f,E){return function(A,X,s,N,f,E,K){const r=C(A,((N,f)=>(A._tempPickingRay||(A._tempPickingRay=M.Zero()),Q(A,X,s,N,A._tempPickingRay,E||null,!1,f),A._tempPickingRay)),N,f,!1,K);return r&&(r.ray=d(A,X,s,g.c.Identity(),E||null)),r}(this,A,X,s,N,f,E)},N.d.prototype.pickWithRay=function(A,X,s,N){return function(A,X,s,N,f){const E=C(A,(s=>(A._pickWithRayInverseMatrix||(A._pickWithRayInverseMatrix=g.c.Identity()),s.invertToRef(A._pickWithRayInverseMatrix),A._cachedRayForTransform||(A._cachedRayForTransform=M.Zero()),M.TransformToRef(X,A._pickWithRayInverseMatrix,A._cachedRayForTransform),A._cachedRayForTransform)),s,N,!1,f);return E&&(E.ray=X),E}(this,A,X,s,N)},N.d.prototype.multiPick=function(A,X,s,N,f){return function(A,X,s,N,f,E){return J(A,(N=>d(A,X,s,N,f||null)),N,E)}(this,A,X,s,N,f)},N.d.prototype.multiPickWithRay=function(A,X,s){return function(A,X,s,N){return J(A,(s=>(A._pickWithRayInverseMatrix||(A._pickWithRayInverseMatrix=g.c.Identity()),s.invertToRef(A._pickWithRayInverseMatrix),A._cachedRayForTransform||(A._cachedRayForTransform=M.Zero()),M.TransformToRef(X,A._pickWithRayInverseMatrix,A._cachedRayForTransform),A._cachedRayForTransform)),s,N)}(this,A,X,s)}},2394:(A,X,s)=>{"use strict";var N=s(592),f=s(470),E=s(508),g=s(624),K=s(547),r=s(605);K.d.prototype._partialLoadFile=function(A,X,s,N){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(A,(A=>{s[X]=A,s._internalCount++,6===s._internalCount&&N(s)}),void 0,void 0,!0,((A,X)=>{f&&A&&f(A.status+" "+A.statusText,X)}))},K.d.prototype._cascadeLoadFiles=function(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const f=[];f._internalCount=0;for(let E=0;E<6;E++)this._partialLoadFile(s[E],E,f,X,N)},K.d.prototype._cascadeLoadImgs=function(A,X,s,N){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5?arguments[5]:void 0;const g=[];g._internalCount=0;for(let K=0;K<6;K++)this._partialLoadImg(N[K],K,g,A,X,s,f,E)},K.d.prototype._partialLoadImg=function(A,X,s,N,f,K){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7?arguments[7]:void 0;const Y=(0,g.c)();(0,E.o)(A,(A=>{s[X]=A,s._internalCount++,N&&N.removePendingData(Y),6===s._internalCount&&K&&K(f,s)}),((A,X)=>{N&&N.removePendingData(Y),r&&r(A,X)}),N?N.offlineProvider:null,i),N&&N.addPendingData(Y)},K.d.prototype.createCubeTextureBase=function(A,X,s,E){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,w=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,R=arguments.length>14&&void 0!==arguments[14]&&arguments[14],C=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const J=d||new N.b(this,7);J.isCube=!0,J.url=A,J.generateMipMaps=!E,J._lodGenerationScale=c,J._lodGenerationOffset=M,J._useSRGBBuffer=!!R&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!E),J!==d&&(J.label=A.substring(0,60)),this._doNotHandleContextLost||(J._extension=Y,J._files=s,J._buffer=C);const a=A;this._transformTextureUrl&&!d&&(A=this._transformTextureUrl(A));const u=Y??function(A){const X=A.split("?")[0],s=X.lastIndexOf(".");return s>-1?X.substring(s).toLowerCase():""}(A),z=(0,r.e)(u),m=(A,X)=>{J.dispose(),K?K(A,X):A&&f.b.Warn(A)},b=(N,K)=>{A===a?N&&m(N.status+" "+N.statusText,K):(f.b.Warn(`Failed to load ${A}, falling back to the ${a}`),this.createCubeTextureBase(a,X,s,!!E,g,m,i,Y,v,c,M,J,Q,w,R,C))};if(z)z.then((N=>{const f=A=>{Q&&Q(J,A),N.loadCubeData(A,J,v,g,((A,X)=>{m(A,X)}))};C?f(C):s&&6===s.length?N.supportCascades?this._cascadeLoadFiles(X,(A=>f(A.map((A=>new Uint8Array(A))))),s,m):m("Textures type does not support cascades."):this._loadFile(A,(A=>f(new Uint8Array(A))),void 0,void 0,!0,b)}));else{if(!s||0===s.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(X,J,((A,X)=>{w&&w(A,X)}),s,m)}return this._internalTexturesCache.push(J),J}},12613:(A,X,s)=>{"use strict";s.d(X,{b:()=>N});class N{}N.AUTOSAMPLERSUFFIX="Sampler",N.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",N.ALPHA_DISABLE=0,N.ALPHA_ADD=1,N.ALPHA_COMBINE=2,N.ALPHA_SUBTRACT=3,N.ALPHA_MULTIPLY=4,N.ALPHA_MAXIMIZED=5,N.ALPHA_ONEONE=6,N.ALPHA_PREMULTIPLIED=7,N.ALPHA_PREMULTIPLIED_PORTERDUFF=8,N.ALPHA_INTERPOLATE=9,N.ALPHA_SCREENMODE=10,N.ALPHA_ONEONE_ONEONE=11,N.ALPHA_ALPHATOCOLOR=12,N.ALPHA_REVERSEONEMINUS=13,N.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,N.ALPHA_ONEONE_ONEZERO=15,N.ALPHA_EXCLUSION=16,N.ALPHA_LAYER_ACCUMULATE=17,N.ALPHA_EQUATION_ADD=0,N.ALPHA_EQUATION_SUBSTRACT=1,N.ALPHA_EQUATION_REVERSE_SUBTRACT=2,N.ALPHA_EQUATION_MAX=3,N.ALPHA_EQUATION_MIN=4,N.ALPHA_EQUATION_DARKEN=5,N.DELAYLOADSTATE_NONE=0,N.DELAYLOADSTATE_LOADED=1,N.DELAYLOADSTATE_LOADING=2,N.DELAYLOADSTATE_NOTLOADED=4,N.NEVER=512,N.ALWAYS=519,N.LESS=513,N.EQUAL=514,N.LEQUAL=515,N.GREATER=516,N.GEQUAL=518,N.NOTEQUAL=517,N.KEEP=7680,N.ZERO=0,N.REPLACE=7681,N.INCR=7682,N.DECR=7683,N.INVERT=5386,N.INCR_WRAP=34055,N.DECR_WRAP=34056,N.TEXTURE_CLAMP_ADDRESSMODE=0,N.TEXTURE_WRAP_ADDRESSMODE=1,N.TEXTURE_MIRROR_ADDRESSMODE=2,N.TEXTURE_CREATIONFLAG_STORAGE=1,N.TEXTUREFORMAT_ALPHA=0,N.TEXTUREFORMAT_LUMINANCE=1,N.TEXTUREFORMAT_LUMINANCE_ALPHA=2,N.TEXTUREFORMAT_RGB=4,N.TEXTUREFORMAT_RGBA=5,N.TEXTUREFORMAT_RED=6,N.TEXTUREFORMAT_R=6,N.TEXTUREFORMAT_R16_UNORM=33322,N.TEXTUREFORMAT_RG16_UNORM=33324,N.TEXTUREFORMAT_RGB16_UNORM=32852,N.TEXTUREFORMAT_RGBA16_UNORM=32859,N.TEXTUREFORMAT_R16_SNORM=36760,N.TEXTUREFORMAT_RG16_SNORM=36761,N.TEXTUREFORMAT_RGB16_SNORM=36762,N.TEXTUREFORMAT_RGBA16_SNORM=36763,N.TEXTUREFORMAT_RG=7,N.TEXTUREFORMAT_RED_INTEGER=8,N.TEXTUREFORMAT_R_INTEGER=8,N.TEXTUREFORMAT_RG_INTEGER=9,N.TEXTUREFORMAT_RGB_INTEGER=10,N.TEXTUREFORMAT_RGBA_INTEGER=11,N.TEXTUREFORMAT_BGRA=12,N.TEXTUREFORMAT_DEPTH24_STENCIL8=13,N.TEXTUREFORMAT_DEPTH32_FLOAT=14,N.TEXTUREFORMAT_DEPTH16=15,N.TEXTUREFORMAT_DEPTH24=16,N.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,N.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,N.TEXTUREFORMAT_STENCIL8=19,N.TEXTUREFORMAT_UNDEFINED=4294967295,N.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,N.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,N.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,N.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,N.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,N.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,N.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,N.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,N.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,N.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,N.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,N.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,N.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,N.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,N.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,N.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,N.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,N.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,N.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,N.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,N.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,N.TEXTURETYPE_UNSIGNED_BYTE=0,N.TEXTURETYPE_UNSIGNED_INT=0,N.TEXTURETYPE_FLOAT=1,N.TEXTURETYPE_HALF_FLOAT=2,N.TEXTURETYPE_BYTE=3,N.TEXTURETYPE_SHORT=4,N.TEXTURETYPE_UNSIGNED_SHORT=5,N.TEXTURETYPE_INT=6,N.TEXTURETYPE_UNSIGNED_INTEGER=7,N.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,N.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,N.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,N.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,N.TEXTURETYPE_UNSIGNED_INT_24_8=12,N.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,N.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,N.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,N.TEXTURETYPE_UNDEFINED=16,N.TEXTURE_2D=3553,N.TEXTURE_2D_ARRAY=35866,N.TEXTURE_CUBE_MAP=34067,N.TEXTURE_CUBE_MAP_ARRAY=3735928559,N.TEXTURE_3D=32879,N.TEXTURE_NEAREST_SAMPLINGMODE=1,N.TEXTURE_NEAREST_NEAREST=1,N.TEXTURE_BILINEAR_SAMPLINGMODE=2,N.TEXTURE_LINEAR_LINEAR=2,N.TEXTURE_TRILINEAR_SAMPLINGMODE=3,N.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,N.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,N.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,N.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,N.TEXTURE_NEAREST_LINEAR=7,N.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,N.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,N.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,N.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,N.TEXTURE_LINEAR_NEAREST=12,N.TEXTURE_EXPLICIT_MODE=0,N.TEXTURE_SPHERICAL_MODE=1,N.TEXTURE_PLANAR_MODE=2,N.TEXTURE_CUBIC_MODE=3,N.TEXTURE_PROJECTION_MODE=4,N.TEXTURE_SKYBOX_MODE=5,N.TEXTURE_INVCUBIC_MODE=6,N.TEXTURE_EQUIRECTANGULAR_MODE=7,N.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,N.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,N.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,N.TEXTURE_FILTERING_QUALITY_HIGH=64,N.TEXTURE_FILTERING_QUALITY_MEDIUM=16,N.TEXTURE_FILTERING_QUALITY_LOW=8,N.SCALEMODE_FLOOR=1,N.SCALEMODE_NEAREST=2,N.SCALEMODE_CEILING=3,N.MATERIAL_TextureDirtyFlag=1,N.MATERIAL_LightDirtyFlag=2,N.MATERIAL_FresnelDirtyFlag=4,N.MATERIAL_AttributesDirtyFlag=8,N.MATERIAL_MiscDirtyFlag=16,N.MATERIAL_PrePassDirtyFlag=32,N.MATERIAL_ImageProcessingDirtyFlag=64,N.MATERIAL_AllDirtyFlag=127,N.MATERIAL_TriangleFillMode=0,N.MATERIAL_WireFrameFillMode=1,N.MATERIAL_PointFillMode=2,N.MATERIAL_PointListDrawMode=3,N.MATERIAL_LineListDrawMode=4,N.MATERIAL_LineLoopDrawMode=5,N.MATERIAL_LineStripDrawMode=6,N.MATERIAL_TriangleStripDrawMode=7,N.MATERIAL_TriangleFanDrawMode=8,N.MATERIAL_ClockWiseSideOrientation=0,N.MATERIAL_CounterClockWiseSideOrientation=1,N.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,N.MATERIAL_DIFFUSE_MODEL_BURLEY=1,N.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,N.MATERIAL_DIFFUSE_MODEL_LEGACY=3,N.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,N.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,N.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,N.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,N.ACTION_NothingTrigger=0,N.ACTION_OnPickTrigger=1,N.ACTION_OnLeftPickTrigger=2,N.ACTION_OnRightPickTrigger=3,N.ACTION_OnCenterPickTrigger=4,N.ACTION_OnPickDownTrigger=5,N.ACTION_OnDoublePickTrigger=6,N.ACTION_OnPickUpTrigger=7,N.ACTION_OnPickOutTrigger=16,N.ACTION_OnLongPressTrigger=8,N.ACTION_OnPointerOverTrigger=9,N.ACTION_OnPointerOutTrigger=10,N.ACTION_OnEveryFrameTrigger=11,N.ACTION_OnIntersectionEnterTrigger=12,N.ACTION_OnIntersectionExitTrigger=13,N.ACTION_OnKeyDownTrigger=14,N.ACTION_OnKeyUpTrigger=15,N.PARTICLES_BILLBOARDMODE_Y=2,N.PARTICLES_BILLBOARDMODE_ALL=7,N.PARTICLES_BILLBOARDMODE_STRETCHED=8,N.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,N.MESHES_CULLINGSTRATEGY_STANDARD=0,N.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,N.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,N.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,N.SCENELOADER_NO_LOGGING=0,N.SCENELOADER_MINIMAL_LOGGING=1,N.SCENELOADER_SUMMARY_LOGGING=2,N.SCENELOADER_DETAILED_LOGGING=3,N.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,N.PREPASS_POSITION_TEXTURE_TYPE=1,N.PREPASS_VELOCITY_TEXTURE_TYPE=2,N.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,N.PREPASS_COLOR_TEXTURE_TYPE=4,N.PREPASS_DEPTH_TEXTURE_TYPE=5,N.PREPASS_NORMAL_TEXTURE_TYPE=6,N.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,N.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,N.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,N.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,N.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,N.PREPASS_ALBEDO_TEXTURE_TYPE=12,N.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,N.BUFFER_CREATIONFLAG_READ=1,N.BUFFER_CREATIONFLAG_WRITE=2,N.BUFFER_CREATIONFLAG_READWRITE=3,N.BUFFER_CREATIONFLAG_UNIFORM=4,N.BUFFER_CREATIONFLAG_VERTEX=8,N.BUFFER_CREATIONFLAG_INDEX=16,N.BUFFER_CREATIONFLAG_STORAGE=32,N.BUFFER_CREATIONFLAG_INDIRECT=64,N.RENDERPASS_MAIN=0,N.INPUT_ALT_KEY=18,N.INPUT_CTRL_KEY=17,N.INPUT_META_KEY1=91,N.INPUT_META_KEY2=92,N.INPUT_META_KEY3=93,N.INPUT_SHIFT_KEY=16,N.SNAPSHOTRENDERING_STANDARD=0,N.SNAPSHOTRENDERING_FAST=1,N.PERSPECTIVE_CAMERA=0,N.ORTHOGRAPHIC_CAMERA=1,N.FOVMODE_VERTICAL_FIXED=0,N.FOVMODE_HORIZONTAL_FIXED=1,N.RIG_MODE_NONE=0,N.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,N.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,N.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,N.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,N.RIG_MODE_STEREOSCOPIC_INTERLACED=14,N.RIG_MODE_VR=20,N.RIG_MODE_CUSTOM=22,N.MAX_SUPPORTED_UV_SETS=6,N.GL_ALPHA_EQUATION_ADD=32774,N.GL_ALPHA_EQUATION_MIN=32775,N.GL_ALPHA_EQUATION_MAX=32776,N.GL_ALPHA_EQUATION_SUBTRACT=32778,N.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,N.GL_ALPHA_FUNCTION_SRC=768,N.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,N.GL_ALPHA_FUNCTION_SRC_ALPHA=770,N.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,N.GL_ALPHA_FUNCTION_DST_ALPHA=772,N.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,N.GL_ALPHA_FUNCTION_DST_COLOR=774,N.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,N.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,N.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,N.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,N.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,N.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,N.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,N.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,N.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,N.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,N.SnippetUrl="https://snippet.babylonjs.com",N.FOGMODE_NONE=0,N.FOGMODE_EXP=1,N.FOGMODE_EXP2=2,N.FOGMODE_LINEAR=3,N.BYTE=5120,N.UNSIGNED_BYTE=5121,N.SHORT=5122,N.UNSIGNED_SHORT=5123,N.INT=5124,N.UNSIGNED_INT=5125,N.FLOAT=5126,N.PositionKind="position",N.NormalKind="Si",N.TangentKind="tangent",N.UVKind="uv",N.UV2Kind="uv2",N.UV3Kind="uv3",N.UV4Kind="uv4",N.UV5Kind="uv5",N.UV6Kind="uv6",N.ColorKind="color",N.ColorInstanceKind="instanceColor",N.MatricesIndicesKind="matricesIndices",N.MatricesWeightsKind="matricesWeights",N.MatricesIndicesExtraKind="matricesIndicesExtra",N.MatricesWeightsExtraKind="matricesWeightsExtra",N.ANIMATIONTYPE_FLOAT=0,N.ANIMATIONTYPE_VECTOR3=1,N.ANIMATIONTYPE_QUATERNION=2,N.ANIMATIONTYPE_MATRIX=3,N.ANIMATIONTYPE_COLOR3=4,N.ANIMATIONTYPE_COLOR4=7,N.ANIMATIONTYPE_VECTOR2=5,N.ANIMATIONTYPE_SIZE=6,N.ShadowMinZ=0,N.ShadowMaxZ=1e4},13012:(A,X,s)=>{"use strict";s(470);var N=s(2331);s(592),s(735),s(584),s(2377),s(2336);N.e},12672:(A,X,s)=>{"use strict";s.d(X,{e:()=>f});var N=s(616);class f{constructor(A){this.value=this._toInt(A)}_toInt(A){return 0|A}add(A){return new f(this.value+A.value)}Pg(A){return new f(this.value-A.value)}multiply(A){return new f(Math.imul(this.value,A.value))}divide(A){return new f(this.value/A.value)}getClassName(){return f.ClassName}equals(A){return this.value===A.value}static FromValue(A){return new f(A)}toString(){return this.value.toString()}}f.ClassName="FlowGraphInteger",(0,N.f)("FlowGraphInteger",f)},12680:(A,X,s)=>{"use strict";s.d(X,{c:()=>f,f:()=>E});var N=s(678);class f{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Li=A}get m(){return this.Li}transformVector(A){return this.transformVectorToRef(A,new N.i)}transformVectorToRef(A,X){return X.x=A.x*this.Li[0]+A.y*this.Li[1],X.y=A.x*this.Li[2]+A.y*this.Li[3],X}zi(){return this.toArray()}toArray(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<4;X++)A[X]=this.Li[X];return A}Qi(A){for(let X=0;X<4;X++)this.Li[X]=A[X];return this}multiplyToRef(A,X){const s=A.Li,N=this.Li,f=X.Li;return f[0]=s[0]*N[0]+s[1]*N[2],f[1]=s[0]*N[1]+s[1]*N[3],f[2]=s[2]*N[0]+s[3]*N[2],f[3]=s[2]*N[1]+s[3]*N[3],X}multiply(A){return this.multiplyToRef(A,new f)}divideToRef(A,X){const s=this.Li,N=A.Li,f=X.Li;return f[0]=s[0]/N[0],f[1]=s[1]/N[1],f[2]=s[2]/N[2],f[3]=s[3]/N[3],X}divide(A){return this.divideToRef(A,new f)}addToRef(A,X){const s=this.Li,N=A.m,f=X.m;return f[0]=s[0]+N[0],f[1]=s[1]+N[1],f[2]=s[2]+N[2],f[3]=s[3]+N[3],X}add(A){return this.addToRef(A,new f)}subtractToRef(A,X){const s=this.Li,N=A.m,f=X.m;return f[0]=s[0]-N[0],f[1]=s[1]-N[1],f[2]=s[2]-N[2],f[3]=s[3]-N[3],X}Pg(A){return this.subtractToRef(A,new f)}transpose(){const A=this.Li;return new f([A[0],A[2],A[1],A[3]])}determinant(){const A=this.Li;return A[0]*A[3]-A[1]*A[2]}inverse(){const A=this.determinant();if(0===A)throw new Error("Matrix is not invertible");const X=this.Li,s=1/A;return new f([X[3]*s,-X[1]*s,-X[2]*s,X[0]*s])}equals(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.Li,N=A.m;return 0===X?s[0]===N[0]&&s[1]===N[1]&&s[2]===N[2]&&s[3]===N[3]:Math.abs(s[0]-N[0])<X&&Math.abs(s[1]-N[1])<X&&Math.abs(s[2]-N[2])<X&&Math.abs(s[3]-N[3])<X}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Li.join(", ")})`}}class E{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Li=A}get m(){return this.Li}transformVector(A){return this.transformVectorToRef(A,new N.k)}transformVectorToRef(A,X){const s=this.Li;return X.x=A.x*s[0]+A.y*s[1]+A.z*s[2],X.y=A.x*s[3]+A.y*s[4]+A.z*s[5],X.z=A.x*s[6]+A.y*s[7]+A.z*s[8],X}multiplyToRef(A,X){const s=A.Li,N=this.Li,f=X.m;return f[0]=s[0]*N[0]+s[1]*N[3]+s[2]*N[6],f[1]=s[0]*N[1]+s[1]*N[4]+s[2]*N[7],f[2]=s[0]*N[2]+s[1]*N[5]+s[2]*N[8],f[3]=s[3]*N[0]+s[4]*N[3]+s[5]*N[6],f[4]=s[3]*N[1]+s[4]*N[4]+s[5]*N[7],f[5]=s[3]*N[2]+s[4]*N[5]+s[5]*N[8],f[6]=s[6]*N[0]+s[7]*N[3]+s[8]*N[6],f[7]=s[6]*N[1]+s[7]*N[4]+s[8]*N[7],f[8]=s[6]*N[2]+s[7]*N[5]+s[8]*N[8],X}multiply(A){return this.multiplyToRef(A,new E)}divideToRef(A,X){const s=this.Li,N=A.m,f=X.m;return f[0]=s[0]/N[0],f[1]=s[1]/N[1],f[2]=s[2]/N[2],f[3]=s[3]/N[3],f[4]=s[4]/N[4],f[5]=s[5]/N[5],f[6]=s[6]/N[6],f[7]=s[7]/N[7],f[8]=s[8]/N[8],X}divide(A){return this.divideToRef(A,new E)}addToRef(A,X){const s=this.Li,N=A.m,f=X.m;return f[0]=s[0]+N[0],f[1]=s[1]+N[1],f[2]=s[2]+N[2],f[3]=s[3]+N[3],f[4]=s[4]+N[4],f[5]=s[5]+N[5],f[6]=s[6]+N[6],f[7]=s[7]+N[7],f[8]=s[8]+N[8],X}add(A){return this.addToRef(A,new E)}subtractToRef(A,X){const s=this.Li,N=A.m,f=X.m;return f[0]=s[0]-N[0],f[1]=s[1]-N[1],f[2]=s[2]-N[2],f[3]=s[3]-N[3],f[4]=s[4]-N[4],f[5]=s[5]-N[5],f[6]=s[6]-N[6],f[7]=s[7]-N[7],f[8]=s[8]-N[8],X}Pg(A){return this.subtractToRef(A,new E)}toArray(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<9;X++)A[X]=this.Li[X];return A}zi(){return this.toArray()}Qi(A){for(let X=0;X<9;X++)this.Li[X]=A[X];return this}transpose(){const A=this.Li;return new E([A[0],A[3],A[6],A[1],A[4],A[7],A[2],A[5],A[8]])}determinant(){const A=this.Li;return A[0]*(A[4]*A[8]-A[5]*A[7])-A[1]*(A[3]*A[8]-A[5]*A[6])+A[2]*(A[3]*A[7]-A[4]*A[6])}inverse(){const A=this.determinant();if(0===A)throw new Error("Matrix is not invertible");const X=this.Li,s=1/A;return new E([(X[4]*X[8]-X[5]*X[7])*s,(X[2]*X[7]-X[1]*X[8])*s,(X[1]*X[5]-X[2]*X[4])*s,(X[5]*X[6]-X[3]*X[8])*s,(X[0]*X[8]-X[2]*X[6])*s,(X[2]*X[3]-X[0]*X[5])*s,(X[3]*X[7]-X[4]*X[6])*s,(X[1]*X[6]-X[0]*X[7])*s,(X[0]*X[4]-X[1]*X[3])*s])}equals(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=this.Li,N=A.m;return 0===X?s[0]===N[0]&&s[1]===N[1]&&s[2]===N[2]&&s[3]===N[3]&&s[4]===N[4]&&s[5]===N[5]&&s[6]===N[6]&&s[7]===N[7]&&s[8]===N[8]:Math.abs(s[0]-N[0])<X&&Math.abs(s[1]-N[1])<X&&Math.abs(s[2]-N[2])<X&&Math.abs(s[3]-N[3])<X&&Math.abs(s[4]-N[4])<X&&Math.abs(s[5]-N[5])<X&&Math.abs(s[6]-N[6])<X&&Math.abs(s[7]-N[7])<X&&Math.abs(s[8]-N[8])<X}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Li.join(", ")})`}}},12689:(A,X,s)=>{"use strict";var N;function f(A,X,s,N){switch(X){case"Animation":return N?A.animations.find((A=>A.uniqueId===s))??null:A.animations[s]??null;case"AnimationGroup":return N?A.animationGroups.find((A=>A.uniqueId===s))??null:A.animationGroups[s]??null;case"Mesh":return N?A.meshes.find((A=>A.uniqueId===s))??null:A.meshes[s]??null;case"Material":return N?A.materials.find((A=>A.uniqueId===s))??null:A.materials[s]??null;case"Mi":return N?A.cameras.find((A=>A.uniqueId===s))??null:A.cameras[s]??null;case"Light":return N?A.lights.find((A=>A.uniqueId===s))??null:A.lights[s]??null;default:return null}}s.d(X,{b:()=>f}),function(A){A.Animation="Animation",A.AnimationGroup="AnimationGroup",A.Mesh="Mesh",A.Material="Material",A.Mi="Mi",A.Light="Light"}(N||(N={}))},12715:(A,X,s)=>{"use strict";s.d(X,{c:()=>f});var N=s(12724);class f extends N.e{constructor(A,X){if(super(A),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),X)for(const s of X)this._eventsSignalOutputs[s]=this._registerSignalOutput(s+"Event")}_executeOnTick(A){}_startPendingTasks(A){A._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(A),this._resetAfterCanceled(A)),this._preparePendingTasks(A),A._addPendingBlock(this),this.out._activateSignal(A),A._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(A){A._deleteExecutionVariable(this,"_initialized"),A._removePendingBlock(this)}}},12701:(A,X,s)=>{"use strict";s.d(X,{e:()=>i});var N=s(624),f=s(616),E=s(12704),g=s(454),K=s(12669);class r extends E.e{constructor(A,X,s,N){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:N.defaultValue,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(A,X,s),this.richType=N,this._defaultValue=f,this._optional=E,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new g.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(A){this._isDisabled!==A&&(this._isDisabled=A,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(A,X){X._getConnectionValue(this)!==A&&(X._setConnectionValue(this,A),this.onValueChangedObservable.notifyObservers(A))}resetToDefaultValue(A){A._setConnectionValue(this,this._defaultValue)}connectTo(A){this._isDisabled||super.connectTo(A)}_getValueOrDefault(A){const X=A._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(X):X}getValue(A){if(1===this.connectionType){A._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(A);const X=this._getValueOrDefault(A);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}const X=this.isConnected()?this._connectedPoint[0].getValue(A):this._getValueOrDefault(A);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(A),A.richType={},this.richType.serialize(A.richType),A.optional=this._optional,(0,K.g)("defaultValue",this._defaultValue,A)}}(0,f.f)("FlowGraphDataConnection",r);class i{constructor(A){var X;this.config=A,this.uniqueId=(0,N.c)(),this.name=(null===(X=this.config)||void 0===X?void 0:X.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(A){}registerDataInput(A,X,s){const N=new r(A,0,this,X,s);return this.dataInputs.push(N),N}registerDataOutput(A,X,s){const N=new r(A,1,this,X,s);return this.dataOutputs.push(N),N}getDataInput(A){return this.dataInputs.find((X=>X.name===A))}getDataOutput(A){return this.dataOutputs.find((X=>X.name===A))}serialize(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.g;if(A.uniqueId=this.uniqueId,A.config={},this.config){const s=this.config,N=Object.keys(s);for(const f of N)X(f,s[f],A.config)}A.dataInputs=[],A.dataOutputs=[],A.className=this.getClassName();for(const s of this.dataInputs){const X={};s.serialize(X),A.dataInputs.push(X)}for(const s of this.dataOutputs){const X={};s.serialize(X),A.dataOutputs.push(X)}}deserialize(A){}_log(A,X,s){var N;null===(N=A.logger)||void 0===N||N.addLogItem({action:X,payload:s,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12704:(A,X,s)=>{"use strict";s.d(X,{e:()=>E});var N,f=s(624);!function(A){A[A.Input=0]="Input",A[A.Output=1]="Output"}(N||(N={}));class E{constructor(A,X,s){this._ownerBlock=s,this._connectedPoint=[],this.uniqueId=(0,f.c)(),this.connectedPointIds=[],this.name=A,this._connectionType=X}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(A){if(this._connectionType===A._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||A._isSingularConnection()&&A._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(A),A._connectedPoint.push(this)}disconnectFrom(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const s=this._connectedPoint.indexOf(A),N=A._connectedPoint.indexOf(this);-1!==s&&-1!==N&&(X&&this._connectedPoint.splice(s,1),A._connectedPoint.splice(N,1))}disconnectFromAll(){for(const A of this._connectedPoint)this.disconnectFrom(A,!1);this._connectedPoint.length=0}dispose(){for(const A of this._connectedPoint)this.disconnectFrom(A)}serialize(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A.uniqueId=this.uniqueId,A.name=this.name,A._connectionType=this._connectionType,A.connectedPointIds=[],A.className=this.getClassName();for(const X of this._connectedPoint)A.connectedPointIds.push(X.uniqueId)}getClassName(){return"FGConnection"}deserialize(A){this.uniqueId=A.uniqueId,this.name=A.name,this._connectionType=A._connectionType,this.connectedPointIds=A.connectedPointIds}}},12661:(A,X,s)=>{"use strict";s.d(X,{e:()=>J});var N,f=s(454),E=s(657),g=s(666),K=s(624),r=s(12669),i=s(12689),Y=s(470);!function(A){A.ExecuteBlock="ExecuteBlock",A.ExecuteEvent="ExecuteEvent",A.TriggerConnection="TriggerConnection",A.ContextVariableSet="ContextVariableSet",A.GlobalVariableSet="GlobalVariableSet",A.GlobalVariableDelete="GlobalVariableDelete",A.GlobalVariableGet="GlobalVariableGet",A.AddConnection="AddConnection",A.GetConnectionValue="GetConnectionValue",A.SetConnectionValue="SetConnectionValue",A.ActivateSignal="ActivateSignal",A.ContextVariableGet="ContextVariableGet"}(N||(N={}));class v{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(A){if(A.time||(A.time=Date.now()),this.log.push(A),this.logToConsole){var X;const s=null===(X=A.payload)||void 0===X?void 0:X.value;"object"===typeof s&&s.getClassName?Y.b.Log(`[FGLog] ${A.className}:${A.uniqueId.split("-")[0]} ${A.action} - ${JSON.stringify(s.getClassName())}: ${s.toString()}`):Y.b.Log(`[FGLog] ${A.className}:${A.uniqueId.split("-")[0]} ${A.action} - ${JSON.stringify(A.payload)}`)}}getItemsOfType(A){return this.log.filter((X=>X.action===A))}}class c{get enableLogging(){return this._enableLogging}set enableLogging(A){this._enableLogging!==A&&(this._enableLogging=A,this._enableLogging?(this.logger=new v,this.logger.logToConsole=!0):this.logger=null)}constructor(A){this.uniqueId=(0,K.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new f.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=A,this.assetsContext=A.assetsContext??A.eg}hasVariable(A){return A in this._userVariables}setVariable(A,X){var s;this._userVariables[A]=X,null===(s=this.logger)||void 0===s||s.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:A,value:X}})}getAsset(A,X){return(0,i.b)(this.assetsContext,A,X)}getVariable(A){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:A,value:this._userVariables[A]}}),this._userVariables[A]}get userVariables(){return this._userVariables}va(){return this._configuration.eg}_getUniqueIdPrefixedName(A,X){return`${A.uniqueId}_${X}`}_getGlobalContextVariable(A,X){var s;return null===(s=this.logger)||void 0===s||s.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:A,defaultValue:X,possibleValue:this._globalContextVariables[A]}}),this._hasGlobalContextVariable(A)?this._globalContextVariables[A]:X}_setGlobalContextVariable(A,X){var s;null===(s=this.logger)||void 0===s||s.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:A,value:X}}),this._globalContextVariables[A]=X}_deleteGlobalContextVariable(A){var X;null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:A}}),delete this._globalContextVariables[A]}_hasGlobalContextVariable(A){return A in this._globalContextVariables}_setExecutionVariable(A,X,s){this._executionVariables[this._getUniqueIdPrefixedName(A,X)]=s}_getExecutionVariable(A,X,s){return this._hasExecutionVariable(A,X)?this._executionVariables[this._getUniqueIdPrefixedName(A,X)]:s}_deleteExecutionVariable(A,X){delete this._executionVariables[this._getUniqueIdPrefixedName(A,X)]}_hasExecutionVariable(A,X){return this._getUniqueIdPrefixedName(A,X)in this._executionVariables}_hasConnectionValue(A){return A.uniqueId in this._connectionValues}_setConnectionValue(A,X){var s;this._connectionValues[A.uniqueId]=X,null===(s=this.logger)||void 0===s||s.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:A.uniqueId,value:X}})}_setConnectionValueByKey(A,X){this._connectionValues[A]=X}_getConnectionValue(A){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:A.uniqueId,value:this._connectionValues[A.uniqueId]}}),this._connectionValues[A.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(A){this._pendingBlocks.includes(A)||(this._pendingBlocks.push(A),this._pendingBlocks.sort(((A,X)=>A.priority-X.priority)))}_removePendingBlock(A){const X=this._pendingBlocks.indexOf(A);-1!==X&&this._pendingBlocks.splice(X,1)}_clearPendingBlocks(){for(const A of this._pendingBlocks)A._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(A){var X;this.onNodeExecutedObservable.notifyObservers(A),null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:A.getClassName(),uniqueId:A.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(A){this._setGlobalContextVariable("timeSinceStart",A.timeSinceStart),this._setGlobalContextVariable("deltaTime",A.deltaTime);for(const s of this._pendingBlocks){var X;null===(X=s._executeOnTick)||void 0===X||X.call(s,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.g;A.uniqueId=this.uniqueId,A._userVariables={};for(const N in this._userVariables)X(N,this._userVariables[N],A._userVariables);A._connectionValues={};for(const N in this._connectionValues)X(N,this._connectionValues[N],A._connectionValues);var s;this.assetsContext!==this.va()&&(A._assetsContext={meshes:this.assetsContext.meshes.map((A=>A.id)),materials:this.assetsContext.materials.map((A=>A.id)),textures:this.assetsContext.textures.map((A=>A.name)),animations:this.assetsContext.animations.map((A=>A.name)),lights:this.assetsContext.lights.map((A=>A.id)),cameras:this.assetsContext.cameras.map((A=>A.id)),lm:null===(s=this.assetsContext.lm)||void 0===s?void 0:s.map((A=>A.name)),skeletons:this.assetsContext.skeletons.map((A=>A.id)),ri:this.assetsContext.ri.map((A=>A.name)),geometries:this.assetsContext.geometries.map((A=>A.id)),multiMaterials:this.assetsContext.multiMaterials.map((A=>A.id)),transformNodes:this.assetsContext.transformNodes.map((A=>A.id))})}getClassName(){return"FlowGraphContext"}}(0,E.e)([(0,g.M)()],c.prototype,"uniqueId",void 0);var M=s(12696),d=s(2450);class Q{constructor(A){this.onEventTriggeredObservable=new f.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=A,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ji.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const A=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:A}}),this._startingTime+=A})),this._meshPickedObserver=this._scene.onPointerObservable.add((A=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:A})}),d.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((A=>{const X=A.pointerId,s=A.mesh,N=this._pointerUnderMeshState[X];!N&&s?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:X,mesh:s}}):N&&!s?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:X,mesh:N}}):N&&s&&N!==s&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:X,mesh:N,over:s}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:X,mesh:s,out:N}})),this._pointerUnderMeshState[X]=s}),d.b.POINTERMOVE)}dispose(){var A,X,s,N,f;null===(A=this._sceneDisposeObserver)||void 0===A||A.remove(),null===(X=this._sceneReadyObserver)||void 0===X||X.remove(),null===(s=this._sceneOnBeforeRenderObserver)||void 0===s||s.remove(),null===(N=this._meshPickedObserver)||void 0===N||N.remove(),null===(f=this._meshUnderPointerObserver)||void 0===f||f.remove(),this.onEventTriggeredObservable.clear()}}var w,R=s(12706);!function(A){A[A.Stopped=0]="Stopped",A[A.Started=1]="Started"}(w||(w={}));class C{get state(){return this._state}set state(A){this._state=A,this.onStateChangedObservable.notifyObservers(A)}constructor(A){this.onStateChangedObservable=new f.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=A.eg,this._sceneEventCoordinator=new Q(this._scene),this._coordinator=A.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((A=>{for(const X of this._executionContexts){const s=this._getContextualOrder(A.type,X);for(const N of s)if(!N._executeEvent(X,A.payload))break}switch(A.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const X of this._executionContexts)X._notifyOnTick(A.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const A=new c({eg:this._scene,coordinator:this._coordinator});return this._executionContexts.push(A),A}getContext(A){return this._executionContexts[A]}addEventBlock(A){if("PointerOver"!==A.type&&"PointerOut"!==A.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==A.type&&this._eventBlocks[A.type].push(A),1===this.state)for(const X of this._executionContexts)A._startPendingTasks(X);else this.onStateChangedObservable.addOnce((X=>{if(1===X)for(const s of this._executionContexts)A._startPendingTasks(s)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((A=>{1===A&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const A of this._executionContexts)for(const X in this._eventBlocks){const s=this._getContextualOrder(X,A);for(const X of s)X._startPendingTasks(A)}}_getContextualOrder(A,X){const s=this._eventBlocks[A].sort(((A,X)=>X.initPriority-A.initPriority));if("MeshPick"===A){const A=[];for(const N of s){const f=N.asset.getValue(X);let E=0;for(;E<s.length;E++){const A=s[E].asset.getValue(X);if(f&&A&&(0,R.o)(f,A))break}A.splice(E,0,N)}return A}return s}dispose(){var A;if(0!==this.state){this.state=0;for(const A of this._executionContexts)A._clearPendingBlocks();this._executionContexts.length=0;for(const A in this._eventBlocks)this._eventBlocks[A].length=0;null===(A=this._eventObserver)||void 0===A||A.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(A){const X=[],s=new Set;for(const N in this._eventBlocks)for(const A of this._eventBlocks[N])X.push(A),s.add(A.uniqueId);for(;X.length>0;){const N=X.pop();A(N);for(const A of N.dataInputs)for(const N of A._connectedPoint)s.has(N._ownerBlock.uniqueId)||(X.push(N._ownerBlock),s.add(N._ownerBlock.uniqueId));if(N instanceof M.c)for(const A of N.signalOutputs)for(const N of A._connectedPoint)s.has(N._ownerBlock.uniqueId)||(X.push(N._ownerBlock),s.add(N._ownerBlock.uniqueId))}}serialize(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1?arguments[1]:void 0;A.allBlocks=[],this.visitAllBlocks((X=>{const s={};X.serialize(s),A.allBlocks.push(s)})),A.executionContexts=[];for(const s of this._executionContexts){const N={};s.serialize(N,X),A.executionContexts.push(N)}}}class J{constructor(A){this.config=A,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.eg.Ji.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.eg.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const A=this._executeOnNextFrame.slice(0);if(A.length)for(const X of A){this.notifyCustomEvent(X.id,X.data,!1);const A=this._executeOnNextFrame.findIndex((A=>A.uniqueId===X.uniqueId));-1!==A&&this._executeOnNextFrame.splice(A,1)}}));(J.SceneCoordinators.get(this.config.eg)??[]).push(this)}createGraph(){const A=new C({eg:this.config.eg,coordinator:this});return this._flowGraphs.push(A),A}removeGraph(A){const X=this._flowGraphs.indexOf(A);-1!==X&&(A.dispose(),this._flowGraphs.splice(X,1))}start(){for(const A of this._flowGraphs)A.start()}dispose(){var A,X;for(const f of this._flowGraphs)f.dispose();this._flowGraphs.length=0,null===(A=this._disposeObserver)||void 0===A||A.remove(),null===(X=this._onBeforeRenderObserver)||void 0===X||X.remove();const s=J.SceneCoordinators.get(this.config.eg)??[],N=s.indexOf(this);-1!==N&&s.splice(N,1)}serialize(A,X){A._flowGraphs=[];for(const s of this._flowGraphs){const N={};s.serialize(N,X),A._flowGraphs.push(N)}A.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(A){let X=this._customEventsMap.get(A);return X||(X=new f.b,this._customEventsMap.set(A,X)),X}notifyCustomEvent(A,X){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:A,data:X,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(A)){const X=this._eventExecutionCounter.get(A);if(this._eventExecutionCounter.set(A,X+1),X>=J.MaxEventTypeExecutionPerFrame)return void(X===J.MaxEventTypeExecutionPerFrame&&Y.b.Warn(`FlowGraphCoordinator: Too many executions of event "${A}".`))}else this._eventExecutionCounter.set(A,1);const s=this._customEventsMap.get(A);s&&s.notifyObservers(X)}}J.MaxEventsPerType=30,J.MaxEventTypeExecutionPerFrame=30,J.SceneCoordinators=new Map},12709:(A,X,s)=>{"use strict";s.d(X,{e:()=>f});var N=s(12715);class f extends N.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(A){A._notifyExecuteNode(this),this.done._activateSignal(A)}}},12696:(A,X,s)=>{"use strict";s.d(X,{c:()=>K});var N=s(12701),f=s(12704),E=s(616);class g extends f.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(A){super.connectTo(A),this._connectedPoint.sort(((A,X)=>X.priority-A.priority))}_activateSignal(A){var X;if(null===(X=A.logger)||void 0===X||X.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)A._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(A,this),A._increaseExecutionId();else for(const s of this._connectedPoint)s._activateSignal(A)}}(0,E.f)("FlowGraphSignalConnection",g);class K extends N.e{constructor(A){super(A),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(A){const X=new g(A,0,this);return this.signalInputs.push(X),X}_registerSignalOutput(A){const X=new g(A,1,this);return this.signalOutputs.push(X),X}_unregisterSignalInput(A){const X=this.signalInputs.findIndex((X=>X.name===A));-1!==X&&(this.signalInputs[X].dispose(),this.signalInputs.splice(X,1))}_unregisterSignalOutput(A){const X=this.signalOutputs.findIndex((X=>X.name===A));-1!==X&&(this.signalOutputs[X].dispose(),this.signalOutputs.splice(X,1))}_reportError(A,X){this.error.payload="string"===typeof X?new Error(X):X,this.error._activateSignal(A)}getSignalInput(A){return this.signalInputs.find((X=>X.name===A))}getSignalOutput(A){return this.signalOutputs.find((X=>X.name===A))}serialize(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(A),A.signalInputs=[],A.signalOutputs=[];for(const X of this.signalInputs){const s={};X.serialize(s),A.signalInputs.push(s)}for(const X of this.signalOutputs){const s={};X.serialize(s),A.signalOutputs.push(s)}}deserialize(A){for(let X=0;X<A.signalInputs.length;X++){const s=this.getSignalInput(A.signalInputs[X].name);if(!s)throw new Error("Could not find signal input with name "+A.signalInputs[X].name+" in block "+A.className);s.deserialize(A.signalInputs[X])}for(let X=0;X<A.signalOutputs.length;X++){const s=this.getSignalOutput(A.signalOutputs[X].name);if(!s)throw new Error("Could not find signal output with name "+A.signalOutputs[X].name+" in block "+A.className);s.deserialize(A.signalOutputs[X])}}getClassName(){return"FlowGraphExecutionBlock"}}},12724:(A,X,s)=>{"use strict";s.d(X,{e:()=>f});var N=s(12696);class f extends N.c{constructor(A){super(A),this.out=this._registerSignalOutput("out")}}},12677:(A,X,s)=>{"use strict";s.d(X,{C:()=>b,D:()=>m,b:()=>i,c:()=>c,f:()=>z,g:()=>w,h:()=>R,k:()=>C,n:()=>v,p:()=>u,q:()=>Y,t:()=>M,u:()=>d,w:()=>Q,y:()=>y,z:()=>j});var N,f=s(678),E=s(709),g=s(12672),K=s(12680);!function(A){A.Any="any",A.String="string",A.Number="number",A.Boolean="boolean",A.Object="object",A.Integer="FlowGraphInteger",A.Vector2="Vector2",A.oi="oi",A.Vector4="Vector4",A.Quaternion="Quaternion",A.Matrix="Matrix",A.Matrix2D="Matrix2D",A.Matrix3D="Matrix3D",A.Ui="Ui",A.Vi="Vi"}(N||(N={}));class r{constructor(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=A,this.defaultValue=X,this.animationType=s}serialize(A){A.typeName=this.typeName,A.defaultValue=this.defaultValue}}const i=new r("any",void 0),Y=new r("string",""),v=new r("number",0,0),c=new r("boolean",!1),M=new r("Vector2",f.i.Zero(),5),d=new r("oi",f.k.Zero(),1),Q=new r("Vector4",f.m.Zero()),w=new r("Matrix",f.c.Identity(),3),R=new r("Matrix2D",new K.c),C=new r("Matrix3D",new K.f),J=new r("Ui",E.e.Black(),4),a=new r("Vi",new E.h(0,0,0,0),7),u=new r("Quaternion",f.d.Identity(),2);u.typeTransformer=A=>{if(A.getClassName){if("Vector4"===A.getClassName())return f.d.mi(A.zi());if("oi"===A.getClassName())return f.d.FromEulerVector(A);if("Matrix"===A.getClassName())return f.d.FromRotationMatrix(A)}return A};const z=new r("FlowGraphInteger",new g.e(0),0);function m(A){const X=A;switch(typeof A){case"string":return Y;case"number":return v;case"boolean":return c;case"object":if(X.getClassName)switch(X.getClassName()){case"Vector2":return M;case"oi":return d;case"Vector4":return Q;case"Matrix":return w;case"Ui":return J;case"Vi":return a;case"Quaternion":return u;case"FlowGraphInteger":return z;case"Matrix2D":return R;case"Matrix3D":return C}return i;default:return i}}function b(A){switch(A){case"string":return Y;case"number":return v;case"boolean":return c;case"Vector2":return M;case"oi":return d;case"Vector4":return Q;case"Matrix":return w;case"Ui":return J;case"Vi":return a;case"Quaternion":return u;case"FlowGraphInteger":return z;case"Matrix2D":return R;case"Matrix3D":return C;default:return i}}function y(A){switch(A){case"number":default:return 0;case"Vector2":return 5;case"oi":return 1;case"Matrix":return 3;case"Ui":return 4;case"Vi":return 7;case"Quaternion":return 2}}function j(A){switch(A){case 0:return v;case 5:return M;case 1:return d;case 3:return w;case 4:return J;case 7:return a;case 2:return u;default:return i}}},12669:(A,X,s)=>{"use strict";s.d(X,{e:()=>Y,g:()=>i,h:()=>v});var N=s(709),f=s(678),E=s(12672),g=s(12677),K=s(12680);function r(A){return"Vector2"===A||"oi"===A||"Vector4"===A||"Quaternion"===A||"Ui"===A||"Vi"===A}function i(A,X,s){var N;const f=(null===X||void 0===X||null===(N=X.getClassName)||void 0===N?void 0:N.call(X))??"";if(r(f)||function(A){return"Matrix"===A||"Matrix2D"===A||"Matrix3D"===A}(f))s[A]={value:X.zi(),className:f};else if("FlowGraphInteger"===f)s[A]={value:X.value,className:f};else if(f&&(X.id||X.name))s[A]={id:X.id,name:X.name,className:f};else{if("object"===typeof X)throw new Error(`Could not serialize value ${X}`);s[A]=X}}function Y(A,X,s,i){const v=X[A];let c;const M=(null===v||void 0===v?void 0:v.type)??(null===v||void 0===v?void 0:v.className);if(function(A){return"Mesh"===A||"AbstractMesh"===A||"GroundMesh"===A||"InstanceMesh"===A||"LinesMesh"===A||"GoldbergMesh"===A||"GreasedLineMesh"===A||"TrailMesh"===A}(M)){let A=i.meshes.filter((A=>v.id?A.id===v.id:A.name===v.name));0===A.length&&(A=i.transformNodes.filter((A=>v.id?A.id===v.id:A.name===v.name))),c=v.uniqueId?A.find((A=>A.uniqueId===v.uniqueId)):A[0]}else if(r(M))c=function(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===A)return f.i.mi(X);if("oi"===A)return s&&(X[2]*=-1),f.k.mi(X);if("Vector4"===A)return f.m.mi(X);if("Quaternion"===A)return s&&(X[2]*=-1,X[3]*=-1),f.d.mi(X);if("Ui"===A)return new N.e(X[0],X[1],X[2]);if("Vi"===A)return new N.h(X[0],X[1],X[2],X[3]);throw new Error(`Unknown vector class name ${A}`)}(M,v.value);else if(function(A){return"AnimationGroup"===A}(M)){const A=i.animationGroups.filter((A=>A.name===v.name));c=1===A.length?A[0]:A.find((A=>A.uniqueId===v.uniqueId))}else c="Matrix"===M?f.c.mi(v.value):"Matrix2D"===M?new K.c(v.value):"Matrix3D"===M?new K.f(v.value):"FlowGraphInteger"===M?E.e.FromValue(v.value):"number"===M||"string"===M||"boolean"===M?v.value[0]:v&&void 0!==v.value?v.value:Array.isArray(v)?v.reduce(((A,X)=>X.eventData?(A[X.id]={type:(0,g.C)(X.type)},"undefined"!==typeof X.value&&(A[X.id].value=Y("value",X,s,i)),A):A),{}):v;return c}function v(A){return"FlowGraphJsonPointerParserBlock"===A}},12706:(A,X,s)=>{"use strict";function N(A,X){return!(!A.parent||A.parent!==X&&!N(A.parent,X))}function f(A){if(A.getClassName)return A.getClassName()}function E(A,X){return A===X&&("Vector2"===A||"oi"===A||"Vector4"===A||"Quaternion"===A)}function g(A,X){return A===X&&("Matrix"===A||"Matrix2D"===A||"Matrix3D"===A)}function K(A,X){return"FlowGraphInteger"===A&&"FlowGraphInteger"===X}function r(A,X){const s="number"===typeof A||"number"===typeof(null===A||void 0===A?void 0:A.value);return s&&!X?!isNaN(i(A)):s}function i(A){return"number"===typeof A?A:A.value}s.d(X,{b:()=>K,f:()=>g,j:()=>E,l:()=>f,o:()=>N,s:()=>i,w:()=>r})},11986:(A,X,s)=>{"use strict";s.r(X),s.d(X,{SceneInstrumentation:()=>E});var N=s(456),f=s(2386);class E{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(A){A!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=A,A?(this._onBeforeActiveMeshesEvaluationObserver=this.eg.onBeforeActiveMeshesEvaluationObservable.add((()=>{N.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.eg.onAfterActiveMeshesEvaluationObservable.add((()=>{N.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.eg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.eg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(A){A!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=A,A?(this._onBeforeRenderTargetsRenderObserver=this.eg.onBeforeRenderTargetsRenderObservable.add((()=>{N.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.eg.onAfterRenderTargetsRenderObservable.add((()=>{N.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.eg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.eg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(A){A!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=A,A?(this._onBeforeParticlesRenderingObserver=this.eg.onBeforeParticlesRenderingObservable.add((()=>{N.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.eg.onAfterParticlesRenderingObservable.add((()=>{N.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.eg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.eg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(A){A!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=A,this.eg.spriteManagers&&(A?(this._onBeforeSpritesRenderingObserver=this.eg.onBeforeSpritesRenderingObservable.add((()=>{N.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.eg.onAfterSpritesRenderingObservable.add((()=>{N.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.eg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.eg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(A){A!==this._capturePhysicsTime&&this.eg.onBeforePhysicsObservable&&(this._capturePhysicsTime=A,A?(this._onBeforePhysicsObserver=this.eg.onBeforePhysicsObservable.add((()=>{N.d.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.eg.onAfterPhysicsObservable.add((()=>{N.d.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.eg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.eg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(A){A!==this._captureAnimationsTime&&(this._captureAnimationsTime=A,A?this._onAfterAnimationsObserver=this.eg.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.eg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(A){this._captureFrameTime=A}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(A){this._captureInterFrameTime=A}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(A){A!==this._captureRenderTime&&(this._captureRenderTime=A,A?(this._onBeforeDrawPhaseObserver=this.eg.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),N.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.eg.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),N.d.EndPerformanceCounter("Main render")}))):(this.eg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.eg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(A){A!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=A,A?(this._onBeforeCameraRenderObserver=this.eg.onBeforeCameraRenderObservable.add((A=>{this._cameraRenderTime.beginMonitoring(),N.d.StartPerformanceCounter(`Rendering camera ${A.name}`)})),this._onAfterCameraRenderObserver=this.eg.onAfterCameraRenderObservable.add((A=>{this._cameraRenderTime.endMonitoring(!1),N.d.EndPerformanceCounter(`Rendering camera ${A.name}`)}))):(this.eg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.eg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.eg.getEngine()._drawCalls}constructor(A){this.eg=A,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new f.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new f.d,this._captureFrameTime=!1,this._frameTime=new f.d,this._captureRenderTime=!1,this._renderTime=new f.d,this._captureInterFrameTime=!1,this._interFrameTime=new f.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new f.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new f.d,this._capturePhysicsTime=!1,this._physicsTime=new f.d,this._captureAnimationsTime=!1,this._animationsTime=new f.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new f.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=A.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(N.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.eg.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=A.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(N.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ii(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ii(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ii(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ii(),this._captureRenderTime&&this._renderTime.Ii(),this._captureCameraRenderTime&&this._cameraRenderTime.Ii()}))}dispose(){this._disposed||(this.eg.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.eg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.eg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.eg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.eg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.eg.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.eg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.eg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.eg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.eg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.eg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.eg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.eg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.eg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.eg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.eg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.eg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.eg=null,this._disposed=!0)}}},12659:(A,X,s)=>{"use strict";s.d(X,{e:()=>Y});var N=s(657),f=s(666),E=s(678),g=s(705),K=s(12599),r=s(12624),i=s(616);g.c.AddNodeConstructor("Light_Type_1",((A,X)=>()=>new Y(A,E.k.Zero(),X)));class Y extends r.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(A){this._shadowFrustumSize=A,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(A){this._shadowOrthoScale=A,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(A){this._orthoLeft=A}get orthoRight(){return this._orthoRight}set orthoRight(A){this._orthoRight=A}get orthoTop(){return this._orthoTop}set orthoTop(A){this._orthoTop=A}get orthoBottom(){return this._orthoBottom}set orthoBottom(A){this._orthoBottom=A}constructor(A,X,s){super(A,s),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=X.scale(-1),this.direction=X}getClassName(){return"hb"}getTypeID(){return K.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(A,X,s){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(A):this._setDefaultAutoExtendShadowProjectionMatrix(A,X,s)}_setDefaultFixedFrustumShadowProjectionMatrix(A){const X=this.va().activeCamera;X&&E.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:X.ui,void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,A,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(A,X,s){const N=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const A=E.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let N=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let g=0;g<s.length;g++){const K=s[g];if(!K)continue;const r=K.getBoundingInfo().boundingBox;for(let s=0;s<r.vectorsWorld.length;s++)E.k.TransformCoordinatesToRef(r.vectorsWorld[s],X,A),A.x<this._orthoLeft&&(this._orthoLeft=A.x),A.y<this._orthoBottom&&(this._orthoBottom=A.y),A.x>this._orthoRight&&(this._orthoRight=A.x),A.y>this._orthoTop&&(this._orthoTop=A.y),this.autoCalcShadowZBounds&&(A.z<N&&(N=A.z),A.z>f&&(f=A.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=N,this._shadowMaxZ=f)}const f=this._orthoRight-this._orthoLeft,g=this._orthoTop-this._orthoBottom,K=void 0!==this.shadowMinZ?this.shadowMinZ:(null===N||void 0===N?void 0:N.ui)||0,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===N||void 0===N?void 0:N.maxZ)||1e4,i=this.va().getEngine().useReverseDepthBuffer;E.c.OrthoOffCenterLHToRef(this._orthoLeft-f*this.shadowOrthoScale,this._orthoRight+f*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,i?r:K,i?K:r,A,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(A,X){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,X),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,X),this)}transferToNodeMaterialEffect(A,X){return this.computeTransformedInformation()?(A.setFloat3(X,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(A.setFloat3(X,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(A){const X=this._scene.getEngine();return!X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}getDepthMaxZ(A){const X=this._scene.getEngine();return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}prepareLightSpecificDefines(A,X){A["DIRLIGHT"+X]=!0}}(0,N.e)([(0,f.M)()],Y.prototype,"shadowFrustumSize",null),(0,N.e)([(0,f.M)()],Y.prototype,"shadowOrthoScale",null),(0,N.e)([(0,f.M)()],Y.prototype,"autoUpdateExtends",void 0),(0,N.e)([(0,f.M)()],Y.prototype,"autoCalcShadowZBounds",void 0),(0,N.e)([(0,f.M)("orthoLeft")],Y.prototype,"_orthoLeft",void 0),(0,N.e)([(0,f.M)("orthoRight")],Y.prototype,"_orthoRight",void 0),(0,N.e)([(0,f.M)("orthoTop")],Y.prototype,"_orthoTop",void 0),(0,N.e)([(0,f.M)("orthoBottom")],Y.prototype,"_orthoBottom",void 0),(0,i.f)("BABYLON.DirectionalLight",Y)},12943:(A,X,s)=>{"use strict";s.d(X,{b:()=>Y});var N=s(657),f=s(666),E=s(678),g=s(709),K=s(705),r=s(12599),i=s(616);K.c.AddNodeConstructor("Light_Type_3",((A,X)=>()=>new Y(A,E.k.Zero(),X)));class Y extends r.b{constructor(A,X,s){super(A,s),this.groundColor=new g.e(0,0,0),this.direction=X||E.k.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(A){return this.direction=E.k.Normalize(A.Pg(E.k.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(A,X){const s=E.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",s.x,s.y,s.z,0,X),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Il),X),this}transferToNodeMaterialEffect(A,X){const s=E.k.Normalize(this.direction);return A.setFloat3(X,s.x,s.y,s.z),this}si(){return this._worldMatrix||(this._worldMatrix=E.c.Identity()),this._worldMatrix}getTypeID(){return r.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(A,X){A["HEMILIGHT"+X]=!0}}(0,N.e)([(0,f.k)()],Y.prototype,"groundColor",void 0),(0,N.e)([(0,f.K)()],Y.prototype,"direction",void 0),(0,i.f)("BABYLON.HemisphericLight",Y)},12599:(A,X,s)=>{"use strict";s.d(X,{b:()=>c});var N=s(657),f=s(666),E=s(678),g=s(709),K=s(705),r=s(821),i=s(616),Y=s(834),v=s(707);class c extends K.c{get range(){return this._range}set range(A){this._range=A,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(A){this._intensityMode=A,this._computePhotometricScale()}get radius(){return this._radius}set radius(A){this._radius=A,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(A){this._shadowEnabled!==A&&(this._shadowEnabled=A,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(A){this._includedOnlyMeshes=A,this._hookArrayForIncludedOnly(A)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(A){this._excludedMeshes=A,this._hookArrayForExcluded(A)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(A){this._excludeWithLayerMask=A,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(A){this._includeOnlyWithLayerMask=A,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(A){this._lightmapMode!==A&&(this._lightmapMode=A,this._markMeshesAsLightDirty())}getViewMatrix(A){return null}getProjectionMatrix(A,X){return null}constructor(A,X){super(A,X,!1),this.Qk=new g.e(1,1,1),this.dj=new g.e(1,1,1),this.falloffType=c.FALLOFF_DEFAULT,this.Il=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=c.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new r.b(this.va().getEngine(),void 0,void 0,A),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(A,X){return this}_bindLight(A,X,s,N){let f=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const E=A.toString();let K=!1;if(this._uniformBuffer.bindToEffect(s,"Light"+E),this._renderId!==X.getRenderId()||this._lastUseSpecular!==N||!this._uniformBuffer.useUbo){this._renderId=X.getRenderId(),this._lastUseSpecular=N;const A=this.getScaledIntensity();this.transferToEffect(s,E),this.Qk.scaleToRef(A,g.l.Ui[0]),this._uniformBuffer.updateColor4("vLightDiffuse",g.l.Ui[0],this.range,E),N&&(this.dj.scaleToRef(A,g.l.Ui[1]),this._uniformBuffer.updateColor4("vLightSpecular",g.l.Ui[1],this.radius,E)),K=!0}if(this.transferTexturesToEffect(s,E),X.shadowsEnabled&&this.shadowEnabled&&f){const A=this.getShadowGenerator(X.activeCamera)??this.getShadowGenerator();A&&(A.bindShadowLight(E,s),K=!0)}K?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(A){let X="Name: "+this.name;if(X+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let s=0;s<this.animations.length;s++)X+=", animation[0]: "+this.animations[s].toString(A);return X}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}ci(A){super.ci(A),this._resyncMeshes()}getShadowGenerator(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(A)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return E.k.Zero()}canAffectMesh(A){return!A||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(A))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(A))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&A.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&A.layerMask)))}dispose(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const A=this._shadowGenerators.values();for(let X=A.next();!0!==X.done;X=A.next()){X.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const A=this._parentContainer.lights.indexOf(this);A>-1&&this._parentContainer.lights.splice(A,1),this._parentContainer=null}for(const s of this.va().meshes)s._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(A,X)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Il}clone(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=c.GetConstructorFromName(this.getTypeID(),A,this.va());if(!s)return null;const N=v.c.Clone(s,this);return A&&(N.name=A),X&&(N.parent=X),N.ci(this.isEnabled()),this.onClonedObservable.notifyObservers(N),N}serialize(){const A=v.c.Serialize(this);if(A.uniqueId=this.uniqueId,A.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(A),this.excludedMeshes.length>0){A.excludedMeshesIds=[];for(const X of this.excludedMeshes)A.excludedMeshesIds.push(X.id)}if(this.includedOnlyMeshes.length>0){A.includedOnlyMeshesIds=[];for(const X of this.includedOnlyMeshes)A.includedOnlyMeshesIds.push(X.id)}return v.c.AppendSerializedAnimations(this,A),A.ranges=this.serializeAnimationRanges(),A.isEnabled=this.isEnabled(),A}static GetConstructorFromName(A,X,s){const N=K.c.Construct("Light_Type_"+A,X,s);return N||null}static Parse(A,X){const s=c.GetConstructorFromName(A.type,A.name,X);if(!s)return null;const N=v.c.Parse(s,A,X);if(A.excludedMeshesIds&&(N._excludedMeshesIds=A.excludedMeshesIds),A.includedOnlyMeshesIds&&(N._includedOnlyMeshesIds=A.includedOnlyMeshesIds),void 0!==A.parentId&&(N._waitingParentId=A.parentId),void 0!==A.parentInstanceIndex&&(N._waitingParentInstanceIndex=A.parentInstanceIndex),void 0!==A.falloffType&&(N.falloffType=A.falloffType),void 0!==A.lightmapMode&&(N.lightmapMode=A.lightmapMode),A.animations){for(let X=0;X<A.animations.length;X++){const s=A.animations[X],f=(0,i.d)("BABYLON.Animation");f&&N.animations.push(f.Parse(s))}K.c.ParseAnimationRanges(N,A,X)}return A.autoAnimate&&X.beginAnimation(N,A.autoAnimateFrom,A.autoAnimateTo,A.autoAnimateLoop,A.autoAnimateSpeed||1),void 0!==A.isEnabled&&N.ci(A.isEnabled),N}_hookArrayForExcluded(A){var X=this;const s=A.push;A.push=function(){for(var N=arguments.length,f=new Array(N),E=0;E<N;E++)f[E]=arguments[E];const g=s.apply(A,f);for(const A of f)A._resyncLightSource(X);return g};const N=A.splice;A.splice=(X,s)=>{const f=N.apply(A,[X,s]);for(const A of f)A._resyncLightSource(this);return f};for(const f of A)f._resyncLightSource(this)}_hookArrayForIncludedOnly(A){var X=this;const s=A.push;A.push=function(){for(var N=arguments.length,f=new Array(N),E=0;E<N;E++)f[E]=arguments[E];const g=s.apply(A,f);return X._resyncMeshes(),g};const N=A.splice;A.splice=(X,s)=>{const f=N.apply(A,[X,s]);return this._resyncMeshes(),f},this._resyncMeshes()}_resyncMeshes(){for(const A of this.va().meshes)A._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const A of this.va().meshes)-1!==A.lightSources.indexOf(this)&&A._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let A=0;const X=this.getTypeID();let s=this.intensityMode;switch(s===c.INTENSITYMODE_AUTOMATIC&&(s=X===c.LIGHTTYPEID_DIRECTIONALLIGHT?c.INTENSITYMODE_ILLUMINANCE:c.INTENSITYMODE_LUMINOUSINTENSITY),X){case c.LIGHTTYPEID_POINTLIGHT:case c.LIGHTTYPEID_SPOTLIGHT:switch(s){case c.INTENSITYMODE_LUMINOUSPOWER:A=1/(4*Math.PI);break;case c.INTENSITYMODE_LUMINOUSINTENSITY:A=1;break;case c.INTENSITYMODE_LUMINANCE:A=this.radius*this.radius}break;case c.LIGHTTYPEID_DIRECTIONALLIGHT:switch(s){case c.INTENSITYMODE_ILLUMINANCE:A=1;break;case c.INTENSITYMODE_LUMINANCE:{let X=this.radius;X=Math.max(X,.001);A=2*Math.PI*(1-Math.cos(X));break}}break;case c.LIGHTTYPEID_HEMISPHERICLIGHT:A=1}return A}_reorderLightsInScene(){const A=this.va();0!=this._renderPriority&&(A.requireLightSorting=!0),this.va().sortLightsByPriority()}_isReady(){return!0}}c.FALLOFF_DEFAULT=Y.b.FALLOFF_DEFAULT,c.FALLOFF_PHYSICAL=Y.b.FALLOFF_PHYSICAL,c.FALLOFF_GLTF=Y.b.FALLOFF_GLTF,c.FALLOFF_STANDARD=Y.b.FALLOFF_STANDARD,c.LIGHTMAP_DEFAULT=Y.b.LIGHTMAP_DEFAULT,c.LIGHTMAP_SPECULAR=Y.b.LIGHTMAP_SPECULAR,c.LIGHTMAP_SHADOWSONLY=Y.b.LIGHTMAP_SHADOWSONLY,c.INTENSITYMODE_AUTOMATIC=Y.b.INTENSITYMODE_AUTOMATIC,c.INTENSITYMODE_LUMINOUSPOWER=Y.b.INTENSITYMODE_LUMINOUSPOWER,c.INTENSITYMODE_LUMINOUSINTENSITY=Y.b.INTENSITYMODE_LUMINOUSINTENSITY,c.INTENSITYMODE_ILLUMINANCE=Y.b.INTENSITYMODE_ILLUMINANCE,c.INTENSITYMODE_LUMINANCE=Y.b.INTENSITYMODE_LUMINANCE,c.LIGHTTYPEID_POINTLIGHT=Y.b.LIGHTTYPEID_POINTLIGHT,c.LIGHTTYPEID_DIRECTIONALLIGHT=Y.b.LIGHTTYPEID_DIRECTIONALLIGHT,c.LIGHTTYPEID_SPOTLIGHT=Y.b.LIGHTTYPEID_SPOTLIGHT,c.LIGHTTYPEID_HEMISPHERICLIGHT=Y.b.LIGHTTYPEID_HEMISPHERICLIGHT,c.LIGHTTYPEID_RECT_AREALIGHT=Y.b.LIGHTTYPEID_RECT_AREALIGHT,(0,N.e)([(0,f.k)()],c.prototype,"diffuse",void 0),(0,N.e)([(0,f.k)()],c.prototype,"specular",void 0),(0,N.e)([(0,f.M)()],c.prototype,"falloffType",void 0),(0,N.e)([(0,f.M)()],c.prototype,"intensity",void 0),(0,N.e)([(0,f.M)()],c.prototype,"range",null),(0,N.e)([(0,f.M)()],c.prototype,"intensityMode",null),(0,N.e)([(0,f.M)()],c.prototype,"radius",null),(0,N.e)([(0,f.M)()],c.prototype,"_renderPriority",void 0),(0,N.e)([(0,f.c)("_reorderLightsInScene")],c.prototype,"renderPriority",void 0),(0,N.e)([(0,f.M)("shadowEnabled")],c.prototype,"_shadowEnabled",void 0),(0,N.e)([(0,f.M)("excludeWithLayerMask")],c.prototype,"_excludeWithLayerMask",void 0),(0,N.e)([(0,f.M)("includeOnlyWithLayerMask")],c.prototype,"_includeOnlyWithLayerMask",void 0),(0,N.e)([(0,f.M)("lightmapMode")],c.prototype,"_lightmapMode",void 0)},12624:(A,X,s)=>{"use strict";s.d(X,{d:()=>r});var N=s(657),f=s(666),E=s(678),g=s(12599),K=s(824);class r extends g.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=E.c.Identity(),this._projectionMatrix=E.c.Identity()}_setPosition(A){this._position=A}get position(){return this._position}set position(A){this._setPosition(A)}_setDirection(A){this._direction=A}get direction(){return this._direction}set direction(A){this._setDirection(A)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(A){this._shadowMinZ=A,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(A){this._shadowMaxZ=A,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=E.k.Zero()),E.k.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=E.k.Zero()),E.k.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(A){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(A){return this.direction=E.k.Normalize(A.Pg(this.position)),this.direction}getRotation(){this.direction.normalize();const A=E.k.Cross(this.direction,K.b.Y),X=E.k.Cross(A,this.direction);return E.k.RotationFromAxis(A,X,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=E.k.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}si(A){return!A&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=E.c.Identity()),E.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(A){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===A||void 0===A?void 0:A.ui)||0}getDepthMaxZ(A){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===A||void 0===A?void 0:A.maxZ)||1e4}setShadowProjectionMatrix(A,X,s){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(X,s,A):this._setDefaultShadowProjectionMatrix(A,X,s),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(A){const X=E.f.oi[0];let s=this.position;this.computeTransformedInformation()&&(s=this.transformedPosition),E.k.NormalizeToRef(this.getShadowDirection(A),X),1===Math.abs(E.k.Dot(X,E.k.Up()))&&(X.z=1e-13);const N=E.f.oi[1];return s.addToRef(X,N),E.c.LookAtLHToRef(s,N,E.k.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(A,X){return this.setShadowProjectionMatrix(this._projectionMatrix,A??this._viewMatrix,X??[]),this._projectionMatrix}}(0,N.e)([(0,f.K)()],r.prototype,"position",null),(0,N.e)([(0,f.K)()],r.prototype,"direction",null),(0,N.e)([(0,f.M)()],r.prototype,"shadowMinZ",null),(0,N.e)([(0,f.M)()],r.prototype,"shadowMaxZ",null)},12615:(A,X,s)=>{"use strict";s.d(X,{c:()=>v});var N=s(657),f=s(666),E=s(678),g=s(705),K=s(12599),r=s(12624),i=s(2281),Y=s(616);g.c.AddNodeConstructor("Light_Type_2",((A,X)=>()=>new v(A,E.k.Zero(),E.k.Zero(),0,0,X)));class v extends r.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(A){this._iesProfileTexture!==A&&(this._iesProfileTexture=A,this._iesProfileTexture&&v._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(A){this._angle=A,this._cosHalfAngle=Math.cos(.5*A),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(A){this._innerAngle=A,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(A){this._shadowAngleScale=A,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(A){this._projectionTextureLightNear=A,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(A){this._projectionTextureLightFar=A,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(A){this._projectionTextureUpDirection=A,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(A){this._projectionTexture!==A&&(this._projectionTexture=A,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(v._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):v._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(A){return void 0!==A.onGeneratedObservable}static _IsTexture(A){return void 0!==A.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(A){this._projectionTextureProjectionLightMatrix=A,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(A,X,s,N,f,g){super(A,g),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=E.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=E.k.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=E.k.Zero(),this._projectionTextureViewLightMatrix=E.c.Zero(),this._projectionTextureProjectionLightMatrix=E.c.Zero(),this._projectionTextureScalingMatrix=E.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=X,this.direction=s,this.angle=N,this.exponent=f}getClassName(){return"SpotLight"}getTypeID(){return K.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(A){super._setDirection(A),this._projectionTextureViewLightDirty=!0}_setPosition(A){super._setPosition(A),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(A,X,s){const N=this.va().activeCamera;if(!N)return;this._shadowAngleScale=this._shadowAngleScale||1;const f=this._shadowAngleScale*this._angle,g=void 0!==this.shadowMinZ?this.shadowMinZ:N.ui,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,r=this.va().getEngine().useReverseDepthBuffer;E.c.PerspectiveFovLHToRef(f,1,r?K:g,r?g:K,A,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),E.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const A=this.projectionTextureLightFar,X=this.projectionTextureLightNear,s=A/(A-X),N=-s*X,f=1/Math.tan(this._angle/2);E.c.FromValuesToRef(f/1,0,0,0,0,f,0,0,0,0,s,1,0,0,N,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof i.d){const A=this._projectionTexture.uScale/2,X=this._projectionTexture.vScale/2;E.c.FromValuesToRef(A,0,0,0,0,X,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(A,X){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),A.setMatrix("textureProjectionMatrix"+X,this._projectionTextureMatrix),A.setTexture("projectionLightTexture"+X,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&A.setTexture("iesLightTexture"+X,this._iesProfileTexture),this}transferToEffect(A,X){let s;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,X),s=E.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,X),s=E.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",s.x,s.y,s.z,this._cosHalfAngle,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,X),this}transferToNodeMaterialEffect(A,X){let s;return s=this.computeTransformedInformation()?E.k.Normalize(this.transformedDirection):E.k.Normalize(this.direction),this.va().useRightHandedSystem?A.setFloat3(X,-s.x,-s.y,-s.z):A.setFloat3(X,s.x,s.y,s.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(A){const X=this._scene.getEngine(),s=void 0!==this.shadowMinZ?this.shadowMinZ:(null===A||void 0===A?void 0:A.ui)??0;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?s:this._scene.getEngine().isNDCHalfZRange?0:s}getDepthMaxZ(A){const X=this._scene.getEngine(),s=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===A||void 0===A?void 0:A.maxZ)??1e4;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:s}prepareLightSpecificDefines(A,X){A["SPOTLIGHT"+X]=!0,A["PROJECTEDLIGHTTEXTURE"+X]=!(!this.projectionTexture||!this.projectionTexture.isReady()),A["IESLIGHTTEXTURE"+X]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,N.e)([(0,f.M)()],v.prototype,"angle",null),(0,N.e)([(0,f.M)()],v.prototype,"innerAngle",null),(0,N.e)([(0,f.M)()],v.prototype,"shadowAngleScale",null),(0,N.e)([(0,f.M)()],v.prototype,"exponent",void 0),(0,N.e)([(0,f.M)()],v.prototype,"projectionTextureLightNear",null),(0,N.e)([(0,f.M)()],v.prototype,"projectionTextureLightFar",null),(0,N.e)([(0,f.M)()],v.prototype,"projectionTextureUpDirection",null),(0,N.e)([(0,f.G)("projectedLightTexture")],v.prototype,"_projectionTexture",void 0),(0,Y.f)("BABYLON.SpotLight",v)},12317:(A,X,s)=>{"use strict";s.d(X,{e:()=>g,h:()=>E,k:()=>K});const N={},f={};function E(A,X){N[A]=X}function g(A,X){f[A]=X}function K(A){return f[A]?f[A]:null}},12218:(A,X,s)=>{"use strict";s.d(X,{b:()=>m,e:()=>U});var N,f=s(456),E=s(454),g=s(2418),K=s(503),r=s(470),i=s(788),Y=s(508),v=s(517),c=s(624),M=s(547),d=s(499);!function(A){A[A.Clean=0]="Clean",A[A.Stop=1]="Stop",A[A.Sync=2]="Sync",A[A.NoSync=3]="NoSync"}(N||(N={}));const Q=new E.b,w={};let R=!1;function C(){return w[".babylon"]}function J(A,X){const s=w[A];return s||(r.b.Warn("Unable to find a plugin to load "+A+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),X?C():void 0)}function a(A,X,s){let N="Unable to load from "+(A.rawData?"binary data":A.url);return X?N+=`: ${X}`:s&&(N+=`: ${s}`),N}async function u(A,X,s,N,f,E,g,K,r){var i;const v="data:"===(c=A.url).substring(0,5)?c.substring(5):null;var c;if(A.rawData&&!g)throw"When using ArrayBufferView to load data the file extension must be provided.";const R=v||g?"":function(A){const X=A.indexOf("?");-1!==X&&(A=A.substring(0,X));const s=A.lastIndexOf(".");return A.substring(s,A.length).toLowerCase()}(A.url);let a=g?J(g,!0):v?function(A){for(const X in w){const s=w[X].plugin;if(s.canDirectLoad&&s.canDirectLoad(A))return w[X]}return C()}(A.url):J(R,!1);if(!a&&R){if(A.url&&!A.url.startsWith("blob:")){const X=await async function(A,X){const s=X.method||"GET";return await new Promise(((N,f)=>{const E=new d.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const A={};if(X.responseHeaders)for(const s of X.responseHeaders)A[s]=E.getResponseHeader(s)||"";N({response:E.response,headerValues:A})}else f(`Unable to fetch data from ${A}. Error code: ${E.status}`)})),E.open(s,A),E.send()}))}(A.url,{method:"HEAD",responseHeaders:["Content-Type"]}),s=X.headerValues?X.headerValues["Content-Type"]:"";s&&(a=function(A){for(const X in w){const s=w[X];if(s.mimeType===A)return s}}(s))}a||(a=C())}if(!a)throw new Error(`No plugin or fallback for ${g??A.url}`);if(!1===(null===r||void 0===r||null===(i=r[a.plugin.name])||void 0===i?void 0:i.enabled))throw new Error(`The '${a.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(A.rawData&&!a.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(A=>{if(a.plugin.createPlugin){const X=a.plugin.createPlugin(r??{});return X instanceof Promise?(X.then(A).catch((A=>{f("Error instantiating plugin.",A)})),null):(A(X),X)}return A(a.plugin),a.plugin})((r=>{var i;if(!r)throw`The loader plugin corresponding to the '${g}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Q.notifyObservers(r),v&&(r.canDirectLoad&&r.canDirectLoad(A.url)||!(0,Y.h)(A.url))){if(r.directLoad){const A=r.directLoad(X,v);A instanceof Promise?A.then((A=>{s(r,A)})).catch((A=>{f("Error in directLoad of _loadData: "+A,A)})):s(r,A)}else s(r,v);return}const c=a.isBinary,d=(A,N)=>{X.u?f("Scene has been disposed"):s(r,A,N)};let w=null,R=!1;null===(i=r.Ji)||void 0===i||i.add((()=>{R=!0,w&&(w.abort(),w=null),E()}));const C=()=>{if(R)return;const s=(A,X)=>{f(null===A||void 0===A?void 0:A.statusText,X)};if(!r.loadFile&&A.rawData)throw"Plugin does not support loading ArrayBufferView.";w=r.loadFile?r.loadFile(X,A.rawData||A.file||A.url,A.rootUrl,d,N,c,s,K):X._loadFile(A.file||A.url,d,N,!0,c,s)},J=X.getEngine();let u=J.enableOfflineSupport;if(u){let s=!1;for(const N of X.disableOfflineSupportExceptionRules)if(N.test(A.url)){s=!0;break}u=!s}u&&M.d.OfflineProviderFactory?X.offlineProvider=M.d.OfflineProviderFactory(A.url,C,J.disableManifestCheck):C()}))}function z(A,X){let s,N,E=null,g=null;if(X)if(X.name)s=`file:${X.name}`,N=X.name,E=X;else if(ArrayBuffer.isView(X))s="",N=(0,c.c)(),g=X;else if(X.startsWith("data:"))s=X,N="";else if(A){const E=X;if("/"===E.substring(0,1))return f.d.Error("Wrong sceneFilename parameter"),null;s=A+E,N=E}else s=X,N=f.d.GetFilename(X),A=f.d.GetFolderPath(X);else s=A,N=f.d.GetFilename(A),A=f.d.GetFolderPath(A);return{url:s,rootUrl:A,name:N,file:E,rawData:g}}function m(A){if("string"===typeof A.extensions){const X=A.extensions;w[X.toLowerCase()]={plugin:A,isBinary:!1}}else{const X=A.extensions,s=Object.keys(X);for(const N of s)w[N.toLowerCase()]={plugin:A,isBinary:X[N].isBinary,mimeType:X[N].mimeType}}}async function b(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.b.LastCreatedScene,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!N)return r.b.Error("No scene available to import mesh to"),null;const M=z(X,s);if(!M)return null;const d={};N.addPendingData(d);const Q=()=>{N.removePendingData(d)},w=(A,X)=>{const s=a(M,A,X);g?g(N,s,new v.h(s,v.e.SceneLoaderError,X)):r.b.Error(s),Q()},R=E?A=>{try{E(A)}catch(X){w("Error in onProgress callback: "+X,X)}}:void 0,C=(A,X,s,E,g,K,r,i)=>{if(N.importedMeshesFiles.push(M.url),f)try{f(A,X,s,E,g,K,r,i)}catch(Y){w("Error in onSuccess callback: "+Y,Y)}N.removePendingData(d)};return await u(M,N,((X,s,f)=>{if(X.rewriteRootURL&&(M.rootUrl=X.rewriteRootURL(M.rootUrl,f)),X.importMesh){const f=[],E=[],g=[];if(!X.importMesh(A,N,s,M.rootUrl,f,E,g,w))return;N.loadingPluginName=X.name,C(f,E,g,[],[],[],[],[])}else{X.importMeshAsync(A,N,s,M.rootUrl,R,M.name).then((A=>{N.loadingPluginName=X.name,C(A.meshes,A.ri,A.skeletons,A.animationGroups,A.transformNodes,A.geometries,A.lights,A.spriteManagers)})).catch((A=>{w(A.message,A)}))}}),R,w,Q,i,Y,c)}async function y(A,X,s,N,f,E,g,K){return await new Promise(((r,i)=>{try{b(A,X,s,N,((A,X,s,N,f,E,g,K)=>{r({meshes:A,ri:X,skeletons:s,animationGroups:N,transformNodes:f,geometries:E,lights:g,spriteManagers:K})}),f,((A,X,s)=>{i(s||new Error(X))}),E,g,K).catch(i)}catch(v){i(v)}}))}async function j(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedEngine,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};s?await V(A,X,new g.d(s),N,E,r,i,Y,v):f.d.Error("No engine available")}async function G(A,X,s,N,f,E,g){return await new Promise(((K,r)=>{j(A,X,s,(A=>{K(A)}),N,((A,X,s)=>{r(s||new Error(X))}),f,E,g)}))}async function V(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!s)return r.b.Error("No scene available to append to"),null;const M=z(A,X);if(!M)return null;const d={};s.addPendingData(d);const Q=()=>{s.removePendingData(d)};i.c.ShowLoadingScreen&&!R&&(R=!0,s.getEngine().displayLoadingUI(),s.executeWhenReady((()=>{s.getEngine().hideLoadingUI(),R=!1})));const w=(A,X)=>{const N=a(M,A,X);E?E(s,N,new v.h(N,v.e.SceneLoaderError,X)):r.b.Error(N),Q()},C=f?A=>{try{f(A)}catch(X){w("Error in onProgress callback",X)}}:void 0,J=()=>{if(N)try{N(s)}catch(A){w("Error in onSuccess callback",A)}s.removePendingData(d)};return await u(M,s,((A,X)=>{if(A.load){if(!A.load(s,X,M.rootUrl,w))return;s.loadingPluginName=A.name,J()}else{A.loadAsync(s,X,M.rootUrl,C,M.name).then((()=>{s.loadingPluginName=A.name,J()})).catch((A=>{w(A.message,A)}))}}),C,w,Q,g,Y,c)}async function D(A,X,s,N,f,E,g){return await new Promise(((K,r)=>{try{V(A,X,s,(A=>{K(A)}),N,((A,X,s)=>{r(s||new Error(X))}),f,E,g).catch(r)}catch(v){r(v)}}))}async function O(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!s)return r.b.Error("No scene available to load asset container to"),null;const c=z(A,X);if(!c)return null;const M={};s.addPendingData(M);const d=()=>{s.removePendingData(M)},Q=(A,X)=>{const N=a(c,A,X);E?E(s,N,new v.h(N,v.e.SceneLoaderError,X)):r.b.Error(N),d()},w=f?A=>{try{f(A)}catch(X){Q("Error in onProgress callback",X)}}:void 0,R=A=>{if(N)try{N(A)}catch(X){Q("Error in onSuccess callback",X)}s.removePendingData(M)};return await u(c,s,((A,X)=>{if(A.loadAssetContainer){const N=A.loadAssetContainer(s,X,c.rootUrl,Q);if(!N)return;N.populateRootNodes(),s.loadingPluginName=A.name,R(N)}else if(A.loadAssetContainerAsync){A.loadAssetContainerAsync(s,X,c.rootUrl,w,c.name).then((X=>{X.populateRootNodes(),s.loadingPluginName=A.name,R(X)})).catch((A=>{Q(A.message,A)}))}else Q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),w,Q,d,g,i,Y)}async function P(A,X,s,N,f,E,g){return await new Promise(((K,r)=>{try{O(A,X,s,(A=>{K(A)}),N,((A,X,s)=>{r(s||new Error(X))}),f,E,g).catch(r)}catch(v){r(v)}}))}async function l(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.b.LastCreatedScene,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",M=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!s)return void r.b.Error("No scene available to load animations to");if(N){for(const N of s.animatables)N.reset();s.stopAllAnimations();const A=s.animationGroups.slice();for(const s of A)s.dispose();const X=s.getNodes();for(const s of X)s.animations&&(s.animations=[])}else switch(f){case 0:const A=s.animationGroups.slice();for(const X of A)X.dispose();break;case 1:for(const X of s.animationGroups)X.stop();break;case 2:for(const X of s.animationGroups)X.reset(),X.restart();break;case 3:break;default:return void r.b.Error("Unknown animation group loading mode value '"+f+"'")}const d=s.animatables.length;await O(A,X,s,(A=>{A.mergeAnimationsTo(s,s.animatables.slice(d),E),A.dispose(),s.onAnimationFileImportedObservable.notifyObservers(s),g&&g(s)}),i,Y,v,c,M)}async function n(A,X,s,N,f,E,g,K,r,i){return await new Promise(((Y,c)=>{try{l(A,X,s,N,f,E,(A=>{Y(A)}),g,((A,X,s)=>{c(s||new Error(X))}),K,r,i).catch(c)}catch(v){c(v)}}))}class U{static get ForceFullSceneLoadingForIncremental(){return i.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(A){i.c.ForceFullSceneLoadingForIncremental=A}static get ShowLoadingScreen(){return i.c.ShowLoadingScreen}static set ShowLoadingScreen(A){i.c.ShowLoadingScreen=A}static get loggingLevel(){return i.c.loggingLevel}static set loggingLevel(A){i.c.loggingLevel=A}static get CleanBoneMatrixWeights(){return i.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(A){i.c.CleanBoneMatrixWeights=A}static GetDefaultPlugin(){return C()}static GetPluginForExtension(A){var X;return null===(X=J(A,!0))||void 0===X?void 0:X.plugin}static IsPluginForExtensionAvailable(A){return function(A){return!!w[A]}(A)}static RegisterPlugin(A){m(A)}static ImportMesh(A,X,s,N,f,E,g,r,i){b(A,X,s,N,f,E,g,r,i).catch((A=>null===g||void 0===g?void 0:g(K.b.LastCreatedScene,null===A||void 0===A?void 0:A.message,A)))}static async ImportMeshAsync(A,X,s,N,f,E,g){return await y(A,X,s,N,f,E,g)}static Load(A,X,s,N,f,E,g,r){j(A,X,s,N,f,E,g,r).catch((A=>null===E||void 0===E?void 0:E(K.b.LastCreatedScene,null===A||void 0===A?void 0:A.message,A)))}static async LoadAsync(A,X,s,N,f,E){return await G(A,X,s,N,f,E)}static Append(A,X,s,N,f,E,g,r){V(A,X,s,N,f,E,g,r).catch((A=>null===E||void 0===E?void 0:E(s??K.b.LastCreatedScene,null===A||void 0===A?void 0:A.message,A)))}static async AppendAsync(A,X,s,N,f,E){return await D(A,X,s,N,f,E)}static LoadAssetContainer(A,X,s,N,f,E,g,r){O(A,X,s,N,f,E,g,r).catch((A=>null===E||void 0===E?void 0:E(s??K.b.LastCreatedScene,null===A||void 0===A?void 0:A.message,A)))}static async LoadAssetContainerAsync(A,X,s,N,f,E){return await P(A,X,s,N,f,E)}static ImportAnimations(A,X,s,N,f,E,g,r,i,Y,v){l(A,X,s,N,f,E,g,r,i,Y,v).catch((A=>null===i||void 0===i?void 0:i(s??K.b.LastCreatedScene,null===A||void 0===A?void 0:A.message,A)))}static async ImportAnimationsAsync(A,X,s,N,f,E,g,K,r,i,Y){return await n(A,X,s,N,f,E,K,i,Y)}}U.NO_LOGGING=0,U.MINIMAL_LOGGING=1,U.SUMMARY_LOGGING=2,U.DETAILED_LOGGING=3,U.OnPluginActivatedObservable=Q},12581:(A,X,s)=>{"use strict";s.d(X,{c:()=>L});var N=s(657),f=s(666),E=s(470),g=s(672),K=s(12578),r=s(2418),i=s(678),Y=s(728),v=s(12129),c=s(12159);class M extends v.e{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class d extends c.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(A,"PBRBRDF",90,new M,X),this._useEnergyConservation=d.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=d.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=d.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=d.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=d.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=d.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=d.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=d.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=d.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=d.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=d.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=d.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=d.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=d.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=d.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=d.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=d.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=d.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=A._dirtyCallbacks[16],this._enable(!0)}prepareDefines(A){A.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,A.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,A.SPHERICAL_HARMONICS=this._useSphericalHarmonics,A.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,A.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,A.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,A.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,A.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,A.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}d.DEFAULT_USE_ENERGY_CONSERVATION=!0,d.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,d.DEFAULT_USE_SPHERICAL_HARMONICS=!0,d.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,d.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,d.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,d.DEFAULT_DIFFUSE_MODEL=0,d.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,d.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useEnergyConservation",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useSphericalHarmonics",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"mixIblRadianceWithIrradiance",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"useLegacySpecularEnergyConservation",void 0),(0,N.e)([(0,f.M)("baseDiffuseModel"),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"baseDiffuseModel",void 0),(0,N.e)([(0,f.M)("dielectricSpecularModel"),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"dielectricSpecularModel",void 0),(0,N.e)([(0,f.M)("conductorSpecularModel"),(0,f.c)("_markAllSubMeshesAsMiscDirty")],d.prototype,"conductorSpecularModel",void 0);var Q=s(12121),w=s(709),R=s(2426),C=s(826),J=s(12135),a=s(2281),u=s(12140),z=(s(2492),s(12146)),m=s(828);class b extends v.e{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class y extends c.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(A,"PBRClearCoat",100,new b,X),this._isEnabled=!1,this.isEnabled=!1,this.Il=1,this.roughness=0,this._indexOfRefraction=y._DefaultIndexOfRefraction,this.indexOfRefraction=y._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=w.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=A._dirtyCallbacks[1]}isReadyForSubMesh(A,X,s){if(!this._isEnabled)return!0;const N=this._material._disableBumpMap;if(A._areTexturesDirty&&X.texturesEnabled){if(this._texture&&u.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&u.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(s.getCaps().standardDerivatives&&this._bumpTexture&&u.b.ClearCoatBumpTextureEnabled&&!N&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&u.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(A,X){this._isEnabled?(A.CLEARCOAT=!0,A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,A.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,A._areTexturesDirty&&X.texturesEnabled&&(this._texture&&u.b.ClearCoatTextureEnabled?(0,m.V)(this._texture,A,"CLEARCOAT_TEXTURE"):A.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&u.b.ClearCoatTextureEnabled?(0,m.V)(this._textureRoughness,A,"CLEARCOAT_TEXTURE_ROUGHNESS"):A.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&u.b.ClearCoatBumpTextureEnabled?(0,m.V)(this._bumpTexture,A,"CLEARCOAT_BUMP"):A.CLEARCOAT_BUMP=!1,A.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===y._DefaultIndexOfRefraction,this._isTintEnabled?(A.CLEARCOAT_TINT=!0,this._tintTexture&&u.b.ClearCoatTintTextureEnabled?((0,m.V)(this._tintTexture,A,"CLEARCOAT_TINT_TEXTURE"),A.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):A.CLEARCOAT_TINT_TEXTURE=!1):(A.CLEARCOAT_TINT=!1,A.CLEARCOAT_TINT_TEXTURE=!1))):(A.CLEARCOAT=!1,A.CLEARCOAT_TEXTURE=!1,A.CLEARCOAT_TEXTURE_ROUGHNESS=!1,A.CLEARCOAT_BUMP=!1,A.CLEARCOAT_TINT=!1,A.CLEARCOAT_TINT_TEXTURE=!1,A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,A.CLEARCOAT_DEFAULTIOR=!1,A.CLEARCOAT_TEXTUREDIRECTUV=0,A.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,A.CLEARCOAT_BUMPDIRECTUV=0,A.CLEARCOAT_REMAP_F0=!1,A.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,A.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(A,X,s,N){if(!this._isEnabled)return;const f=N.materialDefines,E=this._material.isFrozen,g=this._material._disableBumpMap,K=this._material._invertNormalMapX,r=this._material._invertNormalMapY;if(!A.useUbo||!E||!A.isSync){var i,Y,v,c;if((this._texture||this._textureRoughness)&&u.b.ClearCoatTextureEnabled)A.updateFloat4("vClearCoatInfos",(null===(i=this._texture)||void 0===i?void 0:i.coordinatesIndex)??0,(null===(Y=this._texture)||void 0===Y?void 0:Y.level)??0,(null===(v=this._textureRoughness)||void 0===v?void 0:v.coordinatesIndex)??0,(null===(c=this._textureRoughness)||void 0===c?void 0:c.level)??0),this._texture&&(0,m.y)(this._texture,A,"clearCoat"),this._textureRoughness&&!f.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,m.y)(this._textureRoughness,A,"clearCoatRoughness");this._bumpTexture&&s.getCaps().standardDerivatives&&u.b.ClearCoatTextureEnabled&&!g&&(A.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,m.y)(this._bumpTexture,A,"clearCoatBump"),X._mirroredCameraPosition?A.updateFloat2("vClearCoatTangentSpaceParams",K?1:-1,r?1:-1):A.updateFloat2("vClearCoatTangentSpaceParams",K?-1:1,r?-1:1)),this._tintTexture&&u.b.ClearCoatTintTextureEnabled&&(A.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,m.y)(this._tintTexture,A,"clearCoatTint")),A.updateFloat2("vClearCoatParams",this.Il,this.roughness);const N=1-this._indexOfRefraction,E=1+this._indexOfRefraction,M=Math.pow(-N/E,2),d=1/this._indexOfRefraction;A.updateFloat4("vClearCoatRefractionParams",M,d,N,E),this._isTintEnabled&&(A.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),A.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}X.texturesEnabled&&(this._texture&&u.b.ClearCoatTextureEnabled&&A.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!f.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&u.b.ClearCoatTextureEnabled&&A.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&s.getCaps().standardDerivatives&&u.b.ClearCoatBumpTextureEnabled&&!g&&A.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&u.b.ClearCoatTintTextureEnabled&&A.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(A){return this._texture===A||(this._textureRoughness===A||(this._bumpTexture===A||this._tintTexture===A))}getActiveTextures(A){this._texture&&A.push(this._texture),this._textureRoughness&&A.push(this._textureRoughness),this._bumpTexture&&A.push(this._bumpTexture),this._tintTexture&&A.push(this._tintTexture)}getAnimatables(A){this._texture&&this._texture.animations&&this._texture.animations.length>0&&A.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&A.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&A.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&A.push(this._tintTexture)}dispose(A){var X,s,N,f;A&&(null===(X=this._texture)||void 0===X||X.dispose(),null===(s=this._textureRoughness)||void 0===s||s.dispose(),null===(N=this._bumpTexture)||void 0===N||N.dispose(),null===(f=this._tintTexture)||void 0===f||f.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(A,X,s){return A.CLEARCOAT_BUMP&&X.addFallback(s++,"CLEARCOAT_BUMP"),A.CLEARCOAT_TINT&&X.addFallback(s++,"CLEARCOAT_TINT"),A.CLEARCOAT&&X.addFallback(s++,"CLEARCOAT"),s}getSamplers(A){A.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}y._DefaultIndexOfRefraction=1.5,(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isEnabled",void 0),(0,N.e)([(0,f.M)()],y.prototype,"intensity",void 0),(0,N.e)([(0,f.M)()],y.prototype,"roughness",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"indexOfRefraction",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"texture",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRoughnessFromMainTexture",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"textureRoughness",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"remapF0OnInterfaceChange",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"bumpTexture",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isTintEnabled",void 0),(0,N.e)([(0,f.k)()],y.prototype,"tintColor",void 0),(0,N.e)([(0,f.M)()],y.prototype,"tintColorAtDistance",void 0),(0,N.e)([(0,f.M)()],y.prototype,"tintThickness",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"tintTexture",void 0);class j extends v.e{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class G extends c.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(A,"PBRIridescence",110,new j,X),this._isEnabled=!1,this.isEnabled=!1,this.Il=1,this.minimumThickness=G._DefaultMinimumThickness,this.maximumThickness=G._DefaultMaximumThickness,this.indexOfRefraction=G._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=A._dirtyCallbacks[1]}isReadyForSubMesh(A,X){if(!this._isEnabled)return!0;if(A._areTexturesDirty&&X.texturesEnabled){if(this._texture&&u.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&u.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(A,X){this._isEnabled?(A.IRIDESCENCE=!0,A._areTexturesDirty&&X.texturesEnabled&&(this._texture&&u.b.IridescenceTextureEnabled?(0,m.V)(this._texture,A,"IRIDESCENCE_TEXTURE"):A.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&u.b.IridescenceTextureEnabled?(0,m.V)(this._thicknessTexture,A,"IRIDESCENCE_THICKNESS_TEXTURE"):A.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(A.IRIDESCENCE=!1,A.IRIDESCENCE_TEXTURE=!1,A.IRIDESCENCE_THICKNESS_TEXTURE=!1,A.IRIDESCENCE_TEXTUREDIRECTUV=0,A.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(A,X){if(!this._isEnabled)return;const s=this._material.isFrozen;if(!A.useUbo||!s||!A.isSync){var N,f,E,g;if((this._texture||this._thicknessTexture)&&u.b.IridescenceTextureEnabled)A.updateFloat4("vIridescenceInfos",(null===(N=this._texture)||void 0===N?void 0:N.coordinatesIndex)??0,(null===(f=this._texture)||void 0===f?void 0:f.level)??0,(null===(E=this._thicknessTexture)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(g=this._thicknessTexture)||void 0===g?void 0:g.level)??0),this._texture&&(0,m.y)(this._texture,A,"iridescence"),this._thicknessTexture&&(0,m.y)(this._thicknessTexture,A,"iridescenceThickness");A.updateFloat4("vIridescenceParams",this.Il,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}X.texturesEnabled&&(this._texture&&u.b.IridescenceTextureEnabled&&A.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&u.b.IridescenceTextureEnabled&&A.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(A){return this._texture===A||this._thicknessTexture===A}getActiveTextures(A){this._texture&&A.push(this._texture),this._thicknessTexture&&A.push(this._thicknessTexture)}getAnimatables(A){this._texture&&this._texture.animations&&this._texture.animations.length>0&&A.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&A.push(this._thicknessTexture)}dispose(A){var X,s;A&&(null===(X=this._texture)||void 0===X||X.dispose(),null===(s=this._thicknessTexture)||void 0===s||s.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(A,X,s){return A.IRIDESCENCE&&X.addFallback(s++,"IRIDESCENCE"),s}getSamplers(A){A.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}G._DefaultMinimumThickness=100,G._DefaultMaximumThickness=400,G._DefaultIndexOfRefraction=1.3,(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,N.e)([(0,f.M)()],G.prototype,"intensity",void 0),(0,N.e)([(0,f.M)()],G.prototype,"minimumThickness",void 0),(0,N.e)([(0,f.M)()],G.prototype,"maximumThickness",void 0),(0,N.e)([(0,f.M)()],G.prototype,"indexOfRefraction",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"thicknessTexture",void 0);class V extends v.e{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class D extends c.c{set angle(A){this.direction.x=Math.cos(A),this.direction.y=Math.sin(A)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(A,"PBRAnisotropic",110,new V,X),this._isEnabled=!1,this.isEnabled=!1,this.Il=1,this.direction=new i.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=A._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=A._dirtyCallbacks[16]}isReadyForSubMesh(A,X){return!this._isEnabled||!(A._areTexturesDirty&&X.texturesEnabled&&this._texture&&u.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(A,X,s){this._isEnabled?(A.ANISOTROPIC=this._isEnabled,this._isEnabled&&!s.isVerticesDataPresent(Y.e.TangentKind)&&(A._needUVs=!0,A.MAINUV1=!0),A._areTexturesDirty&&X.texturesEnabled&&(this._texture&&u.b.AnisotropicTextureEnabled?(0,m.V)(this._texture,A,"ANISOTROPIC_TEXTURE"):A.ANISOTROPIC_TEXTURE=!1),A._areMiscDirty&&(A.ANISOTROPIC_LEGACY=this._legacy)):(A.ANISOTROPIC=!1,A.ANISOTROPIC_TEXTURE=!1,A.ANISOTROPIC_TEXTUREDIRECTUV=0,A.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(A,X){if(!this._isEnabled)return;const s=this._material.isFrozen;A.useUbo&&s&&A.isSync||(this._texture&&u.b.AnisotropicTextureEnabled&&(A.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,m.y)(this._texture,A,"anisotropy")),A.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Il)),X.texturesEnabled&&this._texture&&u.b.AnisotropicTextureEnabled&&A.setTexture("anisotropySampler",this._texture)}hasTexture(A){return this._texture===A}getActiveTextures(A){this._texture&&A.push(this._texture)}getAnimatables(A){this._texture&&this._texture.animations&&this._texture.animations.length>0&&A.push(this._texture)}dispose(A){A&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(A,X,s){return A.ANISOTROPIC&&X.addFallback(s++,"ANISOTROPIC"),s}getSamplers(A){A.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(A,X,s){super.parse(A,X,s),void 0===A.legacy&&(this.legacy=!0)}}(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"isEnabled",void 0),(0,N.e)([(0,f.M)()],D.prototype,"intensity",void 0),(0,N.e)([(0,f.J)()],D.prototype,"direction",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],D.prototype,"texture",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsMiscDirty")],D.prototype,"legacy",void 0);class O extends v.e{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class P extends c.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(A,"Sheen",120,new O,X),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Il=1,this.color=w.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=A._dirtyCallbacks[1]}isReadyForSubMesh(A,X){if(!this._isEnabled)return!0;if(A._areTexturesDirty&&X.texturesEnabled){if(this._texture&&u.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&u.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(A,X){this._isEnabled?(A.SHEEN=!0,A.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,A.SHEEN_ROUGHNESS=null!==this._roughness,A.SHEEN_ALBEDOSCALING=this._albedoScaling,A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,A._areTexturesDirty&&X.texturesEnabled&&(this._texture&&u.b.SheenTextureEnabled?((0,m.V)(this._texture,A,"SHEEN_TEXTURE"),A.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):A.SHEEN_TEXTURE=!1,this._textureRoughness&&u.b.SheenTextureEnabled?(0,m.V)(this._textureRoughness,A,"SHEEN_TEXTURE_ROUGHNESS"):A.SHEEN_TEXTURE_ROUGHNESS=!1)):(A.SHEEN=!1,A.SHEEN_TEXTURE=!1,A.SHEEN_TEXTURE_ROUGHNESS=!1,A.SHEEN_LINKWITHALBEDO=!1,A.SHEEN_ROUGHNESS=!1,A.SHEEN_ALBEDOSCALING=!1,A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,A.SHEEN_GAMMATEXTURE=!1,A.SHEEN_TEXTUREDIRECTUV=0,A.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(A,X,s,N){if(!this._isEnabled)return;const f=N.materialDefines,E=this._material.isFrozen;if(!A.useUbo||!E||!A.isSync){var g,K,r,i;if((this._texture||this._textureRoughness)&&u.b.SheenTextureEnabled)A.updateFloat4("vSheenInfos",(null===(g=this._texture)||void 0===g?void 0:g.coordinatesIndex)??0,(null===(K=this._texture)||void 0===K?void 0:K.level)??0,(null===(r=this._textureRoughness)||void 0===r?void 0:r.coordinatesIndex)??0,(null===(i=this._textureRoughness)||void 0===i?void 0:i.level)??0),this._texture&&(0,m.y)(this._texture,A,"sheen"),this._textureRoughness&&!f.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,m.y)(this._textureRoughness,A,"sheenRoughness");A.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Il),null!==this._roughness&&A.updateFloat("vSheenRoughness",this._roughness)}X.texturesEnabled&&(this._texture&&u.b.SheenTextureEnabled&&A.setTexture("sheenSampler",this._texture),this._textureRoughness&&!f.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&u.b.SheenTextureEnabled&&A.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(A){return this._texture===A||this._textureRoughness===A}getActiveTextures(A){this._texture&&A.push(this._texture),this._textureRoughness&&A.push(this._textureRoughness)}getAnimatables(A){this._texture&&this._texture.animations&&this._texture.animations.length>0&&A.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&A.push(this._textureRoughness)}dispose(A){var X,s;A&&(null===(X=this._texture)||void 0===X||X.dispose(),null===(s=this._textureRoughness)||void 0===s||s.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(A,X,s){return A.SHEEN&&X.addFallback(s++,"SHEEN"),s}getSamplers(A){A.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkSheenWithAlbedo",void 0),(0,N.e)([(0,f.M)()],P.prototype,"intensity",void 0),(0,N.e)([(0,f.k)()],P.prototype,"color",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useRoughnessFromMainTexture",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"roughness",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"textureRoughness",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"albedoScaling",void 0);class l extends v.e{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class n extends c.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(A){this._scene.enableSubSurfaceForPrePass()&&A&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(A))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(A){this._volumeIndexOfRefraction=A>=1?A:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(A,"PBRSubSurface",130,new l,X),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=w.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=w.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=n.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=n.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=A.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=A._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=A._dirtyCallbacks[32]}isReadyForSubMesh(A,X){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(A._areTexturesDirty&&X.texturesEnabled){if(this._thicknessTexture&&u.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&u.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&u.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const A=this._getRefractionTexture(X);if(A&&u.b.RefractionTextureEnabled&&!A.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(A,X){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return A.SUBSURFACE=!1,A.SS_DISPERSION=!1,A.SS_TRANSLUCENCY=!1,A.SS_SCATTERING=!1,A.SS_REFRACTION=!1,A.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,A.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,A.SS_THICKNESSANDMASK_TEXTURE=!1,A.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,A.SS_HAS_THICKNESS=!1,A.SS_REFRACTIONINTENSITY_TEXTURE=!1,A.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,A.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,A.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,A.SS_REFRACTIONMAP_3D=!1,A.SS_REFRACTIONMAP_OPPOSITEZ=!1,A.SS_LODINREFRACTIONALPHA=!1,A.SS_GAMMAREFRACTION=!1,A.SS_RGBDREFRACTION=!1,A.SS_LINEARSPECULARREFRACTION=!1,A.SS_LINKREFRACTIONTOTRANSPARENCY=!1,A.SS_ALBEDOFORREFRACTIONTINT=!1,A.SS_ALBEDOFORTRANSLUCENCYTINT=!1,A.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,A.SS_USE_THICKNESS_AS_DEPTH=!1,A.SS_USE_GLTF_TEXTURES=!1,A.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,A.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,A.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(A.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(A._areTexturesDirty){if(A.SUBSURFACE=!0,A.SS_DISPERSION=this._isDispersionEnabled,A.SS_TRANSLUCENCY=this._isTranslucencyEnabled,A.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,A.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,A.SS_SCATTERING=this._isScatteringEnabled,A.SS_THICKNESSANDMASK_TEXTURE=!1,A.SS_REFRACTIONINTENSITY_TEXTURE=!1,A.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,A.SS_HAS_THICKNESS=!1,A.SS_USE_GLTF_TEXTURES=!1,A.SS_REFRACTION=!1,A.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,A.SS_REFRACTIONMAP_3D=!1,A.SS_GAMMAREFRACTION=!1,A.SS_RGBDREFRACTION=!1,A.SS_LINEARSPECULARREFRACTION=!1,A.SS_REFRACTIONMAP_OPPOSITEZ=!1,A.SS_LODINREFRACTIONALPHA=!1,A.SS_LINKREFRACTIONTOTRANSPARENCY=!1,A.SS_ALBEDOFORREFRACTIONTINT=!1,A.SS_ALBEDOFORTRANSLUCENCYTINT=!1,A.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,A.SS_USE_THICKNESS_AS_DEPTH=!1,A.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,A.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,A._areTexturesDirty&&X.texturesEnabled&&(this._thicknessTexture&&u.b.ThicknessTextureEnabled&&(0,m.V)(this._thicknessTexture,A,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&u.b.RefractionIntensityTextureEnabled&&(0,m.V)(this._refractionIntensityTexture,A,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&u.b.TranslucencyIntensityTextureEnabled&&(0,m.V)(this._translucencyIntensityTexture,A,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&u.b.TranslucencyColorTextureEnabled&&((0,m.V)(this._translucencyColorTexture,A,"SS_TRANSLUCENCYCOLOR_TEXTURE"),A.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),A.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,A.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,A.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,A.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&X.texturesEnabled){const s=this._getRefractionTexture(X);s&&u.b.RefractionTextureEnabled&&(A.SS_REFRACTION=!0,A.SS_REFRACTIONMAP_3D=s.isCube,A.SS_GAMMAREFRACTION=s.gammaSpace,A.SS_RGBDREFRACTION=s.isRGBD,A.SS_LINEARSPECULARREFRACTION=s.linearSpecularLOD,A.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&s.isCube?!s.invertZ:s.invertZ,A.SS_LODINREFRACTIONALPHA=s.lodLevelInAlpha,A.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,A.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,A.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=s.isCube&&s.boundingBoxSize,A.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(A.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(A,X,s,N){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)A.updateFloat2("vThicknessParam",0,0);else{N.getRenderingMesh().getWorldMatrix().decompose(i.f.oi[0]);const X=Math.max(Math.abs(i.f.oi[0].x),Math.abs(i.f.oi[0].y),Math.abs(i.f.oi[0].z));A.updateFloat2("vThicknessParam",this.minimumThickness*X,(this.maximumThickness-this.minimumThickness)*X)}}bindForSubMesh(A,X,s,N){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const f=N.materialDefines,E=this._material.isFrozen,g=this._material.realTimeFiltering,K=f.LODBASEDMICROSFURACE,r=this._getRefractionTexture(X);if(!A.useUbo||!E||!A.isSync){if(this._thicknessTexture&&u.b.ThicknessTextureEnabled&&(A.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,m.y)(this._thicknessTexture,A,"thickness")),this._refractionIntensityTexture&&u.b.RefractionIntensityTextureEnabled&&f.SS_REFRACTIONINTENSITY_TEXTURE&&(A.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,m.y)(this._refractionIntensityTexture,A,"refractionIntensity")),this._translucencyColorTexture&&u.b.TranslucencyColorTextureEnabled&&f.SS_TRANSLUCENCYCOLOR_TEXTURE&&(A.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,m.y)(this._translucencyColorTexture,A,"translucencyColor")),this._translucencyIntensityTexture&&u.b.TranslucencyIntensityTextureEnabled&&f.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(A.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,m.y)(this._translucencyIntensityTexture,A,"translucencyIntensity")),r&&u.b.RefractionTextureEnabled){A.Yi("refractionMatrix",r.getRefractionTextureMatrix());let X=1;r.isCube||r.depth&&(X=r.depth);const s=r.getSize().width,N=this.volumeIndexOfRefraction;if(A.updateFloat4("vRefractionInfos",r.level,1/N,X,this._invertRefractionY?-1:1),A.updateFloat4("vRefractionMicrosurfaceInfos",s,r.lodGenerationScale,r.lodGenerationOffset,1/this.indexOfRefraction),g&&A.updateFloat2("vRefractionFilteringInfo",s,Math.log2(s)),r.boundingBoxSize){const X=r;A.updateVector3("vRefractionPosition",X.boundingBoxPosition),A.updateVector3("vRefractionSize",X.boundingBoxSize)}}this._isScatteringEnabled&&A.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),A.updateColor3("vDiffusionDistance",this.diffusionDistance),A.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),A.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),A.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),A.updateFloat("dispersion",this.dispersion)}X.texturesEnabled&&(this._thicknessTexture&&u.b.ThicknessTextureEnabled&&A.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&u.b.RefractionIntensityTextureEnabled&&f.SS_REFRACTIONINTENSITY_TEXTURE&&A.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&u.b.TranslucencyIntensityTextureEnabled&&f.SS_TRANSLUCENCYINTENSITY_TEXTURE&&A.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&u.b.TranslucencyColorTextureEnabled&&f.SS_TRANSLUCENCYCOLOR_TEXTURE&&A.setTexture("translucencyColorSampler",this._translucencyColorTexture),r&&u.b.RefractionTextureEnabled&&(K?A.setTexture("refractionSampler",r):(A.setTexture("refractionSampler",r._lodTextureMid||r),A.setTexture("refractionSamplerLow",r._lodTextureLow||r),A.setTexture("refractionSamplerHigh",r._lodTextureHigh||r))))}_getRefractionTexture(A){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?A.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(A){u.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&A.push(this._refractionTexture)}hasTexture(A){return this._thicknessTexture===A||(this._refractionTexture===A||(this._refractionIntensityTexture===A||(this._translucencyIntensityTexture===A||this._translucencyColorTexture===A)))}hasRenderTargetTextures(){return!!(u.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(A){this._thicknessTexture&&A.push(this._thicknessTexture),this._refractionTexture&&A.push(this._refractionTexture),this._translucencyColorTexture&&A.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&A.push(this._translucencyIntensityTexture)}getAnimatables(A){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&A.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&A.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&A.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&A.push(this._translucencyIntensityTexture)}dispose(A){A&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(A,X,s){return A.SS_SCATTERING&&X.addFallback(s++,"SS_SCATTERING"),A.SS_TRANSLUCENCY&&X.addFallback(s++,"SS_TRANSLUCENCY"),s}getSamplers(A){A.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}n.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,n.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isRefractionEnabled",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isTranslucencyEnabled",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isDispersionEnabled",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markScenePrePassDirty")],n.prototype,"isScatteringEnabled",void 0),(0,N.e)([(0,f.M)()],n.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,N.e)([(0,f.M)()],n.prototype,"refractionIntensity",void 0),(0,N.e)([(0,f.M)()],n.prototype,"translucencyIntensity",void 0),(0,N.e)([(0,f.M)()],n.prototype,"useAlbedoToTintRefraction",void 0),(0,N.e)([(0,f.M)()],n.prototype,"useAlbedoToTintTranslucency",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"thicknessTexture",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionTexture",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"indexOfRefraction",void 0),(0,N.e)([(0,f.M)()],n.prototype,"_volumeIndexOfRefraction",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"volumeIndexOfRefraction",null),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertRefractionY",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkRefractionWithTransparency",void 0),(0,N.e)([(0,f.M)()],n.prototype,"minimumThickness",void 0),(0,N.e)([(0,f.M)()],n.prototype,"maximumThickness",void 0),(0,N.e)([(0,f.M)()],n.prototype,"useThicknessAsDepth",void 0),(0,N.e)([(0,f.k)()],n.prototype,"tintColor",void 0),(0,N.e)([(0,f.M)()],n.prototype,"tintColorAtDistance",void 0),(0,N.e)([(0,f.M)()],n.prototype,"dispersion",void 0),(0,N.e)([(0,f.k)()],n.prototype,"diffusionDistance",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useMaskFromThicknessTexture",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionIntensityTexture",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"translucencyIntensityTexture",void 0),(0,N.e)([(0,f.k)()],n.prototype,"translucencyColor",void 0),(0,N.e)([(0,f.G)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"translucencyColorTexture",void 0),(0,N.e)([(0,f.M)(),(0,f.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useGltfStyleTextures",void 0),(0,N.e)([(0,f.M)()],n.prototype,"applyAlbedoAfterSubSurface",void 0),(0,N.e)([(0,f.M)()],n.prototype,"legacyTransluceny",void 0);var U=s(12152),t=s(841),e=s(12166);const T={effect:null,subMesh:null};class I extends v.e{constructor(A){super(A),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class L extends J.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(A){this._realTimeFiltering=A,this.Oi(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(A){this._realTimeFilteringQuality=A,this.Oi(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(A){A!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=A||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(A,X){super(A,X,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||L.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new i.m(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=L.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=w.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new w.e(0,0,0),this._albedoColor=new w.e(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new w.e(1,1,1),this._reflectionColor=new w.e(1,1,1),this._emissiveColor=new w.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=L.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new g.f(16),this._globalAmbientColor=new w.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new d(this),this.clearCoat=new y(this),this.iridescence=new G(this),this.anisotropy=new D(this),this.sheen=new P(this),this.subSurface=new n(this),this.detailMap=new U.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),u.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,K.c)(this.va()),this.prePassConfiguration=new Q.d}get hasRenderTargetTextures(){return!!(u.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var A;return this._transparencyMode===L.PBRMATERIAL_OPAQUE||this._transparencyMode===L.PBRMATERIAL_ALPHATEST||(null===(A=this.subSurface)||void 0===A?void 0:A.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var A;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(A=this.subSurface)||void 0===A||!A.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===L.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Ej&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==L.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Ej||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(A,X,s){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const N=X._drawWrapper;if(N.effect&&this.isFrozen&&N._wasPreviouslyReady&&N._wasPreviouslyUsingInstances===s)return!0;X.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),X.materialDefines=new I(this._eventInfo.defineNames));const f=X.materialDefines;if(this._isReadyForSubMesh(X))return!0;const g=this.va(),K=g.getEngine();if(f._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,g.texturesEnabled)){if(this._albedoTexture&&u.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&u.b.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&u.b.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&u.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&u.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const A=this._getReflectionTexture();if(A&&u.b.ReflectionTextureEnabled){if(!A.isReadyOrNotBlocking())return!1;var r;if(A.irradianceTexture){if(!A.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!A.sphericalPolynomial&&null!==(r=A.getInternalTexture())&&void 0!==r&&r._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&u.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&u.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(u.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(K.getCaps().standardDerivatives&&this._bumpTexture&&u.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&u.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=f,this._eventInfo.subMesh=X,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(f._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(f.AREALIGHTUSED)for(let E=0;E<A.lightSources.length;E++)if(!A.lightSources[E]._isReady())return!1;K.getCaps().standardDerivatives||A.isVerticesDataPresent(Y.e.NormalKind)||(A.createNormals(!0),E.b.Warn("PBRMaterial: Normals have been created for the mesh: "+A.name));const i=X.effect,v=f._areLightsDisposed;let c=this._prepareEffect(A,f,this.onCompiled,this.onError,s,null,X.getRenderingMesh().hasThinInstances),M=!1;if(c)if(this._onEffectCreatedObservable&&(T.effect=c,T.subMesh=X,this._onEffectCreatedObservable.notifyObservers(T)),this.allowShaderHotSwapping&&i&&!c.isReady()){if(c=i,f.markAsUnprocessed(),M=this.isFrozen,v)return f._areLightsDisposed=!0,!1}else g.resetCachedMaterial(),X.setEffect(c,f,this._materialContext);return!(!X.effect||!X.effect.isReady())&&(f._renderId=g.getRenderId(),N._wasPreviouslyReady=!M,N._wasPreviouslyUsingInstances=!!s,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(A,X){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(A,X,E,g,K),!X.isDirty)return null;X.markAsProcessed();const r=this.va().getEngine(),i=new z.e;let v=0;X.USESPHERICALINVERTEX&&i.addFallback(v++,"USESPHERICALINVERTEX"),X.FOG&&i.addFallback(v,"FOG"),X.SPECULARAA&&i.addFallback(v,"SPECULARAA"),X.POINTSIZE&&i.addFallback(v,"POINTSIZE"),X.LOGARITHMICDEPTH&&i.addFallback(v,"LOGARITHMICDEPTH"),X.PARALLAX&&i.addFallback(v,"PARALLAX"),X.PARALLAX_RHS&&i.addFallback(v,"PARALLAX_RHS"),X.PARALLAXOCCLUSION&&i.addFallback(v++,"PARALLAXOCCLUSION"),X.ENVIRONMENTBRDF&&i.addFallback(v++,"ENVIRONMENTBRDF"),X.TANGENT&&i.addFallback(v++,"TANGENT"),X.BUMP&&i.addFallback(v++,"BUMP"),v=(0,m.B)(X,i,this._maxSimultaneousLights,v++),X.SPECULARTERM&&i.addFallback(v++,"SPECULARTERM"),X.USESPHERICALFROMREFLECTIONMAP&&i.addFallback(v++,"USESPHERICALFROMREFLECTIONMAP"),X.USEIRRADIANCEMAP&&i.addFallback(v++,"USEIRRADIANCEMAP"),X.LIGHTMAP&&i.addFallback(v++,"LIGHTMAP"),X.NORMAL&&i.addFallback(v++,"NORMAL"),X.AMBIENT&&i.addFallback(v++,"AMBIENT"),X.EMISSIVE&&i.addFallback(v++,"EMISSIVE"),X.VERTEXCOLOR&&i.addFallback(v++,"VERTEXCOLOR"),X.MORPHTARGETS&&i.addFallback(v++,"MORPHTARGETS"),X.MULTIVIEW&&i.addFallback(0,"MULTIVIEW");const c=[Y.e.PositionKind];X.NORMAL&&c.push(Y.e.NormalKind),X.TANGENT&&c.push(Y.e.TangentKind);for(let s=1;s<=6;++s)X["UV"+s]&&c.push(`uv${1===s?"":s}`);X.VERTEXCOLOR&&c.push(Y.e.ColorKind),(0,m.D)(c,A,X,i),(0,m.E)(c,X),(0,m.G)(c,A,X),(0,m.C)(c,A,X);let M="pbr";const d=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],w=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],C=["Material","Scene","Mesh"],J={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:X.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=i,this._eventInfo.fallbackRank=v,this._eventInfo.defines=X,this._eventInfo.uniforms=d,this._eventInfo.attributes=c,this._eventInfo.samplers=w,this._eventInfo.uniformBuffersNames=C,this._eventInfo.customCode=void 0,this._eventInfo.mesh=A,this._eventInfo.indexParameters=J,this._callbackPluginEventGeneric(128,this._eventInfo),e.b.AddUniformsAndSamplers(d,w),Q.d.AddUniforms(d),Q.d.AddSamplers(w),(0,t.b)(d),R.e&&(R.e.PrepareUniforms(d,X),R.e.PrepareSamplers(w,X)),(0,m.fb)({uniformsNames:d,uniformBuffersNames:C,samplers:w,defines:X,maxSimultaneousLights:this._maxSimultaneousLights});const a={};this.customShaderNameResolve&&(M=this.customShaderNameResolve(M,d,C,w,X,c,a));const u=X.toString(),b=r.createEffect(M,{attributes:c,uniformsNames:d,uniformBuffersNames:C,samplers:w,defines:u,fallbacks:i,onCompiled:N,onError:f,indexParameters:J,processFinalCode:a.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:X.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([s.e(41),s.e(50)]).then(s.bind(s,13718)),Promise.all([s.e(42),s.e(51)]).then(s.bind(s,13737))]):await Promise.all([Promise.all([s.e(45),s.e(52)]).then(s.bind(s,13740)),Promise.all([s.e(47),s.e(53)]).then(s.bind(s,13770))]),this._shadersLoaded=!0}},r);return this._eventInfo.customCode=void 0,b}_prepareDefines(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const E=this.va(),g=E.getEngine();(0,m.U)(E,A,X,!0,this._maxSimultaneousLights,this._disableLighting),X._needNormals=!0,(0,m.Z)(E,X);const K=this.needAlphaBlendingForMesh(A)&&this.va().useOrderIndependentTransparency;if((0,m.bb)(E,X,this.canRenderToMRT&&!K),(0,m._)(E,X,K),e.b.PrepareDefines(g.currentRenderPassId,A,X),X.METALLICWORKFLOW=this.isMetallicWorkflow(),X._areTexturesDirty){X._needUVs=!1;for(let A=1;A<=6;++A)X["MAINUV"+A]=!1;if(E.texturesEnabled){X.ALBEDODIRECTUV=0,X.BASE_WEIGHTDIRECTUV=0,X.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,X.AMBIENTDIRECTUV=0,X.OPACITYDIRECTUV=0,X.EMISSIVEDIRECTUV=0,X.REFLECTIVITYDIRECTUV=0,X.MICROSURFACEMAPDIRECTUV=0,X.METALLIC_REFLECTANCEDIRECTUV=0,X.REFLECTANCEDIRECTUV=0,X.BUMPDIRECTUV=0,X.LIGHTMAPDIRECTUV=0,g.getCaps().textureLOD&&(X.LODBASEDMICROSFURACE=!0),this._albedoTexture&&u.b.DiffuseTextureEnabled?((0,m.V)(this._albedoTexture,X,"ALBEDO"),X.GAMMAALBEDO=this._albedoTexture.gammaSpace):X.ALBEDO=!1,this._baseWeightTexture&&u.b.BaseWeightTextureEnabled?(0,m.V)(this._baseWeightTexture,X,"BASE_WEIGHT"):X.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&u.b.BaseDiffuseRoughnessTextureEnabled?(0,m.V)(this._baseDiffuseRoughnessTexture,X,"BASE_DIFFUSE_ROUGHNESS"):X.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&u.b.AmbientTextureEnabled?((0,m.V)(this._ambientTexture,X,"AMBIENT"),X.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):X.AMBIENT=!1,this._opacityTexture&&u.b.OpacityTextureEnabled?((0,m.V)(this._opacityTexture,X,"OPACITY"),X.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):X.OPACITY=!1;const A=this._getReflectionTexture();if(A&&u.b.ReflectionTextureEnabled){switch(X.REFLECTION=!0,X.GAMMAREFLECTION=A.gammaSpace,X.RGBDREFLECTION=A.isRGBD,X.LODINREFLECTIONALPHA=A.lodLevelInAlpha,X.LINEARSPECULARREFLECTION=A.linearSpecularLOD,X.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(X.NUM_SAMPLES=""+this.realTimeFilteringQuality,g._features.needTypeSuffixInShaderConstants&&(X.NUM_SAMPLES=X.NUM_SAMPLES+"u"),X.REALTIME_FILTERING=!0,this.va().iblCdfGenerator&&(X.IBL_CDF_FILTERING=!0)):X.REALTIME_FILTERING=!1,X.INVERTCUBICMAP=A.coordinatesMode===a.d.INVCUBIC_MODE,X.REFLECTIONMAP_3D=A.isCube,X.REFLECTIONMAP_OPPOSITEZ=X.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!A.invertZ:A.invertZ,X.REFLECTIONMAP_CUBIC=!1,X.REFLECTIONMAP_EXPLICIT=!1,X.REFLECTIONMAP_PLANAR=!1,X.REFLECTIONMAP_PROJECTION=!1,X.REFLECTIONMAP_SKYBOX=!1,X.REFLECTIONMAP_SPHERICAL=!1,X.REFLECTIONMAP_EQUIRECTANGULAR=!1,X.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,X.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,A.coordinatesMode){case a.d.EXPLICIT_MODE:X.REFLECTIONMAP_EXPLICIT=!0;break;case a.d.PLANAR_MODE:X.REFLECTIONMAP_PLANAR=!0;break;case a.d.PROJECTION_MODE:X.REFLECTIONMAP_PROJECTION=!0;break;case a.d.SKYBOX_MODE:X.REFLECTIONMAP_SKYBOX=!0;break;case a.d.SPHERICAL_MODE:X.REFLECTIONMAP_SPHERICAL=!0;break;case a.d.EQUIRECTANGULAR_MODE:X.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case a.d.FIXED_EQUIRECTANGULAR_MODE:X.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case a.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:X.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case a.d.CUBIC_MODE:case a.d.INVCUBIC_MODE:default:X.REFLECTIONMAP_CUBIC=!0,X.USE_LOCAL_REFLECTIONMAP_CUBIC=!!A.boundingBoxSize}A.coordinatesMode!==a.d.SKYBOX_MODE&&(A.irradianceTexture?(X.USEIRRADIANCEMAP=!0,X.USESPHERICALFROMREFLECTIONMAP=!1,X.USESPHERICALINVERTEX=!1,A.irradianceTexture._dominantDirection&&(X.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):A.isCube&&(X.USESPHERICALFROMREFLECTIONMAP=!0,X.USEIRRADIANCEMAP=!1,X.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||g.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?X.USESPHERICALINVERTEX=!1:X.USESPHERICALINVERTEX=!0))}else X.REFLECTION=!1,X.REFLECTIONMAP_3D=!1,X.REFLECTIONMAP_SPHERICAL=!1,X.REFLECTIONMAP_PLANAR=!1,X.REFLECTIONMAP_CUBIC=!1,X.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,X.REFLECTIONMAP_PROJECTION=!1,X.REFLECTIONMAP_SKYBOX=!1,X.REFLECTIONMAP_EXPLICIT=!1,X.REFLECTIONMAP_EQUIRECTANGULAR=!1,X.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,X.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,X.INVERTCUBICMAP=!1,X.USESPHERICALFROMREFLECTIONMAP=!1,X.USEIRRADIANCEMAP=!1,X.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,X.USESPHERICALINVERTEX=!1,X.REFLECTIONMAP_OPPOSITEZ=!1,X.LODINREFLECTIONALPHA=!1,X.GAMMAREFLECTION=!1,X.RGBDREFLECTION=!1,X.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&u.b.LightmapTextureEnabled?((0,m.V)(this._lightmapTexture,X,"LIGHTMAP"),X.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,X.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,X.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):X.LIGHTMAP=!1,this._emissiveTexture&&u.b.EmissiveTextureEnabled?((0,m.V)(this._emissiveTexture,X,"EMISSIVE"),X.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):X.EMISSIVE=!1,u.b.SpecularTextureEnabled?(this._metallicTexture?((0,m.V)(this._metallicTexture,X,"REFLECTIVITY"),X.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,X.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,X.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,X.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,X.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,m.V)(this._reflectivityTexture,X,"REFLECTIVITY"),X.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,X.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,X.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):X.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(X.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,m.V)(this._metallicReflectanceTexture,X,"METALLIC_REFLECTANCE"),X.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):X.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,m.V)(this._reflectanceTexture,X,"REFLECTANCE"),X.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):X.REFLECTANCE=!1):(X.METALLIC_REFLECTANCE=!1,X.REFLECTANCE=!1),this._microSurfaceTexture?(0,m.V)(this._microSurfaceTexture,X,"MICROSURFACEMAP"):X.MICROSURFACEMAP=!1):(X.REFLECTIVITY=!1,X.MICROSURFACEMAP=!1),g.getCaps().standardDerivatives&&this._bumpTexture&&u.b.BumpTextureEnabled&&!this._disableBumpMap?((0,m.V)(this._bumpTexture,X,"BUMP"),this._useParallax&&this._albedoTexture&&u.b.DiffuseTextureEnabled?(X.PARALLAX=!0,X.PARALLAX_RHS=E.useRightHandedSystem,X.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):X.PARALLAX=!1,X.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(X.BUMP=!1,X.PARALLAX=!1,X.PARALLAX_RHS=!1,X.PARALLAXOCCLUSION=!1,X.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&u.b.ReflectionTextureEnabled?(X.ENVIRONMENTBRDF=!0,X.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(X.ENVIRONMENTBRDF=!1,X.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?X.ALPHAFROMALBEDO=!0:X.ALPHAFROMALBEDO=!1}X.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===L.LIGHTFALLOFF_STANDARD?(X.USEPHYSICALLIGHTFALLOFF=!1,X.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===L.LIGHTFALLOFF_GLTF?(X.USEPHYSICALLIGHTFALLOFF=!1,X.USEGLTFLIGHTFALLOFF=!0):(X.USEPHYSICALLIGHTFALLOFF=!0,X.USEGLTFLIGHTFALLOFF=!1),X.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.yi&&this._twoSidedLighting?X.TWOSIDEDLIGHTING=!0:X.TWOSIDEDLIGHTING=!1,X.MIRRORED=!!E._mirroredCameraPosition,X.SPECULARAA=g.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(X._areTexturesDirty||X._areMiscDirty)&&(X.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,X.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,X.ALPHABLEND=this.needAlphaBlendingForMesh(A),X.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,X.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),X._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(X),X.FORCENORMALFORWARD=this._forceNormalForward,X.RADIANCEOCCLUSION=this._useRadianceOcclusion,X.HORIZONOCCLUSION=this._useHorizonOcclusion,X._areMiscDirty&&((0,m.Y)(A,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(A),X,this._applyDecalMapAfterDetailMap),X.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!A.isVerticesDataPresent(Y.e.NormalKind),X.DEBUGMODE=this._debugMode),(0,m.Q)(E,g,this,X,!!s,N,f),this._eventInfo.defines=X,this._eventInfo.mesh=A,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,m.M)(A,X,!0,!0,!0,this._transparencyMode!==L.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(A,X,s){const N={clipPlane:!1,useInstances:!1,...s};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const s=new I(this._eventInfo.defineNames),f=this._prepareEffect(A,s,void 0,void 0,N.useInstances,N.clipPlane,A.hasThinInstances);this._onEffectCreatedObservable&&(T.effect=f,T.subMesh=null,this._onEffectCreatedObservable.notifyObservers(T)),f.isReady()?X&&X(this):f.onCompileObservable.add((()=>{X&&X(this)}))})()}buildUniformLayout(){const A=this._uniformBuffer;A.addUniform("vAlbedoInfos",2),A.addUniform("vBaseWeightInfos",2),A.addUniform("vBaseDiffuseRoughnessInfos",2),A.addUniform("vAmbientInfos",4),A.addUniform("vOpacityInfos",2),A.addUniform("vEmissiveInfos",2),A.addUniform("vLightmapInfos",2),A.addUniform("vReflectivityInfos",3),A.addUniform("vMicroSurfaceSamplerInfos",2),A.addUniform("vReflectionInfos",2),A.addUniform("vReflectionFilteringInfo",2),A.addUniform("vReflectionPosition",3),A.addUniform("vReflectionSize",3),A.addUniform("vBumpInfos",3),A.addUniform("albedoMatrix",16),A.addUniform("baseWeightMatrix",16),A.addUniform("baseDiffuseRoughnessMatrix",16),A.addUniform("ambientMatrix",16),A.addUniform("opacityMatrix",16),A.addUniform("emissiveMatrix",16),A.addUniform("lightmapMatrix",16),A.addUniform("reflectivityMatrix",16),A.addUniform("microSurfaceSamplerMatrix",16),A.addUniform("bumpMatrix",16),A.addUniform("vTangentSpaceParams",2),A.addUniform("reflectionMatrix",16),A.addUniform("vReflectionColor",3),A.addUniform("vAlbedoColor",4),A.addUniform("baseWeight",1),A.addUniform("baseDiffuseRoughness",1),A.addUniform("vLightingIntensity",4),A.addUniform("vReflectionMicrosurfaceInfos",3),A.addUniform("vReflectionDominantDirection",3),A.addUniform("pointSize",1),A.addUniform("vReflectivityColor",4),A.addUniform("vEmissiveColor",3),A.addUniform("vAmbientColor",3),A.addUniform("vDebugMode",2),A.addUniform("vMetallicReflectanceFactors",4),A.addUniform("vMetallicReflectanceInfos",2),A.addUniform("metallicReflectanceMatrix",16),A.addUniform("vReflectanceInfos",2),A.addUniform("reflectanceMatrix",16),A.addUniform("vSphericalL00",3),A.addUniform("vSphericalL1_1",3),A.addUniform("vSphericalL10",3),A.addUniform("vSphericalL11",3),A.addUniform("vSphericalL2_2",3),A.addUniform("vSphericalL2_1",3),A.addUniform("vSphericalL20",3),A.addUniform("vSphericalL21",3),A.addUniform("vSphericalL22",3),A.addUniform("vSphericalX",3),A.addUniform("vSphericalY",3),A.addUniform("vSphericalZ",3),A.addUniform("vSphericalXX_ZZ",3),A.addUniform("vSphericalYY_ZZ",3),A.addUniform("vSphericalZZ",3),A.addUniform("vSphericalXY",3),A.addUniform("vSphericalYZ",3),A.addUniform("vSphericalZX",3),A.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(A,X,s){const N=this.va(),f=s.materialDefines;if(!f)return;const E=s.effect;if(!E)return;this._activeEffect=E,X.getMeshUniformBuffer().bindToEffect(E,"Mesh"),X.transferToEffect(A);const g=N.getEngine();this._uniformBuffer.bindToEffect(E,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,N,X,A,this.isFrozen),e.b.Bind(g.currentRenderPassId,this._activeEffect,X,A,this);const K=N.activeCamera;K?this._uniformBuffer.updateFloat4("cameraInfo",K.ui,K.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=s,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),f.OBJECTSPACE_NORMALMAP&&(A.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const i=this._mustRebind(N,E,s,X.visibility);(0,m.e)(X,this._activeEffect,this.prePassConfiguration);let Y=null;const v=this._uniformBuffer;if(i){if(this.bindViewProjection(E),Y=this._getReflectionTexture(),!v.useUbo||!this.isFrozen||!v.isSync||s._drawWrapper._forceRebindOnNextCall){var c;if(N.texturesEnabled){if(this._albedoTexture&&u.b.DiffuseTextureEnabled&&(v.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,m.y)(this._albedoTexture,v,"albedo")),this._baseWeightTexture&&u.b.BaseWeightTextureEnabled&&(v.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,m.y)(this._baseWeightTexture,v,"baseWeight")),this._baseDiffuseRoughnessTexture&&u.b.BaseDiffuseRoughnessTextureEnabled&&(v.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,m.y)(this._baseDiffuseRoughnessTexture,v,"baseDiffuseRoughness")),this._ambientTexture&&u.b.AmbientTextureEnabled&&(v.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,m.y)(this._ambientTexture,v,"ambient")),this._opacityTexture&&u.b.OpacityTextureEnabled&&(v.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,m.y)(this._opacityTexture,v,"opacity")),Y&&u.b.ReflectionTextureEnabled){if(v.Yi("reflectionMatrix",Y.getReflectionTextureMatrix()),v.updateFloat2("vReflectionInfos",Y.level*N.iblIntensity,0),Y.boundingBoxSize){const A=Y;v.updateVector3("vReflectionPosition",A.boundingBoxPosition),v.updateVector3("vReflectionSize",A.boundingBoxSize)}if(this.realTimeFiltering){const A=Y.getSize().width;v.updateFloat2("vReflectionFilteringInfo",A,Math.log2(A))}if(f.USEIRRADIANCEMAP)f.USEIRRADIANCEMAP&&f.USE_IRRADIANCE_DOMINANT_DIRECTION&&v.updateVector3("vReflectionDominantDirection",Y.irradianceTexture._dominantDirection);else{const A=Y.sphericalPolynomial;if(f.USESPHERICALFROMREFLECTIONMAP&&A)if(f.SPHERICAL_HARMONICS){const X=A.preScaledHarmonics;v.updateVector3("vSphericalL00",X.l00),v.updateVector3("vSphericalL1_1",X.l1_1),v.updateVector3("vSphericalL10",X.l10),v.updateVector3("vSphericalL11",X.l11),v.updateVector3("vSphericalL2_2",X.l2_2),v.updateVector3("vSphericalL2_1",X.l2_1),v.updateVector3("vSphericalL20",X.l20),v.updateVector3("vSphericalL21",X.l21),v.updateVector3("vSphericalL22",X.l22)}else v.updateFloat3("vSphericalX",A.x.x,A.x.y,A.x.z),v.updateFloat3("vSphericalY",A.y.x,A.y.y,A.y.z),v.updateFloat3("vSphericalZ",A.z.x,A.z.y,A.z.z),v.updateFloat3("vSphericalXX_ZZ",A.xx.x-A.zz.x,A.xx.y-A.zz.y,A.xx.z-A.zz.z),v.updateFloat3("vSphericalYY_ZZ",A.yy.x-A.zz.x,A.yy.y-A.zz.y,A.yy.z-A.zz.z),v.updateFloat3("vSphericalZZ",A.zz.x,A.zz.y,A.zz.z),v.updateFloat3("vSphericalXY",A.xy.x,A.xy.y,A.xy.z),v.updateFloat3("vSphericalYZ",A.yz.x,A.yz.y,A.yz.z),v.updateFloat3("vSphericalZX",A.zx.x,A.zx.y,A.zx.z)}v.updateFloat3("vReflectionMicrosurfaceInfos",Y.getSize().width,Y.lodGenerationScale,Y.lodGenerationOffset)}this._emissiveTexture&&u.b.EmissiveTextureEnabled&&(v.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,m.y)(this._emissiveTexture,v,"emissive")),this._lightmapTexture&&u.b.LightmapTextureEnabled&&(v.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,m.y)(this._lightmapTexture,v,"lightmap")),u.b.SpecularTextureEnabled&&(this._metallicTexture?(v.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,m.y)(this._metallicTexture,v,"reflectivity")):this._reflectivityTexture&&(v.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,m.y)(this._reflectivityTexture,v,"reflectivity")),this._metallicReflectanceTexture&&(v.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,m.y)(this._metallicReflectanceTexture,v,"metallicReflectance")),this._reflectanceTexture&&f.REFLECTANCE&&(v.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,m.y)(this._reflectanceTexture,v,"reflectance")),this._microSurfaceTexture&&(v.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,m.y)(this._microSurfaceTexture,v,"microSurfaceSampler"))),this._bumpTexture&&g.getCaps().standardDerivatives&&u.b.BumpTextureEnabled&&!this._disableBumpMap&&(v.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,m.y)(this._bumpTexture,v,"bump"),N._mirroredCameraPosition?v.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):v.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&v.updateFloat("pointSize",this.pointSize),f.METALLICWORKFLOW){var M;w.l.Vi[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,w.l.Vi[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const A=(null===(M=this.subSurface)||void 0===M?void 0:M._indexOfRefraction)??1.5,X=1;w.l.Vi[0].b=A;const s=Math.pow((A-X)/(A+X),2);w.l.Vi[0].a=s,v.updateDirectColor4("vReflectivityColor",w.l.Vi[0]),v.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else v.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);v.updateColor3("vEmissiveColor",u.b.EmissiveTextureEnabled?this._emissiveColor:w.e.BlackReadOnly),v.updateColor3("vReflectionColor",this._reflectionColor),!f.SS_REFRACTION&&null!==(c=this.subSurface)&&void 0!==c&&c._linkRefractionWithTransparency?v.updateColor4("vAlbedoColor",this._albedoColor,1):v.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),v.updateFloat("baseWeight",this._baseWeight),v.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*N.environmentIntensity,this._lightingInfos.w=this._specularIntensity,v.updateVector4("vLightingIntensity",this._lightingInfos),N.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),v.updateColor3("vAmbientColor",this._globalAmbientColor),v.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(N.texturesEnabled){if(this._albedoTexture&&u.b.DiffuseTextureEnabled&&v.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&u.b.BaseWeightTextureEnabled&&v.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&u.b.BaseDiffuseRoughnessTextureEnabled&&v.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&u.b.AmbientTextureEnabled&&v.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&u.b.OpacityTextureEnabled&&v.setTexture("opacitySampler",this._opacityTexture),Y&&u.b.ReflectionTextureEnabled){f.LODBASEDMICROSFURACE?v.setTexture("reflectionSampler",Y):(v.setTexture("reflectionSampler",Y._lodTextureMid||Y),v.setTexture("reflectionSamplerLow",Y._lodTextureLow||Y),v.setTexture("reflectionSamplerHigh",Y._lodTextureHigh||Y)),f.USEIRRADIANCEMAP&&v.setTexture("irradianceSampler",Y.irradianceTexture);const A=this.va().iblCdfGenerator;this.realTimeFiltering&&A&&v.setTexture("icdfSampler",A.getIcdfTexture())}f.ENVIRONMENTBRDF&&v.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&u.b.EmissiveTextureEnabled&&v.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&u.b.LightmapTextureEnabled&&v.setTexture("lightmapSampler",this._lightmapTexture),u.b.SpecularTextureEnabled&&(this._metallicTexture?v.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&v.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&v.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&f.REFLECTANCE&&v.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&v.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&g.getCaps().standardDerivatives&&u.b.BumpTextureEnabled&&!this._disableBumpMap&&v.setTexture("bumpSampler",this._bumpTexture)}this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(X)&&this.va().depthPeelingRenderer.bind(E),this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,t.c)(this._activeEffect,this,N),this.bindEyePosition(E)}else N.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(i||!this.isFrozen){var d;if(N.lightsEnabled&&!this._disableLighting&&(0,m.m)(N,X,this._activeEffect,f,this._maxSimultaneousLights),(N.fogEnabled&&X.applyFog&&N.fogMode!==r.d.FOGMODE_NONE||Y||this.subSurface.refractionTexture||X.receiveShadows||f.PREPASS)&&this.bindView(E),(0,m.i)(N,X,this._activeEffect,!0),f.NUM_MORPH_INFLUENCERS&&(0,m.t)(X,this._activeEffect),f.BAKED_VERTEX_ANIMATION_TEXTURE)null===(d=X.bakedVertexAnimationManager)||void 0===d||d.bind(E,f.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,m.p)(f,this._activeEffect,N)}this._afterBind(X,this._activeEffect,s),v.update()}getAnimatables(){const A=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&A.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&A.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&A.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&A.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&A.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&A.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&A.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?A.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&A.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&A.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&A.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&A.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&A.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&A.push(this._microSurfaceTexture),A}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const A=super.getActiveTextures();return this._albedoTexture&&A.push(this._albedoTexture),this._baseWeightTexture&&A.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&A.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&A.push(this._ambientTexture),this._opacityTexture&&A.push(this._opacityTexture),this._reflectionTexture&&A.push(this._reflectionTexture),this._emissiveTexture&&A.push(this._emissiveTexture),this._reflectivityTexture&&A.push(this._reflectivityTexture),this._metallicTexture&&A.push(this._metallicTexture),this._metallicReflectanceTexture&&A.push(this._metallicReflectanceTexture),this._reflectanceTexture&&A.push(this._reflectanceTexture),this._microSurfaceTexture&&A.push(this._microSurfaceTexture),this._bumpTexture&&A.push(this._bumpTexture),this._lightmapTexture&&A.push(this._lightmapTexture),A}hasTexture(A){return!!super.hasTexture(A)||(this._albedoTexture===A||(this._baseWeightTexture===A||(this._baseDiffuseRoughnessTexture===A||(this._ambientTexture===A||(this._opacityTexture===A||(this._reflectionTexture===A||(this._emissiveTexture===A||(this._reflectivityTexture===A||(this._metallicTexture===A||(this._metallicReflectanceTexture===A||(this._reflectanceTexture===A||(this._microSurfaceTexture===A||(this._bumpTexture===A||this._lightmapTexture===A)))))))))))))}setPrePassRenderer(){var A;if(null===(A=this.subSurface)||void 0===A||!A.isScatteringEnabled)return!1;const X=this.va().enableSubSurfaceForPrePass();return X&&(X.enabled=!0),!0}dispose(A,X){var s,N,f,E,g,K,r,i,Y,v,c,M,d,Q;(this._breakShaderLoadedCheck=!0,X)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(s=this._albedoTexture)||void 0===s||s.dispose(),null===(N=this._baseWeightTexture)||void 0===N||N.dispose(),null===(f=this._baseDiffuseRoughnessTexture)||void 0===f||f.dispose(),null===(E=this._ambientTexture)||void 0===E||E.dispose(),null===(g=this._opacityTexture)||void 0===g||g.dispose(),null===(K=this._reflectionTexture)||void 0===K||K.dispose(),null===(r=this._emissiveTexture)||void 0===r||r.dispose(),null===(i=this._metallicTexture)||void 0===i||i.dispose(),null===(Y=this._reflectivityTexture)||void 0===Y||Y.dispose(),null===(v=this._bumpTexture)||void 0===v||v.dispose(),null===(c=this._lightmapTexture)||void 0===c||c.dispose(),null===(M=this._metallicReflectanceTexture)||void 0===M||M.dispose(),null===(d=this._reflectanceTexture)||void 0===d||d.dispose(),null===(Q=this._microSurfaceTexture)||void 0===Q||Q.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(A,X)}}L.PBRMATERIAL_OPAQUE=C.c.MATERIAL_OPAQUE,L.PBRMATERIAL_ALPHATEST=C.c.MATERIAL_ALPHATEST,L.PBRMATERIAL_ALPHABLEND=C.c.MATERIAL_ALPHABLEND,L.PBRMATERIAL_ALPHATESTANDBLEND=C.c.MATERIAL_ALPHATESTANDBLEND,L.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,L.LIGHTFALLOFF_PHYSICAL=0,L.LIGHTFALLOFF_GLTF=1,L.LIGHTFALLOFF_STANDARD=2,L.ForceGLSL=!1,(0,N.e)([(0,f.s)()],L.prototype,"_imageProcessingConfiguration",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsMiscDirty")],L.prototype,"debugMode",void 0)},12635:(A,X,s)=>{"use strict";s.d(X,{d:()=>c});var N=s(657),f=s(666),E=s(456),g=s(678),K=s(2288),r=s(2281),i=s(616),Y=s(454),v=s(707);s(2394);class c extends K.b{set boundingBoxSize(A){if(this._boundingBoxSize&&this._boundingBoxSize.equals(A))return;this._boundingBoxSize=A;const X=this.va();X&&X.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(A){this._rotationY=A,this.setReflectionTextureMatrix(g.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(A,X,s){let N="";for(const f of A)N+=f;return new c(N,X,null,s,A)}static CreateFromPrefilteredData(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const f=X.useDelayedTextureLoading;X.useDelayedTextureLoading=!1;const E=new c(A,X,null,!1,null,null,null,void 0,!0,s,N);return X.useDelayedTextureLoading=f,E}constructor(A,X){var s;let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,w=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,R=arguments.length>13?arguments[13]:void 0,C=arguments.length>14?arguments[14]:void 0;super(X),this.onLoadObservable=new Y.b,this.boundingBoxPosition=g.k.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g.c,this._buffer=null,this.name=A,this.url=A,this._noMipmap=f,this.Ej=!1,this.isCube=!0,this._textureMatrix=g.c.Identity(),this.coordinatesMode=r.d.CUBIC_MODE;let J=null,a=null;null===N||Array.isArray(N)?(this._noMipmap=f,this._format=v,this._createPolynomials=d,J=N,this._loaderOptions=R,this._useSRGBBuffer=C,this._lodScale=Q,this._lodOffset=w):(J=N.extensions??null,this._noMipmap=N.noMipmap??!1,E=N.files??null,a=N.buffer??null,this._format=N.format??5,c=N.prefiltered??!1,M=N.forcedExtension??null,this._createPolynomials=N.createPolynomials??!1,this._lodScale=N.lodScale??.8,this._lodOffset=N.lodOffset??0,this._loaderOptions=N.loaderOptions,this._useSRGBBuffer=N.useSRGBBuffer,K=N.X??null,i=N.onError??null),(A||E)&&this.updateURL(A,M,K,c,i,J,null===(s=this.va())||void 0===s?void 0:s.useDelayedTextureLoading,E,a)}getClassName(){return"CubeTexture"}updateURL(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=A),this.url=A,X&&(this._forcedExtension=X);const i=A.lastIndexOf("."),Y=X||(i>-1?A.substring(i).toLowerCase():""),v=0===Y.indexOf(".dds"),c=0===Y.indexOf(".env"),M=0===Y.indexOf(".basis");if(c?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=N,N&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),K)this._files=K;else if(M||c||v||E||(E=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,E){for(let X=0;X<E.length;X++)this._files.push(A+E[X]);this._extensions=E}this._buffer=r,g?(this.delayLoadState=4,this._delayedOnLoad=s,this._delayedOnError=f):this._loadTexture(s,f)}delayLoad(A){4===this.delayLoadState&&(A&&(this._forcedExtension=A),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(A){var X,s;if(A.updateFlag===this._textureMatrix.updateFlag)return;A.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(s=this.va())||void 0===s||s.markAllMaterialsAsDirty(1,(A=>-1!==A.getActiveTextures().indexOf(this))));if(this._textureMatrix=A,null===(X=this.va())||void 0===X||!X.useRightHandedSystem)return;const N=g.f.oi[0],f=g.f.Quaternion[0],E=g.f.oi[1];this._textureMatrix.decompose(N,f,E),f.z*=-1,f.w*=-1,g.c.ComposeToRef(N,f,E,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var A;return null!==(A=this.va())&&void 0!==A&&A.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=this.va(),N=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const f=()=>{var X;(this.onLoadObservable.notifyObservers(this),N)&&(N.dispose(),null===(X=this.va())||void 0===X||X.markAllMaterialsAsDirty(1));A&&A()},g=(A,s)=>{this._loadingError=!0,this._errorObject={message:A,exception:s},X&&X(A,s),r.d.OnTextureLoadErrorObservable.notifyObservers(this)};var K;this._texture?this._texture.isReady?E.d.SetImmediate((()=>f())):this._texture.onLoadedObservable.add((()=>f())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,s,this._lodScale,this._lodOffset,A,g,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,s,this._files,this._noMipmap,A,g,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(K=this._texture)||void 0===K||K.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(A,X,s){const N=v.c.Parse((()=>{let N=!1;return A.prefiltered&&(N=A.prefiltered),new c(s+(A.url??A.name),X,A.extensions,!1,A.files||null,null,null,void 0,N,A.forcedExtension)}),A,X);if(A.boundingBoxPosition&&(N.boundingBoxPosition=g.k.mi(A.boundingBoxPosition)),A.boundingBoxSize&&(N.boundingBoxSize=g.k.mi(A.boundingBoxSize)),A.animations)for(let f=0;f<A.animations.length;f++){const X=A.animations[f],s=(0,i.d)("BABYLON.Animation");s&&N.animations.push(s.Parse(X))}return N}clone(){let A=0;const X=v.c.Clone((()=>{const X=new c(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return A=X.uniqueId,X}),this);return X.uniqueId=A,X}}(0,N.e)([(0,f.M)()],c.prototype,"url",void 0),(0,N.e)([(0,f.K)()],c.prototype,"boundingBoxPosition",void 0),(0,N.e)([(0,f.K)()],c.prototype,"boundingBoxSize",null),(0,N.e)([(0,f.M)("rotationY")],c.prototype,"rotationY",null),(0,N.e)([(0,f.M)("files")],c.prototype,"_files",void 0),(0,N.e)([(0,f.M)("forcedExtension")],c.prototype,"_forcedExtension",void 0),(0,N.e)([(0,f.M)("extensions")],c.prototype,"_extensions",void 0),(0,N.e)([(0,f.w)("textureMatrix")],c.prototype,"_textureMatrix",void 0),(0,N.e)([(0,f.w)("textureMatrixRefraction")],c.prototype,"_textureMatrixRefraction",void 0),r.d._CubeTextureParser=c.Parse,(0,i.f)("BABYLON.CubeTexture",c)},12952:(A,X,s)=>{"use strict";s.d(X,{e:()=>r});var N=s(470),f=s(2281),E=s(629),g=s(2333),K=s(592);g.ThinEngine.prototype.createDynamicTexture=function(A,X,s,N){const f=new K.b(this,4);return f.baseWidth=A,f.baseHeight=X,s&&(A=this.needPOTTextures?(0,E.g)(A,this._caps.maxTextureSize):A,X=this.needPOTTextures?(0,E.g)(X,this._caps.maxTextureSize):X),f.width=A,f.height=X,f.isReady=!1,f.generateMipMaps=s,f.samplingMode=N,this.updateTextureSamplingMode(N,f),this._internalTexturesCache.push(f),f},g.ThinEngine.prototype.updateDynamicTexture=function(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!A)return;const g=this._gl,K=g.TEXTURE_2D,r=this._bindTextureDirectly(K,A,!0,E);this._unpackFlipY(void 0===s?A.invertY:s),N&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const i=this._getWebGLTextureType(A.type),Y=this._getInternalFormat(f||A.format),v=this._getRGBABufferInternalSizedFormat(A.type,Y);g.texImage2D(K,0,v,Y,i,X),A.generateMipMaps&&g.generateMipmap(K),r||this._bindTextureDirectly(K,null),N&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),f&&(A.format=f),A._dynamicTextureSource=X,A._premulAlpha=N,A.invertY=s||!1,A.isReady=!0};class r extends f.d{constructor(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,K=arguments.length>6?arguments[6]:void 0;const r=!s||s._isScene;super(null,r?s:null===s||void 0===s?void 0:s.eg,r?!N:s,K,E,void 0,void 0,void 0,void 0,g),this.name=A,this.wrapU=f.d.CLAMP_ADDRESSMODE,this.wrapV=f.d.CLAMP_ADDRESSMODE,this._generateMipMaps=N;const i=this._getEngine();if(!i)return;if(X.getContext)this._canvas=X,this._ownCanvas=!1,this._texture=i.createDynamicTexture(this._canvas.width,this._canvas.height,N,E);else{this._canvas=i.createCanvas(1,1),this._ownCanvas=!0;const A=X;A.width||0===A.width?this._texture=i.createDynamicTexture(A.width,A.height,N,E):this._texture=i.createDynamicTexture(X,X,N,E)}const Y=this.getSize();this._canvas.width!==Y.width&&(this._canvas.width=Y.width),this._canvas.height!==Y.height&&(this._canvas.height=Y.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(A){this._canvas.width=A.width,this._canvas.height=A.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(A.width,A.height,this._generateMipMaps,this.samplingMode)}scale(A){const X=this.getSize();X.width*=A,X.height*=A,this._recreate(X)}scaleTo(A,X){const s=this.getSize();s.width=A,s.height=X,this._recreate(s)}getContext(){return this._context}clear(A){const X=this.getSize();A&&(this._context.fillStyle=A),this._context.clearRect(0,0,X.width,X.height)}update(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===A||A,X,this._format||void 0,void 0,s)}drawText(A,X,s,N,f,E,g){let K=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const r=this.getSize();if(E&&(this._context.fillStyle=E,this._context.fillRect(0,0,r.width,r.height)),this._context.font=N,null===X||void 0===X){const s=this._context.measureText(A);X=(r.width-s.width)/2}if(null===s||void 0===s){const A=parseInt(N.replace(/\D/g,""));s=r.height/2+A/3.65}this._context.fillStyle=f||"",this._context.fillText(A,X,s),K&&this.update(g)}dispose(){var A,X;(super.dispose(),this._ownCanvas)&&(null===(A=this._canvas)||void 0===A||null===(X=A.remove)||void 0===X||X.call(A));this._canvas=null,this._context=null}clone(){const A=this.va();if(!A)return this;const X=this.getSize(),s=new r(this.name,X,A,this._generateMipMaps);return s.Ej=this.Ej,s.level=this.level,s.wrapU=this.wrapU,s.wrapV=this.wrapV,s}serialize(){const A=this.va();A&&!A.isReady()&&N.b.Warn("The scene must be ready before serializing the dynamic texture");const X=super.serialize();return r._IsCanvasElement(this._canvas)&&(X.base64String=this._canvas.toDataURL()),X.invertY=this._invertY,X.samplingMode=this.samplingMode,X}static _IsCanvasElement(A){return void 0!==A.toDataURL}_rebuild(){this.update()}}},12247:(A,X,s)=>{"use strict";s.d(X,{d:()=>f});var N=s(2281);class f extends N.d{constructor(A,X,s,f,E){let g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Y=arguments.length>9?arguments[9]:void 0,v=arguments.length>10?arguments[10]:void 0,c=arguments.length>11?arguments[11]:void 0;super(null,E,!g,K,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Y),this.format=f,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==i||(r=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==i||(r=1),this._texture=this._engine.createRawTexture(A,X,s,f,g,K,r,null,i,Y??0,v??!1),this.wrapU=N.d.CLAMP_ADDRESSMODE,this.wrapV=N.d.CLAMP_ADDRESSMODE,this._waitingForData=!!c&&!A)}update(A){this._getEngine().updateRawTexture(this._texture,A,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const A=new f(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return A._texture=this._texture,this._texture.incrementReferences(),A}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(A,X,s,N){return new f(A,X,s,1,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(A,X,s,N){return new f(A,X,s,2,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(A,X,s,N){return new f(A,X,s,0,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(A,X,s,N){return new f(A,X,s,4,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(A,X,s,N){return new f(A,X,s,5,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(A,X,s,N){return new f(A,X,s,5,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(A,X,s,E){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:N.d.TRILINEAR_SAMPLINGMODE;return new f(A,X,s,6,E,g,K,r,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(A,X,s,E){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:N.d.TRILINEAR_SAMPLINGMODE;return new f(A,X,s,6,E,g,K,r,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12507:(A,X,s)=>{"use strict";s.d(X,{c:()=>f});var N=s(2281);class f extends N.d{get depth(){return this._depth}constructor(A,X,s,f,E,g){let K=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:N.d.TRILINEAR_SAMPLINGMODE,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,v=arguments.length>10?arguments[10]:void 0;super(null,g,!K,r),this.format=E,this._texture=g.getEngine().createRawTexture2DArray(A,X,s,f,E,K,r,i,null,Y,v),this._depth=f,this.is2DArray=!0}update(A){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,A,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(A,X,s,N,E){return new f(A,X,s,N,5,E,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12146:(A,X,s)=>{"use strict";s.d(X,{e:()=>N});class N{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(A,X){this._defines[A]||(A<this._currentRank&&(this._currentRank=A),A>this._maxRank&&(this._maxRank=A),this._defines[A]=new Array),this._defines[A].push(X)}addCPUSkinningFallback(A,X){this._mesh=X,A<this._currentRank&&(this._currentRank=A),A>this._maxRank&&(this._maxRank=A)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(A,X){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,A=A.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),X._bonesComputationForcedToCPU=!0;const s=this._mesh.va();for(let A=0;A<s.meshes.length;A++){const N=s.meshes[A];if(N.material){if(N.computeBonesUsingShaders&&0!==N.numBoneInfluencers)if(N.material.getEffect()===X)N.computeBonesUsingShaders=!1;else if(N.wi)for(const A of N.wi){if(A.effect===X){N.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&N.computeBonesUsingShaders&&N.numBoneInfluencers>0&&(N.computeBonesUsingShaders=!1)}}else{const X=this._defines[this._currentRank];if(X)for(let s=0;s<X.length;s++)A=A.replace("#define "+X[s],"");this._currentRank++}return A}}},12152:(A,X,s)=>{"use strict";s.d(X,{c:()=>v});var N=s(657),f=s(826),E=s(666),g=s(12140),K=s(12129),r=s(12159),i=s(828);class Y extends K.e{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class v extends r.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(A,"DetailMap",140,new Y,X),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=f.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=A._dirtyCallbacks[1]}isReadyForSubMesh(A,X,s){return!this._isEnabled||!(A._areTexturesDirty&&X.texturesEnabled&&s.getCaps().standardDerivatives&&this._texture&&g.b.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(A,X){if(this._isEnabled){A.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const s=X.getEngine();A._areTexturesDirty&&(s.getCaps().standardDerivatives&&this._texture&&g.b.DetailTextureEnabled&&this._isEnabled?((0,i.V)(this._texture,A,"DETAIL"),A.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):A.DETAIL=!1)}else A.DETAIL=!1}bindForSubMesh(A,X){if(!this._isEnabled)return;const s=this._material.isFrozen;A.useUbo&&s&&A.isSync||this._texture&&g.b.DetailTextureEnabled&&(A.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,i.y)(this._texture,A,"detail")),X.texturesEnabled&&this._texture&&g.b.DetailTextureEnabled&&A.setTexture("detailSampler",this._texture)}hasTexture(A){return this._texture===A}getActiveTextures(A){this._texture&&A.push(this._texture)}getAnimatables(A){this._texture&&this._texture.animations&&this._texture.animations.length>0&&A.push(this._texture)}dispose(A){var X;A&&(null===(X=this._texture)||void 0===X||X.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(A){A.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,N.e)([(0,E.G)("detailTexture"),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,N.e)([(0,E.M)()],v.prototype,"diffuseBlendLevel",void 0),(0,N.e)([(0,E.M)()],v.prototype,"roughnessBlendLevel",void 0),(0,N.e)([(0,E.M)()],v.prototype,"bumpLevel",void 0),(0,N.e)([(0,E.M)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"normalBlendMethod",void 0),(0,N.e)([(0,E.M)(),(0,E.c)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0)},12129:(A,X,s)=>{"use strict";s.d(X,{e:()=>N});class N{constructor(A){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=A,A)for(const X in A)Object.prototype.hasOwnProperty.call(A,X)&&this._setDefaultValue(X)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||A,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const A of Object.keys(this))"_"!==A[0]&&this._keys.push(A);if(this._externalProperties)for(const A in this._externalProperties)-1===this._keys.indexOf(A)&&this._keys.push(A)}isEqual(A){if(this._keys.length!==A._keys.length)return!1;for(let X=0;X<this._keys.length;X++){const s=this._keys[X];if(this[s]!==A[s])return!1}return!0}cloneTo(A){this._keys.length!==A._keys.length&&(A._keys=this._keys.slice(0));for(let X=0;X<this._keys.length;X++){const s=this._keys[X];A[s]=this[s]}}reset(){for(const A of this._keys)this._setDefaultValue(A)}_setDefaultValue(A){var X,s,N,f;const E=(null===(X=this._externalProperties)||void 0===X||null===(s=X[A])||void 0===s?void 0:s.type)??typeof this[A],g=null===(N=this._externalProperties)||void 0===N||null===(f=N[A])||void 0===f?void 0:f.default;switch(E){case"number":this[A]=g??0;break;case"string":this[A]=g??"";break;default:this[A]=g??!1}}toString(){let A="";for(let X=0;X<this._keys.length;X++){const s=this._keys[X],N=this[s];switch(typeof N){case"number":case"string":A+="#define "+s+" "+N+"\n";break;default:N&&(A+="#define "+s+"\n")}}return A}}},12140:(A,X,s)=>{"use strict";s.d(X,{b:()=>f});var N=s(547);class f{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(A){this._DiffuseTextureEnabled!==A&&(this._DiffuseTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(A){this._BaseWeightTextureEnabled!==A&&(this._BaseWeightTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(A){this._BaseDiffuseRoughnessTextureEnabled!==A&&(this._BaseDiffuseRoughnessTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(A){this._DetailTextureEnabled!==A&&(this._DetailTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(A){this._DecalMapEnabled!==A&&(this._DecalMapEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(A){this._AmbientTextureEnabled!==A&&(this._AmbientTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(A){this._OpacityTextureEnabled!==A&&(this._OpacityTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(A){this._ReflectionTextureEnabled!==A&&(this._ReflectionTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(A){this._EmissiveTextureEnabled!==A&&(this._EmissiveTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(A){this._SpecularTextureEnabled!==A&&(this._SpecularTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(A){this._BumpTextureEnabled!==A&&(this._BumpTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(A){this._LightmapTextureEnabled!==A&&(this._LightmapTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(A){this._RefractionTextureEnabled!==A&&(this._RefractionTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(A){this._ColorGradingTextureEnabled!==A&&(this._ColorGradingTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(A){this._FresnelEnabled!==A&&(this._FresnelEnabled=A,N.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(A){this._ClearCoatTextureEnabled!==A&&(this._ClearCoatTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(A){this._ClearCoatBumpTextureEnabled!==A&&(this._ClearCoatBumpTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(A){this._ClearCoatTintTextureEnabled!==A&&(this._ClearCoatTintTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(A){this._SheenTextureEnabled!==A&&(this._SheenTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(A){this._AnisotropicTextureEnabled!==A&&(this._AnisotropicTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(A){this._ThicknessTextureEnabled!==A&&(this._ThicknessTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(A){this._RefractionIntensityTextureEnabled!==A&&(this._RefractionIntensityTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(A){this._TranslucencyIntensityTextureEnabled!==A&&(this._TranslucencyIntensityTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(A){this._TranslucencyColorTextureEnabled!==A&&(this._TranslucencyColorTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(A){this._IridescenceTextureEnabled!==A&&(this._IridescenceTextureEnabled=A,N.d.MarkAllMaterialsAsDirty(1))}}f._DiffuseTextureEnabled=!0,f._BaseWeightTextureEnabled=!0,f._BaseDiffuseRoughnessTextureEnabled=!0,f._DetailTextureEnabled=!0,f._DecalMapEnabled=!0,f._AmbientTextureEnabled=!0,f._OpacityTextureEnabled=!0,f._ReflectionTextureEnabled=!0,f._EmissiveTextureEnabled=!0,f._SpecularTextureEnabled=!0,f._BumpTextureEnabled=!0,f._LightmapTextureEnabled=!0,f._RefractionTextureEnabled=!0,f._ColorGradingTextureEnabled=!0,f._FresnelEnabled=!0,f._ClearCoatTextureEnabled=!0,f._ClearCoatBumpTextureEnabled=!0,f._ClearCoatTintTextureEnabled=!0,f._SheenTextureEnabled=!0,f._AnisotropicTextureEnabled=!0,f._ThicknessTextureEnabled=!0,f._RefractionIntensityTextureEnabled=!0,f._TranslucencyIntensityTextureEnabled=!0,f._TranslucencyColorTextureEnabled=!0,f._IridescenceTextureEnabled=!0},12166:(A,X,s)=>{"use strict";s.d(X,{b:()=>E});var N,f=s(678);!function(A){A[A.Zero=0]="Zero",A[A.One=1]="One",A[A.MaxViewZ=2]="MaxViewZ"}(N||(N={}));class E{static CreateConfiguration(A){return E._Configurations[A]={defines:{},previousWorldMatrices:{},previousViewProjection:f.c.Zero(),currentViewProjection:f.c.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},E._Configurations[A]}static DeleteConfiguration(A){delete E._Configurations[A]}static GetConfiguration(A){return E._Configurations[A]}static AddUniformsAndSamplers(A,X){A.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(A,X){for(const s of X)if(s.wi)for(const X of s.wi)X._removeDrawWrapper(A)}static PrepareDefines(A,X,s){if(!s._arePrePassDirty)return;const N=E._Configurations[A];if(!N)return;s.PREPASS=!0,s.PREPASS_COLOR=!1,s.PREPASS_COLOR_INDEX=-1;let f=0;for(let g=0;g<E.GeometryTextureDescriptions.length;g++){const A=E.GeometryTextureDescriptions[g],X=A.define,K=A.defineIndex,r=N.defines[K];void 0!==r?(s[X]=!0,s[K]=r,f++):(s[X]=!1,delete s[K])}s.SCENE_MRT_COUNT=f,s.BONES_VELOCITY_ENABLED=X.useBones&&X.computeBonesUsingShaders&&X.skeleton&&!X.skeleton.isUsingTextureForMatrices&&-1===N.excludedSkinnedMesh.indexOf(X)}static Bind(A,X,s,N,f){const g=E._Configurations[A];if(!g)return;const K=s.va(),r=K.getEngine();if(g.reverseCulling&&r.setStateCullFaceType(K._mirroredCameraPosition?f.cullBackFaces:!f.cullBackFaces),(void 0!==g.defines.PREPASS_VELOCITY_INDEX||void 0!==g.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(g.previousWorldMatrices[s.uniqueId]||(g.previousWorldMatrices[s.uniqueId]=N.clone()),g.previousViewProjection||(g.previousViewProjection=K.getTransformMatrix().clone(),g.currentViewProjection=K.getTransformMatrix().clone()),g.currentViewProjection.updateFlag!==K.getTransformMatrix().updateFlag?(g.lastUpdateFrameId=r.frameId,g.previousViewProjection.p(g.currentViewProjection),g.currentViewProjection.p(K.getTransformMatrix())):g.lastUpdateFrameId!==r.frameId&&(g.lastUpdateFrameId=r.frameId,g.previousViewProjection.p(g.currentViewProjection)),X.setMatrix("previousWorld",g.previousWorldMatrices[s.uniqueId]),X.setMatrix("previousViewProjection",g.previousViewProjection),g.previousWorldMatrices[s.uniqueId]=N.clone(),s.useBones&&s.computeBonesUsingShaders&&s.skeleton)){const A=s.skeleton;if(!A.isUsingTextureForMatrices||-1===X.getUniformIndex("boneTextureWidth")){const N=A.getTransformMatrices(s);N&&(g.previousBones[s.uniqueId]||(g.previousBones[s.uniqueId]=N.slice()),X.setMatrices("mPreviousBones",g.previousBones[s.uniqueId]),g.previousBones[s.uniqueId].set(N))}}}}E.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],E._Configurations={}},12159:(A,X,s)=>{"use strict";s.d(X,{c:()=>R});var N=s(657),f=s(666),E=s(826),g=s(503),K=s(528),r=s(559);const i=new RegExp("^([gimus]+)!");class Y{constructor(A){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=A,this._scene=A.va(),this._engine=this._scene.getEngine()}_addPlugin(A){for(let N=0;N<this._plugins.length;++N)if(this._plugins[N].name===A.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!A.isCompatible(this._material.shaderLanguage))throw`The plugin "${A.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const X=A.getClassName();Y._MaterialPluginClassToMainDefine[X]||(Y._MaterialPluginClassToMainDefine[X]="MATERIALPLUGIN_"+ ++Y._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(A,X)=>this._handlePluginEvent(A,X),this._plugins.push(A),this._plugins.sort(((A,X)=>A.priority-X.priority)),this._codeInjectionPoints={};const s={};s[Y._MaterialPluginClassToMainDefine[X]]={type:"boolean",default:!0};for(const N of this._plugins)N.collectDefines(s),this._collectPointNames("vertex",N.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",N.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=s,!0}_activatePlugin(A){-1===this._activePlugins.indexOf(A)&&(this._activePlugins.push(A),this._activePlugins.sort(((A,X)=>A.priority-X.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),A.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(A),this._activePluginsForExtraEvents.sort(((A,X)=>A.priority-X.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(A){for(let X=0;X<this._plugins.length;++X)if(this._plugins[X].name===A)return this._plugins[X];return null}_handlePluginEventIsReadyForSubMesh(A){let X=!0;for(const s of this._activePlugins)X=X&&s.isReadyForSubMesh(A.defines,this._scene,this._engine,A.subMesh);A.isReadyForSubMesh=X}_handlePluginEventPrepareDefinesBeforeAttributes(A){for(const X of this._activePlugins)X.prepareDefinesBeforeAttributes(A.defines,this._scene,A.mesh)}_handlePluginEventPrepareDefines(A){for(const X of this._activePlugins)X.prepareDefines(A.defines,this._scene,A.mesh)}_handlePluginEventHardBindForSubMesh(A){for(const X of this._activePluginsForExtraEvents)X.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,A.subMesh)}_handlePluginEventBindForSubMesh(A){for(const X of this._activePlugins)X.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,A.subMesh)}_handlePluginEventHasRenderTargetTextures(A){let X=!1;for(const s of this._activePluginsForExtraEvents)if(X=s.hasRenderTargetTextures(),X)break;A.hasRenderTargetTextures=X}_handlePluginEventFillRenderTargetTextures(A){for(const X of this._activePluginsForExtraEvents)X.fillRenderTargetTextures(A.renderTargets)}_handlePluginEvent(A,X){switch(A){case 512:{const A=X;for(const X of this._activePlugins)X.getActiveTextures(A.activeTextures);break}case 256:{const A=X;for(const X of this._activePlugins)X.getAnimatables(A.animatables);break}case 1024:{const A=X;let s=!1;for(const X of this._activePlugins)if(s=X.hasTexture(A.texture),s)break;A.hasTexture=s;break}case 2:{const A=X;for(const X of this._plugins)X.dispose(A.forceDisposeTextures);break}case 4:X.defineNames=this._defineNamesFromPlugins;break;case 128:{const A=X;for(const X of this._activePlugins)A.fallbackRank=X.addFallbacks(A.defines,A.fallbacks,A.fallbackRank),X.getAttributes(A.attributes,this._scene,A.mesh);this._uniformList.length>0&&A.uniforms.push(...this._uniformList),this._samplerList.length>0&&A.samplers.push(...this._samplerList),this._uboList.length>0&&A.uniformBuffersNames.push(...this._uboList),A.customCode=this._injectCustomCode(A,A.customCode);break}case 8:{const A=X;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const s=1===this._material.shaderLanguage;for(const X of this._plugins){const N=X.getUniforms(this._material.shaderLanguage);if(N){if(N.ubo)for(const X of N.ubo){if(X.size&&X.type){const N=X.arraySize??0;if(A.ubo.addUniform(X.name,X.size,N),s){let A;switch(X.type){case"mat4":A="mat4x4f";break;case"float":A="f32";break;default:A=`${X.type}f`}this._uboDeclaration+=N>0?`uniform ${X.name}: array<${A}, ${N}>;\n`:`uniform ${X.name}: ${A};\n`}else this._uboDeclaration+=`${X.type} ${X.name}${N>0?`[${N}]`:""};\n`}this._uniformList.push(X.name)}N.vertex&&(this._vertexDeclaration+=N.vertex+"\n"),N.fragment&&(this._fragmentDeclaration+=N.fragment+"\n")}X.getSamplers(this._samplerList),X.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(A,X){if(X)for(const s in X)this._codeInjectionPoints[A]||(this._codeInjectionPoints[A]={}),this._codeInjectionPoints[A][s]=!0}_injectCustomCode(A,X){return(s,N)=>{var f;X&&(N=X(s,N)),this._uboDeclaration&&(N=N.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(N=N.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(N=N.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const E=null===(f=this._codeInjectionPoints)||void 0===f?void 0:f[s];if(!E)return N;let g=null;for(let X in E){let f="";for(const N of this._activePlugins){var Y;let E=null===(Y=N.getCustomCode(s,this._material.shaderLanguage))||void 0===Y?void 0:Y[X];if(E){if(N.resolveIncludes){if(null===g){const X=0;g={defines:[],indexParameters:A.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:r.b.GetShadersRepository(X),includesShadersStore:r.b.GetIncludesShadersStore(X),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}g.isFragment="fragment"===s,(0,K.h)(E,g,(A=>E=A))}f+=E+"\n"}}if(f.length>0)if("!"===X.charAt(0)){X=X.substring(1);let A="g";if("!"===X.charAt(0))A="",X=X.substring(1);else{const s=i.exec(X);s&&s.length>=2&&(A=s[1],X=X.substring(A.length+1))}A.indexOf("g")<0&&(A+="g");const s=N,E=new RegExp(X,A);let g=E.exec(s);for(;null!==g;){let A=f;for(let X=0;X<g.length;++X)A=A.replace("$"+X,g[X]);N=N.replace(g[0],A),g=E.exec(s)}}else{const A="#define "+X;N=N.replace(A,"\n"+f+"\n"+A)}}return N}}}Y._MaterialPluginClassToMainDefine={},Y._MaterialPluginCounter=0,g.b.OnEnginesDisposedObservable.add((()=>{d()}));const v=[];let c=!1,M=null;function d(){v.length=0,c=!1,E.c.OnEventObservable.remove(M),M=null}var Q=s(707),w=s(616);class R{isCompatible(A){return 0===A}_enable(A){A&&this._pluginManager._activatePlugin(this)}constructor(A,X,s,N){let f=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=A,this.name=X,this.priority=s,this.resolveIncludes=g,A.pluginManager||(A.pluginManager=new Y(A),A.Ji.add((()=>{A.pluginManager=void 0}))),this._pluginDefineNames=N,this._pluginManager=A.pluginManager,f&&this._pluginManager._addPlugin(this),E&&this._enable(!0),this.markAllDefinesAsDirty=A._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(A,X,s,N){return!0}hardBindForSubMesh(A,X,s,N){}bindForSubMesh(A,X,s,N){}dispose(A){}getCustomCode(A){return null}collectDefines(A){if(this._pluginDefineNames)for(const X of Object.keys(this._pluginDefineNames)){if("_"===X[0])continue;const s=typeof this._pluginDefineNames[X];A[X]={type:"number"===s?"number":"string"===s?"string":"boolean"===s?"boolean":"object",default:this._pluginDefineNames[X]}}}prepareDefinesBeforeAttributes(A,X,s){}prepareDefines(A,X,s){}hasTexture(A){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(A){}getActiveTextures(A){}getAnimatables(A){}addFallbacks(A,X,s){return s}getSamplers(A){}getAttributes(A,X,s){}getUniformBuffersNames(A){}getUniforms(){return{}}copyTo(A){Q.c.Clone((()=>A),this)}serialize(){return Q.c.Serialize(this)}parse(A,X,s){Q.c.Parse((()=>this),A,X,s)}}(0,N.e)([(0,f.M)()],R.prototype,"name",void 0),(0,N.e)([(0,f.M)()],R.prototype,"priority",void 0),(0,N.e)([(0,f.M)()],R.prototype,"resolveIncludes",void 0),(0,N.e)([(0,f.M)()],R.prototype,"registerForExtraEvents",void 0),(0,w.f)("BABYLON.MaterialPluginBase",R)},12121:(A,X,s)=>{"use strict";s.d(X,{d:()=>N});class N{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(A){A.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(A){}bindForSubMesh(A,X,s,N,f){if(X.prePassRenderer&&X.prePassRenderer.enabled&&X.prePassRenderer.currentRTisSceneRT&&(-1!==X.prePassRenderer.getIndex(2)||-1!==X.prePassRenderer.getIndex(11))){this.previousWorldMatrices[s.uniqueId]||(this.previousWorldMatrices[s.uniqueId]=N.clone()),this.previousViewProjection||(this.previousViewProjection=X.getTransformMatrix().clone(),this.currentViewProjection=X.getTransformMatrix().clone());const f=X.getEngine();this.currentViewProjection.updateFlag!==X.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=f.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(X.getTransformMatrix())):this._lastUpdateFrameId!==f.frameId&&(this._lastUpdateFrameId=f.frameId,this.previousViewProjection.p(this.currentViewProjection)),A.setMatrix("previousWorld",this.previousWorldMatrices[s.uniqueId]),A.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[s.uniqueId]=N.clone()}}}},12135:(A,X,s)=>{"use strict";s.d(X,{b:()=>E});var N=s(678),f=s(826);class E extends f.c{constructor(A,X){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(A,X,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new N.c,this._storeEffectOnSubMeshes=s}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(A,X){return!!A&&(!this._storeEffectOnSubMeshes||(!A.wi||0===A.wi.length||this.isReadyForSubMesh(A,A.wi[0],X)))}_isReadyForSubMesh(A){const X=A.materialDefines;return!(this.checkReadyOnEveryCall||!A.effect||!X||X._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(A){this._activeEffect.setMatrix("world",A)}bindOnlyNormalMatrix(A){this._activeEffect.setMatrix("normalMatrix",A)}bind(A,X){X&&this.bindForSubMesh(A,X,X.wi[0])}_afterBind(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;super._afterBind(A,X,s),this.va()._cachedEffect=X,s?s._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return s._drawWrapper._forceRebindOnNextCall||A.isCachedMaterialInvalid(this,X,N)}dispose(A,X,s){this._activeEffect=void 0,super.dispose(A,X,s)}}},12116:(A,X,s)=>{"use strict";s.d(X,{e:()=>y});var N=s(657),f=s(666),E=s(672),g=s(2418),K=s(709),r=s(728),i=s(12121),Y=s(2426),v=s(826),c=s(12129),M=s(12135),d=s(2281),Q=s(616),w=s(12140),R=s(12146),C=s(12152),J=s(841),a=s(828),u=s(707),z=s(12166);const m={effect:null,subMesh:null};class b extends c.e{constructor(A){super(A),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(A){const X=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const s of X)this[s]=s===A}}class y extends M.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(A){this._attachImageProcessingConfiguration(A),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(A){A!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=A||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(A){this.imageProcessingConfiguration.colorCurvesEnabled=A}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(A){this.imageProcessingConfiguration.colorGradingEnabled=A}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(A){this._imageProcessingConfiguration.toneMappingEnabled=A}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(A){this._imageProcessingConfiguration.exposure=A}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(A){this._imageProcessingConfiguration.contrast=A}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(A){this._imageProcessingConfiguration.colorGradingTexture=A}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(A){this._imageProcessingConfiguration.colorCurves=A}get canRenderToMRT(){return!0}constructor(A,X){super(A,X,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||y.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new K.e(0,0,0),this.diffuseColor=new K.e(1,1,1),this.specularColor=new K.e(1,1,1),this.emissiveColor=new K.e(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new E.f(16),this._globalAmbientColor=new K.e(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new C.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new i.d,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),y.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),y.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(y.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(y.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"cb"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===v.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Ej&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==v.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Ej||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(A,X){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const f=X._drawWrapper;if(f.effect&&this.isFrozen&&f._wasPreviouslyReady&&f._wasPreviouslyUsingInstances===N)return!0;X.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),X.materialDefines=new b(this._eventInfo.defineNames));const E=this.va(),g=X.materialDefines;if(this._isReadyForSubMesh(X))return!0;const K=E.getEngine();g._needNormals=(0,a.U)(E,A,g,!0,this._maxSimultaneousLights,this._disableLighting),(0,a.Z)(E,g);const v=this.needAlphaBlendingForMesh(A)&&this.va().useOrderIndependentTransparency;if((0,a.bb)(E,g,this.canRenderToMRT&&!v),(0,a._)(E,g,v),z.b.PrepareDefines(K.currentRenderPassId,A,g),g._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,g._needUVs=!1;for(let A=1;A<=6;++A)g["MAINUV"+A]=!1;if(E.texturesEnabled){if(g.DIFFUSEDIRECTUV=0,g.BUMPDIRECTUV=0,g.AMBIENTDIRECTUV=0,g.OPACITYDIRECTUV=0,g.EMISSIVEDIRECTUV=0,g.SPECULARDIRECTUV=0,g.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&y.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,a.V)(this._diffuseTexture,g,"DIFFUSE")}else g.DIFFUSE=!1;if(this._ambientTexture&&y.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,a.V)(this._ambientTexture,g,"AMBIENT")}else g.AMBIENT=!1;if(this._opacityTexture&&y.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,a.V)(this._opacityTexture,g,"OPACITY"),g.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else g.OPACITY=!1;if(this._reflectionTexture&&y.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(g._needNormals=!0,g.REFLECTION=!0,g.ROUGHNESS=this._roughness>0,g.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,g.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===d.d.INVCUBIC_MODE,g.REFLECTIONMAP_3D=this._reflectionTexture.isCube,g.REFLECTIONMAP_OPPOSITEZ=g.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,g.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case d.d.EXPLICIT_MODE:g.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case d.d.PLANAR_MODE:g.setReflectionMode("REFLECTIONMAP_PLANAR");break;case d.d.PROJECTION_MODE:g.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case d.d.SKYBOX_MODE:g.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case d.d.SPHERICAL_MODE:g.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case d.d.EQUIRECTANGULAR_MODE:g.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case d.d.FIXED_EQUIRECTANGULAR_MODE:g.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case d.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:g.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case d.d.CUBIC_MODE:case d.d.INVCUBIC_MODE:default:g.setReflectionMode("REFLECTIONMAP_CUBIC")}g.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else g.REFLECTION=!1,g.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&y.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,a.V)(this._emissiveTexture,g,"EMISSIVE")}else g.EMISSIVE=!1;if(this._lightmapTexture&&y.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,a.V)(this._lightmapTexture,g,"LIGHTMAP"),g.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,g.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else g.LIGHTMAP=!1;if(this._specularTexture&&y.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,a.V)(this._specularTexture,g,"SPECULAR"),g.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else g.SPECULAR=!1;if(E.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&y.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,a.V)(this._bumpTexture,g,"BUMP"),g.PARALLAX=this._useParallax,g.PARALLAX_RHS=E.useRightHandedSystem,g.PARALLAXOCCLUSION=this._useParallaxOcclusion,g.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else g.BUMP=!1,g.PARALLAX=!1,g.PARALLAX_RHS=!1,g.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&y.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;g._needUVs=!0,g.REFRACTION=!0,g.REFRACTIONMAP_3D=this._refractionTexture.isCube,g.RGBDREFRACTION=this._refractionTexture.isRGBD,g.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else g.REFRACTION=!1;g.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else g.DIFFUSE=!1,g.AMBIENT=!1,g.OPACITY=!1,g.REFLECTION=!1,g.EMISSIVE=!1,g.LIGHTMAP=!1,g.BUMP=!1,g.REFRACTION=!1;g.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),g.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,g.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,g.SPECULAROVERALPHA=this._useSpecularOverAlpha,g.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,g.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,g.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(A)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=g,this._eventInfo.subMesh=X,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(g._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(g),g.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,g.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(g._areFresnelDirty&&(y.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(g.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,g.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,g.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,g.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,g.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,g.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,g._needNormals=!0,g.FRESNEL=!0):g.FRESNEL=!1),g.AREALIGHTUSED)for(let s=0;s<A.lightSources.length;s++)if(!A.lightSources[s]._isReady())return!1;(0,a.Y)(A,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(A),g,this._applyDecalMapAfterDetailMap),(0,a.Q)(E,K,this,g,N,null,X.getRenderingMesh().hasThinInstances),this._eventInfo.defines=g,this._eventInfo.mesh=A,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,a.M)(A,g,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let c=!1;if(g.isDirty){const N=g._areLightsDisposed;g.markAsProcessed();const f=new R.e;g.REFLECTION&&f.addFallback(0,"REFLECTION"),g.SPECULAR&&f.addFallback(0,"SPECULAR"),g.BUMP&&f.addFallback(0,"BUMP"),g.PARALLAX&&f.addFallback(1,"PARALLAX"),g.PARALLAX_RHS&&f.addFallback(1,"PARALLAX_RHS"),g.PARALLAXOCCLUSION&&f.addFallback(0,"PARALLAXOCCLUSION"),g.SPECULAROVERALPHA&&f.addFallback(0,"SPECULAROVERALPHA"),g.FOG&&f.addFallback(1,"FOG"),g.POINTSIZE&&f.addFallback(0,"POINTSIZE"),g.LOGARITHMICDEPTH&&f.addFallback(0,"LOGARITHMICDEPTH"),(0,a.B)(g,f,this._maxSimultaneousLights),g.SPECULARTERM&&f.addFallback(0,"SPECULARTERM"),g.DIFFUSEFRESNEL&&f.addFallback(1,"DIFFUSEFRESNEL"),g.OPACITYFRESNEL&&f.addFallback(2,"OPACITYFRESNEL"),g.REFLECTIONFRESNEL&&f.addFallback(3,"REFLECTIONFRESNEL"),g.EMISSIVEFRESNEL&&f.addFallback(4,"EMISSIVEFRESNEL"),g.FRESNEL&&f.addFallback(4,"FRESNEL"),g.MULTIVIEW&&f.addFallback(0,"MULTIVIEW");const v=[r.e.PositionKind];g.NORMAL&&v.push(r.e.NormalKind),g.TANGENT&&v.push(r.e.TangentKind);for(let A=1;A<=6;++A)g["UV"+A]&&v.push(`uv${1===A?"":A}`);g.VERTEXCOLOR&&v.push(r.e.ColorKind),(0,a.D)(v,A,g,f),(0,a.E)(v,g),(0,a.G)(v,A,g),(0,a.C)(v,A,g);let M="default";const d=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],Q=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],w=["Material","Scene","Mesh"],C={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:g.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=f,this._eventInfo.fallbackRank=0,this._eventInfo.defines=g,this._eventInfo.uniforms=d,this._eventInfo.attributes=v,this._eventInfo.samplers=Q,this._eventInfo.uniformBuffersNames=w,this._eventInfo.customCode=void 0,this._eventInfo.mesh=A,this._eventInfo.indexParameters=C,this._callbackPluginEventGeneric(128,this._eventInfo),z.b.AddUniformsAndSamplers(d,Q),i.d.AddUniforms(d),i.d.AddSamplers(Q),Y.e&&(Y.e.PrepareUniforms(d,g),Y.e.PrepareSamplers(Q,g)),(0,a.fb)({uniformsNames:d,uniformBuffersNames:w,samplers:Q,defines:g,maxSimultaneousLights:this._maxSimultaneousLights}),(0,J.b)(d);const u={};this.customShaderNameResolve&&(M=this.customShaderNameResolve(M,d,w,Q,g,v,u));const b=g.toString(),y=X.effect;let j=E.getEngine().createEffect(M,{attributes:v,uniformsNames:d,uniformBuffersNames:w,samplers:Q,defines:b,fallbacks:f,onCompiled:this.onCompiled,onError:this.onError,indexParameters:C,processFinalCode:u.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:g.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([s.e(41),s.e(39)]).then(s.bind(s,13242)),Promise.all([s.e(42),s.e(40)]).then(s.bind(s,13375))]):await Promise.all([Promise.all([s.e(45),s.e(44)]).then(s.bind(s,13445)),Promise.all([s.e(47),s.e(46)]).then(s.bind(s,13612))]),this._shadersLoaded=!0}},K);if(this._eventInfo.customCode=void 0,j)if(this._onEffectCreatedObservable&&(m.effect=j,m.subMesh=X,this._onEffectCreatedObservable.notifyObservers(m)),this.allowShaderHotSwapping&&y&&!j.isReady()){if(j=y,g.markAsUnprocessed(),c=this.isFrozen,N)return g._areLightsDisposed=!0,!1}else E.resetCachedMaterial(),X.setEffect(j,g,this._materialContext)}return!(!X.effect||!X.effect.isReady())&&(g._renderId=E.getRenderId(),f._wasPreviouslyReady=!c,f._wasPreviouslyUsingInstances=N,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const A=this._uniformBuffer;A.addUniform("diffuseLeftColor",4),A.addUniform("diffuseRightColor",4),A.addUniform("opacityParts",4),A.addUniform("reflectionLeftColor",4),A.addUniform("reflectionRightColor",4),A.addUniform("refractionLeftColor",4),A.addUniform("refractionRightColor",4),A.addUniform("emissiveLeftColor",4),A.addUniform("emissiveRightColor",4),A.addUniform("vDiffuseInfos",2),A.addUniform("vAmbientInfos",2),A.addUniform("vOpacityInfos",2),A.addUniform("vReflectionInfos",2),A.addUniform("vReflectionPosition",3),A.addUniform("vReflectionSize",3),A.addUniform("vEmissiveInfos",2),A.addUniform("vLightmapInfos",2),A.addUniform("vSpecularInfos",2),A.addUniform("vBumpInfos",3),A.addUniform("diffuseMatrix",16),A.addUniform("ambientMatrix",16),A.addUniform("opacityMatrix",16),A.addUniform("reflectionMatrix",16),A.addUniform("emissiveMatrix",16),A.addUniform("lightmapMatrix",16),A.addUniform("specularMatrix",16),A.addUniform("bumpMatrix",16),A.addUniform("vTangentSpaceParams",2),A.addUniform("pointSize",1),A.addUniform("alphaCutOff",1),A.addUniform("refractionMatrix",16),A.addUniform("vRefractionInfos",4),A.addUniform("vRefractionPosition",3),A.addUniform("vRefractionSize",3),A.addUniform("vSpecularColor",4),A.addUniform("vEmissiveColor",3),A.addUniform("vDiffuseColor",4),A.addUniform("vAmbientColor",3),A.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(A,X,s){const N=this.va(),f=s.materialDefines;if(!f)return;const E=s.effect;if(!E)return;this._activeEffect=E,X.getMeshUniformBuffer().bindToEffect(E,"Mesh"),X.transferToEffect(A),this._uniformBuffer.bindToEffect(E,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,N,X,A,this.isFrozen),z.b.Bind(N.getEngine().currentRenderPassId,this._activeEffect,X,A,this);const r=N.activeCamera;r?this._uniformBuffer.updateFloat4("cameraInfo",r.ui,r.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=s,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),f.OBJECTSPACE_NORMALMAP&&(A.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const i=this._mustRebind(N,E,s,X.visibility);(0,a.e)(X,E);const Y=this._uniformBuffer;if(i){if(this.bindViewProjection(E),!Y.useUbo||!this.isFrozen||!Y.isSync||s._drawWrapper._forceRebindOnNextCall){if(y.FresnelEnabled&&f.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(Y.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),Y.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&Y.updateColor4("opacityParts",new K.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(Y.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),Y.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(Y.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),Y.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(Y.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),Y.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),N.texturesEnabled){if(this._diffuseTexture&&y.DiffuseTextureEnabled&&(Y.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,a.y)(this._diffuseTexture,Y,"diffuse")),this._ambientTexture&&y.AmbientTextureEnabled&&(Y.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,a.y)(this._ambientTexture,Y,"ambient")),this._opacityTexture&&y.OpacityTextureEnabled&&(Y.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,a.y)(this._opacityTexture,Y,"opacity")),this._hasAlphaChannel()&&Y.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&y.ReflectionTextureEnabled){if(Y.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),Y.Yi("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const A=this._reflectionTexture;Y.updateVector3("vReflectionPosition",A.boundingBoxPosition),Y.updateVector3("vReflectionSize",A.boundingBoxSize)}}else Y.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&y.EmissiveTextureEnabled&&(Y.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,a.y)(this._emissiveTexture,Y,"emissive")),this._lightmapTexture&&y.LightmapTextureEnabled&&(Y.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,a.y)(this._lightmapTexture,Y,"lightmap")),this._specularTexture&&y.SpecularTextureEnabled&&(Y.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,a.y)(this._specularTexture,Y,"specular")),this._bumpTexture&&N.getEngine().getCaps().standardDerivatives&&y.BumpTextureEnabled&&(Y.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,a.y)(this._bumpTexture,Y,"bump"),N._mirroredCameraPosition?Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&y.RefractionTextureEnabled){let A=1;if(this._refractionTexture.isCube||(Y.Yi("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(A=this._refractionTexture.depth)),Y.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,A,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const A=this._refractionTexture;Y.updateVector3("vRefractionPosition",A.boundingBoxPosition),Y.updateVector3("vRefractionSize",A.boundingBoxSize)}}}this.pointsCloud&&Y.updateFloat("pointSize",this.pointSize),Y.updateColor4("vSpecularColor",this.specularColor,this.specularPower),Y.updateColor3("vEmissiveColor",y.EmissiveTextureEnabled?this.emissiveColor:K.e.BlackReadOnly),Y.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),N.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),Y.updateColor3("vAmbientColor",this._globalAmbientColor)}N.texturesEnabled&&(this._diffuseTexture&&y.DiffuseTextureEnabled&&E.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&y.AmbientTextureEnabled&&E.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&y.OpacityTextureEnabled&&E.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&y.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?E.setTexture("reflectionCubeSampler",this._reflectionTexture):E.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&y.EmissiveTextureEnabled&&E.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&y.LightmapTextureEnabled&&E.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&y.SpecularTextureEnabled&&E.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&N.getEngine().getCaps().standardDerivatives&&y.BumpTextureEnabled&&E.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&y.RefractionTextureEnabled&&(this._refractionTexture.isCube?E.setTexture("refractionCubeSampler",this._refractionTexture):E.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(X)&&this.va().depthPeelingRenderer.bind(E),this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,J.c)(E,this,N),this.bindEyePosition(E)}else N.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(i||!this.isFrozen){var v;if(N.lightsEnabled&&!this._disableLighting&&(0,a.m)(N,X,E,f,this._maxSimultaneousLights),(N.fogEnabled&&X.applyFog&&N.fogMode!==g.d.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||X.receiveShadows||f.PREPASS)&&this.bindView(E),(0,a.i)(N,X,E),f.NUM_MORPH_INFLUENCERS&&(0,a.t)(X,E),f.BAKED_VERTEX_ANIMATION_TEXTURE)null===(v=X.bakedVertexAnimationManager)||void 0===v||v.bind(E,f.INSTANCES);this.useLogarithmicDepth&&(0,a.p)(f,E,N),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(X,this._activeEffect,s),Y.update()}getAnimatables(){const A=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&A.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&A.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&A.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&A.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&A.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&A.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&A.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&A.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&A.push(this._refractionTexture),A}getActiveTextures(){const A=super.getActiveTextures();return this._diffuseTexture&&A.push(this._diffuseTexture),this._ambientTexture&&A.push(this._ambientTexture),this._opacityTexture&&A.push(this._opacityTexture),this._reflectionTexture&&A.push(this._reflectionTexture),this._emissiveTexture&&A.push(this._emissiveTexture),this._specularTexture&&A.push(this._specularTexture),this._bumpTexture&&A.push(this._bumpTexture),this._lightmapTexture&&A.push(this._lightmapTexture),this._refractionTexture&&A.push(this._refractionTexture),A}hasTexture(A){return!!super.hasTexture(A)||(this._diffuseTexture===A||(this._ambientTexture===A||(this._opacityTexture===A||(this._reflectionTexture===A||(this._emissiveTexture===A||(this._specularTexture===A||(this._bumpTexture===A||(this._lightmapTexture===A||this._refractionTexture===A))))))))}dispose(A,X){var s,N,f,E,g,K,r,i,Y;X&&(null===(s=this._diffuseTexture)||void 0===s||s.dispose(),null===(N=this._ambientTexture)||void 0===N||N.dispose(),null===(f=this._opacityTexture)||void 0===f||f.dispose(),null===(E=this._reflectionTexture)||void 0===E||E.dispose(),null===(g=this._emissiveTexture)||void 0===g||g.dispose(),null===(K=this._specularTexture)||void 0===K||K.dispose(),null===(r=this._bumpTexture)||void 0===r||r.dispose(),null===(i=this._lightmapTexture)||void 0===i||i.dispose(),null===(Y=this._refractionTexture)||void 0===Y||Y.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(A,X)}clone(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const N=u.c.Clone((()=>new y(A,this.va())),this,{cloneTexturesOnlyOnce:X});return N.name=A,N.id=A,this.stencil.copyTo(N.stencil),this._clonePlugins(N,s),N}static Parse(A,X,s){const N=u.c.Parse((()=>new y(A.name,X)),A,X,s);return A.stencil&&N.stencil.parse(A.stencil,X,s),v.c._ParsePlugins(A,N,X,s),N}static get DiffuseTextureEnabled(){return w.b.DiffuseTextureEnabled}static set DiffuseTextureEnabled(A){w.b.DiffuseTextureEnabled=A}static get DetailTextureEnabled(){return w.b.DetailTextureEnabled}static set DetailTextureEnabled(A){w.b.DetailTextureEnabled=A}static get AmbientTextureEnabled(){return w.b.AmbientTextureEnabled}static set AmbientTextureEnabled(A){w.b.AmbientTextureEnabled=A}static get OpacityTextureEnabled(){return w.b.OpacityTextureEnabled}static set OpacityTextureEnabled(A){w.b.OpacityTextureEnabled=A}static get ReflectionTextureEnabled(){return w.b.ReflectionTextureEnabled}static set ReflectionTextureEnabled(A){w.b.ReflectionTextureEnabled=A}static get EmissiveTextureEnabled(){return w.b.EmissiveTextureEnabled}static set EmissiveTextureEnabled(A){w.b.EmissiveTextureEnabled=A}static get SpecularTextureEnabled(){return w.b.SpecularTextureEnabled}static set SpecularTextureEnabled(A){w.b.SpecularTextureEnabled=A}static get BumpTextureEnabled(){return w.b.BumpTextureEnabled}static set BumpTextureEnabled(A){w.b.BumpTextureEnabled=A}static get LightmapTextureEnabled(){return w.b.LightmapTextureEnabled}static set LightmapTextureEnabled(A){w.b.LightmapTextureEnabled=A}static get RefractionTextureEnabled(){return w.b.RefractionTextureEnabled}static set RefractionTextureEnabled(A){w.b.RefractionTextureEnabled=A}static get ColorGradingTextureEnabled(){return w.b.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(A){w.b.ColorGradingTextureEnabled=A}static get FresnelEnabled(){return w.b.FresnelEnabled}static set FresnelEnabled(A){w.b.FresnelEnabled=A}}y.ForceGLSL=!1,(0,N.e)([(0,f.G)("diffuseTexture")],y.prototype,"_diffuseTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"diffuseTexture",void 0),(0,N.e)([(0,f.G)("ambientTexture")],y.prototype,"_ambientTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"ambientTexture",void 0),(0,N.e)([(0,f.G)("opacityTexture")],y.prototype,"_opacityTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"opacityTexture",void 0),(0,N.e)([(0,f.G)("reflectionTexture")],y.prototype,"_reflectionTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"reflectionTexture",void 0),(0,N.e)([(0,f.G)("emissiveTexture")],y.prototype,"_emissiveTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"emissiveTexture",void 0),(0,N.e)([(0,f.G)("specularTexture")],y.prototype,"_specularTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"specularTexture",void 0),(0,N.e)([(0,f.G)("bumpTexture")],y.prototype,"_bumpTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"bumpTexture",void 0),(0,N.e)([(0,f.G)("lightmapTexture")],y.prototype,"_lightmapTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"lightmapTexture",void 0),(0,N.e)([(0,f.G)("refractionTexture")],y.prototype,"_refractionTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"refractionTexture",void 0),(0,N.e)([(0,f.k)("ambient")],y.prototype,"ambientColor",void 0),(0,N.e)([(0,f.k)("diffuse")],y.prototype,"diffuseColor",void 0),(0,N.e)([(0,f.k)("specular")],y.prototype,"specularColor",void 0),(0,N.e)([(0,f.k)("emissive")],y.prototype,"emissiveColor",void 0),(0,N.e)([(0,f.M)()],y.prototype,"specularPower",void 0),(0,N.e)([(0,f.M)("useAlphaFromDiffuseTexture")],y.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"useAlphaFromDiffuseTexture",void 0),(0,N.e)([(0,f.M)("useEmissiveAsIllumination")],y.prototype,"_useEmissiveAsIllumination",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useEmissiveAsIllumination",void 0),(0,N.e)([(0,f.M)("linkEmissiveWithDiffuse")],y.prototype,"_linkEmissiveWithDiffuse",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"linkEmissiveWithDiffuse",void 0),(0,N.e)([(0,f.M)("useSpecularOverAlpha")],y.prototype,"_useSpecularOverAlpha",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useSpecularOverAlpha",void 0),(0,N.e)([(0,f.M)("useReflectionOverAlpha")],y.prototype,"_useReflectionOverAlpha",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useReflectionOverAlpha",void 0),(0,N.e)([(0,f.M)("disableLighting")],y.prototype,"_disableLighting",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsLightsDirty")],y.prototype,"disableLighting",void 0),(0,N.e)([(0,f.M)("useObjectSpaceNormalMap")],y.prototype,"_useObjectSpaceNormalMap",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useObjectSpaceNormalMap",void 0),(0,N.e)([(0,f.M)("useParallax")],y.prototype,"_useParallax",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useParallax",void 0),(0,N.e)([(0,f.M)("useParallaxOcclusion")],y.prototype,"_useParallaxOcclusion",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useParallaxOcclusion",void 0),(0,N.e)([(0,f.M)()],y.prototype,"parallaxScaleBias",void 0),(0,N.e)([(0,f.M)("roughness")],y.prototype,"_roughness",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"roughness",void 0),(0,N.e)([(0,f.M)()],y.prototype,"indexOfRefraction",void 0),(0,N.e)([(0,f.M)()],y.prototype,"invertRefractionY",void 0),(0,N.e)([(0,f.M)()],y.prototype,"alphaCutOff",void 0),(0,N.e)([(0,f.M)("useLightmapAsShadowmap")],y.prototype,"_useLightmapAsShadowmap",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useLightmapAsShadowmap",void 0),(0,N.e)([(0,f.r)("diffuseFresnelParameters")],y.prototype,"_diffuseFresnelParameters",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"diffuseFresnelParameters",void 0),(0,N.e)([(0,f.r)("opacityFresnelParameters")],y.prototype,"_opacityFresnelParameters",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],y.prototype,"opacityFresnelParameters",void 0),(0,N.e)([(0,f.r)("reflectionFresnelParameters")],y.prototype,"_reflectionFresnelParameters",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"reflectionFresnelParameters",void 0),(0,N.e)([(0,f.r)("refractionFresnelParameters")],y.prototype,"_refractionFresnelParameters",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"refractionFresnelParameters",void 0),(0,N.e)([(0,f.r)("emissiveFresnelParameters")],y.prototype,"_emissiveFresnelParameters",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"emissiveFresnelParameters",void 0),(0,N.e)([(0,f.M)("useReflectionFresnelFromSpecular")],y.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsFresnelDirty")],y.prototype,"useReflectionFresnelFromSpecular",void 0),(0,N.e)([(0,f.M)("useGlossinessFromSpecularMapAlpha")],y.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,N.e)([(0,f.M)("maxSimultaneousLights")],y.prototype,"_maxSimultaneousLights",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsLightsDirty")],y.prototype,"maxSimultaneousLights",void 0),(0,N.e)([(0,f.M)("invertNormalMapX")],y.prototype,"_invertNormalMapX",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"invertNormalMapX",void 0),(0,N.e)([(0,f.M)("invertNormalMapY")],y.prototype,"_invertNormalMapY",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"invertNormalMapY",void 0),(0,N.e)([(0,f.M)("twoSidedLighting")],y.prototype,"_twoSidedLighting",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"twoSidedLighting",void 0),(0,N.e)([(0,f.M)("applyDecalMapAfterDetailMap")],y.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,N.e)([(0,f.c)("_markAllSubMeshesAsMiscDirty")],y.prototype,"applyDecalMapAfterDetailMap",void 0),(0,Q.f)("BABYLON.StandardMaterial",y),g.d.DefaultMaterialFactory=A=>new y("default material",A)},12327:(A,X,s)=>{"use strict";s.d(X,{e:()=>K,i:()=>r,k:()=>E,l:()=>g});var N=s(696),f=s(678);function E(A,X){return`{X: ${A.x.toFixed(X)} Y: ${A.y.toFixed(X)}}`}function g(A,X){return`{X: ${A._x.toFixed(X)} Y: ${A._y.toFixed(X)} Z: ${A._z.toFixed(X)}}`}function K(A,X){return 2*Math.acos((0,N.c)(f.d.Dot(A,X)))}function r(A,X){const s=new f.d;return function(A,X,s){const E=f.k.Cross(A,X),g=Math.acos((0,N.c)(f.k.Dot(A,X),-1,1));f.d.RotationAxisToRef(E,g,s)}(A,X,s),s}},12173:(A,X,s)=>{"use strict";s.d(X,{e:()=>i});var N=s(678),f=s(709),E=s(452),g=s(750),K=s(795);s(12175);function r(A){let X=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const s=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],E=[];let r=[];const i=A.width||A.size||1,Y=A.height||A.size||1,v=A.depth||A.size||1,c=A.wrap||!1;let M=void 0===A.topBaseAt?1:A.topBaseAt,d=void 0===A.bottomBaseAt?0:A.bottomBaseAt;M=(M+4)%4,d=(d+4)%4;let Q=[2,0,3,1][M],w=[2,0,1,3][d],R=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(c){X=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],R=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let A=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],s=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const N=[17,18,19,16],f=[22,23,20,21];for(;Q>0;)A.unshift(A.pop()),N.unshift(N.pop()),Q--;for(;w>0;)s.unshift(s.pop()),f.unshift(f.pop()),w--;A=A.flat(),s=s.flat(),R=R.concat(A).concat(s),X.push(N[0],N[2],N[3],N[0],N[1],N[2]),X.push(f[0],f[2],f[3],f[0],f[1],f[2])}const C=[i/2,Y/2,v/2];r=R.reduce(((A,X,s)=>A.concat(X*C[s%3])),[]);const J=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE,a=A.faceUV||new Array(6),u=A.faceColors,z=[];for(let g=0;g<6;g++)void 0===a[g]&&(a[g]=new N.m(0,0,1,1)),u&&void 0===u[g]&&(u[g]=new f.h(1,1,1,1));for(let N=0;N<6;N++)if(E.push(a[N].z,K.b?1-a[N].w:a[N].w),E.push(a[N].x,K.b?1-a[N].w:a[N].w),E.push(a[N].x,K.b?1-a[N].y:a[N].y),E.push(a[N].z,K.b?1-a[N].y:a[N].y),u)for(let A=0;A<4;A++)z.push(u[N].r,u[N].g,u[N].b,u[N].a);g.b._ComputeSides(J,r,X,s,E,A.frontUVs,A.backUVs);const m=new g.b;if(m.indices=X,m.xa=r,m.ya=s,m.Aa=E,u){const A=J===g.b.DOUBLESIDE?z.concat(z):z;m.za=A}return m}function i(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new E.d(A,s);X.sideOrientation=E.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return r(X).Ca(N,X.updatable),N}g.b.CreateBox=r,E.d.CreateBox=function(A,X){return i(A,{size:X,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12175:(A,X,s)=>{"use strict";s.d(X,{i:()=>w,e:()=>C,k:()=>R});var N=s(678),f=s(709),E=s(452),g=s(750),K=s(728);E.d._GroundMeshParser=(A,X)=>r.Parse(A,X);class r extends E.d{constructor(A,X){super(A,X),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=A,this._subdivisionsY=A,this.subdivide(A);const s=this;s.createOrUpdateSubmeshesOctree&&s.createOrUpdateSubmeshesOctree(X)}getHeightAtCoordinates(A,X){const s=this.getWorldMatrix(),f=N.f.Matrix[5];s.invertToRef(f);const E=N.f.oi[8];if(N.k.TransformCoordinatesFromFloatsToRef(A,0,X,f,E),A=E.x,X=E.z,A<this._minX||A>=this._maxX||X<=this._minZ||X>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(A,X),K=-(g.x*A+g.z*X+g.w)/g.y;return N.k.TransformCoordinatesFromFloatsToRef(0,K,0,s,E),E.y}getNormalAtCoordinates(A,X){const s=new N.k(0,1,0);return this.getNormalAtCoordinatesToRef(A,X,s),s}getNormalAtCoordinatesToRef(A,X,s){const f=this.getWorldMatrix(),E=N.f.Matrix[5];f.invertToRef(E);const g=N.f.oi[8];if(N.k.TransformCoordinatesFromFloatsToRef(A,0,X,E,g),A=g.x,X=g.z,A<this._minX||A>this._maxX||X<this._minZ||X>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const K=this._getFacetAt(A,X);return N.k.TransformNormalFromFloatsToRef(K.x,K.y,K.z,f,s),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(A,X){const s=Math.floor((A+this._maxX)*this._subdivisionsX/this._width),N=Math.floor(-(X+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),f=this._heightQuads[N*this._subdivisionsX+s];let E;return E=X<f.slope.x*A+f.slope.y?f.facet1:f.facet2,E}_initHeightQuads(){const A=this._subdivisionsX,X=this._subdivisionsY;this._heightQuads=[];for(let s=0;s<X;s++)for(let X=0;X<A;X++){const f={slope:N.i.Zero(),facet1:new N.m(0,0,0,0),facet2:new N.m(0,0,0,0)};this._heightQuads[s*A+X]=f}return this}_computeHeightQuads(){const A=this.getVerticesData(K.e.PositionKind);if(!A)return this;const X=N.f.oi[3],s=N.f.oi[2],f=N.f.oi[1],E=N.f.oi[0],g=N.f.oi[4],r=N.f.oi[5],i=N.f.oi[6],Y=N.f.oi[7],v=N.f.oi[8];let c=0,M=0,d=0,Q=0,w=0,R=0,C=0;const J=this._subdivisionsX,a=this._subdivisionsY;for(let K=0;K<a;K++)for(let a=0;a<J;a++){c=3*a,M=K*(J+1)*3,d=(K+1)*(J+1)*3,X.x=A[M+c],X.y=A[M+c+1],X.z=A[M+c+2],s.x=A[M+c+3],s.y=A[M+c+4],s.z=A[M+c+5],f.x=A[d+c],f.y=A[d+c+1],f.z=A[d+c+2],E.x=A[d+c+3],E.y=A[d+c+4],E.z=A[d+c+5],Q=(E.z-X.z)/(E.x-X.x),w=X.z-Q*X.x,s.subtractToRef(X,g),f.subtractToRef(X,r),E.subtractToRef(X,i),N.k.CrossToRef(i,r,Y),N.k.CrossToRef(g,i,v),Y.normalize(),v.normalize(),R=-(Y.x*X.x+Y.y*X.y+Y.z*X.z),C=-(v.x*s.x+v.y*s.y+v.z*s.z);const u=this._heightQuads[K*J+a];u.slope.gi(Q,w),u.facet1.gi(Y.x,Y.y,Y.z,R),u.facet2.gi(v.x,v.y,v.z,C)}return this}serialize(A){super.serialize(A),A.subdivisionsX=this._subdivisionsX,A.subdivisionsY=this._subdivisionsY,A.minX=this._minX,A.maxX=this._maxX,A.ui=this._minZ,A.maxZ=this._maxZ,A.width=this._width,A.height=this._height}static Parse(A,X){const s=new r(A.name,X);return s._subdivisionsX=A.subdivisionsX||1,s._subdivisionsY=A.subdivisionsY||1,s._minX=A.minX,s._maxX=A.maxX,s._minZ=A.ui,s._maxZ=A.maxZ,s._width=A.width,s._height=A.height,s}}var i=s(456),Y=s(503),v=s(683),c=s(795);function M(A){const X=[],s=[],f=[],E=[];let K,r;const i=A.width||A.size||1,Y=A.height||A.size||1,v=0|(A.subdivisionsX||A.subdivisions||1),M=0|(A.subdivisionsY||A.subdivisions||1);for(K=0;K<=M;K++)for(r=0;r<=v;r++){const A=new N.k(r*i/v-i/2,0,(M-K)*Y/M-Y/2),X=new N.k(0,1,0);s.push(A.x,A.y,A.z),f.push(X.x,X.y,X.z),E.push(r/v,c.b?K/M:1-K/M)}for(K=0;K<M;K++)for(r=0;r<v;r++)X.push(r+1+(K+1)*(v+1)),X.push(r+1+K*(v+1)),X.push(r+K*(v+1)),X.push(r+(K+1)*(v+1)),X.push(r+1+(K+1)*(v+1)),X.push(r+K*(v+1));const d=new g.b;return d.indices=X,d.xa=s,d.ya=f,d.Aa=E,d}function d(A){const X=void 0!==A.xmin&&null!==A.xmin?A.xmin:-1,s=void 0!==A.zmin&&null!==A.zmin?A.zmin:-1,f=void 0!==A.xmax&&null!==A.xmax?A.xmax:1,E=void 0!==A.zmax&&null!==A.zmax?A.zmax:1,K=A.subdivisions||{w:1,h:1},r=A.precision||{w:1,h:1},i=[],Y=[],v=[],c=[];let M,d,Q,w;K.h=K.h<1?1:K.h,K.w=K.w<1?1:K.w,r.w=r.w<1?1:r.w,r.h=r.h<1?1:r.h;const R=(f-X)/K.w,C=(E-s)/K.h;function J(A,X,s,f){const E=Y.length/3,g=r.w+1;for(M=0;M<r.h;M++)for(d=0;d<r.w;d++){const A=[E+d+M*g,E+(d+1)+M*g,E+(d+1)+(M+1)*g,E+d+(M+1)*g];i.push(A[1]),i.push(A[2]),i.push(A[3]),i.push(A[0]),i.push(A[1]),i.push(A[3])}const K=N.k.Zero(),Q=new N.k(0,1,0);for(M=0;M<=r.h;M++)for(K.z=M*(f-X)/r.h+X,d=0;d<=r.w;d++)K.x=d*(s-A)/r.w+A,K.y=0,Y.push(K.x,K.y,K.z),v.push(Q.x,Q.y,Q.z),c.push(d/r.w,M/r.h)}for(Q=0;Q<K.h;Q++)for(w=0;w<K.w;w++)J(X+w*R,s+Q*C,X+(w+1)*R,s+(Q+1)*C);const a=new g.b;return a.indices=i,a.xa=Y,a.ya=v,a.Aa=c,a}function Q(A){const X=[],s=[],E=[],K=[];let r,i;const Y=A.colorFilter||new f.e(.3,.59,.11),c=A.alphaFilter||0;let M=!1;if(A.minHeight>A.maxHeight){M=!0;const X=A.maxHeight;A.maxHeight=A.minHeight,A.minHeight=X}for(r=0;r<=A.subdivisions;r++)for(i=0;i<=A.subdivisions;i++){const X=new N.k(i*A.width/A.subdivisions-A.width/2,0,(A.subdivisions-r)*A.height/A.subdivisions-A.height/2),f=4*(((X.x+A.width/2)/A.width*(A.bufferWidth-1)|0)+((1-(X.z+A.height/2)/A.height)*(A.bufferHeight-1)|0)*A.bufferWidth);let g=A.buffer[f]/255,d=A.buffer[f+1]/255,Q=A.buffer[f+2]/255;const w=A.buffer[f+3]/255;M&&(g=1-g,d=1-d,Q=1-Q);const R=g*Y.r+d*Y.g+Q*Y.b;X.y=w>=c?A.minHeight+(A.maxHeight-A.minHeight)*R:A.minHeight-v.b,A.heightBuffer&&(A.heightBuffer[r*(A.subdivisions+1)+i]=X.y),s.push(X.x,X.y,X.z),E.push(0,0,0),K.push(i/A.subdivisions,1-r/A.subdivisions)}for(r=0;r<A.subdivisions;r++)for(i=0;i<A.subdivisions;i++){const N=i+1+(r+1)*(A.subdivisions+1),f=i+1+r*(A.subdivisions+1),E=i+r*(A.subdivisions+1),g=i+(r+1)*(A.subdivisions+1),K=s[3*N+1]>=A.minHeight,Y=s[3*f+1]>=A.minHeight,v=s[3*E+1]>=A.minHeight;K&&Y&&v&&(X.push(N),X.push(f),X.push(E));s[3*g+1]>=A.minHeight&&K&&v&&(X.push(g),X.push(N),X.push(E))}g.b.ComputeNormals(s,X,E);const d=new g.b;return d.indices=X,d.xa=s,d.ya=E,d.Aa=K,d}function w(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=new r(A,arguments.length>2?arguments[2]:void 0);s._setReady(!1),s._subdivisionsX=X.subdivisionsX||X.subdivisions||1,s._subdivisionsY=X.subdivisionsY||X.subdivisions||1,s._width=X.width||1,s._height=X.height||1,s._maxX=s._width/2,s._maxZ=s._height/2,s._minX=-s._maxX,s._minZ=-s._maxZ;return M(X).Ca(s,X.updatable),s._setReady(!0),s}function R(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new E.d(A,s);return d(X).Ca(N,X.updatable),N}function C(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=s.width||10,g=s.height||10,K=s.subdivisions||1,v=s.minHeight||0,c=s.maxHeight||1,M=s.colorFilter||new f.e(.3,.59,.11),d=s.alphaFilter||0,w=s.updatable,R=s.onReady;N=N||Y.b.LastCreatedScene;const C=new r(A,N);let J;C._subdivisionsX=K,C._subdivisionsY=K,C._width=E,C._height=g,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ,C._setReady(!1),s.passHeightBufferInCallback&&(J=new Float32Array((K+1)*(K+1)));const a=(A,X,s)=>{Q({width:E,height:g,subdivisions:K,minHeight:v,maxHeight:c,colorFilter:M,buffer:A,bufferWidth:X,bufferHeight:s,alphaFilter:d,heightBuffer:J}).Ca(C,w),R&&R(C,J),C._setReady(!0)};if("string"===typeof X){const A=A=>{var X;const s=A.width,f=A.height;if(N.u)return;const E=null===(X=N)||void 0===X?void 0:X.getEngine().resizeImageBitmap(A,s,f);a(E,s,f)};i.d.LoadImage(X,A,s.onError?s.onError:()=>{},N.offlineProvider)}else a(X.data,X.width,X.height);return C}g.b.CreateGround=M,g.b.CreateTiledGround=d,g.b.CreateGroundFromHeightMap=Q,E.d.CreateGround=(A,X,s,N,f,E)=>w(A,{width:X,height:s,subdivisions:N,updatable:E},f),E.d.CreateTiledGround=(A,X,s,N,f,E,g,K,r)=>R(A,{xmin:X,zmin:s,xmax:N,zmax:f,subdivisions:E,precision:g,updatable:r},K),E.d.CreateGroundFromHeightMap=(A,X,s,N,f,E,g,K,r,i,Y)=>C(A,X,{width:s,height:N,subdivisions:f,minHeight:E,maxHeight:g,updatable:r,onReady:i,alphaFilter:Y},K)},12846:(A,X,s)=>{"use strict";s.d(X,{e:()=>D,g:()=>G,h:()=>V});var N=s(678),f=s(452),E=s(750),g=s(709),K=s(728),r=s(12593),i=s(826),Y=s(707),v=s(2418),c=s(2281),M=s(616),d=s(12146),Q=s(499),w=s(12135),R=s(503),C=s(841),J=s(828);const a={effect:null,subMesh:null};class u extends w.b{constructor(A,X,s){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(A,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new N.c,this._cachedWorldViewProjectionMatrix=new N.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=s,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Si","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...f}}get shaderPath(){return this._shaderPath}set shaderPath(A){this._shaderPath=A}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(A){-1===this._options.uniforms.indexOf(A)&&this._options.uniforms.push(A)}setTexture(A,X){return-1===this._options.samplers.indexOf(A)&&this._options.samplers.push(A),this._textures[A]=X,this}removeTexture(A){delete this._textures[A]}setTextureArray(A,X){return-1===this._options.samplers.indexOf(A)&&this._options.samplers.push(A),this._checkUniform(A),this._textureArrays[A]=X,this}setExternalTexture(A,X){return-1===this._options.externalTextures.indexOf(A)&&this._options.externalTextures.push(A),this._externalTextures[A]=X,this}setFloat(A,X){return this._checkUniform(A),this._floats[A]=X,this}setInt(A,X){return this._checkUniform(A),this._ints[A]=X,this}setUInt(A,X){return this._checkUniform(A),this._uints[A]=X,this}setFloats(A,X){return this._checkUniform(A),this._floatsArrays[A]=X,this}setColor3(A,X){return this._checkUniform(A),this._colors3[A]=X,this}setColor3Array(A,X){return this._checkUniform(A),this._colors3Arrays[A]=X.reduce(((A,X)=>(A.push(X.r,X.g,X.b),A)),[]),this}setColor4(A,X){return this._checkUniform(A),this._colors4[A]=X,this}setColor4Array(A,X){return this._checkUniform(A),this._colors4Arrays[A]=X.reduce(((A,X)=>(A.push(X.r,X.g,X.b,X.a),A)),[]),this}setVector2(A,X){return this._checkUniform(A),this._vectors2[A]=X,this}setVector3(A,X){return this._checkUniform(A),this._vectors3[A]=X,this}setVector4(A,X){return this._checkUniform(A),this._vectors4[A]=X,this}setQuaternion(A,X){return this._checkUniform(A),this._quaternions[A]=X,this}setQuaternionArray(A,X){return this._checkUniform(A),this._quaternionsArrays[A]=X.reduce(((A,X)=>(X.toArray(A,A.length),A)),[]),this}setMatrix(A,X){return this._checkUniform(A),this._matrices[A]=X,this}setMatrices(A,X){this._checkUniform(A);const s=new Float32Array(16*X.length);for(let N=0;N<X.length;N++){X[N].copyToArray(s,16*N)}return this._matrixArrays[A]=s,this}setMatrix3x3(A,X){return this._checkUniform(A),this._matrices3x3[A]=X,this}setMatrix2x2(A,X){return this._checkUniform(A),this._matrices2x2[A]=X,this}setArray2(A,X){return this._checkUniform(A),this._vectors2Arrays[A]=X,this}setArray3(A,X){return this._checkUniform(A),this._vectors3Arrays[A]=X,this}setArray4(A,X){return this._checkUniform(A),this._vectors4Arrays[A]=X,this}setUniformBuffer(A,X){return-1===this._options.uniformBuffers.indexOf(A)&&this._options.uniformBuffers.push(A),this._uniformBuffers[A]=X,this}setTextureSampler(A,X){return-1===this._options.samplerObjects.indexOf(A)&&this._options.samplerObjects.push(A),this._textureSamplers[A]=X,this}setStorageBuffer(A,X){return-1===this._options.storageBuffers.indexOf(A)&&this._options.storageBuffers.push(A),this._storageBuffers[A]=X,this}setDefine(A,X){const s=A.trimEnd()+" ",N=this.options.defines.findIndex((X=>X===A||X.startsWith(s)));return N>=0&&this.options.defines.splice(N,1),("boolean"!==typeof X||X)&&this.options.defines.push(s+X),this}isReadyForSubMesh(A,X,s){return this.isReady(A,s,X)}isReady(A,X,s){var N;const f=s&&this._storeEffectOnSubMeshes;if(this.isFrozen){const A=f?s._drawWrapper:this._drawWrapper;if(A.effect&&A._wasPreviouslyReady&&A._wasPreviouslyUsingInstances===X)return!0}const E=this.va(),g=E.getEngine(),r=[],i=[];let Y=null,c=this._shaderPath,M=this._options.uniforms,Q=this._options.uniformBuffers,w=this._options.samplers;g.getCaps().multiview&&E.activeCamera&&E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,r.push("#define MULTIVIEW"),-1!==M.indexOf("viewProjection")&&-1===M.indexOf("viewProjectionR")&&M.push("viewProjectionR"));for(let K=0;K<this._options.defines.length;K++){const A=0===this._options.defines[K].indexOf("#define")?this._options.defines[K]:`#define ${this._options.defines[K]}`;r.push(A)}for(let K=0;K<this._options.attributes.length;K++)i.push(this._options.attributes[K]);if(A&&A.isVerticesDataPresent(K.e.ColorKind)&&(-1===i.indexOf(K.e.ColorKind)&&i.push(K.e.ColorKind),r.push("#define VERTEXCOLOR")),X&&(r.push("#define INSTANCES"),(0,J.ib)(i,this._materialHelperNeedsPreviousMatrices),null!==A&&void 0!==A&&A.hasThinInstances&&(r.push("#define THIN_INSTANCES"),A&&A.isVerticesDataPresent(K.e.ColorInstanceKind)&&(i.push(K.e.ColorInstanceKind),r.push("#define INSTANCESCOLOR")))),A&&A.useBones&&A.computeBonesUsingShaders&&A.skeleton){i.push(K.e.MatricesIndicesKind),i.push(K.e.MatricesWeightsKind),A.numBoneInfluencers>4&&(i.push(K.e.MatricesIndicesExtraKind),i.push(K.e.MatricesWeightsExtraKind));const X=A.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+A.numBoneInfluencers),Y=new d.e,Y.addCPUSkinningFallback(0,A),X.isUsingTextureForMatrices?(r.push("#define BONETEXTURE"),-1===M.indexOf("boneTextureWidth")&&M.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(r.push("#define BonesPerMesh "+(X.bones.length+1)),-1===M.indexOf("mBones")&&M.push("mBones"))}else r.push("#define NUM_BONE_INFLUENCERS 0");let R=0;const u=A?A.morphTargetManager:null;if(u){const X=-1!==r.indexOf("#define UV1"),s=-1!==r.indexOf("#define UV2"),N=-1!==r.indexOf("#define TANGENT"),f=-1!==r.indexOf("#define NORMAL"),E=-1!==r.indexOf("#define VERTEXCOLOR");R=(0,J.J)(u,r,i,A,!0,f,N,X,s,E),u.isUsingTextureForTargets&&(-1===M.indexOf("morphTargetTextureIndices")&&M.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),R>0&&(M=M.slice(),M.push("morphTargetInfluences"),M.push("morphTargetCount"),M.push("morphTargetTextureInfo"),M.push("morphTargetTextureIndices"))}else r.push("#define NUM_MORPH_INFLUENCERS 0");if(A){const X=A.bakedVertexAnimationManager;X&&X.isEnabled&&(r.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===M.indexOf("bakedVertexAnimationSettings")&&M.push("bakedVertexAnimationSettings"),-1===M.indexOf("bakedVertexAnimationTextureSizeInverted")&&M.push("bakedVertexAnimationTextureSizeInverted"),-1===M.indexOf("bakedVertexAnimationTime")&&M.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,J.C)(i,A,r)}for(const K in this._textures)if(!this._textures[K].isReady())return!1;A&&this.needAlphaTestingForMesh(A)&&r.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,C.b)(M),(0,C.j)(this,E,r)),E.fogEnabled&&null!==A&&void 0!==A&&A.applyFog&&E.fogMode!==v.d.FOGMODE_NONE&&(r.push("#define FOG"),-1===M.indexOf("view")&&M.push("view"),-1===M.indexOf("vFogInfos")&&M.push("vFogInfos"),-1===M.indexOf("vFogColor")&&M.push("vFogColor")),this._useLogarithmicDepth&&(r.push("#define LOGARITHMICDEPTH"),-1===M.indexOf("logarithmicDepthConstant")&&M.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(M=M.slice(),Q=Q.slice(),w=w.slice(),c=this.customShaderNameResolve(this.name,M,Q,w,r,i));const z=f?s._getDrawWrapper(void 0,!0):this._drawWrapper,m=(null===z||void 0===z?void 0:z.effect)??null,b=(null===z||void 0===z?void 0:z.defines)??null,y=r.join("\n");let j=m;return b!==y&&(j=g.createEffect(c,{attributes:i,uniformsNames:M,uniformBuffersNames:Q,samplers:w,defines:y,fallbacks:Y,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:R},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},g),f?s.setEffect(j,y,this._materialContext):z&&z.setEffect(j,y),this._onEffectCreatedObservable&&(a.effect=j,a.subMesh=s??(null===A||void 0===A?void 0:A.wi[0])??null,this._onEffectCreatedObservable.notifyObservers(a))),z._wasPreviouslyUsingInstances=!!X,!(null===(N=j)||void 0===N||!N.isReady())&&(m!==j&&E.resetCachedMaterial(),z._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(A,X){const s=X??this.getEffect();if(!s)return;const N=this._options.uniforms;-1!==N.indexOf("world")&&s.setMatrix("world",A);const f=this.va();-1!==N.indexOf("worldView")&&(A.multiplyToRef(f.getViewMatrix(),this._cachedWorldViewMatrix),s.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==N.indexOf("worldViewProjection")&&(A.multiplyToRef(f.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),s.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==N.indexOf("view")&&s.setMatrix("view",f.getViewMatrix())}bindForSubMesh(A,X,s){var N;this.bind(A,X,null===(N=s._drawWrapperOverride)||void 0===N?void 0:N.effect,s)}bind(A,X,s,N){const f=N&&this._storeEffectOnSubMeshes,E=s??(f?N.effect:this.getEffect());if(!E)return;const g=this.va();this._activeEffect=E,this.bindOnlyWorldMatrix(A,s);const K=this._options.uniformBuffers;let r=!1;if(E&&K&&K.length>0&&g.getEngine().supportsUniformBuffers)for(let v=0;v<K.length;++v){switch(K[v]){case"Mesh":X&&(X.getMeshUniformBuffer().bindToEffect(E,"Mesh"),X.transferToEffect(A));break;case"Scene":(0,J.u)(E,g.getSceneUniformBuffer()),g.finalizeSceneUbo(),r=!0}}const i=X&&f?this._mustRebind(g,E,N,X.visibility):g.getCachedMaterial()!==this;if(E&&i){let A;for(A in r||-1===this._options.uniforms.indexOf("view")||E.setMatrix("view",g.getViewMatrix()),r||-1===this._options.uniforms.indexOf("projection")||E.setMatrix("projection",g.getProjectionMatrix()),r||-1===this._options.uniforms.indexOf("viewProjection")||(E.setMatrix("viewProjection",g.getTransformMatrix()),this._multiview&&E.setMatrix("viewProjectionR",g._transformMatrixR)),g.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&E.setVector3("cameraPosition",g.activeCamera.globalPosition),(0,J.e)(X,E),(0,C.c)(E,this,g),this._useLogarithmicDepth&&(0,J.p)(f?N.materialDefines:E.defines,E,g),X&&(0,J.i)(g,X,E),this._textures)E.setTexture(A,this._textures[A]);for(A in this._textureArrays)E.setTextureArray(A,this._textureArrays[A]);for(A in this._ints)E.setInt(A,this._ints[A]);for(A in this._uints)E.setUInt(A,this._uints[A]);for(A in this._floats)E.setFloat(A,this._floats[A]);for(A in this._floatsArrays)E.setArray(A,this._floatsArrays[A]);for(A in this._colors3)E.setColor3(A,this._colors3[A]);for(A in this._colors3Arrays)E.setArray3(A,this._colors3Arrays[A]);for(A in this._colors4){const X=this._colors4[A];E.setFloat4(A,X.r,X.g,X.b,X.a)}for(A in this._colors4Arrays)E.setArray4(A,this._colors4Arrays[A]);for(A in this._vectors2)E.setVector2(A,this._vectors2[A]);for(A in this._vectors3)E.setVector3(A,this._vectors3[A]);for(A in this._vectors4)E.setVector4(A,this._vectors4[A]);for(A in this._quaternions)E.setQuaternion(A,this._quaternions[A]);for(A in this._matrices)E.setMatrix(A,this._matrices[A]);for(A in this._matrixArrays)E.setMatrices(A,this._matrixArrays[A]);for(A in this._matrices3x3)E.setMatrix3x3(A,this._matrices3x3[A]);for(A in this._matrices2x2)E.setMatrix2x2(A,this._matrices2x2[A]);for(A in this._vectors2Arrays)E.setArray2(A,this._vectors2Arrays[A]);for(A in this._vectors3Arrays)E.setArray3(A,this._vectors3Arrays[A]);for(A in this._vectors4Arrays)E.setArray4(A,this._vectors4Arrays[A]);for(A in this._quaternionsArrays)E.setArray4(A,this._quaternionsArrays[A]);for(A in this._uniformBuffers){const X=this._uniformBuffers[A].getBuffer();X&&E.bindUniformBuffer(X,A)}const s=g.getEngine(),K=s.setExternalTexture;if(K)for(A in this._externalTextures)K.call(s,A,this._externalTextures[A]);const i=s.setTextureSampler;if(i)for(A in this._textureSamplers)i.call(s,A,this._textureSamplers[A]);const Y=s.setStorageBuffer;if(Y)for(A in this._storageBuffers)Y.call(s,A,this._storageBuffers[A])}if(E&&X&&(i||!this.isFrozen)){(0,J.t)(X,E),X.morphTargetManager&&X.morphTargetManager.isUsingTextureForTargets&&X.morphTargetManager._bind(E);const A=X.bakedVertexAnimationManager;if(A&&A.isEnabled){var Y;const A=f?N._drawWrapper:this._drawWrapper;null===(Y=X.bakedVertexAnimationManager)||void 0===Y||Y.bind(E,!!A._wasPreviouslyUsingInstances)}}this._afterBind(X,E,N)}getActiveTextures(){const A=super.getActiveTextures();for(const X in this._textures)A.push(this._textures[X]);for(const X in this._textureArrays){const s=this._textureArrays[X];for(let X=0;X<s.length;X++)A.push(s[X])}return A}hasTexture(A){if(super.hasTexture(A))return!0;for(const X in this._textures)if(this._textures[X]===A)return!0;for(const X in this._textureArrays){const s=this._textureArrays[X];for(let X=0;X<s.length;X++)if(s[X]===A)return!0}return!1}clone(A){const X=Y.c.Clone((()=>new u(A,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);X.name=A,X.id=A,"object"===typeof X._shaderPath&&(X._shaderPath={...X._shaderPath}),this._options={...this._options};const s=Object.keys(this._options);for(const N of s){const A=this._options[N];Array.isArray(A)&&(this._options[N]=A.slice(0))}this.stencil.copyTo(X.stencil);for(const N in this._textures)X.setTexture(N,this._textures[N]);for(const N in this._textureArrays)X.setTextureArray(N,this._textureArrays[N]);for(const N in this._externalTextures)X.setExternalTexture(N,this._externalTextures[N]);for(const N in this._ints)X.setInt(N,this._ints[N]);for(const N in this._uints)X.setUInt(N,this._uints[N]);for(const N in this._floats)X.setFloat(N,this._floats[N]);for(const N in this._floatsArrays)X.setFloats(N,this._floatsArrays[N]);for(const N in this._colors3)X.setColor3(N,this._colors3[N]);for(const N in this._colors3Arrays)X._colors3Arrays[N]=this._colors3Arrays[N];for(const N in this._colors4)X.setColor4(N,this._colors4[N]);for(const N in this._colors4Arrays)X._colors4Arrays[N]=this._colors4Arrays[N];for(const N in this._vectors2)X.setVector2(N,this._vectors2[N]);for(const N in this._vectors3)X.setVector3(N,this._vectors3[N]);for(const N in this._vectors4)X.setVector4(N,this._vectors4[N]);for(const N in this._quaternions)X.setQuaternion(N,this._quaternions[N]);for(const N in this._quaternionsArrays)X._quaternionsArrays[N]=this._quaternionsArrays[N];for(const N in this._matrices)X.setMatrix(N,this._matrices[N]);for(const N in this._matrixArrays)X._matrixArrays[N]=this._matrixArrays[N].slice();for(const N in this._matrices3x3)X.setMatrix3x3(N,this._matrices3x3[N]);for(const N in this._matrices2x2)X.setMatrix2x2(N,this._matrices2x2[N]);for(const N in this._vectors2Arrays)X.setArray2(N,this._vectors2Arrays[N]);for(const N in this._vectors3Arrays)X.setArray3(N,this._vectors3Arrays[N]);for(const N in this._vectors4Arrays)X.setArray4(N,this._vectors4Arrays[N]);for(const N in this._uniformBuffers)X.setUniformBuffer(N,this._uniformBuffers[N]);for(const N in this._textureSamplers)X.setTextureSampler(N,this._textureSamplers[N]);for(const N in this._storageBuffers)X.setStorageBuffer(N,this._storageBuffers[N]);return X}dispose(A,X,s){if(X){let A;for(A in this._textures)this._textures[A].dispose();for(A in this._textureArrays){const X=this._textureArrays[A];for(let A=0;A<X.length;A++)X[A].dispose()}}this._textures={},super.dispose(A,X,s)}serialize(){const A=Y.c.Serialize(this);let X;for(X in A.customType="BABYLON.ShaderMaterial",A.uniqueId=this.uniqueId,A.options=this._options,A.shaderPath=this._shaderPath,A.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,A.stencil=this.stencil.serialize(),A.textures={},this._textures)A.textures[X]=this._textures[X].serialize();for(X in A.textureArrays={},this._textureArrays){A.textureArrays[X]=[];const s=this._textureArrays[X];for(let N=0;N<s.length;N++)A.textureArrays[X].push(s[N].serialize())}for(X in A.ints={},this._ints)A.ints[X]=this._ints[X];for(X in A.uints={},this._uints)A.uints[X]=this._uints[X];for(X in A.floats={},this._floats)A.floats[X]=this._floats[X];for(X in A.floatsArrays={},this._floatsArrays)A.floatsArrays[X]=this._floatsArrays[X];for(X in A.colors3={},this._colors3){const s=this._colors3[X];A.colors3[X]=[s.r,s.g,s.b]}for(X in A.colors3Arrays={},this._colors3Arrays)A.colors3Arrays[X]=this._colors3Arrays[X];for(X in A.colors4={},this._colors4){const s=this._colors4[X];A.colors4[X]=[s.r,s.g,s.b,s.a]}for(X in A.colors4Arrays={},this._colors4Arrays)A.colors4Arrays[X]=this._colors4Arrays[X];for(X in A.vectors2={},this._vectors2){const s=this._vectors2[X];A.vectors2[X]=[s.x,s.y]}for(X in A.vectors3={},this._vectors3){const s=this._vectors3[X];A.vectors3[X]=[s.x,s.y,s.z]}for(X in A.vectors4={},this._vectors4){const s=this._vectors4[X];A.vectors4[X]=[s.x,s.y,s.z,s.w]}for(X in A.quaternions={},this._quaternions)A.quaternions[X]=this._quaternions[X].zi();for(X in A.matrices={},this._matrices)A.matrices[X]=this._matrices[X].zi();for(X in A.matrixArray={},this._matrixArrays)A.matrixArray[X]=this._matrixArrays[X];for(X in A.matrices3x3={},this._matrices3x3)A.matrices3x3[X]=this._matrices3x3[X];for(X in A.matrices2x2={},this._matrices2x2)A.matrices2x2[X]=this._matrices2x2[X];for(X in A.vectors2Arrays={},this._vectors2Arrays)A.vectors2Arrays[X]=this._vectors2Arrays[X];for(X in A.vectors3Arrays={},this._vectors3Arrays)A.vectors3Arrays[X]=this._vectors3Arrays[X];for(X in A.vectors4Arrays={},this._vectors4Arrays)A.vectors4Arrays[X]=this._vectors4Arrays[X];for(X in A.quaternionsArrays={},this._quaternionsArrays)A.quaternionsArrays[X]=this._quaternionsArrays[X];return A}static Parse(A,X,s){const f=Y.c.Parse((()=>new u(A.name,X,A.shaderPath,A.options,A.storeEffectOnSubMeshes)),A,X,s);let E;for(E in A.stencil&&f.stencil.parse(A.stencil,X,s),A.textures)f.setTexture(E,c.d.Parse(A.textures[E],X,s));for(E in A.textureArrays){const N=A.textureArrays[E],g=[];for(let A=0;A<N.length;A++)g.push(c.d.Parse(N[A],X,s));f.setTextureArray(E,g)}for(E in A.ints)f.setInt(E,A.ints[E]);for(E in A.uints)f.setUInt(E,A.uints[E]);for(E in A.floats)f.setFloat(E,A.floats[E]);for(E in A.floatsArrays)f.setFloats(E,A.floatsArrays[E]);for(E in A.colors3){const X=A.colors3[E];f.setColor3(E,{r:X[0],g:X[1],b:X[2]})}for(E in A.colors3Arrays){const X=A.colors3Arrays[E].reduce(((A,X,s)=>(s%3===0?A.push([X]):A[A.length-1].push(X),A)),[]).map((A=>({r:A[0],g:A[1],b:A[2]})));f.setColor3Array(E,X)}for(E in A.colors4){const X=A.colors4[E];f.setColor4(E,{r:X[0],g:X[1],b:X[2],a:X[3]})}for(E in A.colors4Arrays){const X=A.colors4Arrays[E].reduce(((A,X,s)=>(s%4===0?A.push([X]):A[A.length-1].push(X),A)),[]).map((A=>({r:A[0],g:A[1],b:A[2],a:A[3]})));f.setColor4Array(E,X)}for(E in A.vectors2){const X=A.vectors2[E];f.setVector2(E,{x:X[0],y:X[1]})}for(E in A.vectors3){const X=A.vectors3[E];f.setVector3(E,{x:X[0],y:X[1],z:X[2]})}for(E in A.vectors4){const X=A.vectors4[E];f.setVector4(E,{x:X[0],y:X[1],z:X[2],w:X[3]})}for(E in A.quaternions)f.setQuaternion(E,N.d.mi(A.quaternions[E]));for(E in A.matrices)f.setMatrix(E,N.c.mi(A.matrices[E]));for(E in A.matrixArray)f._matrixArrays[E]=new Float32Array(A.matrixArray[E]);for(E in A.matrices3x3)f.setMatrix3x3(E,A.matrices3x3[E]);for(E in A.matrices2x2)f.setMatrix2x2(E,A.matrices2x2[E]);for(E in A.vectors2Arrays)f.setArray2(E,A.vectors2Arrays[E]);for(E in A.vectors3Arrays)f.setArray3(E,A.vectors3Arrays[E]);for(E in A.vectors4Arrays)f.setArray4(E,A.vectors4Arrays[E]);for(E in A.quaternionsArrays)f.setArray4(E,A.quaternionsArrays[E]);return f}static async ParseFromFileAsync(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((f,E)=>{const g=new Q.b;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const X=JSON.parse(g.responseText),E=this.Parse(X,s||R.b.LastCreatedScene,N);A&&(E.name=A),f(E)}else E("Unable to load the ShaderMaterial")})),g.open("GET",X),g.send()}))}static async ParseFromSnippetAsync(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((N,f)=>{const E=new Q.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const f=JSON.parse(JSON.parse(E.responseText).jsonPayload),g=JSON.parse(f.shaderMaterial),K=this.Parse(g,X||R.b.LastCreatedScene,s);K.snippetId=A,N(K)}else f("Unable to load the snippet "+A)})),E.open("GET",this.SnippetUrl+"/"+A.replace(/#/g,"/")),E.send()}))}}u.SnippetUrl="https://snippet.babylonjs.com",u.CreateFromSnippetAsync=u.ParseFromSnippetAsync,(0,M.f)("BABYLON.ShaderMaterial",u),f.d._LinesMeshParser=(A,X)=>z.Parse(A,X);class z extends f.d{_isShaderMaterial(A){return"ShaderMaterial"===A.getClassName()}constructor(A){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0;super(A,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X,arguments.length>4?arguments[4]:void 0),this.useVertexColor=N,this.useVertexAlpha=f,this.color=new g.e(1,1,1),this.alpha=1,this._shaderLanguage=0,X&&(this.color=X.color.clone(),this.alpha=X.alpha,this.useVertexColor=X.useVertexColor,this.useVertexAlpha=X.useVertexAlpha),this.intersectionThreshold=.1;const r={attributes:[K.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?r.defines.push("#define VERTEXALPHA"):r.needAlphaBlending=!1,this.useVertexColor?(r.defines.push("#define VERTEXCOLOR"),r.attributes.push(K.e.ColorKind)):(r.uniforms.push("color"),this._color4=new g.h),E)this.material=E;else{this.va().getEngine().isWebGPU&&!z.ForceGLSL&&(this._shaderLanguage=1),r.shaderLanguage=this._shaderLanguage,r.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([s.e(43).then(s.bind(s,14046)),s.e(102).then(s.bind(s,14055))]):await Promise.all([s.e(48).then(s.bind(s,14058)),s.e(103).then(s.bind(s,14064))])},this.material=new u("colorShader",this.va(),"color",r,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(A){this._lineMaterial=A,this._lineMaterial.fillMode=i.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(A){}_bind(A,X){if(!this._geometry)return this;const s=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(X,s):this._geometry._bind(X,s,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:A,g:X,b:s}=this.color;this._color4.set(A,X,s,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(A,X,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const N=this.va().getEngine();return this._unIndexed?N.drawArraysType(i.c.LineListDrawMode,A.verticesStart,A.verticesCount,s):N.drawElementsType(i.c.LineListDrawMode,A.indexStart,A.indexCount,s),this}dispose(A){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(A)}clone(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;if(X&&void 0===X._addToSceneRootNodes){const s=X;return s.source=this,new z(A,this.va(),s.parent,s.source,s.doNotCloneChildren)}return new z(A,this.va(),X,this,s)}createInstance(A){const X=new m(A,this);if(this.instancedBuffers){X.instancedBuffers={};for(const A in this.instancedBuffers)X.instancedBuffers[A]=this.instancedBuffers[A]}return X}serialize(A){super.serialize(A),A.color=this.color.zi(),A.alpha=this.alpha}static Parse(A,X){const s=new z(A.name,X);return s.color=g.e.mi(A.color),s.alpha=A.alpha,s}}z.ForceGLSL=!1;class m extends r.d{constructor(A,X){super(A,X),this.intersectionThreshold=X.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var b=s(470);function y(A){const X=[],s=[],N=A.lines,f=A.za,g=[];let K=0;for(let E=0;E<N.length;E++){const A=N[E];for(let N=0;N<A.length;N++){const{x:r,y:i,z:Y}=A[N];if(s.push(r,i,Y),f){const A=f[E],{r:X,g:s,b:K,a:r}=A[N];g.push(X,s,K,r)}N>0&&(X.push(K-1),X.push(K)),K++}}const r=new E.b;return r.indices=X,r.xa=s,f&&(r.za=g),r}function j(A){const X=A.dashSize||3,s=A.gapSize||1,f=A.dashNb||200,g=A.points,K=[],r=[],i=N.k.Zero();let Y=0,v=0,c=0,M=0,d=0,Q=0,w=0;for(w=0;w<g.length-1;w++)g[w+1].subtractToRef(g[w],i),Y+=i.length();for(c=Y/f,M=X*c/(X+s),w=0;w<g.length-1;w++){g[w+1].subtractToRef(g[w],i),v=Math.floor(i.length()/c),i.normalize();for(let A=0;A<v;A++)d=c*A,K.push(g[w].x+d*i.x,g[w].y+d*i.y,g[w].z+d*i.z),K.push(g[w].x+(d+M)*i.x,g[w].y+(d+M)*i.y,g[w].z+(d+M)*i.z),r.push(Q,Q+1),Q+=2}const R=new E.b;return R.xa=K,R.indices=r,R}function G(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=X.instance,f=X.lines,E=X.za;if(N){const A=N.getVerticesData(K.e.PositionKind);let X,s;E&&(X=N.getVerticesData(K.e.ColorKind));let g=0,r=0;for(let N=0;N<f.length;N++){const K=f[N];for(let f=0;f<K.length;f++)A[g]=K[f].x,A[g+1]=K[f].y,A[g+2]=K[f].z,E&&X&&(s=E[N],X[r]=s[f].r,X[r+1]=s[f].g,X[r+2]=s[f].b,X[r+3]=s[f].a,r+=4),g+=3}return N.updateVerticesData(K.e.PositionKind,A,!1,!1),E&&X&&N.updateVerticesData(K.e.ColorKind,X,!1,!1),N.refreshBoundingInfo(),N}const g=new z(A,s,null,void 0,void 0,!!E,X.useVertexAlpha,X.material);return y(X).Ca(g,X.updatable),g}function V(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=X.za?[X.za]:null;return G(A,{lines:[X.points],updatable:X.updatable,instance:X.instance,za:N,useVertexAlpha:X.useVertexAlpha,material:X.material},s)}function D(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=X.points,g=X.instance,K=X.gapSize||1,r=X.dashSize||3;if(g){const A=A=>{const X=N.k.Zero(),s=A.length/6;let f=0,K=0,r=0,i=0,Y=0,v=0,c=0,M=0;for(c=0;c<E.length-1;c++)E[c+1].subtractToRef(E[c],X),f+=X.length();r=f/s;const d=g._creationDataStorage.dashSize;for(i=d*r/(d+g._creationDataStorage.gapSize),c=0;c<E.length-1;c++)for(E[c+1].subtractToRef(E[c],X),K=Math.floor(X.length()/r),X.normalize(),M=0;M<K&&v<A.length;)Y=r*M,A[v]=E[c].x+Y*X.x,A[v+1]=E[c].y+Y*X.y,A[v+2]=E[c].z+Y*X.z,A[v+3]=E[c].x+(Y+i)*X.x,A[v+4]=E[c].y+(Y+i)*X.y,A[v+5]=E[c].z+(Y+i)*X.z,v+=6,M++;for(;v<A.length;)A[v]=E[c].x,A[v+1]=E[c].y,A[v+2]=E[c].z,v+=3};return(X.dashNb||X.dashSize||X.gapSize||X.useVertexAlpha||X.material)&&b.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),g.updateMeshPositions(A,!1),g}const i=new z(A,s,null,void 0,void 0,void 0,X.useVertexAlpha,X.material);return j(X).Ca(i,X.updatable),i._creationDataStorage=new f.f,i._creationDataStorage.dashSize=r,i._creationDataStorage.gapSize=K,i}E.b.CreateLineSystem=y,E.b.CreateDashedLines=j,f.d.Ei=function(A,X){return V(A,{points:X,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},f.d.CreateDashedLines=function(A,X,s,N,f){return D(A,{points:X,dashSize:s,gapSize:N,dashNb:f,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12221:(A,X,s)=>{"use strict";s.d(X,{c:()=>K,d:()=>r});var N=s(452),f=s(750),E=s(795);function g(A){const X=[],s=[],N=[],g=[],K=void 0!==A.width?A.width:void 0!==A.size?A.size:1,r=void 0!==A.height?A.height:void 0!==A.size?A.size:1,i=0===A.sideOrientation?0:A.sideOrientation||f.b.DEFAULTSIDE,Y=K/2,v=r/2;s.push(-Y,-v,0),N.push(0,0,-1),g.push(0,E.b?1:0),s.push(Y,-v,0),N.push(0,0,-1),g.push(1,E.b?1:0),s.push(Y,v,0),N.push(0,0,-1),g.push(1,E.b?0:1),s.push(-Y,v,0),N.push(0,0,-1),g.push(0,E.b?0:1),X.push(0),X.push(1),X.push(2),X.push(0),X.push(2),X.push(3),f.b._ComputeSides(i,s,X,N,g,A.frontUVs,A.backUVs);const c=new f.b;return c.indices=X,c.xa=s,c.ya=N,c.Aa=g,c}function K(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new N.d(A,s);X.sideOrientation=N.d._GetDefaultSideOrientation(X.sideOrientation),f._originalBuilderSideOrientation=X.sideOrientation;return g(X).Ca(f,X.updatable),X.sourcePlane&&(f.translate(X.sourcePlane.Si,-X.sourcePlane.d),f.setDirection(X.sourcePlane.Si.scale(-1))),f}const r={Fi:K};f.b.Fi=g,N.d.Fi=(A,X,s,N,f)=>K(A,{size:X,width:X,height:X,sideOrientation:f,updatable:N},s)},12315:(A,X,s)=>{"use strict";s.d(X,{b:()=>r});var N=s(678),f=s(452),E=s(750),g=s(795);function K(A){const X=0|(A.segments||32),s=A.diameterX||A.diameter||1,f=A.diameterY||A.diameter||1,K=A.diameterZ||A.diameter||1,r=A.arc&&(A.arc<=0||A.arc>1)?1:A.arc||1,i=A.slice&&A.slice<=0?1:A.slice||1,Y=0===A.sideOrientation?0:A.sideOrientation||E.b.DEFAULTSIDE,v=!!A.dedupTopBottomIndices,c=new N.k(s/2,f/2,K/2),M=2+X,d=2*M,Q=[],w=[],R=[],C=[];for(let E=0;E<=M;E++){const A=E/M,X=A*Math.PI*i;for(let s=0;s<=d;s++){const f=s/d,E=f*Math.PI*2*r,K=N.c.RotationZ(-X),i=N.c.RotationY(E),Y=N.k.TransformCoordinates(N.k.Up(),K),v=N.k.TransformCoordinates(Y,i),M=v.multiply(c),Q=v.divide(c).normalize();w.push(M.x,M.y,M.z),R.push(Q.x,Q.y,Q.z),C.push(f,g.b?1-A:A)}if(E>0){const A=w.length/3;for(let X=A-2*(d+1);X+d+2<A;X++)v?(E>1&&(Q.push(X),Q.push(X+1),Q.push(X+d+1)),(E<M||i<1)&&(Q.push(X+d+1),Q.push(X+1),Q.push(X+d+2))):(Q.push(X),Q.push(X+1),Q.push(X+d+1),Q.push(X+d+1),Q.push(X+1),Q.push(X+d+2))}}E.b._ComputeSides(Y,w,Q,R,C,A.frontUVs,A.backUVs);const J=new E.b;return J.indices=Q,J.xa=w,J.ya=R,J.Aa=C,J}function r(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return K(X).Ca(N,X.updatable),N}E.b.CreateSphere=K,f.d.CreateSphere=(A,X,s,N,f,E)=>r(A,{segments:X,diameterX:s,diameterY:s,diameterZ:s,sideOrientation:E,updatable:f},N)},12645:(A,X,s)=>{"use strict";s.d(X,{b:()=>r,c:()=>g,g:()=>K});var N=s(456),f=s(2510),E=s(12647);function g(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function K(A){return!!(A.wasmUrl&&(A.wasmBinary||A.wasmBinaryUrl)&&"object"===typeof WebAssembly||A.fallbackUrl)}class r{constructor(A){if(A.workerPool)return void(this._workerPoolPromise=Promise.resolve(A.workerPool));const X=A.wasmBinary,s=A.numWorkers??g(),K=s&&"function"===typeof Worker&&"function"===typeof URL,r=K||!A.jsModule,i=A.wasmUrl&&A.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:r?N.d.GetBabylonScriptURL(A.wasmUrl,!0):"",wasmBinaryPromise:X?Promise.resolve(X):N.d.LoadFileAsync(N.d.GetBabylonScriptURL(A.wasmBinaryUrl,!0))}:{url:r?N.d.GetBabylonScriptURL(A.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};K?this._workerPoolPromise=i.wasmBinaryPromise.then((A=>{const X=this._getWorkerContent(),N=URL.createObjectURL(new Blob([X],{type:"application/javascript"}));return new f.d(s,(()=>{const X=new Worker(N);return(0,E.k)(X,A,i.url)}))})):this._modulePromise=i.wasmBinaryPromise.then((async X=>{if(!this._isModuleAvailable()&&!A.jsModule){if(!i.url)throw new Error("Draco codec module is not available");await N.d.LoadBabylonScriptAsync(i.url)}return await this._createModuleAsync(X,A.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((A=>{A.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},12966:(A,X,s)=>{"use strict";s.d(X,{b:()=>K});var N=s(12645),f=s(12638),E=s(12652),g=s(750);class K{static get Configuration(){return{get decoder(){return f.c.DefaultConfiguration},set decoder(A){f.c.DefaultConfiguration=A}}}static set Configuration(A){f.c.DefaultConfiguration=A.decoder}static get DecoderAvailable(){return(0,N.g)(f.c.DefaultConfiguration)}static get Default(){return K._Default??(K._Default=new K),K._Default}static ResetDefault(A){K._Default&&(A||K._Default.dispose(),K._Default=null)}constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.DefaultNumWorkers;const X="number"===typeof A?{...f.c.DefaultConfiguration,numWorkers:A}:{...f.c.DefaultConfiguration,...A};this._decoder=new f.c(X)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(A,X,s){return this._decoder.decodeMeshToMeshDataAsync(A,X,s)}async decodeMeshToGeometryAsync(A,X,s,N){return await this._decoder.decodeMeshToGeometryAsync(A,X,s,N)}async _decodeMeshToGeometryForGltfAsync(A,X,s,N,f,E){return await this._decoder._decodeMeshToGeometryForGltfAsync(A,X,s,N,f,E)}async decodeMeshAsync(A,X){const s=await this._decoder.decodeMeshToMeshDataAsync(A,X),N=new g.b;s.indices&&(N.indices=s.indices);for(const f of s.attributes){const A=E.c.GetFloatData(f.data,f.size,E.c.GetDataType(f.data),f.byteOffset,f.byteStride,f.normalized,s.totalVertices);N.set(A,f.kind)}return N}}K.DefaultNumWorkers=(0,N.c)(),K._Default=null},12647:(A,X,s)=>{"use strict";function N(A,X,s,N,f){const E=A;let g=null,K=null,r=null;try{let A;g=new E.Decoder,K=new E.DecoderBuffer,K.Init(X,X.byteLength);const i=g.GetEncodedGeometryType(K);switch(i){case E.TRIANGULAR_MESH:{const X=new E.Mesh;if(A=g.DecodeBufferToMesh(K,X),!A.ok()||0===X.ptr)throw new Error(A.error_msg());const s=3*X.num_faces(),f=4*s,i=E._malloc(f);try{g.GetTrianglesUInt32Array(X,f,i);const A=new Uint32Array(s);A.set(new Uint32Array(E.HEAPF32.buffer,i,s)),N(A)}finally{E._free(i)}r=X;break}case E.POINT_CLOUD:{const X=new E.PointCloud;if(A=g.DecodeBufferToPointCloud(K,X),!A.ok()||!X.ptr)throw new Error(A.error_msg());r=X;break}default:throw new Error(`Invalid geometry type ${i}`)}const Y=r.num_points(),v=(A,X,s,N)=>{const g=N.data_type(),K=N.num_components(),r=N.normalized(),i=N.byte_stride(),v=N.byte_offset(),c={[E.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:E.HEAPF32},[E.DT_INT8]:{typedArrayConstructor:Int8Array,heap:E.HEAP8},[E.DT_INT16]:{typedArrayConstructor:Int16Array,heap:E.HEAP16},[E.DT_INT32]:{typedArrayConstructor:Int32Array,heap:E.HEAP32},[E.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:E.HEAPU8},[E.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:E.HEAPU16},[E.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:E.HEAPU32}}[g];if(!c)throw new Error(`Invalid data type ${g}`);const M=Y*K,d=M*c.typedArrayConstructor.BYTES_PER_ELEMENT,Q=E._malloc(d);try{A.GetAttributeDataArrayForAllPoints(X,N,g,d,Q);const E=new c.typedArrayConstructor(c.heap.buffer,Q,M);f(s,E.slice(),K,v,i,r)}finally{E._free(Q)}};if(s)for(const X in s){const A=s[X],N=g.GetAttributeByUniqueId(r,A);v(g,r,X,N)}else{const A={position:E.POSITION,Si:E.NORMAL,color:E.COLOR,uv:E.TEX_COORD};for(const X in A){const s=g.GetAttributeId(r,A[X]);if(-1!==s){const A=g.GetAttribute(r,s);v(g,r,X,A)}}}return Y}finally{r&&E.destroy(r),K&&E.destroy(K),g&&E.destroy(g)}}function f(){let A;onmessage=X=>{const s=X.data;switch(s.id){case"init":{s.url&&importScripts(s.url);const X=s.wasmBinary?{wasmBinary:s.wasmBinary}:{};A=DracoDecoderModule(X),postMessage({id:"initDone"});break}case"decodeMesh":if(!A)throw new Error("Draco decoder module is not available");A.then((A=>{const X=N(A,s.dataView,s.attributes,(A=>{postMessage({id:"indices",data:A},[A.buffer])}),((A,X,s,N,f,E)=>{postMessage({id:"attribute",kind:A,data:X,size:s,byteOffset:N,byteStride:f,normalized:E},[X.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:X})}))}}}async function E(A,X,s){return await new Promise(((N,f)=>{const E=X=>{A.removeEventListener("error",E),A.removeEventListener("message",g),f(X)},g=X=>{"initDone"===X.data.id&&(A.removeEventListener("error",E),A.removeEventListener("message",g),N(A))};if(A.addEventListener("error",E),A.addEventListener("message",g),X){const N=X.slice(0);A.postMessage({id:"init",url:s,wasmBinary:N},[N])}else A.postMessage({id:"init",url:s})}))}s.d(X,{d:()=>N,h:()=>f,k:()=>E})},12638:(A,X,s)=>{"use strict";s.d(X,{c:()=>i});var N=s(12645),f=s(456),E=s(779),g=s(12652),K=s(470),r=s(12647);class i extends N.b{static get DefaultAvailable(){return(0,N.g)(i.DefaultConfiguration)}static get Default(){return i._Default??(i._Default=new i),i._Default}static ResetDefault(A){i._Default&&(A||i._Default.dispose(),i._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(A,X){return{module:await(X||DracoDecoderModule)({wasmBinary:A})}}_getWorkerContent(){return`${r.d}(${r.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DefaultConfiguration)}decodeMeshToMeshDataAsync(A,X,s){const N=A instanceof ArrayBuffer?new Int8Array(A):new Int8Array(A.buffer,A.byteOffset,A.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async A=>await new Promise(((f,E)=>{A.push(((A,g)=>{let r=null;const i=[],Y=X=>{A.removeEventListener("error",Y),A.removeEventListener("message",v),E(X),g()},v=X=>{const N=X.data;switch(N.id){case"indices":r=N.data;break;case"attribute":i.push({kind:N.kind,data:N.data,size:N.size,byteOffset:N.byteOffset,byteStride:N.byteStride,normalized:(E=N.kind,c=N.normalized,s&&void 0!==s[E]?(c!==s[E]&&K.b.Warn(`Normalized flag from Draco data (${c}) does not match normalized flag from glTF accessor (${s[E]}). Using flag from glTF accessor.`),s[E]):c)});break;case"decodeMeshDone":A.removeEventListener("error",Y),A.removeEventListener("message",v),f({indices:r,attributes:i,totalVertices:N.totalVertices}),g()}var E,c};A.addEventListener("error",Y),A.addEventListener("message",v);const c=N.slice();A.postMessage({id:"decodeMesh",dataView:c,attributes:X},[c.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((A=>{let s=null;const f=[],E=(0,r.d)(A.module,N,X,(A=>{s=A}),((A,X,s,N,E,g)=>{f.push({kind:A,data:X,size:s,byteOffset:N,byteStride:E,normalized:g})}));return{indices:s,attributes:f,totalVertices:E}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(A,X,s,N){const f=await this.decodeMeshToMeshDataAsync(s,N),K=new E.b(A,X);f.indices&&K.setIndices(f.indices);for(const E of f.attributes)K.setVerticesBuffer(new g.c(X.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),f.totalVertices);return K}async _decodeMeshToGeometryForGltfAsync(A,X,s,N,f,K){const r=await this.decodeMeshToMeshDataAsync(s,N,f),i=new E.b(A,X);K&&(i._boundingInfo=K,i.useBoundingInfoFromGeometry=!0),r.indices&&i.setIndices(r.indices);for(const E of r.attributes)i.setVerticesBuffer(new g.c(X.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),r.totalVertices);return i}}i.DefaultConfiguration={wasmUrl:`${f.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${f.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${f.d._DefaultCdnUrl}/draco_decoder_gltf.js`},i._Default=null},12652:(A,X,s)=>{"use strict";s.d(X,{c:()=>N.e});var N=s(728)},12593:(A,X,s)=>{"use strict";s.d(X,{d:()=>c});var N=s(678),f=s(470),E=s(804),g=s(452),K=s(479),r=s(810),i=s(728),Y=s(456),v=s(616);g.d._instancedMeshFactory=(A,X)=>{const s=new c(A,X);if(X.instancedBuffers){s.instancedBuffers={};for(const A in X.instancedBuffers)s.instancedBuffers[A]=X.instancedBuffers[A]}return s};class c extends E.e{constructor(A,X){super(A,X.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,X.Ci(this),this._sourceMesh=X,this._unIndexed=X._unIndexed,this.position.p(X.position),this.rotation.p(X.rotation),this.hi.p(X.hi),X.rotationQuaternion&&(this.rotationQuaternion=X.rotationQuaternion.clone()),this.animations=X.animations.slice();for(const s of X.getAnimationRanges())null!=s&&this.createAnimationRange(s.name,s.from,s.to);if(this.infiniteDistance=X.infiniteDistance,this.setPivotMatrix(X.getPivotMatrix()),X.skeleton||X.morphTargetManager||!X.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const A=X.getBoundingInfo();this.buildBoundingInfo(A.minimum,A.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(A){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.receiveShadows)!==A&&Y.d.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(A){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.material)!==A&&Y.d.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(A){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.visibility)!==A&&Y.d.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(A){var X;(null===(X=this._sourceMesh)||void 0===X?void 0:X.skeleton)!==A&&Y.d.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(A){this._sourceMesh&&A!==this._sourceMesh.renderingGroupId&&f.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get pi(){return this._sourceMesh._geometry}createInstance(A){return this._sourceMesh.createInstance(A)}isReady(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(A,!0)}getVerticesData(A,X,s){return this._sourceMesh.getVerticesData(A,X,s)}copyVerticesData(A,X){this._sourceMesh.copyVerticesData(A,X)}Ga(A,X,s,N){return this.sourceMesh&&this.sourceMesh.Ga(A,X,s,N),this.sourceMesh}updateVerticesData(A,X,s,N){return this.sourceMesh&&this.sourceMesh.updateVerticesData(A,X,s,N),this.sourceMesh}setIndices(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(A,X),this.sourceMesh}isVerticesDataPresent(A){return this._sourceMesh.isVerticesDataPresent(A)}ti(){return this._sourceMesh.ti()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let A,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;A="object"===typeof X?X:{applySkeleton:X,applyMorph:s};const N=this._sourceMesh.pi?this._sourceMesh.pi.boundingBias:null;return this.Fa(this._sourceMesh._getData(A,null,i.e.PositionKind),N),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(A,X){if(super._activate(A,X),this._sourceMesh.wi||f.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,A),X){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==r.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new N.c);const A=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,N.f.oi[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.si(!0)),this._currentLOD.position.p(N.f.oi[7]),this._currentLOD._masterMesh=A,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(A){if(!A)return this;const X=this.sourceMesh.getLODLevels();if(X&&0!==X.length){const X=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(A,X.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(A){return this.sourceMesh._preActivateForIntermediateRendering(A)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.wi)for(let A=0;A<this._sourceMesh.wi.length;A++)this._sourceMesh.wi[A].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;const N=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(A);if(K.d.DeepCopy(this,N,["name","wi","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","qi","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","pi"],[]),this.refreshBoundingInfo(),X&&(N.parent=X),!s)for(let f=0;f<this.va().meshes.length;f++){const A=this.va().meshes[f];A.parent===this&&A.clone(A.name,N)}return N.si(!0),this.onClonedObservable.notifyObservers(N),N}dispose(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Di(this),super.dispose(A,X)}_serializeAsParent(A){super._serializeAsParent(A),A.parentId=this._sourceMesh.uniqueId,A.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;const N=this.clone("Clone of "+(this.name||this.id),A||this.parent,!0,X&&X.newSourcedMesh);N&&s&&s(this,N);for(const f of this.getChildTransformNodes(!0))f.instantiateHierarchy(N,X,s);return N}}g.d.prototype.registerInstancedBuffer=function(A,X){var s,N;if(null===(s=this._userInstancedBuffersStorage)||void 0===s||null===(N=s.vertexBuffers[A])||void 0===N||N.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const A of this.instances)A.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[A]=null,this._userInstancedBuffersStorage.strides[A]=X,this._userInstancedBuffersStorage.sizes[A]=32*X,this._userInstancedBuffersStorage.data[A]=new Float32Array(this._userInstancedBuffersStorage.sizes[A]),this._userInstancedBuffersStorage.vertexBuffers[A]=new i.e(this.getEngine(),this._userInstancedBuffersStorage.data[A],A,!0,!1,X,!0);for(const f of this.instances)f.instancedBuffers[A]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},g.d.prototype._processInstancedBuffers=function(A,X){const s=A?A.length:0;for(const N in this.instancedBuffers){let f=this._userInstancedBuffersStorage.sizes[N];const E=this._userInstancedBuffersStorage.strides[N],g=(s+1)*E;for(;f<g;)f*=2;this._userInstancedBuffersStorage.data[N].length!=f&&(this._userInstancedBuffersStorage.data[N]=new Float32Array(f),this._userInstancedBuffersStorage.sizes[N]=f,this._userInstancedBuffersStorage.vertexBuffers[N]&&(this._userInstancedBuffersStorage.vertexBuffers[N].dispose(),this._userInstancedBuffersStorage.vertexBuffers[N]=null));const K=this._userInstancedBuffersStorage.data[N];let r=0;if(X){const A=this.instancedBuffers[N];A.toArray?A.toArray(K,r):A.copyToArray?A.copyToArray(K,r):K[r]=A,r+=E}for(let X=0;X<s;X++){const s=A[X].instancedBuffers[N];s.toArray?s.toArray(K,r):s.copyToArray?s.copyToArray(K,r):K[r]=s,r+=E}this._userInstancedBuffersStorage.vertexBuffers[N]?this._userInstancedBuffersStorage.vertexBuffers[N].updateDirectly(K,0):(this._userInstancedBuffersStorage.vertexBuffers[N]=new i.e(this.getEngine(),this._userInstancedBuffersStorage.data[N],N,!0,!1,E,!0),this._invalidateInstanceVertexArrayObject())}},g.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const A in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[A]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},g.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const A in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[A]&&this._userInstancedBuffersStorage.vertexBuffers[A].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,v.f)("BABYLON.InstancedMesh",c)},12844:(A,X,s)=>{"use strict";s.d(X,{d:()=>QA});var N=s(678),f=s(452),E=s(728),g=s(750),K=s(795);function r(A){let X=A.pathArray;const s=A.closeArray||!1,N=A.closePath||!1,f=A.invertUV||!1,r=Math.floor(X[0].length/2);let i=A.offset||r;i=i>r?r:Math.floor(i);const Y=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE,v=A.Aa,c=A.za,M=[],d=[],Q=[],w=[],R=[],C=[],J=[],a=[];let u;const z=[],m=[];let b,y,j;if(X.length<2){const A=[],s=[];for(y=0;y<X[0].length-i;y++)A.push(X[0][y]),s.push(X[0][y+i]);X=[A,s]}let G=0;const V=N?1:0,D=s?1:0;let O,P,l,n,U,t;for(u=X[0].length,b=0;b<X.length+D;b++){for(J[b]=0,R[b]=[0],O=b===X.length?X[0]:X[b],P=O.length,u=u<P?u:P,j=0;j<P;)M.push(O[j].x,O[j].y,O[j].z),j>0&&(l=O[j].Pg(O[j-1]).length(),n=l+J[b],R[b].push(n),J[b]=n),j++;N&&(j--,M.push(O[0].x,O[0].y,O[0].z),l=O[j].Pg(O[0]).length(),n=l+J[b],R[b].push(n),J[b]=n),z[b]=P+V,m[b]=G,G+=P+V}let e,T,I=null,L=null;for(y=0;y<u+V;y++)for(a[y]=0,C[y]=[0],b=0;b<X.length-1+D;b++)U=X[b],t=b===X.length-1?X[0]:X[b+1],y===u?(I=U[0],L=t[0]):(I=U[y],L=t[y]),l=L.Pg(I).length(),n=l+a[y],C[y].push(n),a[y]=n;if(v)for(b=0;b<v.length;b++)w.push(v[b].x,K.b?1-v[b].y:v[b].y);else for(b=0;b<X.length+D;b++)for(y=0;y<u+V;y++)e=0!=J[b]?R[b][y]/J[b]:0,T=0!=a[y]?C[y][b]/a[y]:0,f?w.push(T,e):w.push(e,K.b?1-T:T);b=0;let k=0,x=z[b]-1,H=z[b+1]-1,F=x<H?x:H,q=m[1]-m[0];const S=z.length-1;for(;k<=F&&b<S;)d.push(k,k+q,k+1),d.push(k+q+1,k+1,k+q),k+=1,k===F&&(b++,q=m[b+1]-m[b],x=z[b]-1,H=z[b+1]-1,k=m[b],F=x<H?x+k:H+k);if(g.b.ComputeNormals(M,d,Q),N){let A=0,s=0;for(b=0;b<X.length;b++){A=3*m[b],s=b+1<X.length?3*(m[b+1]-1):Q.length-3,Q[A]=.5*(Q[A]+Q[s]),Q[A+1]=.5*(Q[A+1]+Q[s+1]),Q[A+2]=.5*(Q[A+2]+Q[s+2]);const N=Math.sqrt(Q[A]*Q[A]+Q[A+1]*Q[A+1]+Q[A+2]*Q[A+2]);Q[A]/=N,Q[A+1]/=N,Q[A+2]/=N,Q[s]=Q[A],Q[s+1]=Q[A+1],Q[s+2]=Q[A+2]}}if(s){let A=3*m[0],s=3*m[X.length];for(y=0;y<u+V;y++){Q[A]=.5*(Q[A]+Q[s]),Q[A+1]=.5*(Q[A+1]+Q[s+1]),Q[A+2]=.5*(Q[A+2]+Q[s+2]);const X=Math.sqrt(Q[A]*Q[A]+Q[A+1]*Q[A+1]+Q[A+2]*Q[A+2]);Q[A]/=X,Q[A+1]/=X,Q[A+2]/=X,Q[s]=Q[A],Q[s+1]=Q[A+1],Q[s+2]=Q[A+2],A+=3,s+=3}}g.b._ComputeSides(Y,M,d,Q,w,A.frontUVs,A.backUVs);let p=null;if(c){p=new Float32Array(4*c.length);for(let A=0;A<c.length;A++)p[4*A]=c[A].r,p[4*A+1]=c[A].g,p[4*A+2]=c[A].b,p[4*A+3]=c[A].a}const B=new g.b,Z=new Float32Array(M),o=new Float32Array(Q),W=new Float32Array(w);return B.indices=d,B.xa=Z,B.ya=o,B.Aa=W,p&&B.set(p,E.e.ColorKind),N&&(B._idx=m),B}function i(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=X.pathArray,Y=X.closeArray,v=X.closePath,c=f.d._GetDefaultSideOrientation(X.sideOrientation),M=X.instance,d=X.updatable;if(M){const A=N.f.oi[0].ni(Number.MAX_VALUE),s=N.f.oi[1].ni(-Number.MAX_VALUE),r=X=>{let N=i[0].length;const E=M;let g=0;const K=E._originalBuilderSideOrientation===f.d.DOUBLESIDE?2:1;for(let f=1;f<=K;++f)for(let K=0;K<i.length;++K){const f=i[K],r=f.length;N=N<r?N:r;for(let E=0;E<N;++E){const N=f[E];X[g]=N.x,X[g+1]=N.y,X[g+2]=N.z,A.minimizeInPlaceFromFloats(N.x,N.y,N.z),s.maximizeInPlaceFromFloats(N.x,N.y,N.z),g+=3}if(E._creationDataStorage&&E._creationDataStorage.closePath){const A=f[0];X[g]=A.x,X[g+1]=A.y,X[g+2]=A.z,g+=3}}},Y=M.getVerticesData(E.e.PositionKind);if(r(Y),M.hasBoundingInfo?M.getBoundingInfo().reConstruct(A,s,M._worldMatrix):M.buildBoundingInfo(A,s,M._worldMatrix),M.updateVerticesData(E.e.PositionKind,Y,!1,!1),X.za){const A=M.getVerticesData(E.e.ColorKind);for(let s=0,N=0;s<X.za.length;s++,N+=4){const f=X.za[s];A[N]=f.r,A[N+1]=f.g,A[N+2]=f.b,A[N+3]=f.a}M.updateVerticesData(E.e.ColorKind,A,!1,!1)}if(X.Aa){const A=M.getVerticesData(E.e.UVKind);for(let s=0;s<X.Aa.length;s++)A[2*s]=X.Aa[s].x,A[2*s+1]=K.b?1-X.Aa[s].y:X.Aa[s].y;M.updateVerticesData(E.e.UVKind,A,!1,!1)}if(!M.areNormalsFrozen||M.isFacetDataEnabled){const A=M.ti(),X=M.getVerticesData(E.e.NormalKind),s=M.isFacetDataEnabled?M.getFacetDataParameters():null;if(g.b.ComputeNormals(Y,A,X,s),M._creationDataStorage&&M._creationDataStorage.closePath){let A=0,s=0;for(let N=0;N<i.length;N++)A=3*M._creationDataStorage.idx[N],s=N+1<i.length?3*(M._creationDataStorage.idx[N+1]-1):X.length-3,X[A]=.5*(X[A]+X[s]),X[A+1]=.5*(X[A+1]+X[s+1]),X[A+2]=.5*(X[A+2]+X[s+2]),X[s]=X[A],X[s+1]=X[A+1],X[s+2]=X[A+2]}M.areNormalsFrozen||M.updateVerticesData(E.e.NormalKind,X,!1,!1)}return M}{const N=new f.d(A,s);N._originalBuilderSideOrientation=c,N._creationDataStorage=new f.f;const E=r(X);return v&&(N._creationDataStorage.idx=E._idx),N._creationDataStorage.closePath=v,N._creationDataStorage.closeArray=Y,E.Ca(N,d),N}}g.b.CreateRibbon=r,f.d.CreateRibbon=function(A,X){return i(A,{pathArray:X,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var Y=s(856),v=s(12173),c=s(709);function M(A){const X=A.pattern||f.d.NO_FLIP,s=A.tileWidth||A.tileSize||1,N=A.tileHeight||A.tileSize||1,E=A.alignHorizontal||0,K=A.alignVertical||0,r=A.width||A.size||1,i=Math.floor(r/s);let Y=r-i*s;const v=A.height||A.size||1,c=Math.floor(v/N);let M=v-c*N;const d=s*i/2,Q=N*c/2;let w=0,R=0,C=0,J=0,a=0,u=0;if(Y>0||M>0){switch(C=-d,J=-Q,a=d,u=Q,E){case f.d.CENTER:Y/=2,C-=Y,a+=Y;break;case f.d.LEFT:a+=Y,w=-Y/2;break;case f.d.RIGHT:C-=Y,w=Y/2}switch(K){case f.d.CENTER:M/=2,J-=M,u+=M;break;case f.d.BOTTOM:u+=M,R=-M/2;break;case f.d.TOP:J-=M,R=M/2}}const z=[],m=[],b=[];b[0]=[0,0,1,0,1,1,0,1],b[1]=[0,0,1,0,1,1,0,1],X!==f.d.ROTATE_TILE&&X!==f.d.ROTATE_ROW||(b[1]=[1,1,0,1,0,0,1,0]),X!==f.d.FLIP_TILE&&X!==f.d.FLIP_ROW||(b[1]=[1,0,0,0,0,1,1,1]),X!==f.d.FLIP_N_ROTATE_TILE&&X!==f.d.FLIP_N_ROTATE_ROW||(b[1]=[0,1,1,1,1,0,0,0]);let y=[];const j=[],G=[];let V=0;for(let g=0;g<c;g++)for(let A=0;A<i;A++)z.push(A*s-d+w,g*N-Q+R,0),z.push((A+1)*s-d+w,g*N-Q+R,0),z.push((A+1)*s-d+w,(g+1)*N-Q+R,0),z.push(A*s-d+w,(g+1)*N-Q+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),y=X===f.d.FLIP_TILE||X===f.d.ROTATE_TILE||X===f.d.FLIP_N_ROTATE_TILE?y.concat(b[(A%2+g%2)%2]):X===f.d.FLIP_ROW||X===f.d.ROTATE_ROW||X===f.d.FLIP_N_ROTATE_ROW?y.concat(b[g%2]):y.concat(b[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),V+=4;if(Y>0||M>0){const A=M>0&&(K===f.d.CENTER||K===f.d.TOP),g=M>0&&(K===f.d.CENTER||K===f.d.BOTTOM),r=Y>0&&(E===f.d.CENTER||E===f.d.RIGHT),v=Y>0&&(E===f.d.CENTER||E===f.d.LEFT);let b,D,O,P,l=[];if(A&&r&&(z.push(C+w,J+R,0),z.push(-d+w,J+R,0),z.push(-d+w,J+M+R,0),z.push(C+w,J+M+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,b=1-Y/s,D=1-M/N,O=1,P=1,l=[b,D,O,D,O,P,b,P],X===f.d.ROTATE_ROW&&(l=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),X===f.d.FLIP_ROW&&(l=[1-b,D,1-O,D,1-O,P,1-b,P]),X===f.d.FLIP_N_ROTATE_ROW&&(l=[b,1-D,O,1-D,O,1-P,b,1-P]),y=y.concat(l),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&v&&(z.push(d+w,J+R,0),z.push(a+w,J+R,0),z.push(a+w,J+M+R,0),z.push(d+w,J+M+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,b=0,D=1-M/N,O=Y/s,P=1,l=[b,D,O,D,O,P,b,P],(X===f.d.ROTATE_ROW||X===f.d.ROTATE_TILE&&i%2===0)&&(l=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),(X===f.d.FLIP_ROW||X===f.d.FLIP_TILE&&i%2===0)&&(l=[1-b,D,1-O,D,1-O,P,1-b,P]),(X===f.d.FLIP_N_ROTATE_ROW||X===f.d.FLIP_N_ROTATE_TILE&&i%2===0)&&(l=[b,1-D,O,1-D,O,1-P,b,1-P]),y=y.concat(l),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&r&&(z.push(C+w,Q+R,0),z.push(-d+w,Q+R,0),z.push(-d+w,u+R,0),z.push(C+w,u+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,b=1-Y/s,D=0,O=1,P=M/N,l=[b,D,O,D,O,P,b,P],(X===f.d.ROTATE_ROW&&c%2===1||X===f.d.ROTATE_TILE&&c%1===0)&&(l=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),(X===f.d.FLIP_ROW&&c%2===1||X===f.d.FLIP_TILE&&c%2===0)&&(l=[1-b,D,1-O,D,1-O,P,1-b,P]),(X===f.d.FLIP_N_ROTATE_ROW&&c%2===1||X===f.d.FLIP_N_ROTATE_TILE&&c%2===0)&&(l=[b,1-D,O,1-D,O,1-P,b,1-P]),y=y.concat(l),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&v&&(z.push(d+w,Q+R,0),z.push(a+w,Q+R,0),z.push(a+w,u+R,0),z.push(d+w,u+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,b=0,D=0,O=Y/s,P=M/N,l=[b,D,O,D,O,P,b,P],(X===f.d.ROTATE_ROW&&c%2===1||X===f.d.ROTATE_TILE&&(c+i)%2===1)&&(l=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),(X===f.d.FLIP_ROW&&c%2===1||X===f.d.FLIP_TILE&&(c+i)%2===1)&&(l=[1-b,D,1-O,D,1-O,P,1-b,P]),(X===f.d.FLIP_N_ROTATE_ROW&&c%2===1||X===f.d.FLIP_N_ROTATE_TILE&&(c+i)%2===1)&&(l=[b,1-D,O,1-D,O,1-P,b,1-P]),y=y.concat(l),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A){const A=[];b=0,D=1-M/N,O=1,P=1,A[0]=[b,D,O,D,O,P,b,P],A[1]=[b,D,O,D,O,P,b,P],X!==f.d.ROTATE_TILE&&X!==f.d.ROTATE_ROW||(A[1]=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),X!==f.d.FLIP_TILE&&X!==f.d.FLIP_ROW||(A[1]=[1-b,D,1-O,D,1-O,P,1-b,P]),X!==f.d.FLIP_N_ROTATE_TILE&&X!==f.d.FLIP_N_ROTATE_ROW||(A[1]=[b,1-D,O,1-D,O,1-P,b,1-P]);for(let N=0;N<i;N++)z.push(N*s-d+w,J+R,0),z.push((N+1)*s-d+w,J+R,0),z.push((N+1)*s-d+w,J+M+R,0),z.push(N*s-d+w,J+M+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,y=X===f.d.FLIP_TILE||X===f.d.ROTATE_TILE||X===f.d.FLIP_N_ROTATE_TILE?y.concat(A[(N+1)%2]):X===f.d.FLIP_ROW||X===f.d.ROTATE_ROW||X===f.d.FLIP_N_ROTATE_ROW?y.concat(A[1]):y.concat(A[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const A=[];b=0,D=0,O=1,P=M/N,A[0]=[b,D,O,D,O,P,b,P],A[1]=[b,D,O,D,O,P,b,P],X!==f.d.ROTATE_TILE&&X!==f.d.ROTATE_ROW||(A[1]=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),X!==f.d.FLIP_TILE&&X!==f.d.FLIP_ROW||(A[1]=[1-b,D,1-O,D,1-O,P,1-b,P]),X!==f.d.FLIP_N_ROTATE_TILE&&X!==f.d.FLIP_N_ROTATE_ROW||(A[1]=[b,1-D,O,1-D,O,1-P,b,1-P]);for(let N=0;N<i;N++)z.push(N*s-d+w,u-M+R,0),z.push((N+1)*s-d+w,u-M+R,0),z.push((N+1)*s-d+w,u+R,0),z.push(N*s-d+w,u+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,y=X===f.d.FLIP_TILE||X===f.d.ROTATE_TILE||X===f.d.FLIP_N_ROTATE_TILE?y.concat(A[(N+c)%2]):X===f.d.FLIP_ROW||X===f.d.ROTATE_ROW||X===f.d.FLIP_N_ROTATE_ROW?y.concat(A[c%2]):y.concat(A[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const A=[];b=1-Y/s,D=0,O=1,P=1,A[0]=[b,D,O,D,O,P,b,P],A[1]=[b,D,O,D,O,P,b,P],X!==f.d.ROTATE_TILE&&X!==f.d.ROTATE_ROW||(A[1]=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),X!==f.d.FLIP_TILE&&X!==f.d.FLIP_ROW||(A[1]=[1-b,D,1-O,D,1-O,P,1-b,P]),X!==f.d.FLIP_N_ROTATE_TILE&&X!==f.d.FLIP_N_ROTATE_ROW||(A[1]=[b,1-D,O,1-D,O,1-P,b,1-P]);for(let s=0;s<c;s++)z.push(C+w,s*N-Q+R,0),z.push(C+Y+w,s*N-Q+R,0),z.push(C+Y+w,(s+1)*N-Q+R,0),z.push(C+w,(s+1)*N-Q+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,y=X===f.d.FLIP_TILE||X===f.d.ROTATE_TILE||X===f.d.FLIP_N_ROTATE_TILE?y.concat(A[(s+1)%2]):X===f.d.FLIP_ROW||X===f.d.ROTATE_ROW||X===f.d.FLIP_N_ROTATE_ROW?y.concat(A[s%2]):y.concat(A[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(v){const A=[];b=0,D=0,O=Y/N,P=1,A[0]=[b,D,O,D,O,P,b,P],A[1]=[b,D,O,D,O,P,b,P],X!==f.d.ROTATE_TILE&&X!==f.d.ROTATE_ROW||(A[1]=[1-b,1-D,1-O,1-D,1-O,1-P,1-b,1-P]),X!==f.d.FLIP_TILE&&X!==f.d.FLIP_ROW||(A[1]=[1-b,D,1-O,D,1-O,P,1-b,P]),X!==f.d.FLIP_N_ROTATE_TILE&&X!==f.d.FLIP_N_ROTATE_ROW||(A[1]=[b,1-D,O,1-D,O,1-P,b,1-P]);for(let s=0;s<c;s++)z.push(a-Y+w,s*N-Q+R,0),z.push(a+w,s*N-Q+R,0),z.push(a+w,(s+1)*N-Q+R,0),z.push(a-Y+w,(s+1)*N-Q+R,0),G.push(V,V+1,V+3,V+1,V+2,V+3),V+=4,y=X===f.d.FLIP_TILE||X===f.d.ROTATE_TILE||X===f.d.FLIP_N_ROTATE_TILE?y.concat(A[(s+i)%2]):X===f.d.FLIP_ROW||X===f.d.ROTATE_ROW||X===f.d.FLIP_N_ROTATE_ROW?y.concat(A[s%2]):y.concat(A[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const D=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE;g.b._ComputeSides(D,z,G,m,y,A.frontUVs,A.backUVs);const O=new g.b;O.indices=G,O.xa=z,O.ya=m,O.Aa=y;const P=D===g.b.DOUBLESIDE?j.concat(j):j;return O.za=P,O}function d(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return M(X).Ca(N,X.updatable),N}function Q(A){const X=A.faceUV||new Array(6),s=A.faceColors,E=A.pattern||f.d.NO_FLIP,r=A.width||A.size||1,i=A.height||A.size||1,Y=A.depth||A.size||1,v=A.tileWidth||A.tileSize||1,d=A.tileHeight||A.tileSize||1,Q=A.alignHorizontal||0,w=A.alignVertical||0,R=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE;for(let f=0;f<6;f++)void 0===X[f]&&(X[f]=new N.m(0,0,1,1)),s&&void 0===s[f]&&(s[f]=new c.h(1,1,1,1));const C=r/2,J=i/2,a=Y/2,u=[];for(let N=0;N<2;N++)u[N]=M({pattern:E,tileWidth:v,tileHeight:d,width:r,height:i,alignVertical:w,alignHorizontal:Q,sideOrientation:R});for(let N=2;N<4;N++)u[N]=M({pattern:E,tileWidth:v,tileHeight:d,width:Y,height:i,alignVertical:w,alignHorizontal:Q,sideOrientation:R});let z=w;w===f.d.BOTTOM?z=f.d.TOP:w===f.d.TOP&&(z=f.d.BOTTOM);for(let N=4;N<6;N++)u[N]=M({pattern:E,tileWidth:v,tileHeight:d,width:r,height:Y,alignVertical:z,alignHorizontal:Q,sideOrientation:R});let m=[],b=[],y=[],j=[];const G=[],V=[],D=[],O=[];let P=0,l=0;for(let f=0;f<6;f++){const A=u[f].xa.length;V[f]=[],D[f]=[];for(let X=0;X<A/3;X++)V[f].push(new N.k(u[f].xa[3*X],u[f].xa[3*X+1],u[f].xa[3*X+2])),D[f].push(new N.k(u[f].ya[3*X],u[f].ya[3*X+1],u[f].ya[3*X+2]));P=u[f].Aa.length,O[f]=[];for(let s=0;s<P;s+=2)O[f][s]=X[f].x+(X[f].z-X[f].x)*u[f].Aa[s],O[f][s+1]=X[f].y+(X[f].w-X[f].y)*u[f].Aa[s+1],K.b&&(O[f][s+1]=1-O[f][s+1]);if(y=y.concat(O[f]),j=j.concat(u[f].indices.map((A=>A+l))),l+=V[f].length,s)for(let X=0;X<4;X++)G.push(s[f].r,s[f].g,s[f].b,s[f].a)}const n=new N.k(0,0,a),U=N.c.RotationY(Math.PI);m=V[0].map((A=>N.k.TransformNormal(A,U).add(n))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[]),b=D[0].map((A=>N.k.TransformNormal(A,U))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[]),m=m.concat(V[1].map((A=>A.Pg(n))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[])),b=b.concat(D[1].map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[]));const t=new N.k(C,0,0),e=N.c.RotationY(-Math.PI/2);m=m.concat(V[2].map((A=>N.k.TransformNormal(A,e).add(t))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[])),b=b.concat(D[2].map((A=>N.k.TransformNormal(A,e))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[]));const T=N.c.RotationY(Math.PI/2);m=m.concat(V[3].map((A=>N.k.TransformNormal(A,T).Pg(t))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[])),b=b.concat(D[3].map((A=>N.k.TransformNormal(A,T))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[]));const I=new N.k(0,J,0),L=N.c.RotationX(Math.PI/2);m=m.concat(V[4].map((A=>N.k.TransformNormal(A,L).add(I))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[])),b=b.concat(D[4].map((A=>N.k.TransformNormal(A,L))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[]));const k=N.c.RotationX(-Math.PI/2);m=m.concat(V[5].map((A=>N.k.TransformNormal(A,k).Pg(I))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[])),b=b.concat(D[5].map((A=>N.k.TransformNormal(A,k))).map((A=>[A.x,A.y,A.z])).reduce(((A,X)=>A.concat(X)),[])),g.b._ComputeSides(R,m,j,b,y);const x=new g.b;if(x.indices=j,x.xa=m,x.ya=b,x.Aa=y,s){const A=R===g.b.DOUBLESIDE?G.concat(G):G;x.za=A}return x}function w(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return Q(X).Ca(N,X.updatable),N}g.b.CreateTiledPlane=M;g.b.CreateTiledBox=Q;var R=s(12315),C=s(2418),J=s(824);function a(A){const X=A.height||2;let s=0===A.diameterTop?0:A.diameterTop||A.diameter||1,E=0===A.diameterBottom?0:A.diameterBottom||A.diameter||1;s=s||1e-5,E=E||1e-5;const r=0|(A.tessellation||24),i=0|(A.subdivisions||1),Y=!!A.hasRings,v=!!A.enclose,M=0===A.cap?0:A.cap||f.d.CAP_ALL,d=A.arc&&(A.arc<=0||A.arc>1)?1:A.arc||1,Q=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE,w=A.faceUV||new Array(3),R=A.faceColors,C=2+(1+(1!==d&&v?2:0))*(Y?i:1);let a;for(a=0;a<C;a++)R&&void 0===R[a]&&(R[a]=new c.h(1,1,1,1));for(a=0;a<C;a++)w&&void 0===w[a]&&(w[a]=new N.m(0,0,1,1));const u=[],z=[],m=[],b=[],y=[],j=2*Math.PI*d/r;let G,V,D;const O=(E-s)/2/X,P=N.k.Zero(),l=N.k.Zero(),n=N.k.Zero(),U=N.k.Zero(),t=N.k.Zero(),e=J.b.Y;let T,I,L,k=1,x=1,H=0,F=0;for(T=0;T<=i;T++)for(V=T/i,D=(V*(s-E)+E)/2,k=Y&&0!==T&&T!==i?2:1,L=0;L<k;L++){for(Y&&(x+=L),v&&(x+=2*L),I=0;I<=r;I++)G=I*j,P.x=Math.cos(-G)*D,P.y=-X/2+V*X,P.z=Math.sin(-G)*D,0===s&&T===i?(l.x=m[m.length-3*(r+1)],l.y=m[m.length-3*(r+1)+1],l.z=m[m.length-3*(r+1)+2]):(l.x=P.x,l.z=P.z,l.y=Math.sqrt(l.x*l.x+l.z*l.z)*O,l.normalize()),0===I&&(n.p(P),U.p(l)),z.push(P.x,P.y,P.z),m.push(l.x,l.y,l.z),F=Y?H!==x?w[x].y:w[x].w:w[x].y+(w[x].w-w[x].y)*V,b.push(w[x].x+(w[x].z-w[x].x)*I/r,K.b?1-F:F),R&&y.push(R[x].r,R[x].g,R[x].b,R[x].a);1!==d&&v&&(z.push(P.x,P.y,P.z),z.push(0,P.y,0),z.push(0,P.y,0),z.push(n.x,n.y,n.z),N.k.CrossToRef(e,l,t),t.normalize(),m.push(t.x,t.y,t.z,t.x,t.y,t.z),N.k.CrossToRef(U,e,t),t.normalize(),m.push(t.x,t.y,t.z,t.x,t.y,t.z),F=Y?H!==x?w[x+1].y:w[x+1].w:w[x+1].y+(w[x+1].w-w[x+1].y)*V,b.push(w[x+1].x,K.b?1-F:F),b.push(w[x+1].z,K.b?1-F:F),F=Y?H!==x?w[x+2].y:w[x+2].w:w[x+2].y+(w[x+2].w-w[x+2].y)*V,b.push(w[x+2].x,K.b?1-F:F),b.push(w[x+2].z,K.b?1-F:F),R&&(y.push(R[x+1].r,R[x+1].g,R[x+1].b,R[x+1].a),y.push(R[x+1].r,R[x+1].g,R[x+1].b,R[x+1].a),y.push(R[x+2].r,R[x+2].g,R[x+2].b,R[x+2].a),y.push(R[x+2].r,R[x+2].g,R[x+2].b,R[x+2].a))),H!==x&&(H=x)}const q=1!==d&&v?r+4:r;for(T=0,x=0;x<i;x++){let A=0,X=0,s=0,N=0;for(I=0;I<r;I++)A=T*(q+1)+I,X=(T+1)*(q+1)+I,s=T*(q+1)+(I+1),N=(T+1)*(q+1)+(I+1),u.push(A,X,s),u.push(N,s,X);1!==d&&v&&(u.push(A+2,X+2,s+2),u.push(N+2,s+2,X+2),u.push(A+4,X+4,s+4),u.push(N+4,s+4,X+4)),T=Y?T+2:T+1}const S=A=>{const f=A?s/2:E/2;if(0===f)return;let g,i,Y;const v=A?w[C-1]:w[0];let c=null;R&&(c=A?R[C-1]:R[0]);const M=z.length/3,Q=A?X/2:-X/2,J=new N.k(0,Q,0);z.push(J.x,J.y,J.z),m.push(0,A?1:-1,0);const a=v.y+.5*(v.w-v.y);b.push(v.x+.5*(v.z-v.x),K.b?1-a:a),c&&y.push(c.r,c.g,c.b,c.a);const j=new N.i(.5,.5);for(Y=0;Y<=r;Y++){g=2*Math.PI*Y*d/r;const X=Math.cos(-g),s=Math.sin(-g);i=new N.k(X*f,Q,s*f);const E=new N.i(X*j.x+.5,s*j.y+.5);z.push(i.x,i.y,i.z),m.push(0,A?1:-1,0);const M=v.y+(v.w-v.y)*E.y;b.push(v.x+(v.z-v.x)*E.x,K.b?1-M:M),c&&y.push(c.r,c.g,c.b,c.a)}for(Y=0;Y<r;Y++)A?(u.push(M),u.push(M+(Y+2)),u.push(M+(Y+1))):(u.push(M),u.push(M+(Y+1)),u.push(M+(Y+2)))};M!==f.d.CAP_START&&M!==f.d.CAP_ALL||S(!1),M!==f.d.CAP_END&&M!==f.d.CAP_ALL||S(!0),g.b._ComputeSides(Q,z,u,m,b,A.frontUVs,A.backUVs);const p=new g.b;return p.indices=u,p.xa=z,p.ya=m,p.Aa=b,R&&(p.za=y),p}function u(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return a(X).Ca(N,X.updatable),N}function z(A){const X=[],s=[],f=[],E=[],r=A.diameter||1,i=A.thickness||.5,Y=0|(A.tessellation||16),v=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE,c=Y+1;for(let g=0;g<=Y;g++){const A=g/Y,v=g*Math.PI*2/Y-Math.PI/2,M=N.c.Translation(r/2,0,0).multiply(N.c.RotationY(v));for(let r=0;r<=Y;r++){const v=1-r/Y,d=r*Math.PI*2/Y+Math.PI,Q=Math.cos(d),w=Math.sin(d);let R=new N.k(Q,w,0),C=R.scale(i/2);const J=new N.i(A,v);C=N.k.TransformCoordinates(C,M),R=N.k.TransformNormal(R,M),s.push(C.x,C.y,C.z),f.push(R.x,R.y,R.z),E.push(J.x,K.b?1-J.y:J.y);const a=(g+1)%c,u=(r+1)%c;X.push(g*c+r),X.push(g*c+u),X.push(a*c+r),X.push(g*c+u),X.push(a*c+u),X.push(a*c+r)}}g.b._ComputeSides(v,s,X,f,E,A.frontUVs,A.backUVs);const M=new g.b;return M.indices=X,M.xa=s,M.ya=f,M.Aa=E,M}function m(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return z(X).Ca(N,X.updatable),N}g.b.CreateCylinder=a,f.d.CreateCylinder=(A,X,s,N,E,g,K,r,i)=>{void 0!==K&&K instanceof C.d||(void 0!==K&&(i=r||f.d.DEFAULTSIDE,r=K),K=g,g=1);return u(A,{height:X,diameterTop:s,diameterBottom:N,tessellation:E,subdivisions:g,sideOrientation:i,updatable:r},K)};function b(A){const X=[],s=[],f=[],E=[],r=A.radius||2,i=A.tube||.5,Y=A.radialSegments||32,v=A.tubularSegments||32,c=A.p||2,M=A.q||3,d=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE,Q=A=>{const X=Math.cos(A),s=Math.sin(A),f=M/c*A,E=Math.cos(f),g=r*(2+E)*.5*X,K=r*(2+E)*s*.5,i=r*Math.sin(f)*.5;return new N.k(g,K,i)};let w,R;for(w=0;w<=Y;w++){const A=w%Y/Y*2*c*Math.PI,X=Q(A),f=Q(A+.01),g=f.Pg(X);let r=f.add(X);const M=N.k.Cross(g,r);for(r=N.k.Cross(M,g),M.normalize(),r.normalize(),R=0;R<v;R++){const A=R%v/v*2*Math.PI,N=-i*Math.cos(A),f=i*Math.sin(A);s.push(X.x+N*r.x+f*M.x),s.push(X.y+N*r.y+f*M.y),s.push(X.z+N*r.z+f*M.z),E.push(w/Y),E.push(K.b?1-R/v:R/v)}}for(w=0;w<Y;w++)for(R=0;R<v;R++){const A=(R+1)%v,s=w*v+R,N=(w+1)*v+R,f=(w+1)*v+A,E=w*v+A;X.push(E),X.push(N),X.push(s),X.push(E),X.push(f),X.push(N)}g.b.ComputeNormals(s,X,f),g.b._ComputeSides(d,s,X,f,E,A.frontUVs,A.backUVs);const C=new g.b;return C.indices=X,C.xa=s,C.ya=f,C.Aa=E,C}function y(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return b(X).Ca(N,X.updatable),N}g.b.CreateTorus=z,f.d.CreateTorus=(A,X,s,N,f,E,g)=>m(A,{diameter:X,thickness:s,tessellation:N,sideOrientation:g,updatable:E},f);g.b.CreateTorusKnot=b,f.d.CreateTorusKnot=(A,X,s,N,f,E,g,K,r,i)=>y(A,{radius:X,tube:s,radialSegments:N,tubularSegments:f,p:E,q:g,sideOrientation:i,updatable:r},K);var j=s(12846),G=s(470),V=s(2249),D=s(683),O=s(503);class P extends N.i{constructor(A,X){super(A.x,A.y),this.index=X}}class l{constructor(){this.elements=[]}add(A){const X=[];for(const s of A){const A=new P(s,this.elements.length);X.push(A),this.elements.push(A)}return X}computeBounds(){const A=new N.i(this.elements[0].x,this.elements[0].y),X=new N.i(this.elements[0].x,this.elements[0].y);for(const s of this.elements)s.x<A.x?A.x=s.x:s.x>X.x&&(X.x=s.x),s.y<A.y?A.y=s.y:s.y>X.y&&(X.y=s.y);return{min:A,max:X,width:X.x-A.x,height:X.y-A.y}}}class n{_addToepoint(A){for(const X of A)this._epoints.push(X.x,X.y)}constructor(A,X,s){let N,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new l,this._outlinepoints=new l,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=f,this._name=A,this._scene=s||O.b.LastCreatedScene,N=X instanceof V.g?X.getPoints():X,this._addToepoint(N),this._points.add(N),this._outlinepoints.add(N),"undefined"===typeof this.bjsEarcut&&G.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(A){this._points.add(A);const X=new l;return X.add(A),this._holes.push(X),this._eholes.push(this._epoints.length/2),this._addToepoint(A),this}build(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const N=new f.d(this._name,this._scene),g=this.buildVertexData(X,s);return N.Ga(E.e.PositionKind,g.xa,A),N.Ga(E.e.NormalKind,g.ya,A),N.Ga(E.e.UVKind,g.Aa,A),N.setIndices(g.indices),N}buildVertexData(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const s=new g.b,N=[],f=[],E=[],K=this._points.computeBounds();for(const g of this._points.elements)N.push(0,1,0),f.push(g.x,0,g.y),E.push((g.x-K.min.x)/K.width,(g.y-K.min.y)/K.height);const r=[],i=this.bjsEarcut(this._epoints,this._eholes,2);for(let g=0;g<i.length;g++)r.push(i[g]);if(A>0){const s=f.length/3;for(const X of this._points.elements)N.push(0,-1,0),f.push(X.x,-A,X.y),E.push(1-(X.x-K.min.x)/K.width,1-(X.y-K.min.y)/K.height);const g=r.length;for(let A=0;A<g;A+=3){const X=r[A+0],N=r[A+1],f=r[A+2];r.push(f+s),r.push(N+s),r.push(X+s)}this._addSide(f,N,E,r,K,this._outlinepoints,A,!1,X);for(const i of this._holes)this._addSide(f,N,E,r,K,i,A,!0,X)}return s.indices=r,s.xa=f,s.ya=N,s.Aa=E,s}_addSide(A,X,s,f,E,g,K,r,i){let Y=A.length/3,v=0;for(let c=0;c<g.elements.length;c++){const M=g.elements[c],d=g.elements[(c+1)%g.elements.length];A.push(M.x,0,M.y),A.push(M.x,-K,M.y),A.push(d.x,0,d.y),A.push(d.x,-K,d.y);const Q=g.elements[(c+g.elements.length-1)%g.elements.length],w=g.elements[(c+2)%g.elements.length];let R=new N.k(-(d.y-M.y),0,d.x-M.x),C=new N.k(-(M.y-Q.y),0,M.x-Q.x),J=new N.k(-(w.y-d.y),0,w.x-d.x);r||(R=R.scale(-1),C=C.scale(-1),J=J.scale(-1));const a=R.normalizeToNew();let u=C.normalizeToNew(),z=J.normalizeToNew();const m=N.k.Dot(u,a);u=m>i?m<D.b-1?new N.k(M.x,0,M.y).Pg(new N.k(d.x,0,d.y)).normalize():C.add(R).normalize():a;const b=N.k.Dot(J,R);z=b>i?b<D.b-1?new N.k(d.x,0,d.y).Pg(new N.k(M.x,0,M.y)).normalize():J.add(R).normalize():a,s.push(v/E.width,0),s.push(v/E.width,1),v+=R.length(),s.push(v/E.width,0),s.push(v/E.width,1),X.push(u.x,u.y,u.z),X.push(u.x,u.y,u.z),X.push(z.x,z.y,z.z),X.push(z.x,z.y,z.z),r?(f.push(Y),f.push(Y+2),f.push(Y+1),f.push(Y+1),f.push(Y+2),f.push(Y+3)):(f.push(Y),f.push(Y+1),f.push(Y+2),f.push(Y+1),f.push(Y+3),f.push(Y+2)),Y+=4}}}function U(A,X,s,f,r,i,Y){const v=s||new Array(3),M=f,d=[],Q=Y||!1;for(let E=0;E<3;E++)void 0===v[E]&&(v[E]=new N.m(0,0,1,1)),M&&void 0===M[E]&&(M[E]=new c.h(1,1,1,1));const w=A.getVerticesData(E.e.PositionKind),R=A.getVerticesData(E.e.NormalKind),C=A.getVerticesData(E.e.UVKind),J=A.ti(),a=w.length/9;let u=0,z=0,m=0,b=0,y=0;const j=[0];if(Q)for(let N=a;N<w.length/3;N+=4)z=w[3*(N+2)]-w[3*N],m=w[3*(N+2)+2]-w[3*N+2],b=Math.sqrt(z*z+m*m),y+=b,j.push(y);let G=0,V=0;for(let N=0;N<R.length;N+=3)Math.abs(R[N+1])<.001&&(V=1),Math.abs(R[N+1]-1)<.001&&(V=0),Math.abs(R[N+1]+1)<.001&&(V=2),G=N/3,1===V?(u=G-a,C[2*G]=u%4<1.5?Q?v[V].x+(v[V].z-v[V].x)*j[Math.floor(u/4)]/y:v[V].x:Q?v[V].x+(v[V].z-v[V].x)*j[Math.floor(u/4)+1]/y:v[V].z,C[2*G+1]=u%2===0?K.b?1-v[V].w:v[V].w:K.b?1-v[V].y:v[V].y):(C[2*G]=(1-C[2*G])*v[V].x+C[2*G]*v[V].z,C[2*G+1]=(1-C[2*G+1])*v[V].y+C[2*G+1]*v[V].w,K.b&&(C[2*G+1]=1-C[2*G+1])),M&&d.push(M[V].r,M[V].g,M[V].b,M[V].a);g.b._ComputeSides(X,w,J,R,C,r,i);const D=new g.b;if(D.indices=J,D.xa=w,D.ya=R,D.Aa=C,M){const A=X===g.b.DOUBLESIDE?d.concat(d):d;D.za=A}return D}function t(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation);const g=X.shape,K=X.holes||[],r=X.depth||0,i=X.smoothingThreshold||2,Y=[];let v=[];for(let f=0;f<g.length;f++)Y[f]=new N.i(g[f].x,g[f].z);Y[0].equalsWithEpsilon(Y[Y.length-1],1e-8)&&Y.pop();const c=new n(A,Y,s||O.b.LastCreatedScene,E);for(let f=0;f<K.length;f++){v=[];for(let A=0;A<K[f].length;A++)v.push(new N.i(K[f][A].x,K[f][A].z));c.addHole(v)}const M=c.build(!1,r,i);M._originalBuilderSideOrientation=X.sideOrientation;return U(M,X.sideOrientation,X.faceUV,X.faceColors,X.frontUVs,X.backUVs,X.wrap).Ca(M,X.updatable),M}function e(A,X){return t(A,X,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function T(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=X.path,E=X.shape,g=X.scale||1,K=X.rotation||0,r=0===X.cap?0:X.cap||f.d.NO_CAP,i=X.updatable,Y=f.d._GetDefaultSideOrientation(X.sideOrientation),v=X.instance||null,c=X.invertUV||!1,M=X.closeShape||!1,d=X.closePath||!1,Q=X.capFunction||null;return L(A,E,N,g,K,null,null,d,M,r,!1,s,!!i,Y,v,c,X.frontUVs||null,X.backUVs||null,X.firstNormal||null,!!X.adjustFrame,Q)}function I(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=X.path,E=X.shape,g=X.scaleFunction||(()=>1),K=X.rotationFunction||(()=>0),r=X.closePath||X.ribbonCloseArray||!1,i=X.closeShape||X.ribbonClosePath||!1,Y=0===X.cap?0:X.cap||f.d.NO_CAP,v=X.updatable,c=X.firstNormal||null,M=X.adjustFrame||!1,d=f.d._GetDefaultSideOrientation(X.sideOrientation),Q=X.instance,w=X.invertUV||!1,R=X.capFunction||null;return L(A,E,N,null,null,g,K,r,i,Y,!0,s,!!v,d,Q||null,w,X.frontUVs||null,X.backUVs||null,c,M,R||null)}function L(A,X,s,E,g,K,r,Y,v,c,M,d,Q,w,R,C,J,a,u,z,m){const b=(A,X,s,E,g,K,r,i,Y,v,c)=>{const M=s.getTangents(),d=s.getNormals(),Q=s.getBinormals(),w=s.getDistances();if(c)for(let f=0;f<M.length;f++)if(0==M[f].x&&0==M[f].y&&0==M[f].z&&M[f].p(M[f-1]),0==d[f].x&&0==d[f].y&&0==d[f].z&&d[f].p(d[f-1]),0==Q[f].x&&0==Q[f].y&&0==Q[f].z&&Q[f].p(Q[f-1]),f>0){let A=M[f-1];N.k.Dot(A,M[f])<0&&M[f].scaleInPlace(-1),A=d[f-1],N.k.Dot(A,d[f])<0&&d[f].scaleInPlace(-1),A=Q[f-1],N.k.Dot(A,Q[f])<0&&Q[f].scaleInPlace(-1)}let R=0;const C=v&&i?i:()=>null!==K?K:0,J=v&&r?r:()=>null!==g?g:1;let a=Y===f.d.NO_CAP||Y===f.d.CAP_END?0:2;const u=N.f.Matrix[0];for(let f=0;f<X.length;f++){const s=[],g=C(f,w[f]),K=J(f,w[f]);N.c.RotationAxisToRef(M[f],R,u);for(let E=0;E<A.length;E++){const g=M[f].scale(A[E].z).add(d[f].scale(A[E].x)).add(Q[f].scale(A[E].y)),r=N.k.Zero();N.k.TransformCoordinatesToRef(g,u,r),r.scaleInPlace(K).addInPlace(X[f]),s[E]=r}E[a]=s,R+=g,a++}const z=m||(A=>{const X=Array(),s=N.k.Zero();let f;for(f=0;f<A.length;f++)s.addInPlace(A[f]);for(s.scaleInPlace(1/A.length),f=0;f<A.length;f++)X.push(s);return X});switch(Y){case f.d.NO_CAP:break;case f.d.CAP_START:E[0]=z(E[2]),E[1]=E[2];break;case f.d.CAP_END:E[a]=E[a-1],E[a+1]=z(E[a-1]);break;case f.d.CAP_ALL:E[0]=z(E[2]),E[1]=E[2],E[a]=E[a-1],E[a+1]=z(E[a-1])}return E};let y,j;if(R){const A=R._creationDataStorage;return y=u?A.path3D.update(s,u):A.path3D.update(s),j=b(X,s,A.path3D,A.pathArray,E,g,K,r,A.cap,M,z),R=i("",{pathArray:j,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:R},d||void 0)}y=u?new V.i(s,u):new V.i(s);j=b(X,s,y,new Array,E,g,K,r,c=c<0||c>3?0:c,M,z);const G=i(A,{pathArray:j,closeArray:Y,closePath:v,updatable:Q,sideOrientation:w,invertUV:C,frontUVs:J||void 0,backUVs:a||void 0},d);return G._creationDataStorage.pathArray=j,G._creationDataStorage.path3D=y,G._creationDataStorage.cap=c,G}g.b.CreatePolygon=U,f.d.CreatePolygon=function(A,X,s,N,f,E){return t(A,{shape:X,holes:N,updatable:f,sideOrientation:E},s,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},f.d.ExtrudePolygon=function(A,X,s,N,f,E,g){return e(A,{shape:X,holes:f,depth:s,updatable:E,sideOrientation:g},N,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function k(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=X.arc?X.arc<=0||X.arc>1?1:X.arc:1,g=void 0===X.closed||X.closed,K=X.shape,r=X.radius||1,Y=X.tessellation||64,v=X.clip||0,c=X.updatable,M=f.d._GetDefaultSideOrientation(X.sideOrientation),d=X.cap||f.d.NO_CAP,Q=2*Math.PI,w=[],R=X.invertUV||!1;let C=0,J=0;const a=Q/Y*E;let u,z;for(C=0;C<=Y-v;C++){for(z=[],d!=f.d.CAP_START&&d!=f.d.CAP_ALL||(z.push(new N.k(0,K[0].y,0)),z.push(new N.k(Math.cos(C*a)*K[0].x*r,K[0].y,Math.sin(C*a)*K[0].x*r))),J=0;J<K.length;J++)u=new N.k(Math.cos(C*a)*K[J].x*r,K[J].y,Math.sin(C*a)*K[J].x*r),z.push(u);d!=f.d.CAP_END&&d!=f.d.CAP_ALL||(z.push(new N.k(Math.cos(C*a)*K[K.length-1].x*r,K[K.length-1].y,Math.sin(C*a)*K[K.length-1].x*r)),z.push(new N.k(0,K[K.length-1].y,0))),w.push(z)}return i(A,{pathArray:w,closeArray:g,sideOrientation:M,updatable:c,invertUV:R,frontUVs:X.frontUVs,backUVs:X.backUVs},s)}f.d.ExtrudeShape=function(A,X,s,N,E,g){let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7?arguments[7]:void 0,i=arguments.length>8?arguments[8]:void 0,Y=arguments.length>9?arguments[9]:void 0;return T(A,{shape:X,path:s,scale:N,rotation:E,cap:0===g?0:g||f.d.NO_CAP,sideOrientation:i,instance:Y,updatable:r},K)},f.d.ExtrudeShapeCustom=(A,X,s,N,E,g,K,r,i,Y,v,c)=>I(A,{shape:X,path:s,scaleFunction:N,rotationFunction:E,ribbonCloseArray:g,ribbonClosePath:K,cap:0===r?0:r||f.d.NO_CAP,sideOrientation:v,instance:c,updatable:Y},i);f.d.CreateLathe=(A,X,s,N,f,E,g)=>k(A,{shape:X,radius:s,tessellation:N,sideOrientation:g,updatable:E},f);var x=s(12221),H=s(12175);function F(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=X.path;let g=X.instance,K=1;void 0!==X.radius?K=X.radius:g&&(K=g._creationDataStorage.radius);const r=X.tessellation||64,Y=X.radiusFunction||null;let v=X.cap||f.d.NO_CAP;const c=X.invertUV||!1,M=X.updatable,d=f.d._GetDefaultSideOrientation(X.sideOrientation);X.arc=X.arc&&(X.arc<=0||X.arc>1)?1:X.arc||1;const Q=(A,X,s,E,g,K,r,i)=>{const Y=X.getTangents(),v=X.getNormals(),c=X.getDistances(),M=2*Math.PI/g*i,d=K||(()=>E);let Q,w,R,C;const J=N.f.Matrix[0];let a=r===f.d.NO_CAP||r===f.d.CAP_END?0:2;for(let f=0;f<A.length;f++){w=d(f,c[f]),Q=Array(),R=v[f];for(let X=0;X<g;X++)N.c.RotationAxisToRef(Y[f],M*X,J),C=Q[X]?Q[X]:N.k.Zero(),N.k.TransformCoordinatesToRef(R,J,C),C.scaleInPlace(w).addInPlace(A[f]),Q[X]=C;s[a]=Q,a++}const u=(X,s)=>{const N=Array();for(let f=0;f<X;f++)N.push(A[s]);return N};switch(r){case f.d.NO_CAP:break;case f.d.CAP_START:s[0]=u(g,0),s[1]=s[2].slice(0);break;case f.d.CAP_END:s[a]=s[a-1].slice(0),s[a+1]=u(g,A.length-1);break;case f.d.CAP_ALL:s[0]=u(g,0),s[1]=s[2].slice(0),s[a]=s[a-1].slice(0),s[a+1]=u(g,A.length-1)}return s};let w,R;if(g){const A=g._creationDataStorage,s=X.arc||A.arc;return w=A.path3D.update(E),R=Q(E,w,A.pathArray,K,A.tessellation,Y,A.cap,s),g=i("",{pathArray:R,instance:g}),A.path3D=w,A.pathArray=R,A.arc=s,A.radius=K,g}w=new V.i(E);v=v<0||v>3?0:v,R=Q(E,w,new Array,K,r,Y,v,X.arc);const C=i(A,{pathArray:R,closePath:!0,closeArray:!1,updatable:M,sideOrientation:d,invertUV:c,frontUVs:X.frontUVs,backUVs:X.backUVs},s);return C._creationDataStorage.pathArray=R,C._creationDataStorage.path3D=w,C._creationDataStorage.tessellation=r,C._creationDataStorage.cap=v,C._creationDataStorage.arc=X.arc,C._creationDataStorage.radius=K,C}function q(A){const X=[];X[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},X[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},X[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},X[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},X[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},X[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},X[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},X[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},X[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},X[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},X[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},X[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},X[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},X[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},X[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const s=A.type&&(A.type<0||A.type>=X.length)?0:A.type||0,f=A.size,E=A.sizeX||f||1,r=A.sizeY||f||1,i=A.sizeZ||f||1,Y=A.custom||X[s],v=Y.face.length,M=A.faceUV||new Array(v),d=A.faceColors,Q=void 0===A.flat||A.flat,w=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE,R=[],C=[],J=[],a=[],u=[];let z=0,m=0;const b=[];let y,j,G,V,D,O,P=0,l=0;if(Q)for(l=0;l<v;l++)d&&void 0===d[l]&&(d[l]=new c.h(1,1,1,1)),M&&void 0===M[l]&&(M[l]=new N.m(0,0,1,1));if(Q)for(l=0;l<v;l++){const A=Y.face[l].length;for(G=2*Math.PI/A,V=.5*Math.tan(G/2),D=.5,P=0;P<A;P++)R.push(Y.vertex[Y.face[l][P]][0]*E,Y.vertex[Y.face[l][P]][1]*r,Y.vertex[Y.face[l][P]][2]*i),b.push(z),z++,y=M[l].x+(M[l].z-M[l].x)*(.5+V),j=M[l].y+(M[l].w-M[l].y)*(D-.5),a.push(y,K.b?1-j:j),O=V*Math.cos(G)-D*Math.sin(G),D=V*Math.sin(G)+D*Math.cos(G),V=O,d&&u.push(d[l].r,d[l].g,d[l].b,d[l].a);for(P=0;P<A-2;P++)C.push(b[0+m],b[P+2+m],b[P+1+m]);m+=A}else{for(P=0;P<Y.vertex.length;P++)R.push(Y.vertex[P][0]*E,Y.vertex[P][1]*r,Y.vertex[P][2]*i),a.push(0,K.b?1:0);for(l=0;l<v;l++)for(P=0;P<Y.face[l].length-2;P++)C.push(Y.face[l][0],Y.face[l][P+2],Y.face[l][P+1])}g.b.ComputeNormals(R,C,J),g.b._ComputeSides(w,R,C,J,a,A.frontUVs,A.backUVs);const n=new g.b;return n.xa=R,n.indices=C,n.ya=J,n.Aa=a,d&&Q&&(n.za=u),n}function S(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return q(X).Ca(N,X.updatable),N}f.d.CreateTube=(A,X,s,N,f,E,g,K,r,i)=>F(A,{path:X,radius:s,tessellation:N,radiusFunction:f,arc:1,cap:E,updatable:K,sideOrientation:r,instance:i},g);function p(A){const X=A.sideOrientation||g.b.DEFAULTSIDE,s=A.radius||1,f=void 0===A.flat||A.flat,E=0|(A.subdivisions||4),r=A.radiusX||s,i=A.radiusY||s,Y=A.radiusZ||s,v=(1+Math.sqrt(5))/2,c=[-1,v,-0,1,v,0,-1,-v,0,1,-v,0,0,-1,-v,0,1,-v,0,-1,v,0,1,v,v,0,1,v,0,-1,-v,0,1,-v,0,-1],M=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],d=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],w=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],R=[],C=[],J=[],a=[];let u=0;const z=new Array(3),m=new Array(3);let b;for(b=0;b<3;b++)z[b]=N.k.Zero(),m[b]=N.i.Zero();for(let g=0;g<20;g++){for(b=0;b<3;b++){const A=M[3*g+b];z[b].gi(c[3*d[A]],c[3*d[A]+1],c[3*d[A]+2]),z[b].normalize(),m[b].gi(.134765625*Q[2*A]+.05859375+-.0390625*w[g],.2333984375*Q[2*A+1]+.025390625+.01953125*w[g])}const A=(A,X,s,g)=>{const v=N.k.Lerp(z[0],z[2],X/E),c=N.k.Lerp(z[1],z[2],X/E),M=E===X?z[2]:N.k.Lerp(v,c,A/(E-X));let d;if(M.normalize(),f){const A=N.k.Lerp(z[0],z[2],g/E),X=N.k.Lerp(z[1],z[2],g/E);d=N.k.Lerp(A,X,s/(E-g))}else d=new N.k(M.x,M.y,M.z);d.x/=r,d.y/=i,d.z/=Y,d.normalize();const Q=N.i.Lerp(m[0],m[2],X/E),w=N.i.Lerp(m[1],m[2],X/E),b=E===X?m[2]:N.i.Lerp(Q,w,A/(E-X));C.push(M.x*r,M.y*i,M.z*Y),J.push(d.x,d.y,d.z),a.push(b.x,K.b?1-b.y:b.y),R.push(u),u++};for(let X=0;X<E;X++)for(let s=0;s+X<E;s++)A(s,X,s+1/3,X+1/3),A(s+1,X,s+1/3,X+1/3),A(s,X+1,s+1/3,X+1/3),s+X+1<E&&(A(s+1,X,s+2/3,X+2/3),A(s+1,X+1,s+2/3,X+2/3),A(s,X+1,s+2/3,X+2/3))}g.b._ComputeSides(X,C,R,J,a,A.frontUVs,A.backUVs);const y=new g.b;return y.indices=R,y.xa=C,y.ya=J,y.Aa=a,y}function B(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new f.d(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),N._originalBuilderSideOrientation=X.sideOrientation;return p(X).Ca(N,X.updatable),N}g.b.CreatePolyhedron=q,f.d.CreatePolyhedron=(A,X,s)=>S(A,X,s);g.b.CreateIcoSphere=p,f.d.CreateIcoSphere=(A,X,s)=>B(A,X,s);var Z=s(696);const o=new N.k(1,0,0),W=new N.k(-1,0,0),h=new N.k(0,1,0),AA=new N.k(0,-1,0),XA=new N.k(0,0,1),sA=new N.k(0,0,-1);class NA{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.k.Zero(),X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.k.Up(),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.i.Zero(),f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=A,this.Si=X,this.uv=s,this.vertexIdx=f,this.vertexIdxForBones=E,this.localPositionOverride=g,this.localNormalOverride=K,this.matrixIndicesOverride=r,this.matrixWeightsOverride=i}clone(){var A,X,s,N;return new NA(this.position.clone(),this.Si.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(A=this.localPositionOverride)||void 0===A?void 0:A.slice(),null===(X=this.localNormalOverride)||void 0===X?void 0:X.slice(),null===(s=this.matrixIndicesOverride)||void 0===s?void 0:s.slice(),null===(N=this.matrixWeightsOverride)||void 0===N?void 0:N.slice())}}function fA(A,X,s){var r,i,Y,v,c;const M=!!X.skeleton,d=!(null===(r=X.morphTargetManager)||void 0===r||!r.numTargets),Q=s.localMode||M,w=X.ti(),R=M||d?X.Tf(!0,!0):X.getVerticesData(E.e.PositionKind),C=M||d?X.getNormalsData(!0,!0):X.getVerticesData(E.e.NormalKind),J=Q?M?X.getVerticesData(E.e.PositionKind):R:null,a=Q?M?X.getVerticesData(E.e.NormalKind):C:null,u=X.getVerticesData(E.e.UVKind),z=M?X.getVerticesData(E.e.MatricesIndicesKind):null,m=M?X.getVerticesData(E.e.MatricesWeightsKind):null,b=M?X.getVerticesData(E.e.MatricesIndicesExtraKind):null,y=M?X.getVerticesData(E.e.MatricesWeightsExtraKind):null,j=s.position||N.k.Zero();let G=s.Si||N.k.Up();const V=s.size||N.k.One(),D=s.angle||0;if(!G){const A=new N.k(0,0,1),s=X.va().activeCamera,f=N.k.TransformCoordinates(A,s.getWorldMatrix());G=s.globalPosition.Pg(f)}const O=-Math.atan2(G.z,G.x)-Math.PI/2,P=Math.sqrt(G.x*G.x+G.z*G.z),l=Math.atan2(G.y,P),n=new g.b;n.indices=[],n.xa=[],n.ya=[],n.Aa=[],n.matricesIndices=M?[]:null,n.matricesWeights=M?[]:null,n.matricesIndicesExtra=b?[]:null,n.matricesWeightsExtra=y?[]:null;let U=0;const t=(A,X)=>{const f=new NA;if(!w||!R||!C)return f;const E=w[A];if(f.vertexIdx=3*E,f.vertexIdxForBones=4*E,f.position=new N.k(R[3*E],R[3*E+1],R[3*E+2]),N.k.TransformCoordinatesToRef(f.position,X,f.position),f.Si=new N.k(C[3*E],C[3*E+1],C[3*E+2]),N.k.TransformNormalToRef(f.Si,X,f.Si),s.captureUVS&&u){const A=u[2*E+1];f.uv=new N.i(u[2*E],K.b?1-A:A)}return f},e=[0,0,0,0],T=(A,X)=>{if(0===A.length)return A;const s=.5*Math.abs(N.k.Dot(V,X)),f=(A,X,s,N)=>{for(let f=0;f<N;++f)if(A[s+f]===X)return s+f;return-1},E=(A,E)=>{const g=N.k.GetClipFactor(A.position,E.position,X,s);let K=e,r=e;if(z&&m){const X=A.matrixIndicesOverride?0:A.vertexIdxForBones,s=A.matrixIndicesOverride??z,N=A.matrixWeightsOverride??m,i=E.matrixIndicesOverride?0:E.vertexIdxForBones,Y=E.matrixIndicesOverride??z,v=E.matrixWeightsOverride??m;K=[0,0,0,0],r=[0,0,0,0];let c=0;for(let A=0;A<4;++A)if(N[X+A]>0){const E=f(Y,s[X+A],i,4);K[c]=s[X+A],r[c]=(0,Z.l)(N[X+A],E>=0?v[E]:0,g),c++}for(let A=0;A<4&&c<4;++A){const N=Y[i+A];-1===f(s,N,X,4)&&(K[c]=N,r[c]=(0,Z.l)(0,v[i+A],g),c++)}const M=r[0]+r[1]+r[2]+r[3];r[0]/=M,r[1]/=M,r[2]/=M,r[3]/=M}const i=A.localPositionOverride?A.localPositionOverride[0]:(null===J||void 0===J?void 0:J[A.vertexIdx])??0,Y=A.localPositionOverride?A.localPositionOverride[1]:(null===J||void 0===J?void 0:J[A.vertexIdx+1])??0,v=A.localPositionOverride?A.localPositionOverride[2]:(null===J||void 0===J?void 0:J[A.vertexIdx+2])??0,c=E.localPositionOverride?E.localPositionOverride[0]:(null===J||void 0===J?void 0:J[E.vertexIdx])??0,M=E.localPositionOverride?E.localPositionOverride[1]:(null===J||void 0===J?void 0:J[E.vertexIdx+1])??0,d=E.localPositionOverride?E.localPositionOverride[2]:(null===J||void 0===J?void 0:J[E.vertexIdx+2])??0,Q=A.localNormalOverride?A.localNormalOverride[0]:(null===a||void 0===a?void 0:a[A.vertexIdx])??0,w=A.localNormalOverride?A.localNormalOverride[1]:(null===a||void 0===a?void 0:a[A.vertexIdx+1])??0,R=A.localNormalOverride?A.localNormalOverride[2]:(null===a||void 0===a?void 0:a[A.vertexIdx+2])??0,C=Q+((E.localNormalOverride?E.localNormalOverride[0]:(null===a||void 0===a?void 0:a[E.vertexIdx])??0)-Q)*g,u=w+((E.localNormalOverride?E.localNormalOverride[1]:(null===a||void 0===a?void 0:a[E.vertexIdx+1])??0)-w)*g,b=R+((E.localNormalOverride?E.localNormalOverride[2]:(null===a||void 0===a?void 0:a[E.vertexIdx+2])??0)-R)*g,y=Math.sqrt(C*C+u*u+b*b);return new NA(N.k.Lerp(A.position,E.position,g),N.k.Lerp(A.Si,E.Si,g).normalize(),N.i.Lerp(A.uv,E.uv,g),-1,-1,J?[i+(c-i)*g,Y+(M-Y)*g,v+(d-v)*g]:null,a?[C/y,u/y,b/y]:null,K,r)};let g=null;A.length>3&&(g=[]);for(let K=0;K<A.length;K+=3){let f=0,r=null,i=null,Y=null,v=null;const c=N.k.Dot(A[K].position,X)-s>0,M=N.k.Dot(A[K+1].position,X)-s>0,d=N.k.Dot(A[K+2].position,X)-s>0;switch(f=(c?1:0)+(M?1:0)+(d?1:0),f){case 0:A.length>3?(g.push(A[K]),g.push(A[K+1]),g.push(A[K+2])):g=A;break;case 1:if(g=g??new Array,c&&(r=A[K+1],i=A[K+2],Y=E(A[K],r),v=E(A[K],i)),M){r=A[K],i=A[K+2],Y=E(A[K+1],r),v=E(A[K+1],i),g.push(Y),g.push(i.clone()),g.push(r.clone()),g.push(i.clone()),g.push(Y.clone()),g.push(v);break}d&&(r=A[K],i=A[K+1],Y=E(A[K+2],r),v=E(A[K+2],i)),r&&i&&Y&&v&&(g.push(r.clone()),g.push(i.clone()),g.push(Y),g.push(v),g.push(Y.clone()),g.push(i.clone()));break;case 2:g=g??new Array,c||(r=A[K].clone(),i=E(r,A[K+1]),Y=E(r,A[K+2]),g.push(r),g.push(i),g.push(Y)),M||(r=A[K+1].clone(),i=E(r,A[K+2]),Y=E(r,A[K]),g.push(r),g.push(i),g.push(Y)),d||(r=A[K+2].clone(),i=E(r,A[K]),Y=E(r,A[K+1]),g.push(r),g.push(i),g.push(Y))}}return g},I=X instanceof f.d?X:null,L=null===I||void 0===I?void 0:I._thinInstanceDataStorage.matrixData,k=(null===I||void 0===I?void 0:I.ji)||1,x=N.f.Matrix[0];x.p(N.c.IdentityReadOnly);for(let f=0;f<k;++f){if(null!==I&&void 0!==I&&I.hasThinInstances&&L){const A=16*f;x.setRowFromFloats(0,L[A+0],L[A+1],L[A+2],L[A+3]),x.setRowFromFloats(1,L[A+4],L[A+5],L[A+6],L[A+7]),x.setRowFromFloats(2,L[A+8],L[A+9],L[A+10],L[A+11]),x.setRowFromFloats(3,L[A+12],L[A+13],L[A+14],L[A+15])}const A=N.c.RotationYawPitchRoll(O,l,D).multiply(N.c.Translation(j.x,j.y,j.z)),E=N.c.Invert(A),g=X.getWorldMatrix(),r=x.multiply(g).multiply(E),i=new Array(3);for(let X=0;X<w.length;X+=3){let A=i;if(A[0]=t(X,r),A[1]=t(X+1,r),A[2]=t(X+2,r),!(s.cullBackFaces&&-A[0].Si.z<=0&&-A[1].Si.z<=0&&-A[2].Si.z<=0)&&(A=T(A,o),A&&(A=T(A,W),A&&(A=T(A,h),A&&(A=T(A,AA),A&&(A=T(A,XA),A&&(A=T(A,sA),A)))))))for(let X=0;X<A.length;X++){const N=A[X];if(n.indices.push(U),Q?(N.localPositionOverride?(n.xa[3*U]=N.localPositionOverride[0],n.xa[3*U+1]=N.localPositionOverride[1],n.xa[3*U+2]=N.localPositionOverride[2]):J&&(n.xa[3*U]=J[N.vertexIdx],n.xa[3*U+1]=J[N.vertexIdx+1],n.xa[3*U+2]=J[N.vertexIdx+2]),N.localNormalOverride?(n.ya[3*U]=N.localNormalOverride[0],n.ya[3*U+1]=N.localNormalOverride[1],n.ya[3*U+2]=N.localNormalOverride[2]):a&&(n.ya[3*U]=a[N.vertexIdx],n.ya[3*U+1]=a[N.vertexIdx+1],n.ya[3*U+2]=a[N.vertexIdx+2])):(N.position.toArray(n.xa,3*U),N.Si.toArray(n.ya,3*U)),n.matricesIndices&&n.matricesWeights&&(N.matrixIndicesOverride?(n.matricesIndices[4*U]=N.matrixIndicesOverride[0],n.matricesIndices[4*U+1]=N.matrixIndicesOverride[1],n.matricesIndices[4*U+2]=N.matrixIndicesOverride[2],n.matricesIndices[4*U+3]=N.matrixIndicesOverride[3]):(z&&(n.matricesIndices[4*U]=z[N.vertexIdxForBones],n.matricesIndices[4*U+1]=z[N.vertexIdxForBones+1],n.matricesIndices[4*U+2]=z[N.vertexIdxForBones+2],n.matricesIndices[4*U+3]=z[N.vertexIdxForBones+3]),b&&n.matricesIndicesExtra&&(n.matricesIndicesExtra[4*U]=b[N.vertexIdxForBones],n.matricesIndicesExtra[4*U+1]=b[N.vertexIdxForBones+1],n.matricesIndicesExtra[4*U+2]=b[N.vertexIdxForBones+2],n.matricesIndicesExtra[4*U+3]=b[N.vertexIdxForBones+3])),N.matrixWeightsOverride?(n.matricesWeights[4*U]=N.matrixWeightsOverride[0],n.matricesWeights[4*U+1]=N.matrixWeightsOverride[1],n.matricesWeights[4*U+2]=N.matrixWeightsOverride[2],n.matricesWeights[4*U+3]=N.matrixWeightsOverride[3]):(m&&(n.matricesWeights[4*U]=m[N.vertexIdxForBones],n.matricesWeights[4*U+1]=m[N.vertexIdxForBones+1],n.matricesWeights[4*U+2]=m[N.vertexIdxForBones+2],n.matricesWeights[4*U+3]=m[N.vertexIdxForBones+3]),y&&n.matricesWeightsExtra&&(n.matricesWeightsExtra[4*U]=y[N.vertexIdxForBones],n.matricesWeightsExtra[4*U+1]=y[N.vertexIdxForBones+1],n.matricesWeightsExtra[4*U+2]=y[N.vertexIdxForBones+2],n.matricesWeightsExtra[4*U+3]=y[N.vertexIdxForBones+3]))),s.captureUVS)N.uv.toArray(n.Aa,2*U);else{n.Aa.push(.5+N.position.x/V.x);const A=.5+N.position.y/V.y;n.Aa.push(K.b?1-A:A)}U++}}}0===n.indices.length&&(n.indices=null),0===n.xa.length&&(n.xa=null),0===n.ya.length&&(n.ya=null),0===n.Aa.length&&(n.Aa=null),0===(null===(i=n.matricesIndices)||void 0===i?void 0:i.length)&&(n.matricesIndices=null),0===(null===(Y=n.matricesWeights)||void 0===Y?void 0:Y.length)&&(n.matricesWeights=null),0===(null===(v=n.matricesIndicesExtra)||void 0===v?void 0:v.length)&&(n.matricesIndicesExtra=null),0===(null===(c=n.matricesWeightsExtra)||void 0===c?void 0:c.length)&&(n.matricesWeightsExtra=null);const H=new f.d(A,X.va());return n.Ca(H),Q?(H.skeleton=X.skeleton,H.parent=X):(H.position=j.clone(),H.rotation=new N.k(l,O,D)),H.si(!0),H.refreshBoundingInfo(!0,!0),H}function EA(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const X=0|Math.max(A.subdivisions?A.subdivisions:2,1),s=0|Math.max(A.tessellation?A.tessellation:16,3),f=Math.max(A.height?A.height:1,0),E=Math.max(A.radius?A.radius:.25,0),r=0|Math.max(A.capSubdivisions?A.capSubdivisions:6,1),i=s,Y=X,v=Math.max(A.radiusTop?A.radiusTop:E,0),c=Math.max(A.radiusBottom?A.radiusBottom:E,0),M=f-(v+c),d=2*Math.PI,Q=Math.max(A.topCapSubdivisions?A.topCapSubdivisions:r,1),w=Math.max(A.bottomCapSubdivisions?A.bottomCapSubdivisions:r,1),R=Math.acos((c-v)/f);let C=[];const J=[],a=[],u=[];let z=0;const m=[],b=.5*M,y=.5*Math.PI;let j,G;const V=N.k.Zero(),D=N.k.Zero(),O=Math.cos(R),P=Math.sin(R),l=new N.i(v*P,b+v*O).Pg(new N.i(c*P,c*O-b)).length(),n=v*R+l+c*(y-R);let U=0;for(G=0;G<=Q;G++){const A=[],X=y-R*(G/Q);U+=v*R/Q;const s=Math.cos(X),N=Math.sin(X),f=s*v;for(j=0;j<=i;j++){const X=j/i,E=X*d+0,g=Math.sin(E),r=Math.cos(E);D.x=f*g,D.y=b+N*v,D.z=f*r,J.push(D.x,D.y,D.z),V.set(s*g,N,s*r),a.push(V.x,V.y,V.z),u.push(X,K.b?U/n:1-U/n),A.push(z),z++}m.push(A)}const t=f-v-c+O*v-O*c,e=P*(c-v)/t;for(G=1;G<=Y;G++){const A=[];U+=l/Y;const X=P*(G*(c-v)/Y+v);for(j=0;j<=i;j++){const s=j/i,N=s*d+0,f=Math.sin(N),E=Math.cos(N);D.x=X*f,D.y=b+O*v-G*t/Y,D.z=X*E,J.push(D.x,D.y,D.z),V.set(f,e,E).normalize(),a.push(V.x,V.y,V.z),u.push(s,K.b?U/n:1-U/n),A.push(z),z++}m.push(A)}for(G=1;G<=w;G++){const A=[],X=y-R-(Math.PI-R)*(G/w);U+=c*R/w;const s=Math.cos(X),N=Math.sin(X),f=s*c;for(j=0;j<=i;j++){const X=j/i,E=X*d+0,g=Math.sin(E),r=Math.cos(E);D.x=f*g,D.y=N*c-b,D.z=f*r,J.push(D.x,D.y,D.z),V.set(s*g,N,s*r),a.push(V.x,V.y,V.z),u.push(X,K.b?U/n:1-U/n),A.push(z),z++}m.push(A)}for(j=0;j<i;j++)for(G=0;G<Q+Y+w;G++){const A=m[G][j],X=m[G+1][j],s=m[G+1][j+1],N=m[G][j+1];C.push(A),C.push(X),C.push(N),C.push(X),C.push(s),C.push(N)}if(C=C.reverse(),A.orientation&&!A.orientation.equals(N.k.Up())){const X=new N.c;A.orientation.clone().scale(.5*Math.PI).cross(N.k.Up()).toQuaternion().toRotationMatrix(X);const s=N.k.Zero();for(let A=0;A<J.length;A+=3)s.set(J[A],J[A+1],J[A+2]),N.k.TransformCoordinatesToRef(s.clone(),X,s),J[A]=s.x,J[A+1]=s.y,J[A+2]=s.z}const T=new g.b;return T.xa=J,T.ya=a,T.Aa=u,T.indices=C,T}function gA(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:N.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new f.d(A,s);return EA(X).Ca(E,X.updatable),E}f.d.CreateDecal=(A,X,s,N,f,E)=>fA(A,X,{position:s,Si:N,size:f,angle:E});f.d.CreateCapsule=(A,X,s)=>gA(A,X,s),g.b.CreateCapsule=EA;class KA{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=A,this.y=X,A!==Math.floor(A)&&(A=Math.floor(A),G.b.Warn("x is not an integer, floor(x) used")),X!==Math.floor(X)&&(X=Math.floor(X),G.b.Warn("y is not an integer, floor(y) used"))}clone(){return new KA(this.x,this.y)}rotate60About(A){const X=this.x;return this.x=A.x+A.y-this.y,this.y=X+this.y-A.x,this}rotateNeg60About(A){const X=this.x;return this.x=X+this.y-A.y,this.y=A.x+A.y-X,this}rotate120(A,X){A!==Math.floor(A)&&(A=Math.floor(A),G.b.Warn("m not an integer only floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),G.b.Warn("n not an integer only floor(n) used"));const s=this.x;return this.x=A-s-this.y,this.y=X+s,this}rotateNeg120(A,X){A!==Math.floor(A)&&(A=Math.floor(A),G.b.Warn("m is not an integer, floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),G.b.Warn("n is not an integer,   floor(n) used"));const s=this.x;return this.x=this.y-X,this.y=A+X-s-this.y,this}toCartesianOrigin(A,X){const s=N.k.Zero();return s.x=A.x+2*this.x*X+this.y*X,s.y=A.y+Math.sqrt(3)*this.y*X,s}static Zero(){return new KA(0,0)}}class rA{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new iA("icosahedron","Regular",[[0,D.e,-1],[-D.e,1,0],[-1,0,-D.e],[1,0,-D.e],[D.e,1,0],[0,D.e,1],[-1,0,D.e],[-D.e,-1,0],[0,-D.e,-1],[D.e,-1,0],[1,0,D.e],[0,-D.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let A=12;const X={},s=this.m,N=this.n;let f,E,g,K,r,i=s,Y=1,v=0;0!==N&&(i=(0,Z.g)(s,N)),Y=s/i,v=N/i;const c=KA.Zero(),M=new KA(s,N),d=new KA(-N,s+N),Q=KA.Zero(),w=KA.Zero(),R=KA.Zero();let C,J,a,u,z=[];const m=[],b=this.vertByDist,y=(s,N,f,E)=>{C=s+"|"+f,J=N+"|"+E,C in X||J in X?C in X&&!(J in X)?X[J]=X[C]:J in X&&!(C in X)&&(X[C]=X[J]):(X[C]=A,X[J]=A,A++),b[f][0]>2?m[X[C]]=[-b[f][0],b[f][1],X[C]]:m[X[C]]=[z[b[f][0]],b[f][1],X[C]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let j=0;j<20;j++){if(z=this.IDATA.face[j],g=z[2],K=z[1],r=z[0],a=c.x+"|"+c.y,C=j+"|"+a,C in X||(X[C]=g,m[g]=[z[b[a][0]],b[a][1]]),a=M.x+"|"+M.y,C=j+"|"+a,C in X||(X[C]=K,m[K]=[z[b[a][0]],b[a][1]]),a=d.x+"|"+d.y,C=j+"|"+a,C in X||(X[C]=r,m[r]=[z[b[a][0]],b[a][1]]),f=this.IDATA.edgematch[j][0],E=this.IDATA.edgematch[j][1],"B"===E)for(let A=1;A<i;A++)w.x=s-A*(Y+v),w.y=N+A*Y,R.x=-A*v,R.y=A*(Y+v),a=w.x+"|"+w.y,u=R.x+"|"+R.y,y(j,f,a,u);if("O"===E)for(let A=1;A<i;A++)R.x=-A*v,R.y=A*(Y+v),Q.x=A*Y,Q.y=A*v,a=R.x+"|"+R.y,u=Q.x+"|"+Q.y,y(j,f,a,u);if(f=this.IDATA.edgematch[j][2],E=this.IDATA.edgematch[j][3],E&&"A"===E)for(let A=1;A<i;A++)Q.x=A*Y,Q.y=A*v,w.x=s-(i-A)*(Y+v),w.y=N+(i-A)*Y,a=Q.x+"|"+Q.y,u=w.x+"|"+w.y,y(j,f,a,u);for(let s=0;s<this.vertices.length;s++)a=this.vertices[s].x+"|"+this.vertices[s].y,C=j+"|"+a,C in X||(X[C]=A++,b[a][0]>2?m[X[C]]=[-b[a][0],b[a][1],X[C]]:m[X[C]]=[z[b[a][0]],b[a][1],X[C]])}this.closestTo=m,this.vecToidx=X}calcCoeffs(){const A=this.m,X=this.n,s=Math.sqrt(3)/3,N=A*A+X*X+A*X;this.coau=(A+X)/N,this.cobu=-X/N,this.coav=-s*(A-X)/N,this.cobv=s*(2*A+X)/N}createInnerFacets(){const A=this.m,X=this.n;for(let s=0;s<X+A+1;s++)for(let A=this.min[s];A<this.max[s]+1;A++)A<this.max[s]&&A<this.max[s+1]+1&&this.innerFacets.push(["|"+A+"|"+s,"|"+A+"|"+(s+1),"|"+(A+1)+"|"+s]),s>0&&A<this.max[s-1]&&A+1<this.max[s]+1&&this.innerFacets.push(["|"+A+"|"+s,"|"+(A+1)+"|"+s,"|"+(A+1)+"|"+(s-1)])}edgeVecsABOB(){const A=this.m,X=this.n,s=new KA(-X,A+X);for(let N=1;N<A+X;N++){const A=new KA(this.min[N],N),X=new KA(this.min[N-1],N-1),f=new KA(this.min[N+1],N+1),E=A.clone(),g=X.clone(),K=f.clone();E.rotate60About(s),g.rotate60About(s),K.rotate60About(s);const r=new KA(this.max[E.y],E.y),i=new KA(this.max[E.y-1],E.y-1),Y=new KA(this.max[E.y-1]-1,E.y-1);E.x===r.x&&E.y===r.y||(E.x!==i.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([A,i,Y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([A,Y,r])):E.y===K.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([A,X,i]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([A,i,f])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([A,X,i]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([A,i,r])))}}mapABOBtoOBOA(){const A=new KA(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const s=[];for(let N=0;N<3;N++)A.x=this.isoVecsABOB[X][N].x,A.y=this.isoVecsABOB[X][N].y,0===this.vertexTypes[X][N]&&A.rotateNeg120(this.m,this.n),s.push(A.clone());this.isoVecsOBOA.push(s)}}mapABOBtoBAOA(){const A=new KA(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const s=[];for(let N=0;N<3;N++)A.x=this.isoVecsABOB[X][N].x,A.y=this.isoVecsABOB[X][N].y,1===this.vertexTypes[X][N]&&A.rotate120(this.m,this.n),s.push(A.clone());this.isoVecsBAOA.push(s)}}MapToFace(A,X){const s=this.IDATA.face[A],f=s[2],E=s[1],g=s[0],K=N.k.mi(this.IDATA.vertex[f]),r=N.k.mi(this.IDATA.vertex[E]),i=N.k.mi(this.IDATA.vertex[g]),Y=r.Pg(K),v=i.Pg(K),c=Y.scale(this.coau).add(v.scale(this.cobu)),M=Y.scale(this.coav).add(v.scale(this.cobv)),d=[];let Q,w=N.f.oi[0];for(let N=0;N<this.cartesian.length;N++)w=c.scale(this.cartesian[N].x).add(M.scale(this.cartesian[N].y)).add(K),d[N]=[w.x,w.y,w.z],Q=A+"|"+this.vertices[N].x+"|"+this.vertices[N].y,X.vertex[this.vecToidx[Q]]=[w.x,w.y,w.z]}build(A,X){const s=[],N=KA.Zero(),f=new KA(A,X),E=new KA(-X,A+X);s.push(N,f,E);for(let a=X;a<A+1;a++)for(let X=0;X<A+1-a;X++)s.push(new KA(X,a));if(X>0){const N=(0,Z.g)(A,X),f=A/N,E=X/N;for(let K=1;K<N;K++)s.push(new KA(K*f,K*E)),s.push(new KA(-K*E,K*(f+E))),s.push(new KA(A-K*(f+E),X+K*f));const g=A/X;for(let K=1;K<X;K++)for(let N=0;N<K*g;N++)s.push(new KA(N,K)),s.push(new KA(N,K).rotate120(A,X)),s.push(new KA(N,K).rotateNeg120(A,X))}s.sort(((A,X)=>A.x-X.x)),s.sort(((A,X)=>A.y-X.y));const g=new Array(A+X+1),K=new Array(A+X+1);for(let a=0;a<g.length;a++)g[a]=1/0,K[a]=-1/0;let r=0,i=0;const Y=s.length;for(let a=0;a<Y;a++)i=s[a].x,r=s[a].y,g[r]=Math.min(i,g[r]),K[r]=Math.max(i,K[r]);const v=(s,N)=>{const f=s.clone();return"A"===N&&f.rotateNeg120(A,X),"B"===N&&f.rotate120(A,X),f.x<0?f.y:f.x+f.y},c=[],M=[],d=[],Q=[],w={},R=[];let C=-1,J=-1;for(let a=0;a<Y;a++)c[a]=s[a].toCartesianOrigin(new KA(0,0),.5),M[a]=v(s[a],"O"),d[a]=v(s[a],"A"),Q[a]=v(s[a],"B"),M[a]===d[a]&&d[a]===Q[a]?(C=3,J=M[a]):M[a]===d[a]?(C=4,J=M[a]):d[a]===Q[a]?(C=5,J=d[a]):Q[a]===M[a]&&(C=6,J=M[a]),M[a]<d[a]&&M[a]<Q[a]&&(C=2,J=M[a]),d[a]<M[a]&&d[a]<Q[a]&&(C=1,J=d[a]),Q[a]<d[a]&&Q[a]<M[a]&&(C=0,J=Q[a]),R.push([C,J,s[a].x,s[a].y]);R.sort(((A,X)=>A[2]-X[2])),R.sort(((A,X)=>A[3]-X[3])),R.sort(((A,X)=>A[1]-X[1])),R.sort(((A,X)=>A[0]-X[0]));for(let a=0;a<R.length;a++)w[R[a][2]+"|"+R[a][3]]=[R[a][0],R[a][1],a];return this.m=A,this.n=X,this.vertices=s,this.vertByDist=w,this.cartesian=c,this.min=g,this.max=K,this}}class iA{constructor(A,X,s,N){this.name=A,this.category=X,this.vertex=s,this.face=N}}class YA extends iA{innerToData(A,X){for(let s=0;s<X.innerFacets.length;s++)this.face.push(X.innerFacets[s].map((s=>X.vecToidx[A+s])))}mapABOBtoDATA(A,X){const s=X.IDATA.edgematch[A][0];for(let N=0;N<X.isoVecsABOB.length;N++){const f=[];for(let E=0;E<3;E++)0===X.vertexTypes[N][E]?f.push(A+"|"+X.isoVecsABOB[N][E].x+"|"+X.isoVecsABOB[N][E].y):f.push(s+"|"+X.isoVecsABOB[N][E].x+"|"+X.isoVecsABOB[N][E].y);this.face.push([X.vecToidx[f[0]],X.vecToidx[f[1]],X.vecToidx[f[2]]])}}mapOBOAtoDATA(A,X){const s=X.IDATA.edgematch[A][0];for(let N=0;N<X.isoVecsOBOA.length;N++){const f=[];for(let E=0;E<3;E++)1===X.vertexTypes[N][E]?f.push(A+"|"+X.isoVecsOBOA[N][E].x+"|"+X.isoVecsOBOA[N][E].y):f.push(s+"|"+X.isoVecsOBOA[N][E].x+"|"+X.isoVecsOBOA[N][E].y);this.face.push([X.vecToidx[f[0]],X.vecToidx[f[1]],X.vecToidx[f[2]]])}}mapBAOAtoDATA(A,X){const s=X.IDATA.edgematch[A][2];for(let N=0;N<X.isoVecsBAOA.length;N++){const f=[];for(let E=0;E<3;E++)1===X.vertexTypes[N][E]?f.push(A+"|"+X.isoVecsBAOA[N][E].x+"|"+X.isoVecsBAOA[N][E].y):f.push(s+"|"+X.isoVecsBAOA[N][E].x+"|"+X.isoVecsBAOA[N][E].y);this.face.push([X.vecToidx[f[0]],X.vecToidx[f[1]],X.vecToidx[f[2]]])}}orderData(A){const X=[];for(let E=0;E<13;E++)X[E]=[];const s=A.closestTo;for(let E=0;E<s.length;E++)s[E][0]>-1?s[E][1]>0&&X[s[E][0]].push([E,s[E][1]]):X[12].push([E,s[E][0]]);const N=[];for(let E=0;E<12;E++)N[E]=E;let f=12;for(let E=0;E<12;E++){X[E].sort(((A,X)=>A[1]-X[1]));for(let A=0;A<X[E].length;A++)N[X[E][A][0]]=f++}for(let E=0;E<X[12].length;E++)N[X[12][E][0]]=f++;for(let E=0;E<this.vertex.length;E++)this.vertex[E].push(N[E]);this.vertex.sort(((A,X)=>A[3]-X[3]));for(let E=0;E<this.vertex.length;E++)this.vertex[E].pop();for(let E=0;E<this.face.length;E++)for(let A=0;A<this.face[E].length;A++)this.face[E][A]=N[this.face[E][A]];this.sharedNodes=X[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(A,X){const s=[],N=[];let f=X.pop();N.push(f);let E=this.face[f].indexOf(A);E=(E+2)%3;let g=this.face[f][E];s.push(g);let K=0;for(;X.length>0;)f=X[K],this.face[f].indexOf(g)>-1?(E=(this.face[f].indexOf(g)+1)%3,g=this.face[f][E],s.push(g),N.push(f),X.splice(K,1),K=0):K++;return this.adjacentFaces.push(s),N}toGoldbergPolyhedronData(){const A=new iA("GeoDual","Goldberg",[],[]);A.name="GD dual";const X=this.vertex.length,s=new Array(X);for(let r=0;r<X;r++)s[r]=[];for(let r=0;r<this.face.length;r++)for(let A=0;A<3;A++)s[this.face[r][A]].push(r);let N=0,f=0,E=0,g=[],K=[];this.adjacentFaces=[];for(let r=0;r<s.length;r++){A.face[r]=this.setOrder(r,s[r].concat([]));for(const X of s[r]){N=0,f=0,E=0,g=this.face[X];for(let A=0;A<3;A++)K=this.vertex[g[A]],N+=K[0],f+=K[1],E+=K[2];A.vertex[X]=[N/3,f/3,E/3]}}return A}static BuildGeodesicData(A){const X=new YA("Geodesic-m-n","Geodesic",[[0,D.e,-1],[-D.e,1,0],[-1,0,-D.e],[1,0,-D.e],[D.e,1,0],[0,D.e,1],[-1,0,D.e],[-D.e,-1,0],[0,-D.e,-1],[D.e,-1,0],[1,0,D.e],[0,-D.e,1]],[]);A.setIndices(),A.calcCoeffs(),A.createInnerFacets(),A.edgeVecsABOB(),A.mapABOBtoOBOA(),A.mapABOBtoBAOA();for(let s=0;s<A.IDATA.face.length;s++)A.MapToFace(s,X),X.innerToData(s,A),"B"===A.IDATA.edgematch[s][1]&&X.mapABOBtoDATA(s,A),"O"===A.IDATA.edgematch[s][1]&&X.mapOBOAtoDATA(s,A),"A"===A.IDATA.edgematch[s][3]&&X.mapBAOAtoDATA(s,A);X.orderData(A);return X.vertex=X.vertex.map((function(A){const X=A[0],s=A[1],N=A[2],f=Math.sqrt(X*X+s*s+N*N);return A[0]*=1/f,A[1]*=1/f,A[2]*=1/f,A})),X}}f.d._GoldbergMeshParser=(A,X)=>vA.Parse(A,X);class vA extends f.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(A,X){return void 0===X?(A>this.goldbergData.nbUnsharedFaces-1&&(G.b.Warn("Maximum number of unshared faces used"),A=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+A):(A>11&&(G.b.Warn("Last pole used"),A=11),X>this.goldbergData.nbFacesAtPole-1&&(G.b.Warn("Maximum number of faces at a pole used"),X=this.goldbergData.nbFacesAtPole-1),12+A*this.goldbergData.nbFacesAtPole+X)}_changeGoldbergFaceColors(A){for(let s=0;s<A.length;s++){const X=A[s][0],N=A[s][1],f=A[s][2];for(let A=X;A<N+1;A++)this.goldbergData.faceColors[A]=f}const X=[];for(let s=0;s<12;s++)for(let A=0;A<5;A++)X.push(this.goldbergData.faceColors[s].r,this.goldbergData.faceColors[s].g,this.goldbergData.faceColors[s].b,this.goldbergData.faceColors[s].a);for(let s=12;s<this.goldbergData.faceColors.length;s++)for(let A=0;A<6;A++)X.push(this.goldbergData.faceColors[s].r,this.goldbergData.faceColors[s].g,this.goldbergData.faceColors[s].b,this.goldbergData.faceColors[s].a);return X}setGoldbergFaceColors(A){const X=this._changeGoldbergFaceColors(A);this.Ga(E.e.ColorKind,X)}updateGoldbergFaceColors(A){const X=this._changeGoldbergFaceColors(A);this.updateVerticesData(E.e.ColorKind,X)}_changeGoldbergFaceUVs(A){const X=this.getVerticesData(E.e.UVKind);for(let s=0;s<A.length;s++){const N=A[s][0],f=A[s][1],E=A[s][2],g=A[s][3],K=A[s][4],r=[],i=[];let Y,v;for(let A=0;A<5;A++)Y=E.x+g*Math.cos(K+A*Math.PI/2.5),v=E.y+g*Math.sin(K+A*Math.PI/2.5),Y<0&&(Y=0),Y>1&&(Y=1),r.push(Y,v);for(let A=0;A<6;A++)Y=E.x+g*Math.cos(K+A*Math.PI/3),v=E.y+g*Math.sin(K+A*Math.PI/3),Y<0&&(Y=0),Y>1&&(Y=1),i.push(Y,v);for(let A=N;A<Math.min(12,f+1);A++)for(let s=0;s<5;s++)X[10*A+2*s]=r[2*s],X[10*A+2*s+1]=r[2*s+1];for(let A=Math.max(12,N);A<f+1;A++)for(let s=0;s<6;s++)X[12*A-24+2*s]=i[2*s],X[12*A-23+2*s]=i[2*s+1]}return X}setGoldbergFaceUVs(A){const X=this._changeGoldbergFaceUVs(A);this.Ga(E.e.UVKind,X)}updateGoldbergFaceUVs(A){const X=this._changeGoldbergFaceUVs(A);this.updateVerticesData(E.e.UVKind,X)}placeOnGoldbergFaceAt(A,X,s){const f=N.k.RotationFromAxis(this.goldbergData.faceXaxis[X],this.goldbergData.faceYaxis[X],this.goldbergData.faceZaxis[X]);A.rotation=f,A.position=this.goldbergData.faceCenters[X].add(this.goldbergData.faceXaxis[X].scale(s.x)).add(this.goldbergData.faceYaxis[X].scale(s.y)).add(this.goldbergData.faceZaxis[X].scale(s.z))}serialize(A){super.serialize(A),A.type="GoldbergMesh";const X={};if(X.adjacentFaces=this.goldbergData.adjacentFaces,X.nbSharedFaces=this.goldbergData.nbSharedFaces,X.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,X.nbFaces=this.goldbergData.nbFaces,X.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){X.faceColors=[];for(const A of this.goldbergData.faceColors)X.faceColors.push(A.zi())}if(this.goldbergData.faceCenters){X.faceCenters=[];for(const A of this.goldbergData.faceCenters)X.faceCenters.push(A.zi())}if(this.goldbergData.faceZaxis){X.faceZaxis=[];for(const A of this.goldbergData.faceZaxis)X.faceZaxis.push(A.zi())}if(this.goldbergData.faceYaxis){X.faceYaxis=[];for(const A of this.goldbergData.faceYaxis)X.faceYaxis.push(A.zi())}if(this.goldbergData.faceXaxis){X.faceXaxis=[];for(const A of this.goldbergData.faceXaxis)X.faceXaxis.push(A.zi())}A.goldbergData=X}static Parse(A,X){const s=A.goldbergData;s.faceColors=s.faceColors.map((A=>c.h.mi(A))),s.faceCenters=s.faceCenters.map((A=>N.k.mi(A))),s.faceZaxis=s.faceZaxis.map((A=>N.k.mi(A))),s.faceXaxis=s.faceXaxis.map((A=>N.k.mi(A))),s.faceYaxis=s.faceYaxis.map((A=>N.k.mi(A)));const f=new vA(A.name,X);return f.goldbergData=s,f}}var cA=s(810);class MA{constructor(A){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=A}moveTo(A,X){this._currentPath=new V.g(A,X),this._tempPaths.push(this._currentPath)}lineTo(A,X){this._currentPath.addLineTo(A,X)}quadraticCurveTo(A,X,s,N){this._currentPath.addQuadraticCurveTo(A,X,s,N,this._resolution)}bezierCurveTo(A,X,s,N,f,E){this._currentPath.addBezierCurveTo(A,X,s,N,f,E,this._resolution)}extractHoles(){for(const A of this._tempPaths)A.area()>0?this._holes.push(A):this._paths.push(A);if(!this._paths.length&&this._holes.length){const A=this._holes;this._holes=this._paths,this._paths=A}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function dA(A,X,s,N,f,E){const g=E.glyphs[A]||E.glyphs["?"];if(!g)return null;const K=new MA(f);if(g.o){const A=g.o.split(" ");for(let f=0,E=A.length;f<E;){switch(A[f++]){case"m":{const E=parseInt(A[f++])*X+s,g=parseInt(A[f++])*X+N;K.moveTo(E,g);break}case"l":{const E=parseInt(A[f++])*X+s,g=parseInt(A[f++])*X+N;K.lineTo(E,g);break}case"q":{const E=parseInt(A[f++])*X+s,g=parseInt(A[f++])*X+N,r=parseInt(A[f++])*X+s,i=parseInt(A[f++])*X+N;K.quadraticCurveTo(r,i,E,g);break}case"b":{const E=parseInt(A[f++])*X+s,g=parseInt(A[f++])*X+N,r=parseInt(A[f++])*X+s,i=parseInt(A[f++])*X+N,Y=parseInt(A[f++])*X+s,v=parseInt(A[f++])*X+N;K.bezierCurveTo(r,i,Y,v,E,g);break}}}}return K.extractHoles(),{offsetX:g.ha*X,shapePath:K}}const QA={CreateBox:v.e,CreateTiledBox:w,CreateSphere:R.b,CreateDisc:Y.d,CreateIcoSphere:B,CreateRibbon:i,CreateCylinder:u,CreateTorus:m,CreateTorusKnot:y,CreateLineSystem:j.g,Ei:j.h,CreateDashedLines:j.e,ExtrudeShape:T,ExtrudeShapeCustom:I,CreateLathe:k,CreateTiledPlane:d,Fi:x.c,CreateGround:H.i,CreateTiledGround:H.k,CreateGroundFromHeightMap:H.e,CreatePolygon:t,ExtrudePolygon:e,CreateTube:F,CreatePolyhedron:S,CreateGeodesic:function(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=X.m||1;N!==Math.floor(N)&&(N=Math.floor(N),G.b.Warn("m not an integer only floor(m) used"));let f=X.n||0;if(f!==Math.floor(f)&&(f=Math.floor(f),G.b.Warn("n not an integer only floor(n) used")),f>N){const A=f;f=N,N=A,G.b.Warn("n > m therefore m and n swapped")}const E=new rA;return E.build(N,f),S(A,{custom:YA.BuildGeodesicData(E),size:X.size,sizeX:X.sizeX,sizeY:X.sizeY,sizeZ:X.sizeZ,faceUV:X.faceUV,faceColors:X.faceColors,flat:X.flat,updatable:X.updatable,sideOrientation:X.sideOrientation,frontUVs:X.frontUVs,backUVs:X.backUVs},s)},CreateGoldberg:function(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=X.size,r=X.sizeX||E||1,i=X.sizeY||E||1,Y=X.sizeZ||E||1;let v=X.m||1;v!==Math.floor(v)&&(v=Math.floor(v),G.b.Warn("m not an integer only floor(m) used"));let M=X.n||0;if(M!==Math.floor(M)&&(M=Math.floor(M),G.b.Warn("n not an integer only floor(n) used")),M>v){const A=M;M=v,v=A,G.b.Warn("n > m therefore m and n swapped")}const d=new rA;d.build(v,M);const Q=YA.BuildGeodesicData(d),w=Q.toGoldbergPolyhedronData(),R=new vA(A,s);X.sideOrientation=f.d._GetDefaultSideOrientation(X.sideOrientation),R._originalBuilderSideOrientation=X.sideOrientation;(function(A,X){const s=A.size,f=A.sizeX||s||1,E=A.sizeY||s||1,r=A.sizeZ||s||1,i=0===A.sideOrientation?0:A.sideOrientation||g.b.DEFAULTSIDE,Y=[],v=[],c=[],M=[];let d=1/0,Q=-1/0,w=1/0,R=-1/0;for(let N=0;N<X.vertex.length;N++)d=Math.min(d,X.vertex[N][0]*f),Q=Math.max(Q,X.vertex[N][0]*f),w=Math.min(w,X.vertex[N][1]*E),R=Math.max(R,X.vertex[N][1]*E);let C=0;for(let g=0;g<X.face.length;g++){const A=X.face[g],s=N.k.mi(X.vertex[A[0]]),i=N.k.mi(X.vertex[A[2]]),J=N.k.mi(X.vertex[A[1]]),a=i.Pg(s),u=J.Pg(s),z=N.k.Cross(u,a).normalize();for(let N=0;N<A.length;N++){c.push(z.x,z.y,z.z);const s=X.vertex[A[N]];Y.push(s[0]*f,s[1]*E,s[2]*r);const g=(s[1]*E-w)/(R-w);M.push((s[0]*f-d)/(Q-d),K.b?1-g:g)}for(let X=0;X<A.length-2;X++)v.push(C,C+X+2,C+X+1);C+=A.length}g.b._ComputeSides(i,Y,v,c,M);const J=new g.b;return J.xa=Y,J.indices=v,J.ya=c,J.Aa=M,J})(X,w).Ca(R,X.updatable),R.goldbergData.nbSharedFaces=Q.sharedNodes,R.goldbergData.nbUnsharedFaces=Q.poleNodes,R.goldbergData.adjacentFaces=Q.adjacentFaces,R.goldbergData.nbFaces=R.goldbergData.nbSharedFaces+R.goldbergData.nbUnsharedFaces,R.goldbergData.nbFacesAtPole=(R.goldbergData.nbUnsharedFaces-12)/12;for(let f=0;f<Q.vertex.length;f++)R.goldbergData.faceCenters.push(N.k.mi(Q.vertex[f])),R.goldbergData.faceCenters[f].x*=r,R.goldbergData.faceCenters[f].y*=i,R.goldbergData.faceCenters[f].z*=Y,R.goldbergData.faceColors.push(new c.h(1,1,1,1));for(let f=0;f<w.face.length;f++){const A=w.face[f],X=N.k.mi(w.vertex[A[0]]),s=N.k.mi(w.vertex[A[2]]),E=N.k.mi(w.vertex[A[1]]),g=s.Pg(X),K=E.Pg(X),r=N.k.Cross(K,g).normalize(),i=N.k.Cross(K,r).normalize();R.goldbergData.faceXaxis.push(K.normalize()),R.goldbergData.faceYaxis.push(r),R.goldbergData.faceZaxis.push(i)}return R},CreateDecal:fA,CreateCapsule:gA,CreateText:function(A,X,s){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const r=function(A,X,s,N){const f=Array.from(A),E=X/N.resolution,g=(N.boundingBox.yMax-N.boundingBox.yMin+N.underlineThickness)*E,K=[];let r=0,i=0;for(let Y=0;Y<f.length;Y++){const A=f[Y];if("\n"===A)r=0,i-=g;else{const X=dA(A,E,r,i,s,N);X&&(r+=X.offsetX,K.push(X.shapePath))}}return K}(X,E.size||50,E.resolution||8,s),i=[];let Y=0;for(const d of r){if(!d.paths.length)continue;const X=d.holes.slice();for(const s of d.paths){var v,c;const r=[],M=[],d=s.getPoints();for(const A of d)M.push(new N.k(A.x,0,A.y));const Q=X.slice();for(const A of Q){const f=A.getPoints();let E=!1;for(const A of f)if(s.isPointInside(A)){E=!0;break}if(!E)continue;const g=[];for(const A of f)g.push(new N.k(A.x,0,A.y));r.push(g),X.splice(X.indexOf(A),1)}if(!r.length&&X.length)for(const A of X){const X=A.getPoints(),s=[];for(const A of X)s.push(new N.k(A.x,0,A.y));r.push(s)}const w=e(A,{shape:M,holes:r.length?r:void 0,depth:E.depth||1,faceUV:E.faceUV||(null===(v=E.perLetterFaceUV)||void 0===v?void 0:v.call(E,Y)),faceColors:E.faceColors||(null===(c=E.perLetterFaceColors)||void 0===c?void 0:c.call(E,Y)),sideOrientation:f.d._GetDefaultSideOrientation(E.sideOrientation||f.d.DOUBLESIDE)},g,K);i.push(w),Y++}}const M=f.d.MergeMeshes(i,!0,!0);if(M){const X=M.getBoundingInfo().boundingBox;M.position.x+=-(X.minimumWorld.x+X.maximumWorld.x)/2,M.position.y+=-(X.minimumWorld.y+X.maximumWorld.y)/2,M.position.z+=-(X.minimumWorld.z+X.maximumWorld.z)/2+X.extendSize.z,M.name=A;const s=new cA.c("pivot",g);s.rotation.x=-Math.PI/2,M.parent=s,M.bakeCurrentTransformIntoVertices(),M.parent=null,s.dispose()}return M}}},12578:(A,X,s)=>{"use strict";s.d(X,{c:()=>g});var N=s(2281),f=s(2483);let E=0;const g=A=>{if(!A.environmentBRDFTexture){const X=A.useDelayedTextureLoading;A.useDelayedTextureLoading=!1;const s=A._blockEntityCollection;A._blockEntityCollection=!1;const g=N.d.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+E++,A,!0,!1,N.d.BILINEAR_SAMPLINGMODE);A._blockEntityCollection=s;const K=A.getEngine().getLoadedTexturesCache(),r=K.indexOf(g.getInternalTexture());-1!==r&&K.splice(r,1),g.isRGBD=!0,g.wrapU=N.d.CLAMP_ADDRESSMODE,g.wrapV=N.d.CLAMP_ADDRESSMODE,A.environmentBRDFTexture=g,A.useDelayedTextureLoading=X,f.e.ExpandRGBDTexture(g);const i=A.getEngine().onContextRestoredObservable.add((()=>{g.isRGBD=!0;const X=A.onBeforeRenderObservable.add((()=>{g.isReady()&&(A.onBeforeRenderObservable.remove(X),f.e.ExpandRGBDTexture(g))}))}));A.Ji.add((()=>{A.getEngine().onContextRestoredObservable.remove(i)}))}return A.environmentBRDFTexture}},2510:(A,X,s)=>{"use strict";s.d(X,{d:()=>f});class N{constructor(A){this._pendingActions=new Array,this._workerInfos=A.map((A=>({workerPromise:Promise.resolve(A),idle:!0})))}dispose(){for(const A of this._workerInfos)A.workerPromise.then((A=>{A.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(A){this._executeOnIdleWorker(A)||this._pendingActions.push(A)}_executeOnIdleWorker(A){for(const X of this._workerInfos)if(X.idle)return this._execute(X,A),!0;return!1}_execute(A,X){A.idle=!1,A.workerPromise.then((s=>{X(s,(()=>{const X=this._pendingActions.shift();X?this._execute(A,X):A.idle=!0}))}))}}class f extends N{constructor(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.DefaultOptions;super([]),this._maxWorkers=A,this._createWorkerAsync=X,this._options=s}push(A){if(!this._executeOnIdleWorker(A))if(this._workerInfos.length<this._maxWorkers){const X={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(X),this._execute(X,A)}else this._pendingActions.push(A)}_execute(A,X){A.timeoutId&&(clearTimeout(A.timeoutId),delete A.timeoutId),super._execute(A,((s,N)=>{X(s,(()=>{N(),A.idle&&(A.timeoutId=setTimeout((()=>{A.workerPromise.then((A=>{A.terminate()}));const X=this._workerInfos.indexOf(A);-1!==X&&this._workerInfos.splice(X,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}f.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12238:(A,X,s)=>{"use strict";s.d(X,{d:()=>KX});var N=s(678),f=s(12129);class E extends f.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var g=s(709),K=(s(2361),s(616));class r{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(A){this._targetStopDuration!==A&&(this._targetStopDuration=A)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(A){this._noiseTexture!==A&&(this._noiseTexture=A,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(A){this._animationSheetEnabled!==A&&(this._animationSheetEnabled=A)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(A){this._isAnimationSheetEnabled!=A&&(this._isAnimationSheetEnabled=A,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(A){this._useLogarithmicDepth=A&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(A){switch(A){case r.BLENDMODE_MULTIPLYADD:return;case r.BLENDMODE_ADD:A=1;break;case r.BLENDMODE_ONEONE:A=6;break;case r.BLENDMODE_STANDARD:A=2;break;case r.BLENDMODE_MULTIPLY:A=4;break;case r.BLENDMODE_SUBTRACT:A=3}this._engine.setAlphaMode(A)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:N.k.Zero()}set direction1(A){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=A)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:N.k.Zero()}set direction2(A){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=A)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:N.k.Zero()}set minEmitBox(A){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=A)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:N.k.Zero()}set maxEmitBox(A){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=A)}get billboardMode(){return this._billboardMode}set billboardMode(A){this._billboardMode!==A&&(this._billboardMode=A,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(A){this._isBillboardBased!==A&&(this._isBillboardBased=A,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(A){this._attachImageProcessingConfiguration(A)}_attachImageProcessingConfiguration(A){A!==this._imageProcessingConfiguration&&(!A&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=A)}_reset(){}_removeGradientAndTexture(A,X,s){if(!X)return this;let N=0;for(const f of X){if(f.gradient===A){X.splice(N,1);break}N++}return s&&s.dispose(),this}constructor(A){this.animations=[],this.renderingGroupId=0,this.j=N.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new N.k(10,10,10),this.onAnimationEnd=null,this.blendMode=r.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new N.i(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.dg=new N.k(0,0,0),this._useLogarithmicDepth=!1,this.gravity=N.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new g.h(1,1,1,1),this.color2=new g.h(1,1,1,1),this.colorDead=new g.h(0,0,0,1),this.textureMask=new g.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new E,this.id=A,this.name=A}createPointEmitter(A,X){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new N.k(0,1,0),arguments.length>2&&void 0!==arguments[2]||new N.k(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new N.k(0,1,0),arguments.length>4&&void 0!==arguments[4]||new N.k(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new N.k(0,1,0),arguments.length>3&&void 0!==arguments[3]||new N.k(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(A,X,s,N){throw new Error("Method not implemented.")}}r.BLENDMODE_ONEONE=0,r.BLENDMODE_STANDARD=1,r.BLENDMODE_ADD=2,r.BLENDMODE_MULTIPLY=3,r.BLENDMODE_MULTIPLYADD=4,r.BLENDMODE_SUBTRACT=-1,(0,K.f)("BABYLON.BaseParticleSystem",r);var i=s(696),Y=s(479);class v{constructor(){this.direction1=new N.k(0,1,0),this.direction2=new N.k(0,1,0),this.minEmitBox=new N.k(-.5,-.5,-.5),this.maxEmitBox=new N.k(.5,.5,.5)}startDirectionFunction(A,X,s,f){const E=(0,i.r)(this.direction1.x,this.direction2.x),g=(0,i.r)(this.direction1.y,this.direction2.y),K=(0,i.r)(this.direction1.z,this.direction2.z);if(f)return X.x=E,X.y=g,void(X.z=K);N.k.TransformNormalFromFloatsToRef(E,g,K,A,X)}startPositionFunction(A,X,s,f){const E=(0,i.r)(this.minEmitBox.x,this.maxEmitBox.x),g=(0,i.r)(this.minEmitBox.y,this.maxEmitBox.y),K=(0,i.r)(this.minEmitBox.z,this.maxEmitBox.z);if(f)return X.x=E,X.y=g,void(X.z=K);N.k.TransformCoordinatesFromFloatsToRef(E,g,K,A,X)}clone(){const A=new v;return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setVector3("direction1",this.direction1),A.setVector3("direction2",this.direction2),A.setVector3("minEmitBox",this.minEmitBox),A.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(A){A.addUniform("direction1",3),A.addUniform("direction2",3),A.addUniform("minEmitBox",3),A.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const A={};return A.type=this.getClassName(),A.direction1=this.direction1.zi(),A.direction2=this.direction2.zi(),A.minEmitBox=this.minEmitBox.zi(),A.maxEmitBox=this.maxEmitBox.zi(),A}parse(A){N.k.FromArrayToRef(A.direction1,0,this.direction1),N.k.FromArrayToRef(A.direction2,0,this.direction2),N.k.FromArrayToRef(A.minEmitBox,0,this.minEmitBox),N.k.FromArrayToRef(A.maxEmitBox,0,this.maxEmitBox)}}class c{get radius(){return this._radius}set radius(A){this._radius=A,this._buildHeight()}get angle(){return this._angle}set angle(A){this._angle=A,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=s,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=X,this.radius=A}startDirectionFunction(A,X,s,f){f?N.f.oi[0].p(s.Kg).normalize():s.position.subtractToRef(A.getTranslation(),N.f.oi[0]).normalize();const E=(0,i.r)(0,this.directionRandomizer),g=(0,i.r)(0,this.directionRandomizer),K=(0,i.r)(0,this.directionRandomizer);X.x=N.f.oi[0].x+E,X.y=N.f.oi[0].y+g,X.z=N.f.oi[0].z+K,X.normalize()}startPositionFunction(A,X,s,f){const E=(0,i.r)(0,2*Math.PI);let g;this.emitFromSpawnPointOnly?g=1e-4:(g=(0,i.r)(0,this.heightRange),g=1-g*g);let K=this._radius-(0,i.r)(0,this._radius*this.radiusRange);K*=g;const r=K*Math.sin(E),Y=K*Math.cos(E),v=g*this._height;if(f)return X.x=r,X.y=v,void(X.z=Y);N.k.TransformCoordinatesFromFloatsToRef(r,v,Y,A,X)}clone(){const A=new c(this._radius,this._angle,this.directionRandomizer);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setFloat2("radius",this._radius,this.radiusRange),A.setFloat("coneAngle",this._angle),A.setFloat2("height",this._height,this.heightRange),A.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(A){A.addUniform("radius",2),A.addUniform("coneAngle",1),A.addUniform("height",2),A.addUniform("directionRandomizer",1)}getEffectDefines(){let A="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(A+="\n#define CONEEMITTERSPAWNPOINT"),A}getClassName(){return"ConeParticleEmitter"}serialize(){const A={};return A.type=this.getClassName(),A.radius=this._radius,A.angle=this._angle,A.directionRandomizer=this.directionRandomizer,A.radiusRange=this.radiusRange,A.heightRange=this.heightRange,A.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,A}parse(A){this.radius=A.radius,this.angle=A.angle,this.directionRandomizer=A.directionRandomizer,this.radiusRange=void 0!==A.radiusRange?A.radiusRange:1,this.heightRange=void 0!==A.radiusRange?A.heightRange:1,this.emitFromSpawnPointOnly=void 0!==A.emitFromSpawnPointOnly&&A.emitFromSpawnPointOnly}}class M extends c{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0),f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0);super(A,X),this.direction1=s,this.direction2=f}startDirectionFunction(A,X){const s=(0,i.r)(this.direction1.x,this.direction2.x),f=(0,i.r)(this.direction1.y,this.direction2.y),E=(0,i.r)(this.direction1.z,this.direction2.z);N.k.TransformNormalFromFloatsToRef(s,f,E,A,X)}clone(){const A=new M(this.radius,this.angle,this.direction1,this.direction2);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setFloat("radius",this.radius),A.setFloat("radiusRange",this.radiusRange),A.setVector3("direction1",this.direction1),A.setVector3("direction2",this.direction2)}buildUniformLayout(A){A.addUniform("radius",1),A.addUniform("radiusRange",1),A.addUniform("direction1",3),A.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const A=super.serialize();return A.direction1=this.direction1.zi(),A.direction2=this.direction2.zi(),A}parse(A){super.parse(A),this.direction1.p(A.direction1),this.direction2.p(A.direction2)}}class d{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=A,this.height=X,this.radiusRange=s,this.directionRandomizer=f,this._tempVector=N.k.Zero()}startDirectionFunction(A,X,s,f,E){s.position.subtractToRef(A.getTranslation(),this._tempVector),this._tempVector.normalize(),N.k.TransformNormalToRef(this._tempVector,E,this._tempVector);const g=(0,i.r)(-this.directionRandomizer/2,this.directionRandomizer/2);let K=Math.atan2(this._tempVector.x,this._tempVector.z);K+=(0,i.r)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=g,this._tempVector.x=Math.sin(K),this._tempVector.z=Math.cos(K),this._tempVector.normalize(),f?X.p(this._tempVector):N.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,A,X)}startPositionFunction(A,X,s,f){const E=(0,i.r)(-this.height/2,this.height/2),g=(0,i.r)(0,2*Math.PI),K=(0,i.r)((1-this.radiusRange)*(1-this.radiusRange),1),r=Math.sqrt(K)*this.radius,Y=r*Math.cos(g),v=r*Math.sin(g);f?X.gi(Y,E,v):N.k.TransformCoordinatesFromFloatsToRef(Y,E,v,A,X)}clone(){const A=new d(this.radius,this.directionRandomizer);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setFloat("radius",this.radius),A.setFloat("height",this.height),A.setFloat("radiusRange",this.radiusRange),A.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(A){A.addUniform("radius",1),A.addUniform("height",1),A.addUniform("radiusRange",1),A.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const A={};return A.type=this.getClassName(),A.radius=this.radius,A.height=this.height,A.radiusRange=this.radiusRange,A.directionRandomizer=this.directionRandomizer,A}parse(A){this.radius=A.radius,this.height=A.height,this.radiusRange=A.radiusRange,this.directionRandomizer=A.directionRandomizer}}class Q extends d{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.k(0,1,0);super(A,X,s),this.direction1=f,this.direction2=E}startDirectionFunction(A,X,s,f){const E=(0,i.r)(this.direction1.x,this.direction2.x),g=(0,i.r)(this.direction1.y,this.direction2.y),K=(0,i.r)(this.direction1.z,this.direction2.z);f?X.gi(E,g,K):N.k.TransformNormalFromFloatsToRef(E,g,K,A,X)}clone(){const A=new Q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setFloat("radius",this.radius),A.setFloat("height",this.height),A.setFloat("radiusRange",this.radiusRange),A.setVector3("direction1",this.direction1),A.setVector3("direction2",this.direction2)}buildUniformLayout(A){A.addUniform("radius",1),A.addUniform("height",1),A.addUniform("radiusRange",1),A.addUniform("direction1",3),A.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const A=super.serialize();return A.direction1=this.direction1.zi(),A.direction2=this.direction2.zi(),A}parse(A){super.parse(A),N.k.FromArrayToRef(A.direction1,0,this.direction1),N.k.FromArrayToRef(A.direction2,0,this.direction2)}}class w{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=A,this.radiusRange=X,this.directionRandomizer=s}startDirectionFunction(A,X,s,f){const E=s.position.Pg(A.getTranslation()).normalize(),g=(0,i.r)(0,this.directionRandomizer),K=(0,i.r)(0,this.directionRandomizer),r=(0,i.r)(0,this.directionRandomizer);E.x+=g,E.y+=K,E.z+=r,E.normalize(),f?X.p(E):N.k.TransformNormalFromFloatsToRef(E.x,E.y,E.z,A,X)}startPositionFunction(A,X,s,f){const E=this.radius-(0,i.r)(0,this.radius*this.radiusRange),g=(0,i.r)(0,1),K=(0,i.r)(0,2*Math.PI),r=Math.acos(2*g-1),Y=E*Math.cos(K)*Math.sin(r),v=E*Math.cos(r),c=E*Math.sin(K)*Math.sin(r);f?X.gi(Y,Math.abs(v),c):N.k.TransformCoordinatesFromFloatsToRef(Y,Math.abs(v),c,A,X)}clone(){const A=new w(this.radius,this.directionRandomizer);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setFloat("radius",this.radius),A.setFloat("radiusRange",this.radiusRange),A.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(A){A.addUniform("radius",1),A.addUniform("radiusRange",1),A.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const A={};return A.type=this.getClassName(),A.radius=this.radius,A.radiusRange=this.radiusRange,A.directionRandomizer=this.directionRandomizer,A}parse(A){this.radius=A.radius,this.radiusRange=A.radiusRange,this.directionRandomizer=A.directionRandomizer}}class R{constructor(){this.direction1=new N.k(0,1,0),this.direction2=new N.k(0,1,0)}startDirectionFunction(A,X,s,f){const E=(0,i.r)(this.direction1.x,this.direction2.x),g=(0,i.r)(this.direction1.y,this.direction2.y),K=(0,i.r)(this.direction1.z,this.direction2.z);f?X.gi(E,g,K):N.k.TransformNormalFromFloatsToRef(E,g,K,A,X)}startPositionFunction(A,X,s,f){f?X.gi(0,0,0):N.k.TransformCoordinatesFromFloatsToRef(0,0,0,A,X)}clone(){const A=new R;return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setVector3("direction1",this.direction1),A.setVector3("direction2",this.direction2)}buildUniformLayout(A){A.addUniform("direction1",3),A.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const A={};return A.type=this.getClassName(),A.direction1=this.direction1.zi(),A.direction2=this.direction2.zi(),A}parse(A){N.k.FromArrayToRef(A.direction1,0,this.direction1),N.k.FromArrayToRef(A.direction2,0,this.direction2)}}class C{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=A,this.radiusRange=X,this.directionRandomizer=s}startDirectionFunction(A,X,s,f){const E=s.position.Pg(A.getTranslation()).normalize(),g=(0,i.r)(0,this.directionRandomizer),K=(0,i.r)(0,this.directionRandomizer),r=(0,i.r)(0,this.directionRandomizer);E.x+=g,E.y+=K,E.z+=r,E.normalize(),f?X.p(E):N.k.TransformNormalFromFloatsToRef(E.x,E.y,E.z,A,X)}startPositionFunction(A,X,s,f){const E=this.radius-(0,i.r)(0,this.radius*this.radiusRange),g=(0,i.r)(0,1),K=(0,i.r)(0,2*Math.PI),r=Math.acos(2*g-1),Y=E*Math.cos(K)*Math.sin(r),v=E*Math.cos(r),c=E*Math.sin(K)*Math.sin(r);f?X.gi(Y,v,c):N.k.TransformCoordinatesFromFloatsToRef(Y,v,c,A,X)}clone(){const A=new C(this.radius,this.directionRandomizer);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setFloat("radius",this.radius),A.setFloat("radiusRange",this.radiusRange),A.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(A){A.addUniform("radius",1),A.addUniform("radiusRange",1),A.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const A={};return A.type=this.getClassName(),A.radius=this.radius,A.radiusRange=this.radiusRange,A.directionRandomizer=this.directionRandomizer,A}parse(A){this.radius=A.radius,this.radiusRange=A.radiusRange,this.directionRandomizer=A.directionRandomizer}}class J extends C{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.k(0,1,0),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0);super(A),this.direction1=X,this.direction2=s}startDirectionFunction(A,X){const s=(0,i.r)(this.direction1.x,this.direction2.x),f=(0,i.r)(this.direction1.y,this.direction2.y),E=(0,i.r)(this.direction1.z,this.direction2.z);N.k.TransformNormalFromFloatsToRef(s,f,E,A,X)}clone(){const A=new J(this.radius,this.direction1,this.direction2);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setFloat("radius",this.radius),A.setFloat("radiusRange",this.radiusRange),A.setVector3("direction1",this.direction1),A.setVector3("direction2",this.direction2)}buildUniformLayout(A){A.addUniform("radius",1),A.addUniform("radiusRange",1),A.addUniform("direction1",3),A.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const A=super.serialize();return A.direction1=this.direction1.zi(),A.direction2=this.direction2.zi(),A}parse(A){super.parse(A),this.direction1.p(A.direction1),this.direction2.p(A.direction2)}}class a{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(A,X,s,f){const E=N.f.oi[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,s,E);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,s,E);const A=N.f.oi[1];E.subtractToRef(s.position,A),A.scaleToRef(1/s.lifeTime,E)}else E.set(0,0,0);f?X.p(E):N.k.TransformNormalToRef(E,A,X)}startPositionFunction(A,X,s,f){const E=N.f.oi[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,s,E):E.set(0,0,0),f?X.p(E):N.k.TransformCoordinatesToRef(E,A,X)}clone(){const A=new a;return Y.d.DeepCopy(this,A),A}applyToShader(A){}buildUniformLayout(A){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const A={};return A.type=this.getClassName(),A.particlePositionGenerator=this.particlePositionGenerator,A.particleDestinationGenerator=this.particleDestinationGenerator,A}parse(A){A.particlePositionGenerator&&(this.particlePositionGenerator=A.particlePositionGenerator),A.particleDestinationGenerator&&(this.particleDestinationGenerator=A.particleDestinationGenerator)}}var u=s(728);class z{get mesh(){return this._mesh}set mesh(A){this._mesh!==A&&(this._mesh=A,A?(this._indices=A.ti(),this._positions=A.getVerticesData(u.e.PositionKind),this._normals=A.getVerticesData(u.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=N.k.Zero(),this._mesh=null,this.direction1=new N.k(0,1,0),this.direction2=new N.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=A}startDirectionFunction(A,X,s,f){if(this.useMeshNormalsForDirection&&this._normals)return void N.k.TransformNormalToRef(this._storedNormal,A,X);const E=(0,i.r)(this.direction1.x,this.direction2.x),g=(0,i.r)(this.direction1.y,this.direction2.y),K=(0,i.r)(this.direction1.z,this.direction2.z);f?X.gi(E,g,K):N.k.TransformNormalFromFloatsToRef(E,g,K,A,X)}startPositionFunction(A,X,s,f){if(!this._indices||!this._positions)return;const E=3*(Math.random()*(this._indices.length/3)|0),g=Math.random(),K=Math.random()*(1-g),r=1-g-K,i=this._indices[E],Y=this._indices[E+1],v=this._indices[E+2],c=N.f.oi[0],M=N.f.oi[1],d=N.f.oi[2],Q=N.f.oi[3];N.k.FromArrayToRef(this._positions,3*i,c),N.k.FromArrayToRef(this._positions,3*Y,M),N.k.FromArrayToRef(this._positions,3*v,d),Q.x=g*c.x+K*M.x+r*d.x,Q.y=g*c.y+K*M.y+r*d.y,Q.z=g*c.z+K*M.z+r*d.z,f?X.gi(Q.x,Q.y,Q.z):N.k.TransformCoordinatesFromFloatsToRef(Q.x,Q.y,Q.z,A,X),this.useMeshNormalsForDirection&&this._normals&&(N.k.FromArrayToRef(this._normals,3*i,c),N.k.FromArrayToRef(this._normals,3*Y,M),N.k.FromArrayToRef(this._normals,3*v,d),this._storedNormal.x=g*c.x+K*M.x+r*d.x,this._storedNormal.y=g*c.y+K*M.y+r*d.y,this._storedNormal.z=g*c.z+K*M.z+r*d.z)}clone(){const A=new z(this.mesh);return Y.d.DeepCopy(this,A),A}applyToShader(A){A.setVector3("direction1",this.direction1),A.setVector3("direction2",this.direction2)}buildUniformLayout(A){A.addUniform("direction1",3),A.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var A;const X={};return X.type=this.getClassName(),X.direction1=this.direction1.zi(),X.direction2=this.direction2.zi(),X.meshId=null===(A=this.mesh)||void 0===A?void 0:A.id,X.useMeshNormalsForDirection=this.useMeshNormalsForDirection,X}parse(A,X){N.k.FromArrayToRef(A.direction1,0,this.direction1),N.k.FromArrayToRef(A.direction2,0,this.direction2),A.meshId&&X&&(this.mesh=X.getLastMeshById(A.meshId)),this.useMeshNormalsForDirection=A.useMeshNormalsForDirection}}class m{_isUbo(A){return void 0!==A.addUniform}constructor(A){this._isUbo(A)?(this.setMatrix3x3=A.updateMatrix3x3.bind(A),this.setMatrix2x2=A.updateMatrix2x2.bind(A),this.setFloat=A.updateFloat.bind(A),this.setFloat2=A.updateFloat2.bind(A),this.setFloat3=A.updateFloat3.bind(A),this.setFloat4=A.updateFloat4.bind(A),this.setFloatArray=A.updateFloatArray.bind(A),this.setArray=A.updateArray.bind(A),this.setIntArray=A.updateIntArray.bind(A),this.setMatrix=A.Yi.bind(A),this.setMatrices=A.updateMatrices.bind(A),this.setVector3=A.updateVector3.bind(A),this.setVector4=A.updateVector4.bind(A),this.setColor3=A.updateColor3.bind(A),this.setColor4=A.updateColor4.bind(A),this.setDirectColor4=A.updateDirectColor4.bind(A),this.setInt=A.updateInt.bind(A),this.setInt2=A.updateInt2.bind(A),this.setInt3=A.updateInt3.bind(A),this.setInt4=A.updateInt4.bind(A)):(this.setMatrix3x3=A.setMatrix3x3.bind(A),this.setMatrix2x2=A.setMatrix2x2.bind(A),this.setFloat=A.setFloat.bind(A),this.setFloat2=A.setFloat2.bind(A),this.setFloat3=A.setFloat3.bind(A),this.setFloat4=A.setFloat4.bind(A),this.setFloatArray=A.setFloatArray.bind(A),this.setArray=A.setArray.bind(A),this.setIntArray=A.setIntArray.bind(A),this.setMatrix=A.setMatrix.bind(A),this.setMatrices=A.setMatrices.bind(A),this.setVector3=A.setVector3.bind(A),this.setVector4=A.setVector4.bind(A),this.setColor3=A.setColor3.bind(A),this.setColor4=A.setColor4.bind(A),this.setDirectColor4=A.setDirectColor4.bind(A),this.setInt=A.setInt.bind(A),this.setInt2=A.setInt2.bind(A),this.setInt3=A.setInt3.bind(A),this.setInt4=A.setInt4.bind(A))}}var b=s(559);const y="gpuUpdateParticlesPixelShader",j="#version 300 es\nvoid main() {discard;}\n";b.b.ShadersStore[y]||(b.b.ShadersStore[y]=j);const G="gpuUpdateParticlesVertexShader",V="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";b.b.ShadersStore[G]||(b.b.ShadersStore[G]=V);(0,K.f)("BABYLON.WebGL2ParticleSystem",class{constructor(A,X){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=A,this._engine=X,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var A;return(null===(A=this._updateEffect)||void 0===A?void 0:A.isReady())??!1}createUpdateBuffer(A){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof a&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=A,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new m(this._updateEffect)}createVertexBuffers(A,X){this._updateVAO.push(this._createUpdateVAO(A)),this._renderVAO.push(this._engine.recordVertexArrayObject(X,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=X}createParticleBuffer(A){return A}bindDrawBuffers(A,X,s){s?this._engine.bindBuffers(this._renderVertexBuffers,s,X):this._engine.bindVertexArrayObject(this._renderVAO[A],null)}preUpdateParticleBuffer(){const A=this._engine;if(this._engine.enableEffect(this._updateEffect),!A.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(A,X,s){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[A],null);const N=this._engine;N.bindTransformFeedbackBuffer(X.getBuffer()),N.setRasterizerState(!1),N.beginTransformFeedback(!0),N.drawArraysType(3,0,s),N.endTransformFeedback(),N.setRasterizerState(!0),N.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let A=0;A<this._updateVAO.length;A++)this._engine.releaseVertexArrayObject(this._updateVAO[A]);this._updateVAO.length=0;for(let A=0;A<this._renderVAO.length;A++)this._engine.releaseVertexArrayObject(this._renderVAO[A]);this._renderVAO.length=0}_createUpdateVAO(A){const X={};X.position=A.createVertexBuffer("position",0,3);let s=3;X.age=A.createVertexBuffer("age",s,1),s+=1,X.size=A.createVertexBuffer("size",s,3),s+=3,X.life=A.createVertexBuffer("life",s,1),s+=1,X.seed=A.createVertexBuffer("seed",s,4),s+=4,X.direction=A.createVertexBuffer("direction",s,3),s+=3,this._parent.particleEmitterType instanceof a&&(X.initialPosition=A.createVertexBuffer("initialPosition",s,3),s+=3),this._parent._colorGradientsTexture||(X.color=A.createVertexBuffer("color",s,4),s+=4),this._parent._isBillboardBased||(X.initialDirection=A.createVertexBuffer("initialDirection",s,3),s+=3),this._parent.noiseTexture&&(X.noiseCoordinates1=A.createVertexBuffer("noiseCoordinates1",s,3),s+=3,X.noiseCoordinates2=A.createVertexBuffer("noiseCoordinates2",s,3),s+=3),this._parent._angularSpeedGradientsTexture?(X.angle=A.createVertexBuffer("angle",s,1),s+=1):(X.angle=A.createVertexBuffer("angle",s,2),s+=2),this._parent._isAnimationSheetEnabled&&(X.cellIndex=A.createVertexBuffer("cellIndex",s,1),s+=1,this._parent.spriteRandomStartCell&&(X.cellStartOffset=A.createVertexBuffer("cellStartOffset",s,1),s+=1));const N=this._engine.recordVertexArrayObject(X,null,this._updateEffect);return this._engine.bindArrayBuffer(null),N}});class D{constructor(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,N=arguments.length>3?arguments[3]:void 0;this._engine=A,this._label=N,this._engine._storageBuffers.push(this),this._create(X,s)}_create(A,X){this._bufferSize=A,this._creationFlags=X,this._buffer=this._engine.createStorageBuffer(A,X,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(A,X,s){this._buffer&&this._engine.updateStorageBuffer(this._buffer,A,X,s)}async read(A,X,s,N){return await this._engine.readFromStorageBuffer(this._buffer,A,X,s,N)}dispose(){const A=this._engine._storageBuffers,X=A.indexOf(this);-1!==X&&(A[X]=A[A.length-1],A.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var O=s(657),P=s(666),l=s(707),n=s(2281),U=s(2476),t=s(470),e=s(597),T=s(2386);class I{constructor(){this._gpuTimeInFrameId=-1,this.counter=new T.d}_addDuration(A,X){A<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==A?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(X,!1),this._gpuTimeInFrameId=A):this.counter.addCount(X,!1))}}var L=s(542);class k{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=A,this._engine=X,this.uniqueId=U.c.UniqueId,X.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new I),this._engine.getCaps().supportComputeShaders?N.bindingsMapping?(this._context=X.createComputeContext(),this._shaderPath=s,this._options={bindingsMapping:{},defines:[],...N}):t.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):t.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(A,X){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=this._bindings[A];this._bindings[A]={type:s?0:4,object:X,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!N||N.object!==X||N.type!==this._bindings[A].type)}setStorageTexture(A,X){const s=this._bindings[A];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==X),this._bindings[A]={type:1,object:X,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setExternalTexture(A,X){const s=this._bindings[A];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==X),this._bindings[A]={type:6,object:X,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setVideoTexture(A,X){return!!X.externalTexture&&(this.setExternalTexture(A,X.externalTexture),!0)}setUniformBuffer(A,X){const s=this._bindings[A];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==X),this._bindings[A]={type:k._BufferIsDataBuffer(X)?7:2,object:X,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setStorageBuffer(A,X){const s=this._bindings[A];this._contextIsDirty||(this._contextIsDirty=!s||s.object!==X),this._bindings[A]={type:k._BufferIsDataBuffer(X)?7:3,object:X,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}setTextureSampler(A,X){const s=this._bindings[A];this._contextIsDirty||(this._contextIsDirty=!s||!X.compareSampler(s.object)),this._bindings[A]={type:5,object:X,indexInGroupEntries:null===s||void 0===s?void 0:s.indexInGroupEntries}}isReady(){let A=this._effect;for(const f in this._bindings){const A=this._bindings[f],X=A.type,s=A.object;switch(X){case 0:case 4:case 1:if(!s.isReady())return!1;break;case 6:if(!s.isReady())return!1;break}}const X=[],s=this._shaderPath;if(this._options.defines)for(let f=0;f<this._options.defines.length;f++)X.push(this._options.defines[f]);const N=X.join("\n");return this._cachedDefines!==N&&(this._cachedDefines=N,A=this._engine.createComputeEffect(s,{defines:N,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=A),!!A.isReady()}dispatch(A,X,s){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,A,X,s,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const s=k._BufferIsDataBuffer(A)?A:A.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,s,X,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const X in this._bindings){const s=this._bindings[X];if(!this._options.bindingsMapping[X])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+X+"'");switch(s.type){case 0:{const N=this._samplers[X],f=s.object;var A;if(!N||!f._texture||!N.compareSampler(f._texture))this._samplers[X]=(new e.c).setParameters(f.wrapU,f.wrapV,f.wrapR,f.anisotropicFilteringLevel,f._texture.samplingMode,null===(A=f._texture)||void 0===A?void 0:A._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const A=s.object;A.getBuffer()!==s.buffer&&(s.buffer=A.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((f=>{(0,L.i)((()=>this.dispatch(A,X,s)),f,void 0,N)}))}serialize(){const A=l.c.Serialize(this);A.options=this._options,A.shaderPath=this._shaderPath,A.Tl={},A.textures={};for(const X in this._bindings){const s=this._bindings[X],N=s.object;switch(s.type){case 0:case 4:case 1:{const f=N.serialize();f&&(A.textures[X]=f,A.Tl[X]={type:s.type});break}}}return A}static Parse(A,X,s){const N=l.c.Parse((()=>new k(A.name,X.getEngine(),A.shaderPath,A.options)),A,X,s);for(const f in A.textures){const E=A.Tl[f],g=n.d.Parse(A.textures[f],X,s);0===E.type?N.setTexture(f,g):4===E.type?N.setTexture(f,g,!1):N.setStorageTexture(f,g)}return N}static _BufferIsDataBuffer(A){return void 0!==A.underlyingResource}}(0,O.e)([(0,P.M)()],k.prototype,"name",void 0),(0,O.e)([(0,P.M)()],k.prototype,"fastMode",void 0),(0,K.f)("BABYLON.ComputeShader",k);var x=s(821);const H="gpuUpdateParticlesComputeShader",F="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";b.b.ShadersStoreWGSL[H]||(b.b.ShadersStoreWGSL[H]=F);(0,K.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(A,X){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=A,this._engine=X}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var A;return(null===(A=this._updateComputeShader)||void 0===A?void 0:A.isReady())??!1}createUpdateBuffer(A){var X;const s={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(s.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(s.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(s.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(s.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(s.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(s.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(s.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new k("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:s,defines:A.split("\n")}),null===(X=this._simParamsComputeShader)||void 0===X||X.dispose(),this._simParamsComputeShader=new x.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new m(this._simParamsComputeShader)}createVertexBuffers(A,X){this._renderVertexBuffers.push(X)}createParticleBuffer(A){const X=new D(this._engine,4*A.length,11,"ComputeShaderParticleSystemBuffer");return X.update(A),this._bufferComputeShader.push(X),X.getBuffer()}bindDrawBuffers(A,X,s){this._engine.bindBuffers(this._renderVertexBuffers[A],s,X)}preUpdateParticleBuffer(){}updateParticleBuffer(A,X,s){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[A]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^A]),this._updateComputeShader.dispatch(Math.ceil(s/64))}releaseBuffers(){var A;for(let X=0;X<this._bufferComputeShader.length;++X)this._bufferComputeShader[X].dispose();this._bufferComputeShader.length=0,null===(A=this._simParamsComputeShader)||void 0===A||A.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class q{constructor(A,X,s){this.gradient=A,this.color1=X,this.color2=s}getColorToRef(A){this.color2?g.h.LerpToRef(this.color1,this.color2,Math.random(),A):A.p(this.color1)}}class S{constructor(A,X){this.gradient=A,this.color=X}}class p{constructor(A,X,s){this.gradient=A,this.factor1=X,this.factor2=s}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class B{static GetCurrentGradient(A,X,s){if(X[0].gradient>A)return void s(X[0],X[0],1);for(let f=0;f<X.length-1;f++){const N=X[f],E=X[f+1];if(A>=N.gradient&&A<=E.gradient){return void s(N,E,(A-N.gradient)/(E.gradient-N.gradient))}}const N=X.length-1;s(X[N],X[N],1)}}var Z=s(454),o=s(12247),W=s(503);class h{constructor(A){this.particleSystem=A,this.position=N.k.Zero(),this.direction=N.k.Zero(),this.color=new g.h(0,0,0,0),this.colorStep=new g.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new N.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new g.h(0,0,0,0),this._currentColor2=new g.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=h._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let A=this.age,X=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===X?(X=1,A=this._randomCellOffset):A+=this._randomCellOffset);const s=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let N;N=this._initialSpriteCellLoop?(0,i.c)(A*X%this.lifeTime/this.lifeTime):(0,i.c)(A*X/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+N*s|0}_inheritParticleInfoToSubEmitter(A){if(A.particleSystem.j.position){const X=A.particleSystem.j;if(X.position.p(this.position),A.inheritDirection){const A=N.f.oi[0];this.direction.normalizeToRef(A),X.setDirection(A,0,Math.PI/2)}}else{A.particleSystem.j.p(this.position)}this.direction.scaleToRef(A.inheritedVelocityAmount/2,N.f.oi[0]),A.particleSystem._inheritedVelocityOffset.p(N.f.oi[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const A of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(A)}_reset(){this.age=0,this.id=h._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(A){A.position.p(this.position),this._initialDirection?A._initialDirection?A._initialDirection.p(this._initialDirection):A._initialDirection=this._initialDirection.clone():A._initialDirection=null,A.direction.p(this.direction),this.Kg&&(A.Kg?A.Kg.p(this.Kg):A.Kg=this.Kg.clone()),A.color.p(this.color),A.colorStep.p(this.colorStep),A.lifeTime=this.lifeTime,A.age=this.age,A._randomCellOffset=this._randomCellOffset,A.size=this.size,A.scale.p(this.scale),A.angle=this.angle,A.angularSpeed=this.angularSpeed,A.particleSystem=this.particleSystem,A.cellIndex=this.cellIndex,A.id=this.id,A._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(A._currentColorGradient=this._currentColorGradient,A._currentColor1.p(this._currentColor1),A._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(A._currentSizeGradient=this._currentSizeGradient,A._currentSize1=this._currentSize1,A._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(A._currentAngularSpeedGradient=this._currentAngularSpeedGradient,A._currentAngularSpeed1=this._currentAngularSpeed1,A._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(A._currentVelocityGradient=this._currentVelocityGradient,A._currentVelocity1=this._currentVelocity1,A._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(A._currentLimitVelocityGradient=this._currentLimitVelocityGradient,A._currentLimitVelocity1=this._currentLimitVelocity1,A._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(A._currentDragGradient=this._currentDragGradient,A._currentDrag1=this._currentDrag1,A._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(A._initialStartSpriteCellId=this._initialStartSpriteCellId,A._initialEndSpriteCellId=this._initialEndSpriteCellId,A._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(A.remapData&&this.remapData?A.remapData.p(this.remapData):A.remapData=new N.m(0,0,0,0)),this._randomNoiseCoordinates1&&(A._randomNoiseCoordinates1?(A._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),A._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(A._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),A._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}h._Count=0;var AA=s(775),XA=(s(2352),s(841)),sA=s(828),NA=s(2442);function fA(A,X){const s=(0,i.r)(0,1);g.h.LerpToRef(X.color1,X.color2,s,A.color),X.colorDead.subtractToRef(A.color,X._colorDiff),X._colorDiff.scaleToRef(1/A.lifeTime,A.colorStep)}function EA(A,X){A._currentColorGradient=X._colorGradients[0],A._currentColorGradient.getColorToRef(A.color),A._currentColor1.p(A.color),X._colorGradients.length>1?X._colorGradients[1].getColorToRef(A._currentColor2):A._currentColor2.p(A.color)}function gA(A,X){const s=X._colorGradients;B.GetCurrentGradient(X._ratio,s,((X,s,N)=>{X!==A._currentColorGradient&&(A._currentColor1.p(A._currentColor2),s.getColorToRef(A._currentColor2),A._currentColorGradient=X),g.h.LerpToRef(A._currentColor1,A._currentColor2,N,A.color)}))}function KA(A,X){A.colorStep.scaleToRef(X._scaledUpdateSpeed,X._scaledColorStep),A.color.addInPlace(X._scaledColorStep),A.color.a<0&&(A.color.a=0)}function rA(A,X){B.GetCurrentGradient(X._ratio,X._angularSpeedGradients,((X,s,N)=>{X!==A._currentAngularSpeedGradient&&(A._currentAngularSpeed1=A._currentAngularSpeed2,A._currentAngularSpeed2=s.getFactor(),A._currentAngularSpeedGradient=X),A.angularSpeed=(0,i.l)(A._currentAngularSpeed1,A._currentAngularSpeed2,N)}))}function iA(A,X){A.angle+=A.angularSpeed*X._scaledUpdateSpeed}function YA(A,X){X.particleEmitterType.startDirectionFunction(X._emitterWorldMatrix,A.direction,A,X.isLocal,X._emitterInverseWorldMatrix)}function vA(A,X){X.startDirectionFunction(X._emitterWorldMatrix,A.direction,A,X.isLocal)}function cA(A,X){A._currentVelocityGradient=X._velocityGradients[0],A._currentVelocity1=A._currentVelocityGradient.getFactor(),X._velocityGradients.length>1?A._currentVelocity2=X._velocityGradients[1].getFactor():A._currentVelocity2=A._currentVelocity1}function MA(A,X){A._currentLimitVelocityGradient=X._limitVelocityGradients[0],A._currentLimitVelocity1=A._currentLimitVelocityGradient.getFactor(),X._limitVelocityGradients.length>1?A._currentLimitVelocity2=X._limitVelocityGradients[1].getFactor():A._currentLimitVelocity2=A._currentLimitVelocity1}function dA(A,X){B.GetCurrentGradient(X._ratio,X._velocityGradients,((s,N,f)=>{s!==A._currentVelocityGradient&&(A._currentVelocity1=A._currentVelocity2,A._currentVelocity2=N.getFactor(),A._currentVelocityGradient=s),X._directionScale*=(0,i.l)(A._currentVelocity1,A._currentVelocity2,f)}))}function QA(A,X){B.GetCurrentGradient(X._ratio,X._limitVelocityGradients,((s,N,f)=>{s!==A._currentLimitVelocityGradient&&(A._currentLimitVelocity1=A._currentLimitVelocity2,A._currentLimitVelocity2=N.getFactor(),A._currentLimitVelocityGradient=s);const E=(0,i.l)(A._currentLimitVelocity1,A._currentLimitVelocity2,f);A.direction.length()>E&&A.direction.scaleInPlace(X.limitVelocityDamping)}))}function wA(A,X){A.direction.scaleToRef(X._directionScale,X._scaledDirection)}function RA(A,X){X.particleEmitterType.startPositionFunction(X._emitterWorldMatrix,A.position,A,X.isLocal)}function CA(A,X){X.startPositionFunction(X._emitterWorldMatrix,A.position,A,X.isLocal)}function JA(A,X){A.Kg?A.Kg.p(A.position):A.Kg=A.position.clone(),N.k.TransformCoordinatesToRef(A.Kg,X._emitterWorldMatrix,A.position)}function aA(A,X){X.isLocal&&A.Kg?(A.Kg.addInPlace(X._scaledDirection),N.k.TransformCoordinatesToRef(A.Kg,X._emitterWorldMatrix,A.position)):A.position.addInPlace(X._scaledDirection)}function uA(A,X){A._currentDragGradient=X._dragGradients[0],A._currentDrag1=A._currentDragGradient.getFactor(),X._dragGradients.length>1?A._currentDrag2=X._dragGradients[1].getFactor():A._currentDrag2=A._currentDrag1}function zA(A,X){B.GetCurrentGradient(X._ratio,X._dragGradients,((s,N,f)=>{s!==A._currentDragGradient&&(A._currentDrag1=A._currentDrag2,A._currentDrag2=N.getFactor(),A._currentDragGradient=s);const E=(0,i.l)(A._currentDrag1,A._currentDrag2,f);X._scaledDirection.scaleInPlace(1-E)}))}function mA(A,X){A._randomNoiseCoordinates1?(A._randomNoiseCoordinates1.gi(Math.random(),Math.random(),Math.random()),A._randomNoiseCoordinates2.gi(Math.random(),Math.random(),Math.random())):(A._randomNoiseCoordinates1=new N.k(Math.random(),Math.random(),Math.random()),A._randomNoiseCoordinates2=new N.k(Math.random(),Math.random(),Math.random()))}function bA(A,X){const s=X._noiseTextureData,f=X._noiseTextureSize;if(s&&f&&A._randomNoiseCoordinates1){const E=X._fetchR(A._randomNoiseCoordinates1.x,A._randomNoiseCoordinates1.y,f.width,f.height,s),g=X._fetchR(A._randomNoiseCoordinates1.z,A._randomNoiseCoordinates2.x,f.width,f.height,s),K=X._fetchR(A._randomNoiseCoordinates2.y,A._randomNoiseCoordinates2.z,f.width,f.height,s),r=N.f.oi[0],i=N.f.oi[1];r.gi((2*E-1)*X.noiseStrength.x,(2*g-1)*X.noiseStrength.y,(2*K-1)*X.noiseStrength.z),r.scaleToRef(X._tempScaledUpdateSpeed,i),A.direction.addInPlace(i)}}function yA(A,X){X.gravity.scaleToRef(X._tempScaledUpdateSpeed,X._scaledGravity),A.direction.addInPlace(X._scaledGravity)}function jA(A,X){A.size=(0,i.r)(X.minSize,X.maxSize),A.scale.gi((0,i.r)(X.minScaleX,X.maxScaleX),(0,i.r)(X.minScaleY,X.maxScaleY))}function GA(A,X){A._currentSizeGradient=X._sizeGradients[0],A._currentSize1=A._currentSizeGradient.getFactor(),A.size=A._currentSize1,X._sizeGradients.length>1?A._currentSize2=X._sizeGradients[1].getFactor():A._currentSize2=A._currentSize1,A.scale.gi((0,i.r)(X.minScaleX,X.maxScaleX),(0,i.r)(X.minScaleY,X.maxScaleY))}function VA(A,X){const s=X._actualFrame/X.targetStopDuration;B.GetCurrentGradient(s,X._startSizeGradients,((s,N,f)=>{s!==X._currentStartSizeGradient&&(X._currentStartSize1=X._currentStartSize2,X._currentStartSize2=N.getFactor(),X._currentStartSizeGradient=s);const E=(0,i.l)(X._currentStartSize1,X._currentStartSize2,f);A.scale.scaleInPlace(E)}))}function DA(A,X){B.GetCurrentGradient(X._ratio,X._sizeGradients,((X,s,N)=>{X!==A._currentSizeGradient&&(A._currentSize1=A._currentSize2,A._currentSize2=s.getFactor(),A._currentSizeGradient=X),A.size=(0,i.l)(A._currentSize1,A._currentSize2,N)}))}function OA(A,X){A.remapData=new N.m(0,1,0,1)}function PA(A,X){X._colorRemapGradients&&X._colorRemapGradients.length>0&&B.GetCurrentGradient(X._ratio,X._colorRemapGradients,((X,s,N)=>{const f=(0,i.l)(X.factor1,s.factor1,N),E=(0,i.l)(X.factor2,s.factor2,N);A.remapData.x=f,A.remapData.y=E-f})),X._alphaRemapGradients&&X._alphaRemapGradients.length>0&&B.GetCurrentGradient(X._ratio,X._alphaRemapGradients,((X,s,N)=>{const f=(0,i.l)(X.factor1,s.factor1,N),E=(0,i.l)(X.factor2,s.factor2,N);A.remapData.z=f,A.remapData.w=E-f}))}function lA(A,X){const s=(0,i.c)(X._actualFrame/X.targetStopDuration);B.GetCurrentGradient(s,X._lifeTimeGradients,((X,N)=>{const f=X,E=N,g=f.getFactor(),K=E.getFactor(),r=(s-f.gradient)/(E.gradient-f.gradient);A.lifeTime=(0,i.l)(g,K,r)})),X._emitPower=(0,i.r)(X.minEmitPower,X.maxEmitPower)}function nA(A,X){A.lifeTime=(0,i.r)(X.minLifeTime,X.maxLifeTime),X._emitPower=(0,i.r)(X.minEmitPower,X.maxEmitPower)}function UA(A,X){0===X._emitPower?(A._initialDirection?A._initialDirection.p(A.direction):A._initialDirection=A.direction.clone(),A.direction.set(0,0,0)):(A._initialDirection=null,A.direction.scaleInPlace(X._emitPower)),A.direction.addInPlace(X._inheritedVelocityOffset)}function tA(A,X){A.angularSpeed=(0,i.r)(X.minAngularSpeed,X.maxAngularSpeed),A.angle=(0,i.r)(X.minInitialRotation,X.maxInitialRotation)}function eA(A,X){A._currentAngularSpeedGradient=X._angularSpeedGradients[0],A.angularSpeed=A._currentAngularSpeedGradient.getFactor(),A._currentAngularSpeed1=A.angularSpeed,X._angularSpeedGradients.length>1?A._currentAngularSpeed2=X._angularSpeedGradients[1].getFactor():A._currentAngularSpeed2=A._currentAngularSpeed1,A.angle=(0,i.r)(X.minInitialRotation,X.maxInitialRotation)}function TA(A,X){A._initialStartSpriteCellId=X.startSpriteCellID,A._initialEndSpriteCellId=X.endSpriteCellID,A._initialSpriteCellLoop=X.spriteCellLoop}function IA(A,X){A.previousItem=X.previousItem,A.nextItem=X,X.previousItem&&(X.previousItem.nextItem=A),X.previousItem=A}function LA(A,X){A.previousItem=X,A.nextItem=X.nextItem,X.nextItem&&(X.nextItem.previousItem=A),X.nextItem=A}function kA(A,X){let s=X;for(;s.nextItem;)s=s.nextItem;A.previousItem=s,A.nextItem=s.nextItem,s.nextItem=A}function xA(A){A.previousItem&&(A.previousItem.nextItem=A.nextItem),A.nextItem&&(A.nextItem.previousItem=A.previousItem)}class HA extends r{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(A){this._startDirectionFunction!==A&&(this._startDirectionFunction=A,this._directionProcessing.process=A?vA:YA)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(A){this._startPositionFunction!==A&&(this._startPositionFunction=A,this._positionCreation.process=A?CA:RA)}set onDispose(A){this._onDisposeObserver&&this.Ji.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ji.add(A)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(A){this._useRampGradients!==A&&(this._useRampGradients=A,this._resetEffect(),A?(this._rampCreation={process:OA,previousItem:null,nextItem:null},LA(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:PA,previousItem:null,nextItem:null},LA(this._remapGradientProcessing,this._gravityProcessing)):(xA(this._rampCreation),xA(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(A){this._isLocal!==A&&(this._isLocal=A,A?(this._isLocalCreation={process:JA,previousItem:null,nextItem:null},LA(this._isLocalCreation,this._positionCreation)):xA(this._isLocalCreation))}get particles(){return this.Ol}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(A){this._animationSheetEnabled!==A&&(this._animationSheetEnabled=A,A?(this._sheetCreation={process:TA,previousItem:null,nextItem:null},LA(this._sheetCreation,this._colorCreation)):xA(this._sheetCreation),this._reset())}getActiveCount(){return this.Ol.length}getClassName(){return"ej"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var A;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(A=this._customWrappers[X])||void 0===A?void 0:A.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[A]??this._customWrappers[0]}setCustomEffect(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new AA.c(this._engine),this._customWrappers[X].effect=A,this._customWrappers[X].drawContext&&(this._customWrappers[X].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(A){if(this.noiseTexture!==A){if(this._noiseTexture=A,!A)return xA(this._noiseCreation),void xA(this._noiseProcessing);this._noiseCreation={process:mA,previousItem:null,nextItem:null},LA(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:bA,previousItem:null,nextItem:null},LA(this._noiseProcessing,this._positionProcessing)}}constructor(A,X,s){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(A),this._emitterInverseWorldMatrix=N.c.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new N.k,this.Ji=new Z.b,this.onStoppedObservable=new Z.b,this.onStartedObservable=new Z.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ol=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new g.h(0,0,0,0),this._colorDiff=new g.h(0,0,0,0),this._scaledDirection=N.k.Zero(),this._scaledGravity=N.k.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=A=>{},this.recycleParticle=A=>{const X=this.Ol.pop();X!==A&&X.copyTo(A),this._stockParticles.push(X)},this._createParticle=()=>{let A;return 0!==this._stockParticles.length?(A=this._stockParticles.pop(),A._reset()):A=new h(this),this._prepareParticle(A),A},this.paused=!1,this._shadersLoaded=!1,this._capacity=X,this._epsilon=K,s&&"Scene"!==s.getClassName()?(this._engine=s,this.defaultProjectionMatrix=N.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=s||W.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ri.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:nA,previousItem:null,nextItem:null},this._positionCreation={process:RA,previousItem:null,nextItem:null},LA(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:YA,previousItem:null,nextItem:null},LA(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:UA,previousItem:null,nextItem:null},LA(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:jA,previousItem:null,nextItem:null},LA(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:tA,previousItem:null,nextItem:null},LA(this._angleCreation,this._sizeCreation),this._colorCreation={process:fA,previousItem:null,nextItem:null},LA(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,r||(this._colorProcessing={process:KA,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:iA,previousItem:null,nextItem:null},LA(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:wA,previousItem:null,nextItem:null},LA(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:aA,previousItem:null,nextItem:null},LA(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:yA,previousItem:null,nextItem:null},LA(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=E,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new AA.c(this._engine)},this._customWrappers[0].effect=f,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new v,this.updateFunction=A=>{var X;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(X=this.noiseTexture.getContent())||void 0===X||X.then((A=>{this._noiseTextureData=A})));const s=A===this.Ol;for(let N=0;N<A.length;N++){const X=A[N];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const f=X.age;if(X.age+=this._tempScaledUpdateSpeed,X.age>X.lifeTime){const A=X.age-f,s=X.lifeTime-f;this._tempScaledUpdateSpeed=s*this._tempScaledUpdateSpeed/A,X.age=X.lifeTime}this._ratio=X.age/X.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let E=this._updateQueueStart;for(;E;)E.process(X,this),E=E.nextItem;if(this._isAnimationSheetEnabled&&!r&&X.updateCellIndex(),X._inheritParticleInfoToSubEmitters(),X.age>=X.lifeTime){if(this._emitFromParticle(X),X._attachedSubEmitters){for(const A of X._attachedSubEmitters)A.particleSystem.disposeOnStop=!0,A.particleSystem.stop();X._attachedSubEmitters=null}this.recycleParticle(X),s&&N--}else;}}}serialize(A){throw new Error("Method not implemented.")}clone(A,X){throw new Error("Method not implemented.")}_addFactorGradient(A,X,s,N){const f=new p(X,s,N);A.push(f),A.sort(((A,X)=>A.gradient<X.gradient?-1:A.gradient>X.gradient?1:0))}_removeFactorGradient(A,X){if(!A)return;let s=0;for(const N of A){if(N.gradient===X){A.splice(s,1);break}s++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=lA:this._lifeTimeCreation.process=nA}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:VA,previousItem:null,nextItem:null},LA(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(xA(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(A){this.targetStopDuration!==A&&(this._targetStopDuration=A,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(A,X,s){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,A,X,s),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(A){return this._removeFactorGradient(this._lifeTimeGradients,A),this._syncLifeTimeCreation(),this}addSizeGradient(A,X,s){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=GA,this._sizeGradientProcessing={process:DA,previousItem:null,nextItem:null},IA(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,A,X,s),this}removeSizeGradient(A){var X;return this._removeFactorGradient(this._sizeGradients,A),0===(null===(X=this._sizeGradients)||void 0===X?void 0:X.length)&&(xA(this._sizeGradientProcessing),this._sizeCreation.process=jA),this}addColorRemapGradient(A,X,s){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,A,X,s),this}removeColorRemapGradient(A){return this._removeFactorGradient(this._colorRemapGradients,A),this}addAlphaRemapGradient(A,X,s){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,A,X,s),this}removeAlphaRemapGradient(A){return this._removeFactorGradient(this._alphaRemapGradients,A),this}addAngularSpeedGradient(A,X,s){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=eA,this._angularSpeedGradientProcessing={process:rA,previousItem:null,nextItem:null},IA(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,A,X,s),this}removeAngularSpeedGradient(A){var X;return this._removeFactorGradient(this._angularSpeedGradients,A),0===(null===(X=this._angularSpeedGradients)||void 0===X?void 0:X.length)&&(this._angleCreation.process=tA,xA(this._angularSpeedGradientProcessing)),this}addVelocityGradient(A,X,s){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:cA,previousItem:null,nextItem:null},LA(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:dA,previousItem:null,nextItem:null},IA(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,A,X,s),this}removeVelocityGradient(A){var X;return this._removeFactorGradient(this._velocityGradients,A),0===(null===(X=this._velocityGradients)||void 0===X?void 0:X.length)&&(xA(this._velocityCreation),xA(this._velocityGradientProcessing)),this}addLimitVelocityGradient(A,X,s){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:MA,previousItem:null,nextItem:null},LA(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:QA,previousItem:null,nextItem:null},LA(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,A,X,s),this}removeLimitVelocityGradient(A){var X;return this._removeFactorGradient(this._limitVelocityGradients,A),0===(null===(X=this._limitVelocityGradients)||void 0===X?void 0:X.length)&&(xA(this._limitVelocityCreation),xA(this._limitVelocityGradientProcessing)),this}addDragGradient(A,X,s){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:uA,previousItem:null,nextItem:null},IA(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:zA,previousItem:null,nextItem:null},IA(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,A,X,s),this}removeDragGradient(A){var X;return this._removeFactorGradient(this._dragGradients,A),0===(null===(X=this._dragGradients)||void 0===X?void 0:X.length)&&(xA(this._dragCreation),xA(this._dragGradientProcessing)),this}addEmitRateGradient(A,X,s){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,A,X,s),this}removeEmitRateGradient(A){return this._removeFactorGradient(this._emitRateGradients,A),this}addStartSizeGradient(A,X,s){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,A,X,s),this._syncStartSizeCreation(),this}removeStartSizeGradient(A){return this._removeFactorGradient(this._startSizeGradients,A),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const A=new Uint8Array(4*this._rawTextureWidth),X=g.l.Ui[0];for(let s=0;s<this._rawTextureWidth;s++){const N=s/this._rawTextureWidth;B.GetCurrentGradient(N,this._rampGradients,((N,f,E)=>{g.e.LerpToRef(N.color,f.color,E,X),A[4*s]=255*X.r,A[4*s+1]=255*X.g,A[4*s+2]=255*X.b,A[4*s+3]=255}))}this._rampGradientsTexture=o.d.CreateRGBATexture(A,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((A,X)=>A.gradient<X.gradient?-1:A.gradient>X.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(A,X){this._rampGradients||(this._rampGradients=[]);const s=new S(A,X);return this._rampGradients.push(s),this._syncRampGradientTexture(),this}removeRampGradient(A){return this._removeGradientAndTexture(A,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(A,X,s){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=EA,this._colorProcessing.process=gA);const N=new q(A,X,s);return this._colorGradients.push(N),this._colorGradients.sort(((A,X)=>A.gradient<X.gradient?-1:A.gradient>X.gradient?1:0)),this}removeColorGradient(A){if(!this._colorGradients)return this;let X=0;for(const s of this._colorGradients){if(s.gradient===A){this._colorGradients.splice(X,1);break}X++}return 0===this._colorGradients.length&&(this._colorCreation.process=fA,this._colorProcessing.process=KA),this}resetDrawCache(){if(this._drawWrappers){for(const A of this._drawWrappers)if(A)for(const X of A)null===X||void 0===X||X.dispose();this._drawWrappers=[]}}_fetchR(A,X,s,N,f){return f[4*(((A=.5*Math.abs(A)+.5)*s%s|0)+((X=.5*Math.abs(X)+.5)*N%N|0)*s)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const A=this._engine,X=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*X),this._vertexBuffer=new u.b(A,this._vertexData,!0,X);let s=0;const N=this._vertexBuffer.createVertexBuffer(u.e.PositionKind,s,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[u.e.PositionKind]=N,s+=3;const f=this._vertexBuffer.createVertexBuffer(u.e.ColorKind,s,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[u.e.ColorKind]=f,s+=4;const E=this._vertexBuffer.createVertexBuffer("angle",s,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=E,s+=1;const g=this._vertexBuffer.createVertexBuffer("size",s,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=g,s+=2,this._isAnimationSheetEnabled){const A=this._vertexBuffer.createVertexBuffer("cellIndex",s,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=A,s+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const A=this._vertexBuffer.createVertexBuffer("direction",s,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=A,s+=3}if(this._useRampGradients){const A=this._vertexBuffer.createVertexBuffer("remapData",s,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=A,s+=4}let K;if(this._useInstancing){const X=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new u.b(A,X,!1,2),K=this._spriteBuffer.createVertexBuffer("offset",0,2)}else K=this._vertexBuffer.createVertexBuffer("offset",s,2,this._vertexBufferSize,this._useInstancing),s+=2;this._vertexBuffers.offset=K,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const A=[],X=[];let s=0;for(let N=0;N<this._capacity;N++)A.push(s),A.push(s+1),A.push(s+2),A.push(s),A.push(s+2),A.push(s+3),X.push(s,s+1,s+1,s+2,s+2,s+3,s+3,s,s,s+3),s+=4;this._indexBuffer=this._engine.createIndexBuffer(A),this._linesIndexBuffer=this._engine.createIndexBuffer(X)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(A)setTimeout((()=>{this.start(0)}),A);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var X;-1!==(null===(X=this.j)||void 0===X?void 0:X.getClassName().indexOf("Mesh"))&&this.j.si(!0);const A=this.noiseTexture;if(A&&A.onGeneratedObservable)A.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let X=0;X<this.preWarmCycles;X++)this.animate(!0),A.render()}))}));else for(let X=0;X<this.preWarmCycles;X++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(A))}_postStop(A){}reset(){this._stockParticles.length=0,this.Ol.length=0}_appendParticleVertex(A,X,s,f){let E=A*this._vertexBufferSize;if(this._vertexData[E++]=X.position.x+this.dg.x,this._vertexData[E++]=X.position.y+this.dg.y,this._vertexData[E++]=X.position.z+this.dg.z,this._vertexData[E++]=X.color.r,this._vertexData[E++]=X.color.g,this._vertexData[E++]=X.color.b,this._vertexData[E++]=X.color.a,this._vertexData[E++]=X.angle,this._vertexData[E++]=X.scale.x*X.size,this._vertexData[E++]=X.scale.y*X.size,this._isAnimationSheetEnabled&&(this._vertexData[E++]=X.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[E++]=X.direction.x,this._vertexData[E++]=X.direction.y,this._vertexData[E++]=X.direction.z);else if(X._initialDirection){let A=X._initialDirection;this.isLocal&&(N.k.TransformNormalToRef(A,this._emitterWorldMatrix,N.f.oi[0]),A=N.f.oi[0]),0===A.x&&0===A.z&&(A.x=.001),this._vertexData[E++]=A.x,this._vertexData[E++]=A.y,this._vertexData[E++]=A.z}else{let A=X.direction;this.isLocal&&(N.k.TransformNormalToRef(A,this._emitterWorldMatrix,N.f.oi[0]),A=N.f.oi[0]),0===A.x&&0===A.z&&(A.x=.001),this._vertexData[E++]=A.x,this._vertexData[E++]=A.y,this._vertexData[E++]=A.z}this._useRampGradients&&X.remapData&&(this._vertexData[E++]=X.remapData.x,this._vertexData[E++]=X.remapData.y,this._vertexData[E++]=X.remapData.z,this._vertexData[E++]=X.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===s?s=this._epsilon:1===s&&(s=1-this._epsilon),0===f?f=this._epsilon:1===f&&(f=1-this._epsilon)),this._vertexData[E++]=s,this._vertexData[E++]=f)}_prepareParticle(A){}_createNewOnes(A){let X;for(let s=0;s<A&&this.Ol.length!==this._capacity;s++){X=this._createParticle(),this.Ol.push(X);let A=this._createQueueStart;for(;A;)A.process(X,this),A=A.nextItem;X._inheritParticleInfoToSubEmitters()}}_update(A){if(this._alive=this.Ol.length>0,this.j.position){const A=this.j;this._emitterWorldMatrix=A.getWorldMatrix()}else{const A=this.j;this._emitterWorldMatrix=N.c.Translation(A.x,A.y,A.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ol),this._createNewOnes(A)}static _GetAttributeNamesOrOptions(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=[u.e.PositionKind,u.e.ColorKind,"angle","offset","size"];return A&&N.push("cellIndex"),X||N.push("direction"),s&&N.push("remapData"),N}static _GetEffectCreationOptions(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,XA.b)(N),A&&N.push("particlesInfos"),X&&N.push("logarithmicDepthConstant"),s&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(A,X){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,XA.j)(this,this._scene,A),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&A.push("#define FOG")),this._isAnimationSheetEnabled&&A.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&A.push("#define LOGARITHMICDEPTH"),X===r.BLENDMODE_MULTIPLY&&A.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&A.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(A.push("#define BILLBOARD"),this.billboardMode){case 2:A.push("#define BILLBOARDY");break;case 8:case 9:A.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&A.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:A.push("#define BILLBOARDMODE_ALL")}s&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),A.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(A,X,s){X.push(...HA._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),A.push(...HA._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),s.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,NA.f)(A,this._imageProcessingConfigurationDefines),(0,NA.d)(s,this._imageProcessingConfigurationDefines))}_getWrapper(A){const X=this._getCustomDrawWrapper(A);if(null!==X&&void 0!==X&&X.effect)return X;const s=[];this.fillDefines(s,A);const N=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let f=this._drawWrappers[N];f||(f=this._drawWrappers[N]=[]);let E=f[A];E||(E=new AA.c(this._engine),E.drawContext&&(E.drawContext.useInstancing=this._useInstancing),f[A]=E);const g=s.join("\n");if(E.defines!==g){const A=[],X=[],s=[];this.fillUniformsAttributesAndSamplerNames(X,A,s),E.setEffect(this._engine.createEffect("particles",A,X,s,g,void 0,void 0,void 0,void 0,this._shaderLanguage),g)}return E}animate(){var A;let X,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!s&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(s?this.preWarmStepOffset:(null===(A=this._scene)||void 0===A?void 0:A.getAnimationRatio())||1),this.manualEmitCount>-1)X=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let A=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const X=this._actualFrame/this.targetStopDuration;B.GetCurrentGradient(X,this._emitRateGradients,((X,s,N)=>{X!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=s.getFactor(),this._currentEmitRateGradient=X),A=(0,i.l)(this._currentEmitRate1,this._currentEmitRate2,N)}))}X=A*this._scaledUpdateSpeed|0,this._newPartsExcess+=A*this._scaledUpdateSpeed-X}if(this._newPartsExcess>1&&(X+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?X=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(X),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!s){let A=0;for(let X=0;X<this.Ol.length;X++){const s=this.Ol[X];this._appendParticleVertices(A,s),A+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ol.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(A,X){this._appendParticleVertex(A++,X,0,0),this._useInstancing||(this._appendParticleVertex(A++,X,1,0),this._appendParticleVertex(A++,X,1,1),this._appendParticleVertex(A++,X,0,1))}rebuild(){var A;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(A=this._spriteBuffer)||void 0===A||A._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!HA.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(s.bind(s,12407)),Promise.resolve().then(s.bind(s,12352))])):await Promise.all([Promise.resolve().then(s.bind(s,12348)),Promise.resolve().then(s.bind(s,12333))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==r.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(r.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(r.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(A){const X=this._getWrapper(A),s=X.effect,f=this._engine;f.enableEffect(X);const E=this.defaultViewMatrix??this._scene.getViewMatrix();if(s.setTexture("diffuseSampler",this.particleTexture),s.setMatrix("view",E),s.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const A=this.particleTexture.getBaseSize();s.setFloat3("particlesInfos",this.spriteCellWidth/A.width,this.spriteCellHeight/A.height,this.spriteCellWidth/A.width)}if(s.setVector2("translationPivot",this.translationPivot),s.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const A=this._scene.activeCamera;s.setVector3("eyePosition",A.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),s.setTexture("rampSampler",this._rampGradientsTexture));const g=s.defines;var K,r,i,Y,v,c;(this._scene&&((0,XA.c)(s,this,this._scene),this.applyFog&&(0,sA.i)(this._scene,void 0,s)),g.indexOf("#define BILLBOARDMODE_ALL")>=0&&(E.invertToRef(N.f.Matrix[0]),s.setMatrix("invView",N.f.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?f.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,s):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,s)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?f.bindBuffers(this._vertexBuffers,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBuffer:this._indexBuffer,s):f.bindBuffers(this._vertexBuffers,null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._linesIndexBufferUseInstancing:null,s);(this.useLogarithmicDepth&&this._scene&&(0,sA.p)(g,s,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(s),this._setEngineBasedOnBlendMode(A),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(s),this._useInstancing)?null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?f.drawElementsType(6,0,10,this.Ol.length):f.drawArraysType(7,0,4,this.Ol.length):null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?f.drawElementsType(1,0,10*this.Ol.length):f.drawElementsType(0,0,6*this.Ol.length);return this.Ol.length}render(){if(!this.isReady()||!this.Ol.length)return 0;const A=this._engine;A.setState&&(A.setState(!1),this.forceDepthWrite&&A.setDepthWrite(!0));let X=0;return X=this.blendMode===r.BLENDMODE_MULTIPLYADD?this._render(r.BLENDMODE_MULTIPLY)+this._render(r.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),X}_onDispose(){}dispose(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),A&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),A&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(X,s),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const A=this._scene.ri.indexOf(this);A>-1&&this._scene.ri.splice(A,1),this._scene._activeParticleSystems.dispose()}this.Ji.notifyObservers(this),this.Ji.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}HA.ForceGLSL=!1;var FA,qA=s(495);!function(A){A[A.ATTACHED=0]="ATTACHED",A[A.END=1]="END"}(FA||(FA={}));class SA{constructor(A){if(this.particleSystem=A,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!A.j||!A.j.dispose){const X=(0,K.d)("BABYLON.AbstractMesh");A.j=new X("SubemitterSystemEmitter",A.va()),A._disposeEmitterOnDispose=!0}}clone(){let A=this.particleSystem.j;if(A){if(A instanceof N.k)A=A.clone();else if(-1!==A.getClassName().indexOf("Mesh")){A=new((0,K.d)("BABYLON.Mesh"))("",A.va()),A.isVisible=!1}}else A=new N.k;const X=new SA(this.particleSystem.clone(this.particleSystem.name,A));return X.particleSystem.name+="Clone",X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem._disposeEmitterOnDispose=!0,X.particleSystem.disposeOnStop=!0,X}serialize(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem=this.particleSystem.serialize(A),X}static _ParseParticleSystem(A,X,s){throw(0,qA.e)("ParseParticle")}static Parse(A,X,s){const N=A.particleSystem,f=new SA(SA._ParseParticleSystem(N,X,s,!0));return f.type=A.type,f.inheritDirection=A.inheritDirection,f.inheritedVelocityAmount=A.inheritedVelocityAmount,f.particleSystem._isSubEmitter=!0,f}dispose(){this.particleSystem.dispose()}}var pA=s(547);function BA(A,X){const s=new R;return s.direction1=A,s.direction2=X,s}function ZA(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function oA(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function WA(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.k(0,1,0),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0);return new J(A,X,s)}function hA(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function AX(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.k(0,1,0);return new Q(A,X,s,f,E)}function XX(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new c(A,X)}function sX(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0),f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0);return new M(A,X,s,f)}const NX=N.k.Zero(),fX=N.k.Zero(),EX=N.k.Zero();class gX{constructor(){this.strength=0,this.position=N.k.Zero()}_processParticle(A,X){this.position.subtractToRef(A.position,NX);const s=NX.lengthSquared()+1;NX.normalize().scaleToRef(this.strength/s,fX),fX.scaleToRef(X._tempScaledUpdateSpeed,EX),A.direction.addInPlace(EX)}serialize(){return{position:this.position.zi(),strength:this.strength}}}class KX extends HA{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=A=>{if(!this._subEmitters||0===this._subEmitters.length)return;const X=Math.floor(Math.random()*this._subEmitters.length);for(const s of this._subEmitters[X])if(1===s.type){const X=s.clone();A._inheritParticleInfoToSubEmitter(X),X.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(X.particleSystem),X.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(A,X){const s=BA(A,X);return this.particleEmitterType=s,s}get flowMap(){return this._flowMap}set flowMap(A){this._flowMap!==A&&(this._flowMap=A,this._flowMapUpdate&&(xA(this._flowMapUpdate),this._flowMapUpdate=null),A&&(this._flowMapUpdate={process:A=>{var X;const s=null===(X=this.va())||void 0===X?void 0:X.getTransformMatrix();this._flowMap._processParticle(A,this.flowMapStrength*this._tempScaledUpdateSpeed,s)},previousItem:null,nextItem:null},LA(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(A){this._attractors.push(A),1===this._attractors.length&&(this._attractorUpdate={process:A=>{for(const X of this._attractors)X._processParticle(A,this)},previousItem:null,nextItem:null},LA(this._attractorUpdate,this._directionProcessing))}removeAttractor(A){const X=this._attractors.indexOf(A);-1!==X&&this._attractors.splice(X,1),0===this._attractors.length&&xA(this._attractorUpdate)}start(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(A)}createHemisphericEmitter(){const A=ZA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=A,A}createSphereEmitter(){const A=oA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=A,A}createDirectedSphereEmitter(){const A=WA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0));return this.particleEmitterType=A,A}createCylinderEmitter(){const A=hA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=A,A}createDirectedCylinderEmitter(){const A=AX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.k(0,1,0));return this.particleEmitterType=A,A}createConeEmitter(){const A=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=A,A}createDirectedConeEmitter(){const A=sX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0));return this.particleEmitterType=A,A}createBoxEmitter(A,X,s,N){const f=new v;return this.particleEmitterType=f,this.direction1=A,this.direction2=X,this.minEmitBox=s,this.maxEmitBox=N,f}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const A of this.subEmitters)A instanceof KX?this._subEmitters.push([new SA(A)]):A instanceof SA?this._subEmitters.push([A]):A instanceof Array&&this._subEmitters.push(A)}_stopSubEmitters(){if(this.activeSubSystems){for(const A of this.activeSubSystems)A.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const A=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==A&&this._rootParticleSystem.activeSubSystems.splice(A,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(A){A&&this._stopSubEmitters()}_prepareParticle(A){if(this._subEmitters&&this._subEmitters.length>0){const X=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];A._attachedSubEmitters=[];for(const s of X)if(0===s.type){const X=s.clone();A._attachedSubEmitters.push(X),X.particleSystem.start()}}}_onDispose(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),A&&this.particles)for(const s of this.particles)if(s._attachedSubEmitters)for(let A=s._attachedSubEmitters.length-1;A>=0;A-=1)s._attachedSubEmitters[A].dispose();if(X&&this.activeSubSystems)for(let s=this.activeSubSystems.length-1;s>=0;s-=1)this.activeSubSystems[s].dispose();if(this._subEmitters&&this._subEmitters.length){for(let A=0;A<this._subEmitters.length;A++)for(const X of this._subEmitters[A])X.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(A,X,s,f){let E;E=s instanceof pA.d?null:s;const r=(0,K.d)("BABYLON.Texture");if(r&&E&&(A.texture?X.particleTexture=r.Parse(A.texture,E,f):A.textureName&&(X.particleTexture=new r(f+A.textureName,E,!1,void 0===A.invertY||A.invertY),X.particleTexture.name=A.textureName)),A.emitterId||0===A.emitterId||void 0!==A.j?A.emitterId&&E?X.j=E.getLastMeshById(A.emitterId):X.j=N.k.mi(A.j):X.j=N.k.Zero(),X.isLocal=!!A.isLocal,void 0!==A.renderingGroupId&&(X.renderingGroupId=A.renderingGroupId),void 0!==A.isBillboardBased&&(X.isBillboardBased=A.isBillboardBased),void 0!==A.billboardMode&&(X.billboardMode=A.billboardMode),void 0!==A.useLogarithmicDepth&&(X.useLogarithmicDepth=A.useLogarithmicDepth),A.animations){for(let s=0;s<A.animations.length;s++){const N=A.animations[s],f=(0,K.d)("BABYLON.Animation");f&&X.animations.push(f.Parse(N))}X.beginAnimationOnStart=A.beginAnimationOnStart,X.beginAnimationFrom=A.beginAnimationFrom,X.beginAnimationTo=A.beginAnimationTo,X.beginAnimationLoop=A.beginAnimationLoop}if(A.autoAnimate&&E&&E.beginAnimation(X,A.autoAnimateFrom,A.autoAnimateTo,A.autoAnimateLoop,A.autoAnimateSpeed||1),X.startDelay=0|A.startDelay,X.minAngularSpeed=A.minAngularSpeed,X.maxAngularSpeed=A.maxAngularSpeed,X.minSize=A.minSize,X.maxSize=A.maxSize,A.minScaleX&&(X.minScaleX=A.minScaleX,X.maxScaleX=A.maxScaleX,X.minScaleY=A.minScaleY,X.maxScaleY=A.maxScaleY),void 0!==A.preWarmCycles&&(X.preWarmCycles=A.preWarmCycles,X.preWarmStepOffset=A.preWarmStepOffset),void 0!==A.minInitialRotation&&(X.minInitialRotation=A.minInitialRotation,X.maxInitialRotation=A.maxInitialRotation),X.minLifeTime=A.minLifeTime,X.maxLifeTime=A.maxLifeTime,X.minEmitPower=A.minEmitPower,X.maxEmitPower=A.maxEmitPower,X.emitRate=A.emitRate,X.gravity=N.k.mi(A.gravity),A.noiseStrength&&(X.noiseStrength=N.k.mi(A.noiseStrength)),X.color1=g.h.mi(A.color1),X.color2=g.h.mi(A.color2),X.colorDead=g.h.mi(A.colorDead),X.updateSpeed=A.updateSpeed,X.targetStopDuration=A.targetStopDuration,X.blendMode=A.blendMode,A.colorGradients)for(const N of A.colorGradients)X.addColorGradient(N.gradient,g.h.mi(N.color1),N.color2?g.h.mi(N.color2):void 0);if(A.rampGradients){for(const s of A.rampGradients)X.addRampGradient(s.gradient,g.e.mi(s.color));X.useRampGradients=A.useRampGradients}if(A.colorRemapGradients)for(const N of A.colorRemapGradients)X.addColorRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.alphaRemapGradients)for(const N of A.alphaRemapGradients)X.addAlphaRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.sizeGradients)for(const N of A.sizeGradients)X.addSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.angularSpeedGradients)for(const N of A.angularSpeedGradients)X.addAngularSpeedGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.velocityGradients)for(const N of A.velocityGradients)X.addVelocityGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.dragGradients)for(const N of A.dragGradients)X.addDragGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.emitRateGradients)for(const N of A.emitRateGradients)X.addEmitRateGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.startSizeGradients)for(const N of A.startSizeGradients)X.addStartSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.lifeTimeGradients)for(const N of A.lifeTimeGradients)X.addLifeTimeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(A.limitVelocityGradients){for(const s of A.limitVelocityGradients)X.addLimitVelocityGradient(s.gradient,void 0!==s.factor1?s.factor1:s.factor,s.factor2);X.limitVelocityDamping=A.limitVelocityDamping}if(A.noiseTexture&&E){const s=(0,K.d)("BABYLON.ProceduralTexture");X.noiseTexture=s.Parse(A.noiseTexture,E,f)}let i;if(A.particleEmitterType){switch(A.particleEmitterType.type){case"SphereParticleEmitter":i=new C;break;case"SphereDirectedParticleEmitter":i=new J;break;case"ConeEmitter":case"ConeParticleEmitter":i=new c;break;case"ConeDirectedParticleEmitter":i=new M;break;case"CylinderParticleEmitter":i=new d;break;case"CylinderDirectedParticleEmitter":i=new Q;break;case"HemisphericParticleEmitter":i=new w;break;case"PointParticleEmitter":i=new R;break;case"MeshParticleEmitter":i=new z;break;case"CustomParticleEmitter":i=new a;break;default:i=new v}i.parse(A.particleEmitterType,E)}else i=new v,i.parse(A,E);X.particleEmitterType=i,X.startSpriteCellID=A.startSpriteCellID,X.endSpriteCellID=A.endSpriteCellID,X.spriteCellLoop=A.spriteCellLoop??!0,X.spriteCellWidth=A.spriteCellWidth,X.spriteCellHeight=A.spriteCellHeight,X.spriteCellChangeSpeed=A.spriteCellChangeSpeed,X.spriteRandomStartCell=A.spriteRandomStartCell,X.disposeOnStop=A.disposeOnStop??!1,X.manualEmitCount=A.manualEmitCount??-1}static Parse(A,X,s){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const K=A.name;let r,i,Y=null,v=null;if(X instanceof pA.d?r=X:(i=X,r=i.getEngine()),A.customShader&&r.createEffectForParticles){v=A.customShader;const X=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"";Y=r.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,X)}const c=new KX(K,E||A.Yh,X,Y,A.isAnimationSheetEnabled);if(c.customShader=v,c._rootUrl=s,A.id&&(c.id=A.id),A.subEmitters){c.subEmitters=[];for(const N of A.subEmitters){const A=[];for(const f of N)A.push(SA.Parse(f,X,s));c.subEmitters.push(A)}}if(A.attractors)for(const g of A.attractors){const A=new gX;A.position=N.k.mi(g.position),A.strength=g.strength,c.addAttractor(A)}return KX._Parse(A,c,X,s),A.textureMask&&(c.textureMask=g.h.mi(A.textureMask)),A.dg&&(c.dg=N.k.mi(A.dg)),A.preventAutoStart&&(c.preventAutoStart=A.preventAutoStart),f||c.preventAutoStart||c.start(),c}serialize(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};if(KX._Serialize(X,this,A),X.textureMask=this.textureMask.zi(),X.customShader=this.customShader,X.preventAutoStart=this.preventAutoStart,X.dg=this.dg.zi(),this.subEmitters){X.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const s of this._subEmitters){const N=[];for(const X of s)N.push(X.serialize(A));X.subEmitters.push(N)}}if(this._attractors&&this._attractors.length){X.attractors=[];for(const A of this._attractors)X.attractors.push(A.serialize())}return X}static _Serialize(A,X,s){if(A.name=X.name,A.id=X.id,A.Yh=X.getCapacity(),A.disposeOnStop=X.disposeOnStop,A.manualEmitCount=X.manualEmitCount,X.j.position){const s=X.j;A.emitterId=s.id}else{const s=X.j;A.j=s.zi()}X.particleEmitterType&&(A.particleEmitterType=X.particleEmitterType.serialize()),X.particleTexture&&(s?A.texture=X.particleTexture.serialize():(A.textureName=X.particleTexture.name,A.invertY=!!X.particleTexture._invertY)),A.isLocal=X.isLocal,l.c.AppendSerializedAnimations(X,A),A.beginAnimationOnStart=X.beginAnimationOnStart,A.beginAnimationFrom=X.beginAnimationFrom,A.beginAnimationTo=X.beginAnimationTo,A.beginAnimationLoop=X.beginAnimationLoop,A.startDelay=X.startDelay,A.renderingGroupId=X.renderingGroupId,A.isBillboardBased=X.isBillboardBased,A.billboardMode=X.billboardMode,A.minAngularSpeed=X.minAngularSpeed,A.maxAngularSpeed=X.maxAngularSpeed,A.minSize=X.minSize,A.maxSize=X.maxSize,A.minScaleX=X.minScaleX,A.maxScaleX=X.maxScaleX,A.minScaleY=X.minScaleY,A.maxScaleY=X.maxScaleY,A.minEmitPower=X.minEmitPower,A.maxEmitPower=X.maxEmitPower,A.minLifeTime=X.minLifeTime,A.maxLifeTime=X.maxLifeTime,A.emitRate=X.emitRate,A.gravity=X.gravity.zi(),A.noiseStrength=X.noiseStrength.zi(),A.color1=X.color1.zi(),A.color2=X.color2.zi(),A.colorDead=X.colorDead.zi(),A.updateSpeed=X.updateSpeed,A.targetStopDuration=X.targetStopDuration,A.blendMode=X.blendMode,A.preWarmCycles=X.preWarmCycles,A.preWarmStepOffset=X.preWarmStepOffset,A.minInitialRotation=X.minInitialRotation,A.maxInitialRotation=X.maxInitialRotation,A.startSpriteCellID=X.startSpriteCellID,A.spriteCellLoop=X.spriteCellLoop,A.endSpriteCellID=X.endSpriteCellID,A.spriteCellChangeSpeed=X.spriteCellChangeSpeed,A.spriteCellWidth=X.spriteCellWidth,A.spriteCellHeight=X.spriteCellHeight,A.spriteRandomStartCell=X.spriteRandomStartCell,A.isAnimationSheetEnabled=X.isAnimationSheetEnabled,A.useLogarithmicDepth=X.useLogarithmicDepth;const N=X.getColorGradients();if(N){A.colorGradients=[];for(const X of N){const s={gradient:X.gradient,color1:X.color1.zi()};X.color2?s.color2=X.color2.zi():s.color2=X.color1.zi(),A.colorGradients.push(s)}}const f=X.getRampGradients();if(f){A.rampGradients=[];for(const X of f){const s={gradient:X.gradient,color:X.color.zi()};A.rampGradients.push(s)}A.useRampGradients=X.useRampGradients}const E=X.getColorRemapGradients();if(E){A.colorRemapGradients=[];for(const X of E){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.colorRemapGradients.push(s)}}const g=X.getAlphaRemapGradients();if(g){A.alphaRemapGradients=[];for(const X of g){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.alphaRemapGradients.push(s)}}const K=X.getSizeGradients();if(K){A.sizeGradients=[];for(const X of K){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.sizeGradients.push(s)}}const r=X.getAngularSpeedGradients();if(r){A.angularSpeedGradients=[];for(const X of r){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.angularSpeedGradients.push(s)}}const i=X.getVelocityGradients();if(i){A.velocityGradients=[];for(const X of i){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.velocityGradients.push(s)}}const Y=X.getDragGradients();if(Y){A.dragGradients=[];for(const X of Y){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.dragGradients.push(s)}}const v=X.getEmitRateGradients();if(v){A.emitRateGradients=[];for(const X of v){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.emitRateGradients.push(s)}}const c=X.getStartSizeGradients();if(c){A.startSizeGradients=[];for(const X of c){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.startSizeGradients.push(s)}}const M=X.getLifeTimeGradients();if(M){A.lifeTimeGradients=[];for(const X of M){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.lifeTimeGradients.push(s)}}const d=X.getLimitVelocityGradients();if(d){A.limitVelocityGradients=[];for(const X of d){const s={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?s.factor2=X.factor2:s.factor2=X.factor1,A.limitVelocityGradients.push(s)}A.limitVelocityDamping=X.limitVelocityDamping}X.noiseTexture&&(A.noiseTexture=X.noiseTexture.serialize())}clone(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let f=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){f=this.customShader;const A=f.shaderOptions.defines.length>0?f.shaderOptions.defines.join("\n"):"",X=E.createEffectForParticles(f.shaderPath.fragmentElement,f.shaderOptions.uniforms,f.shaderOptions.samplers,A);N[0]?N[0].effect=X:this.setCustomEffect(X,0)}const g=this.serialize(s),K=KX.Parse(g,this._scene||this._engine,this._rootUrl);return K.name=A,K.customShader=f,K._customWrappers=N,void 0===X&&(X=this.j),this.noiseTexture&&(K.noiseTexture=this.noiseTexture.clone()),K.j=X,this.preventAutoStart||K.start(),K}}KX.BILLBOARDMODE_Y=2,KX.BILLBOARDMODE_ALL=7,KX.BILLBOARDMODE_STRETCHED=8,KX.BILLBOARDMODE_STRETCHED_LOCAL=9,SA._ParseParticleSystem=KX.Parse;var rX=s(2426),iX=s(2418),YX=s(2331);YX.e.prototype.createTransformFeedback=function(){const A=this._gl.createTransformFeedback();if(!A)throw new Error("Unable to create Transform Feedback");return A},YX.e.prototype.deleteTransformFeedback=function(A){this._gl.deleteTransformFeedback(A)},YX.e.prototype.bindTransformFeedback=function(A){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,A)},YX.e.prototype.beginTransformFeedback=function(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(A?this._gl.POINTS:this._gl.TRIANGLES)},YX.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},YX.e.prototype.setTranformFeedbackVaryings=function(A,X){this._gl.transformFeedbackVaryings(A,X,this._gl.INTERLEAVED_ATTRIBS)},YX.e.prototype.bindTransformFeedbackBuffer=function(A){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,A?A.underlyingResource:null)},YX.e.prototype.readTransformFeedbackBuffer=function(A){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,A)};const vX="clipPlaneFragmentDeclaration2",cX="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";b.b.IncludesShadersStore[vX]||(b.b.IncludesShadersStore[vX]=cX);s(12250),s(12255),s(12262),s(12266),s(12273),s(12281),s(12286),s(12290);const MX="gpuRenderParticlesPixelShader",dX="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";b.b.ShadersStore[MX]||(b.b.ShadersStore[MX]=dX);const QX="clipPlaneVertexDeclaration2",wX="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";b.b.IncludesShadersStore[QX]||(b.b.IncludesShadersStore[QX]=wX);s(12292),s(12295),s(12302),s(12307);const RX="gpuRenderParticlesVertexShader",CX="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";b.b.ShadersStore[RX]||(b.b.ShadersStore[RX]=CX);class JX extends r{static get IsSupported(){if(!W.b.LastCreatedEngine)return!1;const A=W.b.LastCreatedEngine.getCaps();return A.supportTransformFeedbacks||A.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(A){this._maxActiveParticleCount=Math.min(A,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(A){this.maxActiveParticleCount=A}createPointEmitter(A,X){const s=BA(A,X);return this.particleEmitterType=s,s}createHemisphericEmitter(){const A=ZA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=A,A}createSphereEmitter(){const A=oA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=A,A}createDirectedSphereEmitter(){const A=WA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0));return this.particleEmitterType=A,A}createCylinderEmitter(){const A=hA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=A,A}createDirectedCylinderEmitter(){const A=AX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.k(0,1,0));return this.particleEmitterType=A,A}createConeEmitter(){const A=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=A,A}createDirectedConeEmitter(){const A=sX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.k(0,1,0));return this.particleEmitterType=A,A}createBoxEmitter(A,X,s,N){const f=new v;return this.particleEmitterType=f,this.direction1=A,this.direction2=X,this.minEmitBox=s,this.maxEmitBox=N,f}get flowMap(){return this._flowMap}set flowMap(A){this._flowMap!==A&&(this._flowMap=A)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==KX.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(KX.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(KX.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";A?setTimeout((()=>{this.start(0)}),A):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var A;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(A=this._customWrappers[X])||void 0===A?void 0:A.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[A]??this._customWrappers[0]}setCustomEffect(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new AA.c(this._engine),this._customWrappers[X].effect=A}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Z.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(A,X,s){return super._removeGradientAndTexture(A,X,s),this._releaseBuffers(),this}addColorGradient(A,X){this._colorGradients||(this._colorGradients=[]);const s=new q(A,X);return this._colorGradients.push(s),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(A&&this._colorGradients.sort(((A,X)=>A.gradient<X.gradient?-1:A.gradient>X.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(A){return this._removeGradientAndTexture(A,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const X in this._drawWrappers){var A;null===(A=this._drawWrappers[X].drawContext)||void 0===A||A.reset()}}_addFactorGradient(A,X,s){const N=new p(X,s);A.push(N),this._releaseBuffers()}addSizeGradient(A,X){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,A,X),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(A){return this._removeGradientAndTexture(A,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(A,X){if(!A)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&A.sort(((A,X)=>A.gradient<X.gradient?-1:A.gradient>X.gradient?1:0));const s=this;s[X]&&(s[X].dispose(),s[X]=null)}addAngularSpeedGradient(A,X){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,A,X),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(A){return this._removeGradientAndTexture(A,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(A,X){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,A,X),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(A){return this._removeGradientAndTexture(A,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(A,X){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,A,X),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(A){return this._removeGradientAndTexture(A,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(A,X){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,A,X),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(A){return this._removeGradientAndTexture(A,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(A){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(A,X,s){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(A),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ji=new Z.b,this.onStoppedObservable=new Z.b,this.onStartedObservable=new Z.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,s&&"Scene"!==s.getClassName()?(this._engine=s,this.defaultProjectionMatrix=N.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=s||W.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ri.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,K.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,K.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,K.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,K.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new AA.c(this._engine)},this._customWrappers[0].effect=f,this._drawWrappers={0:new AA.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(X=X??{}).randomTextureSize||delete X.randomTextureSize;const g={Yh:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...X},r=X;isFinite(r)&&(g.Yh=r),this._capacity=g.Yh,this._maxActiveParticleCount=g.Yh,this._currentActiveCount=0,this._isAnimationSheetEnabled=E,this.particleEmitterType=new v;const i=Math.min(this._engine.getCaps().maxTextureSize,g.randomTextureSize);let Y=[];for(let N=0;N<i;++N)Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random());this._randomTexture=new o.d(new Float32Array(Y),i,1,5,s,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,Y=[];for(let N=0;N<i;++N)Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random());this._randomTexture2=new o.d(new Float32Array(Y),i,1,5,s,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=i}_reset(){this._releaseBuffers()}_createVertexBuffers(A,X,s){const N={};N.position=X.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let f=3;N.age=X.createVertexBuffer("age",f,1,this._attributesStrideSize,!0),f+=1,N.size=X.createVertexBuffer("size",f,3,this._attributesStrideSize,!0),f+=3,N.life=X.createVertexBuffer("life",f,1,this._attributesStrideSize,!0),f+=1,f+=4,this.billboardMode===KX.BILLBOARDMODE_STRETCHED&&(N.direction=X.createVertexBuffer("direction",f,3,this._attributesStrideSize,!0)),f+=3,this._platform.alignDataInBuffer&&(f+=1),this.particleEmitterType instanceof a&&(f+=3,this._platform.alignDataInBuffer&&(f+=1)),this._colorGradientsTexture||(N.color=X.createVertexBuffer("color",f,4,this._attributesStrideSize,!0),f+=4),this._isBillboardBased||(N.initialDirection=X.createVertexBuffer("initialDirection",f,3,this._attributesStrideSize,!0),f+=3,this._platform.alignDataInBuffer&&(f+=1)),this.noiseTexture&&(N.noiseCoordinates1=X.createVertexBuffer("noiseCoordinates1",f,3,this._attributesStrideSize,!0),f+=3,this._platform.alignDataInBuffer&&(f+=1),N.noiseCoordinates2=X.createVertexBuffer("noiseCoordinates2",f,3,this._attributesStrideSize,!0),f+=3,this._platform.alignDataInBuffer&&(f+=1)),N.angle=X.createVertexBuffer("angle",f,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?f++:f+=2,this._isAnimationSheetEnabled&&(N.cellIndex=X.createVertexBuffer("cellIndex",f,1,this._attributesStrideSize,!0),f+=1,this.spriteRandomStartCell&&(N.cellStartOffset=X.createVertexBuffer("cellStartOffset",f,1,this._attributesStrideSize,!0),f+=1)),N.offset=s.createVertexBuffer("offset",0,2),N.uv=s.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(N),this._platform.createVertexBuffers(A,N),this.resetDrawCache()}_initialize(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!A)return;const X=this._engine,s=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof a&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const f=this.particleEmitterType instanceof a,E=N.f.oi[0];let g=0;for(let N=0;N<this._capacity;N++)if(s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(0),s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),f?(this.particleEmitterType.particleDestinationGenerator(N,null,E),s.push(E.x),s.push(E.y),s.push(E.z)):(s.push(0),s.push(0),s.push(0)),this._platform.alignDataInBuffer&&s.push(0),g+=16,f&&(this.particleEmitterType.particlePositionGenerator(N,null,E),s.push(E.x),s.push(E.y),s.push(E.z),this._platform.alignDataInBuffer&&s.push(0),g+=4),this._colorGradientsTexture||(s.push(0),s.push(0),s.push(0),s.push(0),g+=4),this.isBillboardBased||(s.push(0),s.push(0),s.push(0),this._platform.alignDataInBuffer&&s.push(0),g+=4),this.noiseTexture&&(s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),this._platform.alignDataInBuffer&&s.push(0),s.push(Math.random()),s.push(Math.random()),s.push(Math.random()),this._platform.alignDataInBuffer&&s.push(0),g+=8),s.push(0),g+=1,this._angularSpeedGradientsTexture||(s.push(0),g+=1),this._isAnimationSheetEnabled&&(s.push(0),g+=1,this.spriteRandomStartCell&&(s.push(0),g+=1)),this._platform.alignDataInBuffer){let A=3-(g+3&3);for(g+=A;A-- >0;)s.push(0)}const K=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),r=this._platform.createParticleBuffer(s),i=this._platform.createParticleBuffer(s);this._buffer0=new u.b(X,r,!1,this._attributesStrideSize),this._buffer1=new u.b(X,i,!1,this._attributesStrideSize),this._spriteBuffer=new u.b(X,K,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let A=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(A+="\n#define BILLBOARD"),this._colorGradientsTexture&&(A+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(A+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(A+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(A+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(A+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(A+="\n#define DRAGGRADIENTS"),this._flowMap&&(A+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(A+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(A+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(A+="\n#define NOISE"),this.isLocal&&(A+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===A||(this._cachedUpdateDefines=A,this._updateBuffer=this._platform.createUpdateBuffer(A)),this._platform.isUpdateBufferReady()}_getWrapper(A){const X=this._getCustomDrawWrapper(A);if(null!==X&&void 0!==X&&X.effect)return X;const s=[];this.fillDefines(s,A);let N=this._drawWrappers[A];N||(N=new AA.c(this._engine),N.drawContext&&(N.drawContext.useInstancing=!0),this._drawWrappers[A]=N);const f=s.join("\n");if(N.defines!==f){const A=[],X=[],s=[];this.fillUniformsAttributesAndSamplerNames(X,A,s),N.setEffect(this._engine.createEffect("gpuRenderParticles",A,X,s,f),f)}return N}static _GetAttributeNamesOrOptions(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const f=[u.e.PositionKind,"age","life","size","angle"];return A||f.push(u.e.ColorKind),X&&f.push("cellIndex"),s||f.push("initialDirection"),N&&f.push("direction"),f.push("offset",u.e.UVKind),f}static _GetEffectCreationOptions(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["emitterWM","dg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,XA.b)(N),A&&N.push("sheetInfos"),X&&N.push("logarithmicDepthConstant"),s&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,XA.j)(this,this._scene,A),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==iX.d.FOGMODE_NONE&&A.push("#define FOG")),X===KX.BLENDMODE_MULTIPLY&&A.push("#define BLENDMULTIPLYMODE"),this.isLocal&&A.push("#define LOCAL"),this.useLogarithmicDepth&&A.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(A.push("#define BILLBOARD"),this.billboardMode){case KX.BILLBOARDMODE_Y:A.push("#define BILLBOARDY");break;case KX.BILLBOARDMODE_STRETCHED:A.push("#define BILLBOARDSTRETCHED");break;case KX.BILLBOARDMODE_ALL:A.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&A.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&A.push("#define ANIMATESHEET"),s&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),A.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(A,X,s){X.push(...JX._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===KX.BILLBOARDMODE_STRETCHED)),A.push(...JX._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),s.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(rX.e.PrepareUniforms(A,this._imageProcessingConfigurationDefines),rX.e.PrepareSamplers(s,this._imageProcessingConfigurationDefines))}animate(){var A;let X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(X?this.preWarmStepOffset:(null===(A=this._scene)||void 0===A?void 0:A.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(A,X){const s=this[X];if(!A||!A.length||s)return;const N=new Float32Array(this._rawTextureWidth);for(let f=0;f<this._rawTextureWidth;f++){const X=f/this._rawTextureWidth;B.GetCurrentGradient(X,A,((A,X,s)=>{N[f]=(0,i.l)(A.factor1,X.factor1,s)}))}this[X]=o.d.CreateRTexture(N,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[X].name=X.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const A=new Uint8Array(4*this._rawTextureWidth),X=g.l.Vi[0];for(let s=0;s<this._rawTextureWidth;s++){const N=s/this._rawTextureWidth;B.GetCurrentGradient(N,this._colorGradients,((N,f,E)=>{g.h.LerpToRef(N.color1,f.color1,E,X),A[4*s]=255*X.r,A[4*s+1]=255*X.g,A[4*s+2]=255*X.b,A[4*s+3]=255*X.a}))}this._colorGradientsTexture=o.d.CreateRGBATexture(A,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(A,X){var s,f,E,g;const K=this._getWrapper(A),r=K.effect;this._engine.enableEffect(K);const i=(null===(s=this._scene)||void 0===s?void 0:s.getViewMatrix())||N.c.IdentityReadOnly;if(r.setMatrix("view",i),r.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),r.setTexture("diffuseSampler",this.particleTexture),r.setVector2("translationPivot",this.translationPivot),r.setVector3("dg",this.dg),this.isLocal&&r.setMatrix("emitterWM",X),this._colorGradientsTexture?r.setTexture("colorGradientSampler",this._colorGradientsTexture):r.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const A=this.particleTexture.getBaseSize();r.setFloat3("sheetInfos",this.spriteCellWidth/A.width,this.spriteCellHeight/A.height,A.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const A=this._scene.activeCamera;r.setVector3("eyePosition",A.globalPosition)}const Y=r.defines;if(this._scene&&((0,XA.c)(r,this,this._scene),this.applyFog&&(0,sA.i)(this._scene,void 0,r)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0){const A=i.clone();A.invert(),r.setMatrix("invView",A)}return this.useLogarithmicDepth&&this._scene&&(0,sA.p)(Y,r,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(r),this._setEngineBasedOnBlendMode(A),this._platform.bindDrawBuffers(this._targetIndex,r,null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(r),null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(A){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!A)if(this.j.position){A=this.j.getWorldMatrix()}else{const X=this.j;A=N.f.Matrix[0],N.c.TranslationToRef(X.x,X.y,X.z,A)}const X=this._engine,s=X.getDepthWrite();if(X.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const A=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",A.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",A),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const f=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=f,X.setDepthWrite(s)}render(){let A,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!X&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let A=0;A<this.preWarmCycles;A++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const A=0|this._accumulatedCount;this._accumulatedCount-=A,this._currentActiveCount+=A}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){A=this.j.getWorldMatrix()}else{const X=this.j;A=N.f.Matrix[0],N.c.TranslationToRef(X.x,X.y,X.z,A)}const f=this._engine;this.updateInAnimate||this._update(A);let E=0;return X||s||(f.setState(!1),this.forceDepthWrite&&f.setDepthWrite(!0),E=this.blendMode===KX.BLENDMODE_MULTIPLYADD?this._render(KX.BLENDMODE_MULTIPLY,A)+this._render(KX.BLENDMODE_ADD,A):this._render(this.blendMode,A),this._engine.setAlphaMode(0)),E}rebuild(){const A=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(A,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,A()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const X in this._drawWrappers){this._drawWrappers[X].dispose()}if(this._drawWrappers={},this._scene){const A=this._scene.ri.indexOf(this);A>-1&&this._scene.ri.splice(A,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let X=0;X<this._renderVertexBuffers.length;++X){const A=this._renderVertexBuffers[X];for(const X in A)A[X].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),A&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),A&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ji.notifyObservers(this),this.Ji.clear()}clone(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let f=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){f=this.customShader;const A=f.shaderOptions.defines.length>0?f.shaderOptions.defines.join("\n"):"";N[0]=E.createEffectForParticles(f.shaderPath.fragmentElement,f.shaderOptions.uniforms,f.shaderOptions.samplers,A,void 0,void 0,void 0,this)}const g=this.serialize(s),K=JX.Parse(g,this._scene||this._engine,this._rootUrl);return K.name=A,K.customShader=f,K._customWrappers=N,void 0===X&&(X=this.j),this.noiseTexture&&(K.noiseTexture=this.noiseTexture.clone()),K.j=X,K}serialize(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return KX._Serialize(X,this,A),X.activeParticleCount=this.activeParticleCount,X.randomTextureSize=this._randomTextureSize,X.customShader=this.customShader,X}static Parse(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4?arguments[4]:void 0;const E=A.name;let g,K;X instanceof pA.d?g=X:(K=X,g=K.getEngine());const r=new JX(E,{Yh:f||A.Yh,randomTextureSize:A.randomTextureSize},X,null,A.isAnimationSheetEnabled);if(r._rootUrl=s,A.customShader&&g.createEffectForParticles){const X=A.customShader,s=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",N=g.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,s,void 0,void 0,void 0,r);r.setCustomEffect(N,0),r.customShader=X}return A.id&&(r.id=A.id),A.activeParticleCount&&(r.activeParticleCount=A.activeParticleCount),KX._Parse(A,r,X,s),A.preventAutoStart&&(r.preventAutoStart=A.preventAutoStart),N||r.preventAutoStart||r.start(),r}}var aX=s(456),uX=s(12315),zX=s(12116);class mX{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(A){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const X of this.systems)X.j=A;this._emitterNode=A}setEmitterAsSphere(A,X,s){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:A,renderingGroupId:X};const N=(0,uX.b)("emitterSphere",{diameter:A.diameter,segments:A.segments},s);N.renderingGroupId=X;const f=new zX.e("emitterSphereMaterial",s);f.emissiveColor=A.color,N.material=f;for(const E of this.systems)E.j=N;this._emitterNode=N}start(A){for(const X of this.systems)A&&(X.j=A),X.start()}dispose(){for(const A of this.systems)A.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={systems:[]};for(const s of this.systems)X.systems.push(s.serialize(A));return this._emitterNode&&(X.j=this._emitterCreationOptions),X}static Parse(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;const f=new mX,E=this.BaseAssetsUrl+"/textures/";X=X||W.b.LastCreatedScene;for(const g of A.systems)f.systems.push(s?JX.Parse(g,X,E,!0,N):KX.Parse(g,X,E,!0,N));if(A.j){const s=A.j.options;if("Sphere"===A.j.kind)f.setEmitterAsSphere({diameter:s.diameter,segments:s.segments,color:g.e.mi(s.color)},A.j.renderingGroupId,X)}return f}}mX.BaseAssetsUrl="https://assets.babylonjs.com/particles";var bX=s(499);class yX{static CreateDefault(A){let X,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,N=arguments.length>2?arguments[2]:void 0;X=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new JX("default system",{Yh:s},N):new KX("default system",s,N),X.j=A;const f=aX.d.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return X.particleTexture=new n.d(f,X.va()),X.createConeEmitter(.1,Math.PI/4),X.color1=new g.h(1,1,1,1),X.color2=new g.h(1,1,1,1),X.colorDead=new g.h(1,1,1,0),X.minSize=.1,X.maxSize=.1,X.minEmitPower=2,X.maxEmitPower=2,X.updateSpeed=1/60,X.emitRate=30,X}static CreateAsync(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;X||(X=W.b.LastCreatedScene);const f={};return X.addPendingData(f),new Promise(((E,g)=>{if(s&&!JX.IsSupported)return X.removePendingData(f),g("Particle system with GPU is not supported.");aX.d.LoadFile(`${yX.BaseAssetsUrl}/systems/${A}.json`,(A=>{X.removePendingData(f);const g=JSON.parse(A.toString());return E(mX.Parse(g,X,s,N))}),void 0,void 0,void 0,(()=>(X.removePendingData(f),g(`An error occurred with the creation of your particle system. Check if your type '${A}' exists.`))))}))}static ExportSet(A){const X=new mX;for(const s of A)X.systems.push(s);return X}static ParseFromFileAsync(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",E=arguments.length>5?arguments[5]:void 0;return new Promise(((g,K)=>{const r=new bX.b;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const X=JSON.parse(r.responseText);let K;K=N?JX.Parse(X,s,f,!1,E):KX.Parse(X,s,f,!1,E),A&&(K.name=A),g(K)}else K("Unable to load the particle system")})),r.open("GET",X),r.send()}))}static ParseFromSnippetAsync(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",f=arguments.length>4?arguments[4]:void 0;if("_BLANK"===A){const A=this.CreateDefault(null);return A.start(),Promise.resolve(A)}return new Promise(((E,g)=>{const K=new bX.b;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const g=JSON.parse(JSON.parse(K.responseText).jsonPayload),r=JSON.parse(g.particleSystem);let i;i=s?JX.Parse(r,X,N,!1,f):KX.Parse(r,X,N,!1,f),i.snippetId=A,E(i)}else g("Unable to load the snippet "+A)})),K.open("GET",this.SnippetUrl+"/"+A.replace(/#/g,"/")),K.send()}))}}yX.BaseAssetsUrl=mX.BaseAssetsUrl,yX.SnippetUrl="https://snippet.babylonjs.com",yX.CreateFromSnippetAsync=yX.ParseFromSnippetAsync;var jX=s(452),GX=s(850),VX=s(12317);(0,VX.h)(GX.b.NAME_PARTICLESYSTEM,((A,X,s,N)=>{const f=(0,VX.k)(GX.b.NAME_PARTICLESYSTEM);if(f&&void 0!==A.ri&&null!==A.ri)for(let E=0,g=A.ri.length;E<g;E++){const g=A.ri[E];s.ri.push(f(g,X,N))}})),(0,VX.e)(GX.b.NAME_PARTICLESYSTEM,((A,X,s)=>{if(A.activeParticleCount){return JX.Parse(A,X,s)}return KX.Parse(A,X,s)})),pA.d.prototype.createEffectForParticles=function(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Y=arguments.length>9?arguments[9]:void 0,v=[],c=[];const M=[];return r?r.fillUniformsAttributesAndSamplerNames(c,v,M):(v=KX._GetAttributeNamesOrOptions(),c=KX._GetEffectCreationOptions()),-1===f.indexOf(" BILLBOARD")&&(f+="\n#define BILLBOARD\n"),null!==r&&void 0!==r&&r.isAnimationSheetEnabled&&-1===f.indexOf(" ANIMATESHEET")&&(f+="\n#define ANIMATESHEET\n"),-1===N.indexOf("diffuseSampler")&&N.push("diffuseSampler"),this.createEffect({vertex:Y??(null===r||void 0===r?void 0:r.vertexShaderName)??"particles",fragmentElement:A},v,c.concat(X),M.concat(N),f,E,g,K,void 0,i,(async()=>{0===i?await Promise.resolve().then(s.bind(s,12348)):await Promise.resolve().then(s.bind(s,12407))}))},jX.d.prototype.getEmittedParticleSystems=function(){const A=[];for(let X=0;X<this.va().ri.length;X++){const s=this.va().ri[X];s.j===this&&A.push(s)}return A},jX.d.prototype.getHierarchyEmittedParticleSystems=function(){const A=[],X=this.getDescendants();X.push(this);for(let s=0;s<this.va().ri.length;s++){const N=this.va().ri[s],f=N.j;f.position&&-1!==X.indexOf(f)&&A.push(N)}return A};s(759),s(769),s(804);s(750),s(856),s(824),s(752),s(843);s(2246);var DX;s(12323),s(2288);!function(A){A[A.Color=2]="Color",A[A.UV=1]="UV",A[A.Random=0]="Random",A[A.Stated=3]="Stated"}(DX||(DX={}));var OX=s(2274);const PX=new N.k(0,0,0),lX=new N.k(0,0,0),nX=new N.k(0,0,0);class UX{constructor(A,X,s){this.width=A,this.height=X,this.data=s}processFlowable(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;if(!s)return;s instanceof N.c?N.k.TransformCoordinatesToRef(A.position,s,nX):(nX.x=s.x,nX.y=s.y,nX.z=s.z);const f=.5*nX.x+.5,E=1-(.5*nX.y+.5),g=Math.floor(f*this.width),K=Math.floor(E*this.height);if(g<0||g>=this.width||K<0||K>=this.height)return;const r=4*(K*this.width+g),i=this.data[r]/255*2-1,Y=this.data[r+1]/255*2-1,v=this.data[r+2]/255*2-1,c=this.data[r+3]/255;PX.set(i,Y,v),PX.scaleToRef(X*c,lX),A.direction.addInPlace(lX)}_processParticle(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;this.processFlowable(A,X,s)}static async FromUrlAsync(A){return await new Promise(((X,s)=>{const N=document.createElement("canvas"),f=N.getContext("2d");let E=null;const g=new Image;g.crossOrigin="anonymous",g.src=A,g.onerror=X=>{s(new Error(`Failed to load image: ${A} : ${X}`))},g.onload=()=>{N.width=g.width,N.height=g.height,f.drawImage(g,0,0),E=f.getImageData(0,0,N.width,N.height),X(new UX(N.width,N.height,E.data))}}))}static async ExtractFromTextureAsync(A){return await new Promise(((X,s)=>{if(!A.isReady())return void A.onLoadObservable.addOnce((async()=>{try{const s=await this.ExtractFromTextureAsync(A);X(s)}catch(N){s(N)}}));const N=A.getSize();OX.e.GetTextureDataAsync(A,N.width,N.height).then((A=>{X(new UX(N.width,N.height,new Uint8ClampedArray(A)))})).catch(s)}))}}var tX,eX,TX,IX,LX,kX,xX,HX,FX;!function(A){A[A.Int=1]="Int",A[A.Float=2]="Float",A[A.Vector2=4]="Vector2",A[A.oi=8]="oi",A[A.Matrix=16]="Matrix",A[A.Particle=32]="Particle",A[A.Texture=64]="Texture",A[A.Vi=128]="Vi",A[A.FloatGradient=256]="FloatGradient",A[A.Vector2Gradient=512]="Vector2Gradient",A[A.Vector3Gradient=1024]="Vector3Gradient",A[A.Color4Gradient=2048]="Color4Gradient",A[A.System=4096]="System",A[A.AutoDetect=8192]="AutoDetect",A[A.BasedOnInput=16384]="BasedOnInput",A[A.Undefined=32768]="Undefined",A[A.All=65535]="All"}(tX||(tX={})),function(A){A[A.Compatible=0]="Compatible",A[A.TypeIncompatible=1]="TypeIncompatible",A[A.HierarchyIssue=2]="HierarchyIssue"}(eX||(eX={})),function(A){A[A.Input=0]="Input",A[A.Output=1]="Output"}(TX||(TX={}));class qX{get direction(){return this._direction}get type(){if(this._type===tX.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===tX.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(A){this._type=A}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((A=>A.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(A,X,s){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=tX.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Z.b,this.onDisconnectionObservable=new Z.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=X,this.name=A,this._direction=s}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(A){var X;return this.isConnected?null!==(X=this._connectedPoint)&&void 0!==X&&X._storedFunction?this._connectedPoint._storedFunction(A):this._connectedPoint._storedValue:this.value}canConnectTo(A){return 0===this.checkCompatibilityState(A)}checkCompatibilityState(A){const X=this._ownerBlock,s=A.ownerBlock;if(this.type!==A.type&&A.innerType!==tX.AutoDetect)return A.acceptedConnectionPointTypes&&-1!==A.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(A.excludedConnectionPointTypes&&-1!==A.excludedConnectionPointTypes.indexOf(this.type))return 1;let N=s,f=X;return 0===this.direction&&(N=X,f=s),N.isAnAncestorOf(f)?2:0}connectTo(A){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(A))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${A.ownerBlock.name}".${A.name}`;return this._endpoints.push(A),A._connectedPoint=this,this.onConnectionObservable.notifyObservers(A),A.onConnectionObservable.notifyObservers(this),this}disconnectFrom(A){const X=this._endpoints.indexOf(A);return-1===X||(this._endpoints.splice(X,1),A._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(A),A.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(A){let X=1;for(;X<tX.All;)A&X||this.excludedConnectionPointTypes.push(X),X<<=1}serialize(){let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const X={};return X.name=this.name,X.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.zi?(X.valueType="BABYLON."+this.value.getClassName(),X.value=this.value.zi()):(X.valueType="number",X.value=this.value)),A&&this.connectedPoint&&(X.inputName=this.name,X.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,X.targetConnectionName=this.connectedPoint.name,X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),X}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class SX{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(A){this._name=A}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(A){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new Z.b,this.Ji=new Z.b,this.onInputChangedObservable=new Z.b,this.visibleOnFrame=!1,this._name=A,this.uniqueId=U.c.UniqueId}_inputRename(A){return A}_outputRename(A){return A}isAnAncestorOf(A){for(const X of this._outputs)if(X.hasEndpoints)for(const s of X.endpoints){if(s.ownerBlock===A)return!0;if(s.ownerBlock.isAnAncestorOf(A))return!0}return!1}isAnAncestorOfType(A){if(this.getClassName()===A)return!0;for(const X of this._outputs)if(X.hasEndpoints)for(const s of X.endpoints)if(s.ownerBlock.isAnAncestorOfType(A))return!0;return!1}getInputByName(A){const X=this._inputs.filter((X=>X.name===A));return X.length?X[0]:null}_linkConnectionTypes(A,X){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[X]._acceptedConnectionPointType=this._inputs[A]:(this._inputs[A]._linkedConnectionSource=this._inputs[X],this._inputs[A]._isMainLinkSource=!0),this._inputs[X]._linkedConnectionSource=this._inputs[A]}registerInput(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0;const g=new qX(A,this,0);return g.type=X,g.isOptional=s,g.defaultValue=N,g.value=N,g.valueMin=f,g.valueMax=E,this._inputs.push(g),this.onInputChangedObservable.notifyObservers(g),this}registerOutput(A,X,s){return(s=s??new qX(A,this,1)).type=X,this._outputs.push(s),this}_build(A){}_customBuildStep(A){}build(A){if(this._buildId===A.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((A=>A.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=A.buildId;for(const X of this._inputs){if(!X.connectedPoint){X.isOptional||A.notConnectedNonOptionalInputs.push(X);continue}const s=X.connectedPoint.ownerBlock;s&&s!==this&&!s.isSystem&&s.build(A)}return this._customBuildStep(A),A.verbose&&t.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(A),this.onBuildObservable.notifyObservers(this),!1}serialize(){const A={};A.customType="BABYLON."+this.getClassName(),A.id=this.uniqueId,A.name=this.name,A.visibleOnFrame=this.visibleOnFrame,A.inputs=[],A.outputs=[];for(const X of this.inputs)A.inputs.push(X.serialize());for(const X of this.outputs)A.outputs.push(X.serialize(!1));return A}_deserialize(A){this._name=A.name,this.comments=A.comments,this.visibleOnFrame=!!A.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(A)}_deserializePortDisplayNamesAndExposedOnFrame(A){const X=A.inputs,s=A.outputs;if(X)for(const N of X){const A=this.inputs.find((A=>A.name===N.name));if(!A)return;if(N.displayName&&(A.displayName=N.displayName),N.isExposedOnFrame&&(A.isExposedOnFrame=N.isExposedOnFrame,A.exposedPortPosition=N.exposedPortPosition),void 0!==N.value&&null!==N.value)if("number"===N.valueType)A.value=N.value;else{const X=(0,K.d)(N.valueType);X&&(A.value=X.mi(N.value))}}if(s)for(let N=0;N<s.length;N++){const A=s[N];A.displayName&&(this.outputs[N].displayName=A.displayName),A.isExposedOnFrame&&(this.outputs[N].isExposedOnFrame=A.isExposedOnFrame,this.outputs[N].exposedPortPosition=A.exposedPortPosition)}}clone(){const A=this.serialize(),X=(0,K.d)(A.customType);if(X){const s=new X;return s._deserialize(A),s}return null}dispose(){this.Ji.notifyObservers(this),this.Ji.clear();for(const A of this.inputs)A.dispose();for(const A of this.outputs)A.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function pX(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",N=arguments.length>3?arguments[3]:void 0;return(f,E)=>{let g=f._propStore;g||(g=[],f._propStore=g),g.push({propertyName:E,displayName:A,type:X,groupName:s,options:N??{},className:f.getClassName()})}}(0,O.e)([(0,P.M)("comment")],SX.prototype,"comments",void 0),function(A){A[A.Boolean=0]="Boolean",A[A.Float=1]="Float",A[A.Int=2]="Int",A[A.Vector2=3]="Vector2",A[A.List=4]="List",A[A.Vi=5]="Vi",A[A.SamplingMode=6]="SamplingMode",A[A.TextureFormat=7]="TextureFormat",A[A.TextureType=8]="TextureType"}(IX||(IX={})),function(A){A[A.None=0]="None",A[A.Position=1]="Position",A[A.Direction=2]="Direction",A[A.Age=3]="Age",A[A.Lifetime=4]="Lifetime",A[A.Color=5]="Color",A[A.ScaledDirection=6]="ScaledDirection",A[A.Scale=7]="Scale",A[A.AgeGradient=8]="AgeGradient",A[A.Angle=9]="Angle",A[A.SpriteCellIndex=16]="SpriteCellIndex",A[A.SpriteCellStart=17]="SpriteCellStart",A[A.SpriteCellEnd=18]="SpriteCellEnd"}(LX||(LX={})),function(A){A[A.None=0]="None",A[A.Time=1]="Time",A[A.Delta=2]="Delta",A[A.Emitter=3]="Emitter"}(kX||(kX={}));class BX{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let A="";for(const X of this.notConnectedNonOptionalInputs)A+=`input ${X.name} from block ${X.ownerBlock.name}[${X.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(A)throw"Build of Node Particle System Set failed:\n"+A}adapt(A,X){const s=A.getConnectedValue(this)||0;if(A.type===X)return s;switch(X){case tX.Vector2:return new N.i(s,s);case tX.oi:return new N.k(s,s,s);case tX.Vi:return new g.h(s,s,s,s)}return null}getContextualValue(A){if(!this.particleContext||!this.systemContext)return null;switch(A){case LX.Position:return this.particleContext.position;case LX.Direction:return this.particleContext.direction;case LX.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case LX.Color:return this.particleContext.color;case LX.Age:return this.particleContext.age;case LX.Lifetime:return this.particleContext.lifeTime;case LX.Angle:return this.particleContext.angle;case LX.Scale:return this.particleContext.scale;case LX.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case LX.SpriteCellEnd:return this.systemContext.endSpriteCellID;case LX.SpriteCellIndex:return this.particleContext.cellIndex;case LX.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(A){if(!this.particleContext||!this.systemContext)return null;switch(A){case kX.Time:return this.systemContext._actualFrame;case kX.Delta:return this.systemContext._scaledUpdateSpeed;case kX.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function ZX(A,X,s){const N=new BX;N.eg=X;const f=A.createSystem(N);return f.canStart=()=>!0,f.j=s.clone(),f.disposeOnStop=!0,f.start(),f}class oX extends SX{constructor(A){super(A),this.blendMode=r.BLENDMODE_ONEONE,this.Yh=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",tX.Particle),this.registerInput("texture",tX.Texture),this.registerInput("onStart",tX.System,!0),this.registerInput("onEnd",tX.System,!0),this.registerOutput("system",tX.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(A){A.Yh=this.Yh,A.buildId=this._buildId++,this.build(A);const X=this.particle.getConnectedValue(A);return X.particleTexture=this.texture.getConnectedValue(A),X.emitRate=this.emitRate,X.blendMode=this.blendMode,X.name=this.name,X._nodeGenerated=!0,X._targetStopDuration=this.targetStopDuration,X.startDelay=this.startDelay,this.system._storedValue=this,X.canStart=()=>!this.doNoStart,X.onStartedObservable.add((s=>{const N=this.onStart.getConnectedValue(A);N&&s.onStartedObservable.addOnce((()=>{A.systemContext=X;const s=ZX(N,A.eg,A.emitterPosition);this.Ji.addOnce((()=>{s.dispose()}))}));const f=this.onEnd.getConnectedValue(A);f&&s.onStoppedObservable.addOnce((()=>{A.systemContext=X;const s=ZX(f,A.eg,A.emitterPosition);this.Ji.addOnce((()=>{s.dispose()}))}))})),this.Ji.addOnce((()=>{X.dispose()})),X}serialize(){const A=super.serialize();return A.Yh=this.Yh,A.emitRate=this.emitRate,A.blendMode=this.blendMode,A.doNoStart=this.doNoStart,A.targetStopDuration=this.targetStopDuration,A.startDelay=this.startDelay,A}_deserialize(A){super._deserialize(A),this.Yh=A.Yh,this.emitRate=A.emitRate,this.doNoStart=!!A.doNoStart,void 0!==A.blendMode&&(this.blendMode=A.blendMode),void 0!==A.targetStopDuration&&(this.targetStopDuration=A.targetStopDuration),void 0!==A.startDelay&&(this.startDelay=A.startDelay)}}(0,O.e)([pX("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:r.BLENDMODE_ONEONE},{label:"Standard",value:r.BLENDMODE_STANDARD},{label:"Add",value:r.BLENDMODE_ADD},{label:"Multiply",value:r.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:r.BLENDMODE_MULTIPLYADD}]})],oX.prototype,"blendMode",void 0),(0,O.e)([pX("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],oX.prototype,"Yh",void 0),(0,O.e)([pX("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],oX.prototype,"emitRate",void 0),(0,O.e)([pX("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],oX.prototype,"targetStopDuration",void 0),(0,O.e)([pX("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],oX.prototype,"startDelay",void 0),(0,O.e)([pX("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],oX.prototype,"doNoStart",void 0),(0,K.f)("BABYLON.SystemBlock",oX);class WX extends SX{get type(){if(this._type===tX.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=tX.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=tX.Vector2,this._type;case"oi":return this._type=tX.oi,this._type;case"Vi":return this._type=tX.Vi,this._type;case"Matrix":return this._type=tX.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===LX.None&&this._systemSource!==kX.None}get systemSource(){return this._systemSource}set systemSource(A){if(this._systemSource=A,A!==kX.None){switch(this._contextualSource=LX.None,this._type=tX.Float,A){case kX.Time:case kX.Delta:this._type=tX.Float;break;case kX.Emitter:this._type=tX.oi}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==LX.None}get contextualValue(){return this._contextualSource}set contextualValue(A){if(this._contextualSource=A,A!==LX.None){switch(this._systemSource=kX.None,A){case LX.Scale:this._type=tX.Vector2;break;case LX.Position:case LX.Direction:case LX.ScaledDirection:this._type=tX.oi;break;case LX.Color:this._type=tX.Vi;break;case LX.Age:case LX.Lifetime:case LX.Angle:case LX.AgeGradient:this._type=tX.Float;break;case LX.SpriteCellEnd:case LX.SpriteCellStart:case LX.SpriteCellIndex:this._type=tX.Int}this.output&&(this.output.type=this._type)}}constructor(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tX.AutoDetect;super(A),this._type=tX.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new Z.b,this._systemSource=kX.None,this._contextualSource=LX.None,this._type=X,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",X)}get value(){return this._storedValue}set value(A){this.type===tX.Float&&this.min!==this.max&&(A=Math.max(this.min,A),A=Math.min(this.max,A)),this._storedValue=A,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(A){this._valueCallback=A}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case tX.Int:case tX.Float:this.value=0;break;case tX.Vector2:this.value=N.i.Zero();break;case tX.oi:this.value=N.k.Zero();break;case tX.Vi:this.value=new g.h(1,1,1,1);break;case tX.Matrix:this.value=N.c.Identity()}}_build(A){super._build(A),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=A=>A.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=A=>A.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const A=super.serialize();return A.type=this.type,A.contextualValue=this.contextualValue,A.systemSource=this.systemSource,A.min=this.min,A.max=this.max,A.groupInInspector=this.groupInInspector,A.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.zi?(A.valueType="BABYLON."+this._storedValue.getClassName(),A.value=this._storedValue.zi()):(A.valueType="number",A.value=this._storedValue)),A}_deserialize(A){if(super._deserialize(A),this._type=A.type,this.contextualValue=A.contextualValue,this.systemSource=A.systemSource||kX.None,this.min=A.min||0,this.max=A.max||0,this.groupInInspector=A.groupInInspector||"",void 0!==A.displayInInspector&&(this.displayInInspector=A.displayInInspector),A.valueType)if("number"===A.valueType)this._storedValue=A.value;else{const X=(0,K.d)(A.valueType);X&&(this._storedValue=X.mi(A.value))}}}(0,K.f)("BABYLON.ParticleInputBlock",WX);class hX extends SX{get url(){return this._url}set url(A){this._url!==A&&(this._cachedData=null,this._url=A,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(A){this._textureDataUrl!==A&&(this._cachedData=null,this._textureDataUrl=A,this._url="",this._sourceTexture=null)}set sourceTexture(A){this._sourceTexture!==A&&(this._cachedData=null,this._sourceTexture=A,this._url="",this._textureDataUrl="")}constructor(A){super(A),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",tX.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const A=this.texture._storedValue;return await new Promise(((X,s)=>{if(!A.isReady())return void A.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),X(this._cachedData)}catch(A){s(A)}}));const N=A.getSize();OX.e.GetTextureDataAsync(A,N.width,N.height).then((s=>{this._cachedData={width:N.width,height:N.height,data:new Uint8ClampedArray(s)},A.dispose(),X(this._cachedData)})).catch(s)}))}_build(A){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.d(this._textureDataUrl,A.eg):this.texture._storedValue=new n.d(this._url,A.eg):this.texture._storedValue=null}serialize(){const A=super.serialize();return A.url=this.url,A.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(A.textureDataUrl=this.textureDataUrl),A}_deserialize(A){super._deserialize(A),this.url=A.url,this.serializedCachedData=!!A.serializedCachedData,A.textureDataUrl&&(this.textureDataUrl=A.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,K.f)("BABYLON.ParticleTextureSourceBlock",hX);class As extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("position",tX.oi),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(A){const X=this.particle.getConnectedValue(A);if(this.output._storedValue=X,!this.position.isConnected)return;const s={process:s=>{A.particleContext=s,A.systemContext=X,s.position.p(this.position.getConnectedValue(A))},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s}}(0,K.f)("BABYLON.UpdatePositionBlock",As),function(A){A[A.Add=0]="Add",A[A.Subtract=1]="Subtract",A[A.Multiply=2]="Multiply",A[A.Divide=3]="Divide",A[A.Max=4]="Max",A[A.Min=5]="Min"}(xX||(xX={}));class Xs extends SX{constructor(A){super(A),this.operation=xX.Add,this.registerInput("left",tX.AutoDetect),this.registerInput("right",tX.AutoDetect),this.registerOutput("output",tX.BasedOnInput),this.output._typeConnectionSource=this.left;const X=[tX.Matrix,tX.Particle,tX.Texture,tX.System,tX.FloatGradient,tX.Color4Gradient,tX.Vector2Gradient,tX.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...X),this.right.excludedConnectionPointTypes.push(...X),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(A){let X;const s=this.left,f=this.right;if(!s.isConnected||!f.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const E=s.type===tX.Float||s.type===tX.Int,K=f.type===tX.Float||f.type===tX.Int,r=E&&K;switch(this.operation){case xX.Add:X=r?A=>s.getConnectedValue(A)+f.getConnectedValue(A):E?A=>A.adapt(s,f.type).add(f.getConnectedValue(A)):A=>s.getConnectedValue(A).add(A.adapt(f,s.type));break;case xX.Subtract:X=r?A=>s.getConnectedValue(A)-f.getConnectedValue(A):E?A=>A.adapt(s,f.type).Pg(f.getConnectedValue(A)):A=>s.getConnectedValue(A).Pg(A.adapt(f,s.type));break;case xX.Multiply:X=r?A=>s.getConnectedValue(A)*f.getConnectedValue(A):E?A=>A.adapt(s,f.type).multiply(f.getConnectedValue(A)):A=>s.getConnectedValue(A).multiply(A.adapt(f,s.type));break;case xX.Divide:X=r?A=>s.getConnectedValue(A)/f.getConnectedValue(A):E?A=>A.adapt(s,f.type).divide(f.getConnectedValue(A)):A=>s.getConnectedValue(A).divide(A.adapt(f,s.type));break;case xX.Min:if(r)X=A=>Math.min(s.getConnectedValue(A),f.getConnectedValue(A));else{const[A,K]=E?[f,s]:[s,f];switch(A.type){case tX.Vector2:X=X=>N.i.Minimize(A.getConnectedValue(X),X.adapt(K,A.type));break;case tX.oi:X=X=>N.k.Minimize(A.getConnectedValue(X),X.adapt(K,A.type));break;case tX.Vi:X=X=>{const s=A.getConnectedValue(X),{r:N,g:f,b:E,a:r}=X.adapt(K,A.type);return new g.h(Math.min(s.r,N),Math.min(s.g,f),Math.min(s.b,E),Math.min(s.a,r))}}}break;case xX.Max:if(!r){const[A,K]=E?[f,s]:[s,f];switch(A.type){case tX.Vector2:X=X=>N.i.Maximize(A.getConnectedValue(X),X.adapt(K,A.type));break;case tX.oi:X=X=>N.k.Maximize(A.getConnectedValue(X),X.adapt(K,A.type));break;case tX.Vi:X=X=>{const s=A.getConnectedValue(X),{r:N,g:f,b:E,a:r}=X.adapt(K,A.type);return new g.h(Math.max(s.r,N),Math.min(s.g,f),Math.min(s.b,E),Math.min(s.a,r))}}break}X=A=>Math.max(s.getConnectedValue(A),f.getConnectedValue(A))}this.output._storedFunction=A=>s.type===tX.Int?0|X(A):X(A)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===tX.Int||this.left.type===tX.Float&&this.right.type!==tX.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[A,X]of[[this.left,this.right],[this.right,this.left]])A.acceptedConnectionPointTypes=[tX.Int,tX.Float],X.isConnected&&(A.acceptedConnectionPointTypes.push(X.type),X.type!==tX.Int&&X.type!==tX.Float||A.acceptedConnectionPointTypes.push(tX.Vector2,tX.oi,tX.Vi))}dispose(){super.dispose();for(const A of this._connectionObservers)A.remove();this._connectionObservers.length=0}serialize(){const A=super.serialize();return A.operation=this.operation,A}_deserialize(A){super._deserialize(A),this.operation=A.operation}}(0,O.e)([pX("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:xX.Add},{label:"Subtract",value:xX.Subtract},{label:"Multiply",value:xX.Multiply},{label:"Divide",value:xX.Divide},{label:"Max",value:xX.Max},{label:"Min",value:xX.Min}]})],Xs.prototype,"operation",void 0),(0,K.f)("BABYLON.ParticleMathBlock",Xs);class ss extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("direction1",tX.oi,!0,new N.k(0,1,0)),this.registerInput("direction2",tX.oi,!0,new N.k(0,1,0)),this.registerInput("minEmitBox",tX.oi,!0,new N.k(-.5,-.5,-.5)),this.registerInput("maxEmitBox",tX.oi,!0,new N.k(.5,.5,.5)),this.registerOutput("output",tX.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(A){const X=this.particle.getConnectedValue(A);X._directionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.direction1.getConnectedValue(A),E=this.direction2.getConnectedValue(A),g=(0,i.r)(f.x,E.x),K=(0,i.r)(f.y,E.y),r=(0,i.r)(f.z,E.z);A.isEmitterTransformNode?N.k.TransformNormalFromFloatsToRef(g,K,r,A.emitterWorldMatrix,s.direction):s.direction.gi(g,K,r)},X._positionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.minEmitBox.getConnectedValue(A),E=this.maxEmitBox.getConnectedValue(A),g=(0,i.r)(f.x,E.x),K=(0,i.r)(f.y,E.y),r=(0,i.r)(f.z,E.z);A.isEmitterTransformNode?N.k.TransformCoordinatesFromFloatsToRef(g,K,r,A.emitterWorldMatrix,s.position):(s.position.gi(g,K,r),s.position.addInPlace(A.emitterPosition))},this.output._storedValue=X}}(0,K.f)("BABYLON.BoxShapeBlock",ss);class Ns extends SX{constructor(A){super(A),this.registerInput("emitPower",tX.Float,!0,1),this.registerInput("lifeTime",tX.Float,!0,1),this.registerInput("color",tX.Vi,!0,new g.h(1,1,1,1)),this.registerInput("scale",tX.Vector2,!0,new N.i(1,1)),this.registerInput("angle",tX.Float,!0,0),this.registerOutput("particle",tX.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(A){const X=new KX(this.name,A.Yh,A.eg,null,!1,void 0,!0);X.particleEmitterType=new R,X._lifeTimeCreation.process=(X,s)=>{A.particleContext=X,X.lifeTime=this.lifeTime.getConnectedValue(A),s._emitPower=this.emitPower.getConnectedValue(A)},X._colorCreation.process=X=>{A.particleContext=X,X.color.p(this.color.getConnectedValue(A))},X._sizeCreation.process=X=>{A.particleContext=X,X.size=1,X.scale.p(this.scale.getConnectedValue(A))},X._angleCreation.process=X=>{A.particleContext=X,X.angle=this.angle.getConnectedValue(A)},this.particle._storedValue=X}}(0,K.f)("BABYLON.CreateParticleBlock",Ns);class fs{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const A=[];for(const X of this.attachedBlocks)X.isInput&&A.push(X);return A}constructor(A){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new Z.b,this.name=A}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(A)&&this.attachedBlocks.push(A);for(const s of A.inputs){const N=s.connectedPoint;if(N){const s=N.ownerBlock;s!==A&&this._initializeBlock(s,X)}}}async buildAsync(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((s=>{const N=new mX;for(const A of this._systemBlocks)this._initializeBlock(A);for(const f of this.systemBlocks){const s=new BX;s.buildId=this._buildId++,s.eg=A,s.verbose=X;const E=f.createSystem(s);s.emitErrors(),N.systems.push(E)}this.onBuildObservable.notifyObservers(this),s(N)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const A=new oX("Particle system"),X=new As("Update position");X.output.connectTo(A.particle);const s=new WX("Position");s.contextualValue=LX.Position;const N=new WX("Scaled direction");N.contextualValue=LX.ScaledDirection;const f=new Xs("Add");f.operation=xX.Add,s.output.connectTo(f.left),N.output.connectTo(f.right),f.output.connectTo(X.position);const E=new Ns("Create particle"),g=new ss("Box shape");E.particle.connectTo(g.particle),g.output.connectTo(X.particle);const K=new hX("Texture");K.texture.connectTo(A.texture),K.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(A)}removeBlock(A){const X=this.attachedBlocks.indexOf(A);if(X>-1&&this.attachedBlocks.splice(X,1),A.isSystem){const X=this._systemBlocks.indexOf(A);X>-1&&this._systemBlocks.splice(X,1)}}parseSerializedObject(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];X||this.clear();const s={};for(const N of A.Rk){const A=(0,K.d)(N.customType);if(A){const X=new A;X._deserialize(N),s[N.id]=X,this.attachedBlocks.push(X),X.isSystem&&this._systemBlocks.push(X)}}for(const N of this.attachedBlocks)if(N.isTeleportOut){const A=N,X=A._tempEntryPointUniqueId;if(X){const N=s[X];N&&N.attachToEndpoint(A)}}for(let N=0;N<A.Rk.length;N++){const f=A.Rk[N],E=s[f.id];E&&(E.inputs.length&&f.inputs.some((A=>A.targetConnectionName))&&!X||this._restoreConnections(E,A,s))}if(A.locations||A.editorData&&A.editorData.locations){const N=A.locations||A.editorData.locations;for(const A of N)s[A.blockId]&&(A.blockId=s[A.blockId].uniqueId);X&&this.editorData&&this.editorData.locations&&N.concat(this.editorData.locations),A.locations?this.editorData={locations:N}:(this.editorData=A.editorData,this.editorData.locations=N);const f=[];for(const A in s)f[A]=s[A].uniqueId;this.editorData.map=f}this.comment=A.comment}_restoreConnections(A,X,s){for(const N of A.outputs)for(const f of X.Rk){const E=s[f.id];if(E)for(const g of f.inputs)if(s[g.targetBlockId]!==A||g.targetConnectionName!==N.name);else{const A=E.getInputByName(g.inputName);if(!A||A.isConnected)continue;N.connectTo(A,!0),this._restoreConnections(E,X,s)}}}serialize(A){const X=A?{}:l.c.Serialize(this);X.editorData=JSON.parse(JSON.stringify(this.editorData));let s=[];A?s=A:X.customType="BABYLON.NodeParticleSystemSet",X.Rk=[];for(const N of s)X.Rk.push(N.serialize());if(!A)for(const N of this.attachedBlocks)-1===s.indexOf(N)&&X.Rk.push(N.serialize());return X}dispose(){for(const A of this.attachedBlocks)A.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(A){const X=new fs(A);return X.setToDefault(),X}static Parse(A){const X=l.c.Parse((()=>new fs(A.name)),A,null);return X.parseSerializedObject(A),X}static ParseFromSnippetAsync(A,X){return"_BLANK"===A?Promise.resolve(fs.CreateDefault("blank")):new Promise(((s,N)=>{const f=new bX.b;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){const g=JSON.parse(JSON.parse(f.responseText).jsonPayload),K=JSON.parse(g.nodeParticle);X||(X=l.c.Parse((()=>new fs(A)),K,null)),X.parseSerializedObject(K),X.snippetId=A;try{s(X)}catch(E){N(E)}}else N("Unable to load the snippet "+A)})),f.open("GET",this.SnippetUrl+"/"+A.replace(/#/g,"/")),f.send()}))}}fs.EditorURL=`${aX.d._DefaultCdnUrl}/v${pA.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,fs.SnippetUrl="https://snippet.babylonjs.com",(0,O.e)([(0,P.M)()],fs.prototype,"name",void 0),(0,O.e)([(0,P.M)("comment")],fs.prototype,"comment",void 0),function(A){A[A.None=0]="None",A[A.PerParticle=1]="PerParticle",A[A.PerSystem=2]="PerSystem"}(HX||(HX={}));class Es extends SX{constructor(A){super(A),this._currentLockId=-2,this.lockMode=HX.PerParticle,this.registerInput("min",tX.AutoDetect,!0,0),this.registerInput("max",tX.AutoDetect,!0,1),this.registerOutput("output",tX.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(tX.Float|tX.Int|tX.Vector2|tX.oi|tX.Vi),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(tX.Float|tX.Int|tX.Vector2|tX.oi|tX.Vi),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=tX.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let A=null;switch(this._currentLockId=-2,this.min.type){case tX.AutoDetect:case tX.Int:case tX.Float:A=A=>{const X=this.min.getConnectedValue(A)||0,s=this.max.getConnectedValue(A)||1;return X+Math.random()*(s-X)};break;case tX.Vector2:A=A=>{const X=this.min.getConnectedValue(A)||N.i.Zero(),s=this.max.getConnectedValue(A)||N.i.One();return new N.i(X.x+Math.random()*(s.x-X.x),X.y+Math.random()*(s.y-X.y))};break;case tX.oi:A=A=>{const X=this.min.getConnectedValue(A)||N.k.Zero(),s=this.max.getConnectedValue(A)||N.k.One();return new N.k(X.x+Math.random()*(s.x-X.x),X.y+Math.random()*(s.y-X.y),X.z+Math.random()*(s.z-X.z))};break;case tX.Vi:A=A=>{const X=this.min.getConnectedValue(A)||new g.h(0,0,0,0),s=this.max.getConnectedValue(A)||new g.h(1,1,1,1);return new g.h(X.x+Math.random()*(s.x-X.x),X.y+Math.random()*(s.y-X.y),X.z+Math.random()*(s.z-X.z),X.w+Math.random()*(s.w-X.w))}}this.output._storedFunction=X=>{var s;let N=0;switch(this.lockMode){case HX.PerParticle:N=(null===(s=X.particleContext)||void 0===s?void 0:s.id)||-1;break;case HX.PerSystem:N=X.buildId||0}return this._currentLockId!==N&&(this.lockMode!==HX.None&&(this._currentLockId=N),this.output._storedValue=A(X)),this.output._storedValue}}serialize(){const A=super.serialize();return A.lockMode=this.lockMode,A}_deserialize(A){super._deserialize(A),this.lockMode=A.lockMode}}(0,O.e)([pX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:HX.None},{label:"Per particle",value:HX.PerParticle},{label:"Per system",value:HX.PerSystem}]})],Es.prototype,"lockMode",void 0),(0,K.f)("BABYLON.ParticleRandomBlock",Es);class gs extends SX{constructor(A){super(A),this._currentLockId=-2,this.lockMode=HX.PerParticle,this.registerInput("min",tX.AutoDetect),this.registerInput("max",tX.AutoDetect),this.registerOutput("output",tX.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const X=[tX.Matrix,tX.Particle,tX.Texture,tX.System,tX.FloatGradient,tX.Color4Gradient,tX.Vector2Gradient,tX.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...X),this.max.excludedConnectionPointTypes.push(...X)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let A=null;switch(this._currentLockId=-2,this.min.type){case tX.Float:case tX.Int:A=A=>{const X=this.min.getConnectedValue(A),s=this.max.getConnectedValue(A);return Math.random()*(s-X)+X};break;case tX.Vector2:A=A=>{const X=this.min.getConnectedValue(A),s=this.max.getConnectedValue(A);return new N.i(Math.random()*(s.x-X.x)+X.x,Math.random()*(s.y-X.y)+X.y)};break;case tX.oi:A=A=>{const X=this.min.getConnectedValue(A),s=this.max.getConnectedValue(A);return new N.k(Math.random()*(s.x-X.x)+X.x,Math.random()*(s.y-X.y)+X.y,Math.random()*(s.z-X.z)+X.z)};break;case tX.Vi:A=A=>{const X=this.min.getConnectedValue(A),s=this.max.getConnectedValue(A);return new g.h(Math.random()*(s.r-X.r)+X.r,Math.random()*(s.g-X.g)+X.g,Math.random()*(s.b-X.b)+X.b,Math.random()*(s.a-X.a)+X.a)}}this.output._storedFunction=X=>{var s;let N=0;switch(this.lockMode){case HX.PerParticle:N=(null===(s=X.particleContext)||void 0===s?void 0:s.id)||-1;break;case HX.PerSystem:N=X.buildId||0}return this._currentLockId!==N&&(this.lockMode!==HX.None&&(this._currentLockId=N),this.output._storedValue=A(X)),this.output._storedValue}}serialize(){const A=super.serialize();return A.lockMode=this.lockMode,A}_deserialize(A){super._deserialize(A),void 0!==A.lockMode&&(this.lockMode=A.lockMode)}}(0,O.e)([pX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:HX.None},{label:"Per particle",value:HX.PerParticle},{label:"Per system",value:HX.PerSystem}]})],gs.prototype,"lockMode",void 0),(0,K.f)("BABYLON.RandomRangeBlock",gs);(0,K.f)("BABYLON.ParticleLerpBlock",class extends SX{constructor(A){super(A),this.registerInput("left",tX.AutoDetect),this.registerInput("right",tX.AutoDetect),this.registerInput("gradient",tX.Float,!0,0,0,1),this.registerOutput("output",tX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(tX.Float|tX.Int|tX.Vector2|tX.oi|tX.Vi)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const A=(A,X,s)=>(1-A)*X+A*s;this.output._storedFunction=X=>{const s=this.left.getConnectedValue(X),f=this.right.getConnectedValue(X),E=this.gradient.getConnectedValue(X);switch(this.left.type){case tX.Int:case tX.Float:return A(E,s,f);case tX.Vector2:return new N.i(A(E,s.x,f.x),A(E,s.y,f.y));case tX.oi:return new N.k(A(E,s.x,f.x),A(E,s.y,f.y),A(E,s.z,f.z));case tX.Vi:return new g.h(A(E,s.r,f.r),A(E,s.g,f.g),A(E,s.b,f.b),A(E,s.a,f.a))}return 0}}});(0,K.f)("BABYLON.UpdateDirectionBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("direction",tX.oi),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(A){const X=this.particle.getConnectedValue(A);if(this.output._storedValue=X,!this.direction.isConnected)return;const s={process:s=>{A.particleContext=s,A.systemContext=X,s.direction.p(this.direction.getConnectedValue(A))},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s}});(0,K.f)("BABYLON.UpdateColorBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("color",tX.Vi),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(A){const X=this.particle.getConnectedValue(A);if(this.output._storedValue=X,!this.color.isConnected)return;const s={process:s=>{A.particleContext=s,A.systemContext=X,s.color.p(this.color.getConnectedValue(A))},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s}});(0,K.f)("BABYLON.UpdateScaleBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("scale",tX.Vector2),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(A){const X=this.particle.getConnectedValue(A);if(this.output._storedValue=X,!this.scale.isConnected)return;const s={process:s=>{A.particleContext=s,A.systemContext=X,s.scale.p(this.scale.getConnectedValue(A))},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s}});(0,K.f)("BABYLON.UpdateAngleBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("angle",tX.Float),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(A){const X=this.particle.getConnectedValue(A);if(this.output._storedValue=X,!this.angle.isConnected)return;const s={process:s=>{A.particleContext=s,A.systemContext=X,s.angle=this.angle.getConnectedValue(A)},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s}});(0,K.f)("BABYLON.BasicPositionUpdateBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(A){const X=this.particle.getConnectedValue(A),s={process:s=>{A.particleContext=s,A.systemContext=X,s.direction.scaleToRef(X._directionScale,X._scaledDirection),s.position.addInPlace(X._scaledDirection)},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s,this.output._storedValue=X}});(0,K.f)("BABYLON.BasicSpriteUpdateBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(A){const X=this.particle.getConnectedValue(A),s={process:s=>{A.particleContext=s,A.systemContext=X,s.updateCellIndex()},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s,this.output._storedValue=X}});(0,K.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("cellIndex",tX.Int),this.registerOutput("output",tX.Particle),this.cellIndex.acceptedConnectionPointTypes=[tX.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(A){const X=this.particle.getConnectedValue(A);if(this.output._storedValue=X,!this.cellIndex.isConnected)return;const s={process:s=>{A.particleContext=s,A.systemContext=X,s.cellIndex=Math.floor(this.cellIndex.getConnectedValue(A))},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s}});class Ks extends SX{constructor(A){super(A),this.strength=1,this.registerInput("particle",tX.Particle),this.registerInput("flowMap",tX.Texture),this.registerOutput("output",tX.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(A){var X;const s=this.particle.getConnectedValue(A),N=A.eg;let f;(null===(X=this.flowMap.connectedPoint)||void 0===X?void 0:X.ownerBlock).extractTextureContentAsync().then((A=>{A&&(f=new UX(A.width,A.height,A.data))}));const E={process:A=>{const X=N.getTransformMatrix();f&&f._processParticle(A,this.strength*s._tempScaledUpdateSpeed,X)},previousItem:null,nextItem:null};s._updateQueueStart?kA(E,s._updateQueueStart):s._updateQueueStart=E,this.output._storedValue=s}serialize(){const A=super.serialize();return A.strength=this.strength,A}_deserialize(A){super._deserialize(A),this.strength=A.strength}}(0,O.e)([pX("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ks.prototype,"strength",void 0),(0,K.f)("BABYLON.UpdateFlowMapBlock",Ks);(0,K.f)("BABYLON.SphereShapeBlock",class extends SX{constructor(A){super(A),this.registerInput("input",tX.Particle),this.registerInput("radius",tX.Float,!0,1),this.registerInput("radiusRange",tX.Float,!0,1,0,1),this.registerInput("directionRandomizer",tX.Float,!0,0,0,1),this.registerOutput("output",tX.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(A){const X=this.input.getConnectedValue(A);X._directionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.directionRandomizer.getConnectedValue(A),E=s.position.Pg(A.emitterPosition).normalize(),g=(0,i.r)(0,f),K=(0,i.r)(0,f),r=(0,i.r)(0,f);E.x+=g,E.y+=K,E.z+=r,E.normalize(),A.isEmitterTransformNode?N.k.TransformNormalFromFloatsToRef(g,K,r,A.emitterWorldMatrix,s.direction):s.direction.gi(g,K,r)},X._positionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.radius.getConnectedValue(A),E=this.radiusRange.getConnectedValue(A),g=f-(0,i.r)(0,f*E),K=(0,i.r)(0,1),r=(0,i.r)(0,2*Math.PI),Y=Math.acos(2*K-1),v=g*Math.cos(r)*Math.sin(Y),c=g*Math.cos(Y),M=g*Math.sin(r)*Math.sin(Y);A.isEmitterTransformNode?N.k.TransformCoordinatesFromFloatsToRef(v,c,M,A.emitterWorldMatrix,s.position):(s.position.gi(v,c,M),s.position.addInPlace(A.emitterPosition))},this.output._storedValue=X}});(0,K.f)("BABYLON.PointShapeBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("direction1",tX.oi,!0,new N.k(0,1,0)),this.registerInput("direction2",tX.oi,!0,new N.k(0,1,0)),this.registerOutput("output",tX.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(A){const X=this.particle.getConnectedValue(A);X._directionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.direction1.getConnectedValue(A),E=this.direction2.getConnectedValue(A),g=(0,i.r)(f.x,E.x),K=(0,i.r)(f.y,E.y),r=(0,i.r)(f.z,E.z);A.isEmitterTransformNode?N.k.TransformNormalFromFloatsToRef(g,K,r,A.emitterWorldMatrix,s.direction):s.direction.gi(g,K,r)},X._positionCreation.process=s=>{A.systemContext=X,A.isEmitterTransformNode?N.k.TransformCoordinatesFromFloatsToRef(0,0,0,A.emitterWorldMatrix,s.position):s.position.p(A.emitterPosition)},this.output._storedValue=X}});(0,K.f)("BABYLON.CustomShapeBlock",class extends SX{constructor(A){super(A),this.registerInput("particle",tX.Particle),this.registerInput("position",tX.oi,!0,new N.k(0,0,0)),this.registerInput("direction",tX.oi,!0,new N.k(0,1,0)),this.registerOutput("output",tX.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(A){const X=this.particle.getConnectedValue(A);X._directionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.direction.getConnectedValue(A);A.isEmitterTransformNode?N.k.TransformNormalToRef(f,A.emitterWorldMatrix,s.direction):s.direction.p(f)},X._positionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.position.getConnectedValue(A);A.isEmitterTransformNode?N.k.TransformCoordinatesToRef(f,A.emitterWorldMatrix,s.position):(s.position.p(f),s.position.addInPlace(A.emitterPosition))},this.output._storedValue=X}});(0,K.f)("BABYLON.CylinderShapeBlock",class extends SX{constructor(A){super(A),this._tempVector=N.k.Zero(),this.registerInput("particle",tX.Particle),this.registerInput("radius",tX.Float,!0,1),this.registerInput("height",tX.Float,!0,1,0),this.registerInput("radiusRange",tX.Float,!0,1,0,1),this.registerInput("directionRandomizer",tX.Float,!0,0,0,1),this.registerOutput("output",tX.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(A){const X=this.particle.getConnectedValue(A);X._directionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.directionRandomizer.getConnectedValue(A);s.position.subtractToRef(A.emitterPosition,this._tempVector),this._tempVector.normalize(),A.isEmitterTransformNode&&N.k.TransformNormalToRef(this._tempVector,A.emitterInverseWorldMatrix,this._tempVector);const E=(0,i.r)(-f/2,f/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,i.r)(-Math.PI/2,Math.PI/2)*f,this._tempVector.y=E,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),A.isEmitterTransformNode?N.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,A.emitterWorldMatrix,s.direction):s.direction.p(this._tempVector)},X._positionCreation.process=s=>{A.particleContext=s,A.systemContext=X;const f=this.height.getConnectedValue(A),E=this.radiusRange.getConnectedValue(A),g=this.radius.getConnectedValue(A),K=(0,i.r)(-f/2,f/2),r=(0,i.r)(0,2*Math.PI),Y=(0,i.r)((1-E)*(1-E),1),v=Math.sqrt(Y)*g,c=v*Math.cos(r),M=v*Math.sin(r);A.isEmitterTransformNode?N.k.TransformCoordinatesFromFloatsToRef(c,K,M,A.emitterWorldMatrix,s.position):(s.position.gi(c,K,M),s.position.addInPlace(A.emitterPosition))},this.output._storedValue=X}});class rs extends SX{constructor(A){super(A),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",tX.Particle),this.registerOutput("output",tX.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(A){super._build(A);const X=this.particle.getConnectedValue(A);X._isAnimationSheetEnabled=!0,X.spriteCellWidth=this.width,X.spriteCellHeight=this.height,X.startSpriteCellID=this.start,X.endSpriteCellID=this.end,X.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=X}serialize(){const A=super.serialize();return A.width=this.width,A.height=this.height,A.start=this.start,A.end=this.end,A.randomStartCell=this.randomStartCell,A}_deserialize(A){super._deserialize(A),this.width=A.width,this.height=A.height,this.start=A.start,this.end=A.end,this.randomStartCell=A.randomStartCell}}(0,O.e)([pX("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rs.prototype,"start",void 0),(0,O.e)([pX("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rs.prototype,"end",void 0),(0,O.e)([pX("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rs.prototype,"width",void 0),(0,O.e)([pX("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rs.prototype,"height",void 0),(0,O.e)([pX("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rs.prototype,"loop",void 0),(0,O.e)([pX("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rs.prototype,"randomStartCell",void 0),(0,K.f)("BABYLON.SetupSpriteSheetBlock",rs);class is extends SX{constructor(A){super(A),this.reference=0,this.registerInput("value",tX.AutoDetect),this.registerOutput("output",tX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=A=>{switch(A){case tX.Float:return tX.FloatGradient;case tX.Vector2:return tX.Vector2Gradient;case tX.oi:return tX.Vector3Gradient;case tX.Vi:return tX.Color4Gradient}return A},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(tX.Float|tX.Vector2|tX.oi|tX.Vi)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=A=>null}serialize(){const A=super.serialize();return A.reference=this.reference,A}_deserialize(A){super._deserialize(A),this.reference=A.reference}}(0,O.e)([pX("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],is.prototype,"reference",void 0),(0,K.f)("BABYLON.ParticleGradientValueBlock",is);(0,K.f)("BABYLON.ParticleGradientBlock",class extends SX{constructor(A){super(A),this._entryCount=1,this.registerInput("gradient",tX.Float,!0,1,0,1),this.registerInput("value0",tX.AutoDetect),this.registerOutput("output",tX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=A=>{switch(A){case tX.FloatGradient:return tX.Float;case tX.Vector2Gradient:return tX.Vector2;case tX.Vector3Gradient:return tX.oi;case tX.Color4Gradient:return tX.Vi}return A},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(tX.FloatGradient|tX.Vector2Gradient|tX.Vector3Gradient|tX.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(A){this._inputs[A].onConnectionObservable.add((()=>{this._entryCount>A||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),tX.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const A=[];for(let s=1;s<this._inputs.length;s++){var X;if(this._inputs[s].isConnected)A.push(null===(X=this._inputs[s].connectedPoint)||void 0===X?void 0:X.ownerBlock)}A.sort(((A,X)=>A.reference-X.reference)),this.output._storedFunction=X=>{const s=this.gradient.getConnectedValue(X);if(1===A.length)return A[0].value.getConnectedValue(X);let f=null;for(let E=A.length-1;E>=0;E--){const K=A[E];if(K.reference<=s){const A=K.value.getConnectedValue(X);if(f){const E=f.value.getConnectedValue(X),r=f.reference,Y=K.reference,v=Math.max(0,Math.min(1,(s-Y)/(r-Y)));switch(this.output.type){case tX.Float:return(0,i.l)(A,E,v);case tX.Vector2:return N.i.Lerp(A,E,v);case tX.oi:return N.k.Lerp(A,E,v);case tX.Vi:return g.h.Lerp(A,E,v)}}return A}f=K}return 0}}});(0,K.f)("BABYLON.ParticleConverterBlock",class extends SX{constructor(A){super(A),this.registerInput("color ",tX.Vi,!0),this.registerInput("xyz ",tX.oi,!0),this.registerInput("xy ",tX.Vector2,!0),this.registerInput("zw ",tX.Vector2,!0),this.registerInput("x ",tX.Float,!0),this.registerInput("y ",tX.Float,!0),this.registerInput("z ",tX.Float,!0),this.registerInput("w ",tX.Float,!0),this.registerOutput("color",tX.Vi),this.registerOutput("xyz",tX.oi),this.registerOutput("xy",tX.Vector2),this.registerOutput("zw",tX.Vector2),this.registerOutput("x",tX.Float),this.registerOutput("y",tX.Float),this.registerOutput("z",tX.Float),this.registerOutput("w",tX.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(A){return"color "===A?"colorIn":"xyz "===A?"xyzIn":"xy "===A?"xyIn":"zw "===A?"zwIn":"x "===A?"xIn":"y "===A?"yIn":"z "===A?"zIn":"w "===A?"wIn":A}_outputRename(A){switch(A){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return A}}_build(A){super._build(A);const X=this.xIn,s=this.yIn,f=this.zIn,E=this.wIn,K=this.xyIn,r=this.zwIn,i=this.xyzIn,Y=this.colorIn,v=this.colorOut,c=this.xyzOut,M=this.xyOut,d=this.zwOut,Q=this.xOut,w=this.yOut,R=this.zOut,C=this.wOut,J=A=>{if(Y.isConnected)return Y.getConnectedValue(A);let N=0,v=0,c=0,M=0;if(X.isConnected&&(N=X.getConnectedValue(A)),s.isConnected&&(v=s.getConnectedValue(A)),f.isConnected&&(c=f.getConnectedValue(A)),E.isConnected&&(M=E.getConnectedValue(A)),K.isConnected){const X=K.getConnectedValue(A);X&&(N=X.x,v=X.y)}if(r.isConnected){const X=r.getConnectedValue(A);X&&(c=X.x,M=X.y)}if(i.isConnected){const X=i.getConnectedValue(A);X&&(N=X.x,v=X.y,c=X.z)}return new g.h(N,v,c,M)};v._storedFunction=A=>J(A),c._storedFunction=A=>{const X=J(A);return new N.k(X.r,X.g,X.b)},M._storedFunction=A=>{const X=J(A);return new N.i(X.r,X.g)},d._storedFunction=A=>{const X=J(A);return new N.i(X.b,X.a)},Q._storedFunction=A=>J(A).r,w._storedFunction=A=>J(A).g,R._storedFunction=A=>J(A).b,C._storedFunction=A=>J(A).a}}),function(A){A[A.Cos=0]="Cos",A[A.Sin=1]="Sin",A[A.Abs=2]="Abs",A[A.Exp=3]="Exp",A[A.Exp2=4]="Exp2",A[A.Round=5]="Round",A[A.Floor=6]="Floor",A[A.Ceiling=7]="Ceiling",A[A.Sqrt=8]="Sqrt",A[A.Log=9]="Log",A[A.Tan=10]="Tan",A[A.ArcTan=11]="ArcTan",A[A.ArcCos=12]="ArcCos",A[A.ArcSin=13]="ArcSin",A[A.Sign=14]="Sign",A[A.Negate=15]="Negate",A[A.OneMinus=16]="OneMinus",A[A.Reciprocal=17]="Reciprocal",A[A.ToDegrees=18]="ToDegrees",A[A.ToRadians=19]="ToRadians",A[A.Fract=20]="Fract"}(FX||(FX={}));class Ys extends SX{constructor(A){super(A),this.operation=FX.Cos,this.registerInput("input",tX.AutoDetect),this.registerOutput("output",tX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(tX.Float|tX.Int|tX.Vector2|tX.oi|tX.Vi)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(A){super._build(A);let X=null;switch(this.operation){case FX.Cos:X=A=>Math.cos(A);break;case FX.Sin:X=A=>Math.sin(A);break;case FX.Abs:X=A=>Math.abs(A);break;case FX.Exp:X=A=>Math.exp(A);break;case FX.Exp2:X=A=>Math.pow(2,A);break;case FX.Round:X=A=>Math.round(A);break;case FX.Floor:X=A=>Math.floor(A);break;case FX.Ceiling:X=A=>Math.ceil(A);break;case FX.Sqrt:X=A=>Math.sqrt(A);break;case FX.Log:X=A=>Math.log(A);break;case FX.Tan:X=A=>Math.tan(A);break;case FX.ArcTan:X=A=>Math.atan(A);break;case FX.ArcCos:X=A=>Math.acos(A);break;case FX.ArcSin:X=A=>Math.asin(A);break;case FX.Sign:X=A=>Math.sign(A);break;case FX.Negate:X=A=>-A;break;case FX.OneMinus:X=A=>1-A;break;case FX.Reciprocal:X=A=>1/A;break;case FX.ToRadians:X=A=>A*Math.PI/180;break;case FX.ToDegrees:X=A=>180*A/Math.PI;break;case FX.Fract:X=A=>A>=0?A-Math.floor(A):A-Math.ceil(A)}if(!X)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case tX.Int:case tX.Float:this.output._storedFunction=A=>{const s=this.input.getConnectedValue(A);return X(s)};break;case tX.Vector2:this.output._storedFunction=A=>{const s=this.input.getConnectedValue(A);return new N.i(X(s.x),X(s.y))};break;case tX.oi:this.output._storedFunction=A=>{const s=this.input.getConnectedValue(A);return new N.k(X(s.x),X(s.y),X(s.z))};break;case tX.Vi:this.output._storedFunction=A=>{const s=this.input.getConnectedValue(A);return new g.h(X(s.r),X(s.g),X(s.b),X(s.a))}}return this}serialize(){const A=super.serialize();return A.operation=this.operation,A}_deserialize(A){super._deserialize(A),this.operation=A.operation}}(0,O.e)([pX("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:FX.Cos},{label:"Sin",value:FX.Sin},{label:"Abs",value:FX.Abs},{label:"Exp",value:FX.Exp},{label:"Exp2",value:FX.Exp2},{label:"Round",value:FX.Round},{label:"Floor",value:FX.Floor},{label:"Ceiling",value:FX.Ceiling},{label:"Sqrt",value:FX.Sqrt},{label:"Log",value:FX.Log},{label:"Tan",value:FX.Tan},{label:"ArcTan",value:FX.ArcTan},{label:"ArcCos",value:FX.ArcCos},{label:"ArcSin",value:FX.ArcSin},{label:"Sign",value:FX.Sign},{label:"Negate",value:FX.Negate},{label:"OneMinus",value:FX.OneMinus},{label:"Reciprocal",value:FX.Reciprocal},{label:"ToDegrees",value:FX.ToDegrees},{label:"ToRadians",value:FX.ToRadians},{label:"Fract",value:FX.Fract}]})],Ys.prototype,"operation",void 0),(0,K.f)("BABYLON.ParticleTrigonometryBlock",Ys);var vs,cs=s(12327);class Ms extends SX{constructor(A){super(A),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",tX.AutoDetect),this.registerOutput("output",tX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(tX.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(tX.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(tX.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(tX.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(tX.System),this._inputs[0].excludedConnectionPointTypes.push(tX.Particle),this._inputs[0].excludedConnectionPointTypes.push(tX.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(A){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const X=A=>{const X=this.input.getConnectedValue(A);if(this.log.length>=this.stackSize)return X;if(null===X||void 0===X)return this.log.push(["null",""]),X;switch(this.input.type){case tX.Vector2:this.log.push([(0,cs.k)(X,4),X.toString()]);break;case tX.oi:this.log.push([(0,cs.l)(X,4),X.toString()]);break;case tX.Vi:this.log.push([`{R: ${X.r.toFixed(4)} G: ${X.g.toFixed(4)} B: ${X.b.toFixed(4)} A: ${X.a.toFixed(4)}}`,X.toString()]);break;default:this.log.push([X.toString(),X.toString()])}return X};this.output.isConnected?this.output._storedFunction=X:this.output._storedValue=X(A)}serialize(){const A=super.serialize();return A.stackSize=this.stackSize,A}_deserialize(A){super._deserialize(A),this.stackSize=A.stackSize}}(0,O.e)([pX("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Ms.prototype,"stackSize",void 0),(0,K.f)("BABYLON.ParticleDebugBlock",Ms);(0,K.f)("BABYLON.ParticleElbowBlock",class extends SX{constructor(A){super(A),this.registerInput("input",tX.AutoDetect),this.registerOutput("output",tX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(A){super._build(A);const X=this._outputs[0],s=this._inputs[0];X._storedFunction=A=>s.getConnectedValue(A)}});(0,K.f)("BABYLON.ParticleTeleportInBlock",class extends SX{get endpoints(){return this._endpoints}constructor(A){super(A),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",tX.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(A){if(this.getClassName()===A)return!0;for(const X of this.endpoints)if(X.isAnAncestorOfType(A))return!0;return!1}isAnAncestorOf(A){for(const X of this.endpoints){if(X===A)return!0;if(X.isAnAncestorOf(A))return!0}return!1}attachToEndpoint(A){A.detach(),this._endpoints.push(A),A._entryPoint=this,A._outputs[0]._typeConnectionSource=this._inputs[0],A._tempEntryPointUniqueId=null,A.name="> "+this.name}detachFromEndpoint(A){const X=this._endpoints.indexOf(A);-1!==X&&(this._endpoints.splice(X,1),A._outputs[0]._typeConnectionSource=null,A._entryPoint=null)}_build(){for(const A of this._endpoints)A.output._storedFunction=A=>this.input.getConnectedValue(A)}});(0,K.f)("BABYLON.ParticleTeleportOutBlock",class extends SX{constructor(A){super(A),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",tX.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(A){this.entryPoint&&this.entryPoint.build(A)}clone(){const A=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(A),A}serialize(){var A;const X=super.serialize();return X.entryPoint=(null===(A=this.entryPoint)||void 0===A?void 0:A.uniqueId)??"",X}_deserialize(A){super._deserialize(A),this._tempEntryPointUniqueId=A.entryPoint}}),function(A){A[A.Equal=0]="Equal",A[A.NotEqual=1]="NotEqual",A[A.LessThan=2]="LessThan",A[A.GreaterThan=3]="GreaterThan",A[A.LessOrEqual=4]="LessOrEqual",A[A.GreaterOrEqual=5]="GreaterOrEqual",A[A.Xor=6]="Xor",A[A.Or=7]="Or",A[A.And=8]="And"}(vs||(vs={}));class ds extends SX{constructor(A){super(A),this.test=vs.Equal,this.epsilon=0,this.registerInput("left",tX.Float),this.registerInput("right",tX.Float,!0,0),this.registerInput("ifTrue",tX.AutoDetect,!0,1),this.registerInput("ifFalse",tX.AutoDetect,!0,0),this.registerOutput("output",tX.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=tX.Float,this._inputs[0].acceptedConnectionPointTypes.push(tX.Int),this._inputs[1].acceptedConnectionPointTypes.push(tX.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const A=A=>{const X=this.left.getConnectedValue(A),s=this.right.getConnectedValue(A);let N=!1;switch(this.test){case vs.Equal:N=(0,i.t)(X,s,this.epsilon);break;case vs.NotEqual:N=!(0,i.t)(X,s,this.epsilon);break;case vs.LessThan:N=X<s+this.epsilon;break;case vs.GreaterThan:N=X>s-this.epsilon;break;case vs.LessOrEqual:N=X<=s+this.epsilon;break;case vs.GreaterOrEqual:N=X>=s-this.epsilon;break;case vs.Xor:N=!!X&&!s||!X&&!!s;break;case vs.Or:N=!!X||!!s;break;case vs.And:N=!!X&&!!s}return N};this.output._storedFunction=X=>A(X)?this.ifTrue.getConnectedValue(X):this.ifFalse.getConnectedValue(X)}serialize(){const A=super.serialize();return A.test=this.test,A.epsilon=this.epsilon,A}_deserialize(A){super._deserialize(A),this.test=A.test,void 0!==A.epsilon&&(this.epsilon=A.epsilon)}}(0,O.e)([pX("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:vs.Equal},{label:"NotEqual",value:vs.NotEqual},{label:"LessThan",value:vs.LessThan},{label:"GreaterThan",value:vs.GreaterThan},{label:"LessOrEqual",value:vs.LessOrEqual},{label:"GreaterOrEqual",value:vs.GreaterOrEqual},{label:"Xor",value:vs.Xor},{label:"Or",value:vs.Or},{label:"And",value:vs.And}]})],ds.prototype,"test",void 0),(0,O.e)([pX("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ds.prototype,"epsilon",void 0),(0,K.f)("BABYLON.ParticleConditionBlock",ds);class Qs extends SX{constructor(A){super(A),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",tX.Particle),this.registerInput("condition",tX.Float,!0,0),this.registerInput("system",tX.System),this.registerOutput("output",tX.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(A){this._triggerCount=0;const X=this.input.getConnectedValue(A),s={process:s=>{if(A.particleContext=s,A.systemContext=X,0!==this.condition.getConnectedValue(A)&&(0===this.limit||this._triggerCount<this.limit)){const N=(new Date).getTime();if(this._previousOne&&N-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=N;const f=this.system.getConnectedValue(A);if(f){const N=ZX(f,A.eg,s.position);N.Ji.addOnce((()=>{this._triggerCount--})),X.Ji.addOnce((()=>{N.dispose()}))}}},previousItem:null,nextItem:null};X._updateQueueStart?kA(s,X._updateQueueStart):X._updateQueueStart=s,this.output._storedValue=X}serialize(){const A=super.serialize();return A.limit=this.limit,A.delay=this.delay,A}_deserialize(A){super._deserialize(A),void 0!==A.limit&&(this.limit=A.limit),void 0!==A.delay&&(this.delay=A.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,O.e)([pX("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Qs.prototype,"limit",void 0),(0,O.e)([pX("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Qs.prototype,"delay",void 0),(0,K.f)("BABYLON.ParticleTriggerBlock",Qs);s(12333),s(12348),s(12352),s(12407)},12388:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneFragment",E="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12357:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneFragmentDeclaration",E="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12427:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneVertex",E="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12409:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneVertexDeclaration",E="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12403:(A,X,s)=>{"use strict";var N=s(559);const f="fogFragment",E="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12386:(A,X,s)=>{"use strict";var N=s(559);const f="fogFragmentDeclaration",E="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12434:(A,X,s)=>{"use strict";var N=s(559);const f="fogVertex",E="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12418:(A,X,s)=>{"use strict";var N=s(559);const f="fogVertexDeclaration",E="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12376:(A,X,s)=>{"use strict";var N=s(559);const f="helperFunctions",E="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12362:(A,X,s)=>{"use strict";var N=s(559);const f="imageProcessingDeclaration",E="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12383:(A,X,s)=>{"use strict";var N=s(559);const f="imageProcessingFunctions",E="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12370:(A,X,s)=>{"use strict";var N=s(559);const f="logDepthDeclaration",E="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12394:(A,X,s)=>{"use strict";var N=s(559);const f="logDepthFragment",E="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12437:(A,X,s)=>{"use strict";var N=s(559);const f="logDepthVertex",E="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";N.b.IncludesShadersStoreWGSL[f]||(N.b.IncludesShadersStoreWGSL[f]=E)},12352:(A,X,s)=>{"use strict";s.r(X),s.d(X,{particlesPixelShaderWGSL:()=>g});var N=s(559);s(12357),s(12362),s(12370),s(12376),s(12383),s(12386),s(12388),s(12394),s(12403);const f="particlesPixelShader",E="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.b.ShadersStoreWGSL[f]||(N.b.ShadersStoreWGSL[f]=E);const g={name:f,shader:E}},12407:(A,X,s)=>{"use strict";s.r(X),s.d(X,{particlesVertexShaderWGSL:()=>g});var N=s(559);s(12409),s(12418),s(12370),s(12427),s(12434),s(12437);const f="particlesVertexShader",E="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.b.ShadersStoreWGSL[f]||(N.b.ShadersStoreWGSL[f]=E);const g={name:f,shader:E}},12281:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneFragment",E="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12341:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneFragmentDeclaration",E="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12295:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneVertex",E="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12350:(A,X,s)=>{"use strict";var N=s(559);const f="clipPlaneVertexDeclaration",E="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12290:(A,X,s)=>{"use strict";var N=s(559);const f="fogFragment",E="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12273:(A,X,s)=>{"use strict";var N=s(559);const f="fogFragmentDeclaration",E="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12302:(A,X,s)=>{"use strict";var N=s(559);const f="fogVertex",E="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12292:(A,X,s)=>{"use strict";var N=s(559);const f="fogVertexDeclaration",E="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12262:(A,X,s)=>{"use strict";var N=s(559);const f="helperFunctions",E="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12250:(A,X,s)=>{"use strict";var N=s(559);const f="imageProcessingDeclaration",E="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12266:(A,X,s)=>{"use strict";var N=s(559);const f="imageProcessingFunctions",E="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12255:(A,X,s)=>{"use strict";var N=s(559);const f="logDepthDeclaration",E="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12286:(A,X,s)=>{"use strict";var N=s(559);const f="logDepthFragment",E="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12307:(A,X,s)=>{"use strict";var N=s(559);const f="logDepthVertex",E="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";N.b.IncludesShadersStore[f]||(N.b.IncludesShadersStore[f]=E)},12333:(A,X,s)=>{"use strict";s.r(X),s.d(X,{particlesPixelShader:()=>g});var N=s(559);s(12341),s(12250),s(12255),s(12262),s(12266),s(12273),s(12281),s(12286),s(12290);const f="particlesPixelShader",E="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.b.ShadersStore[f]||(N.b.ShadersStore[f]=E);const g={name:f,shader:E}},12348:(A,X,s)=>{"use strict";s.r(X),s.d(X,{particlesVertexShader:()=>g});var N=s(559);s(12350),s(12292),s(12255),s(12295),s(12302),s(12307);const f="particlesVertexShader",E="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.b.ShadersStore[f]||(N.b.ShadersStore[f]=E);const g={name:f,shader:E}},12729:(A,X,s)=>{"use strict";s.r(X),s.d(X,{FlowGraphGLTFDataProvider:()=>E});var N=s(12701),f=s(12677);class E extends N.e{constructor(A){var X,s;super();const N=A.glTF,E=(null===(X=N.animations)||void 0===X?void 0:X.map((A=>A._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",f.b,E);const g=(null===(s=N.nodes)||void 0===s?void 0:s.map((A=>A._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",f.b,g)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12610:(A,X,s)=>{"use strict";s.d(X,{b:()=>w,d:()=>d,h:()=>M,j:()=>Q});var N=s(678),f=s(12613),E=s(709),g=s(12615);const K=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class r{constructor(A,X){this._gltf=A,this._infoTree=X}convert(A){let X,s=this._gltf,N=this._infoTree;if(!A.startsWith("/"))throw new Error("Path must start with a /");const f=A.split("/");if(f.shift(),f[f.length-1].includes(".length")){const A=f[f.length-1].split(".");f.pop(),f.push(...A)}let E=!1;for(const r of f){const f="length"===r;if(f&&!N.__array__)throw new Error(`Path ${A} is invalid`);if(N.__ignoreObjectTree__&&(E=!0),N.__array__&&!f)N=N.__array__;else if(N=N[r],!N)throw new Error(`Path ${A} is invalid`);if(!E)if(void 0===s){if(!K.find((X=>X.regex.test(A))))throw new Error(`Path ${A} is invalid`)}else if(!f){var g;s=null===(g=s)||void 0===g?void 0:g[r]}(N.__target__||f)&&(X=s)}return{object:X,info:N}}}function i(A,X,s,N){const f=Y(A,X);return N?f[s][N]:f[s]}function Y(A,X,s){var N,E;return null===(N=A._data)||void 0===N||null===(E=N[(null===s||void 0===s?void 0:s.fillMode)??f.b.MATERIAL_TriangleFillMode])||void 0===E?void 0:E.babylonMaterial}function v(A,X){return{offset:{componentsCount:2,type:"Vector2",get:(s,f,E)=>{const g=i(s,E,A,X);return new N.i(null===g||void 0===g?void 0:g.uOffset,null===g||void 0===g?void 0:g.vOffset)},getTarget:Y,set:(s,N,f,E)=>{const g=i(N,E,A,X);g.uOffset=s.x,g.vOffset=s.y},getPropertyName:[()=>`${A}${X?"."+X:""}.uOffset`,()=>`${A}${X?"."+X:""}.vOffset`]},rotation:{type:"number",get:(s,N,f)=>{var E;return null===(E=i(s,f,A,X))||void 0===E?void 0:E.wAng},getTarget:Y,set:(s,N,f,E)=>i(N,E,A,X).wAng=s,getPropertyName:[()=>`${A}${X?"."+X:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(s,f,E)=>{const g=i(s,E,A,X);return new N.i(null===g||void 0===g?void 0:g.uScale,null===g||void 0===g?void 0:g.vScale)},getTarget:Y,set:(s,N,f,E)=>{const g=i(N,E,A,X);g.uScale=s.x,g.vScale=s.y},getPropertyName:[()=>`${A}${X?"."+X:""}.uScale`,()=>`${A}${X?"."+X:""}.vScale`]}}}const c={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:A=>{var X,s;return new N.i((null===(X=A._babylonCamera)||void 0===X?void 0:X.orthoLeft)??0,(null===(s=A._babylonCamera)||void 0===s?void 0:s.orthoRight)??0)},set:(A,X)=>{X._babylonCamera&&(X._babylonCamera.orthoLeft=A.x,X._babylonCamera.orthoRight=A.y)},getTarget:A=>A,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:A=>{var X,s;return new N.i((null===(X=A._babylonCamera)||void 0===X?void 0:X.orthoBottom)??0,(null===(s=A._babylonCamera)||void 0===s?void 0:s.orthoTop)??0)},set:(A,X)=>{X._babylonCamera&&(X._babylonCamera.orthoBottom=A.x,X._babylonCamera.orthoTop=A.y)},getTarget:A=>A,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:A=>{var X;return null===(X=A._babylonCamera)||void 0===X?void 0:X.maxZ},set:(A,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=A)},getTarget:A=>A,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:A=>{var X;return null===(X=A._babylonCamera)||void 0===X?void 0:X.ui},set:(A,X)=>{X._babylonCamera&&(X._babylonCamera.ui=A)},getTarget:A=>A,getPropertyName:[()=>"ui"]}},perspective:{aspectRatio:{type:"number",get:A=>{var X;return null===(X=A._babylonCamera)||void 0===X?void 0:X.getEngine().getAspectRatio(A._babylonCamera)},getTarget:A=>A,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:A=>{var X;return null===(X=A._babylonCamera)||void 0===X?void 0:X.fov},set:(A,X)=>{X._babylonCamera&&(X._babylonCamera.fov=A)},getTarget:A=>A,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:A=>{var X;return null===(X=A._babylonCamera)||void 0===X?void 0:X.maxZ},set:(A,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=A)},getTarget:A=>A,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:A=>{var X;return null===(X=A._babylonCamera)||void 0===X?void 0:X.ui},set:(A,X)=>{X._babylonCamera&&(X._babylonCamera.ui=A)},getTarget:A=>A,getPropertyName:[()=>"ui"]}}}},nodes:{length:{type:"number",get:A=>A.length,getTarget:A=>A.map((A=>A._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"oi",get:A=>{var X;return null===(X=A._babylonTransformNode)||void 0===X?void 0:X.position},set:(A,X)=>{var s;return null===(s=X._babylonTransformNode)||void 0===s?void 0:s.position.p(A)},getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:A=>{var X;return null===(X=A._babylonTransformNode)||void 0===X?void 0:X.rotationQuaternion},set:(A,X)=>{var s,N;return null===(s=X._babylonTransformNode)||void 0===s||null===(N=s.rotationQuaternion)||void 0===N?void 0:N.p(A)},getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"oi",get:A=>{var X;return null===(X=A._babylonTransformNode)||void 0===X?void 0:X.hi},set:(A,X)=>{var s;return null===(s=X._babylonTransformNode)||void 0===s?void 0:s.hi.p(A)},getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"hi"]},weights:{length:{type:"number",get:A=>A._numMorphTargets,getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(A,X)=>{var s,N;return void 0!==X?null===(s=A._primitiveBabylonMeshes)||void 0===s||null===(N=s[0].morphTargetManager)||void 0===N?void 0:N.getTarget(X).influence:void 0},getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(A,X)=>[0],getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:A=>{var X,s,f;return N.c.Compose(null===(X=A._babylonTransformNode)||void 0===X?void 0:X.hi,null===(s=A._babylonTransformNode)||void 0===s?void 0:s.rotationQuaternion,null===(f=A._babylonTransformNode)||void 0===f?void 0:f.position)},getTarget:A=>A._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:A=>{var X,s,f,E;const g=N.c.Identity();let K=A.parent;for(;K&&K.parent;)K=K.parent;const r=(null===(X=A._babylonTransformNode)||void 0===X?void 0:X.position._isDirty)||(null===(s=A._babylonTransformNode)||void 0===s||null===(f=s.rotationQuaternion)||void 0===f?void 0:f._isDirty)||(null===(E=A._babylonTransformNode)||void 0===E?void 0:E.hi._isDirty);if(K){var i;const X=null===(i=K._babylonTransformNode)||void 0===i?void 0:i.si(!0).invert();var Y,v;if(X)null===(Y=A._babylonTransformNode)||void 0===Y||null===(v=Y.si(r))||void 0===v||v.multiplyToRef(X,g)}else A._babylonTransformNode&&g.p(A._babylonTransformNode.si(r));return g},getTarget:A=>A._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:A=>{var X,s;return null===(X=A._babylonTransformNode)||void 0===X||null===(s=X.getChildren((A=>A instanceof g.c),!0)[0])||void 0===s?void 0:s.Il},getTarget:A=>{var X;return null===(X=A._babylonTransformNode)||void 0===X?void 0:X.getChildren((A=>A instanceof g.c),!0)[0]},set:(A,X)=>{if(X._babylonTransformNode){const s=X._babylonTransformNode.getChildren((A=>A instanceof g.c),!0)[0];s&&(s.Il=A)}}},color:{type:"Ui",get:A=>{var X,s;return null===(X=A._babylonTransformNode)||void 0===X||null===(s=X.getChildren((A=>A instanceof g.c),!0)[0])||void 0===s?void 0:s.Qk},getTarget:A=>{var X;return null===(X=A._babylonTransformNode)||void 0===X?void 0:X.getChildren((A=>A instanceof g.c),!0)[0]},set:(A,X)=>{if(X._babylonTransformNode){const s=X._babylonTransformNode.getChildren((A=>A instanceof g.c),!0)[0];s&&(s.Qk=A)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Ui",get:(A,X,s)=>Y(A,X,s).emissiveColor,set:(A,X,s,N)=>Y(X,s,N).emissiveColor.p(A),getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:v("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(A,X,s)=>{var N;return null===(N=i(A,s,"bumpTexture"))||void 0===N?void 0:N.level},set:(A,X,s,N)=>{const f=i(X,N,"bumpTexture");f&&(f.level=A)},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:v("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(A,X,s)=>Y(A,X,s).ambientTextureStrength,set:(A,X,s,N)=>{const f=Y(X,s,N);f&&(f.ambientTextureStrength=A)},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:v("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Vi",get:(A,X,s)=>{const N=Y(A,X,s);return E.h.FromColor3(N.albedoColor,N.alpha)},set:(A,X,s,N)=>{const f=Y(X,s,N);f.albedoColor.set(A.r,A.g,A.b),f.alpha=A.a},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:v("albedoTexture")}},metallicFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).metallic,set:(A,X,s,N)=>{const f=Y(X,s,N);f&&(f.metallic=A)},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).roughness,set:(A,X,s,N)=>{const f=Y(X,s,N);f&&(f.roughness=A)},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:v("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(A,X,s)=>Y(A,X,s).anisotropy.Il,set:(A,X,s,N)=>{Y(X,s,N).anisotropy.Il=A},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(A,X,s)=>Y(A,X,s).anisotropy.angle,set:(A,X,s,N)=>{Y(X,s,N).anisotropy.angle=A},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:v("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).clearCoat.Il,set:(A,X,s,N)=>{Y(X,s,N).clearCoat.Il=A},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).clearCoat.roughness,set:(A,X,s,N)=>{Y(X,s,N).clearCoat.roughness=A},getTarget:(A,X,s)=>Y(A,X,s),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:v("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(A,X,s)=>{var N;return null===(N=Y(A,X,s).clearCoat.bumpTexture)||void 0===N?void 0:N.level},getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).clearCoat.bumpTexture.level=A},extensions:{KHR_texture_transform:v("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:v("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(A,X,s)=>Y(A,X,s).subSurface.dispersion,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).subSurface.dispersion=A}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(A,X,s)=>Y(A,X,s).emissiveIntensity,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).emissiveIntensity=A}},KHR_materials_ior:{ior:{type:"number",get:(A,X,s)=>Y(A,X,s).indexOfRefraction,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).indexOfRefraction=A}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).iridescence.Il,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).iridescence.Il=A},iridescenceIor:{type:"number",get:(A,X,s)=>Y(A,X,s).iridescence.indexOfRefraction,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).iridescence.indexOfRefraction=A},iridescenceTexture:{extensions:{KHR_texture_transform:v("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(A,X,s)=>Y(A,X,s).iridescence.maximumThickness,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).iridescence.maximumThickness=A},iridescenceThicknessMinimum:{type:"number",get:(A,X,s)=>Y(A,X,s).iridescence.minimumThickness,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).iridescence.minimumThickness=A},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:v("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Ui",get:(A,X,s)=>Y(A,X,s).sheen.color,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).sheen.color.p(A)},sheenColorTexture:{extensions:{KHR_texture_transform:v("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).sheen.Il,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).sheen.Il=A},sheenRoughnessTexture:{extensions:{KHR_texture_transform:v("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).metallicF0Factor,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).metallicF0Factor=A,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Ui",get:(A,X,s)=>Y(A,X,s).metallicReflectanceColor,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).metallicReflectanceColor.p(A),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:v("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:v("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).subSurface.refractionIntensity,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).subSurface.refractionIntensity=A,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:v("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).subSurface.translucencyIntensity,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).subSurface.translucencyIntensity=A},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:v("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Ui",get:(A,X,s)=>Y(A,X,s).subSurface.translucencyColor,getTarget:Y,set:(A,X,s,N)=>{var f;return A&&(null===(f=Y(X,s,N).subSurface.translucencyColor)||void 0===f?void 0:f.p(A))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:v("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Ui",get:(A,X,s)=>Y(A,X,s).subSurface.tintColor,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).subSurface.tintColor.p(A)},attenuationDistance:{type:"number",get:(A,X,s)=>Y(A,X,s).subSurface.tintColorAtDistance,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).subSurface.tintColorAtDistance=A},thicknessFactor:{type:"number",get:(A,X,s)=>Y(A,X,s).subSurface.maximumThickness,getTarget:Y,set:(A,X,s,N)=>Y(X,s,N).subSurface.maximumThickness=A},thicknessTexture:{extensions:{KHR_texture_transform:v("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:A=>A.length,getTarget:A=>A.map((A=>A._babylonLight)),getPropertyName:[A=>"length"]},__array__:{__target__:!0,color:{type:"Ui",get:A=>{var X;return null===(X=A._babylonLight)||void 0===X?void 0:X.Qk},set:(A,X)=>{var s;return null===(s=X._babylonLight)||void 0===s?void 0:s.Qk.p(A)},getTarget:A=>A._babylonLight,getPropertyName:[A=>"diffuse"]},Il:{type:"number",get:A=>{var X;return null===(X=A._babylonLight)||void 0===X?void 0:X.Il},set:(A,X)=>X._babylonLight?X._babylonLight.Il=A:void 0,getTarget:A=>A._babylonLight,getPropertyName:[A=>"intensity"]},range:{type:"number",get:A=>{var X;return null===(X=A._babylonLight)||void 0===X?void 0:X.range},set:(A,X)=>X._babylonLight?X._babylonLight.range=A:void 0,getTarget:A=>A._babylonLight,getPropertyName:[A=>"range"]},spot:{innerConeAngle:{type:"number",get:A=>{var X;return null===(X=A._babylonLight)||void 0===X?void 0:X.innerAngle},set:(A,X)=>X._babylonLight?X._babylonLight.innerAngle=A:void 0,getTarget:A=>A._babylonLight,getPropertyName:[A=>"innerConeAngle"]},outerConeAngle:{type:"number",get:A=>{var X;return null===(X=A._babylonLight)||void 0===X?void 0:X.angle},set:(A,X)=>X._babylonLight?X._babylonLight.angle=A:void 0,getTarget:A=>A._babylonLight,getPropertyName:[A=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:A=>A.length,getTarget:A=>A.map((A=>A._babylonLight)),getPropertyName:[A=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:A=>A.length,getTarget:A=>A.map((A=>A._babylonTexture)),getPropertyName:[A=>"length"]},__array__:{__target__:!0,Il:{type:"number",get:A=>{var X;return null===(X=A._babylonTexture)||void 0===X?void 0:X.level},set:(A,X)=>{X._babylonTexture&&(X._babylonTexture.level=A)},getTarget:A=>A._babylonTexture},rotation:{type:"Quaternion",get:A=>{var X;return A._babylonTexture&&N.d.FromRotationMatrix(null===(X=A._babylonTexture)||void 0===X?void 0:X.getReflectionTextureMatrix())},set:(A,X)=>{var s;X._babylonTexture&&(null!==(s=X._babylonTexture.va())&&void 0!==s&&s.useRightHandedSystem||(A=N.d.Inverse(A)),N.c.FromQuaternionToRef(A,X._babylonTexture.getReflectionTextureMatrix()))},getTarget:A=>A._babylonTexture}}}}},animations:{length:{type:"number",get:A=>A.length,getTarget:A=>A.map((A=>A._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:A=>A.length,getTarget:A=>A.map((A=>{var X;return null===(X=A.primitives[0]._instanceData)||void 0===X?void 0:X.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function M(A){return new r(A,c)}function d(A){const X=A.split("/").map((A=>A.replace(/{}/g,"__array__")));let s=c;for(const N of X)N&&(s=s[N]);if(s&&s.type&&s.get)return s}function Q(A,X){const s=A.split("/").map((A=>A.replace(/{}/g,"__array__")));let N=c;for(const f of s)f&&(N=N[f]);N&&N.type&&N.get&&(N.interpolation=X)}function w(A,X){const s=A.split("/").map((A=>A.replace(/{}/g,"__array__")));let N=c;for(const f of s)if(f){if(!N[f]){if("?"===f){N.__ignoreObjectTree__=!0;continue}N[f]={},"__array__"===f&&(N[f].__target__=!0)}N=N[f]}Object.assign(N,X)}},12629:(A,X,s)=>{"use strict";s.r(X),s.d(X,{AnimationPropertyInfo:()=>i,TransformNodeAnimationPropertyInfo:()=>Y,WeightAnimationPropertyInfo:()=>v,getQuaternion:()=>K,getVector3:()=>g,getWeights:()=>r});var N=s(12567),f=s(678),E=s(12610);function g(A,X,s,N){return f.k.mi(X,s).scaleInPlace(N)}function K(A,X,s,N){return f.d.mi(X,s).scaleInPlace(N)}function r(A,X,s,N){const f=new Array(A._numMorphTargets);for(let E=0;E<f.length;E++)f[E]=X[s++]*N;return f}class i{constructor(A,X,s,N){this.type=A,this.name=X,this.getValue=s,this.getStride=N}_buildAnimation(A,X,s){const f=new N.e(A,this.name,X,this.type);return f.setKeys(s),f}}class Y extends i{buildAnimations(A,X,s,N){const f=[];return f.push({babylonAnimatable:A._babylonTransformNode,babylonAnimation:this._buildAnimation(X,s,N)}),f}}class v extends i{buildAnimations(A,X,s,f){const E=[];if(A._numMorphTargets)for(let g=0;g<A._numMorphTargets;g++){const K=new N.e(`${X}_${g}`,this.name,s,this.type);if(K.setKeys(f.map((A=>({frame:A.frame,inTangent:A.inTangent?A.inTangent[g]:void 0,value:A.value[g],outTangent:A.outTangent?A.outTangent[g]:void 0,interpolation:A.interpolation})))),A._primitiveBabylonMeshes)for(const X of A._primitiveBabylonMeshes)if(X.morphTargetManager){const A=X.morphTargetManager.getTarget(g),s=K.clone();A.animations.push(s),E.push({babylonAnimatable:A,babylonAnimation:s})}}return E}}(0,E.j)("/nodes/{}/translation",[new Y(N.e.ANIMATIONTYPE_VECTOR3,"position",g,(()=>3))]),(0,E.j)("/nodes/{}/rotation",[new Y(N.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",K,(()=>4))]),(0,E.j)("/nodes/{}/scale",[new Y(N.e.ANIMATIONTYPE_VECTOR3,"hi",g,(()=>3))]),(0,E.j)("/nodes/{}/weights",[new v(N.e.ANIMATIONTYPE_FLOAT,"influence",r,(A=>A._numMorphTargets))])},12543:(A,X,s)=>{"use strict";class N{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((A,X)=>{this._resolve=A,this._reject=X}))}}var f=s(678),E=s(709),g=s(456),K=s(653),r=s(12545),i=s(12563),Y=s(454),v=s(12247),c=s(12567),M=s(12573),d=s(503),Q=s(470),w=s(479);class R{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(A){this._useTextureToStoreBoneMatrices=A,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(A){this._animationPropertiesOverride=A}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(A,X,s){this.name=A,this.id=X,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=f.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Y.b,this.bones=[],this._scene=s||d.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const N=this._scene.getEngine().getCaps();this._canUseTextureForBones=N.textureFloat&&N.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((A=>!A.getParent()))}getTransformMatrices(A){if(this.needInitialSkinMatrix){if(!A)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return A._bonesTransformMatrices||this.prepare(!0),A._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(A){return this.needInitialSkinMatrix&&A._transformMatrixTexture?A._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(A){let X=`Name: ${this.name}, nBones: ${this.bones.length}`;if(X+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,A){X+=", Ranges: {";let A=!0;for(const s in this._ranges)A&&(X+=", ",A=!1),X+=s;X+="}"}return X}getBoneIndexByName(A){for(let X=0,s=this.bones.length;X<s;X++)if(this.bones[X].name===A)return X;return-1}createAnimationRange(A,X,s){if(!this._ranges[A]){this._ranges[A]=new M.c(A,X,s);for(let N=0,f=this.bones.length;N<f;N++)this.bones[N].animations[0]&&this.bones[N].animations[0].createRange(A,X,s)}}deleteAnimationRange(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let s=0,N=this.bones.length;s<N;s++)this.bones[s].animations[0]&&this.bones[s].animations[0].deleteRange(A,X);this._ranges[A]=null}getAnimationRange(A){return this._ranges[A]||null}getAnimationRanges(){const A=[];let X;for(X in this._ranges)A.push(this._ranges[X]);return A}copyAnimationRange(A,X){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[X]||!A.getAnimationRange(X))return!1;let N=!0;const f=this._getHighestAnimationFrame()+1,E={},g=A.bones;let K,r;for(r=0,K=g.length;r<K;r++)E[g[r].name]=g[r];this.bones.length!==g.length&&(Q.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${g.length}`),N=!1);const i=s&&this.dimensionsAtRest&&A.dimensionsAtRest?this.dimensionsAtRest.divide(A.dimensionsAtRest):null;for(r=0,K=this.bones.length;r<K;r++){const A=this.bones[r].name,g=E[A];g?N=N&&this.bones[r].copyAnimationRange(g,X,f,s,i):(Q.b.Warn("copyAnimationRange: not same rig, missing source bone "+A),N=!1)}const Y=A.getAnimationRange(X);return Y&&(this._ranges[X]=new M.c(X,Y.from+f,Y.to+f)),N}returnToRest(){for(const A of this.bones)-1!==A._index&&A.returnToRest()}_getHighestAnimationFrame(){let A=0;for(let X=0,s=this.bones.length;X<s;X++)if(this.bones[X].animations[0]){const s=this.bones[X].animations[0].getHighestFrame();A<s&&(A=s)}return A}beginAnimation(A,X,s,N){const f=this.getAnimationRange(A);return f?this._scene.beginAnimation(this,f.from,f.to,X,s,N):null}static MakeAnimationAdditive(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;const N=A.getAnimationRange(s);if(!N)return null;const f=A._scene.getAllAnimatablesByTarget(A);let E=null;for(let K=0;K<f.length;K++){const A=f[K];if(A.fromFrame===(null===N||void 0===N?void 0:N.from)&&A.toFrame===(null===N||void 0===N?void 0:N.to)){E=A;break}}const g=A.getAnimatables();for(let K=0;K<g.length;K++){const A=g[K].animations;if(A)for(let N=0;N<A.length;N++)c.e.MakeAnimationAdditive(A[N],X,s)}return E&&(E.isAdditive=!0),A}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(A){this._meshesWithPoseMatrix.push(A)}_unregisterMeshWithPoseMatrix(A){const X=this._meshesWithPoseMatrix.indexOf(A);X>-1&&this._meshesWithPoseMatrix.splice(X,1)}_computeTransformMatrices(A,X){this.onBeforeComputeObservable.notifyObservers(this);for(let s=0;s<this.bones.length;s++){const N=this.bones[s];N._childUpdateId++;const f=N.getParent();if(f?N.getLocalMatrix().multiplyToRef(f.getFinalMatrix(),N.getFinalMatrix()):X?N.getLocalMatrix().multiplyToRef(X,N.getFinalMatrix()):N.getFinalMatrix().p(N.getLocalMatrix()),-1!==N._index){const X=null===N._index?s:N._index;N.getAbsoluteInverseBindMatrix().multiplyToArray(N.getFinalMatrix(),A,16*X)}}this._identity.copyToArray(A,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const A=this.va().getRenderId();if(this._currentRenderId===A)return;this._currentRenderId=A}if(this._numBonesWithLinkedTransformNode>0)for(const A of this.bones)if(A._linkedTransformNode){const X=A._linkedTransformNode;A.position=X.position,X.rotationQuaternion?A.rotationQuaternion=X.rotationQuaternion:A.rotation=X.rotation,A.hi=X.hi}if(this.needInitialSkinMatrix)for(const A of this._meshesWithPoseMatrix){const X=A.getPoseMatrix();let s=this._isDirty;if(A._bonesTransformMatrices&&A._bonesTransformMatrices.length===16*(this.bones.length+1)||(A._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),s=!0),s){if(this._synchronizedWithMesh!==A){this._synchronizedWithMesh=A;for(const A of this.bones)if(!A.getParent()){A.getBindMatrix().multiplyToRef(X,f.f.Matrix[1]),A._updateAbsoluteBindMatrices(f.f.Matrix[1])}if(this.isUsingTextureForMatrices){const X=4*(this.bones.length+1);A._transformMatrixTexture&&A._transformMatrixTexture.getSize().width===X||(A._transformMatrixTexture&&A._transformMatrixTexture.dispose(),A._transformMatrixTexture=v.d.CreateRGBATexture(A._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(A._bonesTransformMatrices,X),this.isUsingTextureForMatrices&&A._transformMatrixTexture&&A._transformMatrixTexture.update(A._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=v.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let A=0;A<this.bones.length;A++)this._animatables.push(this.bones[A])}return this._animatables}clone(A,X){const s=new R(A,X||A,this._scene);s.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let N=0;N<this.bones.length;N++){const A=this.bones[N];let X=null;const f=A.getParent();if(f){const A=this.bones.indexOf(f);X=s.bones[A]}const E=new i.b(A.name,s,X,A.getBindMatrix().clone(),A.getRestMatrix().clone());E._index=A._index,A._linkedTransformNode&&E.linkTransformNode(A._linkedTransformNode),w.d.DeepCopy(A.animations,E.animations)}if(this._ranges){s._ranges={};for(const A in this._ranges){const X=this._ranges[A];X&&(s._ranges[A]=X.clone())}}return this._isDirty=!0,s.prepare(!0),s}enableBlending(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const X of this.bones)for(const s of X.animations)s.enableBlending=!0,s.blendingSpeed=A}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const A=this._parentContainer.skeletons.indexOf(this);A>-1&&this._parentContainer.skeletons.splice(A,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const A={};A.name=this.name,A.id=this.id,this.dimensionsAtRest&&(A.dimensionsAtRest=this.dimensionsAtRest.zi()),A.bones=[],A.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let s=0;s<this.bones.length;s++){var X;const N=this.bones[s],f=N.getParent(),E={parentBoneIndex:f?this.bones.indexOf(f):-1,index:N.getIndex(),name:N.name,id:N.id,matrix:N.getBindMatrix().zi(),rest:N.getRestMatrix().zi(),linkedTransformNodeId:null===(X=N.getTransformNode())||void 0===X?void 0:X.id};A.bones.push(E),N.length&&(E.length=N.length),N.metadata&&(E.metadata=N.metadata),N.animations&&N.animations.length>0&&(E.animation=N.animations[0].serialize()),A.ranges=[];for(const X in this._ranges){const s=this._ranges[X];if(!s)continue;const N={};N.name=X,N.from=s.from,N.to=s.to,A.ranges.push(N)}}return A}static Parse(A,X){const s=new R(A.name,A.id,X);let N;for(A.dimensionsAtRest&&(s.dimensionsAtRest=f.k.mi(A.dimensionsAtRest)),s.needInitialSkinMatrix=A.needInitialSkinMatrix,N=0;N<A.bones.length;N++){const X=A.bones[N],E=A.bones[N].index;let g=null;X.parentBoneIndex>-1&&(g=s.bones[X.parentBoneIndex]);const K=X.rest?f.c.mi(X.rest):null,r=new i.b(X.name,s,g,f.c.mi(X.matrix),K,null,E);void 0!==X.id&&null!==X.id&&(r.id=X.id),X.length&&(r.length=X.length),X.metadata&&(r.metadata=X.metadata),X.animation&&r.animations.push(c.e.Parse(X.animation)),void 0!==X.linkedTransformNodeId&&null!==X.linkedTransformNodeId&&(s._hasWaitingData=!0,r._waitingTransformNodeId=X.linkedTransformNodeId)}if(A.ranges)for(N=0;N<A.ranges.length;N++){const X=A.ranges[N];s.createAnimationRange(X.name,X.from,X.to)}return s}computeAbsoluteMatrices(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||A)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(A)}getPoseMatrix(){let A=null;return this._meshesWithPoseMatrix.length>0&&(A=this._meshesWithPoseMatrix[0].getPoseMatrix()),A}sortBones(){const A=[],X=new Array(this.bones.length);for(let s=0;s<this.bones.length;s++)this._sortBones(s,A,X);this.bones=A}_sortBones(A,X,s){if(s[A])return;s[A]=!0;const N=this.bones[A];if(!N)return;void 0===N._index&&(N._index=A);const f=N.getParent();f&&this._sortBones(this.bones.indexOf(f),X,s),X.push(N)}setCurrentPoseAsRest(){for(const A of this.bones)A.setCurrentPoseAsRest()}}var C=s(826),J=s(657),a=s(666),u=s(12578),z=s(12581),m=s(616),b=s(707);class y extends z.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(A){this.subSurface.refractionTexture=A,A?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(A){this.subSurface.indexOfRefraction=A}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(A){this.subSurface.invertRefractionY=A}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(A){this.subSurface.linkRefractionWithTransparency=A,A&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===z.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(A){A!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=A?z.c.LIGHTFALLOFF_PHYSICAL:z.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===z.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(A){A!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=A?z.c.LIGHTFALLOFF_GLTF:z.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(A){this._attachImageProcessingConfiguration(A),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(A){this.imageProcessingConfiguration.colorCurvesEnabled=A}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(A){this.imageProcessingConfiguration.colorGradingEnabled=A}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(A){this._imageProcessingConfiguration.toneMappingEnabled=A}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(A){this._imageProcessingConfiguration.exposure=A}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(A){this._imageProcessingConfiguration.contrast=A}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(A){this._imageProcessingConfiguration.colorGradingTexture=A}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(A){this._imageProcessingConfiguration.colorCurves=A}constructor(A,X){super(A,X,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=E.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new E.e(0,0,0),this.albedoColor=new E.e(1,1,1),this.baseWeight=1,this.reflectivityColor=new E.e(1,1,1),this.reflectionColor=new E.e(1,1,1),this.emissiveColor=new E.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,u.c)(this.va())}getClassName(){return"PBRMaterial"}clone(A){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const N=b.c.Clone((()=>new y(A,this.va())),this,{cloneTexturesOnlyOnce:X});return N.id=A,N.name=A,this.stencil.copyTo(N.stencil),this._clonePlugins(N,s),N}serialize(){const A=super.serialize();return A.customType="BABYLON.PBRMaterial",A}static Parse(A,X,s){const N=b.c.Parse((()=>new y(A.name,X)),A,X,s);return A.stencil&&N.stencil.parse(A.stencil,X,s),C.c._ParsePlugins(A,N,X,s),A.clearCoat&&N.clearCoat.parse(A.clearCoat,X,s),A.anisotropy&&N.anisotropy.parse(A.anisotropy,X,s),A.brdf&&N.brdf.parse(A.brdf,X,s),A.sheen&&N.sheen.parse(A.sheen,X,s),A.subSurface&&N.subSurface.parse(A.subSurface,X,s),A.iridescence&&N.iridescence.parse(A.iridescence,X,s),N}}y.PBRMATERIAL_OPAQUE=z.c.PBRMATERIAL_OPAQUE,y.PBRMATERIAL_ALPHATEST=z.c.PBRMATERIAL_ALPHATEST,y.PBRMATERIAL_ALPHABLEND=z.c.PBRMATERIAL_ALPHABLEND,y.PBRMATERIAL_ALPHATESTANDBLEND=z.c.PBRMATERIAL_ALPHATESTANDBLEND,y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=z.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"directIntensity",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"emissiveIntensity",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"environmentIntensity",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"specularIntensity",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"disableBumpMap",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"albedoTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"baseWeightTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"baseDiffuseRoughnessTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"ambientTexture",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"ambientTextureStrength",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"opacityTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"reflectionTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"emissiveTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"reflectivityTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"metallicTexture",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"metallic",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"roughness",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"metallicF0Factor",void 0),(0,J.e)([(0,a.k)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"metallicReflectanceColor",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"metallicReflectanceTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"reflectanceTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"microSurfaceTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"bumpTexture",void 0),(0,J.e)([(0,a.G)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty",null)],y.prototype,"lightmapTexture",void 0),(0,J.e)([(0,a.k)("ambient"),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"ambientColor",void 0),(0,J.e)([(0,a.k)("albedo"),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"albedoColor",void 0),(0,J.e)([(0,a.M)("baseWeight"),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"baseWeight",void 0),(0,J.e)([(0,a.M)("baseDiffuseRoughness"),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"baseDiffuseRoughness",void 0),(0,J.e)([(0,a.k)("reflectivity"),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"reflectivityColor",void 0),(0,J.e)([(0,a.k)("reflection"),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"reflectionColor",void 0),(0,J.e)([(0,a.k)("emissive"),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"emissiveColor",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"microSurface",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useLightmapAsShadowmap",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"useAlphaFromAlbedoTexture",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"forceAlphaTest",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],y.prototype,"alphaCutOff",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useSpecularOverAlpha",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useAmbientInGrayScale",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,J.e)([(0,a.M)()],y.prototype,"usePhysicalLightFalloff",null),(0,J.e)([(0,a.M)()],y.prototype,"useGLTFLightFalloff",null),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRadianceOverAlpha",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useObjectSpaceNormalMap",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useParallax",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useParallaxOcclusion",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"parallaxScaleBias",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsLightsDirty")],y.prototype,"disableLighting",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"forceIrradianceInFragment",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsLightsDirty")],y.prototype,"maxSimultaneousLights",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"invertNormalMapX",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"invertNormalMapY",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"twoSidedLighting",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useAlphaFresnel",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useLinearAlphaFresnel",void 0),(0,J.e)([(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"environmentBRDFTexture",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"forceNormalForward",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"enableSpecularAntiAliasing",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useHorizonOcclusion",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRadianceOcclusion",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsMiscDirty")],y.prototype,"unlit",void 0),(0,J.e)([(0,a.M)(),(0,a.c)("_markAllSubMeshesAsMiscDirty")],y.prototype,"applyDecalMapAfterDetailMap",void 0),(0,m.f)("BABYLON.PBRMaterial",y);var j=s(2281),G=s(810),V=s(728),D=s(779),O=s(804),P=s(452);class l{get influence(){return this._influence}set influence(A){if(this._influence===A)return;const X=this._influence;this._influence=A,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===X||0===A)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(A){this._animationPropertiesOverride=A}constructor(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=A,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new Y.b,this._onDataLayoutChanged=new Y.b,this._animationPropertiesOverride=null,this.id=A,this._scene=s||d.b.LastCreatedScene,this.influence=X,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(A){const X=this.hasPositions;this._positions=A,X!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(A){const X=this.hasNormals;this._normals=A,X!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(A){const X=this.hasTangents;this._tangents=A,X!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(A){const X=this.hasUVs;this._uvs=A,X!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(A){const X=this.hasUV2s;this._uv2s=A,X!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(A){const X=this.hasColors;this._colors=A,X!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const A=b.c.Clone((()=>new l(this.name,this.influence,this._scene)),this);return A._positions=this._positions,A._normals=this._normals,A._tangents=this._tangents,A._uvs=this._uvs,A._uv2s=this._uv2s,A._colors=this._colors,A}serialize(){const A={};return A.name=this.name,A.influence=this.influence,A.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(A.id=this.id),this.hasNormals&&(A.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(A.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(A.Aa=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(A.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(A.za=Array.prototype.slice.call(this.getColors())),b.c.AppendSerializedAnimations(this,A),A}getClassName(){return"MorphTarget"}static Parse(A,X){const s=new l(A.name,A.influence);if(s.setPositions(A.xa),null!=A.id&&(s.id=A.id),A.ya&&s.setNormals(A.ya),A.tangents&&s.setTangents(A.tangents),A.Aa&&s.setUVs(A.Aa),A.uv2s&&s.setUV2s(A.uv2s),A.za&&s.setColors(A.za),A.animations){for(let X=0;X<A.animations.length;X++){const N=A.animations[X],f=(0,m.d)("BABYLON.Animation");f&&s.animations.push(f.Parse(N))}A.autoAnimate&&X&&X.beginAnimation(s,A.autoAnimateFrom,A.autoAnimateTo,A.autoAnimateLoop,A.autoAnimateSpeed||1)}return s}static FromMesh(A,X,s){X||(X=A.name);const N=new l(X,s,A.va());return N.setPositions(A.getVerticesData(V.e.PositionKind)),A.isVerticesDataPresent(V.e.NormalKind)&&N.setNormals(A.getVerticesData(V.e.NormalKind)),A.isVerticesDataPresent(V.e.TangentKind)&&N.setTangents(A.getVerticesData(V.e.TangentKind)),A.isVerticesDataPresent(V.e.UVKind)&&N.setUVs(A.getVerticesData(V.e.UVKind)),A.isVerticesDataPresent(V.e.UV2Kind)&&N.setUV2s(A.getVerticesData(V.e.UV2Kind)),A.isVerticesDataPresent(V.e.ColorKind)&&N.setColors(A.getVerticesData(V.e.ColorKind)),N}}(0,J.e)([(0,a.M)()],l.prototype,"id",void 0);var n=s(672),U=s(12507);class t{set areUpdatesFrozen(A){A?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new n.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,A||(A=d.b.LastCreatedScene),this._scene=A,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const A=this._scene.getEngine().getCaps();this._canUseTextureForTargets=A.canUseGLVertexID&&A.textureFloat&&A.maxVertexTextureImageUnits>0&&A.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return t.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?t.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(A){this._numMaxInfluencers!==A&&(this._numMaxInfluencers=A,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(A){this._useTextureToStoreTargets!==A&&(this._useTextureToStoreTargets=A,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var A;return t.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(A=this._scene)&&void 0!==A&&A.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(A){return this._activeTargets.data[A]}getTarget(A){return this._targets[A]}getTargetByName(A){for(const X of this._targets)if(X.name===A)return X;return null}addTarget(A){this._targets.push(A),this._targetInfluenceChangedObservers.push(A.onInfluenceChanged.add((A=>{this.areUpdatesFrozen&&A&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(A)}))),this._targetDataLayoutChangedObservers.push(A._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(A){const X=this._targets.indexOf(A);X>=0&&(this._targets.splice(X,1),A.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(X,1)[0]),A._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(X,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(A)}_bind(A){A.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),A.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),A.setTexture("morphTargets",this._targetStoreTexture),A.setInt("morphTargetCount",this.numInfluencers)}clone(){const A=new t(this._scene);for(const X of this._targets)A.addTarget(X.clone());return A.enablePositionMorphing=this.enablePositionMorphing,A.enableNormalMorphing=this.enableNormalMorphing,A.enableTangentMorphing=this.enableTangentMorphing,A.enableUVMorphing=this.enableUVMorphing,A.enableUV2Morphing=this.enableUV2Morphing,A.enableColorMorphing=this.enableColorMorphing,A}serialize(){const A={};A.id=this.uniqueId,A.targets=[];for(const X of this._targets)A.targets.push(X.serialize());return A}_syncActiveTargets(){let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const X=!!this._targetStoreTexture,s=this.isUsingTextureForTargets;(this._mustSynchronize||X!==s)&&(this._mustSynchronize=!1,this.synchronize());let N=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let f=-1;for(const E of this._targets)if(f++,0!==E.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=t.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(E),this._morphTargetTextureIndices[N]=f,this._tempInfluences[N++]=E.influence}this._morphTargetTextureIndices.length!==N&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,N)),this._influences&&this._influences.length===N||(this._influences=new Float32Array(N));for(let E=0;E<N;E++)this._influences[E]=this._tempInfluences[E];if(A&&this._scene)for(const E of this._scene.meshes)E.morphTargetManager===this&&(s?E._markSubMeshesAsAttributesDirty():E._syncGeometryWithMorphTargetManager())}synchronize(){var A;if(!this._scene||this.areUpdatesFrozen)return;const X=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(A=this._targetStoreTexture)||void 0===A||A.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>X.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const s of this._targets){this._supportsPositions=this._supportsPositions&&s.hasPositions,this._supportsNormals=this._supportsNormals&&s.hasNormals,this._supportsTangents=this._supportsTangents&&s.hasTangents,this._supportsUVs=this._supportsUVs&&s.hasUVs,this._supportsUV2s=this._supportsUV2s&&s.hasUV2s,this._supportsColors=this._supportsColors&&s.hasColors;const A=s.vertexCount;if(0===this._vertexCount)this._vertexCount=A;else if(this._vertexCount!==A)return void Q.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${s.name}": ${A}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const A=X.getCaps().maxTextureSize;this._textureWidth>A&&(this._textureHeight=Math.ceil(this._textureWidth/A),this._textureWidth=A);const s=this._targets.length,N=new Float32Array(s*this._textureWidth*this._textureHeight*4);let f=0;for(let X=0;X<s;X++){const A=this._targets[X],s=A.getPositions(),E=A.getNormals(),g=A.getUVs(),K=A.getTangents(),r=A.getUV2s(),i=A.getColors();f=X*this._textureWidth*this._textureHeight*4;for(let X=0;X<this._vertexCount;X++)this._supportsPositions&&s&&(N[f]=s[3*X],N[f+1]=s[3*X+1],N[f+2]=s[3*X+2],f+=4),this._supportsNormals&&E&&(N[f]=E[3*X],N[f+1]=E[3*X+1],N[f+2]=E[3*X+2],f+=4),this._supportsUVs&&g&&(N[f]=g[2*X],N[f+1]=g[2*X+1],f+=4),this._supportsTangents&&K&&(N[f]=K[3*X],N[f+1]=K[3*X+1],N[f+2]=K[3*X+2],f+=4),this._supportsUV2s&&r&&(N[f]=r[2*X],N[f+1]=r[2*X+1],f+=4),this._supportsColors&&i&&(N[f]=i[4*X],N[f+1]=i[4*X+1],N[f+2]=i[4*X+2],N[f+3]=i[4*X+3],f+=4)}this._targetStoreTexture=U.c.CreateRGBATexture(N,this._textureWidth,this._textureHeight,s,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const s of this._scene.meshes)s.morphTargetManager===this&&s._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const A=this._parentContainer.morphTargetManagers.indexOf(this);A>-1&&this._parentContainer.morphTargetManagers.splice(A,1),this._parentContainer=null}for(const A of this._targets)this._scene.stopAnimation(A)}}static Parse(A,X){const s=new t(X);for(const N of A.targets)s.addTarget(l.Parse(N,X));return s}}t.EnableTextureStorage=!0,t.MaxActiveMorphTargetsInVertexAttributeMode=8,t.ConstantTargetCountForTextureMode=0;var e=s(12585),T=s(508),I=s(759);const L=new Map,k=L;function x(A,X,s){H(A)&&Q.b.Warn(`Extension with the name '${A}' already exists`),L.set(A,{isGLTFExtension:X,factory:s})}function H(A){return L.delete(A)}var F=s(12610);function q(){const A=A=>!!A&&"object"===typeof A;for(var X=arguments.length,s=new Array(X),N=0;N<X;N++)s[N]=arguments[N];return s.reduce(((X,s)=>{const N=Object.keys(s);for(const f of N){const N=X[f],E=s[f];Array.isArray(N)&&Array.isArray(E)?X[f]=N.concat(...E):A(N)&&A(E)?X[f]=q(N,E):X[f]=E}return X}),{})}var S=s(741);class p{static Get(A,X,s){if(!X||void 0==s||!X[s])throw new Error(`${A}: Failed to find index (${s})`);return X[s]}static TryGet(A,X){return A&&void 0!=X&&A[X]?A[X]:null}static Assign(A){if(A)for(let X=0;X<A.length;X++)A[X].index=X}}function B(A){if(A.min&&A.max){const X=A.min,s=A.max,N=f.f.oi[0].gi(X[0],X[1],X[2]),E=f.f.oi[1].gi(s[0],s[1],s[2]);if(A.normalized&&5126!==A.componentType){let X=1;switch(A.componentType){case 5120:X=127;break;case 5121:X=255;break;case 5122:X=32767;break;case 5123:X=65535}const s=1/X;N.scaleInPlace(s),E.scaleInPlace(s)}return new I.e(N,E)}return null}class Z{static RegisterExtension(A,X){x(A,!1,X)}static UnregisterExtension(A){return H(A)}get Gi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(A){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=A}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((A=>A.dispose&&A.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(A,X,s,N,f,E){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=X,this._assetContainer=s,this._loadData(N);let E=null;if(A){const X={};if(this._gltf.nodes)for(const A of this._gltf.nodes)A.name&&(X[A.name]=A.index);E=(A instanceof Array?A:[A]).map((A=>{const s=X[A];if(void 0===s)throw new Error(`Failed to find node '${A}'`);return s}))}return await this._loadAsync(f,g,E,(()=>({meshes:this._getMeshes(),ri:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(A,X,s,N){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=A,this._loadData(X),await this._loadAsync(s,f,null,(()=>{}))}async _loadAsync(A,X,s,N){return await Promise.resolve().then((async()=>{this._rootUrl=A,this._uniqueRootUrl=!A.startsWith("file:")&&X?A:`${A}${Date.now()}/`,this._fileName=X,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const f=`${e.l[e.l.LOADING]} => ${e.l[e.l.READY]}`,E=`${e.l[e.l.LOADING]} => ${e.l[e.l.COMPLETE]}`;this._parent._startPerformanceCounter(f),this._parent._startPerformanceCounter(E),this._parent._setState(e.l.LOADING),this._extensionsOnLoading();const K=new Array;if(!this.parent.loadOnlyMaterials)if(s)K.push(this.loadSceneAsync("/nodes",{nodes:s,index:-1}));else if(void 0!=this._gltf.eg||this._gltf.scenes&&this._gltf.scenes[0]){const A=p.Get("/scene",this._gltf.scenes,this._gltf.eg||0);K.push(this.loadSceneAsync(`/scenes/${A.index}`,A))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let A=0;A<this._gltf.materials.length;++A){const X=this._gltf.materials[A],s="/materials/"+A,N=C.c.TriangleFillMode;K.push(this._loadMaterialAsync(s,X,null,N,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&K.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&K.push(this._compileShadowGeneratorsAsync());const r=Promise.all(K).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ci(!0);for(const A of this._babylonScene.materials){const X=A;void 0!==X.maxSimultaneousLights&&(X.maxSimultaneousLights=Math.max(X.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(e.l.READY),this._skipStartAnimationStep||this._startAnimations(),N()}));return await r.then((A=>(this._parent._endPerformanceCounter(f),g.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(E),this._parent._setState(e.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(A=>{this._parent.onErrorObservable.notifyObservers(A),this._parent.onErrorObservable.clear(),this.dispose()}))})),A)))})).catch((A=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(A),this._parent.onErrorObservable.clear(),this.dispose()),A}))}_loadData(A){if(this._gltf=A.json,this._setupData(),A.bin){const X=this._gltf.buffers;if(X&&X[0]&&!X[0].uri){const s=X[0];(s.byteLength<A.bin.byteLength-3||s.byteLength>A.bin.byteLength)&&Q.b.Warn(`Binary buffer length (${s.byteLength}) from JSON does not match chunk length (${A.bin.byteLength})`),this._bin=A.bin}else Q.b.Warn("Unexpected BIN chunk")}}_setupData(){if(p.Assign(this._gltf.accessors),p.Assign(this._gltf.animations),p.Assign(this._gltf.buffers),p.Assign(this._gltf.bufferViews),p.Assign(this._gltf.cameras),p.Assign(this._gltf.images),p.Assign(this._gltf.materials),p.Assign(this._gltf.meshes),p.Assign(this._gltf.nodes),p.Assign(this._gltf.samplers),p.Assign(this._gltf.scenes),p.Assign(this._gltf.skins),p.Assign(this._gltf.textures),this._gltf.nodes){const A={};for(const s of this._gltf.nodes)if(s.children)for(const X of s.children)A[X]=s.index;const X=this._createRootNode();for(const s of this._gltf.nodes){const N=A[s.index];s.parent=void 0===N?X:this._gltf.nodes[N]}}}async _loadExtensionsAsync(){const A=[];if(k.forEach(((X,s)=>{var N;!1===(null===(N=this.parent.extensionOptions[s])||void 0===N?void 0:N.enabled)?X.isGLTFExtension&&this.isExtensionUsed(s)&&Q.b.Warn(`Extension ${s} is used but has been explicitly disabled.`):X.isGLTFExtension&&!this.isExtensionUsed(s)||A.push((async()=>{const A=await X.factory(this);return A.name!==s&&Q.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${A.name} !== ${s}`),this._parent.onExtensionLoadedObservable.notifyObservers(A),A})())})),this._extensions.push(...await Promise.all(A)),this._extensions.sort(((A,X)=>(A.order||Number.MAX_VALUE)-(X.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const s of this._gltf.extensionsRequired){if(!this._extensions.some((A=>A.name===s&&A.enabled))){var X;if(!1===(null===(X=this.parent.extensionOptions[s])||void 0===X?void 0:X.enabled))throw new Error(`Required extension ${s} is disabled`);throw new Error(`Required extension ${s} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new P.d("__root__",this._babylonScene);this._rootBabylonMesh=A,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ci(!1);const X={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case e.h.AUTO:this._babylonScene.useRightHandedSystem||(X.rotation=[0,1,0,0],X.scale=[1,1,-1],Z._LoadTransform(X,this._rootBabylonMesh));break;case e.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(A),X}loadSceneAsync(A,X){const s=this._extensionsLoadSceneAsync(A,X);if(s)return s;const N=new Array;if(this.logOpen(`${A} ${X.name||""}`),X.nodes)for(const f of X.nodes){const X=p.Get(`${A}/nodes/${f}`,this._gltf.nodes,f);N.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(A=>{A.parent=this._rootBabylonMesh})))}for(const f of this._postSceneLoadActions)f();return N.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(N).then((()=>{}))}_forEachPrimitive(A,X){if(A._primitiveBabylonMeshes)for(const s of A._primitiveBabylonMeshes)X(s)}_getGeometries(){const A=[],X=this._gltf.nodes;if(X)for(const s of X)this._forEachPrimitive(s,(X=>{const s=X.pi;s&&-1===A.indexOf(s)&&A.push(s)}));return A}_getMeshes(){const A=[];this._rootBabylonMesh instanceof O.e&&A.push(this._rootBabylonMesh);const X=this._gltf.nodes;if(X)for(const s of X)this._forEachPrimitive(s,(X=>{A.push(X)}));return A}_getTransformNodes(){const A=[],X=this._gltf.nodes;if(X)for(const s of X)s._babylonTransformNode&&"bj"===s._babylonTransformNode.getClassName()&&A.push(s._babylonTransformNode),s._babylonTransformNodeForSkin&&A.push(s._babylonTransformNodeForSkin);return A}_getSkeletons(){const A=[],X=this._gltf.skins;if(X)for(const s of X)s._data&&A.push(s._data.babylonSkeleton);return A}_getAnimationGroups(){const A=[],X=this._gltf.animations;if(X)for(const s of X)s._babylonAnimationGroup&&A.push(s._babylonAnimationGroup);return A}_startAnimations(){switch(this._parent.animationStartMode){case e.f.NONE:break;case e.f.FIRST:{const A=this._getAnimationGroups();0!==A.length&&A[0].start(!0);break}case e.f.ALL:{const A=this._getAnimationGroups();for(const X of A)X.start(!0);break}default:return void Q.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadNodeAsync(A,X,s);if(N)return N;if(X._babylonTransformNode)throw new Error(`${A}: Invalid recursive node hierarchy`);const f=new Array;this.logOpen(`${A} ${X.name||""}`);const E=N=>{if(Z.AddPointerMetadata(N,A),Z._LoadTransform(X,N),void 0!=X.camera){const s=p.Get(`${A}/camera`,this._gltf.cameras,X.camera);f.push(this.loadCameraAsync(`/cameras/${s.index}`,s,(A=>{A.parent=N,this._babylonScene.useRightHandedSystem||(N.hi.x=-1)})))}if(X.children)for(const s of X.children){const X=p.Get(`${A}/children/${s}`,this._gltf.nodes,s);f.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(A=>{A.parent=N})))}s(N)},g=void 0!=X.mesh,K=this._parent.loadSkins&&void 0!=X.skin;if(!g||K){const A=X.name||`node${X.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new G.c(A,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==X.mesh?X._babylonTransformNode=s:X._babylonTransformNodeForSkin=s,E(s)}if(g)if(K){const s=p.Get(`${A}/mesh`,this._gltf.meshes,X.mesh);f.push(this._loadMeshAsync(`/meshes/${s.index}`,X,s,(s=>{const N=X._babylonTransformNodeForSkin;s.metadata=q(N.metadata,s.metadata||{});const E=p.Get(`${A}/skin`,this._gltf.skins,X.skin);f.push(this._loadSkinAsync(`/skins/${E.index}`,X,E,(A=>{this._forEachPrimitive(X,(X=>{X.skeleton=A})),this._postSceneLoadActions.push((()=>{if(void 0!=E.skeleton){const A=p.Get(`/skins/${E.index}/skeleton`,this._gltf.nodes,E.skeleton).parent;X.index===A.index?s.parent=N.parent:s.parent=A._babylonTransformNode}else s.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:N,skinnedNode:s})}))})))})))}else{const s=p.Get(`${A}/mesh`,this._gltf.meshes,X.mesh);f.push(this._loadMeshAsync(`/meshes/${s.index}`,X,s,E))}return this.logClose(),Promise.all(f).then((()=>(this._forEachPrimitive(X,(A=>{const X=A;!X.isAnInstance&&X.pi&&X.pi.useBoundingInfoFromGeometry?A.Ea():A.refreshBoundingInfo(!0,!0)})),X._babylonTransformNode)))}_loadMeshAsync(A,X,s,N){const f=s.primitives;if(!f||!f.length)throw new Error(`${A}: Primitives are missing`);void 0==f[0].index&&p.Assign(f);const E=new Array;this.logOpen(`${A} ${s.name||""}`);const g=X.name||`node${X.index}`;if(1===f.length){const N=s.primitives[0];E.push(this._loadMeshPrimitiveAsync(`${A}/primitives/${N.index}`,g,X,s,N,(A=>{X._babylonTransformNode=A,X._primitiveBabylonMeshes=[A]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,X._babylonTransformNode=new G.c(g,this._babylonScene),X._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._primitiveBabylonMeshes=[];for(const N of f)E.push(this._loadMeshPrimitiveAsync(`${A}/primitives/${N.index}`,`${g}_primitive${N.index}`,X,s,N,(A=>{A.parent=X._babylonTransformNode,X._primitiveBabylonMeshes.push(A)})))}return N(X._babylonTransformNode),this.logClose(),Promise.all(E).then((()=>X._babylonTransformNode))}_loadMeshPrimitiveAsync(A,X,s,N,f,E){const g=this._extensionsLoadMeshPrimitiveAsync(A,X,s,N,f,E);if(g)return g;this.logOpen(`${A}`);const K=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==s.skin&&!N.primitives[0].targets;let r,i;if(K&&f._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,r=f._instanceData.babylonSourceMesh.createInstance(X),r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i=f._instanceData.promise;else{const E=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new P.d(X,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.sideOrientation=this._babylonScene.useRightHandedSystem?C.c.CounterClockWiseSideOrientation:C.c.ClockWiseSideOrientation,this._createMorphTargets(A,s,N,f,g),E.push(this._loadVertexDataAsync(A,f,g).then((async X=>await this._loadMorphTargetsAsync(A,f,g,X).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,X.Ca(g),X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const Y=Z._GetDrawMode(A,f.mode);if(void 0==f.material){let A=this._defaultBabylonMaterialData[Y];A||(A=this._createDefaultMaterial("__GLTFLoader._default",Y),this._parent.onMaterialLoadedObservable.notifyObservers(A),this._defaultBabylonMaterialData[Y]=A),g.material=A}else if(!this.parent.skipMaterials){const X=p.Get(`${A}/material`,this._gltf.materials,f.material);E.push(this._loadMaterialAsync(`/materials/${X.index}`,X,g,Y,(A=>{g.material=A})))}i=Promise.all(E),K&&(f._instanceData={babylonSourceMesh:g,promise:i}),r=g}return Z.AddPointerMetadata(r,A),this._parent.onMeshLoadedObservable.notifyObservers(r),E(r),this.logClose(),i.then((()=>r))}_loadVertexDataAsync(A,X,s){const N=this._extensionsLoadVertexDataAsync(A,X,s);if(N)return N;const f=X.attributes;if(!f)throw new Error(`${A}: Attributes are missing`);const E=new Array,g=new D.b(s.name,this._babylonScene);if(void 0==X.indices)s.isUnIndexed=!0;else{const s=p.Get(`${A}/indices`,this._gltf.accessors,X.indices);E.push(this._loadIndicesAccessorAsync(`/accessors/${s.index}`,s).then((A=>{g.setIndices(A)})))}const K=(X,N,K)=>{if(void 0==f[X])return;s._delayInfo=s._delayInfo||[],-1===s._delayInfo.indexOf(N)&&s._delayInfo.push(N);const r=p.Get(`${A}/attributes/${X}`,this._gltf.accessors,f[X]);E.push(this._loadVertexAccessorAsync(`/accessors/${r.index}`,r,N).then((A=>{if(A.getKind()===V.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!s.skeleton){const A=B(r);A&&(g._boundingInfo=A,g.useBoundingInfoFromGeometry=!0)}g.setVerticesBuffer(A,r.count)}))),N==V.e.MatricesIndicesExtraKind&&(s.numBoneInfluencers=8),K&&K(r)};return K("POSITION",V.e.PositionKind),K("NORMAL",V.e.NormalKind),K("TANGENT",V.e.TangentKind),K("TEXCOORD_0",V.e.UVKind),K("TEXCOORD_1",V.e.UV2Kind),K("TEXCOORD_2",V.e.UV3Kind),K("TEXCOORD_3",V.e.UV4Kind),K("TEXCOORD_4",V.e.UV5Kind),K("TEXCOORD_5",V.e.UV6Kind),K("JOINTS_0",V.e.MatricesIndicesKind),K("WEIGHTS_0",V.e.MatricesWeightsKind),K("JOINTS_1",V.e.MatricesIndicesExtraKind),K("WEIGHTS_1",V.e.MatricesWeightsExtraKind),K("COLOR_0",V.e.ColorKind,(A=>{"VEC4"===A.type&&(s.hasVertexAlpha=!0)})),Promise.all(E).then((()=>g))}_createMorphTargets(A,X,s,N,f){if(!N.targets||!this._parent.loadMorphTargets)return;if(void 0==X._numMorphTargets)X._numMorphTargets=N.targets.length;else if(N.targets.length!==X._numMorphTargets)throw new Error(`${A}: Primitives do not have the same number of targets`);const E=s.extras?s.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,f.morphTargetManager=new t(this._babylonScene),f.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f.morphTargetManager.areUpdatesFrozen=!0;for(let g=0;g<N.targets.length;g++){const A=X.weights?X.weights[g]:s.weights?s.weights[g]:0,N=E?E[g]:`morphTarget${g}`;f.morphTargetManager.addTarget(new l(N,A,f.va()))}}_loadMorphTargetsAsync(A,X,s,N){if(!X.targets||!this._parent.loadMorphTargets)return Promise.resolve();const f=new Array,E=s.morphTargetManager;for(let g=0;g<E.numTargets;g++){const s=E.getTarget(g);f.push(this._loadMorphTargetVertexDataAsync(`${A}/targets/${g}`,N,X.targets[g],s))}return Promise.all(f).then((()=>{E.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(A,X,s,N){const f=new Array,E=(N,E,g)=>{if(void 0==s[N])return;const K=X.getVertexBuffer(E);if(!K)return;const r=p.Get(`${A}/${N}`,this._gltf.accessors,s[N]);f.push(this._loadFloatAccessorAsync(`/accessors/${r.index}`,r).then((A=>{g(K,A)})))};return E("POSITION",V.e.PositionKind,((A,X)=>{const s=new Float32Array(X.length);A.forEach(X.length,((A,N)=>{s[N]=X[N]+A})),N.setPositions(s)})),E("NORMAL",V.e.NormalKind,((A,X)=>{const s=new Float32Array(X.length);A.forEach(s.length,((A,N)=>{s[N]=X[N]+A})),N.setNormals(s)})),E("TANGENT",V.e.TangentKind,((A,X)=>{const s=new Float32Array(X.length/3*4);let f=0;A.forEach(X.length/3*4,((A,N)=>{(N+1)%4!==0&&(s[f]=X[f]+A,f++)})),N.setTangents(s)})),E("TEXCOORD_0",V.e.UVKind,((A,X)=>{const s=new Float32Array(X.length);A.forEach(X.length,((A,N)=>{s[N]=X[N]+A})),N.setUVs(s)})),E("TEXCOORD_1",V.e.UV2Kind,((A,X)=>{const s=new Float32Array(X.length);A.forEach(X.length,((A,N)=>{s[N]=X[N]+A})),N.setUV2s(s)})),E("COLOR_0",V.e.ColorKind,((X,s)=>{let f=null;const E=X.getSize();if(3===E){f=new Float32Array(s.length/3*4),X.forEach(s.length,((A,X)=>{const N=Math.floor(X/3),E=X%3;f[4*N+E]=s[3*N+E]+A}));for(let A=0;A<s.length/3;++A)f[4*A+3]=1}else{if(4!==E)throw new Error(`${A}: Invalid number of components (${E}) for COLOR_0 attribute`);f=new Float32Array(s.length),X.forEach(s.length,((A,X)=>{f[X]=s[X]+A}))}N.setColors(f)})),await Promise.all(f).then((()=>{}))}static _LoadTransform(A,X){if(void 0!=A.skin)return;let s=f.k.Zero(),N=f.d.Identity(),E=f.k.One();if(A.matrix){f.c.mi(A.matrix).decompose(E,N,s)}else A.translation&&(s=f.k.mi(A.translation)),A.rotation&&(N=f.d.mi(A.rotation)),A.scale&&(E=f.k.mi(A.scale));X.position=s,X.rotationQuaternion=N,X.hi=E}_loadSkinAsync(A,X,s,N){if(!this._parent.loadSkins)return Promise.resolve();const f=this._extensionsLoadSkinAsync(A,X,s);if(f)return f;if(s._data)return N(s._data.babylonSkeleton),s._data.promise;const E=`skeleton${s.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new R(s.name||E,E,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(A,s,g);const K=this._loadSkinInverseBindMatricesDataAsync(A,s).then((A=>{this._updateBoneMatrices(g,A)}));return s._data={babylonSkeleton:g,promise:K},N(g),K}_loadBones(A,X,s){if(void 0==X.skeleton||this._parent.alwaysComputeSkeletonRootNode){const s=this._findSkeletonRootNode(`${A}/joints`,X.joints);if(s)if(void 0===X.skeleton)X.skeleton=s.index;else{const N=(A,X)=>{for(;X.parent;X=X.parent)if(X.parent===A)return!0;return!1},f=p.Get(`${A}/skeleton`,this._gltf.nodes,X.skeleton);f===s||N(f,s)||(Q.b.Warn(`${A}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),X.skeleton=s.index)}else Q.b.Warn(`${A}: Failed to find common root`)}const N={};for(const f of X.joints){const E=p.Get(`${A}/joints/${f}`,this._gltf.nodes,f);this._loadBone(E,X,s,N)}}_findSkeletonRootNode(A,X){if(0===X.length)return null;const s={};for(const f of X){const X=[];let N=p.Get(`${A}/${f}`,this._gltf.nodes,f);for(;-1!==N.index;)X.unshift(N),N=N.parent;s[f]=X}let N=null;for(let f=0;;++f){let A=s[X[0]];if(f>=A.length)return N;const E=A[f];for(let g=1;g<X.length;++g)if(A=s[X[g]],f>=A.length||E!==A[f])return N;N=E}}_loadBone(A,X,s,N){A._isJoint=!0;let f=N[A.index];if(f)return f;let E=null;A.index!==X.skeleton&&(A.parent&&-1!==A.parent.index?E=this._loadBone(A.parent,X,s,N):void 0!==X.skeleton&&Q.b.Warn(`/skins/${X.index}/skeleton: Skeleton node is not a common root`));const g=X.joints.indexOf(A.index);return f=new i.b(A.name||`joint${A.index}`,s,E,this._getNodeMatrix(A),null,null,g),N[A.index]=f,this._postSceneLoadActions.push((()=>{f.linkTransformNode(A._babylonTransformNode)})),f}_loadSkinInverseBindMatricesDataAsync(A,X){if(void 0==X.inverseBindMatrices)return Promise.resolve(null);const s=p.Get(`${A}/inverseBindMatrices`,this._gltf.accessors,X.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${s.index}`,s)}_updateBoneMatrices(A,X){for(const s of A.bones){const A=f.c.Identity(),N=s._index;X&&-1!==N&&(f.c.FromArrayToRef(X,16*N,A),A.invertToRef(A));const E=s.getParent();E&&A.multiplyToRef(E.getAbsoluteInverseBindMatrix(),A),s.Yi(A,!1,!1),s._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(A){return A.matrix?f.c.mi(A.matrix):f.c.Compose(A.scale?f.k.mi(A.scale):f.k.One(),A.rotation?f.d.mi(A.rotation):f.d.Identity(),A.translation?f.k.mi(A.translation):f.k.Zero())}loadCameraAsync(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadCameraAsync(A,X,s);if(N)return N;const E=new Array;this.logOpen(`${A} ${X.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new r.b(X.name||`camera${X.index}`,f.k.Zero(),this._babylonScene,!1);switch(g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonCamera=g,g.setTarget(new f.k(0,0,-1)),X.type){case"perspective":{const s=X.perspective;if(!s)throw new Error(`${A}: Camera perspective properties are missing`);g.fov=s.yfov,g.ui=s.znear,g.maxZ=s.zfar||0;break}case"orthographic":if(!X.orthographic)throw new Error(`${A}: Camera orthographic properties are missing`);g.mode=K.b.ORTHOGRAPHIC_CAMERA,g.orthoLeft=-X.orthographic.xmag,g.orthoRight=X.orthographic.xmag,g.orthoBottom=-X.orthographic.ymag,g.orthoTop=X.orthographic.ymag,g.ui=X.orthographic.znear,g.maxZ=X.orthographic.zfar;break;default:throw new Error(`${A}: Invalid camera type (${X.type})`)}return Z.AddPointerMetadata(g,A),this._parent.onCameraLoadedObservable.notifyObservers(g),s(g),this.logClose(),Promise.all(E).then((()=>g))}_loadAnimationsAsync(){const A=this._gltf.animations;if(!A)return Promise.resolve();const X=new Array;for(let s=0;s<A.length;s++){const N=A[s];X.push(this.loadAnimationAsync(`/animations/${N.index}`,N).then((A=>{0===A.targetedAnimations.length&&A.dispose()})))}return Promise.all(X).then((()=>{}))}loadAnimationAsync(A,X){const N=this._extensionsLoadAnimationAsync(A,X);return N||s.e(49).then(s.bind(s,13709)).then((s=>{let{AnimationGroup:N}=s;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new N(X.name||`animation${X.index}`,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonAnimationGroup=f;const E=new Array;p.Assign(X.channels),p.Assign(X.samplers);for(const g of X.channels)E.push(this._loadAnimationChannelAsync(`${A}/channels/${g.index}`,A,X,g,((A,X)=>{A.animations=A.animations||[],A.animations.push(X),f.addTargetedAnimation(X,A)})));return Promise.all(E).then((()=>(f.normalize(0),f)))}))}async _loadAnimationChannelAsync(A,X,N,f,E){const g=this._extensionsLoadAnimationChannelAsync(A,X,N,f,E);if(g)return await g;if(void 0==f.target.node)return await Promise.resolve();const K=p.Get(`${A}/target/node`,this._gltf.nodes,f.target.node),r=f.target.path,i="weights"===r;if(i&&!K._numMorphTargets||!i&&!K._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!i&&!K._isJoint)return await Promise.resolve();let Y;switch(await Promise.resolve().then(s.bind(s,12629)),r){case"translation":var v;Y=null===(v=(0,F.d)("/nodes/{}/translation"))||void 0===v?void 0:v.interpolation;break;case"rotation":var c;Y=null===(c=(0,F.d)("/nodes/{}/rotation"))||void 0===c?void 0:c.interpolation;break;case"scale":var M;Y=null===(M=(0,F.d)("/nodes/{}/scale"))||void 0===M?void 0:M.interpolation;break;case"weights":var d;Y=null===(d=(0,F.d)("/nodes/{}/weights"))||void 0===d?void 0:d.interpolation;break;default:throw new Error(`${A}/target/path: Invalid value (${f.target.path})`)}if(!Y)throw new Error(`${A}/target/path: Could not find interpolation properties for target path (${f.target.path})`);const Q={object:K,info:Y};return await this._loadAnimationChannelFromTargetInfoAsync(A,X,N,f,Q,E)}_loadAnimationChannelFromTargetInfoAsync(A,X,s,N,f,E){const g=this.parent.targetFps,K=1/g,r=p.Get(`${A}/sampler`,s.samplers,N.sampler);return this._loadAnimationSamplerAsync(`${X}/samplers/${N.sampler}`,r).then((A=>{let X=0;const r=f.object,i=f.info;for(const f of i){const i=f.getStride(r),Y=A.input,v=A.output,c=new Array(Y.length);let M=0;switch(A.interpolation){case"STEP":for(let A=0;A<Y.length;A++){const X=f.getValue(r,v,M,1);M+=i,c[A]={frame:Y[A]*g,value:X,interpolation:1}}break;case"CUBICSPLINE":for(let A=0;A<Y.length;A++){const X=f.getValue(r,v,M,K);M+=i;const s=f.getValue(r,v,M,1);M+=i;const N=f.getValue(r,v,M,K);M+=i,c[A]={frame:Y[A]*g,inTangent:X,value:s,outTangent:N}}break;case"LINEAR":for(let A=0;A<Y.length;A++){const X=f.getValue(r,v,M,1);M+=i,c[A]={frame:Y[A]*g,value:X}}}if(M>0){const A=`${s.name||`animation${s.index}`}_channel${N.index}_${X}`,K=f.buildAnimations(r,A,g,c);for(const s of K)X++,E(s.babylonAnimatable,s.babylonAnimation)}}}))}_loadAnimationSamplerAsync(A,X){if(X._data)return X._data;const s=X.interpolation||"LINEAR";switch(s){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${A}/interpolation: Invalid value (${X.interpolation})`)}const N=p.Get(`${A}/input`,this._gltf.accessors,X.input),f=p.Get(`${A}/output`,this._gltf.accessors,X.output);return X._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${N.index}`,N),this._loadFloatAccessorAsync(`/accessors/${f.index}`,f)]).then((A=>{let[X,N]=A;return{input:X,interpolation:s,output:N}})),X._data}loadBufferAsync(A,X,s,N){const f=this._extensionsLoadBufferAsync(A,X,s,N);if(f)return f;if(!X._data)if(X.uri)X._data=this.loadUriAsync(`${A}/uri`,X,X.uri);else{if(!this._bin)throw new Error(`${A}: Uri is missing or the binary glTF is missing its binary chunk`);X._data=this._bin.readAsync(0,X.byteLength)}return X._data.then((X=>{try{return new Uint8Array(X.buffer,X.byteOffset+s,N)}catch(f){throw new Error(`${A}: ${f.message}`)}}))}loadBufferViewAsync(A,X){const s=this._extensionsLoadBufferViewAsync(A,X);if(s)return s;if(X._data)return X._data;const N=p.Get(`${A}/buffer`,this._gltf.buffers,X.buffer);return X._data=this.loadBufferAsync(`/buffers/${N.index}`,N,X.byteOffset||0,X.byteLength),X._data}_loadAccessorAsync(A,X,s){if(X._data)return X._data;const N=Z._GetNumComponents(A,X.type),f=N*V.e.GetTypeByteLength(X.componentType),E=N*X.count;if(void 0==X.bufferView)X._data=Promise.resolve(new s(E));else{const g=p.Get(`${A}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((K=>{if(5126!==X.componentType||X.normalized||g.byteStride&&g.byteStride!==f){const A=new s(E);return V.e.ForEach(K,X.byteOffset||0,g.byteStride||f,N,X.componentType,A.length,X.normalized||!1,((X,s)=>{A[s]=X})),A}return Z._GetTypedArray(A,X.componentType,K,X.byteOffset,E)}))}if(X.sparse){const E=X.sparse;X._data=X._data.then((g=>{const K=g,r=p.Get(`${A}/sparse/indices/bufferView`,this._gltf.bufferViews,E.indices.bufferView),i=p.Get(`${A}/sparse/values/bufferView`,this._gltf.bufferViews,E.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${r.index}`,r),this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)]).then((g=>{let[r,i]=g;const Y=Z._GetTypedArray(`${A}/sparse/indices`,E.indices.componentType,r,E.indices.byteOffset,E.count),v=N*E.count;let c;if(5126!==X.componentType||X.normalized){const g=Z._GetTypedArray(`${A}/sparse/values`,X.componentType,i,E.values.byteOffset,v);c=new s(v),V.e.ForEach(g,0,f,N,X.componentType,c.length,X.normalized||!1,((A,X)=>{c[X]=A}))}else c=Z._GetTypedArray(`${A}/sparse/values`,X.componentType,i,E.values.byteOffset,v);let M=0;for(let A=0;A<Y.length;A++){let X=Y[A]*N;for(let A=0;A<N;A++)K[X++]=c[M++]}return K}))}))}return X._data}_loadFloatAccessorAsync(A,X){return this._loadAccessorAsync(A,X,Float32Array)}_loadIndicesAccessorAsync(A,X){if("SCALAR"!==X.type)throw new Error(`${A}/type: Invalid value ${X.type}`);if(5121!==X.componentType&&5123!==X.componentType&&5125!==X.componentType)throw new Error(`${A}/componentType: Invalid value ${X.componentType}`);if(X._data)return X._data;if(X.sparse){const s=Z._GetTypedArrayConstructor(`${A}/componentType`,X.componentType);X._data=this._loadAccessorAsync(A,X,s)}else{const s=p.Get(`${A}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((s=>Z._GetTypedArray(A,X.componentType,s,X.byteOffset,X.count)))}return X._data}_loadVertexBufferViewAsync(A){if(A._babylonBuffer)return A._babylonBuffer;const X=this._babylonScene.getEngine();return A._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((A=>new V.b(X,A,!1))),A._babylonBuffer}_loadVertexAccessorAsync(A,X,s){var N;if(null!==(N=X._babylonVertexBuffer)&&void 0!==N&&N[s])return X._babylonVertexBuffer[s];X._babylonVertexBuffer||(X._babylonVertexBuffer={});const f=this._babylonScene.getEngine();if(X.sparse||void 0==X.bufferView)X._babylonVertexBuffer[s]=this._loadFloatAccessorAsync(A,X).then((A=>new V.e(f,A,s,!1)));else{const N=p.Get(`${A}/bufferView`,this._gltf.bufferViews,X.bufferView);X._babylonVertexBuffer[s]=this._loadVertexBufferViewAsync(N).then((E=>{const g=Z._GetNumComponents(A,X.type);return new V.e(f,E,s,!1,void 0,N.byteStride,void 0,X.byteOffset,g,X.componentType,X.normalized,!0,void 0,!0)}))}return X._babylonVertexBuffer[s]}_loadMaterialMetallicRoughnessPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return X&&(X.baseColorFactor?(s.albedoColor=E.e.mi(X.baseColorFactor),s.alpha=X.baseColorFactor[3]):s.albedoColor=E.e.White(),s.metallic=void 0==X.metallicFactor?1:X.metallicFactor,s.roughness=void 0==X.roughnessFactor?1:X.roughnessFactor,X.baseColorTexture&&N.push(this.loadTextureInfoAsync(`${A}/baseColorTexture`,X.baseColorTexture,(A=>{A.name=`${s.name} (Base Color)`,s.albedoTexture=A}))),X.metallicRoughnessTexture&&(X.metallicRoughnessTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${A}/metallicRoughnessTexture`,X.metallicRoughnessTexture,(A=>{A.name=`${s.name} (Metallic Roughness)`,s.metallicTexture=A}))),s.useMetallnessFromMetallicTextureBlue=!0,s.useRoughnessFromMetallicTextureGreen=!0,s.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(N).then((()=>{}))}_loadMaterialAsync(A,X,s,N){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const E=this._extensionsLoadMaterialAsync(A,X,s,N,f);if(E)return E;X._data=X._data||{};let g=X._data[N];if(!g){this.logOpen(`${A} ${X.name||""}`);const s=this.createMaterial(A,X,N);g={babylonMaterial:s,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(A,X,s)},X._data[N]=g,Z.AddPointerMetadata(s,A),this._parent.onMaterialLoadedObservable.notifyObservers(s),this.logClose()}return s&&(g.babylonMeshes.push(s),s.Ji.addOnce((()=>{const A=g.babylonMeshes.indexOf(s);-1!==A&&g.babylonMeshes.splice(A,1)}))),f(g.babylonMaterial),g.promise.then((()=>g.babylonMaterial))}_createDefaultMaterial(A,X){this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new y(A,this._babylonScene);return s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.fillMode=X,s.enableSpecularAntiAliasing=!0,s.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,s.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,s.transparencyMode=y.PBRMATERIAL_OPAQUE,s.metallic=1,s.roughness=1,s}createMaterial(A,X,s){const N=this._extensionsCreateMaterial(A,X,s);if(N)return N;const f=X.name||`material${X.index}`;return this._createDefaultMaterial(f,s)}loadMaterialPropertiesAsync(A,X,s){const N=this._extensionsLoadMaterialPropertiesAsync(A,X,s);if(N)return N;const f=new Array;return f.push(this.loadMaterialBasePropertiesAsync(A,X,s)),X.pbrMetallicRoughness&&f.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${A}/pbrMetallicRoughness`,X.pbrMetallicRoughness,s)),this.loadMaterialAlphaProperties(A,X,s),Promise.all(f).then((()=>{}))}loadMaterialBasePropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return s.emissiveColor=X.emissiveFactor?E.e.mi(X.emissiveFactor):new E.e(0,0,0),X.doubleSided&&(s.yi=!1,s.twoSidedLighting=!0),X.normalTexture&&(X.normalTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${A}/normalTexture`,X.normalTexture,(A=>{A.name=`${s.name} (Normal)`,s.bumpTexture=A}))),s.invertNormalMapX=!this._babylonScene.useRightHandedSystem,s.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=X.normalTexture.scale&&s.bumpTexture&&(s.bumpTexture.level=X.normalTexture.scale),s.forceIrradianceInFragment=!0),X.occlusionTexture&&(X.occlusionTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${A}/occlusionTexture`,X.occlusionTexture,(A=>{A.name=`${s.name} (Occlusion)`,s.ambientTexture=A}))),s.useAmbientInGrayScale=!0,void 0!=X.occlusionTexture.strength&&(s.ambientTextureStrength=X.occlusionTexture.strength)),X.emissiveTexture&&N.push(this.loadTextureInfoAsync(`${A}/emissiveTexture`,X.emissiveTexture,(A=>{A.name=`${s.name} (Emissive)`,s.emissiveTexture=A}))),Promise.all(N).then((()=>{}))}loadMaterialAlphaProperties(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);switch(X.alphaMode||"OPAQUE"){case"OPAQUE":s.transparencyMode=y.PBRMATERIAL_OPAQUE,s.alpha=1;break;case"MASK":s.transparencyMode=y.PBRMATERIAL_ALPHATEST,s.alphaCutOff=void 0==X.alphaCutoff?.5:X.alphaCutoff,s.albedoTexture&&(s.albedoTexture.Ej=!0);break;case"BLEND":s.transparencyMode=y.PBRMATERIAL_ALPHABLEND,s.albedoTexture&&(s.albedoTexture.Ej=!0,s.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${A}/alphaMode: Invalid value (${X.alphaMode})`)}}loadTextureInfoAsync(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureInfoAsync(A,X,s);if(N)return N;if(this.logOpen(`${A}`),X.texCoord>=6)throw new Error(`${A}/texCoord: Invalid value (${X.texCoord})`);const f=p.Get(`${A}/index`,this._gltf.textures,X.index);f._textureInfo=X;const E=this._loadTextureAsync(`/textures/${X.index}`,f,(N=>{N.coordinatesIndex=X.texCoord||0,Z.AddPointerMetadata(N,A),this._parent.onTextureLoadedObservable.notifyObservers(N),s(N)}));return this.logClose(),E}_loadTextureAsync(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureAsync(A,X,s);if(N)return N;this.logOpen(`${A} ${X.name||""}`);const f=void 0==X.sampler?Z.DefaultSampler:p.Get(`${A}/sampler`,this._gltf.samplers,X.sampler),E=p.Get(`${A}/source`,this._gltf.images,X.source),g=this._createTextureAsync(A,f,E,s,void 0,!X._textureInfo.nonColorData);return this.logClose(),g}_createTextureAsync(A,X,s){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},E=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0;const K=this._loadSampler(`/samplers/${X.index}`,X),r=new Array,i=new N;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y={noMipmap:K.noMipMaps,invertY:!1,samplingMode:K.samplingMode,X:()=>{this._disposed||i.resolve()},onError:(X,s)=>{this._disposed||i.reject(new Error(`${A}: ${s&&s.message?s.message:X||"Failed to load texture"}`))},mimeType:s.mimeType??(0,T.g)(s.uri??""),loaderOptions:E,useSRGBBuffer:!!g&&this._parent.useSRGBBuffers},v=new j.d(null,this._babylonScene,Y);return v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.push(i.promise),r.push(this.loadImageAsync(`/images/${s.index}`,s).then((A=>{const X=s.uri||`${this._fileName}#image${s.index}`,N=`data:${this._uniqueRootUrl}${X}`;v.updateURL(N,A);const f=v.getInternalTexture();f&&(f.label=s.name)}))),v.wrapU=K.wrapU,v.wrapV=K.wrapV,f(v),this._parent.useGltfTextureNames&&(v.name=s.name||s.uri||`image${s.index}`),Promise.all(r).then((()=>v))}_loadSampler(A,X){return X._data||(X._data={noMipMaps:9728===X.minFilter||9729===X.minFilter,samplingMode:Z._GetTextureSamplingMode(A,X),wrapU:Z._GetTextureWrapMode(`${A}/wrapS`,X.wrapS),wrapV:Z._GetTextureWrapMode(`${A}/wrapT`,X.wrapT)}),X._data}loadImageAsync(A,X){if(!X._data){if(this.logOpen(`${A} ${X.name||""}`),X.uri)X._data=this.loadUriAsync(`${A}/uri`,X,X.uri);else{const s=p.Get(`${A}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}this.logClose()}return X._data}loadUriAsync(A,X,s){const N=this._extensionsLoadUriAsync(A,X,s);if(N)return N;if(!Z._ValidateUri(s))throw new Error(`${A}: '${s}' is invalid`);if((0,T.h)(s)){const X=new Uint8Array((0,T.d)(s));return this.log(`${A}: Decoded ${s.substring(0,64)}... (${X.length} bytes)`),Promise.resolve(X)}return this.log(`${A}: Loading ${s}`),this._parent.preprocessUrlAsync(this._rootUrl+s).then((X=>new Promise(((N,f)=>{this._parent._loadFile(this._babylonScene,X,(X=>{this._disposed||(this.log(`${A}: Loaded ${s} (${X.byteLength} bytes)`),N(new Uint8Array(X)))}),!0,(X=>{f(new T.l(`${A}: Failed to load '${s}'${X?": "+X.status+" "+X.statusText:""}`,X))}))}))))}static AddPointerMetadata(A,X){A.metadata=A.metadata||{};const s=A._internalMetadata=A._internalMetadata||{},N=s.Gi=s.Gi||{};(N.pointers=N.pointers||[]).push(X)}static _GetTextureWrapMode(A,X){switch(X=void 0==X?10497:X){case 33071:return j.d.CLAMP_ADDRESSMODE;case 33648:return j.d.MIRROR_ADDRESSMODE;case 10497:return j.d.WRAP_ADDRESSMODE;default:return Q.b.Warn(`${A}: Invalid value (${X})`),j.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(A,X){const s=void 0==X.magFilter?9729:X.magFilter,N=void 0==X.minFilter?9987:X.minFilter;if(9729===s)switch(N){case 9728:return j.d.LINEAR_NEAREST;case 9729:return j.d.LINEAR_LINEAR;case 9984:return j.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return j.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return j.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return j.d.LINEAR_LINEAR_MIPLINEAR;default:return Q.b.Warn(`${A}/minFilter: Invalid value (${N})`),j.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==s&&Q.b.Warn(`${A}/magFilter: Invalid value (${s})`),N){case 9728:return j.d.NEAREST_NEAREST;case 9729:return j.d.NEAREST_LINEAR;case 9984:return j.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return j.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return j.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return j.d.NEAREST_LINEAR_MIPLINEAR;default:return Q.b.Warn(`${A}/minFilter: Invalid value (${N})`),j.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(A,X){try{return(0,S.j)(X)}catch(s){throw new Error(`${A}: ${s.message}`)}}static _GetTypedArray(A,X,s,N,f){const E=s.buffer;N=s.byteOffset+(N||0);const g=Z._GetTypedArrayConstructor(`${A}/componentType`,X),K=V.e.GetTypeByteLength(X);return N%K!==0?(Q.b.Warn(`${A}: Copying buffer as byte offset (${N}) is not a multiple of component type byte length (${K})`),new g(E.slice(N,N+f*K),0)):new g(E,N,f)}static _GetNumComponents(A,X){switch(X){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${A}: Invalid type (${X})`)}static _ValidateUri(A){return g.d.IsBase64(A)||-1===A.indexOf("..")}static _GetDrawMode(A,X){switch(void 0==X&&(X=4),X){case 0:return C.c.PointListDrawMode;case 1:return C.c.LineListDrawMode;case 2:return C.c.LineLoopDrawMode;case 3:return C.c.LineStripDrawMode;case 4:return C.c.TriangleFillMode;case 5:return C.c.TriangleStripDrawMode;case 6:return C.c.TriangleFanDrawMode}throw new Error(`${A}: Invalid mesh primitive mode (${X})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const A=new Array;if(this._gltf.materials)for(const X of this._gltf.materials)if(X._data)for(const s in X._data){const N=X._data[s];for(const X of N.babylonMeshes){X.si(!0);const s=N.babylonMaterial;A.push(s.forceCompilationAsync(X)),A.push(s.forceCompilationAsync(X,{useInstances:!0})),this._parent.useClipPlane&&(A.push(s.forceCompilationAsync(X,{clipPlane:!0})),A.push(s.forceCompilationAsync(X,{clipPlane:!0,useInstances:!0})))}}return Promise.all(A).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const A=new Array,X=this._babylonScene.lights;for(const s of X){const X=s.getShadowGenerator();X&&A.push(X.forceCompilationAsync())}return Promise.all(A).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(A){for(const X of this._extensions)X.enabled&&A(X)}_applyExtensions(A,X,s){for(const N of this._extensions)if(N.enabled){const f=`${N.name}.${X}`,E=A;E._activeLoaderExtensionFunctions=E._activeLoaderExtensionFunctions||{};const g=E._activeLoaderExtensionFunctions;if(!g[f]){g[f]=!0;try{const A=s(N);if(A)return A}finally{delete g[f]}}}return null}_extensionsOnLoading(){this._forEachExtensions((A=>A.onLoading&&A.onLoading()))}_extensionsOnReady(){this._forEachExtensions((A=>A.onReady&&A.onReady()))}_extensionsLoadSceneAsync(A,X){return this._applyExtensions(X,"loadScene",(s=>s.loadSceneAsync&&s.loadSceneAsync(A,X)))}_extensionsLoadNodeAsync(A,X,s){return this._applyExtensions(X,"loadNode",(N=>N.loadNodeAsync&&N.loadNodeAsync(A,X,s)))}_extensionsLoadCameraAsync(A,X,s){return this._applyExtensions(X,"loadCamera",(N=>N.loadCameraAsync&&N.loadCameraAsync(A,X,s)))}_extensionsLoadVertexDataAsync(A,X,s){return this._applyExtensions(X,"loadVertexData",(N=>N._loadVertexDataAsync&&N._loadVertexDataAsync(A,X,s)))}_extensionsLoadMeshPrimitiveAsync(A,X,s,N,f,E){return this._applyExtensions(f,"loadMeshPrimitive",(g=>g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(A,X,s,N,f,E)))}_extensionsLoadMaterialAsync(A,X,s,N,f){return this._applyExtensions(X,"loadMaterial",(E=>E._loadMaterialAsync&&E._loadMaterialAsync(A,X,s,N,f)))}_extensionsCreateMaterial(A,X,s){return this._applyExtensions(X,"createMaterial",(N=>N.createMaterial&&N.createMaterial(A,X,s)))}_extensionsLoadMaterialPropertiesAsync(A,X,s){return this._applyExtensions(X,"loadMaterialProperties",(N=>N.loadMaterialPropertiesAsync&&N.loadMaterialPropertiesAsync(A,X,s)))}_extensionsLoadTextureInfoAsync(A,X,s){return this._applyExtensions(X,"loadTextureInfo",(N=>N.loadTextureInfoAsync&&N.loadTextureInfoAsync(A,X,s)))}_extensionsLoadTextureAsync(A,X,s){return this._applyExtensions(X,"loadTexture",(N=>N._loadTextureAsync&&N._loadTextureAsync(A,X,s)))}_extensionsLoadAnimationAsync(A,X){return this._applyExtensions(X,"loadAnimation",(s=>s.loadAnimationAsync&&s.loadAnimationAsync(A,X)))}_extensionsLoadAnimationChannelAsync(A,X,s,N,f){return this._applyExtensions(s,"loadAnimationChannel",(E=>E._loadAnimationChannelAsync&&E._loadAnimationChannelAsync(A,X,s,N,f)))}_extensionsLoadSkinAsync(A,X,s){return this._applyExtensions(s,"loadSkin",(N=>N._loadSkinAsync&&N._loadSkinAsync(A,X,s)))}_extensionsLoadUriAsync(A,X,s){return this._applyExtensions(X,"loadUri",(N=>N._loadUriAsync&&N._loadUriAsync(A,X,s)))}_extensionsLoadBufferViewAsync(A,X){return this._applyExtensions(X,"loadBufferView",(s=>s.loadBufferViewAsync&&s.loadBufferViewAsync(A,X)))}_extensionsLoadBufferAsync(A,X,s,N){return this._applyExtensions(X,"loadBuffer",(f=>f.loadBufferAsync&&f.loadBufferAsync(A,X,s,N)))}static LoadExtensionAsync(A,X,s,N){if(!X.extensions)return null;const f=X.extensions[s];return f?N(`${A}/extensions/${s}`,f):null}static LoadExtraAsync(A,X,s,N){if(!X.extras)return null;const f=X.extras[s];return f?N(`${A}/extras/${s}`,f):null}isExtensionUsed(A){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(A)}logOpen(A){this._parent._logOpen(A)}logClose(){this._parent._logClose()}log(A){this._parent._log(A)}startPerformanceCounter(A){this._parent._startPerformanceCounter(A)}endPerformanceCounter(A){this._parent._endPerformanceCounter(A)}}Z.DefaultSampler={index:-1},e.b._CreateGLTF2Loader=A=>new Z(A);var o=s(12629),W=s(2239),h=s(2410),AA=s(12635);class XA extends AA.d{constructor(A,X,s){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",A),this._texture=A.getEngine().createRawCubeTexture(X,s,N,f,E,g,K,r)}update(A,X,s,N){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,A,X,s,N,f)}updateRGBDAsync(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,h.p)(this._texture,A,X,s,N).then((()=>{}))}clone(){return b.c.Clone((()=>{const A=this.va(),X=this._texture,s=new XA(A,X._bufferViewArray,X.width,X.format,X.type,X.generateMipMaps,X.invertY,X.samplingMode,X._compression);return 13===X.source&&s.updateRGBDAsync(X._bufferViewArrayArray,X._sphericalPolynomial,X._lodGenerationScale,X._lodGenerationOffset),s}),this)}}const sA="EXT_lights_image_based";class NA{constructor(A){this.name=sA,this._loader=A,this.enabled=this._loader.isExtensionUsed(sA)}dispose(){this._loader=null,delete this._lights}onLoading(){const A=this._loader.Gi.extensions;if(A&&A[this.name]){const X=A[this.name];this._lights=X.lights}}loadSceneAsync(A,X){return Z.LoadExtensionAsync(A,X,this.name,(async(s,N)=>{this._loader._allMaterialsDirtyRequired=!0;const f=new Array;f.push(this._loader.loadSceneAsync(A,X)),this._loader.logOpen(`${s}`);const E=p.Get(`${s}/light`,this._lights,N.ab);return f.push(this._loadLightAsync(`/extensions/${this.name}/lights/${N.ab}`,E).then((A=>{this._loader.babylonScene.environmentTexture=A}))),this._loader.logClose(),await Promise.all(f).then((()=>{}))}))}_loadLightAsync(A,X){if(!X._loaded){const s=new Array;this._loader.logOpen(`${A}`);const N=new Array(X.specularImages.length);for(let f=0;f<X.specularImages.length;f++){const E=X.specularImages[f];N[f]=new Array(E.length);for(let X=0;X<E.length;X++){const g=`${A}/specularImages/${f}/${X}`;this._loader.logOpen(`${g}`);const K=E[X],r=p.Get(g,this._loader.Gi.images,K);s.push(this._loader.loadImageAsync(`/images/${K}`,r).then((A=>{N[f][X]=A}))),this._loader.logClose()}}this._loader.logClose(),X._loaded=Promise.all(s).then((async()=>{const s=new XA(this._loader.babylonScene,null,X.specularImageSize);if(s.name=X.name||"environment",X._babylonTexture=s,void 0!=X.Il&&(s.level=X.Il),X.rotation){let A=f.d.mi(X.rotation);this._loader.babylonScene.useRightHandedSystem||(A=f.d.Inverse(A)),f.c.FromQuaternionToRef(A,s.getReflectionTextureMatrix())}if(!X.irradianceCoefficients)throw new Error(`${A}: Irradiance coefficients are missing`);const E=W.c.mi(X.irradianceCoefficients);E.scaleInPlace(X.Il),E.convertIrradianceToLambertianRadiance();const g=W.d.FromHarmonics(E),K=(N.length-1)/Math.log2(X.specularImageSize);return await s.updateRGBDAsync(N,g,K)}))}return X._loaded.then((()=>X._babylonTexture))}}H(sA),x(sA,!0,(A=>new NA(A)));s(444);const fA="EXT_mesh_gpu_instancing";class EA{constructor(A){this.name=fA,this._loader=A,this.enabled=this._loader.isExtensionUsed(fA)}dispose(){this._loader=null}loadNodeAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(A,N)=>{this._loader._disableInstancedMesh++;const E=this._loader.loadNodeAsync(`/nodes/${X.index}`,X,s);if(this._loader._disableInstancedMesh--,!X._primitiveBabylonMeshes)return await E;const g=new Array;let K=0;const r=X=>{if(void 0==N.attributes[X])return void g.push(Promise.resolve(null));const s=p.Get(`${A}/attributes/${X}`,this._loader.Gi.accessors,N.attributes[X]);if(g.push(this._loader._loadFloatAccessorAsync(`/accessors/${s.bufferView}`,s)),0===K)K=s.count;else if(K!==s.count)throw new Error(`${A}/attributes: Instance buffer accessors do not have the same count.`)};return r("TRANSLATION"),r("ROTATION"),r("SCALE"),await E.then((async A=>{const[s,N,E]=await Promise.all(g),r=new Float32Array(16*K);f.f.oi[0].gi(0,0,0),f.f.Quaternion[0].gi(0,0,0,1),f.f.oi[1].gi(1,1,1);for(let X=0;X<K;++X)s&&f.k.FromArrayToRef(s,3*X,f.f.oi[0]),N&&f.d.FromArrayToRef(N,4*X,f.f.Quaternion[0]),E&&f.k.FromArrayToRef(E,3*X,f.f.oi[1]),f.c.ComposeToRef(f.f.oi[1],f.f.Quaternion[0],f.f.oi[0],f.f.Matrix[0]),f.f.Matrix[0].copyToArray(r,16*X);for(const f of X._primitiveBabylonMeshes)f.ki("matrix",r,16,!0);return A}))}))}}H(fA),x(fA,!0,(A=>new EA(A)));let gA=0,KA=null;class rA{static get Default(){return rA._Default||(rA._Default=new rA),rA._Default}constructor(){const A=rA.Configuration.decoder;this._decoderModulePromise=g.d.LoadBabylonScriptAsync(A.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(A,X,s,N,f){await this._decoderModulePromise,0===gA&&(MeshoptDecoder.useWorkers(1),gA=1);const E=await MeshoptDecoder.decodeGltfBufferAsync(X,s,A,N,f);return null!==KA&&clearTimeout(KA),KA=setTimeout((()=>{MeshoptDecoder.useWorkers(0),gA=0,KA=null}),1e3),E}}rA.Configuration={decoder:{url:`${g.d._DefaultCdnUrl}/meshopt_decoder.js`}},rA._Default=null;const iA="EXT_meshopt_compression";class YA{constructor(A){this.name=iA,this.enabled=A.isExtensionUsed(iA),this._loader=A}dispose(){this._loader=null}loadBufferViewAsync(A,X){return Z.LoadExtensionAsync(A,X,this.name,(async(s,N)=>{const f=X;if(f._meshOptData)return await f._meshOptData;const E=p.Get(`${A}/buffer`,this._loader.Gi.buffers,N.buffer);return f._meshOptData=this._loader.loadBufferAsync(`/buffers/${E.index}`,E,N.byteOffset||0,N.byteLength).then((async A=>await rA.Default.decodeGltfBufferAsync(A,N.count,N.byteStride,N.mode,N.filter))),await f._meshOptData}))}}H(iA),x(iA,!0,(A=>new YA(A)));const vA="EXT_texture_webp";class cA{constructor(A){this.name=vA,this._loader=A,this.enabled=A.isExtensionUsed(vA)}dispose(){this._loader=null}_loadTextureAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=void 0==X.sampler?Z.DefaultSampler:p.Get(`${A}/sampler`,this._loader.Gi.samplers,X.sampler),g=p.Get(`${N}/source`,this._loader.Gi.images,f.source);return await this._loader._createTextureAsync(A,E,g,(A=>{s(A)}),void 0,!X._textureInfo.nonColorData)}))}}H(vA),x(vA,!0,(A=>new cA(A)));const MA="EXT_texture_avif";class dA{constructor(A){this.name=MA,this._loader=A,this.enabled=A.isExtensionUsed(MA)}dispose(){this._loader=null}_loadTextureAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=void 0==X.sampler?Z.DefaultSampler:p.Get(`${A}/sampler`,this._loader.Gi.samplers,X.sampler),g=p.Get(`${N}/source`,this._loader.Gi.images,f.source);return await this._loader._createTextureAsync(A,E,g,(A=>{s(A)}),void 0,!X._textureInfo.nonColorData)}))}}H(MA),x(MA,!0,(A=>new dA(A)));var QA=s(12615),wA=s(12599);const RA="EXT_lights_ies";class CA{constructor(A){this.name=RA,this._loader=A,this.enabled=this._loader.isExtensionUsed(RA)}dispose(){this._loader=null,delete this._lights}onLoading(){const A=this._loader.Gi.extensions;if(A&&A[this.name]){const X=A[this.name];this._lights=X.lights,p.Assign(this._lights)}}loadNodeAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,g)=>{let K,r;this._loader._allMaterialsDirtyRequired=!0;const i=await this._loader.loadNodeAsync(A,X,(A=>{r=p.Get(N,this._lights,g.ab);const X=r.name||A.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,K=new QA.c(X,f.k.Zero(),f.k.Backward(),0,1,this._loader.babylonScene),K.angle=Math.PI/2,K.innerAngle=0,K._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,r._babylonLight=K,K.falloffType=wA.b.FALLOFF_GLTF,K.Qk=g.color?E.e.mi(g.color):E.e.White(),K.Il=g.multiplier||1,K.range=Number.MAX_VALUE,K.parent=A,this._loader._babylonLights.push(K),Z.AddPointerMetadata(K,N),s(A)}));let Y;if(r.uri)Y=await this._loader.loadUriAsync(A,r,r.uri);else{const X=p.Get(`${A}/bufferView`,this._loader.Gi.bufferViews,r.bufferView);Y=await this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}return K.iesProfileTexture=new j.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,Y,!0,void 0,void 0,void 0,void 0,".ies"),i}))}}H(RA),x(RA,!0,(A=>new CA(A)));var JA=s(12638);const aA="KHR_draco_mesh_compression";class uA{constructor(A){this.name=aA,this.useNormalizedFlagFromAccessor=!0,this._loader=A,this.enabled=JA.c.DefaultAvailable&&this._loader.isExtensionUsed(aA)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{if(void 0!=X.mode&&4!==X.mode&&5!==X.mode)throw new Error(`${A}: Unsupported mode ${X.mode}`);const E={},g={},K=(A,N)=>{const K=f.attributes[A];if(void 0!=K&&(s._delayInfo=s._delayInfo||[],-1===s._delayInfo.indexOf(N)&&s._delayInfo.push(N),E[N]=K,this.useNormalizedFlagFromAccessor)){const s=p.TryGet(this._loader.Gi.accessors,X.attributes[A]);s&&(g[N]=s.normalized||!1)}};K("POSITION",V.e.PositionKind),K("NORMAL",V.e.NormalKind),K("TANGENT",V.e.TangentKind),K("TEXCOORD_0",V.e.UVKind),K("TEXCOORD_1",V.e.UV2Kind),K("TEXCOORD_2",V.e.UV3Kind),K("TEXCOORD_3",V.e.UV4Kind),K("TEXCOORD_4",V.e.UV5Kind),K("TEXCOORD_5",V.e.UV6Kind),K("JOINTS_0",V.e.MatricesIndicesKind),K("WEIGHTS_0",V.e.MatricesWeightsKind),K("COLOR_0",V.e.ColorKind);const r=p.Get(N,this._loader.Gi.bufferViews,f.bufferView);return r._dracoBabylonGeometry||(r._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((async N=>{const f=this.dracoDecoder||JA.c.Default,K=p.TryGet(this._loader.Gi.accessors,X.attributes.POSITION),r=this._loader.parent.alwaysComputeBoundingBox||s.skeleton||!K?null:B(K);return await f._decodeMeshToGeometryForGltfAsync(s.name,this._loader.babylonScene,N,E,g,r).catch((X=>{throw new Error(`${A}: ${X.message}`)}))}))),await r._dracoBabylonGeometry}))}}H(aA),x(aA,!0,(A=>new uA(A)));var zA=s(12659),mA=s(705),bA=s(12624);mA.c.AddNodeConstructor("Light_Type_0",((A,X)=>()=>new yA(A,f.k.Zero(),X)));class yA extends bA.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(A){this._shadowAngle=A,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(A){const X=this.needCube();if(this._direction=A,this.needCube()!==X&&this._shadowGenerators){const A=this._shadowGenerators.values();for(let X=A.next();!0!==X.done;X=A.next()){X.value.recreateShadowMap()}}}constructor(A,X,s){super(A,s),this._shadowAngle=Math.PI/2,this.position=X}getClassName(){return"PointLight"}getTypeID(){return wA.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(A){if(this.direction)return super.getShadowDirection(A);switch(A){case 0:return new f.k(1,0,0);case 1:return new f.k(-1,0,0);case 2:return new f.k(0,-1,0);case 3:return new f.k(0,1,0);case 4:return new f.k(0,0,1);case 5:return new f.k(0,0,-1)}return f.k.Zero()}_setDefaultShadowProjectionMatrix(A,X,s){const N=this.va().activeCamera;if(!N)return;const E=void 0!==this.shadowMinZ?this.shadowMinZ:N.ui,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,K=this.va().getEngine().useReverseDepthBuffer;f.c.PerspectiveFovLHToRef(this.shadowAngle,1,K?g:E,K?E:g,A,!0,this._scene.getEngine().isNDCHalfZRange,void 0,K)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(A,X){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,X):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,X),this}transferToNodeMaterialEffect(A,X){return this.computeTransformedInformation()?A.setFloat3(X,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):A.setFloat3(X,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(A,X){A["POINTLIGHT"+X]=!0}}(0,J.e)([(0,a.M)()],yA.prototype,"shadowAngle",null),(0,m.f)("BABYLON.PointLight",yA);const jA="KHR_lights_punctual";class GA{constructor(A){this.name=jA,this._loader=A,this.enabled=this._loader.isExtensionUsed(jA)}dispose(){this._loader=null,delete this._lights}onLoading(){const A=this._loader.Gi.extensions;if(A&&A[this.name]){const X=A[this.name];this._lights=X.lights,p.Assign(this._lights)}}loadNodeAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,g)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(A,X,(A=>{let X;const K=p.Get(N,this._lights,g.ab),r=K.name||A.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,K.type){case"directional":{const A=new zA.e(r,f.k.Backward(),this._loader.babylonScene);A.position.ni(0),X=A;break}case"point":X=new yA(r,f.k.Zero(),this._loader.babylonScene);break;case"spot":{const A=new QA.c(r,f.k.Zero(),f.k.Backward(),0,1,this._loader.babylonScene);A.angle=2*(K.spot&&K.spot.outerConeAngle||Math.PI/4),A.innerAngle=2*(K.spot&&K.spot.innerConeAngle||0),X=A;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${N}: Invalid light type (${K.type})`)}X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,K._babylonLight=X,X.falloffType=wA.b.FALLOFF_GLTF,X.Qk=K.color?E.e.mi(K.color):E.e.White(),X.Il=void 0==K.Il?1:K.Il,X.range=void 0==K.range?Number.MAX_VALUE:K.range,X.parent=A,this._loader._babylonLights.push(X),Z.AddPointerMetadata(X,N),s(A)})))))}}H(jA),x(jA,!0,(A=>new GA(A)));const VA="KHR_materials_pbrSpecularGlossiness";class DA{constructor(A){this.name=VA,this.order=200,this._loader=A,this.enabled=this._loader.isExtensionUsed(VA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialBasePropertiesAsync(A,X,s)),E.push(this._loadSpecularGlossinessPropertiesAsync(N,f,s)),this._loader.loadMaterialAlphaProperties(A,X,s),await Promise.all(E).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return s.metallic=null,s.roughness=null,X.diffuseFactor?(s.albedoColor=E.e.mi(X.diffuseFactor),s.alpha=X.diffuseFactor[3]):s.albedoColor=E.e.White(),s.reflectivityColor=X.specularFactor?E.e.mi(X.specularFactor):E.e.White(),s.microSurface=void 0==X.glossinessFactor?1:X.glossinessFactor,X.diffuseTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/diffuseTexture`,X.diffuseTexture,(A=>{A.name=`${s.name} (Diffuse)`,s.albedoTexture=A}))),X.specularGlossinessTexture&&(N.push(this._loader.loadTextureInfoAsync(`${A}/specularGlossinessTexture`,X.specularGlossinessTexture,(A=>{A.name=`${s.name} (Specular Glossiness)`,s.reflectivityTexture=A,s.reflectivityTexture.Ej=!0}))),s.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(N).then((()=>{}))}}H(VA),x(VA,!0,(A=>new DA(A)));const OA="KHR_materials_unlit";class PA{constructor(A){this.name=OA,this.order=210,this._loader=A,this.enabled=this._loader.isExtensionUsed(OA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async()=>await this._loadUnlitPropertiesAsync(A,X,s)))}_loadUnlitPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;s.unlit=!0;const f=X.pbrMetallicRoughness;return f&&(f.baseColorFactor?(s.albedoColor=E.e.mi(f.baseColorFactor),s.alpha=f.baseColorFactor[3]):s.albedoColor=E.e.White(),f.baseColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/baseColorTexture`,f.baseColorTexture,(A=>{A.name=`${s.name} (Base Color)`,s.albedoTexture=A})))),X.doubleSided&&(s.yi=!1,s.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(A,X,s),Promise.all(N).then((()=>{}))}}H(OA),x(OA,!0,(A=>new PA(A)));const lA="KHR_materials_clearcoat";class nA{constructor(A){this.name=lA,this.order=190,this._loader=A,this.enabled=this._loader.isExtensionUsed(lA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadClearCoatPropertiesAsync(N,f,s)),await Promise.all(E)}))}_loadClearCoatPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return s.clearCoat.isEnabled=!0,s.clearCoat.useRoughnessFromMainTexture=!1,s.clearCoat.remapF0OnInterfaceChange=!1,void 0!=X.clearcoatFactor?s.clearCoat.Il=X.clearcoatFactor:s.clearCoat.Il=0,X.clearcoatTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/clearcoatTexture`,X.clearcoatTexture,(A=>{A.name=`${s.name} (ClearCoat)`,s.clearCoat.texture=A}))),void 0!=X.clearcoatRoughnessFactor?s.clearCoat.roughness=X.clearcoatRoughnessFactor:s.clearCoat.roughness=0,X.clearcoatRoughnessTexture&&(X.clearcoatRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${A}/clearcoatRoughnessTexture`,X.clearcoatRoughnessTexture,(A=>{A.name=`${s.name} (ClearCoat Roughness)`,s.clearCoat.textureRoughness=A})))),X.clearcoatNormalTexture&&(X.clearcoatNormalTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${A}/clearcoatNormalTexture`,X.clearcoatNormalTexture,(A=>{A.name=`${s.name} (ClearCoat Normal)`,s.clearCoat.bumpTexture=A}))),s.invertNormalMapX=!s.va().useRightHandedSystem,s.invertNormalMapY=s.va().useRightHandedSystem,void 0!=X.clearcoatNormalTexture.scale&&(s.clearCoat.bumpTexture.level=X.clearcoatNormalTexture.scale)),Promise.all(N).then((()=>{}))}}H(lA),x(lA,!0,(A=>new nA(A)));const UA="KHR_materials_iridescence";class tA{constructor(A){this.name=UA,this.order=195,this._loader=A,this.enabled=this._loader.isExtensionUsed(UA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadIridescencePropertiesAsync(N,f,s)),await Promise.all(E).then((()=>{}))}))}_loadIridescencePropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return s.iridescence.isEnabled=!0,s.iridescence.Il=X.iridescenceFactor??0,s.iridescence.indexOfRefraction=X.iridescenceIor??X.iridescenceIOR??1.3,s.iridescence.minimumThickness=X.iridescenceThicknessMinimum??100,s.iridescence.maximumThickness=X.iridescenceThicknessMaximum??400,X.iridescenceTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/iridescenceTexture`,X.iridescenceTexture,(A=>{A.name=`${s.name} (Iridescence)`,s.iridescence.texture=A}))),X.iridescenceThicknessTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/iridescenceThicknessTexture`,X.iridescenceThicknessTexture,(A=>{A.name=`${s.name} (Iridescence Thickness)`,s.iridescence.thicknessTexture=A}))),Promise.all(N).then((()=>{}))}}H(UA),x(UA,!0,(A=>new tA(A)));const eA="KHR_materials_anisotropy";class TA{constructor(A){this.name=eA,this.order=195,this._loader=A,this.enabled=this._loader.isExtensionUsed(eA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadIridescencePropertiesAsync(N,f,s)),await Promise.all(E)}))}async _loadIridescencePropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;s.anisotropy.isEnabled=!0,s.anisotropy.Il=X.anisotropyStrength??0,s.anisotropy.angle=X.anisotropyRotation??0,X.anisotropyTexture&&(X.anisotropyTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${A}/anisotropyTexture`,X.anisotropyTexture,(A=>{A.name=`${s.name} (Anisotropy Intensity)`,s.anisotropy.texture=A})))),await Promise.all(N)}}H(eA),x(eA,!0,(A=>new TA(A)));const IA="KHR_materials_emissive_strength";class LA{constructor(A){this.name=IA,this.order=170,this._loader=A,this.enabled=this._loader.isExtensionUsed(IA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>await this._loader.loadMaterialPropertiesAsync(A,X,s).then((()=>{this._loadEmissiveProperties(N,f,s)}))))}_loadEmissiveProperties(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);void 0!==X.emissiveStrength&&(s.emissiveIntensity=X.emissiveStrength)}}H(IA),x(IA,!0,(A=>new LA(A)));const kA="KHR_materials_sheen";class xA{constructor(A){this.name=kA,this.order=190,this._loader=A,this.enabled=this._loader.isExtensionUsed(kA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadSheenPropertiesAsync(N,f,s)),await Promise.all(E).then((()=>{}))}))}_loadSheenPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return s.sheen.isEnabled=!0,s.sheen.Il=1,void 0!=X.sheenColorFactor?s.sheen.color=E.e.mi(X.sheenColorFactor):s.sheen.color=E.e.Black(),X.sheenColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/sheenColorTexture`,X.sheenColorTexture,(A=>{A.name=`${s.name} (Sheen Color)`,s.sheen.texture=A}))),void 0!==X.sheenRoughnessFactor?s.sheen.roughness=X.sheenRoughnessFactor:s.sheen.roughness=0,X.sheenRoughnessTexture&&(X.sheenRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${A}/sheenRoughnessTexture`,X.sheenRoughnessTexture,(A=>{A.name=`${s.name} (Sheen Roughness)`,s.sheen.textureRoughness=A})))),s.sheen.albedoScaling=!0,s.sheen.useRoughnessFromMainTexture=!1,Promise.all(N).then((()=>{}))}}H(kA),x(kA,!0,(A=>new xA(A)));var HA=s(12613);const FA="KHR_materials_specular";class qA{constructor(A){this.name=FA,this.order=190,this._loader=A,this.enabled=this._loader.isExtensionUsed(FA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;if(E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadSpecularPropertiesAsync(N,f,s)),f.extensions&&f.extensions.EXT_materials_specular_edge_color&&s instanceof y){f.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(s.brdf.dielectricSpecularModel=HA.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,s.brdf.conductorSpecularModel=HA.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(E).then((()=>{}))}))}_loadSpecularPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return void 0!==X.specularFactor&&(s.metallicF0Factor=X.specularFactor),void 0!==X.specularColorFactor&&(s.metallicReflectanceColor=E.e.mi(X.specularColorFactor)),X.specularTexture&&(X.specularTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${A}/specularTexture`,X.specularTexture,(A=>{A.name=`${s.name} (Specular)`,s.metallicReflectanceTexture=A,s.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),X.specularColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/specularColorTexture`,X.specularColorTexture,(A=>{A.name=`${s.name} (Specular Color)`,s.reflectanceTexture=A}))),Promise.all(N).then((()=>{}))}}H(FA),x(FA,!0,(A=>new qA(A)));const SA="KHR_materials_ior";class pA{constructor(A){this.name=SA,this.order=180,this._loader=A,this.enabled=this._loader.isExtensionUsed(SA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadIorPropertiesAsync(N,f,s)),await Promise.all(E).then((()=>{}))}))}_loadIorPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);return void 0!==X.ior?s.indexOfRefraction=X.ior:s.indexOfRefraction=pA._DEFAULT_IOR,Promise.resolve()}}pA._DEFAULT_IOR=1.5,H(SA),x(SA,!0,(A=>new pA(A)));const BA="KHR_materials_variants";class ZA{constructor(A){this.name=BA,this._loader=A,this.enabled=this._loader.isExtensionUsed(BA)}dispose(){this._loader=null}static GetAvailableVariants(A){const X=this._GetExtensionMetadata(A);return X?Object.keys(X.variants):[]}getAvailableVariants(A){return ZA.GetAvailableVariants(A)}static SelectVariant(A,X){const s=this._GetExtensionMetadata(A);if(!s)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${BA} extension`);const N=A=>{const X=s.variants[A];if(X)for(const s of X)s.mesh.material=s.material};if(X instanceof Array)for(const f of X)N(f);else N(X);s.lastSelected=X}selectVariant(A,X){ZA.SelectVariant(A,X)}static Reset(A){const X=this._GetExtensionMetadata(A);if(!X)throw new Error(`Cannot reset on a glTF mesh that does not have the ${BA} extension`);for(const s of X.original)s.mesh.material=s.material;X.lastSelected=null}reset(A){ZA.Reset(A)}static GetLastSelectedVariant(A){const X=this._GetExtensionMetadata(A);if(!X)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${BA} extension`);return X.lastSelected}getLastSelectedVariant(A){return ZA.GetLastSelectedVariant(A)}static _GetExtensionMetadata(A){var X,s;return(null===A||void 0===A||null===(X=A._internalMetadata)||void 0===X||null===(s=X.Gi)||void 0===s?void 0:s[BA])||null}onLoading(){const A=this._loader.Gi.extensions;if(A&&A[this.name]){const X=A[this.name];this._variants=X.variants}}onReady(){const A=this._loader.rootBabylonMesh;if(A){var X;const s=this._loader.parent.extensionOptions[BA];null!==s&&void 0!==s&&s.defaultVariant&&ZA.SelectVariant(A,s.defaultVariant),null===s||void 0===s||null===(X=s.onLoaded)||void 0===X||X.call(s,{get variants(){return ZA.GetAvailableVariants(A)},get selectedVariant(){const X=ZA.GetLastSelectedVariant(A);return X?Array.isArray(X)?X[0]:X:ZA.GetAvailableVariants(A)[0]},set selectedVariant(X){ZA.SelectVariant(A,X)}})}}_loadMeshPrimitiveAsync(A,X,s,N,f,E){return Z.LoadExtensionAsync(A,f,this.name,(async(g,K)=>{const r=new Array;return r.push(this._loader._loadMeshPrimitiveAsync(A,X,s,N,f,(X=>{if(E(X),X instanceof P.d){const s=Z._GetDrawMode(A,f.mode),N=this._loader.rootBabylonMesh,E=N?N._internalMetadata=N._internalMetadata||{}:{},i=E.Gi=E.Gi||{},Y=i[BA]=i[BA]||{lastSelected:null,original:[],variants:{}};Y.original.push({mesh:X,material:X.material});for(let A=0;A<K.mappings.length;++A){const f=K.mappings[A],E=p.Get(`${g}/mappings/${A}/material`,this._loader.Gi.materials,f.material);r.push(this._loader._loadMaterialAsync(`#/materials/${f.material}`,E,X,s,(A=>{for(let s=0;s<f.variants.length;++s){const E=f.variants[s],g=p.Get(`/extensions/${BA}/variants/${E}`,this._variants,E);Y.variants[g.name]=Y.variants[g.name]||[],Y.variants[g.name].push({mesh:X,material:A}),X.onClonedObservable.add((A=>{const s=A;let f=null,E=s;do{if(E=E.parent,!E)return;f=ZA._GetExtensionMetadata(E)}while(null===f);if(N&&f===ZA._GetExtensionMetadata(N)){E._internalMetadata={};for(const A in N._internalMetadata)E._internalMetadata[A]=N._internalMetadata[A];E._internalMetadata.Gi=[];for(const A in N._internalMetadata.Gi)E._internalMetadata.Gi[A]=N._internalMetadata.Gi[A];E._internalMetadata.Gi[BA]={lastSelected:null,original:[],variants:{}};for(const A of f.original)E._internalMetadata.Gi[BA].original.push({mesh:A.mesh,material:A.material});for(const A in f.variants)if(Object.prototype.hasOwnProperty.call(f.variants,A)){E._internalMetadata.Gi[BA].variants[A]=[];for(const X of f.variants[A])E._internalMetadata.Gi[BA].variants[A].push({mesh:X.mesh,material:X.material})}f=E._internalMetadata.Gi[BA]}for(const N of f.original)N.mesh===X&&(N.mesh=s);for(const N of f.variants[g.name])N.mesh===X&&(N.mesh=s)}))}})))}}}))),await Promise.all(r).then((A=>{let[X]=A;return X}))}))}}H(BA),x(BA,!0,(A=>new ZA(A)));var oA=s(2290);class WA{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:HA.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(A,X){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...WA._GetDefaultOptions(),...A},this._scene=X,this._scene._transmissionHelper=this,this.onErrorObservable=new Y.b,this._scene.Ji.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(A){if(!Object.keys(A).filter((X=>this._options[X]!==A[X])).length)return;const X={...this._options,...A},s=this._options;this._options=X,X.renderSize===s.renderSize&&X.renderTargetTextureType===s.renderTargetTextureType&&X.generateMipmaps===s.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=X.samples,this._opaqueRenderTarget.lodGenerationScale=X.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=X.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(A){return!!A&&!!(A instanceof y&&A.subSurface.isRefractionEnabled)}_addMesh(A){this._materialObservers[A.uniqueId]=A.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),g.d.SetImmediate((()=>{this._shouldRenderAsTransmission(A.material)?(A.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(A)&&this._transparentMeshesCache.push(A)):-1===this._opaqueMeshesCache.indexOf(A)&&this._opaqueMeshesCache.push(A)}))}_removeMesh(A){A.onMaterialChangedObservable.remove(this._materialObservers[A.uniqueId]),delete this._materialObservers[A.uniqueId];let X=this._transparentMeshesCache.indexOf(A);-1!==X&&this._transparentMeshesCache.splice(X,1),X=this._opaqueMeshesCache.indexOf(A),-1!==X&&this._opaqueMeshesCache.splice(X,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(A){const X=this._transparentMeshesCache.indexOf(A),s=this._opaqueMeshesCache.indexOf(A);this._shouldRenderAsTransmission(A.material)?(A.material instanceof y&&(A.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==s?(this._opaqueMeshesCache.splice(s,1),this._transparentMeshesCache.push(A)):-1===X&&this._transparentMeshesCache.push(A)):-1!==X?(this._transparentMeshesCache.splice(X,1),this._opaqueMeshesCache.push(A)):-1===s&&this._opaqueMeshesCache.push(A)}_isRenderTargetValid(){var A;return null!==(null===(A=this._opaqueRenderTarget)||void 0===A?void 0:A.getInternalTexture())}_setupRenderTargets(){var A;let X;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new oA.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(A=this._options.clearColor)||void 0===A?void 0:A.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((A=>{X=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?A.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(A.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=X}));for(const s of this._transparentMeshesCache)this._shouldRenderAsTransmission(s.material)&&(s.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const hA="KHR_materials_transmission";class AX{constructor(A){this.name=hA,this.order=175,this._loader=A,this.enabled=this._loader.isExtensionUsed(hA),this.enabled&&(A.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadTransparentPropertiesAsync(N,X,s,f)),await Promise.all(E).then((()=>{}))}))}_loadTransparentPropertiesAsync(A,X,s,N){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const f=s;if(f.subSurface.isRefractionEnabled=!0,f.subSurface.volumeIndexOfRefraction=1,f.subSurface.useAlbedoToTintRefraction=!0,void 0===N.transmissionFactor)return f.subSurface.refractionIntensity=0,f.subSurface.isRefractionEnabled=!1,Promise.resolve();{var E;f.subSurface.refractionIntensity=N.transmissionFactor;const A=f.va();if(f.subSurface.refractionIntensity&&!A._transmissionHelper)new WA({},f.va());else if(f.subSurface.refractionIntensity&&(null===(E=A._transmissionHelper)||void 0===E||!E._isRenderTargetValid())){var g;null===(g=A._transmissionHelper)||void 0===g||g._setupRenderTargets()}}return f.subSurface.minimumThickness=0,f.subSurface.maximumThickness=0,N.transmissionTexture?(N.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${A}/transmissionTexture`,N.transmissionTexture,void 0).then((A=>{A.name=`${s.name} (Transmission)`,f.subSurface.refractionIntensityTexture=A,f.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(hA),x(hA,!0,(A=>new AX(A)));const XX="KHR_materials_diffuse_transmission";class sX{constructor(A){this.name=XX,this.order=174,this._loader=A,this.enabled=this._loader.isExtensionUsed(XX),this.enabled&&(A.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadTranslucentPropertiesAsync(N,X,s,f)),await Promise.all(E).then((()=>{}))}))}_loadTranslucentPropertiesAsync(A,X,s,N){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const f=s;if(f.subSurface.isTranslucencyEnabled=!0,f.subSurface.volumeIndexOfRefraction=1,f.subSurface.minimumThickness=0,f.subSurface.maximumThickness=0,f.subSurface.useAlbedoToTintTranslucency=!1,void 0===N.diffuseTransmissionFactor)return f.subSurface.translucencyIntensity=0,f.subSurface.isTranslucencyEnabled=!1,Promise.resolve();f.subSurface.translucencyIntensity=N.diffuseTransmissionFactor;const g=new Array;return f.subSurface.useGltfStyleTextures=!0,N.diffuseTransmissionTexture&&(N.diffuseTransmissionTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${A}/diffuseTransmissionTexture`,N.diffuseTransmissionTexture).then((A=>{A.name=`${s.name} (Diffuse Transmission)`,f.subSurface.translucencyIntensityTexture=A})))),void 0!==N.diffuseTransmissionColorFactor?f.subSurface.translucencyColor=E.e.mi(N.diffuseTransmissionColorFactor):f.subSurface.translucencyColor=E.e.White(),N.diffuseTransmissionColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${A}/diffuseTransmissionColorTexture`,N.diffuseTransmissionColorTexture).then((A=>{A.name=`${s.name} (Diffuse Transmission Color)`,f.subSurface.translucencyColorTexture=A}))),Promise.all(g).then((()=>{}))}}H(XX),x(XX,!0,(A=>new sX(A)));const NX="KHR_materials_volume";class fX{constructor(A){this.name=NX,this.order=173,this._loader=A,this.enabled=this._loader.isExtensionUsed(NX),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadVolumePropertiesAsync(N,X,s,f)),await Promise.all(E).then((()=>{}))}))}_loadVolumePropertiesAsync(A,X,s,N){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);if(!s.subSurface.isRefractionEnabled&&!s.subSurface.isTranslucencyEnabled||!N.thicknessFactor)return Promise.resolve();s.subSurface.volumeIndexOfRefraction=s.indexOfRefraction;const f=void 0!==N.attenuationDistance?N.attenuationDistance:Number.MAX_VALUE;return s.subSurface.tintColorAtDistance=f,void 0!==N.attenuationColor&&3==N.attenuationColor.length&&s.subSurface.tintColor.gi(N.attenuationColor[0],N.attenuationColor[1],N.attenuationColor[2]),s.subSurface.minimumThickness=0,s.subSurface.maximumThickness=N.thicknessFactor,s.subSurface.useThicknessAsDepth=!0,N.thicknessTexture?(N.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${A}/thicknessTexture`,N.thicknessTexture).then((A=>{A.name=`${s.name} (Thickness)`,s.subSurface.thicknessTexture=A,s.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(NX),x(NX,!0,(A=>new fX(A)));const EX="KHR_materials_dispersion";class gX{constructor(A){this.name=EX,this.order=174,this._loader=A,this.enabled=this._loader.isExtensionUsed(EX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadDispersionPropertiesAsync(N,X,s,f)),await Promise.all(E).then((()=>{}))}))}_loadDispersionPropertiesAsync(A,X,s,N){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);return s.subSurface.isRefractionEnabled&&N.dispersion?(s.subSurface.isDispersionEnabled=!0,s.subSurface.dispersion=N.dispersion,Promise.resolve()):Promise.resolve()}}H(EX),x(EX,!0,(A=>new gX(A)));const KX="EXT_materials_diffuse_roughness";class rX{constructor(A){this.name=KX,this.order=190,this._loader=A,this.enabled=this._loader.isExtensionUsed(KX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(A,X,s)),E.push(this._loadDiffuseRoughnessPropertiesAsync(N,f,s)),await Promise.all(E).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(A,X,s){if(!(s instanceof y))throw new Error(`${A}: Material type not supported`);const N=new Array;return s.brdf.baseDiffuseModel=HA.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=X.diffuseRoughnessFactor?s.baseDiffuseRoughness=X.diffuseRoughnessFactor:s.baseDiffuseRoughness=0,X.diffuseRoughnessTexture&&N.push(this._loader.loadTextureInfoAsync(`${A}/diffuseRoughnessTexture`,X.diffuseRoughnessTexture,(A=>{A.name=`${s.name} (Diffuse Roughness)`,s.baseDiffuseRoughnessTexture=A}))),Promise.all(N).then((()=>{}))}}H(KX),x(KX,!0,(A=>new rX(A)));const iX="KHR_mesh_quantization";class YX{constructor(A){this.name=iX,this.enabled=A.isExtensionUsed(iX)}dispose(){}}H(iX),x(iX,!0,(A=>new YX(A)));const vX="KHR_texture_basisu";class cX{constructor(A){this.name=vX,this._loader=A,this.enabled=A.isExtensionUsed(vX)}dispose(){this._loader=null}_loadTextureAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>{const E=void 0==X.sampler?Z.DefaultSampler:p.Get(`${A}/sampler`,this._loader.Gi.samplers,X.sampler),g=p.Get(`${N}/source`,this._loader.Gi.images,f.source);return await this._loader._createTextureAsync(A,E,g,(A=>{s(A)}),X._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!X._textureInfo.nonColorData)}))}}H(vX),x(vX,!0,(A=>new cX(A)));const MX="KHR_texture_transform";class dX{constructor(A){this.name=MX,this._loader=A,this.enabled=this._loader.isExtensionUsed(MX)}dispose(){this._loader=null}loadTextureInfoAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(N,f)=>await this._loader.loadTextureInfoAsync(A,X,(A=>{if(!(A instanceof j.d))throw new Error(`${N}: Texture type not supported`);f.offset&&(A.uOffset=f.offset[0],A.vOffset=f.offset[1]),A.uRotationCenter=0,A.vRotationCenter=0,f.rotation&&(A.wAng=-f.rotation),f.scale&&(A.uScale=f.scale[0],A.vScale=f.scale[1]),void 0!=f.texCoord&&(A.coordinatesIndex=f.texCoord),s(A)}))))}}H(MX),x(MX,!0,(A=>new dX(A)));const QX="KHR_xmp_json_ld";class wX{constructor(A){this.name=QX,this.order=100,this._loader=A,this.enabled=this._loader.isExtensionUsed(QX)}dispose(){this._loader=null}onLoading(){var A,X,s;if(null===this._loader.rootBabylonMesh)return;const N=null===(A=this._loader.Gi.extensions)||void 0===A?void 0:A.KHR_xmp_json_ld,f=null===(X=this._loader.Gi.asset)||void 0===X||null===(s=X.extensions)||void 0===s?void 0:s.KHR_xmp_json_ld;if(N&&f){const A=+f.packet;N.packets&&A<N.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=N.packets[A])}}}function RX(A,X,s,N){return E.e.mi(X,s).scale(N)}function CX(A,X,s,N){return X[s]*N}function JX(A,X,s,N){return-X[s]*N}function aX(A,X,s,N){return X[s+1]*N}function uX(A,X,s,N){return X[s]*N*2}function zX(A){return{scale:[new bX(c.e.ANIMATIONTYPE_FLOAT,`${A}.uScale`,CX,(()=>2)),new bX(c.e.ANIMATIONTYPE_FLOAT,`${A}.vScale`,aX,(()=>2))],offset:[new bX(c.e.ANIMATIONTYPE_FLOAT,`${A}.uOffset`,CX,(()=>2)),new bX(c.e.ANIMATIONTYPE_FLOAT,`${A}.vOffset`,aX,(()=>2))],rotation:[new bX(c.e.ANIMATIONTYPE_FLOAT,`${A}.wAng`,JX,(()=>1))]}}H(QX),x(QX,!0,(A=>new wX(A)));class mX extends o.AnimationPropertyInfo{buildAnimations(A,X,s,N){return[{babylonAnimatable:A._babylonCamera,babylonAnimation:this._buildAnimation(X,s,N)}]}}class bX extends o.AnimationPropertyInfo{buildAnimations(A,X,s,N){const f=[];for(const E in A._data)f.push({babylonAnimatable:A._data[E].babylonMaterial,babylonAnimation:this._buildAnimation(X,s,N)});return f}}class yX extends o.AnimationPropertyInfo{buildAnimations(A,X,s,N){return[{babylonAnimatable:A._babylonLight,babylonAnimation:this._buildAnimation(X,s,N)}]}}(0,F.j)("/cameras/{}/orthographic/xmag",[new mX(c.e.ANIMATIONTYPE_FLOAT,"orthoLeft",JX,(()=>1)),new mX(c.e.ANIMATIONTYPE_FLOAT,"orthoRight",aX,(()=>1))]),(0,F.j)("/cameras/{}/orthographic/ymag",[new mX(c.e.ANIMATIONTYPE_FLOAT,"orthoBottom",JX,(()=>1)),new mX(c.e.ANIMATIONTYPE_FLOAT,"orthoTop",aX,(()=>1))]),(0,F.j)("/cameras/{}/orthographic/zfar",[new mX(c.e.ANIMATIONTYPE_FLOAT,"maxZ",CX,(()=>1))]),(0,F.j)("/cameras/{}/orthographic/znear",[new mX(c.e.ANIMATIONTYPE_FLOAT,"ui",CX,(()=>1))]),(0,F.j)("/cameras/{}/perspective/yfov",[new mX(c.e.ANIMATIONTYPE_FLOAT,"fov",CX,(()=>1))]),(0,F.j)("/cameras/{}/perspective/zfar",[new mX(c.e.ANIMATIONTYPE_FLOAT,"maxZ",CX,(()=>1))]),(0,F.j)("/cameras/{}/perspective/znear",[new mX(c.e.ANIMATIONTYPE_FLOAT,"ui",CX,(()=>1))]),(0,F.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new bX(c.e.ANIMATIONTYPE_COLOR3,"albedoColor",RX,(()=>4)),new bX(c.e.ANIMATIONTYPE_FLOAT,"alpha",(function(A,X,s,N){return X[s+3]*N}),(()=>4))]),(0,F.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"metallic",CX,(()=>1))]),(0,F.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"roughness",CX,(()=>1))]);const jX=zX("albedoTexture");(0,F.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",jX.scale),(0,F.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",jX.offset),(0,F.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",jX.rotation);const GX=zX("metallicTexture");(0,F.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",GX.scale),(0,F.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",GX.offset),(0,F.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",GX.rotation),(0,F.j)("/materials/{}/emissiveFactor",[new bX(c.e.ANIMATIONTYPE_COLOR3,"emissiveColor",RX,(()=>3))]);const VX=zX("bumpTexture");(0,F.j)("/materials/{}/normalTexture/scale",[new bX(c.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",CX,(()=>1))]),(0,F.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",VX.scale),(0,F.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",VX.offset),(0,F.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",VX.rotation),(0,F.j)("/materials/{}/occlusionTexture/strength",[new bX(c.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",CX,(()=>1))]);const DX=zX("ambientTexture");(0,F.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",DX.scale),(0,F.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",DX.offset),(0,F.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",DX.rotation);const OX=zX("emissiveTexture");(0,F.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",OX.scale),(0,F.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",OX.offset),(0,F.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",OX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new bX(c.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new bX(c.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",CX,(()=>1))]);const PX=zX("anisotropy.texture");(0,F.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",PX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",PX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",PX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",CX,(()=>1))]);const lX=zX("clearCoat.texture");(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",lX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",lX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",lX.rotation);const nX=zX("clearCoat.bumpTexture");(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new bX(c.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",nX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",nX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",nX.rotation);const UX=zX("clearCoat.textureRoughness");(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",UX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",UX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",UX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new bX(c.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new bX(c.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new bX(c.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new bX(c.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",CX,(()=>1))]);const tX=zX("iridescence.texture");(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",tX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",tX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",tX.rotation);const eX=zX("iridescence.thicknessTexture");(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",eX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",eX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",eX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new bX(c.e.ANIMATIONTYPE_COLOR3,"sheen.color",RX,(()=>3))]),(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",CX,(()=>1))]);const TX=zX("sheen.texture");(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",TX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",TX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",TX.rotation);const IX=zX("sheen.textureRoughness");(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",IX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",IX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",IX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new bX(c.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",RX,(()=>3))]);const LX=zX("metallicReflectanceTexture");(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",LX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",LX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",LX.rotation);const kX=zX("reflectanceTexture");(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",kX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",kX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",kX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",CX,(()=>1))]);const xX=zX("subSurface.refractionIntensityTexture");(0,F.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",xX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",xX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",xX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new bX(c.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",RX,(()=>3))]),(0,F.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new bX(c.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",CX,(()=>1))]),(0,F.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",CX,(()=>1))]);const HX=zX("subSurface.thicknessTexture");(0,F.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",HX.scale),(0,F.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",HX.offset),(0,F.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",HX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new bX(c.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",CX,(()=>1))]);const FX=zX("subSurface.translucencyIntensityTexture");(0,F.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",FX.scale),(0,F.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",FX.offset),(0,F.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",FX.rotation),(0,F.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new bX(c.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",RX,(()=>3))]);const qX=zX("subSurface.translucencyColorTexture");(0,F.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",qX.scale),(0,F.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",qX.offset),(0,F.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",qX.rotation),(0,F.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new yX(c.e.ANIMATIONTYPE_COLOR3,"diffuse",RX,(()=>3))]),(0,F.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new yX(c.e.ANIMATIONTYPE_FLOAT,"intensity",CX,(()=>1))]),(0,F.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new yX(c.e.ANIMATIONTYPE_FLOAT,"range",CX,(()=>1))]),(0,F.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new yX(c.e.ANIMATIONTYPE_FLOAT,"innerAngle",uX,(()=>1))]),(0,F.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new yX(c.e.ANIMATIONTYPE_FLOAT,"angle",uX,(()=>1))]),(0,F.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new yX(c.e.ANIMATIONTYPE_COLOR3,"diffuse",RX,(()=>3))]),(0,F.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new yX(c.e.ANIMATIONTYPE_FLOAT,"intensity",CX,(()=>1))]);const SX="KHR_animation_pointer";class pX{constructor(A){this.name=SX,this._loader=A,this._pathToObjectConverter=(0,F.h)(this._loader.Gi)}get enabled(){return this._loader.isExtensionUsed(SX)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(A,X,s,N,f){var E;const g=null===(E=N.target.extensions)||void 0===E?void 0:E.KHR_animation_pointer;if(!g||!this._pathToObjectConverter)return null;"pointer"!==N.target.path&&Q.b.Warn(`${A}/target/path: Value (${N.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=N.target.node&&Q.b.Warn(`${A}/target/node: Value (${N.target.node}) must not be present when using the ${this.name} extension`);const K=`${A}/extensions/${this.name}`,r=g.pointer;if(!r)throw new Error(`${K}: Pointer is missing`);try{const E=this._pathToObjectConverter.convert(r);if(!E.info.interpolation)throw new Error(`${K}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(A,X,s,N,{object:E.object,info:E.info.interpolation},f)}catch(i){return Q.b.Warn(`${K}/pointer: Invalid pointer (${r}) skipped`),null}}}H(SX),x(SX,!0,(A=>new pX(A)));class BX{constructor(A,X,s){this.frame=A,this.action=X,this.onlyOnce=s,this.isDone=!1}_clone(){return new BX(this.frame,this.action,this.onlyOnce)}}var ZX=s(495),oX=s(547),WX=s(542);class hX{get loop(){return this._loop}set loop(A){A!==this._loop&&(this._loop=A,this.updateOptions({loop:A}))}get currentTime(){var A;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(A=oX.d.audioEngine)&&void 0!==A&&A.audioContext&&(this.isPlaying||this.isPaused)){const A=this.isPaused?0:oX.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+A}return 0}get spatialSound(){return this._spatialSound}set spatialSound(A){if(A==this._spatialSound)return;const X=this.isPlaying;this.pause(),A?(this._spatialSound=A,this._updateSpatialParameters()):this._disableSpatialSound(),X&&this.play()}constructor(A,X,s){var N;let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Y.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=f.k.Zero(),this._localDirection=new f.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=A,s=s||d.b.LastCreatedScene)if(this._scene=s,hX._SceneComponentInitialization(s),this._readyToPlayCallback=E,this._customAttenuationFunction=(A,X,s,N,f)=>X<s?A*(1-X/s):0,K&&(this.autoplay=K.autoplay||!1,this._loop=K.loop||!1,void 0!==K.volume&&(this._volume=K.volume),this._spatialSound=K.spatialSound??!1,this.maxDistance=K.maxDistance??100,this.useCustomAttenuation=K.useCustomAttenuation??!1,this.rolloffFactor=K.rolloffFactor||1,this.refDistance=K.refDistance||1,this.distanceModel=K.distanceModel||"linear",this._playbackRate=K.playbackRate||1,this._streaming=K.streaming??!1,this._length=K.length,this._offset=K.offset),null!==(N=oX.d.audioEngine)&&void 0!==N&&N.canUseWebAudio&&oX.d.audioEngine.audioContext){this._soundGain=oX.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let A=!0;if(X)try{"string"===typeof X?(this._urlType="String",this._url=X):X instanceof ArrayBuffer?this._urlType="ArrayBuffer":X instanceof HTMLMediaElement?this._urlType="MediaElement":X instanceof MediaStream?this._urlType="MediaStream":X instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(X)&&(this._urlType="Array");let s=[],N=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=oX.d.audioEngine.audioContext.createMediaElementSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=oX.d.audioEngine.audioContext.createMediaStreamSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":X.byteLength>0&&(N=!0,this._soundLoaded(X));break;case"AudioBuffer":this._audioBufferLoaded(X);break;case"String":s.push(X);case"Array":0===s.length&&(s=X);for(let A=0;A<s.length;A++){const X=s[A];if(N=K&&K.skipCodecCheck||-1!==X.indexOf(".mp3",X.length-4)&&oX.d.audioEngine.isMP3supported||-1!==X.indexOf(".ogg",X.length-4)&&oX.d.audioEngine.isOGGsupported||-1!==X.indexOf(".wav",X.length-4)||-1!==X.indexOf(".m4a",X.length-4)||-1!==X.indexOf(".mp4",X.length-4)||-1!==X.indexOf("blob:"),N){this._streaming?(this._htmlAudioElement=new Audio(X),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,g.d.SetCorsBehavior(X,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(X,(A=>{this._soundLoaded(A)}),void 0,!0,!0,(A=>{A&&Q.b.Error("XHR "+A.status+" error on: "+X+"."),Q.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:A=!1}A?N||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Q.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(r){Q.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),oX.d.audioEngine&&!oX.d.audioEngine.WarnedWebAudioUnsupported&&(Q.b.Error("Web Audio is not supported by your browser."),oX.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var A;null!==(A=oX.d.audioEngine)&&void 0!==A&&A.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(A){var X;null!==(X=oX.d.audioEngine)&&void 0!==X&&X.audioContext&&(this._audioBuffer=A,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(A){var X;null!==(X=oX.d.audioEngine)&&void 0!==X&&X.audioContext&&oX.d.audioEngine.audioContext.decodeAudioData(A,(A=>{this._audioBufferLoaded(A)}),(A=>{Q.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+A)}))}setAudioBuffer(A){var X;null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&(this._audioBuffer=A,this._isReadyToPlay=!0)}updateOptions(A){A&&(this.loop=A.loop??this.loop,this.maxDistance=A.maxDistance??this.maxDistance,this.useCustomAttenuation=A.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=A.rolloffFactor??this.rolloffFactor,this.refDistance=A.refDistance??this.refDistance,this.distanceModel=A.distanceModel??this.distanceModel,this._playbackRate=A.playbackRate??this._playbackRate,this._length=A.length??void 0,this.spatialSound=A.spatialSound??this._spatialSound,this._setOffset(A.offset??void 0),this.setVolume(A.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var A;null!==(A=oX.d.audioEngine)&&void 0!==A&&A.canUseWebAudio&&oX.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??oX.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var A;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(A=this._soundPanner)||void 0===A||A.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var A;null!==(A=oX.d.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(A){var X;null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(A),this._isOutputConnected=!0)}setDirectionalCone(A,X,s){X<A?Q.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=A,this._coneOuterAngle=X,this._coneOuterGain=s,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(A){if(A!=this._coneInnerAngle){var X;if(this._coneOuterAngle<A)return void Q.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=A,null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(A){if(A!=this._coneOuterAngle){var X;if(A<this._coneInnerAngle)return void Q.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=A,null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(A){var X;A.equals(this._position)||(this._position.p(A),null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(A){var X;this._localDirection=A,null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const A=this._connectedTransformNode.getWorldMatrix(),X=f.k.TransformNormal(this._localDirection,A);X.normalize(),this._soundPanner.orientationX.value=X.x,this._soundPanner.orientationY.value=X.y,this._soundPanner.orientationZ.value=X.z}updateDistanceFromListener(){var A;if(null!==(A=oX.d.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const A=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Pg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,A,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(A){this._customAttenuationFunction=A}play(A,X,s){var N;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(N=oX.d.audioEngine)&&void 0!==N&&N.audioContext)try{var f,E;this._clearTimeoutsAndObservers();let N=A?(null===(f=oX.d.audioEngine)||void 0===f?void 0:f.audioContext.currentTime)+A:null===(E=oX.d.audioEngine)||void 0===E?void 0:E.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=oX.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const A=()=>{var s;if(null!==(s=oX.d.audioEngine)&&void 0!==s&&s.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=X??0;const s=this._htmlAudioElement.play();void 0!==s&&s.catch((()=>{var X,s;(null===(X=oX.d.audioEngine)||void 0===X||X.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(s=oX.d.audioEngine)||void 0===s?void 0:s.onAudioUnlockedObservable.addOnce((()=>{A()})))}))}else{var N;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(N=oX.d.audioEngine)||void 0===N?void 0:N.onAudioUnlockedObservable.addOnce((()=>{A()}))}};A()}}else{var g;const f=()=>{var f;if(null!==(f=oX.d.audioEngine)&&void 0!==f&&f.audioContext){var E;if(s=s||this._length,void 0!==X&&this._setOffset(X),this._soundSource){const A=this._soundSource;A.onended=()=>{A.disconnect()}}if(this._soundSource=null===(E=oX.d.audioEngine)||void 0===E?void 0:E.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var g;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==X&&(this._soundSource.loopStart=X),void 0!==s&&(this._soundSource.loopEnd=(0|X)+s),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},N=A?(null===(g=oX.d.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+A:oX.d.audioEngine.audioContext.currentTime;const f=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(N,f,this.loop?void 0:s)}}};"suspended"===(null===(g=oX.d.audioEngine)||void 0===g?void 0:g.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var A;"suspended"===(null===(A=oX.d.audioEngine)||void 0===A?void 0:A.audioContext.state)?(oX.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=oX.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{f()})))):f()}),500):f()}this._startTime=N,this.isPlaying=!0,this.isPaused=!1}catch(K){Q.b.Error("Error while trying to play audio: "+this.name+", "+K.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(A){var X;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var s;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(s=this._streamingSource)||void 0===s||s.disconnect();this.isPlaying=!1}else if(null!==(X=oX.d.audioEngine)&&void 0!==X&&X.audioContext&&this._soundSource){const X=A?oX.d.audioEngine.audioContext.currentTime+A:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(X)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var A;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var X;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(X=this._streamingSource)||void 0===X||X.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(A=oX.d.audioEngine)&&void 0!==A&&A.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=oX.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(A,X){var s;null!==(s=oX.d.audioEngine)&&void 0!==s&&s.canUseWebAudio&&this._soundGain&&(X&&oX.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(oX.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,oX.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(A,oX.d.audioEngine.audioContext.currentTime+X)):this._soundGain.gain.value=A),this._volume=A}setPlaybackRate(A){this._playbackRate=A,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(A){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=A,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=A=>this._onRegisterAfterWorldMatrixUpdate(A),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(A){var X;if(A.getBoundingInfo){const X=A.getBoundingInfo();this.setPosition(X.boundingSphere.centerWorld)}else this.setPosition(A.absolutePosition);null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const A=()=>{(0,WX.i)((()=>this._isReadyToPlay),(()=>{s._audioBuffer=this.getAudioBuffer(),s._isReadyToPlay=!0,s.autoplay&&s.play(0,this._offset,this._length)}),void 0,300)},X={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},s=new hX(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,X);return this.useCustomAttenuation&&s.setAttenuationFunction(this._customAttenuationFunction),s.setPosition(this._position),s.setPlaybackRate(this._playbackRate),A(),s}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const A={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(A.connectedMeshId=this._connectedTransformNode.id),A.position=this._position.zi(),A.refDistance=this.refDistance,A.distanceModel=this.distanceModel,A.isDirectional=this._isDirectional,A.localDirectionToMesh=this._localDirection.zi(),A.coneInnerAngle=this._coneInnerAngle,A.coneOuterAngle=this._coneOuterAngle,A.coneOuterGain=this._coneOuterGain),A}static Parse(A,X,s,N){const E=A.name;let g;g=A.url?s+A.url:s+E;const K={autoplay:A.autoplay,loop:A.loop,volume:A.volume,spatialSound:A.spatialSound,maxDistance:A.maxDistance,rolloffFactor:A.rolloffFactor,refDistance:A.refDistance,distanceModel:A.distanceModel,playbackRate:A.playbackRate};let r;if(N){const A=()=>{(0,WX.i)((()=>N._isReadyToPlay),(()=>{r._audioBuffer=N.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play(0,r._offset,r._length)}),void 0,300)};r=new hX(E,new ArrayBuffer(0),X,null,K),A()}else r=new hX(E,g,X,(()=>{X.removePendingData(r)}),K),X.addPendingData(r);if(A.position){const X=f.k.mi(A.position);r.setPosition(X)}if(A.isDirectional&&(r.setDirectionalCone(A.coneInnerAngle||360,A.coneOuterAngle||360,A.coneOuterGain||0),A.localDirectionToMesh)){const X=f.k.mi(A.localDirectionToMesh);r.setLocalDirectionToMesh(X)}if(A.connectedMeshId){const s=X.getMeshById(A.connectedMeshId);s&&r.attachToMesh(s)}return A.metadata&&(r.metadata=A.metadata),r}_setOffset(A){this._offset!==A&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=A)}_clearTimeoutsAndObservers(){var A;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(A=oX.d.audioEngine)||void 0===A||A.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}hX._SceneComponentInitialization=A=>{throw(0,ZX.e)("AudioSceneComponent")},(0,m.f)("BABYLON.Sound",hX);class As{constructor(A,X,s){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],X.length!==s.length)throw new Error("Sounds length does not equal weights length");this.loop=A,this._weights=s;let N=0;for(const E of s)N+=E;const f=N>0?1/N:0;for(let E=0;E<this._weights.length;E++)this._weights[E]*=f;this._sounds=X;for(const E of this._sounds)E.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(A){if(A!==this._coneInnerAngle){if(this._coneOuterAngle<A)return void Q.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=A;for(const X of this._sounds)X.directionalConeInnerAngle=A}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(A){if(A!==this._coneOuterAngle){if(A<this._coneInnerAngle)return void Q.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=A;for(const X of this._sounds)X.directionalConeOuterAngle=A}}get volume(){return this._volume}set volume(A){if(A!==this._volume)for(const X of this._sounds)X.setVolume(A)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(A){if(!this.isPaused){this.stop();const A=Math.random();let X=0;for(let s=0;s<this._weights.length;s++)if(X+=this._weights[s],A<=X){this._currentIndex=s;break}}const X=this._sounds[this._currentIndex??0];X.isReady()?X.play(0,this.isPaused?void 0:A):X.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Xs{constructor(A){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(A=A||d.b.LastCreatedScene)&&(this._scene=A,this.soundCollection=[],this._options=X,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var A;null!==(A=oX.d.audioEngine)&&void 0!==A&&A.canUseWebAudio&&oX.d.audioEngine.audioContext&&(this._outputAudioNode=oX.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(oX.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(oX.d.audioEngine&&oX.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(A){var X;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&A.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==A.soundTrackId&&(-1===A.soundTrackId?this._scene.mainSoundTrack.removeSound(A):this._scene.soundTracks&&this._scene.soundTracks[A.soundTrackId].removeSound(A)),this.soundCollection.push(A),A.soundTrackId=this.id}removeSound(A){const X=this.soundCollection.indexOf(A);-1!==X&&this.soundCollection.splice(X,1)}setVolume(A){var X;null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=A)}switchPanningModelToHRTF(){var A;if(null!==(A=oX.d.audioEngine)&&void 0!==A&&A.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var A;if(null!==(A=oX.d.audioEngine)&&void 0!==A&&A.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToEqualPower()}connectToAnalyser(A){var X;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=A,null!==(X=oX.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,oX.d.audioEngine.masterGain))}}var ss=s(850),Ns=s(2418),fs=s(465);oX.d.AudioEngineFactory=(A,X,s)=>new Es(A,X,s);class Es{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Y.b,this.onAudioLockedObservable=new Y.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,fs.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const N=document.createElement("audio");this._hostElement=A,this._audioContext=X,this._audioDestination=s;try{N&&N.canPlayType&&(N.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||N.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(f){}try{N&&N.canPlayType&&N.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(f){}}lock(){this._triggerSuspendedState()}unlock(){var A,X;if("running"===(null===(A=this._audioContext)||void 0===A?void 0:A.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(X=this._audioContext)||void 0===X||X.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Q.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var A;null===(A=this._audioContext)||void 0===A||A.addEventListener("statechange",(()=>{var A;this.unlocked&&"running"!==(null===(A=this._audioContext)||void 0===A?void 0:A.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var A;return null!==(A=this._audioContext)&&void 0!==A&&A.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(A){this.canUseWebAudio=!1,Q.b.Error("Web Audio: "+A.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(A){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const A=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",X=document.createElement("style");X.appendChild(document.createTextNode(A)),document.getElementsByTagName("head")[0].appendChild(X),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var A;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(A=this._audioContext)||void 0===A||A.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(A){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=A)}connectToAnalyser(A){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=A,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var gs=s(486);(0,s(12317).h)(ss.b.NAME_AUDIO,((A,X,s,N)=>{let f,E=[];if(s.lm=s.lm||[],void 0!==A.lm&&null!==A.lm)for(let K=0,r=A.lm.length;K<r;K++){var g;const r=A.lm[K];null!==(g=oX.d.audioEngine)&&void 0!==g&&g.canUseWebAudio?(r.url||(r.url=r.name),E[r.url]?s.lm.push(hX.Parse(r,X,N,E[r.url])):(f=hX.Parse(r,X,N),E[r.url]=f,s.lm.push(f))):s.lm.push(new hX(r.name,null,X))}E=[]})),Object.defineProperty(Ns.d.prototype,"mainSoundTrack",{get:function(){let A=this._getComponent(ss.b.NAME_AUDIO);return A||(A=new Ks(this),this.bb(A)),this._mainSoundTrack||(this._mainSoundTrack=new Xs(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Ns.d.prototype.getSoundByName=function(A){let X;for(X=0;X<this.mainSoundTrack.soundCollection.length;X++)if(this.mainSoundTrack.soundCollection[X].name===A)return this.mainSoundTrack.soundCollection[X];if(this.soundTracks)for(let s=0;s<this.soundTracks.length;s++)for(X=0;X<this.soundTracks[s].soundCollection.length;X++)if(this.soundTracks[s].soundCollection[X].name===A)return this.soundTracks[s].soundCollection[X];return null},Object.defineProperty(Ns.d.prototype,"audioEnabled",{get:function(){let A=this._getComponent(ss.b.NAME_AUDIO);return A||(A=new Ks(this),this.bb(A)),A.audioEnabled},set:function(A){let X=this._getComponent(ss.b.NAME_AUDIO);X||(X=new Ks(this),this.bb(X)),A?X.enableAudio():X.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Ns.d.prototype,"headphone",{get:function(){let A=this._getComponent(ss.b.NAME_AUDIO);return A||(A=new Ks(this),this.bb(A)),A.headphone},set:function(A){let X=this._getComponent(ss.b.NAME_AUDIO);X||(X=new Ks(this),this.bb(X)),A?X.switchAudioModeForHeadphones():X.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Ns.d.prototype,"audioListenerPositionProvider",{get:function(){let A=this._getComponent(ss.b.NAME_AUDIO);return A||(A=new Ks(this),this.bb(A)),A.audioListenerPositionProvider},set:function(A){let X=this._getComponent(ss.b.NAME_AUDIO);if(X||(X=new Ks(this),this.bb(X)),A&&"function"!==typeof A)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");X.audioListenerPositionProvider=A},enumerable:!0,configurable:!0}),Object.defineProperty(Ns.d.prototype,"audioListenerRotationProvider",{get:function(){let A=this._getComponent(ss.b.NAME_AUDIO);return A||(A=new Ks(this),this.bb(A)),A.audioListenerRotationProvider},set:function(A){let X=this._getComponent(ss.b.NAME_AUDIO);if(X||(X=new Ks(this),this.bb(X)),A&&"function"!==typeof A)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");X.audioListenerRotationProvider=A},enumerable:!0,configurable:!0}),Object.defineProperty(Ns.d.prototype,"audioPositioningRefreshRate",{get:function(){let A=this._getComponent(ss.b.NAME_AUDIO);return A||(A=new Ks(this),this.bb(A)),A.audioPositioningRefreshRate},set:function(A){let X=this._getComponent(ss.b.NAME_AUDIO);X||(X=new Ks(this),this.bb(X)),X.audioPositioningRefreshRate=A},enumerable:!0,configurable:!0});class Ks{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(A){this.name=ss.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new f.k,this._cachedCameraPosition=new f.k,this._lastCheck=0,this._invertMatrixTemp=new f.c,this._cameraDirectionTemp=new f.k,(A=A||d.b.LastCreatedScene)&&(this.eg=A,A.soundTracks=[],A.lm=[])}register(){this.eg._afterRenderStage.registerStep(ss.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(A){if(A.lm=[],this.eg.soundTracks)for(let X=0;X<this.eg.soundTracks.length;X++){const s=this.eg.soundTracks[X];for(let X=0;X<s.soundCollection.length;X++)A.lm.push(s.soundCollection[X].serialize())}}addFromContainer(A){if(A.lm)for(const X of A.lm)X.play(),X.autoplay=!0,this.eg.mainSoundTrack.addSound(X)}removeFromContainer(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(A.lm)for(const s of A.lm)s.stop(),s.autoplay=!1,this.eg.mainSoundTrack.removeSound(s),X&&s.dispose()}dispose(){const A=this.eg;if(A._mainSoundTrack&&A.mainSoundTrack.dispose(),A.soundTracks)for(let X=0;X<A.soundTracks.length;X++)A.soundTracks[X].dispose()}disableAudio(){const A=this.eg;let X;for(this._audioEnabled=!1,oX.d.audioEngine&&oX.d.audioEngine.audioContext&&oX.d.audioEngine.audioContext.suspend(),X=0;X<A.mainSoundTrack.soundCollection.length;X++)A.mainSoundTrack.soundCollection[X].pause();if(A.soundTracks)for(X=0;X<A.soundTracks.length;X++)for(let s=0;s<A.soundTracks[X].soundCollection.length;s++)A.soundTracks[X].soundCollection[s].pause()}enableAudio(){const A=this.eg;let X;for(this._audioEnabled=!0,oX.d.audioEngine&&oX.d.audioEngine.audioContext&&oX.d.audioEngine.audioContext.resume(),X=0;X<A.mainSoundTrack.soundCollection.length;X++)A.mainSoundTrack.soundCollection[X].isPaused&&A.mainSoundTrack.soundCollection[X].play();if(A.soundTracks)for(X=0;X<A.soundTracks.length;X++)for(let s=0;s<A.soundTracks[X].soundCollection.length;s++)A.soundTracks[X].soundCollection[s].isPaused&&A.soundTracks[X].soundCollection[s].play()}switchAudioModeForHeadphones(){const A=this.eg;if(this._headphone=!0,A.mainSoundTrack.switchPanningModelToHRTF(),A.soundTracks)for(let X=0;X<A.soundTracks.length;X++)A.soundTracks[X].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const A=this.eg;if(this._headphone=!1,A.mainSoundTrack.switchPanningModelToEqualPower(),A.soundTracks)for(let X=0;X<A.soundTracks.length;X++)A.soundTracks[X].switchPanningModelToEqualPower()}_afterRender(){const A=gs.e.Now;if(this._lastCheck&&A-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=A;const X=this.eg;if(!this._audioEnabled||!X._mainSoundTrack||!X.soundTracks||0===X._mainSoundTrack.soundCollection.length&&1===X.soundTracks.length)return;const s=oX.d.audioEngine;if(s&&s.audioContext){let A,N=X.activeCamera;if(X.activeCameras&&X.activeCameras.length>0&&(N=X.activeCameras[0]),this.audioListenerPositionProvider){const A=this.audioListenerPositionProvider();s.audioContext.listener.setPosition(A.x||0,A.y||0,A.z||0)}else N?this._cachedCameraPosition.equals(N.globalPosition)||(this._cachedCameraPosition.p(N.globalPosition),s.audioContext.listener.setPosition(N.globalPosition.x,N.globalPosition.y,N.globalPosition.z)):s.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const A=this.audioListenerRotationProvider();s.audioContext.listener.setOrientation(A.x||0,A.y||0,A.z||0,0,1,0)}else N?(N.rigCameras&&N.rigCameras.length>0&&(N=N.rigCameras[0]),N.getViewMatrix().invertToRef(this._invertMatrixTemp),f.k.TransformNormalToRef(Ks._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),s.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):s.audioContext.listener.setOrientation(0,0,0,0,1,0);for(A=0;A<X.mainSoundTrack.soundCollection.length;A++){const s=X.mainSoundTrack.soundCollection[A];s.useCustomAttenuation&&s.updateDistanceFromListener()}if(X.soundTracks)for(A=0;A<X.soundTracks.length;A++)for(let s=0;s<X.soundTracks[A].soundCollection.length;s++){const N=X.soundTracks[A].soundCollection[s];N.useCustomAttenuation&&N.updateDistanceFromListener()}}}}Ks._CameraDirection=new f.k(0,0,-1),hX._SceneComponentInitialization=A=>{let X=A._getComponent(ss.b.NAME_AUDIO);X||(X=new Ks(A),A.bb(X))};const rs="MSFT_audio_emitter";class is{constructor(A){this.name=rs,this._loader=A,this.enabled=this._loader.isExtensionUsed(rs)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const A=this._loader.Gi.extensions;if(A&&A[this.name]){const X=A[this.name];this._clips=X.clips,this._emitters=X.emitters,p.Assign(this._clips),p.Assign(this._emitters)}}loadSceneAsync(A,X){return Z.LoadExtensionAsync(A,X,this.name,(async(s,N)=>{const f=new Array;f.push(this._loader.loadSceneAsync(A,X));for(const A of N.emitters){const X=p.Get(`${s}/emitters`,this._emitters,A);if(void 0!=X.refDistance||void 0!=X.maxDistance||void 0!=X.rolloffFactor||void 0!=X.distanceModel||void 0!=X.innerAngle||void 0!=X.outerAngle)throw new Error(`${s}: Direction or Distance properties are not allowed on emitters attached to a scene`);f.push(this._loadEmitterAsync(`${s}/emitters/${X.index}`,X))}await Promise.all(f)}))}loadNodeAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(A,N)=>{const E=new Array,K=await this._loader.loadNodeAsync(A,X,(X=>{for(const s of N.emitters){const N=p.Get(`${A}/emitters`,this._emitters,s);E.push(this._loadEmitterAsync(`${A}/emitters/${N.index}`,N).then((()=>{for(const A of N._babylonSounds)A.attachToMesh(X),void 0==N.innerAngle&&void 0==N.outerAngle||(A.setLocalDirectionToMesh(f.k.Forward()),A.setDirectionalCone(2*g.d.ToDegrees(void 0==N.innerAngle?Math.PI:N.innerAngle),2*g.d.ToDegrees(void 0==N.outerAngle?Math.PI:N.outerAngle),0))})))}s(X)}));return await Promise.all(E),K}))}loadAnimationAsync(A,X){return Z.LoadExtensionAsync(A,X,this.name,(async(s,N)=>{const f=await this._loader.loadAnimationAsync(A,X),E=new Array;p.Assign(N.events);for(const g of N.events)E.push(this._loadAnimationEventAsync(`${s}/events/${g.index}`,A,X,g,f));return await Promise.all(E),f}))}_loadClipAsync(A,X){if(X._objectURL)return X._objectURL;let s;if(X.uri)s=this._loader.loadUriAsync(A,X,X.uri);else{const N=p.Get(`${A}/bufferView`,this._loader.Gi.bufferViews,X.bufferView);s=this._loader.loadBufferViewAsync(`/bufferViews/${N.index}`,N)}return X._objectURL=s.then((A=>URL.createObjectURL(new Blob([A],{type:X.mimeType})))),X._objectURL}_loadEmitterAsync(A,X){if(X._babylonSounds=X._babylonSounds||[],!X._babylonData){const A=new Array,s=X.name||`emitter${X.index}`,N={loop:!1,autoplay:!1,volume:void 0==X.volume?1:X.volume};for(let E=0;E<X.clips.length;E++){const f=`/extensions/${this.name}/clips`,g=p.Get(f,this._clips,X.clips[E].clip);A.push(this._loadClipAsync(`${f}/${X.clips[E].clip}`,g).then((A=>{const f=X._babylonSounds[E]=new hX(s,A,this._loader.babylonScene,null,N);f.refDistance=X.refDistance||1,f.maxDistance=X.maxDistance||256,f.rolloffFactor=X.rolloffFactor||1,f.distanceModel=X.distanceModel||"exponential"})))}const f=Promise.all(A).then((()=>{const A=X.clips.map((A=>A.weight||1)),s=new As(X.loop||!1,X._babylonSounds,A);X.innerAngle&&(s.directionalConeInnerAngle=2*g.d.ToDegrees(X.innerAngle)),X.outerAngle&&(s.directionalConeOuterAngle=2*g.d.ToDegrees(X.outerAngle)),X.volume&&(s.volume=X.volume),X._babylonData.sound=s}));X._babylonData={loaded:f}}return X._babylonData.loaded}_getEventAction(A,X,s,N,f){switch(s){case"play":return A=>{const s=(f||0)+(A-N);X.play(s)};case"stop":return()=>{X.stop()};case"pause":return()=>{X.pause()};default:throw new Error(`${A}: Unsupported action ${s}`)}}_loadAnimationEventAsync(A,X,s,N,f){if(0==f.targetedAnimations.length)return Promise.resolve();const E=f.targetedAnimations[0],g=N.j,K=p.Get(`/extensions/${this.name}/emitters`,this._emitters,g);return this._loadEmitterAsync(A,K).then((()=>{const X=K._babylonData.sound;if(X){const s=new BX(N.time,this._getEventAction(A,X,N.action,N.time,N.startOffset));E.animation.addEvent(s),f.onAnimationGroupEndObservable.add((()=>{X.stop()})),f.onAnimationGroupPauseObservable.add((()=>{X.pause()}))}}))}}H(rs),x(rs,!0,(A=>new is(A)));const Ys="MSFT_lod";class vs{constructor(A){var X;this.name=Ys,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Y.b,this.onMaterialLODsLoadedObservable=new Y.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=A,this.maxLODsToLoad=(null===(X=this._loader.parent.extensionOptions[Ys])||void 0===X?void 0:X.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Ys)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let A=0;A<this._nodePromiseLODs.length;A++){const X=Promise.all(this._nodePromiseLODs[A]).then((()=>{0!==A&&(this._loader.endPerformanceCounter(`Node LOD ${A}`),this._loader.log(`Loaded node LOD ${A}`)),this.onNodeLODsLoadedObservable.notifyObservers(A),A!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${A+1}`),this._loadBufferLOD(this._nodeBufferLODs,A+1),this._nodeSignalLODs[A]&&this._nodeSignalLODs[A].resolve())}));this._loader._completePromises.push(X)}for(let A=0;A<this._materialPromiseLODs.length;A++){const X=Promise.all(this._materialPromiseLODs[A]).then((()=>{0!==A&&(this._loader.endPerformanceCounter(`Material LOD ${A}`),this._loader.log(`Loaded material LOD ${A}`)),this.onMaterialLODsLoadedObservable.notifyObservers(A),A!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${A+1}`),this._loadBufferLOD(this._materialBufferLODs,A+1),this._materialSignalLODs[A]&&this._materialSignalLODs[A].resolve())}));this._loader._completePromises.push(X)}}loadSceneAsync(A,X){const s=this._loader.loadSceneAsync(A,X);return this._loadBufferLOD(this._bufferLODs,0),s}loadNodeAsync(A,X,s){return Z.LoadExtensionAsync(A,X,this.name,(async(A,f)=>{let E;const g=this._getLODs(A,X,this._loader.Gi.nodes,f.ids);this._loader.logOpen(`${A}`);for(let X=0;X<g.length;X++){const A=g[X];0!==X&&(this._nodeIndexLOD=X,this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new N);const f=A=>{s(A),A.ci(!1)},K=this._loader.loadNodeAsync(`/nodes/${A.index}`,A,f).then((A=>{if(0!==X){const A=g[X-1];A._babylonTransformNode&&(this._disposeTransformNode(A._babylonTransformNode),delete A._babylonTransformNode)}return A.ci(!0),A}));this._nodePromiseLODs[X]=this._nodePromiseLODs[X]||[],0===X?E=K:(this._nodeIndexLOD=null,this._nodePromiseLODs[X].push(K))}return this._loader.logClose(),await E}))}_loadMaterialAsync(A,X,s,N,f){return this._nodeIndexLOD?null:Z.LoadExtensionAsync(A,X,this.name,(async(A,E)=>{let g;const K=this._getLODs(A,X,this._loader.Gi.materials,E.ids);this._loader.logOpen(`${A}`);for(let X=0;X<K.length;X++){const A=K[X];0!==X&&(this._materialIndexLOD=X);const E=this._loader._loadMaterialAsync(`/materials/${A.index}`,A,s,N,(A=>{0===X&&f(A)})).then((A=>{if(0!==X){f(A);const s=K[X-1]._data;s[N]&&(this._disposeMaterials([s[N].babylonMaterial]),delete s[N])}return A}));this._materialPromiseLODs[X]=this._materialPromiseLODs[X]||[],0===X?g=E:(this._materialIndexLOD=null,this._materialPromiseLODs[X].push(E))}return this._loader.logClose(),await g}))}_loadUriAsync(A,X,s){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const f=this._nodeIndexLOD-1;return this._nodeSignalLODs[f]=this._nodeSignalLODs[f]||new N,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(A,X,s)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const f=this._materialIndexLOD-1;return this._materialSignalLODs[f]=this._materialSignalLODs[f]||new N,this._materialSignalLODs[f].promise.then((async()=>await this._loader.loadUriAsync(A,X,s)))}return null}loadBufferAsync(A,X,s,f){if(this._loader.parent.useRangeRequests&&!X.uri){if(!this._loader.bin)throw new Error(`${A}: Uri is missing or the binary glTF is missing its binary chunk`);const X=async(A,X)=>{const E=s,g=E+f-1;let K=A[X];return K?(K.start=Math.min(K.start,E),K.end=Math.max(K.end,g)):(K={start:E,end:g,loaded:new N},A[X]=K),await K.loaded.promise.then((A=>new Uint8Array(A.buffer,A.byteOffset+s-K.start,f)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?X(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?X(this._materialBufferLODs,this._materialIndexLOD):X(this._bufferLODs,0)}return null}_loadBufferLOD(A,X){const s=A[X];s&&(this._loader.log(`Loading buffer range [${s.start}-${s.end}]`),this._loader.bin.readAsync(s.start,s.end-s.start+1).then((A=>{s.loaded.resolve(A)}),(A=>{s.loaded.reject(A)})))}_getLODs(A,X,s,N){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const f=[];for(let E=N.length-1;E>=0;E--)if(f.push(p.Get(`${A}/ids/${N[E]}`,s,N[E])),f.length===this.maxLODsToLoad)return f;return f.push(X),f}_disposeTransformNode(A){const X=[],s=A.material;s&&X.push(s);for(const f of A.getChildMeshes())f.material&&X.push(f.material);A.dispose();const N=X.filter((A=>this._loader.babylonScene.meshes.every((X=>X.material!=A))));this._disposeMaterials(N)}_disposeMaterials(A){const X={};for(const s of A){for(const A of s.getActiveTextures())X[A.uniqueId]=A;s.dispose()}for(const s in X)for(const A of this._loader.babylonScene.materials)A.hasTexture(X[s])&&delete X[s];for(const s in X)X[s].dispose()}}H(Ys),x(Ys,!0,(A=>new vs(A)));const cs="MSFT_minecraftMesh";class Ms{constructor(A){this.name=cs,this._loader=A,this.enabled=this._loader.isExtensionUsed(cs)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtraAsync(A,X,this.name,(async(N,f)=>{if(f){if(!(s instanceof y))throw new Error(`${N}: Material type not supported`);const f=this._loader.loadMaterialPropertiesAsync(A,X,s);return s.needAlphaBlending()&&(s.forceDepthWrite=!0,s.separateCullingPass=!0),s.yi=s.forceDepthWrite,s.twoSidedLighting=!0,await f}}))}}H(cs),x(cs,!0,(A=>new Ms(A)));const ds="MSFT_sRGBFactors";class Qs{constructor(A){this.name=ds,this._loader=A,this.enabled=this._loader.isExtensionUsed(ds)}dispose(){this._loader=null}loadMaterialPropertiesAsync(A,X,s){return Z.LoadExtraAsync(A,X,this.name,(async(N,f)=>{if(f){if(!(s instanceof y))throw new Error(`${N}: Material type not supported`);const f=this._loader.loadMaterialPropertiesAsync(A,X,s),E=s.va().getEngine().useExactSrgbConversions;return s.albedoTexture||s.albedoColor.toLinearSpaceToRef(s.albedoColor,E),s.reflectivityTexture||s.reflectivityColor.toLinearSpaceToRef(s.reflectivityColor,E),await f}}))}}H(ds),x(ds,!0,(A=>new Qs(A)));var ws=s(12661);const Rs={};var Cs=s(12709),Js=s(12696),as=s(12669),us=s(12677);function zs(A,X){for(const s of A)for(const A of s.dataOutputs)if(A.uniqueId===X)return A;throw new Error("Could not find data out connection with unique id "+X)}function ms(A,X){for(const s of A)if(s instanceof Js.c)for(const A of s.signalInputs)if(A.uniqueId===X)return A;throw new Error("Could not find signal in connection with unique id "+X)}async function bs(A,X){const N=await Promise.all(A.allBlocks.map((async A=>{const X=function(A){switch(A){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([s.e(49),s.e(54)]).then(s.bind(s,13778))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await s.e(55).then(s.bind(s,13781))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await s.e(56).then(s.bind(s,13787))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await s.e(57).then(s.bind(s,13792))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await s.e(58).then(s.bind(s,13796))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await s.e(59).then(s.bind(s,13801))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await s.e(60).then(s.bind(s,13805))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await s.e(61).then(s.bind(s,13810))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await s.e(62).then(s.bind(s,13818))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await s.e(65).then(s.bind(s,13858))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await s.e(65).then(s.bind(s,13858))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await s.e(65).then(s.bind(s,13858))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await s.e(65).then(s.bind(s,13858))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await s.e(70).then(s.bind(s,13863))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await s.e(71).then(s.bind(s,13867))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await s.e(72).then(s.bind(s,13873))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await s.e(73).then(s.bind(s,13878))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await s.e(74).then(s.bind(s,13885))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await s.e(75).then(s.bind(s,13888))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await s.e(76).then(s.bind(s,13890))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await s.e(77).then(s.bind(s,13895))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await s.e(78).then(s.bind(s,13904))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await s.e(79).then(s.bind(s,13908))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await s.e(80).then(s.bind(s,13913))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await s.e(81).then(s.bind(s,13916))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await s.e(82).then(s.bind(s,13919))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await s.e(83).then(s.bind(s,13923))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await s.e(84).then(s.bind(s,13927))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await s.e(85).then(s.bind(s,13930))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await s.e(86).then(s.bind(s,13936))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await s.e(87).then(s.bind(s,13943))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await s.e(88).then(s.bind(s,13952))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await s.e(67).then(s.bind(s,13954))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await s.e(89).then(s.bind(s,13956))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await s.e(90).then(s.bind(s,13959))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await s.e(91).then(s.bind(s,13967))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await s.e(68).then(s.bind(s,13974))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await s.e(63).then(s.bind(s,13826))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await s.e(69).then(s.bind(s,13977))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await s.e(64).then(s.bind(s,13852))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await s.e(65).then(s.bind(s,13858))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await s.e(65).then(s.bind(s,13858))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await s.e(66).then(s.bind(s,13979))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await s.e(66).then(s.bind(s,13979))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await s.e(66).then(s.bind(s,13979))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await s.e(66).then(s.bind(s,13979))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await s.e(66).then(s.bind(s,13979))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await s.e(66).then(s.bind(s,13979))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await s.e(92).then(s.bind(s,13986))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await s.e(93).then(s.bind(s,13990))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await s.e(94).then(s.bind(s,13996))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await s.e(95).then(s.bind(s,14002))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await s.e(96).then(s.bind(s,14005))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await s.e(97).then(s.bind(s,14014))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await s.e(98).then(s.bind(s,14023))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await s.e(99).then(s.bind(s,14032))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await s.e(100).then(s.bind(s,14041))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await s.e(101).then(s.bind(s,14043))).FlowGraphDataSwitchBlock;default:if(Rs[A])return Rs[A];throw new Error(`Unknown block name ${A}`)}}(A.className);return await X()})));return function(A,X,s){const N=X.coordinator.createGraph(),f=[],E=X.valueParseFunction??as.e;for(let g=0;g<A.allBlocks.length;g++){const K=js(A.allBlocks[g],{eg:X.coordinator.config.eg,pathConverter:X.pathConverter,assetsContainer:X.coordinator.config.eg,valueParseFunction:E},s[g]);f.push(K),K instanceof Cs.e&&N.addEventBlock(K)}for(const g of f){for(const A of g.dataInputs)for(const X of A.connectedPointIds){const s=zs(f,X);A.connectTo(s)}if(g instanceof Js.c)for(const A of g.signalOutputs)for(const X of A.connectedPointIds){const s=ms(f,X);A.connectTo(s)}}for(const g of A.executionContexts)ys(g,{graph:N,valueParseFunction:E},A.rightHanded);return N}(A,X,N)}function ys(A,X,s){const N=X.graph.createContext();A.enableLogging&&(N.enableLogging=!0),N.treatDataAsRightHanded=s||!1;const f=X.valueParseFunction??as.e;N.uniqueId=A.uniqueId;const E=N.va();if(A._assetsContext){var g,K,r,i,Y,v,c,M,d,Q;const X=A._assetsContext,s={meshes:null===(g=X.meshes)||void 0===g?void 0:g.map((A=>E.getMeshById(A))),lights:null===(K=X.lights)||void 0===K?void 0:K.map((A=>E.getLightByName(A))),cameras:null===(r=X.cameras)||void 0===r?void 0:r.map((A=>E.getCameraByName(A))),materials:null===(i=X.materials)||void 0===i?void 0:i.map((A=>E.getMaterialById(A))),textures:null===(Y=X.textures)||void 0===Y?void 0:Y.map((A=>E.getTextureByName(A))),animations:null===(v=X.animations)||void 0===v?void 0:v.map((A=>E.animations.find((X=>X.name===A)))),skeletons:null===(c=X.skeletons)||void 0===c?void 0:c.map((A=>E.getSkeletonByName(A))),ri:null===(M=X.ri)||void 0===M?void 0:M.map((A=>E.getParticleSystemById(A))),animationGroups:null===(d=X.animationGroups)||void 0===d?void 0:d.map((A=>E.getAnimationGroupByName(A))),transformNodes:null===(Q=X.transformNodes)||void 0===Q?void 0:Q.map((A=>E.getTransformNodeById(A))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],lm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};N.assetsContext=s}for(const w in A._userVariables){const X=f(w,A._userVariables,N.assetsContext,E);N.userVariables[w]=X}for(const w in A._connectionValues){const X=f(w,A._connectionValues,N.assetsContext,E);N._setConnectionValueByKey(w,X)}return N}function js(A,X,s){const N={},f=X.valueParseFunction??as.e;if(A.config)for(const g in A.config)N[g]=f(g,A.config,X.assetsContainer||X.eg,X.eg);if((0,as.h)(A.className)){if(!X.pathConverter)throw new Error("Path converter is required for this block");N.pathConverter=X.pathConverter}const E=new s(N);E.uniqueId=A.uniqueId;for(let g=0;g<A.dataInputs.length;g++){const X=E.getDataInput(A.dataInputs[g].name);if(!X)throw new Error("Could not find data input with name "+A.dataInputs[g].name+" in block "+A.className);X.deserialize(A.dataInputs[g])}for(let g=0;g<A.dataOutputs.length;g++){const X=E.getDataOutput(A.dataOutputs[g].name);if(!X)throw new Error("Could not find data output with name "+A.dataOutputs[g].name+" in block "+A.className);X.deserialize(A.dataOutputs[g])}return E.metadata=A.metadata,E.deserialize&&E.deserialize(A),E}function Gs(A){const[X,s]=A.split(":");return Vs({op:X,extension:s})}function Vs(A){var X;let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const N=A.extension?null===(X=Os[A.extension])||void 0===X?void 0:X[A.op]:Ps[A.op];if(!N&&(Q.b.Warn(`No mapping found for operation ${A.op} and extension ${A.extension||"KHR_interactivity"}`),s)){const X={},s={flows:{}};if(A.inputValueSockets){X.values={};for(const s in A.inputValueSockets)X.values[s]={name:s}}return A.outputValueSockets&&(s.values={},Object.keys(A.outputValueSockets).forEach((A=>{s.values[A]={name:A}}))),{Rk:[],inputs:X,outputs:s}}return N}function Ds(A,X,s){Os[X]||(Os[X]={}),Os[X][A]=s}const Os={BABYLON:{"flow/log":{Rk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ps={"event/onStart":{Rk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Rk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Rk:["FlowGraphSendCustomEventBlock"],extraProcessor(A,X,s,N,f){if("event/send"!==X.op||!A.configuration||1!==Object.keys(A.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const E=A.configuration.event.value[0];if("number"!==typeof E)throw new Error("Event id should be a number");const g=N.arrays.events[E],K=f[0];return K.config||(K.config={}),K.config.eventId=g.eventId,K.config.eventData=g.eventData,f}},"event/receive":{Rk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(A,X){var s;if(!A.configuration)return Q.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const N=A.configuration.event;if(!N)return Q.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const f=N.value[0];if("number"!==typeof f)return Q.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(s=X.events)||void 0===s?void 0:s[f])?{valid:!0}:(Q.b.Error(`Event with id ${f} not found`),{valid:!1,error:`Event with id ${f} not found`})},extraProcessor(A,X,s,N,f){if("event/receive"!==X.op||!A.configuration||1!==Object.keys(A.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const E=A.configuration.event.value[0];if("number"!==typeof E)throw new Error("Event id should be a number");const g=N.arrays.events[E],K=f[0];return K.config||(K.config={}),K.config.eventId=g.eventId,K.config.eventData=g.eventData,f}},"math/e":ls("FlowGraphEBlock"),"math/pi":ls("FlowGraphPIBlock"),"math/inf":ls("FlowGraphInfBlock"),"math/nan":ls("FlowGraphNaNBlock"),"math/abs":ls("FlowGraphAbsBlock"),"math/sign":ls("FlowGraphSignBlock"),"math/trunc":ls("FlowGraphTruncBlock"),"math/floor":ls("FlowGraphFloorBlock"),"math/ceil":ls("FlowGraphCeilBlock"),"math/round":{Rk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f){var E;return(E=f[0]).config||(E.config={}),f[0].config.roundHalfAwayFromZero=!0,f}},"math/fract":ls("FlowGraphFractBlock"),"math/neg":ls("FlowGraphNegationBlock"),"math/add":ls("FlowGraphAddBlock",["a","b"],!0),"math/sub":ls("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Rk:["FlowGraphMultiplyBlock"],extraProcessor(A,X,s,N,f){var E;(E=f[0]).config||(E.config={}),f[0].config.useMatrixPerComponent=!0,f[0].config.preventIntegerFloatArithmetic=!0;let g=-1;return Object.keys(A.values||{}).find((X=>{var s;return void 0!==(null===(s=A.values)||void 0===s?void 0:s[X].type)&&(g=A.values[X].type,!0)})),-1!==g&&(f[0].config.type=N.arrays.types[g].flowGraphType),f},validation:A=>A.values?ns(A):{valid:!0}},"math/div":ls("FlowGraphDivideBlock",["a","b"],!0),"math/rem":ls("FlowGraphModuloBlock",["a","b"]),"math/min":ls("FlowGraphMinBlock",["a","b"]),"math/max":ls("FlowGraphMaxBlock",["a","b"]),"math/clamp":ls("FlowGraphClampBlock",["a","b","c"]),"math/saturate":ls("FlowGraphSaturateBlock"),"math/mix":ls("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":ls("FlowGraphEqualityBlock",["a","b"]),"math/lt":ls("FlowGraphLessThanBlock",["a","b"]),"math/le":ls("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":ls("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":ls("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":ls("FlowGraphIsNaNBlock"),"math/isinf":ls("FlowGraphIsInfBlock"),"math/select":{Rk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Rk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":ls("FlowGraphSinBlock"),"math/cos":ls("FlowGraphCosBlock"),"math/tan":ls("FlowGraphTanBlock"),"math/asin":ls("FlowGraphASinBlock"),"math/acos":ls("FlowGraphACosBlock"),"math/atan":ls("FlowGraphATanBlock"),"math/atan2":ls("FlowGraphATan2Block",["a","b"]),"math/sinh":ls("FlowGraphSinhBlock"),"math/cosh":ls("FlowGraphCoshBlock"),"math/tanh":ls("FlowGraphTanhBlock"),"math/asinh":ls("FlowGraphASinhBlock"),"math/acosh":ls("FlowGraphACoshBlock"),"math/atanh":ls("FlowGraphATanhBlock"),"math/exp":ls("FlowGraphExponentialBlock"),"math/log":ls("FlowGraphLogBlock"),"math/log2":ls("FlowGraphLog2Block"),"math/log10":ls("FlowGraphLog10Block"),"math/sqrt":ls("FlowGraphSquareRootBlock"),"math/cbrt":ls("FlowGraphCubeRootBlock"),"math/pow":ls("FlowGraphPowerBlock",["a","b"]),"math/length":ls("FlowGraphLengthBlock"),"math/normalize":ls("FlowGraphNormalizeBlock"),"math/dot":ls("FlowGraphDotBlock",["a","b"]),"math/cross":ls("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":ls("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":ls("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Rk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Rk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Rk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Rk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Rk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Rk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Rk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":ls("FlowGraphTransposeBlock"),"math/determinant":ls("FlowGraphDeterminantBlock"),"math/inverse":ls("FlowGraphInvertMatrixBlock"),"math/matmul":ls("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Rk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"hi",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f,E){const g=f[0].dataInputs.find((A=>"rotationQuaternion"===A.name));if(!g)throw new Error("Rotation quaternion input not found");return E._connectionValues[g.uniqueId]&&(E._connectionValues[g.uniqueId].type="Quaternion"),f}},"math/matDecompose":{Rk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"hi"}}}},"math/quatConjugate":ls("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Rk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f){var E;return(E=f[0]).config||(E.config={}),f[0].config.type="Quaternion",f}},"math/quatAngleBetween":ls("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Rk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":ls("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":ls("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Rk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f){var E;return(E=f[0]).config||(E.config={}),f[0].config.inputIsColumnMajor=!0,f}},"math/extract2x2":{Rk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Rk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f){var E;return(E=f[0]).config||(E.config={}),f[0].config.inputIsColumnMajor=!0,f}},"math/extract3x3":{Rk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Rk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f){var E;return(E=f[0]).config||(E.config={}),f[0].config.inputIsColumnMajor=!0,f}},"math/extract4x4":{Rk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Rk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f,E){var g,K;(K=f[0]).config||(K.config={});const r=f[0].dataInputs[0];return f[0].config.valueType=(null===(g=E._connectionValues[r.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",f}},"math/and":{Rk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f,E){var g,K,r;(r=f[0]).config||(r.config={});const i=f[0].dataInputs[0],Y=f[0].dataInputs[1];return f[0].config.valueType=(null===(g=E._connectionValues[i.uniqueId])||void 0===g?void 0:g.type)??(null===(K=E._connectionValues[Y.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",f}},"math/or":{Rk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f,E){var g,K,r;(r=f[0]).config||(r.config={});const i=f[0].dataInputs[0],Y=f[0].dataInputs[1];return f[0].config.valueType=(null===(g=E._connectionValues[i.uniqueId])||void 0===g?void 0:g.type)??(null===(K=E._connectionValues[Y.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",f}},"math/xor":{Rk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(A,X,s,N,f,E){var g,K,r;(r=f[0]).config||(r.config={});const i=f[0].dataInputs[0],Y=f[0].dataInputs[1];return f[0].config.valueType=(null===(g=E._connectionValues[i.uniqueId])||void 0===g?void 0:g.type)??(null===(K=E._connectionValues[Y.uniqueId])||void 0===K?void 0:K.type)??"FlowGraphInteger",f}},"math/asr":ls("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":ls("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":ls("FlowGraphLeadingZerosBlock"),"math/ctz":ls("FlowGraphTrailingZerosBlock"),"math/popcnt":ls("FlowGraphOneBitsCounterBlock"),"math/rad":ls("FlowGraphDegToRadBlock"),"math/deg":ls("FlowGraphRadToDegBlock"),"type/boolToInt":ls("FlowGraphBooleanToInt"),"type/boolToFloat":ls("FlowGraphBooleanToFloat"),"type/intToBool":ls("FlowGraphIntToBoolean"),"type/intToFloat":ls("FlowGraphIntToFloat"),"type/floatToInt":ls("FlowGraphFloatToInt"),"type/floatToBool":ls("FlowGraphFloatToBoolean"),"flow/sequence":{Rk:["FlowGraphSequenceBlock"],extraProcessor(A,X,s,N,f){const E=f[0];return E.config||(E.config={}),E.config.outputSignalCount=Object.keys(A.flows||[]).length,E.signalOutputs.forEach(((A,X)=>{A.name="out_"+X})),f}},"flow/branch":{Rk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Rk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(A){if(A.configuration&&A.configuration.cases){const X=A.configuration.cases.value;if(!X.every((A=>"number"===typeof A&&/^-?\d+$/.test(A.toString()))))return Q.b.Warn("Switch cases should be integers. Using empty array instead."),A.configuration.cases.value=[],{valid:!0};const s=new Set(X);A.configuration.cases.value=Array.from(s)}return{valid:!0}},extraProcessor(A,X,s,N,f){if("flow/switch"!==X.op||!A.flows||0===Object.keys(A.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return f[0].signalOutputs.forEach((A=>{"default"!==A.name&&(A.name="out_"+A.name)})),f}},"flow/while":{Rk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Rk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(A,X,s,N,f){const E=f[0];return E.config||(E.config={}),E.config.incrementIndexWhenLoopDone=!0,f}},"flow/doN":{Rk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Rk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(A,X,s,N,f){if("flow/multiGate"!==X.op||!A.flows||0===Object.keys(A.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const E=f[0];return E.config||(E.config={}),E.config.outputSignalCount=Object.keys(A.flows).length,E.signalOutputs.forEach(((A,X)=>{A.name="out_"+X})),f}},"flow/waitAll":{Rk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(A){var X,s;return"number"!==typeof(null===(X=A.configuration)||void 0===X||null===(s=X.inputFlows)||void 0===s?void 0:s.value[0])&&(A.configuration=A.configuration||{inputFlows:{value:[0]}},A.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Rk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Rk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Rk:["FlowGraphCancelDelayBlock"]},"variable/get":{Rk:["FlowGraphGetVariableBlock"],validation(A){var X,s;return null!==(X=A.configuration)&&void 0!==X&&null!==(s=X.variable)&&void 0!==s&&s.value?{valid:!0}:(Q.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(A,X)=>[X.getVariableName(A[0])]}}},"variable/set":{Rk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(A,X)=>[X.getVariableName(A[0])]}}},"variable/setMultiple":{Rk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(A,X)=>[A[0].map((A=>X.getVariableName(A)))]}},extraProcessor:(A,X,s,N,f)=>(f[0].dataInputs.forEach((A=>{A.name=N.getVariableName(+A.name)})),f)},"variable/interpolate":{Rk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(A,X)=>[X.getVariableName(A[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:A=>!0===A[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(A,X,s,N,f){var E,g,K;const r=f[0],i=null===(E=A.configuration)||void 0===E?void 0:E.variable.value[0];if("number"!==typeof i)throw Q.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const Y=N.arrays.staticVariables[i];"undefined"===typeof r.config.animationType.value&&(N.arrays.staticVariables,r.config.animationType.value=(0,us.y)(Y.type));const v=f[4];return v.config||(v.config={}),(g=v.config).variable||(g.variable={}),v.config.variable.value=N.getVariableName(i),(K=f[3]).config||(K.config={}),f}},"pointer/get":{Rk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(A,X,s,N,f)=>(f.forEach((A=>{"FlowGraphJsonPointerParserBlock"===A.className&&(A.config||(A.config={}),A.config.outputValue=!0)})),f)},"pointer/set":{Rk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(A,X,s,N,f)=>(f.forEach((A=>{"FlowGraphJsonPointerParserBlock"===A.className&&(A.config||(A.config={}),A.config.outputValue=!0)})),f)},"pointer/interpolate":{Rk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(A,X,s,N,f)=>(f.forEach((X=>{"FlowGraphJsonPointerParserBlock"===X.className?(X.config||(X.config={}),X.config.outputValue=!0):"FlowGraphInterpolationBlock"===X.className&&(X.config||(X.config={}),Object.keys(A.values||[]).forEach((s=>{var f;const E=null===(f=A.values)||void 0===f?void 0:f[s];if("value"===s&&E){const A=E.type;void 0!==A&&(X.config.animationType=N.arrays.types[A].flowGraphType)}})))})),f)},"animation/start":{Rk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(A,X)=>[A[0]*X._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(A,X)=>[A[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(A,X,s,N,f,E,g){const K=f[f.length-1];return K.config||(K.config={}),K.config.glTF=g,f}},"animation/stop":{Rk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(A,X,s,N,f,E,g){const K=f[f.length-1];return K.config||(K.config={}),K.config.glTF=g,f}},"animation/stopAt":{Rk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(A,X)=>[A[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(A,X,s,N,f,E,g){const K=f[f.length-1];return K.config||(K.config={}),K.config.glTF=g,f}},"math/switch":{Rk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(A){if(A.configuration&&A.configuration.cases){const X=A.configuration.cases.value;if(!X.every((A=>"number"===typeof A&&/^-?\d+$/.test(A.toString()))))return Q.b.Warn("Switch cases should be integers. Using empty array instead."),A.configuration.cases.value=[],{valid:!0};const s=new Set(X);A.configuration.cases.value=Array.from(s)}return{valid:!0}},extraProcessor(A,X,s,N,f){const E=f[0];return E.dataInputs.forEach((A=>{"default"!==A.name&&"case"!==A.name&&(A.name="in_"+A.name)})),E.config||(E.config={}),E.config.treatCasesAsIntegers=!0,f}},"debug/log":{Rk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function ls(A){let X=arguments.length>2?arguments[2]:void 0;return{Rk:[A],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((A,X)=>(A[X]={name:X},A)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(A,s,N,f,E){var g;if(X){(g=E[0]).config||(g.config={}),E[0].config.preventIntegerFloatArithmetic=!0;let X=-1;Object.keys(A.values||{}).find((s=>{var N;return void 0!==(null===(N=A.values)||void 0===N?void 0:N[s].type)&&(X=A.values[s].type,!0)})),-1!==X&&(E[0].config.type=f.arrays.types[X].flowGraphType)}return E},validation:A=>X?ns(A):{valid:!0}}}function ns(A){if(A.values){const X=Object.keys(A.values).map((X=>A.values[X].type)).filter((A=>void 0!==A));if(!X.every((A=>A===X[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Ps["math/compose"]=Ps["math/matCompose"],Ps["math/decompose"]=Ps["math/matDecompose"];var Us=s(624);const ts={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"oi",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class es{constructor(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=A,this._gltf=X,this._animationTargetFps=s,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const A of this._interactivityGraph.types)this._types.push(ts[A.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const A of this._interactivityGraph.declarations){const X=Vs(A);if(!X)throw Q.b.Error(["No mapping found for declaration",A]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:X,fullOperationName:A.extension?A.op+":"+A.extension:A.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const A of this._interactivityGraph.variables){const X=this._parseVariable(A);this._staticVariables.push(X)}}_parseVariable(A,X){const s=this._types[A.type];if(!s)throw Q.b.Error(["No type found for variable",A]),new Error("Error parsing variables");if(A.value&&A.value.length!==s.length)throw Q.b.Error(["Invalid value length for variable",A,s]),new Error("Error parsing variables");const N=A.value||[];if(!N.length)switch(s.flowGraphType){case"boolean":N.push(!1);break;case"FlowGraphInteger":N.push(0);break;case"number":N.push(NaN);break;case"Vector2":N.push(NaN,NaN);break;case"oi":N.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":N.fill(NaN,0,4);break;case"Matrix":N.fill(NaN,0,16);break;case"Matrix3D":N.fill(NaN,0,9)}return"number"===s.elementType&&"string"===typeof N[0]&&(N[0]=parseFloat(N[0])),{type:s.flowGraphType,value:X?X(N,this):N}}_parseEvents(){if(this._interactivityGraph.events)for(const A of this._interactivityGraph.events){const X={eventId:A.id||"internalEvent_"+this._internalEventsCounter++};A.values&&(X.eventData=Object.keys(A.values).map((X=>{var s;const N=null===(s=A.values)||void 0===s?void 0:s[X];if(!N)throw Q.b.Error(["No value found for event key",X]),new Error("Error parsing events");const f=this._types[N.type];if(!f)throw Q.b.Error(["No type found for event value",N]),new Error("Error parsing events");const E="undefined"!==typeof N.value?this._parseVariable(N):void 0;return{id:X,type:f.flowGraphType,eventData:!0,value:E}}))),this._events.push(X)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const X of this._interactivityGraph.nodes){if("number"!==typeof X.declaration)throw Q.b.Error(["No declaration found for node",X]),new Error("Error parsing nodes");const s=this._mappings[X.declaration];if(!s)throw Q.b.Error(["No mapping found for node",X]),new Error("Error parsing nodes");if(s.flowGraphMapping.validation){const N=s.flowGraphMapping.validation(X,this._interactivityGraph,this._gltf);var A;if(!N.valid)throw new Error(`Error validating interactivity node ${null===(A=this._interactivityGraph.declarations)||void 0===A?void 0:A[X.declaration].op} - ${N.error}`)}const N=[];for(const A of s.flowGraphMapping.Rk){const f=this._getEmptyBlock(A,s.fullOperationName);this._parseNodeConfiguration(X,f,s.flowGraphMapping,A),N.push(f)}this._nodes.push({Rk:N,fullOperationName:s.fullOperationName})}}_getEmptyBlock(A,X){return{uniqueId:(0,Us.c)(),className:A,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:X,metadata:{}}}_parseNodeConfiguration(A,X,s,N){const f=X.config;if(A.configuration){const X=Object.keys(A.configuration);for(const K of X){var E,g;const X=null===(E=A.configuration)||void 0===E?void 0:E[K];if(!X)throw Q.b.Error(["No value found for node configuration",K]),new Error("Error parsing node configuration");const r=null===(g=s.configuration)||void 0===g?void 0:g[K];if(r&&r.toBlock?r.toBlock===N:0===s.Rk.indexOf(N)){const A=(null===r||void 0===r?void 0:r.name)||K;X&&"undefined"!==typeof X.value||"undefined"===typeof(null===r||void 0===r?void 0:r.defaultValue)?X.value.length>=0?f[A]={value:1===X.value.length?X.value[0]:X.value}:Q.b.Warn(["Invalid value for node configuration",X]):f[A]={value:r.defaultValue},r&&r.dataTransformer&&(f[A].value=r.dataTransformer([f[A].value],this)[0])}}}}_parseNodeConnections(A){for(let z=0;z<this._nodes.length;z++){var X;const m=null===(X=this._interactivityGraph.nodes)||void 0===X?void 0:X[z];if(!m)throw Q.b.Error(["No node found for interactivity node",this._nodes[z]]),new Error("Error parsing node connections");const b=this._nodes[z],y=this._mappings[m.declaration];if(!y)throw Q.b.Error(["No mapping found for node",m]),new Error("Error parsing node connections");const j=m.flows||{},G=Object.keys(j).sort();for(const A of G){var s,N,f,E;const X=j[A],i=null===(s=y.flowGraphMapping.outputs)||void 0===s||null===(N=s.flows)||void 0===N?void 0:N[A],Y=(null===i||void 0===i?void 0:i.name)||A,v=this._createNewSocketConnection(Y,!0);(i&&i.toBlock&&b.Rk.find((A=>A.className===i.toBlock))||b.Rk[0]).signalOutputs.push(v);const c=X.node,M=this._nodes[c];if(!M)throw Q.b.Error(["No node found for input node id",c]),new Error("Error parsing node connections");const d=Gs(M.fullOperationName);if(!d)throw Q.b.Error(["No mapping found for input node",M]),new Error("Error parsing node connections");let w=null===(f=d.inputs)||void 0===f||null===(E=f.flows)||void 0===E?void 0:E[X.socket||"in"],R=!1;if(!w)for(const A in null===(g=d.inputs)||void 0===g?void 0:g.flows){var g,K,r;if(A.startsWith("[")&&A.endsWith("]"))R=!0,w=null===(K=d.inputs)||void 0===K||null===(r=K.flows)||void 0===r?void 0:r[A]}const C=w?R?w.name.replace("$1",X.socket||""):w.name:X.socket||"in",J=w&&w.toBlock&&M.Rk.find((A=>A.className===w.toBlock))||M.Rk[0];let a=J.signalInputs.find((A=>A.name===C));a||(a=this._createNewSocketConnection(C),J.signalInputs.push(a)),a.connectedPointIds.push(v.uniqueId),v.connectedPointIds.push(a.uniqueId)}const V=m.values||{},D=Object.keys(V);for(const X of D){var i,Y;const s=V[X];let N=null===(i=y.flowGraphMapping.inputs)||void 0===i||null===(Y=i.values)||void 0===Y?void 0:Y[X],f=!1;if(!N)for(const A in null===(v=y.flowGraphMapping.inputs)||void 0===v?void 0:v.values){var v,c,M;if(A.startsWith("[")&&A.endsWith("]"))f=!0,N=null===(c=y.flowGraphMapping.inputs)||void 0===c||null===(M=c.values)||void 0===M?void 0:M[A]}const E=N?f?N.name.replace("$1",X):N.name:X,g=this._createNewSocketConnection(E);if((N&&N.toBlock&&b.Rk.find((A=>A.className===N.toBlock))||b.Rk[0]).dataInputs.push(g),void 0!==s.value){const X=this._parseVariable(s,N&&N.dataTransformer);A._connectionValues[g.uniqueId]=X}else{if("undefined"===typeof s.node)throw Q.b.Error(["Invalid value for value connection",s]),new Error("Error parsing node connections");{var d,w,R;const A=s.node,X=s.socket||"value",N=this._nodes[A];if(!N)throw Q.b.Error(["No node found for output socket reference",s]),new Error("Error parsing node connections");const f=Gs(N.fullOperationName);if(!f)throw Q.b.Error(["No mapping found for output socket reference",s]),new Error("Error parsing node connections");let E=null===(d=f.outputs)||void 0===d||null===(w=d.values)||void 0===w?void 0:w[X],K=!1;if(!E)for(const s in null===(C=f.outputs)||void 0===C?void 0:C.values){var C,J,a;if(s.startsWith("[")&&s.endsWith("]"))K=!0,E=null===(J=f.outputs)||void 0===J||null===(a=J.values)||void 0===a?void 0:a[s]}const r=E?K?E.name.replace("$1",X):null===(R=E)||void 0===R?void 0:R.name:X,i=E&&E.toBlock&&N.Rk.find((A=>A.className===E.toBlock))||N.Rk[0];let Y=i.dataOutputs.find((A=>A.name===r));Y||(Y=this._createNewSocketConnection(r,!0),i.dataOutputs.push(Y)),g.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(g.uniqueId)}}}if(y.flowGraphMapping.interBlockConnectors)for(const A of y.flowGraphMapping.interBlockConnectors){const X=A.input,s=A.output,N=A.isVariable;this._connectFlowGraphNodes(X,s,b.Rk[A.inputBlockIndex],b.Rk[A.outputBlockIndex],N)}if(y.flowGraphMapping.extraProcessor){var u;const X=null===(u=this._interactivityGraph.declarations)||void 0===u?void 0:u[m.declaration];if(!X)throw Q.b.Error(["No declaration found for extra processor",m]),new Error("Error parsing node connections");b.Rk=y.flowGraphMapping.extraProcessor(m,X,y.flowGraphMapping,this,b.Rk,A,this._gltf)}}}_createNewSocketConnection(A,X){return{uniqueId:(0,Us.c)(),name:A,_connectionType:X?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(A,X,s,N,f){const E=f?s.dataInputs:s.signalInputs,g=f?N.dataOutputs:N.signalOutputs,K=E.find((X=>X.name===A))||this._createNewSocketConnection(A),r=g.find((A=>A.name===X))||this._createNewSocketConnection(X,!0);E.find((X=>X.name===A))||E.push(K),g.find((A=>A.name===X))||g.push(r),K.connectedPointIds.push(r.uniqueId),r.connectedPointIds.push(K.uniqueId)}getVariableName(A){return"staticVariable_"+A}serializeToFlowGraph(){const A={uniqueId:(0,Us.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(A);for(let X=0;X<this._staticVariables.length;X++){const s=this._staticVariables[X];A._userVariables[this.getVariableName(X)]=s}return{rightHanded:!0,allBlocks:this._nodes.reduce(((A,X)=>A.concat(X.Rk)),[]),executionContexts:[A]}}}const Ts="KHR_interactivity";class Is{constructor(A){this._loader=A,this.name=Ts,this.enabled=this._loader.isExtensionUsed(Ts),this._pathConverter=(0,F.h)(this._loader.Gi),A._skipStartAnimationStep=!0;const X=A.babylonScene;X&&function(A){(0,F.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!A.activeCamera)return new f.d(NaN,NaN,NaN,NaN);const X=f.d.FromRotationMatrix(A.activeCamera.getWorldMatrix()).normalize();return A.useRightHandedSystem||(X.w*=-1,X.x*=-1),X},type:"Quaternion",getTarget:()=>A.activeCamera}),(0,F.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!A.activeCamera)return new f.k(NaN,NaN,NaN);const X=A.activeCamera.getWorldMatrix().getTranslation();return A.useRightHandedSystem||(X.x*=-1),X},type:"oi",getTarget:()=>A.activeCamera}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:A=>{var X;return(null===(X=A._babylonAnimationGroup)||void 0===X?void 0:X.isPlaying)??!1},type:"boolean",getTarget:A=>A._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:A=>{var X;return((null===(X=A._babylonAnimationGroup)||void 0===X?void 0:X.from)??0)/60},type:"number",getTarget:A=>A._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:A=>{var X;return((null===(X=A._babylonAnimationGroup)||void 0===X?void 0:X.to)??0)/60},type:"number",getTarget:A=>A._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:A=>{var X;return((null===(X=A._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:A=>A._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:A=>{var X;return((null===(X=A._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:A=>A._babylonAnimationGroup})}(X)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var A;if(!this._loader.babylonScene||!this._pathConverter)return;const X=this._loader.babylonScene,s=null===(A=this._loader.Gi.extensions)||void 0===A?void 0:A.KHR_interactivity;if(!s)return;const N=new ws.e({eg:X});N.dispatchEventsSynchronously=!1;const f=s.graphs.map((A=>new es(A,this._loader.Gi,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(f.map((async A=>await bs(A,{coordinator:N,pathConverter:this._pathConverter})))),N.start()}}var Ls;Ls=async()=>(await Promise.resolve().then(s.bind(s,12729))).FlowGraphGLTFDataProvider,Rs[`${Ts}/${"FlowGraphGLTFDataProvider"}`]=Ls,H(Ts),x(Ts,!0,(A=>new Is(A)));const ks="KHR_node_visibility";(0,F.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:A=>{const X=A._babylonTransformNode;return!X||void 0===X.isVisible||X.isVisible},set:(A,X)=>{var s,N;null===(s=X._primitiveBabylonMeshes)||void 0===s||s.forEach((A=>{A.inheritVisibility=!0})),X._babylonTransformNode&&(X._babylonTransformNode.isVisible=A),null===(N=X._primitiveBabylonMeshes)||void 0===N||N.forEach((X=>{X.isVisible=A}))},getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class xs{constructor(A){this.name=ks,this._loader=A,this.enabled=A.isExtensionUsed(ks)}async onReady(){var A;null===(A=this._loader.Gi.nodes)||void 0===A||A.forEach((A=>{var X,s,N,f;(null===(X=A._primitiveBabylonMeshes)||void 0===X||X.forEach((A=>{A.inheritVisibility=!0})),null!==(s=A.extensions)&&void 0!==s&&s.KHR_node_visibility)&&(!1===(null===(N=A.extensions)||void 0===N?void 0:N.KHR_node_visibility.visible)&&(A._babylonTransformNode&&(A._babylonTransformNode.isVisible=!1),null===(f=A._primitiveBabylonMeshes)||void 0===f||f.forEach((A=>{A.isVisible=!1}))))}))}dispose(){this._loader=null}}H(ks),x(ks,!0,(A=>new xs(A)));const Hs="KHR_node_selectability";Ds("event/onSelect",Hs,{Rk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:A=>["pickedMesh_"+A[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(A,X,s,N,f,E,g){var K,r,i,Y,v,c;const M=f[f.length-1];M.config=M.config||{},M.config.glTF=g;const d=null===(K=A.configuration)||void 0===K||null===(r=K.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const Q="pickedMesh_"+d;return f[1].config.variable=Q,E._userVariables[Q]={className:"Mesh",id:null===g||void 0===g||null===(i=g.nodes)||void 0===i||null===(Y=i[d]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===g||void 0===g||null===(v=g.nodes)||void 0===v||null===(c=v[d]._babylonTransformNode)||void 0===c?void 0:c.uniqueId},f}}),(0,F.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:A=>{const X=A._babylonTransformNode;return!X||void 0===X.Ai||X.Ai},set:(A,X)=>{var s;null===(s=X._primitiveBabylonMeshes)||void 0===s||s.forEach((X=>{X.Ai=A}))},getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"Ai"],type:"boolean"});class Fs{constructor(A){this.name=Hs,this._loader=A,this.enabled=A.isExtensionUsed(Hs)}async onReady(){var A;null===(A=this._loader.Gi.nodes)||void 0===A||A.forEach((A=>{var X,s,N;null!==(X=A.extensions)&&void 0!==X&&X.KHR_node_selectability&&!1===(null===(s=A.extensions)||void 0===s?void 0:s.KHR_node_selectability.selectable)&&(null===(N=A._babylonTransformNode)||void 0===N||N.getChildMeshes().forEach((A=>{A.Ai=!1})))}))}dispose(){this._loader=null}}H(Hs),x(Hs,!0,(A=>new Fs(A)));const qs="KHR_node_hoverability",Ss="targetMeshPointerOver_";Ds("event/onHoverIn",qs,{Rk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:A=>[Ss+A[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(A,X,s,N,f,E,g){var K,r,i,Y,v,c;const M=f[f.length-1];M.config=M.config||{},M.config.glTF=g;const d=null===(K=A.configuration)||void 0===K||null===(r=K.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const Q=Ss+d;return f[1].config.variable=Q,E._userVariables[Q]={className:"Mesh",id:null===g||void 0===g||null===(i=g.nodes)||void 0===i||null===(Y=i[d]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===g||void 0===g||null===(v=g.nodes)||void 0===v||null===(c=v[d]._babylonTransformNode)||void 0===c?void 0:c.uniqueId},f}});const ps="targetMeshPointerOut_";Ds("event/onHoverOut",qs,{Rk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:A=>[ps+A[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(A,X,s,N,f,E,g){var K,r,i,Y,v,c;const M=f[f.length-1];M.config=M.config||{},M.config.glTF=g;const d=null===(K=A.configuration)||void 0===K||null===(r=K.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const Q=ps+d;return f[1].config.variable=Q,E._userVariables[Q]={className:"Mesh",id:null===g||void 0===g||null===(i=g.nodes)||void 0===i||null===(Y=i[d]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===g||void 0===g||null===(v=g.nodes)||void 0===v||null===(c=v[d]._babylonTransformNode)||void 0===c?void 0:c.uniqueId},f}}),(0,F.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:A=>{const X=A._babylonTransformNode;return!X||void 0===X.pointerOverDisableMeshTesting||X.pointerOverDisableMeshTesting},set:(A,X)=>{var s;null===(s=X._primitiveBabylonMeshes)||void 0===s||s.forEach((X=>{X.pointerOverDisableMeshTesting=!A}))},getTarget:A=>A._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Bs{constructor(A){this.name=qs,this._loader=A,this.enabled=A.isExtensionUsed(qs)}async onReady(){var A;null===(A=this._loader.Gi.nodes)||void 0===A||A.forEach((A=>{var X,s,N;null!==(X=A.extensions)&&void 0!==X&&X.KHR_node_hoverability&&!1===(null===(s=A.extensions)||void 0===s?void 0:s.KHR_node_hoverability.hoverable)&&(null===(N=A._babylonTransformNode)||void 0===N||N.getChildMeshes().forEach((A=>{A.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}H(qs),x(qs,!0,(A=>new Bs(A)));const Zs="ExtrasAsMetadata";class os{_assignExtras(A,X){if(X.extras&&Object.keys(X.extras).length>0){const s=A.metadata=A.metadata||{};(s.Gi=s.Gi||{}).extras=X.extras}}constructor(A){this.name=Zs,this.enabled=!0,this._loader=A}dispose(){this._loader=null}loadNodeAsync(A,X,s){return this._loader.loadNodeAsync(A,X,(A=>{this._assignExtras(A,X),s(A)}))}loadCameraAsync(A,X,s){return this._loader.loadCameraAsync(A,X,(A=>{this._assignExtras(A,X),s(A)}))}createMaterial(A,X,s){const N=this._loader.createMaterial(A,X,s);return this._assignExtras(N,X),N}}H(Zs),x(Zs,!1,(A=>new os(A)));s(12729)},12585:(A,X,s)=>{"use strict";s.d(X,{b:()=>P,f:()=>y,h:()=>b,l:()=>j});var N=s(454),f=s(456),E=s(12218),g=s(452),K=s(810),r=s(804),i=s(470),Y=s(503),v=s(12593),c=s(12599),M=s(653),d=s(638);class Q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ri=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.lm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(A){this._environmentTexture=A}getNodes(){let A=[];A=A.concat(this.meshes),A=A.concat(this.lights),A=A.concat(this.cameras),A=A.concat(this.transformNodes);for(const X of this.skeletons)A=A.concat(X.bones);return A}}class w extends Q{}class R{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const A=this.rootNodes;for(const N of A)N.dispose();A.length=0;const X=this.skeletons;for(const N of X)N.dispose();X.length=0;const s=this.animationGroups;for(const N of s)N.dispose();s.length=0}}class C extends Q{constructor(A){super(),this._wasAddedToScene=!1,(A=A||Y.b.LastCreatedScene)&&(this.eg=A,this.proceduralTextures=[],A.Ji.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=A.getEngine().onContextRestoredObservable.add((()=>{for(const A of this.geometries)A._rebuild();for(const A of this.meshes)A._rebuild();for(const A of this.ri)A.rebuild();for(const A of this.textures)A._rebuild()})))}_topologicalSort(A){const X=new Map;for(const g of A)X.set(g.uniqueId,g);const s={dependsOn:new Map,dependedBy:new Map};for(const g of A){const A=g.uniqueId;s.dependsOn.set(A,new Set),s.dependedBy.set(A,new Set)}for(const g of A){const A=g.uniqueId,N=s.dependsOn.get(A);if(g instanceof v.d){const f=g.sourceMesh;X.has(f.uniqueId)&&(N.add(f.uniqueId),s.dependedBy.get(f.uniqueId).add(A))}const f=s.dependedBy.get(A);for(const E of g.getDescendants()){const N=E.uniqueId;if(X.has(N)){f.add(N);s.dependsOn.get(N).add(A)}}}const N=[],f=[];for(const g of A){const A=g.uniqueId;0===s.dependsOn.get(A).size&&(f.push(g),X.delete(A))}const E=f;for(;E.length>0;){const A=E.shift();N.push(A);const f=s.dependedBy.get(A.uniqueId);for(const N of Array.from(f.values())){const f=s.dependsOn.get(N);f.delete(A.uniqueId),0===f.size&&X.get(N)&&(E.push(X.get(N)),X.delete(N))}}return X.size>0&&(i.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),X.forEach((A=>{i.b.Error(A.name)}))),N}_addNodeAndDescendantsToList(A,X,s,N){if(s&&(!N||N(s))&&!X.has(s.uniqueId)){A.push(s),X.add(s.uniqueId);for(const f of s.getDescendants(!0))this._addNodeAndDescendantsToList(A,X,f,N)}}_isNodeInContainer(A){return A instanceof r.e&&-1!==this.meshes.indexOf(A)||(A instanceof K.c&&-1!==this.transformNodes.indexOf(A)||(A instanceof c.b&&-1!==this.lights.indexOf(A)||A instanceof M.b&&-1!==this.cameras.indexOf(A)))}_isValidHierarchy(){for(const A of this.meshes)if(A.parent&&!this._isNodeInContainer(A.parent))return i.b.Warn(`Node ${A.name} has a parent that is not in the container.`),!1;for(const A of this.transformNodes)if(A.parent&&!this._isNodeInContainer(A.parent))return i.b.Warn(`Node ${A.name} has a parent that is not in the container.`),!1;for(const A of this.lights)if(A.parent&&!this._isNodeInContainer(A.parent))return i.b.Warn(`Node ${A.name} has a parent that is not in the container.`),!1;for(const A of this.cameras)if(A.parent&&!this._isNodeInContainer(A.parent))return i.b.Warn(`Node ${A.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(A){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||f.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const N={},E={},K=new R,r=[],i=[],Y={doNotInstantiate:!0,...s},v=[],c=new Set;for(const f of this.transformNodes)null===f.parent&&this._addNodeAndDescendantsToList(v,c,f,Y.predicate);for(const f of this.meshes)null===f.parent&&this._addNodeAndDescendantsToList(v,c,f,Y.predicate);const M=this._topologicalSort(v),d=(s,f)=>{if(((X,s)=>{if(N[X.uniqueId]=s.uniqueId,E[s.uniqueId]=s,A&&(s.name=A(X.name)),s instanceof g.d){const A=s;if(A.morphTargetManager){const s=X.morphTargetManager;A.morphTargetManager=s.clone();for(let X=0;X<s.numTargets;X++){const f=s.getTarget(X),g=A.morphTargetManager.getTarget(X);N[f.uniqueId]=g.uniqueId,E[g.uniqueId]=g}}}})(s,f),s.parent){const A=N[s.parent.uniqueId],X=E[A];f.parent=X||s.parent}if(f.position&&s.position&&f.position.p(s.position),f.rotationQuaternion&&s.rotationQuaternion&&f.rotationQuaternion.p(s.rotationQuaternion),f.rotation&&s.rotation&&f.rotation.p(s.rotation),f.hi&&s.hi&&f.hi.p(s.hi),f.material){const g=f;if(g.material)if(X){const X=s.material;if(-1===i.indexOf(X)){let s=X.clone(A?A(X.name):"Clone of "+X.name);if(i.push(X),N[X.uniqueId]=s.uniqueId,E[s.uniqueId]=s,"MultiMaterial"===X.getClassName()){const f=X;for(const X of f.Bi)X&&(s=X.clone(A?A(X.name):"Clone of "+X.name),i.push(X),N[X.uniqueId]=s.uniqueId,E[s.uniqueId]=s);f.Bi=f.Bi.map((A=>A&&E[N[A.uniqueId]]))}}"InstancedMesh"!==g.getClassName()&&(g.material=E[N[X.uniqueId]])}else"MultiMaterial"===g.material.getClassName()?-1===this.eg.multiMaterials.indexOf(g.material)&&this.eg.addMultiMaterial(g.material):-1===this.eg.materials.indexOf(g.material)&&this.eg.addMaterial(g.material)}null===f.parent&&K.rootNodes.push(f)};for(const f of M)if("InstancedMesh"===f.getClassName()){const A=f,X=A.sourceMesh,s=N[X.uniqueId];d(A,("number"===typeof s?E[s]:X).createInstance(A.name))}else{let A=!0;"bj"===f.getClassName()||"Node"===f.getClassName()||f.skeleton||!f.getTotalVertices||0===f.getTotalVertices()?A=!1:Y.doNotInstantiate&&(A="function"===typeof Y.doNotInstantiate?!Y.doNotInstantiate(f):!Y.doNotInstantiate);const X=A?f.createInstance(`instance of ${f.name}`):f.clone(`Clone of ${f.name}`,null,!0);if(!X)throw new Error(`Could not clone or instantiate node on Asset Container ${f.name}`);d(f,X)}for(const f of this.skeletons){if(Y.predicate&&!Y.predicate(f))continue;const X=f.clone(A?A(f.name):"Clone of "+f.name);for(const A of this.meshes)if(A.skeleton===f&&!A.isAnInstance){const s=E[N[A.uniqueId]];if(!s||s.isAnInstance)continue;if(s.skeleton=X,-1!==r.indexOf(X))continue;r.push(X);for(const A of X.bones)A._linkedTransformNode&&(A._linkedTransformNode=E[N[A._linkedTransformNode.uniqueId]])}K.skeletons.push(X)}for(const f of this.animationGroups){if(Y.predicate&&!Y.predicate(f))continue;const X=f.clone(A?A(f.name):"Clone of "+f.name,(A=>E[N[A.uniqueId]]||A));K.animationGroups.push(X)}return K}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||f.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.eg.environmentTexture=this.environmentTexture);for(const A of this.eg._serializableComponents)A.addFromContainer(this);this.eg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=[];for(const s of this.cameras)A&&!A(s)||(this.eg.addCamera(s),X.push(s));for(const s of this.lights)A&&!A(s)||(this.eg.addLight(s),X.push(s));for(const s of this.meshes)A&&!A(s)||(this.eg.Xi(s),X.push(s));for(const s of this.skeletons)A&&!A(s)||this.eg.addSkeleton(s);for(const s of this.animations)A&&!A(s)||this.eg.addAnimation(s);for(const s of this.animationGroups)A&&!A(s)||this.eg.addAnimationGroup(s);for(const s of this.multiMaterials)A&&!A(s)||this.eg.addMultiMaterial(s);for(const s of this.materials)A&&!A(s)||this.eg.addMaterial(s);for(const s of this.morphTargetManagers)A&&!A(s)||this.eg.addMorphTargetManager(s);for(const s of this.geometries)A&&!A(s)||this.eg.addGeometry(s);for(const s of this.transformNodes)A&&!A(s)||(this.eg.addTransformNode(s),X.push(s));for(const s of this.actionManagers)A&&!A(s)||this.eg.addActionManager(s);for(const s of this.textures)A&&!A(s)||this.eg.addTexture(s);for(const s of this.reflectionProbes)A&&!A(s)||this.eg.addReflectionProbe(s);for(const s of X)s.parent&&-1===this.eg.getNodes().indexOf(s.parent)&&(s.setParent?s.setParent(null):s.parent=null)}removeAllFromScene(){this._isValidHierarchy()||f.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.eg.environmentTexture&&(this.eg.environmentTexture=null);for(const A of this.eg._serializableComponents)A.removeFromContainer(this)}removeFromScene(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const X of this.cameras)A&&!A(X)||this.eg.removeCamera(X);for(const X of this.lights)A&&!A(X)||this.eg.removeLight(X);for(const X of this.meshes)A&&!A(X)||this.eg.Zi(X,!0);for(const X of this.skeletons)A&&!A(X)||this.eg.removeSkeleton(X);for(const X of this.animations)A&&!A(X)||this.eg.removeAnimation(X);for(const X of this.animationGroups)A&&!A(X)||this.eg.removeAnimationGroup(X);for(const X of this.multiMaterials)A&&!A(X)||this.eg.removeMultiMaterial(X);for(const X of this.materials)A&&!A(X)||this.eg.removeMaterial(X);for(const X of this.morphTargetManagers)A&&!A(X)||this.eg.removeMorphTargetManager(X);for(const X of this.geometries)A&&!A(X)||this.eg.removeGeometry(X);for(const X of this.transformNodes)A&&!A(X)||this.eg.removeTransformNode(X);for(const X of this.actionManagers)A&&!A(X)||this.eg.removeActionManager(X);for(const X of this.textures)A&&!A(X)||this.eg.removeTexture(X);for(const X of this.reflectionProbes)A&&!A(X)||this.eg.removeReflectionProbe(X)}dispose(){const A=this.cameras.slice(0);for(const M of A)M.dispose();this.cameras.length=0;const X=this.lights.slice(0);for(const M of X)M.dispose();this.lights.length=0;const s=this.meshes.slice(0);for(const M of s)M.dispose();this.meshes.length=0;const N=this.skeletons.slice(0);for(const M of N)M.dispose();this.skeletons.length=0;const f=this.animationGroups.slice(0);for(const M of f)M.dispose();this.animationGroups.length=0;const E=this.multiMaterials.slice(0);for(const M of E)M.dispose();this.multiMaterials.length=0;const g=this.materials.slice(0);for(const M of g)M.dispose();this.materials.length=0;const K=this.geometries.slice(0);for(const M of K)M.dispose();this.geometries.length=0;const r=this.transformNodes.slice(0);for(const M of r)M.dispose();this.transformNodes.length=0;const i=this.actionManagers.slice(0);for(const M of i)M.dispose();this.actionManagers.length=0;const Y=this.textures.slice(0);for(const M of Y)M.dispose();this.textures.length=0;const v=this.reflectionProbes.slice(0);for(const M of v)M.dispose();this.reflectionProbes.length=0;const c=this.morphTargetManagers.slice(0);for(const M of c)M.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const M of this.eg._serializableComponents)M.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.eg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(A,X,s){if(A&&X)for(const N of A){let A=!0;if(s)for(const X of s)if(N===X){A=!1;break}A&&(X.push(N),N._parentContainer=this)}}moveAllFromScene(A){this._wasAddedToScene=!1,void 0===A&&(A=new w);for(const X in this)Object.prototype.hasOwnProperty.call(this,X)&&(this[X]=this[X]||("_environmentTexture"===X?null:[]),this._moveAssets(this.eg[X],this[X],A[X]));this.environmentTexture=this.eg.environmentTexture,this.removeAllFromScene()}createRootMesh(){const A=new g.d("assetContainerRootMesh",this.eg);for(const X of this.meshes)X.parent||A.addChild(X);return this.meshes.unshift(A),A}mergeAnimationsTo(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.b.LastCreatedScene,X=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!A)return i.b.Error("No scene available to merge animations to"),[];const N=s||(X=>{let s=null;const N=X.animations.length?X.animations[0].targetProperty:"",f=X.name.split(".").join("").split("_primitive")[0];switch(N){case"position":case"rotationQuaternion":s=A.getTransformNodeByName(X.name)||A.getTransformNodeByName(f);break;case"influence":s=A.getMorphTargetByName(X.name)||A.getMorphTargetByName(f);break;default:s=A.getNodeByName(X.name)||A.getNodeByName(f)}return s}),f=this.getNodes();for(const K of f){const A=N(K);if(null!==A){for(const X of K.animations){const s=A.animations.filter((A=>A.targetProperty===X.targetProperty));for(const X of s){const s=A.animations.indexOf(X,0);s>-1&&A.animations.splice(s,1)}}A.animations=A.animations.concat(K.animations)}}const E=[],g=this.animationGroups.slice();for(const K of g){E.push(K.clone(K.name,N));for(const A of K.animatables)A.stop()}for(const K of X){const X=N(K.target);X&&(A.beginAnimation(X,K.fromFrame,K.toFrame,K.loopAnimation,K.speedRatio,K.onAnimationEnd?K.onAnimationEnd:void 0,void 0,!0,void 0,K.onAnimationLoop?K.onAnimationLoop:void 0),A.stopAnimation(K.target))}return E}populateRootNodes(){this.rootNodes.length=0;for(const A of this.meshes)A.parent||-1!==this.rootNodes.indexOf(A)||this.rootNodes.push(A);for(const A of this.transformNodes)A.parent||-1!==this.rootNodes.indexOf(A)||this.rootNodes.push(A);for(const A of this.lights)A.parent||-1!==this.rootNodes.indexOf(A)||this.rootNodes.push(A);for(const A of this.cameras)A.parent||-1!==this.rootNodes.indexOf(A)||this.rootNodes.push(A)}addAllAssetsToContainer(A){if(!A)return;const X=[],s=new Set;for(X.push(A);X.length>0;){const A=X.pop();if(A instanceof g.d?(A.pi&&-1===this.geometries.indexOf(A.pi)&&this.geometries.push(A.pi),this.meshes.push(A)):A instanceof v.d?this.meshes.push(A):A instanceof K.c?this.transformNodes.push(A):A instanceof c.b?this.lights.push(A):A instanceof M.b&&this.cameras.push(A),A instanceof r.e){if(A.material&&-1===this.materials.indexOf(A.material)){this.materials.push(A.material);for(const X of A.material.getActiveTextures())-1===this.textures.indexOf(X)&&this.textures.push(X)}A.skeleton&&-1===this.skeletons.indexOf(A.skeleton)&&this.skeletons.push(A.skeleton),A.morphTargetManager&&-1===this.morphTargetManagers.indexOf(A.morphTargetManager)&&this.morphTargetManagers.push(A.morphTargetManager)}for(const N of A.getChildren())s.has(N)||X.push(N);s.add(A)}this.populateRootNodes()}_getByTags(A,X,s){if(void 0===X)return A;const N=[];for(const f in A){const E=A[f];d.e&&d.e.MatchesQuery(E,X)&&(!s||s(E))&&N.push(E)}return N}getMeshesByTags(A,X){return this._getByTags(this.meshes,A,X)}getCamerasByTags(A,X){return this._getByTags(this.cameras,A,X)}getLightsByTags(A,X){return this._getByTags(this.lights,A,X)}getMaterialsByTags(A,X){return this._getByTags(this.materials,A,X).concat(this._getByTags(this.multiMaterials,A,X))}getTransformNodesByTags(A,X){return this._getByTags(this.transformNodes,A,X)}}var J=s(519);class a{constructor(A){this.byteOffset=0,this.buffer=A}async loadAsync(A){const X=await this.buffer.readAsync(this.byteOffset,A);this._dataView=new DataView(X.buffer,X.byteOffset,X.byteLength),this._dataByteOffset=0}readUint32(){const A=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,A}readUint8Array(A){const X=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,A);return this._dataByteOffset+=A,this.byteOffset+=A,X}readString(A){return(0,J.f)(this.readUint8Array(A))}skipBytes(A){this._dataByteOffset+=A,this.byteOffset+=A}}var u=s(12606);const z="Z2xURg",m={name:"Gi",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:A=>-1!==A.indexOf("asset")&&-1!==A.indexOf("version")||A.startsWith("data:base64,"+z)||A.startsWith("data:;base64,"+z)||A.startsWith("data:application/octet-stream;base64,"+z)||A.startsWith("data:model/gltf-binary;base64,"+z)};var b,y,j,G=s(508),V=s(517);function D(A,X,s){try{return Promise.resolve(new Uint8Array(A,X,s))}catch(N){return Promise.reject(N)}}!function(A){A[A.AUTO=0]="AUTO",A[A.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(b||(b={})),function(A){A[A.NONE=0]="NONE",A[A.FIRST=1]="FIRST",A[A.ALL=2]="ALL"}(y||(y={})),function(A){A[A.LOADING=0]="LOADING",A[A.READY=1]="READY",A[A.COMPLETE=2]="COMPLETE"}(j||(j={}));class O{constructor(){this.coordinateSystemMode=b.AUTO,this.animationStartMode=y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=A=>Promise.resolve(A),this.extensionOptions={}}p(A){A&&(this.onParsed=A.onParsed,this.coordinateSystemMode=A.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=A.animationStartMode??this.animationStartMode,this.loadNodeAnimations=A.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=A.loadSkins??this.loadSkins,this.loadMorphTargets=A.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=A.compileMaterials??this.compileMaterials,this.useClipPlane=A.useClipPlane??this.useClipPlane,this.compileShadowGenerators=A.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=A.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=A.useRangeRequests??this.useRangeRequests,this.createInstances=A.createInstances??this.createInstances,this.alwaysComputeBoundingBox=A.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=A.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=A.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=A.skipMaterials??this.skipMaterials,this.useSRGBBuffers=A.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=A.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=A.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=A.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=A.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=A.customRootNode,this.onMeshLoaded=A.onMeshLoaded,this.onSkinLoaded=A.onSkinLoaded,this.onTextureLoaded=A.onTextureLoaded,this.onMaterialLoaded=A.onMaterialLoaded,this.onCameraLoaded=A.onCameraLoaded,this.extensionOptions=A.extensionOptions??this.extensionOptions)}}class P extends O{constructor(A){super(),this.onParsedObservable=new N.b,this.onMeshLoadedObservable=new N.b,this.onSkinLoadedObservable=new N.b,this.onTextureLoadedObservable=new N.b,this.onMaterialLoadedObservable=new N.b,this.onCameraLoadedObservable=new N.b,this.onCompleteObservable=new N.b,this.onErrorObservable=new N.b,this.Ji=new N.b,this.onExtensionLoadedObservable=new N.b,this.validate=!1,this.onValidatedObservable=new N.b,this._loader=null,this._state=null,this._requests=new Array,this.name=m.name,this.extensions=m.extensions,this.onLoaderStateChangedObservable=new N.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(A)}set onParsed(A){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),A&&(this._onParsedObserver=this.onParsedObservable.add(A))}set onMeshLoaded(A){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),A&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(A))}set onSkinLoaded(A){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),A&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((X=>A(X.node,X.skinnedNode))))}set onTextureLoaded(A){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),A&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(A))}set onMaterialLoaded(A){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),A&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(A))}set onCameraLoaded(A){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),A&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(A))}set onComplete(A){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(A)}set onError(A){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(A)}set onDispose(A){this._onDisposeObserver&&this.Ji.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ji.add(A)}set onExtensionLoaded(A){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(A)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(A){this._loggingEnabled!==A&&(this._loggingEnabled=A,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(A){this._capturePerformanceCounters!==A&&(this._capturePerformanceCounters=A,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(A){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(A)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const A of this._requests)A.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=A=>Promise.resolve(A),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ji.notifyObservers(void 0),this.Ji.clear()}loadFile(A,X,s,E,g,K,r,Y){if(ArrayBuffer.isView(X))return this._loadBinary(A,X,s,E,r,Y),null;this._progressCallback=g;const v=X.name||f.d.GetFilename(X);if(K){if(this.useRangeRequests){this.validate&&i.b.Warn("glTF validation is not supported when range requests are enabled");const s={abort:()=>{},onCompleteObservable:new N.b},f={readAsync:(s,N)=>new Promise(((f,E)=>{this._loadFile(A,X,(A=>{f(new Uint8Array(A))}),!0,(A=>{E(A)}),(A=>{A.setRequestHeader("Range",`bytes=${s}-${s+N-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new a(f)).then((A=>{s.onCompleteObservable.notifyObservers(s),E(A)}),r?A=>r(void 0,A):void 0),s}return this._loadFile(A,X,(X=>{this._validate(A,new Uint8Array(X,0,X.byteLength),s,v),this._unpackBinaryAsync(new a({readAsync:(A,s)=>D(X,A,s),byteLength:X.byteLength})).then((A=>{E(A)}),r?A=>r(void 0,A):void 0)}),!0,r)}return this._loadFile(A,X,(X=>{try{this._validate(A,X,s,v),E({json:this._parseJson(X)})}catch{r&&r()}}),!1,r)}_loadBinary(A,X,s,N,f,E){this._validate(A,new Uint8Array(X.buffer,X.byteOffset,X.byteLength),s,E),this._unpackBinaryAsync(new a({readAsync:(A,s)=>function(A,X,s){try{if(X<0||X>=A.byteLength)throw new RangeError("Offset is out of range.");if(X+s>A.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(A.buffer,A.byteOffset+X,s))}catch(N){return Promise.reject(N)}}(X,A,s),byteLength:X.byteLength})).then((A=>{N(A)}),f?A=>f(void 0,A):void 0)}importMeshAsync(A,X,s,N,f,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(s),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(s),this._loader.importMeshAsync(A,X,null,s,N,f,E))))}loadAsync(A,X,s,N,f){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${f||""}`),this._loader=this._getLoader(X),this._loader.loadAsync(A,X,s,N,f))))}loadAssetContainerAsync(A,X,s,N,f){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${f||""}`),this._loader=this._getLoader(X);const E=new C(A),g=[];this.onMaterialLoadedObservable.add((A=>{g.push(A)}));const K=[];this.onTextureLoadedObservable.add((A=>{K.push(A)}));const r=[];this.onCameraLoadedObservable.add((A=>{r.push(A)}));const i=[];return this.onMeshLoadedObservable.add((A=>{A.morphTargetManager&&i.push(A.morphTargetManager)})),this._loader.importMeshAsync(null,A,E,X,s,N,f).then((A=>(Array.prototype.push.apply(E.geometries,A.geometries),Array.prototype.push.apply(E.meshes,A.meshes),Array.prototype.push.apply(E.ri,A.ri),Array.prototype.push.apply(E.skeletons,A.skeletons),Array.prototype.push.apply(E.animationGroups,A.animationGroups),Array.prototype.push.apply(E.materials,g),Array.prototype.push.apply(E.textures,K),Array.prototype.push.apply(E.lights,A.lights),Array.prototype.push.apply(E.transformNodes,A.transformNodes),Array.prototype.push.apply(E.cameras,r),Array.prototype.push.apply(E.morphTargetManagers,i),E)))}))}canDirectLoad(A){return m.canDirectLoad(A)}directLoad(A,X){if(X.startsWith("base64,"+z)||X.startsWith(";base64,"+z)||X.startsWith("application/octet-stream;base64,"+z)||X.startsWith("model/gltf-binary;base64,"+z)){const s=(0,G.d)(X);return this._validate(A,new Uint8Array(s,0,s.byteLength)),this._unpackBinaryAsync(new a({readAsync:(A,X)=>D(s,A,X),byteLength:s.byteLength}))}return this._validate(A,X),Promise.resolve({json:this._parseJson(X)})}createPlugin(A){return new P(A[m.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((A,X)=>{this.onCompleteObservable.addOnce((()=>{A()})),this.onErrorObservable.addOnce((A=>{X(A)}))}))}_setState(A){this._state!==A&&(this._state=A,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(j[this._state]))}_loadFile(A,X,s,N,f,E){const g=A._loadFile(X,s,(A=>{this._onProgress(A,g)}),!0,N,f,E);return g.onCompleteObservable.add((()=>{g._lengthComputable=!0,g._total=g._loaded})),this._requests.push(g),g}_onProgress(A,X){if(!this._progressCallback)return;X._lengthComputable=A.lengthComputable,X._loaded=A.loaded,X._total=A.total;let s=!0,N=0,f=0;for(const E of this._requests){if(void 0===E._lengthComputable||void 0===E._loaded||void 0===E._total)return;s=s&&E._lengthComputable,N+=E._loaded,f+=E._total}this._progressCallback({lengthComputable:s,loaded:N,total:s?f:0})}_validate(A,X){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),u.d.ValidateAsync(X,s,N,(X=>this.preprocessUrlAsync(s+X).then((X=>A._loadFileAsync(X,void 0,!0,!0).then((A=>new Uint8Array(A,0,A.byteLength))))))).then((A=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(A),this.onValidatedObservable.clear()}),(A=>{this._endPerformanceCounter("Validate JSON"),f.d.Warn(`Failed to validate: ${A.message}`),this.onValidatedObservable.clear()})))}_getLoader(A){const X=A.json.asset||{};this._log(`Asset version: ${X.version}`),X.minVersion&&this._log(`Asset minimum version: ${X.minVersion}`),X.generator&&this._log(`Asset generator: ${X.generator}`);const s=P._parseVersion(X.version);if(!s)throw new Error("Invalid version: "+X.version);if(void 0!==X.minVersion){const A=P._parseVersion(X.minVersion);if(!A)throw new Error("Invalid minimum version: "+X.minVersion);if(P._compareVersion(A,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+X.minVersion)}const N={1:P._CreateGLTF1Loader,2:P._CreateGLTF2Loader}[s.major];if(!N)throw new Error("Unsupported version: "+X.version);return N(this)}_parseJson(A){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${A.length}`);const X=JSON.parse(A);return this._endPerformanceCounter("Parse JSON"),X}_unpackBinaryAsync(A){return this._startPerformanceCounter("Unpack Binary"),A.loadAsync(20).then((()=>{const X=A.readUint32();if(1179937895!==X)throw new V.h("Unexpected magic: "+X,V.e.GLTFLoaderUnexpectedMagicError);const s=A.readUint32();this.loggingEnabled&&this._log(`Binary version: ${s}`);const N=A.readUint32();let f;switch(this.useRangeRequests||N===A.buffer.byteLength||i.b.Warn(`Length in header does not match actual data length: ${N} != ${A.buffer.byteLength}`),s){case 1:f=this._unpackBinaryV1Async(A,N);break;case 2:f=this._unpackBinaryV2Async(A,N);break;default:throw new Error("Unsupported version: "+s)}return this._endPerformanceCounter("Unpack Binary"),f}))}_unpackBinaryV1Async(A,X){const s=A.readUint32(),N=A.readUint32();if(0!==N)throw new Error(`Unexpected content format: ${N}`);const f=X-A.byteOffset,E={json:this._parseJson(A.readString(s)),bin:null};if(0!==f){const X=A.byteOffset;E.bin={readAsync:(s,N)=>A.buffer.readAsync(X+s,N),byteLength:f}}return Promise.resolve(E)}_unpackBinaryV2Async(A,X){const s=1313821514,N=5130562,f=A.readUint32();if(A.readUint32()!==s)throw new Error("First chunk format is not JSON");return A.byteOffset+f===X?A.loadAsync(f).then((()=>({json:this._parseJson(A.readString(f)),bin:null}))):A.loadAsync(f+8).then((()=>{const E={json:this._parseJson(A.readString(f)),bin:null},g=()=>{const f=A.readUint32();switch(A.readUint32()){case s:throw new Error("Unexpected JSON chunk");case N:{const X=A.byteOffset;E.bin={readAsync:(s,N)=>A.buffer.readAsync(X+s,N),byteLength:f},A.skipBytes(f);break}default:A.skipBytes(f)}return A.byteOffset!==X?A.loadAsync(8).then(g):Promise.resolve(E)};return g()}))}static _parseVersion(A){if("1.0"===A||"1.0.1"===A)return{major:1,minor:0};const X=(A+"").match(/^(\d+)\.(\d+)/);return X?{major:parseInt(X[1]),minor:parseInt(X[2])}:null}static _compareVersion(A,X){return A.major>X.major?1:A.major<X.major?-1:A.minor>X.minor?1:A.minor<X.minor?-1:0}_logOpen(A){this._log(A),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(A){const X=P._logSpaces.substring(0,2*this._logIndentLevel);i.b.Log(`${X}${A}`)}_logDisabled(A){}_startPerformanceCounterEnabled(A){f.d.StartPerformanceCounter(A)}_startPerformanceCounterDisabled(A){}_endPerformanceCounterEnabled(A){f.d.EndPerformanceCounter(A)}_endPerformanceCounterDisabled(A){}}P.IncrementalLoading=!0,P.HomogeneousCoordinates=!1,P._logSpaces="                                ",(0,E.b)(new P)},12606:(A,X,s)=>{"use strict";s.d(X,{d:()=>g});var N=s(456);function f(A,X,s,N){const f={externalResourceFunction:N};return s&&(f.uri="file:"===X?s:X+s),ArrayBuffer.isView(A)?GLTFValidator.validateBytes(A,f):GLTFValidator.validateString(A,f)}function E(){const A=[];onmessage=X=>{const s=X.data;switch(s.id){case"init":importScripts(s.url);break;case"validate":f(s.data,s.rootUrl,s.fileName,(X=>new Promise(((s,N)=>{const f=A.length;A.push({resolve:s,reject:N}),postMessage({id:"getExternalResource",index:f,uri:X})})))).then((A=>{postMessage({id:"validate.resolve",value:A})}),(A=>{postMessage({id:"validate.reject",reason:A})}));break;case"getExternalResource.resolve":A[s.index].resolve(s.value);break;case"getExternalResource.reject":A[s.index].reject(s.reason)}}}class g{static ValidateAsync(A,X,s,g){return"function"===typeof Worker?new Promise(((K,r)=>{const i=`${f}(${E})()`,Y=URL.createObjectURL(new Blob([i],{type:"application/javascript"})),v=new Worker(Y),c=A=>{v.removeEventListener("error",c),v.removeEventListener("message",M),r(A)},M=A=>{const X=A.data;switch(X.id){case"getExternalResource":g(X.uri).then((A=>{v.postMessage({id:"getExternalResource.resolve",index:X.index,value:A},[A.buffer])}),(A=>{v.postMessage({id:"getExternalResource.reject",index:X.index,reason:A})}));break;case"validate.resolve":v.removeEventListener("error",c),v.removeEventListener("message",M),K(X.value),v.terminate();break;case"validate.reject":v.removeEventListener("error",c),v.removeEventListener("message",M),r(X.reason),v.terminate()}};if(v.addEventListener("error",c),v.addEventListener("message",M),v.postMessage({id:"init",url:N.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(A)){const N=A.slice();v.postMessage({id:"validate",data:N,rootUrl:X,fileName:s},[N.buffer])}else v.postMessage({id:"validate",data:A,rootUrl:X,fileName:s})})):(this._LoadScriptPromise||(this._LoadScriptPromise=N.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>f(A,X,s,g))))}}g.Configuration={url:`${N.d._DefaultCdnUrl}/gltf_validator.js`}},12958:(A,X,s)=>{"use strict";s.d(X,{b:()=>m});var N=s(657),f=s(666),E=s(707),g=s(678),K=s(12129),r=s(12135),i=s(728),Y=s(2418),v=s(616),c=s(559);s(12341),s(12255),s(12273),s(12262),s(12281),s(12286),s(12290);const M="imageProcessingCompatibility",d="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";c.b.IncludesShadersStore[M]||(c.b.IncludesShadersStore[M]=d);const Q="skyPixelShader",w="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";c.b.ShadersStore[Q]||(c.b.ShadersStore[Q]=w);s(12350),s(12292),s(12295),s(12307),s(12302);const R="skyVertexShader",C="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";c.b.ShadersStore[R]||(c.b.ShadersStore[R]=C);var J=s(12146),a=s(841),u=s(828);class z extends K.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class m extends r.b{constructor(A,X){super(A,X),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new g.k(0,100,0),this.useSunPosition=!1,this.cameraOffset=g.k.Zero(),this.up=g.k.Up(),this.dithering=!1,this._cameraPosition=g.k.Zero(),this._skyOrientation=new g.d}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(A,X){const s=X._drawWrapper;if(this.isFrozen&&s.effect&&s._wasPreviouslyReady)return!0;X.materialDefines||(X.materialDefines=new z);const N=X.materialDefines,f=this.va();if(this._isReadyForSubMesh(X))return!0;if((0,u.Y)(A,f,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,N),(0,u.M)(A,N,!0,!1),N.IMAGEPROCESSINGPOSTPROCESS!==f.imageProcessingConfiguration.applyByPostProcess&&N.markAsMiscDirty(),N.DITHER!==this.dithering&&N.markAsMiscDirty(),N.isDirty){N.markAsProcessed(),f.resetCachedMaterial();const A=new J.e;N.FOG&&A.addFallback(1,"FOG"),N.IMAGEPROCESSINGPOSTPROCESS=f.imageProcessingConfiguration.applyByPostProcess,N.DITHER=this.dithering;const s=[i.e.PositionKind];N.VERTEXCOLOR&&s.push(i.e.ColorKind);const E="sky",g=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,a.b)(g);const K=N.toString();X.setEffect(f.getEngine().createEffect(E,s,g,[],K,A,this.onCompiled,this.onError),N,this._materialContext)}return!(!X.effect||!X.effect.isReady())&&(N._renderId=f.getRenderId(),s._wasPreviouslyReady=!0,!0)}bindForSubMesh(A,X,s){const N=this.va(),f=s.materialDefines;if(!f)return;const E=s.effect;if(!E)return;this._activeEffect=E,this.bindOnlyWorldMatrix(A),this._activeEffect.setMatrix("viewProjection",N.getTransformMatrix()),this._mustRebind(N,E,s)&&((0,a.c)(E,this,N),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,u.p)(f,E,N)),N.fogEnabled&&X.applyFog&&N.fogMode!==Y.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",N.getViewMatrix()),(0,u.i)(N,X,this._activeEffect);const K=N.activeCamera;if(K){const A=K.getWorldMatrix();this._cameraPosition.x=A.m[12],this._cameraPosition.y=A.m[13],this._cameraPosition.z=A.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const A=Math.PI*(this.inclination-.5),X=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(X)*Math.cos(A),this.sunPosition.y=this.distance*Math.sin(-A),this.sunPosition.z=this.distance*Math.sin(X)*Math.cos(A),g.d.FromUnitVectorsToRef(g.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(X,this._activeEffect,s)}getAnimatables(){return[]}dispose(A){super.dispose(A)}clone(A){return E.c.Clone((()=>new m(A,this.va())),this)}serialize(){const A=super.serialize();return A.customType="BABYLON.SkyMaterial",A}getClassName(){return"SkyMaterial"}static Parse(A,X,s){return E.c.Parse((()=>new m(A.name,X)),A,X,s)}}(0,N.e)([(0,f.M)()],m.prototype,"luminance",void 0),(0,N.e)([(0,f.M)()],m.prototype,"turbidity",void 0),(0,N.e)([(0,f.M)()],m.prototype,"rayleigh",void 0),(0,N.e)([(0,f.M)()],m.prototype,"mieCoefficient",void 0),(0,N.e)([(0,f.M)()],m.prototype,"mieDirectionalG",void 0),(0,N.e)([(0,f.M)()],m.prototype,"distance",void 0),(0,N.e)([(0,f.M)()],m.prototype,"inclination",void 0),(0,N.e)([(0,f.M)()],m.prototype,"azimuth",void 0),(0,N.e)([(0,f.K)()],m.prototype,"sunPosition",void 0),(0,N.e)([(0,f.M)()],m.prototype,"useSunPosition",void 0),(0,N.e)([(0,f.K)()],m.prototype,"cameraOffset",void 0),(0,N.e)([(0,f.K)()],m.prototype,"up",void 0),(0,N.e)([(0,f.M)()],m.prototype,"dithering",void 0),(0,v.f)("BABYLON.SkyMaterial",m)},11784:(A,X,s)=>{"use strict";function N(A,X){X.headers=A.headers||{},X.statusMessage=A.statusText,X.statusCode=A.status,X.data=A.response}function f(A,X,s){return new Promise((function(f,E){s=s||{};var g,K,r,i=new XMLHttpRequest,Y=s.body,v=s.headers||{};for(g in s.timeout&&(i.timeout=s.timeout),i.ontimeout=i.onerror=function(A){A.timeout="timeout"==A.type,E(A)},i.open(A,X.href||X),i.onload=function(){for(r=i.getAllResponseHeaders().trim().split(/[\r\n]+/),N(i,i);K=r.shift();)K=K.split(": "),i.headers[K.shift().toLowerCase()]=K.join(": ");if((K=i.headers["content-type"])&&~K.indexOf("application/json"))try{i.data=JSON.parse(i.data,s.reviver)}catch(A){return N(i,A),E(A)}(i.status>=400?E:f)(i)},typeof FormData<"u"&&Y instanceof FormData||Y&&"object"==typeof Y&&(v["content-type"]="application/json",Y=JSON.stringify(Y)),i.withCredentials=!!s.withCredentials,v)i.setRequestHeader(g,v[g]);i.send(Y)}))}s.r(X),s.d(X,{del:()=>r,get:()=>E,patch:()=>K,post:()=>g,put:()=>i,send:()=>f});var E=f.bind(f,"GET"),g=f.bind(f,"POST"),K=f.bind(f,"PATCH"),r=f.bind(f,"DELETE"),i=f.bind(f,"PUT")},13057:(A,X,s)=>{"use strict";s.d(X,{c:()=>v});const N=.5*(Math.sqrt(3)-1),f=(3-Math.sqrt(3))/6,E=1/3,g=1/6,K=(Math.sqrt(5)-1)/4,r=(5-Math.sqrt(5))/20,i=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Y=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const v=class{constructor(){let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const X="function"==typeof A?A:function(A){let X=0,s=0,N=0,f=1;const E=function(){let A=4022871197;return function(X){X=X.toString();for(let s=0;s<X.length;s++){A+=X.charCodeAt(s);let N=.02519603282416938*A;A=N>>>0,N-=A,N*=A,A=N>>>0,N-=A,A+=4294967296*N}return 2.3283064365386963e-10*(A>>>0)}}();X=E(" "),s=E(" "),N=E(" "),X-=E(A),X<0&&(X+=1);s-=E(A),s<0&&(s+=1);N-=E(A),N<0&&(N+=1);return function(){const A=2091639*X+2.3283064365386963e-10*f;return X=s,s=N,N=A-(f=0|A)}}(A);this.p=function(A){const X=new Uint8Array(256);for(let s=0;s<256;s++)X[s]=s;for(let s=0;s<255;s++){const N=s+~~(A()*(256-s)),f=X[s];X[s]=X[N],X[N]=f}return X}(X),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let s=0;s<512;s++)this.perm[s]=this.p[255&s],this.permMod12[s]=this.perm[s]%12}noise2D(A,X){const s=this.permMod12,E=this.perm;let g=0,K=0,r=0;const Y=(A+X)*N,v=Math.floor(A+Y),c=Math.floor(X+Y),M=(v+c)*f,d=A-(v-M),Q=X-(c-M);let w,R;d>Q?(w=1,R=0):(w=0,R=1);const C=d-w+f,J=Q-R+f,a=d-1+2*f,u=Q-1+2*f,z=255&v,m=255&c;let b=.5-d*d-Q*Q;if(b>=0){const A=3*s[z+E[m]];b*=b,g=b*b*(i[A]*d+i[A+1]*Q)}let y=.5-C*C-J*J;if(y>=0){const A=3*s[z+w+E[m+R]];y*=y,K=y*y*(i[A]*C+i[A+1]*J)}let j=.5-a*a-u*u;if(j>=0){const A=3*s[z+1+E[m+1]];j*=j,r=j*j*(i[A]*a+i[A+1]*u)}return 70*(g+K+r)}noise3D(A,X,s){const N=this.permMod12,f=this.perm;let K,r,Y,v;const c=(A+X+s)*E,M=Math.floor(A+c),d=Math.floor(X+c),Q=Math.floor(s+c),w=(M+d+Q)*g,R=A-(M-w),C=X-(d-w),J=s-(Q-w);let a,u,z,m,b,y;R>=C?C>=J?(a=1,u=0,z=0,m=1,b=1,y=0):R>=J?(a=1,u=0,z=0,m=1,b=0,y=1):(a=0,u=0,z=1,m=1,b=0,y=1):C<J?(a=0,u=0,z=1,m=0,b=1,y=1):R<J?(a=0,u=1,z=0,m=0,b=1,y=1):(a=0,u=1,z=0,m=1,b=1,y=0);const j=R-a+g,G=C-u+g,V=J-z+g,D=R-m+2*g,O=C-b+2*g,P=J-y+2*g,l=R-1+.5,n=C-1+.5,U=J-1+.5,t=255&M,e=255&d,T=255&Q;let I=.6-R*R-C*C-J*J;if(I<0)K=0;else{const A=3*N[t+f[e+f[T]]];I*=I,K=I*I*(i[A]*R+i[A+1]*C+i[A+2]*J)}let L=.6-j*j-G*G-V*V;if(L<0)r=0;else{const A=3*N[t+a+f[e+u+f[T+z]]];L*=L,r=L*L*(i[A]*j+i[A+1]*G+i[A+2]*V)}let k=.6-D*D-O*O-P*P;if(k<0)Y=0;else{const A=3*N[t+m+f[e+b+f[T+y]]];k*=k,Y=k*k*(i[A]*D+i[A+1]*O+i[A+2]*P)}let x=.6-l*l-n*n-U*U;if(x<0)v=0;else{const A=3*N[t+1+f[e+1+f[T+1]]];x*=x,v=x*x*(i[A]*l+i[A+1]*n+i[A+2]*U)}return 32*(K+r+Y+v)}noise4D(A,X,s,N){const f=this.perm;let E,g,i,v,c;const M=(A+X+s+N)*K,d=Math.floor(A+M),Q=Math.floor(X+M),w=Math.floor(s+M),R=Math.floor(N+M),C=(d+Q+w+R)*r,J=A-(d-C),a=X-(Q-C),u=s-(w-C),z=N-(R-C);let m=0,b=0,y=0,j=0;J>a?m++:b++,J>u?m++:y++,J>z?m++:j++,a>u?b++:y++,a>z?b++:j++,u>z?y++:j++;const G=m>=3?1:0,V=b>=3?1:0,D=y>=3?1:0,O=j>=3?1:0,P=m>=2?1:0,l=b>=2?1:0,n=y>=2?1:0,U=j>=2?1:0,t=m>=1?1:0,e=b>=1?1:0,T=y>=1?1:0,I=j>=1?1:0,L=J-G+r,k=a-V+r,x=u-D+r,H=z-O+r,F=J-P+2*r,q=a-l+2*r,S=u-n+2*r,p=z-U+2*r,B=J-t+3*r,Z=a-e+3*r,o=u-T+3*r,W=z-I+3*r,h=J-1+4*r,AA=a-1+4*r,XA=u-1+4*r,sA=z-1+4*r,NA=255&d,fA=255&Q,EA=255&w,gA=255&R;let KA=.6-J*J-a*a-u*u-z*z;if(KA<0)E=0;else{const A=f[NA+f[fA+f[EA+f[gA]]]]%32*4;KA*=KA,E=KA*KA*(Y[A]*J+Y[A+1]*a+Y[A+2]*u+Y[A+3]*z)}let rA=.6-L*L-k*k-x*x-H*H;if(rA<0)g=0;else{const A=f[NA+G+f[fA+V+f[EA+D+f[gA+O]]]]%32*4;rA*=rA,g=rA*rA*(Y[A]*L+Y[A+1]*k+Y[A+2]*x+Y[A+3]*H)}let iA=.6-F*F-q*q-S*S-p*p;if(iA<0)i=0;else{const A=f[NA+P+f[fA+l+f[EA+n+f[gA+U]]]]%32*4;iA*=iA,i=iA*iA*(Y[A]*F+Y[A+1]*q+Y[A+2]*S+Y[A+3]*p)}let YA=.6-B*B-Z*Z-o*o-W*W;if(YA<0)v=0;else{const A=f[NA+t+f[fA+e+f[EA+T+f[gA+I]]]]%32*4;YA*=YA,v=YA*YA*(Y[A]*B+Y[A+1]*Z+Y[A+2]*o+Y[A+3]*W)}let vA=.6-h*h-AA*AA-XA*XA-sA*sA;if(vA<0)c=0;else{const A=f[NA+1+f[fA+1+f[EA+1+f[gA+1]]]]%32*4;vA*=vA,c=vA*vA*(Y[A]*h+Y[A+1]*AA+Y[A+2]*XA+Y[A+3]*sA)}return 27*(E+g+i+v+c)}}}}]);