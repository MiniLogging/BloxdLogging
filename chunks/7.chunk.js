(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{11988:function(U,W){!function(U){"use strict";var W=function(U,l){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,W){U.__proto__=W}||function(U,W){for(var l in W)Object.prototype.hasOwnProperty.call(W,l)&&(U[l]=W[l])},W(U,l)};function l(U,l){if("function"!==typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function M(){this.constructor=U}W(U,l),U.prototype=null===l?Object.create(l):(M.prototype=l.prototype,new M)}function M(U,W,l,M){var t,L=arguments.length,p=L<3?W:null===M?M=Object.getOwnPropertyDescriptor(W,l):M;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(U,W,l,M);else for(var B=U.length-1;B>=0;B--)(t=U[B])&&(p=(L<3?t(p):L>3?t(W,l,p):t(W,l))||p);return L>3&&p&&Object.defineProperty(W,l,p),p}function t(U,W,l){if(l||2===arguments.length)for(var M,t=0,L=W.length;t<L;t++)!M&&t in W||(M||(M=Array.prototype.slice.call(W,0,t)),M[t]=W[t]);return U.concat(M||Array.prototype.slice.call(W))}var L,p=255,B=213;U.OPERATION=void 0,(L=U.OPERATION||(U.OPERATION={}))[L.ADD=128]="ADD",L[L.REPLACE=0]="REPLACE",L[L.DELETE=64]="DELETE",L[L.DELETE_AND_ADD=192]="DELETE_AND_ADD",L[L.TOUCH=1]="TOUCH",L[L.CLEAR=10]="CLEAR";var k=function(){function W(U,W,l){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=U,this.setParent(W,l)}return W.prototype.setParent=function(U,W,l){var M=this;if(this.indexes||(this.indexes=this.ref instanceof nU?this.ref._definition.indexes:{}),this.parent=U,this.parentIndex=l,W)if(this.root=W,this.ref instanceof nU){var t=this.ref._definition;for(var L in t.schema){var p=this.ref[L];if(p&&p.$changes){var B=t.indexes[L];p.$changes.setParent(this.ref,W,B)}}}else"object"===typeof this.ref&&this.ref.forEach((function(U,W){if(U instanceof nU){var l=U.$changes,t=M.ref.$changes.indexes[W];l.setParent(M.ref,M.root,t)}}))},W.prototype.operation=function(U){this.changes.set(--this.currentCustomOperation,U)},W.prototype.change=function(W,l){void 0===l&&(l=U.OPERATION.ADD);var M="number"===typeof W?W:this.indexes[W];this.assertValidIndex(M,W);var t=this.changes.get(M);t&&t.op!==U.OPERATION.DELETE&&t.op!==U.OPERATION.TOUCH||this.changes.set(M,{op:t&&t.op===U.OPERATION.DELETE?U.OPERATION.DELETE_AND_ADD:l,index:M}),this.allChanges.add(M),this.changed=!0,this.touchParents()},W.prototype.touch=function(W){var l="number"===typeof W?W:this.indexes[W];this.assertValidIndex(l,W),this.changes.has(l)||this.changes.set(l,{op:U.OPERATION.TOUCH,index:l}),this.allChanges.add(l),this.touchParents()},W.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},W.prototype.getType=function(U){if(this.ref._definition)return(W=this.ref._definition).schema[W.fieldsByIndex[U]];var W,l=(W=this.parent._definition).schema[W.fieldsByIndex[this.parentIndex]];return Object.values(l)[0]},W.prototype.getChildrenFilter=function(){var U=this.parent._definition.childFilters;return U&&U[this.parentIndex]},W.prototype.getValue=function(U){return this.ref.getByIndex(U)},W.prototype.delete=function(W){var l="number"===typeof W?W:this.indexes[W];if(void 0!==l){var M=this.getValue(l);this.changes.set(l,{op:U.OPERATION.DELETE,index:l}),this.allChanges.delete(l),delete this.caches[l],M&&M.$changes&&(M.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(W," (").concat(l,")"))},W.prototype.discard=function(W,l){var M=this;void 0===W&&(W=!1),void 0===l&&(l=!1),this.ref instanceof nU||this.changes.forEach((function(W){if(W.op===U.OPERATION.DELETE){var l=M.ref.getIndex(W.index);delete M.indexes[l]}})),this.changes.clear(),this.changed=W,l&&this.allChanges.clear(),this.currentCustomOperation=0},W.prototype.discardAll=function(){var U=this;this.changes.forEach((function(W){var l=U.getValue(W.index);l&&l.$changes&&l.$changes.discardAll()})),this.discard()},W.prototype.cache=function(U,W){this.caches[U]=W},W.prototype.clone=function(){return new W(this.ref,this.parent,this.root)},W.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},W.prototype.assertValidIndex=function(U,W){if(void 0===U)throw new Error('ChangeTree: missing index for field "'.concat(W,'"'))},W}();function A(U,W,l,M){return U[W]||(U[W]=[]),U[W].push(l),null===M||void 0===M||M.forEach((function(U,W){return l(U,W)})),function(){return y(U[W],U[W].indexOf(l))}}function q(W){var l=this,M="string"!==typeof this.$changes.getType();this.$items.forEach((function(t,L){W.push({refId:l.$changes.refId,op:U.OPERATION.DELETE,field:L,value:void 0,previousValue:t}),M&&l.$changes.root.removeRef(t.$changes.refId)}))}function y(U,W){if(-1===W||W>=U.length)return!1;for(var l=U.length-1,M=W;M<l;M++)U[M]=U[M+1];return U.length=l,!0}var j=function(U,W){var l=U.toString(),M=W.toString();return l<M?-1:l>M?1:0};function s(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,W){return"symbol"===typeof W||isNaN(W)?U[W]:U.at(W)},set:function(U,W,l){if("symbol"===typeof W||isNaN(W))U[W]=l;else{var M=Array.from(U.$items.keys()),t=parseInt(M[W]||W);void 0===l||null===l?U.deleteAt(t):U.setAt(t,l)}return!0},deleteProperty:function(U,W){return"number"===typeof W?U.deleteAt(W):delete U[W],!0}})}var w=function(){function W(){for(var U=[],W=0;W<arguments.length;W++)U[W]=arguments[W];this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,U)}return W.prototype.cc=function(W,l){return void 0===l&&(l=!0),A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,W,l?this.$items:void 0)},W.prototype.qc=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,W)},W.prototype.onChange=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,W)},W.is=function(U){return Array.isArray(U)||void 0!==U.array},Object.defineProperty(W.prototype,"length",{get:function(){return this.$items.size},set:function(U){0===U?this.clear():this.splice(U,this.length-U)},enumerable:!1,configurable:!0}),W.prototype.push=function(){for(var U,W=this,l=[],M=0;M<arguments.length;M++)l[M]=arguments[M];return l.forEach((function(l){U=W.$refId++,W.setAt(U,l)})),U},W.prototype.pop=function(){var U=Array.from(this.$indexes.values()).pop();if(void 0!==U){this.$changes.delete(U),this.$indexes.delete(U);var W=this.$items.get(U);return this.$items.delete(U),W}},W.prototype.at=function(U){var W=Array.from(this.$items.keys())[U];return this.$items.get(W)},W.prototype.setAt=function(W,l){var M,t;if(void 0!==l&&null!==l){if(this.$items.get(W)!==l){void 0!==l.$changes&&l.$changes.setParent(this,this.$changes.root,W);var L=null!==(t=null===(M=this.$changes.indexes[W])||void 0===M?void 0:M.op)&&void 0!==t?t:U.OPERATION.ADD;this.$changes.indexes[W]=W,this.$indexes.set(W,W),this.$items.set(W,l),this.$changes.change(W,L)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},W.prototype.deleteAt=function(U){var W=Array.from(this.$items.keys())[U];return void 0!==W&&this.$deleteAt(W)},W.prototype.$deleteAt=function(U){return this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U)},W.prototype.clear=function(W){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),W&&q.call(this,W),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},W.prototype.concat=function(){for(var U,l=[],M=0;M<arguments.length;M++)l[M]=arguments[M];return new(W.bind.apply(W,t([void 0],(U=Array.from(this.$items.values())).concat.apply(U,l),!1)))},W.prototype.join=function(U){return Array.from(this.$items.values()).join(U)},W.prototype.reverse=function(){var U=this,W=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(l,M){U.setAt(W[M],l)})),this},W.prototype.shift=function(){var U=Array.from(this.$items.keys()).shift();if(void 0!==U){var W=this.$items.get(U);return this.$deleteAt(U),W}},W.prototype.slice=function(U,l){var M=new W;return M.push.apply(M,Array.from(this.$items.values()).slice(U,l)),M},W.prototype.sort=function(U){var W=this;void 0===U&&(U=j);var l=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(U).forEach((function(U,M){W.setAt(l[M],U)})),this},W.prototype.splice=function(U,W){void 0===W&&(W=this.length-U);for(var l=Array.from(this.$items.keys()),M=[],t=U;t<U+W;t++)M.push(this.$items.get(l[t])),this.$deleteAt(l[t]);return M},W.prototype.unshift=function(){for(var U=this,W=[],l=0;l<arguments.length;l++)W[l]=arguments[l];var M=this.length,t=W.length,L=Array.from(this.$items.values());return W.forEach((function(W,l){U.setAt(l,W)})),L.forEach((function(W,l){U.setAt(t+l,W)})),M+t},W.prototype.indexOf=function(U,W){return Array.from(this.$items.values()).indexOf(U,W)},W.prototype.lastIndexOf=function(U,W){return void 0===W&&(W=this.length-1),Array.from(this.$items.values()).lastIndexOf(U,W)},W.prototype.every=function(U,W){return Array.from(this.$items.values()).every(U,W)},W.prototype.some=function(U,W){return Array.from(this.$items.values()).some(U,W)},W.prototype.forEach=function(U,W){Array.from(this.$items.values()).forEach(U,W)},W.prototype.map=function(U,W){return Array.from(this.$items.values()).map(U,W)},W.prototype.filter=function(U,W){return Array.from(this.$items.values()).filter(U,W)},W.prototype.reduce=function(U,W){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},W.prototype.reduceRight=function(U,W){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},W.prototype.find=function(U,W){return Array.from(this.$items.values()).find(U,W)},W.prototype.findIndex=function(U,W){return Array.from(this.$items.values()).findIndex(U,W)},W.prototype.fill=function(U,W,l){throw new Error("ArraySchema#fill() not implemented")},W.prototype.copyWithin=function(U,W,l){throw new Error("ArraySchema#copyWithin() not implemented")},W.prototype.toString=function(){return this.$items.toString()},W.prototype.toLocaleString=function(){return this.$items.toLocaleString()},W.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(W,Symbol.species,{get:function(){return W},enumerable:!1,configurable:!0}),W.prototype.entries=function(){return this.$items.entries()},W.prototype.keys=function(){return this.$items.keys()},W.prototype.values=function(){return this.$items.values()},W.prototype.includes=function(U,W){return Array.from(this.$items.values()).includes(U,W)},W.prototype.flatMap=function(U,W){throw new Error("ArraySchema#flatMap() is not supported.")},W.prototype.flat=function(U){throw new Error("ArraySchema#flat() is not supported.")},W.prototype.findLast=function(){var U=Array.from(this.$items.values());return U.findLast.apply(U,arguments)},W.prototype.findLastIndex=function(){var U=Array.from(this.$items.values());return U.findLastIndex.apply(U,arguments)},W.prototype.setIndex=function(U,W){this.$indexes.set(U,W)},W.prototype.getIndex=function(U){return this.$indexes.get(U)},W.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},W.prototype.deleteByIndex=function(U){var W=this.$indexes.get(U);this.$items.delete(W),this.$indexes.delete(U)},W.prototype.toArray=function(){return Array.from(this.$items.values())},W.prototype.toJSON=function(){return this.toArray().map((function(U){return"function"===typeof U.toJSON?U.toJSON():U}))},W.prototype.clone=function(U){return U?new(W.bind.apply(W,t([void 0],Array.from(this.$items.values()),!1))):new(W.bind.apply(W,t([void 0],this.map((function(U){return U.$changes?U.clone():U})),!1)))},W}();function K(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,W){return"symbol"!==typeof W&&"undefined"===typeof U[W]?U.get(W):U[W]},set:function(U,W,l){return"symbol"!==typeof W&&-1===W.indexOf("$")&&"cc"!==W&&"qc"!==W&&"onChange"!==W?U.set(W,l):U[W]=l,!0},deleteProperty:function(U,W){return U.delete(W),!0}})}var r=function(){function W(U){var l=this;if(this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U)if(U instanceof Map||U instanceof W)U.forEach((function(U,W){return l.set(W,U)}));else for(var M in U)this.set(M,U[M])}return W.prototype.cc=function(W,l){return void 0===l&&(l=!0),A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,W,l?this.$items:void 0)},W.prototype.qc=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,W)},W.prototype.onChange=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,W)},W.is=function(U){return void 0!==U.map},W.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(W.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(W,Symbol.species,{get:function(){return W},enumerable:!1,configurable:!0}),W.prototype.set=function(W,l){if(void 0===l||null===l)throw new Error("MapSchema#set('".concat(W,"', ").concat(l,"): trying to set ").concat(l," value on '").concat(W,"'."));W=W.toString();var M="undefined"!==typeof this.$changes.indexes[W],t=M?this.$changes.indexes[W]:this.$refId++,L=M?U.OPERATION.REPLACE:U.OPERATION.ADD,p=void 0!==l.$changes;if(p&&l.$changes.setParent(this,this.$changes.root,t),M){if(!p&&this.$items.get(W)===l)return;p&&this.$items.get(W)!==l&&(L=U.OPERATION.ADD)}else this.$changes.indexes[W]=t,this.$indexes.set(t,W);return this.$items.set(W,l),this.$changes.change(W,L),this},W.prototype.get=function(U){return this.$items.get(U)},W.prototype.delete=function(U){return this.$changes.delete(U),this.$items.delete(U)},W.prototype.clear=function(W){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),W&&q.call(this,W),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},W.prototype.has=function(U){return this.$items.has(U)},W.prototype.forEach=function(U){this.$items.forEach(U)},W.prototype.entries=function(){return this.$items.entries()},W.prototype.keys=function(){return this.$items.keys()},W.prototype.values=function(){return this.$items.values()},Object.defineProperty(W.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),W.prototype.setIndex=function(U,W){this.$indexes.set(U,W)},W.prototype.getIndex=function(U){return this.$indexes.get(U)},W.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},W.prototype.deleteByIndex=function(U){var W=this.$indexes.get(U);this.$items.delete(W),this.$indexes.delete(U)},W.prototype.toJSON=function(){var U={};return this.forEach((function(W,l){U[l]="function"===typeof W.toJSON?W.toJSON():W})),U},W.prototype.clone=function(U){var l;return U?l=Object.assign(new W,this):(l=new W,this.forEach((function(U,W){U.$changes?l.set(W,U.clone()):l.set(W,U)}))),l},W}(),m={};function f(U,W){m[U]=W}function g(U){return m[U]}var E=function(){function U(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return U.create=function(W){var l=new U;return l.schema=Object.assign({},W&&W.schema||{}),l.indexes=Object.assign({},W&&W.indexes||{}),l.fieldsByIndex=Object.assign({},W&&W.fieldsByIndex||{}),l.descriptors=Object.assign({},W&&W.descriptors||{}),l.deprecated=Object.assign({},W&&W.deprecated||{}),l},U.prototype.addField=function(U,W){var l=this.getNextFieldIndex();this.fieldsByIndex[l]=U,this.indexes[U]=l,this.schema[U]=Array.isArray(W)?{array:W[0]}:W},U.prototype.hasField=function(U){return void 0!==this.indexes[U]},U.prototype.addFilter=function(U,W){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[U]]=W,this.indexesWithFilters.push(this.indexes[U]),!0},U.prototype.addChildrenFilter=function(U,W){var l=this.indexes[U],M=this.schema[U];if(g(Object.keys(M)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[l]=W,!0;console.warn("@filterChildren: field '".concat(U,"' can't have children. Ignoring filter."))},U.prototype.getChildrenFilter=function(U){return this.childFilters&&this.childFilters[this.indexes[U]]},U.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},U}();function Z(U){return U._context&&U._context.useFilters}var N=function(){function U(){this.types={},this.schemas=new Map,this.useFilters=!1}return U.prototype.has=function(U){return this.schemas.has(U)},U.prototype.get=function(U){return this.types[U]},U.prototype.add=function(U,W){void 0===W&&(W=this.schemas.size),U._definition=E.create(U._definition),U._typeid=W,this.types[W]=U,this.schemas.set(U,W)},U.create=function(W){return void 0===W&&(W={}),function(l){return W.context||(W.context=new U),o(l,W)}},U}(),D=new N;function o(U,W){return void 0===W&&(W={}),function(l,M){var L=W.context||D,p=l.constructor;if(p._context=L,!U)throw new Error("".concat(p.name,': @type() reference provided for "').concat(M,"\" is undefined. Make sure you don't have any circular dependencies."));L.has(p)||L.add(p);var B=p._definition;if(B.addField(M,U),B.descriptors[M]){if(B.deprecated[M])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(M,"' definition on '").concat(p.name,"'.\nCheck @type() annotation"))}catch(m){var k=m.stack.split("\n")[4].trim();throw new Error("".concat(m.message," ").concat(k))}}var A=w.is(U),q=!A&&r.is(U);if("string"!==typeof U&&!nU.is(U)){var y=Object.values(U)[0];"string"===typeof y||L.has(y)||L.add(y)}if(W.manual)B.descriptors[M]={enumerable:!0,configurable:!0,writable:!0};else{var j="_".concat(M);B.descriptors[j]={enumerable:!1,configurable:!1,writable:!0},B.descriptors[M]={get:function(){return this[j]},set:function(U){U!==this[j]&&(void 0!==U&&null!==U?(!A||U instanceof w||(U=new(w.bind.apply(w,t([void 0],U,!1)))),!q||U instanceof r||(U=new r(U)),void 0===U.$proxy&&(q?U=K(U):A&&(U=s(U))),this.$changes.change(M),U.$changes&&U.$changes.setParent(this,this.$changes.root,this._definition.indexes[M])):this[j]&&this.$changes.delete(M),this[j]=U)},enumerable:!0,configurable:!0}}}}function i(U){return function(W,l){var M=W.constructor;M._definition.addFilter(l,U)&&(M._context.useFilters=!0)}}function O(U){return function(W,l){var M=W.constructor;M._definition.addChildrenFilter(l,U)&&(M._context.useFilters=!0)}}function e(U){return void 0===U&&(U=!0),function(W,l){var M=W.constructor._definition;M.deprecated[l]=!0,U&&(M.descriptors[l]={get:function(){throw new Error("".concat(l," is deprecated."))},set:function(U){},enumerable:!1,configurable:!0})}}function d(U,W,l){for(var M in void 0===l&&(l={}),l.context||(l.context=U._context||l.context||D),W)o(W[M],l)(U.prototype,M);return U}function H(U){for(var W=0,l=0,M=0,t=U.length;M<t;M++)(W=U.charCodeAt(M))<128?l+=1:W<2048?l+=2:W<55296||W>=57344?l+=3:(M++,l+=4);return l}function V(U,W,l){for(var M=0,t=0,L=l.length;t<L;t++)(M=l.charCodeAt(t))<128?U[W++]=M:M<2048?(U[W++]=192|M>>6,U[W++]=128|63&M):M<55296||M>=57344?(U[W++]=224|M>>12,U[W++]=128|M>>6&63,U[W++]=128|63&M):(t++,M=65536+((1023&M)<<10|1023&l.charCodeAt(t)),U[W++]=240|M>>18,U[W++]=128|M>>12&63,U[W++]=128|M>>6&63,U[W++]=128|63&M)}function n(U,W){U.push(255&W)}function x(U,W){U.push(255&W)}function I(U,W){U.push(255&W),U.push(W>>8&255)}function R(U,W){U.push(255&W),U.push(W>>8&255)}function F(U,W){U.push(255&W),U.push(W>>8&255),U.push(W>>16&255),U.push(W>>24&255)}function v(U,W){var l=W>>24,M=W>>16,t=W>>8,L=W;U.push(255&L),U.push(255&t),U.push(255&M),U.push(255&l)}function J(U,W){var l=Math.floor(W/Math.pow(2,32));v(U,W>>>0),v(U,l)}function Q(U,W){var l=W/Math.pow(2,32)|0;v(U,W>>>0),v(U,l)}function G(U,W){S(U,W)}function u(U,W){c(U,W)}var b=new Int32Array(2),C=new Float32Array(b.buffer),P=new Float64Array(b.buffer);function S(U,W){C[0]=W,F(U,b[0])}function c(U,W){P[0]=W,F(U,b[0]),F(U,b[1])}function h(U,W){return x(U,W?1:0)}function z(U,W){W||(W="");var l=H(W),M=0;if(l<32)U.push(160|l),M=1;else if(l<256)U.push(217),x(U,l),M=2;else if(l<65536)U.push(218),R(U,l),M=3;else{if(!(l<4294967296))throw new Error("String too long");U.push(219),v(U,l),M=5}return V(U,U.length,W),M+l}function a(U,W){return isNaN(W)?a(U,0):isFinite(W)?W!==(0|W)?(U.push(203),c(U,W),9):W>=0?W<128?(x(U,W),1):W<256?(U.push(204),x(U,W),2):W<65536?(U.push(205),R(U,W),3):W<4294967296?(U.push(206),v(U,W),5):(U.push(207),Q(U,W),9):W>=-32?(U.push(224|W+32),1):W>=-128?(U.push(208),n(U,W),2):W>=-32768?(U.push(209),I(U,W),3):W>=-2147483648?(U.push(210),F(U,W),5):(U.push(211),J(U,W),9):a(U,W>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Y=Object.freeze({__proto__:null,utf8Write:V,int8:n,uint8:x,int16:I,uint16:R,int32:F,uint32:v,int64:J,uint64:Q,float32:G,float64:u,writeFloat32:S,writeFloat64:c,boolean:h,string:z,number:a});function X(U,W,l){for(var M="",t=0,L=W,p=W+l;L<p;L++){var B=U[L];0!==(128&B)?192!==(224&B)?224!==(240&B)?240!==(248&B)?console.error("Invalid byte "+B.toString(16)):(t=(7&B)<<18|(63&U[++L])<<12|(63&U[++L])<<6|63&U[++L])>=65536?(t-=65536,M+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):M+=String.fromCharCode(t):M+=String.fromCharCode((15&B)<<12|(63&U[++L])<<6|63&U[++L]):M+=String.fromCharCode((31&B)<<6|63&U[++L]):M+=String.fromCharCode(B)}return M}function T(U,W){return UU(U,W)<<24>>24}function UU(U,W){return U[W.offset++]}function WU(U,W){return lU(U,W)<<16>>16}function lU(U,W){return U[W.offset++]|U[W.offset++]<<8}function MU(U,W){return U[W.offset++]|U[W.offset++]<<8|U[W.offset++]<<16|U[W.offset++]<<24}function tU(U,W){return MU(U,W)>>>0}function LU(U,W){return jU(U,W)}function pU(U,W){return sU(U,W)}function BU(U,W){var l=tU(U,W);return MU(U,W)*Math.pow(2,32)+l}function kU(U,W){var l=tU(U,W);return tU(U,W)*Math.pow(2,32)+l}var AU=new Int32Array(2),qU=new Float32Array(AU.buffer),yU=new Float64Array(AU.buffer);function jU(U,W){return AU[0]=MU(U,W),qU[0]}function sU(U,W){return AU[0]=MU(U,W),AU[1]=MU(U,W),yU[0]}function wU(U,W){return UU(U,W)>0}function KU(U,W){var l,M=U[W.offset++];M<192?l=31&M:217===M?l=UU(U,W):218===M?l=lU(U,W):219===M&&(l=tU(U,W));var t=X(U,W.offset,l);return W.offset+=l,t}function rU(U,W){var l=U[W.offset];return l<192&&l>160||217===l||218===l||219===l}function mU(U,W){var l=U[W.offset++];return l<128?l:202===l?jU(U,W):203===l?sU(U,W):204===l?UU(U,W):205===l?lU(U,W):206===l?tU(U,W):207===l?kU(U,W):208===l?T(U,W):209===l?WU(U,W):210===l?MU(U,W):211===l?BU(U,W):l>223?-1*(255-l+1):void 0}function fU(U,W){var l=U[W.offset];return l<128||l>=202&&l<=211}function gU(U,W){return U[W.offset]<160}function EU(U,W){return U[W.offset-1]===p&&(U[W.offset]<128||U[W.offset]>=202&&U[W.offset]<=211)}var ZU=Object.freeze({__proto__:null,int8:T,uint8:UU,int16:WU,uint16:lU,int32:MU,uint32:tU,float32:LU,float64:pU,int64:BU,uint64:kU,readFloat32:jU,readFloat64:sU,boolean:wU,string:KU,stringCheck:rU,number:mU,numberCheck:fU,arrayCheck:gU,switchStructureCheck:EU}),NU=function(){function W(U){var W=this;this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return W.add(U)}))}return W.prototype.cc=function(W,l){return void 0===l&&(l=!0),A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,W,l?this.$items:void 0)},W.prototype.qc=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,W)},W.prototype.onChange=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,W)},W.is=function(U){return void 0!==U.collection},W.prototype.add=function(U){var W=this.$refId++;return void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,W),this.$changes.indexes[W]=W,this.$indexes.set(W,W),this.$items.set(W,U),this.$changes.change(W),W},W.prototype.at=function(U){var W=Array.from(this.$items.keys())[U];return this.$items.get(W)},W.prototype.entries=function(){return this.$items.entries()},W.prototype.delete=function(U){for(var W,l,M=this.$items.entries();(l=M.next())&&!l.done;)if(U===l.value[1]){W=l.value[0];break}return void 0!==W&&(this.$changes.delete(W),this.$indexes.delete(W),this.$items.delete(W))},W.prototype.clear=function(W){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),W&&q.call(this,W),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},W.prototype.has=function(U){return Array.from(this.$items.values()).some((function(W){return W===U}))},W.prototype.forEach=function(U){var W=this;this.$items.forEach((function(l,M,t){return U(l,M,W)}))},W.prototype.values=function(){return this.$items.values()},Object.defineProperty(W.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),W.prototype.setIndex=function(U,W){this.$indexes.set(U,W)},W.prototype.getIndex=function(U){return this.$indexes.get(U)},W.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},W.prototype.deleteByIndex=function(U){var W=this.$indexes.get(U);this.$items.delete(W),this.$indexes.delete(U)},W.prototype.toArray=function(){return Array.from(this.$items.values())},W.prototype.toJSON=function(){var U=[];return this.forEach((function(W,l){U.push("function"===typeof W.toJSON?W.toJSON():W)})),U},W.prototype.clone=function(U){var l;return U?l=Object.assign(new W,this):(l=new W,this.forEach((function(U){U.$changes?l.add(U.clone()):l.add(U)}))),l},W}(),DU=function(){function W(U){var W=this;this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return W.add(U)}))}return W.prototype.cc=function(W,l){return void 0===l&&(l=!0),A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,W,l?this.$items:void 0)},W.prototype.qc=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,W)},W.prototype.onChange=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,W)},W.is=function(U){return void 0!==U.set},W.prototype.add=function(W){var l,M;if(this.has(W))return!1;var t=this.$refId++;void 0!==W.$changes&&W.$changes.setParent(this,this.$changes.root,t);var L=null!==(M=null===(l=this.$changes.indexes[t])||void 0===l?void 0:l.op)&&void 0!==M?M:U.OPERATION.ADD;return this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,W),this.$changes.change(t,L),t},W.prototype.entries=function(){return this.$items.entries()},W.prototype.delete=function(U){for(var W,l,M=this.$items.entries();(l=M.next())&&!l.done;)if(U===l.value[1]){W=l.value[0];break}return void 0!==W&&(this.$changes.delete(W),this.$indexes.delete(W),this.$items.delete(W))},W.prototype.clear=function(W){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),W&&q.call(this,W),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},W.prototype.has=function(U){for(var W,l=this.$items.values(),M=!1;(W=l.next())&&!W.done;)if(U===W.value){M=!0;break}return M},W.prototype.forEach=function(U){var W=this;this.$items.forEach((function(l,M,t){return U(l,M,W)}))},W.prototype.values=function(){return this.$items.values()},Object.defineProperty(W.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),W.prototype.setIndex=function(U,W){this.$indexes.set(U,W)},W.prototype.getIndex=function(U){return this.$indexes.get(U)},W.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},W.prototype.deleteByIndex=function(U){var W=this.$indexes.get(U);this.$items.delete(W),this.$indexes.delete(U)},W.prototype.toArray=function(){return Array.from(this.$items.values())},W.prototype.toJSON=function(){var U=[];return this.forEach((function(W,l){U.push("function"===typeof W.toJSON?W.toJSON():W)})),U},W.prototype.clone=function(U){var l;return U?l=Object.assign(new W,this):(l=new W,this.forEach((function(U){U.$changes?l.add(U.clone()):l.add(U)}))),l},W}(),oU=function(){function U(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return U.prototype.addRefId=function(U){this.refIds.has(U)||(this.refIds.add(U),this.containerIndexes.set(U,new Set))},U.get=function(W){return void 0===W.$filterState&&(W.$filterState=new U),W.$filterState},U}(),iU=function(){function U(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return U.prototype.getNextUniqueId=function(){return this.nextUniqueId++},U.prototype.addRef=function(U,W,l){void 0===l&&(l=!0),this.refs.set(U,W),l&&(this.refCounts[U]=(this.refCounts[U]||0)+1)},U.prototype.removeRef=function(U){this.refCounts[U]=this.refCounts[U]-1,this.deletedRefs.add(U)},U.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},U.prototype.garbageCollectDeletedRefs=function(){var U=this;this.deletedRefs.forEach((function(W){if(!(U.refCounts[W]>0)){var l=U.refs.get(W);if(l instanceof nU)for(var M in l._definition.schema)"string"!==typeof l._definition.schema[M]&&l[M]&&l[M].$changes&&U.removeRef(l[M].$changes.refId);else{var t=l.$changes.parent._definition,L=t.schema[t.fieldsByIndex[l.$changes.parentIndex]];"function"===typeof Object.values(L)[0]&&Array.from(l.values()).forEach((function(W){return U.removeRef(W.$changes.refId)}))}U.refs.delete(W),delete U.refCounts[W]}})),this.deletedRefs.clear()},U}(),OU=function(U){function W(){return null!==U&&U.apply(this,arguments)||this}return l(W,U),W}(Error);function eU(U,W,l,M){var t,L=!1;switch(W){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":t="number",isNaN(U)&&console.log('trying to encode "NaN" in '.concat(l.constructor.name,"#").concat(M));break;case"string":t="string",L=!0;break;case"boolean":return}if(typeof U!==t&&(!L||L&&null!==U)){var p="'".concat(JSON.stringify(U),"'").concat(U&&U.constructor&&" (".concat(U.constructor.name,")")||"");throw new OU("a '".concat(t,"' was expected, but ").concat(p," was provided in ").concat(l.constructor.name,"#").concat(M))}}function dU(U,W,l,M){if(!(U instanceof W))throw new OU("a '".concat(W.name,"' was expected, but '").concat(U.constructor.name,"' was provided in ").concat(l.constructor.name,"#").concat(M))}function HU(U,W,l,M,t){eU(l,U,M,t);var L=Y[U];if(!L)throw new OU("a '".concat(U,"' was expected, but ").concat(l," was provided in ").concat(M.constructor.name,"#").concat(t));L(W,l)}function VU(U,W,l){return ZU[U](W,l)}var nU=function(){function W(){for(var U=[],W=0;W<arguments.length;W++)U[W]=arguments[W];Object.defineProperties(this,{$changes:{value:new k(this,void 0,new iU),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var l=this._definition.descriptors;l&&Object.defineProperties(this,l),U[0]&&this.assign(U[0])}return W.onError=function(U){console.error(U)},W.is=function(U){return U._definition&&void 0!==U._definition.schema},W.prototype.onChange=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,W)},W.prototype.qc=function(W){return A(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,W)},W.prototype.assign=function(U){return Object.assign(this,U),this},Object.defineProperty(W.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),W.prototype.setDirty=function(U,W){this.$changes.change(U,W)},W.prototype.listen=function(U,W,l){var M=this;return void 0===l&&(l=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[U]||(this.$callbacks[U]=[]),this.$callbacks[U].push(W),l&&void 0!==this[U]&&W(this[U],void 0),function(){return y(M.$callbacks[U],M.$callbacks[U].indexOf(W))}},W.prototype.decode=function(l,M,t){var L;void 0===M&&(M={offset:0}),void 0===t&&(t=this);var B=[],k=this.$changes.root,A=l.length,q=0;for(k.refs.set(q,this);M.offset<A;){var y=l[M.offset++];if(y!=p){var j=t.$changes,s=void 0!==t._definition,K=s?y>>6<<6:y;if(K!==U.OPERATION.CLEAR){var m=s?y%(K||255):mU(l,M),f=s?t._definition.fieldsByIndex[m]:"",E=j.getType(m),Z=void 0,N=void 0,D=void 0;if(s?N=t["_".concat(f)]:(N=t.getByIndex(m),(K&U.OPERATION.ADD)===U.OPERATION.ADD?(D=t instanceof r?KU(l,M):m,t.setIndex(m,D)):D=t.getIndex(m)),(K&U.OPERATION.DELETE)===U.OPERATION.DELETE&&(K!==U.OPERATION.DELETE_AND_ADD&&t.deleteByIndex(m),N&&N.$changes&&k.removeRef(N.$changes.refId),Z=null),void 0!==f){if(K===U.OPERATION.DELETE);else if(W.is(E)){var o=mU(l,M);if(Z=k.refs.get(o),K!==U.OPERATION.REPLACE){var i=this.getSchemaType(l,M,E);Z||((Z=this.createTypeInstance(i)).$changes.refId=o,N&&(Z.$callbacks=N.$callbacks,N.$changes.refId&&o!==N.$changes.refId&&k.removeRef(N.$changes.refId))),k.addRef(o,Z,Z!==N)}}else if("string"===typeof E)Z=VU(E,l,M);else{var O=g(Object.keys(E)[0]),e=mU(l,M),d=k.refs.has(e)?N||k.refs.get(e):new O.constructor;if((Z=d.clone(!0)).$changes.refId=e,N&&(Z.$callbacks=N.$callbacks,N.$changes.refId&&e!==N.$changes.refId)){k.removeRef(N.$changes.refId);for(var H=N.entries(),V=void 0;(V=H.next())&&!V.done;){var n=(L=V.value)[0],x=L[1];B.push({refId:e,op:U.OPERATION.DELETE,field:n,value:void 0,previousValue:x})}}k.addRef(e,Z,d!==N)}if(null!==Z&&void 0!==Z)if(Z.$changes&&Z.$changes.setParent(j.ref,j.root,m),t instanceof W)t[f]=Z;else if(t instanceof r)n=D,t.$items.set(n,Z),t.$changes.allChanges.add(m);else if(t instanceof w)t.setAt(m,Z);else if(t instanceof NU){var I=t.add(Z);t.setIndex(m,I)}else t instanceof DU&&!1!==(I=t.add(Z))&&t.setIndex(m,I);N!==Z&&B.push({refId:q,op:K,field:f,dynamicIndex:D,value:Z,previousValue:N})}else{console.warn("@colyseus/schema: definition mismatch");for(var R={offset:M.offset};M.offset<A&&(!EU(l,M)||(R.offset=M.offset+1,!k.refs.has(mU(l,R))));)M.offset++}}else t.clear(B)}else{q=mU(l,M);var F=k.refs.get(q);if(!F)throw new Error('"refId" not found: '.concat(q));t=F}}return this._triggerChanges(B),k.garbageCollectDeletedRefs(),B},W.prototype.encode=function(l,M,t){void 0===l&&(l=!1),void 0===M&&(M=[]),void 0===t&&(t=!1);for(var L=this.$changes,B=new WeakSet,k=[L],A=1,q=0;q<A;q++){var y=k[q],j=y.ref,s=j instanceof W;y.ensureRefId(),B.add(y),y!==L&&(y.changed||l)&&(x(M,p),a(M,y.refId));for(var w=l?Array.from(y.allChanges):Array.from(y.changes.values()),K=0,m=w.length;K<m;K++){var f=l?{op:U.OPERATION.ADD,index:w[K]}:w[K],E=f.index,Z=s?j._definition.fieldsByIndex&&j._definition.fieldsByIndex[E]:E,N=M.length;if(f.op!==U.OPERATION.TOUCH)if(s)x(M,E|f.op);else{if(x(M,f.op),f.op===U.OPERATION.CLEAR)continue;a(M,E)}if(s||(f.op&U.OPERATION.ADD)!=U.OPERATION.ADD||j instanceof r&&z(M,y.ref.$indexes.get(E)),f.op!==U.OPERATION.DELETE){var D=y.getType(E),o=y.getValue(E);if(o&&o.$changes&&!B.has(o.$changes)&&(k.push(o.$changes),o.$changes.ensureRefId(),A++),f.op!==U.OPERATION.TOUCH){if(W.is(D))dU(o,D,j,Z),a(M,o.$changes.refId),(f.op&U.OPERATION.ADD)===U.OPERATION.ADD&&this.tryEncodeTypeId(M,D,o.constructor);else if("string"===typeof D)HU(D,M,o,j,Z);else{var i=g(Object.keys(D)[0]);dU(j["_".concat(Z)],i.constructor,j,Z),a(M,o.$changes.refId)}t&&y.cache(E,M.slice(N))}}}l||t||y.discard()}return M},W.prototype.encodeAll=function(U){return this.encode(!0,[],U)},W.prototype.applyFilters=function(l,M){var t,L;void 0===M&&(M=!1);for(var B=this,k=new Set,A=oU.get(l),q=[this.$changes],y=1,j=[],s=function(s){var w=q[s];if(k.has(w.refId))return"continue";var K=w.ref,m=K instanceof W;x(j,p),a(j,w.refId);var f=A.refIds.has(w),g=M||!f;A.addRefId(w);var E=A.containerIndexes.get(w),Z=g?Array.from(w.allChanges):Array.from(w.changes.values());!M&&m&&K._definition.indexesWithFilters&&K._definition.indexesWithFilters.forEach((function(W){!E.has(W)&&w.allChanges.has(W)&&(g?Z.push(W):Z.push({op:U.OPERATION.ADD,index:W}))}));for(var N=0,D=Z.length;N<D;N++){var o=g?{op:U.OPERATION.ADD,index:Z[N]}:Z[N];if(o.op!==U.OPERATION.CLEAR){var i=o.index;if(o.op!==U.OPERATION.DELETE){var O=w.getValue(i),e=w.getType(i);if(m){if((d=K._definition.filters&&K._definition.filters[i])&&!d.call(K,l,O,B)){O&&O.$changes&&k.add(O.$changes.refId);continue}}else{var d,H=w.parent;if((d=w.getChildrenFilter())&&!d.call(H,l,K.$indexes.get(i),O,B)){O&&O.$changes&&k.add(O.$changes.refId);continue}}if(O.$changes&&(q.push(O.$changes),y++),o.op!==U.OPERATION.TOUCH)if(o.op===U.OPERATION.ADD||m)j.push.apply(j,null!==(t=w.caches[i])&&void 0!==t?t:[]),E.add(i);else if(E.has(i))j.push.apply(j,null!==(L=w.caches[i])&&void 0!==L?L:[]);else{if(E.add(i),x(j,U.OPERATION.ADD),a(j,i),K instanceof r){var V=w.ref.$indexes.get(i);z(j,V)}O.$changes?a(j,O.$changes.refId):Y[e](j,O)}else O.$changes&&!m&&(x(j,U.OPERATION.ADD),a(j,i),K instanceof r&&(V=w.ref.$indexes.get(i),z(j,V)),a(j,O.$changes.refId))}else m?x(j,o.op|i):(x(j,o.op),a(j,i))}else x(j,o.op)}},w=0;w<y;w++)s(w);return j},W.prototype.clone=function(){var U,W=new this.constructor,l=this._definition.schema;for(var M in l)"object"===typeof this[M]&&"function"===typeof(null===(U=this[M])||void 0===U?void 0:U.clone)?W[M]=this[M].clone():W[M]=this[M];return W},W.prototype.toJSON=function(){var U=this._definition.schema,W=this._definition.deprecated,l={};for(var M in U)W[M]||null===this[M]||"undefined"===typeof this[M]||(l[M]="function"===typeof this[M].toJSON?this[M].toJSON():this["_".concat(M)]);return l},W.prototype.discardAllChanges=function(){this.$changes.discardAll()},W.prototype.getByIndex=function(U){return this[this._definition.fieldsByIndex[U]]},W.prototype.deleteByIndex=function(U){this[this._definition.fieldsByIndex[U]]=void 0},W.prototype.tryEncodeTypeId=function(U,W,l){W._typeid!==l._typeid&&(x(U,B),a(U,l._typeid))},W.prototype.getSchemaType=function(U,W,l){var M;return U[W.offset]===B&&(W.offset++,M=this.constructor._context.get(mU(U,W))),M||l},W.prototype.createTypeInstance=function(U){var W=new U;return W.$changes.root=this.$changes.root,W},W.prototype._triggerChanges=function(l){for(var M,t,L,p,B,k,A,q,y,j=new Set,s=this.$changes.root.refs,w=function(w){var K=l[w],r=K.refId,m=s.get(r),f=m.$callbacks;if((K.op&U.OPERATION.DELETE)===U.OPERATION.DELETE&&K.previousValue instanceof W&&(null===(t=null===(M=K.previousValue.$callbacks)||void 0===M?void 0:M[U.OPERATION.DELETE])||void 0===t||t.forEach((function(U){return U()}))),!f)return"continue";if(m instanceof W){if(!j.has(r))try{null===(L=null===f||void 0===f?void 0:f[U.OPERATION.REPLACE])||void 0===L||L.forEach((function(U){return U()}))}catch(g){W.onError(g)}try{f.hasOwnProperty(K.field)&&(null===(p=f[K.field])||void 0===p||p.forEach((function(U){return U(K.value,K.previousValue)})))}catch(g){W.onError(g)}}else K.op===U.OPERATION.ADD&&void 0===K.previousValue?null===(B=f[U.OPERATION.ADD])||void 0===B||B.forEach((function(U){var W;return U(K.value,null!==(W=K.dynamicIndex)&&void 0!==W?W:K.field)})):K.op===U.OPERATION.DELETE?void 0!==K.previousValue&&(null===(k=f[U.OPERATION.DELETE])||void 0===k||k.forEach((function(U){var W;return U(K.previousValue,null!==(W=K.dynamicIndex)&&void 0!==W?W:K.field)}))):K.op===U.OPERATION.DELETE_AND_ADD&&(void 0!==K.previousValue&&(null===(A=f[U.OPERATION.DELETE])||void 0===A||A.forEach((function(U){var W;return U(K.previousValue,null!==(W=K.dynamicIndex)&&void 0!==W?W:K.field)}))),null===(q=f[U.OPERATION.ADD])||void 0===q||q.forEach((function(U){var W;return U(K.value,null!==(W=K.dynamicIndex)&&void 0!==W?W:K.field)}))),K.value!==K.previousValue&&(null===(y=f[U.OPERATION.REPLACE])||void 0===y||y.forEach((function(U){var W;return U(K.value,null!==(W=K.dynamicIndex)&&void 0!==W?W:K.field)})));j.add(r)},K=0;K<l.length;K++)w(K)},W._definition=E.create(),W}();function xU(U){for(var W=[U.$changes],l=1,M={},t=M,L=function(U){var l=W[U];l.changes.forEach((function(U){var W=l.ref,M=U.index,L=W._definition?W._definition.fieldsByIndex[M]:W.$indexes.get(M);t[L]=l.getValue(M)}))},p=0;p<l;p++)L(p);return M}var IU={context:new N},RU=function(U){function W(){return null!==U&&U.apply(this,arguments)||this}return l(W,U),M([o("string",IU)],W.prototype,"name",void 0),M([o("string",IU)],W.prototype,"type",void 0),M([o("number",IU)],W.prototype,"referencedType",void 0),W}(nU),FU=function(U){function W(){var W=null!==U&&U.apply(this,arguments)||this;return W.fields=new w,W}return l(W,U),M([o("number",IU)],W.prototype,"id",void 0),M([o([RU],IU)],W.prototype,"fields",void 0),W}(nU),vU=function(U){function W(){var W=null!==U&&U.apply(this,arguments)||this;return W.types=new w,W}return l(W,U),W.encode=function(U){var l=U.constructor,M=new W;M.rootType=l._typeid;var t=function(U,W){for(var l in W){var t=new RU;t.name=l;var L=void 0;if("string"===typeof W[l])L=W[l];else{var p=W[l],B=void 0;nU.is(p)?(L="ref",B=W[l]):"string"===typeof p[L=Object.keys(p)[0]]?L+=":"+p[L]:B=p[L],t.referencedType=B?B._typeid:-1}t.type=L,U.fields.push(t)}M.types.push(U)},L=l._context.types;for(var p in L){var B=new FU;B.id=Number(p),t(B,L[p]._definition.schema)}return M.encodeAll()},W.decode=function(U,M){var t=new N,L=new W;L.decode(U,M);var p=L.types.reduce((function(U,W){var M=function(U){function W(){return null!==U&&U.apply(this,arguments)||this}return l(W,U),W}(nU),L=W.id;return U[L]=M,t.add(M,L),U}),{});L.types.forEach((function(U){var W=p[U.id];U.fields.forEach((function(U){var l;if(void 0!==U.referencedType){var M=U.type,L=p[U.referencedType];if(!L){var B=U.type.split(":");M=B[0],L=B[1]}"ref"===M?o(L,{context:t})(W.prototype,U.name):o(((l={})[M]=L,l),{context:t})(W.prototype,U.name)}else o(U.type,{context:t})(W.prototype,U.name)}))}));var B=p[L.rootType],k=new B;for(var A in B._definition.schema){var q=B._definition.schema[A];"string"!==typeof q&&(k[A]="function"===typeof q?new q:new(g(Object.keys(q)[0]).constructor))}return k},M([o([FU],IU)],W.prototype,"types",void 0),M([o("number",IU)],W.prototype,"rootType",void 0),W}(nU);f("map",{constructor:r}),f("array",{constructor:w}),f("set",{constructor:DU}),f("collection",{constructor:NU}),U.ArraySchema=w,U.CollectionSchema=NU,U.Context=N,U.MapSchema=r,U.Reflection=vU,U.ReflectionField=RU,U.ReflectionType=FU,U.Schema=nU,U.SchemaDefinition=E,U.SetSchema=DU,U.decode=ZU,U.defineTypes=d,U.deprecated=e,U.dumpChanges=xU,U.encode=Y,U.filter=i,U.filterChildren=O,U.hasFilter=Z,U.registerType=f,U.type=o,Object.defineProperty(U,"__esModule",{value:!0})}(W)},12936:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12932:(U,W,l)=>{var M=l(12936),t=l(12945),L=Object.hasOwnProperty,p=Object.create(null);for(var B in M)L.call(M,B)&&(p[M[B]]=B);var k=U.exports={to:{},get:{}};function A(U,W,l){return Math.min(Math.max(W,U),l)}function q(U){var W=Math.round(U).toString(16).toUpperCase();return W.length<2?"0"+W:W}k.get=function(U){var W,l;switch(U.substring(0,3).toLowerCase()){case"hsl":W=k.get.hsl(U),l="hsl";break;case"hwb":W=k.get.hwb(U),l="hwb";break;default:W=k.get.rgb(U),l="rgb"}return W?{model:l,value:W}:null},k.get.rgb=function(U){if(!U)return null;var W,l,t,p=[0,0,0,1];if(W=U.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(t=W[2],W=W[1],l=0;l<3;l++){var B=2*l;p[l]=parseInt(W.slice(B,B+2),16)}t&&(p[3]=parseInt(t,16)/255)}else if(W=U.match(/^#([a-f0-9]{3,4})$/i)){for(t=(W=W[1])[3],l=0;l<3;l++)p[l]=parseInt(W[l]+W[l],16);t&&(p[3]=parseInt(t+t,16)/255)}else if(W=U.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(l=0;l<3;l++)p[l]=parseInt(W[l+1],0);W[4]&&(W[5]?p[3]=.01*parseFloat(W[4]):p[3]=parseFloat(W[4]))}else{if(!(W=U.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(W=U.match(/^(\w+)$/))?"transparent"===W[1]?[0,0,0,0]:L.call(M,W[1])?((p=M[W[1]])[3]=1,p):null:null;for(l=0;l<3;l++)p[l]=Math.round(2.55*parseFloat(W[l+1]));W[4]&&(W[5]?p[3]=.01*parseFloat(W[4]):p[3]=parseFloat(W[4]))}for(l=0;l<3;l++)p[l]=A(p[l],0,255);return p[3]=A(p[3],0,1),p},k.get.hsl=function(U){if(!U)return null;var W=U.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(W){var l=parseFloat(W[4]);return[(parseFloat(W[1])%360+360)%360,A(parseFloat(W[2]),0,100),A(parseFloat(W[3]),0,100),A(isNaN(l)?1:l,0,1)]}return null},k.get.hwb=function(U){if(!U)return null;var W=U.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(W){var l=parseFloat(W[4]);return[(parseFloat(W[1])%360+360)%360,A(parseFloat(W[2]),0,100),A(parseFloat(W[3]),0,100),A(isNaN(l)?1:l,0,1)]}return null},k.to.hex=function(){var U=t(arguments);return"#"+q(U[0])+q(U[1])+q(U[2])+(U[3]<1?q(Math.round(255*U[3])):"")},k.to.rgb=function(){var U=t(arguments);return U.length<4||1===U[3]?"rgb("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+")":"rgba("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+", "+U[3]+")"},k.to.rgb.percent=function(){var U=t(arguments),W=Math.round(U[0]/255*100),l=Math.round(U[1]/255*100),M=Math.round(U[2]/255*100);return U.length<4||1===U[3]?"rgb("+W+"%, "+l+"%, "+M+"%)":"rgba("+W+"%, "+l+"%, "+M+"%, "+U[3]+")"},k.to.hsl=function(){var U=t(arguments);return U.length<4||1===U[3]?"hsl("+U[0]+", "+U[1]+"%, "+U[2]+"%)":"hsla("+U[0]+", "+U[1]+"%, "+U[2]+"%, "+U[3]+")"},k.to.hwb=function(){var U=t(arguments),W="";return U.length>=4&&1!==U[3]&&(W=", "+U[3]),"hwb("+U[0]+", "+U[1]+"%, "+U[2]+"%"+W+")"},k.to.keyword=function(U){return p[U.slice(0,3)]}},12929:(U,W,l)=>{const M=l(12932),t=l(12962),L=["keyword","gray","hex"],p={};for(const s of Object.keys(t))p[[...t[s].labels].sort().join("")]=s;const B={};function k(U,W){if(!(this instanceof k))return new k(U,W);if(W&&W in L&&(W=null),W&&!(W in t))throw new Error("Unknown model: "+W);let l,A;if(null==U)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(U instanceof k)this.model=U.model,this.color=[...U.color],this.valpha=U.valpha;else if("string"===typeof U){const W=M.get(U);if(null===W)throw new Error("Unable to parse color from string: "+U);this.model=W.model,A=t[this.model].channels,this.color=W.value.slice(0,A),this.valpha="number"===typeof W.value[A]?W.value[A]:1}else if(U.length>0){this.model=W||"rgb",A=t[this.model].channels;const l=Array.prototype.slice.call(U,0,A);this.color=j(l,A),this.valpha="number"===typeof U[A]?U[A]:1}else if("number"===typeof U)this.model="rgb",this.color=[U>>16&255,U>>8&255,255&U],this.valpha=1;else{this.valpha=1;const W=Object.keys(U);"alpha"in U&&(W.splice(W.indexOf("alpha"),1),this.valpha="number"===typeof U.alpha?U.alpha:0);const M=W.sort().join("");if(!(M in p))throw new Error("Unable to parse color from object: "+JSON.stringify(U));this.model=p[M];const{labels:L}=t[this.model],B=[];for(l=0;l<L.length;l++)B.push(U[L[l]]);this.color=j(B)}if(B[this.model])for(A=t[this.model].channels,l=0;l<A;l++){const U=B[this.model][l];U&&(this.color[l]=U(this.color[l]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}k.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(U){let W=this.model in M.to?this:this.rgb();W=W.round("number"===typeof U?U:1);const l=1===W.valpha?W.color:[...W.color,this.valpha];return M.to[W.model](l)},percentString(U){const W=this.rgb().round("number"===typeof U?U:1),l=1===W.valpha?W.color:[...W.color,this.valpha];return M.to.rgb.percent(l)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const U={},{channels:W}=t[this.model],{labels:l}=t[this.model];for(let M=0;M<W;M++)U[l[M]]=this.color[M];return 1!==this.valpha&&(U.alpha=this.valpha),U},unitArray(){const U=this.rgb().color;return U[0]/=255,U[1]/=255,U[2]/=255,1!==this.valpha&&U.push(this.valpha),U},unitObject(){const U=this.rgb().object();return U.r/=255,U.g/=255,U.b/=255,1!==this.valpha&&(U.alpha=this.valpha),U},round(U){return U=Math.max(U||0,0),new k([...this.color.map(A(U)),this.valpha],this.model)},alpha(U){return void 0!==U?new k([...this.color,Math.max(0,Math.min(1,U))],this.model):this.valpha},red:q("rgb",0,y(255)),green:q("rgb",1,y(255)),blue:q("rgb",2,y(255)),hue:q(["hsl","hsv","hsl","hwb","hcg"],0,(U=>(U%360+360)%360)),saturationl:q("hsl",1,y(100)),lightness:q("hsl",2,y(100)),saturationv:q("hsv",1,y(100)),value:q("hsv",2,y(100)),chroma:q("hcg",1,y(100)),gray:q("hcg",2,y(100)),white:q("hwb",1,y(100)),wblack:q("hwb",2,y(100)),cyan:q("cmyk",0,y(100)),magenta:q("cmyk",1,y(100)),yellow:q("cmyk",2,y(100)),black:q("cmyk",3,y(100)),x:q("xyz",0,y(95.047)),y:q("xyz",1,y(100)),z:q("xyz",2,y(108.833)),l:q("lab",0,y(100)),a:q("lab",1),b:q("lab",2),keyword(U){return void 0!==U?new k(U):t[this.model].keyword(this.color)},hex(U){return void 0!==U?new k(U):M.to.hex(this.rgb().round().color)},hexa(U){if(void 0!==U)return new k(U);const W=this.rgb().round().color;let l=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===l.length&&(l="0"+l),M.to.hex(W)+l},rgbNumber(){const U=this.rgb().color;return(255&U[0])<<16|(255&U[1])<<8|255&U[2]},luminosity(){const U=this.rgb().color,W=[];for(const[l,M]of U.entries()){const U=M/255;W[l]=U<=.04045?U/12.92:((U+.055)/1.055)**2.4}return.2126*W[0]+.7152*W[1]+.0722*W[2]},contrast(U){const W=this.luminosity(),l=U.luminosity();return W>l?(W+.05)/(l+.05):(l+.05)/(W+.05)},level(U){const W=this.contrast(U);return W>=7?"AAA":W>=4.5?"AA":""},isDark(){const U=this.rgb().color;return(2126*U[0]+7152*U[1]+722*U[2])/1e4<128},isLight(){return!this.isDark()},negate(){const U=this.rgb();for(let W=0;W<3;W++)U.color[W]=255-U.color[W];return U},lighten(U){const W=this.hsl();return W.color[2]+=W.color[2]*U,W},darken(U){const W=this.hsl();return W.color[2]-=W.color[2]*U,W},saturate(U){const W=this.hsl();return W.color[1]+=W.color[1]*U,W},desaturate(U){const W=this.hsl();return W.color[1]-=W.color[1]*U,W},whiten(U){const W=this.hwb();return W.color[1]+=W.color[1]*U,W},blacken(U){const W=this.hwb();return W.color[2]+=W.color[2]*U,W},grayscale(){const U=this.rgb().color,W=.3*U[0]+.59*U[1]+.11*U[2];return k.rgb(W,W,W)},fade(U){return this.alpha(this.valpha-this.valpha*U)},opaquer(U){return this.alpha(this.valpha+this.valpha*U)},rotate(U){const W=this.hsl();let l=W.color[0];return l=(l+U)%360,l=l<0?360+l:l,W.color[0]=l,W},mix(U,W){if(!U||!U.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof U);const l=U.rgb(),M=this.rgb(),t=void 0===W?.5:W,L=2*t-1,p=l.alpha()-M.alpha(),B=((L*p===-1?L:(L+p)/(1+L*p))+1)/2,A=1-B;return k.rgb(B*l.red()+A*M.red(),B*l.green()+A*M.green(),B*l.blue()+A*M.blue(),l.alpha()*t+M.alpha()*(1-t))}};for(const s of Object.keys(t)){if(L.includes(s))continue;const{channels:U}=t[s];k.prototype[s]=function(){if(this.model===s)return new k(this);for(var U=arguments.length,W=new Array(U),l=0;l<U;l++)W[l]=arguments[l];return W.length>0?new k(W,s):new k([...(M=t[this.model][s].raw(this.color),Array.isArray(M)?M:[M]),this.valpha],s);var M},k[s]=function(){for(var W=arguments.length,l=new Array(W),M=0;M<W;M++)l[M]=arguments[M];let t=l[0];return"number"===typeof t&&(t=j(l,U)),new k(t,s)}}function A(U){return function(W){return function(U,W){return Number(U.toFixed(W))}(W,U)}}function q(U,W,l){U=Array.isArray(U)?U:[U];for(const M of U)(B[M]||(B[M]=[]))[W]=l;return U=U[0],function(M){let t;return void 0!==M?(l&&(M=l(M)),t=this[U](),t.color[W]=M,t):(t=this[U]().color[W],l&&(t=l(t)),t)}}function y(U){return function(W){return Math.max(0,Math.min(U,W))}}function j(U,W){for(let l=0;l<W;l++)"number"!==typeof U[l]&&(U[l]=0);return U}U.exports=k},12968:(U,W,l)=>{const M=l(12973),t={};for(const p of Object.keys(M))t[M[p]]=p;const L={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};U.exports=L;for(const p of Object.keys(L)){if(!("channels"in L[p]))throw new Error("missing channels property: "+p);if(!("labels"in L[p]))throw new Error("missing channel labels property: "+p);if(L[p].labels.length!==L[p].channels)throw new Error("channel and label counts mismatch: "+p);const{channels:U,labels:W}=L[p];delete L[p].channels,delete L[p].labels,Object.defineProperty(L[p],"channels",{value:U}),Object.defineProperty(L[p],"labels",{value:W})}L.rgb.hsl=function(U){const W=U[0]/255,l=U[1]/255,M=U[2]/255,t=Math.min(W,l,M),L=Math.max(W,l,M),p=L-t;let B,k;L===t?B=0:W===L?B=(l-M)/p:l===L?B=2+(M-W)/p:M===L&&(B=4+(W-l)/p),B=Math.min(60*B,360),B<0&&(B+=360);const A=(t+L)/2;return k=L===t?0:A<=.5?p/(L+t):p/(2-L-t),[B,100*k,100*A]},L.rgb.hsv=function(U){let W,l,M,t,L;const p=U[0]/255,B=U[1]/255,k=U[2]/255,A=Math.max(p,B,k),q=A-Math.min(p,B,k),y=function(U){return(A-U)/6/q+.5};return 0===q?(t=0,L=0):(L=q/A,W=y(p),l=y(B),M=y(k),p===A?t=M-l:B===A?t=1/3+W-M:k===A&&(t=2/3+l-W),t<0?t+=1:t>1&&(t-=1)),[360*t,100*L,100*A]},L.rgb.hwb=function(U){const W=U[0],l=U[1];let M=U[2];const t=L.rgb.hsl(U)[0],p=1/255*Math.min(W,Math.min(l,M));return M=1-1/255*Math.max(W,Math.max(l,M)),[t,100*p,100*M]},L.rgb.cmyk=function(U){const W=U[0]/255,l=U[1]/255,M=U[2]/255,t=Math.min(1-W,1-l,1-M);return[100*((1-W-t)/(1-t)||0),100*((1-l-t)/(1-t)||0),100*((1-M-t)/(1-t)||0),100*t]},L.rgb.keyword=function(U){const W=t[U];if(W)return W;let l,L=1/0;for(const t of Object.keys(M)){const W=M[t],k=(B=W,((p=U)[0]-B[0])**2+(p[1]-B[1])**2+(p[2]-B[2])**2);k<L&&(L=k,l=t)}var p,B;return l},L.keyword.rgb=function(U){return M[U]},L.rgb.xyz=function(U){let W=U[0]/255,l=U[1]/255,M=U[2]/255;W=W>.04045?((W+.055)/1.055)**2.4:W/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92,M=M>.04045?((M+.055)/1.055)**2.4:M/12.92;return[100*(.4124*W+.3576*l+.1805*M),100*(.2126*W+.7152*l+.0722*M),100*(.0193*W+.1192*l+.9505*M)]},L.rgb.lab=function(U){const W=L.rgb.xyz(U);let l=W[0],M=W[1],t=W[2];l/=95.047,M/=100,t/=108.883,l=l>.008856?l**(1/3):7.787*l+16/116,M=M>.008856?M**(1/3):7.787*M+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*M-16,500*(l-M),200*(M-t)]},L.hsl.rgb=function(U){const W=U[0]/360,l=U[1]/100,M=U[2]/100;let t,L,p;if(0===l)return p=255*M,[p,p,p];t=M<.5?M*(1+l):M+l-M*l;const B=2*M-t,k=[0,0,0];for(let A=0;A<3;A++)L=W+1/3*-(A-1),L<0&&L++,L>1&&L--,p=6*L<1?B+6*(t-B)*L:2*L<1?t:3*L<2?B+(t-B)*(2/3-L)*6:B,k[A]=255*p;return k},L.hsl.hsv=function(U){const W=U[0];let l=U[1]/100,M=U[2]/100,t=l;const L=Math.max(M,.01);M*=2,l*=M<=1?M:2-M,t*=L<=1?L:2-L;return[W,100*(0===M?2*t/(L+t):2*l/(M+l)),100*((M+l)/2)]},L.hsv.rgb=function(U){const W=U[0]/60,l=U[1]/100;let M=U[2]/100;const t=Math.floor(W)%6,L=W-Math.floor(W),p=255*M*(1-l),B=255*M*(1-l*L),k=255*M*(1-l*(1-L));switch(M*=255,t){case 0:return[M,k,p];case 1:return[B,M,p];case 2:return[p,M,k];case 3:return[p,B,M];case 4:return[k,p,M];case 5:return[M,p,B]}},L.hsv.hsl=function(U){const W=U[0],l=U[1]/100,M=U[2]/100,t=Math.max(M,.01);let L,p;p=(2-l)*M;const B=(2-l)*t;return L=l*t,L/=B<=1?B:2-B,L=L||0,p/=2,[W,100*L,100*p]},L.hwb.rgb=function(U){const W=U[0]/360;let l=U[1]/100,M=U[2]/100;const t=l+M;let L;t>1&&(l/=t,M/=t);const p=Math.floor(6*W),B=1-M;L=6*W-p,0!==(1&p)&&(L=1-L);const k=l+L*(B-l);let A,q,y;switch(p){default:case 6:case 0:A=B,q=k,y=l;break;case 1:A=k,q=B,y=l;break;case 2:A=l,q=B,y=k;break;case 3:A=l,q=k,y=B;break;case 4:A=k,q=l,y=B;break;case 5:A=B,q=l,y=k}return[255*A,255*q,255*y]},L.cmyk.rgb=function(U){const W=U[0]/100,l=U[1]/100,M=U[2]/100,t=U[3]/100;return[255*(1-Math.min(1,W*(1-t)+t)),255*(1-Math.min(1,l*(1-t)+t)),255*(1-Math.min(1,M*(1-t)+t))]},L.xyz.rgb=function(U){const W=U[0]/100,l=U[1]/100,M=U[2]/100;let t,L,p;return t=3.2406*W+-1.5372*l+-.4986*M,L=-.9689*W+1.8758*l+.0415*M,p=.0557*W+-.204*l+1.057*M,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,t=Math.min(Math.max(0,t),1),L=Math.min(Math.max(0,L),1),p=Math.min(Math.max(0,p),1),[255*t,255*L,255*p]},L.xyz.lab=function(U){let W=U[0],l=U[1],M=U[2];W/=95.047,l/=100,M/=108.883,W=W>.008856?W**(1/3):7.787*W+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,M=M>.008856?M**(1/3):7.787*M+16/116;return[116*l-16,500*(W-l),200*(l-M)]},L.lab.xyz=function(U){let W,l,M;l=(U[0]+16)/116,W=U[1]/500+l,M=l-U[2]/200;const t=l**3,L=W**3,p=M**3;return l=t>.008856?t:(l-16/116)/7.787,W=L>.008856?L:(W-16/116)/7.787,M=p>.008856?p:(M-16/116)/7.787,W*=95.047,l*=100,M*=108.883,[W,l,M]},L.lab.lch=function(U){const W=U[0],l=U[1],M=U[2];let t;t=360*Math.atan2(M,l)/2/Math.PI,t<0&&(t+=360);return[W,Math.sqrt(l*l+M*M),t]},L.lch.lab=function(U){const W=U[0],l=U[1],M=U[2]/360*2*Math.PI;return[W,l*Math.cos(M),l*Math.sin(M)]},L.rgb.ansi16=function(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[l,M,t]=U;let p=null===W?L.rgb.hsv(U)[2]:W;if(p=Math.round(p/50),0===p)return 30;let B=30+(Math.round(t/255)<<2|Math.round(M/255)<<1|Math.round(l/255));return 2===p&&(B+=60),B},L.hsv.ansi16=function(U){return L.rgb.ansi16(L.hsv.rgb(U),U[2])},L.rgb.ansi256=function(U){const W=U[0],l=U[1],M=U[2];if(W===l&&l===M)return W<8?16:W>248?231:Math.round((W-8)/247*24)+232;return 16+36*Math.round(W/255*5)+6*Math.round(l/255*5)+Math.round(M/255*5)},L.ansi16.rgb=function(U){let W=U%10;if(0===W||7===W)return U>50&&(W+=3.5),W=W/10.5*255,[W,W,W];const l=.5*(1+~~(U>50));return[(1&W)*l*255,(W>>1&1)*l*255,(W>>2&1)*l*255]},L.ansi256.rgb=function(U){if(U>=232){const W=10*(U-232)+8;return[W,W,W]}let W;U-=16;return[Math.floor(U/36)/5*255,Math.floor((W=U%36)/6)/5*255,W%6/5*255]},L.rgb.hex=function(U){const W=(((255&Math.round(U[0]))<<16)+((255&Math.round(U[1]))<<8)+(255&Math.round(U[2]))).toString(16).toUpperCase();return"000000".substring(W.length)+W},L.hex.rgb=function(U){const W=U.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!W)return[0,0,0];let l=W[0];3===W[0].length&&(l=l.split("").map((U=>U+U)).join(""));const M=parseInt(l,16);return[M>>16&255,M>>8&255,255&M]},L.rgb.hcg=function(U){const W=U[0]/255,l=U[1]/255,M=U[2]/255,t=Math.max(Math.max(W,l),M),L=Math.min(Math.min(W,l),M),p=t-L;let B,k;return B=p<1?L/(1-p):0,k=p<=0?0:t===W?(l-M)/p%6:t===l?2+(M-W)/p:4+(W-l)/p,k/=6,k%=1,[360*k,100*p,100*B]},L.hsl.hcg=function(U){const W=U[1]/100,l=U[2]/100,M=l<.5?2*W*l:2*W*(1-l);let t=0;return M<1&&(t=(l-.5*M)/(1-M)),[U[0],100*M,100*t]},L.hsv.hcg=function(U){const W=U[1]/100,l=U[2]/100,M=W*l;let t=0;return M<1&&(t=(l-M)/(1-M)),[U[0],100*M,100*t]},L.hcg.rgb=function(U){const W=U[0]/360,l=U[1]/100,M=U[2]/100;if(0===l)return[255*M,255*M,255*M];const t=[0,0,0],L=W%1*6,p=L%1,B=1-p;let k=0;switch(Math.floor(L)){case 0:t[0]=1,t[1]=p,t[2]=0;break;case 1:t[0]=B,t[1]=1,t[2]=0;break;case 2:t[0]=0,t[1]=1,t[2]=p;break;case 3:t[0]=0,t[1]=B,t[2]=1;break;case 4:t[0]=p,t[1]=0,t[2]=1;break;default:t[0]=1,t[1]=0,t[2]=B}return k=(1-l)*M,[255*(l*t[0]+k),255*(l*t[1]+k),255*(l*t[2]+k)]},L.hcg.hsv=function(U){const W=U[1]/100,l=W+U[2]/100*(1-W);let M=0;return l>0&&(M=W/l),[U[0],100*M,100*l]},L.hcg.hsl=function(U){const W=U[1]/100,l=U[2]/100*(1-W)+.5*W;let M=0;return l>0&&l<.5?M=W/(2*l):l>=.5&&l<1&&(M=W/(2*(1-l))),[U[0],100*M,100*l]},L.hcg.hwb=function(U){const W=U[1]/100,l=W+U[2]/100*(1-W);return[U[0],100*(l-W),100*(1-l)]},L.hwb.hcg=function(U){const W=U[1]/100,l=1-U[2]/100,M=l-W;let t=0;return M<1&&(t=(l-M)/(1-M)),[U[0],100*M,100*t]},L.apple.rgb=function(U){return[U[0]/65535*255,U[1]/65535*255,U[2]/65535*255]},L.rgb.apple=function(U){return[U[0]/255*65535,U[1]/255*65535,U[2]/255*65535]},L.gray.rgb=function(U){return[U[0]/100*255,U[0]/100*255,U[0]/100*255]},L.gray.hsl=function(U){return[0,0,U[0]]},L.gray.hsv=L.gray.hsl,L.gray.hwb=function(U){return[0,100,U[0]]},L.gray.cmyk=function(U){return[0,0,0,U[0]]},L.gray.lab=function(U){return[U[0],0,0]},L.gray.hex=function(U){const W=255&Math.round(U[0]/100*255),l=((W<<16)+(W<<8)+W).toString(16).toUpperCase();return"000000".substring(l.length)+l},L.rgb.gray=function(U){return[(U[0]+U[1]+U[2])/3/255*100]}},12962:(U,W,l)=>{const M=l(12968),t=l(12982),L={};Object.keys(M).forEach((U=>{L[U]={},Object.defineProperty(L[U],"channels",{value:M[U].channels}),Object.defineProperty(L[U],"labels",{value:M[U].labels});const W=t(U);Object.keys(W).forEach((l=>{const M=W[l];L[U][l]=function(U){const W=function(){for(var W=arguments.length,l=new Array(W),M=0;M<W;M++)l[M]=arguments[M];const t=l[0];if(void 0===t||null===t)return t;t.length>1&&(l=t);const L=U(l);if("object"===typeof L)for(let U=L.length,p=0;p<U;p++)L[p]=Math.round(L[p]);return L};return"conversion"in U&&(W.conversion=U.conversion),W}(M),L[U][l].raw=function(U){const W=function(){for(var W=arguments.length,l=new Array(W),M=0;M<W;M++)l[M]=arguments[M];const t=l[0];return void 0===t||null===t?t:(t.length>1&&(l=t),U(l))};return"conversion"in U&&(W.conversion=U.conversion),W}(M)}))})),U.exports=L},12982:(U,W,l)=>{const M=l(12968);function t(U){const W=function(){const U={},W=Object.keys(M);for(let l=W.length,M=0;M<l;M++)U[W[M]]={distance:-1,parent:null};return U}(),l=[U];for(W[U].distance=0;l.length;){const U=l.pop(),t=Object.keys(M[U]);for(let M=t.length,L=0;L<M;L++){const M=t[L],p=W[M];-1===p.distance&&(p.distance=W[U].distance+1,p.parent=U,l.unshift(M))}}return W}function L(U,W){return function(l){return W(U(l))}}function p(U,W){const l=[W[U].parent,U];let t=M[W[U].parent][U],p=W[U].parent;for(;W[p].parent;)l.unshift(W[p].parent),t=L(M[W[p].parent][p],t),p=W[p].parent;return t.conversion=l,t}U.exports=function(U){const W=t(U),l={},M=Object.keys(W);for(let t=M.length,L=0;L<t;L++){const U=M[L];null!==W[U].parent&&(l[U]=p(U,W))}return l}},12973:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11996:function(U,W,l){"use strict";var M=this&&this.__createBinding||(Object.create?function(U,W,l,M){void 0===M&&(M=l);var t=Object.getOwnPropertyDescriptor(W,l);t&&!("get"in t?!W.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return W[l]}}),Object.defineProperty(U,M,t)}:function(U,W,l,M){void 0===M&&(M=l),U[M]=W[l]}),t=this&&this.__setModuleDefault||(Object.create?function(U,W){Object.defineProperty(U,"default",{enumerable:!0,value:W})}:function(U,W){U.default=W}),L=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var W={};if(null!=U)for(var l in U)"default"!==l&&Object.prototype.hasOwnProperty.call(U,l)&&M(W,U,l);return t(W,U),W},p=this&&this.__awaiter||function(U,W,l,M){return new(l||(l=Promise))((function(t,L){function p(U){try{k(M.next(U))}catch(W){L(W)}}function B(U){try{k(M.throw(U))}catch(W){L(W)}}function k(U){var W;U.done?t(U.value):(W=U.value,W instanceof l?W:new l((function(U){U(W)}))).then(p,B)}k((M=M.apply(U,W||[])).next())}))};Object.defineProperty(W,"__esModule",{value:!0}),W.Auth=W.Platform=void 0;const B=L(l(11933)),k=l(12e3),A="colyseus-auth-token";!function(U){U.ios="ios",U.android="android"}(W.Platform||(W.Platform={}));W.Auth=class{constructor(U){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=U.replace("ws","http"),(0,k.getItem)(A,(U=>this.token=U))}get hasToken(){return!!this.token}login(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p(this,void 0,void 0,(function*(){const W=Object.assign({},U);this.hasToken&&(W.token=this.token);const l=yield this.request("post","/auth",W);this.token=l.token,(0,k.setItem)(A,this.token);for(let U in l)this.hasOwnProperty(U)&&(this[U]=l[U]);return this.registerPingService(),this}))}save(){return p(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return p(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return p(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return p(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(U){return p(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:U})}))}acceptFriendRequest(U){return p(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:U})}))}declineFriendRequest(U){return p(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:U})}))}blockUser(U){return p(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:U})}))}unblockUser(U){return p(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:U})}))}request(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},M=arguments.length>3?arguments[3]:void 0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return p(this,void 0,void 0,(function*(){t.Accept="application/json",this.hasToken&&(t.Authorization="Bearer "+this.token);const L=[];for(const U in l)L.push(`${U}=${l[U]}`);const p=L.length>0?`?${L.join("&")}`:"",k={headers:t};return M&&(k.body=M),(yield B[U](`${this.endpoint}${W}${p}`,k)).data}))}logout(){this.token=void 0,(0,k.removeItem)(A),this.unregisterPingService()}registerPingService(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),U)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11930:function(U,W,l){"use strict";var M,t=this&&this.__awaiter||function(U,W,l,M){return new(l||(l=Promise))((function(t,L){function p(U){try{k(M.next(U))}catch(W){L(W)}}function B(U){try{k(M.throw(U))}catch(W){L(W)}}function k(U){var W;U.done?t(U.value):(W=U.value,W instanceof l?W:new l((function(U){U(W)}))).then(p,B)}k((M=M.apply(U,W||[])).next())}))};Object.defineProperty(W,"__esModule",{value:!0}),W.Client=W.MatchMakeError=void 0;const L=l(11933),p=l(11935),B=l(11937);class k extends Error{constructor(U,W){super(U),this.code=W,Object.setPrototypeOf(this,k.prototype)}}W.MatchMakeError=k;const A="undefined"!==typeof window&&"undefined"!==typeof(null===(M=null===window||void 0===window?void 0:window.location)||void 0===M?void 0:M.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";W.Client=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A;if("string"===typeof U){const W=new URL(U),l="https:"===W.protocol||"wss:"===W.protocol,M=Number(W.port||(l?443:80));this.settings={hostname:W.hostname,pathname:"/"!==W.pathname?W.pathname:"",port:M,secure:l}}else void 0===U.port&&(U.port=U.secure?443:80),void 0===U.pathname&&(U.pathname=""),this.settings=U}joinOrCreate(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",U,W,l)}))}create(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",U,W,l)}))}join(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",U,W,l)}))}joinById(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",U,W,l)}))}reconnect(U,W){return t(this,void 0,void 0,(function*(){if("string"===typeof U&&"string"===typeof W)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[l,M]=U.split(":");return yield this.createMatchMakeRequest("reconnect",l,{reconnectionToken:M},W)}))}getAvailableRooms(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t(this,void 0,void 0,(function*(){return(yield(0,L.get)(this.getHttpEndpoint(`${U}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(U,W,l){return t(this,void 0,void 0,(function*(){const M=this.createRoom(U.room.name,W);M.roomId=U.room.roomId,M.sessionId=U.sessionId;const L={sessionId:M.sessionId};U.reconnectionToken&&(L.reconnectionToken=U.reconnectionToken);const B=l||M;return M.connect(this.buildEndpoint(U.room,L),U.devMode&&(()=>t(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${M.roomId}'...`);let l=0;const L=()=>t(this,void 0,void 0,(function*(){l++;try{yield this.consumeSeatReservation(U,W,B),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${M.roomId}'`)}catch(t){l<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${l} out of 8)`),setTimeout(L,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(L,2e3)}))),B),new Promise(((U,W)=>{const l=(U,l)=>W(new p.ServerError(U,l));B.onError.once(l),B.onJoin.once((()=>{B.onError.remove(l),U(B)}))}))}))}createMatchMakeRequest(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},M=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;return t(this,void 0,void 0,(function*(){const t=(yield(0,L.post)(this.getHttpEndpoint(`${U}/${W}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(t.error)throw new k(t.error,t.code);return"reconnect"===U&&(t.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(t,M,p)}))}createRoom(U,W){return new B.Room(U,W)}buildEndpoint(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=[];for(const t in W)W.hasOwnProperty(t)&&l.push(`${t}=${W[t]}`);let M=this.settings.secure?"wss://":"ws://";return U.publicAddress?M+=`${U.publicAddress}`:M+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${M}/${U.processId}/${U.roomId}?${l.join("&")}`}getHttpEndpoint(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${U}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11952:(U,W,l)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Connection=void 0;const M=l(11957);W.Connection=class{constructor(){this.events={},this.transport=new M.WebSocketTransport(this.events)}send(U){this.transport.send(U)}connect(U){this.transport.connect(U)}close(U,W){this.transport.close(U,W)}get isOpen(){return this.transport.isOpen}}},11970:(U,W)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.utf8Length=W.utf8Read=W.ErrorCode=W.Protocol=void 0,function(U){U[U.HANDSHAKE=9]="HANDSHAKE",U[U.JOIN_ROOM=10]="JOIN_ROOM",U[U.ERROR=11]="ERROR",U[U.LEAVE_ROOM=12]="LEAVE_ROOM",U[U.ROOM_DATA=13]="ROOM_DATA",U[U.ROOM_STATE=14]="ROOM_STATE",U[U.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",U[U.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",U[U.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(W.Protocol||(W.Protocol={})),function(U){U[U.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",U[U.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",U[U.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",U[U.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",U[U.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",U[U.AUTH_FAILED=4215]="AUTH_FAILED",U[U.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(W.ErrorCode||(W.ErrorCode={})),W.utf8Read=function(U,W){const l=U[W++];for(var M="",t=0,L=W,p=W+l;L<p;L++){var B=U[L];if(0!==(128&B))if(192!==(224&B))if(224!==(240&B)){if(240!==(248&B))throw new Error("Invalid byte "+B.toString(16));(t=(7&B)<<18|(63&U[++L])<<12|(63&U[++L])<<6|63&U[++L])>=65536?(t-=65536,M+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):M+=String.fromCharCode(t)}else M+=String.fromCharCode((15&B)<<12|(63&U[++L])<<6|63&U[++L]);else M+=String.fromCharCode((31&B)<<6|63&U[++L]);else M+=String.fromCharCode(B)}return M},W.utf8Length=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",W=0,l=0;for(let M=0,t=U.length;M<t;M++)W=U.charCodeAt(M),W<128?l+=1:W<2048?l+=2:W<55296||W>=57344?l+=3:(M++,l+=4);return l+1}},11937:function(U,W,l){"use strict";var M=this&&this.__createBinding||(Object.create?function(U,W,l,M){void 0===M&&(M=l);var t=Object.getOwnPropertyDescriptor(W,l);t&&!("get"in t?!W.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return W[l]}}),Object.defineProperty(U,M,t)}:function(U,W,l,M){void 0===M&&(M=l),U[M]=W[l]}),t=this&&this.__setModuleDefault||(Object.create?function(U,W){Object.defineProperty(U,"default",{enumerable:!0,value:W})}:function(U,W){U.default=W}),L=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var W={};if(null!=U)for(var l in U)"default"!==l&&Object.prototype.hasOwnProperty.call(U,l)&&M(W,U,l);return t(W,U),W};Object.defineProperty(W,"__esModule",{value:!0}),W.Room=void 0;const p=L(l(11945)),B=l(11952),k=l(11970),A=l(11975),q=l(11978),y=l(11986),j=l(11988),s=l(11935);class w{constructor(U,W){this.onStateChange=(0,y.createSignal)(),this.onError=(0,y.createSignal)(),this.onLeave=(0,y.createSignal)(),this.onJoin=(0,y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,q.createNanoEvents)(),this.roomId=null,this.name=U,W&&(this.serializer=new((0,A.getSerializer)("schema")),this.rootSchema=W,this.serializer.state=new W),this.onError(((U,W)=>{var l;return null===(l=console.warn)||void 0===l?void 0:l.call(console,`colyseus.js - onError => (${U}) ${W}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const M=new B.Connection;l.connection=M,M.events.onmessage=w.prototype.onMessageCallback.bind(l),M.events.onclose=function(U){var M;if(!l.hasJoined)return null===(M=console.warn)||void 0===M||M.call(console,`Room connection was closed unexpectedly (${U.code}): ${U.reason}`),void l.onError.invoke(U.code,U.reason);U.code===s.CloseCode.DEVMODE_RESTART&&W?W():(l.onLeave.invoke(U.code),l.destroy())},M.events.onerror=function(U){var W;null===(W=console.warn)||void 0===W||W.call(console,`Room, onError (${U.code}): ${U.reason}`),l.onError.invoke(U.code,U.reason)},M.connect(U)}leave(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((W=>{this.onLeave((U=>W(U))),this.connection?U?this.connection.send([k.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(s.CloseCode.CONSENTED)}))}onMessage(U,W){return this.onMessageHandlers.on(this.getMessageHandlerKey(U),W)}send(U,W){const l=[k.Protocol.ROOM_DATA];let M;if("string"===typeof U?j.encode.string(l,U):j.encode.number(l,U),void 0!==W){const U=p.encode(W);M=new Uint8Array(l.length+U.byteLength),M.set(new Uint8Array(l),0),M.set(new Uint8Array(U),l.length)}else M=new Uint8Array(l);this.connection.send(M.buffer)}sendBytes(U,W){const l=[k.Protocol.ROOM_DATA_BYTES];let M;"string"===typeof U?j.encode.string(l,U):j.encode.number(l,U),M=new Uint8Array(l.length+(W.byteLength||W.length)),M.set(new Uint8Array(l),0),M.set(new Uint8Array(W),l.length),this.connection.send(M.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(U){const W=Array.from(new Uint8Array(U.data)),l=W[0];if(l===k.Protocol.JOIN_ROOM){let U=1;const l=(0,k.utf8Read)(W,U);if(U+=(0,k.utf8Length)(l),this.serializerId=(0,k.utf8Read)(W,U),U+=(0,k.utf8Length)(this.serializerId),!this.serializer){const U=(0,A.getSerializer)(this.serializerId);this.serializer=new U}W.length>U&&this.serializer.handshake&&this.serializer.handshake(W,{offset:U}),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([k.Protocol.JOIN_ROOM])}else if(l===k.Protocol.ERROR){const U={offset:1},l=j.decode.number(W,U),M=j.decode.string(W,U);this.onError.invoke(l,M)}else if(l===k.Protocol.LEAVE_ROOM)this.leave();else if(l===k.Protocol.ROOM_DATA_SCHEMA){const U={offset:1},l=this.serializer.getState().constructor._context.get(j.decode.number(W,U)),M=new l;M.decode(W,U),this.dispatchMessage(l,M)}else if(l===k.Protocol.ROOM_STATE)W.shift(),this.setState(W);else if(l===k.Protocol.ROOM_STATE_PATCH)W.shift(),this.patch(W);else if(l===k.Protocol.ROOM_DATA){const l={offset:1},M=j.decode.stringCheck(W,l)?j.decode.string(W,l):j.decode.number(W,l),t=W.length>l.offset?p.decode(U.data,l.offset):void 0;this.dispatchMessage(M,t)}else if(l===k.Protocol.ROOM_DATA_BYTES){const U={offset:1},l=j.decode.stringCheck(W,U)?j.decode.string(W,U):j.decode.number(W,U);this.dispatchMessage(l,new Uint8Array(W.slice(U.offset)))}}setState(U){this.serializer.setState(U),this.onStateChange.invoke(this.serializer.getState())}patch(U){this.serializer.patch(U),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(U,W){var l;const M=this.getMessageHandlerKey(U);this.onMessageHandlers.events[M]?this.onMessageHandlers.emit(M,W):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",U,W):null===(l=console.warn)||void 0===l||l.call(console,`colyseus.js: onMessage() not registered for type '${U}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(U){switch(typeof U){case"function":return`$${U._typeid}`;case"string":return U;case"number":return`i${U}`;default:throw new Error("invalid message type.")}}}W.Room=w},12e3:(U,W)=>{"use strict";let l;function M(){return l||(l="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(U,W){this.cache[U]=W},getItem:function(U){this.cache[U]},removeItem:function(U){delete this.cache[U]}}),l}Object.defineProperty(W,"__esModule",{value:!0}),W.getItem=W.removeItem=W.setItem=void 0,W.setItem=function(U,W){M().setItem(U,W)},W.removeItem=function(U){M().removeItem(U)},W.getItem=function(U,W){const l=M().getItem(U);"undefined"!==typeof Promise&&l instanceof Promise?l.then((U=>W(U))):W(l)}},11978:(U,W)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.createNanoEvents=void 0;W.createNanoEvents=()=>({emit(U){let W=this.events[U]||[];for(var l=arguments.length,M=new Array(l>1?l-1:0),t=1;t<l;t++)M[t-1]=arguments[t];for(let L=0,p=W.length;L<p;L++)W[L](...M)},events:{},on(U,W){var l;return(null===(l=this.events[U])||void 0===l?void 0:l.push(W))||(this.events[U]=[W]),()=>{var l;this.events[U]=null===(l=this.events[U])||void 0===l?void 0:l.filter((U=>W!==U))}}})},11986:(U,W)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.createSignal=W.EventEmitter=void 0;class l{constructor(){this.handlers=[]}register(U){return this.handlers.push(U),this}invoke(){for(var U=arguments.length,W=new Array(U),l=0;l<U;l++)W[l]=arguments[l];this.handlers.forEach((U=>U.apply(this,W)))}invokeAsync(){for(var U=arguments.length,W=new Array(U),l=0;l<U;l++)W[l]=arguments[l];return Promise.all(this.handlers.map((U=>U.apply(this,W))))}remove(U){const W=this.handlers.indexOf(U);this.handlers[W]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}W.EventEmitter=l,W.createSignal=function(){const U=new l;function W(W){return U.register(W,null===this)}return W.once=W=>{const l=function(){for(var M=arguments.length,t=new Array(M),L=0;L<M;L++)t[L]=arguments[L];W.apply(this,t),U.remove(l)};U.register(l)},W.remove=W=>U.remove(W),W.invoke=function(){return U.invoke(...arguments)},W.invokeAsync=function(){return U.invokeAsync(...arguments)},W.clear=()=>U.clear(),W}},11935:(U,W)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.ServerError=W.CloseCode=void 0,function(U){U[U.CONSENTED=4e3]="CONSENTED",U[U.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(W.CloseCode||(W.CloseCode={}));class l extends Error{constructor(U,W){super(W),this.name="ServerError",this.code=U}}W.ServerError=l},11922:(U,W,l)=>{"use strict";W.d=void 0,l(11928);var M=l(11930);Object.defineProperty(W,"d",{enumerable:!0,get:function(){return M.Client}});var t=l(11970);var L=l(11937);var p=l(11996);const B=l(12004);const k=l(12010),A=l(11975);(0,A.registerSerializer)("schema",B.SchemaSerializer),(0,A.registerSerializer)("none",k.NoneSerializer)},11928:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=U=>null!==U&&"object"===typeof U&&U.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11945:(U,W)=>{"use strict";function l(U,W){if(this._offset=W,U instanceof ArrayBuffer)this._buffer=U,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(U))throw new Error("Invalid argument");this._buffer=U.buffer,this._view=new DataView(this._buffer,U.byteOffset,U.byteLength)}}Object.defineProperty(W,"__esModule",{value:!0}),W.decode=W.encode=void 0,l.prototype._array=function(U){for(var W=new Array(U),l=0;l<U;l++)W[l]=this._parse();return W},l.prototype._map=function(U){for(var W={},l=0;l<U;l++)W[this._parse()]=this._parse();return W},l.prototype._str=function(U){var W=function(U,W,l){for(var M="",t=0,L=W,p=W+l;L<p;L++){var B=U.getUint8(L);if(0!==(128&B))if(192!==(224&B))if(224!==(240&B)){if(240!==(248&B))throw new Error("Invalid byte "+B.toString(16));(t=(7&B)<<18|(63&U.getUint8(++L))<<12|(63&U.getUint8(++L))<<6|63&U.getUint8(++L))>=65536?(t-=65536,M+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):M+=String.fromCharCode(t)}else M+=String.fromCharCode((15&B)<<12|(63&U.getUint8(++L))<<6|63&U.getUint8(++L));else M+=String.fromCharCode((31&B)<<6|63&U.getUint8(++L));else M+=String.fromCharCode(B)}return M}(this._view,this._offset,U);return this._offset+=U,W},l.prototype._bin=function(U){var W=this._buffer.slice(this._offset,this._offset+U);return this._offset+=U,W},l.prototype._parse=function(){var U,W=this._view.getUint8(this._offset++),l=0,M=0,t=0,L=0;if(W<192)return W<128?W:W<144?this._map(15&W):W<160?this._array(15&W):this._str(31&W);if(W>223)return-1*(255-W+1);switch(W){case 192:return null;case 194:return!1;case 195:return!0;case 196:return l=this._view.getUint8(this._offset),this._offset+=1,this._bin(l);case 197:return l=this._view.getUint16(this._offset),this._offset+=2,this._bin(l);case 198:return l=this._view.getUint32(this._offset),this._offset+=4,this._bin(l);case 199:if(l=this._view.getUint8(this._offset),M=this._view.getInt8(this._offset+1),this._offset+=2,-1===M){var p=this._view.getUint32(this._offset);return t=this._view.getInt32(this._offset+4),L=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*t+L)+p/1e6)}return[M,this._bin(l)];case 200:return l=this._view.getUint16(this._offset),M=this._view.getInt8(this._offset+2),this._offset+=3,[M,this._bin(l)];case 201:return l=this._view.getUint32(this._offset),M=this._view.getInt8(this._offset+4),this._offset+=5,[M,this._bin(l)];case 202:return U=this._view.getFloat32(this._offset),this._offset+=4,U;case 203:return U=this._view.getFloat64(this._offset),this._offset+=8,U;case 204:return U=this._view.getUint8(this._offset),this._offset+=1,U;case 205:return U=this._view.getUint16(this._offset),this._offset+=2,U;case 206:return U=this._view.getUint32(this._offset),this._offset+=4,U;case 207:return t=this._view.getUint32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,t+L;case 208:return U=this._view.getInt8(this._offset),this._offset+=1,U;case 209:return U=this._view.getInt16(this._offset),this._offset+=2,U;case 210:return U=this._view.getInt32(this._offset),this._offset+=4,U;case 211:return t=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,t+L;case 212:return M=this._view.getInt8(this._offset),this._offset+=1,0===M?void(this._offset+=1):[M,this._bin(1)];case 213:return M=this._view.getInt8(this._offset),this._offset+=1,[M,this._bin(2)];case 214:return M=this._view.getInt8(this._offset),this._offset+=1,-1===M?(U=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*U)):[M,this._bin(4)];case 215:return M=this._view.getInt8(this._offset),this._offset+=1,0===M?(t=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(t+L)):-1===M?(t=this._view.getUint32(this._offset),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&t)+L)+(t>>>2)/1e6)):[M,this._bin(8)];case 216:return M=this._view.getInt8(this._offset),this._offset+=1,[M,this._bin(16)];case 217:return l=this._view.getUint8(this._offset),this._offset+=1,this._str(l);case 218:return l=this._view.getUint16(this._offset),this._offset+=2,this._str(l);case 219:return l=this._view.getUint32(this._offset),this._offset+=4,this._str(l);case 220:return l=this._view.getUint16(this._offset),this._offset+=2,this._array(l);case 221:return l=this._view.getUint32(this._offset),this._offset+=4,this._array(l);case 222:return l=this._view.getUint16(this._offset),this._offset+=2,this._map(l);case 223:return l=this._view.getUint32(this._offset),this._offset+=4,this._map(l)}throw new Error("Could not parse")},W.decode=function(U){var W=new l(U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),M=W._parse();if(W._offset!==U.byteLength)throw new Error(U.byteLength-W._offset+" trailing bytes");return M};function M(U,W,l){for(var M=0,t=0,L=l.length;t<L;t++)(M=l.charCodeAt(t))<128?U.setUint8(W++,M):M<2048?(U.setUint8(W++,192|M>>6),U.setUint8(W++,128|63&M)):M<55296||M>=57344?(U.setUint8(W++,224|M>>12),U.setUint8(W++,128|M>>6&63),U.setUint8(W++,128|63&M)):(t++,M=65536+((1023&M)<<10|1023&l.charCodeAt(t)),U.setUint8(W++,240|M>>18),U.setUint8(W++,128|M>>12&63),U.setUint8(W++,128|M>>6&63),U.setUint8(W++,128|63&M))}function t(U,W,l){var M=typeof l,L=0,p=0,B=0,k=0,A=0,q=0;if("string"===M){if(A=function(U){for(var W=0,l=0,M=0,t=U.length;M<t;M++)(W=U.charCodeAt(M))<128?l+=1:W<2048?l+=2:W<55296||W>=57344?l+=3:(M++,l+=4);return l}(l),A<32)U.push(160|A),q=1;else if(A<256)U.push(217,A),q=2;else if(A<65536)U.push(218,A>>8,A),q=3;else{if(!(A<4294967296))throw new Error("String too long");U.push(219,A>>24,A>>16,A>>8,A),q=5}return W.push({_str:l,_length:A,_offset:U.length}),q+A}if("number"===M)return Math.floor(l)===l&&isFinite(l)?l>=0?l<128?(U.push(l),1):l<256?(U.push(204,l),2):l<65536?(U.push(205,l>>8,l),3):l<4294967296?(U.push(206,l>>24,l>>16,l>>8,l),5):(B=l/Math.pow(2,32)|0,k=l>>>0,U.push(207,B>>24,B>>16,B>>8,B,k>>24,k>>16,k>>8,k),9):l>=-32?(U.push(l),1):l>=-128?(U.push(208,l),2):l>=-32768?(U.push(209,l>>8,l),3):l>=-2147483648?(U.push(210,l>>24,l>>16,l>>8,l),5):(B=Math.floor(l/Math.pow(2,32)),k=l>>>0,U.push(211,B>>24,B>>16,B>>8,B,k>>24,k>>16,k>>8,k),9):(U.push(203),W.push({_float:l,_length:8,_offset:U.length}),9);if("object"===M){if(null===l)return U.push(192),1;if(Array.isArray(l)){if((A=l.length)<16)U.push(144|A),q=1;else if(A<65536)U.push(220,A>>8,A),q=3;else{if(!(A<4294967296))throw new Error("Array too large");U.push(221,A>>24,A>>16,A>>8,A),q=5}for(L=0;L<A;L++)q+=t(U,W,l[L]);return q}if(l instanceof Date){var y=l.getTime(),j=Math.floor(y/1e3),s=1e6*(y-1e3*j);return j>=0&&s>=0&&j<=17179869183?0===s&&j<=4294967295?(U.push(214,255,j>>24,j>>16,j>>8,j),6):(B=j/4294967296,k=4294967295&j,U.push(215,255,s>>22,s>>14,s>>6,B,k>>24,k>>16,k>>8,k),10):(B=Math.floor(j/4294967296),k=j>>>0,U.push(199,12,255,s>>24,s>>16,s>>8,s,B>>24,B>>16,B>>8,B,k>>24,k>>16,k>>8,k),15)}if(l instanceof ArrayBuffer){if((A=l.byteLength)<256)U.push(196,A),q=2;else if(A<65536)U.push(197,A>>8,A),q=3;else{if(!(A<4294967296))throw new Error("Buffer too large");U.push(198,A>>24,A>>16,A>>8,A),q=5}return W.push({_bin:l,_length:A,_offset:U.length}),q+A}if("function"===typeof l.toJSON)return t(U,W,l.toJSON());var w=[],K="",r=Object.keys(l);for(L=0,p=r.length;L<p;L++)void 0!==l[K=r[L]]&&"function"!==typeof l[K]&&w.push(K);if((A=w.length)<16)U.push(128|A),q=1;else if(A<65536)U.push(222,A>>8,A),q=3;else{if(!(A<4294967296))throw new Error("Object too large");U.push(223,A>>24,A>>16,A>>8,A),q=5}for(L=0;L<A;L++)q+=t(U,W,K=w[L]),q+=t(U,W,l[K]);return q}if("boolean"===M)return U.push(l?195:194),1;if("undefined"===M)return U.push(192),1;if("function"===typeof l.toJSON)return t(U,W,l.toJSON());throw new Error("Could not encode")}W.encode=function(U){var W=[],l=[],L=t(W,l,U),p=new ArrayBuffer(L),B=new DataView(p),k=0,A=0,q=-1;l.length>0&&(q=l[0]._offset);for(var y,j=0,s=0,w=0,K=W.length;w<K;w++)if(B.setUint8(A+w,W[w]),w+1===q){if(j=(y=l[k])._length,s=A+q,y._bin)for(var r=new Uint8Array(y._bin),m=0;m<j;m++)B.setUint8(s+m,r[m]);else y._str?M(B,s,y._str):void 0!==y._float&&B.setFloat64(s,y._float);A+=j,l[++k]&&(q=l[k]._offset)}return p}},12010:(U,W)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.NoneSerializer=void 0;W.NoneSerializer=class{setState(U){}getState(){return null}patch(U){}teardown(){}handshake(U){}}},12004:(U,W,l)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.SchemaSerializer=void 0;const M=l(11988);W.SchemaSerializer=class{setState(U){return this.state.decode(U)}getState(){return this.state}patch(U){return this.state.decode(U)}teardown(){var U,W;null===(W=null===(U=this.state)||void 0===U?void 0:U.$changes)||void 0===W||W.root.clearRefs()}handshake(U,W){if(this.state){(new M.Reflection).decode(U,W)}else this.state=M.Reflection.decode(U,W)}}},11975:(U,W)=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.getSerializer=W.registerSerializer=void 0;const l={};W.registerSerializer=function(U,W){l[U]=W},W.getSerializer=function(U){const W=l[U];if(!W)throw new Error("missing serializer: "+U);return W}},11957:function(U,W,l){"use strict";var M=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(W,"__esModule",{value:!0}),W.WebSocketTransport=void 0;const t=M(l(11964)),L=globalThis.WebSocket||t.default;W.WebSocketTransport=class{constructor(U){this.events=U}send(U){U instanceof ArrayBuffer?this.ws.send(U):Array.isArray(U)&&this.ws.send(new Uint8Array(U).buffer)}connect(U){this.ws=new L(U,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(U,W){this.ws.close(U,W)}get isOpen(){return this.ws.readyState===L.OPEN}}},11964:U=>{"use strict";U.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13032:U=>{"use strict";U.exports=function(U,W,l,M,t,L){var p=+W[0],B=+W[1],k=+W[2],A=+l[0],q=+l[1],y=+l[2],j=Math.sqrt(A*A+q*q+y*y);if(0===j)throw new Error("Can't raycast along a zero vector");return function(U,W,l,M,t,L,p,B,k,A){for(var q=0,y=Math.floor,j=0|y(W),s=0|y(l),w=0|y(M),K=t>0?1:-1,r=L>0?1:-1,m=p>0?1:-1,f=Math.abs(1/t),g=Math.abs(1/L),E=Math.abs(1/p),Z=f<1/0?f*(K>0?j+1-W:W-j):1/0,N=g<1/0?g*(r>0?s+1-l:l-s):1/0,D=E<1/0?E*(m>0?w+1-M:M-w):1/0,o=-1;q<=B;){var i=U(j,s,w);if(i)return k&&(k[0]=W+q*t,k[1]=l+q*L,k[2]=M+q*p),A&&(A[0]=A[1]=A[2]=0,0===o&&(A[0]=-K),1===o&&(A[1]=-r),2===o&&(A[2]=-m)),i;Z<N?Z<D?(j+=K,q=Z,Z+=f,o=0):(w+=m,q=D,D+=E,o=2):N<D?(s+=r,q=N,N+=g,o=1):(w+=m,q=D,D+=E,o=2)}return k&&(k[0]=W+q*t,k[1]=l+q*L,k[2]=M+q*p),A&&(A[0]=A[1]=A[2]=0),0}(U,p,B,k,A/=j,q/=j,y/=j,M="undefined"===typeof M?64:+M,t,L)}},13067:(U,W,l)=>{"use strict";l.d(W,{e:()=>L});var M=l(79);function t(){this.Sl=!1,this.stopPropagation=!1,this.Tl=!1,this.disabled=!1}class L{constructor(U,W){this.version="0.7.0";var l=Object.assign({},new t,W||{});this.element=U||document,this.Sl=!!l.Sl,this.stopPropagation=!!l.stopPropagation,this.Tl=!!l.Tl,this.disabled=!!l.disabled,this.filterEvents=(U,W)=>!0,this.down=new M.EventEmitter,this.up=new M.EventEmitter,this.state={},this.Rg={dx:0,dy:0,zm:0,Hf:0,Am:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?B(this):document.addEventListener("DOMContentLoaded",(U=>{B(this)}),{once:!0})}bind(U){for(var W=arguments.length,l=new Array(W>1?W-1:0),M=1;M<W;M++)l[M-1]=arguments[M];l.forEach((W=>{var l=this._keyBindmap[W]||[];l.includes(U)||(l.push(U),this._keyBindmap[W]=l)})),this.state[U]=!!this.state[U],this.pressCount[U]=this.pressCount[U]||0,this.releaseCount[U]=this.releaseCount[U]||0}unbind(U){for(var W in this._keyBindmap){var l=this._keyBindmap[W],M=l.indexOf(U);M>-1&&l.splice(M,1)}}getBindings(){var U={};for(var W in this._keyBindmap){this._keyBindmap[W].forEach((l=>{U[l]=U[l]||[],U[l].push(W)}))}return U}Sj(){p(this.Rg),p(this.pressCount),p(this.releaseCount)}}function p(U){for(var W in U)U[W]=0}function B(U){window.addEventListener("keydown",w.bind(null,U,!0),!1),window.addEventListener("keyup",w.bind(null,U,!1),!1);var W={passive:!0};U.element.addEventListener("touchstart",y.bind(void 0,U),{passive:!1}),U.element.addEventListener("touchend",s.bind(void 0,U),W),U.element.addEventListener("mousedown",K.bind(null,U,!0),W),window.document.addEventListener("mouseup",K.bind(null,U,!1),W),U.element.addEventListener("touchmove",r.bind(null,U),W),U.element.addEventListener("mousemove",r.bind(null,U),W),window.PointerEvent,U.element.addEventListener("wheel",m.bind(null,U),W),U.element.addEventListener("contextmenu",f.bind(null,U),!1),window.addEventListener("blur",g.bind(null,U),!1)}var k=0,A=0,q=null;function y(U,W){W.preventDefault(),j(W)}function j(U){let W=!1;for(let l=0;l<U.touches.length;++l)if(U.touches[l].identifier===q){W=!0;break}if(!W){const W=U.changedTouches[0];k=W.clientX,A=W.clientY,q=W.identifier}}function s(U,W){for(var l=W.changedTouches,M=0;M<l.length;++M)l[M].identifier===q&&(q=null)}function w(U,W,l){E(l.code,W,U,l)}function K(U,W,l){if("pointerId"in l)if(W){if(null!==U._touches.currID)return;U._touches.currID=l.pointerId}else{if(U._touches.currID!==l.pointerId)return;U._touches.currID=null}return E("Mouse"+("button"in l?l.button+1:1),W,U,l),!1}function r(U,W){var l=W.movementX||W.mozMovementX||0,M=W.movementY||W.mozMovementY||0;if(W.touches&&0===(l|M)){var t=function(U){j(U);for(let W=0;W<U.changedTouches.length;++W)if(U.changedTouches[W].identifier==q){const l=U.changedTouches[W],M=[l.clientX-k,l.clientY-A];return k=l.clientX,A=l.clientY,M}return console.error(`Did not find touch id ${q}`),[0,0]}(W);l=t[0],M=t[1]}U.Rg.dx+=l,U.Rg.dy+=M}function m(U,W){var l=1;switch(W.deltaMode){case 0:l=1;break;case 1:l=12;break;case 2:l=U.element.clientHeight||window.innerHeight}U.Rg.zm+=(W.deltaX||0)*l,U.Rg.Hf+=(W.deltaY||0)*l,U.Rg.Am+=(W.deltaZ||0)*l}function f(U,W){if(!U.Tl)return W.preventDefault(),!1}function g(U){for(var W in U._keyStates)U._keyStates[W]&&(/^Mouse\d/.test(W)||E(W,!1,U,{code:W,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function E(U,W,l,M){var t=l._keyBindmap[U];t&&(Z(l._keyStates[U],W)&&(l._keyStates[U]=W,t.forEach((U=>{(!l.filterEvents||l.filterEvents(M,U))&&function(U,W,l,M){var t=W?l.pressCount:l.releaseCount;t[U]=(t[U]||0)+1;var L=l._bindPressCount[U]||0;(L+=W?1:-1)<0&&(L=0);l._bindPressCount[U]=L;var p=l.state[U];if(Z(p,L)){l.state[U]=L>0;var B=W?l.down:l.up;l.disabled||B.emit(U,M)}}(U,W,l,M)}))),"button"in M||(l.Sl&&!M.defaultPrevented&&M.preventDefault(),l.stopPropagation&&M.stopPropagation()))}function Z(U,W){return U?!W:W}},13039:(U,W,l)=>{"use strict";l.d(W,{c:()=>M});class M{constructor(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Zk=!1,this.$k=!1,this.nf=30,this.Yk=0,this.fl=!1,this.fullscreen=!1,this.al=function(U){},this.bl=function(){},this.dl=function(){},this.k=function(){},this.cl=function(U){},this.onFullscreenChanged=function(U){},A((()=>{!function(U,W){U._nowObject=performance||Date,U._lastTick=0,U._renderAccum=0,U._rt=0,U._frameCB=B.bind(null,U),requestAnimationFrame(U._frameCB),W>0&&(U._intervalCB=p.bind(null,U),U._interval=setInterval(U._intervalCB,Math.max(W,1e3/U.nf/2)))}(this,W),function(U,W){if(!W)return;var l=!1,M=!1;document.addEventListener("pointerlockchange",(M=>{l=document.pointerLockElement===W,U.cl(l)})),document.addEventListener("fullscreenchange",(l=>{M=document.fullscreenElement===W,U.onFullscreenChanged(M)})),Object.defineProperty(U,"fl",{get:()=>l,set:U=>{U&&!l?k(W):l&&!U&&function(U){U.exitPointerLock&&U.exitPointerLock()}(document)}}),Object.defineProperty(U,"fullscreen",{get:()=>M,set:U=>{U&&!M?W.requestFullscreen():M&&!U&&document.exitFullscreen()}}),W.addEventListener("click",(t=>{U.Zk&&!l&&k(W),U.$k&&!M&&W.requestFullscreen()}));var t=()=>U.k();if(window.ResizeObserver){new ResizeObserver(t).observe(W)}else window.addEventListener("resize",t)}(this,U),this.dl()}))}}var t=3,L=20;function p(U){for(var W=1e3/U.nf,l=U._nowObject.now()+L,M=0;U._nowObject.now()>=U._lastTick+W&&U._nowObject.now()<l&&++M<=t;)U.al(W),U._lastTick+=W;var p=5*(W+5),B=U._nowObject.now();if(B-U._lastTick>p)for(;B>=U._lastTick+W;)U._lastTick+=W}function B(U){requestAnimationFrame(U._frameCB),p(U);var W=U._nowObject.now(),l=W-U._rt;if(U._rt=W,U.Yk>0){U._renderAccum+=l;var M=1e3/U.Yk;if(U._renderAccum<M)return;U._renderAccum=Math.min(U._renderAccum-M,M)}var t=1e3/U.nf,L=(W-U._lastTick)/t;U.bl(l,L,t)}function k(U){U.requestPointerLock&&U.requestPointerLock()}var A=U=>{if("loading"===document.readyState){var W=()=>{document.removeEventListener("readystatechange",W),U()};document.addEventListener("readystatechange",W)}else setTimeout(U,1)}},12917:U=>{var W;self,W=()=>(()=>{"use strict";var U={d:(W,l)=>{for(var M in l)U.o(l,M)&&!U.o(W,M)&&Object.defineProperty(W,M,{enumerable:!0,get:l[M]})},o:(U,W)=>Object.prototype.hasOwnProperty.call(U,W)},W={};U.d(W,{default:()=>x});var l,M=function(U,W){var l=W.x-U.x,M=W.y-U.y;return Math.sqrt(l*l+M*M)},t=function(U){return U*(Math.PI/180)},L=new Map,p=function(U){L.has(U)&&clearTimeout(L.get(U)),L.set(U,setTimeout(U,100))},B=function(U,W,l){for(var M,t=W.split(/[ ,]+/g),L=0;L<t.length;L+=1)M=t[L],U.addEventListener?U.addEventListener(M,l,!1):U.attachEvent&&U.attachEvent(M,l)},k=function(U,W,l){for(var M,t=W.split(/[ ,]+/g),L=0;L<t.length;L+=1)M=t[L],U.removeEventListener?U.removeEventListener(M,l):U.detachEvent&&U.detachEvent(M,l)},A=function(U){return U.preventDefault(),U.type.match(/^touch/)?U.changedTouches:U},q=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},y=function(U,W){W.top||W.right||W.bottom||W.left?(U.style.top=W.top,U.style.right=W.right,U.style.bottom=W.bottom,U.style.left=W.left):(U.style.left=W.x+"px",U.style.top=W.y+"px")},j=function(U,W,l){var M=s(U);for(var t in M)if(M.hasOwnProperty(t))if("string"==typeof W)M[t]=W+" "+l;else{for(var L="",p=0,B=W.length;p<B;p+=1)L+=W[p]+" "+l+", ";M[t]=L.slice(0,-2)}return M},s=function(U){var W={};return W[U]="",["webkit","Moz","o"].forEach((function(l){W[l+U.charAt(0).toUpperCase()+U.slice(1)]=""})),W},w=function(U,W){for(var l in W)W.hasOwnProperty(l)&&(U[l]=W[l]);return U},K=function(U,W){if(U.length)for(var l=0,M=U.length;l<M;l+=1)W(U[l]);else W(U)},r="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,m=window.matchMedia("(any-hover: none)").matches,f=!!("ontouchstart"in window),g=!!window.PointerEvent,E=!!window.MSPointerEvent,Z={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},N={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function o(){}r&&!m?l=Z:g?l={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?l={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:f?(l=Z,D=N):l=N,o.prototype.on=function(U,W){var l,M=this,t=U.split(/[ ,]+/g);M._handlers_=M._handlers_||{};for(var L=0;L<t.length;L+=1)l=t[L],M._handlers_[l]=M._handlers_[l]||[],M._handlers_[l].push(W);return M},o.prototype.off=function(U,W){var l=this;return l._handlers_=l._handlers_||{},void 0===U?l._handlers_={}:void 0===W?l._handlers_[U]=null:l._handlers_[U]&&l._handlers_[U].indexOf(W)>=0&&l._handlers_[U].splice(l._handlers_[U].indexOf(W),1),l},o.prototype.trigger=function(U,W){var l,M=this,t=U.split(/[ ,]+/g);M._handlers_=M._handlers_||{};for(var L=0;L<t.length;L+=1)l=t[L],M._handlers_[l]&&M._handlers_[l].length&&M._handlers_[l].forEach((function(U){U.call(M,{type:l,target:M},W)}))},o.prototype.config=function(U){var W=this;W.options=W.defaults||{},U&&(W.options=function(U,W){var l={};for(var M in U)U.hasOwnProperty(M)&&W.hasOwnProperty(M)?l[M]=W[M]:U.hasOwnProperty(M)&&(l[M]=U[M]);return l}(W.options,U))},o.prototype.bindEvt=function(U,W){var M=this;return M._domHandlers_=M._domHandlers_||{},M._domHandlers_[W]=function(){"function"==typeof M["on"+W]?M["on"+W].apply(M,arguments):console.warn('[WARNING] : Missing "on'+W+'" handler.')},B(U,l[W],M._domHandlers_[W]),D[W]&&B(U,D[W],M._domHandlers_[W]),M},o.prototype.unbindEvt=function(U,W){var M=this;return M._domHandlers_=M._domHandlers_||{},k(U,l[W],M._domHandlers_[W]),D[W]&&k(U,D[W],M._domHandlers_[W]),delete M._domHandlers_[W],this};const i=o;function O(U,W){return this.identifier=W.identifier,this.position=W.position,this.frontPosition=W.frontPosition,this.collection=U,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(W),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=O.id,O.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}O.prototype=new i,O.constructor=O,O.id=0,O.prototype.buildEl=function(U){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},O.prototype.stylize=function(){if(this.options.dataOnly)return this;var U=this.options.fadeTime+"ms",W=function(){var U=s("borderRadius");for(var W in U)U.hasOwnProperty(W)&&(U[W]="50%");return U}(),l=j("transition","opacity",U),M={};return M.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},M.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},M.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},w(M.el,l),"circle"===this.options.shape&&w(M.back,W),w(M.front,W),this.applyStyles(M),this},O.prototype.applyStyles=function(U){for(var W in this.ui)if(this.ui.hasOwnProperty(W))for(var l in U[W])this.ui[W].style[l]=U[W][l];return this},O.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},O.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},O.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},O.prototype.show=function(U){var W=this;return W.options.dataOnly||(clearTimeout(W.removeTimeout),clearTimeout(W.showTimeout),clearTimeout(W.restTimeout),W.addToDom(),W.restCallback(),setTimeout((function(){W.ui.el.style.opacity=1}),0),W.showTimeout=setTimeout((function(){W.trigger("shown",W.instance),"function"==typeof U&&U.call(this)}),W.options.fadeTime)),W},O.prototype.hide=function(U){var W=this;if(W.options.dataOnly)return W;if(W.ui.el.style.opacity=W.options.restOpacity,clearTimeout(W.removeTimeout),clearTimeout(W.showTimeout),clearTimeout(W.restTimeout),W.removeTimeout=setTimeout((function(){var l="dynamic"===W.options.mode?"none":"block";W.ui.el.style.display=l,"function"==typeof U&&U.call(W),W.trigger("hidden",W.instance)}),W.options.fadeTime),W.options.restJoystick){var l=W.options.restJoystick,M={};M.x=!0===l||!1!==l.x?0:W.instance.frontPosition.x,M.y=!0===l||!1!==l.y?0:W.instance.frontPosition.y,W.setPosition(U,M)}return W},O.prototype.setPosition=function(U,W){var l=this;l.frontPosition={x:W.x,y:W.y};var M=l.options.fadeTime+"ms",t={};t.front=j("transition",["transform"],M);var L={front:{}};L.front={transform:"translate("+l.frontPosition.x+"px,"+l.frontPosition.y+"px)"},l.applyStyles(t),l.applyStyles(L),l.restTimeout=setTimeout((function(){"function"==typeof U&&U.call(l),l.restCallback()}),l.options.fadeTime)},O.prototype.restCallback=function(){var U=this,W={};W.front=j("transition","none",""),U.applyStyles(W),U.trigger("rested",U.instance)},O.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},O.prototype.computeDirection=function(U){var W,l,M,t=U.angle.radian,L=Math.PI/4,p=Math.PI/2;if(t>L&&t<3*L&&!U.lockX?W="up":t>-L&&t<=L&&!U.lockY?W="left":t>3*-L&&t<=-L&&!U.lockX?W="down":U.lockY||(W="right"),U.lockY||(l=t>-p&&t<p?"left":"right"),U.lockX||(M=t>0?"up":"down"),U.force>this.options.threshold){var B,k={};for(B in this.direction)this.direction.hasOwnProperty(B)&&(k[B]=this.direction[B]);var A={};for(B in this.direction={x:l,y:M,angle:W},U.direction=this.direction,k)k[B]===this.direction[B]&&(A[B]=!0);if(A.x&&A.y&&A.angle)return U;A.x&&A.y||this.trigger("plain",U),A.x||this.trigger("plain:"+l,U),A.y||this.trigger("plain:"+M,U),A.angle||this.trigger("dir dir:"+W,U)}else this.resetDirection();return U};const e=O;function d(U,W){var l=this;l.nipples=[],l.idles=[],l.actives=[],l.ids=[],l.pressureIntervals={},l.manager=U,l.id=d.id,d.id+=1,l.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},l.config(W),"static"!==l.options.mode&&"semi"!==l.options.mode||(l.options.multitouch=!1),l.options.multitouch||(l.options.maxNumberOfNipples=1);var M=getComputedStyle(l.options.zone.parentElement);return M&&"flex"===M.display&&(l.parentIsFlex=!0),l.updateBox(),l.prepareNipples(),l.Ul(),l.begin(),l.nipples}d.prototype=new i,d.constructor=d,d.id=0,d.prototype.prepareNipples=function(){var U=this,W=U.nipples;W.on=U.on.bind(U),W.off=U.off.bind(U),W.options=U.options,W.destroy=U.destroy.bind(U),W.ids=U.ids,W.id=U.id,W.processOnMove=U.processOnMove.bind(U),W.processOnEnd=U.processOnEnd.bind(U),W.get=function(U){if(void 0===U)return W[0];for(var l=0,M=W.length;l<M;l+=1)if(W[l].identifier===U)return W[l];return!1}},d.prototype.Ul=function(){var U=this;U.bindEvt(U.options.zone,"start"),U.options.zone.style.touchAction="none",U.options.zone.style.msTouchAction="none"},d.prototype.begin=function(){var U=this,W=U.options;if("static"===W.mode){var l=U.createNipple(W.position,U.manager.getIdentifier());l.add(),U.idles.push(l)}},d.prototype.createNipple=function(U,W){var l=this,M=l.manager.scroll,t={},L=l.options,p=l.parentIsFlex?M.x:M.x+l.box.left,B=l.parentIsFlex?M.y:M.y+l.box.top;if(U.x&&U.y)t={x:U.x-p,y:U.y-B};else if(U.top||U.right||U.bottom||U.left){var k=document.createElement("DIV");k.style.display="hidden",k.style.top=U.top,k.style.right=U.right,k.style.bottom=U.bottom,k.style.left=U.left,k.style.position="absolute",L.zone.appendChild(k);var A=k.getBoundingClientRect();L.zone.removeChild(k),t=U,U={x:A.left+M.x,y:A.top+M.y}}var q=new e(l,{color:L.color,size:L.size,threshold:L.threshold,fadeTime:L.fadeTime,dataOnly:L.dataOnly,restJoystick:L.restJoystick,restOpacity:L.restOpacity,mode:L.mode,identifier:W,position:U,zone:L.zone,frontPosition:{x:0,y:0},shape:L.shape});return L.dataOnly||(y(q.ui.el,t),y(q.ui.front,q.frontPosition)),l.nipples.push(q),l.trigger("added "+q.identifier+":added",q),l.manager.trigger("added "+q.identifier+":added",q),l.bindNipple(q),q},d.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},d.prototype.bindNipple=function(U){var W,l=this,M=function(U,M){W=U.type+" "+M.id+":"+U.type,l.trigger(W,M)};U.on("destroyed",l.onDestroyed.bind(l)),U.on("shown hidden rested dir plain",M),U.on("dir:up dir:right dir:down dir:left",M),U.on("plain:up plain:right plain:down plain:left",M)},d.prototype.pressureFn=function(U,W,l){var M=this,t=0;clearInterval(M.pressureIntervals[l]),M.pressureIntervals[l]=setInterval(function(){var l=U.force||U.pressure||U.webkitForce||0;l!==t&&(W.trigger("pressure",l),M.trigger("pressure "+W.identifier+":pressure",l),t=l)}.bind(M),100)},d.prototype.onstart=function(U){var W=this,l=W.options,M=U;return U=A(U),W.updateBox(),K(U,(function(t){W.actives.length<l.maxNumberOfNipples?W.processOnStart(t):M.type.match(/^touch/)&&(Object.keys(W.manager.ids).forEach((function(l){if(Object.values(M.touches).findIndex((function(U){return U.identifier===l}))<0){var t=[U[0]];t.identifier=l,W.processOnEnd(t)}})),W.actives.length<l.maxNumberOfNipples&&W.processOnStart(t))})),W.manager.bindDocument(),!1},d.prototype.processOnStart=function(U){var W,l=this,t=l.options,L=l.manager.getIdentifier(U),p=U.force||U.pressure||U.webkitForce||0,B={x:U.pageX,y:U.pageY},k=l.getOrCreate(L,B);k.identifier!==L&&l.manager.removeIdentifier(k.identifier),k.identifier=L;var A=function(W){W.trigger("start",W),l.trigger("start "+W.id+":start",W),W.show(),p>0&&l.pressureFn(U,W,W.identifier),l.processOnMove(U)};if((W=l.idles.indexOf(k))>=0&&l.idles.splice(W,1),l.actives.push(k),l.ids.push(k.identifier),"semi"!==t.mode)A(k);else{if(!(M(B,k.position)<=t.catchDistance))return k.destroy(),void l.processOnStart(U);A(k)}return k},d.prototype.getOrCreate=function(U,W){var l,M=this,t=M.options;return/(semi|static)/.test(t.mode)?(l=M.idles[0])?(M.idles.splice(0,1),l):"semi"===t.mode?M.createNipple(W,U):(console.warn("Coudln't find the needed nipple."),!1):l=M.createNipple(W,U)},d.prototype.processOnMove=function(U){var W=this,l=W.options,L=W.manager.getIdentifier(U),p=W.nipples.get(L),B=W.manager.scroll;if(function(U){return isNaN(U.buttons)?0!==U.pressure:0!==U.buttons}(U)){if(!p)return console.error("Found zombie joystick with ID "+L),void W.manager.removeIdentifier(L);if(l.dynamicPage){var k=p.el.getBoundingClientRect();p.position={x:B.x+k.left,y:B.y+k.top}}p.identifier=L;var A=p.options.size/2,q={x:U.pageX,y:U.pageY};l.lockX&&(q.y=p.position.y),l.lockY&&(q.x=p.position.x);var y,j,s,w,K,r,m,f,g,E,Z=M(q,p.position),N=(y=q,s=(j=p.position).x-y.x,w=j.y-y.y,function(U){return U*(180/Math.PI)}(Math.atan2(w,s))),D=t(N),o=Z/A,i={distance:Z,position:q};if("circle"===p.options.shape?(K=Math.min(Z,A),m=p.position,f=K,E={x:0,y:0},g=t(g=N),E.x=m.x-f*Math.cos(g),E.y=m.y-f*Math.sin(g),r=E):(r=function(U,W,l){return{x:Math.min(Math.max(U.x,W.x-l),W.x+l),y:Math.min(Math.max(U.y,W.y-l),W.y+l)}}(q,p.position,A),K=M(r,p.position)),l.follow){if(Z>A){var O=q.x-r.x,e=q.y-r.y;p.position.x+=O,p.position.y+=e,p.el.style.top=p.position.y-(W.box.top+B.y)+"px",p.el.style.left=p.position.x-(W.box.left+B.x)+"px",Z=M(q,p.position)}}else q=r,Z=K;var d=q.x-p.position.x,H=q.y-p.position.y;p.frontPosition={x:d,y:H},l.dataOnly||(p.ui.front.style.transform="translate("+d+"px,"+H+"px)");var V={identifier:p.identifier,position:q,force:o,pressure:U.force||U.pressure||U.webkitForce||0,distance:Z,angle:{radian:D,degree:N},vector:{x:d/A,y:-H/A},raw:i,instance:p,lockX:l.lockX,lockY:l.lockY};(V=p.computeDirection(V)).angle={radian:t(180-N),degree:180-N},p.trigger("move",V),W.trigger("move "+p.id+":move",V)}else this.processOnEnd(U)},d.prototype.processOnEnd=function(U){var W=this,l=W.options,M=W.manager.getIdentifier(U),t=W.nipples.get(M),L=W.manager.removeIdentifier(t.identifier);t&&(l.dataOnly||t.hide((function(){"dynamic"===l.mode&&(t.trigger("removed",t),W.trigger("removed "+t.id+":removed",t),W.manager.trigger("removed "+t.id+":removed",t),t.destroy())})),clearInterval(W.pressureIntervals[t.identifier]),t.resetDirection(),t.trigger("end",t),W.trigger("end "+t.id+":end",t),W.ids.indexOf(t.identifier)>=0&&W.ids.splice(W.ids.indexOf(t.identifier),1),W.actives.indexOf(t)>=0&&W.actives.splice(W.actives.indexOf(t),1),/(semi|static)/.test(l.mode)?W.idles.push(t):W.nipples.indexOf(t)>=0&&W.nipples.splice(W.nipples.indexOf(t),1),W.manager.unbindDocument(),/(semi|static)/.test(l.mode)&&(W.manager.ids[L.id]=L.identifier))},d.prototype.onDestroyed=function(U,W){var l=this;l.nipples.indexOf(W)>=0&&l.nipples.splice(l.nipples.indexOf(W),1),l.actives.indexOf(W)>=0&&l.actives.splice(l.actives.indexOf(W),1),l.idles.indexOf(W)>=0&&l.idles.splice(l.idles.indexOf(W),1),l.ids.indexOf(W.identifier)>=0&&l.ids.splice(l.ids.indexOf(W.identifier),1),l.manager.removeIdentifier(W.identifier),l.manager.unbindDocument()},d.prototype.destroy=function(){var U=this;for(var W in U.unbindEvt(U.options.zone,"start"),U.nipples.forEach((function(U){U.destroy()})),U.pressureIntervals)U.pressureIntervals.hasOwnProperty(W)&&clearInterval(U.pressureIntervals[W]);U.trigger("destroyed",U.nipples),U.manager.unbindDocument(),U.off()};const H=d;function V(U){var W=this;W.ids={},W.index=0,W.collections=[],W.scroll=q(),W.config(U),W.prepareCollections();var l=function(){var U;W.collections.forEach((function(l){l.forEach((function(l){U=l.el.getBoundingClientRect(),l.position={x:W.scroll.x+U.left,y:W.scroll.y+U.top}}))}))};B(window,"resize",(function(){p(l)}));var M=function(){W.scroll=q()};return B(window,"scroll",(function(){p(M)})),W.collections}V.prototype=new i,V.constructor=V,V.prototype.prepareCollections=function(){var U=this;U.collections.create=U.create.bind(U),U.collections.on=U.on.bind(U),U.collections.off=U.off.bind(U),U.collections.destroy=U.destroy.bind(U),U.collections.get=function(W){var l;return U.collections.every((function(U){return!(l=U.get(W))})),l}},V.prototype.create=function(U){return this.createCollection(U)},V.prototype.createCollection=function(U){var W=this,l=new H(W,U);return W.bindCollection(l),W.collections.push(l),l},V.prototype.bindCollection=function(U){var W,l=this,M=function(U,M){W=U.type+" "+M.id+":"+U.type,l.trigger(W,M)};U.on("destroyed",l.onDestroyed.bind(l)),U.on("shown hidden rested dir plain",M),U.on("dir:up dir:right dir:down dir:left",M),U.on("plain:up plain:right plain:down plain:left",M)},V.prototype.bindDocument=function(){var U=this;U.binded||(U.bindEvt(document,"move").bindEvt(document,"end"),U.binded=!0)},V.prototype.unbindDocument=function(U){var W=this;Object.keys(W.ids).length&&!0!==U||(W.unbindEvt(document,"move").unbindEvt(document,"end"),W.binded=!1)},V.prototype.getIdentifier=function(U){var W;return U?void 0===(W=void 0===U.identifier?U.pointerId:U.identifier)&&(W=this.latest||0):W=this.index,void 0===this.ids[W]&&(this.ids[W]=this.index,this.index+=1),this.latest=W,this.ids[W]},V.prototype.removeIdentifier=function(U){var W={};for(var l in this.ids)if(this.ids[l]===U){W.id=l,W.identifier=this.ids[l],delete this.ids[l];break}return W},V.prototype.onmove=function(U){return this.onAny("move",U),!1},V.prototype.onend=function(U){return this.onAny("end",U),!1},V.prototype.oncancel=function(U){return this.onAny("end",U),!1},V.prototype.onAny=function(U,W){var l,M=this,t="processOn"+U.charAt(0).toUpperCase()+U.slice(1);W=A(W);var L=function(U,W,l){l.ids.indexOf(W)>=0&&(l[t](U),U._found_=!0)};return K(W,(function(U){l=M.getIdentifier(U),K(M.collections,L.bind(null,U,l)),U._found_||M.removeIdentifier(l)})),!1},V.prototype.destroy=function(){var U=this;U.unbindDocument(!0),U.ids={},U.index=0,U.collections.forEach((function(U){U.destroy()})),U.off()},V.prototype.onDestroyed=function(U,W){var l=this;if(l.collections.indexOf(W)<0)return!1;l.collections.splice(l.collections.indexOf(W),1)};var n=new V;const x={create:function(U){return n.create(U)},factory:n};return W.default})(),U.exports=W()},12118:(U,W,l)=>{"use strict";const{Deflate:M,deflate:t,deflateRaw:L,gzip:p}=l(12120),{Inflate:B,inflate:k,inflateRaw:A,ungzip:q}=l(12167),y=l(12141);U.exports.Deflate=M,U.exports.deflate=t,U.exports.deflateRaw=L,U.exports.gzip=p,U.exports.Inflate=B,U.exports.inflate=k,U.exports.inflateRaw=A,U.exports.ungzip=q,U.exports.constants=y},12120:(U,W,l)=>{"use strict";const M=l(12124),t=l(12147),L=l(12156),p=l(12139),B=l(12159),k=Object.prototype.toString,{Z_NO_FLUSH:A,Z_SYNC_FLUSH:q,Z_FULL_FLUSH:y,Z_FINISH:j,Z_OK:s,Z_STREAM_END:w,Z_DEFAULT_COMPRESSION:K,Z_DEFAULT_STRATEGY:r,Z_DEFLATED:m}=l(12141);function f(U){this.options=t.assign({level:K,method:m,Ja:16384,windowBits:15,memLevel:8,strategy:r},U||{});let W=this.options;W.raw&&W.windowBits>0?W.windowBits=-W.windowBits:W.gzip&&W.windowBits>0&&W.windowBits<16&&(W.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;let l=M.deflateInit2(this.strm,W.level,W.method,W.windowBits,W.memLevel,W.strategy);if(l!==s)throw new Error(p[l]);if(W.header&&M.deflateSetHeader(this.strm,W.header),W.dictionary){let U;if(U="string"===typeof W.dictionary?L.string2buf(W.dictionary):"[object ArrayBuffer]"===k.call(W.dictionary)?new Uint8Array(W.dictionary):W.dictionary,l=M.deflateSetDictionary(this.strm,U),l!==s)throw new Error(p[l]);this._dict_set=!0}}function g(U,W){const l=new f(W);if(l.push(U,!0),l.err)throw l.msg||p[l.err];return l.result}f.prototype.push=function(U,W){const l=this.strm,t=this.options.Ja;let p,B;if(this.ended)return!1;for(B=W===~~W?W:!0===W?j:A,"string"===typeof U?l.input=L.string2buf(U):"[object ArrayBuffer]"===k.call(U)?l.input=new Uint8Array(U):l.input=U,l.next_in=0,l.avail_in=l.input.length;;)if(0===l.avail_out&&(l.output=new Uint8Array(t),l.next_out=0,l.avail_out=t),(B===q||B===y)&&l.avail_out<=6)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else{if(p=M.deflate(l,B),p===w)return l.next_out>0&&this.onData(l.output.subarray(0,l.next_out)),p=M.deflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===s;if(0!==l.avail_out){if(B>0&&l.next_out>0)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else if(0===l.avail_in)break}else this.onData(l.output)}return!0},f.prototype.onData=function(U){this.chunks.push(U)},f.prototype.onEnd=function(U){U===s&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.msg=this.strm.msg},U.exports.Deflate=f,U.exports.deflate=g,U.exports.deflateRaw=function(U,W){return(W=W||{}).raw=!0,g(U,W)},U.exports.gzip=function(U,W){return(W=W||{}).gzip=!0,g(U,W)},U.exports.constants=l(12141)},12167:(U,W,l)=>{"use strict";const M=l(12174),t=l(12147),L=l(12156),p=l(12139),B=l(12159),k=l(12185),A=Object.prototype.toString,{Z_NO_FLUSH:q,Z_FINISH:y,Z_OK:j,Z_STREAM_END:s,Z_NEED_DICT:w,Z_STREAM_ERROR:K,Z_DATA_ERROR:r,Z_MEM_ERROR:m}=l(12141);function f(U){this.options=t.assign({Ja:65536,windowBits:15,to:""},U||{});const W=this.options;W.raw&&W.windowBits>=0&&W.windowBits<16&&(W.windowBits=-W.windowBits,0===W.windowBits&&(W.windowBits=-15)),!(W.windowBits>=0&&W.windowBits<16)||U&&U.windowBits||(W.windowBits+=32),W.windowBits>15&&W.windowBits<48&&0===(15&W.windowBits)&&(W.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;let l=M.inflateInit2(this.strm,W.windowBits);if(l!==j)throw new Error(p[l]);if(this.header=new k,M.inflateGetHeader(this.strm,this.header),W.dictionary&&("string"===typeof W.dictionary?W.dictionary=L.string2buf(W.dictionary):"[object ArrayBuffer]"===A.call(W.dictionary)&&(W.dictionary=new Uint8Array(W.dictionary)),W.raw&&(l=M.inflateSetDictionary(this.strm,W.dictionary),l!==j)))throw new Error(p[l])}function g(U,W){const l=new f(W);if(l.push(U),l.err)throw l.msg||p[l.err];return l.result}f.prototype.push=function(U,W){const l=this.strm,t=this.options.Ja,p=this.options.dictionary;let B,k,f;if(this.ended)return!1;for(k=W===~~W?W:!0===W?y:q,"[object ArrayBuffer]"===A.call(U)?l.input=new Uint8Array(U):l.input=U,l.next_in=0,l.avail_in=l.input.length;;){for(0===l.avail_out&&(l.output=new Uint8Array(t),l.next_out=0,l.avail_out=t),B=M.inflate(l,k),B===w&&p&&(B=M.inflateSetDictionary(l,p),B===j?B=M.inflate(l,k):B===r&&(B=w));l.avail_in>0&&B===s&&l.state.wrap>0&&0!==U[l.next_in];)M.inflateReset(l),B=M.inflate(l,k);switch(B){case K:case r:case w:case m:return this.onEnd(B),this.ended=!0,!1}if(f=l.avail_out,l.next_out&&(0===l.avail_out||B===s))if("string"===this.options.to){let U=L.utf8border(l.output,l.next_out),W=l.next_out-U,M=L.buf2string(l.output,U);l.next_out=W,l.avail_out=t-W,W&&l.output.set(l.output.subarray(U,U+W),0),this.onData(M)}else this.onData(l.output.length===l.next_out?l.output:l.output.subarray(0,l.next_out));if(B!==j||0!==f){if(B===s)return B=M.inflateEnd(this.strm),this.onEnd(B),this.ended=!0,!0;if(0===l.avail_in)break}}return!0},f.prototype.onData=function(U){this.chunks.push(U)},f.prototype.onEnd=function(U){U===j&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.msg=this.strm.msg},U.exports.Inflate=f,U.exports.inflate=g,U.exports.inflateRaw=function(U,W){return(W=W||{}).raw=!0,g(U,W)},U.exports.ungzip=g,U.exports.constants=l(12141)},12147:U=>{"use strict";const W=(U,W)=>Object.prototype.hasOwnProperty.call(U,W);U.exports.assign=function(U){const l=Array.prototype.slice.call(arguments,1);for(;l.length;){const M=l.shift();if(M){if("object"!==typeof M)throw new TypeError(M+"must be non-object");for(const l in M)W(M,l)&&(U[l]=M[l])}}return U},U.exports.flattenChunks=U=>{let W=0;for(let M=0,t=U.length;M<t;M++)W+=U[M].length;const l=new Uint8Array(W);for(let M=0,t=0,L=U.length;M<L;M++){let W=U[M];l.set(W,t),t+=W.length}return l}},12156:U=>{"use strict";let W=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(M){W=!1}const l=new Uint8Array(256);for(let t=0;t<256;t++)l[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;l[254]=l[254]=1,U.exports.string2buf=U=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(U);let W,l,M,t,L,p=U.length,B=0;for(t=0;t<p;t++)l=U.charCodeAt(t),55296===(64512&l)&&t+1<p&&(M=U.charCodeAt(t+1),56320===(64512&M)&&(l=65536+(l-55296<<10)+(M-56320),t++)),B+=l<128?1:l<2048?2:l<65536?3:4;for(W=new Uint8Array(B),L=0,t=0;L<B;t++)l=U.charCodeAt(t),55296===(64512&l)&&t+1<p&&(M=U.charCodeAt(t+1),56320===(64512&M)&&(l=65536+(l-55296<<10)+(M-56320),t++)),l<128?W[L++]=l:l<2048?(W[L++]=192|l>>>6,W[L++]=128|63&l):l<65536?(W[L++]=224|l>>>12,W[L++]=128|l>>>6&63,W[L++]=128|63&l):(W[L++]=240|l>>>18,W[L++]=128|l>>>12&63,W[L++]=128|l>>>6&63,W[L++]=128|63&l);return W};U.exports.buf2string=(U,M)=>{const t=M||U.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(U.subarray(0,M));let L,p;const B=new Array(2*t);for(p=0,L=0;L<t;){let W=U[L++];if(W<128){B[p++]=W;continue}let M=l[W];if(M>4)B[p++]=65533,L+=M-1;else{for(W&=2===M?31:3===M?15:7;M>1&&L<t;)W=W<<6|63&U[L++],M--;M>1?B[p++]=65533:W<65536?B[p++]=W:(W-=65536,B[p++]=55296|W>>10&1023,B[p++]=56320|1023&W)}}return((U,l)=>{if(l<65534&&U.subarray&&W)return String.fromCharCode.apply(null,U.length===l?U:U.subarray(0,l));let M="";for(let W=0;W<l;W++)M+=String.fromCharCode(U[W]);return M})(B,p)},U.exports.utf8border=(U,W)=>{(W=W||U.length)>U.length&&(W=U.length);let M=W-1;for(;M>=0&&128===(192&U[M]);)M--;return M<0||0===M?W:M+l[U[M]]>W?M:W}},12133:U=>{"use strict";U.exports=(U,W,l,M)=>{let t=65535&U,L=U>>>16&65535,p=0;for(;0!==l;){p=l>2e3?2e3:l,l-=p;do{t=t+W[M++]|0,L=L+t|0}while(--p);t%=65521,L%=65521}return t|L<<16}},12141:U=>{"use strict";U.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12137:U=>{"use strict";const W=new Uint32Array((()=>{let U,W=[];for(var l=0;l<256;l++){U=l;for(var M=0;M<8;M++)U=1&U?3988292384^U>>>1:U>>>1;W[l]=U}return W})());U.exports=(U,l,M,t)=>{const L=W,p=t+M;U^=-1;for(let W=t;W<p;W++)U=U>>>8^L[255&(U^l[W])];return~U}},12124:(U,W,l)=>{"use strict";const{_tr_init:M,_tr_stored_block:t,_tr_flush_block:L,_tr_tally:p,_tr_align:B}=l(12127),k=l(12133),A=l(12137),q=l(12139),{Z_NO_FLUSH:y,Z_PARTIAL_FLUSH:j,Z_FULL_FLUSH:s,Z_FINISH:w,Z_BLOCK:K,Z_OK:r,Z_STREAM_END:m,Z_STREAM_ERROR:f,Z_DATA_ERROR:g,Z_BUF_ERROR:E,Z_DEFAULT_COMPRESSION:Z,Z_FILTERED:N,Z_HUFFMAN_ONLY:D,Z_RLE:o,Z_FIXED:i,Z_DEFAULT_STRATEGY:O,Z_UNKNOWN:e,Z_DEFLATED:d}=l(12141),H=258,V=262,n=103,x=113,I=666,R=(U,W)=>(U.msg=q[W],W),F=U=>(U<<1)-(U>4?9:0),v=U=>{let W=U.length;for(;--W>=0;)U[W]=0};let J=(U,W,l)=>(W<<U.hash_shift^l)&U.hash_mask;const Q=U=>{const W=U.state;let l=W.pending;l>U.avail_out&&(l=U.avail_out),0!==l&&(U.output.set(W.pending_buf.subarray(W.pending_out,W.pending_out+l),U.next_out),U.next_out+=l,W.pending_out+=l,U.total_out+=l,U.avail_out-=l,W.pending-=l,0===W.pending&&(W.pending_out=0))},G=(U,W)=>{L(U,U.block_start>=0?U.block_start:-1,U.strstart-U.block_start,W),U.block_start=U.strstart,Q(U.strm)},u=(U,W)=>{U.pending_buf[U.pending++]=W},b=(U,W)=>{U.pending_buf[U.pending++]=W>>>8&255,U.pending_buf[U.pending++]=255&W},C=(U,W,l,M)=>{let t=U.avail_in;return t>M&&(t=M),0===t?0:(U.avail_in-=t,W.set(U.input.subarray(U.next_in,U.next_in+t),l),1===U.state.wrap?U.adler=k(U.adler,W,t,l):2===U.state.wrap&&(U.adler=A(U.adler,W,t,l)),U.next_in+=t,U.total_in+=t,t)},P=(U,W)=>{let l,M,t=U.max_chain_length,L=U.strstart,p=U.prev_length,B=U.nice_match;const k=U.strstart>U.w_size-V?U.strstart-(U.w_size-V):0,A=U.window,q=U.w_mask,y=U.prev,j=U.strstart+H;let s=A[L+p-1],w=A[L+p];U.prev_length>=U.good_match&&(t>>=2),B>U.lookahead&&(B=U.lookahead);do{if(l=W,A[l+p]===w&&A[l+p-1]===s&&A[l]===A[L]&&A[++l]===A[L+1]){L+=2,l++;do{}while(A[++L]===A[++l]&&A[++L]===A[++l]&&A[++L]===A[++l]&&A[++L]===A[++l]&&A[++L]===A[++l]&&A[++L]===A[++l]&&A[++L]===A[++l]&&A[++L]===A[++l]&&L<j);if(M=H-(j-L),L=j-H,M>p){if(U.match_start=W,p=M,M>=B)break;s=A[L+p-1],w=A[L+p]}}}while((W=y[W&q])>k&&0!==--t);return p<=U.lookahead?p:U.lookahead},S=U=>{const W=U.w_size;let l,M,t,L,p;do{if(L=U.window_size-U.lookahead-U.strstart,U.strstart>=W+(W-V)){U.window.set(U.window.subarray(W,W+W),0),U.match_start-=W,U.strstart-=W,U.block_start-=W,M=U.hash_size,l=M;do{t=U.head[--l],U.head[l]=t>=W?t-W:0}while(--M);M=W,l=M;do{t=U.prev[--l],U.prev[l]=t>=W?t-W:0}while(--M);L+=W}if(0===U.strm.avail_in)break;if(M=C(U.strm,U.window,U.strstart+U.lookahead,L),U.lookahead+=M,U.lookahead+U.insert>=3)for(p=U.strstart-U.insert,U.ins_h=U.window[p],U.ins_h=J(U,U.ins_h,U.window[p+1]);U.insert&&(U.ins_h=J(U,U.ins_h,U.window[p+3-1]),U.prev[p&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=p,p++,U.insert--,!(U.lookahead+U.insert<3)););}while(U.lookahead<V&&0!==U.strm.avail_in)},c=(U,W)=>{let l,M;for(;;){if(U.lookahead<V){if(S(U),U.lookahead<V&&W===y)return 1;if(0===U.lookahead)break}if(l=0,U.lookahead>=3&&(U.ins_h=J(U,U.ins_h,U.window[U.strstart+3-1]),l=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),0!==l&&U.strstart-l<=U.w_size-V&&(U.match_length=P(U,l)),U.match_length>=3)if(M=p(U,U.strstart-U.match_start,U.match_length-3),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=3){U.match_length--;do{U.strstart++,U.ins_h=J(U,U.ins_h,U.window[U.strstart+3-1]),l=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart}while(0!==--U.match_length);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=J(U,U.ins_h,U.window[U.strstart+1]);else M=p(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(M&&(G(U,!1),0===U.strm.avail_out))return 1}return U.insert=U.strstart<2?U.strstart:2,W===w?(G(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(G(U,!1),0===U.strm.avail_out)?1:2},h=(U,W)=>{let l,M,t;for(;;){if(U.lookahead<V){if(S(U),U.lookahead<V&&W===y)return 1;if(0===U.lookahead)break}if(l=0,U.lookahead>=3&&(U.ins_h=J(U,U.ins_h,U.window[U.strstart+3-1]),l=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=2,0!==l&&U.prev_length<U.max_lazy_match&&U.strstart-l<=U.w_size-V&&(U.match_length=P(U,l),U.match_length<=5&&(U.strategy===N||3===U.match_length&&U.strstart-U.match_start>4096)&&(U.match_length=2)),U.prev_length>=3&&U.match_length<=U.prev_length){t=U.strstart+U.lookahead-3,M=p(U,U.strstart-1-U.prev_match,U.prev_length-3),U.lookahead-=U.prev_length-1,U.prev_length-=2;do{++U.strstart<=t&&(U.ins_h=J(U,U.ins_h,U.window[U.strstart+3-1]),l=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart)}while(0!==--U.prev_length);if(U.match_available=0,U.match_length=2,U.strstart++,M&&(G(U,!1),0===U.strm.avail_out))return 1}else if(U.match_available){if(M=p(U,0,U.window[U.strstart-1]),M&&G(U,!1),U.strstart++,U.lookahead--,0===U.strm.avail_out)return 1}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(M=p(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<2?U.strstart:2,W===w?(G(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(G(U,!1),0===U.strm.avail_out)?1:2};function z(U,W,l,M,t){this.good_length=U,this.max_lazy=W,this.nice_length=l,this.max_chain=M,this.func=t}const a=[new z(0,0,0,0,((U,W)=>{let l=65535;for(l>U.pending_buf_size-5&&(l=U.pending_buf_size-5);;){if(U.lookahead<=1){if(S(U),0===U.lookahead&&W===y)return 1;if(0===U.lookahead)break}U.strstart+=U.lookahead,U.lookahead=0;const M=U.block_start+l;if((0===U.strstart||U.strstart>=M)&&(U.lookahead=U.strstart-M,U.strstart=M,G(U,!1),0===U.strm.avail_out))return 1;if(U.strstart-U.block_start>=U.w_size-V&&(G(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,W===w?(G(U,!0),0===U.strm.avail_out?3:4):(U.strstart>U.block_start&&(G(U,!1),U.strm.avail_out),1)})),new z(4,4,8,4,c),new z(4,5,16,8,c),new z(4,6,32,32,c),new z(4,4,16,16,h),new z(8,16,32,32,h),new z(8,16,128,128,h),new z(8,32,128,256,h),new z(32,128,258,1024,h),new z(32,258,258,4096,h)];function Y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),v(this.dyn_ltree),v(this.dyn_dtree),v(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),v(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),v(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const X=U=>{if(!U||!U.state)return R(U,f);U.total_in=U.total_out=0,U.data_type=e;const W=U.state;return W.pending=0,W.pending_out=0,W.wrap<0&&(W.wrap=-W.wrap),W.status=W.wrap?42:x,U.adler=2===W.wrap?0:1,W.last_flush=y,M(W),r},T=U=>{const W=X(U);var l;return W===r&&((l=U.state).window_size=2*l.w_size,v(l.head),l.max_lazy_match=a[l.level].max_lazy,l.good_match=a[l.level].good_length,l.nice_match=a[l.level].nice_length,l.max_chain_length=a[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=2,l.match_available=0,l.ins_h=0),W},UU=(U,W,l,M,t,L)=>{if(!U)return f;let p=1;if(W===Z&&(W=6),M<0?(p=0,M=-M):M>15&&(p=2,M-=16),t<1||t>9||l!==d||M<8||M>15||W<0||W>9||L<0||L>i)return R(U,f);8===M&&(M=9);const B=new Y;return U.state=B,B.strm=U,B.wrap=p,B.gzhead=null,B.w_bits=M,B.w_size=1<<B.w_bits,B.w_mask=B.w_size-1,B.hash_bits=t+7,B.hash_size=1<<B.hash_bits,B.hash_mask=B.hash_size-1,B.hash_shift=~~((B.hash_bits+3-1)/3),B.window=new Uint8Array(2*B.w_size),B.head=new Uint16Array(B.hash_size),B.prev=new Uint16Array(B.w_size),B.lit_bufsize=1<<t+6,B.pending_buf_size=4*B.lit_bufsize,B.pending_buf=new Uint8Array(B.pending_buf_size),B.d_buf=1*B.lit_bufsize,B.l_buf=3*B.lit_bufsize,B.level=W,B.strategy=L,B.method=l,T(U)};U.exports.deflateInit=(U,W)=>UU(U,W,d,15,8,O),U.exports.deflateInit2=UU,U.exports.deflateReset=T,U.exports.deflateResetKeep=X,U.exports.deflateSetHeader=(U,W)=>U&&U.state?2!==U.state.wrap?f:(U.state.gzhead=W,r):f,U.exports.deflate=(U,W)=>{let l,M;if(!U||!U.state||W>K||W<0)return U?R(U,f):f;const L=U.state;if(!U.output||!U.input&&0!==U.avail_in||L.status===I&&W!==w)return R(U,0===U.avail_out?E:f);L.strm=U;const k=L.last_flush;if(L.last_flush=W,42===L.status)if(2===L.wrap)U.adler=0,u(L,31),u(L,139),u(L,8),L.gzhead?(u(L,(L.gzhead.text?1:0)+(L.gzhead.hcrc?2:0)+(L.gzhead.extra?4:0)+(L.gzhead.name?8:0)+(L.gzhead.comment?16:0)),u(L,255&L.gzhead.time),u(L,L.gzhead.time>>8&255),u(L,L.gzhead.time>>16&255),u(L,L.gzhead.time>>24&255),u(L,9===L.level?2:L.strategy>=D||L.level<2?4:0),u(L,255&L.gzhead.os),L.gzhead.extra&&L.gzhead.extra.length&&(u(L,255&L.gzhead.extra.length),u(L,L.gzhead.extra.length>>8&255)),L.gzhead.hcrc&&(U.adler=A(U.adler,L.pending_buf,L.pending,0)),L.gzindex=0,L.status=69):(u(L,0),u(L,0),u(L,0),u(L,0),u(L,0),u(L,9===L.level?2:L.strategy>=D||L.level<2?4:0),u(L,3),L.status=x);else{let W=d+(L.w_bits-8<<4)<<8,l=-1;l=L.strategy>=D||L.level<2?0:L.level<6?1:6===L.level?2:3,W|=l<<6,0!==L.strstart&&(W|=32),W+=31-W%31,L.status=x,b(L,W),0!==L.strstart&&(b(L,U.adler>>>16),b(L,65535&U.adler)),U.adler=1}if(69===L.status)if(L.gzhead.extra){for(l=L.pending;L.gzindex<(65535&L.gzhead.extra.length)&&(L.pending!==L.pending_buf_size||(L.gzhead.hcrc&&L.pending>l&&(U.adler=A(U.adler,L.pending_buf,L.pending-l,l)),Q(U),l=L.pending,L.pending!==L.pending_buf_size));)u(L,255&L.gzhead.extra[L.gzindex]),L.gzindex++;L.gzhead.hcrc&&L.pending>l&&(U.adler=A(U.adler,L.pending_buf,L.pending-l,l)),L.gzindex===L.gzhead.extra.length&&(L.gzindex=0,L.status=73)}else L.status=73;if(73===L.status)if(L.gzhead.name){l=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>l&&(U.adler=A(U.adler,L.pending_buf,L.pending-l,l)),Q(U),l=L.pending,L.pending===L.pending_buf_size)){M=1;break}M=L.gzindex<L.gzhead.name.length?255&L.gzhead.name.charCodeAt(L.gzindex++):0,u(L,M)}while(0!==M);L.gzhead.hcrc&&L.pending>l&&(U.adler=A(U.adler,L.pending_buf,L.pending-l,l)),0===M&&(L.gzindex=0,L.status=91)}else L.status=91;if(91===L.status)if(L.gzhead.comment){l=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>l&&(U.adler=A(U.adler,L.pending_buf,L.pending-l,l)),Q(U),l=L.pending,L.pending===L.pending_buf_size)){M=1;break}M=L.gzindex<L.gzhead.comment.length?255&L.gzhead.comment.charCodeAt(L.gzindex++):0,u(L,M)}while(0!==M);L.gzhead.hcrc&&L.pending>l&&(U.adler=A(U.adler,L.pending_buf,L.pending-l,l)),0===M&&(L.status=n)}else L.status=n;if(L.status===n&&(L.gzhead.hcrc?(L.pending+2>L.pending_buf_size&&Q(U),L.pending+2<=L.pending_buf_size&&(u(L,255&U.adler),u(L,U.adler>>8&255),U.adler=0,L.status=x)):L.status=x),0!==L.pending){if(Q(U),0===U.avail_out)return L.last_flush=-1,r}else if(0===U.avail_in&&F(W)<=F(k)&&W!==w)return R(U,E);if(L.status===I&&0!==U.avail_in)return R(U,E);if(0!==U.avail_in||0!==L.lookahead||W!==y&&L.status!==I){let l=L.strategy===D?((U,W)=>{let l;for(;;){if(0===U.lookahead&&(S(U),0===U.lookahead)){if(W===y)return 1;break}if(U.match_length=0,l=p(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,l&&(G(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,W===w?(G(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(G(U,!1),0===U.strm.avail_out)?1:2})(L,W):L.strategy===o?((U,W)=>{let l,M,t,L;const B=U.window;for(;;){if(U.lookahead<=H){if(S(U),U.lookahead<=H&&W===y)return 1;if(0===U.lookahead)break}if(U.match_length=0,U.lookahead>=3&&U.strstart>0&&(t=U.strstart-1,M=B[t],M===B[++t]&&M===B[++t]&&M===B[++t])){L=U.strstart+H;do{}while(M===B[++t]&&M===B[++t]&&M===B[++t]&&M===B[++t]&&M===B[++t]&&M===B[++t]&&M===B[++t]&&M===B[++t]&&t<L);U.match_length=H-(L-t),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=3?(l=p(U,1,U.match_length-3),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(l=p(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),l&&(G(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,W===w?(G(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(G(U,!1),0===U.strm.avail_out)?1:2})(L,W):a[L.level].func(L,W);if(3!==l&&4!==l||(L.status=I),1===l||3===l)return 0===U.avail_out&&(L.last_flush=-1),r;if(2===l&&(W===j?B(L):W!==K&&(t(L,0,0,!1),W===s&&(v(L.head),0===L.lookahead&&(L.strstart=0,L.block_start=0,L.insert=0))),Q(U),0===U.avail_out))return L.last_flush=-1,r}return W!==w?r:L.wrap<=0?m:(2===L.wrap?(u(L,255&U.adler),u(L,U.adler>>8&255),u(L,U.adler>>16&255),u(L,U.adler>>24&255),u(L,255&U.total_in),u(L,U.total_in>>8&255),u(L,U.total_in>>16&255),u(L,U.total_in>>24&255)):(b(L,U.adler>>>16),b(L,65535&U.adler)),Q(U),L.wrap>0&&(L.wrap=-L.wrap),0!==L.pending?r:m)},U.exports.deflateEnd=U=>{if(!U||!U.state)return f;const W=U.state.status;return 42!==W&&69!==W&&73!==W&&91!==W&&W!==n&&W!==x&&W!==I?R(U,f):(U.state=null,W===x?R(U,g):r)},U.exports.deflateSetDictionary=(U,W)=>{let l=W.length;if(!U||!U.state)return f;const M=U.state,t=M.wrap;if(2===t||1===t&&42!==M.status||M.lookahead)return f;if(1===t&&(U.adler=k(U.adler,W,l,0)),M.wrap=0,l>=M.w_size){0===t&&(v(M.head),M.strstart=0,M.block_start=0,M.insert=0);let U=new Uint8Array(M.w_size);U.set(W.subarray(l-M.w_size,l),0),W=U,l=M.w_size}const L=U.avail_in,p=U.next_in,B=U.input;for(U.avail_in=l,U.next_in=0,U.input=W,S(M);M.lookahead>=3;){let U=M.strstart,W=M.lookahead-2;do{M.ins_h=J(M,M.ins_h,M.window[U+3-1]),M.prev[U&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=U,U++}while(--W);M.strstart=U,M.lookahead=2,S(M)}return M.strstart+=M.lookahead,M.block_start=M.strstart,M.insert=M.lookahead,M.lookahead=0,M.match_length=M.prev_length=2,M.match_available=0,U.next_in=p,U.input=B,U.avail_in=L,M.wrap=t,r},U.exports.deflateInfo="pako deflate (from Nodeca project)"},12185:U=>{"use strict";U.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12176:U=>{"use strict";U.exports=function(U,W){let l,M,t,L,p,B,k,A,q,y,j,s,w,K,r,m,f,g,E,Z,N,D,o,i;const O=U.state;l=U.next_in,o=U.input,M=l+(U.avail_in-5),t=U.next_out,i=U.output,L=t-(W-U.avail_out),p=t+(U.avail_out-257),B=O.dmax,k=O.wsize,A=O.whave,q=O.wnext,y=O.window,j=O.hold,s=O.bits,w=O.lencode,K=O.distcode,r=(1<<O.lenbits)-1,m=(1<<O.distbits)-1;U:do{s<15&&(j+=o[l++]<<s,s+=8,j+=o[l++]<<s,s+=8),f=w[j&r];W:for(;;){if(g=f>>>24,j>>>=g,s-=g,g=f>>>16&255,0===g)i[t++]=65535&f;else{if(!(16&g)){if(0===(64&g)){f=w[(65535&f)+(j&(1<<g)-1)];continue W}if(32&g){O.mode=12;break U}U.msg="invalid literal/length code",O.mode=30;break U}E=65535&f,g&=15,g&&(s<g&&(j+=o[l++]<<s,s+=8),E+=j&(1<<g)-1,j>>>=g,s-=g),s<15&&(j+=o[l++]<<s,s+=8,j+=o[l++]<<s,s+=8),f=K[j&m];l:for(;;){if(g=f>>>24,j>>>=g,s-=g,g=f>>>16&255,!(16&g)){if(0===(64&g)){f=K[(65535&f)+(j&(1<<g)-1)];continue l}U.msg="invalid distance code",O.mode=30;break U}if(Z=65535&f,g&=15,s<g&&(j+=o[l++]<<s,s+=8,s<g&&(j+=o[l++]<<s,s+=8)),Z+=j&(1<<g)-1,Z>B){U.msg="invalid distance too far back",O.mode=30;break U}if(j>>>=g,s-=g,g=t-L,Z>g){if(g=Z-g,g>A&&O.sane){U.msg="invalid distance too far back",O.mode=30;break U}if(N=0,D=y,0===q){if(N+=k-g,g<E){E-=g;do{i[t++]=y[N++]}while(--g);N=t-Z,D=i}}else if(q<g){if(N+=k+q-g,g-=q,g<E){E-=g;do{i[t++]=y[N++]}while(--g);if(N=0,q<E){g=q,E-=g;do{i[t++]=y[N++]}while(--g);N=t-Z,D=i}}}else if(N+=q-g,g<E){E-=g;do{i[t++]=y[N++]}while(--g);N=t-Z,D=i}for(;E>2;)i[t++]=D[N++],i[t++]=D[N++],i[t++]=D[N++],E-=3;E&&(i[t++]=D[N++],E>1&&(i[t++]=D[N++]))}else{N=t-Z;do{i[t++]=i[N++],i[t++]=i[N++],i[t++]=i[N++],E-=3}while(E>2);E&&(i[t++]=i[N++],E>1&&(i[t++]=i[N++]))}break}}break}}while(l<M&&t<p);E=s>>3,l-=E,s-=E<<3,j&=(1<<s)-1,U.next_in=l,U.next_out=t,U.avail_in=l<M?M-l+5:5-(l-M),U.avail_out=t<p?p-t+257:257-(t-p),O.hold=j,O.bits=s}},12174:(U,W,l)=>{"use strict";const M=l(12133),t=l(12137),L=l(12176),p=l(12181),{Z_FINISH:B,Z_BLOCK:k,Z_TREES:A,Z_OK:q,Z_STREAM_END:y,Z_NEED_DICT:j,Z_STREAM_ERROR:s,Z_DATA_ERROR:w,Z_MEM_ERROR:K,Z_BUF_ERROR:r,Z_DEFLATED:m}=l(12141),f=12,g=30,E=U=>(U>>>24&255)+(U>>>8&65280)+((65280&U)<<8)+((255&U)<<24);function Z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const N=U=>{if(!U||!U.state)return s;const W=U.state;return U.total_in=U.total_out=W.total=0,U.msg="",W.wrap&&(U.adler=1&W.wrap),W.mode=1,W.last=0,W.havedict=0,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new Int32Array(852),W.distcode=W.distdyn=new Int32Array(592),W.sane=1,W.back=-1,q},D=U=>{if(!U||!U.state)return s;const W=U.state;return W.wsize=0,W.whave=0,W.wnext=0,N(U)},o=(U,W)=>{let l;if(!U||!U.state)return s;const M=U.state;return W<0?(l=0,W=-W):(l=1+(W>>4),W<48&&(W&=15)),W&&(W<8||W>15)?s:(null!==M.window&&M.wbits!==W&&(M.window=null),M.wrap=l,M.wbits=W,D(U))},i=(U,W)=>{if(!U)return s;const l=new Z;U.state=l,l.window=null;const M=o(U,W);return M!==q&&(U.state=null),M};let O,e,d=!0;const H=U=>{if(d){O=new Int32Array(512),e=new Int32Array(32);let W=0;for(;W<144;)U.lens[W++]=8;for(;W<256;)U.lens[W++]=9;for(;W<280;)U.lens[W++]=7;for(;W<288;)U.lens[W++]=8;for(p(1,U.lens,0,288,O,0,U.work,{bits:9}),W=0;W<32;)U.lens[W++]=5;p(2,U.lens,0,32,e,0,U.work,{bits:5}),d=!1}U.lencode=O,U.lenbits=9,U.distcode=e,U.distbits=5},V=(U,W,l,M)=>{let t;const L=U.state;return null===L.window&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new Uint8Array(L.wsize)),M>=L.wsize?(L.window.set(W.subarray(l-L.wsize,l),0),L.wnext=0,L.whave=L.wsize):(t=L.wsize-L.wnext,t>M&&(t=M),L.window.set(W.subarray(l-M,l-M+t),L.wnext),(M-=t)?(L.window.set(W.subarray(l-M,l),0),L.wnext=M,L.whave=L.wsize):(L.wnext+=t,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=t))),0};U.exports.inflateReset=D,U.exports.inflateReset2=o,U.exports.inflateResetKeep=N,U.exports.inflateInit=U=>i(U,15),U.exports.inflateInit2=i,U.exports.inflate=(U,W)=>{let l,Z,N,D,o,i,O,e,d,n,x,I,R,F,v,J,Q,G,u,b,C,P,S=0;const c=new Uint8Array(4);let h,z;const a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!U||!U.state||!U.output||!U.input&&0!==U.avail_in)return s;l=U.state,l.mode===f&&(l.mode=13),o=U.next_out,N=U.output,O=U.avail_out,D=U.next_in,Z=U.input,i=U.avail_in,e=l.hold,d=l.bits,n=i,x=O,P=q;U:for(;;)switch(l.mode){case 1:if(0===l.wrap){l.mode=13;break}for(;d<16;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(2&l.wrap&&35615===e){l.check=0,c[0]=255&e,c[1]=e>>>8&255,l.check=t(l.check,c,2,0),e=0,d=0,l.mode=2;break}if(l.flags=0,l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&e)<<8)+(e>>8))%31){U.msg="incorrect header check",l.mode=g;break}if((15&e)!==m){U.msg="unknown compression method",l.mode=g;break}if(e>>>=4,d-=4,C=8+(15&e),0===l.wbits)l.wbits=C;else if(C>l.wbits){U.msg="invalid window size",l.mode=g;break}l.dmax=1<<l.wbits,U.adler=l.check=1,l.mode=512&e?10:f,e=0,d=0;break;case 2:for(;d<16;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(l.flags=e,(255&l.flags)!==m){U.msg="unknown compression method",l.mode=g;break}if(57344&l.flags){U.msg="unknown header flags set",l.mode=g;break}l.head&&(l.head.text=e>>8&1),512&l.flags&&(c[0]=255&e,c[1]=e>>>8&255,l.check=t(l.check,c,2,0)),e=0,d=0,l.mode=3;case 3:for(;d<32;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}l.head&&(l.head.time=e),512&l.flags&&(c[0]=255&e,c[1]=e>>>8&255,c[2]=e>>>16&255,c[3]=e>>>24&255,l.check=t(l.check,c,4,0)),e=0,d=0,l.mode=4;case 4:for(;d<16;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}l.head&&(l.head.xflags=255&e,l.head.os=e>>8),512&l.flags&&(c[0]=255&e,c[1]=e>>>8&255,l.check=t(l.check,c,2,0)),e=0,d=0,l.mode=5;case 5:if(1024&l.flags){for(;d<16;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}l.length=e,l.head&&(l.head.extra_len=e),512&l.flags&&(c[0]=255&e,c[1]=e>>>8&255,l.check=t(l.check,c,2,0)),e=0,d=0}else l.head&&(l.head.extra=null);l.mode=6;case 6:if(1024&l.flags&&(I=l.length,I>i&&(I=i),I&&(l.head&&(C=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Uint8Array(l.head.extra_len)),l.head.extra.set(Z.subarray(D,D+I),C)),512&l.flags&&(l.check=t(l.check,Z,I,D)),i-=I,D+=I,l.length-=I),l.length))break U;l.length=0,l.mode=7;case 7:if(2048&l.flags){if(0===i)break U;I=0;do{C=Z[D+I++],l.head&&C&&l.length<65536&&(l.head.name+=String.fromCharCode(C))}while(C&&I<i);if(512&l.flags&&(l.check=t(l.check,Z,I,D)),i-=I,D+=I,C)break U}else l.head&&(l.head.name=null);l.length=0,l.mode=8;case 8:if(4096&l.flags){if(0===i)break U;I=0;do{C=Z[D+I++],l.head&&C&&l.length<65536&&(l.head.comment+=String.fromCharCode(C))}while(C&&I<i);if(512&l.flags&&(l.check=t(l.check,Z,I,D)),i-=I,D+=I,C)break U}else l.head&&(l.head.comment=null);l.mode=9;case 9:if(512&l.flags){for(;d<16;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(e!==(65535&l.check)){U.msg="header crc mismatch",l.mode=g;break}e=0,d=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),U.adler=l.check=0,l.mode=f;break;case 10:for(;d<32;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}U.adler=l.check=E(e),e=0,d=0,l.mode=11;case 11:if(0===l.havedict)return U.next_out=o,U.avail_out=O,U.next_in=D,U.avail_in=i,l.hold=e,l.bits=d,j;U.adler=l.check=1,l.mode=f;case f:if(W===k||W===A)break U;case 13:if(l.last){e>>>=7&d,d-=7&d,l.mode=27;break}for(;d<3;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}switch(l.last=1&e,e>>>=1,d-=1,3&e){case 0:l.mode=14;break;case 1:if(H(l),l.mode=20,W===A){e>>>=2,d-=2;break U}break;case 2:l.mode=17;break;case 3:U.msg="invalid block type",l.mode=g}e>>>=2,d-=2;break;case 14:for(e>>>=7&d,d-=7&d;d<32;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if((65535&e)!==(e>>>16^65535)){U.msg="invalid stored block lengths",l.mode=g;break}if(l.length=65535&e,e=0,d=0,l.mode=15,W===A)break U;case 15:l.mode=16;case 16:if(I=l.length,I){if(I>i&&(I=i),I>O&&(I=O),0===I)break U;N.set(Z.subarray(D,D+I),o),i-=I,D+=I,O-=I,o+=I,l.length-=I;break}l.mode=f;break;case 17:for(;d<14;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(l.nlen=257+(31&e),e>>>=5,d-=5,l.ndist=1+(31&e),e>>>=5,d-=5,l.ncode=4+(15&e),e>>>=4,d-=4,l.nlen>286||l.ndist>30){U.msg="too many length or distance symbols",l.mode=g;break}l.have=0,l.mode=18;case 18:for(;l.have<l.ncode;){for(;d<3;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}l.lens[a[l.have++]]=7&e,e>>>=3,d-=3}for(;l.have<19;)l.lens[a[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,h={bits:l.lenbits},P=p(0,l.lens,0,19,l.lencode,0,l.work,h),l.lenbits=h.bits,P){U.msg="invalid code lengths set",l.mode=g;break}l.have=0,l.mode=19;case 19:for(;l.have<l.nlen+l.ndist;){for(;S=l.lencode[e&(1<<l.lenbits)-1],v=S>>>24,J=S>>>16&255,Q=65535&S,!(v<=d);){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(Q<16)e>>>=v,d-=v,l.lens[l.have++]=Q;else{if(16===Q){for(z=v+2;d<z;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(e>>>=v,d-=v,0===l.have){U.msg="invalid bit length repeat",l.mode=g;break}C=l.lens[l.have-1],I=3+(3&e),e>>>=2,d-=2}else if(17===Q){for(z=v+3;d<z;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}e>>>=v,d-=v,C=0,I=3+(7&e),e>>>=3,d-=3}else{for(z=v+7;d<z;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}e>>>=v,d-=v,C=0,I=11+(127&e),e>>>=7,d-=7}if(l.have+I>l.nlen+l.ndist){U.msg="invalid bit length repeat",l.mode=g;break}for(;I--;)l.lens[l.have++]=C}}if(l.mode===g)break;if(0===l.lens[256]){U.msg="invalid code -- missing end-of-block",l.mode=g;break}if(l.lenbits=9,h={bits:l.lenbits},P=p(1,l.lens,0,l.nlen,l.lencode,0,l.work,h),l.lenbits=h.bits,P){U.msg="invalid literal/lengths set",l.mode=g;break}if(l.distbits=6,l.distcode=l.distdyn,h={bits:l.distbits},P=p(2,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,h),l.distbits=h.bits,P){U.msg="invalid distances set",l.mode=g;break}if(l.mode=20,W===A)break U;case 20:l.mode=21;case 21:if(i>=6&&O>=258){U.next_out=o,U.avail_out=O,U.next_in=D,U.avail_in=i,l.hold=e,l.bits=d,L(U,x),o=U.next_out,N=U.output,O=U.avail_out,D=U.next_in,Z=U.input,i=U.avail_in,e=l.hold,d=l.bits,l.mode===f&&(l.back=-1);break}for(l.back=0;S=l.lencode[e&(1<<l.lenbits)-1],v=S>>>24,J=S>>>16&255,Q=65535&S,!(v<=d);){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(J&&0===(240&J)){for(G=v,u=J,b=Q;S=l.lencode[b+((e&(1<<G+u)-1)>>G)],v=S>>>24,J=S>>>16&255,Q=65535&S,!(G+v<=d);){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}e>>>=G,d-=G,l.back+=G}if(e>>>=v,d-=v,l.back+=v,l.length=Q,0===J){l.mode=26;break}if(32&J){l.back=-1,l.mode=f;break}if(64&J){U.msg="invalid literal/length code",l.mode=g;break}l.extra=15&J,l.mode=22;case 22:if(l.extra){for(z=l.extra;d<z;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}l.length+=e&(1<<l.extra)-1,e>>>=l.extra,d-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=23;case 23:for(;S=l.distcode[e&(1<<l.distbits)-1],v=S>>>24,J=S>>>16&255,Q=65535&S,!(v<=d);){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(0===(240&J)){for(G=v,u=J,b=Q;S=l.distcode[b+((e&(1<<G+u)-1)>>G)],v=S>>>24,J=S>>>16&255,Q=65535&S,!(G+v<=d);){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}e>>>=G,d-=G,l.back+=G}if(e>>>=v,d-=v,l.back+=v,64&J){U.msg="invalid distance code",l.mode=g;break}l.offset=Q,l.extra=15&J,l.mode=24;case 24:if(l.extra){for(z=l.extra;d<z;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}l.offset+=e&(1<<l.extra)-1,e>>>=l.extra,d-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){U.msg="invalid distance too far back",l.mode=g;break}l.mode=25;case 25:if(0===O)break U;if(I=x-O,l.offset>I){if(I=l.offset-I,I>l.whave&&l.sane){U.msg="invalid distance too far back",l.mode=g;break}I>l.wnext?(I-=l.wnext,R=l.wsize-I):R=l.wnext-I,I>l.length&&(I=l.length),F=l.window}else F=N,R=o-l.offset,I=l.length;I>O&&(I=O),O-=I,l.length-=I;do{N[o++]=F[R++]}while(--I);0===l.length&&(l.mode=21);break;case 26:if(0===O)break U;N[o++]=l.length,O--,l.mode=21;break;case 27:if(l.wrap){for(;d<32;){if(0===i)break U;i--,e|=Z[D++]<<d,d+=8}if(x-=O,U.total_out+=x,l.total+=x,x&&(U.adler=l.check=l.flags?t(l.check,N,x,o-x):M(l.check,N,x,o-x)),x=O,(l.flags?e:E(e))!==l.check){U.msg="incorrect data check",l.mode=g;break}e=0,d=0}l.mode=28;case 28:if(l.wrap&&l.flags){for(;d<32;){if(0===i)break U;i--,e+=Z[D++]<<d,d+=8}if(e!==(4294967295&l.total)){U.msg="incorrect length check",l.mode=g;break}e=0,d=0}l.mode=29;case 29:P=y;break U;case g:P=w;break U;case 31:return K;default:return s}return U.next_out=o,U.avail_out=O,U.next_in=D,U.avail_in=i,l.hold=e,l.bits=d,(l.wsize||x!==U.avail_out&&l.mode<g&&(l.mode<27||W!==B))&&V(U,U.output,U.next_out,x-U.avail_out)?(l.mode=31,K):(n-=U.avail_in,x-=U.avail_out,U.total_in+=n,U.total_out+=x,l.total+=x,l.wrap&&x&&(U.adler=l.check=l.flags?t(l.check,N,x,U.next_out-x):M(l.check,N,x,U.next_out-x)),U.data_type=l.bits+(l.last?64:0)+(l.mode===f?128:0)+(20===l.mode||15===l.mode?256:0),(0===n&&0===x||W===B)&&P===q&&(P=r),P)},U.exports.inflateEnd=U=>{if(!U||!U.state)return s;let W=U.state;return W.window&&(W.window=null),U.state=null,q},U.exports.inflateGetHeader=(U,W)=>{if(!U||!U.state)return s;const l=U.state;return 0===(2&l.wrap)?s:(l.head=W,W.done=!1,q)},U.exports.inflateSetDictionary=(U,W)=>{const l=W.length;let t,L,p;return U&&U.state?(t=U.state,0!==t.wrap&&11!==t.mode?s:11===t.mode&&(L=1,L=M(L,W,l,0),L!==t.check)?w:(p=V(U,W,l,l),p?(t.mode=31,K):(t.havedict=1,q))):s},U.exports.inflateInfo="pako inflate (from Nodeca project)"},12181:U=>{"use strict";const W=15,l=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),M=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),L=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);U.exports=(U,p,B,k,A,q,y,j)=>{const s=j.bits;let w,K,r,m,f,g,E=0,Z=0,N=0,D=0,o=0,i=0,O=0,e=0,d=0,H=0,V=null,n=0;const x=new Uint16Array(16),I=new Uint16Array(16);let R,F,v,J=null,Q=0;for(E=0;E<=W;E++)x[E]=0;for(Z=0;Z<k;Z++)x[p[B+Z]]++;for(o=s,D=W;D>=1&&0===x[D];D--);if(o>D&&(o=D),0===D)return A[q++]=20971520,A[q++]=20971520,j.bits=1,0;for(N=1;N<D&&0===x[N];N++);for(o<N&&(o=N),e=1,E=1;E<=W;E++)if(e<<=1,e-=x[E],e<0)return-1;if(e>0&&(0===U||1!==D))return-1;for(I[1]=0,E=1;E<W;E++)I[E+1]=I[E]+x[E];for(Z=0;Z<k;Z++)0!==p[B+Z]&&(y[I[p[B+Z]]++]=Z);if(0===U?(V=J=y,g=19):1===U?(V=l,n-=257,J=M,Q-=257,g=256):(V=t,J=L,g=-1),H=0,Z=0,E=N,f=q,i=o,O=0,r=-1,d=1<<o,m=d-1,1===U&&d>852||2===U&&d>592)return 1;for(;;){R=E-O,y[Z]<g?(F=0,v=y[Z]):y[Z]>g?(F=J[Q+y[Z]],v=V[n+y[Z]]):(F=96,v=0),w=1<<E-O,K=1<<i,N=K;do{K-=w,A[f+(H>>O)+K]=R<<24|F<<16|v}while(0!==K);for(w=1<<E-1;H&w;)w>>=1;if(0!==w?(H&=w-1,H+=w):H=0,Z++,0===--x[E]){if(E===D)break;E=p[B+y[Z]]}if(E>o&&(H&m)!==r){for(0===O&&(O=o),f+=N,i=E-O,e=1<<i;i+O<D&&(e-=x[i+O],!(e<=0));)i++,e<<=1;if(d+=1<<i,1===U&&d>852||2===U&&d>592)return 1;r=H&m,A[r]=o<<24|i<<16|f-q}}return 0!==H&&(A[f+H]=E-O<<24|64<<16),j.bits=o,0}},12139:U=>{"use strict";U.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12127:U=>{"use strict";function W(U){let W=U.length;for(;--W>=0;)U[W]=0}const l=256,M=286,t=30,L=15,p=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),B=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),k=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),q=new Array(576);W(q);const y=new Array(60);W(y);const j=new Array(512);W(j);const s=new Array(256);W(s);const w=new Array(29);W(w);const K=new Array(t);function r(U,W,l,M,t){this.static_tree=U,this.extra_bits=W,this.extra_base=l,this.elems=M,this.max_length=t,this.has_stree=U&&U.length}let m,f,g;function E(U,W){this.dyn_tree=U,this.max_code=0,this.stat_desc=W}W(K);const Z=U=>U<256?j[U]:j[256+(U>>>7)],N=(U,W)=>{U.pending_buf[U.pending++]=255&W,U.pending_buf[U.pending++]=W>>>8&255},D=(U,W,l)=>{U.bi_valid>16-l?(U.bi_buf|=W<<U.bi_valid&65535,N(U,U.bi_buf),U.bi_buf=W>>16-U.bi_valid,U.bi_valid+=l-16):(U.bi_buf|=W<<U.bi_valid&65535,U.bi_valid+=l)},o=(U,W,l)=>{D(U,l[2*W],l[2*W+1])},i=(U,W)=>{let l=0;do{l|=1&U,U>>>=1,l<<=1}while(--W>0);return l>>>1},O=(U,W,l)=>{const M=new Array(16);let t,p,B=0;for(t=1;t<=L;t++)M[t]=B=B+l[t-1]<<1;for(p=0;p<=W;p++){let W=U[2*p+1];0!==W&&(U[2*p]=i(M[W]++,W))}},e=U=>{let W;for(W=0;W<M;W++)U.dyn_ltree[2*W]=0;for(W=0;W<t;W++)U.dyn_dtree[2*W]=0;for(W=0;W<19;W++)U.bl_tree[2*W]=0;U.dyn_ltree[512]=1,U.opt_len=U.static_len=0,U.last_lit=U.matches=0},d=U=>{U.bi_valid>8?N(U,U.bi_buf):U.bi_valid>0&&(U.pending_buf[U.pending++]=U.bi_buf),U.bi_buf=0,U.bi_valid=0},H=(U,W,l,M)=>{const t=2*W,L=2*l;return U[t]<U[L]||U[t]===U[L]&&M[W]<=M[l]},V=(U,W,l)=>{const M=U.heap[l];let t=l<<1;for(;t<=U.heap_len&&(t<U.heap_len&&H(W,U.heap[t+1],U.heap[t],U.depth)&&t++,!H(W,M,U.heap[t],U.depth));)U.heap[l]=U.heap[t],l=t,t<<=1;U.heap[l]=M},n=(U,W,M)=>{let t,L,k,A,q=0;if(0!==U.last_lit)do{t=U.pending_buf[U.d_buf+2*q]<<8|U.pending_buf[U.d_buf+2*q+1],L=U.pending_buf[U.l_buf+q],q++,0===t?o(U,L,W):(k=s[L],o(U,k+l+1,W),A=p[k],0!==A&&(L-=w[k],D(U,L,A)),t--,k=Z(t),o(U,k,M),A=B[k],0!==A&&(t-=K[k],D(U,t,A)))}while(q<U.last_lit);o(U,256,W)},x=(U,W)=>{const l=W.dyn_tree,M=W.stat_desc.static_tree,t=W.stat_desc.has_stree,p=W.stat_desc.elems;let B,k,A,q=-1;for(U.heap_len=0,U.heap_max=573,B=0;B<p;B++)0!==l[2*B]?(U.heap[++U.heap_len]=q=B,U.depth[B]=0):l[2*B+1]=0;for(;U.heap_len<2;)A=U.heap[++U.heap_len]=q<2?++q:0,l[2*A]=1,U.depth[A]=0,U.opt_len--,t&&(U.static_len-=M[2*A+1]);for(W.max_code=q,B=U.heap_len>>1;B>=1;B--)V(U,l,B);A=p;do{B=U.heap[1],U.heap[1]=U.heap[U.heap_len--],V(U,l,1),k=U.heap[1],U.heap[--U.heap_max]=B,U.heap[--U.heap_max]=k,l[2*A]=l[2*B]+l[2*k],U.depth[A]=(U.depth[B]>=U.depth[k]?U.depth[B]:U.depth[k])+1,l[2*B+1]=l[2*k+1]=A,U.heap[1]=A++,V(U,l,1)}while(U.heap_len>=2);U.heap[--U.heap_max]=U.heap[1],((U,W)=>{const l=W.dyn_tree,M=W.max_code,t=W.stat_desc.static_tree,p=W.stat_desc.has_stree,B=W.stat_desc.extra_bits,k=W.stat_desc.extra_base,A=W.stat_desc.max_length;let q,y,j,s,w,K,r=0;for(s=0;s<=L;s++)U.bl_count[s]=0;for(l[2*U.heap[U.heap_max]+1]=0,q=U.heap_max+1;q<573;q++)y=U.heap[q],s=l[2*l[2*y+1]+1]+1,s>A&&(s=A,r++),l[2*y+1]=s,y>M||(U.bl_count[s]++,w=0,y>=k&&(w=B[y-k]),K=l[2*y],U.opt_len+=K*(s+w),p&&(U.static_len+=K*(t[2*y+1]+w)));if(0!==r){do{for(s=A-1;0===U.bl_count[s];)s--;U.bl_count[s]--,U.bl_count[s+1]+=2,U.bl_count[A]--,r-=2}while(r>0);for(s=A;0!==s;s--)for(y=U.bl_count[s];0!==y;)j=U.heap[--q],j>M||(l[2*j+1]!==s&&(U.opt_len+=(s-l[2*j+1])*l[2*j],l[2*j+1]=s),y--)}})(U,W),O(l,q,U.bl_count)},I=(U,W,l)=>{let M,t,L=-1,p=W[1],B=0,k=7,A=4;for(0===p&&(k=138,A=3),W[2*(l+1)+1]=65535,M=0;M<=l;M++)t=p,p=W[2*(M+1)+1],++B<k&&t===p||(B<A?U.bl_tree[2*t]+=B:0!==t?(t!==L&&U.bl_tree[2*t]++,U.bl_tree[32]++):B<=10?U.bl_tree[34]++:U.bl_tree[36]++,B=0,L=t,0===p?(k=138,A=3):t===p?(k=6,A=3):(k=7,A=4))},R=(U,W,l)=>{let M,t,L=-1,p=W[1],B=0,k=7,A=4;for(0===p&&(k=138,A=3),M=0;M<=l;M++)if(t=p,p=W[2*(M+1)+1],!(++B<k&&t===p)){if(B<A)do{o(U,t,U.bl_tree)}while(0!==--B);else 0!==t?(t!==L&&(o(U,t,U.bl_tree),B--),o(U,16,U.bl_tree),D(U,B-3,2)):B<=10?(o(U,17,U.bl_tree),D(U,B-3,3)):(o(U,18,U.bl_tree),D(U,B-11,7));B=0,L=t,0===p?(k=138,A=3):t===p?(k=6,A=3):(k=7,A=4)}};let F=!1;const v=(U,W,l,M)=>{D(U,0+(M?1:0),3),((U,W,l,M)=>{d(U),M&&(N(U,l),N(U,~l)),U.pending_buf.set(U.window.subarray(W,W+l),U.pending),U.pending+=l})(U,W,l,!0)};U.exports._tr_init=U=>{F||((()=>{let U,W,l,A,E;const Z=new Array(16);for(l=0,A=0;A<28;A++)for(w[A]=l,U=0;U<1<<p[A];U++)s[l++]=A;for(s[l-1]=A,E=0,A=0;A<16;A++)for(K[A]=E,U=0;U<1<<B[A];U++)j[E++]=A;for(E>>=7;A<t;A++)for(K[A]=E<<7,U=0;U<1<<B[A]-7;U++)j[256+E++]=A;for(W=0;W<=L;W++)Z[W]=0;for(U=0;U<=143;)q[2*U+1]=8,U++,Z[8]++;for(;U<=255;)q[2*U+1]=9,U++,Z[9]++;for(;U<=279;)q[2*U+1]=7,U++,Z[7]++;for(;U<=287;)q[2*U+1]=8,U++,Z[8]++;for(O(q,287,Z),U=0;U<t;U++)y[2*U+1]=5,y[2*U]=i(U,5);m=new r(q,p,257,M,L),f=new r(y,B,0,t,L),g=new r(new Array(0),k,0,19,7)})(),F=!0),U.l_desc=new E(U.dyn_ltree,m),U.d_desc=new E(U.dyn_dtree,f),U.bl_desc=new E(U.bl_tree,g),U.bi_buf=0,U.bi_valid=0,e(U)},U.exports._tr_stored_block=v,U.exports._tr_flush_block=(U,W,M,t)=>{let L,p,B=0;U.level>0?(2===U.strm.data_type&&(U.strm.data_type=(U=>{let W,M=4093624447;for(W=0;W<=31;W++,M>>>=1)if(1&M&&0!==U.dyn_ltree[2*W])return 0;if(0!==U.dyn_ltree[18]||0!==U.dyn_ltree[20]||0!==U.dyn_ltree[26])return 1;for(W=32;W<l;W++)if(0!==U.dyn_ltree[2*W])return 1;return 0})(U)),x(U,U.l_desc),x(U,U.d_desc),B=(U=>{let W;for(I(U,U.dyn_ltree,U.l_desc.max_code),I(U,U.dyn_dtree,U.d_desc.max_code),x(U,U.bl_desc),W=18;W>=3&&0===U.bl_tree[2*A[W]+1];W--);return U.opt_len+=3*(W+1)+5+5+4,W})(U),L=U.opt_len+3+7>>>3,p=U.static_len+3+7>>>3,p<=L&&(L=p)):L=p=M+5,M+4<=L&&-1!==W?v(U,W,M,t):4===U.strategy||p===L?(D(U,2+(t?1:0),3),n(U,q,y)):(D(U,4+(t?1:0),3),((U,W,l,M)=>{let t;for(D(U,W-257,5),D(U,l-1,5),D(U,M-4,4),t=0;t<M;t++)D(U,U.bl_tree[2*A[t]+1],3);R(U,U.dyn_ltree,W-1),R(U,U.dyn_dtree,l-1)})(U,U.l_desc.max_code+1,U.d_desc.max_code+1,B+1),n(U,U.dyn_ltree,U.dyn_dtree)),e(U),t&&d(U)},U.exports._tr_tally=(U,W,M)=>(U.pending_buf[U.d_buf+2*U.last_lit]=W>>>8&255,U.pending_buf[U.d_buf+2*U.last_lit+1]=255&W,U.pending_buf[U.l_buf+U.last_lit]=255&M,U.last_lit++,0===W?U.dyn_ltree[2*M]++:(U.matches++,W--,U.dyn_ltree[2*(s[M]+l+1)]++,U.dyn_dtree[2*Z(W)]++),U.last_lit===U.lit_bufsize-1),U.exports._tr_align=U=>{D(U,2,3),o(U,256,q),(U=>{16===U.bi_valid?(N(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):U.bi_valid>=8&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)})(U)}},12159:U=>{"use strict";U.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12083:U=>{function W(U,W,l){for(var M=U.length,t=-1/0,L=1/0,p=0;p<M;p++){var B=(l[0][p]-U[p])/W[p],k=(l[1][p]-U[p])/W[p];if(B>k){var A=B;B=k,k=A}if(k<t||B>L)return 1/0;B>t&&(t=B),k<L&&(L=k)}return t>L?1/0:t}U.exports=function(U,l,M,t){var L=W(l,M,t);if(L===1/0)U=null;else{U=U||[];for(var p=0;p<l.length;p++)U[p]=l[p]+M[p]*L}return U},U.exports.distance=W},13011:(U,W,l)=>{"use strict";l.d(W,{b:()=>p});var M=l(33);const t=M.useLayoutEffect;const L=function(U){var W=(0,M.useRef)(U);return t((function(){W.current=U})),W};var p=function(U){var W=L(U);(0,M.Ad)((function(){var U=function(U){var l;if(null!=W.current&&(l=W.current(U)),U.defaultPrevented&&(U.returnValue=""),"string"===typeof l)return U.returnValue=l,l};return window.addEventListener("beforeunload",U),function(){window.removeEventListener("beforeunload",U)}}),[])}},12945:(U,W,l)=>{"use strict";var M=l(12953),t=Array.prototype.concat,L=Array.prototype.slice,p=U.exports=function(U){for(var W=[],l=0,p=U.length;l<p;l++){var B=U[l];M(B)?W=t.call(W,L.call(B)):W.push(B)}return W};p.wrap=function(U){return function(){return U(p(arguments))}}},12953:U=>{U.exports=function(U){return!(!U||"string"===typeof U)&&(U instanceof Array||Array.isArray(U)||U.length>=0&&(U.splice instanceof Function||Object.getOwnPropertyDescriptor(U,U.length-1)&&"String"!==U.constructor.name))}},12094:(U,W,l)=>{var M=l(12098);function t(U){for(var W,l,t=0,L=U.length,p=0;p<U.length;){for(W=U[p],l=0;p<L&&U[p]===W;)++p,++l;t+=M.log2(l)/7|0,t+=M.log2(W>>>0)/7|0,t+=2}return t}W.size=t,W.encode=function(U,W){W||(W=new Uint8Array(t(U)));for(var l,M,L=0,p=W.length,B=0;B<U.length;){for(l=U[B],M=0;B<U.length&&U[B]===l;)++B,++M;for(;L<p&&M>=128;)W[L++]=128+(127&M),M>>>=7;if(L>=p)throw new Error("RLE buffer overflow");for(W[L++]=M,l>>>=0;L<p&&l>=128;)W[L++]=128+(127&l),l>>>=7;if(L>=p)throw new Error("RLE buffer overflow");W[L++]=l}return W},W.decode=function(U,W){for(var l,M,t,L,p=W.length,B=U.length,k=0,A=0;A<B;){for(l=0,M=0;A<B&&U[A]>=128;)l+=(127&U[A++])<<M,M+=7;if(l+=U[A++]<<M,A>=B)throw new Error("RLE buffer underrun");if(k+l>p)throw new Error("Chunk buffer overflow");for(t=0,M=0;A<B&&U[A]>=128;)t+=(127&U[A++])<<M,M+=7;if(A>=B)throw new Error("RLE buffer underrun");for(t+=U[A++]<<M,L=0;L<l;++L)W[k++]=t}return W}},12098:(U,W)=>{"use strict";function l(U){var W=32;return(U&=-U)&&W--,65535&U&&(W-=16),16711935&U&&(W-=8),252645135&U&&(W-=4),858993459&U&&(W-=2),1431655765&U&&(W-=1),W}W.INT_BITS=32,W.INT_MAX=2147483647,W.INT_MIN=-1<<31,W.sign=function(U){return(U>0)-(U<0)},W.abs=function(U){var W=U>>31;return(U^W)-W},W.min=function(U,W){return W^(U^W)&-(U<W)},W.max=function(U,W){return U^(U^W)&-(U<W)},W.isPow2=function(U){return!(U&U-1)&&!!U},W.log2=function(U){var W,l;return W=(U>65535)<<4,W|=l=((U>>>=W)>255)<<3,W|=l=((U>>>=l)>15)<<2,(W|=l=((U>>>=l)>3)<<1)|(U>>>=l)>>1},W.log10=function(U){return U>=1e9?9:U>=1e8?8:U>=1e7?7:U>=1e6?6:U>=1e5?5:U>=1e4?4:U>=1e3?3:U>=100?2:U>=10?1:0},W.popCount=function(U){return 16843009*((U=(858993459&(U-=U>>>1&1431655765))+(U>>>2&858993459))+(U>>>4)&252645135)>>>24},W.countTrailingZeros=l,W.nextPow2=function(U){return U+=0===U,--U,U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)+1},W.prevPow2=function(U){return U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)-(U>>>1)},W.parity=function(U){return U^=U>>>16,U^=U>>>8,U^=U>>>4,27030>>>(U&=15)&1};var M=new Array(256);!function(U){for(var W=0;W<256;++W){var l=W,M=W,t=7;for(l>>>=1;l;l>>>=1)M<<=1,M|=1&l,--t;U[W]=M<<t&255}}(M),W.reverse=function(U){return M[255&U]<<24|M[U>>>8&255]<<16|M[U>>>16&255]<<8|M[U>>>24&255]},W.interleave2=function(U,W){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))|(W=1431655765&((W=858993459&((W=252645135&((W=16711935&((W&=65535)|W<<8))|W<<4))|W<<2))|W<<1))<<1},W.deinterleave2=function(U,W){return(U=65535&((U=16711935&((U=252645135&((U=858993459&((U=U>>>W&1431655765)|U>>>1))|U>>>2))|U>>>4))|U>>>16))<<16>>16},W.interleave3=function(U,W,l){return U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2),(U|=(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<1)|(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<2},W.deinterleave3=function(U,W){return(U=1023&((U=4278190335&((U=251719695&((U=3272356035&((U=U>>>W&1227133513)|U>>>2))|U>>>4))|U>>>8))|U>>>16))<<22>>22},W.nextCombination=function(U){var W=U|U-1;return W+1|(~W&-~W)-1>>>l(U)+1}},13074:(U,W,l)=>{"use strict";l.d(W,{c:()=>y});var M=l(915),t=l(119);class L{constructor(U,W,l,L,p,B,k){this.tf=new M(U.base,U.uf),this.mass=W,this.friction=l,this.restitution=L,this.ge=p,this.Ie=B,this.he=!!k,this.Ng=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ei=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.xf=t.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=t.create(),this._impulses=t.create(),this._sleepFrameCount=10}loadFromCopy(U){t.i(this.tf.base,U.tf.base),t.i(this.tf.uf,U.tf.uf),t.i(this.tf.max,U.tf.max),this.tf.mag=U.tf.mag,this.mass=U.mass,this.friction=U.friction,this.restitution=U.restitution,this.ge=U.ge,this.Ie=U.Ie,this.he=U.he,this.Ng=U.Ng,this.fluidDrag=U.fluidDrag,this.ei=U.ei,this.preventFallOffEdge=U.preventFallOffEdge,this.rolledBackLastTick=U.rolledBackLastTick,t.i(this.xf,U.xf),t.i(this.resting,U.resting),this.inFluid=U.inFluid,this._ratioInFluid=U._ratioInFluid,t.i(this._forces,U._forces),t.i(this._impulses,U._impulses),this._sleepFrameCount=U._sleepFrameCount}setPosition(U){p(U),t.de(U,U,this.tf.base),this.tf.translate(U),this._h()}vg(){return t.clone(this.tf.base)}applyForce(U){p(U),t.add(this._forces,this._forces,U),this._h()}applyImpulse(U){p(U),t.add(this._impulses,this._impulses,U),this._h()}_h(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var p=U=>{};var B=l(915),k=l(119),A=l(923);function q(){this.Ng=.1,this.fluidDrag=.4,this.se=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function y(U,W,l){U=Object.assign(new q,U),this.gravity=U.gravity||[0,-10,0],this.Ng=U.Ng||.1,this.se=U.se||2,this.fluidDrag=U.fluidDrag||.4,this.minBounceImpulse=U.minBounceImpulse,this.bodies=[],this.rm=U.rm,this.testSolid=W,this.testFluid=l}y.prototype.jf=function(U,W,l,M,t,p){U=U||new B([0,0,0],[1,1,1]),"undefined"==typeof W&&(W=1),"undefined"==typeof l&&(l=1),"undefined"==typeof M&&(M=0),"undefined"==typeof t&&(t=1);var k=new L(U,W,l,M,t,p);return this.bodies.push(k),k},y.prototype.lf=function(U){var W=this.bodies.indexOf(U);W<0||(this.bodies.splice(W,1),U.tf=U.Ie=null)};var j=k.create(),s=k.create(),w=k.create(),K=k.create(),r=k.create(),m=k.create(),f=k.create(),g=new B([0,0,0],[1,1,1]),E=new L(g,1,1,0,1,(()=>{}),!1);function Z(U,W,l){return W=l,W*=1-(1-U.ratioInFluid)**2}y.prototype.Sj=function(U){U/=1e3;var W=J(0,k.squaredLength(this.gravity));this.bodies.forEach((l=>function(U,W,l,M){k.i(r,W.resting),U.rm&&E.loadFromCopy(W);if(W.mass<=0)return k.set(W.xf,0,0,0),k.set(W._forces,0,0,0),void k.set(W._impulses,0,0,0);var t=M||0===W.ge;if(function(U,W,l,M){if(W._sleepFrameCount>0)return!1;if(M)return!0;var t=!1,L=.5*l*l*W.ge;return k.scale(v,U.gravity,L),A(U.testSolid,W.tf,v,(function(){return t=!0,!0}),!0),t}(U,W,l,t))return;W._sleepFrameCount--,function(U,W){var l=W.tf,M=Math.floor(l.base[0]),t=Math.floor(l.base[2]),L=Math.floor(l.base[1]),p=Math.floor(l.max[1]);if(!U.testFluid(M,L,t))return W.inFluid=!1,void(W.ratioInFluid=0);var B=1,A=L+1;for(;A<=p&&U.testFluid(M,A,t);)B++,A++;var q=(L+B-l.base[1])/l.uf[1];q>1&&(q=1);var y=l.uf[0]*l.uf[1]*l.uf[2]*q,j=D;k.scale(j,U.gravity,-U.se*y*W.ge),W.applyForce(j),W.inFluid=!0,W.ratioInFluid=q}(U,W),G(W._forces),G(W._impulses),G(W.xf),G(W.resting),k.scale(j,W._forces,1/W.mass),k.yf(j,j,U.gravity,W.ge),k.scale(s,W._impulses,1/W.mass),k.yf(s,s,j,l),k.add(W.xf,W.xf,s),W.friction&&(o(U,0,W,s,l),o(U,1,W,s,l),o(U,2,W,s,l));var L=W.fluidDrag>=0?W.fluidDrag:U.fluidDrag,p=W.Ng>=0?W.Ng:U.Ng,B=p,q=p;W.inFluid&&(B=Z(W,B,W.fluidDragHoriz>=0?W.fluidDragHoriz:L),q=Z(W,q,W.fluidDragVert>=0?W.fluidDragVert:L));B=Math.max(1-B*l/W.mass,0),q=Math.max(1-q*l/W.mass,0),k.set(N,B,q,B),k.multiply(W.xf,W.xf,N),k.scale(w,W.xf,l),k.set(W._forces,0,0,0),k.set(W._impulses,0,0,0),W.he&&Q(e,W.tf);k.i(m,w),k.set(f,0,0,0),W.preventFallOffEdge&&function(U,W,l,M){if(!W.resting[1]||l[1]>0)return;var t=I;Q(t,W.tf);for(var L=0;L<3;L+=2){k.set(x,0,0,0),x[L]=l[L];var p=!0;(p=(p=(p=(p=p&&!F(U,t.base[0]+x[0]+1e-5,t.base[1],t.base[2]+x[2]+1e-5))&&!F(U,t.max[0]+x[0]-1e-5,t.base[1],t.base[2]+x[2]+1e-5))&&!F(U,t.base[0]+x[0]+1e-5,t.base[1],t.max[2]+x[2]-1e-5))&&!F(U,t.max[0]+x[0]-1e-5,t.base[1],t.max[2]+x[2]-1e-5))?(M[L]=l[L]>0?1:-1,l[L]=0):0===L&&(k.set(R,l[0],0,0),O(U,t,R,M,W.slideOnCollision))}}(U,W,w,f);O(U,W.tf,w,W.resting,W.slideOnCollision),W.he&&function(U,W,l,M){if(W.resting[1]>=0&&!W.inFluid)return;var t=0!==W.resting[0],L=0!==W.resting[2];if(!t&&!L)return;var p=Math.abs(M[0]/M[2]),B=4;if(!t&&p>B)return;if(!L&&p<1/B)return;k.add(H,l.base,M);var q=U.testSolid;A(q,l,M,(function(U,W,l,M){if(1!==W)return!0;M[W]=0}));var y=l.base[1],j=W.inFluid?1.951:1.001,s=Math.floor(y+j)-y;k.set(V,0,s,0);var w=!1;if(A(q,l,V,(function(U,W,l,M){return w=!0,!0})),w)return;k.de(n,H,l.base),n[1]=0,O(U,l,n,d,!0);var K=J(l.base[0],H[0]),r=J(l.base[2],H[2]);if(t&&!K&&(!r||!L))return;if(L&&(!K||!t)&&!r)return;var m=!0;if(m=m&&!F(U,l.base[0]+1e-5,l.base[1],l.base[2]+1e-5),m=m&&!F(U,l.max[0]-1e-5,l.base[1],l.base[2]+1e-5),m=m&&!F(U,l.base[0]+1e-5,l.base[1],l.max[2]-1e-5),m=m&&!F(U,l.max[0]-1e-5,l.base[1],l.max[2]-1e-5),m)return;Q(W.tf,l),W.resting[0]=d[0],W.resting[2]=d[2],W.ei&&W.ei()}(U,W,e,m);for(var y=0;y<3;++y)W.resting[y]=W.resting[y]||f[y],K[y]=0,W.resting[y]&&(r[y]||(K[y]=-W.xf[y]),W.xf[y]=0);var g=k.length(K);g>.001&&(k.scale(K,K,W.mass),W.Ie&&W.Ie(K),W.restitution>0&&g>U.minBounceImpulse&&(k.scale(K,K,W.restitution),W.applyImpulse(K)));var i=k.squaredLength(W.xf);i>1e-5&&W._h();U.rm&&U.rm(W)?(W.loadFromCopy(E),W.rolledBackLastTick=!0):W.rolledBackLastTick=!1}(this,l,U,W)))};var N=k.create([0,0,0]);var D=k.create();function o(U,W,l,M,t){var L=l.resting[W],p=M[W];if(!l.alwaysApplyHorizFriction||1!==W){if(0===L)return;if(L*p<=0)return}k.i(i,l.xf),i[W]=0;var B=k.length(i);if(!J(B,0)){var A=Math.abs(l.friction*U.gravity[W]*t),q=B>A?(B-A)/B:0;l.xf[(W+1)%3]*=q,l.xf[(W+2)%3]*=q}}var i=k.create();function O(U,W,l,M,t){return k.set(M,0,0,0),A(U.testSolid,W,l,(function(U,W,l,L){M[W]=l,L[W]=0,t||(L[0]=0,L[1]=0,L[2]=0)}))}var e=new B([],[]),d=k.create(),H=k.create(),V=k.create(),n=k.create();var x=k.create(),I=new B([],[]),R=k.create();function F(U,W,l,M){return U.testSolid(Math.floor(W),Math.floor(l-1),Math.floor(M))}var v=k.create();function J(U,W){return Math.abs(U-W)<1e-5}function Q(U,W){for(var l=0;l<3;l++)U.base[l]=W.base[l],U.max[l]=W.max[l],U.uf[l]=W.uf[l]}var G=function(U){}},12109:U=>{"use strict";U.exports=function(U,W,l,M){var t=self||window;try{try{var L;try{L=new t.Blob([U])}catch(A){(L=new(t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder)).append(U),L=L.getBlob()}var p=t.URL||t.webkitURL,B=p.createObjectURL(L),k=new t[W](B,l);return p.revokeObjectURL(B),k}catch(A){return new t[W]("data:application/javascript,".concat(encodeURIComponent(U)),l)}}catch(A){if(!M)throw Error("Inline worker is not supported");return new t[W](M,l)}}},12071:(U,W,l)=>{"use strict";function M(U,W,l,M,t){var L={};return Object.keys(M).forEach((function(U){L[U]=M[U]})),L.enumerable=!!L.enumerable,L.configurable=!!L.configurable,("value"in L||L.initializer)&&(L.writable=!0),L=l.slice().reverse().reduce((function(l,M){return M(U,W,l)||l}),L),t&&void 0!==L.initializer&&(L.value=L.initializer?L.initializer.call(t):void 0,L.initializer=void 0),void 0===L.initializer&&(Object.defineProperty(U,W,L),L=null),L}l.d(W,{e:()=>M})},12062:(U,W,l)=>{"use strict";function M(U,W,l,M){l&&Object.defineProperty(U,W,{enumerable:l.enumerable,configurable:l.configurable,writable:l.writable,value:l.initializer?l.initializer.call(M):void 0})}l.d(W,{e:()=>M})},12995:(U,W,l)=>{"use strict";l.d(W,{b:()=>p,d:()=>y,f:()=>B,g:()=>L,j:()=>k,n:()=>t,q:()=>A,t:()=>q});var M=l(2024);class t{constructor(){this._easingMode=t.EASINGMODE_EASEIN}setEasingMode(U){const W=Math.min(Math.max(U,0),2);this._easingMode=W}getEasingMode(){return this._easingMode}easeInCore(U){throw new Error("You must implement this method")}ease(U){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(U);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-U)}return U>=.5?.5*(1-this.easeInCore(2*(1-U)))+.5:.5*this.easeInCore(2*U)}}t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2;class L extends t{easeInCore(U){return U=Math.max(0,Math.min(1,U)),1-Math.sqrt(1-U*U)}}class p extends t{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=U}easeInCore(U){const W=Math.max(0,this.amplitude);return Math.pow(U,3)-U*W*Math.sin(3.141592653589793*U)}}class B extends t{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=U,this.bounciness=W}easeInCore(U){const W=Math.max(0,this.bounces);let l=this.bounciness;l<=1&&(l=1.001);const M=Math.pow(l,W),t=1-l,L=(1-M)/t+.5*M,p=U*L,B=Math.log(-p*(1-l)+1)/Math.log(l),k=Math.floor(B),A=k+1,q=(1-Math.pow(l,k))/(t*L),y=.5*(q+(1-Math.pow(l,A))/(t*L)),j=U-y,s=y-q;return-Math.pow(1/l,W-k)/(s*s)*(j-s)*(j+s)}}class k extends t{easeInCore(U){return U*U*U}}class A extends t{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=U,this.springiness=W}easeInCore(U){let W;const l=Math.max(0,this.oscillations),M=Math.max(0,this.springiness);return W=0==M?U:(Math.exp(M*U)-1)/(Math.exp(M)-1),W*Math.sin((6.283185307179586*l+1.5707963267948966)*U)}}class q extends t{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=U}easeInCore(U){return this.exponent<=0?U:(Math.exp(this.exponent*U)-1)/(Math.exp(this.exponent)-1)}}class y extends t{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=U,this.y1=W,this.x2=l,this.y2=M}easeInCore(U){return M.e.Interpolate(U,this.x1,this.y1,this.x2,this.y2)}}},12625:(U,W,l)=>{"use strict";l.d(W,{c:()=>p});var M=l(706),t=l(719),L=l(730);class p extends L.c{get _matrix(){return this._compose(),this.Rk}set _matrix(U){(U.updateFlag!==this.Rk.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Rk.p(U),this._markAsDirtyAndDecompose())}constructor(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(U,W.va(),!1),this.name=U,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=W,this.Rk=(null===t||void 0===t?void 0:t.clone())??M.c.Identity(),this._restMatrix=L??this.Rk.clone(),this._bindMatrix=p??this.Rk.clone(),this._index=B,this._absoluteMatrix=new M.c,this._absoluteBindMatrix=new M.c,this._absoluteInverseBindMatrix=new M.c,this._finalMatrix=new M.c,W.bones.push(this),this.setParent(l,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(U){this.setParent(U)}setParent(U){let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==U){if(this.parent){const U=this.parent.children.indexOf(this);-1!==U&&this.parent.children.splice(U,1)}this._parentNode=U,this.parent&&this.parent.children.push(this),W&&this._updateAbsoluteBindMatrices(),this.ek()}}getLocalMatrix(){return this._compose(),this.Rk}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(U){this._restMatrix.p(U)}setRestPose(U){this.setRestMatrix(U)}getBindPose(){return this.getBindMatrix()}setBindMatrix(U){this.wk(U)}setBindPose(U){this.setBindMatrix(U)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const U=M.f.ik[0],W=M.f.Quaternion[0],l=M.f.ik[1];this.getRestMatrix().decompose(U,W,l),this._linkedTransformNode.position.p(l),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??M.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(W),this._linkedTransformNode.yd.p(U)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(U){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=U,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.vd}set position(U){this._decompose(),this.vd.p(U),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(U){this.setRotation(U)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(U){this.setRotationQuaternion(U)}get yd(){return this.getScale()}set yd(U){this.setScale(U)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=M.l.Zero(),this._localRotation=M.e.Zero(),this.vd=M.l.Zero()),this.Rk.decompose(this._localScaling,this._localRotation,this.vd))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,M.c.ComposeToRef(this._localScaling,this._localRotation,this.vd,this.Rk)):this._needToCompose=!1)}wk(U){let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(U),W&&this._updateAbsoluteBindMatrices(),l?this._matrix=U:this.ek()}_updateAbsoluteBindMatrices(U){let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U||(U=this._bindMatrix),this.parent?U.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(U),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),W)for(let l=0;l<this.children.length;l++)this.children[l]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ek(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ek(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ek(),this._needToDecompose=!0}_updatePosition(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=this.getLocalMatrix();if(0==W)t?(L.addAtIndex(12,U.x),L.addAtIndex(13,U.y),L.addAtIndex(14,U.z)):L.setTranslationFromFloats(U.x,U.y,U.z);else{let W=null;l&&(W=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=p._TmpMats[0],k=p._TmpVecs[0];this.parent?l&&W?(B.p(this.parent.getAbsoluteMatrix()),B.multiplyToRef(W,B)):B.p(this.parent.getAbsoluteMatrix()):M.c.IdentityToRef(B),t&&B.setTranslationFromFloats(0,0,0),B.invert(),M.l.TransformCoordinatesToRef(U,B,k),t?(L.addAtIndex(12,k.x),L.addAtIndex(13,k.y),L.addAtIndex(14,k.z)):L.setTranslationFromFloats(k.x,k.y,k.z)}this._markAsDirtyAndDecompose()}translate(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,W,l,!0)}setPosition(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,W,l,!1)}setAbsolutePosition(U,W){this.setPosition(U,1,W)}scale(U,W,l){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=this.getLocalMatrix(),B=p._TmpMats[0];M.c.ScalingToRef(U,W,l,B),B.multiplyToRef(L,L),B.invert();for(const M of this.children){const t=M.getLocalMatrix();t.multiplyToRef(B,t),t.multiplyAtIndex(12,U),t.multiplyAtIndex(13,W),t.multiplyAtIndex(14,l),M._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),t)for(const M of this.children)M.scale(U,W,l,t)}setScale(U){this._decompose(),this._localScaling.p(U),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(U){this._decompose(),U.p(this._localScaling)}setYawPitchRoll(U,W,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4?arguments[4]:void 0;if(0===t){const B=p._TmpQuat;return M.e.RotationYawPitchRollToRef(U,W,l,B),void this.setRotationQuaternion(B,t,L)}const B=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,L))return;const k=p._TmpMats[1];M.c.RotationYawPitchRollToRef(U,W,l,k),B.multiplyToRef(k,k),this._rotateWithMatrix(k,t,L)}rotate(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;const L=p._TmpMats[0];L.setTranslationFromFloats(0,0,0),M.c.RotationAxisToRef(U,W,L),this._rotateWithMatrix(L,l,t)}setAxisAngle(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;if(0===l){const L=p._TmpQuat;return M.e.RotationAxisToRef(U,W,L),void this.setRotationQuaternion(L,l,t)}const L=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,t))return;const B=p._TmpMats[1];M.c.RotationAxisToRef(U,W,B),L.multiplyToRef(B,B),this._rotateWithMatrix(B,l,t)}setRotation(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(U.y,U.x,U.z,W,l)}setRotationQuaternion(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===W)return this._decompose(),this._localRotation.p(U),void this._markAsDirtyAndCompose();const t=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,l))return;const L=p._TmpMats[1];M.c.FromQuaternionToRef(U,L),t.multiplyToRef(L,L),this._rotateWithMatrix(L,W,l)}setRotationMatrix(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===W){const t=p._TmpQuat;return M.e.FromRotationMatrixToRef(U,t),void this.setRotationQuaternion(t,W,l)}const t=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,l))return;const L=p._TmpMats[1];L.p(U),t.multiplyToRef(U,L),this._rotateWithMatrix(L,W,l)}_rotateWithMatrix(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const M=this.getLocalMatrix(),t=M.m[12],L=M.m[13],B=M.m[14],k=this.getParent(),A=p._TmpMats[3],q=p._TmpMats[4];k&&1==W?(l?(A.p(l.getWorldMatrix()),k.getAbsoluteMatrix().multiplyToRef(A,A)):A.p(k.getAbsoluteMatrix()),q.p(A),q.invert(),M.multiplyToRef(A,M),M.multiplyToRef(U,M),M.multiplyToRef(q,M)):1==W&&l?(A.p(l.getWorldMatrix()),q.p(A),q.invert(),M.multiplyToRef(A,M),M.multiplyToRef(U,M),M.multiplyToRef(q,M)):M.multiplyToRef(U,M),M.setTranslationFromFloats(t,L,B),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(U,W){const l=p._TmpMats[2];return U.p(this.getAbsoluteMatrix()),W?(U.multiplyToRef(W.getWorldMatrix(),U),M.c.ScalingToRef(W.yd.x,W.yd.y,W.yd.z,l)):M.c.IdentityToRef(l),U.invert(),!isNaN(U.m[0])&&(l.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyToRef(l,U),!0)}vg(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=M.l.Zero();return this.getPositionToRef(U,W,l),l}getPositionToRef(){let U=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const U=this.getLocalMatrix();W.x=U.m[12],W.y=U.m[13],W.z=U.m[14]}else{let l=null;U&&(l=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let M=p._TmpMats[0];U&&l?(M.p(this.getAbsoluteMatrix()),M.multiplyToRef(l,M)):M=this.getAbsoluteMatrix(),W.x=M.m[12],W.y=M.m[13],W.z=M.m[14]}}getAbsolutePosition(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const W=M.l.Zero();return this.getPositionToRef(1,U,W),W}getAbsolutePositionToRef(U,W){this.getPositionToRef(1,U,W)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Rk.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Rk);const U=this._skeleton.getPoseMatrix();U&&this._absoluteMatrix.multiplyToRef(U,this._absoluteMatrix)}const U=this.children,W=U.length;for(let l=0;l<W;l++)U[l].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Eg(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=M.l.Zero();return this.getDirectionToRef(U,W,l),l}getDirectionToRef(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,t=null;W&&(t=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=p._TmpMats[0];L.p(this.getAbsoluteMatrix()),W&&t&&L.multiplyToRef(t,L),M.l.TransformNormalToRef(U,L,l),l.normalize()}getRotation(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=M.l.Zero();return this.getRotationToRef(U,W,l),l}getRotationToRef(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;const M=p._TmpQuat;this.getRotationQuaternionToRef(U,W,M),M.toEulerAnglesToRef(l)}getRotationQuaternion(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=M.e.Identity();return this.getRotationQuaternionToRef(U,W,l),l}getRotationQuaternionToRef(){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),W.p(this._localRotation);else{const l=p._TmpMats[0],M=this.getAbsoluteMatrix();U?M.multiplyToRef(U.getWorldMatrix(),l):l.p(M),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.decompose(void 0,W,void 0)}}getRotationMatrix(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=arguments.length>1?arguments[1]:void 0;const l=M.c.Identity();return this.getRotationMatrixToRef(U,W,l),l}getRotationMatrixToRef(){let U=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(W);else{const l=p._TmpMats[0],M=this.getAbsoluteMatrix();U?M.multiplyToRef(U.getWorldMatrix(),l):l.p(M),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.getRotationMatrixToRef(W)}}getAbsolutePositionFromLocal(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=M.l.Zero();return this.getAbsolutePositionFromLocalToRef(U,W,l),l}getAbsolutePositionFromLocalToRef(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,t=null;W&&(t=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=p._TmpMats[0];L.p(this.getAbsoluteMatrix()),W&&t&&L.multiplyToRef(t,L),M.l.TransformCoordinatesToRef(U,L,l)}getLocalPositionFromAbsolute(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=M.l.Zero();return this.getLocalPositionFromAbsoluteToRef(U,W,l),l}getLocalPositionFromAbsoluteToRef(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,t=null;W&&(t=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=p._TmpMats[0];L.p(this.getAbsoluteMatrix()),W&&t&&L.multiplyToRef(t,L),L.invert(),M.l.TransformCoordinatesToRef(U,L,l)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const U=this._skeleton.bones.indexOf(this);if(-1!==U&&this._skeleton.bones.splice(U,1),this._parentNode&&this._parentNode.children){const U=this._parentNode.children,W=U.indexOf(this);-1!==W&&U.splice(W,1)}super.dispose()}}p._TmpVecs=(0,t.d)(2,M.l.Zero),p._TmpQuat=M.e.Identity(),p._TmpMats=(0,t.d)(5,M.c.Identity)},12991:(U,W,l)=>{"use strict";l.d(W,{b:()=>x});var M=l(686),t=l(688),L=l(496),p=l(706),B=l(722),k=l(730),A=l(487),q=l(2203),y=l(524),j=l(711);class s{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(U){this._idleRotationSpeed=U}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(U){this._idleRotationWaitTime=U}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(U){this._idleRotationSpinupTime=U}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(U){this._attachedCamera=U;const W=this._attachedCamera.va();this._onPrePointerObservableObserver=W.onPrePointerObservable.add((U=>{U.type!==q.b.POINTERDOWN?U.type===q.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const U=y.d.Now;let W=0;null!=this._lastFrameTime&&(W=U-this._lastFrameTime),this._lastFrameTime=U,this._applyUserInteraction();const l=U-this._lastInteractionTime-this._idleRotationWaitTime,M=Math.max(Math.min(l/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*M,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(W/1e3))}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.va();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(U){this._lastInteractionTime=U??y.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<j.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let U=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(U=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?U:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=y.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var w=l(12995),K=l(11860);class r{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(U){if(this._autoTransitionRange===U)return;this._autoTransitionRange=U;const W=this._attachedCamera;W&&(U?this._onMeshTargetChangedObserver=W.onMeshTargetChangedObservable.add((U=>{if(U&&(U.fk(!0),U.getBoundingInfo)){const W=U.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*W,this.upperRadiusTransitionRange=.05*W}})):this._onMeshTargetChangedObserver&&W.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(U){this._attachedCamera=U,this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(U){return!!this._attachedCamera&&(this._attachedCamera.radius===U&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(U){if(!this._attachedCamera)return;this._radiusBounceTransition||(r.EasingFunction.setEasingMode(r.EasingMode),this._radiusBounceTransition=K.c.CreateAnimation("radius",K.c.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const W=K.c.TransitionTo("radius",this._attachedCamera.radius+U,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));W&&this._animatables.push(W)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}r.EasingFunction=new w.b(.3),r.EasingMode=w.n.EASINGMODE_EASEOUT;class m{constructor(){this.onTargetFramingAnimationEndObservable=new L.b,this._mode=m.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(U){this._mode=U}get mode(){return this._mode}set radiusScale(U){this._radiusScale=U}get radiusScale(){return this._radiusScale}set positionScale(U){this._positionScale=U}get positionScale(){return this._positionScale}set defaultElevation(U){this._defaultElevation=U}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(U){this._elevationReturnTime=U}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(U){this._elevationReturnWaitTime=U}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(U){this._framingTime=U}get framingTime(){return this._framingTime}init(){}attach(U){this._attachedCamera=U;const W=this._attachedCamera.va();m.EasingFunction.setEasingMode(m.EasingMode),this._onPrePointerObservableObserver=W.onPrePointerObservable.add((U=>{U.type!==q.b.POINTERDOWN?U.type===q.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((U=>{U&&U.getBoundingInfo&&this.zoomOnMesh(U,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.va();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.fk(!0);const M=U.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(M.minimumWorld,M.maximumWorld,W,l)}zoomOnMeshHierarchy(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.fk(!0);const M=U.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(M.min,M.max,W,l)}zoomOnMeshesHierarchy(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new p.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new p.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let L=0;L<U.length;L++){const W=U[L].getHierarchyBoundingVectors(!0);p.l.CheckExtends(W.min,M,t),p.l.CheckExtends(W.max,M,t)}this.zoomOnBoundingInfo(M,t,W,l)}zoomOnBoundingInfo(U,W){let l,M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const L=U.y,B=L+(W.y-L)*this._positionScale,k=W.de(U).scale(.5);if(!isFinite(B))return!1;if(M)l=new p.l(0,B,0);else{const W=U.add(k);l=new p.l(W.x,B,W.z)}this._vectorTransition||(this._vectorTransition=K.c.CreateAnimation("target",K.c.ANIMATIONTYPE_VECTOR3,60,m.EasingFunction)),this._betaIsAnimating=!0;let A=K.c.TransitionTo("target",l,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);A&&this._animatables.push(A);let q=0;if(this._mode===m.FitFrustumSidesMode){const l=this._calculateLowerRadiusFromModelBoundingSphere(U,W);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=k.length()+this._attachedCamera.bk),q=l}else this._mode===m.IgnoreBoundsSizeMode&&(q=this._calculateLowerRadiusFromModelBoundingSphere(U,W),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.bk));if(this.autoCorrectCameraLimitsAndSensibility){const l=W.de(U).length();this._attachedCamera.panningSensibility=5e3/l,this._attachedCamera.wheelPrecision=100/q}return this._radiusTransition||(this._radiusTransition=K.c.CreateAnimation("radius",K.c.ANIMATIONTYPE_FLOAT,60,m.EasingFunction)),A=K.c.TransitionTo("radius",q,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),t&&t(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),A&&this._animatables.push(A),!0}_calculateLowerRadiusFromModelBoundingSphere(U,W){const l=this._attachedCamera;if(!l)return 0;let M=l._calculateLowerRadiusFromModelBoundingSphere(U,W,this._radiusScale);return l.lowerRadiusLimit&&this._mode===m.IgnoreBoundsSizeMode&&(M=M<l.lowerRadiusLimit?l.lowerRadiusLimit:M),l.upperRadiusLimit&&(M=M>l.upperRadiusLimit?l.upperRadiusLimit:M),M}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const U=y.d.Now-this._lastInteractionTime,W=.5*Math.PI-this._defaultElevation,l=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>l&&U>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=K.c.CreateAnimation("beta",K.c.ANIMATIONTYPE_FLOAT,60,m.EasingFunction));const U=K.c.TransitionTo("beta",W,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));U&&this._animatables.push(U)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=y.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}m.EasingFunction=new w.t,m.EasingMode=w.n.EASINGMODE_EASEINOUT,m.IgnoreBoundsSizeMode=0,m.FitFrustumSidesMode=1;var f=l(677),g=l(11789),E=l(12617),Z=l(503);class N{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(U){U=Z.h.BackCompatCameraNoPreventDefault(arguments);const W=this.camera.getEngine(),l=W.getInputElement();let M=0,t=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=L=>{var p,B;const k=L.event,A="touch"===k.pointerType;if(L.type!==q.b.POINTERMOVE&&-1===this.buttons.indexOf(k.button))return;const y=k.target;if(this._altKey=k.altKey,this._ctrlKey=k.ctrlKey,this._metaKey=k.metaKey,this._shiftKey=k.shiftKey,this._buttonsPressed=k.buttons,W.isPointerLock){const U=k.movementX,W=k.movementY;this.onTouch(null,U,W),this._pointA=null,this._pointB=null}else{if(L.type!==q.b.POINTERDOWN&&L.type!==q.b.POINTERDOUBLETAP&&A&&(null===(p=this._pointA)||void 0===p?void 0:p.pointerId)!==k.pointerId&&(null===(B=this._pointB)||void 0===B?void 0:B.pointerId)!==k.pointerId)return;if(L.type!==q.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!A)if(L.type===q.b.POINTERDOUBLETAP)this.onDoubleTap(k.pointerType);else if(L.type!==q.b.POINTERUP||this._currentMousePointerIdDown!==k.pointerId&&!A){if(L.type===q.b.POINTERMOVE)if(U||k.preventDefault(),this._pointA&&null===this._pointB){const U=k.clientX-this._pointA.x,W=k.clientY-this._pointA.y;this._pointA.x=k.clientX,this._pointA.y=k.clientY,this.onTouch(this._pointA,U,W)}else if(this._pointA&&this._pointB){const U=this._pointA.pointerId===k.pointerId?this._pointA:this._pointB;U.x=k.clientX,U.y=k.clientY;const W=this._pointA.x-this._pointB.x,l=this._pointA.y-this._pointB.y,p=W*W+l*l,B={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:k.pointerId,type:L.type};this.onMultiTouch(this._pointA,this._pointB,M,p,t,B),t=B,M=p}}else{try{null===y||void 0===y||y.releasePointerCapture(k.pointerId)}catch(j){}A||(this._pointB=null),W._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==k.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==k.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==M||t)&&(this.onMultiTouch(this._pointA,this._pointB,M,0,t,null),M=0,t=null),this._currentMousePointerIdDown=-1,this.onButtonUp(k),U||k.preventDefault()}else{try{null===y||void 0===y||y.setPointerCapture(k.pointerId)}catch(j){}if(null===this._pointA)this._pointA={x:k.clientX,y:k.clientY,pointerId:k.pointerId,type:k.pointerType};else{if(null!==this._pointB)return;this._pointB={x:k.clientX,y:k.clientY,pointerId:k.pointerId,type:k.pointerType}}-1!==this._currentMousePointerIdDown||A||(this._currentMousePointerIdDown=k.pointerId),this.onButtonDown(k),U||(k.preventDefault(),l&&l.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,q.b.POINTERDOWN|q.b.POINTERUP|q.b.POINTERMOVE|q.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,M=0,t=null,this.onLostFocus()},this._contextMenuBind=U=>this.onContextMenu(U),l&&l.addEventListener("contextmenu",this._contextMenuBind,!1);const L=this.camera.va().getEngine().getHostWindow();L&&Z.h.RegisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}dk(){if(this._onLostFocus){const U=this.camera.va().getEngine().getHostWindow();U&&Z.h.UnregisterTopRootEvents(U,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const U=this.camera.va().getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(U){}onTouch(U,W,l){}onMultiTouch(U,W,l,M,t,L){}onContextMenu(U){U.preventDefault()}onButtonDown(U){}onButtonUp(U){}onLostFocus(){}}(0,M.e)([(0,t.T)()],N.prototype,"buttons",void 0);class D extends N{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(U,W){if(0!==this.panningSensibility&&U&&W){const l=W.x-U.x,M=W.y-U.y;this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=M/this.panningSensibility}}_computePinchZoom(U,W){const l=this.camera.radius||D.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=l*Math.sqrt(U)/Math.sqrt(W):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(W-U)*l*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(W-U)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(U,W,l){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-W/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility):(this.camera.inertialAlphaOffset-=W/this.angularSensibilityX,this.camera.inertialBetaOffset-=l/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(U,W,l,M,t,L){0===l&&null===t||0===M&&null===L||(this.multiTouchPanAndZoom?(this._computePinchZoom(l,M),this._computeMultiTouchPanning(t,L)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(M)-Math.sqrt(l))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(l,M),this._isPinching=!0):this._computeMultiTouchPanning(t,L)):this.multiTouchPanning?this._computeMultiTouchPanning(t,L):this.pinchZoom&&this._computePinchZoom(l,M))}onButtonDown(U){this._isPanClick=U.button===this.camera._panningMouseButton}onButtonUp(U){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}D.MinimumRadiusForPinch=.001,(0,M.e)([(0,t.T)()],D.prototype,"buttons",void 0),(0,M.e)([(0,t.T)()],D.prototype,"angularSensibilityX",void 0),(0,M.e)([(0,t.T)()],D.prototype,"angularSensibilityY",void 0),(0,M.e)([(0,t.T)()],D.prototype,"pinchPrecision",void 0),(0,M.e)([(0,t.T)()],D.prototype,"pinchDeltaPercentage",void 0),(0,M.e)([(0,t.T)()],D.prototype,"useNaturalPinchZoom",void 0),(0,M.e)([(0,t.T)()],D.prototype,"pinchZoom",void 0),(0,M.e)([(0,t.T)()],D.prototype,"panningSensibility",void 0),(0,M.e)([(0,t.T)()],D.prototype,"multiTouchPanning",void 0),(0,M.e)([(0,t.T)()],D.prototype,"multiTouchPanAndZoom",void 0),E.b.ArcRotateCameraPointersInput=D;var o=l(2210);class i{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(U){U=Z.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((W=>{const l=W.event;if(!l.metaKey)if(W.type===o.c.KEYDOWN){if(this._ctrlPressed=l.ctrlKey,this._altPressed=l.altKey,-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),l.preventDefault&&(U||l.preventDefault())}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){const W=this._keys.indexOf(l.keyCode);W>=0&&this._keys.splice(W,1),l.preventDefault&&(U||l.preventDefault())}})))}dk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let W=0;W<this._keys.length;W++){const l=this._keys[W];-1!==this.keysLeft.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX-=1/this.panningSensibility:U.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset+=1/this.zoomingSensibility:U.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX+=1/this.panningSensibility:U.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset-=1/this.zoomingSensibility:U.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(l)&&U.useInputToRestoreState&&U.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,M.e)([(0,t.T)()],i.prototype,"keysUp",void 0),(0,M.e)([(0,t.T)()],i.prototype,"keysDown",void 0),(0,M.e)([(0,t.T)()],i.prototype,"keysLeft",void 0),(0,M.e)([(0,t.T)()],i.prototype,"keysRight",void 0),(0,M.e)([(0,t.T)()],i.prototype,"keysReset",void 0),(0,M.e)([(0,t.T)()],i.prototype,"panningSensibility",void 0),(0,M.e)([(0,t.T)()],i.prototype,"zoomingSensibility",void 0),(0,M.e)([(0,t.T)()],i.prototype,"useAltToZoom",void 0),(0,M.e)([(0,t.T)()],i.prototype,"angularSpeed",void 0),E.b.ArcRotateCameraKeyboardMoveInput=i;var O=l(756),e=l(2213);class d{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new p.l(0,0,0),this._globalOffset=new p.l(0,0,0),this._inertialPanning=p.l.Zero()}_computeDeltaFromMouseWheelLegacyEvent(U,W){let l=0;const M=.01*U*this.wheelDeltaPercentage*W;return l=U>0?M/(1+this.wheelDeltaPercentage):M*(1+this.wheelDeltaPercentage),l}attachControl(U){U=Z.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=W=>{if(W.type!==q.b.POINTERWHEEL)return;const l=W.event;let M=0;const t=l.deltaMode===e.b.DOM_DELTA_LINE?40:1,L=-l.deltaY*t;if(this.customComputeDeltaFromMouseWheel)M=this.customComputeDeltaFromMouseWheel(L,this,l);else if(this.wheelDeltaPercentage){if(M=this._computeDeltaFromMouseWheelLegacyEvent(L,this.camera.radius),M>0){let U=this.camera.radius,W=this.camera.inertialRadiusOffset+M;for(let l=0;l<20&&!(U<=W)&&!(Math.abs(W*this.camera.inertia)<.001);l++)U-=W,W*=this.camera.inertia;U=(0,B.Clamp)(U,0,Number.MAX_VALUE),M=this._computeDeltaFromMouseWheelLegacyEvent(L,U)}}else M=L/(40*this.wheelPrecision);M&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(M)):this.camera.inertialRadiusOffset+=M),l.preventDefault&&(U||l.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,q.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.jk(0)}dk(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const U=this.camera;0+U.inertialAlphaOffset+U.inertialBetaOffset+U.inertialRadiusOffset&&(this._updateHitPlane(),U.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(U.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const U=this.camera,W=U.target.de(U.position);this._hitPlane=O.d.FromPositionAndNormal(U.target,W)}_getPosition(){const U=this.camera,W=U.va(),l=W.createPickingRay(W.pointerX,W.pointerY,p.c.Identity(),U,!1);0===U.targetScreenOffset.x&&0===U.targetScreenOffset.y||(this._viewOffset.set(U.targetScreenOffset.x,U.targetScreenOffset.y,0),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),this._globalOffset=p.l.TransformNormal(this._viewOffset,U._cameraTransformMatrix),l.origin.addInPlace(this._globalOffset));let M=0;return this._hitPlane&&(M=l.intersectsPlane(this._hitPlane)??0),l.origin.addInPlace(l.direction.scaleInPlace(M))}_zoomToMouse(U){const W=this.camera,l=1-W.inertia;if(W.lowerRadiusLimit){const M=W.lowerRadiusLimit??0;W.radius-(W.inertialRadiusOffset+U)/l<M&&(U=(W.radius-M)*l-W.inertialRadiusOffset)}if(W.upperRadiusLimit){const M=W.upperRadiusLimit??0;W.radius-(W.inertialRadiusOffset+U)/l>M&&(U=(W.radius-M)*l-W.inertialRadiusOffset)}const M=U/l/W.radius,t=this._getPosition(),L=p.f.ik[6];t.subtractToRef(W.target,L),L.scaleInPlace(M),L.scaleInPlace(l),this._inertialPanning.addInPlace(L),W.inertialRadiusOffset+=U}_zeroIfClose(U){Math.abs(U.x)<j.d&&(U.x=0),Math.abs(U.y)<j.d&&(U.y=0),Math.abs(U.z)<j.d&&(U.z=0)}}(0,M.e)([(0,t.T)()],d.prototype,"wheelPrecision",void 0),(0,M.e)([(0,t.T)()],d.prototype,"zoomToMouseLocation",void 0),(0,M.e)([(0,t.T)()],d.prototype,"wheelDeltaPercentage",void 0),E.b.ArcRotateCameraMouseWheelInput=d;class H extends E.c{constructor(U){super(U)}addMouseWheel(){return this.add(new d),this}addPointers(){return this.add(new D),this}addKeyboard(){return this.add(new i),this}}var V=l(655);function n(U,W){return isNaN(U)?W:U}k.c.AddNodeConstructor("ArcRotateCamera",((U,W)=>()=>new x(U,0,0,1,p.l.Zero(),W)));class x extends g.b{get target(){return this._target}set target(U){this.setTarget(U)}get targetHost(){return this._targetHost}set targetHost(U){U&&this.setTarget(U)}getTarget(){return this.target}get position(){return this._position}set position(U){this.setPosition(U)}set upVector(U){this._upToYMatrix||(this._yToUpMatrix=new p.c,this._upToYMatrix=new p.c,this._upVector=p.l.Zero()),U.normalize(),this._upVector.p(U),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){p.c.RotationAlignToRef(p.l.UpReadOnly,this._upVector,this._yToUpMatrix),p.c.RotationAlignToRef(this._upVector,p.l.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityX:0}set angularSensibilityX(U){const W=this.inputs.attached.pointers;W&&(W.angularSensibilityX=U)}get angularSensibilityY(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityY:0}set angularSensibilityY(U){const W=this.inputs.attached.pointers;W&&(W.angularSensibilityY=U)}get pinchPrecision(){const U=this.inputs.attached.pointers;return U?U.pinchPrecision:0}set pinchPrecision(U){const W=this.inputs.attached.pointers;W&&(W.pinchPrecision=U)}get pinchDeltaPercentage(){const U=this.inputs.attached.pointers;return U?U.pinchDeltaPercentage:0}set pinchDeltaPercentage(U){const W=this.inputs.attached.pointers;W&&(W.pinchDeltaPercentage=U)}get useNaturalPinchZoom(){const U=this.inputs.attached.pointers;return!!U&&U.useNaturalPinchZoom}set useNaturalPinchZoom(U){const W=this.inputs.attached.pointers;W&&(W.useNaturalPinchZoom=U)}get panningSensibility(){const U=this.inputs.attached.pointers;return U?U.panningSensibility:0}set panningSensibility(U){const W=this.inputs.attached.pointers;W&&(W.panningSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const W=this.inputs.attached.keyboard;W&&(W.keysUp=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const W=this.inputs.attached.keyboard;W&&(W.keysDown=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const W=this.inputs.attached.keyboard;W&&(W.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const W=this.inputs.attached.keyboard;W&&(W.keysRight=U)}get wheelPrecision(){const U=this.inputs.attached.mousewheel;return U?U.wheelPrecision:0}set wheelPrecision(U){const W=this.inputs.attached.mousewheel;W&&(W.wheelPrecision=U)}get zoomToMouseLocation(){const U=this.inputs.attached.mousewheel;return!!U&&U.zoomToMouseLocation}set zoomToMouseLocation(U){const W=this.inputs.attached.mousewheel;W&&(W.zoomToMouseLocation=U)}get wheelDeltaPercentage(){const U=this.inputs.attached.mousewheel;return U?U.wheelDeltaPercentage:0}set wheelDeltaPercentage(U){const W=this.inputs.attached.mousewheel;W&&(W.wheelDeltaPercentage=U)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(U){U!==this.useBouncingBehavior&&(U?(this._bouncingBehavior=new r,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(U){U!==this.useFramingBehavior&&(U?(this._framingBehavior=new m,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(U){U!==this.useAutoRotationBehavior&&(U?(this._autoRotationBehavior=new s,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(U,W,l,M,t,B){var k;let A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(U,p.l.Zero(),B,A),k=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=p.l.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=p.h.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new p.c,this.panningAxis=new p.l(1,1,0),this._transformedDirection=new p.l,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new L.b,this.checkCollisions=!1,this.collisionRadius=new p.l(.5,.5,.5),this._previousPosition=p.l.Zero(),this._collisionVelocity=p.l.Zero(),this._newPosition=p.l.Zero(),this._computationVector=p.l.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new p.l(NaN,NaN,NaN),this._goalTargetScreenOffset=new p.h(NaN,NaN),this._onCollisionPositionChange=function(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l?(k.setPosition(W),k.Ie&&k.Ie(l)):k._previousPosition.p(k._position);const M=Math.cos(k.alpha),t=Math.sin(k.alpha),L=Math.cos(k.beta);let p=Math.sin(k.beta);0===p&&(p=1e-4);const B=k._getTargetPosition();k._computationVector.wd(k.radius*M*p,k.radius*L,k.radius*t*p),B.addToRef(k._computationVector,k._newPosition),k._position.p(k._newPosition);let A=k.upVector;k.allowUpsideDown&&k.beta<0&&(A=A.clone(),A=A.negate()),k._computeViewMatrix(k._position,B,A),k._viewMatrix.addAtIndex(12,k.targetScreenOffset.x),k._viewMatrix.addAtIndex(13,k.targetScreenOffset.y),k._collisionTriggered=!1},this._target=p.l.Zero(),t&&this.setTarget(t),this.alpha=W,this.beta=l,this.radius=M,this.getViewMatrix(),this.inputs=new H(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new p.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=p.h.Zero()}_updateCache(U){U||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const U=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?U.addToRef(this._targetBoundingCenter,this._target):this._target.p(U)}const U=this._getLockedTargetPosition();return U||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>j.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,L=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=L?this._currentInterpolationFactor=L:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=n(U,this._goalAlpha),this._goalBeta=n(W,this._goalBeta),this._goalRadius=n(l,this._goalRadius),this._goalTarget.set(n(M.x,this._goalTarget.x),n(M.y,this._goalTarget.y),n(M.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(n(t.x,this._goalTargetScreenOffset.x),n(t.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,B.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,B.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,B.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,B.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(U,W){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const t=arguments;W=Z.h.BackCompatCameraNoPreventDefault(t),this._useCtrlForPanning=l,this._panningMouseButton=M,"boolean"===typeof t[0]&&(t.length>1&&(this._useCtrlForPanning=t[1]),t.length>2&&(this._panningMouseButton=t[2])),this.inputs.attachElement(W),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}dk(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let U=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){U=!0;const W=this.invertRotation?-1:1,l=this._calculateHandednessMultiplier();let M=this.inertialAlphaOffset*l;this.beta<0&&(M*=-1),this.alpha+=M*W,this.beta+=this.inertialBetaOffset*W,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<j.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<j.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*j.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){U=!0;const W=new p.l(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),W.multiplyInPlace(this.panningAxis),p.l.TransformNormalToRef(W,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const U=this.upVector,W=p.l.CrossToRef(this._transformedDirection,U,this._transformedDirection);p.l.CrossToRef(U,W,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);p.l.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const U=p.f.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(U),U.transposeToRef(U),p.l.TransformCoordinatesToRef(this._transformedDirection,U,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*j.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*j.d&&(this.inertialPanningY=0)}if(U)this.stopInterpolation();else if(this._isInterpolating){let U=!1;const W=this._scene.getEngine().getDeltaTime()/1e3,l=1-Math.pow(2,-W/this._currentInterpolationFactor),M=n(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const W=p.f.ik[0].set(n(this._goalTarget.x,this._target.x),n(this._goalTarget.y,this._target.y),n(this._goalTarget.z,this._target.z));p.l.LerpToRef(this.target,W,l,this._target),10*p.l.Distance(this.target,W)/M<j.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(W),this.setTarget(this.target,!1,!0,!0)):U=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const W=p.e.RotationAlphaBetaGammaToRef(n(this._goalAlpha,this.alpha),n(this._goalBeta,this.beta),0,p.f.Quaternion[0]),M=p.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,p.f.Quaternion[1]),t=p.e.SlerpToRef(M,W,l,p.f.Quaternion[2]);t.normalize();const L=t.toAlphaBetaGammaToRef(p.f.ik[0]);if(this.alpha=L.x,this.beta=L.y,t.isApprox(W,j.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const U=W.toAlphaBetaGammaToRef(p.f.ik[0]);this.alpha=U.x,this.beta=U.y}else U=!0}if(isNaN(this._goalRadius)||(this.radius+=(M-this.radius)*l,Math.abs(M/this.radius-1)<j.d?(this._goalRadius=NaN,this.radius=M):U=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const W=p.f.Vector2[0].set(n(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),n(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));p.h.LerpToRef(this.targetScreenOffset,W,l,this.targetScreenOffset),p.h.Distance(this.targetScreenOffset,W)<j.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(W)):U=!0}this._isInterpolating=U}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.l.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const U=this.alpha;var W,l;this.alpha=function(U){let W=Math.PI/2;return 0===U.x&&0===U.z||(W=Math.acos(U.x/Math.sqrt(Math.pow(U.x,2)+Math.pow(U.z,2)))),U.z<0&&(W=2*Math.PI-W),W}(this._computationVector),this.beta=(W=this._computationVector.y,l=this.radius,Math.acos(W/l));const M=Math.round((U-this.alpha)/(2*Math.PI));this.alpha+=2*M*Math.PI,this._checkLimits()}setPosition(U){this._position.equals(U)||(this._position.p(U),this.rebuildAnglesAndRadius())}setTarget(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(M=this.overrideCloneAlphaBetaRadius??M,U.fk)W&&U.getBoundingInfo?this._targetBoundingCenter=U.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,U.fk(),this._targetHost=U,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const W=U,M=this._getTargetPosition();if(M&&!l&&M.equals(W))return;this._targetHost=null,this._target=W,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}M||this.rebuildAnglesAndRadius()}_getViewMatrix(){const U=Math.cos(this.alpha),W=Math.sin(this.alpha),l=Math.cos(this.beta);let M=Math.sin(this.beta);0===M&&(M=1e-4),0===this.radius&&(this.radius=1e-4);const t=this._getTargetPosition();if(this._computationVector.wd(this.radius*U*M,this.radius*l,this.radius*W*M),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.l.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),t.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const U=this.va().collisionCoordinator;this._collider||(this._collider=U.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,U.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let U=this.upVector;this.allowUpsideDown&&M<0&&(U=U.negate()),this._computeViewMatrix(this._position,t,U),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(t),this._viewMatrix}zoomOn(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U=U||this.va().meshes;const l=A.e.MinMax(U);let M=this._calculateLowerRadiusFromModelBoundingSphere(l.min,l.max);if(M=Math.max(Math.min(M,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=M*this.zoomOnFactor,this.mode===f.d.ORTHOGRAPHIC_CAMERA){const U=this.va().getEngine().getAspectRatio(this),W=M*this.zoomOnFactor/2;this.orthoLeft=-W*U,this.orthoRight=W*U,this.orthoBottom=-W,this.orthoTop=W}this.focusOn({min:l.min,max:l.max,distance:M},W)}focusOn(U){let W,l,M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===U.min){const M=U||this.va().meshes;W=A.e.MinMax(M),l=p.l.Distance(W.min,W.max)}else{W=U,l=U.distance}this._target=A.e.Center(W),M||(this.maxZ=2*l)}createRigCamera(U,W){let l=0;switch(this.cameraRigMode){case f.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.d.RIG_MODE_VR:l=this._cameraRigParams.stereoHalfAngle*(0===W?1:-1);break;case f.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:l=this._cameraRigParams.stereoHalfAngle*(0===W?-1:1)}const M=new x(U,this.alpha+l,this.beta,this.radius,this._target,this.va());return M._cameraRigParams={},M.isRigCamera=!0,M.rigParent=this,M.upVector=this.upVector,M.mode=this.mode,M.orthoLeft=this.orthoLeft,M.orthoRight=this.orthoRight,M.orthoBottom=this.orthoBottom,M.orthoTop=this.orthoTop,M}_updateRigCameras(){const U=this._rigCameras[0],W=this._rigCameras[1];switch(U.beta=W.beta=this.beta,this.cameraRigMode){case f.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.d.RIG_MODE_VR:U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,W.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case f.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,W.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const M=p.l.Distance(U,W),t=this.va().getEngine().getAspectRatio(this),L=Math.tan(this.fov/2),B=L*t,k=.5*M*l,A=k*Math.sqrt(1+1/(B*B)),q=k*Math.sqrt(1+1/(L*L));return Math.max(A,q)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,M.e)([(0,t.T)()],x.prototype,"alpha",void 0),(0,M.e)([(0,t.T)()],x.prototype,"beta",void 0),(0,M.e)([(0,t.T)()],x.prototype,"radius",void 0),(0,M.e)([(0,t.T)()],x.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,M.e)([(0,t.R)("target")],x.prototype,"_target",void 0),(0,M.e)([(0,t.D)("targetHost")],x.prototype,"_targetHost",void 0),(0,M.e)([(0,t.T)()],x.prototype,"inertialAlphaOffset",void 0),(0,M.e)([(0,t.T)()],x.prototype,"inertialBetaOffset",void 0),(0,M.e)([(0,t.T)()],x.prototype,"inertialRadiusOffset",void 0),(0,M.e)([(0,t.T)()],x.prototype,"lowerAlphaLimit",void 0),(0,M.e)([(0,t.T)()],x.prototype,"upperAlphaLimit",void 0),(0,M.e)([(0,t.T)()],x.prototype,"lowerBetaLimit",void 0),(0,M.e)([(0,t.T)()],x.prototype,"upperBetaLimit",void 0),(0,M.e)([(0,t.T)()],x.prototype,"lowerRadiusLimit",void 0),(0,M.e)([(0,t.T)()],x.prototype,"upperRadiusLimit",void 0),(0,M.e)([(0,t.T)()],x.prototype,"lowerTargetYLimit",void 0),(0,M.e)([(0,t.T)()],x.prototype,"inertialPanningX",void 0),(0,M.e)([(0,t.T)()],x.prototype,"inertialPanningY",void 0),(0,M.e)([(0,t.T)()],x.prototype,"pinchToPanMaxDistance",void 0),(0,M.e)([(0,t.T)()],x.prototype,"panningDistanceLimit",void 0),(0,M.e)([(0,t.R)()],x.prototype,"panningOriginTarget",void 0),(0,M.e)([(0,t.T)()],x.prototype,"panningInertia",void 0),(0,M.e)([(0,t.T)()],x.prototype,"zoomToMouseLocation",null),(0,M.e)([(0,t.T)()],x.prototype,"zoomOnFactor",void 0),(0,M.e)([(0,t.O)()],x.prototype,"targetScreenOffset",void 0),(0,M.e)([(0,t.T)()],x.prototype,"allowUpsideDown",void 0),(0,M.e)([(0,t.T)()],x.prototype,"useInputToRestoreState",void 0),(0,M.e)([(0,t.T)()],x.prototype,"restoreStateInterpolationFactor",void 0),(0,V.f)("BABYLON.ArcRotateCamera",x)},12617:(U,W,l)=>{"use strict";l.d(W,{b:()=>p,c:()=>B});var M=l(512),t=l(734),L=l(677),p={};class B{constructor(U){this.attachedToElement=!1,this.attached={},this.camera=U,this.checkInputs=()=>{}}add(U){const W=U.getSimpleName();this.attached[W]?M.b.Warn("camera input of type "+W+" already exists on camera"):(this.attached[W]=U,U.camera=this.camera,U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U))),this.attachedToElement&&U.attachControl(this.noPreventDefault))}remove(U){for(const W in this.attached){const l=this.attached[W];if(l===U)return l.dk(),l.camera=null,delete this.attached[W],void this.rebuildInputCheck()}}removeByType(U){for(const W in this.attached){const l=this.attached[W];l.getClassName()===U&&(l.dk(),l.camera=null,delete this.attached[W],this.rebuildInputCheck())}}_addCheckInputs(U){const W=this.checkInputs;return()=>{W(),U()}}attachInput(U){this.attachedToElement&&U.attachControl(this.noPreventDefault)}attachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){U=!L.d.ForceAttachControlToAlwaysPreventDefault&&U,this.attachedToElement=!0,this.noPreventDefault=U;for(const W in this.attached)this.attached[W].attachControl(U)}}detachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const W in this.attached)this.attached[W].dk(),U&&(this.attached[W].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const U in this.attached){const W=this.attached[U];W.checkInputs&&(this.checkInputs=this._addCheckInputs(W.checkInputs.bind(W)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(U){const W={};for(const l in this.attached){const U=this.attached[l],M=t.e.Serialize(U);W[U.getClassName()]=M}U.inputsmgr=W}parse(U){const W=U.inputsmgr;if(W){this.clear();for(const U in W){const l=p[U];if(l){const M=W[U],L=t.e.Parse((()=>new l),M,null);this.add(L)}}}else for(const l in this.attached){const W=p[this.attached[l].getClassName()];if(W){const M=t.e.Parse((()=>new W),U,null);this.remove(this.attached[l]),this.add(M)}}}}},12614:(U,W,l)=>{"use strict";l.d(W,{c:()=>N});var M=l(686),t=l(688),L=l(706),p=l(11789),B=l(12617),k=l(2210),A=l(503);class q{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(U){U=A.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((W=>{const l=W.event;if(!l.metaKey)if(W.type===k.c.KEYDOWN){if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),U||l.preventDefault()}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){const W=this._keys.indexOf(l.keyCode);W>=0&&this._keys.splice(W,1),U||l.preventDefault()}})))}dk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let W=0;W<this._keys.length;W++){const l=this._keys[W],M=U._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(l)?U._localDirection.wd(-M,0,0):-1!==this.keysUp.indexOf(l)?U._localDirection.wd(0,0,M):-1!==this.keysRight.indexOf(l)?U._localDirection.wd(M,0,0):-1!==this.keysDown.indexOf(l)?U._localDirection.wd(0,0,-M):-1!==this.keysUpward.indexOf(l)?U._localDirection.wd(0,M,0):-1!==this.keysDownward.indexOf(l)?U._localDirection.wd(0,-M,0):-1!==this.keysRotateLeft.indexOf(l)?(U._localDirection.wd(0,0,0),U.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(l)?(U._localDirection.wd(0,0,0),U.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(l)?(U._localDirection.wd(0,0,0),U.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(l)&&(U._localDirection.wd(0,0,0),U.cameraRotation.x+=this._getLocalRotation()),U.va().useRightHandedSystem&&(U._localDirection.z*=-1),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),L.l.TransformNormalToRef(U._localDirection,U._cameraTransformMatrix,U._transformedDirection),U.cameraDirection.addInPlace(U._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const U=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*U}}(0,M.e)([(0,t.T)()],q.prototype,"keysUp",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysUpward",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysDown",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysDownward",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysLeft",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysRight",void 0),(0,M.e)([(0,t.T)()],q.prototype,"rotationSpeed",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysRotateLeft",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysRotateRight",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysRotateUp",void 0),(0,M.e)([(0,t.T)()],q.prototype,"keysRotateDown",void 0),B.b.FreeCameraKeyboardMoveInput=q;var y=l(496),j=l(2203);class s{constructor(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=U,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new y.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(U){U=A.h.BackCompatCameraNoPreventDefault(arguments);const W=this.camera.getEngine(),l=W.getInputElement();this._pointerInput||(this._pointerInput=M=>{const t=M.event,L="touch"===t.pointerType;if(!this.touchEnabled&&L)return;if(M.type!==j.b.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const p=t.target;if(M.type===j.b.POINTERDOWN){if(L&&-1!==this._activePointerId||!L&&-1!==this._currentActiveButton)return;this._activePointerId=t.pointerId;try{null===p||void 0===p||p.setPointerCapture(t.pointerId)}catch(B){}-1===this._currentActiveButton&&(this._currentActiveButton=t.button),this._previousPosition={x:t.clientX,y:t.clientY},U||(t.preventDefault(),l&&l.focus()),W.isPointerLock&&this._onMouseMove&&this._onMouseMove(M.event)}else if(M.type===j.b.POINTERUP){if(L&&this._activePointerId!==t.pointerId||!L&&this._currentActiveButton!==t.button)return;try{null===p||void 0===p||p.releasePointerCapture(t.pointerId)}catch(B){}this._currentActiveButton=-1,this._previousPosition=null,U||t.preventDefault(),this._activePointerId=-1}else if(M.type===j.b.POINTERMOVE&&(this._activePointerId===t.pointerId||!L))if(W.isPointerLock&&this._onMouseMove)this._onMouseMove(M.event);else if(this._previousPosition){const W=this.camera._calculateHandednessMultiplier(),l=(t.clientX-this._previousPosition.x)*W,M=t.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=l/this.angularSensibility,this.camera.cameraRotation.x+=M/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:l,offsetY:M}),this._previousPosition={x:t.clientX,y:t.clientY},U||t.preventDefault()}}),this._onMouseMove=l=>{if(!W.isPointerLock)return;const M=this.camera._calculateHandednessMultiplier(),t=l.movementX*M;this.camera.cameraRotation.y+=t/this.angularSensibility;const L=l.movementY;this.camera.cameraRotation.x+=L/this.angularSensibility,this._previousPosition=null,U||l.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,j.b.POINTERDOWN|j.b.POINTERUP|j.b.POINTERMOVE),l&&(this._contextMenuBind=U=>this.onContextMenu(U),l.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(U){U.preventDefault()}dk(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,M.e)([(0,t.T)()],s.prototype,"buttons",void 0),(0,M.e)([(0,t.T)()],s.prototype,"angularSensibility",void 0),B.b.FreeCameraMouseInput=s;var w,K=l(2213);class r{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new y.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(U){U=A.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=W=>{if(W.type!==j.b.POINTERWHEEL)return;const l=W.event,M=l.deltaMode===K.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*M*l.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*M*l.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*M*l.deltaZ/this._normalize,l.preventDefault&&(U||l.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,j.b.POINTERWHEEL)}dk(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,M.e)([(0,t.T)()],r.prototype,"wheelPrecisionX",void 0),(0,M.e)([(0,t.T)()],r.prototype,"wheelPrecisionY",void 0),(0,M.e)([(0,t.T)()],r.prototype,"wheelPrecisionZ",void 0),function(U){U[U.MoveRelative=0]="MoveRelative",U[U.RotateRelative=1]="RotateRelative",U[U.MoveScene=2]="MoveScene"}(w||(w={}));class m extends r{constructor(){super(...arguments),this._moveRelative=L.l.Zero(),this._rotateRelative=L.l.Zero(),this._moveScene=L.l.Zero(),this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(U){null===U&&this._wheelXAction!==w.MoveRelative||(this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=U)}get wheelXMoveRelative(){return this._wheelXAction!==w.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(U){null===U&&this._wheelYAction!==w.MoveRelative||(this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=U)}get wheelYMoveRelative(){return this._wheelYAction!==w.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(U){null===U&&this._wheelZAction!==w.MoveRelative||(this._wheelZAction=w.MoveRelative,this._wheelZActionCoordinate=U)}get wheelZMoveRelative(){return this._wheelZAction!==w.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(U){null===U&&this._wheelXAction!==w.RotateRelative||(this._wheelXAction=w.RotateRelative,this._wheelXActionCoordinate=U)}get wheelXRotateRelative(){return this._wheelXAction!==w.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(U){null===U&&this._wheelYAction!==w.RotateRelative||(this._wheelYAction=w.RotateRelative,this._wheelYActionCoordinate=U)}get wheelYRotateRelative(){return this._wheelYAction!==w.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(U){null===U&&this._wheelZAction!==w.RotateRelative||(this._wheelZAction=w.RotateRelative,this._wheelZActionCoordinate=U)}get wheelZRotateRelative(){return this._wheelZAction!==w.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(U){null===U&&this._wheelXAction!==w.MoveScene||(this._wheelXAction=w.MoveScene,this._wheelXActionCoordinate=U)}get wheelXMoveScene(){return this._wheelXAction!==w.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(U){null===U&&this._wheelYAction!==w.MoveScene||(this._wheelYAction=w.MoveScene,this._wheelYActionCoordinate=U)}get wheelYMoveScene(){return this._wheelYAction!==w.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(U){null===U&&this._wheelZAction!==w.MoveScene||(this._wheelZAction=w.MoveScene,this._wheelZActionCoordinate=U)}get wheelZMoveScene(){return this._wheelZAction!==w.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.jk(0),this._rotateRelative.jk(0),this._moveScene.jk(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const U=L.c.Zero();this.camera.getViewMatrix().invertToRef(U);const W=L.l.Zero();L.l.TransformNormalToRef(this._moveRelative,U,W),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(W),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(U,W,l){if(0===U)return;if(null===W||null===l)return;let M=null;switch(W){case w.MoveRelative:M=this._moveRelative;break;case w.RotateRelative:M=this._rotateRelative;break;case w.MoveScene:M=this._moveScene}switch(l){case 0:M.set(U,0,0);break;case 1:M.set(0,U,0);break;case 2:M.set(0,0,U)}}}(0,M.e)([(0,t.T)()],m.prototype,"wheelXMoveRelative",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelYMoveRelative",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelZMoveRelative",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelXRotateRelative",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelYRotateRelative",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelZRotateRelative",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelXMoveScene",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelYMoveScene",null),(0,M.e)([(0,t.T)()],m.prototype,"wheelZMoveScene",null),B.b.FreeCameraMouseWheelInput=m;class f{constructor(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=U,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=A.h.IsSafari()}attachControl(U){U=A.h.BackCompatCameraNoPreventDefault(arguments);let W=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=l=>{const M=l.event,t="mouse"===M.pointerType||this._isSafari&&"undefined"===typeof M.pointerType;if(this.allowMouse||!t)if(l.type===j.b.POINTERDOWN){if(U||M.preventDefault(),this._pointerPressed.push(M.pointerId),1!==this._pointerPressed.length)return;W={x:M.clientX,y:M.clientY}}else if(l.type===j.b.POINTERUP){U||M.preventDefault();const l=this._pointerPressed.indexOf(M.pointerId);if(-1===l)return;if(this._pointerPressed.splice(l,1),0!=l)return;W=null,this._offsetX=null,this._offsetY=null}else if(l.type===j.b.POINTERMOVE){if(U||M.preventDefault(),!W)return;if(0!=this._pointerPressed.indexOf(M.pointerId))return;this._offsetX=M.clientX-W.x,this._offsetY=-(M.clientY-W.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,j.b.POINTERDOWN|j.b.POINTERUP|j.b.POINTERMOVE),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.addEventListener("blur",this._onLostFocus)}}dk(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const U=this.camera,W=U._calculateHandednessMultiplier();U.cameraRotation.y=W*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)U.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const W=U._computeLocalCameraSpeed(),l=new L.l(0,0,0!==this.touchMoveSensibility?W*this._offsetY/this.touchMoveSensibility:0);L.c.RotationYawPitchRollToRef(U.rotation.y,U.rotation.x,0,U._cameraRotationMatrix),U.cameraDirection.addInPlace(L.l.TransformCoordinates(l,U._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,M.e)([(0,t.T)()],f.prototype,"touchAngularSensibility",void 0),(0,M.e)([(0,t.T)()],f.prototype,"touchMoveSensibility",void 0),B.b.FreeCameraTouchInput=f;class g extends B.c{constructor(U){super(U),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new q),this}addMouse(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new s(U),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new m,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new f),this}clear(){super.clear(),this._mouseInput=null}}var E=l(655),Z=l(592);class N extends p.b{get angularSensibility(){const U=this.inputs.attached.mouse;return U?U.angularSensibility:0}set angularSensibility(U){const W=this.inputs.attached.mouse;W&&(W.angularSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const W=this.inputs.attached.keyboard;W&&(W.keysUp=U)}get keysUpward(){const U=this.inputs.attached.keyboard;return U?U.keysUpward:[]}set keysUpward(U){const W=this.inputs.attached.keyboard;W&&(W.keysUpward=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const W=this.inputs.attached.keyboard;W&&(W.keysDown=U)}get keysDownward(){const U=this.inputs.attached.keyboard;return U?U.keysDownward:[]}set keysDownward(U){const W=this.inputs.attached.keyboard;W&&(W.keysDownward=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const W=this.inputs.attached.keyboard;W&&(W.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const W=this.inputs.attached.keyboard;W&&(W.keysRight=U)}get keysRotateLeft(){const U=this.inputs.attached.keyboard;return U?U.keysRotateLeft:[]}set keysRotateLeft(U){const W=this.inputs.attached.keyboard;W&&(W.keysRotateLeft=U)}get keysRotateRight(){const U=this.inputs.attached.keyboard;return U?U.keysRotateRight:[]}set keysRotateRight(U){const W=this.inputs.attached.keyboard;W&&(W.keysRotateRight=U)}get keysRotateUp(){const U=this.inputs.attached.keyboard;return U?U.keysRotateUp:[]}set keysRotateUp(U){const W=this.inputs.attached.keyboard;W&&(W.keysRotateUp=U)}get keysRotateDown(){const U=this.inputs.attached.keyboard;return U?U.keysRotateDown:[]}set keysRotateDown(U){const W=this.inputs.attached.keyboard;W&&(W.keysRotateDown=U)}constructor(U,W,l){var M;super(U,W,l,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),M=this,this.ellipsoid=new L.l(.5,1,.5),this.ellipsoidOffset=new L.l(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=L.l.Zero(),this._diffPosition=L.l.Zero(),this._newPosition=L.l.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M._newPosition.p(W),M._newPosition.subtractToRef(M._oldPosition,M._diffPosition),M._diffPosition.length()>Z.d.CollisionsEpsilon&&(M.position.addToRef(M._diffPosition,M._deferredPositionUpdate),M._deferOnly?M._deferredUpdated=!0:M.position.p(M._deferredPositionUpdate),M.Ie&&l&&M.Ie(l))},this.inputs=new g(this),this.inputs.addKeyboard().addMouse()}attachControl(U,W){W=A.h.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(W)}dk(){this.inputs.detachElement(),this.cameraDirection=new L.l(0,0,0),this.cameraRotation=new L.h(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(U){this._collisionMask=isNaN(U)?-1:U}_collideWithWorld(U){let W;W=this.parent?L.l.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,W.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const l=this.va().collisionCoordinator;this._collider||(this._collider=l.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let M=U;this.applyGravity&&(M=U.add(this.va().gravity)),l.getNewPosition(this._oldPosition,M,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=L.l.Zero(),this._transformedDirection=L.l.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(U){this._needMoveForGravity=U}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,M.e)([(0,t.R)()],N.prototype,"ellipsoid",void 0),(0,M.e)([(0,t.R)()],N.prototype,"ellipsoidOffset",void 0),(0,M.e)([(0,t.T)()],N.prototype,"checkCollisions",void 0),(0,M.e)([(0,t.T)()],N.prototype,"applyGravity",void 0),(0,E.f)("BABYLON.FreeCamera",N)},13043:(U,W,l)=>{"use strict";l.d(W,{c:()=>L});var M=l(702),t=l(13048);class L{constructor(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=l,this.il=[],this._maxBlockCapacity=W||64,this._selectionContent=new M.e(1024),this._creationFunc=U}update(U,W,l){t.b._CreateBlocks(U,W,l,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Dk(U){for(let W=0;W<this.$g.length;W++){this.$g[W].addEntry(U)}}Ek(U){for(let W=0;W<this.$g.length;W++){this.$g[W].removeEntry(U)}}select(U,W){this._selectionContent.reset();for(let l=0;l<this.$g.length;l++){this.$g[l].select(U,this._selectionContent,W)}return W?this._selectionContent.concat(this.il):this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}intersects(U,W,l){this._selectionContent.reset();for(let M=0;M<this.$g.length;M++){this.$g[M].intersects(U,W,this._selectionContent,l)}return l?this._selectionContent.concat(this.il):this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}intersectsRay(U){this._selectionContent.reset();for(let W=0;W<this.$g.length;W++){this.$g[W].intersectsRay(U,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.il),this._selectionContent}}L.CreationFuncForMeshes=(U,W)=>{const l=U.getBoundingInfo();!U.isBlocked&&l.boundingBox.intersectsMinMax(W.kl,W.ll)&&W.entries.push(U)},L.CreationFuncForSubMeshes=(U,W)=>{U.getBoundingInfo().boundingBox.intersectsMinMax(W.kl,W.ll)&&W.entries.push(U)}},13048:(U,W,l)=>{"use strict";l.d(W,{b:()=>L});var M=l(706),t=l(791);class L{constructor(U,W,l,M,t,L){this.entries=[],this.ml=new Array,this._capacity=l,this._depth=M,this._maxDepth=t,this._creationFunc=L,this._minPoint=U,this._maxPoint=W,this.ml.push(U.clone()),this.ml.push(W.clone()),this.ml.push(U.clone()),this.ml[2].x=W.x,this.ml.push(U.clone()),this.ml[3].y=W.y,this.ml.push(U.clone()),this.ml[4].z=W.z,this.ml.push(W.clone()),this.ml[5].z=U.z,this.ml.push(W.clone()),this.ml[6].x=U.x,this.ml.push(W.clone()),this.ml[7].y=U.y}get Db(){return this._capacity}get kl(){return this._minPoint}get ll(){return this._maxPoint}addEntry(U){if(this.$g)for(let W=0;W<this.$g.length;W++){this.$g[W].addEntry(U)}else this._creationFunc(U,this),this.entries.length>this.Db&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(U){if(this.$g){for(let W=0;W<this.$g.length;W++){this.$g[W].removeEntry(U)}return}const W=this.entries.indexOf(U);W>-1&&this.entries.splice(W,1)}addEntries(U){for(let W=0;W<U.length;W++){const l=U[W];this.addEntry(l)}}select(U,W,l){if(t.b.IsInFrustum(this.ml,U)){if(this.$g){for(let M=0;M<this.$g.length;M++){this.$g[M].select(U,W,l)}return}l?W.concat(this.entries):W.concatWithNoDuplicate(this.entries)}}intersects(U,W,l,M){if(t.b.IntersectsSphere(this._minPoint,this._maxPoint,U,W)){if(this.$g){for(let t=0;t<this.$g.length;t++){this.$g[t].intersects(U,W,l,M)}return}M?l.concat(this.entries):l.concatWithNoDuplicate(this.entries)}}intersectsRay(U,W){if(U.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.$g){for(let l=0;l<this.$g.length;l++){this.$g[l].intersectsRay(U,W)}return}W.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){L._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(U,W,l,t,p,B,k,A){k.$g=new Array;const q=new M.l((W.x-U.x)/2,(W.y-U.y)/2,(W.z-U.z)/2);for(let M=0;M<2;M++)for(let W=0;W<2;W++)for(let y=0;y<2;y++){const j=U.add(q.multiplyByFloats(M,W,y)),s=U.add(q.multiplyByFloats(M+1,W+1,y+1)),w=new L(j,s,t,p+1,B,A);w.addEntries(l),k.$g.push(w)}}}},13056:(U,W,l)=>{"use strict";l.d(W,{b:()=>q});var M=l(2178),t=l(706),L=l(821),p=l(12388),B=l(877),k=l(13043),A=l(543);M.c.prototype.createOrUpdateSelectionOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,l=this._getComponent(B.d.NAME_OCTREE);l||(l=new q(this),this.o(l)),this.gl||(this.gl=new k.c(k.c.CreationFuncForMeshes,U,W));const M=this.getWorldExtends();return this.gl.update(M.min,M.max,this.meshes),this.gl},Object.defineProperty(M.c.prototype,"selectionOctree",{get:function(){return this.gl},enumerable:!0,configurable:!0}),L.c.prototype.createOrUpdateSubmeshesOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const l=this.va();let M=l._getComponent(B.d.NAME_OCTREE);M||(M=new q(l),l.o(M)),this._submeshesOctree||(this._submeshesOctree=new k.c(k.c.CreationFuncForSubMeshes,U,W)),this.fk(!0);const t=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(t.minimumWorld,t.maximumWorld,this.uk),this._submeshesOctree};class q{constructor(U){this.name=B.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new p.e(t.l.Zero(),new t.l(1,1,1)),(U=U||A.d.LastCreatedScene)&&(this.Gd=U,this.Gd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Gd.getActiveSubMeshCandidates=U=>this.getActiveSubMeshCandidates(U),this.Gd.getCollidingSubMeshCandidates=(U,W)=>this.getCollidingSubMeshCandidates(U,W),this.Gd.getIntersectingSubMeshCandidates=(U,W)=>this.getIntersectingSubMeshCandidates(U,W))}register(){this.Gd.onMeshRemovedObservable.add((U=>{const W=this.Gd.selectionOctree;if(void 0!==W&&null!==W){const l=W.il.indexOf(U);-1!==l&&W.il.splice(l,1)}})),this.Gd.onMeshImportedObservable.add((U=>{const W=this.Gd.selectionOctree;void 0!==W&&null!==W&&W.Dk(U)}))}getActiveMeshCandidates(){var U;return(null===(U=this.Gd.gl)||void 0===U?void 0:U.select(this.Gd.frustumPlanes))||this.Gd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(U){if(U._submeshesOctree&&U.useOctreeForRenderingSelection){return U._submeshesOctree.select(this.Gd.frustumPlanes)}return this.Gd._getDefaultSubMeshCandidates(U)}getIntersectingSubMeshCandidates(U,W){if(U._submeshesOctree&&U.useOctreeForPicking){p.e.TransformToRef(W,U.getWorldMatrix(),this._tempRay);return U._submeshesOctree.intersectsRay(this._tempRay)}return this.Gd._getDefaultSubMeshCandidates(U)}getCollidingSubMeshCandidates(U,W){if(U._submeshesOctree&&U.useOctreeForCollisions){const l=W._velocityWorldLength+Math.max(W._radius.x,W._radius.y,W._radius.z);return U._submeshesOctree.intersects(W._basePointWorld,l)}return this.Gd._getDefaultSubMeshCandidates(U)}rebuild(){}dispose(){}}},12388:(U,W,l)=>{"use strict";l.d(W,{e:()=>s});var M=l(2178),t=l(677),L=l(711),p=l(706),B=l(719),k=l(781),A=l(833),q=l(543),y=l(2219);const j={internalPickerForMesh:void 0};class s{constructor(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.d;this.origin=U,this.direction=W,this.length=l,this.epsilon=M}clone(){return new s(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const M=s._TmpVector3[0].wd(U.x-l,U.y-l,U.z-l),t=s._TmpVector3[1].wd(W.x+l,W.y+l,W.z+l);let L,p,B,k,A=0,q=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<M.x||this.origin.x>t.x)return!1}else if(L=1/this.direction.x,p=(M.x-this.origin.x)*L,B=(t.x-this.origin.x)*L,B===-1/0&&(B=1/0),p>B&&(k=p,p=B,B=k),A=Math.max(p,A),q=Math.min(B,q),A>q)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<M.y||this.origin.y>t.y)return!1}else if(L=1/this.direction.y,p=(M.y-this.origin.y)*L,B=(t.y-this.origin.y)*L,B===-1/0&&(B=1/0),p>B&&(k=p,p=B,B=k),A=Math.max(p,A),q=Math.min(B,q),A>q)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<M.z||this.origin.z>t.z)return!1}else if(L=1/this.direction.z,p=(M.z-this.origin.z)*L,B=(t.z-this.origin.z)*L,B===-1/0&&(B=1/0),p>B&&(k=p,p=B,B=k),A=Math.max(p,A),q=Math.min(B,q),A>q)return!1;return!0}intersectsBox(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(U.minimum,U.maximum,W)}intersectsSphere(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=U.center.x-this.origin.x,M=U.center.y-this.origin.y,t=U.center.z-this.origin.z,L=l*l+M*M+t*t,p=U.radius+W,B=p*p;if(L<=B)return!0;const k=l*this.direction.x+M*this.direction.y+t*this.direction.z;if(k<0)return!1;return L-k*k<=B}intersectsTriangle(U,W,l){const M=s._TmpVector3[0],t=s._TmpVector3[1],L=s._TmpVector3[2],B=s._TmpVector3[3],A=s._TmpVector3[4];W.subtractToRef(U,M),l.subtractToRef(U,t),p.l.CrossToRef(this.direction,t,L);const q=p.l.Dot(M,L);if(0===q)return null;const y=1/q;this.origin.subtractToRef(U,B);const j=p.l.Dot(B,L)*y;if(j<-this.epsilon||j>1+this.epsilon)return null;p.l.CrossToRef(B,M,A);const w=p.l.Dot(this.direction,A)*y;if(w<-this.epsilon||j+w>1+this.epsilon)return null;const K=p.l.Dot(t,A)*y;return K>this.length?null:new k.b(1-j-w,j,K)}intersectsPlane(U){let W;const l=p.l.Dot(U.rk,this.direction);if(Math.abs(l)<9.99999997475243e-7)return null;{const M=p.l.Dot(U.rk,this.origin);return W=(-U.d-M)/l,W<0?W<-9.99999997475243e-7?null:0:W}}intersectsAxis(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(U){case"y":{const U=(this.origin.y-W)/this.direction.y;return U>0?null:new p.l(this.origin.x+this.direction.x*-U,W,this.origin.z+this.direction.z*-U)}case"x":{const U=(this.origin.x-W)/this.direction.x;return U>0?null:new p.l(W,this.origin.y+this.direction.y*-U,this.origin.z+this.direction.z*-U)}case"z":{const U=(this.origin.z-W)/this.direction.z;return U>0?null:new p.l(this.origin.x+this.direction.x*-U,this.origin.y+this.direction.y*-U,W)}default:return null}}intersectsMesh(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=p.f.Matrix[0];return U.getWorldMatrix().invertToRef(B),this._tmpRay?s.TransformToRef(this,B,this._tmpRay):this._tmpRay=s.Transform(this,B),U.intersects(this._tmpRay,W,l,M,t,L)}intersectsMeshes(U,W,l){l?l.length=0:l=[];for(let M=0;M<U.length;M++){const t=this.intersectsMesh(U[M],W);t.hit&&l.push(t)}return l.sort(this._comparePickingInfo),l}_comparePickingInfo(U,W){return U.distance<W.distance?-1:U.distance>W.distance?1:0}intersectionSegment(U,W,l){const M=this.origin,t=p.f.ik[0],L=p.f.ik[1],B=p.f.ik[2],k=p.f.ik[3];W.subtractToRef(U,t),this.direction.scaleToRef(s._Rayl,B),M.addToRef(B,L),U.subtractToRef(M,k);const A=p.l.Dot(t,t),q=p.l.Dot(t,B),y=p.l.Dot(B,B),j=p.l.Dot(t,k),w=p.l.Dot(B,k),K=A*y-q*q;let r,m,f=K,g=K;K<s._Smallnum?(r=0,f=1,m=w,g=y):(r=q*w-y*j,m=A*w-q*j,r<0?(r=0,m=w,g=y):r>f&&(r=f,m=w+q,g=y)),m<0?(m=0,-j<0?r=0:-j>A?r=f:(r=-j,f=A)):m>g&&(m=g,-j+q<0?r=0:-j+q>A?r=f:(r=-j+q,f=A));const E=Math.abs(r)<s._Smallnum?0:r/f,Z=Math.abs(m)<s._Smallnum?0:m/g,N=p.f.ik[4];B.scaleToRef(Z,N);const D=p.f.ik[5];t.scaleToRef(E,D),D.addInPlace(k);const o=p.f.ik[6];D.subtractToRef(N,o);return Z>0&&Z<=this.length&&o.lengthSquared()<l*l?D.length():-1}update(U,W,l,M,t,L,B){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){s._RayDistant||(s._RayDistant=s.Zero()),s._RayDistant.unprojectRayToRef(U,W,l,M,p.c.IdentityReadOnly,L,B);const k=p.f.Matrix[0];t.invertToRef(k),s.TransformToRef(s._RayDistant,k,this)}else this.unprojectRayToRef(U,W,l,M,t,L,B);return this}static Zero(){return new s(p.l.Zero(),p.l.Zero())}static CreateNew(U,W,l,M,t,L,p){return s.Zero().update(U,W,l,M,t,L,p)}static CreateNewFromTo(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.c.IdentityReadOnly;const M=new s(new p.l(0,0,0),new p.l(0,0,0));return s.CreateFromToToRef(U,W,M,l)}static CreateFromToToRef(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.c.IdentityReadOnly;l.origin.p(U);const t=W.subtractToRef(U,l.direction),L=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return l.length=L,l.direction.normalize(),s.TransformToRef(l,M,l)}static Transform(U,W){const l=new s(new p.l(0,0,0),new p.l(0,0,0));return s.TransformToRef(U,W,l),l}static TransformToRef(U,W,l){p.l.TransformCoordinatesToRef(U.origin,W,l.origin),p.l.TransformNormalToRef(U.direction,W,l.direction),l.length=U.length,l.epsilon=U.epsilon;const M=l.direction,t=M.length();if(0!==t&&1!==t){const U=1/t;M.x*=U,M.y*=U,M.z*=U,l.length*=t}return l}unprojectRayToRef(U,W,l,M,t,L,B){const k=p.f.Matrix[0];t.multiplyToRef(L,k),k.multiplyToRef(B,k),k.invert();const A=q.d.LastCreatedEngine,y=p.f.ik[0];y.x=U/l*2-1,y.y=-(W/M*2-1),y.z=null!==A&&void 0!==A&&A.useReverseDepthBuffer?1:null!==A&&void 0!==A&&A.isNDCHalfZRange?0:-1;const j=p.f.ik[1].wd(y.x,y.y,1-1e-8),s=p.f.ik[2],w=p.f.ik[3];p.l._UnprojectFromInvertedMatrixToRef(y,k,s),p.l._UnprojectFromInvertedMatrixToRef(j,k,w),this.origin.p(s),w.subtractToRef(s,this.direction),this.direction.normalize()}}function w(U,W,l,M,t){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=s.Zero();return K(U,W,l,M,p,t,L),p}function K(U,W,l,M,t,L){let B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const A=U.getEngine();if(!L&&!(L=U.activeCamera))return U;const q=L.viewport,y=A.getRenderHeight(),{x:j,y:s,width:w,height:K}=q.toGlobal(A.getRenderWidth(),y),r=1/A.getHardwareScalingLevel();return W=W*r-j,l=l*r-(y-s-K),t.update(W,l,w,K,M||p.c.IdentityReadOnly,B?p.c.IdentityReadOnly:L.getViewMatrix(),L.getProjectionMatrix(),k),U}function r(U,W,l,M,t){if(!A.c)return U;const L=U.getEngine();if(!t&&!(t=U.activeCamera))throw new Error("Active camera not set");const B=t.viewport,k=L.getRenderHeight(),{x:q,y:y,width:j,height:s}=B.toGlobal(L.getRenderWidth(),k),w=p.c.Identity(),K=1/L.getHardwareScalingLevel();return W=W*K-q,l=l*K-(k-y-s),M.update(W,l,j,s,w,w,t.getProjectionMatrix()),U}function m(U,W,l,M,t,L,p,B){const k=W(M,l.enableDistantPicking),A=l.intersects(k,t,p,L,M,B);return A&&A.hit?!t&&null!=U&&A.distance>=U.distance?null:A:null}function f(U,W,l,M,t,L){let B=null;const k=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),q=U.cameraToUseForPointers||U.activeCamera,y=j.internalPickerForMesh||m;for(let A=0;A<U.meshes.length;A++){const j=U.meshes[A];if(l){if(!l(j,-1))continue}else if(!j.isEnabled()||!j.isVisible||!j.df)continue;const s=k&&j.isWorldMatrixCameraDependent(),w=j.fk(s,q);if(j.hasThinInstances&&j.thinInstanceEnablePicking){const U=y(B,W,j,w,!0,!0,L);if(U){if(t)return U;const k=p.f.Matrix[1],A=j.thinInstanceGetWorldMatrices();for(let U=0;U<A.length;U++){if(l&&!l(j,U))continue;A[U].multiplyToRef(w,k);const p=y(B,W,j,k,M,t,L,!0);if(p&&(B=p,B.thinInstanceIndex=U,M))return B}}}else{const U=y(B,W,j,w,M,t,L);if(U&&(B=U,M))return B}}return B||new A.c}function g(U,W,l,M){if(!A.c)return null;const t=[],L=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),B=U.cameraToUseForPointers||U.activeCamera,k=j.internalPickerForMesh||m;for(let A=0;A<U.meshes.length;A++){const q=U.meshes[A];if(l){if(!l(q,-1))continue}else if(!q.isEnabled()||!q.isVisible||!q.df)continue;const y=L&&q.isWorldMatrixCameraDependent(),j=q.fk(y,B);if(q.hasThinInstances&&q.thinInstanceEnablePicking){if(k(null,W,q,j,!0,!0,M)){const U=p.f.Matrix[1],L=q.thinInstanceGetWorldMatrices();for(let p=0;p<L.length;p++){if(l&&!l(q,p))continue;L[p].multiplyToRef(j,U);const B=k(null,W,q,U,!1,!1,M,!0);B&&(B.thinInstanceIndex=p,t.push(B))}}}else{const U=k(null,W,q,j,!1,!1,M);U&&t.push(U)}}return t}function E(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,M=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;M||(M=U.getWorldMatrix()),W.length=l,t?W.origin.p(t):W.origin.p(U.position);const L=p.f.ik[2];L.set(0,0,U._scene.useRightHandedSystem?-1:1);const B=p.f.ik[3];return p.l.TransformNormalToRef(L,M,B),p.l.NormalizeToRef(B,W.direction),W}var Z,N;s._TmpVector3=(0,B.d)(6,p.l.Zero),s._RayDistant=s.Zero(),s._Smallnum=1e-8,s._Rayl=1e9,Z=M.c,(N=t.d)&&(N.prototype.getForwardRay=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,W=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return E(this,new s(p.l.Zero(),p.l.Zero(),U),U,W,l)},N.prototype.getForwardRayToRef=function(U){return E(this,U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),Z&&(y.d._IsPickingAvailable=!0,Z.prototype.createPickingRay=function(U,W,l,M){return w(this,U,W,l,M,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),M.c.prototype.createPickingRayToRef=function(U,W,l,M,t){return K(this,U,W,l,M,t,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},M.c.prototype.createPickingRayInCameraSpace=function(U,W,l){return function(U,W,l,M){const t=s.Zero();return r(U,W,l,t,M),t}(this,U,W,l)},M.c.prototype.createPickingRayInCameraSpaceToRef=function(U,W,l,M){return r(this,U,W,l,M)},M.c.prototype.pickWithBoundingInfo=function(U,W,l,M,t){return function(U,W,l,M,t,L){if(!A.c)return null;const B=f(U,(M=>(U._tempPickingRay||(U._tempPickingRay=s.Zero()),K(U,W,l,M,U._tempPickingRay,L||null),U._tempPickingRay)),M,t,!0);return B&&(B.ray=w(U,W,l,p.c.Identity(),L||null)),B}(this,U,W,l,M,t)},M.c.prototype.ce=function(U,W,l,M,t,L){return function(U,W,l,M,t,L,B){const k=f(U,((M,t)=>(U._tempPickingRay||(U._tempPickingRay=s.Zero()),K(U,W,l,M,U._tempPickingRay,L||null,!1,t),U._tempPickingRay)),M,t,!1,B);return k&&(k.ray=w(U,W,l,p.c.Identity(),L||null)),k}(this,U,W,l,M,t,L)},M.c.prototype.pickWithRay=function(U,W,l,M){return function(U,W,l,M,t){const L=f(U,(l=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=p.c.Identity()),l.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=s.Zero()),s.TransformToRef(W,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),l,M,!1,t);return L&&(L.ray=W),L}(this,U,W,l,M)},M.c.prototype.multiPick=function(U,W,l,M,t){return function(U,W,l,M,t,L){return g(U,(M=>w(U,W,l,M,t||null)),M,L)}(this,U,W,l,M,t)},M.c.prototype.multiPickWithRay=function(U,W,l){return function(U,W,l,M){return g(U,(l=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=p.c.Identity()),l.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=s.Zero()),s.TransformToRef(W,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),l,M)}(this,U,W,l)}},2160:(U,W,l)=>{"use strict";var M=l(624),t=l(512),L=l(547),p=l(658),B=l(592),k=l(639);B.d.prototype._partialLoadFile=function(U,W,l,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(U,(U=>{l[W]=U,l._internalCount++,6===l._internalCount&&M(l)}),void 0,void 0,!0,((U,W)=>{t&&U&&t(U.status+" "+U.statusText,W)}))},B.d.prototype._cascadeLoadFiles=function(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=[];t._internalCount=0;for(let L=0;L<6;L++)this._partialLoadFile(l[L],L,t,W,M)},B.d.prototype._cascadeLoadImgs=function(U,W,l,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5?arguments[5]:void 0;const p=[];p._internalCount=0;for(let B=0;B<6;B++)this._partialLoadImg(M[B],B,p,U,W,l,t,L)},B.d.prototype._partialLoadImg=function(U,W,l,M,t,B){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7?arguments[7]:void 0;const q=(0,p.d)();(0,L.l)(U,(U=>{l[W]=U,l._internalCount++,M&&M.removePendingData(q),6===l._internalCount&&B&&B(t,l)}),((U,W)=>{M&&M.removePendingData(q),k&&k(U,W)}),M?M.offlineProvider:null,A),M&&M.addPendingData(q)},B.d.prototype.createCubeTextureBase=function(U,W,l,L){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,s=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,K=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,r=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,m=arguments.length>14&&void 0!==arguments[14]&&arguments[14],f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const g=w||new M.c(this,7);g.isCube=!0,g.url=U,g.generateMipMaps=!L,g._lodGenerationScale=j,g._lodGenerationOffset=s,g._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!L),g!==w&&(g.label=U.substring(0,60)),this._doNotHandleContextLost||(g._extension=q,g._files=l,g._buffer=f);const E=U;this._transformTextureUrl&&!w&&(U=this._transformTextureUrl(U));const Z=q??function(U){const W=U.split("?")[0],l=W.lastIndexOf(".");return l>-1?W.substring(l).toLowerCase():""}(U),N=(0,k.b)(Z),D=(U,W)=>{g.dispose(),B?B(U,W):U&&t.b.Warn(U)},o=(M,B)=>{U===E?M&&D(M.status+" "+M.statusText,B):(t.b.Warn(`Failed to load ${U}, falling back to the ${E}`),this.createCubeTextureBase(E,W,l,!!L,p,D,A,q,y,j,s,g,K,r,m,f))};if(N)N.then((M=>{const t=U=>{K&&K(g,U),M.loadCubeData(U,g,y,p,((U,W)=>{D(U,W)}))};f?t(f):l&&6===l.length?M.supportCascades?this._cascadeLoadFiles(W,(U=>t(U.map((U=>new Uint8Array(U))))),l,D):D("Textures type does not support cascades."):this._loadFile(U,(U=>t(new Uint8Array(U))),void 0,void 0,!0,o)}));else{if(!l||0===l.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(W,g,((U,W)=>{r&&r(U,W)}),l,D)}return this._internalTexturesCache.push(g),g}},13061:(U,W,l)=>{"use strict";l(512);var M=l(2088);l(624),l(768),l(618),l(2136),l(2100);M.c},12699:(U,W,l)=>{"use strict";l.d(W,{d:()=>t});var M=l(655);class t{constructor(U){this.value=this._toInt(U)}_toInt(U){return 0|U}add(U){return new t(this.value+U.value)}de(U){return new t(this.value-U.value)}multiply(U){return new t(Math.imul(this.value,U.value))}divide(U){return new t(this.value/U.value)}getClassName(){return t.ClassName}equals(U){return this.value===U.value}static FromValue(U){return new t(U)}toString(){return this.value.toString()}}t.ClassName="FlowGraphInteger",(0,M.f)("FlowGraphInteger",t)},12713:(U,W,l)=>{"use strict";l.d(W,{b:()=>t,f:()=>L});var M=l(706);class t{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.pk=U}get m(){return this.pk}transformVector(U){return this.transformVectorToRef(U,new M.h)}transformVectorToRef(U,W){return W.x=U.x*this.pk[0]+U.y*this.pk[1],W.y=U.x*this.pk[2]+U.y*this.pk[3],W}qk(){return this.toArray()}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let W=0;W<4;W++)U[W]=this.pk[W];return U}fe(U){for(let W=0;W<4;W++)this.pk[W]=U[W];return this}multiplyToRef(U,W){const l=U.pk,M=this.pk,t=W.pk;return t[0]=l[0]*M[0]+l[1]*M[2],t[1]=l[0]*M[1]+l[1]*M[3],t[2]=l[2]*M[0]+l[3]*M[2],t[3]=l[2]*M[1]+l[3]*M[3],W}multiply(U){return this.multiplyToRef(U,new t)}divideToRef(U,W){const l=this.pk,M=U.pk,t=W.pk;return t[0]=l[0]/M[0],t[1]=l[1]/M[1],t[2]=l[2]/M[2],t[3]=l[3]/M[3],W}divide(U){return this.divideToRef(U,new t)}addToRef(U,W){const l=this.pk,M=U.m,t=W.m;return t[0]=l[0]+M[0],t[1]=l[1]+M[1],t[2]=l[2]+M[2],t[3]=l[3]+M[3],W}add(U){return this.addToRef(U,new t)}subtractToRef(U,W){const l=this.pk,M=U.m,t=W.m;return t[0]=l[0]-M[0],t[1]=l[1]-M[1],t[2]=l[2]-M[2],t[3]=l[3]-M[3],W}de(U){return this.subtractToRef(U,new t)}transpose(){const U=this.pk;return new t([U[0],U[2],U[1],U[3]])}determinant(){const U=this.pk;return U[0]*U[3]-U[1]*U[2]}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const W=this.pk,l=1/U;return new t([W[3]*l,-W[1]*l,-W[2]*l,W[0]*l])}equals(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=this.pk,M=U.m;return 0===W?l[0]===M[0]&&l[1]===M[1]&&l[2]===M[2]&&l[3]===M[3]:Math.abs(l[0]-M[0])<W&&Math.abs(l[1]-M[1])<W&&Math.abs(l[2]-M[2])<W&&Math.abs(l[3]-M[3])<W}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.pk.join(", ")})`}}class L{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.pk=U}get m(){return this.pk}transformVector(U){return this.transformVectorToRef(U,new M.l)}transformVectorToRef(U,W){const l=this.pk;return W.x=U.x*l[0]+U.y*l[1]+U.z*l[2],W.y=U.x*l[3]+U.y*l[4]+U.z*l[5],W.z=U.x*l[6]+U.y*l[7]+U.z*l[8],W}multiplyToRef(U,W){const l=U.pk,M=this.pk,t=W.m;return t[0]=l[0]*M[0]+l[1]*M[3]+l[2]*M[6],t[1]=l[0]*M[1]+l[1]*M[4]+l[2]*M[7],t[2]=l[0]*M[2]+l[1]*M[5]+l[2]*M[8],t[3]=l[3]*M[0]+l[4]*M[3]+l[5]*M[6],t[4]=l[3]*M[1]+l[4]*M[4]+l[5]*M[7],t[5]=l[3]*M[2]+l[4]*M[5]+l[5]*M[8],t[6]=l[6]*M[0]+l[7]*M[3]+l[8]*M[6],t[7]=l[6]*M[1]+l[7]*M[4]+l[8]*M[7],t[8]=l[6]*M[2]+l[7]*M[5]+l[8]*M[8],W}multiply(U){return this.multiplyToRef(U,new L)}divideToRef(U,W){const l=this.pk,M=U.m,t=W.m;return t[0]=l[0]/M[0],t[1]=l[1]/M[1],t[2]=l[2]/M[2],t[3]=l[3]/M[3],t[4]=l[4]/M[4],t[5]=l[5]/M[5],t[6]=l[6]/M[6],t[7]=l[7]/M[7],t[8]=l[8]/M[8],W}divide(U){return this.divideToRef(U,new L)}addToRef(U,W){const l=this.pk,M=U.m,t=W.m;return t[0]=l[0]+M[0],t[1]=l[1]+M[1],t[2]=l[2]+M[2],t[3]=l[3]+M[3],t[4]=l[4]+M[4],t[5]=l[5]+M[5],t[6]=l[6]+M[6],t[7]=l[7]+M[7],t[8]=l[8]+M[8],W}add(U){return this.addToRef(U,new L)}subtractToRef(U,W){const l=this.pk,M=U.m,t=W.m;return t[0]=l[0]-M[0],t[1]=l[1]-M[1],t[2]=l[2]-M[2],t[3]=l[3]-M[3],t[4]=l[4]-M[4],t[5]=l[5]-M[5],t[6]=l[6]-M[6],t[7]=l[7]-M[7],t[8]=l[8]-M[8],W}de(U){return this.subtractToRef(U,new L)}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let W=0;W<9;W++)U[W]=this.pk[W];return U}qk(){return this.toArray()}fe(U){for(let W=0;W<9;W++)this.pk[W]=U[W];return this}transpose(){const U=this.pk;return new L([U[0],U[3],U[6],U[1],U[4],U[7],U[2],U[5],U[8]])}determinant(){const U=this.pk;return U[0]*(U[4]*U[8]-U[5]*U[7])-U[1]*(U[3]*U[8]-U[5]*U[6])+U[2]*(U[3]*U[7]-U[4]*U[6])}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const W=this.pk,l=1/U;return new L([(W[4]*W[8]-W[5]*W[7])*l,(W[2]*W[7]-W[1]*W[8])*l,(W[1]*W[5]-W[2]*W[4])*l,(W[5]*W[6]-W[3]*W[8])*l,(W[0]*W[8]-W[2]*W[6])*l,(W[2]*W[3]-W[0]*W[5])*l,(W[3]*W[7]-W[4]*W[6])*l,(W[1]*W[6]-W[0]*W[7])*l,(W[0]*W[4]-W[1]*W[3])*l])}equals(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=this.pk,M=U.m;return 0===W?l[0]===M[0]&&l[1]===M[1]&&l[2]===M[2]&&l[3]===M[3]&&l[4]===M[4]&&l[5]===M[5]&&l[6]===M[6]&&l[7]===M[7]&&l[8]===M[8]:Math.abs(l[0]-M[0])<W&&Math.abs(l[1]-M[1])<W&&Math.abs(l[2]-M[2])<W&&Math.abs(l[3]-M[3])<W&&Math.abs(l[4]-M[4])<W&&Math.abs(l[5]-M[5])<W&&Math.abs(l[6]-M[6])<W&&Math.abs(l[7]-M[7])<W&&Math.abs(l[8]-M[8])<W}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.pk.join(", ")})`}}},12721:(U,W,l)=>{"use strict";var M;function t(U,W,l,M){switch(W){case"Animation":return M?U.animations.find((U=>U.uniqueId===l))??null:U.animations[l]??null;case"AnimationGroup":return M?U.animationGroups.find((U=>U.uniqueId===l))??null:U.animationGroups[l]??null;case"Mesh":return M?U.meshes.find((U=>U.uniqueId===l))??null:U.meshes[l]??null;case"Material":return M?U.materials.find((U=>U.uniqueId===l))??null:U.materials[l]??null;case"ck":return M?U.cameras.find((U=>U.uniqueId===l))??null:U.cameras[l]??null;case"Light":return M?U.lights.find((U=>U.uniqueId===l))??null:U.lights[l]??null;default:return null}}l.d(W,{c:()=>t}),function(U){U.Animation="Animation",U.AnimationGroup="AnimationGroup",U.Mesh="Mesh",U.Material="Material",U.ck="ck",U.Light="Light"}(M||(M={}))},12761:(U,W,l)=>{"use strict";l.d(W,{b:()=>t});var M=l(12766);class t extends M.e{constructor(U,W){if(super(U),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),W)for(const l of W)this._eventsSignalOutputs[l]=this._registerSignalOutput(l+"Event")}_executeOnTick(U){}_startPendingTasks(U){U._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(U),this._resetAfterCanceled(U)),this._preparePendingTasks(U),U._addPendingBlock(this),this.out._activateSignal(U),U._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(U){U._deleteExecutionVariable(this,"_initialized"),U._removePendingBlock(this)}}},12739:(U,W,l)=>{"use strict";l.d(W,{e:()=>A});var M=l(658),t=l(655),L=l(12742),p=l(496),B=l(12692);class k extends L.b{constructor(U,W,l,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:M.defaultValue,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(U,W,l),this.richType=M,this._defaultValue=t,this._optional=L,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new p.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(U){this._isDisabled!==U&&(this._isDisabled=U,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(U,W){W._getConnectionValue(this)!==U&&(W._setConnectionValue(this,U),this.onValueChangedObservable.notifyObservers(U))}resetToDefaultValue(U){U._setConnectionValue(this,this._defaultValue)}connectTo(U){this._isDisabled||super.connectTo(U)}_getValueOrDefault(U){const W=U._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(W):W}getValue(U){if(1===this.connectionType){U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(U);const W=this._getValueOrDefault(U);return this._lastValue=W,this.richType.typeTransformer?this.richType.typeTransformer(W):W}const W=this.isConnected()?this._connectedPoint[0].getValue(U):this._getValueOrDefault(U);return this._lastValue=W,this.richType.typeTransformer?this.richType.typeTransformer(W):W}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.richType={},this.richType.serialize(U.richType),U.optional=this._optional,(0,B.i)("defaultValue",this._defaultValue,U)}}(0,t.f)("FlowGraphDataConnection",k);class A{constructor(U){var W;this.config=U,this.uniqueId=(0,M.d)(),this.name=(null===(W=this.config)||void 0===W?void 0:W.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(U){}registerDataInput(U,W,l){const M=new k(U,0,this,W,l);return this.dataInputs.push(M),M}registerDataOutput(U,W,l){const M=new k(U,1,this,W,l);return this.dataOutputs.push(M),M}getDataInput(U){return this.dataInputs.find((W=>W.name===U))}getDataOutput(U){return this.dataOutputs.find((W=>W.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.i;if(U.uniqueId=this.uniqueId,U.config={},this.config){const l=this.config,M=Object.keys(l);for(const t of M)W(t,l[t],U.config)}U.dataInputs=[],U.dataOutputs=[],U.className=this.getClassName();for(const l of this.dataInputs){const W={};l.serialize(W),U.dataInputs.push(W)}for(const l of this.dataOutputs){const W={};l.serialize(W),U.dataOutputs.push(W)}}deserialize(U){}_log(U,W,l){var M;null===(M=U.logger)||void 0===M||M.addLogItem({action:W,payload:l,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12742:(U,W,l)=>{"use strict";l.d(W,{b:()=>L});var M,t=l(658);!function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(M||(M={}));class L{constructor(U,W,l){this._ownerBlock=l,this._connectedPoint=[],this.uniqueId=(0,t.d)(),this.connectedPointIds=[],this.name=U,this._connectionType=W}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(U){if(this._connectionType===U._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||U._isSingularConnection()&&U._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(U),U._connectedPoint.push(this)}disconnectFrom(U){let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const l=this._connectedPoint.indexOf(U),M=U._connectedPoint.indexOf(this);-1!==l&&-1!==M&&(W&&this._connectedPoint.splice(l,1),U._connectedPoint.splice(M,1))}disconnectFromAll(){for(const U of this._connectedPoint)this.disconnectFrom(U,!1);this._connectedPoint.length=0}dispose(){for(const U of this._connectedPoint)this.disconnectFrom(U)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U.uniqueId=this.uniqueId,U.name=this.name,U._connectionType=this._connectionType,U.connectedPointIds=[],U.className=this.getClassName();for(const W of this._connectedPoint)U.connectedPointIds.push(W.uniqueId)}getClassName(){return"FGConnection"}deserialize(U){this.uniqueId=U.uniqueId,this.name=U.name,this._connectionType=U._connectionType,this.connectedPointIds=U.connectedPointIds}}},12685:(U,W,l)=>{"use strict";l.d(W,{e:()=>g});var M,t=l(496),L=l(686),p=l(688),B=l(658),k=l(12692),A=l(12721),q=l(512);!function(U){U.ExecuteBlock="ExecuteBlock",U.ExecuteEvent="ExecuteEvent",U.TriggerConnection="TriggerConnection",U.ContextVariableSet="ContextVariableSet",U.GlobalVariableSet="GlobalVariableSet",U.GlobalVariableDelete="GlobalVariableDelete",U.GlobalVariableGet="GlobalVariableGet",U.AddConnection="AddConnection",U.GetConnectionValue="GetConnectionValue",U.SetConnectionValue="SetConnectionValue",U.ActivateSignal="ActivateSignal",U.ContextVariableGet="ContextVariableGet"}(M||(M={}));class y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(U){if(U.time||(U.time=Date.now()),this.log.push(U),this.logToConsole){var W;const l=null===(W=U.payload)||void 0===W?void 0:W.value;"object"===typeof l&&l.getClassName?q.b.Log(`[FGLog] ${U.className}:${U.uniqueId.split("-")[0]} ${U.action} - ${JSON.stringify(l.getClassName())}: ${l.toString()}`):q.b.Log(`[FGLog] ${U.className}:${U.uniqueId.split("-")[0]} ${U.action} - ${JSON.stringify(U.payload)}`)}}getItemsOfType(U){return this.log.filter((W=>W.action===U))}}class j{get enableLogging(){return this._enableLogging}set enableLogging(U){this._enableLogging!==U&&(this._enableLogging=U,this._enableLogging?(this.logger=new y,this.logger.logToConsole=!0):this.logger=null)}constructor(U){this.uniqueId=(0,B.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new t.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=U,this.assetsContext=U.assetsContext??U.Gd}hasVariable(U){return U in this._userVariables}setVariable(U,W){var l;this._userVariables[U]=W,null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:U,value:W}})}getAsset(U,W){return(0,A.c)(this.assetsContext,U,W)}getVariable(U){var W;return null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:U,value:this._userVariables[U]}}),this._userVariables[U]}get userVariables(){return this._userVariables}va(){return this._configuration.Gd}_getUniqueIdPrefixedName(U,W){return`${U.uniqueId}_${W}`}_getGlobalContextVariable(U,W){var l;return null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:U,defaultValue:W,possibleValue:this._globalContextVariables[U]}}),this._hasGlobalContextVariable(U)?this._globalContextVariables[U]:W}_setGlobalContextVariable(U,W){var l;null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:U,value:W}}),this._globalContextVariables[U]=W}_deleteGlobalContextVariable(U){var W;null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:U}}),delete this._globalContextVariables[U]}_hasGlobalContextVariable(U){return U in this._globalContextVariables}_setExecutionVariable(U,W,l){this._executionVariables[this._getUniqueIdPrefixedName(U,W)]=l}_getExecutionVariable(U,W,l){return this._hasExecutionVariable(U,W)?this._executionVariables[this._getUniqueIdPrefixedName(U,W)]:l}_deleteExecutionVariable(U,W){delete this._executionVariables[this._getUniqueIdPrefixedName(U,W)]}_hasExecutionVariable(U,W){return this._getUniqueIdPrefixedName(U,W)in this._executionVariables}_hasConnectionValue(U){return U.uniqueId in this._connectionValues}_setConnectionValue(U,W){var l;this._connectionValues[U.uniqueId]=W,null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:U.uniqueId,value:W}})}_setConnectionValueByKey(U,W){this._connectionValues[U]=W}_getConnectionValue(U){var W;return null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:U.uniqueId,value:this._connectionValues[U.uniqueId]}}),this._connectionValues[U.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(U){this._pendingBlocks.includes(U)||(this._pendingBlocks.push(U),this._pendingBlocks.sort(((U,W)=>U.priority-W.priority)))}_removePendingBlock(U){const W=this._pendingBlocks.indexOf(U);-1!==W&&this._pendingBlocks.splice(W,1)}_clearPendingBlocks(){for(const U of this._pendingBlocks)U._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(U){var W;this.onNodeExecutedObservable.notifyObservers(U),null===(W=this.logger)||void 0===W||W.addLogItem({time:Date.now(),className:U.getClassName(),uniqueId:U.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(U){this._setGlobalContextVariable("timeSinceStart",U.timeSinceStart),this._setGlobalContextVariable("deltaTime",U.deltaTime);for(const l of this._pendingBlocks){var W;null===(W=l._executeOnTick)||void 0===W||W.call(l,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.i;U.uniqueId=this.uniqueId,U._userVariables={};for(const M in this._userVariables)W(M,this._userVariables[M],U._userVariables);U._connectionValues={};for(const M in this._connectionValues)W(M,this._connectionValues[M],U._connectionValues);var l;this.assetsContext!==this.va()&&(U._assetsContext={meshes:this.assetsContext.meshes.map((U=>U.id)),materials:this.assetsContext.materials.map((U=>U.id)),textures:this.assetsContext.textures.map((U=>U.name)),animations:this.assetsContext.animations.map((U=>U.name)),lights:this.assetsContext.lights.map((U=>U.id)),cameras:this.assetsContext.cameras.map((U=>U.id)),nm:null===(l=this.assetsContext.nm)||void 0===l?void 0:l.map((U=>U.name)),skeletons:this.assetsContext.skeletons.map((U=>U.id)),Fk:this.assetsContext.Fk.map((U=>U.name)),geometries:this.assetsContext.geometries.map((U=>U.id)),multiMaterials:this.assetsContext.multiMaterials.map((U=>U.id)),transformNodes:this.assetsContext.transformNodes.map((U=>U.id))})}getClassName(){return"FlowGraphContext"}}(0,L.e)([(0,p.T)()],j.prototype,"uniqueId",void 0);var s=l(12730),w=l(2203);class K{constructor(U){this.onEventTriggeredObservable=new t.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=U,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.nk.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const U=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:U}}),this._startingTime+=U})),this._meshPickedObserver=this._scene.onPointerObservable.add((U=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:U})}),w.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((U=>{const W=U.pointerId,l=U.mesh,M=this._pointerUnderMeshState[W];!M&&l?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:W,mesh:l}}):M&&!l?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:W,mesh:M}}):M&&l&&M!==l&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:W,mesh:M,over:l}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:W,mesh:l,out:M}})),this._pointerUnderMeshState[W]=l}),w.b.POINTERMOVE)}dispose(){var U,W,l,M,t;null===(U=this._sceneDisposeObserver)||void 0===U||U.remove(),null===(W=this._sceneReadyObserver)||void 0===W||W.remove(),null===(l=this._sceneOnBeforeRenderObserver)||void 0===l||l.remove(),null===(M=this._meshPickedObserver)||void 0===M||M.remove(),null===(t=this._meshUnderPointerObserver)||void 0===t||t.remove(),this.onEventTriggeredObservable.clear()}}var r,m=l(12746);!function(U){U[U.Stopped=0]="Stopped",U[U.Started=1]="Started"}(r||(r={}));class f{get state(){return this._state}set state(U){this._state=U,this.onStateChangedObservable.notifyObservers(U)}constructor(U){this.onStateChangedObservable=new t.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=U.Gd,this._sceneEventCoordinator=new K(this._scene),this._coordinator=U.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((U=>{for(const W of this._executionContexts){const l=this._getContextualOrder(U.type,W);for(const M of l)if(!M._executeEvent(W,U.payload))break}switch(U.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const W of this._executionContexts)W._notifyOnTick(U.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const U=new j({Gd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(U),U}getContext(U){return this._executionContexts[U]}addEventBlock(U){if("PointerOver"!==U.type&&"PointerOut"!==U.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==U.type&&this._eventBlocks[U.type].push(U),1===this.state)for(const W of this._executionContexts)U._startPendingTasks(W);else this.onStateChangedObservable.addOnce((W=>{if(1===W)for(const l of this._executionContexts)U._startPendingTasks(l)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((U=>{1===U&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const U of this._executionContexts)for(const W in this._eventBlocks){const l=this._getContextualOrder(W,U);for(const W of l)W._startPendingTasks(U)}}_getContextualOrder(U,W){const l=this._eventBlocks[U].sort(((U,W)=>W.initPriority-U.initPriority));if("MeshPick"===U){const U=[];for(const M of l){const t=M.asset.getValue(W);let L=0;for(;L<l.length;L++){const U=l[L].asset.getValue(W);if(t&&U&&(0,m.l)(t,U))break}U.splice(L,0,M)}return U}return l}dispose(){var U;if(0!==this.state){this.state=0;for(const U of this._executionContexts)U._clearPendingBlocks();this._executionContexts.length=0;for(const U in this._eventBlocks)this._eventBlocks[U].length=0;null===(U=this._eventObserver)||void 0===U||U.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(U){const W=[],l=new Set;for(const M in this._eventBlocks)for(const U of this._eventBlocks[M])W.push(U),l.add(U.uniqueId);for(;W.length>0;){const M=W.pop();U(M);for(const U of M.dataInputs)for(const M of U._connectedPoint)l.has(M._ownerBlock.uniqueId)||(W.push(M._ownerBlock),l.add(M._ownerBlock.uniqueId));if(M instanceof s.c)for(const U of M.signalOutputs)for(const M of U._connectedPoint)l.has(M._ownerBlock.uniqueId)||(W.push(M._ownerBlock),l.add(M._ownerBlock.uniqueId))}}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},W=arguments.length>1?arguments[1]:void 0;U.allBlocks=[],this.visitAllBlocks((W=>{const l={};W.serialize(l),U.allBlocks.push(l)})),U.executionContexts=[];for(const l of this._executionContexts){const M={};l.serialize(M,W),U.executionContexts.push(M)}}}class g{constructor(U){this.config=U,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Gd.nk.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Gd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const U=this._executeOnNextFrame.slice(0);if(U.length)for(const W of U){this.notifyCustomEvent(W.id,W.data,!1);const U=this._executeOnNextFrame.findIndex((U=>U.uniqueId===W.uniqueId));-1!==U&&this._executeOnNextFrame.splice(U,1)}}));(g.SceneCoordinators.get(this.config.Gd)??[]).push(this)}createGraph(){const U=new f({Gd:this.config.Gd,coordinator:this});return this._flowGraphs.push(U),U}removeGraph(U){const W=this._flowGraphs.indexOf(U);-1!==W&&(U.dispose(),this._flowGraphs.splice(W,1))}start(){for(const U of this._flowGraphs)U.start()}dispose(){var U,W;for(const t of this._flowGraphs)t.dispose();this._flowGraphs.length=0,null===(U=this._disposeObserver)||void 0===U||U.remove(),null===(W=this._onBeforeRenderObserver)||void 0===W||W.remove();const l=g.SceneCoordinators.get(this.config.Gd)??[],M=l.indexOf(this);-1!==M&&l.splice(M,1)}serialize(U,W){U._flowGraphs=[];for(const l of this._flowGraphs){const M={};l.serialize(M,W),U._flowGraphs.push(M)}U.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(U){let W=this._customEventsMap.get(U);return W||(W=new t.b,this._customEventsMap.set(U,W)),W}notifyCustomEvent(U,W){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:U,data:W,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(U)){const W=this._eventExecutionCounter.get(U);if(this._eventExecutionCounter.set(U,W+1),W>=g.MaxEventTypeExecutionPerFrame)return void(W===g.MaxEventTypeExecutionPerFrame&&q.b.Warn(`FlowGraphCoordinator: Too many executions of event "${U}".`))}else this._eventExecutionCounter.set(U,1);const l=this._customEventsMap.get(U);l&&l.notifyObservers(W)}}g.MaxEventsPerType=30,g.MaxEventTypeExecutionPerFrame=30,g.SceneCoordinators=new Map},12754:(U,W,l)=>{"use strict";l.d(W,{d:()=>t});var M=l(12761);class t extends M.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(U){U._notifyExecuteNode(this),this.done._activateSignal(U)}}},12730:(U,W,l)=>{"use strict";l.d(W,{c:()=>B});var M=l(12739),t=l(12742),L=l(655);class p extends t.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(U){super.connectTo(U),this._connectedPoint.sort(((U,W)=>W.priority-U.priority))}_activateSignal(U){var W;if(null===(W=U.logger)||void 0===W||W.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(U,this),U._increaseExecutionId();else for(const l of this._connectedPoint)l._activateSignal(U)}}(0,L.f)("FlowGraphSignalConnection",p);class B extends M.e{constructor(U){super(U),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(U){const W=new p(U,0,this);return this.signalInputs.push(W),W}_registerSignalOutput(U){const W=new p(U,1,this);return this.signalOutputs.push(W),W}_unregisterSignalInput(U){const W=this.signalInputs.findIndex((W=>W.name===U));-1!==W&&(this.signalInputs[W].dispose(),this.signalInputs.splice(W,1))}_unregisterSignalOutput(U){const W=this.signalOutputs.findIndex((W=>W.name===U));-1!==W&&(this.signalOutputs[W].dispose(),this.signalOutputs.splice(W,1))}_reportError(U,W){this.error.payload="string"===typeof W?new Error(W):W,this.error._activateSignal(U)}getSignalInput(U){return this.signalInputs.find((W=>W.name===U))}getSignalOutput(U){return this.signalOutputs.find((W=>W.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.signalInputs=[],U.signalOutputs=[];for(const W of this.signalInputs){const l={};W.serialize(l),U.signalInputs.push(l)}for(const W of this.signalOutputs){const l={};W.serialize(l),U.signalOutputs.push(l)}}deserialize(U){for(let W=0;W<U.signalInputs.length;W++){const l=this.getSignalInput(U.signalInputs[W].name);if(!l)throw new Error("Could not find signal input with name "+U.signalInputs[W].name+" in block "+U.className);l.deserialize(U.signalInputs[W])}for(let W=0;W<U.signalOutputs.length;W++){const l=this.getSignalOutput(U.signalOutputs[W].name);if(!l)throw new Error("Could not find signal output with name "+U.signalOutputs[W].name+" in block "+U.className);l.deserialize(U.signalOutputs[W])}}getClassName(){return"FlowGraphExecutionBlock"}}},12766:(U,W,l)=>{"use strict";l.d(W,{e:()=>t});var M=l(12730);class t extends M.c{constructor(U){super(U),this.out=this._registerSignalOutput("out")}}},12704:(U,W,l)=>{"use strict";l.d(W,{A:()=>s,E:()=>w,I:()=>K,M:()=>i,N:()=>O,Q:()=>o,U:()=>D,d:()=>A,h:()=>j,k:()=>N,n:()=>r,q:()=>m,r:()=>f,s:()=>y,u:()=>Z,w:()=>q});var M,t=l(706),L=l(742),p=l(12699),B=l(12713);!function(U){U.Any="any",U.String="string",U.Number="number",U.Boolean="boolean",U.Object="object",U.Integer="FlowGraphInteger",U.Vector2="Vector2",U.ik="ik",U.Vector4="Vector4",U.Quaternion="Quaternion",U.Matrix="Matrix",U.Matrix2D="Matrix2D",U.Matrix3D="Matrix3D",U.zk="zk",U.Ak="Ak"}(M||(M={}));class k{constructor(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=U,this.defaultValue=W,this.animationType=l}serialize(U){U.typeName=this.typeName,U.defaultValue=this.defaultValue}}const A=new k("any",void 0),q=new k("string",""),y=new k("number",0,0),j=new k("boolean",!1),s=new k("Vector2",t.h.Zero(),5),w=new k("ik",t.l.Zero(),1),K=new k("Vector4",t.p.Zero()),r=new k("Matrix",t.c.Identity(),3),m=new k("Matrix2D",new B.b),f=new k("Matrix3D",new B.f),g=new k("zk",L.e.Black(),4),E=new k("Ak",new L.f(0,0,0,0),7),Z=new k("Quaternion",t.e.Identity(),2);Z.typeTransformer=U=>{if(U.getClassName){if("Vector4"===U.getClassName())return t.e.gk(U.qk());if("ik"===U.getClassName())return t.e.FromEulerVector(U);if("Matrix"===U.getClassName())return t.e.FromRotationMatrix(U)}return U};const N=new k("FlowGraphInteger",new p.d(0),0);function D(U){const W=U;switch(typeof U){case"string":return q;case"number":return y;case"boolean":return j;case"object":if(W.getClassName)switch(W.getClassName()){case"Vector2":return s;case"ik":return w;case"Vector4":return K;case"Matrix":return r;case"zk":return g;case"Ak":return E;case"Quaternion":return Z;case"FlowGraphInteger":return N;case"Matrix2D":return m;case"Matrix3D":return f}return A;default:return A}}function o(U){switch(U){case"string":return q;case"number":return y;case"boolean":return j;case"Vector2":return s;case"ik":return w;case"Vector4":return K;case"Matrix":return r;case"zk":return g;case"Ak":return E;case"Quaternion":return Z;case"FlowGraphInteger":return N;case"Matrix2D":return m;case"Matrix3D":return f;default:return A}}function i(U){switch(U){case"number":default:return 0;case"Vector2":return 5;case"ik":return 1;case"Matrix":return 3;case"zk":return 4;case"Ak":return 7;case"Quaternion":return 2}}function O(U){switch(U){case 0:return y;case 5:return s;case 1:return w;case 3:return r;case 4:return g;case 7:return E;case 2:return Z;default:return A}}},12692:(U,W,l)=>{"use strict";l.d(W,{e:()=>q,i:()=>A,k:()=>y});var M=l(742),t=l(706),L=l(12699),p=l(12704),B=l(12713);function k(U){return"Vector2"===U||"ik"===U||"Vector4"===U||"Quaternion"===U||"zk"===U||"Ak"===U}function A(U,W,l){var M;const t=(null===W||void 0===W||null===(M=W.getClassName)||void 0===M?void 0:M.call(W))??"";if(k(t)||function(U){return"Matrix"===U||"Matrix2D"===U||"Matrix3D"===U}(t))l[U]={value:W.qk(),className:t};else if("FlowGraphInteger"===t)l[U]={value:W.value,className:t};else if(t&&(W.id||W.name))l[U]={id:W.id,name:W.name,className:t};else{if("object"===typeof W)throw new Error(`Could not serialize value ${W}`);l[U]=W}}function q(U,W,l,A){const y=W[U];let j;const s=(null===y||void 0===y?void 0:y.type)??(null===y||void 0===y?void 0:y.className);if(function(U){return"Mesh"===U||"AbstractMesh"===U||"GroundMesh"===U||"InstanceMesh"===U||"LinesMesh"===U||"GoldbergMesh"===U||"GreasedLineMesh"===U||"TrailMesh"===U}(s)){let U=A.meshes.filter((U=>y.id?U.id===y.id:U.name===y.name));0===U.length&&(U=A.transformNodes.filter((U=>y.id?U.id===y.id:U.name===y.name))),j=y.uniqueId?U.find((U=>U.uniqueId===y.uniqueId)):U[0]}else if(k(s))j=function(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===U)return t.h.gk(W);if("ik"===U)return l&&(W[2]*=-1),t.l.gk(W);if("Vector4"===U)return t.p.gk(W);if("Quaternion"===U)return l&&(W[2]*=-1,W[3]*=-1),t.e.gk(W);if("zk"===U)return new M.e(W[0],W[1],W[2]);if("Ak"===U)return new M.f(W[0],W[1],W[2],W[3]);throw new Error(`Unknown vector class name ${U}`)}(s,y.value);else if(function(U){return"AnimationGroup"===U}(s)){const U=A.animationGroups.filter((U=>U.name===y.name));j=1===U.length?U[0]:U.find((U=>U.uniqueId===y.uniqueId))}else j="Matrix"===s?t.c.gk(y.value):"Matrix2D"===s?new B.b(y.value):"Matrix3D"===s?new B.f(y.value):"FlowGraphInteger"===s?L.d.FromValue(y.value):"number"===s||"string"===s||"boolean"===s?y.value[0]:y&&void 0!==y.value?y.value:Array.isArray(y)?y.reduce(((U,W)=>W.eventData?(U[W.id]={type:(0,p.Q)(W.type)},"undefined"!==typeof W.value&&(U[W.id].value=q("value",W,l,A)),U):U),{}):y;return j}function y(U){return"FlowGraphJsonPointerParserBlock"===U}},12746:(U,W,l)=>{"use strict";function M(U,W){return!(!U.parent||U.parent!==W&&!M(U.parent,W))}function t(U){if(U.getClassName)return U.getClassName()}function L(U,W){return U===W&&("Vector2"===U||"ik"===U||"Vector4"===U||"Quaternion"===U)}function p(U,W){return U===W&&("Matrix"===U||"Matrix2D"===U||"Matrix3D"===U)}function B(U,W){return"FlowGraphInteger"===U&&"FlowGraphInteger"===W}function k(U,W){const l="number"===typeof U||"number"===typeof(null===U||void 0===U?void 0:U.value);return l&&!W?!isNaN(A(U)):l}function A(U){return"number"===typeof U?U:U.value}l.d(W,{c:()=>B,e:()=>p,g:()=>L,i:()=>t,l:()=>M,n:()=>A,p:()=>k})},12107:(U,W,l)=>{"use strict";l.r(W),l.d(W,{SceneInstrumentation:()=>L});var M=l(503),t=l(2153);class L{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(U){U!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=U,U?(this._onBeforeActiveMeshesEvaluationObserver=this.Gd.onBeforeActiveMeshesEvaluationObservable.add((()=>{M.h.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Gd.onAfterActiveMeshesEvaluationObservable.add((()=>{M.h.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Gd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Gd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(U){U!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=U,U?(this._onBeforeRenderTargetsRenderObserver=this.Gd.onBeforeRenderTargetsRenderObservable.add((()=>{M.h.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Gd.onAfterRenderTargetsRenderObservable.add((()=>{M.h.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Gd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Gd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(U){U!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=U,U?(this._onBeforeParticlesRenderingObserver=this.Gd.onBeforeParticlesRenderingObservable.add((()=>{M.h.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Gd.onAfterParticlesRenderingObservable.add((()=>{M.h.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Gd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Gd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(U){U!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=U,this.Gd.spriteManagers&&(U?(this._onBeforeSpritesRenderingObserver=this.Gd.onBeforeSpritesRenderingObservable.add((()=>{M.h.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Gd.onAfterSpritesRenderingObservable.add((()=>{M.h.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Gd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Gd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(U){U!==this._capturePhysicsTime&&this.Gd.onBeforePhysicsObservable&&(this._capturePhysicsTime=U,U?(this._onBeforePhysicsObserver=this.Gd.onBeforePhysicsObservable.add((()=>{M.h.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Gd.onAfterPhysicsObservable.add((()=>{M.h.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Gd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Gd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(U){U!==this._captureAnimationsTime&&(this._captureAnimationsTime=U,U?this._onAfterAnimationsObserver=this.Gd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Gd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(U){this._captureFrameTime=U}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(U){this._captureInterFrameTime=U}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(U){U!==this._captureRenderTime&&(this._captureRenderTime=U,U?(this._onBeforeDrawPhaseObserver=this.Gd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),M.h.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Gd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),M.h.EndPerformanceCounter("Main render")}))):(this.Gd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Gd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(U){U!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=U,U?(this._onBeforeCameraRenderObserver=this.Gd.onBeforeCameraRenderObservable.add((U=>{this._cameraRenderTime.beginMonitoring(),M.h.StartPerformanceCounter(`Rendering camera ${U.name}`)})),this._onAfterCameraRenderObserver=this.Gd.onAfterCameraRenderObservable.add((U=>{this._cameraRenderTime.endMonitoring(!1),M.h.EndPerformanceCounter(`Rendering camera ${U.name}`)}))):(this.Gd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Gd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Gd.getEngine()._drawCalls}constructor(U){this.Gd=U,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new t.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new t.d,this._captureFrameTime=!1,this._frameTime=new t.d,this._captureRenderTime=!1,this._renderTime=new t.d,this._captureInterFrameTime=!1,this._interFrameTime=new t.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new t.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new t.d,this._capturePhysicsTime=!1,this._physicsTime=new t.d,this._captureAnimationsTime=!1,this._animationsTime=new t.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new t.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=U.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(M.h.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Gd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=U.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(M.h.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.mk(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.mk(),this._captureParticlesRenderTime&&this._particlesRenderTime.mk(),this._captureSpritesRenderTime&&this._spritesRenderTime.mk(),this._captureRenderTime&&this._renderTime.mk(),this._captureCameraRenderTime&&this._cameraRenderTime.mk()}))}dispose(){this._disposed||(this.Gd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Gd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Gd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Gd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Gd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Gd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Gd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Gd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Gd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Gd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Gd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Gd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Gd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Gd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Gd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Gd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Gd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Gd=null,this._disposed=!0)}}},12678:(U,W,l)=>{"use strict";l.d(W,{e:()=>q});var M=l(686),t=l(688),L=l(706),p=l(730),B=l(11868),k=l(11914),A=l(655);p.c.AddNodeConstructor("Light_Type_1",((U,W)=>()=>new q(U,L.l.Zero(),W)));class q extends k.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(U){this._shadowFrustumSize=U,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(U){this._shadowOrthoScale=U,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(U){this._orthoLeft=U}get orthoRight(){return this._orthoRight}set orthoRight(U){this._orthoRight=U}get orthoTop(){return this._orthoTop}set orthoTop(U){this._orthoTop=U}get orthoBottom(){return this._orthoBottom}set orthoBottom(U){this._orthoBottom=U}constructor(U,W,l){super(U,l),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=W.scale(-1),this.direction=W}getClassName(){return"hb"}getTypeID(){return B.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(U,W,l){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(U):this._setDefaultAutoExtendShadowProjectionMatrix(U,W,l)}_setDefaultFixedFrustumShadowProjectionMatrix(U){const W=this.va().activeCamera;W&&L.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:W.bk,void 0!==this.shadowMaxZ?this.shadowMaxZ:W.maxZ,U,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(U,W,l){const M=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const U=L.l.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let M=Number.MAX_VALUE,t=-Number.MAX_VALUE;for(let p=0;p<l.length;p++){const B=l[p];if(!B)continue;const k=B.getBoundingInfo().boundingBox;for(let l=0;l<k.vectorsWorld.length;l++)L.l.TransformCoordinatesToRef(k.vectorsWorld[l],W,U),U.x<this._orthoLeft&&(this._orthoLeft=U.x),U.y<this._orthoBottom&&(this._orthoBottom=U.y),U.x>this._orthoRight&&(this._orthoRight=U.x),U.y>this._orthoTop&&(this._orthoTop=U.y),this.autoCalcShadowZBounds&&(U.z<M&&(M=U.z),U.z>t&&(t=U.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=M,this._shadowMaxZ=t)}const t=this._orthoRight-this._orthoLeft,p=this._orthoTop-this._orthoBottom,B=void 0!==this.shadowMinZ?this.shadowMinZ:(null===M||void 0===M?void 0:M.bk)||0,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===M||void 0===M?void 0:M.maxZ)||1e4,A=this.va().getEngine().useReverseDepthBuffer;L.c.OrthoOffCenterLHToRef(this._orthoLeft-t*this.shadowOrthoScale,this._orthoRight+t*this.shadowOrthoScale,this._orthoBottom-p*this.shadowOrthoScale,this._orthoTop+p*this.shadowOrthoScale,A?k:B,A?B:k,U,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,W){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,W),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,W),this)}transferToNodeMaterialEffect(U,W){return this.computeTransformedInformation()?(U.setFloat3(W,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(U.setFloat3(W,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(U){const W=this._scene.getEngine();return!W.useReverseDepthBuffer&&W.isNDCHalfZRange?0:1}getDepthMaxZ(U){const W=this._scene.getEngine();return W.useReverseDepthBuffer&&W.isNDCHalfZRange?0:1}prepareLightSpecificDefines(U,W){U["DIRLIGHT"+W]=!0}}(0,M.e)([(0,t.T)()],q.prototype,"shadowFrustumSize",null),(0,M.e)([(0,t.T)()],q.prototype,"shadowOrthoScale",null),(0,M.e)([(0,t.T)()],q.prototype,"autoUpdateExtends",void 0),(0,M.e)([(0,t.T)()],q.prototype,"autoCalcShadowZBounds",void 0),(0,M.e)([(0,t.T)("orthoLeft")],q.prototype,"_orthoLeft",void 0),(0,M.e)([(0,t.T)("orthoRight")],q.prototype,"_orthoRight",void 0),(0,M.e)([(0,t.T)("orthoTop")],q.prototype,"_orthoTop",void 0),(0,M.e)([(0,t.T)("orthoBottom")],q.prototype,"_orthoBottom",void 0),(0,A.f)("BABYLON.DirectionalLight",q)},13002:(U,W,l)=>{"use strict";l.d(W,{d:()=>q});var M=l(686),t=l(688),L=l(706),p=l(742),B=l(730),k=l(11868),A=l(655);B.c.AddNodeConstructor("Light_Type_3",((U,W)=>()=>new q(U,L.l.Zero(),W)));class q extends k.c{constructor(U,W,l){super(U,l),this.groundColor=new p.e(0,0,0),this.direction=W||L.l.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ib"}setDirectionToTarget(U){return this.direction=L.l.Normalize(U.de(L.l.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(U,W){const l=L.l.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",l.x,l.y,l.z,0,W),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.bb),W),this}transferToNodeMaterialEffect(U,W){const l=L.l.Normalize(this.direction);return U.setFloat3(W,l.x,l.y,l.z),this}fk(){return this._worldMatrix||(this._worldMatrix=L.c.Identity()),this._worldMatrix}getTypeID(){return k.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(U,W){U["HEMILIGHT"+W]=!0}}(0,M.e)([(0,t.n)()],q.prototype,"groundColor",void 0),(0,M.e)([(0,t.R)()],q.prototype,"direction",void 0),(0,A.f)("BABYLON.HemisphericLight",q)},12646:(U,W,l)=>{"use strict";l.d(W,{d:()=>y});var M=l(686),t=l(688),L=l(706),p=l(730),B=l(11868),k=l(11914),A=l(2048),q=l(655);p.c.AddNodeConstructor("Light_Type_2",((U,W)=>()=>new y(U,L.l.Zero(),L.l.Zero(),0,0,W)));class y extends k.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(U){this._iesProfileTexture!==U&&(this._iesProfileTexture=U,this._iesProfileTexture&&y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(U){this._angle=U,this._cosHalfAngle=Math.cos(.5*U),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(U){this._innerAngle=U,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(U){this._shadowAngleScale=U,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(U){this._projectionTextureLightNear=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(U){this._projectionTextureLightFar=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(U){this._projectionTextureUpDirection=U,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(U){this._projectionTexture!==U&&(this._projectionTexture=U,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(U){return void 0!==U.onGeneratedObservable}static _IsTexture(U){return void 0!==U.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(U){this._projectionTextureProjectionLightMatrix=U,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(U,W,l,M,t,p){super(U,p),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=L.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=L.l.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=L.l.Zero(),this._projectionTextureViewLightMatrix=L.c.Zero(),this._projectionTextureProjectionLightMatrix=L.c.Zero(),this._projectionTextureScalingMatrix=L.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=W,this.direction=l,this.angle=M,this.exponent=t}getClassName(){return"SpotLight"}getTypeID(){return B.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(U){super._setDirection(U),this._projectionTextureViewLightDirty=!0}_setPosition(U){super._setPosition(U),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(U,W,l){const M=this.va().activeCamera;if(!M)return;this._shadowAngleScale=this._shadowAngleScale||1;const t=this._shadowAngleScale*this._angle,p=void 0!==this.shadowMinZ?this.shadowMinZ:M.bk,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ,k=this.va().getEngine().useReverseDepthBuffer;L.c.PerspectiveFovLHToRef(t,1,k?B:p,k?p:B,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,k)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),L.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const U=this.projectionTextureLightFar,W=this.projectionTextureLightNear,l=U/(U-W),M=-l*W,t=1/Math.tan(this._angle/2);L.c.FromValuesToRef(t/1,0,0,0,0,t,0,0,0,0,l,1,0,0,M,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof A.d){const U=this._projectionTexture.uScale/2,W=this._projectionTexture.vScale/2;L.c.FromValuesToRef(U,0,0,0,0,W,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(U,W){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),U.setMatrix("textureProjectionMatrix"+W,this._projectionTextureMatrix),U.setTexture("projectionLightTexture"+W,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&U.setTexture("iesLightTexture"+W,this._iesProfileTexture),this}transferToEffect(U,W){let l;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,W),l=L.l.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,W),l=L.l.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",l.x,l.y,l.z,this._cosHalfAngle,W),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,W),this}transferToNodeMaterialEffect(U,W){let l;return l=this.computeTransformedInformation()?L.l.Normalize(this.transformedDirection):L.l.Normalize(this.direction),this.va().useRightHandedSystem?U.setFloat3(W,-l.x,-l.y,-l.z):U.setFloat3(W,l.x,l.y,l.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(U){const W=this._scene.getEngine(),l=void 0!==this.shadowMinZ?this.shadowMinZ:(null===U||void 0===U?void 0:U.bk)??0;return W.useReverseDepthBuffer&&W.isNDCHalfZRange?l:this._scene.getEngine().isNDCHalfZRange?0:l}getDepthMaxZ(U){const W=this._scene.getEngine(),l=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===U||void 0===U?void 0:U.maxZ)??1e4;return W.useReverseDepthBuffer&&W.isNDCHalfZRange?0:l}prepareLightSpecificDefines(U,W){U["SPOTLIGHT"+W]=!0,U["PROJECTEDLIGHTTEXTURE"+W]=!(!this.projectionTexture||!this.projectionTexture.isReady()),U["IESLIGHTTEXTURE"+W]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,M.e)([(0,t.T)()],y.prototype,"angle",null),(0,M.e)([(0,t.T)()],y.prototype,"innerAngle",null),(0,M.e)([(0,t.T)()],y.prototype,"shadowAngleScale",null),(0,M.e)([(0,t.T)()],y.prototype,"exponent",void 0),(0,M.e)([(0,t.T)()],y.prototype,"projectionTextureLightNear",null),(0,M.e)([(0,t.T)()],y.prototype,"projectionTextureLightFar",null),(0,M.e)([(0,t.T)()],y.prototype,"projectionTextureUpDirection",null),(0,M.e)([(0,t.K)("projectedLightTexture")],y.prototype,"_projectionTexture",void 0),(0,q.f)("BABYLON.SpotLight",y)},12385:(U,W,l)=>{"use strict";l.d(W,{e:()=>p,g:()=>L,i:()=>B});const M={},t={};function L(U,W){M[U]=W}function p(U,W){t[U]=W}function B(U){return t[U]?t[U]:null}},12272:(U,W,l)=>{"use strict";l.d(W,{e:()=>D,f:()=>R});var M,t=l(503),L=l(496),p=l(2178),B=l(543),k=l(512),A=l(814),q=l(547),y=l(552),j=l(658),s=l(592),w=l(541);!function(U){U[U.Clean=0]="Clean",U[U.Stop=1]="Stop",U[U.Sync=2]="Sync",U[U.NoSync=3]="NoSync"}(M||(M={}));const K=new L.b,r={};let m=!1;function f(){return r[".babylon"]}function g(U,W){const l=r[U];return l||(k.b.Warn("Unable to find a plugin to load "+U+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),W?f():void 0)}function E(U,W,l){let M="Unable to load from "+(U.rawData?"binary data":U.url);return W?M+=`: ${W}`:l&&(M+=`: ${l}`),M}async function Z(U,W,l,M,t,L,p,B,k){var A;const y="data:"===(j=U.url).substring(0,5)?j.substring(5):null;var j;if(U.rawData&&!p)throw"When using ArrayBufferView to load data the file extension must be provided.";const m=y||p?"":function(U){const W=U.indexOf("?");-1!==W&&(U=U.substring(0,W));const l=U.lastIndexOf(".");return U.substring(l,U.length).toLowerCase()}(U.url);let E=p?g(p,!0):y?function(U){for(const W in r){const l=r[W].plugin;if(l.canDirectLoad&&l.canDirectLoad(U))return r[W]}return f()}(U.url):g(m,!1);if(!E&&m){if(U.url&&!U.url.startsWith("blob:")){const W=await async function(U,W){const l=W.method||"GET";return await new Promise(((M,t)=>{const L=new w.c;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const U={};if(W.responseHeaders)for(const l of W.responseHeaders)U[l]=L.getResponseHeader(l)||"";M({response:L.response,headerValues:U})}else t(`Unable to fetch data from ${U}. Error code: ${L.status}`)})),L.open(l,U),L.send()}))}(U.url,{method:"HEAD",responseHeaders:["Content-Type"]}),l=W.headerValues?W.headerValues["Content-Type"]:"";l&&(E=function(U){for(const W in r){const l=r[W];if(l.mimeType===U)return l}}(l))}E||(E=f())}if(!E)throw new Error(`No plugin or fallback for ${p??U.url}`);if(!1===(null===k||void 0===k||null===(A=k[E.plugin.name])||void 0===A?void 0:A.enabled))throw new Error(`The '${E.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(U.rawData&&!E.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(U=>{if(E.plugin.createPlugin){const W=E.plugin.createPlugin(k??{});return W instanceof Promise?(W.then(U).catch((U=>{t("Error instantiating plugin.",U)})),null):(U(W),W)}return U(E.plugin),E.plugin})((k=>{var A;if(!k)throw`The loader plugin corresponding to the '${p}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(K.notifyObservers(k),y&&(k.canDirectLoad&&k.canDirectLoad(U.url)||!(0,q.f)(U.url))){if(k.directLoad){const U=k.directLoad(W,y);U instanceof Promise?U.then((U=>{l(k,U)})).catch((U=>{t("Error in directLoad of _loadData: "+U,U)})):l(k,U)}else l(k,y);return}const j=E.isBinary,w=(U,M)=>{W.u?t("Scene has been disposed"):l(k,U,M)};let r=null,m=!1;null===(A=k.nk)||void 0===A||A.add((()=>{m=!0,r&&(r.abort(),r=null),L()}));const f=()=>{if(m)return;const l=(U,W)=>{t(null===U||void 0===U?void 0:U.statusText,W)};if(!k.loadFile&&U.rawData)throw"Plugin does not support loading ArrayBufferView.";r=k.loadFile?k.loadFile(W,U.rawData||U.file||U.url,U.rootUrl,w,M,j,l,B):W._loadFile(U.file||U.url,w,M,!0,j,l)},g=W.getEngine();let Z=g.enableOfflineSupport;if(Z){let l=!1;for(const M of W.disableOfflineSupportExceptionRules)if(M.test(U.url)){l=!0;break}Z=!l}Z&&s.d.OfflineProviderFactory?W.offlineProvider=s.d.OfflineProviderFactory(U.url,f,g.disableManifestCheck):f()}))}function N(U,W){let l,M,L=null,p=null;if(W)if(W.name)l=`file:${W.name}`,M=W.name,L=W;else if(ArrayBuffer.isView(W))l="",M=(0,j.d)(),p=W;else if(W.startsWith("data:"))l=W,M="";else if(U){const L=W;if("/"===L.substring(0,1))return t.h.Error("Wrong sceneFilename parameter"),null;l=U+L,M=L}else l=W,M=t.h.GetFilename(W),U=t.h.GetFolderPath(W);else l=U,M=t.h.GetFilename(U),U=t.h.GetFolderPath(U);return{url:l,rootUrl:U,name:M,file:L,rawData:p}}function D(U){if("string"===typeof U.extensions){const W=U.extensions;r[W.toLowerCase()]={plugin:U,isBinary:!1}}else{const W=U.extensions,l=Object.keys(W);for(const M of l)r[M.toLowerCase()]={plugin:U,isBinary:W[M].isBinary,mimeType:W[M].mimeType}}}async function o(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.d.LastCreatedScene,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!M)return k.b.Error("No scene available to import mesh to"),null;const s=N(W,l);if(!s)return null;const w={};M.addPendingData(w);const K=()=>{M.removePendingData(w)},r=(U,W)=>{const l=E(s,U,W);p?p(M,l,new y.i(l,y.g.SceneLoaderError,W)):k.b.Error(l),K()},m=L?U=>{try{L(U)}catch(W){r("Error in onProgress callback: "+W,W)}}:void 0,f=(U,W,l,L,p,B,k,A)=>{if(M.importedMeshesFiles.push(s.url),t)try{t(U,W,l,L,p,B,k,A)}catch(q){r("Error in onSuccess callback: "+q,q)}M.removePendingData(w)};return await Z(s,M,((W,l,t)=>{if(W.rewriteRootURL&&(s.rootUrl=W.rewriteRootURL(s.rootUrl,t)),W.importMesh){const t=[],L=[],p=[];if(!W.importMesh(U,M,l,s.rootUrl,t,L,p,r))return;M.loadingPluginName=W.name,f(t,L,p,[],[],[],[],[])}else{W.importMeshAsync(U,M,l,s.rootUrl,m,s.name).then((U=>{M.loadingPluginName=W.name,f(U.meshes,U.Fk,U.skeletons,U.animationGroups,U.transformNodes,U.geometries,U.lights,U.spriteManagers)})).catch((U=>{r(U.message,U)}))}}),m,r,K,A,q,j)}async function i(U,W,l,M,t,L,p,B){return await new Promise(((k,A)=>{try{o(U,W,l,M,((U,W,l,M,t,L,p,B)=>{k({meshes:U,Fk:W,skeletons:l,animationGroups:M,transformNodes:t,geometries:L,lights:p,spriteManagers:B})}),t,((U,W,l)=>{A(l||new Error(W))}),L,p,B).catch(A)}catch(y){A(y)}}))}async function O(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedEngine,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};l?await d(U,W,new p.c(l),M,L,k,A,q,y):t.h.Error("No engine available")}async function e(U,W,l,M,t,L,p){return await new Promise(((B,k)=>{O(U,W,l,(U=>{B(U)}),M,((U,W,l)=>{k(l||new Error(W))}),t,L,p)}))}async function d(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedScene,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return k.b.Error("No scene available to append to"),null;const s=N(U,W);if(!s)return null;const w={};l.addPendingData(w);const K=()=>{l.removePendingData(w)};A.b.ShowLoadingScreen&&!m&&(m=!0,l.getEngine().displayLoadingUI(),l.executeWhenReady((()=>{l.getEngine().hideLoadingUI(),m=!1})));const r=(U,W)=>{const M=E(s,U,W);L?L(l,M,new y.i(M,y.g.SceneLoaderError,W)):k.b.Error(M),K()},f=t?U=>{try{t(U)}catch(W){r("Error in onProgress callback",W)}}:void 0,g=()=>{if(M)try{M(l)}catch(U){r("Error in onSuccess callback",U)}l.removePendingData(w)};return await Z(s,l,((U,W)=>{if(U.load){if(!U.load(l,W,s.rootUrl,r))return;l.loadingPluginName=U.name,g()}else{U.loadAsync(l,W,s.rootUrl,f,s.name).then((()=>{l.loadingPluginName=U.name,g()})).catch((U=>{r(U.message,U)}))}}),f,r,K,p,q,j)}async function H(U,W,l,M,t,L,p){return await new Promise(((B,k)=>{try{d(U,W,l,(U=>{B(U)}),M,((U,W,l)=>{k(l||new Error(W))}),t,L,p).catch(k)}catch(y){k(y)}}))}async function V(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedScene,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return k.b.Error("No scene available to load asset container to"),null;const j=N(U,W);if(!j)return null;const s={};l.addPendingData(s);const w=()=>{l.removePendingData(s)},K=(U,W)=>{const M=E(j,U,W);L?L(l,M,new y.i(M,y.g.SceneLoaderError,W)):k.b.Error(M),w()},r=t?U=>{try{t(U)}catch(W){K("Error in onProgress callback",W)}}:void 0,m=U=>{if(M)try{M(U)}catch(W){K("Error in onSuccess callback",W)}l.removePendingData(s)};return await Z(j,l,((U,W)=>{if(U.loadAssetContainer){const M=U.loadAssetContainer(l,W,j.rootUrl,K);if(!M)return;M.populateRootNodes(),l.loadingPluginName=U.name,m(M)}else if(U.loadAssetContainerAsync){U.loadAssetContainerAsync(l,W,j.rootUrl,r,j.name).then((W=>{W.populateRootNodes(),l.loadingPluginName=U.name,m(W)})).catch((U=>{K(U.message,U)}))}else K("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),r,K,w,p,A,q)}async function n(U,W,l,M,t,L,p){return await new Promise(((B,k)=>{try{V(U,W,l,(U=>{B(U)}),M,((U,W,l)=>{k(l||new Error(W))}),t,L,p).catch(k)}catch(y){k(y)}}))}async function x(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.d.LastCreatedScene,M=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",s=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!l)return void k.b.Error("No scene available to load animations to");if(M){for(const M of l.animatables)M.reset();l.stopAllAnimations();const U=l.animationGroups.slice();for(const l of U)l.dispose();const W=l.getNodes();for(const l of W)l.animations&&(l.animations=[])}else switch(t){case 0:const U=l.animationGroups.slice();for(const W of U)W.dispose();break;case 1:for(const W of l.animationGroups)W.stop();break;case 2:for(const W of l.animationGroups)W.reset(),W.restart();break;case 3:break;default:return void k.b.Error("Unknown animation group loading mode value '"+t+"'")}const w=l.animatables.length;await V(U,W,l,(U=>{U.mergeAnimationsTo(l,l.animatables.slice(w),L),U.dispose(),l.onAnimationFileImportedObservable.notifyObservers(l),p&&p(l)}),A,q,y,j,s)}async function I(U,W,l,M,t,L,p,B,k,A){return await new Promise(((q,j)=>{try{x(U,W,l,M,t,L,(U=>{q(U)}),p,((U,W,l)=>{j(l||new Error(W))}),B,k,A).catch(j)}catch(y){j(y)}}))}class R{static get ForceFullSceneLoadingForIncremental(){return A.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(U){A.b.ForceFullSceneLoadingForIncremental=U}static get ShowLoadingScreen(){return A.b.ShowLoadingScreen}static set ShowLoadingScreen(U){A.b.ShowLoadingScreen=U}static get loggingLevel(){return A.b.loggingLevel}static set loggingLevel(U){A.b.loggingLevel=U}static get CleanBoneMatrixWeights(){return A.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(U){A.b.CleanBoneMatrixWeights=U}static GetDefaultPlugin(){return f()}static GetPluginForExtension(U){var W;return null===(W=g(U,!0))||void 0===W?void 0:W.plugin}static IsPluginForExtensionAvailable(U){return function(U){return!!r[U]}(U)}static RegisterPlugin(U){D(U)}static ImportMesh(U,W,l,M,t,L,p,k,A){o(U,W,l,M,t,L,p,k,A).catch((U=>null===p||void 0===p?void 0:p(B.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportMeshAsync(U,W,l,M,t,L,p){return await i(U,W,l,M,t,L,p)}static Load(U,W,l,M,t,L,p,k){O(U,W,l,M,t,L,p,k).catch((U=>null===L||void 0===L?void 0:L(B.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAsync(U,W,l,M,t,L){return await e(U,W,l,M,t,L)}static Append(U,W,l,M,t,L,p,k){d(U,W,l,M,t,L,p,k).catch((U=>null===L||void 0===L?void 0:L(l??B.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async AppendAsync(U,W,l,M,t,L){return await H(U,W,l,M,t,L)}static LoadAssetContainer(U,W,l,M,t,L,p,k){V(U,W,l,M,t,L,p,k).catch((U=>null===L||void 0===L?void 0:L(l??B.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAssetContainerAsync(U,W,l,M,t,L){return await n(U,W,l,M,t,L)}static ImportAnimations(U,W,l,M,t,L,p,k,A,q,y){x(U,W,l,M,t,L,p,k,A,q,y).catch((U=>null===A||void 0===A?void 0:A(l??B.d.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportAnimationsAsync(U,W,l,M,t,L,p,B,k,A,q){return await I(U,W,l,M,t,L,B,A,q)}}R.NO_LOGGING=0,R.MINIMAL_LOGGING=1,R.SUMMARY_LOGGING=2,R.DETAILED_LOGGING=3,R.OnPluginActivatedObservable=K},12662:(U,W,l)=>{"use strict";l.d(W,{e:()=>j});var M=l(686),t=l(688),L=l(503),p=l(706),B=l(2051),k=l(2048),A=l(655),q=l(496),y=l(734);l(2160);class j extends B.c{set boundingBoxSize(U){if(this._boundingBoxSize&&this._boundingBoxSize.equals(U))return;this._boundingBoxSize=U;const W=this.va();W&&W.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(U){this._rotationY=U,this.setReflectionTextureMatrix(p.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(U,W,l){let M="";for(const t of U)M+=t;return new j(M,W,null,l,U)}static CreateFromPrefilteredData(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=W.useDelayedTextureLoading;W.useDelayedTextureLoading=!1;const L=new j(U,W,null,!1,null,null,null,void 0,!0,l,M);return W.useDelayedTextureLoading=t,L}constructor(U,W){var l;let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,w=arguments.length>10&&void 0!==arguments[10]&&arguments[10],K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,m=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0;super(W),this.onLoadObservable=new q.b,this.boundingBoxPosition=p.l.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new p.c,this._buffer=null,this.name=U,this.url=U,this._noMipmap=t,this.yi=!1,this.isCube=!0,this._textureMatrix=p.c.Identity(),this.coordinatesMode=k.d.CUBIC_MODE;let g=null,E=null;null===M||Array.isArray(M)?(this._noMipmap=t,this._format=y,this._createPolynomials=w,g=M,this._loaderOptions=m,this._useSRGBBuffer=f,this._lodScale=K,this._lodOffset=r):(g=M.extensions??null,this._noMipmap=M.noMipmap??!1,L=M.files??null,E=M.buffer??null,this._format=M.format??5,j=M.prefiltered??!1,s=M.forcedExtension??null,this._createPolynomials=M.createPolynomials??!1,this._lodScale=M.lodScale??.8,this._lodOffset=M.lodOffset??0,this._loaderOptions=M.loaderOptions,this._useSRGBBuffer=M.useSRGBBuffer,B=M.X??null,A=M.onError??null),(U||L)&&this.updateURL(U,s,B,j,A,g,null===(l=this.va())||void 0===l?void 0:l.useDelayedTextureLoading,L,E)}getClassName(){return"CubeTexture"}updateURL(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=U),this.url=U,W&&(this._forcedExtension=W);const A=U.lastIndexOf("."),q=W||(A>-1?U.substring(A).toLowerCase():""),y=0===q.indexOf(".dds"),j=0===q.indexOf(".env"),s=0===q.indexOf(".basis");if(j?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=M,M&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),B)this._files=B;else if(s||j||y||L||(L=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,L){for(let W=0;W<L.length;W++)this._files.push(U+L[W]);this._extensions=L}this._buffer=k,p?(this.delayLoadState=4,this._delayedOnLoad=l,this._delayedOnError=t):this._loadTexture(l,t)}delayLoad(U){4===this.delayLoadState&&(U&&(this._forcedExtension=U),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(U){var W,l;if(U.updateFlag===this._textureMatrix.updateFlag)return;U.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(l=this.va())||void 0===l||l.markAllMaterialsAsDirty(1,(U=>-1!==U.getActiveTextures().indexOf(this))));if(this._textureMatrix=U,null===(W=this.va())||void 0===W||!W.useRightHandedSystem)return;const M=p.f.ik[0],t=p.f.Quaternion[0],L=p.f.ik[1];this._textureMatrix.decompose(M,t,L),t.z*=-1,t.w*=-1,p.c.ComposeToRef(M,t,L,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var U;return null!==(U=this.va())&&void 0!==U&&U.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this.va(),M=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const t=()=>{var W;(this.onLoadObservable.notifyObservers(this),M)&&(M.dispose(),null===(W=this.va())||void 0===W||W.markAllMaterialsAsDirty(1));U&&U()},p=(U,l)=>{this._loadingError=!0,this._errorObject={message:U,exception:l},W&&W(U,l),k.d.OnTextureLoadErrorObservable.notifyObservers(this)};var B;this._texture?this._texture.isReady?L.h.SetImmediate((()=>t())):this._texture.onLoadedObservable.add((()=>t())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,l,this._lodScale,this._lodOffset,U,p,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,l,this._files,this._noMipmap,U,p,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(B=this._texture)||void 0===B||B.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(U,W,l){const M=y.e.Parse((()=>{let M=!1;return U.prefiltered&&(M=U.prefiltered),new j(l+(U.url??U.name),W,U.extensions,!1,U.files||null,null,null,void 0,M,U.forcedExtension)}),U,W);if(U.boundingBoxPosition&&(M.boundingBoxPosition=p.l.gk(U.boundingBoxPosition)),U.boundingBoxSize&&(M.boundingBoxSize=p.l.gk(U.boundingBoxSize)),U.animations)for(let t=0;t<U.animations.length;t++){const W=U.animations[t],l=(0,A.d)("BABYLON.Animation");l&&M.animations.push(l.Parse(W))}return M}clone(){let U=0;const W=y.e.Clone((()=>{const W=new j(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return U=W.uniqueId,W}),this);return W.uniqueId=U,W}}(0,M.e)([(0,t.T)()],j.prototype,"url",void 0),(0,M.e)([(0,t.R)()],j.prototype,"boundingBoxPosition",void 0),(0,M.e)([(0,t.R)()],j.prototype,"boundingBoxSize",null),(0,M.e)([(0,t.T)("rotationY")],j.prototype,"rotationY",null),(0,M.e)([(0,t.T)("files")],j.prototype,"_files",void 0),(0,M.e)([(0,t.T)("forcedExtension")],j.prototype,"_forcedExtension",void 0),(0,M.e)([(0,t.T)("extensions")],j.prototype,"_extensions",void 0),(0,M.e)([(0,t.B)("textureMatrix")],j.prototype,"_textureMatrix",void 0),(0,M.e)([(0,t.B)("textureMatrixRefraction")],j.prototype,"_textureMatrixRefraction",void 0),k.d._CubeTextureParser=j.Parse,(0,A.f)("BABYLON.CubeTexture",j)},13015:(U,W,l)=>{"use strict";l.d(W,{d:()=>k});var M=l(512),t=l(2048),L=l(665),p=l(2091),B=l(624);p.ThinEngine.prototype.createDynamicTexture=function(U,W,l,M){const t=new B.c(this,4);return t.baseWidth=U,t.baseHeight=W,l&&(U=this.needPOTTextures?(0,L.c)(U,this._caps.maxTextureSize):U,W=this.needPOTTextures?(0,L.c)(W,this._caps.maxTextureSize):W),t.width=U,t.height=W,t.isReady=!1,t.generateMipMaps=l,t.samplingMode=M,this.updateTextureSamplingMode(M,t),this._internalTexturesCache.push(t),t},p.ThinEngine.prototype.updateDynamicTexture=function(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!U)return;const p=this._gl,B=p.TEXTURE_2D,k=this._bindTextureDirectly(B,U,!0,L);this._unpackFlipY(void 0===l?U.invertY:l),M&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const A=this._getWebGLTextureType(U.type),q=this._getInternalFormat(t||U.format),y=this._getRGBABufferInternalSizedFormat(U.type,q);p.texImage2D(B,0,y,q,A,W),U.generateMipMaps&&p.generateMipmap(B),k||this._bindTextureDirectly(B,null),M&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t&&(U.format=t),U._dynamicTextureSource=W,U._premulAlpha=M,U.invertY=l||!1,U.isReady=!0};class k extends t.d{constructor(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,B=arguments.length>6?arguments[6]:void 0;const k=!l||l._isScene;super(null,k?l:null===l||void 0===l?void 0:l.Gd,k?!M:l,B,L,void 0,void 0,void 0,void 0,p),this.name=U,this.wrapU=t.d.CLAMP_ADDRESSMODE,this.wrapV=t.d.CLAMP_ADDRESSMODE,this._generateMipMaps=M;const A=this._getEngine();if(!A)return;if(W.getContext)this._canvas=W,this._ownCanvas=!1,this._texture=A.createDynamicTexture(this._canvas.width,this._canvas.height,M,L);else{this._canvas=A.createCanvas(1,1),this._ownCanvas=!0;const U=W;U.width||0===U.width?this._texture=A.createDynamicTexture(U.width,U.height,M,L):this._texture=A.createDynamicTexture(W,W,M,L)}const q=this.getSize();this._canvas.width!==q.width&&(this._canvas.width=q.width),this._canvas.height!==q.height&&(this._canvas.height=q.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(U){this._canvas.width=U.width,this._canvas.height=U.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(U.width,U.height,this._generateMipMaps,this.samplingMode)}scale(U){const W=this.getSize();W.width*=U,W.height*=U,this._recreate(W)}scaleTo(U,W){const l=this.getSize();l.width=U,l.height=W,this._recreate(l)}getContext(){return this._context}clear(U){const W=this.getSize();U&&(this._context.fillStyle=U),this._context.clearRect(0,0,W.width,W.height)}update(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===U||U,W,this._format||void 0,void 0,l)}drawText(U,W,l,M,t,L,p){let B=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const k=this.getSize();if(L&&(this._context.fillStyle=L,this._context.fillRect(0,0,k.width,k.height)),this._context.font=M,null===W||void 0===W){const l=this._context.measureText(U);W=(k.width-l.width)/2}if(null===l||void 0===l){const U=parseInt(M.replace(/\D/g,""));l=k.height/2+U/3.65}this._context.fillStyle=t||"",this._context.fillText(U,W,l),B&&this.update(p)}dispose(){var U,W;(super.dispose(),this._ownCanvas)&&(null===(U=this._canvas)||void 0===U||null===(W=U.remove)||void 0===W||W.call(U));this._canvas=null,this._context=null}clone(){const U=this.va();if(!U)return this;const W=this.getSize(),l=new k(this.name,W,U,this._generateMipMaps);return l.yi=this.yi,l.level=this.level,l.wrapU=this.wrapU,l.wrapV=this.wrapV,l}serialize(){const U=this.va();U&&!U.isReady()&&M.b.Warn("The scene must be ready before serializing the dynamic texture");const W=super.serialize();return k._IsCanvasElement(this._canvas)&&(W.base64String=this._canvas.toDataURL()),W.invertY=this._invertY,W.samplingMode=this.samplingMode,W}static _IsCanvasElement(U){return void 0!==U.toDataURL}_rebuild(){this.update()}}},12574:(U,W,l)=>{"use strict";l.d(W,{d:()=>t});var M=l(2048);class t extends M.d{get depth(){return this._depth}constructor(U,W,l,t,L,p){let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:M.d.TRILINEAR_SAMPLINGMODE,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10?arguments[10]:void 0;super(null,p,!B,k),this.format=L,this._texture=p.getEngine().createRawTexture2DArray(U,W,l,t,L,B,k,A,null,q,y),this._depth=t,this.is2DArray=!0}update(U){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,U,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(U,W,l,M,L){return new t(U,W,l,M,5,L,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12394:(U,W,l)=>{"use strict";l.d(W,{c:()=>B,f:()=>k,i:()=>L,m:()=>p});var M=l(722),t=l(706);function L(U,W){return`{X: ${U.x.toFixed(W)} Y: ${U.y.toFixed(W)}}`}function p(U,W){return`{X: ${U._x.toFixed(W)} Y: ${U._y.toFixed(W)} Z: ${U._z.toFixed(W)}}`}function B(U,W){return 2*Math.acos((0,M.Clamp)(t.e.Dot(U,W)))}function k(U,W){const l=new t.e;return function(U,W,l){const L=t.l.Cross(U,W),p=Math.acos((0,M.Clamp)(t.l.Dot(U,W),-1,1));t.e.RotationAxisToRef(L,p,l)}(U,W,l),l}},12217:(U,W,l)=>{"use strict";l.d(W,{c:()=>A});var M=l(706),t=l(742),L=l(487),p=l(774),B=l(818);l(12223);function k(U){let W=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],L=[];let k=[];const A=U.width||U.size||1,q=U.height||U.size||1,y=U.depth||U.size||1,j=U.wrap||!1;let s=void 0===U.topBaseAt?1:U.topBaseAt,w=void 0===U.bottomBaseAt?0:U.bottomBaseAt;s=(s+4)%4,w=(w+4)%4;let K=[2,0,3,1][s],r=[2,0,1,3][w],m=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(j){W=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],m=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let U=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],l=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const M=[17,18,19,16],t=[22,23,20,21];for(;K>0;)U.unshift(U.pop()),M.unshift(M.pop()),K--;for(;r>0;)l.unshift(l.pop()),t.unshift(t.pop()),r--;U=U.flat(),l=l.flat(),m=m.concat(U).concat(l),W.push(M[0],M[2],M[3],M[0],M[1],M[2]),W.push(t[0],t[2],t[3],t[0],t[1],t[2])}const f=[A/2,q/2,y/2];k=m.reduce(((U,W,l)=>U.concat(W*f[l%3])),[]);const g=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE,E=U.faceUV||new Array(6),Z=U.faceColors,N=[];for(let p=0;p<6;p++)void 0===E[p]&&(E[p]=new M.p(0,0,1,1)),Z&&void 0===Z[p]&&(Z[p]=new t.f(1,1,1,1));for(let M=0;M<6;M++)if(L.push(E[M].z,B.c?1-E[M].w:E[M].w),L.push(E[M].x,B.c?1-E[M].w:E[M].w),L.push(E[M].x,B.c?1-E[M].y:E[M].y),L.push(E[M].z,B.c?1-E[M].y:E[M].y),Z)for(let U=0;U<4;U++)N.push(Z[M].r,Z[M].g,Z[M].b,Z[M].a);p.b._ComputeSides(g,k,W,l,L,U.frontUVs,U.backUVs);const D=new p.b;if(D.indices=W,D.xa=k,D.ya=l,D.Aa=L,Z){const U=g===p.b.DOUBLESIDE?N.concat(N):N;D.za=U}return D}function A(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new L.e(U,l);W.sideOrientation=L.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return k(W).Ca(M,W.updatable),M}p.b.CreateBox=k,L.e.CreateBox=function(U,W){return A(U,{size:W,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12223:(U,W,l)=>{"use strict";l.d(W,{e:()=>r,c:()=>f,i:()=>m});var M=l(706),t=l(742),L=l(487),p=l(774),B=l(763);L.e._GroundMeshParser=(U,W)=>k.Parse(U,W);class k extends L.e{constructor(U,W){super(U,W),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=U,this._subdivisionsY=U,this.subdivide(U);const l=this;l.createOrUpdateSubmeshesOctree&&l.createOrUpdateSubmeshesOctree(W)}getHeightAtCoordinates(U,W){const l=this.getWorldMatrix(),t=M.f.Matrix[5];l.invertToRef(t);const L=M.f.ik[8];if(M.l.TransformCoordinatesFromFloatsToRef(U,0,W,t,L),U=L.x,W=L.z,U<this._minX||U>=this._maxX||W<=this._minZ||W>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const p=this._getFacetAt(U,W),B=-(p.x*U+p.z*W+p.w)/p.y;return M.l.TransformCoordinatesFromFloatsToRef(0,B,0,l,L),L.y}getNormalAtCoordinates(U,W){const l=new M.l(0,1,0);return this.getNormalAtCoordinatesToRef(U,W,l),l}getNormalAtCoordinatesToRef(U,W,l){const t=this.getWorldMatrix(),L=M.f.Matrix[5];t.invertToRef(L);const p=M.f.ik[8];if(M.l.TransformCoordinatesFromFloatsToRef(U,0,W,L,p),U=p.x,W=p.z,U<this._minX||U>this._maxX||W<this._minZ||W>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(U,W);return M.l.TransformNormalFromFloatsToRef(B.x,B.y,B.z,t,l),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(U,W){const l=Math.floor((U+this._maxX)*this._subdivisionsX/this._width),M=Math.floor(-(W+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),t=this._heightQuads[M*this._subdivisionsX+l];let L;return L=W<t.slope.x*U+t.slope.y?t.facet1:t.facet2,L}_initHeightQuads(){const U=this._subdivisionsX,W=this._subdivisionsY;this._heightQuads=[];for(let l=0;l<W;l++)for(let W=0;W<U;W++){const t={slope:M.h.Zero(),facet1:new M.p(0,0,0,0),facet2:new M.p(0,0,0,0)};this._heightQuads[l*U+W]=t}return this}_computeHeightQuads(){const U=this.getVerticesData(B.e.PositionKind);if(!U)return this;const W=M.f.ik[3],l=M.f.ik[2],t=M.f.ik[1],L=M.f.ik[0],p=M.f.ik[4],k=M.f.ik[5],A=M.f.ik[6],q=M.f.ik[7],y=M.f.ik[8];let j=0,s=0,w=0,K=0,r=0,m=0,f=0;const g=this._subdivisionsX,E=this._subdivisionsY;for(let B=0;B<E;B++)for(let E=0;E<g;E++){j=3*E,s=B*(g+1)*3,w=(B+1)*(g+1)*3,W.x=U[s+j],W.y=U[s+j+1],W.z=U[s+j+2],l.x=U[s+j+3],l.y=U[s+j+4],l.z=U[s+j+5],t.x=U[w+j],t.y=U[w+j+1],t.z=U[w+j+2],L.x=U[w+j+3],L.y=U[w+j+4],L.z=U[w+j+5],K=(L.z-W.z)/(L.x-W.x),r=W.z-K*W.x,l.subtractToRef(W,p),t.subtractToRef(W,k),L.subtractToRef(W,A),M.l.CrossToRef(A,k,q),M.l.CrossToRef(p,A,y),q.normalize(),y.normalize(),m=-(q.x*W.x+q.y*W.y+q.z*W.z),f=-(y.x*l.x+y.y*l.y+y.z*l.z);const Z=this._heightQuads[B*g+E];Z.slope.wd(K,r),Z.facet1.wd(q.x,q.y,q.z,m),Z.facet2.wd(y.x,y.y,y.z,f)}return this}serialize(U){super.serialize(U),U.subdivisionsX=this._subdivisionsX,U.subdivisionsY=this._subdivisionsY,U.minX=this._minX,U.maxX=this._maxX,U.bk=this._minZ,U.maxZ=this._maxZ,U.width=this._width,U.height=this._height}static Parse(U,W){const l=new k(U.name,W);return l._subdivisionsX=U.subdivisionsX||1,l._subdivisionsY=U.subdivisionsY||1,l._minX=U.minX,l._maxX=U.maxX,l._minZ=U.bk,l._maxZ=U.maxZ,l._width=U.width,l._height=U.height,l}}var A=l(503),q=l(543),y=l(711),j=l(818);function s(U){const W=[],l=[],t=[],L=[];let B,k;const A=U.width||U.size||1,q=U.height||U.size||1,y=0|(U.subdivisionsX||U.subdivisions||1),s=0|(U.subdivisionsY||U.subdivisions||1);for(B=0;B<=s;B++)for(k=0;k<=y;k++){const U=new M.l(k*A/y-A/2,0,(s-B)*q/s-q/2),W=new M.l(0,1,0);l.push(U.x,U.y,U.z),t.push(W.x,W.y,W.z),L.push(k/y,j.c?B/s:1-B/s)}for(B=0;B<s;B++)for(k=0;k<y;k++)W.push(k+1+(B+1)*(y+1)),W.push(k+1+B*(y+1)),W.push(k+B*(y+1)),W.push(k+(B+1)*(y+1)),W.push(k+1+(B+1)*(y+1)),W.push(k+B*(y+1));const w=new p.b;return w.indices=W,w.xa=l,w.ya=t,w.Aa=L,w}function w(U){const W=void 0!==U.xmin&&null!==U.xmin?U.xmin:-1,l=void 0!==U.zmin&&null!==U.zmin?U.zmin:-1,t=void 0!==U.xmax&&null!==U.xmax?U.xmax:1,L=void 0!==U.zmax&&null!==U.zmax?U.zmax:1,B=U.subdivisions||{w:1,h:1},k=U.precision||{w:1,h:1},A=[],q=[],y=[],j=[];let s,w,K,r;B.h=B.h<1?1:B.h,B.w=B.w<1?1:B.w,k.w=k.w<1?1:k.w,k.h=k.h<1?1:k.h;const m=(t-W)/B.w,f=(L-l)/B.h;function g(U,W,l,t){const L=q.length/3,p=k.w+1;for(s=0;s<k.h;s++)for(w=0;w<k.w;w++){const U=[L+w+s*p,L+(w+1)+s*p,L+(w+1)+(s+1)*p,L+w+(s+1)*p];A.push(U[1]),A.push(U[2]),A.push(U[3]),A.push(U[0]),A.push(U[1]),A.push(U[3])}const B=M.l.Zero(),K=new M.l(0,1,0);for(s=0;s<=k.h;s++)for(B.z=s*(t-W)/k.h+W,w=0;w<=k.w;w++)B.x=w*(l-U)/k.w+U,B.y=0,q.push(B.x,B.y,B.z),y.push(K.x,K.y,K.z),j.push(w/k.w,s/k.h)}for(K=0;K<B.h;K++)for(r=0;r<B.w;r++)g(W+r*m,l+K*f,W+(r+1)*m,l+(K+1)*f);const E=new p.b;return E.indices=A,E.xa=q,E.ya=y,E.Aa=j,E}function K(U){const W=[],l=[],L=[],B=[];let k,A;const q=U.colorFilter||new t.e(.3,.59,.11),j=U.alphaFilter||0;let s=!1;if(U.minHeight>U.maxHeight){s=!0;const W=U.maxHeight;U.maxHeight=U.minHeight,U.minHeight=W}for(k=0;k<=U.subdivisions;k++)for(A=0;A<=U.subdivisions;A++){const W=new M.l(A*U.width/U.subdivisions-U.width/2,0,(U.subdivisions-k)*U.height/U.subdivisions-U.height/2),t=4*(((W.x+U.width/2)/U.width*(U.bufferWidth-1)|0)+((1-(W.z+U.height/2)/U.height)*(U.bufferHeight-1)|0)*U.bufferWidth);let p=U.buffer[t]/255,w=U.buffer[t+1]/255,K=U.buffer[t+2]/255;const r=U.buffer[t+3]/255;s&&(p=1-p,w=1-w,K=1-K);const m=p*q.r+w*q.g+K*q.b;W.y=r>=j?U.minHeight+(U.maxHeight-U.minHeight)*m:U.minHeight-y.d,U.heightBuffer&&(U.heightBuffer[k*(U.subdivisions+1)+A]=W.y),l.push(W.x,W.y,W.z),L.push(0,0,0),B.push(A/U.subdivisions,1-k/U.subdivisions)}for(k=0;k<U.subdivisions;k++)for(A=0;A<U.subdivisions;A++){const M=A+1+(k+1)*(U.subdivisions+1),t=A+1+k*(U.subdivisions+1),L=A+k*(U.subdivisions+1),p=A+(k+1)*(U.subdivisions+1),B=l[3*M+1]>=U.minHeight,q=l[3*t+1]>=U.minHeight,y=l[3*L+1]>=U.minHeight;B&&q&&y&&(W.push(M),W.push(t),W.push(L));l[3*p+1]>=U.minHeight&&B&&y&&(W.push(p),W.push(M),W.push(L))}p.b.ComputeNormals(l,W,L);const w=new p.b;return w.indices=W,w.xa=l,w.ya=L,w.Aa=B,w}function r(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=new k(U,arguments.length>2?arguments[2]:void 0);l._setReady(!1),l._subdivisionsX=W.subdivisionsX||W.subdivisions||1,l._subdivisionsY=W.subdivisionsY||W.subdivisions||1,l._width=W.width||1,l._height=W.height||1,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ;return s(W).Ca(l,W.updatable),l._setReady(!0),l}function m(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new L.e(U,l);return w(W).Ca(M,W.updatable),M}function f(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=l.width||10,p=l.height||10,B=l.subdivisions||1,y=l.minHeight||0,j=l.maxHeight||1,s=l.colorFilter||new t.e(.3,.59,.11),w=l.alphaFilter||0,r=l.updatable,m=l.onReady;M=M||q.d.LastCreatedScene;const f=new k(U,M);let g;f._subdivisionsX=B,f._subdivisionsY=B,f._width=L,f._height=p,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),l.passHeightBufferInCallback&&(g=new Float32Array((B+1)*(B+1)));const E=(U,W,l)=>{K({width:L,height:p,subdivisions:B,minHeight:y,maxHeight:j,colorFilter:s,buffer:U,bufferWidth:W,bufferHeight:l,alphaFilter:w,heightBuffer:g}).Ca(f,r),m&&m(f,g),f._setReady(!0)};if("string"===typeof W){const U=U=>{var W;const l=U.width,t=U.height;if(M.u)return;const L=null===(W=M)||void 0===W?void 0:W.getEngine().resizeImageBitmap(U,l,t);E(L,l,t)};A.h.LoadImage(W,U,l.onError?l.onError:()=>{},M.offlineProvider)}else E(W.data,W.width,W.height);return f}p.b.CreateGround=s,p.b.CreateTiledGround=w,p.b.CreateGroundFromHeightMap=K,L.e.CreateGround=(U,W,l,M,t,L)=>r(U,{width:W,height:l,subdivisions:M,updatable:L},t),L.e.CreateTiledGround=(U,W,l,M,t,L,p,B,k)=>m(U,{xmin:W,zmin:l,xmax:M,zmax:t,subdivisions:L,precision:p,updatable:k},B),L.e.CreateGroundFromHeightMap=(U,W,l,M,t,L,p,B,k,A,q)=>f(U,W,{width:l,height:M,subdivisions:t,minHeight:L,maxHeight:p,updatable:k,onReady:A,alphaFilter:q},B)},12888:(U,W,l)=>{"use strict";l.d(W,{e:()=>s,h:()=>y,i:()=>j});var M=l(706),t=l(487),L=l(774),p=l(11873),B=l(763),k=l(512);function A(U){const W=[],l=[],M=U.lines,t=U.za,p=[];let B=0;for(let L=0;L<M.length;L++){const U=M[L];for(let M=0;M<U.length;M++){const{x:k,y:A,z:q}=U[M];if(l.push(k,A,q),t){const U=t[L],{r:W,g:l,b:B,a:k}=U[M];p.push(W,l,B,k)}M>0&&(W.push(B-1),W.push(B)),B++}}const k=new L.b;return k.indices=W,k.xa=l,t&&(k.za=p),k}function q(U){const W=U.dashSize||3,l=U.gapSize||1,t=U.dashNb||200,p=U.points,B=[],k=[],A=M.l.Zero();let q=0,y=0,j=0,s=0,w=0,K=0,r=0;for(r=0;r<p.length-1;r++)p[r+1].subtractToRef(p[r],A),q+=A.length();for(j=q/t,s=W*j/(W+l),r=0;r<p.length-1;r++){p[r+1].subtractToRef(p[r],A),y=Math.floor(A.length()/j),A.normalize();for(let U=0;U<y;U++)w=j*U,B.push(p[r].x+w*A.x,p[r].y+w*A.y,p[r].z+w*A.z),B.push(p[r].x+(w+s)*A.x,p[r].y+(w+s)*A.y,p[r].z+(w+s)*A.z),k.push(K,K+1),K+=2}const m=new L.b;return m.xa=B,m.indices=k,m}function y(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=W.instance,t=W.lines,L=W.za;if(M){const U=M.getVerticesData(B.e.PositionKind);let W,l;L&&(W=M.getVerticesData(B.e.ColorKind));let p=0,k=0;for(let M=0;M<t.length;M++){const B=t[M];for(let t=0;t<B.length;t++)U[p]=B[t].x,U[p+1]=B[t].y,U[p+2]=B[t].z,L&&W&&(l=L[M],W[k]=l[t].r,W[k+1]=l[t].g,W[k+2]=l[t].b,W[k+3]=l[t].a,k+=4),p+=3}return M.updateVerticesData(B.e.PositionKind,U,!1,!1),L&&W&&M.updateVerticesData(B.e.ColorKind,W,!1,!1),M.refreshBoundingInfo(),M}const k=!!L,q=new p.e(U,l,null,void 0,void 0,k,W.useVertexAlpha,W.material);return A(W).Ca(q,W.updatable),q}function j(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=W.za?[W.za]:null;return y(U,{lines:[W.points],updatable:W.updatable,instance:W.instance,za:M,useVertexAlpha:W.useVertexAlpha,material:W.material},l)}function s(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=W.points,B=W.instance,A=W.gapSize||1,y=W.dashSize||3;if(B){const U=U=>{const W=M.l.Zero(),l=U.length/6;let t=0,p=0,k=0,A=0,q=0,y=0,j=0,s=0;for(j=0;j<L.length-1;j++)L[j+1].subtractToRef(L[j],W),t+=W.length();k=t/l;const w=B._creationDataStorage.dashSize;for(A=w*k/(w+B._creationDataStorage.gapSize),j=0;j<L.length-1;j++)for(L[j+1].subtractToRef(L[j],W),p=Math.floor(W.length()/k),W.normalize(),s=0;s<p&&y<U.length;)q=k*s,U[y]=L[j].x+q*W.x,U[y+1]=L[j].y+q*W.y,U[y+2]=L[j].z+q*W.z,U[y+3]=L[j].x+(q+A)*W.x,U[y+4]=L[j].y+(q+A)*W.y,U[y+5]=L[j].z+(q+A)*W.z,y+=6,s++;for(;y<U.length;)U[y]=L[j].x,U[y+1]=L[j].y,U[y+2]=L[j].z,y+=3};return(W.dashNb||W.dashSize||W.gapSize||W.useVertexAlpha||W.material)&&k.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),B.updateMeshPositions(U,!1),B}const j=new p.e(U,l,null,void 0,void 0,void 0,W.useVertexAlpha,W.material);return q(W).Ca(j,W.updatable),j._creationDataStorage=new t.h,j._creationDataStorage.dashSize=y,j._creationDataStorage.gapSize=A,j}L.b.CreateLineSystem=A,L.b.CreateDashedLines=q,t.e.Mk=function(U,W){return j(U,{points:W,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},t.e.CreateDashedLines=function(U,W,l,M,t){return s(U,{points:W,dashSize:l,gapSize:M,dashNb:t,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12274:(U,W,l)=>{"use strict";l.d(W,{d:()=>B,f:()=>k});var M=l(487),t=l(774),L=l(818);function p(U){const W=[],l=[],M=[],p=[],B=void 0!==U.width?U.width:void 0!==U.size?U.size:1,k=void 0!==U.height?U.height:void 0!==U.size?U.size:1,A=0===U.sideOrientation?0:U.sideOrientation||t.b.DEFAULTSIDE,q=B/2,y=k/2;l.push(-q,-y,0),M.push(0,0,-1),p.push(0,L.c?1:0),l.push(q,-y,0),M.push(0,0,-1),p.push(1,L.c?1:0),l.push(q,y,0),M.push(0,0,-1),p.push(1,L.c?0:1),l.push(-q,y,0),M.push(0,0,-1),p.push(0,L.c?0:1),W.push(0),W.push(1),W.push(2),W.push(0),W.push(2),W.push(3),t.b._ComputeSides(A,l,W,M,p,U.frontUVs,U.backUVs);const j=new t.b;return j.indices=W,j.xa=l,j.ya=M,j.Aa=p,j}function B(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new M.e(U,l);W.sideOrientation=M.e._GetDefaultSideOrientation(W.sideOrientation),t._originalBuilderSideOrientation=W.sideOrientation;return p(W).Ca(t,W.updatable),W.sourcePlane&&(t.translate(W.sourcePlane.rk,-W.sourcePlane.d),t.setDirection(W.sourcePlane.rk.scale(-1))),t}const k={Nk:B};t.b.Nk=p,M.e.Nk=(U,W,l,M,t)=>B(U,{size:W,width:W,height:W,sideOrientation:t,updatable:M},l)},12376:(U,W,l)=>{"use strict";l.d(W,{b:()=>k});var M=l(706),t=l(487),L=l(774),p=l(818);function B(U){const W=0|(U.segments||32),l=U.diameterX||U.diameter||1,t=U.diameterY||U.diameter||1,B=U.diameterZ||U.diameter||1,k=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,A=U.slice&&U.slice<=0?1:U.slice||1,q=0===U.sideOrientation?0:U.sideOrientation||L.b.DEFAULTSIDE,y=!!U.dedupTopBottomIndices,j=new M.l(l/2,t/2,B/2),s=2+W,w=2*s,K=[],r=[],m=[],f=[];for(let L=0;L<=s;L++){const U=L/s,W=U*Math.PI*A;for(let l=0;l<=w;l++){const t=l/w,L=t*Math.PI*2*k,B=M.c.RotationZ(-W),A=M.c.RotationY(L),q=M.l.TransformCoordinates(M.l.Up(),B),y=M.l.TransformCoordinates(q,A),s=y.multiply(j),K=y.divide(j).normalize();r.push(s.x,s.y,s.z),m.push(K.x,K.y,K.z),f.push(t,p.c?1-U:U)}if(L>0){const U=r.length/3;for(let W=U-2*(w+1);W+w+2<U;W++)y?(L>1&&(K.push(W),K.push(W+1),K.push(W+w+1)),(L<s||A<1)&&(K.push(W+w+1),K.push(W+1),K.push(W+w+2))):(K.push(W),K.push(W+1),K.push(W+w+1),K.push(W+w+1),K.push(W+1),K.push(W+w+2))}}L.b._ComputeSides(q,r,K,m,f,U.frontUVs,U.backUVs);const g=new L.b;return g.indices=K,g.xa=r,g.ya=m,g.Aa=f,g}function k(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return B(W).Ca(M,W.updatable),M}L.b.CreateSphere=B,t.e.CreateSphere=(U,W,l,M,t,L)=>k(U,{segments:W,diameterX:l,diameterY:l,diameterZ:l,sideOrientation:L,updatable:t},M)},13020:(U,W,l)=>{"use strict";l.d(W,{d:()=>B});var M=l(11889),t=l(12670),L=l(11898),p=l(774);class B{static get Configuration(){return{get decoder(){return t.b.DefaultConfiguration},set decoder(U){t.b.DefaultConfiguration=U}}}static set Configuration(U){t.b.DefaultConfiguration=U.decoder}static get DecoderAvailable(){return(0,M.j)(t.b.DefaultConfiguration)}static get Default(){return B._Default??(B._Default=new B),B._Default}static ResetDefault(U){B._Default&&(U||B._Default.dispose(),B._Default=null)}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.DefaultNumWorkers;const W="number"===typeof U?{...t.b.DefaultConfiguration,numWorkers:U}:{...t.b.DefaultConfiguration,...U};this._decoder=new t.b(W)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(U,W,l){return this._decoder.decodeMeshToMeshDataAsync(U,W,l)}async decodeMeshToGeometryAsync(U,W,l,M){return await this._decoder.decodeMeshToGeometryAsync(U,W,l,M)}async _decodeMeshToGeometryForGltfAsync(U,W,l,M,t,L){return await this._decoder._decodeMeshToGeometryForGltfAsync(U,W,l,M,t,L)}async decodeMeshAsync(U,W){const l=await this._decoder.decodeMeshToMeshDataAsync(U,W),M=new p.b;l.indices&&(M.indices=l.indices);for(const t of l.attributes){const U=L.c.GetFloatData(t.data,t.size,L.c.GetDataType(t.data),t.byteOffset,t.byteStride,t.normalized,l.totalVertices);M.set(U,t.kind)}return M}}B.DefaultNumWorkers=(0,M.g)(),B._Default=null},12670:(U,W,l)=>{"use strict";l.d(W,{b:()=>A});var M=l(11889),t=l(503),L=l(812),p=l(11898),B=l(512),k=l(11896);class A extends M.c{static get DefaultAvailable(){return(0,M.j)(A.DefaultConfiguration)}static get Default(){return A._Default??(A._Default=new A),A._Default}static ResetDefault(U){A._Default&&(U||A._Default.dispose(),A._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(U,W){return{module:await(W||DracoDecoderModule)({wasmBinary:U})}}_getWorkerContent(){return`${k.e}(${k.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.DefaultConfiguration)}decodeMeshToMeshDataAsync(U,W,l){const M=U instanceof ArrayBuffer?new Int8Array(U):new Int8Array(U.buffer,U.byteOffset,U.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async U=>await new Promise(((t,L)=>{U.push(((U,p)=>{let k=null;const A=[],q=W=>{U.removeEventListener("error",q),U.removeEventListener("message",y),L(W),p()},y=W=>{const M=W.data;switch(M.id){case"indices":k=M.data;break;case"attribute":A.push({kind:M.kind,data:M.data,size:M.size,byteOffset:M.byteOffset,byteStride:M.byteStride,normalized:(L=M.kind,j=M.normalized,l&&void 0!==l[L]?(j!==l[L]&&B.b.Warn(`Normalized flag from Draco data (${j}) does not match normalized flag from glTF accessor (${l[L]}). Using flag from glTF accessor.`),l[L]):j)});break;case"decodeMeshDone":U.removeEventListener("error",q),U.removeEventListener("message",y),t({indices:k,attributes:A,totalVertices:M.totalVertices}),p()}var L,j};U.addEventListener("error",q),U.addEventListener("message",y);const j=M.slice();U.postMessage({id:"decodeMesh",dataView:j,attributes:W},[j.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((U=>{let l=null;const t=[],L=(0,k.e)(U.module,M,W,(U=>{l=U}),((U,W,l,M,L,p)=>{t.push({kind:U,data:W,size:l,byteOffset:M,byteStride:L,normalized:p})}));return{indices:l,attributes:t,totalVertices:L}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(U,W,l,M){const t=await this.decodeMeshToMeshDataAsync(l,M),B=new L.e(U,W);t.indices&&B.setIndices(t.indices);for(const L of t.attributes)B.setVerticesBuffer(new p.c(W.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),t.totalVertices);return B}async _decodeMeshToGeometryForGltfAsync(U,W,l,M,t,B){const k=await this.decodeMeshToMeshDataAsync(l,M,t),A=new L.e(U,W);B&&(A._boundingInfo=B,A.useBoundingInfoFromGeometry=!0),k.indices&&A.setIndices(k.indices);for(const L of k.attributes)A.setVerticesBuffer(new p.c(W.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),k.totalVertices);return A}}A.DefaultConfiguration={wasmUrl:`${t.h._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${t.h._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${t.h._DefaultCdnUrl}/draco_decoder_gltf.js`},A._Default=null},12885:(U,W,l)=>{"use strict";l.d(W,{b:()=>BU});var M=l(706),t=l(487),L=l(763),p=l(774),B=l(818);function k(U){let W=U.pathArray;const l=U.closeArray||!1,M=U.closePath||!1,t=U.invertUV||!1,k=Math.floor(W[0].length/2);let A=U.offset||k;A=A>k?k:Math.floor(A);const q=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE,y=U.Aa,j=U.za,s=[],w=[],K=[],r=[],m=[],f=[],g=[],E=[];let Z;const N=[],D=[];let o,i,O;if(W.length<2){const U=[],l=[];for(i=0;i<W[0].length-A;i++)U.push(W[0][i]),l.push(W[0][i+A]);W=[U,l]}let e=0;const d=M?1:0,H=l?1:0;let V,n,x,I,R,F;for(Z=W[0].length,o=0;o<W.length+H;o++){for(g[o]=0,m[o]=[0],V=o===W.length?W[0]:W[o],n=V.length,Z=Z<n?Z:n,O=0;O<n;)s.push(V[O].x,V[O].y,V[O].z),O>0&&(x=V[O].de(V[O-1]).length(),I=x+g[o],m[o].push(I),g[o]=I),O++;M&&(O--,s.push(V[0].x,V[0].y,V[0].z),x=V[O].de(V[0]).length(),I=x+g[o],m[o].push(I),g[o]=I),N[o]=n+d,D[o]=e,e+=n+d}let v,J,Q=null,G=null;for(i=0;i<Z+d;i++)for(E[i]=0,f[i]=[0],o=0;o<W.length-1+H;o++)R=W[o],F=o===W.length-1?W[0]:W[o+1],i===Z?(Q=R[0],G=F[0]):(Q=R[i],G=F[i]),x=G.de(Q).length(),I=x+E[i],f[i].push(I),E[i]=I;if(y)for(o=0;o<y.length;o++)r.push(y[o].x,B.c?1-y[o].y:y[o].y);else for(o=0;o<W.length+H;o++)for(i=0;i<Z+d;i++)v=0!=g[o]?m[o][i]/g[o]:0,J=0!=E[i]?f[i][o]/E[i]:0,t?r.push(J,v):r.push(v,B.c?1-J:J);o=0;let u=0,b=N[o]-1,C=N[o+1]-1,P=b<C?b:C,S=D[1]-D[0];const c=N.length-1;for(;u<=P&&o<c;)w.push(u,u+S,u+1),w.push(u+S+1,u+1,u+S),u+=1,u===P&&(o++,S=D[o+1]-D[o],b=N[o]-1,C=N[o+1]-1,u=D[o],P=b<C?b+u:C+u);if(p.b.ComputeNormals(s,w,K),M){let U=0,l=0;for(o=0;o<W.length;o++){U=3*D[o],l=o+1<W.length?3*(D[o+1]-1):K.length-3,K[U]=.5*(K[U]+K[l]),K[U+1]=.5*(K[U+1]+K[l+1]),K[U+2]=.5*(K[U+2]+K[l+2]);const M=Math.sqrt(K[U]*K[U]+K[U+1]*K[U+1]+K[U+2]*K[U+2]);K[U]/=M,K[U+1]/=M,K[U+2]/=M,K[l]=K[U],K[l+1]=K[U+1],K[l+2]=K[U+2]}}if(l){let U=3*D[0],l=3*D[W.length];for(i=0;i<Z+d;i++){K[U]=.5*(K[U]+K[l]),K[U+1]=.5*(K[U+1]+K[l+1]),K[U+2]=.5*(K[U+2]+K[l+2]);const W=Math.sqrt(K[U]*K[U]+K[U+1]*K[U+1]+K[U+2]*K[U+2]);K[U]/=W,K[U+1]/=W,K[U+2]/=W,K[l]=K[U],K[l+1]=K[U+1],K[l+2]=K[U+2],U+=3,l+=3}}p.b._ComputeSides(q,s,w,K,r,U.frontUVs,U.backUVs);let h=null;if(j){h=new Float32Array(4*j.length);for(let U=0;U<j.length;U++)h[4*U]=j[U].r,h[4*U+1]=j[U].g,h[4*U+2]=j[U].b,h[4*U+3]=j[U].a}const z=new p.b,a=new Float32Array(s),Y=new Float32Array(K),X=new Float32Array(r);return z.indices=w,z.xa=a,z.ya=Y,z.Aa=X,h&&z.set(h,L.e.ColorKind),M&&(z._idx=D),z}function A(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=W.pathArray,q=W.closeArray,y=W.closePath,j=t.e._GetDefaultSideOrientation(W.sideOrientation),s=W.instance,w=W.updatable;if(s){const U=M.f.ik[0].jk(Number.MAX_VALUE),l=M.f.ik[1].jk(-Number.MAX_VALUE),k=W=>{let M=A[0].length;const L=s;let p=0;const B=L._originalBuilderSideOrientation===t.e.DOUBLESIDE?2:1;for(let t=1;t<=B;++t)for(let B=0;B<A.length;++B){const t=A[B],k=t.length;M=M<k?M:k;for(let L=0;L<M;++L){const M=t[L];W[p]=M.x,W[p+1]=M.y,W[p+2]=M.z,U.minimizeInPlaceFromFloats(M.x,M.y,M.z),l.maximizeInPlaceFromFloats(M.x,M.y,M.z),p+=3}if(L._creationDataStorage&&L._creationDataStorage.closePath){const U=t[0];W[p]=U.x,W[p+1]=U.y,W[p+2]=U.z,p+=3}}},q=s.getVerticesData(L.e.PositionKind);if(k(q),s.hasBoundingInfo?s.getBoundingInfo().reConstruct(U,l,s._worldMatrix):s.buildBoundingInfo(U,l,s._worldMatrix),s.updateVerticesData(L.e.PositionKind,q,!1,!1),W.za){const U=s.getVerticesData(L.e.ColorKind);for(let l=0,M=0;l<W.za.length;l++,M+=4){const t=W.za[l];U[M]=t.r,U[M+1]=t.g,U[M+2]=t.b,U[M+3]=t.a}s.updateVerticesData(L.e.ColorKind,U,!1,!1)}if(W.Aa){const U=s.getVerticesData(L.e.UVKind);for(let l=0;l<W.Aa.length;l++)U[2*l]=W.Aa[l].x,U[2*l+1]=B.c?1-W.Aa[l].y:W.Aa[l].y;s.updateVerticesData(L.e.UVKind,U,!1,!1)}if(!s.areNormalsFrozen||s.isFacetDataEnabled){const U=s.hk(),W=s.getVerticesData(L.e.NormalKind),l=s.isFacetDataEnabled?s.getFacetDataParameters():null;if(p.b.ComputeNormals(q,U,W,l),s._creationDataStorage&&s._creationDataStorage.closePath){let U=0,l=0;for(let M=0;M<A.length;M++)U=3*s._creationDataStorage.idx[M],l=M+1<A.length?3*(s._creationDataStorage.idx[M+1]-1):W.length-3,W[U]=.5*(W[U]+W[l]),W[U+1]=.5*(W[U+1]+W[l+1]),W[U+2]=.5*(W[U+2]+W[l+2]),W[l]=W[U],W[l+1]=W[U+1],W[l+2]=W[U+2]}s.areNormalsFrozen||s.updateVerticesData(L.e.NormalKind,W,!1,!1)}return s}{const M=new t.e(U,l);M._originalBuilderSideOrientation=j,M._creationDataStorage=new t.h;const L=k(W);return y&&(M._creationDataStorage.idx=L._idx),M._creationDataStorage.closePath=y,M._creationDataStorage.closeArray=q,L.Ca(M,w),M}}p.b.CreateRibbon=k,t.e.CreateRibbon=function(U,W){return A(U,{pathArray:W,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var q=l(886),y=l(12217),j=l(742);function s(U){const W=U.pattern||t.e.NO_FLIP,l=U.tileWidth||U.tileSize||1,M=U.tileHeight||U.tileSize||1,L=U.alignHorizontal||0,B=U.alignVertical||0,k=U.width||U.size||1,A=Math.floor(k/l);let q=k-A*l;const y=U.height||U.size||1,j=Math.floor(y/M);let s=y-j*M;const w=l*A/2,K=M*j/2;let r=0,m=0,f=0,g=0,E=0,Z=0;if(q>0||s>0){switch(f=-w,g=-K,E=w,Z=K,L){case t.e.CENTER:q/=2,f-=q,E+=q;break;case t.e.LEFT:E+=q,r=-q/2;break;case t.e.RIGHT:f-=q,r=q/2}switch(B){case t.e.CENTER:s/=2,g-=s,Z+=s;break;case t.e.BOTTOM:Z+=s,m=-s/2;break;case t.e.TOP:g-=s,m=s/2}}const N=[],D=[],o=[];o[0]=[0,0,1,0,1,1,0,1],o[1]=[0,0,1,0,1,1,0,1],W!==t.e.ROTATE_TILE&&W!==t.e.ROTATE_ROW||(o[1]=[1,1,0,1,0,0,1,0]),W!==t.e.FLIP_TILE&&W!==t.e.FLIP_ROW||(o[1]=[1,0,0,0,0,1,1,1]),W!==t.e.FLIP_N_ROTATE_TILE&&W!==t.e.FLIP_N_ROTATE_ROW||(o[1]=[0,1,1,1,1,0,0,0]);let i=[];const O=[],e=[];let d=0;for(let p=0;p<j;p++)for(let U=0;U<A;U++)N.push(U*l-w+r,p*M-K+m,0),N.push((U+1)*l-w+r,p*M-K+m,0),N.push((U+1)*l-w+r,(p+1)*M-K+m,0),N.push(U*l-w+r,(p+1)*M-K+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),i=W===t.e.FLIP_TILE||W===t.e.ROTATE_TILE||W===t.e.FLIP_N_ROTATE_TILE?i.concat(o[(U%2+p%2)%2]):W===t.e.FLIP_ROW||W===t.e.ROTATE_ROW||W===t.e.FLIP_N_ROTATE_ROW?i.concat(o[p%2]):i.concat(o[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),d+=4;if(q>0||s>0){const U=s>0&&(B===t.e.CENTER||B===t.e.TOP),p=s>0&&(B===t.e.CENTER||B===t.e.BOTTOM),k=q>0&&(L===t.e.CENTER||L===t.e.RIGHT),y=q>0&&(L===t.e.CENTER||L===t.e.LEFT);let o,H,V,n,x=[];if(U&&k&&(N.push(f+r,g+m,0),N.push(-w+r,g+m,0),N.push(-w+r,g+s+m,0),N.push(f+r,g+s+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,o=1-q/l,H=1-s/M,V=1,n=1,x=[o,H,V,H,V,n,o,n],W===t.e.ROTATE_ROW&&(x=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),W===t.e.FLIP_ROW&&(x=[1-o,H,1-V,H,1-V,n,1-o,n]),W===t.e.FLIP_N_ROTATE_ROW&&(x=[o,1-H,V,1-H,V,1-n,o,1-n]),i=i.concat(x),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&y&&(N.push(w+r,g+m,0),N.push(E+r,g+m,0),N.push(E+r,g+s+m,0),N.push(w+r,g+s+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,o=0,H=1-s/M,V=q/l,n=1,x=[o,H,V,H,V,n,o,n],(W===t.e.ROTATE_ROW||W===t.e.ROTATE_TILE&&A%2===0)&&(x=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),(W===t.e.FLIP_ROW||W===t.e.FLIP_TILE&&A%2===0)&&(x=[1-o,H,1-V,H,1-V,n,1-o,n]),(W===t.e.FLIP_N_ROTATE_ROW||W===t.e.FLIP_N_ROTATE_TILE&&A%2===0)&&(x=[o,1-H,V,1-H,V,1-n,o,1-n]),i=i.concat(x),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&k&&(N.push(f+r,K+m,0),N.push(-w+r,K+m,0),N.push(-w+r,Z+m,0),N.push(f+r,Z+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,o=1-q/l,H=0,V=1,n=s/M,x=[o,H,V,H,V,n,o,n],(W===t.e.ROTATE_ROW&&j%2===1||W===t.e.ROTATE_TILE&&j%1===0)&&(x=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),(W===t.e.FLIP_ROW&&j%2===1||W===t.e.FLIP_TILE&&j%2===0)&&(x=[1-o,H,1-V,H,1-V,n,1-o,n]),(W===t.e.FLIP_N_ROTATE_ROW&&j%2===1||W===t.e.FLIP_N_ROTATE_TILE&&j%2===0)&&(x=[o,1-H,V,1-H,V,1-n,o,1-n]),i=i.concat(x),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&y&&(N.push(w+r,K+m,0),N.push(E+r,K+m,0),N.push(E+r,Z+m,0),N.push(w+r,Z+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,o=0,H=0,V=q/l,n=s/M,x=[o,H,V,H,V,n,o,n],(W===t.e.ROTATE_ROW&&j%2===1||W===t.e.ROTATE_TILE&&(j+A)%2===1)&&(x=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),(W===t.e.FLIP_ROW&&j%2===1||W===t.e.FLIP_TILE&&(j+A)%2===1)&&(x=[1-o,H,1-V,H,1-V,n,1-o,n]),(W===t.e.FLIP_N_ROTATE_ROW&&j%2===1||W===t.e.FLIP_N_ROTATE_TILE&&(j+A)%2===1)&&(x=[o,1-H,V,1-H,V,1-n,o,1-n]),i=i.concat(x),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U){const U=[];o=0,H=1-s/M,V=1,n=1,U[0]=[o,H,V,H,V,n,o,n],U[1]=[o,H,V,H,V,n,o,n],W!==t.e.ROTATE_TILE&&W!==t.e.ROTATE_ROW||(U[1]=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),W!==t.e.FLIP_TILE&&W!==t.e.FLIP_ROW||(U[1]=[1-o,H,1-V,H,1-V,n,1-o,n]),W!==t.e.FLIP_N_ROTATE_TILE&&W!==t.e.FLIP_N_ROTATE_ROW||(U[1]=[o,1-H,V,1-H,V,1-n,o,1-n]);for(let M=0;M<A;M++)N.push(M*l-w+r,g+m,0),N.push((M+1)*l-w+r,g+m,0),N.push((M+1)*l-w+r,g+s+m,0),N.push(M*l-w+r,g+s+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,i=W===t.e.FLIP_TILE||W===t.e.ROTATE_TILE||W===t.e.FLIP_N_ROTATE_TILE?i.concat(U[(M+1)%2]):W===t.e.FLIP_ROW||W===t.e.ROTATE_ROW||W===t.e.FLIP_N_ROTATE_ROW?i.concat(U[1]):i.concat(U[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const U=[];o=0,H=0,V=1,n=s/M,U[0]=[o,H,V,H,V,n,o,n],U[1]=[o,H,V,H,V,n,o,n],W!==t.e.ROTATE_TILE&&W!==t.e.ROTATE_ROW||(U[1]=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),W!==t.e.FLIP_TILE&&W!==t.e.FLIP_ROW||(U[1]=[1-o,H,1-V,H,1-V,n,1-o,n]),W!==t.e.FLIP_N_ROTATE_TILE&&W!==t.e.FLIP_N_ROTATE_ROW||(U[1]=[o,1-H,V,1-H,V,1-n,o,1-n]);for(let M=0;M<A;M++)N.push(M*l-w+r,Z-s+m,0),N.push((M+1)*l-w+r,Z-s+m,0),N.push((M+1)*l-w+r,Z+m,0),N.push(M*l-w+r,Z+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,i=W===t.e.FLIP_TILE||W===t.e.ROTATE_TILE||W===t.e.FLIP_N_ROTATE_TILE?i.concat(U[(M+j)%2]):W===t.e.FLIP_ROW||W===t.e.ROTATE_ROW||W===t.e.FLIP_N_ROTATE_ROW?i.concat(U[j%2]):i.concat(U[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const U=[];o=1-q/l,H=0,V=1,n=1,U[0]=[o,H,V,H,V,n,o,n],U[1]=[o,H,V,H,V,n,o,n],W!==t.e.ROTATE_TILE&&W!==t.e.ROTATE_ROW||(U[1]=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),W!==t.e.FLIP_TILE&&W!==t.e.FLIP_ROW||(U[1]=[1-o,H,1-V,H,1-V,n,1-o,n]),W!==t.e.FLIP_N_ROTATE_TILE&&W!==t.e.FLIP_N_ROTATE_ROW||(U[1]=[o,1-H,V,1-H,V,1-n,o,1-n]);for(let l=0;l<j;l++)N.push(f+r,l*M-K+m,0),N.push(f+q+r,l*M-K+m,0),N.push(f+q+r,(l+1)*M-K+m,0),N.push(f+r,(l+1)*M-K+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,i=W===t.e.FLIP_TILE||W===t.e.ROTATE_TILE||W===t.e.FLIP_N_ROTATE_TILE?i.concat(U[(l+1)%2]):W===t.e.FLIP_ROW||W===t.e.ROTATE_ROW||W===t.e.FLIP_N_ROTATE_ROW?i.concat(U[l%2]):i.concat(U[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const U=[];o=0,H=0,V=q/M,n=1,U[0]=[o,H,V,H,V,n,o,n],U[1]=[o,H,V,H,V,n,o,n],W!==t.e.ROTATE_TILE&&W!==t.e.ROTATE_ROW||(U[1]=[1-o,1-H,1-V,1-H,1-V,1-n,1-o,1-n]),W!==t.e.FLIP_TILE&&W!==t.e.FLIP_ROW||(U[1]=[1-o,H,1-V,H,1-V,n,1-o,n]),W!==t.e.FLIP_N_ROTATE_TILE&&W!==t.e.FLIP_N_ROTATE_ROW||(U[1]=[o,1-H,V,1-H,V,1-n,o,1-n]);for(let l=0;l<j;l++)N.push(E-q+r,l*M-K+m,0),N.push(E+r,l*M-K+m,0),N.push(E+r,(l+1)*M-K+m,0),N.push(E-q+r,(l+1)*M-K+m,0),e.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,i=W===t.e.FLIP_TILE||W===t.e.ROTATE_TILE||W===t.e.FLIP_N_ROTATE_TILE?i.concat(U[(l+A)%2]):W===t.e.FLIP_ROW||W===t.e.ROTATE_ROW||W===t.e.FLIP_N_ROTATE_ROW?i.concat(U[l%2]):i.concat(U[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const H=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE;p.b._ComputeSides(H,N,e,D,i,U.frontUVs,U.backUVs);const V=new p.b;V.indices=e,V.xa=N,V.ya=D,V.Aa=i;const n=H===p.b.DOUBLESIDE?O.concat(O):O;return V.za=n,V}function w(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return s(W).Ca(M,W.updatable),M}function K(U){const W=U.faceUV||new Array(6),l=U.faceColors,L=U.pattern||t.e.NO_FLIP,k=U.width||U.size||1,A=U.height||U.size||1,q=U.depth||U.size||1,y=U.tileWidth||U.tileSize||1,w=U.tileHeight||U.tileSize||1,K=U.alignHorizontal||0,r=U.alignVertical||0,m=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE;for(let t=0;t<6;t++)void 0===W[t]&&(W[t]=new M.p(0,0,1,1)),l&&void 0===l[t]&&(l[t]=new j.f(1,1,1,1));const f=k/2,g=A/2,E=q/2,Z=[];for(let M=0;M<2;M++)Z[M]=s({pattern:L,tileWidth:y,tileHeight:w,width:k,height:A,alignVertical:r,alignHorizontal:K,sideOrientation:m});for(let M=2;M<4;M++)Z[M]=s({pattern:L,tileWidth:y,tileHeight:w,width:q,height:A,alignVertical:r,alignHorizontal:K,sideOrientation:m});let N=r;r===t.e.BOTTOM?N=t.e.TOP:r===t.e.TOP&&(N=t.e.BOTTOM);for(let M=4;M<6;M++)Z[M]=s({pattern:L,tileWidth:y,tileHeight:w,width:k,height:q,alignVertical:N,alignHorizontal:K,sideOrientation:m});let D=[],o=[],i=[],O=[];const e=[],d=[],H=[],V=[];let n=0,x=0;for(let t=0;t<6;t++){const U=Z[t].xa.length;d[t]=[],H[t]=[];for(let W=0;W<U/3;W++)d[t].push(new M.l(Z[t].xa[3*W],Z[t].xa[3*W+1],Z[t].xa[3*W+2])),H[t].push(new M.l(Z[t].ya[3*W],Z[t].ya[3*W+1],Z[t].ya[3*W+2]));n=Z[t].Aa.length,V[t]=[];for(let l=0;l<n;l+=2)V[t][l]=W[t].x+(W[t].z-W[t].x)*Z[t].Aa[l],V[t][l+1]=W[t].y+(W[t].w-W[t].y)*Z[t].Aa[l+1],B.c&&(V[t][l+1]=1-V[t][l+1]);if(i=i.concat(V[t]),O=O.concat(Z[t].indices.map((U=>U+x))),x+=d[t].length,l)for(let W=0;W<4;W++)e.push(l[t].r,l[t].g,l[t].b,l[t].a)}const I=new M.l(0,0,E),R=M.c.RotationY(Math.PI);D=d[0].map((U=>M.l.TransformNormal(U,R).add(I))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[]),o=H[0].map((U=>M.l.TransformNormal(U,R))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[]),D=D.concat(d[1].map((U=>U.de(I))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[])),o=o.concat(H[1].map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[]));const F=new M.l(f,0,0),v=M.c.RotationY(-Math.PI/2);D=D.concat(d[2].map((U=>M.l.TransformNormal(U,v).add(F))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[])),o=o.concat(H[2].map((U=>M.l.TransformNormal(U,v))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[]));const J=M.c.RotationY(Math.PI/2);D=D.concat(d[3].map((U=>M.l.TransformNormal(U,J).de(F))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[])),o=o.concat(H[3].map((U=>M.l.TransformNormal(U,J))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[]));const Q=new M.l(0,g,0),G=M.c.RotationX(Math.PI/2);D=D.concat(d[4].map((U=>M.l.TransformNormal(U,G).add(Q))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[])),o=o.concat(H[4].map((U=>M.l.TransformNormal(U,G))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[]));const u=M.c.RotationX(-Math.PI/2);D=D.concat(d[5].map((U=>M.l.TransformNormal(U,u).de(Q))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[])),o=o.concat(H[5].map((U=>M.l.TransformNormal(U,u))).map((U=>[U.x,U.y,U.z])).reduce(((U,W)=>U.concat(W)),[])),p.b._ComputeSides(m,D,O,o,i);const b=new p.b;if(b.indices=O,b.xa=D,b.ya=o,b.Aa=i,l){const U=m===p.b.DOUBLESIDE?e.concat(e):e;b.za=U}return b}function r(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return K(W).Ca(M,W.updatable),M}p.b.CreateTiledPlane=s;p.b.CreateTiledBox=K;var m=l(12376),f=l(2178),g=l(845);function E(U){const W=U.height||2;let l=0===U.diameterTop?0:U.diameterTop||U.diameter||1,L=0===U.diameterBottom?0:U.diameterBottom||U.diameter||1;l=l||1e-5,L=L||1e-5;const k=0|(U.tessellation||24),A=0|(U.subdivisions||1),q=!!U.hasRings,y=!!U.enclose,s=0===U.cap?0:U.cap||t.e.CAP_ALL,w=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,K=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE,r=U.faceUV||new Array(3),m=U.faceColors,f=2+(1+(1!==w&&y?2:0))*(q?A:1);let E;for(E=0;E<f;E++)m&&void 0===m[E]&&(m[E]=new j.f(1,1,1,1));for(E=0;E<f;E++)r&&void 0===r[E]&&(r[E]=new M.p(0,0,1,1));const Z=[],N=[],D=[],o=[],i=[],O=2*Math.PI*w/k;let e,d,H;const V=(L-l)/2/W,n=M.l.Zero(),x=M.l.Zero(),I=M.l.Zero(),R=M.l.Zero(),F=M.l.Zero(),v=g.c.Y;let J,Q,G,u=1,b=1,C=0,P=0;for(J=0;J<=A;J++)for(d=J/A,H=(d*(l-L)+L)/2,u=q&&0!==J&&J!==A?2:1,G=0;G<u;G++){for(q&&(b+=G),y&&(b+=2*G),Q=0;Q<=k;Q++)e=Q*O,n.x=Math.cos(-e)*H,n.y=-W/2+d*W,n.z=Math.sin(-e)*H,0===l&&J===A?(x.x=D[D.length-3*(k+1)],x.y=D[D.length-3*(k+1)+1],x.z=D[D.length-3*(k+1)+2]):(x.x=n.x,x.z=n.z,x.y=Math.sqrt(x.x*x.x+x.z*x.z)*V,x.normalize()),0===Q&&(I.p(n),R.p(x)),N.push(n.x,n.y,n.z),D.push(x.x,x.y,x.z),P=q?C!==b?r[b].y:r[b].w:r[b].y+(r[b].w-r[b].y)*d,o.push(r[b].x+(r[b].z-r[b].x)*Q/k,B.c?1-P:P),m&&i.push(m[b].r,m[b].g,m[b].b,m[b].a);1!==w&&y&&(N.push(n.x,n.y,n.z),N.push(0,n.y,0),N.push(0,n.y,0),N.push(I.x,I.y,I.z),M.l.CrossToRef(v,x,F),F.normalize(),D.push(F.x,F.y,F.z,F.x,F.y,F.z),M.l.CrossToRef(R,v,F),F.normalize(),D.push(F.x,F.y,F.z,F.x,F.y,F.z),P=q?C!==b?r[b+1].y:r[b+1].w:r[b+1].y+(r[b+1].w-r[b+1].y)*d,o.push(r[b+1].x,B.c?1-P:P),o.push(r[b+1].z,B.c?1-P:P),P=q?C!==b?r[b+2].y:r[b+2].w:r[b+2].y+(r[b+2].w-r[b+2].y)*d,o.push(r[b+2].x,B.c?1-P:P),o.push(r[b+2].z,B.c?1-P:P),m&&(i.push(m[b+1].r,m[b+1].g,m[b+1].b,m[b+1].a),i.push(m[b+1].r,m[b+1].g,m[b+1].b,m[b+1].a),i.push(m[b+2].r,m[b+2].g,m[b+2].b,m[b+2].a),i.push(m[b+2].r,m[b+2].g,m[b+2].b,m[b+2].a))),C!==b&&(C=b)}const S=1!==w&&y?k+4:k;for(J=0,b=0;b<A;b++){let U=0,W=0,l=0,M=0;for(Q=0;Q<k;Q++)U=J*(S+1)+Q,W=(J+1)*(S+1)+Q,l=J*(S+1)+(Q+1),M=(J+1)*(S+1)+(Q+1),Z.push(U,W,l),Z.push(M,l,W);1!==w&&y&&(Z.push(U+2,W+2,l+2),Z.push(M+2,l+2,W+2),Z.push(U+4,W+4,l+4),Z.push(M+4,l+4,W+4)),J=q?J+2:J+1}const c=U=>{const t=U?l/2:L/2;if(0===t)return;let p,A,q;const y=U?r[f-1]:r[0];let j=null;m&&(j=U?m[f-1]:m[0]);const s=N.length/3,K=U?W/2:-W/2,g=new M.l(0,K,0);N.push(g.x,g.y,g.z),D.push(0,U?1:-1,0);const E=y.y+.5*(y.w-y.y);o.push(y.x+.5*(y.z-y.x),B.c?1-E:E),j&&i.push(j.r,j.g,j.b,j.a);const O=new M.h(.5,.5);for(q=0;q<=k;q++){p=2*Math.PI*q*w/k;const W=Math.cos(-p),l=Math.sin(-p);A=new M.l(W*t,K,l*t);const L=new M.h(W*O.x+.5,l*O.y+.5);N.push(A.x,A.y,A.z),D.push(0,U?1:-1,0);const s=y.y+(y.w-y.y)*L.y;o.push(y.x+(y.z-y.x)*L.x,B.c?1-s:s),j&&i.push(j.r,j.g,j.b,j.a)}for(q=0;q<k;q++)U?(Z.push(s),Z.push(s+(q+2)),Z.push(s+(q+1))):(Z.push(s),Z.push(s+(q+1)),Z.push(s+(q+2)))};s!==t.e.CAP_START&&s!==t.e.CAP_ALL||c(!1),s!==t.e.CAP_END&&s!==t.e.CAP_ALL||c(!0),p.b._ComputeSides(K,N,Z,D,o,U.frontUVs,U.backUVs);const h=new p.b;return h.indices=Z,h.xa=N,h.ya=D,h.Aa=o,m&&(h.za=i),h}function Z(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return E(W).Ca(M,W.updatable),M}function N(U){const W=[],l=[],t=[],L=[],k=U.diameter||1,A=U.thickness||.5,q=0|(U.tessellation||16),y=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE,j=q+1;for(let p=0;p<=q;p++){const U=p/q,y=p*Math.PI*2/q-Math.PI/2,s=M.c.Translation(k/2,0,0).multiply(M.c.RotationY(y));for(let k=0;k<=q;k++){const y=1-k/q,w=k*Math.PI*2/q+Math.PI,K=Math.cos(w),r=Math.sin(w);let m=new M.l(K,r,0),f=m.scale(A/2);const g=new M.h(U,y);f=M.l.TransformCoordinates(f,s),m=M.l.TransformNormal(m,s),l.push(f.x,f.y,f.z),t.push(m.x,m.y,m.z),L.push(g.x,B.c?1-g.y:g.y);const E=(p+1)%j,Z=(k+1)%j;W.push(p*j+k),W.push(p*j+Z),W.push(E*j+k),W.push(p*j+Z),W.push(E*j+Z),W.push(E*j+k)}}p.b._ComputeSides(y,l,W,t,L,U.frontUVs,U.backUVs);const s=new p.b;return s.indices=W,s.xa=l,s.ya=t,s.Aa=L,s}function D(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return N(W).Ca(M,W.updatable),M}p.b.CreateCylinder=E,t.e.CreateCylinder=(U,W,l,M,L,p,B,k,A)=>{void 0!==B&&B instanceof f.c||(void 0!==B&&(A=k||t.e.DEFAULTSIDE,k=B),B=p,p=1);return Z(U,{height:W,diameterTop:l,diameterBottom:M,tessellation:L,subdivisions:p,sideOrientation:A,updatable:k},B)};function o(U){const W=[],l=[],t=[],L=[],k=U.radius||2,A=U.tube||.5,q=U.radialSegments||32,y=U.tubularSegments||32,j=U.p||2,s=U.q||3,w=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE,K=U=>{const W=Math.cos(U),l=Math.sin(U),t=s/j*U,L=Math.cos(t),p=k*(2+L)*.5*W,B=k*(2+L)*l*.5,A=k*Math.sin(t)*.5;return new M.l(p,B,A)};let r,m;for(r=0;r<=q;r++){const U=r%q/q*2*j*Math.PI,W=K(U),t=K(U+.01),p=t.de(W);let k=t.add(W);const s=M.l.Cross(p,k);for(k=M.l.Cross(s,p),s.normalize(),k.normalize(),m=0;m<y;m++){const U=m%y/y*2*Math.PI,M=-A*Math.cos(U),t=A*Math.sin(U);l.push(W.x+M*k.x+t*s.x),l.push(W.y+M*k.y+t*s.y),l.push(W.z+M*k.z+t*s.z),L.push(r/q),L.push(B.c?1-m/y:m/y)}}for(r=0;r<q;r++)for(m=0;m<y;m++){const U=(m+1)%y,l=r*y+m,M=(r+1)*y+m,t=(r+1)*y+U,L=r*y+U;W.push(L),W.push(M),W.push(l),W.push(L),W.push(t),W.push(M)}p.b.ComputeNormals(l,W,t),p.b._ComputeSides(w,l,W,t,L,U.frontUVs,U.backUVs);const f=new p.b;return f.indices=W,f.xa=l,f.ya=t,f.Aa=L,f}function i(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return o(W).Ca(M,W.updatable),M}p.b.CreateTorus=N,t.e.CreateTorus=(U,W,l,M,t,L,p)=>D(U,{diameter:W,thickness:l,tessellation:M,sideOrientation:p,updatable:L},t);p.b.CreateTorusKnot=o,t.e.CreateTorusKnot=(U,W,l,M,t,L,p,B,k,A)=>i(U,{radius:W,tube:l,radialSegments:M,tubularSegments:t,p:L,q:p,sideOrientation:A,updatable:k},B);var O=l(12888),e=l(11886),d=l(2024);function H(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=W.path,L=W.shape,p=W.scale||1,B=W.rotation||0,k=0===W.cap?0:W.cap||t.e.NO_CAP,A=W.updatable,q=t.e._GetDefaultSideOrientation(W.sideOrientation),y=W.instance||null,j=W.invertUV||!1,s=W.closeShape||!1,w=W.closePath||!1,K=W.capFunction||null;return n(U,L,M,p,B,null,null,w,s,k,!1,l,!!A,q,y,j,W.frontUVs||null,W.backUVs||null,W.firstNormal||null,!!W.adjustFrame,K)}function V(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=W.path,L=W.shape,p=W.scaleFunction||(()=>1),B=W.rotationFunction||(()=>0),k=W.closePath||W.ribbonCloseArray||!1,A=W.closeShape||W.ribbonClosePath||!1,q=0===W.cap?0:W.cap||t.e.NO_CAP,y=W.updatable,j=W.firstNormal||null,s=W.adjustFrame||!1,w=t.e._GetDefaultSideOrientation(W.sideOrientation),K=W.instance,r=W.invertUV||!1,m=W.capFunction||null;return n(U,L,M,null,null,p,B,k,A,q,!0,l,!!y,w,K||null,r,W.frontUVs||null,W.backUVs||null,j,s,m||null)}function n(U,W,l,L,p,B,k,q,y,j,s,w,K,r,m,f,g,E,Z,N,D){const o=(U,W,l,L,p,B,k,A,q,y,j)=>{const s=l.getTangents(),w=l.getNormals(),K=l.getBinormals(),r=l.getDistances();if(j)for(let t=0;t<s.length;t++)if(0==s[t].x&&0==s[t].y&&0==s[t].z&&s[t].p(s[t-1]),0==w[t].x&&0==w[t].y&&0==w[t].z&&w[t].p(w[t-1]),0==K[t].x&&0==K[t].y&&0==K[t].z&&K[t].p(K[t-1]),t>0){let U=s[t-1];M.l.Dot(U,s[t])<0&&s[t].scaleInPlace(-1),U=w[t-1],M.l.Dot(U,w[t])<0&&w[t].scaleInPlace(-1),U=K[t-1],M.l.Dot(U,K[t])<0&&K[t].scaleInPlace(-1)}let m=0;const f=y&&A?A:()=>null!==B?B:0,g=y&&k?k:()=>null!==p?p:1;let E=q===t.e.NO_CAP||q===t.e.CAP_END?0:2;const Z=M.f.Matrix[0];for(let t=0;t<W.length;t++){const l=[],p=f(t,r[t]),B=g(t,r[t]);M.c.RotationAxisToRef(s[t],m,Z);for(let L=0;L<U.length;L++){const p=s[t].scale(U[L].z).add(w[t].scale(U[L].x)).add(K[t].scale(U[L].y)),k=M.l.Zero();M.l.TransformCoordinatesToRef(p,Z,k),k.scaleInPlace(B).addInPlace(W[t]),l[L]=k}L[E]=l,m+=p,E++}const N=D||(U=>{const W=Array(),l=M.l.Zero();let t;for(t=0;t<U.length;t++)l.addInPlace(U[t]);for(l.scaleInPlace(1/U.length),t=0;t<U.length;t++)W.push(l);return W});switch(q){case t.e.NO_CAP:break;case t.e.CAP_START:L[0]=N(L[2]),L[1]=L[2];break;case t.e.CAP_END:L[E]=L[E-1],L[E+1]=N(L[E-1]);break;case t.e.CAP_ALL:L[0]=N(L[2]),L[1]=L[2],L[E]=L[E-1],L[E+1]=N(L[E-1])}return L};let i,O;if(m){const U=m._creationDataStorage;return i=Z?U.path3D.update(l,Z):U.path3D.update(l),O=o(W,l,U.path3D,U.pathArray,L,p,B,k,U.cap,s,N),m=A("",{pathArray:O,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:m},w||void 0)}i=Z?new d.m(l,Z):new d.m(l);O=o(W,l,i,new Array,L,p,B,k,j=j<0||j>3?0:j,s,N);const e=A(U,{pathArray:O,closeArray:q,closePath:y,updatable:K,sideOrientation:r,invertUV:f,frontUVs:g||void 0,backUVs:E||void 0},w);return e._creationDataStorage.pathArray=O,e._creationDataStorage.path3D=i,e._creationDataStorage.cap=j,e}function x(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=W.arc?W.arc<=0||W.arc>1?1:W.arc:1,p=void 0===W.closed||W.closed,B=W.shape,k=W.radius||1,q=W.tessellation||64,y=W.clip||0,j=W.updatable,s=t.e._GetDefaultSideOrientation(W.sideOrientation),w=W.cap||t.e.NO_CAP,K=2*Math.PI,r=[],m=W.invertUV||!1;let f=0,g=0;const E=K/q*L;let Z,N;for(f=0;f<=q-y;f++){for(N=[],w!=t.e.CAP_START&&w!=t.e.CAP_ALL||(N.push(new M.l(0,B[0].y,0)),N.push(new M.l(Math.cos(f*E)*B[0].x*k,B[0].y,Math.sin(f*E)*B[0].x*k))),g=0;g<B.length;g++)Z=new M.l(Math.cos(f*E)*B[g].x*k,B[g].y,Math.sin(f*E)*B[g].x*k),N.push(Z);w!=t.e.CAP_END&&w!=t.e.CAP_ALL||(N.push(new M.l(Math.cos(f*E)*B[B.length-1].x*k,B[B.length-1].y,Math.sin(f*E)*B[B.length-1].x*k)),N.push(new M.l(0,B[B.length-1].y,0))),r.push(N)}return A(U,{pathArray:r,closeArray:p,sideOrientation:s,updatable:j,invertUV:m,frontUVs:W.frontUVs,backUVs:W.backUVs},l)}t.e.ExtrudeShape=function(U,W,l,M,L,p){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0,q=arguments.length>9?arguments[9]:void 0;return H(U,{shape:W,path:l,scale:M,rotation:L,cap:0===p?0:p||t.e.NO_CAP,sideOrientation:A,instance:q,updatable:k},B)},t.e.ExtrudeShapeCustom=(U,W,l,M,L,p,B,k,A,q,y,j)=>V(U,{shape:W,path:l,scaleFunction:M,rotationFunction:L,ribbonCloseArray:p,ribbonClosePath:B,cap:0===k?0:k||t.e.NO_CAP,sideOrientation:y,instance:j,updatable:q},A);t.e.CreateLathe=(U,W,l,M,t,L,p)=>x(U,{shape:W,radius:l,tessellation:M,sideOrientation:p,updatable:L},t);var I=l(12274),R=l(12223);function F(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=W.path;let p=W.instance,B=1;void 0!==W.radius?B=W.radius:p&&(B=p._creationDataStorage.radius);const k=W.tessellation||64,q=W.radiusFunction||null;let y=W.cap||t.e.NO_CAP;const j=W.invertUV||!1,s=W.updatable,w=t.e._GetDefaultSideOrientation(W.sideOrientation);W.arc=W.arc&&(W.arc<=0||W.arc>1)?1:W.arc||1;const K=(U,W,l,L,p,B,k,A)=>{const q=W.getTangents(),y=W.getNormals(),j=W.getDistances(),s=2*Math.PI/p*A,w=B||(()=>L);let K,r,m,f;const g=M.f.Matrix[0];let E=k===t.e.NO_CAP||k===t.e.CAP_END?0:2;for(let t=0;t<U.length;t++){r=w(t,j[t]),K=Array(),m=y[t];for(let W=0;W<p;W++)M.c.RotationAxisToRef(q[t],s*W,g),f=K[W]?K[W]:M.l.Zero(),M.l.TransformCoordinatesToRef(m,g,f),f.scaleInPlace(r).addInPlace(U[t]),K[W]=f;l[E]=K,E++}const Z=(W,l)=>{const M=Array();for(let t=0;t<W;t++)M.push(U[l]);return M};switch(k){case t.e.NO_CAP:break;case t.e.CAP_START:l[0]=Z(p,0),l[1]=l[2].slice(0);break;case t.e.CAP_END:l[E]=l[E-1].slice(0),l[E+1]=Z(p,U.length-1);break;case t.e.CAP_ALL:l[0]=Z(p,0),l[1]=l[2].slice(0),l[E]=l[E-1].slice(0),l[E+1]=Z(p,U.length-1)}return l};let r,m;if(p){const U=p._creationDataStorage,l=W.arc||U.arc;return r=U.path3D.update(L),m=K(L,r,U.pathArray,B,U.tessellation,q,U.cap,l),p=A("",{pathArray:m,instance:p}),U.path3D=r,U.pathArray=m,U.arc=l,U.radius=B,p}r=new d.m(L);y=y<0||y>3?0:y,m=K(L,r,new Array,B,k,q,y,W.arc);const f=A(U,{pathArray:m,closePath:!0,closeArray:!1,updatable:s,sideOrientation:w,invertUV:j,frontUVs:W.frontUVs,backUVs:W.backUVs},l);return f._creationDataStorage.pathArray=m,f._creationDataStorage.path3D=r,f._creationDataStorage.tessellation=k,f._creationDataStorage.cap=y,f._creationDataStorage.arc=W.arc,f._creationDataStorage.radius=B,f}function v(U){const W=[];W[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},W[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},W[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},W[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},W[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},W[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},W[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},W[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},W[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},W[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},W[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},W[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},W[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},W[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},W[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const l=U.type&&(U.type<0||U.type>=W.length)?0:U.type||0,t=U.size,L=U.sizeX||t||1,k=U.sizeY||t||1,A=U.sizeZ||t||1,q=U.custom||W[l],y=q.face.length,s=U.faceUV||new Array(y),w=U.faceColors,K=void 0===U.flat||U.flat,r=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE,m=[],f=[],g=[],E=[],Z=[];let N=0,D=0;const o=[];let i,O,e,d,H,V,n=0,x=0;if(K)for(x=0;x<y;x++)w&&void 0===w[x]&&(w[x]=new j.f(1,1,1,1)),s&&void 0===s[x]&&(s[x]=new M.p(0,0,1,1));if(K)for(x=0;x<y;x++){const U=q.face[x].length;for(e=2*Math.PI/U,d=.5*Math.tan(e/2),H=.5,n=0;n<U;n++)m.push(q.vertex[q.face[x][n]][0]*L,q.vertex[q.face[x][n]][1]*k,q.vertex[q.face[x][n]][2]*A),o.push(N),N++,i=s[x].x+(s[x].z-s[x].x)*(.5+d),O=s[x].y+(s[x].w-s[x].y)*(H-.5),E.push(i,B.c?1-O:O),V=d*Math.cos(e)-H*Math.sin(e),H=d*Math.sin(e)+H*Math.cos(e),d=V,w&&Z.push(w[x].r,w[x].g,w[x].b,w[x].a);for(n=0;n<U-2;n++)f.push(o[0+D],o[n+2+D],o[n+1+D]);D+=U}else{for(n=0;n<q.vertex.length;n++)m.push(q.vertex[n][0]*L,q.vertex[n][1]*k,q.vertex[n][2]*A),E.push(0,B.c?1:0);for(x=0;x<y;x++)for(n=0;n<q.face[x].length-2;n++)f.push(q.face[x][0],q.face[x][n+2],q.face[x][n+1])}p.b.ComputeNormals(m,f,g),p.b._ComputeSides(r,m,f,g,E,U.frontUVs,U.backUVs);const I=new p.b;return I.xa=m,I.indices=f,I.ya=g,I.Aa=E,w&&K&&(I.za=Z),I}function J(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return v(W).Ca(M,W.updatable),M}t.e.CreateTube=(U,W,l,M,t,L,p,B,k,A)=>F(U,{path:W,radius:l,tessellation:M,radiusFunction:t,arc:1,cap:L,updatable:B,sideOrientation:k,instance:A},p);function Q(U){const W=U.sideOrientation||p.b.DEFAULTSIDE,l=U.radius||1,t=void 0===U.flat||U.flat,L=0|(U.subdivisions||4),k=U.radiusX||l,A=U.radiusY||l,q=U.radiusZ||l,y=(1+Math.sqrt(5))/2,j=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],s=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],w=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],K=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],r=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],m=[],f=[],g=[],E=[];let Z=0;const N=new Array(3),D=new Array(3);let o;for(o=0;o<3;o++)N[o]=M.l.Zero(),D[o]=M.h.Zero();for(let p=0;p<20;p++){for(o=0;o<3;o++){const U=s[3*p+o];N[o].wd(j[3*w[U]],j[3*w[U]+1],j[3*w[U]+2]),N[o].normalize(),D[o].wd(.134765625*K[2*U]+.05859375+-.0390625*r[p],.2333984375*K[2*U+1]+.025390625+.01953125*r[p])}const U=(U,W,l,p)=>{const y=M.l.Lerp(N[0],N[2],W/L),j=M.l.Lerp(N[1],N[2],W/L),s=L===W?N[2]:M.l.Lerp(y,j,U/(L-W));let w;if(s.normalize(),t){const U=M.l.Lerp(N[0],N[2],p/L),W=M.l.Lerp(N[1],N[2],p/L);w=M.l.Lerp(U,W,l/(L-p))}else w=new M.l(s.x,s.y,s.z);w.x/=k,w.y/=A,w.z/=q,w.normalize();const K=M.h.Lerp(D[0],D[2],W/L),r=M.h.Lerp(D[1],D[2],W/L),o=L===W?D[2]:M.h.Lerp(K,r,U/(L-W));f.push(s.x*k,s.y*A,s.z*q),g.push(w.x,w.y,w.z),E.push(o.x,B.c?1-o.y:o.y),m.push(Z),Z++};for(let W=0;W<L;W++)for(let l=0;l+W<L;l++)U(l,W,l+1/3,W+1/3),U(l+1,W,l+1/3,W+1/3),U(l,W+1,l+1/3,W+1/3),l+W+1<L&&(U(l+1,W,l+2/3,W+2/3),U(l+1,W+1,l+2/3,W+2/3),U(l,W+1,l+2/3,W+2/3))}p.b._ComputeSides(W,f,m,g,E,U.frontUVs,U.backUVs);const i=new p.b;return i.indices=m,i.xa=f,i.ya=g,i.Aa=E,i}function G(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new t.e(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),M._originalBuilderSideOrientation=W.sideOrientation;return Q(W).Ca(M,W.updatable),M}p.b.CreatePolyhedron=v,t.e.CreatePolyhedron=(U,W,l)=>J(U,W,l);p.b.CreateIcoSphere=Q,t.e.CreateIcoSphere=(U,W,l)=>G(U,W,l);var u=l(722);const b=new M.l(1,0,0),C=new M.l(-1,0,0),P=new M.l(0,1,0),S=new M.l(0,-1,0),c=new M.l(0,0,1),h=new M.l(0,0,-1);class z{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.l.Zero(),W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.l.Up(),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.h.Zero(),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=U,this.rk=W,this.uv=l,this.vertexIdx=t,this.vertexIdxForBones=L,this.localPositionOverride=p,this.localNormalOverride=B,this.matrixIndicesOverride=k,this.matrixWeightsOverride=A}clone(){var U,W,l,M;return new z(this.position.clone(),this.rk.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(U=this.localPositionOverride)||void 0===U?void 0:U.slice(),null===(W=this.localNormalOverride)||void 0===W?void 0:W.slice(),null===(l=this.matrixIndicesOverride)||void 0===l?void 0:l.slice(),null===(M=this.matrixWeightsOverride)||void 0===M?void 0:M.slice())}}function a(U,W,l){var k,A,q,y,j;const s=!!W.skeleton,w=!(null===(k=W.morphTargetManager)||void 0===k||!k.numTargets),K=l.localMode||s,r=W.hk(),m=s||w?W.Mc(!0,!0):W.getVerticesData(L.e.PositionKind),f=s||w?W.getNormalsData(!0,!0):W.getVerticesData(L.e.NormalKind),g=K?s?W.getVerticesData(L.e.PositionKind):m:null,E=K?s?W.getVerticesData(L.e.NormalKind):f:null,Z=W.getVerticesData(L.e.UVKind),N=s?W.getVerticesData(L.e.MatricesIndicesKind):null,D=s?W.getVerticesData(L.e.MatricesWeightsKind):null,o=s?W.getVerticesData(L.e.MatricesIndicesExtraKind):null,i=s?W.getVerticesData(L.e.MatricesWeightsExtraKind):null,O=l.position||M.l.Zero();let e=l.rk||M.l.Up();const d=l.size||M.l.One(),H=l.angle||0;if(!e){const U=new M.l(0,0,1),l=W.va().activeCamera,t=M.l.TransformCoordinates(U,l.getWorldMatrix());e=l.globalPosition.de(t)}const V=-Math.atan2(e.z,e.x)-Math.PI/2,n=Math.sqrt(e.x*e.x+e.z*e.z),x=Math.atan2(e.y,n),I=new p.b;I.indices=[],I.xa=[],I.ya=[],I.Aa=[],I.matricesIndices=s?[]:null,I.matricesWeights=s?[]:null,I.matricesIndicesExtra=o?[]:null,I.matricesWeightsExtra=i?[]:null;let R=0;const F=(U,W)=>{const t=new z;if(!r||!m||!f)return t;const L=r[U];if(t.vertexIdx=3*L,t.vertexIdxForBones=4*L,t.position=new M.l(m[3*L],m[3*L+1],m[3*L+2]),M.l.TransformCoordinatesToRef(t.position,W,t.position),t.rk=new M.l(f[3*L],f[3*L+1],f[3*L+2]),M.l.TransformNormalToRef(t.rk,W,t.rk),l.captureUVS&&Z){const U=Z[2*L+1];t.uv=new M.h(Z[2*L],B.c?1-U:U)}return t},v=[0,0,0,0],J=(U,W)=>{if(0===U.length)return U;const l=.5*Math.abs(M.l.Dot(d,W)),t=(U,W,l,M)=>{for(let t=0;t<M;++t)if(U[l+t]===W)return l+t;return-1},L=(U,L)=>{const p=M.l.GetClipFactor(U.position,L.position,W,l);let B=v,k=v;if(N&&D){const W=U.matrixIndicesOverride?0:U.vertexIdxForBones,l=U.matrixIndicesOverride??N,M=U.matrixWeightsOverride??D,A=L.matrixIndicesOverride?0:L.vertexIdxForBones,q=L.matrixIndicesOverride??N,y=L.matrixWeightsOverride??D;B=[0,0,0,0],k=[0,0,0,0];let j=0;for(let U=0;U<4;++U)if(M[W+U]>0){const L=t(q,l[W+U],A,4);B[j]=l[W+U],k[j]=(0,u.Lerp)(M[W+U],L>=0?y[L]:0,p),j++}for(let U=0;U<4&&j<4;++U){const M=q[A+U];-1===t(l,M,W,4)&&(B[j]=M,k[j]=(0,u.Lerp)(0,y[A+U],p),j++)}const s=k[0]+k[1]+k[2]+k[3];k[0]/=s,k[1]/=s,k[2]/=s,k[3]/=s}const A=U.localPositionOverride?U.localPositionOverride[0]:(null===g||void 0===g?void 0:g[U.vertexIdx])??0,q=U.localPositionOverride?U.localPositionOverride[1]:(null===g||void 0===g?void 0:g[U.vertexIdx+1])??0,y=U.localPositionOverride?U.localPositionOverride[2]:(null===g||void 0===g?void 0:g[U.vertexIdx+2])??0,j=L.localPositionOverride?L.localPositionOverride[0]:(null===g||void 0===g?void 0:g[L.vertexIdx])??0,s=L.localPositionOverride?L.localPositionOverride[1]:(null===g||void 0===g?void 0:g[L.vertexIdx+1])??0,w=L.localPositionOverride?L.localPositionOverride[2]:(null===g||void 0===g?void 0:g[L.vertexIdx+2])??0,K=U.localNormalOverride?U.localNormalOverride[0]:(null===E||void 0===E?void 0:E[U.vertexIdx])??0,r=U.localNormalOverride?U.localNormalOverride[1]:(null===E||void 0===E?void 0:E[U.vertexIdx+1])??0,m=U.localNormalOverride?U.localNormalOverride[2]:(null===E||void 0===E?void 0:E[U.vertexIdx+2])??0,f=K+((L.localNormalOverride?L.localNormalOverride[0]:(null===E||void 0===E?void 0:E[L.vertexIdx])??0)-K)*p,Z=r+((L.localNormalOverride?L.localNormalOverride[1]:(null===E||void 0===E?void 0:E[L.vertexIdx+1])??0)-r)*p,o=m+((L.localNormalOverride?L.localNormalOverride[2]:(null===E||void 0===E?void 0:E[L.vertexIdx+2])??0)-m)*p,i=Math.sqrt(f*f+Z*Z+o*o);return new z(M.l.Lerp(U.position,L.position,p),M.l.Lerp(U.rk,L.rk,p).normalize(),M.h.Lerp(U.uv,L.uv,p),-1,-1,g?[A+(j-A)*p,q+(s-q)*p,y+(w-y)*p]:null,E?[f/i,Z/i,o/i]:null,B,k)};let p=null;U.length>3&&(p=[]);for(let B=0;B<U.length;B+=3){let t=0,k=null,A=null,q=null,y=null;const j=M.l.Dot(U[B].position,W)-l>0,s=M.l.Dot(U[B+1].position,W)-l>0,w=M.l.Dot(U[B+2].position,W)-l>0;switch(t=(j?1:0)+(s?1:0)+(w?1:0),t){case 0:U.length>3?(p.push(U[B]),p.push(U[B+1]),p.push(U[B+2])):p=U;break;case 1:if(p=p??new Array,j&&(k=U[B+1],A=U[B+2],q=L(U[B],k),y=L(U[B],A)),s){k=U[B],A=U[B+2],q=L(U[B+1],k),y=L(U[B+1],A),p.push(q),p.push(A.clone()),p.push(k.clone()),p.push(A.clone()),p.push(q.clone()),p.push(y);break}w&&(k=U[B],A=U[B+1],q=L(U[B+2],k),y=L(U[B+2],A)),k&&A&&q&&y&&(p.push(k.clone()),p.push(A.clone()),p.push(q),p.push(y),p.push(q.clone()),p.push(A.clone()));break;case 2:p=p??new Array,j||(k=U[B].clone(),A=L(k,U[B+1]),q=L(k,U[B+2]),p.push(k),p.push(A),p.push(q)),s||(k=U[B+1].clone(),A=L(k,U[B+2]),q=L(k,U[B]),p.push(k),p.push(A),p.push(q)),w||(k=U[B+2].clone(),A=L(k,U[B]),q=L(k,U[B+1]),p.push(k),p.push(A),p.push(q))}}return p},Q=W instanceof t.e?W:null,G=null===Q||void 0===Q?void 0:Q._thinInstanceDataStorage.matrixData,a=(null===Q||void 0===Q?void 0:Q.Pk)||1,Y=M.f.Matrix[0];Y.p(M.c.IdentityReadOnly);for(let t=0;t<a;++t){if(null!==Q&&void 0!==Q&&Q.hasThinInstances&&G){const U=16*t;Y.setRowFromFloats(0,G[U+0],G[U+1],G[U+2],G[U+3]),Y.setRowFromFloats(1,G[U+4],G[U+5],G[U+6],G[U+7]),Y.setRowFromFloats(2,G[U+8],G[U+9],G[U+10],G[U+11]),Y.setRowFromFloats(3,G[U+12],G[U+13],G[U+14],G[U+15])}const U=M.c.RotationYawPitchRoll(V,x,H).multiply(M.c.Translation(O.x,O.y,O.z)),L=M.c.Invert(U),p=W.getWorldMatrix(),k=Y.multiply(p).multiply(L),A=new Array(3);for(let W=0;W<r.length;W+=3){let U=A;if(U[0]=F(W,k),U[1]=F(W+1,k),U[2]=F(W+2,k),!(l.cullBackFaces&&-U[0].rk.z<=0&&-U[1].rk.z<=0&&-U[2].rk.z<=0)&&(U=J(U,b),U&&(U=J(U,C),U&&(U=J(U,P),U&&(U=J(U,S),U&&(U=J(U,c),U&&(U=J(U,h),U)))))))for(let W=0;W<U.length;W++){const M=U[W];if(I.indices.push(R),K?(M.localPositionOverride?(I.xa[3*R]=M.localPositionOverride[0],I.xa[3*R+1]=M.localPositionOverride[1],I.xa[3*R+2]=M.localPositionOverride[2]):g&&(I.xa[3*R]=g[M.vertexIdx],I.xa[3*R+1]=g[M.vertexIdx+1],I.xa[3*R+2]=g[M.vertexIdx+2]),M.localNormalOverride?(I.ya[3*R]=M.localNormalOverride[0],I.ya[3*R+1]=M.localNormalOverride[1],I.ya[3*R+2]=M.localNormalOverride[2]):E&&(I.ya[3*R]=E[M.vertexIdx],I.ya[3*R+1]=E[M.vertexIdx+1],I.ya[3*R+2]=E[M.vertexIdx+2])):(M.position.toArray(I.xa,3*R),M.rk.toArray(I.ya,3*R)),I.matricesIndices&&I.matricesWeights&&(M.matrixIndicesOverride?(I.matricesIndices[4*R]=M.matrixIndicesOverride[0],I.matricesIndices[4*R+1]=M.matrixIndicesOverride[1],I.matricesIndices[4*R+2]=M.matrixIndicesOverride[2],I.matricesIndices[4*R+3]=M.matrixIndicesOverride[3]):(N&&(I.matricesIndices[4*R]=N[M.vertexIdxForBones],I.matricesIndices[4*R+1]=N[M.vertexIdxForBones+1],I.matricesIndices[4*R+2]=N[M.vertexIdxForBones+2],I.matricesIndices[4*R+3]=N[M.vertexIdxForBones+3]),o&&I.matricesIndicesExtra&&(I.matricesIndicesExtra[4*R]=o[M.vertexIdxForBones],I.matricesIndicesExtra[4*R+1]=o[M.vertexIdxForBones+1],I.matricesIndicesExtra[4*R+2]=o[M.vertexIdxForBones+2],I.matricesIndicesExtra[4*R+3]=o[M.vertexIdxForBones+3])),M.matrixWeightsOverride?(I.matricesWeights[4*R]=M.matrixWeightsOverride[0],I.matricesWeights[4*R+1]=M.matrixWeightsOverride[1],I.matricesWeights[4*R+2]=M.matrixWeightsOverride[2],I.matricesWeights[4*R+3]=M.matrixWeightsOverride[3]):(D&&(I.matricesWeights[4*R]=D[M.vertexIdxForBones],I.matricesWeights[4*R+1]=D[M.vertexIdxForBones+1],I.matricesWeights[4*R+2]=D[M.vertexIdxForBones+2],I.matricesWeights[4*R+3]=D[M.vertexIdxForBones+3]),i&&I.matricesWeightsExtra&&(I.matricesWeightsExtra[4*R]=i[M.vertexIdxForBones],I.matricesWeightsExtra[4*R+1]=i[M.vertexIdxForBones+1],I.matricesWeightsExtra[4*R+2]=i[M.vertexIdxForBones+2],I.matricesWeightsExtra[4*R+3]=i[M.vertexIdxForBones+3]))),l.captureUVS)M.uv.toArray(I.Aa,2*R);else{I.Aa.push(.5+M.position.x/d.x);const U=.5+M.position.y/d.y;I.Aa.push(B.c?1-U:U)}R++}}}0===I.indices.length&&(I.indices=null),0===I.xa.length&&(I.xa=null),0===I.ya.length&&(I.ya=null),0===I.Aa.length&&(I.Aa=null),0===(null===(A=I.matricesIndices)||void 0===A?void 0:A.length)&&(I.matricesIndices=null),0===(null===(q=I.matricesWeights)||void 0===q?void 0:q.length)&&(I.matricesWeights=null),0===(null===(y=I.matricesIndicesExtra)||void 0===y?void 0:y.length)&&(I.matricesIndicesExtra=null),0===(null===(j=I.matricesWeightsExtra)||void 0===j?void 0:j.length)&&(I.matricesWeightsExtra=null);const X=new t.e(U,W.va());return I.Ca(X),K?(X.skeleton=W.skeleton,X.parent=W):(X.position=O.clone(),X.rotation=new M.l(x,V,H)),X.fk(!0),X.refreshBoundingInfo(!0,!0),X}function Y(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const W=0|Math.max(U.subdivisions?U.subdivisions:2,1),l=0|Math.max(U.tessellation?U.tessellation:16,3),t=Math.max(U.height?U.height:1,0),L=Math.max(U.radius?U.radius:.25,0),k=0|Math.max(U.capSubdivisions?U.capSubdivisions:6,1),A=l,q=W,y=Math.max(U.radiusTop?U.radiusTop:L,0),j=Math.max(U.radiusBottom?U.radiusBottom:L,0),s=t-(y+j),w=2*Math.PI,K=Math.max(U.topCapSubdivisions?U.topCapSubdivisions:k,1),r=Math.max(U.bottomCapSubdivisions?U.bottomCapSubdivisions:k,1),m=Math.acos((j-y)/t);let f=[];const g=[],E=[],Z=[];let N=0;const D=[],o=.5*s,i=.5*Math.PI;let O,e;const d=M.l.Zero(),H=M.l.Zero(),V=Math.cos(m),n=Math.sin(m),x=new M.h(y*n,o+y*V).de(new M.h(j*n,j*V-o)).length(),I=y*m+x+j*(i-m);let R=0;for(e=0;e<=K;e++){const U=[],W=i-m*(e/K);R+=y*m/K;const l=Math.cos(W),M=Math.sin(W),t=l*y;for(O=0;O<=A;O++){const W=O/A,L=W*w+0,p=Math.sin(L),k=Math.cos(L);H.x=t*p,H.y=o+M*y,H.z=t*k,g.push(H.x,H.y,H.z),d.set(l*p,M,l*k),E.push(d.x,d.y,d.z),Z.push(W,B.c?R/I:1-R/I),U.push(N),N++}D.push(U)}const F=t-y-j+V*y-V*j,v=n*(j-y)/F;for(e=1;e<=q;e++){const U=[];R+=x/q;const W=n*(e*(j-y)/q+y);for(O=0;O<=A;O++){const l=O/A,M=l*w+0,t=Math.sin(M),L=Math.cos(M);H.x=W*t,H.y=o+V*y-e*F/q,H.z=W*L,g.push(H.x,H.y,H.z),d.set(t,v,L).normalize(),E.push(d.x,d.y,d.z),Z.push(l,B.c?R/I:1-R/I),U.push(N),N++}D.push(U)}for(e=1;e<=r;e++){const U=[],W=i-m-(Math.PI-m)*(e/r);R+=j*m/r;const l=Math.cos(W),M=Math.sin(W),t=l*j;for(O=0;O<=A;O++){const W=O/A,L=W*w+0,p=Math.sin(L),k=Math.cos(L);H.x=t*p,H.y=M*j-o,H.z=t*k,g.push(H.x,H.y,H.z),d.set(l*p,M,l*k),E.push(d.x,d.y,d.z),Z.push(W,B.c?R/I:1-R/I),U.push(N),N++}D.push(U)}for(O=0;O<A;O++)for(e=0;e<K+q+r;e++){const U=D[e][O],W=D[e+1][O],l=D[e+1][O+1],M=D[e][O+1];f.push(U),f.push(W),f.push(M),f.push(W),f.push(l),f.push(M)}if(f=f.reverse(),U.orientation&&!U.orientation.equals(M.l.Up())){const W=new M.c;U.orientation.clone().scale(.5*Math.PI).cross(M.l.Up()).toQuaternion().toRotationMatrix(W);const l=M.l.Zero();for(let U=0;U<g.length;U+=3)l.set(g[U],g[U+1],g[U+2]),M.l.TransformCoordinatesToRef(l.clone(),W,l),g[U]=l.x,g[U+1]=l.y,g[U+2]=l.z}const J=new p.b;return J.xa=g,J.ya=E,J.Aa=Z,J.indices=f,J}function X(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:M.l.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new t.e(U,l);return Y(W).Ca(L,W.updatable),L}t.e.CreateDecal=(U,W,l,M,t,L)=>a(U,W,{position:l,rk:M,size:t,angle:L});t.e.CreateCapsule=(U,W,l)=>X(U,W,l),p.b.CreateCapsule=Y;var T=l(512),UU=l(711);class WU{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=U,this.y=W,U!==Math.floor(U)&&(U=Math.floor(U),T.b.Warn("x is not an integer, floor(x) used")),W!==Math.floor(W)&&(W=Math.floor(W),T.b.Warn("y is not an integer, floor(y) used"))}clone(){return new WU(this.x,this.y)}rotate60About(U){const W=this.x;return this.x=U.x+U.y-this.y,this.y=W+this.y-U.x,this}rotateNeg60About(U){const W=this.x;return this.x=W+this.y-U.y,this.y=U.x+U.y-W,this}rotate120(U,W){U!==Math.floor(U)&&(U=Math.floor(U),T.b.Warn("m not an integer only floor(m) used")),W!==Math.floor(W)&&(W=Math.floor(W),T.b.Warn("n not an integer only floor(n) used"));const l=this.x;return this.x=U-l-this.y,this.y=W+l,this}rotateNeg120(U,W){U!==Math.floor(U)&&(U=Math.floor(U),T.b.Warn("m is not an integer, floor(m) used")),W!==Math.floor(W)&&(W=Math.floor(W),T.b.Warn("n is not an integer,   floor(n) used"));const l=this.x;return this.x=this.y-W,this.y=U+W-l-this.y,this}toCartesianOrigin(U,W){const l=M.l.Zero();return l.x=U.x+2*this.x*W+this.y*W,l.y=U.y+Math.sqrt(3)*this.y*W,l}static Zero(){return new WU(0,0)}}class lU{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new MU("icosahedron","Regular",[[0,UU.f,-1],[-UU.f,1,0],[-1,0,-UU.f],[1,0,-UU.f],[UU.f,1,0],[0,UU.f,1],[-1,0,UU.f],[-UU.f,-1,0],[0,-UU.f,-1],[UU.f,-1,0],[1,0,UU.f],[0,-UU.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let U=12;const W={},l=this.m,M=this.n;let t,L,p,B,k,A=l,q=1,y=0;0!==M&&(A=(0,u.HighestCommonFactor)(l,M)),q=l/A,y=M/A;const j=WU.Zero(),s=new WU(l,M),w=new WU(-M,l+M),K=WU.Zero(),r=WU.Zero(),m=WU.Zero();let f,g,E,Z,N=[];const D=[],o=this.vertByDist,i=(l,M,t,L)=>{f=l+"|"+t,g=M+"|"+L,f in W||g in W?f in W&&!(g in W)?W[g]=W[f]:g in W&&!(f in W)&&(W[f]=W[g]):(W[f]=U,W[g]=U,U++),o[t][0]>2?D[W[f]]=[-o[t][0],o[t][1],W[f]]:D[W[f]]=[N[o[t][0]],o[t][1],W[f]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let O=0;O<20;O++){if(N=this.IDATA.face[O],p=N[2],B=N[1],k=N[0],E=j.x+"|"+j.y,f=O+"|"+E,f in W||(W[f]=p,D[p]=[N[o[E][0]],o[E][1]]),E=s.x+"|"+s.y,f=O+"|"+E,f in W||(W[f]=B,D[B]=[N[o[E][0]],o[E][1]]),E=w.x+"|"+w.y,f=O+"|"+E,f in W||(W[f]=k,D[k]=[N[o[E][0]],o[E][1]]),t=this.IDATA.edgematch[O][0],L=this.IDATA.edgematch[O][1],"B"===L)for(let U=1;U<A;U++)r.x=l-U*(q+y),r.y=M+U*q,m.x=-U*y,m.y=U*(q+y),E=r.x+"|"+r.y,Z=m.x+"|"+m.y,i(O,t,E,Z);if("O"===L)for(let U=1;U<A;U++)m.x=-U*y,m.y=U*(q+y),K.x=U*q,K.y=U*y,E=m.x+"|"+m.y,Z=K.x+"|"+K.y,i(O,t,E,Z);if(t=this.IDATA.edgematch[O][2],L=this.IDATA.edgematch[O][3],L&&"A"===L)for(let U=1;U<A;U++)K.x=U*q,K.y=U*y,r.x=l-(A-U)*(q+y),r.y=M+(A-U)*q,E=K.x+"|"+K.y,Z=r.x+"|"+r.y,i(O,t,E,Z);for(let l=0;l<this.vertices.length;l++)E=this.vertices[l].x+"|"+this.vertices[l].y,f=O+"|"+E,f in W||(W[f]=U++,o[E][0]>2?D[W[f]]=[-o[E][0],o[E][1],W[f]]:D[W[f]]=[N[o[E][0]],o[E][1],W[f]])}this.closestTo=D,this.vecToidx=W}calcCoeffs(){const U=this.m,W=this.n,l=Math.sqrt(3)/3,M=U*U+W*W+U*W;this.coau=(U+W)/M,this.cobu=-W/M,this.coav=-l*(U-W)/M,this.cobv=l*(2*U+W)/M}createInnerFacets(){const U=this.m,W=this.n;for(let l=0;l<W+U+1;l++)for(let U=this.min[l];U<this.max[l]+1;U++)U<this.max[l]&&U<this.max[l+1]+1&&this.innerFacets.push(["|"+U+"|"+l,"|"+U+"|"+(l+1),"|"+(U+1)+"|"+l]),l>0&&U<this.max[l-1]&&U+1<this.max[l]+1&&this.innerFacets.push(["|"+U+"|"+l,"|"+(U+1)+"|"+l,"|"+(U+1)+"|"+(l-1)])}edgeVecsABOB(){const U=this.m,W=this.n,l=new WU(-W,U+W);for(let M=1;M<U+W;M++){const U=new WU(this.min[M],M),W=new WU(this.min[M-1],M-1),t=new WU(this.min[M+1],M+1),L=U.clone(),p=W.clone(),B=t.clone();L.rotate60About(l),p.rotate60About(l),B.rotate60About(l);const k=new WU(this.max[L.y],L.y),A=new WU(this.max[L.y-1],L.y-1),q=new WU(this.max[L.y-1]-1,L.y-1);L.x===k.x&&L.y===k.y||(L.x!==A.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,A,q]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,q,k])):L.y===B.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,W,A]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([U,A,t])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,W,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,A,k])))}}mapABOBtoOBOA(){const U=new WU(0,0);for(let W=0;W<this.isoVecsABOB.length;W++){const l=[];for(let M=0;M<3;M++)U.x=this.isoVecsABOB[W][M].x,U.y=this.isoVecsABOB[W][M].y,0===this.vertexTypes[W][M]&&U.rotateNeg120(this.m,this.n),l.push(U.clone());this.isoVecsOBOA.push(l)}}mapABOBtoBAOA(){const U=new WU(0,0);for(let W=0;W<this.isoVecsABOB.length;W++){const l=[];for(let M=0;M<3;M++)U.x=this.isoVecsABOB[W][M].x,U.y=this.isoVecsABOB[W][M].y,1===this.vertexTypes[W][M]&&U.rotate120(this.m,this.n),l.push(U.clone());this.isoVecsBAOA.push(l)}}MapToFace(U,W){const l=this.IDATA.face[U],t=l[2],L=l[1],p=l[0],B=M.l.gk(this.IDATA.vertex[t]),k=M.l.gk(this.IDATA.vertex[L]),A=M.l.gk(this.IDATA.vertex[p]),q=k.de(B),y=A.de(B),j=q.scale(this.coau).add(y.scale(this.cobu)),s=q.scale(this.coav).add(y.scale(this.cobv)),w=[];let K,r=M.f.ik[0];for(let M=0;M<this.cartesian.length;M++)r=j.scale(this.cartesian[M].x).add(s.scale(this.cartesian[M].y)).add(B),w[M]=[r.x,r.y,r.z],K=U+"|"+this.vertices[M].x+"|"+this.vertices[M].y,W.vertex[this.vecToidx[K]]=[r.x,r.y,r.z]}build(U,W){const l=[],M=WU.Zero(),t=new WU(U,W),L=new WU(-W,U+W);l.push(M,t,L);for(let E=W;E<U+1;E++)for(let W=0;W<U+1-E;W++)l.push(new WU(W,E));if(W>0){const M=(0,u.HighestCommonFactor)(U,W),t=U/M,L=W/M;for(let B=1;B<M;B++)l.push(new WU(B*t,B*L)),l.push(new WU(-B*L,B*(t+L))),l.push(new WU(U-B*(t+L),W+B*t));const p=U/W;for(let B=1;B<W;B++)for(let M=0;M<B*p;M++)l.push(new WU(M,B)),l.push(new WU(M,B).rotate120(U,W)),l.push(new WU(M,B).rotateNeg120(U,W))}l.sort(((U,W)=>U.x-W.x)),l.sort(((U,W)=>U.y-W.y));const p=new Array(U+W+1),B=new Array(U+W+1);for(let E=0;E<p.length;E++)p[E]=1/0,B[E]=-1/0;let k=0,A=0;const q=l.length;for(let E=0;E<q;E++)A=l[E].x,k=l[E].y,p[k]=Math.min(A,p[k]),B[k]=Math.max(A,B[k]);const y=(l,M)=>{const t=l.clone();return"A"===M&&t.rotateNeg120(U,W),"B"===M&&t.rotate120(U,W),t.x<0?t.y:t.x+t.y},j=[],s=[],w=[],K=[],r={},m=[];let f=-1,g=-1;for(let E=0;E<q;E++)j[E]=l[E].toCartesianOrigin(new WU(0,0),.5),s[E]=y(l[E],"O"),w[E]=y(l[E],"A"),K[E]=y(l[E],"B"),s[E]===w[E]&&w[E]===K[E]?(f=3,g=s[E]):s[E]===w[E]?(f=4,g=s[E]):w[E]===K[E]?(f=5,g=w[E]):K[E]===s[E]&&(f=6,g=s[E]),s[E]<w[E]&&s[E]<K[E]&&(f=2,g=s[E]),w[E]<s[E]&&w[E]<K[E]&&(f=1,g=w[E]),K[E]<w[E]&&K[E]<s[E]&&(f=0,g=K[E]),m.push([f,g,l[E].x,l[E].y]);m.sort(((U,W)=>U[2]-W[2])),m.sort(((U,W)=>U[3]-W[3])),m.sort(((U,W)=>U[1]-W[1])),m.sort(((U,W)=>U[0]-W[0]));for(let E=0;E<m.length;E++)r[m[E][2]+"|"+m[E][3]]=[m[E][0],m[E][1],E];return this.m=U,this.n=W,this.vertices=l,this.vertByDist=r,this.cartesian=j,this.min=p,this.max=B,this}}class MU{constructor(U,W,l,M){this.name=U,this.category=W,this.vertex=l,this.face=M}}class tU extends MU{innerToData(U,W){for(let l=0;l<W.innerFacets.length;l++)this.face.push(W.innerFacets[l].map((l=>W.vecToidx[U+l])))}mapABOBtoDATA(U,W){const l=W.IDATA.edgematch[U][0];for(let M=0;M<W.isoVecsABOB.length;M++){const t=[];for(let L=0;L<3;L++)0===W.vertexTypes[M][L]?t.push(U+"|"+W.isoVecsABOB[M][L].x+"|"+W.isoVecsABOB[M][L].y):t.push(l+"|"+W.isoVecsABOB[M][L].x+"|"+W.isoVecsABOB[M][L].y);this.face.push([W.vecToidx[t[0]],W.vecToidx[t[1]],W.vecToidx[t[2]]])}}mapOBOAtoDATA(U,W){const l=W.IDATA.edgematch[U][0];for(let M=0;M<W.isoVecsOBOA.length;M++){const t=[];for(let L=0;L<3;L++)1===W.vertexTypes[M][L]?t.push(U+"|"+W.isoVecsOBOA[M][L].x+"|"+W.isoVecsOBOA[M][L].y):t.push(l+"|"+W.isoVecsOBOA[M][L].x+"|"+W.isoVecsOBOA[M][L].y);this.face.push([W.vecToidx[t[0]],W.vecToidx[t[1]],W.vecToidx[t[2]]])}}mapBAOAtoDATA(U,W){const l=W.IDATA.edgematch[U][2];for(let M=0;M<W.isoVecsBAOA.length;M++){const t=[];for(let L=0;L<3;L++)1===W.vertexTypes[M][L]?t.push(U+"|"+W.isoVecsBAOA[M][L].x+"|"+W.isoVecsBAOA[M][L].y):t.push(l+"|"+W.isoVecsBAOA[M][L].x+"|"+W.isoVecsBAOA[M][L].y);this.face.push([W.vecToidx[t[0]],W.vecToidx[t[1]],W.vecToidx[t[2]]])}}orderData(U){const W=[];for(let L=0;L<13;L++)W[L]=[];const l=U.closestTo;for(let L=0;L<l.length;L++)l[L][0]>-1?l[L][1]>0&&W[l[L][0]].push([L,l[L][1]]):W[12].push([L,l[L][0]]);const M=[];for(let L=0;L<12;L++)M[L]=L;let t=12;for(let L=0;L<12;L++){W[L].sort(((U,W)=>U[1]-W[1]));for(let U=0;U<W[L].length;U++)M[W[L][U][0]]=t++}for(let L=0;L<W[12].length;L++)M[W[12][L][0]]=t++;for(let L=0;L<this.vertex.length;L++)this.vertex[L].push(M[L]);this.vertex.sort(((U,W)=>U[3]-W[3]));for(let L=0;L<this.vertex.length;L++)this.vertex[L].pop();for(let L=0;L<this.face.length;L++)for(let U=0;U<this.face[L].length;U++)this.face[L][U]=M[this.face[L][U]];this.sharedNodes=W[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(U,W){const l=[],M=[];let t=W.pop();M.push(t);let L=this.face[t].indexOf(U);L=(L+2)%3;let p=this.face[t][L];l.push(p);let B=0;for(;W.length>0;)t=W[B],this.face[t].indexOf(p)>-1?(L=(this.face[t].indexOf(p)+1)%3,p=this.face[t][L],l.push(p),M.push(t),W.splice(B,1),B=0):B++;return this.adjacentFaces.push(l),M}toGoldbergPolyhedronData(){const U=new MU("GeoDual","Goldberg",[],[]);U.name="GD dual";const W=this.vertex.length,l=new Array(W);for(let k=0;k<W;k++)l[k]=[];for(let k=0;k<this.face.length;k++)for(let U=0;U<3;U++)l[this.face[k][U]].push(k);let M=0,t=0,L=0,p=[],B=[];this.adjacentFaces=[];for(let k=0;k<l.length;k++){U.face[k]=this.setOrder(k,l[k].concat([]));for(const W of l[k]){M=0,t=0,L=0,p=this.face[W];for(let U=0;U<3;U++)B=this.vertex[p[U]],M+=B[0],t+=B[1],L+=B[2];U.vertex[W]=[M/3,t/3,L/3]}}return U}static BuildGeodesicData(U){const W=new tU("Geodesic-m-n","Geodesic",[[0,UU.f,-1],[-UU.f,1,0],[-1,0,-UU.f],[1,0,-UU.f],[UU.f,1,0],[0,UU.f,1],[-1,0,UU.f],[-UU.f,-1,0],[0,-UU.f,-1],[UU.f,-1,0],[1,0,UU.f],[0,-UU.f,1]],[]);U.setIndices(),U.calcCoeffs(),U.createInnerFacets(),U.edgeVecsABOB(),U.mapABOBtoOBOA(),U.mapABOBtoBAOA();for(let l=0;l<U.IDATA.face.length;l++)U.MapToFace(l,W),W.innerToData(l,U),"B"===U.IDATA.edgematch[l][1]&&W.mapABOBtoDATA(l,U),"O"===U.IDATA.edgematch[l][1]&&W.mapOBOAtoDATA(l,U),"A"===U.IDATA.edgematch[l][3]&&W.mapBAOAtoDATA(l,U);W.orderData(U);return W.vertex=W.vertex.map((function(U){const W=U[0],l=U[1],M=U[2],t=Math.sqrt(W*W+l*l+M*M);return U[0]*=1/t,U[1]*=1/t,U[2]*=1/t,U})),W}}t.e._GoldbergMeshParser=(U,W)=>LU.Parse(U,W);class LU extends t.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(U,W){return void 0===W?(U>this.goldbergData.nbUnsharedFaces-1&&(T.b.Warn("Maximum number of unshared faces used"),U=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+U):(U>11&&(T.b.Warn("Last pole used"),U=11),W>this.goldbergData.nbFacesAtPole-1&&(T.b.Warn("Maximum number of faces at a pole used"),W=this.goldbergData.nbFacesAtPole-1),12+U*this.goldbergData.nbFacesAtPole+W)}_changeGoldbergFaceColors(U){for(let l=0;l<U.length;l++){const W=U[l][0],M=U[l][1],t=U[l][2];for(let U=W;U<M+1;U++)this.goldbergData.faceColors[U]=t}const W=[];for(let l=0;l<12;l++)for(let U=0;U<5;U++)W.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);for(let l=12;l<this.goldbergData.faceColors.length;l++)for(let U=0;U<6;U++)W.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);return W}setGoldbergFaceColors(U){const W=this._changeGoldbergFaceColors(U);this.Ga(L.e.ColorKind,W)}updateGoldbergFaceColors(U){const W=this._changeGoldbergFaceColors(U);this.updateVerticesData(L.e.ColorKind,W)}_changeGoldbergFaceUVs(U){const W=this.getVerticesData(L.e.UVKind);for(let l=0;l<U.length;l++){const M=U[l][0],t=U[l][1],L=U[l][2],p=U[l][3],B=U[l][4],k=[],A=[];let q,y;for(let U=0;U<5;U++)q=L.x+p*Math.cos(B+U*Math.PI/2.5),y=L.y+p*Math.sin(B+U*Math.PI/2.5),q<0&&(q=0),q>1&&(q=1),k.push(q,y);for(let U=0;U<6;U++)q=L.x+p*Math.cos(B+U*Math.PI/3),y=L.y+p*Math.sin(B+U*Math.PI/3),q<0&&(q=0),q>1&&(q=1),A.push(q,y);for(let U=M;U<Math.min(12,t+1);U++)for(let l=0;l<5;l++)W[10*U+2*l]=k[2*l],W[10*U+2*l+1]=k[2*l+1];for(let U=Math.max(12,M);U<t+1;U++)for(let l=0;l<6;l++)W[12*U-24+2*l]=A[2*l],W[12*U-23+2*l]=A[2*l+1]}return W}setGoldbergFaceUVs(U){const W=this._changeGoldbergFaceUVs(U);this.Ga(L.e.UVKind,W)}updateGoldbergFaceUVs(U){const W=this._changeGoldbergFaceUVs(U);this.updateVerticesData(L.e.UVKind,W)}placeOnGoldbergFaceAt(U,W,l){const t=M.l.RotationFromAxis(this.goldbergData.faceXaxis[W],this.goldbergData.faceYaxis[W],this.goldbergData.faceZaxis[W]);U.rotation=t,U.position=this.goldbergData.faceCenters[W].add(this.goldbergData.faceXaxis[W].scale(l.x)).add(this.goldbergData.faceYaxis[W].scale(l.y)).add(this.goldbergData.faceZaxis[W].scale(l.z))}serialize(U){super.serialize(U),U.type="GoldbergMesh";const W={};if(W.adjacentFaces=this.goldbergData.adjacentFaces,W.nbSharedFaces=this.goldbergData.nbSharedFaces,W.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,W.nbFaces=this.goldbergData.nbFaces,W.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){W.faceColors=[];for(const U of this.goldbergData.faceColors)W.faceColors.push(U.qk())}if(this.goldbergData.faceCenters){W.faceCenters=[];for(const U of this.goldbergData.faceCenters)W.faceCenters.push(U.qk())}if(this.goldbergData.faceZaxis){W.faceZaxis=[];for(const U of this.goldbergData.faceZaxis)W.faceZaxis.push(U.qk())}if(this.goldbergData.faceYaxis){W.faceYaxis=[];for(const U of this.goldbergData.faceYaxis)W.faceYaxis.push(U.qk())}if(this.goldbergData.faceXaxis){W.faceXaxis=[];for(const U of this.goldbergData.faceXaxis)W.faceXaxis.push(U.qk())}U.goldbergData=W}static Parse(U,W){const l=U.goldbergData;l.faceColors=l.faceColors.map((U=>j.f.gk(U))),l.faceCenters=l.faceCenters.map((U=>M.l.gk(U))),l.faceZaxis=l.faceZaxis.map((U=>M.l.gk(U))),l.faceXaxis=l.faceXaxis.map((U=>M.l.gk(U))),l.faceYaxis=l.faceYaxis.map((U=>M.l.gk(U)));const t=new LU(U.name,W);return t.goldbergData=l,t}}var pU=l(11881);const BU={CreateBox:y.c,CreateTiledBox:r,CreateSphere:m.b,CreateDisc:q.c,CreateIcoSphere:G,CreateRibbon:A,CreateCylinder:Z,CreateTorus:D,CreateTorusKnot:i,CreateLineSystem:O.h,Mk:O.i,CreateDashedLines:O.e,ExtrudeShape:H,ExtrudeShapeCustom:V,CreateLathe:x,CreateTiledPlane:w,Nk:I.d,CreateGround:R.e,CreateTiledGround:R.i,CreateGroundFromHeightMap:R.c,CreatePolygon:e.d,ExtrudePolygon:e.g,CreateTube:F,CreatePolyhedron:J,CreateGeodesic:function(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=W.m||1;M!==Math.floor(M)&&(M=Math.floor(M),T.b.Warn("m not an integer only floor(m) used"));let t=W.n||0;if(t!==Math.floor(t)&&(t=Math.floor(t),T.b.Warn("n not an integer only floor(n) used")),t>M){const U=t;t=M,M=U,T.b.Warn("n > m therefore m and n swapped")}const L=new lU;return L.build(M,t),J(U,{custom:tU.BuildGeodesicData(L),size:W.size,sizeX:W.sizeX,sizeY:W.sizeY,sizeZ:W.sizeZ,faceUV:W.faceUV,faceColors:W.faceColors,flat:W.flat,updatable:W.updatable,sideOrientation:W.sideOrientation,frontUVs:W.frontUVs,backUVs:W.backUVs},l)},CreateGoldberg:function(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=W.size,k=W.sizeX||L||1,A=W.sizeY||L||1,q=W.sizeZ||L||1;let y=W.m||1;y!==Math.floor(y)&&(y=Math.floor(y),T.b.Warn("m not an integer only floor(m) used"));let s=W.n||0;if(s!==Math.floor(s)&&(s=Math.floor(s),T.b.Warn("n not an integer only floor(n) used")),s>y){const U=s;s=y,y=U,T.b.Warn("n > m therefore m and n swapped")}const w=new lU;w.build(y,s);const K=tU.BuildGeodesicData(w),r=K.toGoldbergPolyhedronData(),m=new LU(U,l);W.sideOrientation=t.e._GetDefaultSideOrientation(W.sideOrientation),m._originalBuilderSideOrientation=W.sideOrientation;(function(U,W){const l=U.size,t=U.sizeX||l||1,L=U.sizeY||l||1,k=U.sizeZ||l||1,A=0===U.sideOrientation?0:U.sideOrientation||p.b.DEFAULTSIDE,q=[],y=[],j=[],s=[];let w=1/0,K=-1/0,r=1/0,m=-1/0;for(let M=0;M<W.vertex.length;M++)w=Math.min(w,W.vertex[M][0]*t),K=Math.max(K,W.vertex[M][0]*t),r=Math.min(r,W.vertex[M][1]*L),m=Math.max(m,W.vertex[M][1]*L);let f=0;for(let p=0;p<W.face.length;p++){const U=W.face[p],l=M.l.gk(W.vertex[U[0]]),A=M.l.gk(W.vertex[U[2]]),g=M.l.gk(W.vertex[U[1]]),E=A.de(l),Z=g.de(l),N=M.l.Cross(Z,E).normalize();for(let M=0;M<U.length;M++){j.push(N.x,N.y,N.z);const l=W.vertex[U[M]];q.push(l[0]*t,l[1]*L,l[2]*k);const p=(l[1]*L-r)/(m-r);s.push((l[0]*t-w)/(K-w),B.c?1-p:p)}for(let W=0;W<U.length-2;W++)y.push(f,f+W+2,f+W+1);f+=U.length}p.b._ComputeSides(A,q,y,j,s);const g=new p.b;return g.xa=q,g.indices=y,g.ya=j,g.Aa=s,g})(W,r).Ca(m,W.updatable),m.goldbergData.nbSharedFaces=K.sharedNodes,m.goldbergData.nbUnsharedFaces=K.poleNodes,m.goldbergData.adjacentFaces=K.adjacentFaces,m.goldbergData.nbFaces=m.goldbergData.nbSharedFaces+m.goldbergData.nbUnsharedFaces,m.goldbergData.nbFacesAtPole=(m.goldbergData.nbUnsharedFaces-12)/12;for(let t=0;t<K.vertex.length;t++)m.goldbergData.faceCenters.push(M.l.gk(K.vertex[t])),m.goldbergData.faceCenters[t].x*=k,m.goldbergData.faceCenters[t].y*=A,m.goldbergData.faceCenters[t].z*=q,m.goldbergData.faceColors.push(new j.f(1,1,1,1));for(let t=0;t<r.face.length;t++){const U=r.face[t],W=M.l.gk(r.vertex[U[0]]),l=M.l.gk(r.vertex[U[2]]),L=M.l.gk(r.vertex[U[1]]),p=l.de(W),B=L.de(W),k=M.l.Cross(B,p).normalize(),A=M.l.Cross(B,k).normalize();m.goldbergData.faceXaxis.push(B.normalize()),m.goldbergData.faceYaxis.push(k),m.goldbergData.faceZaxis.push(A)}return m},CreateDecal:a,CreateCapsule:X,CreateText:pU.d}},12290:(U,W,l)=>{"use strict";l.d(W,{b:()=>BW});var M=l(706),t=l(11816);class L extends t.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var p=l(742),B=(l(2126),l(655));class k{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this._targetStopDuration!==U&&(this._targetStopDuration=U)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){this._noiseTexture!==U&&(this._noiseTexture=U,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(U){this._isAnimationSheetEnabled!=U&&(this._isAnimationSheetEnabled=U,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(U){this._useLogarithmicDepth=U&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(U){switch(U){case k.BLENDMODE_MULTIPLYADD:return;case k.BLENDMODE_ADD:U=1;break;case k.BLENDMODE_ONEONE:U=6;break;case k.BLENDMODE_STANDARD:U=2;break;case k.BLENDMODE_MULTIPLY:U=4;break;case k.BLENDMODE_SUBTRACT:U=3}this._engine.setAlphaMode(U)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:M.l.Zero()}set direction1(U){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=U)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:M.l.Zero()}set direction2(U){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=U)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:M.l.Zero()}set minEmitBox(U){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=U)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:M.l.Zero()}set maxEmitBox(U){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=U)}get billboardMode(){return this._billboardMode}set billboardMode(U){this._billboardMode!==U&&(this._billboardMode=U,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(U){this._isBillboardBased!==U&&(this._isBillboardBased=U,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(U){this._attachImageProcessingConfiguration(U)}_attachImageProcessingConfiguration(U){U!==this._imageProcessingConfiguration&&(!U&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=U)}_reset(){}_removeGradientAndTexture(U,W,l){if(!W)return this;let M=0;for(const t of W){if(t.gradient===U){W.splice(M,1);break}M++}return l&&l.dispose(),this}constructor(U){this.animations=[],this.renderingGroupId=0,this.j=M.l.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new M.l(10,10,10),this.onAnimationEnd=null,this.blendMode=k.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new M.h(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Le=new M.l(0,0,0),this._useLogarithmicDepth=!1,this.gravity=M.l.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new p.f(1,1,1,1),this.color2=new p.f(1,1,1,1),this.colorDead=new p.f(0,0,0,1),this.textureMask=new p.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new L,this.id=U,this.name=U}createPointEmitter(U,W){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new M.l(0,1,0),arguments.length>2&&void 0!==arguments[2]||new M.l(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new M.l(0,1,0),arguments.length>4&&void 0!==arguments[4]||new M.l(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new M.l(0,1,0),arguments.length>3&&void 0!==arguments[3]||new M.l(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(U,W,l,M){throw new Error("Method not implemented.")}}k.BLENDMODE_ONEONE=0,k.BLENDMODE_STANDARD=1,k.BLENDMODE_ADD=2,k.BLENDMODE_MULTIPLY=3,k.BLENDMODE_MULTIPLYADD=4,k.BLENDMODE_SUBTRACT=-1,(0,B.f)("BABYLON.BaseParticleSystem",k);var A=l(722),q=l(520);class y{constructor(){this.direction1=new M.l(0,1,0),this.direction2=new M.l(0,1,0),this.minEmitBox=new M.l(-.5,-.5,-.5),this.maxEmitBox=new M.l(.5,.5,.5)}startDirectionFunction(U,W,l,t){const L=(0,A.RandomRange)(this.direction1.x,this.direction2.x),p=(0,A.RandomRange)(this.direction1.y,this.direction2.y),B=(0,A.RandomRange)(this.direction1.z,this.direction2.z);if(t)return W.x=L,W.y=p,void(W.z=B);M.l.TransformNormalFromFloatsToRef(L,p,B,U,W)}startPositionFunction(U,W,l,t){const L=(0,A.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),p=(0,A.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),B=(0,A.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(t)return W.x=L,W.y=p,void(W.z=B);M.l.TransformCoordinatesFromFloatsToRef(L,p,B,U,W)}clone(){const U=new y;return q.b.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2),U.setVector3("minEmitBox",this.minEmitBox),U.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3),U.addUniform("minEmitBox",3),U.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.qk(),U.direction2=this.direction2.qk(),U.minEmitBox=this.minEmitBox.qk(),U.maxEmitBox=this.maxEmitBox.qk(),U}parse(U){M.l.FromArrayToRef(U.direction1,0,this.direction1),M.l.FromArrayToRef(U.direction2,0,this.direction2),M.l.FromArrayToRef(U.minEmitBox,0,this.minEmitBox),M.l.FromArrayToRef(U.maxEmitBox,0,this.maxEmitBox)}}class j{get radius(){return this._radius}set radius(U){this._radius=U,this._buildHeight()}get angle(){return this._angle}set angle(U){this._angle=U,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=l,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=W,this.radius=U}startDirectionFunction(U,W,l,t){t?M.f.ik[0].p(l.vd).normalize():l.position.subtractToRef(U.getTranslation(),M.f.ik[0]).normalize();const L=(0,A.RandomRange)(0,this.directionRandomizer),p=(0,A.RandomRange)(0,this.directionRandomizer),B=(0,A.RandomRange)(0,this.directionRandomizer);W.x=M.f.ik[0].x+L,W.y=M.f.ik[0].y+p,W.z=M.f.ik[0].z+B,W.normalize()}startPositionFunction(U,W,l,t){const L=(0,A.RandomRange)(0,2*Math.PI);let p;this.emitFromSpawnPointOnly?p=1e-4:(p=(0,A.RandomRange)(0,this.heightRange),p=1-p*p);let B=this._radius-(0,A.RandomRange)(0,this._radius*this.radiusRange);B*=p;const k=B*Math.sin(L),q=B*Math.cos(L),y=p*this._height;if(t)return W.x=k,W.y=y,void(W.z=q);M.l.TransformCoordinatesFromFloatsToRef(k,y,q,U,W)}clone(){const U=new j(this._radius,this._angle,this.directionRandomizer);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat2("radius",this._radius,this.radiusRange),U.setFloat("coneAngle",this._angle),U.setFloat2("height",this._height,this.heightRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",2),U.addUniform("coneAngle",1),U.addUniform("height",2),U.addUniform("directionRandomizer",1)}getEffectDefines(){let U="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(U+="\n#define CONEEMITTERSPAWNPOINT"),U}getClassName(){return"ConeParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this._radius,U.angle=this._angle,U.directionRandomizer=this.directionRandomizer,U.radiusRange=this.radiusRange,U.heightRange=this.heightRange,U.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,U}parse(U){this.radius=U.radius,this.angle=U.angle,this.directionRandomizer=U.directionRandomizer,this.radiusRange=void 0!==U.radiusRange?U.radiusRange:1,this.heightRange=void 0!==U.radiusRange?U.heightRange:1,this.emitFromSpawnPointOnly=void 0!==U.emitFromSpawnPointOnly&&U.emitFromSpawnPointOnly}}class s extends j{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0);super(U,W),this.direction1=l,this.direction2=t}startDirectionFunction(U,W){const l=(0,A.RandomRange)(this.direction1.x,this.direction2.x),t=(0,A.RandomRange)(this.direction1.y,this.direction2.y),L=(0,A.RandomRange)(this.direction1.z,this.direction2.z);M.l.TransformNormalFromFloatsToRef(l,t,L,U,W)}clone(){const U=new s(this.radius,this.angle,this.direction1,this.direction2);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.qk(),U.direction2=this.direction2.qk(),U}parse(U){super.parse(U),this.direction1.p(U.direction1),this.direction2.p(U.direction2)}}class w{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=U,this.height=W,this.radiusRange=l,this.directionRandomizer=t,this._tempVector=M.l.Zero()}startDirectionFunction(U,W,l,t,L){l.position.subtractToRef(U.getTranslation(),this._tempVector),this._tempVector.normalize(),M.l.TransformNormalToRef(this._tempVector,L,this._tempVector);const p=(0,A.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let B=Math.atan2(this._tempVector.x,this._tempVector.z);B+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=p,this._tempVector.x=Math.sin(B),this._tempVector.z=Math.cos(B),this._tempVector.normalize(),t?W.p(this._tempVector):M.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U,W)}startPositionFunction(U,W,l,t){const L=(0,A.RandomRange)(-this.height/2,this.height/2),p=(0,A.RandomRange)(0,2*Math.PI),B=(0,A.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),k=Math.sqrt(B)*this.radius,q=k*Math.cos(p),y=k*Math.sin(p);t?W.wd(q,L,y):M.l.TransformCoordinatesFromFloatsToRef(q,L,y,U,W)}clone(){const U=new w(this.radius,this.directionRandomizer);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.height=this.height,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.height=U.height,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class K extends w{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.l(0,1,0);super(U,W,l),this.direction1=t,this.direction2=L}startDirectionFunction(U,W,l,t){const L=(0,A.RandomRange)(this.direction1.x,this.direction2.x),p=(0,A.RandomRange)(this.direction1.y,this.direction2.y),B=(0,A.RandomRange)(this.direction1.z,this.direction2.z);t?W.wd(L,p,B):M.l.TransformNormalFromFloatsToRef(L,p,B,U,W)}clone(){const U=new K(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.qk(),U.direction2=this.direction2.qk(),U}parse(U){super.parse(U),M.l.FromArrayToRef(U.direction1,0,this.direction1),M.l.FromArrayToRef(U.direction2,0,this.direction2)}}class r{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=W,this.directionRandomizer=l}startDirectionFunction(U,W,l,t){const L=l.position.de(U.getTranslation()).normalize(),p=(0,A.RandomRange)(0,this.directionRandomizer),B=(0,A.RandomRange)(0,this.directionRandomizer),k=(0,A.RandomRange)(0,this.directionRandomizer);L.x+=p,L.y+=B,L.z+=k,L.normalize(),t?W.p(L):M.l.TransformNormalFromFloatsToRef(L.x,L.y,L.z,U,W)}startPositionFunction(U,W,l,t){const L=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),p=(0,A.RandomRange)(0,1),B=(0,A.RandomRange)(0,2*Math.PI),k=Math.acos(2*p-1),q=L*Math.cos(B)*Math.sin(k),y=L*Math.cos(k),j=L*Math.sin(B)*Math.sin(k);t?W.wd(q,Math.abs(y),j):M.l.TransformCoordinatesFromFloatsToRef(q,Math.abs(y),j,U,W)}clone(){const U=new r(this.radius,this.directionRandomizer);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class m{constructor(){this.direction1=new M.l(0,1,0),this.direction2=new M.l(0,1,0)}startDirectionFunction(U,W,l,t){const L=(0,A.RandomRange)(this.direction1.x,this.direction2.x),p=(0,A.RandomRange)(this.direction1.y,this.direction2.y),B=(0,A.RandomRange)(this.direction1.z,this.direction2.z);t?W.wd(L,p,B):M.l.TransformNormalFromFloatsToRef(L,p,B,U,W)}startPositionFunction(U,W,l,t){t?W.wd(0,0,0):M.l.TransformCoordinatesFromFloatsToRef(0,0,0,U,W)}clone(){const U=new m;return q.b.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.qk(),U.direction2=this.direction2.qk(),U}parse(U){M.l.FromArrayToRef(U.direction1,0,this.direction1),M.l.FromArrayToRef(U.direction2,0,this.direction2)}}class f{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=W,this.directionRandomizer=l}startDirectionFunction(U,W,l,t){const L=l.position.de(U.getTranslation()).normalize(),p=(0,A.RandomRange)(0,this.directionRandomizer),B=(0,A.RandomRange)(0,this.directionRandomizer),k=(0,A.RandomRange)(0,this.directionRandomizer);L.x+=p,L.y+=B,L.z+=k,L.normalize(),t?W.p(L):M.l.TransformNormalFromFloatsToRef(L.x,L.y,L.z,U,W)}startPositionFunction(U,W,l,t){const L=this.radius-(0,A.RandomRange)(0,this.radius*this.radiusRange),p=(0,A.RandomRange)(0,1),B=(0,A.RandomRange)(0,2*Math.PI),k=Math.acos(2*p-1),q=L*Math.cos(B)*Math.sin(k),y=L*Math.cos(k),j=L*Math.sin(B)*Math.sin(k);t?W.wd(q,y,j):M.l.TransformCoordinatesFromFloatsToRef(q,y,j,U,W)}clone(){const U=new f(this.radius,this.directionRandomizer);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class g extends f{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.l(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0);super(U),this.direction1=W,this.direction2=l}startDirectionFunction(U,W){const l=(0,A.RandomRange)(this.direction1.x,this.direction2.x),t=(0,A.RandomRange)(this.direction1.y,this.direction2.y),L=(0,A.RandomRange)(this.direction1.z,this.direction2.z);M.l.TransformNormalFromFloatsToRef(l,t,L,U,W)}clone(){const U=new g(this.radius,this.direction1,this.direction2);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.qk(),U.direction2=this.direction2.qk(),U}parse(U){super.parse(U),this.direction1.p(U.direction1),this.direction2.p(U.direction2)}}class E{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(U,W,l,t){const L=M.f.ik[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,l,L);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,l,L);const U=M.f.ik[1];L.subtractToRef(l.position,U),U.scaleToRef(1/l.lifeTime,L)}else L.set(0,0,0);t?W.p(L):M.l.TransformNormalToRef(L,U,W)}startPositionFunction(U,W,l,t){const L=M.f.ik[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,l,L):L.set(0,0,0),t?W.p(L):M.l.TransformCoordinatesToRef(L,U,W)}clone(){const U=new E;return q.b.DeepCopy(this,U),U}applyToShader(U){}buildUniformLayout(U){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.particlePositionGenerator=this.particlePositionGenerator,U.particleDestinationGenerator=this.particleDestinationGenerator,U}parse(U){U.particlePositionGenerator&&(this.particlePositionGenerator=U.particlePositionGenerator),U.particleDestinationGenerator&&(this.particleDestinationGenerator=U.particleDestinationGenerator)}}var Z=l(763);class N{get mesh(){return this._mesh}set mesh(U){this._mesh!==U&&(this._mesh=U,U?(this._indices=U.hk(),this._positions=U.getVerticesData(Z.e.PositionKind),this._normals=U.getVerticesData(Z.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=M.l.Zero(),this._mesh=null,this.direction1=new M.l(0,1,0),this.direction2=new M.l(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=U}startDirectionFunction(U,W,l,t){if(this.useMeshNormalsForDirection&&this._normals)return void M.l.TransformNormalToRef(this._storedNormal,U,W);const L=(0,A.RandomRange)(this.direction1.x,this.direction2.x),p=(0,A.RandomRange)(this.direction1.y,this.direction2.y),B=(0,A.RandomRange)(this.direction1.z,this.direction2.z);t?W.wd(L,p,B):M.l.TransformNormalFromFloatsToRef(L,p,B,U,W)}startPositionFunction(U,W,l,t){if(!this._indices||!this._positions)return;const L=3*(Math.random()*(this._indices.length/3)|0),p=Math.random(),B=Math.random()*(1-p),k=1-p-B,A=this._indices[L],q=this._indices[L+1],y=this._indices[L+2],j=M.f.ik[0],s=M.f.ik[1],w=M.f.ik[2],K=M.f.ik[3];M.l.FromArrayToRef(this._positions,3*A,j),M.l.FromArrayToRef(this._positions,3*q,s),M.l.FromArrayToRef(this._positions,3*y,w),K.x=p*j.x+B*s.x+k*w.x,K.y=p*j.y+B*s.y+k*w.y,K.z=p*j.z+B*s.z+k*w.z,t?W.wd(K.x,K.y,K.z):M.l.TransformCoordinatesFromFloatsToRef(K.x,K.y,K.z,U,W),this.useMeshNormalsForDirection&&this._normals&&(M.l.FromArrayToRef(this._normals,3*A,j),M.l.FromArrayToRef(this._normals,3*q,s),M.l.FromArrayToRef(this._normals,3*y,w),this._storedNormal.x=p*j.x+B*s.x+k*w.x,this._storedNormal.y=p*j.y+B*s.y+k*w.y,this._storedNormal.z=p*j.z+B*s.z+k*w.z)}clone(){const U=new N(this.mesh);return q.b.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var U;const W={};return W.type=this.getClassName(),W.direction1=this.direction1.qk(),W.direction2=this.direction2.qk(),W.meshId=null===(U=this.mesh)||void 0===U?void 0:U.id,W.useMeshNormalsForDirection=this.useMeshNormalsForDirection,W}parse(U,W){M.l.FromArrayToRef(U.direction1,0,this.direction1),M.l.FromArrayToRef(U.direction2,0,this.direction2),U.meshId&&W&&(this.mesh=W.getLastMeshById(U.meshId)),this.useMeshNormalsForDirection=U.useMeshNormalsForDirection}}class D{_isUbo(U){return void 0!==U.addUniform}constructor(U){this._isUbo(U)?(this.setMatrix3x3=U.updateMatrix3x3.bind(U),this.setMatrix2x2=U.updateMatrix2x2.bind(U),this.setFloat=U.updateFloat.bind(U),this.setFloat2=U.updateFloat2.bind(U),this.setFloat3=U.updateFloat3.bind(U),this.setFloat4=U.updateFloat4.bind(U),this.setFloatArray=U.updateFloatArray.bind(U),this.setArray=U.updateArray.bind(U),this.setIntArray=U.updateIntArray.bind(U),this.setMatrix=U.wk.bind(U),this.setMatrices=U.updateMatrices.bind(U),this.setVector3=U.updateVector3.bind(U),this.setVector4=U.updateVector4.bind(U),this.setColor3=U.updateColor3.bind(U),this.setColor4=U.updateColor4.bind(U),this.setDirectColor4=U.updateDirectColor4.bind(U),this.setInt=U.updateInt.bind(U),this.setInt2=U.updateInt2.bind(U),this.setInt3=U.updateInt3.bind(U),this.setInt4=U.updateInt4.bind(U)):(this.setMatrix3x3=U.setMatrix3x3.bind(U),this.setMatrix2x2=U.setMatrix2x2.bind(U),this.setFloat=U.setFloat.bind(U),this.setFloat2=U.setFloat2.bind(U),this.setFloat3=U.setFloat3.bind(U),this.setFloat4=U.setFloat4.bind(U),this.setFloatArray=U.setFloatArray.bind(U),this.setArray=U.setArray.bind(U),this.setIntArray=U.setIntArray.bind(U),this.setMatrix=U.setMatrix.bind(U),this.setMatrices=U.setMatrices.bind(U),this.setVector3=U.setVector3.bind(U),this.setVector4=U.setVector4.bind(U),this.setColor3=U.setColor3.bind(U),this.setColor4=U.setColor4.bind(U),this.setDirectColor4=U.setDirectColor4.bind(U),this.setInt=U.setInt.bind(U),this.setInt2=U.setInt2.bind(U),this.setInt3=U.setInt3.bind(U),this.setInt4=U.setInt4.bind(U))}}var o=l(604);const i="gpuUpdateParticlesPixelShader",O="#version 300 es\nvoid main() {discard;}\n";o.d.ShadersStore[i]||(o.d.ShadersStore[i]=O);const e="gpuUpdateParticlesVertexShader",d="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";o.d.ShadersStore[e]||(o.d.ShadersStore[e]=d);(0,B.f)("BABYLON.WebGL2ParticleSystem",class{constructor(U,W){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=U,this._engine=W,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var U;return(null===(U=this._updateEffect)||void 0===U?void 0:U.isReady())??!1}createUpdateBuffer(U){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof E&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=U,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new D(this._updateEffect)}createVertexBuffers(U,W){this._updateVAO.push(this._createUpdateVAO(U)),this._renderVAO.push(this._engine.recordVertexArrayObject(W,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=W}createParticleBuffer(U){return U}bindDrawBuffers(U,W,l){l?this._engine.bindBuffers(this._renderVertexBuffers,l,W):this._engine.bindVertexArrayObject(this._renderVAO[U],null)}preUpdateParticleBuffer(){const U=this._engine;if(this._engine.enableEffect(this._updateEffect),!U.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(U,W,l){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[U],null);const M=this._engine;M.bindTransformFeedbackBuffer(W.getBuffer()),M.setRasterizerState(!1),M.beginTransformFeedback(!0),M.drawArraysType(3,0,l),M.endTransformFeedback(),M.setRasterizerState(!0),M.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let U=0;U<this._updateVAO.length;U++)this._engine.releaseVertexArrayObject(this._updateVAO[U]);this._updateVAO.length=0;for(let U=0;U<this._renderVAO.length;U++)this._engine.releaseVertexArrayObject(this._renderVAO[U]);this._renderVAO.length=0}_createUpdateVAO(U){const W={};W.position=U.createVertexBuffer("position",0,3);let l=3;W.age=U.createVertexBuffer("age",l,1),l+=1,W.size=U.createVertexBuffer("size",l,3),l+=3,W.life=U.createVertexBuffer("life",l,1),l+=1,W.seed=U.createVertexBuffer("seed",l,4),l+=4,W.direction=U.createVertexBuffer("direction",l,3),l+=3,this._parent.particleEmitterType instanceof E&&(W.initialPosition=U.createVertexBuffer("initialPosition",l,3),l+=3),this._parent._colorGradientsTexture||(W.color=U.createVertexBuffer("color",l,4),l+=4),this._parent._isBillboardBased||(W.initialDirection=U.createVertexBuffer("initialDirection",l,3),l+=3),this._parent.noiseTexture&&(W.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",l,3),l+=3,W.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",l,3),l+=3),this._parent._angularSpeedGradientsTexture?(W.angle=U.createVertexBuffer("angle",l,1),l+=1):(W.angle=U.createVertexBuffer("angle",l,2),l+=2),this._parent._isAnimationSheetEnabled&&(W.cellIndex=U.createVertexBuffer("cellIndex",l,1),l+=1,this._parent.spriteRandomStartCell&&(W.cellStartOffset=U.createVertexBuffer("cellStartOffset",l,1),l+=1));const M=this._engine.recordVertexArrayObject(W,null,this._updateEffect);return this._engine.bindArrayBuffer(null),M}});class H{constructor(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,M=arguments.length>3?arguments[3]:void 0;this._engine=U,this._label=M,this._engine._storageBuffers.push(this),this._create(W,l)}_create(U,W){this._bufferSize=U,this._creationFlags=W,this._buffer=this._engine.createStorageBuffer(U,W,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(U,W,l){this._buffer&&this._engine.updateStorageBuffer(this._buffer,U,W,l)}async read(U,W,l,M){return await this._engine.readFromStorageBuffer(this._buffer,U,W,l,M)}dispose(){const U=this._engine._storageBuffers,W=U.indexOf(this);-1!==W&&(U[W]=U[U.length-1],U.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var V=l(686),n=l(688),x=l(734),I=l(2048),R=l(2228),F=l(512),v=l(631),J=l(2153);class Q{constructor(){this._gpuTimeInFrameId=-1,this.counter=new J.d}_addDuration(U,W){U<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==U?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(W,!1),this._gpuTimeInFrameId=U):this.counter.addCount(W,!1))}}var G=l(583);class u{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=U,this._engine=W,this.uniqueId=R.d.UniqueId,W.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Q),this._engine.getCaps().supportComputeShaders?M.bindingsMapping?(this._context=W.createComputeContext(),this._shaderPath=l,this._options={bindingsMapping:{},defines:[],...M}):F.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):F.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(U,W){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const M=this._bindings[U];this._bindings[U]={type:l?0:4,object:W,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!M||M.object!==W||M.type!==this._bindings[U].type)}setStorageTexture(U,W){const l=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==W),this._bindings[U]={type:1,object:W,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setExternalTexture(U,W){const l=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==W),this._bindings[U]={type:6,object:W,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setVideoTexture(U,W){return!!W.externalTexture&&(this.setExternalTexture(U,W.externalTexture),!0)}setUniformBuffer(U,W){const l=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==W),this._bindings[U]={type:u._BufferIsDataBuffer(W)?7:2,object:W,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setStorageBuffer(U,W){const l=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==W),this._bindings[U]={type:u._BufferIsDataBuffer(W)?7:3,object:W,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setTextureSampler(U,W){const l=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!l||!W.compareSampler(l.object)),this._bindings[U]={type:5,object:W,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}isReady(){let U=this._effect;for(const t in this._bindings){const U=this._bindings[t],W=U.type,l=U.object;switch(W){case 0:case 4:case 1:if(!l.isReady())return!1;break;case 6:if(!l.isReady())return!1;break}}const W=[],l=this._shaderPath;if(this._options.defines)for(let t=0;t<this._options.defines.length;t++)W.push(this._options.defines[t]);const M=W.join("\n");return this._cachedDefines!==M&&(this._cachedDefines=M,U=this._engine.createComputeEffect(l,{defines:M,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=U),!!U.isReady()}dispatch(U,W,l){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,U,W,l,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const l=u._BufferIsDataBuffer(U)?U:U.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,l,W,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const W in this._bindings){const l=this._bindings[W];if(!this._options.bindingsMapping[W])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+W+"'");switch(l.type){case 0:{const M=this._samplers[W],t=l.object;var U;if(!M||!t._texture||!M.compareSampler(t._texture))this._samplers[W]=(new v.b).setParameters(t.wrapU,t.wrapV,t.wrapR,t.anisotropicFilteringLevel,t._texture.samplingMode,null===(U=t._texture)||void 0===U?void 0:U._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const U=l.object;U.getBuffer()!==l.buffer&&(l.buffer=U.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((t=>{(0,G.d)((()=>this.dispatch(U,W,l)),t,void 0,M)}))}serialize(){const U=x.e.Serialize(this);U.options=this._options,U.shaderPath=this._shaderPath,U.Ul={},U.textures={};for(const W in this._bindings){const l=this._bindings[W],M=l.object;switch(l.type){case 0:case 4:case 1:{const t=M.serialize();t&&(U.textures[W]=t,U.Ul[W]={type:l.type});break}}}return U}static Parse(U,W,l){const M=x.e.Parse((()=>new u(U.name,W.getEngine(),U.shaderPath,U.options)),U,W,l);for(const t in U.textures){const L=U.Ul[t],p=I.d.Parse(U.textures[t],W,l);0===L.type?M.setTexture(t,p):4===L.type?M.setTexture(t,p,!1):M.setStorageTexture(t,p)}return M}static _BufferIsDataBuffer(U){return void 0!==U.underlyingResource}}(0,V.e)([(0,n.T)()],u.prototype,"name",void 0),(0,V.e)([(0,n.T)()],u.prototype,"fastMode",void 0),(0,B.f)("BABYLON.ComputeShader",u);var b=l(837);const C="gpuUpdateParticlesComputeShader",P="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";o.d.ShadersStoreWGSL[C]||(o.d.ShadersStoreWGSL[C]=P);(0,B.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(U,W){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=U,this._engine=W}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var U;return(null===(U=this._updateComputeShader)||void 0===U?void 0:U.isReady())??!1}createUpdateBuffer(U){var W;const l={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(l.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(l.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(l.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(l.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(l.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(l.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(l.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new u("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:l,defines:U.split("\n")}),null===(W=this._simParamsComputeShader)||void 0===W||W.dispose(),this._simParamsComputeShader=new b.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new D(this._simParamsComputeShader)}createVertexBuffers(U,W){this._renderVertexBuffers.push(W)}createParticleBuffer(U){const W=new H(this._engine,4*U.length,11,"ComputeShaderParticleSystemBuffer");return W.update(U),this._bufferComputeShader.push(W),W.getBuffer()}bindDrawBuffers(U,W,l){this._engine.bindBuffers(this._renderVertexBuffers[U],l,W)}preUpdateParticleBuffer(){}updateParticleBuffer(U,W,l){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[U]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^U]),this._updateComputeShader.dispatch(Math.ceil(l/64))}releaseBuffers(){var U;for(let W=0;W<this._bufferComputeShader.length;++W)this._bufferComputeShader[W].dispose();this._bufferComputeShader.length=0,null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class S{constructor(U,W,l){this.gradient=U,this.color1=W,this.color2=l}getColorToRef(U){this.color2?p.f.LerpToRef(this.color1,this.color2,Math.random(),U):U.p(this.color1)}}class c{constructor(U,W){this.gradient=U,this.color=W}}class h{constructor(U,W,l){this.gradient=U,this.factor1=W,this.factor2=l}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class z{static GetCurrentGradient(U,W,l){if(W[0].gradient>U)return void l(W[0],W[0],1);for(let t=0;t<W.length-1;t++){const M=W[t],L=W[t+1];if(U>=M.gradient&&U<=L.gradient){return void l(M,L,(U-M.gradient)/(L.gradient-M.gradient))}}const M=W.length-1;l(W[M],W[M],1)}}var a=l(496),Y=l(11781),X=l(543);class T{constructor(U){this.particleSystem=U,this.position=M.l.Zero(),this.direction=M.l.Zero(),this.color=new p.f(0,0,0,0),this.colorStep=new p.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new M.h(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new p.f(0,0,0,0),this._currentColor2=new p.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=T._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let U=this.age,W=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===W?(W=1,U=this._randomCellOffset):U+=this._randomCellOffset);const l=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let M;M=this._initialSpriteCellLoop?(0,A.Clamp)(U*W%this.lifeTime/this.lifeTime):(0,A.Clamp)(U*W/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+M*l|0}_inheritParticleInfoToSubEmitter(U){if(U.particleSystem.j.position){const W=U.particleSystem.j;if(W.position.p(this.position),U.inheritDirection){const U=M.f.ik[0];this.direction.normalizeToRef(U),W.setDirection(U,0,Math.PI/2)}}else{U.particleSystem.j.p(this.position)}this.direction.scaleToRef(U.inheritedVelocityAmount/2,M.f.ik[0]),U.particleSystem._inheritedVelocityOffset.p(M.f.ik[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const U of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(U)}_reset(){this.age=0,this.id=T._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(U){U.position.p(this.position),this._initialDirection?U._initialDirection?U._initialDirection.p(this._initialDirection):U._initialDirection=this._initialDirection.clone():U._initialDirection=null,U.direction.p(this.direction),this.vd&&(U.vd?U.vd.p(this.vd):U.vd=this.vd.clone()),U.color.p(this.color),U.colorStep.p(this.colorStep),U.lifeTime=this.lifeTime,U.age=this.age,U._randomCellOffset=this._randomCellOffset,U.size=this.size,U.scale.p(this.scale),U.angle=this.angle,U.angularSpeed=this.angularSpeed,U.particleSystem=this.particleSystem,U.cellIndex=this.cellIndex,U.id=this.id,U._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(U._currentColorGradient=this._currentColorGradient,U._currentColor1.p(this._currentColor1),U._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(U._currentSizeGradient=this._currentSizeGradient,U._currentSize1=this._currentSize1,U._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(U._currentAngularSpeedGradient=this._currentAngularSpeedGradient,U._currentAngularSpeed1=this._currentAngularSpeed1,U._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(U._currentVelocityGradient=this._currentVelocityGradient,U._currentVelocity1=this._currentVelocity1,U._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(U._currentLimitVelocityGradient=this._currentLimitVelocityGradient,U._currentLimitVelocity1=this._currentLimitVelocity1,U._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(U._currentDragGradient=this._currentDragGradient,U._currentDrag1=this._currentDrag1,U._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(U._initialStartSpriteCellId=this._initialStartSpriteCellId,U._initialEndSpriteCellId=this._initialEndSpriteCellId,U._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(U.remapData&&this.remapData?U.remapData.p(this.remapData):U.remapData=new M.p(0,0,0,0)),this._randomNoiseCoordinates1&&(U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),U._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(U._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),U._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}T._Count=0;var UU=l(805),WU=(l(2122),l(868)),lU=l(854),MU=l(2196);function tU(U,W){const l=(0,A.RandomRange)(0,1);p.f.LerpToRef(W.color1,W.color2,l,U.color),W.colorDead.subtractToRef(U.color,W._colorDiff),W._colorDiff.scaleToRef(1/U.lifeTime,U.colorStep)}function LU(U,W){U._currentColorGradient=W._colorGradients[0],U._currentColorGradient.getColorToRef(U.color),U._currentColor1.p(U.color),W._colorGradients.length>1?W._colorGradients[1].getColorToRef(U._currentColor2):U._currentColor2.p(U.color)}function pU(U,W){const l=W._colorGradients;z.GetCurrentGradient(W._ratio,l,((W,l,M)=>{W!==U._currentColorGradient&&(U._currentColor1.p(U._currentColor2),l.getColorToRef(U._currentColor2),U._currentColorGradient=W),p.f.LerpToRef(U._currentColor1,U._currentColor2,M,U.color)}))}function BU(U,W){U.colorStep.scaleToRef(W._scaledUpdateSpeed,W._scaledColorStep),U.color.addInPlace(W._scaledColorStep),U.color.a<0&&(U.color.a=0)}function kU(U,W){z.GetCurrentGradient(W._ratio,W._angularSpeedGradients,((W,l,M)=>{W!==U._currentAngularSpeedGradient&&(U._currentAngularSpeed1=U._currentAngularSpeed2,U._currentAngularSpeed2=l.getFactor(),U._currentAngularSpeedGradient=W),U.angularSpeed=(0,A.Lerp)(U._currentAngularSpeed1,U._currentAngularSpeed2,M)}))}function AU(U,W){U.angle+=U.angularSpeed*W._scaledUpdateSpeed}function qU(U,W){W.particleEmitterType.startDirectionFunction(W._emitterWorldMatrix,U.direction,U,W.isLocal,W._emitterInverseWorldMatrix)}function yU(U,W){W.startDirectionFunction(W._emitterWorldMatrix,U.direction,U,W.isLocal)}function jU(U,W){U._currentVelocityGradient=W._velocityGradients[0],U._currentVelocity1=U._currentVelocityGradient.getFactor(),W._velocityGradients.length>1?U._currentVelocity2=W._velocityGradients[1].getFactor():U._currentVelocity2=U._currentVelocity1}function sU(U,W){U._currentLimitVelocityGradient=W._limitVelocityGradients[0],U._currentLimitVelocity1=U._currentLimitVelocityGradient.getFactor(),W._limitVelocityGradients.length>1?U._currentLimitVelocity2=W._limitVelocityGradients[1].getFactor():U._currentLimitVelocity2=U._currentLimitVelocity1}function wU(U,W){z.GetCurrentGradient(W._ratio,W._velocityGradients,((l,M,t)=>{l!==U._currentVelocityGradient&&(U._currentVelocity1=U._currentVelocity2,U._currentVelocity2=M.getFactor(),U._currentVelocityGradient=l),W._directionScale*=(0,A.Lerp)(U._currentVelocity1,U._currentVelocity2,t)}))}function KU(U,W){z.GetCurrentGradient(W._ratio,W._limitVelocityGradients,((l,M,t)=>{l!==U._currentLimitVelocityGradient&&(U._currentLimitVelocity1=U._currentLimitVelocity2,U._currentLimitVelocity2=M.getFactor(),U._currentLimitVelocityGradient=l);const L=(0,A.Lerp)(U._currentLimitVelocity1,U._currentLimitVelocity2,t);U.direction.length()>L&&U.direction.scaleInPlace(W.limitVelocityDamping)}))}function rU(U,W){U.direction.scaleToRef(W._directionScale,W._scaledDirection)}function mU(U,W){W.particleEmitterType.startPositionFunction(W._emitterWorldMatrix,U.position,U,W.isLocal)}function fU(U,W){W.startPositionFunction(W._emitterWorldMatrix,U.position,U,W.isLocal)}function gU(U,W){U.vd?U.vd.p(U.position):U.vd=U.position.clone(),M.l.TransformCoordinatesToRef(U.vd,W._emitterWorldMatrix,U.position)}function EU(U,W){W.isLocal&&U.vd?(U.vd.addInPlace(W._scaledDirection),M.l.TransformCoordinatesToRef(U.vd,W._emitterWorldMatrix,U.position)):U.position.addInPlace(W._scaledDirection)}function ZU(U,W){U._currentDragGradient=W._dragGradients[0],U._currentDrag1=U._currentDragGradient.getFactor(),W._dragGradients.length>1?U._currentDrag2=W._dragGradients[1].getFactor():U._currentDrag2=U._currentDrag1}function NU(U,W){z.GetCurrentGradient(W._ratio,W._dragGradients,((l,M,t)=>{l!==U._currentDragGradient&&(U._currentDrag1=U._currentDrag2,U._currentDrag2=M.getFactor(),U._currentDragGradient=l);const L=(0,A.Lerp)(U._currentDrag1,U._currentDrag2,t);W._scaledDirection.scaleInPlace(1-L)}))}function DU(U,W){U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.wd(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2.wd(Math.random(),Math.random(),Math.random())):(U._randomNoiseCoordinates1=new M.l(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2=new M.l(Math.random(),Math.random(),Math.random()))}function oU(U,W){const l=W._noiseTextureData,t=W._noiseTextureSize;if(l&&t&&U._randomNoiseCoordinates1){const L=W._fetchR(U._randomNoiseCoordinates1.x,U._randomNoiseCoordinates1.y,t.width,t.height,l),p=W._fetchR(U._randomNoiseCoordinates1.z,U._randomNoiseCoordinates2.x,t.width,t.height,l),B=W._fetchR(U._randomNoiseCoordinates2.y,U._randomNoiseCoordinates2.z,t.width,t.height,l),k=M.f.ik[0],A=M.f.ik[1];k.wd((2*L-1)*W.noiseStrength.x,(2*p-1)*W.noiseStrength.y,(2*B-1)*W.noiseStrength.z),k.scaleToRef(W._tempScaledUpdateSpeed,A),U.direction.addInPlace(A)}}function iU(U,W){W.gravity.scaleToRef(W._tempScaledUpdateSpeed,W._scaledGravity),U.direction.addInPlace(W._scaledGravity)}function OU(U,W){U.size=(0,A.RandomRange)(W.minSize,W.maxSize),U.scale.wd((0,A.RandomRange)(W.minScaleX,W.maxScaleX),(0,A.RandomRange)(W.minScaleY,W.maxScaleY))}function eU(U,W){U._currentSizeGradient=W._sizeGradients[0],U._currentSize1=U._currentSizeGradient.getFactor(),U.size=U._currentSize1,W._sizeGradients.length>1?U._currentSize2=W._sizeGradients[1].getFactor():U._currentSize2=U._currentSize1,U.scale.wd((0,A.RandomRange)(W.minScaleX,W.maxScaleX),(0,A.RandomRange)(W.minScaleY,W.maxScaleY))}function dU(U,W){const l=W._actualFrame/W.targetStopDuration;z.GetCurrentGradient(l,W._startSizeGradients,((l,M,t)=>{l!==W._currentStartSizeGradient&&(W._currentStartSize1=W._currentStartSize2,W._currentStartSize2=M.getFactor(),W._currentStartSizeGradient=l);const L=(0,A.Lerp)(W._currentStartSize1,W._currentStartSize2,t);U.scale.scaleInPlace(L)}))}function HU(U,W){z.GetCurrentGradient(W._ratio,W._sizeGradients,((W,l,M)=>{W!==U._currentSizeGradient&&(U._currentSize1=U._currentSize2,U._currentSize2=l.getFactor(),U._currentSizeGradient=W),U.size=(0,A.Lerp)(U._currentSize1,U._currentSize2,M)}))}function VU(U,W){U.remapData=new M.p(0,1,0,1)}function nU(U,W){W._colorRemapGradients&&W._colorRemapGradients.length>0&&z.GetCurrentGradient(W._ratio,W._colorRemapGradients,((W,l,M)=>{const t=(0,A.Lerp)(W.factor1,l.factor1,M),L=(0,A.Lerp)(W.factor2,l.factor2,M);U.remapData.x=t,U.remapData.y=L-t})),W._alphaRemapGradients&&W._alphaRemapGradients.length>0&&z.GetCurrentGradient(W._ratio,W._alphaRemapGradients,((W,l,M)=>{const t=(0,A.Lerp)(W.factor1,l.factor1,M),L=(0,A.Lerp)(W.factor2,l.factor2,M);U.remapData.z=t,U.remapData.w=L-t}))}function xU(U,W){const l=(0,A.Clamp)(W._actualFrame/W.targetStopDuration);z.GetCurrentGradient(l,W._lifeTimeGradients,((W,M)=>{const t=W,L=M,p=t.getFactor(),B=L.getFactor(),k=(l-t.gradient)/(L.gradient-t.gradient);U.lifeTime=(0,A.Lerp)(p,B,k)})),W._emitPower=(0,A.RandomRange)(W.minEmitPower,W.maxEmitPower)}function IU(U,W){U.lifeTime=(0,A.RandomRange)(W.minLifeTime,W.maxLifeTime),W._emitPower=(0,A.RandomRange)(W.minEmitPower,W.maxEmitPower)}function RU(U,W){0===W._emitPower?(U._initialDirection?U._initialDirection.p(U.direction):U._initialDirection=U.direction.clone(),U.direction.set(0,0,0)):(U._initialDirection=null,U.direction.scaleInPlace(W._emitPower)),U.direction.addInPlace(W._inheritedVelocityOffset)}function FU(U,W){U.angularSpeed=(0,A.RandomRange)(W.minAngularSpeed,W.maxAngularSpeed),U.angle=(0,A.RandomRange)(W.minInitialRotation,W.maxInitialRotation)}function vU(U,W){U._currentAngularSpeedGradient=W._angularSpeedGradients[0],U.angularSpeed=U._currentAngularSpeedGradient.getFactor(),U._currentAngularSpeed1=U.angularSpeed,W._angularSpeedGradients.length>1?U._currentAngularSpeed2=W._angularSpeedGradients[1].getFactor():U._currentAngularSpeed2=U._currentAngularSpeed1,U.angle=(0,A.RandomRange)(W.minInitialRotation,W.maxInitialRotation)}function JU(U,W){U._initialStartSpriteCellId=W.startSpriteCellID,U._initialEndSpriteCellId=W.endSpriteCellID,U._initialSpriteCellLoop=W.spriteCellLoop}function QU(U,W){U.previousItem=W.previousItem,U.nextItem=W,W.previousItem&&(W.previousItem.nextItem=U),W.previousItem=U}function GU(U,W){U.previousItem=W,U.nextItem=W.nextItem,W.nextItem&&(W.nextItem.previousItem=U),W.nextItem=U}function uU(U,W){let l=W;for(;l.nextItem;)l=l.nextItem;U.previousItem=l,U.nextItem=l.nextItem,l.nextItem=U}function bU(U){U.previousItem&&(U.previousItem.nextItem=U.nextItem),U.nextItem&&(U.nextItem.previousItem=U.previousItem)}class CU extends k{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(U){this._startDirectionFunction!==U&&(this._startDirectionFunction=U,this._directionProcessing.process=U?yU:qU)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(U){this._startPositionFunction!==U&&(this._startPositionFunction=U,this._positionCreation.process=U?fU:mU)}set onDispose(U){this._onDisposeObserver&&this.nk.remove(this._onDisposeObserver),this._onDisposeObserver=this.nk.add(U)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(U){this._useRampGradients!==U&&(this._useRampGradients=U,this._resetEffect(),U?(this._rampCreation={process:VU,previousItem:null,nextItem:null},GU(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:nU,previousItem:null,nextItem:null},GU(this._remapGradientProcessing,this._gravityProcessing)):(bU(this._rampCreation),bU(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(U){this._isLocal!==U&&(this._isLocal=U,U?(this._isLocalCreation={process:gU,previousItem:null,nextItem:null},GU(this._isLocalCreation,this._positionCreation)):bU(this._isLocalCreation))}get particles(){return this.Pl}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U,U?(this._sheetCreation={process:JU,previousItem:null,nextItem:null},GU(this._sheetCreation,this._colorCreation)):bU(this._sheetCreation),this._reset())}getActiveCount(){return this.Pl.length}getClassName(){return"Uk"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var U;let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(U=this._customWrappers[W])||void 0===U?void 0:U.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[U]??this._customWrappers[0]}setCustomEffect(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[W]=new UU.e(this._engine),this._customWrappers[W].effect=U,this._customWrappers[W].drawContext&&(this._customWrappers[W].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){if(this.noiseTexture!==U){if(this._noiseTexture=U,!U)return bU(this._noiseCreation),void bU(this._noiseProcessing);this._noiseCreation={process:DU,previousItem:null,nextItem:null},GU(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:oU,previousItem:null,nextItem:null},GU(this._noiseProcessing,this._positionProcessing)}}constructor(U,W,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(U),this._emitterInverseWorldMatrix=M.c.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new M.l,this.nk=new a.b,this.onStoppedObservable=new a.b,this.onStartedObservable=new a.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Pl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new p.f(0,0,0,0),this._colorDiff=new p.f(0,0,0,0),this._scaledDirection=M.l.Zero(),this._scaledGravity=M.l.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=U=>{},this.recycleParticle=U=>{const W=this.Pl.pop();W!==U&&W.copyTo(U),this._stockParticles.push(W)},this._createParticle=()=>{let U;return 0!==this._stockParticles.length?(U=this._stockParticles.pop(),U._reset()):U=new T(this),this._prepareParticle(U),U},this.paused=!1,this._shadersLoaded=!1,this._capacity=W,this._epsilon=B,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=M.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||X.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Fk.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:IU,previousItem:null,nextItem:null},this._positionCreation={process:mU,previousItem:null,nextItem:null},GU(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:qU,previousItem:null,nextItem:null},GU(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:RU,previousItem:null,nextItem:null},GU(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:OU,previousItem:null,nextItem:null},GU(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:FU,previousItem:null,nextItem:null},GU(this._angleCreation,this._sizeCreation),this._colorCreation={process:tU,previousItem:null,nextItem:null},GU(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,k||(this._colorProcessing={process:BU,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:AU,previousItem:null,nextItem:null},GU(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:rU,previousItem:null,nextItem:null},GU(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:EU,previousItem:null,nextItem:null},GU(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:iU,previousItem:null,nextItem:null},GU(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=L,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new UU.e(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new y,this.updateFunction=U=>{var W;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(W=this.noiseTexture.getContent())||void 0===W||W.then((U=>{this._noiseTextureData=U})));const l=U===this.Pl;for(let M=0;M<U.length;M++){const W=U[M];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const t=W.age;if(W.age+=this._tempScaledUpdateSpeed,W.age>W.lifeTime){const U=W.age-t,l=W.lifeTime-t;this._tempScaledUpdateSpeed=l*this._tempScaledUpdateSpeed/U,W.age=W.lifeTime}this._ratio=W.age/W.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let L=this._updateQueueStart;for(;L;)L.process(W,this),L=L.nextItem;if(this._isAnimationSheetEnabled&&!k&&W.updateCellIndex(),W._inheritParticleInfoToSubEmitters(),W.age>=W.lifeTime){if(this._emitFromParticle(W),W._attachedSubEmitters){for(const U of W._attachedSubEmitters)U.particleSystem.disposeOnStop=!0,U.particleSystem.stop();W._attachedSubEmitters=null}this.recycleParticle(W),l&&M--}else;}}}serialize(U){throw new Error("Method not implemented.")}clone(U,W){throw new Error("Method not implemented.")}_addFactorGradient(U,W,l,M){const t=new h(W,l,M);U.push(t),U.sort(((U,W)=>U.gradient<W.gradient?-1:U.gradient>W.gradient?1:0))}_removeFactorGradient(U,W){if(!U)return;let l=0;for(const M of U){if(M.gradient===W){U.splice(l,1);break}l++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=xU:this._lifeTimeCreation.process=IU}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:dU,previousItem:null,nextItem:null},GU(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(bU(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this.targetStopDuration!==U&&(this._targetStopDuration=U,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(U,W,l){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,U,W,l),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(U){return this._removeFactorGradient(this._lifeTimeGradients,U),this._syncLifeTimeCreation(),this}addSizeGradient(U,W,l){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=eU,this._sizeGradientProcessing={process:HU,previousItem:null,nextItem:null},QU(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,U,W,l),this}removeSizeGradient(U){var W;return this._removeFactorGradient(this._sizeGradients,U),0===(null===(W=this._sizeGradients)||void 0===W?void 0:W.length)&&(bU(this._sizeGradientProcessing),this._sizeCreation.process=OU),this}addColorRemapGradient(U,W,l){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,U,W,l),this}removeColorRemapGradient(U){return this._removeFactorGradient(this._colorRemapGradients,U),this}addAlphaRemapGradient(U,W,l){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,U,W,l),this}removeAlphaRemapGradient(U){return this._removeFactorGradient(this._alphaRemapGradients,U),this}addAngularSpeedGradient(U,W,l){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=vU,this._angularSpeedGradientProcessing={process:kU,previousItem:null,nextItem:null},QU(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,U,W,l),this}removeAngularSpeedGradient(U){var W;return this._removeFactorGradient(this._angularSpeedGradients,U),0===(null===(W=this._angularSpeedGradients)||void 0===W?void 0:W.length)&&(this._angleCreation.process=FU,bU(this._angularSpeedGradientProcessing)),this}addVelocityGradient(U,W,l){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:jU,previousItem:null,nextItem:null},GU(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:wU,previousItem:null,nextItem:null},QU(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,U,W,l),this}removeVelocityGradient(U){var W;return this._removeFactorGradient(this._velocityGradients,U),0===(null===(W=this._velocityGradients)||void 0===W?void 0:W.length)&&(bU(this._velocityCreation),bU(this._velocityGradientProcessing)),this}addLimitVelocityGradient(U,W,l){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:sU,previousItem:null,nextItem:null},GU(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:KU,previousItem:null,nextItem:null},GU(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,U,W,l),this}removeLimitVelocityGradient(U){var W;return this._removeFactorGradient(this._limitVelocityGradients,U),0===(null===(W=this._limitVelocityGradients)||void 0===W?void 0:W.length)&&(bU(this._limitVelocityCreation),bU(this._limitVelocityGradientProcessing)),this}addDragGradient(U,W,l){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:ZU,previousItem:null,nextItem:null},QU(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:NU,previousItem:null,nextItem:null},QU(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,U,W,l),this}removeDragGradient(U){var W;return this._removeFactorGradient(this._dragGradients,U),0===(null===(W=this._dragGradients)||void 0===W?void 0:W.length)&&(bU(this._dragCreation),bU(this._dragGradientProcessing)),this}addEmitRateGradient(U,W,l){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,U,W,l),this}removeEmitRateGradient(U){return this._removeFactorGradient(this._emitRateGradients,U),this}addStartSizeGradient(U,W,l){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,U,W,l),this._syncStartSizeCreation(),this}removeStartSizeGradient(U){return this._removeFactorGradient(this._startSizeGradients,U),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const U=new Uint8Array(4*this._rawTextureWidth),W=p.h.zk[0];for(let l=0;l<this._rawTextureWidth;l++){const M=l/this._rawTextureWidth;z.GetCurrentGradient(M,this._rampGradients,((M,t,L)=>{p.e.LerpToRef(M.color,t.color,L,W),U[4*l]=255*W.r,U[4*l+1]=255*W.g,U[4*l+2]=255*W.b,U[4*l+3]=255}))}this._rampGradientsTexture=Y.e.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((U,W)=>U.gradient<W.gradient?-1:U.gradient>W.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(U,W){this._rampGradients||(this._rampGradients=[]);const l=new c(U,W);return this._rampGradients.push(l),this._syncRampGradientTexture(),this}removeRampGradient(U){return this._removeGradientAndTexture(U,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(U,W,l){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=LU,this._colorProcessing.process=pU);const M=new S(U,W,l);return this._colorGradients.push(M),this._colorGradients.sort(((U,W)=>U.gradient<W.gradient?-1:U.gradient>W.gradient?1:0)),this}removeColorGradient(U){if(!this._colorGradients)return this;let W=0;for(const l of this._colorGradients){if(l.gradient===U){this._colorGradients.splice(W,1);break}W++}return 0===this._colorGradients.length&&(this._colorCreation.process=tU,this._colorProcessing.process=BU),this}resetDrawCache(){if(this._drawWrappers){for(const U of this._drawWrappers)if(U)for(const W of U)null===W||void 0===W||W.dispose();this._drawWrappers=[]}}_fetchR(U,W,l,M,t){return t[4*(((U=.5*Math.abs(U)+.5)*l%l|0)+((W=.5*Math.abs(W)+.5)*M%M|0)*l)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const U=this._engine,W=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*W),this._vertexBuffer=new Z.b(U,this._vertexData,!0,W);let l=0;const M=this._vertexBuffer.createVertexBuffer(Z.e.PositionKind,l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.e.PositionKind]=M,l+=3;const t=this._vertexBuffer.createVertexBuffer(Z.e.ColorKind,l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.e.ColorKind]=t,l+=4;const L=this._vertexBuffer.createVertexBuffer("angle",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=L,l+=1;const p=this._vertexBuffer.createVertexBuffer("size",l,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=p,l+=2,this._isAnimationSheetEnabled){const U=this._vertexBuffer.createVertexBuffer("cellIndex",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=U,l+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const U=this._vertexBuffer.createVertexBuffer("direction",l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=U,l+=3}if(this._useRampGradients){const U=this._vertexBuffer.createVertexBuffer("remapData",l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=U,l+=4}let B;if(this._useInstancing){const W=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Z.b(U,W,!1,2),B=this._spriteBuffer.createVertexBuffer("offset",0,2)}else B=this._vertexBuffer.createVertexBuffer("offset",l,2,this._vertexBufferSize,this._useInstancing),l+=2;this._vertexBuffers.offset=B,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const U=[],W=[];let l=0;for(let M=0;M<this._capacity;M++)U.push(l),U.push(l+1),U.push(l+2),U.push(l),U.push(l+2),U.push(l+3),W.push(l,l+1,l+1,l+2,l+2,l+3,l+3,l,l,l+3),l+=4;this._indexBuffer=this._engine.createIndexBuffer(U),this._linesIndexBuffer=this._engine.createIndexBuffer(W)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(U)setTimeout((()=>{this.start(0)}),U);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var W;-1!==(null===(W=this.j)||void 0===W?void 0:W.getClassName().indexOf("Mesh"))&&this.j.fk(!0);const U=this.noiseTexture;if(U&&U.onGeneratedObservable)U.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let W=0;W<this.preWarmCycles;W++)this.animate(!0),U.render()}))}));else for(let W=0;W<this.preWarmCycles;W++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(U))}_postStop(U){}reset(){this._stockParticles.length=0,this.Pl.length=0}_appendParticleVertex(U,W,l,t){let L=U*this._vertexBufferSize;if(this._vertexData[L++]=W.position.x+this.Le.x,this._vertexData[L++]=W.position.y+this.Le.y,this._vertexData[L++]=W.position.z+this.Le.z,this._vertexData[L++]=W.color.r,this._vertexData[L++]=W.color.g,this._vertexData[L++]=W.color.b,this._vertexData[L++]=W.color.a,this._vertexData[L++]=W.angle,this._vertexData[L++]=W.scale.x*W.size,this._vertexData[L++]=W.scale.y*W.size,this._isAnimationSheetEnabled&&(this._vertexData[L++]=W.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[L++]=W.direction.x,this._vertexData[L++]=W.direction.y,this._vertexData[L++]=W.direction.z);else if(W._initialDirection){let U=W._initialDirection;this.isLocal&&(M.l.TransformNormalToRef(U,this._emitterWorldMatrix,M.f.ik[0]),U=M.f.ik[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[L++]=U.x,this._vertexData[L++]=U.y,this._vertexData[L++]=U.z}else{let U=W.direction;this.isLocal&&(M.l.TransformNormalToRef(U,this._emitterWorldMatrix,M.f.ik[0]),U=M.f.ik[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[L++]=U.x,this._vertexData[L++]=U.y,this._vertexData[L++]=U.z}this._useRampGradients&&W.remapData&&(this._vertexData[L++]=W.remapData.x,this._vertexData[L++]=W.remapData.y,this._vertexData[L++]=W.remapData.z,this._vertexData[L++]=W.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===l?l=this._epsilon:1===l&&(l=1-this._epsilon),0===t?t=this._epsilon:1===t&&(t=1-this._epsilon)),this._vertexData[L++]=l,this._vertexData[L++]=t)}_prepareParticle(U){}_createNewOnes(U){let W;for(let l=0;l<U&&this.Pl.length!==this._capacity;l++){W=this._createParticle(),this.Pl.push(W);let U=this._createQueueStart;for(;U;)U.process(W,this),U=U.nextItem;W._inheritParticleInfoToSubEmitters()}}_update(U){if(this._alive=this.Pl.length>0,this.j.position){const U=this.j;this._emitterWorldMatrix=U.getWorldMatrix()}else{const U=this.j;this._emitterWorldMatrix=M.c.Translation(U.x,U.y,U.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Pl),this._createNewOnes(U)}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M=[Z.e.PositionKind,Z.e.ColorKind,"angle","offset","size"];return U&&M.push("cellIndex"),W||M.push("direction"),l&&M.push("remapData"),M}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,WU.c)(M),U&&M.push("particlesInfos"),W&&M.push("logarithmicDepthConstant"),l&&(M.push("vFogInfos"),M.push("vFogColor")),M}fillDefines(U,W){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,WU.m)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&U.push("#define FOG")),this._isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),W===k.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&U.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case 2:U.push("#define BILLBOARDY");break;case 8:case 9:U.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&U.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:U.push("#define BILLBOARDMODE_ALL")}l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,W,l){W.push(...CU._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),U.push(...CU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,MU.g)(U,this._imageProcessingConfigurationDefines),(0,MU.d)(l,this._imageProcessingConfigurationDefines))}_getWrapper(U){const W=this._getCustomDrawWrapper(U);if(null!==W&&void 0!==W&&W.effect)return W;const l=[];this.fillDefines(l,U);const M=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let t=this._drawWrappers[M];t||(t=this._drawWrappers[M]=[]);let L=t[U];L||(L=new UU.e(this._engine),L.drawContext&&(L.drawContext.useInstancing=this._useInstancing),t[U]=L);const p=l.join("\n");if(L.defines!==p){const U=[],W=[],l=[];this.fillUniformsAttributesAndSamplerNames(W,U,l),L.setEffect(this._engine.createEffect("particles",U,W,l,p,void 0,void 0,void 0,void 0,this._shaderLanguage),p)}return L}animate(){var U;let W,l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!l&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(l?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this.manualEmitCount>-1)W=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let U=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const W=this._actualFrame/this.targetStopDuration;z.GetCurrentGradient(W,this._emitRateGradients,((W,l,M)=>{W!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=l.getFactor(),this._currentEmitRateGradient=W),U=(0,A.Lerp)(this._currentEmitRate1,this._currentEmitRate2,M)}))}W=U*this._scaledUpdateSpeed|0,this._newPartsExcess+=U*this._scaledUpdateSpeed-W}if(this._newPartsExcess>1&&(W+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?W=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(W),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!l){let U=0;for(let W=0;W<this.Pl.length;W++){const l=this.Pl[W];this._appendParticleVertices(U,l),U+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Pl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(U,W){this._appendParticleVertex(U++,W,0,0),this._useInstancing||(this._appendParticleVertex(U++,W,1,0),this._appendParticleVertex(U++,W,1,1),this._appendParticleVertex(U++,W,0,1))}rebuild(){var U;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(U=this._spriteBuffer)||void 0===U||U._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!CU.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(l.bind(l,12486)),Promise.resolve().then(l.bind(l,12421))])):await Promise.all([Promise.resolve().then(l.bind(l,12409)),Promise.resolve().then(l.bind(l,12401))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==k.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(k.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(k.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(U){const W=this._getWrapper(U),l=W.effect,t=this._engine;t.enableEffect(W);const L=this.defaultViewMatrix??this._scene.getViewMatrix();if(l.setTexture("diffuseSampler",this.particleTexture),l.setMatrix("view",L),l.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();l.setFloat3("particlesInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,this.spriteCellWidth/U.width)}if(l.setVector2("translationPivot",this.translationPivot),l.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;l.setVector3("eyePosition",U.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),l.setTexture("rampSampler",this._rampGradientsTexture));const p=l.defines;var B,k,A,q,y,j;(this._scene&&((0,WU.g)(l,this,this._scene),this.applyFog&&(0,lU.g)(this._scene,void 0,l)),p.indexOf("#define BILLBOARDMODE_ALL")>=0&&(L.invertToRef(M.f.Matrix[0]),l.setMatrix("invView",M.f.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?t.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,l):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,l)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?t.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBuffer:this._indexBuffer,l):t.bindBuffers(this._vertexBuffers,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null,l);(this.useLogarithmicDepth&&this._scene&&(0,lU.n)(p,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),this._setEngineBasedOnBlendMode(U),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),this._useInstancing)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?t.drawElementsType(6,0,10,this.Pl.length):t.drawArraysType(7,0,4,this.Pl.length):null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?t.drawElementsType(1,0,10*this.Pl.length):t.drawElementsType(0,0,6*this.Pl.length);return this.Pl.length}render(){if(!this.isReady()||!this.Pl.length)return 0;const U=this._engine;U.setState&&(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0));let W=0;return W=this.blendMode===k.BLENDMODE_MULTIPLYADD?this._render(k.BLENDMODE_MULTIPLY)+this._render(k.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),W}_onDispose(){}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(W,l),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const U=this._scene.Fk.indexOf(this);U>-1&&this._scene.Fk.splice(U,1),this._scene._activeParticleSystems.dispose()}this.nk.notifyObservers(this),this.nk.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}CU.ForceGLSL=!1;var PU,SU=l(533);!function(U){U[U.ATTACHED=0]="ATTACHED",U[U.END=1]="END"}(PU||(PU={}));class cU{constructor(U){if(this.particleSystem=U,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!U.j||!U.j.dispose){const W=(0,B.d)("BABYLON.AbstractMesh");U.j=new W("SubemitterSystemEmitter",U.va()),U._disposeEmitterOnDispose=!0}}clone(){let U=this.particleSystem.j;if(U){if(U instanceof M.l)U=U.clone();else if(-1!==U.getClassName().indexOf("Mesh")){U=new((0,B.d)("BABYLON.Mesh"))("",U.va()),U.isVisible=!1}}else U=new M.l;const W=new cU(this.particleSystem.clone(this.particleSystem.name,U));return W.particleSystem.name+="Clone",W.type=this.type,W.inheritDirection=this.inheritDirection,W.inheritedVelocityAmount=this.inheritedVelocityAmount,W.particleSystem._disposeEmitterOnDispose=!0,W.particleSystem.disposeOnStop=!0,W}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const W={};return W.type=this.type,W.inheritDirection=this.inheritDirection,W.inheritedVelocityAmount=this.inheritedVelocityAmount,W.particleSystem=this.particleSystem.serialize(U),W}static _ParseParticleSystem(U,W,l){throw(0,SU.d)("ParseParticle")}static Parse(U,W,l){const M=U.particleSystem,t=new cU(cU._ParseParticleSystem(M,W,l,!0));return t.type=U.type,t.inheritDirection=U.inheritDirection,t.inheritedVelocityAmount=U.inheritedVelocityAmount,t.particleSystem._isSubEmitter=!0,t}dispose(){this.particleSystem.dispose()}}var hU=l(592);function zU(U,W){const l=new m;return l.direction1=U,l.direction2=W,l}function aU(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function YU(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function XU(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.l(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0);return new g(U,W,l)}function TU(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function UW(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.l(0,1,0);return new K(U,W,l,t,L)}function WW(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new j(U,W)}function lW(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0);return new s(U,W,l,t)}const MW=M.l.Zero(),tW=M.l.Zero(),LW=M.l.Zero();class pW{constructor(){this.strength=0,this.position=M.l.Zero()}_processParticle(U,W){this.position.subtractToRef(U.position,MW);const l=MW.lengthSquared()+1;MW.normalize().scaleToRef(this.strength/l,tW),tW.scaleToRef(W._tempScaledUpdateSpeed,LW),U.direction.addInPlace(LW)}serialize(){return{position:this.position.qk(),strength:this.strength}}}class BW extends CU{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=U=>{if(!this._subEmitters||0===this._subEmitters.length)return;const W=Math.floor(Math.random()*this._subEmitters.length);for(const l of this._subEmitters[W])if(1===l.type){const W=l.clone();U._inheritParticleInfoToSubEmitter(W),W.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(W.particleSystem),W.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(U,W){const l=zU(U,W);return this.particleEmitterType=l,l}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U,this._flowMapUpdate&&(bU(this._flowMapUpdate),this._flowMapUpdate=null),U&&(this._flowMapUpdate={process:U=>{var W;const l=null===(W=this.va())||void 0===W?void 0:W.getTransformMatrix();this._flowMap._processParticle(U,this.flowMapStrength*this._tempScaledUpdateSpeed,l)},previousItem:null,nextItem:null},GU(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(U){this._attractors.push(U),1===this._attractors.length&&(this._attractorUpdate={process:U=>{for(const W of this._attractors)W._processParticle(U,this)},previousItem:null,nextItem:null},GU(this._attractorUpdate,this._directionProcessing))}removeAttractor(U){const W=this._attractors.indexOf(U);-1!==W&&this._attractors.splice(W,1),0===this._attractors.length&&bU(this._attractorUpdate)}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(U)}createHemisphericEmitter(){const U=aU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=YU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=XU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=TU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=UW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.l(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=WW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=lW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,W,l,M){const t=new y;return this.particleEmitterType=t,this.direction1=U,this.direction2=W,this.minEmitBox=l,this.maxEmitBox=M,t}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const U of this.subEmitters)U instanceof BW?this._subEmitters.push([new cU(U)]):U instanceof cU?this._subEmitters.push([U]):U instanceof Array&&this._subEmitters.push(U)}_stopSubEmitters(){if(this.activeSubSystems){for(const U of this.activeSubSystems)U.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const U=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==U&&this._rootParticleSystem.activeSubSystems.splice(U,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(U){U&&this._stopSubEmitters()}_prepareParticle(U){if(this._subEmitters&&this._subEmitters.length>0){const W=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];U._attachedSubEmitters=[];for(const l of W)if(0===l.type){const W=l.clone();U._attachedSubEmitters.push(W),W.particleSystem.start()}}}_onDispose(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),U&&this.particles)for(const l of this.particles)if(l._attachedSubEmitters)for(let U=l._attachedSubEmitters.length-1;U>=0;U-=1)l._attachedSubEmitters[U].dispose();if(W&&this.activeSubSystems)for(let l=this.activeSubSystems.length-1;l>=0;l-=1)this.activeSubSystems[l].dispose();if(this._subEmitters&&this._subEmitters.length){for(let U=0;U<this._subEmitters.length;U++)for(const W of this._subEmitters[U])W.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(U,W,l,t){let L;L=l instanceof hU.d?null:l;const k=(0,B.d)("BABYLON.Texture");if(k&&L&&(U.texture?W.particleTexture=k.Parse(U.texture,L,t):U.textureName&&(W.particleTexture=new k(t+U.textureName,L,!1,void 0===U.invertY||U.invertY),W.particleTexture.name=U.textureName)),U.emitterId||0===U.emitterId||void 0!==U.j?U.emitterId&&L?W.j=L.getLastMeshById(U.emitterId):W.j=M.l.gk(U.j):W.j=M.l.Zero(),W.isLocal=!!U.isLocal,void 0!==U.renderingGroupId&&(W.renderingGroupId=U.renderingGroupId),void 0!==U.isBillboardBased&&(W.isBillboardBased=U.isBillboardBased),void 0!==U.billboardMode&&(W.billboardMode=U.billboardMode),void 0!==U.useLogarithmicDepth&&(W.useLogarithmicDepth=U.useLogarithmicDepth),U.animations){for(let l=0;l<U.animations.length;l++){const M=U.animations[l],t=(0,B.d)("BABYLON.Animation");t&&W.animations.push(t.Parse(M))}W.beginAnimationOnStart=U.beginAnimationOnStart,W.beginAnimationFrom=U.beginAnimationFrom,W.beginAnimationTo=U.beginAnimationTo,W.beginAnimationLoop=U.beginAnimationLoop}if(U.autoAnimate&&L&&L.beginAnimation(W,U.autoAnimateFrom,U.autoAnimateTo,U.autoAnimateLoop,U.autoAnimateSpeed||1),W.startDelay=0|U.startDelay,W.minAngularSpeed=U.minAngularSpeed,W.maxAngularSpeed=U.maxAngularSpeed,W.minSize=U.minSize,W.maxSize=U.maxSize,U.minScaleX&&(W.minScaleX=U.minScaleX,W.maxScaleX=U.maxScaleX,W.minScaleY=U.minScaleY,W.maxScaleY=U.maxScaleY),void 0!==U.preWarmCycles&&(W.preWarmCycles=U.preWarmCycles,W.preWarmStepOffset=U.preWarmStepOffset),void 0!==U.minInitialRotation&&(W.minInitialRotation=U.minInitialRotation,W.maxInitialRotation=U.maxInitialRotation),W.minLifeTime=U.minLifeTime,W.maxLifeTime=U.maxLifeTime,W.minEmitPower=U.minEmitPower,W.maxEmitPower=U.maxEmitPower,W.emitRate=U.emitRate,W.gravity=M.l.gk(U.gravity),U.noiseStrength&&(W.noiseStrength=M.l.gk(U.noiseStrength)),W.color1=p.f.gk(U.color1),W.color2=p.f.gk(U.color2),W.colorDead=p.f.gk(U.colorDead),W.updateSpeed=U.updateSpeed,W.targetStopDuration=U.targetStopDuration,W.blendMode=U.blendMode,U.colorGradients)for(const M of U.colorGradients)W.addColorGradient(M.gradient,p.f.gk(M.color1),M.color2?p.f.gk(M.color2):void 0);if(U.rampGradients){for(const l of U.rampGradients)W.addRampGradient(l.gradient,p.e.gk(l.color));W.useRampGradients=U.useRampGradients}if(U.colorRemapGradients)for(const M of U.colorRemapGradients)W.addColorRemapGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.alphaRemapGradients)for(const M of U.alphaRemapGradients)W.addAlphaRemapGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.sizeGradients)for(const M of U.sizeGradients)W.addSizeGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.angularSpeedGradients)for(const M of U.angularSpeedGradients)W.addAngularSpeedGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.velocityGradients)for(const M of U.velocityGradients)W.addVelocityGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.dragGradients)for(const M of U.dragGradients)W.addDragGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.emitRateGradients)for(const M of U.emitRateGradients)W.addEmitRateGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.startSizeGradients)for(const M of U.startSizeGradients)W.addStartSizeGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.lifeTimeGradients)for(const M of U.lifeTimeGradients)W.addLifeTimeGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(U.limitVelocityGradients){for(const l of U.limitVelocityGradients)W.addLimitVelocityGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);W.limitVelocityDamping=U.limitVelocityDamping}if(U.noiseTexture&&L){const l=(0,B.d)("BABYLON.ProceduralTexture");W.noiseTexture=l.Parse(U.noiseTexture,L,t)}let A;if(U.particleEmitterType){switch(U.particleEmitterType.type){case"SphereParticleEmitter":A=new f;break;case"SphereDirectedParticleEmitter":A=new g;break;case"ConeEmitter":case"ConeParticleEmitter":A=new j;break;case"ConeDirectedParticleEmitter":A=new s;break;case"CylinderParticleEmitter":A=new w;break;case"CylinderDirectedParticleEmitter":A=new K;break;case"HemisphericParticleEmitter":A=new r;break;case"PointParticleEmitter":A=new m;break;case"MeshParticleEmitter":A=new N;break;case"CustomParticleEmitter":A=new E;break;default:A=new y}A.parse(U.particleEmitterType,L)}else A=new y,A.parse(U,L);W.particleEmitterType=A,W.startSpriteCellID=U.startSpriteCellID,W.endSpriteCellID=U.endSpriteCellID,W.spriteCellLoop=U.spriteCellLoop??!0,W.spriteCellWidth=U.spriteCellWidth,W.spriteCellHeight=U.spriteCellHeight,W.spriteCellChangeSpeed=U.spriteCellChangeSpeed,W.spriteRandomStartCell=U.spriteRandomStartCell,W.disposeOnStop=U.disposeOnStop??!1,W.manualEmitCount=U.manualEmitCount??-1}static Parse(U,W,l){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const B=U.name;let k,A,q=null,y=null;if(W instanceof hU.d?k=W:(A=W,k=A.getEngine()),U.customShader&&k.createEffectForParticles){y=U.customShader;const W=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"";q=k.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,W)}const j=new BW(B,L||U.Db,W,q,U.isAnimationSheetEnabled);if(j.customShader=y,j._rootUrl=l,U.id&&(j.id=U.id),U.subEmitters){j.subEmitters=[];for(const M of U.subEmitters){const U=[];for(const t of M)U.push(cU.Parse(t,W,l));j.subEmitters.push(U)}}if(U.attractors)for(const p of U.attractors){const U=new pW;U.position=M.l.gk(p.position),U.strength=p.strength,j.addAttractor(U)}return BW._Parse(U,j,W,l),U.textureMask&&(j.textureMask=p.f.gk(U.textureMask)),U.Le&&(j.Le=M.l.gk(U.Le)),U.preventAutoStart&&(j.preventAutoStart=U.preventAutoStart),t||j.preventAutoStart||j.start(),j}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const W={};if(BW._Serialize(W,this,U),W.textureMask=this.textureMask.qk(),W.customShader=this.customShader,W.preventAutoStart=this.preventAutoStart,W.Le=this.Le.qk(),this.subEmitters){W.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const l of this._subEmitters){const M=[];for(const W of l)M.push(W.serialize(U));W.subEmitters.push(M)}}if(this._attractors&&this._attractors.length){W.attractors=[];for(const U of this._attractors)W.attractors.push(U.serialize())}return W}static _Serialize(U,W,l){if(U.name=W.name,U.id=W.id,U.Db=W.getCapacity(),U.disposeOnStop=W.disposeOnStop,U.manualEmitCount=W.manualEmitCount,W.j.position){const l=W.j;U.emitterId=l.id}else{const l=W.j;U.j=l.qk()}W.particleEmitterType&&(U.particleEmitterType=W.particleEmitterType.serialize()),W.particleTexture&&(l?U.texture=W.particleTexture.serialize():(U.textureName=W.particleTexture.name,U.invertY=!!W.particleTexture._invertY)),U.isLocal=W.isLocal,x.e.AppendSerializedAnimations(W,U),U.beginAnimationOnStart=W.beginAnimationOnStart,U.beginAnimationFrom=W.beginAnimationFrom,U.beginAnimationTo=W.beginAnimationTo,U.beginAnimationLoop=W.beginAnimationLoop,U.startDelay=W.startDelay,U.renderingGroupId=W.renderingGroupId,U.isBillboardBased=W.isBillboardBased,U.billboardMode=W.billboardMode,U.minAngularSpeed=W.minAngularSpeed,U.maxAngularSpeed=W.maxAngularSpeed,U.minSize=W.minSize,U.maxSize=W.maxSize,U.minScaleX=W.minScaleX,U.maxScaleX=W.maxScaleX,U.minScaleY=W.minScaleY,U.maxScaleY=W.maxScaleY,U.minEmitPower=W.minEmitPower,U.maxEmitPower=W.maxEmitPower,U.minLifeTime=W.minLifeTime,U.maxLifeTime=W.maxLifeTime,U.emitRate=W.emitRate,U.gravity=W.gravity.qk(),U.noiseStrength=W.noiseStrength.qk(),U.color1=W.color1.qk(),U.color2=W.color2.qk(),U.colorDead=W.colorDead.qk(),U.updateSpeed=W.updateSpeed,U.targetStopDuration=W.targetStopDuration,U.blendMode=W.blendMode,U.preWarmCycles=W.preWarmCycles,U.preWarmStepOffset=W.preWarmStepOffset,U.minInitialRotation=W.minInitialRotation,U.maxInitialRotation=W.maxInitialRotation,U.startSpriteCellID=W.startSpriteCellID,U.spriteCellLoop=W.spriteCellLoop,U.endSpriteCellID=W.endSpriteCellID,U.spriteCellChangeSpeed=W.spriteCellChangeSpeed,U.spriteCellWidth=W.spriteCellWidth,U.spriteCellHeight=W.spriteCellHeight,U.spriteRandomStartCell=W.spriteRandomStartCell,U.isAnimationSheetEnabled=W.isAnimationSheetEnabled,U.useLogarithmicDepth=W.useLogarithmicDepth;const M=W.getColorGradients();if(M){U.colorGradients=[];for(const W of M){const l={gradient:W.gradient,color1:W.color1.qk()};W.color2?l.color2=W.color2.qk():l.color2=W.color1.qk(),U.colorGradients.push(l)}}const t=W.getRampGradients();if(t){U.rampGradients=[];for(const W of t){const l={gradient:W.gradient,color:W.color.qk()};U.rampGradients.push(l)}U.useRampGradients=W.useRampGradients}const L=W.getColorRemapGradients();if(L){U.colorRemapGradients=[];for(const W of L){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.colorRemapGradients.push(l)}}const p=W.getAlphaRemapGradients();if(p){U.alphaRemapGradients=[];for(const W of p){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.alphaRemapGradients.push(l)}}const B=W.getSizeGradients();if(B){U.sizeGradients=[];for(const W of B){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.sizeGradients.push(l)}}const k=W.getAngularSpeedGradients();if(k){U.angularSpeedGradients=[];for(const W of k){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.angularSpeedGradients.push(l)}}const A=W.getVelocityGradients();if(A){U.velocityGradients=[];for(const W of A){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.velocityGradients.push(l)}}const q=W.getDragGradients();if(q){U.dragGradients=[];for(const W of q){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.dragGradients.push(l)}}const y=W.getEmitRateGradients();if(y){U.emitRateGradients=[];for(const W of y){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.emitRateGradients.push(l)}}const j=W.getStartSizeGradients();if(j){U.startSizeGradients=[];for(const W of j){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.startSizeGradients.push(l)}}const s=W.getLifeTimeGradients();if(s){U.lifeTimeGradients=[];for(const W of s){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.lifeTimeGradients.push(l)}}const w=W.getLimitVelocityGradients();if(w){U.limitVelocityGradients=[];for(const W of w){const l={gradient:W.gradient,factor1:W.factor1};void 0!==W.factor2?l.factor2=W.factor2:l.factor2=W.factor1,U.limitVelocityGradients.push(l)}U.limitVelocityDamping=W.limitVelocityDamping}W.noiseTexture&&(U.noiseTexture=W.noiseTexture.serialize())}clone(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M={...this._customWrappers};let t=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){t=this.customShader;const U=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"",W=L.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,U);M[0]?M[0].effect=W:this.setCustomEffect(W,0)}const p=this.serialize(l),B=BW.Parse(p,this._scene||this._engine,this._rootUrl);return B.name=U,B.customShader=t,B._customWrappers=M,void 0===W&&(W=this.j),this.noiseTexture&&(B.noiseTexture=this.noiseTexture.clone()),B.j=W,this.preventAutoStart||B.start(),B}}BW.BILLBOARDMODE_Y=2,BW.BILLBOARDMODE_ALL=7,BW.BILLBOARDMODE_STRETCHED=8,BW.BILLBOARDMODE_STRETCHED_LOCAL=9,cU._ParseParticleSystem=BW.Parse;var kW=l(2183),AW=l(2178),qW=l(2088);qW.c.prototype.createTransformFeedback=function(){const U=this._gl.createTransformFeedback();if(!U)throw new Error("Unable to create Transform Feedback");return U},qW.c.prototype.deleteTransformFeedback=function(U){this._gl.deleteTransformFeedback(U)},qW.c.prototype.bindTransformFeedback=function(U){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,U)},qW.c.prototype.beginTransformFeedback=function(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(U?this._gl.POINTS:this._gl.TRIANGLES)},qW.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},qW.c.prototype.setTranformFeedbackVaryings=function(U,W){this._gl.transformFeedbackVaryings(U,W,this._gl.INTERLEAVED_ATTRIBS)},qW.c.prototype.bindTransformFeedbackBuffer=function(U){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U?U.underlyingResource:null)},qW.c.prototype.readTransformFeedbackBuffer=function(U){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U)};const yW="clipPlaneFragmentDeclaration2",jW="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";o.d.IncludesShadersStore[yW]||(o.d.IncludesShadersStore[yW]=jW);l(12295),l(12301),l(12306),l(12312),l(12321),l(12330),l(12337),l(12343);const sW="gpuRenderParticlesPixelShader",wW="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";o.d.ShadersStore[sW]||(o.d.ShadersStore[sW]=wW);const KW="clipPlaneVertexDeclaration2",rW="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";o.d.IncludesShadersStore[KW]||(o.d.IncludesShadersStore[KW]=rW);l(12352),l(12359),l(12368),l(12374);const mW="gpuRenderParticlesVertexShader",fW="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";o.d.ShadersStore[mW]||(o.d.ShadersStore[mW]=fW);class gW extends k{static get IsSupported(){if(!X.d.LastCreatedEngine)return!1;const U=X.d.LastCreatedEngine.getCaps();return U.supportTransformFeedbacks||U.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(U){this._maxActiveParticleCount=Math.min(U,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(U){this.maxActiveParticleCount=U}createPointEmitter(U,W){const l=zU(U,W);return this.particleEmitterType=l,l}createHemisphericEmitter(){const U=aU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=YU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=XU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=TU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=UW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.l(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=WW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=lW(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.l(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,W,l,M){const t=new y;return this.particleEmitterType=t,this.direction1=U,this.direction2=W,this.minEmitBox=l,this.maxEmitBox=M,t}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==BW.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(BW.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(BW.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";U?setTimeout((()=>{this.start(0)}),U):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var U;let W=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(U=this._customWrappers[W])||void 0===U?void 0:U.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[U]??this._customWrappers[0]}setCustomEffect(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[W]=new UU.e(this._engine),this._customWrappers[W].effect=U}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(U,W,l){return super._removeGradientAndTexture(U,W,l),this._releaseBuffers(),this}addColorGradient(U,W){this._colorGradients||(this._colorGradients=[]);const l=new S(U,W);return this._colorGradients.push(l),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(U&&this._colorGradients.sort(((U,W)=>U.gradient<W.gradient?-1:U.gradient>W.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(U){return this._removeGradientAndTexture(U,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const W in this._drawWrappers){var U;null===(U=this._drawWrappers[W].drawContext)||void 0===U||U.reset()}}_addFactorGradient(U,W,l){const M=new h(W,l);U.push(M),this._releaseBuffers()}addSizeGradient(U,W){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,U,W),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(U){return this._removeGradientAndTexture(U,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(U,W){if(!U)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&U.sort(((U,W)=>U.gradient<W.gradient?-1:U.gradient>W.gradient?1:0));const l=this;l[W]&&(l[W].dispose(),l[W]=null)}addAngularSpeedGradient(U,W){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,U,W),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(U){return this._removeGradientAndTexture(U,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(U,W){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,U,W),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(U){return this._removeGradientAndTexture(U,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(U,W){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,U,W),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(U){return this._removeGradientAndTexture(U,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(U,W){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,U,W),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(U){return this._removeGradientAndTexture(U,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(U){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(U,W,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(U),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.nk=new a.b,this.onStoppedObservable=new a.b,this.onStartedObservable=new a.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=M.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||X.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Fk.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,B.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,B.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,B.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,B.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new UU.e(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers={0:new UU.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(W=W??{}).randomTextureSize||delete W.randomTextureSize;const p={Db:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...W},k=W;isFinite(k)&&(p.Db=k),this._capacity=p.Db,this._maxActiveParticleCount=p.Db,this._currentActiveCount=0,this._isAnimationSheetEnabled=L,this.particleEmitterType=new y;const A=Math.min(this._engine.getCaps().maxTextureSize,p.randomTextureSize);let q=[];for(let M=0;M<A;++M)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());this._randomTexture=new Y.e(new Float32Array(q),A,1,5,l,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,q=[];for(let M=0;M<A;++M)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());this._randomTexture2=new Y.e(new Float32Array(q),A,1,5,l,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=A}_reset(){this._releaseBuffers()}_createVertexBuffers(U,W,l){const M={};M.position=W.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let t=3;M.age=W.createVertexBuffer("age",t,1,this._attributesStrideSize,!0),t+=1,M.size=W.createVertexBuffer("size",t,3,this._attributesStrideSize,!0),t+=3,M.life=W.createVertexBuffer("life",t,1,this._attributesStrideSize,!0),t+=1,t+=4,this.billboardMode===BW.BILLBOARDMODE_STRETCHED&&(M.direction=W.createVertexBuffer("direction",t,3,this._attributesStrideSize,!0)),t+=3,this._platform.alignDataInBuffer&&(t+=1),this.particleEmitterType instanceof E&&(t+=3,this._platform.alignDataInBuffer&&(t+=1)),this._colorGradientsTexture||(M.color=W.createVertexBuffer("color",t,4,this._attributesStrideSize,!0),t+=4),this._isBillboardBased||(M.initialDirection=W.createVertexBuffer("initialDirection",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),this.noiseTexture&&(M.noiseCoordinates1=W.createVertexBuffer("noiseCoordinates1",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1),M.noiseCoordinates2=W.createVertexBuffer("noiseCoordinates2",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),M.angle=W.createVertexBuffer("angle",t,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?t++:t+=2,this._isAnimationSheetEnabled&&(M.cellIndex=W.createVertexBuffer("cellIndex",t,1,this._attributesStrideSize,!0),t+=1,this.spriteRandomStartCell&&(M.cellStartOffset=W.createVertexBuffer("cellStartOffset",t,1,this._attributesStrideSize,!0),t+=1)),M.offset=l.createVertexBuffer("offset",0,2),M.uv=l.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(M),this._platform.createVertexBuffers(U,M),this.resetDrawCache()}_initialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!U)return;const W=this._engine,l=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof E&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const t=this.particleEmitterType instanceof E,L=M.f.ik[0];let p=0;for(let M=0;M<this._capacity;M++)if(l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),t?(this.particleEmitterType.particleDestinationGenerator(M,null,L),l.push(L.x),l.push(L.y),l.push(L.z)):(l.push(0),l.push(0),l.push(0)),this._platform.alignDataInBuffer&&l.push(0),p+=16,t&&(this.particleEmitterType.particlePositionGenerator(M,null,L),l.push(L.x),l.push(L.y),l.push(L.z),this._platform.alignDataInBuffer&&l.push(0),p+=4),this._colorGradientsTexture||(l.push(0),l.push(0),l.push(0),l.push(0),p+=4),this.isBillboardBased||(l.push(0),l.push(0),l.push(0),this._platform.alignDataInBuffer&&l.push(0),p+=4),this.noiseTexture&&(l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),p+=8),l.push(0),p+=1,this._angularSpeedGradientsTexture||(l.push(0),p+=1),this._isAnimationSheetEnabled&&(l.push(0),p+=1,this.spriteRandomStartCell&&(l.push(0),p+=1)),this._platform.alignDataInBuffer){let U=3-(p+3&3);for(p+=U;U-- >0;)l.push(0)}const B=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),k=this._platform.createParticleBuffer(l),A=this._platform.createParticleBuffer(l);this._buffer0=new Z.b(W,k,!1,this._attributesStrideSize),this._buffer1=new Z.b(W,A,!1,this._attributesStrideSize),this._spriteBuffer=new Z.b(W,B,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let U=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(U+="\n#define BILLBOARD"),this._colorGradientsTexture&&(U+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(U+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(U+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(U+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(U+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(U+="\n#define DRAGGRADIENTS"),this._flowMap&&(U+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(U+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(U+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(U+="\n#define NOISE"),this.isLocal&&(U+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===U||(this._cachedUpdateDefines=U,this._updateBuffer=this._platform.createUpdateBuffer(U)),this._platform.isUpdateBufferReady()}_getWrapper(U){const W=this._getCustomDrawWrapper(U);if(null!==W&&void 0!==W&&W.effect)return W;const l=[];this.fillDefines(l,U);let M=this._drawWrappers[U];M||(M=new UU.e(this._engine),M.drawContext&&(M.drawContext.useInstancing=!0),this._drawWrappers[U]=M);const t=l.join("\n");if(M.defines!==t){const U=[],W=[],l=[];this.fillUniformsAttributesAndSamplerNames(W,U,l),M.setEffect(this._engine.createEffect("gpuRenderParticles",U,W,l,t),t)}return M}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=[Z.e.PositionKind,"age","life","size","angle"];return U||t.push(Z.e.ColorKind),W&&t.push("cellIndex"),l||t.push("initialDirection"),M&&t.push("direction"),t.push("offset",Z.e.UVKind),t}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M=["emitterWM","Le","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,WU.c)(M),U&&M.push("sheetInfos"),W&&M.push("logarithmicDepthConstant"),l&&(M.push("vFogInfos"),M.push("vFogColor")),M}fillDefines(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,WU.m)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==AW.c.FOGMODE_NONE&&U.push("#define FOG")),W===BW.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this.isLocal&&U.push("#define LOCAL"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case BW.BILLBOARDMODE_Y:U.push("#define BILLBOARDY");break;case BW.BILLBOARDMODE_STRETCHED:U.push("#define BILLBOARDSTRETCHED");break;case BW.BILLBOARDMODE_ALL:U.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&U.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,W,l){W.push(...gW._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===BW.BILLBOARDMODE_STRETCHED)),U.push(...gW._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(kW.c.PrepareUniforms(U,this._imageProcessingConfigurationDefines),kW.c.PrepareSamplers(l,this._imageProcessingConfigurationDefines))}animate(){var U;let W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(W?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(U,W){const l=this[W];if(!U||!U.length||l)return;const M=new Float32Array(this._rawTextureWidth);for(let t=0;t<this._rawTextureWidth;t++){const W=t/this._rawTextureWidth;z.GetCurrentGradient(W,U,((U,W,l)=>{M[t]=(0,A.Lerp)(U.factor1,W.factor1,l)}))}this[W]=Y.e.CreateRTexture(M,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[W].name=W.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const U=new Uint8Array(4*this._rawTextureWidth),W=p.h.Ak[0];for(let l=0;l<this._rawTextureWidth;l++){const M=l/this._rawTextureWidth;z.GetCurrentGradient(M,this._colorGradients,((M,t,L)=>{p.f.LerpToRef(M.color1,t.color1,L,W),U[4*l]=255*W.r,U[4*l+1]=255*W.g,U[4*l+2]=255*W.b,U[4*l+3]=255*W.a}))}this._colorGradientsTexture=Y.e.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(U,W){var l,t,L,p;const B=this._getWrapper(U),k=B.effect;this._engine.enableEffect(B);const A=(null===(l=this._scene)||void 0===l?void 0:l.getViewMatrix())||M.c.IdentityReadOnly;if(k.setMatrix("view",A),k.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),k.setTexture("diffuseSampler",this.particleTexture),k.setVector2("translationPivot",this.translationPivot),k.setVector3("Le",this.Le),this.isLocal&&k.setMatrix("emitterWM",W),this._colorGradientsTexture?k.setTexture("colorGradientSampler",this._colorGradientsTexture):k.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();k.setFloat3("sheetInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,U.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;k.setVector3("eyePosition",U.globalPosition)}const q=k.defines;if(this._scene&&((0,WU.g)(k,this,this._scene),this.applyFog&&(0,lU.g)(this._scene,void 0,k)),q.indexOf("#define BILLBOARDMODE_ALL")>=0){const U=A.clone();U.invert(),k.setMatrix("invView",U)}return this.useLogarithmicDepth&&this._scene&&(0,lU.n)(q,k,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(k),this._setEngineBasedOnBlendMode(U),this._platform.bindDrawBuffers(this._targetIndex,k,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(k),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(U){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!U)if(this.j.position){U=this.j.getWorldMatrix()}else{const W=this.j;U=M.f.Matrix[0],M.c.TranslationToRef(W.x,W.y,W.z,U)}const W=this._engine,l=W.getDepthWrite();if(W.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const U=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",U.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",U),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const t=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=t,W.setDepthWrite(l)}render(){let U,W=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!W&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const U=0|this._accumulatedCount;this._accumulatedCount-=U,this._currentActiveCount+=U}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){U=this.j.getWorldMatrix()}else{const W=this.j;U=M.f.Matrix[0],M.c.TranslationToRef(W.x,W.y,W.z,U)}const t=this._engine;this.updateInAnimate||this._update(U);let L=0;return W||l||(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0),L=this.blendMode===BW.BLENDMODE_MULTIPLYADD?this._render(BW.BLENDMODE_MULTIPLY,U)+this._render(BW.BLENDMODE_ADD,U):this._render(this.blendMode,U),this._engine.setAlphaMode(0)),L}rebuild(){const U=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(U,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,U()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const W in this._drawWrappers){this._drawWrappers[W].dispose()}if(this._drawWrappers={},this._scene){const U=this._scene.Fk.indexOf(this);U>-1&&this._scene.Fk.splice(U,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let W=0;W<this._renderVertexBuffers.length;++W){const U=this._renderVertexBuffers[W];for(const W in U)U[W].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.nk.notifyObservers(this),this.nk.clear()}clone(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M={...this._customWrappers};let t=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){t=this.customShader;const U=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";M[0]=L.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,U,void 0,void 0,void 0,this)}const p=this.serialize(l),B=gW.Parse(p,this._scene||this._engine,this._rootUrl);return B.name=U,B.customShader=t,B._customWrappers=M,void 0===W&&(W=this.j),this.noiseTexture&&(B.noiseTexture=this.noiseTexture.clone()),B.j=W,B}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const W={};return BW._Serialize(W,this,U),W.activeParticleCount=this.activeParticleCount,W.randomTextureSize=this._randomTextureSize,W.customShader=this.customShader,W}static Parse(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const L=U.name;let p,B;W instanceof hU.d?p=W:(B=W,p=B.getEngine());const k=new gW(L,{Db:t||U.Db,randomTextureSize:U.randomTextureSize},W,null,U.isAnimationSheetEnabled);if(k._rootUrl=l,U.customShader&&p.createEffectForParticles){const W=U.customShader,l=W.shaderOptions.defines.length>0?W.shaderOptions.defines.join("\n"):"",M=p.createEffectForParticles(W.shaderPath.fragmentElement,W.shaderOptions.uniforms,W.shaderOptions.samplers,l,void 0,void 0,void 0,k);k.setCustomEffect(M,0),k.customShader=W}return U.id&&(k.id=U.id),U.activeParticleCount&&(k.activeParticleCount=U.activeParticleCount),BW._Parse(U,k,W,l),U.preventAutoStart&&(k.preventAutoStart=U.preventAutoStart),M||k.preventAutoStart||k.start(),k}}var EW=l(503),ZW=l(12376),NW=l(11851);class DW{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(U){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const W of this.systems)W.j=U;this._emitterNode=U}setEmitterAsSphere(U,W,l){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:U,renderingGroupId:W};const M=(0,ZW.b)("emitterSphere",{diameter:U.diameter,segments:U.segments},l);M.renderingGroupId=W;const t=new NW.e("emitterSphereMaterial",l);t.emissiveColor=U.color,M.material=t;for(const L of this.systems)L.j=M;this._emitterNode=M}start(U){for(const W of this.systems)U&&(W.j=U),W.start()}dispose(){for(const U of this.systems)U.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const W={systems:[]};for(const l of this.systems)W.systems.push(l.serialize(U));return this._emitterNode&&(W.j=this._emitterCreationOptions),W}static Parse(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3?arguments[3]:void 0;const t=new DW,L=this.BaseAssetsUrl+"/textures/";W=W||X.d.LastCreatedScene;for(const p of U.systems)t.systems.push(l?gW.Parse(p,W,L,!0,M):BW.Parse(p,W,L,!0,M));if(U.j){const l=U.j.options;if("Sphere"===U.j.kind)t.setEmitterAsSphere({diameter:l.diameter,segments:l.segments,color:p.e.gk(l.color)},U.j.renderingGroupId,W)}return t}}DW.BaseAssetsUrl="https://assets.babylonjs.com/particles";var oW=l(541);class iW{static CreateDefault(U){let W,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,M=arguments.length>2?arguments[2]:void 0;W=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new gW("default system",{Db:l},M):new BW("default system",l,M),W.j=U;const t=EW.h.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return W.particleTexture=new I.d(t,W.va()),W.createConeEmitter(.1,Math.PI/4),W.color1=new p.f(1,1,1,1),W.color2=new p.f(1,1,1,1),W.colorDead=new p.f(1,1,1,0),W.minSize=.1,W.maxSize=.1,W.minEmitPower=2,W.maxEmitPower=2,W.updateSpeed=1/60,W.emitRate=30,W}static CreateAsync(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3?arguments[3]:void 0;W||(W=X.d.LastCreatedScene);const t={};return W.addPendingData(t),new Promise(((L,p)=>{if(l&&!gW.IsSupported)return W.removePendingData(t),p("Particle system with GPU is not supported.");EW.h.LoadFile(`${iW.BaseAssetsUrl}/systems/${U}.json`,(U=>{W.removePendingData(t);const p=JSON.parse(U.toString());return L(DW.Parse(p,W,l,M))}),void 0,void 0,void 0,(()=>(W.removePendingData(t),p(`An error occurred with the creation of your particle system. Check if your type '${U}' exists.`))))}))}static ExportSet(U){const W=new DW;for(const l of U)W.systems.push(l);return W}static ParseFromFileAsync(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",L=arguments.length>5?arguments[5]:void 0;return new Promise(((p,B)=>{const k=new oW.c;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const W=JSON.parse(k.responseText);let B;B=M?gW.Parse(W,l,t,!1,L):BW.Parse(W,l,t,!1,L),U&&(B.name=U),p(B)}else B("Unable to load the particle system")})),k.open("GET",W),k.send()}))}static ParseFromSnippetAsync(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0;if("_BLANK"===U){const U=this.CreateDefault(null);return U.start(),Promise.resolve(U)}return new Promise(((L,p)=>{const B=new oW.c;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const p=JSON.parse(JSON.parse(B.responseText).jsonPayload),k=JSON.parse(p.particleSystem);let A;A=l?gW.Parse(k,W,M,!1,t):BW.Parse(k,W,M,!1,t),A.snippetId=U,L(A)}else p("Unable to load the snippet "+U)})),B.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),B.send()}))}}iW.BaseAssetsUrl=DW.BaseAssetsUrl,iW.SnippetUrl="https://snippet.babylonjs.com",iW.CreateFromSnippetAsync=iW.ParseFromSnippetAsync;var OW=l(487),eW=l(877),dW=l(12385);(0,dW.g)(eW.d.NAME_PARTICLESYSTEM,((U,W,l,M)=>{const t=(0,dW.i)(eW.d.NAME_PARTICLESYSTEM);if(t&&void 0!==U.Fk&&null!==U.Fk)for(let L=0,p=U.Fk.length;L<p;L++){const p=U.Fk[L];l.Fk.push(t(p,W,M))}})),(0,dW.e)(eW.d.NAME_PARTICLESYSTEM,((U,W,l)=>{if(U.activeParticleCount){return gW.Parse(U,W,l)}return BW.Parse(U,W,l)})),hU.d.prototype.createEffectForParticles=function(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0,k=arguments.length>7?arguments[7]:void 0,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,q=arguments.length>9?arguments[9]:void 0,y=[],j=[];const s=[];return k?k.fillUniformsAttributesAndSamplerNames(j,y,s):(y=BW._GetAttributeNamesOrOptions(),j=BW._GetEffectCreationOptions()),-1===t.indexOf(" BILLBOARD")&&(t+="\n#define BILLBOARD\n"),null!==k&&void 0!==k&&k.isAnimationSheetEnabled&&-1===t.indexOf(" ANIMATESHEET")&&(t+="\n#define ANIMATESHEET\n"),-1===M.indexOf("diffuseSampler")&&M.push("diffuseSampler"),this.createEffect({vertex:q??(null===k||void 0===k?void 0:k.vertexShaderName)??"particles",fragmentElement:U},y,j.concat(W),s.concat(M),t,L,p,B,void 0,A,(async()=>{0===A?await Promise.resolve().then(l.bind(l,12409)):await Promise.resolve().then(l.bind(l,12486))}))},OW.e.prototype.getEmittedParticleSystems=function(){const U=[];for(let W=0;W<this.va().Fk.length;W++){const l=this.va().Fk[W];l.j===this&&U.push(l)}return U},OW.e.prototype.getHierarchyEmittedParticleSystems=function(){const U=[],W=this.getDescendants();W.push(this);for(let l=0;l<this.va().Fk.length;l++){const M=this.va().Fk[l],t=M.j;t.position&&-1!==W.indexOf(t)&&U.push(M)}return U};l(784),l(800),l(821);l(774),l(886),l(845),l(776),l(875);l(2016);var HW;l(12388),l(2051);!function(U){U[U.Color=2]="Color",U[U.UV=1]="UV",U[U.Random=0]="Random",U[U.Stated=3]="Stated"}(HW||(HW={}));var VW=l(2046);const nW=new M.l(0,0,0),xW=new M.l(0,0,0),IW=new M.l(0,0,0);class RW{constructor(U,W,l){this.width=U,this.height=W,this.data=l}processFlowable(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2?arguments[2]:void 0;if(!l)return;l instanceof M.c?M.l.TransformCoordinatesToRef(U.position,l,IW):(IW.x=l.x,IW.y=l.y,IW.z=l.z);const t=.5*IW.x+.5,L=1-(.5*IW.y+.5),p=Math.floor(t*this.width),B=Math.floor(L*this.height);if(p<0||p>=this.width||B<0||B>=this.height)return;const k=4*(B*this.width+p),A=this.data[k]/255*2-1,q=this.data[k+1]/255*2-1,y=this.data[k+2]/255*2-1,j=this.data[k+3]/255;nW.set(A,q,y),nW.scaleToRef(W*j,xW),U.direction.addInPlace(xW)}_processParticle(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2?arguments[2]:void 0;this.processFlowable(U,W,l)}static async FromUrlAsync(U){return await new Promise(((W,l)=>{const M=document.createElement("canvas"),t=M.getContext("2d");let L=null;const p=new Image;p.crossOrigin="anonymous",p.src=U,p.onerror=W=>{l(new Error(`Failed to load image: ${U} : ${W}`))},p.onload=()=>{M.width=p.width,M.height=p.height,t.drawImage(p,0,0),L=t.getImageData(0,0,M.width,M.height),W(new RW(M.width,M.height,L.data))}}))}static async ExtractFromTextureAsync(U){return await new Promise(((W,l)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{const l=await this.ExtractFromTextureAsync(U);W(l)}catch(M){l(M)}}));const M=U.getSize();VW.j.GetTextureDataAsync(U,M.width,M.height).then((U=>{W(new RW(M.width,M.height,new Uint8ClampedArray(U)))})).catch(l)}))}}var FW,vW,JW,QW,GW,uW,bW,CW,PW;!function(U){U[U.Int=1]="Int",U[U.Float=2]="Float",U[U.Vector2=4]="Vector2",U[U.ik=8]="ik",U[U.Matrix=16]="Matrix",U[U.Particle=32]="Particle",U[U.Texture=64]="Texture",U[U.Ak=128]="Ak",U[U.FloatGradient=256]="FloatGradient",U[U.Vector2Gradient=512]="Vector2Gradient",U[U.Vector3Gradient=1024]="Vector3Gradient",U[U.Color4Gradient=2048]="Color4Gradient",U[U.System=4096]="System",U[U.AutoDetect=8192]="AutoDetect",U[U.BasedOnInput=16384]="BasedOnInput",U[U.Undefined=32768]="Undefined",U[U.All=65535]="All"}(FW||(FW={})),function(U){U[U.Compatible=0]="Compatible",U[U.TypeIncompatible=1]="TypeIncompatible",U[U.HierarchyIssue=2]="HierarchyIssue"}(vW||(vW={})),function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(JW||(JW={}));class SW{get direction(){return this._direction}get type(){if(this._type===FW.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===FW.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(U){this._type=U}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((U=>U.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(U,W,l){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=FW.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new a.b,this.onDisconnectionObservable=new a.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=W,this.name=U,this._direction=l}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(U){var W;return this.isConnected?null!==(W=this._connectedPoint)&&void 0!==W&&W._storedFunction?this._connectedPoint._storedFunction(U):this._connectedPoint._storedValue:this.value}canConnectTo(U){return 0===this.checkCompatibilityState(U)}checkCompatibilityState(U){const W=this._ownerBlock,l=U.ownerBlock;if(this.type!==U.type&&U.innerType!==FW.AutoDetect)return U.acceptedConnectionPointTypes&&-1!==U.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(U.excludedConnectionPointTypes&&-1!==U.excludedConnectionPointTypes.indexOf(this.type))return 1;let M=l,t=W;return 0===this.direction&&(M=W,t=l),M.isAnAncestorOf(t)?2:0}connectTo(U){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(U))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${U.ownerBlock.name}".${U.name}`;return this._endpoints.push(U),U._connectedPoint=this,this.onConnectionObservable.notifyObservers(U),U.onConnectionObservable.notifyObservers(this),this}disconnectFrom(U){const W=this._endpoints.indexOf(U);return-1===W||(this._endpoints.splice(W,1),U._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(U),U.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(U){let W=1;for(;W<FW.All;)U&W||this.excludedConnectionPointTypes.push(W),W<<=1}serialize(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const W={};return W.name=this.name,W.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.qk?(W.valueType="BABYLON."+this.value.getClassName(),W.value=this.value.qk()):(W.valueType="number",W.value=this.value)),U&&this.connectedPoint&&(W.inputName=this.name,W.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,W.targetConnectionName=this.connectedPoint.name,W.isExposedOnFrame=!0,W.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(W.isExposedOnFrame=!0,W.exposedPortPosition=this.exposedPortPosition),W}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class cW{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(U){this._name=U}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(U){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new a.b,this.nk=new a.b,this.onInputChangedObservable=new a.b,this.visibleOnFrame=!1,this._name=U,this.uniqueId=R.d.UniqueId}_inputRename(U){return U}_outputRename(U){return U}isAnAncestorOf(U){for(const W of this._outputs)if(W.hasEndpoints)for(const l of W.endpoints){if(l.ownerBlock===U)return!0;if(l.ownerBlock.isAnAncestorOf(U))return!0}return!1}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const W of this._outputs)if(W.hasEndpoints)for(const l of W.endpoints)if(l.ownerBlock.isAnAncestorOfType(U))return!0;return!1}getInputByName(U){const W=this._inputs.filter((W=>W.name===U));return W.length?W[0]:null}_linkConnectionTypes(U,W){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[W]._acceptedConnectionPointType=this._inputs[U]:(this._inputs[U]._linkedConnectionSource=this._inputs[W],this._inputs[U]._isMainLinkSource=!0),this._inputs[W]._linkedConnectionSource=this._inputs[U]}registerInput(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;const p=new SW(U,this,0);return p.type=W,p.isOptional=l,p.defaultValue=M,p.value=M,p.valueMin=t,p.valueMax=L,this._inputs.push(p),this.onInputChangedObservable.notifyObservers(p),this}registerOutput(U,W,l){return(l=l??new SW(U,this,1)).type=W,this._outputs.push(l),this}_build(U){}_customBuildStep(U){}build(U){if(this._buildId===U.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((U=>U.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=U.buildId;for(const W of this._inputs){if(!W.connectedPoint){W.isOptional||U.notConnectedNonOptionalInputs.push(W);continue}const l=W.connectedPoint.ownerBlock;l&&l!==this&&!l.isSystem&&l.build(U)}return this._customBuildStep(U),U.verbose&&F.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(U),this.onBuildObservable.notifyObservers(this),!1}serialize(){const U={};U.customType="BABYLON."+this.getClassName(),U.id=this.uniqueId,U.name=this.name,U.visibleOnFrame=this.visibleOnFrame,U.inputs=[],U.outputs=[];for(const W of this.inputs)U.inputs.push(W.serialize());for(const W of this.outputs)U.outputs.push(W.serialize(!1));return U}_deserialize(U){this._name=U.name,this.comments=U.comments,this.visibleOnFrame=!!U.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(U)}_deserializePortDisplayNamesAndExposedOnFrame(U){const W=U.inputs,l=U.outputs;if(W)for(const M of W){const U=this.inputs.find((U=>U.name===M.name));if(!U)return;if(M.displayName&&(U.displayName=M.displayName),M.isExposedOnFrame&&(U.isExposedOnFrame=M.isExposedOnFrame,U.exposedPortPosition=M.exposedPortPosition),void 0!==M.value&&null!==M.value)if("number"===M.valueType)U.value=M.value;else{const W=(0,B.d)(M.valueType);W&&(U.value=W.gk(M.value))}}if(l)for(let M=0;M<l.length;M++){const U=l[M];U.displayName&&(this.outputs[M].displayName=U.displayName),U.isExposedOnFrame&&(this.outputs[M].isExposedOnFrame=U.isExposedOnFrame,this.outputs[M].exposedPortPosition=U.exposedPortPosition)}}clone(){const U=this.serialize(),W=(0,B.d)(U.customType);if(W){const l=new W;return l._deserialize(U),l}return null}dispose(){this.nk.notifyObservers(this),this.nk.clear();for(const U of this.inputs)U.dispose();for(const U of this.outputs)U.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function hW(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",M=arguments.length>3?arguments[3]:void 0;return(t,L)=>{let p=t._propStore;p||(p=[],t._propStore=p),p.push({propertyName:L,displayName:U,type:W,groupName:l,options:M??{},className:t.getClassName()})}}(0,V.e)([(0,n.T)("comment")],cW.prototype,"comments",void 0),function(U){U[U.Boolean=0]="Boolean",U[U.Float=1]="Float",U[U.Int=2]="Int",U[U.Vector2=3]="Vector2",U[U.List=4]="List",U[U.Ak=5]="Ak",U[U.SamplingMode=6]="SamplingMode",U[U.TextureFormat=7]="TextureFormat",U[U.TextureType=8]="TextureType"}(QW||(QW={})),function(U){U[U.None=0]="None",U[U.Position=1]="Position",U[U.Direction=2]="Direction",U[U.Age=3]="Age",U[U.Lifetime=4]="Lifetime",U[U.Color=5]="Color",U[U.ScaledDirection=6]="ScaledDirection",U[U.Scale=7]="Scale",U[U.AgeGradient=8]="AgeGradient",U[U.Angle=9]="Angle",U[U.SpriteCellIndex=16]="SpriteCellIndex",U[U.SpriteCellStart=17]="SpriteCellStart",U[U.SpriteCellEnd=18]="SpriteCellEnd"}(GW||(GW={})),function(U){U[U.None=0]="None",U[U.Time=1]="Time",U[U.Delta=2]="Delta",U[U.Emitter=3]="Emitter"}(uW||(uW={}));class zW{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let U="";for(const W of this.notConnectedNonOptionalInputs)U+=`input ${W.name} from block ${W.ownerBlock.name}[${W.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(U)throw"Build of Node Particle System Set failed:\n"+U}adapt(U,W){const l=U.getConnectedValue(this)||0;if(U.type===W)return l;switch(W){case FW.Vector2:return new M.h(l,l);case FW.ik:return new M.l(l,l,l);case FW.Ak:return new p.f(l,l,l,l)}return null}getContextualValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case GW.Position:return this.particleContext.position;case GW.Direction:return this.particleContext.direction;case GW.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case GW.Color:return this.particleContext.color;case GW.Age:return this.particleContext.age;case GW.Lifetime:return this.particleContext.lifeTime;case GW.Angle:return this.particleContext.angle;case GW.Scale:return this.particleContext.scale;case GW.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case GW.SpriteCellEnd:return this.systemContext.endSpriteCellID;case GW.SpriteCellIndex:return this.particleContext.cellIndex;case GW.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case uW.Time:return this.systemContext._actualFrame;case uW.Delta:return this.systemContext._scaledUpdateSpeed;case uW.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function aW(U,W,l){const M=new zW;M.Gd=W;const t=U.createSystem(M);return t.canStart=()=>!0,t.j=l.clone(),t.disposeOnStop=!0,t.start(),t}class YW extends cW{constructor(U){super(U),this.blendMode=k.BLENDMODE_ONEONE,this.Db=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",FW.Particle),this.registerInput("texture",FW.Texture),this.registerInput("onStart",FW.System,!0),this.registerInput("onEnd",FW.System,!0),this.registerOutput("system",FW.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(U){U.Db=this.Db,U.buildId=this._buildId++,this.build(U);const W=this.particle.getConnectedValue(U);return W.particleTexture=this.texture.getConnectedValue(U),W.emitRate=this.emitRate,W.blendMode=this.blendMode,W.name=this.name,W._nodeGenerated=!0,W._targetStopDuration=this.targetStopDuration,W.startDelay=this.startDelay,this.system._storedValue=this,W.canStart=()=>!this.doNoStart,W.onStartedObservable.add((l=>{const M=this.onStart.getConnectedValue(U);M&&l.onStartedObservable.addOnce((()=>{U.systemContext=W;const l=aW(M,U.Gd,U.emitterPosition);this.nk.addOnce((()=>{l.dispose()}))}));const t=this.onEnd.getConnectedValue(U);t&&l.onStoppedObservable.addOnce((()=>{U.systemContext=W;const l=aW(t,U.Gd,U.emitterPosition);this.nk.addOnce((()=>{l.dispose()}))}))})),this.nk.addOnce((()=>{W.dispose()})),W}serialize(){const U=super.serialize();return U.Db=this.Db,U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.doNoStart=this.doNoStart,U.targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,U}_deserialize(U){super._deserialize(U),this.Db=U.Db,this.emitRate=U.emitRate,this.doNoStart=!!U.doNoStart,void 0!==U.blendMode&&(this.blendMode=U.blendMode),void 0!==U.targetStopDuration&&(this.targetStopDuration=U.targetStopDuration),void 0!==U.startDelay&&(this.startDelay=U.startDelay)}}(0,V.e)([hW("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:k.BLENDMODE_ONEONE},{label:"Standard",value:k.BLENDMODE_STANDARD},{label:"Add",value:k.BLENDMODE_ADD},{label:"Multiply",value:k.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:k.BLENDMODE_MULTIPLYADD}]})],YW.prototype,"blendMode",void 0),(0,V.e)([hW("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],YW.prototype,"Db",void 0),(0,V.e)([hW("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],YW.prototype,"emitRate",void 0),(0,V.e)([hW("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],YW.prototype,"targetStopDuration",void 0),(0,V.e)([hW("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],YW.prototype,"startDelay",void 0),(0,V.e)([hW("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],YW.prototype,"doNoStart",void 0),(0,B.f)("BABYLON.SystemBlock",YW);class XW extends cW{get type(){if(this._type===FW.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=FW.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=FW.Vector2,this._type;case"ik":return this._type=FW.ik,this._type;case"Ak":return this._type=FW.Ak,this._type;case"Matrix":return this._type=FW.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===GW.None&&this._systemSource!==uW.None}get systemSource(){return this._systemSource}set systemSource(U){if(this._systemSource=U,U!==uW.None){switch(this._contextualSource=GW.None,this._type=FW.Float,U){case uW.Time:case uW.Delta:this._type=FW.Float;break;case uW.Emitter:this._type=FW.ik}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==GW.None}get contextualValue(){return this._contextualSource}set contextualValue(U){if(this._contextualSource=U,U!==GW.None){switch(this._systemSource=uW.None,U){case GW.Scale:this._type=FW.Vector2;break;case GW.Position:case GW.Direction:case GW.ScaledDirection:this._type=FW.ik;break;case GW.Color:this._type=FW.Ak;break;case GW.Age:case GW.Lifetime:case GW.Angle:case GW.AgeGradient:this._type=FW.Float;break;case GW.SpriteCellEnd:case GW.SpriteCellStart:case GW.SpriteCellIndex:this._type=FW.Int}this.output&&(this.output.type=this._type)}}constructor(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FW.AutoDetect;super(U),this._type=FW.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new a.b,this._systemSource=uW.None,this._contextualSource=GW.None,this._type=W,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",W)}get value(){return this._storedValue}set value(U){this.type===FW.Float&&this.min!==this.max&&(U=Math.max(this.min,U),U=Math.min(this.max,U)),this._storedValue=U,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(U){this._valueCallback=U}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case FW.Int:case FW.Float:this.value=0;break;case FW.Vector2:this.value=M.h.Zero();break;case FW.ik:this.value=M.l.Zero();break;case FW.Ak:this.value=new p.f(1,1,1,1);break;case FW.Matrix:this.value=M.c.Identity()}}_build(U){super._build(U),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=U=>U.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=U=>U.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const U=super.serialize();return U.type=this.type,U.contextualValue=this.contextualValue,U.systemSource=this.systemSource,U.min=this.min,U.max=this.max,U.groupInInspector=this.groupInInspector,U.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.qk?(U.valueType="BABYLON."+this._storedValue.getClassName(),U.value=this._storedValue.qk()):(U.valueType="number",U.value=this._storedValue)),U}_deserialize(U){if(super._deserialize(U),this._type=U.type,this.contextualValue=U.contextualValue,this.systemSource=U.systemSource||uW.None,this.min=U.min||0,this.max=U.max||0,this.groupInInspector=U.groupInInspector||"",void 0!==U.displayInInspector&&(this.displayInInspector=U.displayInInspector),U.valueType)if("number"===U.valueType)this._storedValue=U.value;else{const W=(0,B.d)(U.valueType);W&&(this._storedValue=W.gk(U.value))}}}(0,B.f)("BABYLON.ParticleInputBlock",XW);class TW extends cW{get url(){return this._url}set url(U){this._url!==U&&(this._cachedData=null,this._url=U,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(U){this._textureDataUrl!==U&&(this._cachedData=null,this._textureDataUrl=U,this._url="",this._sourceTexture=null)}set sourceTexture(U){this._sourceTexture!==U&&(this._cachedData=null,this._sourceTexture=U,this._url="",this._textureDataUrl="")}constructor(U){super(U),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",FW.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const U=this.texture._storedValue;return await new Promise(((W,l)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),W(this._cachedData)}catch(U){l(U)}}));const M=U.getSize();VW.j.GetTextureDataAsync(U,M.width,M.height).then((l=>{this._cachedData={width:M.width,height:M.height,data:new Uint8ClampedArray(l)},U.dispose(),W(this._cachedData)})).catch(l)}))}_build(U){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new I.d(this._textureDataUrl,U.Gd):this.texture._storedValue=new I.d(this._url,U.Gd):this.texture._storedValue=null}serialize(){const U=super.serialize();return U.url=this.url,U.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(U.textureDataUrl=this.textureDataUrl),U}_deserialize(U){super._deserialize(U),this.url=U.url,this.serializedCachedData=!!U.serializedCachedData,U.textureDataUrl&&(this.textureDataUrl=U.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,B.f)("BABYLON.ParticleTextureSourceBlock",TW);class Ul extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("position",FW.ik),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(U){const W=this.particle.getConnectedValue(U);if(this.output._storedValue=W,!this.position.isConnected)return;const l={process:l=>{U.particleContext=l,U.systemContext=W,l.position.p(this.position.getConnectedValue(U))},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l}}(0,B.f)("BABYLON.UpdatePositionBlock",Ul),function(U){U[U.Add=0]="Add",U[U.Subtract=1]="Subtract",U[U.Multiply=2]="Multiply",U[U.Divide=3]="Divide",U[U.Max=4]="Max",U[U.Min=5]="Min"}(bW||(bW={}));class Wl extends cW{constructor(U){super(U),this.operation=bW.Add,this.registerInput("left",FW.AutoDetect),this.registerInput("right",FW.AutoDetect),this.registerOutput("output",FW.BasedOnInput),this.output._typeConnectionSource=this.left;const W=[FW.Matrix,FW.Particle,FW.Texture,FW.System,FW.FloatGradient,FW.Color4Gradient,FW.Vector2Gradient,FW.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...W),this.right.excludedConnectionPointTypes.push(...W),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(U){let W;const l=this.left,t=this.right;if(!l.isConnected||!t.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const L=l.type===FW.Float||l.type===FW.Int,B=t.type===FW.Float||t.type===FW.Int,k=L&&B;switch(this.operation){case bW.Add:W=k?U=>l.getConnectedValue(U)+t.getConnectedValue(U):L?U=>U.adapt(l,t.type).add(t.getConnectedValue(U)):U=>l.getConnectedValue(U).add(U.adapt(t,l.type));break;case bW.Subtract:W=k?U=>l.getConnectedValue(U)-t.getConnectedValue(U):L?U=>U.adapt(l,t.type).de(t.getConnectedValue(U)):U=>l.getConnectedValue(U).de(U.adapt(t,l.type));break;case bW.Multiply:W=k?U=>l.getConnectedValue(U)*t.getConnectedValue(U):L?U=>U.adapt(l,t.type).multiply(t.getConnectedValue(U)):U=>l.getConnectedValue(U).multiply(U.adapt(t,l.type));break;case bW.Divide:W=k?U=>l.getConnectedValue(U)/t.getConnectedValue(U):L?U=>U.adapt(l,t.type).divide(t.getConnectedValue(U)):U=>l.getConnectedValue(U).divide(U.adapt(t,l.type));break;case bW.Min:if(k)W=U=>Math.min(l.getConnectedValue(U),t.getConnectedValue(U));else{const[U,B]=L?[t,l]:[l,t];switch(U.type){case FW.Vector2:W=W=>M.h.Minimize(U.getConnectedValue(W),W.adapt(B,U.type));break;case FW.ik:W=W=>M.l.Minimize(U.getConnectedValue(W),W.adapt(B,U.type));break;case FW.Ak:W=W=>{const l=U.getConnectedValue(W),{r:M,g:t,b:L,a:k}=W.adapt(B,U.type);return new p.f(Math.min(l.r,M),Math.min(l.g,t),Math.min(l.b,L),Math.min(l.a,k))}}}break;case bW.Max:if(!k){const[U,B]=L?[t,l]:[l,t];switch(U.type){case FW.Vector2:W=W=>M.h.Maximize(U.getConnectedValue(W),W.adapt(B,U.type));break;case FW.ik:W=W=>M.l.Maximize(U.getConnectedValue(W),W.adapt(B,U.type));break;case FW.Ak:W=W=>{const l=U.getConnectedValue(W),{r:M,g:t,b:L,a:k}=W.adapt(B,U.type);return new p.f(Math.max(l.r,M),Math.min(l.g,t),Math.min(l.b,L),Math.min(l.a,k))}}break}W=U=>Math.max(l.getConnectedValue(U),t.getConnectedValue(U))}this.output._storedFunction=U=>l.type===FW.Int?0|W(U):W(U)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===FW.Int||this.left.type===FW.Float&&this.right.type!==FW.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[U,W]of[[this.left,this.right],[this.right,this.left]])U.acceptedConnectionPointTypes=[FW.Int,FW.Float],W.isConnected&&(U.acceptedConnectionPointTypes.push(W.type),W.type!==FW.Int&&W.type!==FW.Float||U.acceptedConnectionPointTypes.push(FW.Vector2,FW.ik,FW.Ak))}dispose(){super.dispose();for(const U of this._connectionObservers)U.remove();this._connectionObservers.length=0}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,V.e)([hW("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:bW.Add},{label:"Subtract",value:bW.Subtract},{label:"Multiply",value:bW.Multiply},{label:"Divide",value:bW.Divide},{label:"Max",value:bW.Max},{label:"Min",value:bW.Min}]})],Wl.prototype,"operation",void 0),(0,B.f)("BABYLON.ParticleMathBlock",Wl);class ll extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("direction1",FW.ik,!0,new M.l(0,1,0)),this.registerInput("direction2",FW.ik,!0,new M.l(0,1,0)),this.registerInput("minEmitBox",FW.ik,!0,new M.l(-.5,-.5,-.5)),this.registerInput("maxEmitBox",FW.ik,!0,new M.l(.5,.5,.5)),this.registerOutput("output",FW.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const W=this.particle.getConnectedValue(U);W._directionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.direction1.getConnectedValue(U),L=this.direction2.getConnectedValue(U),p=(0,A.RandomRange)(t.x,L.x),B=(0,A.RandomRange)(t.y,L.y),k=(0,A.RandomRange)(t.z,L.z);U.isEmitterTransformNode?M.l.TransformNormalFromFloatsToRef(p,B,k,U.emitterWorldMatrix,l.direction):l.direction.wd(p,B,k)},W._positionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.minEmitBox.getConnectedValue(U),L=this.maxEmitBox.getConnectedValue(U),p=(0,A.RandomRange)(t.x,L.x),B=(0,A.RandomRange)(t.y,L.y),k=(0,A.RandomRange)(t.z,L.z);U.isEmitterTransformNode?M.l.TransformCoordinatesFromFloatsToRef(p,B,k,U.emitterWorldMatrix,l.position):(l.position.wd(p,B,k),l.position.addInPlace(U.emitterPosition))},this.output._storedValue=W}}(0,B.f)("BABYLON.BoxShapeBlock",ll);class Ml extends cW{constructor(U){super(U),this.registerInput("emitPower",FW.Float,!0,1),this.registerInput("lifeTime",FW.Float,!0,1),this.registerInput("color",FW.Ak,!0,new p.f(1,1,1,1)),this.registerInput("scale",FW.Vector2,!0,new M.h(1,1)),this.registerInput("angle",FW.Float,!0,0),this.registerOutput("particle",FW.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(U){const W=new BW(this.name,U.Db,U.Gd,null,!1,void 0,!0);W.particleEmitterType=new m,W._lifeTimeCreation.process=(W,l)=>{U.particleContext=W,W.lifeTime=this.lifeTime.getConnectedValue(U),l._emitPower=this.emitPower.getConnectedValue(U)},W._colorCreation.process=W=>{U.particleContext=W,W.color.p(this.color.getConnectedValue(U))},W._sizeCreation.process=W=>{U.particleContext=W,W.size=1,W.scale.p(this.scale.getConnectedValue(U))},W._angleCreation.process=W=>{U.particleContext=W,W.angle=this.angle.getConnectedValue(U)},this.particle._storedValue=W}}(0,B.f)("BABYLON.CreateParticleBlock",Ml);class tl{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const U=[];for(const W of this.attachedBlocks)W.isInput&&U.push(W);return U}constructor(U){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new a.b,this.name=U}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(U){let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(U)&&this.attachedBlocks.push(U);for(const l of U.inputs){const M=l.connectedPoint;if(M){const l=M.ownerBlock;l!==U&&this._initializeBlock(l,W)}}}async buildAsync(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((l=>{const M=new DW;for(const U of this._systemBlocks)this._initializeBlock(U);for(const t of this.systemBlocks){const l=new zW;l.buildId=this._buildId++,l.Gd=U,l.verbose=W;const L=t.createSystem(l);l.emitErrors(),M.systems.push(L)}this.onBuildObservable.notifyObservers(this),l(M)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const U=new YW("Particle system"),W=new Ul("Update position");W.output.connectTo(U.particle);const l=new XW("Position");l.contextualValue=GW.Position;const M=new XW("Scaled direction");M.contextualValue=GW.ScaledDirection;const t=new Wl("Add");t.operation=bW.Add,l.output.connectTo(t.left),M.output.connectTo(t.right),t.output.connectTo(W.position);const L=new Ml("Create particle"),p=new ll("Box shape");L.particle.connectTo(p.particle),p.output.connectTo(W.particle);const B=new TW("Texture");B.texture.connectTo(U.texture),B.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(U)}removeBlock(U){const W=this.attachedBlocks.indexOf(U);if(W>-1&&this.attachedBlocks.splice(W,1),U.isSystem){const W=this._systemBlocks.indexOf(U);W>-1&&this._systemBlocks.splice(W,1)}}parseSerializedObject(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];W||this.clear();const l={};for(const M of U.$g){const U=(0,B.d)(M.customType);if(U){const W=new U;W._deserialize(M),l[M.id]=W,this.attachedBlocks.push(W),W.isSystem&&this._systemBlocks.push(W)}}for(const M of this.attachedBlocks)if(M.isTeleportOut){const U=M,W=U._tempEntryPointUniqueId;if(W){const M=l[W];M&&M.attachToEndpoint(U)}}for(let M=0;M<U.$g.length;M++){const t=U.$g[M],L=l[t.id];L&&(L.inputs.length&&t.inputs.some((U=>U.targetConnectionName))&&!W||this._restoreConnections(L,U,l))}if(U.locations||U.editorData&&U.editorData.locations){const M=U.locations||U.editorData.locations;for(const U of M)l[U.blockId]&&(U.blockId=l[U.blockId].uniqueId);W&&this.editorData&&this.editorData.locations&&M.concat(this.editorData.locations),U.locations?this.editorData={locations:M}:(this.editorData=U.editorData,this.editorData.locations=M);const t=[];for(const U in l)t[U]=l[U].uniqueId;this.editorData.map=t}this.comment=U.comment}_restoreConnections(U,W,l){for(const M of U.outputs)for(const t of W.$g){const L=l[t.id];if(L)for(const p of t.inputs)if(l[p.targetBlockId]!==U||p.targetConnectionName!==M.name);else{const U=L.getInputByName(p.inputName);if(!U||U.isConnected)continue;M.connectTo(U,!0),this._restoreConnections(L,W,l)}}}serialize(U){const W=U?{}:x.e.Serialize(this);W.editorData=JSON.parse(JSON.stringify(this.editorData));let l=[];U?l=U:W.customType="BABYLON.NodeParticleSystemSet",W.$g=[];for(const M of l)W.$g.push(M.serialize());if(!U)for(const M of this.attachedBlocks)-1===l.indexOf(M)&&W.$g.push(M.serialize());return W}dispose(){for(const U of this.attachedBlocks)U.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(U){const W=new tl(U);return W.setToDefault(),W}static Parse(U){const W=x.e.Parse((()=>new tl(U.name)),U,null);return W.parseSerializedObject(U),W}static ParseFromSnippetAsync(U,W){return"_BLANK"===U?Promise.resolve(tl.CreateDefault("blank")):new Promise(((l,M)=>{const t=new oW.c;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const p=JSON.parse(JSON.parse(t.responseText).jsonPayload),B=JSON.parse(p.nodeParticle);W||(W=x.e.Parse((()=>new tl(U)),B,null)),W.parseSerializedObject(B),W.snippetId=U;try{l(W)}catch(L){M(L)}}else M("Unable to load the snippet "+U)})),t.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),t.send()}))}}tl.EditorURL=`${EW.h._DefaultCdnUrl}/v${hU.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,tl.SnippetUrl="https://snippet.babylonjs.com",(0,V.e)([(0,n.T)()],tl.prototype,"name",void 0),(0,V.e)([(0,n.T)("comment")],tl.prototype,"comment",void 0),function(U){U[U.None=0]="None",U[U.PerParticle=1]="PerParticle",U[U.PerSystem=2]="PerSystem"}(CW||(CW={}));class Ll extends cW{constructor(U){super(U),this._currentLockId=-2,this.lockMode=CW.PerParticle,this.registerInput("min",FW.AutoDetect,!0,0),this.registerInput("max",FW.AutoDetect,!0,1),this.registerOutput("output",FW.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FW.Float|FW.Int|FW.Vector2|FW.ik|FW.Ak),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(FW.Float|FW.Int|FW.Vector2|FW.ik|FW.Ak),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=FW.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case FW.AutoDetect:case FW.Int:case FW.Float:U=U=>{const W=this.min.getConnectedValue(U)||0,l=this.max.getConnectedValue(U)||1;return W+Math.random()*(l-W)};break;case FW.Vector2:U=U=>{const W=this.min.getConnectedValue(U)||M.h.Zero(),l=this.max.getConnectedValue(U)||M.h.One();return new M.h(W.x+Math.random()*(l.x-W.x),W.y+Math.random()*(l.y-W.y))};break;case FW.ik:U=U=>{const W=this.min.getConnectedValue(U)||M.l.Zero(),l=this.max.getConnectedValue(U)||M.l.One();return new M.l(W.x+Math.random()*(l.x-W.x),W.y+Math.random()*(l.y-W.y),W.z+Math.random()*(l.z-W.z))};break;case FW.Ak:U=U=>{const W=this.min.getConnectedValue(U)||new p.f(0,0,0,0),l=this.max.getConnectedValue(U)||new p.f(1,1,1,1);return new p.f(W.x+Math.random()*(l.x-W.x),W.y+Math.random()*(l.y-W.y),W.z+Math.random()*(l.z-W.z),W.w+Math.random()*(l.w-W.w))}}this.output._storedFunction=W=>{var l;let M=0;switch(this.lockMode){case CW.PerParticle:M=(null===(l=W.particleContext)||void 0===l?void 0:l.id)||-1;break;case CW.PerSystem:M=W.buildId||0}return this._currentLockId!==M&&(this.lockMode!==CW.None&&(this._currentLockId=M),this.output._storedValue=U(W)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),this.lockMode=U.lockMode}}(0,V.e)([hW("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:CW.None},{label:"Per particle",value:CW.PerParticle},{label:"Per system",value:CW.PerSystem}]})],Ll.prototype,"lockMode",void 0),(0,B.f)("BABYLON.ParticleRandomBlock",Ll);class pl extends cW{constructor(U){super(U),this._currentLockId=-2,this.lockMode=CW.PerParticle,this.registerInput("min",FW.AutoDetect),this.registerInput("max",FW.AutoDetect),this.registerOutput("output",FW.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const W=[FW.Matrix,FW.Particle,FW.Texture,FW.System,FW.FloatGradient,FW.Color4Gradient,FW.Vector2Gradient,FW.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...W),this.max.excludedConnectionPointTypes.push(...W)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case FW.Float:case FW.Int:U=U=>{const W=this.min.getConnectedValue(U),l=this.max.getConnectedValue(U);return Math.random()*(l-W)+W};break;case FW.Vector2:U=U=>{const W=this.min.getConnectedValue(U),l=this.max.getConnectedValue(U);return new M.h(Math.random()*(l.x-W.x)+W.x,Math.random()*(l.y-W.y)+W.y)};break;case FW.ik:U=U=>{const W=this.min.getConnectedValue(U),l=this.max.getConnectedValue(U);return new M.l(Math.random()*(l.x-W.x)+W.x,Math.random()*(l.y-W.y)+W.y,Math.random()*(l.z-W.z)+W.z)};break;case FW.Ak:U=U=>{const W=this.min.getConnectedValue(U),l=this.max.getConnectedValue(U);return new p.f(Math.random()*(l.r-W.r)+W.r,Math.random()*(l.g-W.g)+W.g,Math.random()*(l.b-W.b)+W.b,Math.random()*(l.a-W.a)+W.a)}}this.output._storedFunction=W=>{var l;let M=0;switch(this.lockMode){case CW.PerParticle:M=(null===(l=W.particleContext)||void 0===l?void 0:l.id)||-1;break;case CW.PerSystem:M=W.buildId||0}return this._currentLockId!==M&&(this.lockMode!==CW.None&&(this._currentLockId=M),this.output._storedValue=U(W)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),void 0!==U.lockMode&&(this.lockMode=U.lockMode)}}(0,V.e)([hW("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:CW.None},{label:"Per particle",value:CW.PerParticle},{label:"Per system",value:CW.PerSystem}]})],pl.prototype,"lockMode",void 0),(0,B.f)("BABYLON.RandomRangeBlock",pl);(0,B.f)("BABYLON.ParticleLerpBlock",class extends cW{constructor(U){super(U),this.registerInput("left",FW.AutoDetect),this.registerInput("right",FW.AutoDetect),this.registerInput("gradient",FW.Float,!0,0,0,1),this.registerOutput("output",FW.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FW.Float|FW.Int|FW.Vector2|FW.ik|FW.Ak)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const U=(U,W,l)=>(1-U)*W+U*l;this.output._storedFunction=W=>{const l=this.left.getConnectedValue(W),t=this.right.getConnectedValue(W),L=this.gradient.getConnectedValue(W);switch(this.left.type){case FW.Int:case FW.Float:return U(L,l,t);case FW.Vector2:return new M.h(U(L,l.x,t.x),U(L,l.y,t.y));case FW.ik:return new M.l(U(L,l.x,t.x),U(L,l.y,t.y),U(L,l.z,t.z));case FW.Ak:return new p.f(U(L,l.r,t.r),U(L,l.g,t.g),U(L,l.b,t.b),U(L,l.a,t.a))}return 0}}});(0,B.f)("BABYLON.UpdateDirectionBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("direction",FW.ik),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(U){const W=this.particle.getConnectedValue(U);if(this.output._storedValue=W,!this.direction.isConnected)return;const l={process:l=>{U.particleContext=l,U.systemContext=W,l.direction.p(this.direction.getConnectedValue(U))},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l}});(0,B.f)("BABYLON.UpdateColorBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("color",FW.Ak),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(U){const W=this.particle.getConnectedValue(U);if(this.output._storedValue=W,!this.color.isConnected)return;const l={process:l=>{U.particleContext=l,U.systemContext=W,l.color.p(this.color.getConnectedValue(U))},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l}});(0,B.f)("BABYLON.UpdateScaleBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("scale",FW.Vector2),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(U){const W=this.particle.getConnectedValue(U);if(this.output._storedValue=W,!this.scale.isConnected)return;const l={process:l=>{U.particleContext=l,U.systemContext=W,l.scale.p(this.scale.getConnectedValue(U))},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l}});(0,B.f)("BABYLON.UpdateAngleBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("angle",FW.Float),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(U){const W=this.particle.getConnectedValue(U);if(this.output._storedValue=W,!this.angle.isConnected)return;const l={process:l=>{U.particleContext=l,U.systemContext=W,l.angle=this.angle.getConnectedValue(U)},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l}});(0,B.f)("BABYLON.BasicPositionUpdateBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(U){const W=this.particle.getConnectedValue(U),l={process:l=>{U.particleContext=l,U.systemContext=W,l.direction.scaleToRef(W._directionScale,W._scaledDirection),l.position.addInPlace(W._scaledDirection)},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l,this.output._storedValue=W}});(0,B.f)("BABYLON.BasicSpriteUpdateBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(U){const W=this.particle.getConnectedValue(U),l={process:l=>{U.particleContext=l,U.systemContext=W,l.updateCellIndex()},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l,this.output._storedValue=W}});(0,B.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("cellIndex",FW.Int),this.registerOutput("output",FW.Particle),this.cellIndex.acceptedConnectionPointTypes=[FW.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(U){const W=this.particle.getConnectedValue(U);if(this.output._storedValue=W,!this.cellIndex.isConnected)return;const l={process:l=>{U.particleContext=l,U.systemContext=W,l.cellIndex=Math.floor(this.cellIndex.getConnectedValue(U))},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l}});class Bl extends cW{constructor(U){super(U),this.strength=1,this.registerInput("particle",FW.Particle),this.registerInput("flowMap",FW.Texture),this.registerOutput("output",FW.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(U){var W;const l=this.particle.getConnectedValue(U),M=U.Gd;let t;(null===(W=this.flowMap.connectedPoint)||void 0===W?void 0:W.ownerBlock).extractTextureContentAsync().then((U=>{U&&(t=new RW(U.width,U.height,U.data))}));const L={process:U=>{const W=M.getTransformMatrix();t&&t._processParticle(U,this.strength*l._tempScaledUpdateSpeed,W)},previousItem:null,nextItem:null};l._updateQueueStart?uU(L,l._updateQueueStart):l._updateQueueStart=L,this.output._storedValue=l}serialize(){const U=super.serialize();return U.strength=this.strength,U}_deserialize(U){super._deserialize(U),this.strength=U.strength}}(0,V.e)([hW("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bl.prototype,"strength",void 0),(0,B.f)("BABYLON.UpdateFlowMapBlock",Bl);(0,B.f)("BABYLON.SphereShapeBlock",class extends cW{constructor(U){super(U),this.registerInput("input",FW.Particle),this.registerInput("radius",FW.Float,!0,1),this.registerInput("radiusRange",FW.Float,!0,1,0,1),this.registerInput("directionRandomizer",FW.Float,!0,0,0,1),this.registerOutput("output",FW.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(U){const W=this.input.getConnectedValue(U);W._directionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.directionRandomizer.getConnectedValue(U),L=l.position.de(U.emitterPosition).normalize(),p=(0,A.RandomRange)(0,t),B=(0,A.RandomRange)(0,t),k=(0,A.RandomRange)(0,t);L.x+=p,L.y+=B,L.z+=k,L.normalize(),U.isEmitterTransformNode?M.l.TransformNormalFromFloatsToRef(p,B,k,U.emitterWorldMatrix,l.direction):l.direction.wd(p,B,k)},W._positionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.radius.getConnectedValue(U),L=this.radiusRange.getConnectedValue(U),p=t-(0,A.RandomRange)(0,t*L),B=(0,A.RandomRange)(0,1),k=(0,A.RandomRange)(0,2*Math.PI),q=Math.acos(2*B-1),y=p*Math.cos(k)*Math.sin(q),j=p*Math.cos(q),s=p*Math.sin(k)*Math.sin(q);U.isEmitterTransformNode?M.l.TransformCoordinatesFromFloatsToRef(y,j,s,U.emitterWorldMatrix,l.position):(l.position.wd(y,j,s),l.position.addInPlace(U.emitterPosition))},this.output._storedValue=W}});(0,B.f)("BABYLON.PointShapeBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("direction1",FW.ik,!0,new M.l(0,1,0)),this.registerInput("direction2",FW.ik,!0,new M.l(0,1,0)),this.registerOutput("output",FW.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const W=this.particle.getConnectedValue(U);W._directionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.direction1.getConnectedValue(U),L=this.direction2.getConnectedValue(U),p=(0,A.RandomRange)(t.x,L.x),B=(0,A.RandomRange)(t.y,L.y),k=(0,A.RandomRange)(t.z,L.z);U.isEmitterTransformNode?M.l.TransformNormalFromFloatsToRef(p,B,k,U.emitterWorldMatrix,l.direction):l.direction.wd(p,B,k)},W._positionCreation.process=l=>{U.systemContext=W,U.isEmitterTransformNode?M.l.TransformCoordinatesFromFloatsToRef(0,0,0,U.emitterWorldMatrix,l.position):l.position.p(U.emitterPosition)},this.output._storedValue=W}});(0,B.f)("BABYLON.CustomShapeBlock",class extends cW{constructor(U){super(U),this.registerInput("particle",FW.Particle),this.registerInput("position",FW.ik,!0,new M.l(0,0,0)),this.registerInput("direction",FW.ik,!0,new M.l(0,1,0)),this.registerOutput("output",FW.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const W=this.particle.getConnectedValue(U);W._directionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.direction.getConnectedValue(U);U.isEmitterTransformNode?M.l.TransformNormalToRef(t,U.emitterWorldMatrix,l.direction):l.direction.p(t)},W._positionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.position.getConnectedValue(U);U.isEmitterTransformNode?M.l.TransformCoordinatesToRef(t,U.emitterWorldMatrix,l.position):(l.position.p(t),l.position.addInPlace(U.emitterPosition))},this.output._storedValue=W}});(0,B.f)("BABYLON.CylinderShapeBlock",class extends cW{constructor(U){super(U),this._tempVector=M.l.Zero(),this.registerInput("particle",FW.Particle),this.registerInput("radius",FW.Float,!0,1),this.registerInput("height",FW.Float,!0,1,0),this.registerInput("radiusRange",FW.Float,!0,1,0,1),this.registerInput("directionRandomizer",FW.Float,!0,0,0,1),this.registerOutput("output",FW.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const W=this.particle.getConnectedValue(U);W._directionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.directionRandomizer.getConnectedValue(U);l.position.subtractToRef(U.emitterPosition,this._tempVector),this._tempVector.normalize(),U.isEmitterTransformNode&&M.l.TransformNormalToRef(this._tempVector,U.emitterInverseWorldMatrix,this._tempVector);const L=(0,A.RandomRange)(-t/2,t/2);let p=Math.atan2(this._tempVector.x,this._tempVector.z);p+=(0,A.RandomRange)(-Math.PI/2,Math.PI/2)*t,this._tempVector.y=L,this._tempVector.x=Math.sin(p),this._tempVector.z=Math.cos(p),this._tempVector.normalize(),U.isEmitterTransformNode?M.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U.emitterWorldMatrix,l.direction):l.direction.p(this._tempVector)},W._positionCreation.process=l=>{U.particleContext=l,U.systemContext=W;const t=this.height.getConnectedValue(U),L=this.radiusRange.getConnectedValue(U),p=this.radius.getConnectedValue(U),B=(0,A.RandomRange)(-t/2,t/2),k=(0,A.RandomRange)(0,2*Math.PI),q=(0,A.RandomRange)((1-L)*(1-L),1),y=Math.sqrt(q)*p,j=y*Math.cos(k),s=y*Math.sin(k);U.isEmitterTransformNode?M.l.TransformCoordinatesFromFloatsToRef(j,B,s,U.emitterWorldMatrix,l.position):(l.position.wd(j,B,s),l.position.addInPlace(U.emitterPosition))},this.output._storedValue=W}});class kl extends cW{constructor(U){super(U),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",FW.Particle),this.registerOutput("output",FW.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const W=this.particle.getConnectedValue(U);W._isAnimationSheetEnabled=!0,W.spriteCellWidth=this.width,W.spriteCellHeight=this.height,W.startSpriteCellID=this.start,W.endSpriteCellID=this.end,W.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=W}serialize(){const U=super.serialize();return U.width=this.width,U.height=this.height,U.start=this.start,U.end=this.end,U.randomStartCell=this.randomStartCell,U}_deserialize(U){super._deserialize(U),this.width=U.width,this.height=U.height,this.start=U.start,this.end=U.end,this.randomStartCell=U.randomStartCell}}(0,V.e)([hW("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kl.prototype,"start",void 0),(0,V.e)([hW("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kl.prototype,"end",void 0),(0,V.e)([hW("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kl.prototype,"width",void 0),(0,V.e)([hW("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kl.prototype,"height",void 0),(0,V.e)([hW("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kl.prototype,"loop",void 0),(0,V.e)([hW("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kl.prototype,"randomStartCell",void 0),(0,B.f)("BABYLON.SetupSpriteSheetBlock",kl);class Al extends cW{constructor(U){super(U),this.reference=0,this.registerInput("value",FW.AutoDetect),this.registerOutput("output",FW.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case FW.Float:return FW.FloatGradient;case FW.Vector2:return FW.Vector2Gradient;case FW.ik:return FW.Vector3Gradient;case FW.Ak:return FW.Color4Gradient}return U},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FW.Float|FW.Vector2|FW.ik|FW.Ak)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=U=>null}serialize(){const U=super.serialize();return U.reference=this.reference,U}_deserialize(U){super._deserialize(U),this.reference=U.reference}}(0,V.e)([hW("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Al.prototype,"reference",void 0),(0,B.f)("BABYLON.ParticleGradientValueBlock",Al);(0,B.f)("BABYLON.ParticleGradientBlock",class extends cW{constructor(U){super(U),this._entryCount=1,this.registerInput("gradient",FW.Float,!0,1,0,1),this.registerInput("value0",FW.AutoDetect),this.registerOutput("output",FW.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case FW.FloatGradient:return FW.Float;case FW.Vector2Gradient:return FW.Vector2;case FW.Vector3Gradient:return FW.ik;case FW.Color4Gradient:return FW.Ak}return U},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(FW.FloatGradient|FW.Vector2Gradient|FW.Vector3Gradient|FW.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(U){this._inputs[U].onConnectionObservable.add((()=>{this._entryCount>U||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),FW.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const U=[];for(let l=1;l<this._inputs.length;l++){var W;if(this._inputs[l].isConnected)U.push(null===(W=this._inputs[l].connectedPoint)||void 0===W?void 0:W.ownerBlock)}U.sort(((U,W)=>U.reference-W.reference)),this.output._storedFunction=W=>{const l=this.gradient.getConnectedValue(W);if(1===U.length)return U[0].value.getConnectedValue(W);let t=null;for(let L=U.length-1;L>=0;L--){const B=U[L];if(B.reference<=l){const U=B.value.getConnectedValue(W);if(t){const L=t.value.getConnectedValue(W),k=t.reference,q=B.reference,y=Math.max(0,Math.min(1,(l-q)/(k-q)));switch(this.output.type){case FW.Float:return(0,A.Lerp)(U,L,y);case FW.Vector2:return M.h.Lerp(U,L,y);case FW.ik:return M.l.Lerp(U,L,y);case FW.Ak:return p.f.Lerp(U,L,y)}}return U}t=B}return 0}}});(0,B.f)("BABYLON.ParticleConverterBlock",class extends cW{constructor(U){super(U),this.registerInput("color ",FW.Ak,!0),this.registerInput("xyz ",FW.ik,!0),this.registerInput("xy ",FW.Vector2,!0),this.registerInput("zw ",FW.Vector2,!0),this.registerInput("x ",FW.Float,!0),this.registerInput("y ",FW.Float,!0),this.registerInput("z ",FW.Float,!0),this.registerInput("w ",FW.Float,!0),this.registerOutput("color",FW.Ak),this.registerOutput("xyz",FW.ik),this.registerOutput("xy",FW.Vector2),this.registerOutput("zw",FW.Vector2),this.registerOutput("x",FW.Float),this.registerOutput("y",FW.Float),this.registerOutput("z",FW.Float),this.registerOutput("w",FW.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(U){return"color "===U?"colorIn":"xyz "===U?"xyzIn":"xy "===U?"xyIn":"zw "===U?"zwIn":"x "===U?"xIn":"y "===U?"yIn":"z "===U?"zIn":"w "===U?"wIn":U}_outputRename(U){switch(U){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return U}}_build(U){super._build(U);const W=this.xIn,l=this.yIn,t=this.zIn,L=this.wIn,B=this.xyIn,k=this.zwIn,A=this.xyzIn,q=this.colorIn,y=this.colorOut,j=this.xyzOut,s=this.xyOut,w=this.zwOut,K=this.xOut,r=this.yOut,m=this.zOut,f=this.wOut,g=U=>{if(q.isConnected)return q.getConnectedValue(U);let M=0,y=0,j=0,s=0;if(W.isConnected&&(M=W.getConnectedValue(U)),l.isConnected&&(y=l.getConnectedValue(U)),t.isConnected&&(j=t.getConnectedValue(U)),L.isConnected&&(s=L.getConnectedValue(U)),B.isConnected){const W=B.getConnectedValue(U);W&&(M=W.x,y=W.y)}if(k.isConnected){const W=k.getConnectedValue(U);W&&(j=W.x,s=W.y)}if(A.isConnected){const W=A.getConnectedValue(U);W&&(M=W.x,y=W.y,j=W.z)}return new p.f(M,y,j,s)};y._storedFunction=U=>g(U),j._storedFunction=U=>{const W=g(U);return new M.l(W.r,W.g,W.b)},s._storedFunction=U=>{const W=g(U);return new M.h(W.r,W.g)},w._storedFunction=U=>{const W=g(U);return new M.h(W.b,W.a)},K._storedFunction=U=>g(U).r,r._storedFunction=U=>g(U).g,m._storedFunction=U=>g(U).b,f._storedFunction=U=>g(U).a}}),function(U){U[U.Cos=0]="Cos",U[U.Sin=1]="Sin",U[U.Abs=2]="Abs",U[U.Exp=3]="Exp",U[U.Exp2=4]="Exp2",U[U.Round=5]="Round",U[U.Floor=6]="Floor",U[U.Ceiling=7]="Ceiling",U[U.Sqrt=8]="Sqrt",U[U.Log=9]="Log",U[U.Tan=10]="Tan",U[U.ArcTan=11]="ArcTan",U[U.ArcCos=12]="ArcCos",U[U.ArcSin=13]="ArcSin",U[U.Sign=14]="Sign",U[U.Negate=15]="Negate",U[U.OneMinus=16]="OneMinus",U[U.Reciprocal=17]="Reciprocal",U[U.ToDegrees=18]="ToDegrees",U[U.ToRadians=19]="ToRadians",U[U.Fract=20]="Fract"}(PW||(PW={}));class ql extends cW{constructor(U){super(U),this.operation=PW.Cos,this.registerInput("input",FW.AutoDetect),this.registerOutput("output",FW.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FW.Float|FW.Int|FW.Vector2|FW.ik|FW.Ak)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);let W=null;switch(this.operation){case PW.Cos:W=U=>Math.cos(U);break;case PW.Sin:W=U=>Math.sin(U);break;case PW.Abs:W=U=>Math.abs(U);break;case PW.Exp:W=U=>Math.exp(U);break;case PW.Exp2:W=U=>Math.pow(2,U);break;case PW.Round:W=U=>Math.round(U);break;case PW.Floor:W=U=>Math.floor(U);break;case PW.Ceiling:W=U=>Math.ceil(U);break;case PW.Sqrt:W=U=>Math.sqrt(U);break;case PW.Log:W=U=>Math.log(U);break;case PW.Tan:W=U=>Math.tan(U);break;case PW.ArcTan:W=U=>Math.atan(U);break;case PW.ArcCos:W=U=>Math.acos(U);break;case PW.ArcSin:W=U=>Math.asin(U);break;case PW.Sign:W=U=>Math.sign(U);break;case PW.Negate:W=U=>-U;break;case PW.OneMinus:W=U=>1-U;break;case PW.Reciprocal:W=U=>1/U;break;case PW.ToRadians:W=U=>U*Math.PI/180;break;case PW.ToDegrees:W=U=>180*U/Math.PI;break;case PW.Fract:W=U=>U>=0?U-Math.floor(U):U-Math.ceil(U)}if(!W)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case FW.Int:case FW.Float:this.output._storedFunction=U=>{const l=this.input.getConnectedValue(U);return W(l)};break;case FW.Vector2:this.output._storedFunction=U=>{const l=this.input.getConnectedValue(U);return new M.h(W(l.x),W(l.y))};break;case FW.ik:this.output._storedFunction=U=>{const l=this.input.getConnectedValue(U);return new M.l(W(l.x),W(l.y),W(l.z))};break;case FW.Ak:this.output._storedFunction=U=>{const l=this.input.getConnectedValue(U);return new p.f(W(l.r),W(l.g),W(l.b),W(l.a))}}return this}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,V.e)([hW("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:PW.Cos},{label:"Sin",value:PW.Sin},{label:"Abs",value:PW.Abs},{label:"Exp",value:PW.Exp},{label:"Exp2",value:PW.Exp2},{label:"Round",value:PW.Round},{label:"Floor",value:PW.Floor},{label:"Ceiling",value:PW.Ceiling},{label:"Sqrt",value:PW.Sqrt},{label:"Log",value:PW.Log},{label:"Tan",value:PW.Tan},{label:"ArcTan",value:PW.ArcTan},{label:"ArcCos",value:PW.ArcCos},{label:"ArcSin",value:PW.ArcSin},{label:"Sign",value:PW.Sign},{label:"Negate",value:PW.Negate},{label:"OneMinus",value:PW.OneMinus},{label:"Reciprocal",value:PW.Reciprocal},{label:"ToDegrees",value:PW.ToDegrees},{label:"ToRadians",value:PW.ToRadians},{label:"Fract",value:PW.Fract}]})],ql.prototype,"operation",void 0),(0,B.f)("BABYLON.ParticleTrigonometryBlock",ql);var yl,jl=l(12394);class sl extends cW{constructor(U){super(U),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",FW.AutoDetect),this.registerOutput("output",FW.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(FW.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(FW.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(FW.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(FW.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(FW.System),this._inputs[0].excludedConnectionPointTypes.push(FW.Particle),this._inputs[0].excludedConnectionPointTypes.push(FW.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const W=U=>{const W=this.input.getConnectedValue(U);if(this.log.length>=this.stackSize)return W;if(null===W||void 0===W)return this.log.push(["null",""]),W;switch(this.input.type){case FW.Vector2:this.log.push([(0,jl.i)(W,4),W.toString()]);break;case FW.ik:this.log.push([(0,jl.m)(W,4),W.toString()]);break;case FW.Ak:this.log.push([`{R: ${W.r.toFixed(4)} G: ${W.g.toFixed(4)} B: ${W.b.toFixed(4)} A: ${W.a.toFixed(4)}}`,W.toString()]);break;default:this.log.push([W.toString(),W.toString()])}return W};this.output.isConnected?this.output._storedFunction=W:this.output._storedValue=W(U)}serialize(){const U=super.serialize();return U.stackSize=this.stackSize,U}_deserialize(U){super._deserialize(U),this.stackSize=U.stackSize}}(0,V.e)([hW("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],sl.prototype,"stackSize",void 0),(0,B.f)("BABYLON.ParticleDebugBlock",sl);(0,B.f)("BABYLON.ParticleElbowBlock",class extends cW{constructor(U){super(U),this.registerInput("input",FW.AutoDetect),this.registerOutput("output",FW.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const W=this._outputs[0],l=this._inputs[0];W._storedFunction=U=>l.getConnectedValue(U)}});(0,B.f)("BABYLON.ParticleTeleportInBlock",class extends cW{get endpoints(){return this._endpoints}constructor(U){super(U),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",FW.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const W of this.endpoints)if(W.isAnAncestorOfType(U))return!0;return!1}isAnAncestorOf(U){for(const W of this.endpoints){if(W===U)return!0;if(W.isAnAncestorOf(U))return!0}return!1}attachToEndpoint(U){U.detach(),this._endpoints.push(U),U._entryPoint=this,U._outputs[0]._typeConnectionSource=this._inputs[0],U._tempEntryPointUniqueId=null,U.name="> "+this.name}detachFromEndpoint(U){const W=this._endpoints.indexOf(U);-1!==W&&(this._endpoints.splice(W,1),U._outputs[0]._typeConnectionSource=null,U._entryPoint=null)}_build(){for(const U of this._endpoints)U.output._storedFunction=U=>this.input.getConnectedValue(U)}});(0,B.f)("BABYLON.ParticleTeleportOutBlock",class extends cW{constructor(U){super(U),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",FW.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(U){this.entryPoint&&this.entryPoint.build(U)}clone(){const U=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(U),U}serialize(){var U;const W=super.serialize();return W.entryPoint=(null===(U=this.entryPoint)||void 0===U?void 0:U.uniqueId)??"",W}_deserialize(U){super._deserialize(U),this._tempEntryPointUniqueId=U.entryPoint}}),function(U){U[U.Equal=0]="Equal",U[U.NotEqual=1]="NotEqual",U[U.LessThan=2]="LessThan",U[U.GreaterThan=3]="GreaterThan",U[U.LessOrEqual=4]="LessOrEqual",U[U.GreaterOrEqual=5]="GreaterOrEqual",U[U.Xor=6]="Xor",U[U.Or=7]="Or",U[U.And=8]="And"}(yl||(yl={}));class wl extends cW{constructor(U){super(U),this.test=yl.Equal,this.epsilon=0,this.registerInput("left",FW.Float),this.registerInput("right",FW.Float,!0,0),this.registerInput("ifTrue",FW.AutoDetect,!0,1),this.registerInput("ifFalse",FW.AutoDetect,!0,0),this.registerOutput("output",FW.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=FW.Float,this._inputs[0].acceptedConnectionPointTypes.push(FW.Int),this._inputs[1].acceptedConnectionPointTypes.push(FW.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const U=U=>{const W=this.left.getConnectedValue(U),l=this.right.getConnectedValue(U);let M=!1;switch(this.test){case yl.Equal:M=(0,A.WithinEpsilon)(W,l,this.epsilon);break;case yl.NotEqual:M=!(0,A.WithinEpsilon)(W,l,this.epsilon);break;case yl.LessThan:M=W<l+this.epsilon;break;case yl.GreaterThan:M=W>l-this.epsilon;break;case yl.LessOrEqual:M=W<=l+this.epsilon;break;case yl.GreaterOrEqual:M=W>=l-this.epsilon;break;case yl.Xor:M=!!W&&!l||!W&&!!l;break;case yl.Or:M=!!W||!!l;break;case yl.And:M=!!W&&!!l}return M};this.output._storedFunction=W=>U(W)?this.ifTrue.getConnectedValue(W):this.ifFalse.getConnectedValue(W)}serialize(){const U=super.serialize();return U.test=this.test,U.epsilon=this.epsilon,U}_deserialize(U){super._deserialize(U),this.test=U.test,void 0!==U.epsilon&&(this.epsilon=U.epsilon)}}(0,V.e)([hW("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:yl.Equal},{label:"NotEqual",value:yl.NotEqual},{label:"LessThan",value:yl.LessThan},{label:"GreaterThan",value:yl.GreaterThan},{label:"LessOrEqual",value:yl.LessOrEqual},{label:"GreaterOrEqual",value:yl.GreaterOrEqual},{label:"Xor",value:yl.Xor},{label:"Or",value:yl.Or},{label:"And",value:yl.And}]})],wl.prototype,"test",void 0),(0,V.e)([hW("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wl.prototype,"epsilon",void 0),(0,B.f)("BABYLON.ParticleConditionBlock",wl);class Kl extends cW{constructor(U){super(U),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",FW.Particle),this.registerInput("condition",FW.Float,!0,0),this.registerInput("system",FW.System),this.registerOutput("output",FW.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){this._triggerCount=0;const W=this.input.getConnectedValue(U),l={process:l=>{if(U.particleContext=l,U.systemContext=W,0!==this.condition.getConnectedValue(U)&&(0===this.limit||this._triggerCount<this.limit)){const M=(new Date).getTime();if(this._previousOne&&M-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=M;const t=this.system.getConnectedValue(U);if(t){const M=aW(t,U.Gd,l.position);M.nk.addOnce((()=>{this._triggerCount--})),W.nk.addOnce((()=>{M.dispose()}))}}},previousItem:null,nextItem:null};W._updateQueueStart?uU(l,W._updateQueueStart):W._updateQueueStart=l,this.output._storedValue=W}serialize(){const U=super.serialize();return U.limit=this.limit,U.delay=this.delay,U}_deserialize(U){super._deserialize(U),void 0!==U.limit&&(this.limit=U.limit),void 0!==U.delay&&(this.delay=U.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,V.e)([hW("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kl.prototype,"limit",void 0),(0,V.e)([hW("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Kl.prototype,"delay",void 0),(0,B.f)("BABYLON.ParticleTriggerBlock",Kl);l(12401),l(12409),l(12421),l(12486)},12464:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12429:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12497:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneVertex",L="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12489:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12477:(U,W,l)=>{"use strict";var M=l(604);const t="fogFragment",L="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12460:(U,W,l)=>{"use strict";var M=l(604);const t="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12500:(U,W,l)=>{"use strict";var M=l(604);const t="fogVertex",L="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12494:(U,W,l)=>{"use strict";var M=l(604);const t="fogVertexDeclaration",L="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12448:(U,W,l)=>{"use strict";var M=l(604);const t="helperFunctions",L="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12434:(U,W,l)=>{"use strict";var M=l(604);const t="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12453:(U,W,l)=>{"use strict";var M=l(604);const t="imageProcessingFunctions",L="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12440:(U,W,l)=>{"use strict";var M=l(604);const t="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12470:(U,W,l)=>{"use strict";var M=l(604);const t="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12509:(U,W,l)=>{"use strict";var M=l(604);const t="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";M.d.IncludesShadersStoreWGSL[t]||(M.d.IncludesShadersStoreWGSL[t]=L)},12421:(U,W,l)=>{"use strict";l.r(W),l.d(W,{particlesPixelShaderWGSL:()=>p});var M=l(604);l(12429),l(12434),l(12440),l(12448),l(12453),l(12460),l(12464),l(12470),l(12477);const t="particlesPixelShader",L="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";M.d.ShadersStoreWGSL[t]||(M.d.ShadersStoreWGSL[t]=L);const p={name:t,shader:L}},12486:(U,W,l)=>{"use strict";l.r(W),l.d(W,{particlesVertexShaderWGSL:()=>p});var M=l(604);l(12489),l(12494),l(12440),l(12497),l(12500),l(12509);const t="particlesVertexShader",L="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";M.d.ShadersStoreWGSL[t]||(M.d.ShadersStoreWGSL[t]=L);const p={name:t,shader:L}},12330:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12405:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12359:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneVertex",L="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12417:(U,W,l)=>{"use strict";var M=l(604);const t="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12343:(U,W,l)=>{"use strict";var M=l(604);const t="fogFragment",L="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12321:(U,W,l)=>{"use strict";var M=l(604);const t="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12368:(U,W,l)=>{"use strict";var M=l(604);const t="fogVertex",L="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12352:(U,W,l)=>{"use strict";var M=l(604);const t="fogVertexDeclaration",L="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12306:(U,W,l)=>{"use strict";var M=l(604);const t="helperFunctions",L="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12295:(U,W,l)=>{"use strict";var M=l(604);const t="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12312:(U,W,l)=>{"use strict";var M=l(604);const t="imageProcessingFunctions",L="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12301:(U,W,l)=>{"use strict";var M=l(604);const t="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12337:(U,W,l)=>{"use strict";var M=l(604);const t="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12374:(U,W,l)=>{"use strict";var M=l(604);const t="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";M.d.IncludesShadersStore[t]||(M.d.IncludesShadersStore[t]=L)},12401:(U,W,l)=>{"use strict";l.r(W),l.d(W,{particlesPixelShader:()=>p});var M=l(604);l(12405),l(12295),l(12301),l(12306),l(12312),l(12321),l(12330),l(12337),l(12343);const t="particlesPixelShader",L="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";M.d.ShadersStore[t]||(M.d.ShadersStore[t]=L);const p={name:t,shader:L}},12409:(U,W,l)=>{"use strict";l.r(W),l.d(W,{particlesVertexShader:()=>p});var M=l(604);l(12417),l(12352),l(12301),l(12359),l(12368),l(12374);const t="particlesVertexShader",L="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";M.d.ShadersStore[t]||(M.d.ShadersStore[t]=L);const p={name:t,shader:L}},12771:(U,W,l)=>{"use strict";l.r(W),l.d(W,{FlowGraphGLTFDataProvider:()=>L});var M=l(12739),t=l(12704);class L extends M.e{constructor(U){var W,l;super();const M=U.glTF,L=(null===(W=M.animations)||void 0===W?void 0:W.map((U=>U._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",t.d,L);const p=(null===(l=M.nodes)||void 0===l?void 0:l.map((U=>U._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",t.d,p)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12639:(U,W,l)=>{"use strict";l.d(W,{d:()=>r,g:()=>w,j:()=>s,l:()=>K});var M=l(706),t=l(11783),L=l(742),p=l(12646);const B=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class k{constructor(U,W){this._gltf=U,this._infoTree=W}convert(U){let W,l=this._gltf,M=this._infoTree;if(!U.startsWith("/"))throw new Error("Path must start with a /");const t=U.split("/");if(t.shift(),t[t.length-1].includes(".length")){const U=t[t.length-1].split(".");t.pop(),t.push(...U)}let L=!1;for(const k of t){const t="length"===k;if(t&&!M.__array__)throw new Error(`Path ${U} is invalid`);if(M.__ignoreObjectTree__&&(L=!0),M.__array__&&!t)M=M.__array__;else if(M=M[k],!M)throw new Error(`Path ${U} is invalid`);if(!L)if(void 0===l){if(!B.find((W=>W.regex.test(U))))throw new Error(`Path ${U} is invalid`)}else if(!t){var p;l=null===(p=l)||void 0===p?void 0:p[k]}(M.__target__||t)&&(W=l)}return{object:W,info:M}}}function A(U,W,l,M){const t=q(U,W);return M?t[l][M]:t[l]}function q(U,W,l){var M,L;return null===(M=U._data)||void 0===M||null===(L=M[(null===l||void 0===l?void 0:l.fillMode)??t.c.MATERIAL_TriangleFillMode])||void 0===L?void 0:L.babylonMaterial}function y(U,W){return{offset:{componentsCount:2,type:"Vector2",get:(l,t,L)=>{const p=A(l,L,U,W);return new M.h(null===p||void 0===p?void 0:p.uOffset,null===p||void 0===p?void 0:p.vOffset)},getTarget:q,set:(l,M,t,L)=>{const p=A(M,L,U,W);p.uOffset=l.x,p.vOffset=l.y},getPropertyName:[()=>`${U}${W?"."+W:""}.uOffset`,()=>`${U}${W?"."+W:""}.vOffset`]},rotation:{type:"number",get:(l,M,t)=>{var L;return null===(L=A(l,t,U,W))||void 0===L?void 0:L.wAng},getTarget:q,set:(l,M,t,L)=>A(M,L,U,W).wAng=l,getPropertyName:[()=>`${U}${W?"."+W:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(l,t,L)=>{const p=A(l,L,U,W);return new M.h(null===p||void 0===p?void 0:p.uScale,null===p||void 0===p?void 0:p.vScale)},getTarget:q,set:(l,M,t,L)=>{const p=A(M,L,U,W);p.uScale=l.x,p.vScale=l.y},getPropertyName:[()=>`${U}${W?"."+W:""}.uScale`,()=>`${U}${W?"."+W:""}.vScale`]}}}const j={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:U=>{var W,l;return new M.h((null===(W=U._babylonCamera)||void 0===W?void 0:W.orthoLeft)??0,(null===(l=U._babylonCamera)||void 0===l?void 0:l.orthoRight)??0)},set:(U,W)=>{W._babylonCamera&&(W._babylonCamera.orthoLeft=U.x,W._babylonCamera.orthoRight=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:U=>{var W,l;return new M.h((null===(W=U._babylonCamera)||void 0===W?void 0:W.orthoBottom)??0,(null===(l=U._babylonCamera)||void 0===l?void 0:l.orthoTop)??0)},set:(U,W)=>{W._babylonCamera&&(W._babylonCamera.orthoBottom=U.x,W._babylonCamera.orthoTop=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:U=>{var W;return null===(W=U._babylonCamera)||void 0===W?void 0:W.maxZ},set:(U,W)=>{W._babylonCamera&&(W._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var W;return null===(W=U._babylonCamera)||void 0===W?void 0:W.bk},set:(U,W)=>{W._babylonCamera&&(W._babylonCamera.bk=U)},getTarget:U=>U,getPropertyName:[()=>"bk"]}},perspective:{aspectRatio:{type:"number",get:U=>{var W;return null===(W=U._babylonCamera)||void 0===W?void 0:W.getEngine().getAspectRatio(U._babylonCamera)},getTarget:U=>U,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:U=>{var W;return null===(W=U._babylonCamera)||void 0===W?void 0:W.fov},set:(U,W)=>{W._babylonCamera&&(W._babylonCamera.fov=U)},getTarget:U=>U,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:U=>{var W;return null===(W=U._babylonCamera)||void 0===W?void 0:W.maxZ},set:(U,W)=>{W._babylonCamera&&(W._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var W;return null===(W=U._babylonCamera)||void 0===W?void 0:W.bk},set:(U,W)=>{W._babylonCamera&&(W._babylonCamera.bk=U)},getTarget:U=>U,getPropertyName:[()=>"bk"]}}}},nodes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ik",get:U=>{var W;return null===(W=U._babylonTransformNode)||void 0===W?void 0:W.position},set:(U,W)=>{var l;return null===(l=W._babylonTransformNode)||void 0===l?void 0:l.position.p(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:U=>{var W;return null===(W=U._babylonTransformNode)||void 0===W?void 0:W.rotationQuaternion},set:(U,W)=>{var l,M;return null===(l=W._babylonTransformNode)||void 0===l||null===(M=l.rotationQuaternion)||void 0===M?void 0:M.p(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ik",get:U=>{var W;return null===(W=U._babylonTransformNode)||void 0===W?void 0:W.yd},set:(U,W)=>{var l;return null===(l=W._babylonTransformNode)||void 0===l?void 0:l.yd.p(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"yd"]},weights:{length:{type:"number",get:U=>U._numMorphTargets,getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(U,W)=>{var l,M;return void 0!==W?null===(l=U._primitiveBabylonMeshes)||void 0===l||null===(M=l[0].morphTargetManager)||void 0===M?void 0:M.getTarget(W).influence:void 0},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(U,W)=>[0],getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:U=>{var W,l,t;return M.c.Compose(null===(W=U._babylonTransformNode)||void 0===W?void 0:W.yd,null===(l=U._babylonTransformNode)||void 0===l?void 0:l.rotationQuaternion,null===(t=U._babylonTransformNode)||void 0===t?void 0:t.position)},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:U=>{var W,l,t,L;const p=M.c.Identity();let B=U.parent;for(;B&&B.parent;)B=B.parent;const k=(null===(W=U._babylonTransformNode)||void 0===W?void 0:W.position._isDirty)||(null===(l=U._babylonTransformNode)||void 0===l||null===(t=l.rotationQuaternion)||void 0===t?void 0:t._isDirty)||(null===(L=U._babylonTransformNode)||void 0===L?void 0:L.yd._isDirty);if(B){var A;const W=null===(A=B._babylonTransformNode)||void 0===A?void 0:A.fk(!0).invert();var q,y;if(W)null===(q=U._babylonTransformNode)||void 0===q||null===(y=q.fk(k))||void 0===y||y.multiplyToRef(W,p)}else U._babylonTransformNode&&p.p(U._babylonTransformNode.fk(k));return p},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:U=>{var W,l;return null===(W=U._babylonTransformNode)||void 0===W||null===(l=W.getChildren((U=>U instanceof p.d),!0)[0])||void 0===l?void 0:l.bb},getTarget:U=>{var W;return null===(W=U._babylonTransformNode)||void 0===W?void 0:W.getChildren((U=>U instanceof p.d),!0)[0]},set:(U,W)=>{if(W._babylonTransformNode){const l=W._babylonTransformNode.getChildren((U=>U instanceof p.d),!0)[0];l&&(l.bb=U)}}},color:{type:"zk",get:U=>{var W,l;return null===(W=U._babylonTransformNode)||void 0===W||null===(l=W.getChildren((U=>U instanceof p.d),!0)[0])||void 0===l?void 0:l.cb},getTarget:U=>{var W;return null===(W=U._babylonTransformNode)||void 0===W?void 0:W.getChildren((U=>U instanceof p.d),!0)[0]},set:(U,W)=>{if(W._babylonTransformNode){const l=W._babylonTransformNode.getChildren((U=>U instanceof p.d),!0)[0];l&&(l.cb=U)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"zk",get:(U,W,l)=>q(U,W,l).emissiveColor,set:(U,W,l,M)=>q(W,l,M).emissiveColor.p(U),getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(U,W,l)=>{var M;return null===(M=A(U,l,"bumpTexture"))||void 0===M?void 0:M.level},set:(U,W,l,M)=>{const t=A(W,M,"bumpTexture");t&&(t.level=U)},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(U,W,l)=>q(U,W,l).ambientTextureStrength,set:(U,W,l,M)=>{const t=q(W,l,M);t&&(t.ambientTextureStrength=U)},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Ak",get:(U,W,l)=>{const M=q(U,W,l);return L.f.FromColor3(M.albedoColor,M.alpha)},set:(U,W,l,M)=>{const t=q(W,l,M);t.albedoColor.set(U.r,U.g,U.b),t.alpha=U.a},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:y("albedoTexture")}},metallicFactor:{type:"number",get:(U,W,l)=>q(U,W,l).metallic,set:(U,W,l,M)=>{const t=q(W,l,M);t&&(t.metallic=U)},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(U,W,l)=>q(U,W,l).roughness,set:(U,W,l,M)=>{const t=q(W,l,M);t&&(t.roughness=U)},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(U,W,l)=>q(U,W,l).anisotropy.bb,set:(U,W,l,M)=>{q(W,l,M).anisotropy.bb=U},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(U,W,l)=>q(U,W,l).anisotropy.angle,set:(U,W,l,M)=>{q(W,l,M).anisotropy.angle=U},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(U,W,l)=>q(U,W,l).clearCoat.bb,set:(U,W,l,M)=>{q(W,l,M).clearCoat.bb=U},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(U,W,l)=>q(U,W,l).clearCoat.roughness,set:(U,W,l,M)=>{q(W,l,M).clearCoat.roughness=U},getTarget:(U,W,l)=>q(U,W,l),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(U,W,l)=>{var M;return null===(M=q(U,W,l).clearCoat.bumpTexture)||void 0===M?void 0:M.level},getTarget:q,set:(U,W,l,M)=>q(W,l,M).clearCoat.bumpTexture.level=U},extensions:{KHR_texture_transform:y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(U,W,l)=>q(U,W,l).subSurface.dispersion,getTarget:q,set:(U,W,l,M)=>q(W,l,M).subSurface.dispersion=U}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(U,W,l)=>q(U,W,l).emissiveIntensity,getTarget:q,set:(U,W,l,M)=>q(W,l,M).emissiveIntensity=U}},KHR_materials_ior:{ior:{type:"number",get:(U,W,l)=>q(U,W,l).indexOfRefraction,getTarget:q,set:(U,W,l,M)=>q(W,l,M).indexOfRefraction=U}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(U,W,l)=>q(U,W,l).iridescence.bb,getTarget:q,set:(U,W,l,M)=>q(W,l,M).iridescence.bb=U},iridescenceIor:{type:"number",get:(U,W,l)=>q(U,W,l).iridescence.indexOfRefraction,getTarget:q,set:(U,W,l,M)=>q(W,l,M).iridescence.indexOfRefraction=U},iridescenceTexture:{extensions:{KHR_texture_transform:y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(U,W,l)=>q(U,W,l).iridescence.maximumThickness,getTarget:q,set:(U,W,l,M)=>q(W,l,M).iridescence.maximumThickness=U},iridescenceThicknessMinimum:{type:"number",get:(U,W,l)=>q(U,W,l).iridescence.minimumThickness,getTarget:q,set:(U,W,l,M)=>q(W,l,M).iridescence.minimumThickness=U},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"zk",get:(U,W,l)=>q(U,W,l).sheen.color,getTarget:q,set:(U,W,l,M)=>q(W,l,M).sheen.color.p(U)},sheenColorTexture:{extensions:{KHR_texture_transform:y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(U,W,l)=>q(U,W,l).sheen.bb,getTarget:q,set:(U,W,l,M)=>q(W,l,M).sheen.bb=U},sheenRoughnessTexture:{extensions:{KHR_texture_transform:y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(U,W,l)=>q(U,W,l).metallicF0Factor,getTarget:q,set:(U,W,l,M)=>q(W,l,M).metallicF0Factor=U,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"zk",get:(U,W,l)=>q(U,W,l).metallicReflectanceColor,getTarget:q,set:(U,W,l,M)=>q(W,l,M).metallicReflectanceColor.p(U),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(U,W,l)=>q(U,W,l).subSurface.refractionIntensity,getTarget:q,set:(U,W,l,M)=>q(W,l,M).subSurface.refractionIntensity=U,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(U,W,l)=>q(U,W,l).subSurface.translucencyIntensity,getTarget:q,set:(U,W,l,M)=>q(W,l,M).subSurface.translucencyIntensity=U},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"zk",get:(U,W,l)=>q(U,W,l).subSurface.translucencyColor,getTarget:q,set:(U,W,l,M)=>{var t;return U&&(null===(t=q(W,l,M).subSurface.translucencyColor)||void 0===t?void 0:t.p(U))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"zk",get:(U,W,l)=>q(U,W,l).subSurface.tintColor,getTarget:q,set:(U,W,l,M)=>q(W,l,M).subSurface.tintColor.p(U)},attenuationDistance:{type:"number",get:(U,W,l)=>q(U,W,l).subSurface.tintColorAtDistance,getTarget:q,set:(U,W,l,M)=>q(W,l,M).subSurface.tintColorAtDistance=U},thicknessFactor:{type:"number",get:(U,W,l)=>q(U,W,l).subSurface.maximumThickness,getTarget:q,set:(U,W,l,M)=>q(W,l,M).subSurface.maximumThickness=U},thicknessTexture:{extensions:{KHR_texture_transform:y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,color:{type:"zk",get:U=>{var W;return null===(W=U._babylonLight)||void 0===W?void 0:W.cb},set:(U,W)=>{var l;return null===(l=W._babylonLight)||void 0===l?void 0:l.cb.p(U)},getTarget:U=>U._babylonLight,getPropertyName:[U=>"diffuse"]},bb:{type:"number",get:U=>{var W;return null===(W=U._babylonLight)||void 0===W?void 0:W.bb},set:(U,W)=>W._babylonLight?W._babylonLight.bb=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"intensity"]},range:{type:"number",get:U=>{var W;return null===(W=U._babylonLight)||void 0===W?void 0:W.range},set:(U,W)=>W._babylonLight?W._babylonLight.range=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"range"]},spot:{innerConeAngle:{type:"number",get:U=>{var W;return null===(W=U._babylonLight)||void 0===W?void 0:W.innerAngle},set:(U,W)=>W._babylonLight?W._babylonLight.innerAngle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"innerConeAngle"]},outerConeAngle:{type:"number",get:U=>{var W;return null===(W=U._babylonLight)||void 0===W?void 0:W.angle},set:(U,W)=>W._babylonLight?W._babylonLight.angle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTexture)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,bb:{type:"number",get:U=>{var W;return null===(W=U._babylonTexture)||void 0===W?void 0:W.level},set:(U,W)=>{W._babylonTexture&&(W._babylonTexture.level=U)},getTarget:U=>U._babylonTexture},rotation:{type:"Quaternion",get:U=>{var W;return U._babylonTexture&&M.e.FromRotationMatrix(null===(W=U._babylonTexture)||void 0===W?void 0:W.getReflectionTextureMatrix())},set:(U,W)=>{var l;W._babylonTexture&&(null!==(l=W._babylonTexture.va())&&void 0!==l&&l.useRightHandedSystem||(U=M.e.Inverse(U)),M.c.FromQuaternionToRef(U,W._babylonTexture.getReflectionTextureMatrix()))},getTarget:U=>U._babylonTexture}}}}},animations:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>{var W;return null===(W=U.primitives[0]._instanceData)||void 0===W?void 0:W.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function s(U){return new k(U,j)}function w(U){const W=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let l=j;for(const M of W)M&&(l=l[M]);if(l&&l.type&&l.get)return l}function K(U,W){const l=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let M=j;for(const t of l)t&&(M=M[t]);M&&M.type&&M.get&&(M.interpolation=W)}function r(U,W){const l=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let M=j;for(const t of l)if(t){if(!M[t]){if("?"===t){M.__ignoreObjectTree__=!0;continue}M[t]={},"__array__"===t&&(M[t].__target__=!0)}M=M[t]}Object.assign(M,W)}},12655:(U,W,l)=>{"use strict";l.r(W),l.d(W,{AnimationPropertyInfo:()=>A,TransformNodeAnimationPropertyInfo:()=>q,WeightAnimationPropertyInfo:()=>y,getQuaternion:()=>B,getVector3:()=>p,getWeights:()=>k});var M=l(11860),t=l(706),L=l(12639);function p(U,W,l,M){return t.l.gk(W,l).scaleInPlace(M)}function B(U,W,l,M){return t.e.gk(W,l).scaleInPlace(M)}function k(U,W,l,M){const t=new Array(U._numMorphTargets);for(let L=0;L<t.length;L++)t[L]=W[l++]*M;return t}class A{constructor(U,W,l,M){this.type=U,this.name=W,this.getValue=l,this.getStride=M}_buildAnimation(U,W,l){const t=new M.c(U,this.name,W,this.type);return t.setKeys(l),t}}class q extends A{buildAnimations(U,W,l,M){const t=[];return t.push({babylonAnimatable:U._babylonTransformNode,babylonAnimation:this._buildAnimation(W,l,M)}),t}}class y extends A{buildAnimations(U,W,l,t){const L=[];if(U._numMorphTargets)for(let p=0;p<U._numMorphTargets;p++){const B=new M.c(`${W}_${p}`,this.name,l,this.type);if(B.setKeys(t.map((U=>({frame:U.frame,inTangent:U.inTangent?U.inTangent[p]:void 0,value:U.value[p],outTangent:U.outTangent?U.outTangent[p]:void 0,interpolation:U.interpolation})))),U._primitiveBabylonMeshes)for(const W of U._primitiveBabylonMeshes)if(W.morphTargetManager){const U=W.morphTargetManager.getTarget(p),l=B.clone();U.animations.push(l),L.push({babylonAnimatable:U,babylonAnimation:l})}}return L}}(0,L.l)("/nodes/{}/translation",[new q(M.c.ANIMATIONTYPE_VECTOR3,"position",p,(()=>3))]),(0,L.l)("/nodes/{}/rotation",[new q(M.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",B,(()=>4))]),(0,L.l)("/nodes/{}/scale",[new q(M.c.ANIMATIONTYPE_VECTOR3,"yd",p,(()=>3))]),(0,L.l)("/nodes/{}/weights",[new y(M.c.ANIMATIONTYPE_FLOAT,"influence",k,(U=>U._numMorphTargets))])},12606:(U,W,l)=>{"use strict";class M{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((U,W)=>{this._resolve=U,this._reject=W}))}}var t=l(706),L=l(742),p=l(503),B=l(677),k=l(12614),A=l(12625),q=l(496),y=l(11781),j=l(11860),s=l(11862),w=l(543),K=l(512),r=l(520);class m{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(U){this._useTextureToStoreBoneMatrices=U,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(U){this._animationPropertiesOverride=U}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(U,W,l){this.name=U,this.id=W,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=t.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new q.b,this.bones=[],this._scene=l||w.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const M=this._scene.getEngine().getCaps();this._canUseTextureForBones=M.textureFloat&&M.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((U=>!U.getParent()))}getTransformMatrices(U){if(this.needInitialSkinMatrix){if(!U)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return U._bonesTransformMatrices||this.prepare(!0),U._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(U){return this.needInitialSkinMatrix&&U._transformMatrixTexture?U._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(U){let W=`Name: ${this.name}, nBones: ${this.bones.length}`;if(W+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,U){W+=", Ranges: {";let U=!0;for(const l in this._ranges)U&&(W+=", ",U=!1),W+=l;W+="}"}return W}getBoneIndexByName(U){for(let W=0,l=this.bones.length;W<l;W++)if(this.bones[W].name===U)return W;return-1}createAnimationRange(U,W,l){if(!this._ranges[U]){this._ranges[U]=new s.b(U,W,l);for(let M=0,t=this.bones.length;M<t;M++)this.bones[M].animations[0]&&this.bones[M].animations[0].createRange(U,W,l)}}deleteAnimationRange(U){let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let l=0,M=this.bones.length;l<M;l++)this.bones[l].animations[0]&&this.bones[l].animations[0].deleteRange(U,W);this._ranges[U]=null}getAnimationRange(U){return this._ranges[U]||null}getAnimationRanges(){const U=[];let W;for(W in this._ranges)U.push(this._ranges[W]);return U}copyAnimationRange(U,W){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[W]||!U.getAnimationRange(W))return!1;let M=!0;const t=this._getHighestAnimationFrame()+1,L={},p=U.bones;let B,k;for(k=0,B=p.length;k<B;k++)L[p[k].name]=p[k];this.bones.length!==p.length&&(K.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${p.length}`),M=!1);const A=l&&this.dimensionsAtRest&&U.dimensionsAtRest?this.dimensionsAtRest.divide(U.dimensionsAtRest):null;for(k=0,B=this.bones.length;k<B;k++){const U=this.bones[k].name,p=L[U];p?M=M&&this.bones[k].copyAnimationRange(p,W,t,l,A):(K.b.Warn("copyAnimationRange: not same rig, missing source bone "+U),M=!1)}const q=U.getAnimationRange(W);return q&&(this._ranges[W]=new s.b(W,q.from+t,q.to+t)),M}returnToRest(){for(const U of this.bones)-1!==U._index&&U.returnToRest()}_getHighestAnimationFrame(){let U=0;for(let W=0,l=this.bones.length;W<l;W++)if(this.bones[W].animations[0]){const l=this.bones[W].animations[0].getHighestFrame();U<l&&(U=l)}return U}beginAnimation(U,W,l,M){const t=this.getAnimationRange(U);return t?this._scene.beginAnimation(this,t.from,t.to,W,l,M):null}static MakeAnimationAdditive(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const M=U.getAnimationRange(l);if(!M)return null;const t=U._scene.getAllAnimatablesByTarget(U);let L=null;for(let B=0;B<t.length;B++){const U=t[B];if(U.fromFrame===(null===M||void 0===M?void 0:M.from)&&U.toFrame===(null===M||void 0===M?void 0:M.to)){L=U;break}}const p=U.getAnimatables();for(let B=0;B<p.length;B++){const U=p[B].animations;if(U)for(let M=0;M<U.length;M++)j.c.MakeAnimationAdditive(U[M],W,l)}return L&&(L.isAdditive=!0),U}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(U){this._meshesWithPoseMatrix.push(U)}_unregisterMeshWithPoseMatrix(U){const W=this._meshesWithPoseMatrix.indexOf(U);W>-1&&this._meshesWithPoseMatrix.splice(W,1)}_computeTransformMatrices(U,W){this.onBeforeComputeObservable.notifyObservers(this);for(let l=0;l<this.bones.length;l++){const M=this.bones[l];M._childUpdateId++;const t=M.getParent();if(t?M.getLocalMatrix().multiplyToRef(t.getFinalMatrix(),M.getFinalMatrix()):W?M.getLocalMatrix().multiplyToRef(W,M.getFinalMatrix()):M.getFinalMatrix().p(M.getLocalMatrix()),-1!==M._index){const W=null===M._index?l:M._index;M.getAbsoluteInverseBindMatrix().multiplyToArray(M.getFinalMatrix(),U,16*W)}}this._identity.copyToArray(U,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const U=this.va().getRenderId();if(this._currentRenderId===U)return;this._currentRenderId=U}if(this._numBonesWithLinkedTransformNode>0)for(const U of this.bones)if(U._linkedTransformNode){const W=U._linkedTransformNode;U.position=W.position,W.rotationQuaternion?U.rotationQuaternion=W.rotationQuaternion:U.rotation=W.rotation,U.yd=W.yd}if(this.needInitialSkinMatrix)for(const U of this._meshesWithPoseMatrix){const W=U.getPoseMatrix();let l=this._isDirty;if(U._bonesTransformMatrices&&U._bonesTransformMatrices.length===16*(this.bones.length+1)||(U._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),l=!0),l){if(this._synchronizedWithMesh!==U){this._synchronizedWithMesh=U;for(const U of this.bones)if(!U.getParent()){U.getBindMatrix().multiplyToRef(W,t.f.Matrix[1]),U._updateAbsoluteBindMatrices(t.f.Matrix[1])}if(this.isUsingTextureForMatrices){const W=4*(this.bones.length+1);U._transformMatrixTexture&&U._transformMatrixTexture.getSize().width===W||(U._transformMatrixTexture&&U._transformMatrixTexture.dispose(),U._transformMatrixTexture=y.e.CreateRGBATexture(U._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(U._bonesTransformMatrices,W),this.isUsingTextureForMatrices&&U._transformMatrixTexture&&U._transformMatrixTexture.update(U._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=y.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let U=0;U<this.bones.length;U++)this._animatables.push(this.bones[U])}return this._animatables}clone(U,W){const l=new m(U,W||U,this._scene);l.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let M=0;M<this.bones.length;M++){const U=this.bones[M];let W=null;const t=U.getParent();if(t){const U=this.bones.indexOf(t);W=l.bones[U]}const L=new A.c(U.name,l,W,U.getBindMatrix().clone(),U.getRestMatrix().clone());L._index=U._index,U._linkedTransformNode&&L.linkTransformNode(U._linkedTransformNode),r.b.DeepCopy(U.animations,L.animations)}if(this._ranges){l._ranges={};for(const U in this._ranges){const W=this._ranges[U];W&&(l._ranges[U]=W.clone())}}return this._isDirty=!0,l.prepare(!0),l}enableBlending(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const W of this.bones)for(const l of W.animations)l.enableBlending=!0,l.blendingSpeed=U}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const U=this._parentContainer.skeletons.indexOf(this);U>-1&&this._parentContainer.skeletons.splice(U,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const U={};U.name=this.name,U.id=this.id,this.dimensionsAtRest&&(U.dimensionsAtRest=this.dimensionsAtRest.qk()),U.bones=[],U.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let l=0;l<this.bones.length;l++){var W;const M=this.bones[l],t=M.getParent(),L={parentBoneIndex:t?this.bones.indexOf(t):-1,index:M.getIndex(),name:M.name,id:M.id,matrix:M.getBindMatrix().qk(),rest:M.getRestMatrix().qk(),linkedTransformNodeId:null===(W=M.getTransformNode())||void 0===W?void 0:W.id};U.bones.push(L),M.length&&(L.length=M.length),M.metadata&&(L.metadata=M.metadata),M.animations&&M.animations.length>0&&(L.animation=M.animations[0].serialize()),U.ranges=[];for(const W in this._ranges){const l=this._ranges[W];if(!l)continue;const M={};M.name=W,M.from=l.from,M.to=l.to,U.ranges.push(M)}}return U}static Parse(U,W){const l=new m(U.name,U.id,W);let M;for(U.dimensionsAtRest&&(l.dimensionsAtRest=t.l.gk(U.dimensionsAtRest)),l.needInitialSkinMatrix=U.needInitialSkinMatrix,M=0;M<U.bones.length;M++){const W=U.bones[M],L=U.bones[M].index;let p=null;W.parentBoneIndex>-1&&(p=l.bones[W.parentBoneIndex]);const B=W.rest?t.c.gk(W.rest):null,k=new A.c(W.name,l,p,t.c.gk(W.matrix),B,null,L);void 0!==W.id&&null!==W.id&&(k.id=W.id),W.length&&(k.length=W.length),W.metadata&&(k.metadata=W.metadata),W.animation&&k.animations.push(j.c.Parse(W.animation)),void 0!==W.linkedTransformNodeId&&null!==W.linkedTransformNodeId&&(l._hasWaitingData=!0,k._waitingTransformNodeId=W.linkedTransformNodeId)}if(U.ranges)for(M=0;M<U.ranges.length;M++){const W=U.ranges[M];l.createAnimationRange(W.name,W.from,W.to)}return l}computeAbsoluteMatrices(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||U)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(U)}getPoseMatrix(){let U=null;return this._meshesWithPoseMatrix.length>0&&(U=this._meshesWithPoseMatrix[0].getPoseMatrix()),U}sortBones(){const U=[],W=new Array(this.bones.length);for(let l=0;l<this.bones.length;l++)this._sortBones(l,U,W);this.bones=U}_sortBones(U,W,l){if(l[U])return;l[U]=!0;const M=this.bones[U];if(!M)return;void 0===M._index&&(M._index=U);const t=M.getParent();t&&this._sortBones(this.bones.indexOf(t),W,l),W.push(M)}setCurrentPoseAsRest(){for(const U of this.bones)U.setCurrentPoseAsRest()}}var f=l(851),g=l(11798),E=l(2048),Z=l(828),N=l(763),D=l(812),o=l(821),i=l(487),O=l(11864),e=l(702),d=l(12574);class H{set areUpdatesFrozen(U){U?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new e.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,U||(U=w.d.LastCreatedScene),this._scene=U,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const U=this._scene.getEngine().getCaps();this._canUseTextureForTargets=U.canUseGLVertexID&&U.textureFloat&&U.maxVertexTextureImageUnits>0&&U.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return H.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?H.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(U){this._numMaxInfluencers!==U&&(this._numMaxInfluencers=U,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(U){this._useTextureToStoreTargets!==U&&(this._useTextureToStoreTargets=U,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var U;return H.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(U=this._scene)&&void 0!==U&&U.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(U){return this._activeTargets.data[U]}getTarget(U){return this._targets[U]}getTargetByName(U){for(const W of this._targets)if(W.name===U)return W;return null}addTarget(U){this._targets.push(U),this._targetInfluenceChangedObservers.push(U.onInfluenceChanged.add((U=>{this.areUpdatesFrozen&&U&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(U)}))),this._targetDataLayoutChangedObservers.push(U._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(U){const W=this._targets.indexOf(U);W>=0&&(this._targets.splice(W,1),U.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(W,1)[0]),U._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(W,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(U)}_bind(U){U.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),U.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),U.setTexture("morphTargets",this._targetStoreTexture),U.setInt("morphTargetCount",this.numInfluencers)}clone(){const U=new H(this._scene);for(const W of this._targets)U.addTarget(W.clone());return U.enablePositionMorphing=this.enablePositionMorphing,U.enableNormalMorphing=this.enableNormalMorphing,U.enableTangentMorphing=this.enableTangentMorphing,U.enableUVMorphing=this.enableUVMorphing,U.enableUV2Morphing=this.enableUV2Morphing,U.enableColorMorphing=this.enableColorMorphing,U}serialize(){const U={};U.id=this.uniqueId,U.targets=[];for(const W of this._targets)U.targets.push(W.serialize());return U}_syncActiveTargets(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const W=!!this._targetStoreTexture,l=this.isUsingTextureForTargets;(this._mustSynchronize||W!==l)&&(this._mustSynchronize=!1,this.synchronize());let M=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let t=-1;for(const L of this._targets)if(t++,0!==L.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=H.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(L),this._morphTargetTextureIndices[M]=t,this._tempInfluences[M++]=L.influence}this._morphTargetTextureIndices.length!==M&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,M)),this._influences&&this._influences.length===M||(this._influences=new Float32Array(M));for(let L=0;L<M;L++)this._influences[L]=this._tempInfluences[L];if(U&&this._scene)for(const L of this._scene.meshes)L.morphTargetManager===this&&(l?L._markSubMeshesAsAttributesDirty():L._syncGeometryWithMorphTargetManager())}synchronize(){var U;if(!this._scene||this.areUpdatesFrozen)return;const W=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(U=this._targetStoreTexture)||void 0===U||U.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>W.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const l of this._targets){this._supportsPositions=this._supportsPositions&&l.hasPositions,this._supportsNormals=this._supportsNormals&&l.hasNormals,this._supportsTangents=this._supportsTangents&&l.hasTangents,this._supportsUVs=this._supportsUVs&&l.hasUVs,this._supportsUV2s=this._supportsUV2s&&l.hasUV2s,this._supportsColors=this._supportsColors&&l.hasColors;const U=l.vertexCount;if(0===this._vertexCount)this._vertexCount=U;else if(this._vertexCount!==U)return void K.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${l.name}": ${U}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const U=W.getCaps().maxTextureSize;this._textureWidth>U&&(this._textureHeight=Math.ceil(this._textureWidth/U),this._textureWidth=U);const l=this._targets.length,M=new Float32Array(l*this._textureWidth*this._textureHeight*4);let t=0;for(let W=0;W<l;W++){const U=this._targets[W],l=U.getPositions(),L=U.getNormals(),p=U.getUVs(),B=U.getTangents(),k=U.getUV2s(),A=U.getColors();t=W*this._textureWidth*this._textureHeight*4;for(let W=0;W<this._vertexCount;W++)this._supportsPositions&&l&&(M[t]=l[3*W],M[t+1]=l[3*W+1],M[t+2]=l[3*W+2],t+=4),this._supportsNormals&&L&&(M[t]=L[3*W],M[t+1]=L[3*W+1],M[t+2]=L[3*W+2],t+=4),this._supportsUVs&&p&&(M[t]=p[2*W],M[t+1]=p[2*W+1],t+=4),this._supportsTangents&&B&&(M[t]=B[3*W],M[t+1]=B[3*W+1],M[t+2]=B[3*W+2],t+=4),this._supportsUV2s&&k&&(M[t]=k[2*W],M[t+1]=k[2*W+1],t+=4),this._supportsColors&&A&&(M[t]=A[4*W],M[t+1]=A[4*W+1],M[t+2]=A[4*W+2],M[t+3]=A[4*W+3],t+=4)}this._targetStoreTexture=d.d.CreateRGBATexture(M,this._textureWidth,this._textureHeight,l,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const l of this._scene.meshes)l.morphTargetManager===this&&l._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const U=this._parentContainer.morphTargetManagers.indexOf(this);U>-1&&this._parentContainer.morphTargetManagers.splice(U,1),this._parentContainer=null}for(const U of this._targets)this._scene.stopAnimation(U)}}static Parse(U,W){const l=new H(W);for(const M of U.targets)l.addTarget(O.b.Parse(M,W));return l}}H.EnableTextureStorage=!0,H.MaxActiveMorphTargetsInVertexAttributeMode=8,H.ConstantTargetCountForTextureMode=0;var V=l(12633),n=l(547),x=l(784);const I=new Map,R=I;function F(U,W,l){v(U)&&K.b.Warn(`Extension with the name '${U}' already exists`),I.set(U,{isGLTFExtension:W,factory:l})}function v(U){return I.delete(U)}var J=l(12639),Q=l(11907),G=l(772);class u{static Get(U,W,l){if(!W||void 0==l||!W[l])throw new Error(`${U}: Failed to find index (${l})`);return W[l]}static TryGet(U,W){return U&&void 0!=W&&U[W]?U[W]:null}static Assign(U){if(U)for(let W=0;W<U.length;W++)U[W].index=W}}function b(U){if(U.min&&U.max){const W=U.min,l=U.max,M=t.f.ik[0].wd(W[0],W[1],W[2]),L=t.f.ik[1].wd(l[0],l[1],l[2]);if(U.normalized&&5126!==U.componentType){let W=1;switch(U.componentType){case 5120:W=127;break;case 5121:W=255;break;case 5122:W=32767;break;case 5123:W=65535}const l=1/W;M.scaleInPlace(l),L.scaleInPlace(l)}return new x.b(M,L)}return null}class C{static RegisterExtension(U,W){F(U,!1,W)}static UnregisterExtension(U){return v(U)}get Tk(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(U){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=U}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((U=>U.dispose&&U.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(U,W,l,M,t,L){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=W,this._assetContainer=l,this._loadData(M);let L=null;if(U){const W={};if(this._gltf.nodes)for(const U of this._gltf.nodes)U.name&&(W[U.name]=U.index);L=(U instanceof Array?U:[U]).map((U=>{const l=W[U];if(void 0===l)throw new Error(`Failed to find node '${U}'`);return l}))}return await this._loadAsync(t,p,L,(()=>({meshes:this._getMeshes(),Fk:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(U,W,l,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=U,this._loadData(W),await this._loadAsync(l,t,null,(()=>{}))}async _loadAsync(U,W,l,M){return await Promise.resolve().then((async()=>{this._rootUrl=U,this._uniqueRootUrl=!U.startsWith("file:")&&W?U:`${U}${Date.now()}/`,this._fileName=W,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const t=`${V.j[V.j.LOADING]} => ${V.j[V.j.READY]}`,L=`${V.j[V.j.LOADING]} => ${V.j[V.j.COMPLETE]}`;this._parent._startPerformanceCounter(t),this._parent._startPerformanceCounter(L),this._parent._setState(V.j.LOADING),this._extensionsOnLoading();const B=new Array;if(!this.parent.loadOnlyMaterials)if(l)B.push(this.loadSceneAsync("/nodes",{nodes:l,index:-1}));else if(void 0!=this._gltf.Gd||this._gltf.scenes&&this._gltf.scenes[0]){const U=u.Get("/scene",this._gltf.scenes,this._gltf.Gd||0);B.push(this.loadSceneAsync(`/scenes/${U.index}`,U))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let U=0;U<this._gltf.materials.length;++U){const W=this._gltf.materials[U],l="/materials/"+U,M=f.b.TriangleFillMode;B.push(this._loadMaterialAsync(l,W,null,M,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&B.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&B.push(this._compileShadowGeneratorsAsync());const k=Promise.all(B).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.hc(!0);for(const U of this._babylonScene.materials){const W=U;void 0!==W.maxSimultaneousLights&&(W.maxSimultaneousLights=Math.max(W.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(V.j.READY),this._skipStartAnimationStep||this._startAnimations(),M()}));return await k.then((U=>(this._parent._endPerformanceCounter(t),p.h.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(L),this._parent._setState(V.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(U=>{this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()}))})),U)))})).catch((U=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()),U}))}_loadData(U){if(this._gltf=U.json,this._setupData(),U.bin){const W=this._gltf.buffers;if(W&&W[0]&&!W[0].uri){const l=W[0];(l.byteLength<U.bin.byteLength-3||l.byteLength>U.bin.byteLength)&&K.b.Warn(`Binary buffer length (${l.byteLength}) from JSON does not match chunk length (${U.bin.byteLength})`),this._bin=U.bin}else K.b.Warn("Unexpected BIN chunk")}}_setupData(){if(u.Assign(this._gltf.accessors),u.Assign(this._gltf.animations),u.Assign(this._gltf.buffers),u.Assign(this._gltf.bufferViews),u.Assign(this._gltf.cameras),u.Assign(this._gltf.images),u.Assign(this._gltf.materials),u.Assign(this._gltf.meshes),u.Assign(this._gltf.nodes),u.Assign(this._gltf.samplers),u.Assign(this._gltf.scenes),u.Assign(this._gltf.skins),u.Assign(this._gltf.textures),this._gltf.nodes){const U={};for(const l of this._gltf.nodes)if(l.children)for(const W of l.children)U[W]=l.index;const W=this._createRootNode();for(const l of this._gltf.nodes){const M=U[l.index];l.parent=void 0===M?W:this._gltf.nodes[M]}}}async _loadExtensionsAsync(){const U=[];if(R.forEach(((W,l)=>{var M;!1===(null===(M=this.parent.extensionOptions[l])||void 0===M?void 0:M.enabled)?W.isGLTFExtension&&this.isExtensionUsed(l)&&K.b.Warn(`Extension ${l} is used but has been explicitly disabled.`):W.isGLTFExtension&&!this.isExtensionUsed(l)||U.push((async()=>{const U=await W.factory(this);return U.name!==l&&K.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${U.name} !== ${l}`),this._parent.onExtensionLoadedObservable.notifyObservers(U),U})())})),this._extensions.push(...await Promise.all(U)),this._extensions.sort(((U,W)=>(U.order||Number.MAX_VALUE)-(W.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const l of this._gltf.extensionsRequired){if(!this._extensions.some((U=>U.name===l&&U.enabled))){var W;if(!1===(null===(W=this.parent.extensionOptions[l])||void 0===W?void 0:W.enabled))throw new Error(`Required extension ${l} is disabled`);throw new Error(`Required extension ${l} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new i.e("__root__",this._babylonScene);this._rootBabylonMesh=U,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.hc(!1);const W={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case V.h.AUTO:this._babylonScene.useRightHandedSystem||(W.rotation=[0,1,0,0],W.scale=[1,1,-1],C._LoadTransform(W,this._rootBabylonMesh));break;case V.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(U),W}loadSceneAsync(U,W){const l=this._extensionsLoadSceneAsync(U,W);if(l)return l;const M=new Array;if(this.logOpen(`${U} ${W.name||""}`),W.nodes)for(const t of W.nodes){const W=u.Get(`${U}/nodes/${t}`,this._gltf.nodes,t);M.push(this.loadNodeAsync(`/nodes/${W.index}`,W,(U=>{U.parent=this._rootBabylonMesh})))}for(const t of this._postSceneLoadActions)t();return M.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(M).then((()=>{}))}_forEachPrimitive(U,W){if(U._primitiveBabylonMeshes)for(const l of U._primitiveBabylonMeshes)W(l)}_getGeometries(){const U=[],W=this._gltf.nodes;if(W)for(const l of W)this._forEachPrimitive(l,(W=>{const l=W.vk;l&&-1===U.indexOf(l)&&U.push(l)}));return U}_getMeshes(){const U=[];this._rootBabylonMesh instanceof o.c&&U.push(this._rootBabylonMesh);const W=this._gltf.nodes;if(W)for(const l of W)this._forEachPrimitive(l,(W=>{U.push(W)}));return U}_getTransformNodes(){const U=[],W=this._gltf.nodes;if(W)for(const l of W)l._babylonTransformNode&&"Sk"===l._babylonTransformNode.getClassName()&&U.push(l._babylonTransformNode),l._babylonTransformNodeForSkin&&U.push(l._babylonTransformNodeForSkin);return U}_getSkeletons(){const U=[],W=this._gltf.skins;if(W)for(const l of W)l._data&&U.push(l._data.babylonSkeleton);return U}_getAnimationGroups(){const U=[],W=this._gltf.animations;if(W)for(const l of W)l._babylonAnimationGroup&&U.push(l._babylonAnimationGroup);return U}_startAnimations(){switch(this._parent.animationStartMode){case V.f.NONE:break;case V.f.FIRST:{const U=this._getAnimationGroups();0!==U.length&&U[0].start(!0);break}case V.f.ALL:{const U=this._getAnimationGroups();for(const W of U)W.start(!0);break}default:return void K.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadNodeAsync(U,W,l);if(M)return M;if(W._babylonTransformNode)throw new Error(`${U}: Invalid recursive node hierarchy`);const t=new Array;this.logOpen(`${U} ${W.name||""}`);const L=M=>{if(C.AddPointerMetadata(M,U),C._LoadTransform(W,M),void 0!=W.camera){const l=u.Get(`${U}/camera`,this._gltf.cameras,W.camera);t.push(this.loadCameraAsync(`/cameras/${l.index}`,l,(U=>{U.parent=M,this._babylonScene.useRightHandedSystem||(M.yd.x=-1)})))}if(W.children)for(const l of W.children){const W=u.Get(`${U}/children/${l}`,this._gltf.nodes,l);t.push(this.loadNodeAsync(`/nodes/${W.index}`,W,(U=>{U.parent=M})))}l(M)},p=void 0!=W.mesh,B=this._parent.loadSkins&&void 0!=W.skin;if(!p||B){const U=W.name||`node${W.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new Z.d(U,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==W.mesh?W._babylonTransformNode=l:W._babylonTransformNodeForSkin=l,L(l)}if(p)if(B){const l=u.Get(`${U}/mesh`,this._gltf.meshes,W.mesh);t.push(this._loadMeshAsync(`/meshes/${l.index}`,W,l,(l=>{const M=W._babylonTransformNodeForSkin;l.metadata=(0,Q.d)(M.metadata,l.metadata||{});const L=u.Get(`${U}/skin`,this._gltf.skins,W.skin);t.push(this._loadSkinAsync(`/skins/${L.index}`,W,L,(U=>{this._forEachPrimitive(W,(W=>{W.skeleton=U})),this._postSceneLoadActions.push((()=>{if(void 0!=L.skeleton){const U=u.Get(`/skins/${L.index}/skeleton`,this._gltf.nodes,L.skeleton).parent;W.index===U.index?l.parent=M.parent:l.parent=U._babylonTransformNode}else l.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:M,skinnedNode:l})}))})))})))}else{const l=u.Get(`${U}/mesh`,this._gltf.meshes,W.mesh);t.push(this._loadMeshAsync(`/meshes/${l.index}`,W,l,L))}return this.logClose(),Promise.all(t).then((()=>(this._forEachPrimitive(W,(U=>{const W=U;!W.isAnInstance&&W.vk&&W.vk.useBoundingInfoFromGeometry?U.Ea():U.refreshBoundingInfo(!0,!0)})),W._babylonTransformNode)))}_loadMeshAsync(U,W,l,M){const t=l.primitives;if(!t||!t.length)throw new Error(`${U}: Primitives are missing`);void 0==t[0].index&&u.Assign(t);const L=new Array;this.logOpen(`${U} ${l.name||""}`);const p=W.name||`node${W.index}`;if(1===t.length){const M=l.primitives[0];L.push(this._loadMeshPrimitiveAsync(`${U}/primitives/${M.index}`,p,W,l,M,(U=>{W._babylonTransformNode=U,W._primitiveBabylonMeshes=[U]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,W._babylonTransformNode=new Z.d(p,this._babylonScene),W._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W._primitiveBabylonMeshes=[];for(const M of t)L.push(this._loadMeshPrimitiveAsync(`${U}/primitives/${M.index}`,`${p}_primitive${M.index}`,W,l,M,(U=>{U.parent=W._babylonTransformNode,W._primitiveBabylonMeshes.push(U)})))}return M(W._babylonTransformNode),this.logClose(),Promise.all(L).then((()=>W._babylonTransformNode))}_loadMeshPrimitiveAsync(U,W,l,M,t,L){const p=this._extensionsLoadMeshPrimitiveAsync(U,W,l,M,t,L);if(p)return p;this.logOpen(`${U}`);const B=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==l.skin&&!M.primitives[0].targets;let k,A;if(B&&t._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,k=t._instanceData.babylonSourceMesh.createInstance(W),k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A=t._instanceData.promise;else{const L=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new i.e(W,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.sideOrientation=this._babylonScene.useRightHandedSystem?f.b.CounterClockWiseSideOrientation:f.b.ClockWiseSideOrientation,this._createMorphTargets(U,l,M,t,p),L.push(this._loadVertexDataAsync(U,t,p).then((async W=>await this._loadMorphTargetsAsync(U,t,p,W).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,W.Ca(p),W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const q=C._GetDrawMode(U,t.mode);if(void 0==t.material){let U=this._defaultBabylonMaterialData[q];U||(U=this._createDefaultMaterial("__GLTFLoader._default",q),this._parent.onMaterialLoadedObservable.notifyObservers(U),this._defaultBabylonMaterialData[q]=U),p.material=U}else if(!this.parent.skipMaterials){const W=u.Get(`${U}/material`,this._gltf.materials,t.material);L.push(this._loadMaterialAsync(`/materials/${W.index}`,W,p,q,(U=>{p.material=U})))}A=Promise.all(L),B&&(t._instanceData={babylonSourceMesh:p,promise:A}),k=p}return C.AddPointerMetadata(k,U),this._parent.onMeshLoadedObservable.notifyObservers(k),L(k),this.logClose(),A.then((()=>k))}_loadVertexDataAsync(U,W,l){const M=this._extensionsLoadVertexDataAsync(U,W,l);if(M)return M;const t=W.attributes;if(!t)throw new Error(`${U}: Attributes are missing`);const L=new Array,p=new D.e(l.name,this._babylonScene);if(void 0==W.indices)l.isUnIndexed=!0;else{const l=u.Get(`${U}/indices`,this._gltf.accessors,W.indices);L.push(this._loadIndicesAccessorAsync(`/accessors/${l.index}`,l).then((U=>{p.setIndices(U)})))}const B=(W,M,B)=>{if(void 0==t[W])return;l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(M)&&l._delayInfo.push(M);const k=u.Get(`${U}/attributes/${W}`,this._gltf.accessors,t[W]);L.push(this._loadVertexAccessorAsync(`/accessors/${k.index}`,k,M).then((U=>{if(U.getKind()===N.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!l.skeleton){const U=b(k);U&&(p._boundingInfo=U,p.useBoundingInfoFromGeometry=!0)}p.setVerticesBuffer(U,k.count)}))),M==N.e.MatricesIndicesExtraKind&&(l.numBoneInfluencers=8),B&&B(k)};return B("POSITION",N.e.PositionKind),B("NORMAL",N.e.NormalKind),B("TANGENT",N.e.TangentKind),B("TEXCOORD_0",N.e.UVKind),B("TEXCOORD_1",N.e.UV2Kind),B("TEXCOORD_2",N.e.UV3Kind),B("TEXCOORD_3",N.e.UV4Kind),B("TEXCOORD_4",N.e.UV5Kind),B("TEXCOORD_5",N.e.UV6Kind),B("JOINTS_0",N.e.MatricesIndicesKind),B("WEIGHTS_0",N.e.MatricesWeightsKind),B("JOINTS_1",N.e.MatricesIndicesExtraKind),B("WEIGHTS_1",N.e.MatricesWeightsExtraKind),B("COLOR_0",N.e.ColorKind,(U=>{"VEC4"===U.type&&(l.hasVertexAlpha=!0)})),Promise.all(L).then((()=>p))}_createMorphTargets(U,W,l,M,t){if(!M.targets||!this._parent.loadMorphTargets)return;if(void 0==W._numMorphTargets)W._numMorphTargets=M.targets.length;else if(M.targets.length!==W._numMorphTargets)throw new Error(`${U}: Primitives do not have the same number of targets`);const L=l.extras?l.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,t.morphTargetManager=new H(this._babylonScene),t.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.morphTargetManager.areUpdatesFrozen=!0;for(let p=0;p<M.targets.length;p++){const U=W.weights?W.weights[p]:l.weights?l.weights[p]:0,M=L?L[p]:`morphTarget${p}`;t.morphTargetManager.addTarget(new O.b(M,U,t.va()))}}_loadMorphTargetsAsync(U,W,l,M){if(!W.targets||!this._parent.loadMorphTargets)return Promise.resolve();const t=new Array,L=l.morphTargetManager;for(let p=0;p<L.numTargets;p++){const l=L.getTarget(p);t.push(this._loadMorphTargetVertexDataAsync(`${U}/targets/${p}`,M,W.targets[p],l))}return Promise.all(t).then((()=>{L.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(U,W,l,M){const t=new Array,L=(M,L,p)=>{if(void 0==l[M])return;const B=W.getVertexBuffer(L);if(!B)return;const k=u.Get(`${U}/${M}`,this._gltf.accessors,l[M]);t.push(this._loadFloatAccessorAsync(`/accessors/${k.index}`,k).then((U=>{p(B,U)})))};return L("POSITION",N.e.PositionKind,((U,W)=>{const l=new Float32Array(W.length);U.forEach(W.length,((U,M)=>{l[M]=W[M]+U})),M.setPositions(l)})),L("NORMAL",N.e.NormalKind,((U,W)=>{const l=new Float32Array(W.length);U.forEach(l.length,((U,M)=>{l[M]=W[M]+U})),M.setNormals(l)})),L("TANGENT",N.e.TangentKind,((U,W)=>{const l=new Float32Array(W.length/3*4);let t=0;U.forEach(W.length/3*4,((U,M)=>{(M+1)%4!==0&&(l[t]=W[t]+U,t++)})),M.setTangents(l)})),L("TEXCOORD_0",N.e.UVKind,((U,W)=>{const l=new Float32Array(W.length);U.forEach(W.length,((U,M)=>{l[M]=W[M]+U})),M.setUVs(l)})),L("TEXCOORD_1",N.e.UV2Kind,((U,W)=>{const l=new Float32Array(W.length);U.forEach(W.length,((U,M)=>{l[M]=W[M]+U})),M.setUV2s(l)})),L("COLOR_0",N.e.ColorKind,((W,l)=>{let t=null;const L=W.getSize();if(3===L){t=new Float32Array(l.length/3*4),W.forEach(l.length,((U,W)=>{const M=Math.floor(W/3),L=W%3;t[4*M+L]=l[3*M+L]+U}));for(let U=0;U<l.length/3;++U)t[4*U+3]=1}else{if(4!==L)throw new Error(`${U}: Invalid number of components (${L}) for COLOR_0 attribute`);t=new Float32Array(l.length),W.forEach(l.length,((U,W)=>{t[W]=l[W]+U}))}M.setColors(t)})),await Promise.all(t).then((()=>{}))}static _LoadTransform(U,W){if(void 0!=U.skin)return;let l=t.l.Zero(),M=t.e.Identity(),L=t.l.One();if(U.matrix){t.c.gk(U.matrix).decompose(L,M,l)}else U.translation&&(l=t.l.gk(U.translation)),U.rotation&&(M=t.e.gk(U.rotation)),U.scale&&(L=t.l.gk(U.scale));W.position=l,W.rotationQuaternion=M,W.yd=L}_loadSkinAsync(U,W,l,M){if(!this._parent.loadSkins)return Promise.resolve();const t=this._extensionsLoadSkinAsync(U,W,l);if(t)return t;if(l._data)return M(l._data.babylonSkeleton),l._data.promise;const L=`skeleton${l.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new m(l.name||L,L,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(U,l,p);const B=this._loadSkinInverseBindMatricesDataAsync(U,l).then((U=>{this._updateBoneMatrices(p,U)}));return l._data={babylonSkeleton:p,promise:B},M(p),B}_loadBones(U,W,l){if(void 0==W.skeleton||this._parent.alwaysComputeSkeletonRootNode){const l=this._findSkeletonRootNode(`${U}/joints`,W.joints);if(l)if(void 0===W.skeleton)W.skeleton=l.index;else{const M=(U,W)=>{for(;W.parent;W=W.parent)if(W.parent===U)return!0;return!1},t=u.Get(`${U}/skeleton`,this._gltf.nodes,W.skeleton);t===l||M(t,l)||(K.b.Warn(`${U}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),W.skeleton=l.index)}else K.b.Warn(`${U}: Failed to find common root`)}const M={};for(const t of W.joints){const L=u.Get(`${U}/joints/${t}`,this._gltf.nodes,t);this._loadBone(L,W,l,M)}}_findSkeletonRootNode(U,W){if(0===W.length)return null;const l={};for(const t of W){const W=[];let M=u.Get(`${U}/${t}`,this._gltf.nodes,t);for(;-1!==M.index;)W.unshift(M),M=M.parent;l[t]=W}let M=null;for(let t=0;;++t){let U=l[W[0]];if(t>=U.length)return M;const L=U[t];for(let p=1;p<W.length;++p)if(U=l[W[p]],t>=U.length||L!==U[t])return M;M=L}}_loadBone(U,W,l,M){U._isJoint=!0;let t=M[U.index];if(t)return t;let L=null;U.index!==W.skeleton&&(U.parent&&-1!==U.parent.index?L=this._loadBone(U.parent,W,l,M):void 0!==W.skeleton&&K.b.Warn(`/skins/${W.index}/skeleton: Skeleton node is not a common root`));const p=W.joints.indexOf(U.index);return t=new A.c(U.name||`joint${U.index}`,l,L,this._getNodeMatrix(U),null,null,p),M[U.index]=t,this._postSceneLoadActions.push((()=>{t.linkTransformNode(U._babylonTransformNode)})),t}_loadSkinInverseBindMatricesDataAsync(U,W){if(void 0==W.inverseBindMatrices)return Promise.resolve(null);const l=u.Get(`${U}/inverseBindMatrices`,this._gltf.accessors,W.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${l.index}`,l)}_updateBoneMatrices(U,W){for(const l of U.bones){const U=t.c.Identity(),M=l._index;W&&-1!==M&&(t.c.FromArrayToRef(W,16*M,U),U.invertToRef(U));const L=l.getParent();L&&U.multiplyToRef(L.getAbsoluteInverseBindMatrix(),U),l.wk(U,!1,!1),l._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(U){return U.matrix?t.c.gk(U.matrix):t.c.Compose(U.scale?t.l.gk(U.scale):t.l.One(),U.rotation?t.e.gk(U.rotation):t.e.Identity(),U.translation?t.l.gk(U.translation):t.l.Zero())}loadCameraAsync(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadCameraAsync(U,W,l);if(M)return M;const L=new Array;this.logOpen(`${U} ${W.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new k.c(W.name||`camera${W.index}`,t.l.Zero(),this._babylonScene,!1);switch(p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W._babylonCamera=p,p.setTarget(new t.l(0,0,-1)),W.type){case"perspective":{const l=W.perspective;if(!l)throw new Error(`${U}: Camera perspective properties are missing`);p.fov=l.yfov,p.bk=l.znear,p.maxZ=l.zfar||0;break}case"orthographic":if(!W.orthographic)throw new Error(`${U}: Camera orthographic properties are missing`);p.mode=B.d.ORTHOGRAPHIC_CAMERA,p.orthoLeft=-W.orthographic.xmag,p.orthoRight=W.orthographic.xmag,p.orthoBottom=-W.orthographic.ymag,p.orthoTop=W.orthographic.ymag,p.bk=W.orthographic.znear,p.maxZ=W.orthographic.zfar;break;default:throw new Error(`${U}: Invalid camera type (${W.type})`)}return C.AddPointerMetadata(p,U),this._parent.onCameraLoadedObservable.notifyObservers(p),l(p),this.logClose(),Promise.all(L).then((()=>p))}_loadAnimationsAsync(){const U=this._gltf.animations;if(!U)return Promise.resolve();const W=new Array;for(let l=0;l<U.length;l++){const M=U[l];W.push(this.loadAnimationAsync(`/animations/${M.index}`,M).then((U=>{0===U.targetedAnimations.length&&U.dispose()})))}return Promise.all(W).then((()=>{}))}loadAnimationAsync(U,W){const M=this._extensionsLoadAnimationAsync(U,W);return M||l.e(62).then(l.bind(l,13914)).then((l=>{let{AnimationGroup:M}=l;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new M(W.name||`animation${W.index}`,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W._babylonAnimationGroup=t;const L=new Array;u.Assign(W.channels),u.Assign(W.samplers);for(const p of W.channels)L.push(this._loadAnimationChannelAsync(`${U}/channels/${p.index}`,U,W,p,((U,W)=>{U.animations=U.animations||[],U.animations.push(W),t.addTargetedAnimation(W,U)})));return Promise.all(L).then((()=>(t.normalize(0),t)))}))}async _loadAnimationChannelAsync(U,W,M,t,L){const p=this._extensionsLoadAnimationChannelAsync(U,W,M,t,L);if(p)return await p;if(void 0==t.target.node)return await Promise.resolve();const B=u.Get(`${U}/target/node`,this._gltf.nodes,t.target.node),k=t.target.path,A="weights"===k;if(A&&!B._numMorphTargets||!A&&!B._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!A&&!B._isJoint)return await Promise.resolve();let q;switch(await Promise.resolve().then(l.bind(l,12655)),k){case"translation":var y;q=null===(y=(0,J.g)("/nodes/{}/translation"))||void 0===y?void 0:y.interpolation;break;case"rotation":var j;q=null===(j=(0,J.g)("/nodes/{}/rotation"))||void 0===j?void 0:j.interpolation;break;case"scale":var s;q=null===(s=(0,J.g)("/nodes/{}/scale"))||void 0===s?void 0:s.interpolation;break;case"weights":var w;q=null===(w=(0,J.g)("/nodes/{}/weights"))||void 0===w?void 0:w.interpolation;break;default:throw new Error(`${U}/target/path: Invalid value (${t.target.path})`)}if(!q)throw new Error(`${U}/target/path: Could not find interpolation properties for target path (${t.target.path})`);const K={object:B,info:q};return await this._loadAnimationChannelFromTargetInfoAsync(U,W,M,t,K,L)}_loadAnimationChannelFromTargetInfoAsync(U,W,l,M,t,L){const p=this.parent.targetFps,B=1/p,k=u.Get(`${U}/sampler`,l.samplers,M.sampler);return this._loadAnimationSamplerAsync(`${W}/samplers/${M.sampler}`,k).then((U=>{let W=0;const k=t.object,A=t.info;for(const t of A){const A=t.getStride(k),q=U.input,y=U.output,j=new Array(q.length);let s=0;switch(U.interpolation){case"STEP":for(let U=0;U<q.length;U++){const W=t.getValue(k,y,s,1);s+=A,j[U]={frame:q[U]*p,value:W,interpolation:1}}break;case"CUBICSPLINE":for(let U=0;U<q.length;U++){const W=t.getValue(k,y,s,B);s+=A;const l=t.getValue(k,y,s,1);s+=A;const M=t.getValue(k,y,s,B);s+=A,j[U]={frame:q[U]*p,inTangent:W,value:l,outTangent:M}}break;case"LINEAR":for(let U=0;U<q.length;U++){const W=t.getValue(k,y,s,1);s+=A,j[U]={frame:q[U]*p,value:W}}}if(s>0){const U=`${l.name||`animation${l.index}`}_channel${M.index}_${W}`,B=t.buildAnimations(k,U,p,j);for(const l of B)W++,L(l.babylonAnimatable,l.babylonAnimation)}}}))}_loadAnimationSamplerAsync(U,W){if(W._data)return W._data;const l=W.interpolation||"LINEAR";switch(l){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${U}/interpolation: Invalid value (${W.interpolation})`)}const M=u.Get(`${U}/input`,this._gltf.accessors,W.input),t=u.Get(`${U}/output`,this._gltf.accessors,W.output);return W._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${M.index}`,M),this._loadFloatAccessorAsync(`/accessors/${t.index}`,t)]).then((U=>{let[W,M]=U;return{input:W,interpolation:l,output:M}})),W._data}loadBufferAsync(U,W,l,M){const t=this._extensionsLoadBufferAsync(U,W,l,M);if(t)return t;if(!W._data)if(W.uri)W._data=this.loadUriAsync(`${U}/uri`,W,W.uri);else{if(!this._bin)throw new Error(`${U}: Uri is missing or the binary glTF is missing its binary chunk`);W._data=this._bin.readAsync(0,W.byteLength)}return W._data.then((W=>{try{return new Uint8Array(W.buffer,W.byteOffset+l,M)}catch(t){throw new Error(`${U}: ${t.message}`)}}))}loadBufferViewAsync(U,W){const l=this._extensionsLoadBufferViewAsync(U,W);if(l)return l;if(W._data)return W._data;const M=u.Get(`${U}/buffer`,this._gltf.buffers,W.buffer);return W._data=this.loadBufferAsync(`/buffers/${M.index}`,M,W.byteOffset||0,W.byteLength),W._data}_loadAccessorAsync(U,W,l){if(W._data)return W._data;const M=C._GetNumComponents(U,W.type),t=M*N.e.GetTypeByteLength(W.componentType),L=M*W.count;if(void 0==W.bufferView)W._data=Promise.resolve(new l(L));else{const p=u.Get(`${U}/bufferView`,this._gltf.bufferViews,W.bufferView);W._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((B=>{if(5126!==W.componentType||W.normalized||p.byteStride&&p.byteStride!==t){const U=new l(L);return N.e.ForEach(B,W.byteOffset||0,p.byteStride||t,M,W.componentType,U.length,W.normalized||!1,((W,l)=>{U[l]=W})),U}return C._GetTypedArray(U,W.componentType,B,W.byteOffset,L)}))}if(W.sparse){const L=W.sparse;W._data=W._data.then((p=>{const B=p,k=u.Get(`${U}/sparse/indices/bufferView`,this._gltf.bufferViews,L.indices.bufferView),A=u.Get(`${U}/sparse/values/bufferView`,this._gltf.bufferViews,L.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${k.index}`,k),this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)]).then((p=>{let[k,A]=p;const q=C._GetTypedArray(`${U}/sparse/indices`,L.indices.componentType,k,L.indices.byteOffset,L.count),y=M*L.count;let j;if(5126!==W.componentType||W.normalized){const p=C._GetTypedArray(`${U}/sparse/values`,W.componentType,A,L.values.byteOffset,y);j=new l(y),N.e.ForEach(p,0,t,M,W.componentType,j.length,W.normalized||!1,((U,W)=>{j[W]=U}))}else j=C._GetTypedArray(`${U}/sparse/values`,W.componentType,A,L.values.byteOffset,y);let s=0;for(let U=0;U<q.length;U++){let W=q[U]*M;for(let U=0;U<M;U++)B[W++]=j[s++]}return B}))}))}return W._data}_loadFloatAccessorAsync(U,W){return this._loadAccessorAsync(U,W,Float32Array)}_loadIndicesAccessorAsync(U,W){if("SCALAR"!==W.type)throw new Error(`${U}/type: Invalid value ${W.type}`);if(5121!==W.componentType&&5123!==W.componentType&&5125!==W.componentType)throw new Error(`${U}/componentType: Invalid value ${W.componentType}`);if(W._data)return W._data;if(W.sparse){const l=C._GetTypedArrayConstructor(`${U}/componentType`,W.componentType);W._data=this._loadAccessorAsync(U,W,l)}else{const l=u.Get(`${U}/bufferView`,this._gltf.bufferViews,W.bufferView);W._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((l=>C._GetTypedArray(U,W.componentType,l,W.byteOffset,W.count)))}return W._data}_loadVertexBufferViewAsync(U){if(U._babylonBuffer)return U._babylonBuffer;const W=this._babylonScene.getEngine();return U._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((U=>new N.b(W,U,!1))),U._babylonBuffer}_loadVertexAccessorAsync(U,W,l){var M;if(null!==(M=W._babylonVertexBuffer)&&void 0!==M&&M[l])return W._babylonVertexBuffer[l];W._babylonVertexBuffer||(W._babylonVertexBuffer={});const t=this._babylonScene.getEngine();if(W.sparse||void 0==W.bufferView)W._babylonVertexBuffer[l]=this._loadFloatAccessorAsync(U,W).then((U=>new N.e(t,U,l,!1)));else{const M=u.Get(`${U}/bufferView`,this._gltf.bufferViews,W.bufferView);W._babylonVertexBuffer[l]=this._loadVertexBufferViewAsync(M).then((L=>{const p=C._GetNumComponents(U,W.type);return new N.e(t,L,l,!1,void 0,M.byteStride,void 0,W.byteOffset,p,W.componentType,W.normalized,!0,void 0,!0)}))}return W._babylonVertexBuffer[l]}_loadMaterialMetallicRoughnessPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return W&&(W.baseColorFactor?(l.albedoColor=L.e.gk(W.baseColorFactor),l.alpha=W.baseColorFactor[3]):l.albedoColor=L.e.White(),l.metallic=void 0==W.metallicFactor?1:W.metallicFactor,l.roughness=void 0==W.roughnessFactor?1:W.roughnessFactor,W.baseColorTexture&&M.push(this.loadTextureInfoAsync(`${U}/baseColorTexture`,W.baseColorTexture,(U=>{U.name=`${l.name} (Base Color)`,l.albedoTexture=U}))),W.metallicRoughnessTexture&&(W.metallicRoughnessTexture.nonColorData=!0,M.push(this.loadTextureInfoAsync(`${U}/metallicRoughnessTexture`,W.metallicRoughnessTexture,(U=>{U.name=`${l.name} (Metallic Roughness)`,l.metallicTexture=U}))),l.useMetallnessFromMetallicTextureBlue=!0,l.useRoughnessFromMetallicTextureGreen=!0,l.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(M).then((()=>{}))}_loadMaterialAsync(U,W,l,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const L=this._extensionsLoadMaterialAsync(U,W,l,M,t);if(L)return L;W._data=W._data||{};let p=W._data[M];if(!p){this.logOpen(`${U} ${W.name||""}`);const l=this.createMaterial(U,W,M);p={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(U,W,l)},W._data[M]=p,C.AddPointerMetadata(l,U),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return l&&(p.babylonMeshes.push(l),l.nk.addOnce((()=>{const U=p.babylonMeshes.indexOf(l);-1!==U&&p.babylonMeshes.splice(U,1)}))),t(p.babylonMaterial),p.promise.then((()=>p.babylonMaterial))}_createDefaultMaterial(U,W){this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new g.c(U,this._babylonScene);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.fillMode=W,l.enableSpecularAntiAliasing=!0,l.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,l.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,l.transparencyMode=g.c.PBRMATERIAL_OPAQUE,l.metallic=1,l.roughness=1,l}createMaterial(U,W,l){const M=this._extensionsCreateMaterial(U,W,l);if(M)return M;const t=W.name||`material${W.index}`;return this._createDefaultMaterial(t,l)}loadMaterialPropertiesAsync(U,W,l){const M=this._extensionsLoadMaterialPropertiesAsync(U,W,l);if(M)return M;const t=new Array;return t.push(this.loadMaterialBasePropertiesAsync(U,W,l)),W.pbrMetallicRoughness&&t.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${U}/pbrMetallicRoughness`,W.pbrMetallicRoughness,l)),this.loadMaterialAlphaProperties(U,W,l),Promise.all(t).then((()=>{}))}loadMaterialBasePropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return l.emissiveColor=W.emissiveFactor?L.e.gk(W.emissiveFactor):new L.e(0,0,0),W.doubleSided&&(l.sk=!1,l.twoSidedLighting=!0),W.normalTexture&&(W.normalTexture.nonColorData=!0,M.push(this.loadTextureInfoAsync(`${U}/normalTexture`,W.normalTexture,(U=>{U.name=`${l.name} (Normal)`,l.bumpTexture=U}))),l.invertNormalMapX=!this._babylonScene.useRightHandedSystem,l.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=W.normalTexture.scale&&l.bumpTexture&&(l.bumpTexture.level=W.normalTexture.scale),l.forceIrradianceInFragment=!0),W.occlusionTexture&&(W.occlusionTexture.nonColorData=!0,M.push(this.loadTextureInfoAsync(`${U}/occlusionTexture`,W.occlusionTexture,(U=>{U.name=`${l.name} (Occlusion)`,l.ambientTexture=U}))),l.useAmbientInGrayScale=!0,void 0!=W.occlusionTexture.strength&&(l.ambientTextureStrength=W.occlusionTexture.strength)),W.emissiveTexture&&M.push(this.loadTextureInfoAsync(`${U}/emissiveTexture`,W.emissiveTexture,(U=>{U.name=`${l.name} (Emissive)`,l.emissiveTexture=U}))),Promise.all(M).then((()=>{}))}loadMaterialAlphaProperties(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);switch(W.alphaMode||"OPAQUE"){case"OPAQUE":l.transparencyMode=g.c.PBRMATERIAL_OPAQUE,l.alpha=1;break;case"MASK":l.transparencyMode=g.c.PBRMATERIAL_ALPHATEST,l.alphaCutOff=void 0==W.alphaCutoff?.5:W.alphaCutoff,l.albedoTexture&&(l.albedoTexture.yi=!0);break;case"BLEND":l.transparencyMode=g.c.PBRMATERIAL_ALPHABLEND,l.albedoTexture&&(l.albedoTexture.yi=!0,l.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${U}/alphaMode: Invalid value (${W.alphaMode})`)}}loadTextureInfoAsync(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadTextureInfoAsync(U,W,l);if(M)return M;if(this.logOpen(`${U}`),W.texCoord>=6)throw new Error(`${U}/texCoord: Invalid value (${W.texCoord})`);const t=u.Get(`${U}/index`,this._gltf.textures,W.index);t._textureInfo=W;const L=this._loadTextureAsync(`/textures/${W.index}`,t,(M=>{M.coordinatesIndex=W.texCoord||0,C.AddPointerMetadata(M,U),this._parent.onTextureLoadedObservable.notifyObservers(M),l(M)}));return this.logClose(),L}_loadTextureAsync(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadTextureAsync(U,W,l);if(M)return M;this.logOpen(`${U} ${W.name||""}`);const t=void 0==W.sampler?C.DefaultSampler:u.Get(`${U}/sampler`,this._gltf.samplers,W.sampler),L=u.Get(`${U}/source`,this._gltf.images,W.source),p=this._createTextureAsync(U,t,L,l,void 0,!W._textureInfo.nonColorData);return this.logClose(),p}_createTextureAsync(U,W,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},L=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;const B=this._loadSampler(`/samplers/${W.index}`,W),k=new Array,A=new M;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q={noMipmap:B.noMipMaps,invertY:!1,samplingMode:B.samplingMode,X:()=>{this._disposed||A.resolve()},onError:(W,l)=>{this._disposed||A.reject(new Error(`${U}: ${l&&l.message?l.message:W||"Failed to load texture"}`))},mimeType:l.mimeType??(0,n.e)(l.uri??""),loaderOptions:L,useSRGBBuffer:!!p&&this._parent.useSRGBBuffers},y=new E.d(null,this._babylonScene,q);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.push(A.promise),k.push(this.loadImageAsync(`/images/${l.index}`,l).then((U=>{const W=l.uri||`${this._fileName}#image${l.index}`,M=`data:${this._uniqueRootUrl}${W}`;y.updateURL(M,U);const t=y.getInternalTexture();t&&(t.label=l.name)}))),y.wrapU=B.wrapU,y.wrapV=B.wrapV,t(y),this._parent.useGltfTextureNames&&(y.name=l.name||l.uri||`image${l.index}`),Promise.all(k).then((()=>y))}_loadSampler(U,W){return W._data||(W._data={noMipMaps:9728===W.minFilter||9729===W.minFilter,samplingMode:C._GetTextureSamplingMode(U,W),wrapU:C._GetTextureWrapMode(`${U}/wrapS`,W.wrapS),wrapV:C._GetTextureWrapMode(`${U}/wrapT`,W.wrapT)}),W._data}loadImageAsync(U,W){if(!W._data){if(this.logOpen(`${U} ${W.name||""}`),W.uri)W._data=this.loadUriAsync(`${U}/uri`,W,W.uri);else{const l=u.Get(`${U}/bufferView`,this._gltf.bufferViews,W.bufferView);W._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}this.logClose()}return W._data}loadUriAsync(U,W,l){const M=this._extensionsLoadUriAsync(U,W,l);if(M)return M;if(!C._ValidateUri(l))throw new Error(`${U}: '${l}' is invalid`);if((0,n.f)(l)){const W=new Uint8Array((0,n.c)(l));return this.log(`${U}: Decoded ${l.substring(0,64)}... (${W.length} bytes)`),Promise.resolve(W)}return this.log(`${U}: Loading ${l}`),this._parent.preprocessUrlAsync(this._rootUrl+l).then((W=>new Promise(((M,t)=>{this._parent._loadFile(this._babylonScene,W,(W=>{this._disposed||(this.log(`${U}: Loaded ${l} (${W.byteLength} bytes)`),M(new Uint8Array(W)))}),!0,(W=>{t(new n.j(`${U}: Failed to load '${l}'${W?": "+W.status+" "+W.statusText:""}`,W))}))}))))}static AddPointerMetadata(U,W){U.metadata=U.metadata||{};const l=U._internalMetadata=U._internalMetadata||{},M=l.Tk=l.Tk||{};(M.pointers=M.pointers||[]).push(W)}static _GetTextureWrapMode(U,W){switch(W=void 0==W?10497:W){case 33071:return E.d.CLAMP_ADDRESSMODE;case 33648:return E.d.MIRROR_ADDRESSMODE;case 10497:return E.d.WRAP_ADDRESSMODE;default:return K.b.Warn(`${U}: Invalid value (${W})`),E.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(U,W){const l=void 0==W.magFilter?9729:W.magFilter,M=void 0==W.minFilter?9987:W.minFilter;if(9729===l)switch(M){case 9728:return E.d.LINEAR_NEAREST;case 9729:return E.d.LINEAR_LINEAR;case 9984:return E.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return E.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return E.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return E.d.LINEAR_LINEAR_MIPLINEAR;default:return K.b.Warn(`${U}/minFilter: Invalid value (${M})`),E.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==l&&K.b.Warn(`${U}/magFilter: Invalid value (${l})`),M){case 9728:return E.d.NEAREST_NEAREST;case 9729:return E.d.NEAREST_LINEAR;case 9984:return E.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return E.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return E.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return E.d.NEAREST_LINEAR_MIPLINEAR;default:return K.b.Warn(`${U}/minFilter: Invalid value (${M})`),E.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(U,W){try{return(0,G.n)(W)}catch(l){throw new Error(`${U}: ${l.message}`)}}static _GetTypedArray(U,W,l,M,t){const L=l.buffer;M=l.byteOffset+(M||0);const p=C._GetTypedArrayConstructor(`${U}/componentType`,W),B=N.e.GetTypeByteLength(W);return M%B!==0?(K.b.Warn(`${U}: Copying buffer as byte offset (${M}) is not a multiple of component type byte length (${B})`),new p(L.slice(M,M+t*B),0)):new p(L,M,t)}static _GetNumComponents(U,W){switch(W){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${U}: Invalid type (${W})`)}static _ValidateUri(U){return p.h.IsBase64(U)||-1===U.indexOf("..")}static _GetDrawMode(U,W){switch(void 0==W&&(W=4),W){case 0:return f.b.PointListDrawMode;case 1:return f.b.LineListDrawMode;case 2:return f.b.LineLoopDrawMode;case 3:return f.b.LineStripDrawMode;case 4:return f.b.TriangleFillMode;case 5:return f.b.TriangleStripDrawMode;case 6:return f.b.TriangleFanDrawMode}throw new Error(`${U}: Invalid mesh primitive mode (${W})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const U=new Array;if(this._gltf.materials)for(const W of this._gltf.materials)if(W._data)for(const l in W._data){const M=W._data[l];for(const W of M.babylonMeshes){W.fk(!0);const l=M.babylonMaterial;U.push(l.forceCompilationAsync(W)),U.push(l.forceCompilationAsync(W,{useInstances:!0})),this._parent.useClipPlane&&(U.push(l.forceCompilationAsync(W,{clipPlane:!0})),U.push(l.forceCompilationAsync(W,{clipPlane:!0,useInstances:!0})))}}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const U=new Array,W=this._babylonScene.lights;for(const l of W){const W=l.getShadowGenerator();W&&U.push(W.forceCompilationAsync())}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(U){for(const W of this._extensions)W.enabled&&U(W)}_applyExtensions(U,W,l){for(const M of this._extensions)if(M.enabled){const t=`${M.name}.${W}`,L=U;L._activeLoaderExtensionFunctions=L._activeLoaderExtensionFunctions||{};const p=L._activeLoaderExtensionFunctions;if(!p[t]){p[t]=!0;try{const U=l(M);if(U)return U}finally{delete p[t]}}}return null}_extensionsOnLoading(){this._forEachExtensions((U=>U.onLoading&&U.onLoading()))}_extensionsOnReady(){this._forEachExtensions((U=>U.onReady&&U.onReady()))}_extensionsLoadSceneAsync(U,W){return this._applyExtensions(W,"loadScene",(l=>l.loadSceneAsync&&l.loadSceneAsync(U,W)))}_extensionsLoadNodeAsync(U,W,l){return this._applyExtensions(W,"loadNode",(M=>M.loadNodeAsync&&M.loadNodeAsync(U,W,l)))}_extensionsLoadCameraAsync(U,W,l){return this._applyExtensions(W,"loadCamera",(M=>M.loadCameraAsync&&M.loadCameraAsync(U,W,l)))}_extensionsLoadVertexDataAsync(U,W,l){return this._applyExtensions(W,"loadVertexData",(M=>M._loadVertexDataAsync&&M._loadVertexDataAsync(U,W,l)))}_extensionsLoadMeshPrimitiveAsync(U,W,l,M,t,L){return this._applyExtensions(t,"loadMeshPrimitive",(p=>p._loadMeshPrimitiveAsync&&p._loadMeshPrimitiveAsync(U,W,l,M,t,L)))}_extensionsLoadMaterialAsync(U,W,l,M,t){return this._applyExtensions(W,"loadMaterial",(L=>L._loadMaterialAsync&&L._loadMaterialAsync(U,W,l,M,t)))}_extensionsCreateMaterial(U,W,l){return this._applyExtensions(W,"createMaterial",(M=>M.createMaterial&&M.createMaterial(U,W,l)))}_extensionsLoadMaterialPropertiesAsync(U,W,l){return this._applyExtensions(W,"loadMaterialProperties",(M=>M.loadMaterialPropertiesAsync&&M.loadMaterialPropertiesAsync(U,W,l)))}_extensionsLoadTextureInfoAsync(U,W,l){return this._applyExtensions(W,"loadTextureInfo",(M=>M.loadTextureInfoAsync&&M.loadTextureInfoAsync(U,W,l)))}_extensionsLoadTextureAsync(U,W,l){return this._applyExtensions(W,"loadTexture",(M=>M._loadTextureAsync&&M._loadTextureAsync(U,W,l)))}_extensionsLoadAnimationAsync(U,W){return this._applyExtensions(W,"loadAnimation",(l=>l.loadAnimationAsync&&l.loadAnimationAsync(U,W)))}_extensionsLoadAnimationChannelAsync(U,W,l,M,t){return this._applyExtensions(l,"loadAnimationChannel",(L=>L._loadAnimationChannelAsync&&L._loadAnimationChannelAsync(U,W,l,M,t)))}_extensionsLoadSkinAsync(U,W,l){return this._applyExtensions(l,"loadSkin",(M=>M._loadSkinAsync&&M._loadSkinAsync(U,W,l)))}_extensionsLoadUriAsync(U,W,l){return this._applyExtensions(W,"loadUri",(M=>M._loadUriAsync&&M._loadUriAsync(U,W,l)))}_extensionsLoadBufferViewAsync(U,W){return this._applyExtensions(W,"loadBufferView",(l=>l.loadBufferViewAsync&&l.loadBufferViewAsync(U,W)))}_extensionsLoadBufferAsync(U,W,l,M){return this._applyExtensions(W,"loadBuffer",(t=>t.loadBufferAsync&&t.loadBufferAsync(U,W,l,M)))}static LoadExtensionAsync(U,W,l,M){if(!W.extensions)return null;const t=W.extensions[l];return t?M(`${U}/extensions/${l}`,t):null}static LoadExtraAsync(U,W,l,M){if(!W.extras)return null;const t=W.extras[l];return t?M(`${U}/extras/${l}`,t):null}isExtensionUsed(U){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(U)}logOpen(U){this._parent._logOpen(U)}logClose(){this._parent._logClose()}log(U){this._parent._log(U)}startPerformanceCounter(U){this._parent._startPerformanceCounter(U)}endPerformanceCounter(U){this._parent._endPerformanceCounter(U)}}C.DefaultSampler={index:-1},V.b._CreateGLTF2Loader=U=>new C(U);var P=l(12655),S=l(2009),c=l(734),h=l(2175),z=l(12662);class a extends z.e{constructor(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",U),this._texture=U.getEngine().createRawCubeTexture(W,l,M,t,L,p,B,k)}update(U,W,l,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,U,W,l,M,t)}updateRGBDAsync(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,h.l)(this._texture,U,W,l,M).then((()=>{}))}clone(){return c.e.Clone((()=>{const U=this.va(),W=this._texture,l=new a(U,W._bufferViewArray,W.width,W.format,W.type,W.generateMipMaps,W.invertY,W.samplingMode,W._compression);return 13===W.source&&l.updateRGBDAsync(W._bufferViewArrayArray,W._sphericalPolynomial,W._lodGenerationScale,W._lodGenerationOffset),l}),this)}}const Y="EXT_lights_image_based";class X{constructor(U){this.name=Y,this._loader=U,this.enabled=this._loader.isExtensionUsed(Y)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Tk.extensions;if(U&&U[this.name]){const W=U[this.name];this._lights=W.lights}}loadSceneAsync(U,W){return C.LoadExtensionAsync(U,W,this.name,(async(l,M)=>{this._loader._allMaterialsDirtyRequired=!0;const t=new Array;t.push(this._loader.loadSceneAsync(U,W)),this._loader.logOpen(`${l}`);const L=u.Get(`${l}/light`,this._lights,M.ab);return t.push(this._loadLightAsync(`/extensions/${this.name}/lights/${M.ab}`,L).then((U=>{this._loader.babylonScene.environmentTexture=U}))),this._loader.logClose(),await Promise.all(t).then((()=>{}))}))}_loadLightAsync(U,W){if(!W._loaded){const l=new Array;this._loader.logOpen(`${U}`);const M=new Array(W.specularImages.length);for(let t=0;t<W.specularImages.length;t++){const L=W.specularImages[t];M[t]=new Array(L.length);for(let W=0;W<L.length;W++){const p=`${U}/specularImages/${t}/${W}`;this._loader.logOpen(`${p}`);const B=L[W],k=u.Get(p,this._loader.Tk.images,B);l.push(this._loader.loadImageAsync(`/images/${B}`,k).then((U=>{M[t][W]=U}))),this._loader.logClose()}}this._loader.logClose(),W._loaded=Promise.all(l).then((async()=>{const l=new a(this._loader.babylonScene,null,W.specularImageSize);if(l.name=W.name||"environment",W._babylonTexture=l,void 0!=W.bb&&(l.level=W.bb),W.rotation){let U=t.e.gk(W.rotation);this._loader.babylonScene.useRightHandedSystem||(U=t.e.Inverse(U)),t.c.FromQuaternionToRef(U,l.getReflectionTextureMatrix())}if(!W.irradianceCoefficients)throw new Error(`${U}: Irradiance coefficients are missing`);const L=S.b.gk(W.irradianceCoefficients);L.scaleInPlace(W.bb),L.convertIrradianceToLambertianRadiance();const p=S.d.FromHarmonics(L),B=(M.length-1)/Math.log2(W.specularImageSize);return await l.updateRGBDAsync(M,p,B)}))}return W._loaded.then((()=>W._babylonTexture))}}v(Y),F(Y,!0,(U=>new X(U)));l(485);const T="EXT_mesh_gpu_instancing";class UU{constructor(U){this.name=T,this._loader=U,this.enabled=this._loader.isExtensionUsed(T)}dispose(){this._loader=null}loadNodeAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(U,M)=>{this._loader._disableInstancedMesh++;const L=this._loader.loadNodeAsync(`/nodes/${W.index}`,W,l);if(this._loader._disableInstancedMesh--,!W._primitiveBabylonMeshes)return await L;const p=new Array;let B=0;const k=W=>{if(void 0==M.attributes[W])return void p.push(Promise.resolve(null));const l=u.Get(`${U}/attributes/${W}`,this._loader.Tk.accessors,M.attributes[W]);if(p.push(this._loader._loadFloatAccessorAsync(`/accessors/${l.bufferView}`,l)),0===B)B=l.count;else if(B!==l.count)throw new Error(`${U}/attributes: Instance buffer accessors do not have the same count.`)};return k("TRANSLATION"),k("ROTATION"),k("SCALE"),await L.then((async U=>{const[l,M,L]=await Promise.all(p),k=new Float32Array(16*B);t.f.ik[0].wd(0,0,0),t.f.Quaternion[0].wd(0,0,0,1),t.f.ik[1].wd(1,1,1);for(let W=0;W<B;++W)l&&t.l.FromArrayToRef(l,3*W,t.f.ik[0]),M&&t.e.FromArrayToRef(M,4*W,t.f.Quaternion[0]),L&&t.l.FromArrayToRef(L,3*W,t.f.ik[1]),t.c.ComposeToRef(t.f.ik[1],t.f.Quaternion[0],t.f.ik[0],t.f.Matrix[0]),t.f.Matrix[0].copyToArray(k,16*W);for(const t of W._primitiveBabylonMeshes)t.Ik("matrix",k,16,!0);return U}))}))}}v(T),F(T,!0,(U=>new UU(U)));let WU=0,lU=null;class MU{static get Default(){return MU._Default||(MU._Default=new MU),MU._Default}constructor(){const U=MU.Configuration.decoder;this._decoderModulePromise=p.h.LoadBabylonScriptAsync(U.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(U,W,l,M,t){await this._decoderModulePromise,0===WU&&(MeshoptDecoder.useWorkers(1),WU=1);const L=await MeshoptDecoder.decodeGltfBufferAsync(W,l,U,M,t);return null!==lU&&clearTimeout(lU),lU=setTimeout((()=>{MeshoptDecoder.useWorkers(0),WU=0,lU=null}),1e3),L}}MU.Configuration={decoder:{url:`${p.h._DefaultCdnUrl}/meshopt_decoder.js`}},MU._Default=null;const tU="EXT_meshopt_compression";class LU{constructor(U){this.name=tU,this.enabled=U.isExtensionUsed(tU),this._loader=U}dispose(){this._loader=null}loadBufferViewAsync(U,W){return C.LoadExtensionAsync(U,W,this.name,(async(l,M)=>{const t=W;if(t._meshOptData)return await t._meshOptData;const L=u.Get(`${U}/buffer`,this._loader.Tk.buffers,M.buffer);return t._meshOptData=this._loader.loadBufferAsync(`/buffers/${L.index}`,L,M.byteOffset||0,M.byteLength).then((async U=>await MU.Default.decodeGltfBufferAsync(U,M.count,M.byteStride,M.mode,M.filter))),await t._meshOptData}))}}v(tU),F(tU,!0,(U=>new LU(U)));const pU="EXT_texture_webp";class BU{constructor(U){this.name=pU,this._loader=U,this.enabled=U.isExtensionUsed(pU)}dispose(){this._loader=null}_loadTextureAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=void 0==W.sampler?C.DefaultSampler:u.Get(`${U}/sampler`,this._loader.Tk.samplers,W.sampler),p=u.Get(`${M}/source`,this._loader.Tk.images,t.source);return await this._loader._createTextureAsync(U,L,p,(U=>{l(U)}),void 0,!W._textureInfo.nonColorData)}))}}v(pU),F(pU,!0,(U=>new BU(U)));const kU="EXT_texture_avif";class AU{constructor(U){this.name=kU,this._loader=U,this.enabled=U.isExtensionUsed(kU)}dispose(){this._loader=null}_loadTextureAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=void 0==W.sampler?C.DefaultSampler:u.Get(`${U}/sampler`,this._loader.Tk.samplers,W.sampler),p=u.Get(`${M}/source`,this._loader.Tk.images,t.source);return await this._loader._createTextureAsync(U,L,p,(U=>{l(U)}),void 0,!W._textureInfo.nonColorData)}))}}v(kU),F(kU,!0,(U=>new AU(U)));var qU=l(12646),yU=l(11868);const jU="EXT_lights_ies";class sU{constructor(U){this.name=jU,this._loader=U,this.enabled=this._loader.isExtensionUsed(jU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Tk.extensions;if(U&&U[this.name]){const W=U[this.name];this._lights=W.lights,u.Assign(this._lights)}}loadNodeAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,p)=>{let B,k;this._loader._allMaterialsDirtyRequired=!0;const A=await this._loader.loadNodeAsync(U,W,(U=>{k=u.Get(M,this._lights,p.ab);const W=k.name||U.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,B=new qU.d(W,t.l.Zero(),t.l.Backward(),0,1,this._loader.babylonScene),B.angle=Math.PI/2,B.innerAngle=0,B._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,k._babylonLight=B,B.falloffType=yU.c.FALLOFF_GLTF,B.cb=p.color?L.e.gk(p.color):L.e.White(),B.bb=p.multiplier||1,B.range=Number.MAX_VALUE,B.parent=U,this._loader._babylonLights.push(B),C.AddPointerMetadata(B,M),l(U)}));let q;if(k.uri)q=await this._loader.loadUriAsync(U,k,k.uri);else{const W=u.Get(`${U}/bufferView`,this._loader.Tk.bufferViews,k.bufferView);q=await this._loader.loadBufferViewAsync(`/bufferViews/${W.index}`,W)}return B.iesProfileTexture=new E.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,q,!0,void 0,void 0,void 0,void 0,".ies"),A}))}}v(jU),F(jU,!0,(U=>new sU(U)));var wU=l(12670);const KU="KHR_draco_mesh_compression";class rU{constructor(U){this.name=KU,this.useNormalizedFlagFromAccessor=!0,this._loader=U,this.enabled=wU.b.DefaultAvailable&&this._loader.isExtensionUsed(KU)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{if(void 0!=W.mode&&4!==W.mode&&5!==W.mode)throw new Error(`${U}: Unsupported mode ${W.mode}`);const L={},p={},B=(U,M)=>{const B=t.attributes[U];if(void 0!=B&&(l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(M)&&l._delayInfo.push(M),L[M]=B,this.useNormalizedFlagFromAccessor)){const l=u.TryGet(this._loader.Tk.accessors,W.attributes[U]);l&&(p[M]=l.normalized||!1)}};B("POSITION",N.e.PositionKind),B("NORMAL",N.e.NormalKind),B("TANGENT",N.e.TangentKind),B("TEXCOORD_0",N.e.UVKind),B("TEXCOORD_1",N.e.UV2Kind),B("TEXCOORD_2",N.e.UV3Kind),B("TEXCOORD_3",N.e.UV4Kind),B("TEXCOORD_4",N.e.UV5Kind),B("TEXCOORD_5",N.e.UV6Kind),B("JOINTS_0",N.e.MatricesIndicesKind),B("WEIGHTS_0",N.e.MatricesWeightsKind),B("COLOR_0",N.e.ColorKind);const k=u.Get(M,this._loader.Tk.bufferViews,t.bufferView);return k._dracoBabylonGeometry||(k._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${k.index}`,k).then((async M=>{const t=this.dracoDecoder||wU.b.Default,B=u.TryGet(this._loader.Tk.accessors,W.attributes.POSITION),k=this._loader.parent.alwaysComputeBoundingBox||l.skeleton||!B?null:b(B);return await t._decodeMeshToGeometryForGltfAsync(l.name,this._loader.babylonScene,M,L,p,k).catch((W=>{throw new Error(`${U}: ${W.message}`)}))}))),await k._dracoBabylonGeometry}))}}v(KU),F(KU,!0,(U=>new rU(U)));var mU=l(12678),fU=l(686),gU=l(688),EU=l(730),ZU=l(11914),NU=l(655);EU.c.AddNodeConstructor("Light_Type_0",((U,W)=>()=>new DU(U,t.l.Zero(),W)));class DU extends ZU.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(U){this._shadowAngle=U,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(U){const W=this.needCube();if(this._direction=U,this.needCube()!==W&&this._shadowGenerators){const U=this._shadowGenerators.values();for(let W=U.next();!0!==W.done;W=U.next()){W.value.recreateShadowMap()}}}constructor(U,W,l){super(U,l),this._shadowAngle=Math.PI/2,this.position=W}getClassName(){return"PointLight"}getTypeID(){return yU.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(U){if(this.direction)return super.getShadowDirection(U);switch(U){case 0:return new t.l(1,0,0);case 1:return new t.l(-1,0,0);case 2:return new t.l(0,-1,0);case 3:return new t.l(0,1,0);case 4:return new t.l(0,0,1);case 5:return new t.l(0,0,-1)}return t.l.Zero()}_setDefaultShadowProjectionMatrix(U,W,l){const M=this.va().activeCamera;if(!M)return;const L=void 0!==this.shadowMinZ?this.shadowMinZ:M.bk,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ,B=this.va().getEngine().useReverseDepthBuffer;t.c.PerspectiveFovLHToRef(this.shadowAngle,1,B?p:L,B?L:p,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,B)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,W){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,W):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,W),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,W),this}transferToNodeMaterialEffect(U,W){return this.computeTransformedInformation()?U.setFloat3(W,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):U.setFloat3(W,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(U,W){U["POINTLIGHT"+W]=!0}}(0,fU.e)([(0,gU.T)()],DU.prototype,"shadowAngle",null),(0,NU.f)("BABYLON.PointLight",DU);const oU="KHR_lights_punctual";class iU{constructor(U){this.name=oU,this._loader=U,this.enabled=this._loader.isExtensionUsed(oU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Tk.extensions;if(U&&U[this.name]){const W=U[this.name];this._lights=W.lights,u.Assign(this._lights)}}loadNodeAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,p)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(U,W,(U=>{let W;const B=u.Get(M,this._lights,p.ab),k=B.name||U.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,B.type){case"directional":{const U=new mU.e(k,t.l.Backward(),this._loader.babylonScene);U.position.jk(0),W=U;break}case"point":W=new DU(k,t.l.Zero(),this._loader.babylonScene);break;case"spot":{const U=new qU.d(k,t.l.Zero(),t.l.Backward(),0,1,this._loader.babylonScene);U.angle=2*(B.spot&&B.spot.outerConeAngle||Math.PI/4),U.innerAngle=2*(B.spot&&B.spot.innerConeAngle||0),W=U;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${M}: Invalid light type (${B.type})`)}W._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,B._babylonLight=W,W.falloffType=yU.c.FALLOFF_GLTF,W.cb=B.color?L.e.gk(B.color):L.e.White(),W.bb=void 0==B.bb?1:B.bb,W.range=void 0==B.range?Number.MAX_VALUE:B.range,W.parent=U,this._loader._babylonLights.push(W),C.AddPointerMetadata(W,M),l(U)})))))}}v(oU),F(oU,!0,(U=>new iU(U)));const OU="KHR_materials_pbrSpecularGlossiness";class eU{constructor(U){this.name=OU,this.order=200,this._loader=U,this.enabled=this._loader.isExtensionUsed(OU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialBasePropertiesAsync(U,W,l)),L.push(this._loadSpecularGlossinessPropertiesAsync(M,t,l)),this._loader.loadMaterialAlphaProperties(U,W,l),await Promise.all(L).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return l.metallic=null,l.roughness=null,W.diffuseFactor?(l.albedoColor=L.e.gk(W.diffuseFactor),l.alpha=W.diffuseFactor[3]):l.albedoColor=L.e.White(),l.reflectivityColor=W.specularFactor?L.e.gk(W.specularFactor):L.e.White(),l.microSurface=void 0==W.glossinessFactor?1:W.glossinessFactor,W.diffuseTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTexture`,W.diffuseTexture,(U=>{U.name=`${l.name} (Diffuse)`,l.albedoTexture=U}))),W.specularGlossinessTexture&&(M.push(this._loader.loadTextureInfoAsync(`${U}/specularGlossinessTexture`,W.specularGlossinessTexture,(U=>{U.name=`${l.name} (Specular Glossiness)`,l.reflectivityTexture=U,l.reflectivityTexture.yi=!0}))),l.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(M).then((()=>{}))}}v(OU),F(OU,!0,(U=>new eU(U)));const dU="KHR_materials_unlit";class HU{constructor(U){this.name=dU,this.order=210,this._loader=U,this.enabled=this._loader.isExtensionUsed(dU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async()=>await this._loadUnlitPropertiesAsync(U,W,l)))}_loadUnlitPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;l.unlit=!0;const t=W.pbrMetallicRoughness;return t&&(t.baseColorFactor?(l.albedoColor=L.e.gk(t.baseColorFactor),l.alpha=t.baseColorFactor[3]):l.albedoColor=L.e.White(),t.baseColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/baseColorTexture`,t.baseColorTexture,(U=>{U.name=`${l.name} (Base Color)`,l.albedoTexture=U})))),W.doubleSided&&(l.sk=!1,l.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(U,W,l),Promise.all(M).then((()=>{}))}}v(dU),F(dU,!0,(U=>new HU(U)));const VU="KHR_materials_clearcoat";class nU{constructor(U){this.name=VU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(VU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadClearCoatPropertiesAsync(M,t,l)),await Promise.all(L)}))}_loadClearCoatPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return l.clearCoat.isEnabled=!0,l.clearCoat.useRoughnessFromMainTexture=!1,l.clearCoat.remapF0OnInterfaceChange=!1,void 0!=W.clearcoatFactor?l.clearCoat.bb=W.clearcoatFactor:l.clearCoat.bb=0,W.clearcoatTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatTexture`,W.clearcoatTexture,(U=>{U.name=`${l.name} (ClearCoat)`,l.clearCoat.texture=U}))),void 0!=W.clearcoatRoughnessFactor?l.clearCoat.roughness=W.clearcoatRoughnessFactor:l.clearCoat.roughness=0,W.clearcoatRoughnessTexture&&(W.clearcoatRoughnessTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatRoughnessTexture`,W.clearcoatRoughnessTexture,(U=>{U.name=`${l.name} (ClearCoat Roughness)`,l.clearCoat.textureRoughness=U})))),W.clearcoatNormalTexture&&(W.clearcoatNormalTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatNormalTexture`,W.clearcoatNormalTexture,(U=>{U.name=`${l.name} (ClearCoat Normal)`,l.clearCoat.bumpTexture=U}))),l.invertNormalMapX=!l.va().useRightHandedSystem,l.invertNormalMapY=l.va().useRightHandedSystem,void 0!=W.clearcoatNormalTexture.scale&&(l.clearCoat.bumpTexture.level=W.clearcoatNormalTexture.scale)),Promise.all(M).then((()=>{}))}}v(VU),F(VU,!0,(U=>new nU(U)));const xU="KHR_materials_iridescence";class IU{constructor(U){this.name=xU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(xU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadIridescencePropertiesAsync(M,t,l)),await Promise.all(L).then((()=>{}))}))}_loadIridescencePropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return l.iridescence.isEnabled=!0,l.iridescence.bb=W.iridescenceFactor??0,l.iridescence.indexOfRefraction=W.iridescenceIor??W.iridescenceIOR??1.3,l.iridescence.minimumThickness=W.iridescenceThicknessMinimum??100,l.iridescence.maximumThickness=W.iridescenceThicknessMaximum??400,W.iridescenceTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/iridescenceTexture`,W.iridescenceTexture,(U=>{U.name=`${l.name} (Iridescence)`,l.iridescence.texture=U}))),W.iridescenceThicknessTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/iridescenceThicknessTexture`,W.iridescenceThicknessTexture,(U=>{U.name=`${l.name} (Iridescence Thickness)`,l.iridescence.thicknessTexture=U}))),Promise.all(M).then((()=>{}))}}v(xU),F(xU,!0,(U=>new IU(U)));const RU="KHR_materials_anisotropy";class FU{constructor(U){this.name=RU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(RU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadIridescencePropertiesAsync(M,t,l)),await Promise.all(L)}))}async _loadIridescencePropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;l.anisotropy.isEnabled=!0,l.anisotropy.bb=W.anisotropyStrength??0,l.anisotropy.angle=W.anisotropyRotation??0,W.anisotropyTexture&&(W.anisotropyTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${U}/anisotropyTexture`,W.anisotropyTexture,(U=>{U.name=`${l.name} (Anisotropy Intensity)`,l.anisotropy.texture=U})))),await Promise.all(M)}}v(RU),F(RU,!0,(U=>new FU(U)));const vU="KHR_materials_emissive_strength";class JU{constructor(U){this.name=vU,this.order=170,this._loader=U,this.enabled=this._loader.isExtensionUsed(vU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>await this._loader.loadMaterialPropertiesAsync(U,W,l).then((()=>{this._loadEmissiveProperties(M,t,l)}))))}_loadEmissiveProperties(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);void 0!==W.emissiveStrength&&(l.emissiveIntensity=W.emissiveStrength)}}v(vU),F(vU,!0,(U=>new JU(U)));const QU="KHR_materials_sheen";class GU{constructor(U){this.name=QU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(QU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadSheenPropertiesAsync(M,t,l)),await Promise.all(L).then((()=>{}))}))}_loadSheenPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return l.sheen.isEnabled=!0,l.sheen.bb=1,void 0!=W.sheenColorFactor?l.sheen.color=L.e.gk(W.sheenColorFactor):l.sheen.color=L.e.Black(),W.sheenColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/sheenColorTexture`,W.sheenColorTexture,(U=>{U.name=`${l.name} (Sheen Color)`,l.sheen.texture=U}))),void 0!==W.sheenRoughnessFactor?l.sheen.roughness=W.sheenRoughnessFactor:l.sheen.roughness=0,W.sheenRoughnessTexture&&(W.sheenRoughnessTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${U}/sheenRoughnessTexture`,W.sheenRoughnessTexture,(U=>{U.name=`${l.name} (Sheen Roughness)`,l.sheen.textureRoughness=U})))),l.sheen.albedoScaling=!0,l.sheen.useRoughnessFromMainTexture=!1,Promise.all(M).then((()=>{}))}}v(QU),F(QU,!0,(U=>new GU(U)));var uU=l(11783);const bU="KHR_materials_specular";class CU{constructor(U){this.name=bU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(bU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;if(L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadSpecularPropertiesAsync(M,t,l)),t.extensions&&t.extensions.EXT_materials_specular_edge_color&&l instanceof g.c){t.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(l.brdf.dielectricSpecularModel=uU.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,l.brdf.conductorSpecularModel=uU.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(L).then((()=>{}))}))}_loadSpecularPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return void 0!==W.specularFactor&&(l.metallicF0Factor=W.specularFactor),void 0!==W.specularColorFactor&&(l.metallicReflectanceColor=L.e.gk(W.specularColorFactor)),W.specularTexture&&(W.specularTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${U}/specularTexture`,W.specularTexture,(U=>{U.name=`${l.name} (Specular)`,l.metallicReflectanceTexture=U,l.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),W.specularColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/specularColorTexture`,W.specularColorTexture,(U=>{U.name=`${l.name} (Specular Color)`,l.reflectanceTexture=U}))),Promise.all(M).then((()=>{}))}}v(bU),F(bU,!0,(U=>new CU(U)));const PU="KHR_materials_ior";class SU{constructor(U){this.name=PU,this.order=180,this._loader=U,this.enabled=this._loader.isExtensionUsed(PU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadIorPropertiesAsync(M,t,l)),await Promise.all(L).then((()=>{}))}))}_loadIorPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);return void 0!==W.ior?l.indexOfRefraction=W.ior:l.indexOfRefraction=SU._DEFAULT_IOR,Promise.resolve()}}SU._DEFAULT_IOR=1.5,v(PU),F(PU,!0,(U=>new SU(U)));const cU="KHR_materials_variants";class hU{constructor(U){this.name=cU,this._loader=U,this.enabled=this._loader.isExtensionUsed(cU)}dispose(){this._loader=null}static GetAvailableVariants(U){const W=this._GetExtensionMetadata(U);return W?Object.keys(W.variants):[]}getAvailableVariants(U){return hU.GetAvailableVariants(U)}static SelectVariant(U,W){const l=this._GetExtensionMetadata(U);if(!l)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${cU} extension`);const M=U=>{const W=l.variants[U];if(W)for(const l of W)l.mesh.material=l.material};if(W instanceof Array)for(const t of W)M(t);else M(W);l.lastSelected=W}selectVariant(U,W){hU.SelectVariant(U,W)}static Reset(U){const W=this._GetExtensionMetadata(U);if(!W)throw new Error(`Cannot reset on a glTF mesh that does not have the ${cU} extension`);for(const l of W.original)l.mesh.material=l.material;W.lastSelected=null}reset(U){hU.Reset(U)}static GetLastSelectedVariant(U){const W=this._GetExtensionMetadata(U);if(!W)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${cU} extension`);return W.lastSelected}getLastSelectedVariant(U){return hU.GetLastSelectedVariant(U)}static _GetExtensionMetadata(U){var W,l;return(null===U||void 0===U||null===(W=U._internalMetadata)||void 0===W||null===(l=W.Tk)||void 0===l?void 0:l[cU])||null}onLoading(){const U=this._loader.Tk.extensions;if(U&&U[this.name]){const W=U[this.name];this._variants=W.variants}}onReady(){const U=this._loader.rootBabylonMesh;if(U){var W;const l=this._loader.parent.extensionOptions[cU];null!==l&&void 0!==l&&l.defaultVariant&&hU.SelectVariant(U,l.defaultVariant),null===l||void 0===l||null===(W=l.onLoaded)||void 0===W||W.call(l,{get variants(){return hU.GetAvailableVariants(U)},get selectedVariant(){const W=hU.GetLastSelectedVariant(U);return W?Array.isArray(W)?W[0]:W:hU.GetAvailableVariants(U)[0]},set selectedVariant(W){hU.SelectVariant(U,W)}})}}_loadMeshPrimitiveAsync(U,W,l,M,t,L){return C.LoadExtensionAsync(U,t,this.name,(async(p,B)=>{const k=new Array;return k.push(this._loader._loadMeshPrimitiveAsync(U,W,l,M,t,(W=>{if(L(W),W instanceof i.e){const l=C._GetDrawMode(U,t.mode),M=this._loader.rootBabylonMesh,L=M?M._internalMetadata=M._internalMetadata||{}:{},A=L.Tk=L.Tk||{},q=A[cU]=A[cU]||{lastSelected:null,original:[],variants:{}};q.original.push({mesh:W,material:W.material});for(let U=0;U<B.mappings.length;++U){const t=B.mappings[U],L=u.Get(`${p}/mappings/${U}/material`,this._loader.Tk.materials,t.material);k.push(this._loader._loadMaterialAsync(`#/materials/${t.material}`,L,W,l,(U=>{for(let l=0;l<t.variants.length;++l){const L=t.variants[l],p=u.Get(`/extensions/${cU}/variants/${L}`,this._variants,L);q.variants[p.name]=q.variants[p.name]||[],q.variants[p.name].push({mesh:W,material:U}),W.onClonedObservable.add((U=>{const l=U;let t=null,L=l;do{if(L=L.parent,!L)return;t=hU._GetExtensionMetadata(L)}while(null===t);if(M&&t===hU._GetExtensionMetadata(M)){L._internalMetadata={};for(const U in M._internalMetadata)L._internalMetadata[U]=M._internalMetadata[U];L._internalMetadata.Tk=[];for(const U in M._internalMetadata.Tk)L._internalMetadata.Tk[U]=M._internalMetadata.Tk[U];L._internalMetadata.Tk[cU]={lastSelected:null,original:[],variants:{}};for(const U of t.original)L._internalMetadata.Tk[cU].original.push({mesh:U.mesh,material:U.material});for(const U in t.variants)if(Object.prototype.hasOwnProperty.call(t.variants,U)){L._internalMetadata.Tk[cU].variants[U]=[];for(const W of t.variants[U])L._internalMetadata.Tk[cU].variants[U].push({mesh:W.mesh,material:W.material})}t=L._internalMetadata.Tk[cU]}for(const M of t.original)M.mesh===W&&(M.mesh=l);for(const M of t.variants[p.name])M.mesh===W&&(M.mesh=l)}))}})))}}}))),await Promise.all(k).then((U=>{let[W]=U;return W}))}))}}v(cU),F(cU,!0,(U=>new hU(U)));var zU=l(2059);class aU{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:uU.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(U,W){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...aU._GetDefaultOptions(),...U},this._scene=W,this._scene._transmissionHelper=this,this.onErrorObservable=new q.b,this._scene.nk.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(U){if(!Object.keys(U).filter((W=>this._options[W]!==U[W])).length)return;const W={...this._options,...U},l=this._options;this._options=W,W.renderSize===l.renderSize&&W.renderTargetTextureType===l.renderTargetTextureType&&W.generateMipmaps===l.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=W.samples,this._opaqueRenderTarget.lodGenerationScale=W.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=W.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(U){return!!U&&!!(U instanceof g.c&&U.subSurface.isRefractionEnabled)}_addMesh(U){this._materialObservers[U.uniqueId]=U.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),p.h.SetImmediate((()=>{this._shouldRenderAsTransmission(U.material)?(U.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(U)&&this._transparentMeshesCache.push(U)):-1===this._opaqueMeshesCache.indexOf(U)&&this._opaqueMeshesCache.push(U)}))}_removeMesh(U){U.onMaterialChangedObservable.remove(this._materialObservers[U.uniqueId]),delete this._materialObservers[U.uniqueId];let W=this._transparentMeshesCache.indexOf(U);-1!==W&&this._transparentMeshesCache.splice(W,1),W=this._opaqueMeshesCache.indexOf(U),-1!==W&&this._opaqueMeshesCache.splice(W,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(U){const W=this._transparentMeshesCache.indexOf(U),l=this._opaqueMeshesCache.indexOf(U);this._shouldRenderAsTransmission(U.material)?(U.material instanceof g.c&&(U.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==l?(this._opaqueMeshesCache.splice(l,1),this._transparentMeshesCache.push(U)):-1===W&&this._transparentMeshesCache.push(U)):-1!==W?(this._transparentMeshesCache.splice(W,1),this._opaqueMeshesCache.push(U)):-1===l&&this._opaqueMeshesCache.push(U)}_isRenderTargetValid(){var U;return null!==(null===(U=this._opaqueRenderTarget)||void 0===U?void 0:U.getInternalTexture())}_setupRenderTargets(){var U;let W;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new zU.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(U=this._options.clearColor)||void 0===U?void 0:U.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((U=>{W=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?U.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(U.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=W}));for(const l of this._transparentMeshesCache)this._shouldRenderAsTransmission(l.material)&&(l.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const YU="KHR_materials_transmission";class XU{constructor(U){this.name=YU,this.order=175,this._loader=U,this.enabled=this._loader.isExtensionUsed(YU),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadTransparentPropertiesAsync(M,W,l,t)),await Promise.all(L).then((()=>{}))}))}_loadTransparentPropertiesAsync(U,W,l,M){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const t=l;if(t.subSurface.isRefractionEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.useAlbedoToTintRefraction=!0,void 0===M.transmissionFactor)return t.subSurface.refractionIntensity=0,t.subSurface.isRefractionEnabled=!1,Promise.resolve();{var L;t.subSurface.refractionIntensity=M.transmissionFactor;const U=t.va();if(t.subSurface.refractionIntensity&&!U._transmissionHelper)new aU({},t.va());else if(t.subSurface.refractionIntensity&&(null===(L=U._transmissionHelper)||void 0===L||!L._isRenderTargetValid())){var p;null===(p=U._transmissionHelper)||void 0===p||p._setupRenderTargets()}}return t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,M.transmissionTexture?(M.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${U}/transmissionTexture`,M.transmissionTexture,void 0).then((U=>{U.name=`${l.name} (Transmission)`,t.subSurface.refractionIntensityTexture=U,t.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}v(YU),F(YU,!0,(U=>new XU(U)));const TU="KHR_materials_diffuse_transmission";class UW{constructor(U){this.name=TU,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(TU),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadTranslucentPropertiesAsync(M,W,l,t)),await Promise.all(L).then((()=>{}))}))}_loadTranslucentPropertiesAsync(U,W,l,M){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const t=l;if(t.subSurface.isTranslucencyEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,t.subSurface.useAlbedoToTintTranslucency=!1,void 0===M.diffuseTransmissionFactor)return t.subSurface.translucencyIntensity=0,t.subSurface.isTranslucencyEnabled=!1,Promise.resolve();t.subSurface.translucencyIntensity=M.diffuseTransmissionFactor;const p=new Array;return t.subSurface.useGltfStyleTextures=!0,M.diffuseTransmissionTexture&&(M.diffuseTransmissionTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTransmissionTexture`,M.diffuseTransmissionTexture).then((U=>{U.name=`${l.name} (Diffuse Transmission)`,t.subSurface.translucencyIntensityTexture=U})))),void 0!==M.diffuseTransmissionColorFactor?t.subSurface.translucencyColor=L.e.gk(M.diffuseTransmissionColorFactor):t.subSurface.translucencyColor=L.e.White(),M.diffuseTransmissionColorTexture&&p.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTransmissionColorTexture`,M.diffuseTransmissionColorTexture).then((U=>{U.name=`${l.name} (Diffuse Transmission Color)`,t.subSurface.translucencyColorTexture=U}))),Promise.all(p).then((()=>{}))}}v(TU),F(TU,!0,(U=>new UW(U)));const WW="KHR_materials_volume";class lW{constructor(U){this.name=WW,this.order=173,this._loader=U,this.enabled=this._loader.isExtensionUsed(WW),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadVolumePropertiesAsync(M,W,l,t)),await Promise.all(L).then((()=>{}))}))}_loadVolumePropertiesAsync(U,W,l,M){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);if(!l.subSurface.isRefractionEnabled&&!l.subSurface.isTranslucencyEnabled||!M.thicknessFactor)return Promise.resolve();l.subSurface.volumeIndexOfRefraction=l.indexOfRefraction;const t=void 0!==M.attenuationDistance?M.attenuationDistance:Number.MAX_VALUE;return l.subSurface.tintColorAtDistance=t,void 0!==M.attenuationColor&&3==M.attenuationColor.length&&l.subSurface.tintColor.wd(M.attenuationColor[0],M.attenuationColor[1],M.attenuationColor[2]),l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=M.thicknessFactor,l.subSurface.useThicknessAsDepth=!0,M.thicknessTexture?(M.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${U}/thicknessTexture`,M.thicknessTexture).then((U=>{U.name=`${l.name} (Thickness)`,l.subSurface.thicknessTexture=U,l.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}v(WW),F(WW,!0,(U=>new lW(U)));const MW="KHR_materials_dispersion";class tW{constructor(U){this.name=MW,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(MW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadDispersionPropertiesAsync(M,W,l,t)),await Promise.all(L).then((()=>{}))}))}_loadDispersionPropertiesAsync(U,W,l,M){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);return l.subSurface.isRefractionEnabled&&M.dispersion?(l.subSurface.isDispersionEnabled=!0,l.subSurface.dispersion=M.dispersion,Promise.resolve()):Promise.resolve()}}v(MW),F(MW,!0,(U=>new tW(U)));const LW="EXT_materials_diffuse_roughness";class pW{constructor(U){this.name=LW,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(LW)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(U,W,l)),L.push(this._loadDiffuseRoughnessPropertiesAsync(M,t,l)),await Promise.all(L).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(U,W,l){if(!(l instanceof g.c))throw new Error(`${U}: Material type not supported`);const M=new Array;return l.brdf.baseDiffuseModel=uU.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=W.diffuseRoughnessFactor?l.baseDiffuseRoughness=W.diffuseRoughnessFactor:l.baseDiffuseRoughness=0,W.diffuseRoughnessTexture&&M.push(this._loader.loadTextureInfoAsync(`${U}/diffuseRoughnessTexture`,W.diffuseRoughnessTexture,(U=>{U.name=`${l.name} (Diffuse Roughness)`,l.baseDiffuseRoughnessTexture=U}))),Promise.all(M).then((()=>{}))}}v(LW),F(LW,!0,(U=>new pW(U)));const BW="KHR_mesh_quantization";class kW{constructor(U){this.name=BW,this.enabled=U.isExtensionUsed(BW)}dispose(){}}v(BW),F(BW,!0,(U=>new kW(U)));const AW="KHR_texture_basisu";class qW{constructor(U){this.name=AW,this._loader=U,this.enabled=U.isExtensionUsed(AW)}dispose(){this._loader=null}_loadTextureAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>{const L=void 0==W.sampler?C.DefaultSampler:u.Get(`${U}/sampler`,this._loader.Tk.samplers,W.sampler),p=u.Get(`${M}/source`,this._loader.Tk.images,t.source);return await this._loader._createTextureAsync(U,L,p,(U=>{l(U)}),W._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!W._textureInfo.nonColorData)}))}}v(AW),F(AW,!0,(U=>new qW(U)));const yW="KHR_texture_transform";class jW{constructor(U){this.name=yW,this._loader=U,this.enabled=this._loader.isExtensionUsed(yW)}dispose(){this._loader=null}loadTextureInfoAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(M,t)=>await this._loader.loadTextureInfoAsync(U,W,(U=>{if(!(U instanceof E.d))throw new Error(`${M}: Texture type not supported`);t.offset&&(U.uOffset=t.offset[0],U.vOffset=t.offset[1]),U.uRotationCenter=0,U.vRotationCenter=0,t.rotation&&(U.wAng=-t.rotation),t.scale&&(U.uScale=t.scale[0],U.vScale=t.scale[1]),void 0!=t.texCoord&&(U.coordinatesIndex=t.texCoord),l(U)}))))}}v(yW),F(yW,!0,(U=>new jW(U)));const sW="KHR_xmp_json_ld";class wW{constructor(U){this.name=sW,this.order=100,this._loader=U,this.enabled=this._loader.isExtensionUsed(sW)}dispose(){this._loader=null}onLoading(){var U,W,l;if(null===this._loader.rootBabylonMesh)return;const M=null===(U=this._loader.Tk.extensions)||void 0===U?void 0:U.KHR_xmp_json_ld,t=null===(W=this._loader.Tk.asset)||void 0===W||null===(l=W.extensions)||void 0===l?void 0:l.KHR_xmp_json_ld;if(M&&t){const U=+t.packet;M.packets&&U<M.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=M.packets[U])}}}function KW(U,W,l,M){return L.e.gk(W,l).scale(M)}function rW(U,W,l,M){return W[l]*M}function mW(U,W,l,M){return-W[l]*M}function fW(U,W,l,M){return W[l+1]*M}function gW(U,W,l,M){return W[l]*M*2}function EW(U){return{scale:[new NW(j.c.ANIMATIONTYPE_FLOAT,`${U}.uScale`,rW,(()=>2)),new NW(j.c.ANIMATIONTYPE_FLOAT,`${U}.vScale`,fW,(()=>2))],offset:[new NW(j.c.ANIMATIONTYPE_FLOAT,`${U}.uOffset`,rW,(()=>2)),new NW(j.c.ANIMATIONTYPE_FLOAT,`${U}.vOffset`,fW,(()=>2))],rotation:[new NW(j.c.ANIMATIONTYPE_FLOAT,`${U}.wAng`,mW,(()=>1))]}}v(sW),F(sW,!0,(U=>new wW(U)));class ZW extends P.AnimationPropertyInfo{buildAnimations(U,W,l,M){return[{babylonAnimatable:U._babylonCamera,babylonAnimation:this._buildAnimation(W,l,M)}]}}class NW extends P.AnimationPropertyInfo{buildAnimations(U,W,l,M){const t=[];for(const L in U._data)t.push({babylonAnimatable:U._data[L].babylonMaterial,babylonAnimation:this._buildAnimation(W,l,M)});return t}}class DW extends P.AnimationPropertyInfo{buildAnimations(U,W,l,M){return[{babylonAnimatable:U._babylonLight,babylonAnimation:this._buildAnimation(W,l,M)}]}}(0,J.l)("/cameras/{}/orthographic/xmag",[new ZW(j.c.ANIMATIONTYPE_FLOAT,"orthoLeft",mW,(()=>1)),new ZW(j.c.ANIMATIONTYPE_FLOAT,"orthoRight",fW,(()=>1))]),(0,J.l)("/cameras/{}/orthographic/ymag",[new ZW(j.c.ANIMATIONTYPE_FLOAT,"orthoBottom",mW,(()=>1)),new ZW(j.c.ANIMATIONTYPE_FLOAT,"orthoTop",fW,(()=>1))]),(0,J.l)("/cameras/{}/orthographic/zfar",[new ZW(j.c.ANIMATIONTYPE_FLOAT,"maxZ",rW,(()=>1))]),(0,J.l)("/cameras/{}/orthographic/znear",[new ZW(j.c.ANIMATIONTYPE_FLOAT,"bk",rW,(()=>1))]),(0,J.l)("/cameras/{}/perspective/yfov",[new ZW(j.c.ANIMATIONTYPE_FLOAT,"fov",rW,(()=>1))]),(0,J.l)("/cameras/{}/perspective/zfar",[new ZW(j.c.ANIMATIONTYPE_FLOAT,"maxZ",rW,(()=>1))]),(0,J.l)("/cameras/{}/perspective/znear",[new ZW(j.c.ANIMATIONTYPE_FLOAT,"bk",rW,(()=>1))]),(0,J.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new NW(j.c.ANIMATIONTYPE_COLOR3,"albedoColor",KW,(()=>4)),new NW(j.c.ANIMATIONTYPE_FLOAT,"alpha",(function(U,W,l,M){return W[l+3]*M}),(()=>4))]),(0,J.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"metallic",rW,(()=>1))]),(0,J.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"roughness",rW,(()=>1))]);const oW=EW("albedoTexture");(0,J.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",oW.scale),(0,J.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",oW.offset),(0,J.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",oW.rotation);const iW=EW("metallicTexture");(0,J.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",iW.scale),(0,J.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",iW.offset),(0,J.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",iW.rotation),(0,J.l)("/materials/{}/emissiveFactor",[new NW(j.c.ANIMATIONTYPE_COLOR3,"emissiveColor",KW,(()=>3))]);const OW=EW("bumpTexture");(0,J.l)("/materials/{}/normalTexture/scale",[new NW(j.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",rW,(()=>1))]),(0,J.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",OW.scale),(0,J.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",OW.offset),(0,J.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",OW.rotation),(0,J.l)("/materials/{}/occlusionTexture/strength",[new NW(j.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",rW,(()=>1))]);const eW=EW("ambientTexture");(0,J.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",eW.scale),(0,J.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",eW.offset),(0,J.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",eW.rotation);const dW=EW("emissiveTexture");(0,J.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",dW.scale),(0,J.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",dW.offset),(0,J.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",dW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new NW(j.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new NW(j.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",rW,(()=>1))]);const HW=EW("anisotropy.texture");(0,J.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",HW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",HW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",HW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",rW,(()=>1))]);const VW=EW("clearCoat.texture");(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",VW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",VW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",VW.rotation);const nW=EW("clearCoat.bumpTexture");(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new NW(j.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",nW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",nW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",nW.rotation);const xW=EW("clearCoat.textureRoughness");(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",xW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",xW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",xW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new NW(j.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new NW(j.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new NW(j.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new NW(j.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",rW,(()=>1))]);const IW=EW("iridescence.texture");(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",IW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",IW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",IW.rotation);const RW=EW("iridescence.thicknessTexture");(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",RW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",RW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",RW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new NW(j.c.ANIMATIONTYPE_COLOR3,"sheen.color",KW,(()=>3))]),(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",rW,(()=>1))]);const FW=EW("sheen.texture");(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",FW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",FW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",FW.rotation);const vW=EW("sheen.textureRoughness");(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",vW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",vW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",vW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new NW(j.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",KW,(()=>3))]);const JW=EW("metallicReflectanceTexture");(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",JW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",JW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",JW.rotation);const QW=EW("reflectanceTexture");(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",QW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",QW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",QW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",rW,(()=>1))]);const GW=EW("subSurface.refractionIntensityTexture");(0,J.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",GW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",GW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",GW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new NW(j.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",KW,(()=>3))]),(0,J.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new NW(j.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",rW,(()=>1))]),(0,J.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",rW,(()=>1))]);const uW=EW("subSurface.thicknessTexture");(0,J.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",uW.scale),(0,J.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",uW.offset),(0,J.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",uW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new NW(j.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",rW,(()=>1))]);const bW=EW("subSurface.translucencyIntensityTexture");(0,J.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",bW.scale),(0,J.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",bW.offset),(0,J.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",bW.rotation),(0,J.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new NW(j.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",KW,(()=>3))]);const CW=EW("subSurface.translucencyColorTexture");(0,J.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",CW.scale),(0,J.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",CW.offset),(0,J.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",CW.rotation),(0,J.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new DW(j.c.ANIMATIONTYPE_COLOR3,"diffuse",KW,(()=>3))]),(0,J.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new DW(j.c.ANIMATIONTYPE_FLOAT,"intensity",rW,(()=>1))]),(0,J.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new DW(j.c.ANIMATIONTYPE_FLOAT,"range",rW,(()=>1))]),(0,J.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new DW(j.c.ANIMATIONTYPE_FLOAT,"innerAngle",gW,(()=>1))]),(0,J.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new DW(j.c.ANIMATIONTYPE_FLOAT,"angle",gW,(()=>1))]),(0,J.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new DW(j.c.ANIMATIONTYPE_COLOR3,"diffuse",KW,(()=>3))]),(0,J.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new DW(j.c.ANIMATIONTYPE_FLOAT,"intensity",rW,(()=>1))]);const PW="KHR_animation_pointer";class SW{constructor(U){this.name=PW,this._loader=U,this._pathToObjectConverter=(0,J.j)(this._loader.Tk)}get enabled(){return this._loader.isExtensionUsed(PW)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(U,W,l,M,t){var L;const p=null===(L=M.target.extensions)||void 0===L?void 0:L.KHR_animation_pointer;if(!p||!this._pathToObjectConverter)return null;"pointer"!==M.target.path&&K.b.Warn(`${U}/target/path: Value (${M.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=M.target.node&&K.b.Warn(`${U}/target/node: Value (${M.target.node}) must not be present when using the ${this.name} extension`);const B=`${U}/extensions/${this.name}`,k=p.pointer;if(!k)throw new Error(`${B}: Pointer is missing`);try{const L=this._pathToObjectConverter.convert(k);if(!L.info.interpolation)throw new Error(`${B}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(U,W,l,M,{object:L.object,info:L.info.interpolation},t)}catch(A){return K.b.Warn(`${B}/pointer: Invalid pointer (${k}) skipped`),null}}}v(PW),F(PW,!0,(U=>new SW(U)));class cW{constructor(U,W,l){this.frame=U,this.action=W,this.onlyOnce=l,this.isDone=!1}_clone(){return new cW(this.frame,this.action,this.onlyOnce)}}var hW=l(533),zW=l(592),aW=l(583);class YW{get loop(){return this._loop}set loop(U){U!==this._loop&&(this._loop=U,this.updateOptions({loop:U}))}get currentTime(){var U;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(U=zW.d.audioEngine)&&void 0!==U&&U.audioContext&&(this.isPlaying||this.isPaused)){const U=this.isPaused?0:zW.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+U}return 0}get spatialSound(){return this._spatialSound}set spatialSound(U){if(U==this._spatialSound)return;const W=this.isPlaying;this.pause(),U?(this._spatialSound=U,this._updateSpatialParameters()):this._disableSpatialSound(),W&&this.play()}constructor(U,W,l){var M;let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new q.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=t.l.Zero(),this._localDirection=new t.l(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=U,l=l||w.d.LastCreatedScene)if(this._scene=l,YW._SceneComponentInitialization(l),this._readyToPlayCallback=L,this._customAttenuationFunction=(U,W,l,M,t)=>W<l?U*(1-W/l):0,B&&(this.autoplay=B.autoplay||!1,this._loop=B.loop||!1,void 0!==B.volume&&(this._volume=B.volume),this._spatialSound=B.spatialSound??!1,this.maxDistance=B.maxDistance??100,this.useCustomAttenuation=B.useCustomAttenuation??!1,this.rolloffFactor=B.rolloffFactor||1,this.refDistance=B.refDistance||1,this.distanceModel=B.distanceModel||"linear",this._playbackRate=B.playbackRate||1,this._streaming=B.streaming??!1,this._length=B.length,this._offset=B.offset),null!==(M=zW.d.audioEngine)&&void 0!==M&&M.canUseWebAudio&&zW.d.audioEngine.audioContext){this._soundGain=zW.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let U=!0;if(W)try{"string"===typeof W?(this._urlType="String",this._url=W):W instanceof ArrayBuffer?this._urlType="ArrayBuffer":W instanceof HTMLMediaElement?this._urlType="MediaElement":W instanceof MediaStream?this._urlType="MediaStream":W instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(W)&&(this._urlType="Array");let l=[],M=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=zW.d.audioEngine.audioContext.createMediaElementSource(W),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=zW.d.audioEngine.audioContext.createMediaStreamSource(W),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":W.byteLength>0&&(M=!0,this._soundLoaded(W));break;case"AudioBuffer":this._audioBufferLoaded(W);break;case"String":l.push(W);case"Array":0===l.length&&(l=W);for(let U=0;U<l.length;U++){const W=l[U];if(M=B&&B.skipCodecCheck||-1!==W.indexOf(".mp3",W.length-4)&&zW.d.audioEngine.isMP3supported||-1!==W.indexOf(".ogg",W.length-4)&&zW.d.audioEngine.isOGGsupported||-1!==W.indexOf(".wav",W.length-4)||-1!==W.indexOf(".m4a",W.length-4)||-1!==W.indexOf(".mp4",W.length-4)||-1!==W.indexOf("blob:"),M){this._streaming?(this._htmlAudioElement=new Audio(W),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,p.h.SetCorsBehavior(W,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(W,(U=>{this._soundLoaded(U)}),void 0,!0,!0,(U=>{U&&K.b.Error("XHR "+U.status+" error on: "+W+"."),K.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:U=!1}U?M||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):K.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(k){K.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),zW.d.audioEngine&&!zW.d.audioEngine.WarnedWebAudioUnsupported&&(K.b.Error("Web Audio is not supported by your browser."),zW.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var U;null!==(U=zW.d.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(U){var W;null!==(W=zW.d.audioEngine)&&void 0!==W&&W.audioContext&&(this._audioBuffer=U,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(U){var W;null!==(W=zW.d.audioEngine)&&void 0!==W&&W.audioContext&&zW.d.audioEngine.audioContext.decodeAudioData(U,(U=>{this._audioBufferLoaded(U)}),(U=>{K.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+U)}))}setAudioBuffer(U){var W;null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&(this._audioBuffer=U,this._isReadyToPlay=!0)}updateOptions(U){U&&(this.loop=U.loop??this.loop,this.maxDistance=U.maxDistance??this.maxDistance,this.useCustomAttenuation=U.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=U.rolloffFactor??this.rolloffFactor,this.refDistance=U.refDistance??this.refDistance,this.distanceModel=U.distanceModel??this.distanceModel,this._playbackRate=U.playbackRate??this._playbackRate,this._length=U.length??void 0,this.spatialSound=U.spatialSound??this._spatialSound,this._setOffset(U.offset??void 0),this.setVolume(U.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var U;null!==(U=zW.d.audioEngine)&&void 0!==U&&U.canUseWebAudio&&zW.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??zW.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var U;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(U=this._soundPanner)||void 0===U||U.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var U;null!==(U=zW.d.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(U){var W;null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(U),this._isOutputConnected=!0)}setDirectionalCone(U,W,l){W<U?K.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=U,this._coneOuterAngle=W,this._coneOuterGain=l,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!=this._coneInnerAngle){var W;if(this._coneOuterAngle<U)return void K.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U,null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!=this._coneOuterAngle){var W;if(U<this._coneInnerAngle)return void K.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U,null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(U){var W;U.equals(this._position)||(this._position.p(U),null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(U){var W;this._localDirection=U,null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const U=this._connectedTransformNode.getWorldMatrix(),W=t.l.TransformNormal(this._localDirection,U);W.normalize(),this._soundPanner.orientationX.value=W.x,this._soundPanner.orientationY.value=W.y,this._soundPanner.orientationZ.value=W.z}updateDistanceFromListener(){var U;if(null!==(U=zW.d.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const U=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.de(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,U,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(U){this._customAttenuationFunction=U}play(U,W,l){var M;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(M=zW.d.audioEngine)&&void 0!==M&&M.audioContext)try{var t,L;this._clearTimeoutsAndObservers();let M=U?(null===(t=zW.d.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+U:null===(L=zW.d.audioEngine)||void 0===L?void 0:L.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=zW.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const U=()=>{var l;if(null!==(l=zW.d.audioEngine)&&void 0!==l&&l.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=W??0;const l=this._htmlAudioElement.play();void 0!==l&&l.catch((()=>{var W,l;(null===(W=zW.d.audioEngine)||void 0===W||W.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(l=zW.d.audioEngine)||void 0===l?void 0:l.onAudioUnlockedObservable.addOnce((()=>{U()})))}))}else{var M;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(M=zW.d.audioEngine)||void 0===M?void 0:M.onAudioUnlockedObservable.addOnce((()=>{U()}))}};U()}}else{var p;const t=()=>{var t;if(null!==(t=zW.d.audioEngine)&&void 0!==t&&t.audioContext){var L;if(l=l||this._length,void 0!==W&&this._setOffset(W),this._soundSource){const U=this._soundSource;U.onended=()=>{U.disconnect()}}if(this._soundSource=null===(L=zW.d.audioEngine)||void 0===L?void 0:L.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var p;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==W&&(this._soundSource.loopStart=W),void 0!==l&&(this._soundSource.loopEnd=(0|W)+l),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},M=U?(null===(p=zW.d.audioEngine)||void 0===p?void 0:p.audioContext.currentTime)+U:zW.d.audioEngine.audioContext.currentTime;const t=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(M,t,this.loop?void 0:l)}}};"suspended"===(null===(p=zW.d.audioEngine)||void 0===p?void 0:p.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var U;"suspended"===(null===(U=zW.d.audioEngine)||void 0===U?void 0:U.audioContext.state)?(zW.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=zW.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{t()})))):t()}),500):t()}this._startTime=M,this.isPlaying=!0,this.isPaused=!1}catch(B){K.b.Error("Error while trying to play audio: "+this.name+", "+B.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(U){var W;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var l;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(l=this._streamingSource)||void 0===l||l.disconnect();this.isPlaying=!1}else if(null!==(W=zW.d.audioEngine)&&void 0!==W&&W.audioContext&&this._soundSource){const W=U?zW.d.audioEngine.audioContext.currentTime+U:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(W)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var W;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(W=this._streamingSource)||void 0===W||W.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(U=zW.d.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=zW.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(U,W){var l;null!==(l=zW.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._soundGain&&(W&&zW.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(zW.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,zW.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(U,zW.d.audioEngine.audioContext.currentTime+W)):this._soundGain.gain.value=U),this._volume=U}setPlaybackRate(U){this._playbackRate=U,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(U){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=U,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=U=>this._onRegisterAfterWorldMatrixUpdate(U),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(U){var W;if(U.getBoundingInfo){const W=U.getBoundingInfo();this.setPosition(W.boundingSphere.centerWorld)}else this.setPosition(U.absolutePosition);null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const U=()=>{(0,aW.d)((()=>this._isReadyToPlay),(()=>{l._audioBuffer=this.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,this._offset,this._length)}),void 0,300)},W={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},l=new YW(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,W);return this.useCustomAttenuation&&l.setAttenuationFunction(this._customAttenuationFunction),l.setPosition(this._position),l.setPlaybackRate(this._playbackRate),U(),l}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const U={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(U.connectedMeshId=this._connectedTransformNode.id),U.position=this._position.qk(),U.refDistance=this.refDistance,U.distanceModel=this.distanceModel,U.isDirectional=this._isDirectional,U.localDirectionToMesh=this._localDirection.qk(),U.coneInnerAngle=this._coneInnerAngle,U.coneOuterAngle=this._coneOuterAngle,U.coneOuterGain=this._coneOuterGain),U}static Parse(U,W,l,M){const L=U.name;let p;p=U.url?l+U.url:l+L;const B={autoplay:U.autoplay,loop:U.loop,volume:U.volume,spatialSound:U.spatialSound,maxDistance:U.maxDistance,rolloffFactor:U.rolloffFactor,refDistance:U.refDistance,distanceModel:U.distanceModel,playbackRate:U.playbackRate};let k;if(M){const U=()=>{(0,aW.d)((()=>M._isReadyToPlay),(()=>{k._audioBuffer=M.getAudioBuffer(),k._isReadyToPlay=!0,k.autoplay&&k.play(0,k._offset,k._length)}),void 0,300)};k=new YW(L,new ArrayBuffer(0),W,null,B),U()}else k=new YW(L,p,W,(()=>{W.removePendingData(k)}),B),W.addPendingData(k);if(U.position){const W=t.l.gk(U.position);k.setPosition(W)}if(U.isDirectional&&(k.setDirectionalCone(U.coneInnerAngle||360,U.coneOuterAngle||360,U.coneOuterGain||0),U.localDirectionToMesh)){const W=t.l.gk(U.localDirectionToMesh);k.setLocalDirectionToMesh(W)}if(U.connectedMeshId){const l=W.getMeshById(U.connectedMeshId);l&&k.attachToMesh(l)}return U.metadata&&(k.metadata=U.metadata),k}_setOffset(U){this._offset!==U&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=U)}_clearTimeoutsAndObservers(){var U;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(U=zW.d.audioEngine)||void 0===U||U.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}YW._SceneComponentInitialization=U=>{throw(0,hW.d)("AudioSceneComponent")},(0,NU.f)("BABYLON.Sound",YW);class XW{constructor(U,W,l){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],W.length!==l.length)throw new Error("Sounds length does not equal weights length");this.loop=U,this._weights=l;let M=0;for(const L of l)M+=L;const t=M>0?1/M:0;for(let L=0;L<this._weights.length;L++)this._weights[L]*=t;this._sounds=W;for(const L of this._sounds)L.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!==this._coneInnerAngle){if(this._coneOuterAngle<U)return void K.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U;for(const W of this._sounds)W.directionalConeInnerAngle=U}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!==this._coneOuterAngle){if(U<this._coneInnerAngle)return void K.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U;for(const W of this._sounds)W.directionalConeOuterAngle=U}}get volume(){return this._volume}set volume(U){if(U!==this._volume)for(const W of this._sounds)W.setVolume(U)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(U){if(!this.isPaused){this.stop();const U=Math.random();let W=0;for(let l=0;l<this._weights.length;l++)if(W+=this._weights[l],U<=W){this._currentIndex=l;break}}const W=this._sounds[this._currentIndex??0];W.isReady()?W.play(0,this.isPaused?void 0:U):W.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class TW{constructor(U){let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(U=U||w.d.LastCreatedScene)&&(this._scene=U,this.soundCollection=[],this._options=W,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var U;null!==(U=zW.d.audioEngine)&&void 0!==U&&U.canUseWebAudio&&zW.d.audioEngine.audioContext&&(this._outputAudioNode=zW.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(zW.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(zW.d.audioEngine&&zW.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(U){var W;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._outputAudioNode&&U.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==U.soundTrackId&&(-1===U.soundTrackId?this._scene.mainSoundTrack.removeSound(U):this._scene.soundTracks&&this._scene.soundTracks[U.soundTrackId].removeSound(U)),this.soundCollection.push(U),U.soundTrackId=this.id}removeSound(U){const W=this.soundCollection.indexOf(U);-1!==W&&this.soundCollection.splice(W,1)}setVolume(U){var W;null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=U)}switchPanningModelToHRTF(){var U;if(null!==(U=zW.d.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let W=0;W<this.soundCollection.length;W++)this.soundCollection[W].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var U;if(null!==(U=zW.d.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let W=0;W<this.soundCollection.length;W++)this.soundCollection[W].switchPanningModelToEqualPower()}connectToAnalyser(U){var W;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=U,null!==(W=zW.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,zW.d.audioEngine.masterGain))}}var Ul=l(877),Wl=l(2178),ll=l(506);zW.d.AudioEngineFactory=(U,W,l)=>new Ml(U,W,l);class Ml{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new q.b,this.onAudioLockedObservable=new q.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ll.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const M=document.createElement("audio");this._hostElement=U,this._audioContext=W,this._audioDestination=l;try{M&&M.canPlayType&&(M.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||M.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(t){}try{M&&M.canPlayType&&M.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(t){}}lock(){this._triggerSuspendedState()}unlock(){var U,W;if("running"===(null===(U=this._audioContext)||void 0===U?void 0:U.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(W=this._audioContext)||void 0===W||W.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{K.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var U;null===(U=this._audioContext)||void 0===U||U.addEventListener("statechange",(()=>{var U;this.unlocked&&"running"!==(null===(U=this._audioContext)||void 0===U?void 0:U.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var U;return null!==(U=this._audioContext)&&void 0!==U&&U.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(U){this.canUseWebAudio=!1,K.b.Error("Web Audio: "+U.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(U){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const U=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",W=document.createElement("style");W.appendChild(document.createTextNode(U)),document.getElementsByTagName("head")[0].appendChild(W),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var U;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(U=this._audioContext)||void 0===U||U.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(U){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=U)}connectToAnalyser(U){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=U,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var tl=l(524);(0,l(12385).g)(Ul.d.NAME_AUDIO,((U,W,l,M)=>{let t,L=[];if(l.nm=l.nm||[],void 0!==U.nm&&null!==U.nm)for(let B=0,k=U.nm.length;B<k;B++){var p;const k=U.nm[B];null!==(p=zW.d.audioEngine)&&void 0!==p&&p.canUseWebAudio?(k.url||(k.url=k.name),L[k.url]?l.nm.push(YW.Parse(k,W,M,L[k.url])):(t=YW.Parse(k,W,M),L[k.url]=t,l.nm.push(t))):l.nm.push(new YW(k.name,null,W))}L=[]})),Object.defineProperty(Wl.c.prototype,"mainSoundTrack",{get:function(){let U=this._getComponent(Ul.d.NAME_AUDIO);return U||(U=new Ll(this),this.o(U)),this._mainSoundTrack||(this._mainSoundTrack=new TW(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Wl.c.prototype.getSoundByName=function(U){let W;for(W=0;W<this.mainSoundTrack.soundCollection.length;W++)if(this.mainSoundTrack.soundCollection[W].name===U)return this.mainSoundTrack.soundCollection[W];if(this.soundTracks)for(let l=0;l<this.soundTracks.length;l++)for(W=0;W<this.soundTracks[l].soundCollection.length;W++)if(this.soundTracks[l].soundCollection[W].name===U)return this.soundTracks[l].soundCollection[W];return null},Object.defineProperty(Wl.c.prototype,"audioEnabled",{get:function(){let U=this._getComponent(Ul.d.NAME_AUDIO);return U||(U=new Ll(this),this.o(U)),U.audioEnabled},set:function(U){let W=this._getComponent(Ul.d.NAME_AUDIO);W||(W=new Ll(this),this.o(W)),U?W.enableAudio():W.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Wl.c.prototype,"headphone",{get:function(){let U=this._getComponent(Ul.d.NAME_AUDIO);return U||(U=new Ll(this),this.o(U)),U.headphone},set:function(U){let W=this._getComponent(Ul.d.NAME_AUDIO);W||(W=new Ll(this),this.o(W)),U?W.switchAudioModeForHeadphones():W.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Wl.c.prototype,"audioListenerPositionProvider",{get:function(){let U=this._getComponent(Ul.d.NAME_AUDIO);return U||(U=new Ll(this),this.o(U)),U.audioListenerPositionProvider},set:function(U){let W=this._getComponent(Ul.d.NAME_AUDIO);if(W||(W=new Ll(this),this.o(W)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");W.audioListenerPositionProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(Wl.c.prototype,"audioListenerRotationProvider",{get:function(){let U=this._getComponent(Ul.d.NAME_AUDIO);return U||(U=new Ll(this),this.o(U)),U.audioListenerRotationProvider},set:function(U){let W=this._getComponent(Ul.d.NAME_AUDIO);if(W||(W=new Ll(this),this.o(W)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");W.audioListenerRotationProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(Wl.c.prototype,"audioPositioningRefreshRate",{get:function(){let U=this._getComponent(Ul.d.NAME_AUDIO);return U||(U=new Ll(this),this.o(U)),U.audioPositioningRefreshRate},set:function(U){let W=this._getComponent(Ul.d.NAME_AUDIO);W||(W=new Ll(this),this.o(W)),W.audioPositioningRefreshRate=U},enumerable:!0,configurable:!0});class Ll{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(U){this.name=Ul.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new t.l,this._cachedCameraPosition=new t.l,this._lastCheck=0,this._invertMatrixTemp=new t.c,this._cameraDirectionTemp=new t.l,(U=U||w.d.LastCreatedScene)&&(this.Gd=U,U.soundTracks=[],U.nm=[])}register(){this.Gd._afterRenderStage.registerStep(Ul.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(U){if(U.nm=[],this.Gd.soundTracks)for(let W=0;W<this.Gd.soundTracks.length;W++){const l=this.Gd.soundTracks[W];for(let W=0;W<l.soundCollection.length;W++)U.nm.push(l.soundCollection[W].serialize())}}addFromContainer(U){if(U.nm)for(const W of U.nm)W.play(),W.autoplay=!0,this.Gd.mainSoundTrack.addSound(W)}removeFromContainer(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(U.nm)for(const l of U.nm)l.stop(),l.autoplay=!1,this.Gd.mainSoundTrack.removeSound(l),W&&l.dispose()}dispose(){const U=this.Gd;if(U._mainSoundTrack&&U.mainSoundTrack.dispose(),U.soundTracks)for(let W=0;W<U.soundTracks.length;W++)U.soundTracks[W].dispose()}disableAudio(){const U=this.Gd;let W;for(this._audioEnabled=!1,zW.d.audioEngine&&zW.d.audioEngine.audioContext&&zW.d.audioEngine.audioContext.suspend(),W=0;W<U.mainSoundTrack.soundCollection.length;W++)U.mainSoundTrack.soundCollection[W].pause();if(U.soundTracks)for(W=0;W<U.soundTracks.length;W++)for(let l=0;l<U.soundTracks[W].soundCollection.length;l++)U.soundTracks[W].soundCollection[l].pause()}enableAudio(){const U=this.Gd;let W;for(this._audioEnabled=!0,zW.d.audioEngine&&zW.d.audioEngine.audioContext&&zW.d.audioEngine.audioContext.resume(),W=0;W<U.mainSoundTrack.soundCollection.length;W++)U.mainSoundTrack.soundCollection[W].isPaused&&U.mainSoundTrack.soundCollection[W].play();if(U.soundTracks)for(W=0;W<U.soundTracks.length;W++)for(let l=0;l<U.soundTracks[W].soundCollection.length;l++)U.soundTracks[W].soundCollection[l].isPaused&&U.soundTracks[W].soundCollection[l].play()}switchAudioModeForHeadphones(){const U=this.Gd;if(this._headphone=!0,U.mainSoundTrack.switchPanningModelToHRTF(),U.soundTracks)for(let W=0;W<U.soundTracks.length;W++)U.soundTracks[W].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const U=this.Gd;if(this._headphone=!1,U.mainSoundTrack.switchPanningModelToEqualPower(),U.soundTracks)for(let W=0;W<U.soundTracks.length;W++)U.soundTracks[W].switchPanningModelToEqualPower()}_afterRender(){const U=tl.d.Now;if(this._lastCheck&&U-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=U;const W=this.Gd;if(!this._audioEnabled||!W._mainSoundTrack||!W.soundTracks||0===W._mainSoundTrack.soundCollection.length&&1===W.soundTracks.length)return;const l=zW.d.audioEngine;if(l&&l.audioContext){let U,M=W.activeCamera;if(W.activeCameras&&W.activeCameras.length>0&&(M=W.activeCameras[0]),this.audioListenerPositionProvider){const U=this.audioListenerPositionProvider();l.audioContext.listener.setPosition(U.x||0,U.y||0,U.z||0)}else M?this._cachedCameraPosition.equals(M.globalPosition)||(this._cachedCameraPosition.p(M.globalPosition),l.audioContext.listener.setPosition(M.globalPosition.x,M.globalPosition.y,M.globalPosition.z)):l.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const U=this.audioListenerRotationProvider();l.audioContext.listener.setOrientation(U.x||0,U.y||0,U.z||0,0,1,0)}else M?(M.rigCameras&&M.rigCameras.length>0&&(M=M.rigCameras[0]),M.getViewMatrix().invertToRef(this._invertMatrixTemp),t.l.TransformNormalToRef(Ll._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),l.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):l.audioContext.listener.setOrientation(0,0,0,0,1,0);for(U=0;U<W.mainSoundTrack.soundCollection.length;U++){const l=W.mainSoundTrack.soundCollection[U];l.useCustomAttenuation&&l.updateDistanceFromListener()}if(W.soundTracks)for(U=0;U<W.soundTracks.length;U++)for(let l=0;l<W.soundTracks[U].soundCollection.length;l++){const M=W.soundTracks[U].soundCollection[l];M.useCustomAttenuation&&M.updateDistanceFromListener()}}}}Ll._CameraDirection=new t.l(0,0,-1),YW._SceneComponentInitialization=U=>{let W=U._getComponent(Ul.d.NAME_AUDIO);W||(W=new Ll(U),U.o(W))};const pl="MSFT_audio_emitter";class Bl{constructor(U){this.name=pl,this._loader=U,this.enabled=this._loader.isExtensionUsed(pl)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const U=this._loader.Tk.extensions;if(U&&U[this.name]){const W=U[this.name];this._clips=W.clips,this._emitters=W.emitters,u.Assign(this._clips),u.Assign(this._emitters)}}loadSceneAsync(U,W){return C.LoadExtensionAsync(U,W,this.name,(async(l,M)=>{const t=new Array;t.push(this._loader.loadSceneAsync(U,W));for(const U of M.emitters){const W=u.Get(`${l}/emitters`,this._emitters,U);if(void 0!=W.refDistance||void 0!=W.maxDistance||void 0!=W.rolloffFactor||void 0!=W.distanceModel||void 0!=W.innerAngle||void 0!=W.outerAngle)throw new Error(`${l}: Direction or Distance properties are not allowed on emitters attached to a scene`);t.push(this._loadEmitterAsync(`${l}/emitters/${W.index}`,W))}await Promise.all(t)}))}loadNodeAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(U,M)=>{const L=new Array,B=await this._loader.loadNodeAsync(U,W,(W=>{for(const l of M.emitters){const M=u.Get(`${U}/emitters`,this._emitters,l);L.push(this._loadEmitterAsync(`${U}/emitters/${M.index}`,M).then((()=>{for(const U of M._babylonSounds)U.attachToMesh(W),void 0==M.innerAngle&&void 0==M.outerAngle||(U.setLocalDirectionToMesh(t.l.Forward()),U.setDirectionalCone(2*p.h.ToDegrees(void 0==M.innerAngle?Math.PI:M.innerAngle),2*p.h.ToDegrees(void 0==M.outerAngle?Math.PI:M.outerAngle),0))})))}l(W)}));return await Promise.all(L),B}))}loadAnimationAsync(U,W){return C.LoadExtensionAsync(U,W,this.name,(async(l,M)=>{const t=await this._loader.loadAnimationAsync(U,W),L=new Array;u.Assign(M.events);for(const p of M.events)L.push(this._loadAnimationEventAsync(`${l}/events/${p.index}`,U,W,p,t));return await Promise.all(L),t}))}_loadClipAsync(U,W){if(W._objectURL)return W._objectURL;let l;if(W.uri)l=this._loader.loadUriAsync(U,W,W.uri);else{const M=u.Get(`${U}/bufferView`,this._loader.Tk.bufferViews,W.bufferView);l=this._loader.loadBufferViewAsync(`/bufferViews/${M.index}`,M)}return W._objectURL=l.then((U=>URL.createObjectURL(new Blob([U],{type:W.mimeType})))),W._objectURL}_loadEmitterAsync(U,W){if(W._babylonSounds=W._babylonSounds||[],!W._babylonData){const U=new Array,l=W.name||`emitter${W.index}`,M={loop:!1,autoplay:!1,volume:void 0==W.volume?1:W.volume};for(let L=0;L<W.clips.length;L++){const t=`/extensions/${this.name}/clips`,p=u.Get(t,this._clips,W.clips[L].clip);U.push(this._loadClipAsync(`${t}/${W.clips[L].clip}`,p).then((U=>{const t=W._babylonSounds[L]=new YW(l,U,this._loader.babylonScene,null,M);t.refDistance=W.refDistance||1,t.maxDistance=W.maxDistance||256,t.rolloffFactor=W.rolloffFactor||1,t.distanceModel=W.distanceModel||"exponential"})))}const t=Promise.all(U).then((()=>{const U=W.clips.map((U=>U.weight||1)),l=new XW(W.loop||!1,W._babylonSounds,U);W.innerAngle&&(l.directionalConeInnerAngle=2*p.h.ToDegrees(W.innerAngle)),W.outerAngle&&(l.directionalConeOuterAngle=2*p.h.ToDegrees(W.outerAngle)),W.volume&&(l.volume=W.volume),W._babylonData.sound=l}));W._babylonData={loaded:t}}return W._babylonData.loaded}_getEventAction(U,W,l,M,t){switch(l){case"play":return U=>{const l=(t||0)+(U-M);W.play(l)};case"stop":return()=>{W.stop()};case"pause":return()=>{W.pause()};default:throw new Error(`${U}: Unsupported action ${l}`)}}_loadAnimationEventAsync(U,W,l,M,t){if(0==t.targetedAnimations.length)return Promise.resolve();const L=t.targetedAnimations[0],p=M.j,B=u.Get(`/extensions/${this.name}/emitters`,this._emitters,p);return this._loadEmitterAsync(U,B).then((()=>{const W=B._babylonData.sound;if(W){const l=new cW(M.time,this._getEventAction(U,W,M.action,M.time,M.startOffset));L.animation.addEvent(l),t.onAnimationGroupEndObservable.add((()=>{W.stop()})),t.onAnimationGroupPauseObservable.add((()=>{W.pause()}))}}))}}v(pl),F(pl,!0,(U=>new Bl(U)));const kl="MSFT_lod";class Al{constructor(U){var W;this.name=kl,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new q.b,this.onMaterialLODsLoadedObservable=new q.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=U,this.maxLODsToLoad=(null===(W=this._loader.parent.extensionOptions[kl])||void 0===W?void 0:W.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(kl)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let U=0;U<this._nodePromiseLODs.length;U++){const W=Promise.all(this._nodePromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter(`Node LOD ${U}`),this._loader.log(`Loaded node LOD ${U}`)),this.onNodeLODsLoadedObservable.notifyObservers(U),U!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${U+1}`),this._loadBufferLOD(this._nodeBufferLODs,U+1),this._nodeSignalLODs[U]&&this._nodeSignalLODs[U].resolve())}));this._loader._completePromises.push(W)}for(let U=0;U<this._materialPromiseLODs.length;U++){const W=Promise.all(this._materialPromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter(`Material LOD ${U}`),this._loader.log(`Loaded material LOD ${U}`)),this.onMaterialLODsLoadedObservable.notifyObservers(U),U!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${U+1}`),this._loadBufferLOD(this._materialBufferLODs,U+1),this._materialSignalLODs[U]&&this._materialSignalLODs[U].resolve())}));this._loader._completePromises.push(W)}}loadSceneAsync(U,W){const l=this._loader.loadSceneAsync(U,W);return this._loadBufferLOD(this._bufferLODs,0),l}loadNodeAsync(U,W,l){return C.LoadExtensionAsync(U,W,this.name,(async(U,t)=>{let L;const p=this._getLODs(U,W,this._loader.Tk.nodes,t.ids);this._loader.logOpen(`${U}`);for(let W=0;W<p.length;W++){const U=p[W];0!==W&&(this._nodeIndexLOD=W,this._nodeSignalLODs[W]=this._nodeSignalLODs[W]||new M);const t=U=>{l(U),U.hc(!1)},B=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,t).then((U=>{if(0!==W){const U=p[W-1];U._babylonTransformNode&&(this._disposeTransformNode(U._babylonTransformNode),delete U._babylonTransformNode)}return U.hc(!0),U}));this._nodePromiseLODs[W]=this._nodePromiseLODs[W]||[],0===W?L=B:(this._nodeIndexLOD=null,this._nodePromiseLODs[W].push(B))}return this._loader.logClose(),await L}))}_loadMaterialAsync(U,W,l,M,t){return this._nodeIndexLOD?null:C.LoadExtensionAsync(U,W,this.name,(async(U,L)=>{let p;const B=this._getLODs(U,W,this._loader.Tk.materials,L.ids);this._loader.logOpen(`${U}`);for(let W=0;W<B.length;W++){const U=B[W];0!==W&&(this._materialIndexLOD=W);const L=this._loader._loadMaterialAsync(`/materials/${U.index}`,U,l,M,(U=>{0===W&&t(U)})).then((U=>{if(0!==W){t(U);const l=B[W-1]._data;l[M]&&(this._disposeMaterials([l[M].babylonMaterial]),delete l[M])}return U}));this._materialPromiseLODs[W]=this._materialPromiseLODs[W]||[],0===W?p=L:(this._materialIndexLOD=null,this._materialPromiseLODs[W].push(L))}return this._loader.logClose(),await p}))}_loadUriAsync(U,W,l){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const t=this._nodeIndexLOD-1;return this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new M,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(U,W,l)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const t=this._materialIndexLOD-1;return this._materialSignalLODs[t]=this._materialSignalLODs[t]||new M,this._materialSignalLODs[t].promise.then((async()=>await this._loader.loadUriAsync(U,W,l)))}return null}loadBufferAsync(U,W,l,t){if(this._loader.parent.useRangeRequests&&!W.uri){if(!this._loader.bin)throw new Error(`${U}: Uri is missing or the binary glTF is missing its binary chunk`);const W=async(U,W)=>{const L=l,p=L+t-1;let B=U[W];return B?(B.start=Math.min(B.start,L),B.end=Math.max(B.end,p)):(B={start:L,end:p,loaded:new M},U[W]=B),await B.loaded.promise.then((U=>new Uint8Array(U.buffer,U.byteOffset+l-B.start,t)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?W(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?W(this._materialBufferLODs,this._materialIndexLOD):W(this._bufferLODs,0)}return null}_loadBufferLOD(U,W){const l=U[W];l&&(this._loader.log(`Loading buffer range [${l.start}-${l.end}]`),this._loader.bin.readAsync(l.start,l.end-l.start+1).then((U=>{l.loaded.resolve(U)}),(U=>{l.loaded.reject(U)})))}_getLODs(U,W,l,M){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const t=[];for(let L=M.length-1;L>=0;L--)if(t.push(u.Get(`${U}/ids/${M[L]}`,l,M[L])),t.length===this.maxLODsToLoad)return t;return t.push(W),t}_disposeTransformNode(U){const W=[],l=U.material;l&&W.push(l);for(const t of U.getChildMeshes())t.material&&W.push(t.material);U.dispose();const M=W.filter((U=>this._loader.babylonScene.meshes.every((W=>W.material!=U))));this._disposeMaterials(M)}_disposeMaterials(U){const W={};for(const l of U){for(const U of l.getActiveTextures())W[U.uniqueId]=U;l.dispose()}for(const l in W)for(const U of this._loader.babylonScene.materials)U.hasTexture(W[l])&&delete W[l];for(const l in W)W[l].dispose()}}v(kl),F(kl,!0,(U=>new Al(U)));const ql="MSFT_minecraftMesh";class yl{constructor(U){this.name=ql,this._loader=U,this.enabled=this._loader.isExtensionUsed(ql)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtraAsync(U,W,this.name,(async(M,t)=>{if(t){if(!(l instanceof g.c))throw new Error(`${M}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(U,W,l);return l.needAlphaBlending()&&(l.forceDepthWrite=!0,l.separateCullingPass=!0),l.sk=l.forceDepthWrite,l.twoSidedLighting=!0,await t}}))}}v(ql),F(ql,!0,(U=>new yl(U)));const jl="MSFT_sRGBFactors";class sl{constructor(U){this.name=jl,this._loader=U,this.enabled=this._loader.isExtensionUsed(jl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,W,l){return C.LoadExtraAsync(U,W,this.name,(async(M,t)=>{if(t){if(!(l instanceof g.c))throw new Error(`${M}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(U,W,l),L=l.va().getEngine().useExactSrgbConversions;return l.albedoTexture||l.albedoColor.toLinearSpaceToRef(l.albedoColor,L),l.reflectivityTexture||l.reflectivityColor.toLinearSpaceToRef(l.reflectivityColor,L),await t}}))}}v(jl),F(jl,!0,(U=>new sl(U)));var wl=l(12685);const Kl={};var rl=l(12754),ml=l(12730),fl=l(12692),gl=l(12704);function El(U,W){for(const l of U)for(const U of l.dataOutputs)if(U.uniqueId===W)return U;throw new Error("Could not find data out connection with unique id "+W)}function Zl(U,W){for(const l of U)if(l instanceof ml.c)for(const U of l.signalInputs)if(U.uniqueId===W)return U;throw new Error("Could not find signal in connection with unique id "+W)}async function Nl(U,W){const M=await Promise.all(U.allBlocks.map((async U=>{const W=function(U){switch(U){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([l.e(62),l.e(63)]).then(l.bind(l,13923))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await l.e(64).then(l.bind(l,13929))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await l.e(65).then(l.bind(l,13931))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await l.e(66).then(l.bind(l,13939))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await l.e(67).then(l.bind(l,13942))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await l.e(68).then(l.bind(l,13947))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await l.e(69).then(l.bind(l,13950))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await l.e(70).then(l.bind(l,13959))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await l.e(71).then(l.bind(l,13963))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await l.e(74).then(l.bind(l,13996))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await l.e(74).then(l.bind(l,13996))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await l.e(74).then(l.bind(l,13996))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await l.e(74).then(l.bind(l,13996))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await l.e(79).then(l.bind(l,13998))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await l.e(80).then(l.bind(l,14e3))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await l.e(81).then(l.bind(l,14003))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await l.e(82).then(l.bind(l,14012))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await l.e(83).then(l.bind(l,14018))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await l.e(84).then(l.bind(l,14021))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await l.e(85).then(l.bind(l,14026))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await l.e(86).then(l.bind(l,14030))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await l.e(87).then(l.bind(l,14033))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await l.e(88).then(l.bind(l,14037))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await l.e(89).then(l.bind(l,14039))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await l.e(90).then(l.bind(l,14048))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await l.e(91).then(l.bind(l,14057))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await l.e(92).then(l.bind(l,14065))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await l.e(93).then(l.bind(l,14072))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await l.e(94).then(l.bind(l,14074))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await l.e(95).then(l.bind(l,14079))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await l.e(96).then(l.bind(l,14088))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await l.e(97).then(l.bind(l,14095))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await l.e(76).then(l.bind(l,14100))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await l.e(98).then(l.bind(l,14105))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await l.e(99).then(l.bind(l,14112))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await l.e(100).then(l.bind(l,14115))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await l.e(77).then(l.bind(l,14121))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await l.e(72).then(l.bind(l,13969))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await l.e(78).then(l.bind(l,14128))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await l.e(73).then(l.bind(l,13989))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await l.e(74).then(l.bind(l,13996))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await l.e(74).then(l.bind(l,13996))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await l.e(75).then(l.bind(l,14134))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await l.e(75).then(l.bind(l,14134))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await l.e(75).then(l.bind(l,14134))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await l.e(75).then(l.bind(l,14134))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await l.e(75).then(l.bind(l,14134))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await l.e(75).then(l.bind(l,14134))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await l.e(101).then(l.bind(l,14138))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await l.e(102).then(l.bind(l,14147))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await l.e(103).then(l.bind(l,14152))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await l.e(104).then(l.bind(l,14161))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await l.e(105).then(l.bind(l,14169))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await l.e(106).then(l.bind(l,14176))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await l.e(107).then(l.bind(l,14182))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await l.e(108).then(l.bind(l,14190))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await l.e(109).then(l.bind(l,14195))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await l.e(110).then(l.bind(l,14197))).FlowGraphDataSwitchBlock;default:if(Kl[U])return Kl[U];throw new Error(`Unknown block name ${U}`)}}(U.className);return await W()})));return function(U,W,l){const M=W.coordinator.createGraph(),t=[],L=W.valueParseFunction??fl.e;for(let p=0;p<U.allBlocks.length;p++){const B=ol(U.allBlocks[p],{Gd:W.coordinator.config.Gd,pathConverter:W.pathConverter,assetsContainer:W.coordinator.config.Gd,valueParseFunction:L},l[p]);t.push(B),B instanceof rl.d&&M.addEventBlock(B)}for(const p of t){for(const U of p.dataInputs)for(const W of U.connectedPointIds){const l=El(t,W);U.connectTo(l)}if(p instanceof ml.c)for(const U of p.signalOutputs)for(const W of U.connectedPointIds){const l=Zl(t,W);U.connectTo(l)}}for(const p of U.executionContexts)Dl(p,{graph:M,valueParseFunction:L},U.rightHanded);return M}(U,W,M)}function Dl(U,W,l){const M=W.graph.createContext();U.enableLogging&&(M.enableLogging=!0),M.treatDataAsRightHanded=l||!1;const t=W.valueParseFunction??fl.e;M.uniqueId=U.uniqueId;const L=M.va();if(U._assetsContext){var p,B,k,A,q,y,j,s,w,K;const W=U._assetsContext,l={meshes:null===(p=W.meshes)||void 0===p?void 0:p.map((U=>L.getMeshById(U))),lights:null===(B=W.lights)||void 0===B?void 0:B.map((U=>L.getLightByName(U))),cameras:null===(k=W.cameras)||void 0===k?void 0:k.map((U=>L.getCameraByName(U))),materials:null===(A=W.materials)||void 0===A?void 0:A.map((U=>L.getMaterialById(U))),textures:null===(q=W.textures)||void 0===q?void 0:q.map((U=>L.getTextureByName(U))),animations:null===(y=W.animations)||void 0===y?void 0:y.map((U=>L.animations.find((W=>W.name===U)))),skeletons:null===(j=W.skeletons)||void 0===j?void 0:j.map((U=>L.getSkeletonByName(U))),Fk:null===(s=W.Fk)||void 0===s?void 0:s.map((U=>L.getParticleSystemById(U))),animationGroups:null===(w=W.animationGroups)||void 0===w?void 0:w.map((U=>L.getAnimationGroupByName(U))),transformNodes:null===(K=W.transformNodes)||void 0===K?void 0:K.map((U=>L.getTransformNodeById(U))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],nm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};M.assetsContext=l}for(const r in U._userVariables){const W=t(r,U._userVariables,M.assetsContext,L);M.userVariables[r]=W}for(const r in U._connectionValues){const W=t(r,U._connectionValues,M.assetsContext,L);M._setConnectionValueByKey(r,W)}return M}function ol(U,W,l){const M={},t=W.valueParseFunction??fl.e;if(U.config)for(const p in U.config)M[p]=t(p,U.config,W.assetsContainer||W.Gd,W.Gd);if((0,fl.k)(U.className)){if(!W.pathConverter)throw new Error("Path converter is required for this block");M.pathConverter=W.pathConverter}const L=new l(M);L.uniqueId=U.uniqueId;for(let p=0;p<U.dataInputs.length;p++){const W=L.getDataInput(U.dataInputs[p].name);if(!W)throw new Error("Could not find data input with name "+U.dataInputs[p].name+" in block "+U.className);W.deserialize(U.dataInputs[p])}for(let p=0;p<U.dataOutputs.length;p++){const W=L.getDataOutput(U.dataOutputs[p].name);if(!W)throw new Error("Could not find data output with name "+U.dataOutputs[p].name+" in block "+U.className);W.deserialize(U.dataOutputs[p])}return L.metadata=U.metadata,L.deserialize&&L.deserialize(U),L}function il(U){const[W,l]=U.split(":");return Ol({op:W,extension:l})}function Ol(U){var W;let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const M=U.extension?null===(W=dl[U.extension])||void 0===W?void 0:W[U.op]:Hl[U.op];if(!M&&(K.b.Warn(`No mapping found for operation ${U.op} and extension ${U.extension||"KHR_interactivity"}`),l)){const W={},l={flows:{}};if(U.inputValueSockets){W.values={};for(const l in U.inputValueSockets)W.values[l]={name:l}}return U.outputValueSockets&&(l.values={},Object.keys(U.outputValueSockets).forEach((U=>{l.values[U]={name:U}}))),{$g:[],inputs:W,outputs:l}}return M}function el(U,W,l){dl[W]||(dl[W]={}),dl[W][U]=l}const dl={BABYLON:{"flow/log":{$g:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Hl={"event/onStart":{$g:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{$g:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{$g:["FlowGraphSendCustomEventBlock"],extraProcessor(U,W,l,M,t){if("event/send"!==W.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=U.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const p=M.arrays.events[L],B=t[0];return B.config||(B.config={}),B.config.eventId=p.eventId,B.config.eventData=p.eventData,t}},"event/receive":{$g:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(U,W){var l;if(!U.configuration)return K.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const M=U.configuration.event;if(!M)return K.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const t=M.value[0];if("number"!==typeof t)return K.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(l=W.events)||void 0===l?void 0:l[t])?{valid:!0}:(K.b.Error(`Event with id ${t} not found`),{valid:!1,error:`Event with id ${t} not found`})},extraProcessor(U,W,l,M,t){if("event/receive"!==W.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=U.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const p=M.arrays.events[L],B=t[0];return B.config||(B.config={}),B.config.eventId=p.eventId,B.config.eventData=p.eventData,t}},"math/e":Vl("FlowGraphEBlock"),"math/pi":Vl("FlowGraphPIBlock"),"math/inf":Vl("FlowGraphInfBlock"),"math/nan":Vl("FlowGraphNaNBlock"),"math/abs":Vl("FlowGraphAbsBlock"),"math/sign":Vl("FlowGraphSignBlock"),"math/trunc":Vl("FlowGraphTruncBlock"),"math/floor":Vl("FlowGraphFloorBlock"),"math/ceil":Vl("FlowGraphCeilBlock"),"math/round":{$g:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t){var L;return(L=t[0]).config||(L.config={}),t[0].config.roundHalfAwayFromZero=!0,t}},"math/fract":Vl("FlowGraphFractBlock"),"math/neg":Vl("FlowGraphNegationBlock"),"math/add":Vl("FlowGraphAddBlock",["a","b"],!0),"math/sub":Vl("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{$g:["FlowGraphMultiplyBlock"],extraProcessor(U,W,l,M,t){var L;(L=t[0]).config||(L.config={}),t[0].config.useMatrixPerComponent=!0,t[0].config.preventIntegerFloatArithmetic=!0;let p=-1;return Object.keys(U.values||{}).find((W=>{var l;return void 0!==(null===(l=U.values)||void 0===l?void 0:l[W].type)&&(p=U.values[W].type,!0)})),-1!==p&&(t[0].config.type=M.arrays.types[p].flowGraphType),t},validation:U=>U.values?nl(U):{valid:!0}},"math/div":Vl("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Vl("FlowGraphModuloBlock",["a","b"]),"math/min":Vl("FlowGraphMinBlock",["a","b"]),"math/max":Vl("FlowGraphMaxBlock",["a","b"]),"math/clamp":Vl("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Vl("FlowGraphSaturateBlock"),"math/mix":Vl("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Vl("FlowGraphEqualityBlock",["a","b"]),"math/lt":Vl("FlowGraphLessThanBlock",["a","b"]),"math/le":Vl("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Vl("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Vl("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Vl("FlowGraphIsNaNBlock"),"math/isinf":Vl("FlowGraphIsInfBlock"),"math/select":{$g:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{$g:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Vl("FlowGraphSinBlock"),"math/cos":Vl("FlowGraphCosBlock"),"math/tan":Vl("FlowGraphTanBlock"),"math/asin":Vl("FlowGraphASinBlock"),"math/acos":Vl("FlowGraphACosBlock"),"math/atan":Vl("FlowGraphATanBlock"),"math/atan2":Vl("FlowGraphATan2Block",["a","b"]),"math/sinh":Vl("FlowGraphSinhBlock"),"math/cosh":Vl("FlowGraphCoshBlock"),"math/tanh":Vl("FlowGraphTanhBlock"),"math/asinh":Vl("FlowGraphASinhBlock"),"math/acosh":Vl("FlowGraphACoshBlock"),"math/atanh":Vl("FlowGraphATanhBlock"),"math/exp":Vl("FlowGraphExponentialBlock"),"math/log":Vl("FlowGraphLogBlock"),"math/log2":Vl("FlowGraphLog2Block"),"math/log10":Vl("FlowGraphLog10Block"),"math/sqrt":Vl("FlowGraphSquareRootBlock"),"math/cbrt":Vl("FlowGraphCubeRootBlock"),"math/pow":Vl("FlowGraphPowerBlock",["a","b"]),"math/length":Vl("FlowGraphLengthBlock"),"math/normalize":Vl("FlowGraphNormalizeBlock"),"math/dot":Vl("FlowGraphDotBlock",["a","b"]),"math/cross":Vl("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Vl("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Vl("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{$g:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{$g:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{$g:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{$g:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{$g:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{$g:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{$g:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Vl("FlowGraphTransposeBlock"),"math/determinant":Vl("FlowGraphDeterminantBlock"),"math/inverse":Vl("FlowGraphInvertMatrixBlock"),"math/matmul":Vl("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{$g:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"yd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t,L){const p=t[0].dataInputs.find((U=>"rotationQuaternion"===U.name));if(!p)throw new Error("Rotation quaternion input not found");return L._connectionValues[p.uniqueId]&&(L._connectionValues[p.uniqueId].type="Quaternion"),t}},"math/matDecompose":{$g:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"yd"}}}},"math/quatConjugate":Vl("FlowGraphConjugateBlock",["a"]),"math/quatMul":{$g:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t){var L;return(L=t[0]).config||(L.config={}),t[0].config.type="Quaternion",t}},"math/quatAngleBetween":Vl("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{$g:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Vl("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Vl("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{$g:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t){var L;return(L=t[0]).config||(L.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract2x2":{$g:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{$g:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t){var L;return(L=t[0]).config||(L.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract3x3":{$g:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{$g:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t){var L;return(L=t[0]).config||(L.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract4x4":{$g:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{$g:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t,L){var p,B;(B=t[0]).config||(B.config={});const k=t[0].dataInputs[0];return t[0].config.valueType=(null===(p=L._connectionValues[k.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",t}},"math/and":{$g:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t,L){var p,B,k;(k=t[0]).config||(k.config={});const A=t[0].dataInputs[0],q=t[0].dataInputs[1];return t[0].config.valueType=(null===(p=L._connectionValues[A.uniqueId])||void 0===p?void 0:p.type)??(null===(B=L._connectionValues[q.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",t}},"math/or":{$g:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t,L){var p,B,k;(k=t[0]).config||(k.config={});const A=t[0].dataInputs[0],q=t[0].dataInputs[1];return t[0].config.valueType=(null===(p=L._connectionValues[A.uniqueId])||void 0===p?void 0:p.type)??(null===(B=L._connectionValues[q.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",t}},"math/xor":{$g:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,W,l,M,t,L){var p,B,k;(k=t[0]).config||(k.config={});const A=t[0].dataInputs[0],q=t[0].dataInputs[1];return t[0].config.valueType=(null===(p=L._connectionValues[A.uniqueId])||void 0===p?void 0:p.type)??(null===(B=L._connectionValues[q.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",t}},"math/asr":Vl("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Vl("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Vl("FlowGraphLeadingZerosBlock"),"math/ctz":Vl("FlowGraphTrailingZerosBlock"),"math/popcnt":Vl("FlowGraphOneBitsCounterBlock"),"math/rad":Vl("FlowGraphDegToRadBlock"),"math/deg":Vl("FlowGraphRadToDegBlock"),"type/boolToInt":Vl("FlowGraphBooleanToInt"),"type/boolToFloat":Vl("FlowGraphBooleanToFloat"),"type/intToBool":Vl("FlowGraphIntToBoolean"),"type/intToFloat":Vl("FlowGraphIntToFloat"),"type/floatToInt":Vl("FlowGraphFloatToInt"),"type/floatToBool":Vl("FlowGraphFloatToBoolean"),"flow/sequence":{$g:["FlowGraphSequenceBlock"],extraProcessor(U,W,l,M,t){const L=t[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(U.flows||[]).length,L.signalOutputs.forEach(((U,W)=>{U.name="out_"+W})),t}},"flow/branch":{$g:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{$g:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(U){if(U.configuration&&U.configuration.cases){const W=U.configuration.cases.value;if(!W.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return K.b.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const l=new Set(W);U.configuration.cases.value=Array.from(l)}return{valid:!0}},extraProcessor(U,W,l,M,t){if("flow/switch"!==W.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return t[0].signalOutputs.forEach((U=>{"default"!==U.name&&(U.name="out_"+U.name)})),t}},"flow/while":{$g:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{$g:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(U,W,l,M,t){const L=t[0];return L.config||(L.config={}),L.config.incrementIndexWhenLoopDone=!0,t}},"flow/doN":{$g:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{$g:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(U,W,l,M,t){if("flow/multiGate"!==W.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const L=t[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(U.flows).length,L.signalOutputs.forEach(((U,W)=>{U.name="out_"+W})),t}},"flow/waitAll":{$g:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(U){var W,l;return"number"!==typeof(null===(W=U.configuration)||void 0===W||null===(l=W.inputFlows)||void 0===l?void 0:l.value[0])&&(U.configuration=U.configuration||{inputFlows:{value:[0]}},U.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{$g:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{$g:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{$g:["FlowGraphCancelDelayBlock"]},"variable/get":{$g:["FlowGraphGetVariableBlock"],validation(U){var W,l;return null!==(W=U.configuration)&&void 0!==W&&null!==(l=W.variable)&&void 0!==l&&l.value?{valid:!0}:(K.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,W)=>[W.getVariableName(U[0])]}}},"variable/set":{$g:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,W)=>[W.getVariableName(U[0])]}}},"variable/setMultiple":{$g:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(U,W)=>[U[0].map((U=>W.getVariableName(U)))]}},extraProcessor:(U,W,l,M,t)=>(t[0].dataInputs.forEach((U=>{U.name=M.getVariableName(+U.name)})),t)},"variable/interpolate":{$g:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(U,W)=>[W.getVariableName(U[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:U=>!0===U[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(U,W,l,M,t){var L,p,B;const k=t[0],A=null===(L=U.configuration)||void 0===L?void 0:L.variable.value[0];if("number"!==typeof A)throw K.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const q=M.arrays.staticVariables[A];"undefined"===typeof k.config.animationType.value&&(M.arrays.staticVariables,k.config.animationType.value=(0,gl.M)(q.type));const y=t[4];return y.config||(y.config={}),(p=y.config).variable||(p.variable={}),y.config.variable.value=M.getVariableName(A),(B=t[3]).config||(B.config={}),t}},"pointer/get":{$g:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,W,l,M,t)=>(t.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),t)},"pointer/set":{$g:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,W,l,M,t)=>(t.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),t)},"pointer/interpolate":{$g:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,W,l,M,t)=>(t.forEach((W=>{"FlowGraphJsonPointerParserBlock"===W.className?(W.config||(W.config={}),W.config.outputValue=!0):"FlowGraphInterpolationBlock"===W.className&&(W.config||(W.config={}),Object.keys(U.values||[]).forEach((l=>{var t;const L=null===(t=U.values)||void 0===t?void 0:t[l];if("value"===l&&L){const U=L.type;void 0!==U&&(W.config.animationType=M.arrays.types[U].flowGraphType)}})))})),t)},"animation/start":{$g:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(U,W)=>[U[0]*W._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(U,W)=>[U[0]*W._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,W,l,M,t,L,p){const B=t[t.length-1];return B.config||(B.config={}),B.config.glTF=p,t}},"animation/stop":{$g:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,W,l,M,t,L,p){const B=t[t.length-1];return B.config||(B.config={}),B.config.glTF=p,t}},"animation/stopAt":{$g:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(U,W)=>[U[0]*W._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,W,l,M,t,L,p){const B=t[t.length-1];return B.config||(B.config={}),B.config.glTF=p,t}},"math/switch":{$g:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(U){if(U.configuration&&U.configuration.cases){const W=U.configuration.cases.value;if(!W.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return K.b.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const l=new Set(W);U.configuration.cases.value=Array.from(l)}return{valid:!0}},extraProcessor(U,W,l,M,t){const L=t[0];return L.dataInputs.forEach((U=>{"default"!==U.name&&"case"!==U.name&&(U.name="in_"+U.name)})),L.config||(L.config={}),L.config.treatCasesAsIntegers=!0,t}},"debug/log":{$g:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Vl(U){let W=arguments.length>2?arguments[2]:void 0;return{$g:[U],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((U,W)=>(U[W]={name:W},U)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(U,l,M,t,L){var p;if(W){(p=L[0]).config||(p.config={}),L[0].config.preventIntegerFloatArithmetic=!0;let W=-1;Object.keys(U.values||{}).find((l=>{var M;return void 0!==(null===(M=U.values)||void 0===M?void 0:M[l].type)&&(W=U.values[l].type,!0)})),-1!==W&&(L[0].config.type=t.arrays.types[W].flowGraphType)}return L},validation:U=>W?nl(U):{valid:!0}}}function nl(U){if(U.values){const W=Object.keys(U.values).map((W=>U.values[W].type)).filter((U=>void 0!==U));if(!W.every((U=>U===W[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Hl["math/compose"]=Hl["math/matCompose"],Hl["math/decompose"]=Hl["math/matDecompose"];var xl=l(658);const Il={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ik",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Rl{constructor(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=U,this._gltf=W,this._animationTargetFps=l,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const U of this._interactivityGraph.types)this._types.push(Il[U.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const U of this._interactivityGraph.declarations){const W=Ol(U);if(!W)throw K.b.Error(["No mapping found for declaration",U]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:W,fullOperationName:U.extension?U.op+":"+U.extension:U.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const U of this._interactivityGraph.variables){const W=this._parseVariable(U);this._staticVariables.push(W)}}_parseVariable(U,W){const l=this._types[U.type];if(!l)throw K.b.Error(["No type found for variable",U]),new Error("Error parsing variables");if(U.value&&U.value.length!==l.length)throw K.b.Error(["Invalid value length for variable",U,l]),new Error("Error parsing variables");const M=U.value||[];if(!M.length)switch(l.flowGraphType){case"boolean":M.push(!1);break;case"FlowGraphInteger":M.push(0);break;case"number":M.push(NaN);break;case"Vector2":M.push(NaN,NaN);break;case"ik":M.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":M.fill(NaN,0,4);break;case"Matrix":M.fill(NaN,0,16);break;case"Matrix3D":M.fill(NaN,0,9)}return"number"===l.elementType&&"string"===typeof M[0]&&(M[0]=parseFloat(M[0])),{type:l.flowGraphType,value:W?W(M,this):M}}_parseEvents(){if(this._interactivityGraph.events)for(const U of this._interactivityGraph.events){const W={eventId:U.id||"internalEvent_"+this._internalEventsCounter++};U.values&&(W.eventData=Object.keys(U.values).map((W=>{var l;const M=null===(l=U.values)||void 0===l?void 0:l[W];if(!M)throw K.b.Error(["No value found for event key",W]),new Error("Error parsing events");const t=this._types[M.type];if(!t)throw K.b.Error(["No type found for event value",M]),new Error("Error parsing events");const L="undefined"!==typeof M.value?this._parseVariable(M):void 0;return{id:W,type:t.flowGraphType,eventData:!0,value:L}}))),this._events.push(W)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const W of this._interactivityGraph.nodes){if("number"!==typeof W.declaration)throw K.b.Error(["No declaration found for node",W]),new Error("Error parsing nodes");const l=this._mappings[W.declaration];if(!l)throw K.b.Error(["No mapping found for node",W]),new Error("Error parsing nodes");if(l.flowGraphMapping.validation){const M=l.flowGraphMapping.validation(W,this._interactivityGraph,this._gltf);var U;if(!M.valid)throw new Error(`Error validating interactivity node ${null===(U=this._interactivityGraph.declarations)||void 0===U?void 0:U[W.declaration].op} - ${M.error}`)}const M=[];for(const U of l.flowGraphMapping.$g){const t=this._getEmptyBlock(U,l.fullOperationName);this._parseNodeConfiguration(W,t,l.flowGraphMapping,U),M.push(t)}this._nodes.push({$g:M,fullOperationName:l.fullOperationName})}}_getEmptyBlock(U,W){return{uniqueId:(0,xl.d)(),className:U,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:W,metadata:{}}}_parseNodeConfiguration(U,W,l,M){const t=W.config;if(U.configuration){const W=Object.keys(U.configuration);for(const B of W){var L,p;const W=null===(L=U.configuration)||void 0===L?void 0:L[B];if(!W)throw K.b.Error(["No value found for node configuration",B]),new Error("Error parsing node configuration");const k=null===(p=l.configuration)||void 0===p?void 0:p[B];if(k&&k.toBlock?k.toBlock===M:0===l.$g.indexOf(M)){const U=(null===k||void 0===k?void 0:k.name)||B;W&&"undefined"!==typeof W.value||"undefined"===typeof(null===k||void 0===k?void 0:k.defaultValue)?W.value.length>=0?t[U]={value:1===W.value.length?W.value[0]:W.value}:K.b.Warn(["Invalid value for node configuration",W]):t[U]={value:k.defaultValue},k&&k.dataTransformer&&(t[U].value=k.dataTransformer([t[U].value],this)[0])}}}}_parseNodeConnections(U){for(let N=0;N<this._nodes.length;N++){var W;const D=null===(W=this._interactivityGraph.nodes)||void 0===W?void 0:W[N];if(!D)throw K.b.Error(["No node found for interactivity node",this._nodes[N]]),new Error("Error parsing node connections");const o=this._nodes[N],i=this._mappings[D.declaration];if(!i)throw K.b.Error(["No mapping found for node",D]),new Error("Error parsing node connections");const O=D.flows||{},e=Object.keys(O).sort();for(const U of e){var l,M,t,L;const W=O[U],A=null===(l=i.flowGraphMapping.outputs)||void 0===l||null===(M=l.flows)||void 0===M?void 0:M[U],q=(null===A||void 0===A?void 0:A.name)||U,y=this._createNewSocketConnection(q,!0);(A&&A.toBlock&&o.$g.find((U=>U.className===A.toBlock))||o.$g[0]).signalOutputs.push(y);const j=W.node,s=this._nodes[j];if(!s)throw K.b.Error(["No node found for input node id",j]),new Error("Error parsing node connections");const w=il(s.fullOperationName);if(!w)throw K.b.Error(["No mapping found for input node",s]),new Error("Error parsing node connections");let r=null===(t=w.inputs)||void 0===t||null===(L=t.flows)||void 0===L?void 0:L[W.socket||"in"],m=!1;if(!r)for(const U in null===(p=w.inputs)||void 0===p?void 0:p.flows){var p,B,k;if(U.startsWith("[")&&U.endsWith("]"))m=!0,r=null===(B=w.inputs)||void 0===B||null===(k=B.flows)||void 0===k?void 0:k[U]}const f=r?m?r.name.replace("$1",W.socket||""):r.name:W.socket||"in",g=r&&r.toBlock&&s.$g.find((U=>U.className===r.toBlock))||s.$g[0];let E=g.signalInputs.find((U=>U.name===f));E||(E=this._createNewSocketConnection(f),g.signalInputs.push(E)),E.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(E.uniqueId)}const d=D.values||{},H=Object.keys(d);for(const W of H){var A,q;const l=d[W];let M=null===(A=i.flowGraphMapping.inputs)||void 0===A||null===(q=A.values)||void 0===q?void 0:q[W],t=!1;if(!M)for(const U in null===(y=i.flowGraphMapping.inputs)||void 0===y?void 0:y.values){var y,j,s;if(U.startsWith("[")&&U.endsWith("]"))t=!0,M=null===(j=i.flowGraphMapping.inputs)||void 0===j||null===(s=j.values)||void 0===s?void 0:s[U]}const L=M?t?M.name.replace("$1",W):M.name:W,p=this._createNewSocketConnection(L);if((M&&M.toBlock&&o.$g.find((U=>U.className===M.toBlock))||o.$g[0]).dataInputs.push(p),void 0!==l.value){const W=this._parseVariable(l,M&&M.dataTransformer);U._connectionValues[p.uniqueId]=W}else{if("undefined"===typeof l.node)throw K.b.Error(["Invalid value for value connection",l]),new Error("Error parsing node connections");{var w,r,m;const U=l.node,W=l.socket||"value",M=this._nodes[U];if(!M)throw K.b.Error(["No node found for output socket reference",l]),new Error("Error parsing node connections");const t=il(M.fullOperationName);if(!t)throw K.b.Error(["No mapping found for output socket reference",l]),new Error("Error parsing node connections");let L=null===(w=t.outputs)||void 0===w||null===(r=w.values)||void 0===r?void 0:r[W],B=!1;if(!L)for(const l in null===(f=t.outputs)||void 0===f?void 0:f.values){var f,g,E;if(l.startsWith("[")&&l.endsWith("]"))B=!0,L=null===(g=t.outputs)||void 0===g||null===(E=g.values)||void 0===E?void 0:E[l]}const k=L?B?L.name.replace("$1",W):null===(m=L)||void 0===m?void 0:m.name:W,A=L&&L.toBlock&&M.$g.find((U=>U.className===L.toBlock))||M.$g[0];let q=A.dataOutputs.find((U=>U.name===k));q||(q=this._createNewSocketConnection(k,!0),A.dataOutputs.push(q)),p.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(p.uniqueId)}}}if(i.flowGraphMapping.interBlockConnectors)for(const U of i.flowGraphMapping.interBlockConnectors){const W=U.input,l=U.output,M=U.isVariable;this._connectFlowGraphNodes(W,l,o.$g[U.inputBlockIndex],o.$g[U.outputBlockIndex],M)}if(i.flowGraphMapping.extraProcessor){var Z;const W=null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[D.declaration];if(!W)throw K.b.Error(["No declaration found for extra processor",D]),new Error("Error parsing node connections");o.$g=i.flowGraphMapping.extraProcessor(D,W,i.flowGraphMapping,this,o.$g,U,this._gltf)}}}_createNewSocketConnection(U,W){return{uniqueId:(0,xl.d)(),name:U,_connectionType:W?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(U,W,l,M,t){const L=t?l.dataInputs:l.signalInputs,p=t?M.dataOutputs:M.signalOutputs,B=L.find((W=>W.name===U))||this._createNewSocketConnection(U),k=p.find((U=>U.name===W))||this._createNewSocketConnection(W,!0);L.find((W=>W.name===U))||L.push(B),p.find((U=>U.name===W))||p.push(k),B.connectedPointIds.push(k.uniqueId),k.connectedPointIds.push(B.uniqueId)}getVariableName(U){return"staticVariable_"+U}serializeToFlowGraph(){const U={uniqueId:(0,xl.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(U);for(let W=0;W<this._staticVariables.length;W++){const l=this._staticVariables[W];U._userVariables[this.getVariableName(W)]=l}return{rightHanded:!0,allBlocks:this._nodes.reduce(((U,W)=>U.concat(W.$g)),[]),executionContexts:[U]}}}const Fl="KHR_interactivity";class vl{constructor(U){this._loader=U,this.name=Fl,this.enabled=this._loader.isExtensionUsed(Fl),this._pathConverter=(0,J.j)(this._loader.Tk),U._skipStartAnimationStep=!0;const W=U.babylonScene;W&&function(U){(0,J.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!U.activeCamera)return new t.e(NaN,NaN,NaN,NaN);const W=t.e.FromRotationMatrix(U.activeCamera.getWorldMatrix()).normalize();return U.useRightHandedSystem||(W.w*=-1,W.x*=-1),W},type:"Quaternion",getTarget:()=>U.activeCamera}),(0,J.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!U.activeCamera)return new t.l(NaN,NaN,NaN);const W=U.activeCamera.getWorldMatrix().getTranslation();return U.useRightHandedSystem||(W.x*=-1),W},type:"ik",getTarget:()=>U.activeCamera}),(0,J.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:U=>{var W;return(null===(W=U._babylonAnimationGroup)||void 0===W?void 0:W.isPlaying)??!1},type:"boolean",getTarget:U=>U._babylonAnimationGroup}),(0,J.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:U=>{var W;return((null===(W=U._babylonAnimationGroup)||void 0===W?void 0:W.from)??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,J.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:U=>{var W;return((null===(W=U._babylonAnimationGroup)||void 0===W?void 0:W.to)??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,J.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:U=>{var W;return((null===(W=U._babylonAnimationGroup)||void 0===W?void 0:W.getCurrentFrame())??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,J.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:U=>{var W;return((null===(W=U._babylonAnimationGroup)||void 0===W?void 0:W.getCurrentFrame())??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup})}(W)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var U;if(!this._loader.babylonScene||!this._pathConverter)return;const W=this._loader.babylonScene,l=null===(U=this._loader.Tk.extensions)||void 0===U?void 0:U.KHR_interactivity;if(!l)return;const M=new wl.e({Gd:W});M.dispatchEventsSynchronously=!1;const t=l.graphs.map((U=>new Rl(U,this._loader.Tk,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(t.map((async U=>await Nl(U,{coordinator:M,pathConverter:this._pathConverter})))),M.start()}}var Jl;Jl=async()=>(await Promise.resolve().then(l.bind(l,12771))).FlowGraphGLTFDataProvider,Kl[`${Fl}/${"FlowGraphGLTFDataProvider"}`]=Jl,v(Fl),F(Fl,!0,(U=>new vl(U)));const Ql="KHR_node_visibility";(0,J.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:U=>{const W=U._babylonTransformNode;return!W||void 0===W.isVisible||W.isVisible},set:(U,W)=>{var l,M;null===(l=W._primitiveBabylonMeshes)||void 0===l||l.forEach((U=>{U.inheritVisibility=!0})),W._babylonTransformNode&&(W._babylonTransformNode.isVisible=U),null===(M=W._primitiveBabylonMeshes)||void 0===M||M.forEach((W=>{W.isVisible=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Gl{constructor(U){this.name=Ql,this._loader=U,this.enabled=U.isExtensionUsed(Ql)}async onReady(){var U;null===(U=this._loader.Tk.nodes)||void 0===U||U.forEach((U=>{var W,l,M,t;(null===(W=U._primitiveBabylonMeshes)||void 0===W||W.forEach((U=>{U.inheritVisibility=!0})),null!==(l=U.extensions)&&void 0!==l&&l.KHR_node_visibility)&&(!1===(null===(M=U.extensions)||void 0===M?void 0:M.KHR_node_visibility.visible)&&(U._babylonTransformNode&&(U._babylonTransformNode.isVisible=!1),null===(t=U._primitiveBabylonMeshes)||void 0===t||t.forEach((U=>{U.isVisible=!1}))))}))}dispose(){this._loader=null}}v(Ql),F(Ql,!0,(U=>new Gl(U)));const ul="KHR_node_selectability";el("event/onSelect",ul,{$g:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:U=>["pickedMesh_"+U[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,W,l,M,t,L,p){var B,k,A,q,y,j;const s=t[t.length-1];s.config=s.config||{},s.config.glTF=p;const w=null===(B=U.configuration)||void 0===B||null===(k=B.nodeIndex)||void 0===k?void 0:k.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const K="pickedMesh_"+w;return t[1].config.variable=K,L._userVariables[K]={className:"Mesh",id:null===p||void 0===p||null===(A=p.nodes)||void 0===A||null===(q=A[w]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===p||void 0===p||null===(y=p.nodes)||void 0===y||null===(j=y[w]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},t}}),(0,J.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:U=>{const W=U._babylonTransformNode;return!W||void 0===W.df||W.df},set:(U,W)=>{var l;null===(l=W._primitiveBabylonMeshes)||void 0===l||l.forEach((W=>{W.df=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"df"],type:"boolean"});class bl{constructor(U){this.name=ul,this._loader=U,this.enabled=U.isExtensionUsed(ul)}async onReady(){var U;null===(U=this._loader.Tk.nodes)||void 0===U||U.forEach((U=>{var W,l,M;null!==(W=U.extensions)&&void 0!==W&&W.KHR_node_selectability&&!1===(null===(l=U.extensions)||void 0===l?void 0:l.KHR_node_selectability.selectable)&&(null===(M=U._babylonTransformNode)||void 0===M||M.getChildMeshes().forEach((U=>{U.df=!1})))}))}dispose(){this._loader=null}}v(ul),F(ul,!0,(U=>new bl(U)));const Cl="KHR_node_hoverability",Pl="targetMeshPointerOver_";el("event/onHoverIn",Cl,{$g:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:U=>[Pl+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,W,l,M,t,L,p){var B,k,A,q,y,j;const s=t[t.length-1];s.config=s.config||{},s.config.glTF=p;const w=null===(B=U.configuration)||void 0===B||null===(k=B.nodeIndex)||void 0===k?void 0:k.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const K=Pl+w;return t[1].config.variable=K,L._userVariables[K]={className:"Mesh",id:null===p||void 0===p||null===(A=p.nodes)||void 0===A||null===(q=A[w]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===p||void 0===p||null===(y=p.nodes)||void 0===y||null===(j=y[w]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},t}});const Sl="targetMeshPointerOut_";el("event/onHoverOut",Cl,{$g:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:U=>[Sl+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,W,l,M,t,L,p){var B,k,A,q,y,j;const s=t[t.length-1];s.config=s.config||{},s.config.glTF=p;const w=null===(B=U.configuration)||void 0===B||null===(k=B.nodeIndex)||void 0===k?void 0:k.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const K=Sl+w;return t[1].config.variable=K,L._userVariables[K]={className:"Mesh",id:null===p||void 0===p||null===(A=p.nodes)||void 0===A||null===(q=A[w]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===p||void 0===p||null===(y=p.nodes)||void 0===y||null===(j=y[w]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},t}}),(0,J.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:U=>{const W=U._babylonTransformNode;return!W||void 0===W.pointerOverDisableMeshTesting||W.pointerOverDisableMeshTesting},set:(U,W)=>{var l;null===(l=W._primitiveBabylonMeshes)||void 0===l||l.forEach((W=>{W.pointerOverDisableMeshTesting=!U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class cl{constructor(U){this.name=Cl,this._loader=U,this.enabled=U.isExtensionUsed(Cl)}async onReady(){var U;null===(U=this._loader.Tk.nodes)||void 0===U||U.forEach((U=>{var W,l,M;null!==(W=U.extensions)&&void 0!==W&&W.KHR_node_hoverability&&!1===(null===(l=U.extensions)||void 0===l?void 0:l.KHR_node_hoverability.hoverable)&&(null===(M=U._babylonTransformNode)||void 0===M||M.getChildMeshes().forEach((U=>{U.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}v(Cl),F(Cl,!0,(U=>new cl(U)));const hl="ExtrasAsMetadata";class zl{_assignExtras(U,W){if(W.extras&&Object.keys(W.extras).length>0){const l=U.metadata=U.metadata||{};(l.Tk=l.Tk||{}).extras=W.extras}}constructor(U){this.name=hl,this.enabled=!0,this._loader=U}dispose(){this._loader=null}loadNodeAsync(U,W,l){return this._loader.loadNodeAsync(U,W,(U=>{this._assignExtras(U,W),l(U)}))}loadCameraAsync(U,W,l){return this._loader.loadCameraAsync(U,W,(U=>{this._assignExtras(U,W),l(U)}))}createMaterial(U,W,l){const M=this._loader.createMaterial(U,W,l);return this._assignExtras(M,W),M}}v(hl),F(hl,!1,(U=>new zl(U)));l(12771)},12633:(U,W,l)=>{"use strict";l.d(W,{b:()=>n,f:()=>i,h:()=>o,j:()=>O});var M=l(496),t=l(503),L=l(12272),p=l(487),B=l(828),k=l(821),A=l(512),q=l(543),y=l(11778),j=l(11868),s=l(677),w=l(667);class K{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Fk=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.nm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(U){this._environmentTexture=U}getNodes(){let U=[];U=U.concat(this.meshes),U=U.concat(this.lights),U=U.concat(this.cameras),U=U.concat(this.transformNodes);for(const W of this.skeletons)U=U.concat(W.bones);return U}}class r extends K{}class m{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const U=this.rootNodes;for(const M of U)M.dispose();U.length=0;const W=this.skeletons;for(const M of W)M.dispose();W.length=0;const l=this.animationGroups;for(const M of l)M.dispose();l.length=0}}class f extends K{constructor(U){super(),this._wasAddedToScene=!1,(U=U||q.d.LastCreatedScene)&&(this.Gd=U,this.proceduralTextures=[],U.nk.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=U.getEngine().onContextRestoredObservable.add((()=>{for(const U of this.geometries)U._rebuild();for(const U of this.meshes)U._rebuild();for(const U of this.Fk)U.rebuild();for(const U of this.textures)U._rebuild()})))}_topologicalSort(U){const W=new Map;for(const p of U)W.set(p.uniqueId,p);const l={dependsOn:new Map,dependedBy:new Map};for(const p of U){const U=p.uniqueId;l.dependsOn.set(U,new Set),l.dependedBy.set(U,new Set)}for(const p of U){const U=p.uniqueId,M=l.dependsOn.get(U);if(p instanceof y.b){const t=p.sourceMesh;W.has(t.uniqueId)&&(M.add(t.uniqueId),l.dependedBy.get(t.uniqueId).add(U))}const t=l.dependedBy.get(U);for(const L of p.getDescendants()){const M=L.uniqueId;if(W.has(M)){t.add(M);l.dependsOn.get(M).add(U)}}}const M=[],t=[];for(const p of U){const U=p.uniqueId;0===l.dependsOn.get(U).size&&(t.push(p),W.delete(U))}const L=t;for(;L.length>0;){const U=L.shift();M.push(U);const t=l.dependedBy.get(U.uniqueId);for(const M of Array.from(t.values())){const t=l.dependsOn.get(M);t.delete(U.uniqueId),0===t.size&&W.get(M)&&(L.push(W.get(M)),W.delete(M))}}return W.size>0&&(A.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),W.forEach((U=>{A.b.Error(U.name)}))),M}_addNodeAndDescendantsToList(U,W,l,M){if(l&&(!M||M(l))&&!W.has(l.uniqueId)){U.push(l),W.add(l.uniqueId);for(const t of l.getDescendants(!0))this._addNodeAndDescendantsToList(U,W,t,M)}}_isNodeInContainer(U){return U instanceof k.c&&-1!==this.meshes.indexOf(U)||(U instanceof B.d&&-1!==this.transformNodes.indexOf(U)||(U instanceof j.c&&-1!==this.lights.indexOf(U)||U instanceof s.d&&-1!==this.cameras.indexOf(U)))}_isValidHierarchy(){for(const U of this.meshes)if(U.parent&&!this._isNodeInContainer(U.parent))return A.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.transformNodes)if(U.parent&&!this._isNodeInContainer(U.parent))return A.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.lights)if(U.parent&&!this._isNodeInContainer(U.parent))return A.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.cameras)if(U.parent&&!this._isNodeInContainer(U.parent))return A.b.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(U){let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||t.h.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const M={},L={},B=new m,k=[],A=[],q={doNotInstantiate:!0,...l},y=[],j=new Set;for(const t of this.transformNodes)null===t.parent&&this._addNodeAndDescendantsToList(y,j,t,q.predicate);for(const t of this.meshes)null===t.parent&&this._addNodeAndDescendantsToList(y,j,t,q.predicate);const s=this._topologicalSort(y),w=(l,t)=>{if(((W,l)=>{if(M[W.uniqueId]=l.uniqueId,L[l.uniqueId]=l,U&&(l.name=U(W.name)),l instanceof p.e){const U=l;if(U.morphTargetManager){const l=W.morphTargetManager;U.morphTargetManager=l.clone();for(let W=0;W<l.numTargets;W++){const t=l.getTarget(W),p=U.morphTargetManager.getTarget(W);M[t.uniqueId]=p.uniqueId,L[p.uniqueId]=p}}}})(l,t),l.parent){const U=M[l.parent.uniqueId],W=L[U];t.parent=W||l.parent}if(t.position&&l.position&&t.position.p(l.position),t.rotationQuaternion&&l.rotationQuaternion&&t.rotationQuaternion.p(l.rotationQuaternion),t.rotation&&l.rotation&&t.rotation.p(l.rotation),t.yd&&l.yd&&t.yd.p(l.yd),t.material){const p=t;if(p.material)if(W){const W=l.material;if(-1===A.indexOf(W)){let l=W.clone(U?U(W.name):"Clone of "+W.name);if(A.push(W),M[W.uniqueId]=l.uniqueId,L[l.uniqueId]=l,"MultiMaterial"===W.getClassName()){const t=W;for(const W of t.yk)W&&(l=W.clone(U?U(W.name):"Clone of "+W.name),A.push(W),M[W.uniqueId]=l.uniqueId,L[l.uniqueId]=l);t.yk=t.yk.map((U=>U&&L[M[U.uniqueId]]))}}"InstancedMesh"!==p.getClassName()&&(p.material=L[M[W.uniqueId]])}else"MultiMaterial"===p.material.getClassName()?-1===this.Gd.multiMaterials.indexOf(p.material)&&this.Gd.addMultiMaterial(p.material):-1===this.Gd.materials.indexOf(p.material)&&this.Gd.addMaterial(p.material)}null===t.parent&&B.rootNodes.push(t)};for(const t of s)if("InstancedMesh"===t.getClassName()){const U=t,W=U.sourceMesh,l=M[W.uniqueId];w(U,("number"===typeof l?L[l]:W).createInstance(U.name))}else{let U=!0;"Sk"===t.getClassName()||"Node"===t.getClassName()||t.skeleton||!t.getTotalVertices||0===t.getTotalVertices()?U=!1:q.doNotInstantiate&&(U="function"===typeof q.doNotInstantiate?!q.doNotInstantiate(t):!q.doNotInstantiate);const W=U?t.createInstance(`instance of ${t.name}`):t.clone(`Clone of ${t.name}`,null,!0);if(!W)throw new Error(`Could not clone or instantiate node on Asset Container ${t.name}`);w(t,W)}for(const t of this.skeletons){if(q.predicate&&!q.predicate(t))continue;const W=t.clone(U?U(t.name):"Clone of "+t.name);for(const U of this.meshes)if(U.skeleton===t&&!U.isAnInstance){const l=L[M[U.uniqueId]];if(!l||l.isAnInstance)continue;if(l.skeleton=W,-1!==k.indexOf(W))continue;k.push(W);for(const U of W.bones)U._linkedTransformNode&&(U._linkedTransformNode=L[M[U._linkedTransformNode.uniqueId]])}B.skeletons.push(W)}for(const t of this.animationGroups){if(q.predicate&&!q.predicate(t))continue;const W=t.clone(U?U(t.name):"Clone of "+t.name,(U=>L[M[U.uniqueId]]||U));B.animationGroups.push(W)}return B}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||t.h.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Gd.environmentTexture=this.environmentTexture);for(const U of this.Gd._serializableComponents)U.addFromContainer(this);this.Gd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const W=[];for(const l of this.cameras)U&&!U(l)||(this.Gd.addCamera(l),W.push(l));for(const l of this.lights)U&&!U(l)||(this.Gd.addLight(l),W.push(l));for(const l of this.meshes)U&&!U(l)||(this.Gd.Dk(l),W.push(l));for(const l of this.skeletons)U&&!U(l)||this.Gd.addSkeleton(l);for(const l of this.animations)U&&!U(l)||this.Gd.addAnimation(l);for(const l of this.animationGroups)U&&!U(l)||this.Gd.addAnimationGroup(l);for(const l of this.multiMaterials)U&&!U(l)||this.Gd.addMultiMaterial(l);for(const l of this.materials)U&&!U(l)||this.Gd.addMaterial(l);for(const l of this.morphTargetManagers)U&&!U(l)||this.Gd.addMorphTargetManager(l);for(const l of this.geometries)U&&!U(l)||this.Gd.addGeometry(l);for(const l of this.transformNodes)U&&!U(l)||(this.Gd.addTransformNode(l),W.push(l));for(const l of this.actionManagers)U&&!U(l)||this.Gd.addActionManager(l);for(const l of this.textures)U&&!U(l)||this.Gd.addTexture(l);for(const l of this.reflectionProbes)U&&!U(l)||this.Gd.addReflectionProbe(l);for(const l of W)l.parent&&-1===this.Gd.getNodes().indexOf(l.parent)&&(l.setParent?l.setParent(null):l.parent=null)}removeAllFromScene(){this._isValidHierarchy()||t.h.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Gd.environmentTexture&&(this.Gd.environmentTexture=null);for(const U of this.Gd._serializableComponents)U.removeFromContainer(this)}removeFromScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const W of this.cameras)U&&!U(W)||this.Gd.removeCamera(W);for(const W of this.lights)U&&!U(W)||this.Gd.removeLight(W);for(const W of this.meshes)U&&!U(W)||this.Gd.Ek(W,!0);for(const W of this.skeletons)U&&!U(W)||this.Gd.removeSkeleton(W);for(const W of this.animations)U&&!U(W)||this.Gd.removeAnimation(W);for(const W of this.animationGroups)U&&!U(W)||this.Gd.removeAnimationGroup(W);for(const W of this.multiMaterials)U&&!U(W)||this.Gd.removeMultiMaterial(W);for(const W of this.materials)U&&!U(W)||this.Gd.removeMaterial(W);for(const W of this.morphTargetManagers)U&&!U(W)||this.Gd.removeMorphTargetManager(W);for(const W of this.geometries)U&&!U(W)||this.Gd.removeGeometry(W);for(const W of this.transformNodes)U&&!U(W)||this.Gd.removeTransformNode(W);for(const W of this.actionManagers)U&&!U(W)||this.Gd.removeActionManager(W);for(const W of this.textures)U&&!U(W)||this.Gd.removeTexture(W);for(const W of this.reflectionProbes)U&&!U(W)||this.Gd.removeReflectionProbe(W)}dispose(){const U=this.cameras.slice(0);for(const s of U)s.dispose();this.cameras.length=0;const W=this.lights.slice(0);for(const s of W)s.dispose();this.lights.length=0;const l=this.meshes.slice(0);for(const s of l)s.dispose();this.meshes.length=0;const M=this.skeletons.slice(0);for(const s of M)s.dispose();this.skeletons.length=0;const t=this.animationGroups.slice(0);for(const s of t)s.dispose();this.animationGroups.length=0;const L=this.multiMaterials.slice(0);for(const s of L)s.dispose();this.multiMaterials.length=0;const p=this.materials.slice(0);for(const s of p)s.dispose();this.materials.length=0;const B=this.geometries.slice(0);for(const s of B)s.dispose();this.geometries.length=0;const k=this.transformNodes.slice(0);for(const s of k)s.dispose();this.transformNodes.length=0;const A=this.actionManagers.slice(0);for(const s of A)s.dispose();this.actionManagers.length=0;const q=this.textures.slice(0);for(const s of q)s.dispose();this.textures.length=0;const y=this.reflectionProbes.slice(0);for(const s of y)s.dispose();this.reflectionProbes.length=0;const j=this.morphTargetManagers.slice(0);for(const s of j)s.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const s of this.Gd._serializableComponents)s.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Gd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(U,W,l){if(U&&W)for(const M of U){let U=!0;if(l)for(const W of l)if(M===W){U=!1;break}U&&(W.push(M),M._parentContainer=this)}}moveAllFromScene(U){this._wasAddedToScene=!1,void 0===U&&(U=new r);for(const W in this)Object.prototype.hasOwnProperty.call(this,W)&&(this[W]=this[W]||("_environmentTexture"===W?null:[]),this._moveAssets(this.Gd[W],this[W],U[W]));this.environmentTexture=this.Gd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const U=new p.e("assetContainerRootMesh",this.Gd);for(const W of this.meshes)W.parent||U.addChild(W);return this.meshes.unshift(U),U}mergeAnimationsTo(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.d.LastCreatedScene,W=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!U)return A.b.Error("No scene available to merge animations to"),[];const M=l||(W=>{let l=null;const M=W.animations.length?W.animations[0].targetProperty:"",t=W.name.split(".").join("").split("_primitive")[0];switch(M){case"position":case"rotationQuaternion":l=U.getTransformNodeByName(W.name)||U.getTransformNodeByName(t);break;case"influence":l=U.getMorphTargetByName(W.name)||U.getMorphTargetByName(t);break;default:l=U.getNodeByName(W.name)||U.getNodeByName(t)}return l}),t=this.getNodes();for(const B of t){const U=M(B);if(null!==U){for(const W of B.animations){const l=U.animations.filter((U=>U.targetProperty===W.targetProperty));for(const W of l){const l=U.animations.indexOf(W,0);l>-1&&U.animations.splice(l,1)}}U.animations=U.animations.concat(B.animations)}}const L=[],p=this.animationGroups.slice();for(const B of p){L.push(B.clone(B.name,M));for(const U of B.animatables)U.stop()}for(const B of W){const W=M(B.target);W&&(U.beginAnimation(W,B.fromFrame,B.toFrame,B.loopAnimation,B.speedRatio,B.onAnimationEnd?B.onAnimationEnd:void 0,void 0,!0,void 0,B.onAnimationLoop?B.onAnimationLoop:void 0),U.stopAnimation(B.target))}return L}populateRootNodes(){this.rootNodes.length=0;for(const U of this.meshes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.transformNodes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.lights)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.cameras)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U)}addAllAssetsToContainer(U){if(!U)return;const W=[],l=new Set;for(W.push(U);W.length>0;){const U=W.pop();if(U instanceof p.e?(U.vk&&-1===this.geometries.indexOf(U.vk)&&this.geometries.push(U.vk),this.meshes.push(U)):U instanceof y.b?this.meshes.push(U):U instanceof B.d?this.transformNodes.push(U):U instanceof j.c?this.lights.push(U):U instanceof s.d&&this.cameras.push(U),U instanceof k.c){if(U.material&&-1===this.materials.indexOf(U.material)){this.materials.push(U.material);for(const W of U.material.getActiveTextures())-1===this.textures.indexOf(W)&&this.textures.push(W)}U.skeleton&&-1===this.skeletons.indexOf(U.skeleton)&&this.skeletons.push(U.skeleton),U.morphTargetManager&&-1===this.morphTargetManagers.indexOf(U.morphTargetManager)&&this.morphTargetManagers.push(U.morphTargetManager)}for(const M of U.getChildren())l.has(M)||W.push(M);l.add(U)}this.populateRootNodes()}_getByTags(U,W,l){if(void 0===W)return U;const M=[];for(const t in U){const L=U[t];w.d&&w.d.MatchesQuery(L,W)&&(!l||l(L))&&M.push(L)}return M}getMeshesByTags(U,W){return this._getByTags(this.meshes,U,W)}getCamerasByTags(U,W){return this._getByTags(this.cameras,U,W)}getLightsByTags(U,W){return this._getByTags(this.lights,U,W)}getMaterialsByTags(U,W){return this._getByTags(this.materials,U,W).concat(this._getByTags(this.multiMaterials,U,W))}getTransformNodesByTags(U,W){return this._getByTags(this.transformNodes,U,W)}}var g=l(560);class E{constructor(U){this.byteOffset=0,this.buffer=U}async loadAsync(U){const W=await this.buffer.readAsync(this.byteOffset,U);this._dataView=new DataView(W.buffer,W.byteOffset,W.byteLength),this._dataByteOffset=0}readUint32(){const U=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,U}readUint8Array(U){const W=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,U);return this._dataByteOffset+=U,this.byteOffset+=U,W}readString(U){return(0,g.j)(this.readUint8Array(U))}skipBytes(U){this._dataByteOffset+=U,this.byteOffset+=U}}var Z=l(12637);const N="Z2xURg",D={name:"Tk",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:U=>-1!==U.indexOf("asset")&&-1!==U.indexOf("version")||U.startsWith("data:base64,"+N)||U.startsWith("data:;base64,"+N)||U.startsWith("data:application/octet-stream;base64,"+N)||U.startsWith("data:model/gltf-binary;base64,"+N)};var o,i,O,e=l(547),d=l(552);function H(U,W,l){try{return Promise.resolve(new Uint8Array(U,W,l))}catch(M){return Promise.reject(M)}}!function(U){U[U.AUTO=0]="AUTO",U[U.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(o||(o={})),function(U){U[U.NONE=0]="NONE",U[U.FIRST=1]="FIRST",U[U.ALL=2]="ALL"}(i||(i={})),function(U){U[U.LOADING=0]="LOADING",U[U.READY=1]="READY",U[U.COMPLETE=2]="COMPLETE"}(O||(O={}));class V{constructor(){this.coordinateSystemMode=o.AUTO,this.animationStartMode=i.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=U=>Promise.resolve(U),this.extensionOptions={}}p(U){U&&(this.onParsed=U.onParsed,this.coordinateSystemMode=U.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=U.animationStartMode??this.animationStartMode,this.loadNodeAnimations=U.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=U.loadSkins??this.loadSkins,this.loadMorphTargets=U.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=U.compileMaterials??this.compileMaterials,this.useClipPlane=U.useClipPlane??this.useClipPlane,this.compileShadowGenerators=U.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=U.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=U.useRangeRequests??this.useRangeRequests,this.createInstances=U.createInstances??this.createInstances,this.alwaysComputeBoundingBox=U.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=U.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=U.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=U.skipMaterials??this.skipMaterials,this.useSRGBBuffers=U.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=U.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=U.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=U.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=U.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=U.customRootNode,this.onMeshLoaded=U.onMeshLoaded,this.onSkinLoaded=U.onSkinLoaded,this.onTextureLoaded=U.onTextureLoaded,this.onMaterialLoaded=U.onMaterialLoaded,this.onCameraLoaded=U.onCameraLoaded,this.extensionOptions=U.extensionOptions??this.extensionOptions)}}class n extends V{constructor(U){super(),this.onParsedObservable=new M.b,this.onMeshLoadedObservable=new M.b,this.onSkinLoadedObservable=new M.b,this.onTextureLoadedObservable=new M.b,this.onMaterialLoadedObservable=new M.b,this.onCameraLoadedObservable=new M.b,this.onCompleteObservable=new M.b,this.onErrorObservable=new M.b,this.nk=new M.b,this.onExtensionLoadedObservable=new M.b,this.validate=!1,this.onValidatedObservable=new M.b,this._loader=null,this._state=null,this._requests=new Array,this.name=D.name,this.extensions=D.extensions,this.onLoaderStateChangedObservable=new M.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(U)}set onParsed(U){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),U&&(this._onParsedObserver=this.onParsedObservable.add(U))}set onMeshLoaded(U){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),U&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(U))}set onSkinLoaded(U){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),U&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((W=>U(W.node,W.skinnedNode))))}set onTextureLoaded(U){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),U&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(U))}set onMaterialLoaded(U){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),U&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(U))}set onCameraLoaded(U){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),U&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(U))}set onComplete(U){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(U)}set onError(U){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(U)}set onDispose(U){this._onDisposeObserver&&this.nk.remove(this._onDisposeObserver),this._onDisposeObserver=this.nk.add(U)}set onExtensionLoaded(U){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(U)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(U){this._loggingEnabled!==U&&(this._loggingEnabled=U,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(U){this._capturePerformanceCounters!==U&&(this._capturePerformanceCounters=U,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(U){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(U)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const U of this._requests)U.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=U=>Promise.resolve(U),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.nk.notifyObservers(void 0),this.nk.clear()}loadFile(U,W,l,L,p,B,k,q){if(ArrayBuffer.isView(W))return this._loadBinary(U,W,l,L,k,q),null;this._progressCallback=p;const y=W.name||t.h.GetFilename(W);if(B){if(this.useRangeRequests){this.validate&&A.b.Warn("glTF validation is not supported when range requests are enabled");const l={abort:()=>{},onCompleteObservable:new M.b},t={readAsync:(l,M)=>new Promise(((t,L)=>{this._loadFile(U,W,(U=>{t(new Uint8Array(U))}),!0,(U=>{L(U)}),(U=>{U.setRequestHeader("Range",`bytes=${l}-${l+M-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new E(t)).then((U=>{l.onCompleteObservable.notifyObservers(l),L(U)}),k?U=>k(void 0,U):void 0),l}return this._loadFile(U,W,(W=>{this._validate(U,new Uint8Array(W,0,W.byteLength),l,y),this._unpackBinaryAsync(new E({readAsync:(U,l)=>H(W,U,l),byteLength:W.byteLength})).then((U=>{L(U)}),k?U=>k(void 0,U):void 0)}),!0,k)}return this._loadFile(U,W,(W=>{try{this._validate(U,W,l,y),L({json:this._parseJson(W)})}catch{k&&k()}}),!1,k)}_loadBinary(U,W,l,M,t,L){this._validate(U,new Uint8Array(W.buffer,W.byteOffset,W.byteLength),l,L),this._unpackBinaryAsync(new E({readAsync:(U,l)=>function(U,W,l){try{if(W<0||W>=U.byteLength)throw new RangeError("Offset is out of range.");if(W+l>U.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(U.buffer,U.byteOffset+W,l))}catch(M){return Promise.reject(M)}}(W,U,l),byteLength:W.byteLength})).then((U=>{M(U)}),t?U=>t(void 0,U):void 0)}importMeshAsync(U,W,l,M,t,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(l),this._loader.importMeshAsync(U,W,null,l,M,t,L))))}loadAsync(U,W,l,M,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(W),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(W),this._loader.loadAsync(U,W,l,M,t))))}loadAssetContainerAsync(U,W,l,M,t){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(W),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(W);const L=new f(U),p=[];this.onMaterialLoadedObservable.add((U=>{p.push(U)}));const B=[];this.onTextureLoadedObservable.add((U=>{B.push(U)}));const k=[];this.onCameraLoadedObservable.add((U=>{k.push(U)}));const A=[];return this.onMeshLoadedObservable.add((U=>{U.morphTargetManager&&A.push(U.morphTargetManager)})),this._loader.importMeshAsync(null,U,L,W,l,M,t).then((U=>(Array.prototype.push.apply(L.geometries,U.geometries),Array.prototype.push.apply(L.meshes,U.meshes),Array.prototype.push.apply(L.Fk,U.Fk),Array.prototype.push.apply(L.skeletons,U.skeletons),Array.prototype.push.apply(L.animationGroups,U.animationGroups),Array.prototype.push.apply(L.materials,p),Array.prototype.push.apply(L.textures,B),Array.prototype.push.apply(L.lights,U.lights),Array.prototype.push.apply(L.transformNodes,U.transformNodes),Array.prototype.push.apply(L.cameras,k),Array.prototype.push.apply(L.morphTargetManagers,A),L)))}))}canDirectLoad(U){return D.canDirectLoad(U)}directLoad(U,W){if(W.startsWith("base64,"+N)||W.startsWith(";base64,"+N)||W.startsWith("application/octet-stream;base64,"+N)||W.startsWith("model/gltf-binary;base64,"+N)){const l=(0,e.c)(W);return this._validate(U,new Uint8Array(l,0,l.byteLength)),this._unpackBinaryAsync(new E({readAsync:(U,W)=>H(l,U,W),byteLength:l.byteLength}))}return this._validate(U,W),Promise.resolve({json:this._parseJson(W)})}createPlugin(U){return new n(U[D.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((U,W)=>{this.onCompleteObservable.addOnce((()=>{U()})),this.onErrorObservable.addOnce((U=>{W(U)}))}))}_setState(U){this._state!==U&&(this._state=U,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(O[this._state]))}_loadFile(U,W,l,M,t,L){const p=U._loadFile(W,l,(U=>{this._onProgress(U,p)}),!0,M,t,L);return p.onCompleteObservable.add((()=>{p._lengthComputable=!0,p._total=p._loaded})),this._requests.push(p),p}_onProgress(U,W){if(!this._progressCallback)return;W._lengthComputable=U.lengthComputable,W._loaded=U.loaded,W._total=U.total;let l=!0,M=0,t=0;for(const L of this._requests){if(void 0===L._lengthComputable||void 0===L._loaded||void 0===L._total)return;l=l&&L._lengthComputable,M+=L._loaded,t+=L._total}this._progressCallback({lengthComputable:l,loaded:M,total:l?t:0})}_validate(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),Z.c.ValidateAsync(W,l,M,(W=>this.preprocessUrlAsync(l+W).then((W=>U._loadFileAsync(W,void 0,!0,!0).then((U=>new Uint8Array(U,0,U.byteLength))))))).then((U=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(U),this.onValidatedObservable.clear()}),(U=>{this._endPerformanceCounter("Validate JSON"),t.h.Warn(`Failed to validate: ${U.message}`),this.onValidatedObservable.clear()})))}_getLoader(U){const W=U.json.asset||{};this._log(`Asset version: ${W.version}`),W.minVersion&&this._log(`Asset minimum version: ${W.minVersion}`),W.generator&&this._log(`Asset generator: ${W.generator}`);const l=n._parseVersion(W.version);if(!l)throw new Error("Invalid version: "+W.version);if(void 0!==W.minVersion){const U=n._parseVersion(W.minVersion);if(!U)throw new Error("Invalid minimum version: "+W.minVersion);if(n._compareVersion(U,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+W.minVersion)}const M={1:n._CreateGLTF1Loader,2:n._CreateGLTF2Loader}[l.major];if(!M)throw new Error("Unsupported version: "+W.version);return M(this)}_parseJson(U){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${U.length}`);const W=JSON.parse(U);return this._endPerformanceCounter("Parse JSON"),W}_unpackBinaryAsync(U){return this._startPerformanceCounter("Unpack Binary"),U.loadAsync(20).then((()=>{const W=U.readUint32();if(1179937895!==W)throw new d.i("Unexpected magic: "+W,d.g.GLTFLoaderUnexpectedMagicError);const l=U.readUint32();this.loggingEnabled&&this._log(`Binary version: ${l}`);const M=U.readUint32();let t;switch(this.useRangeRequests||M===U.buffer.byteLength||A.b.Warn(`Length in header does not match actual data length: ${M} != ${U.buffer.byteLength}`),l){case 1:t=this._unpackBinaryV1Async(U,M);break;case 2:t=this._unpackBinaryV2Async(U,M);break;default:throw new Error("Unsupported version: "+l)}return this._endPerformanceCounter("Unpack Binary"),t}))}_unpackBinaryV1Async(U,W){const l=U.readUint32(),M=U.readUint32();if(0!==M)throw new Error(`Unexpected content format: ${M}`);const t=W-U.byteOffset,L={json:this._parseJson(U.readString(l)),bin:null};if(0!==t){const W=U.byteOffset;L.bin={readAsync:(l,M)=>U.buffer.readAsync(W+l,M),byteLength:t}}return Promise.resolve(L)}_unpackBinaryV2Async(U,W){const l=1313821514,M=5130562,t=U.readUint32();if(U.readUint32()!==l)throw new Error("First chunk format is not JSON");return U.byteOffset+t===W?U.loadAsync(t).then((()=>({json:this._parseJson(U.readString(t)),bin:null}))):U.loadAsync(t+8).then((()=>{const L={json:this._parseJson(U.readString(t)),bin:null},p=()=>{const t=U.readUint32();switch(U.readUint32()){case l:throw new Error("Unexpected JSON chunk");case M:{const W=U.byteOffset;L.bin={readAsync:(l,M)=>U.buffer.readAsync(W+l,M),byteLength:t},U.skipBytes(t);break}default:U.skipBytes(t)}return U.byteOffset!==W?U.loadAsync(8).then(p):Promise.resolve(L)};return p()}))}static _parseVersion(U){if("1.0"===U||"1.0.1"===U)return{major:1,minor:0};const W=(U+"").match(/^(\d+)\.(\d+)/);return W?{major:parseInt(W[1]),minor:parseInt(W[2])}:null}static _compareVersion(U,W){return U.major>W.major?1:U.major<W.major?-1:U.minor>W.minor?1:U.minor<W.minor?-1:0}_logOpen(U){this._log(U),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(U){const W=n._logSpaces.substring(0,2*this._logIndentLevel);A.b.Log(`${W}${U}`)}_logDisabled(U){}_startPerformanceCounterEnabled(U){t.h.StartPerformanceCounter(U)}_startPerformanceCounterDisabled(U){}_endPerformanceCounterEnabled(U){t.h.EndPerformanceCounter(U)}_endPerformanceCounterDisabled(U){}}n.IncrementalLoading=!0,n.HomogeneousCoordinates=!1,n._logSpaces="                                ",(0,L.e)(new n)},12637:(U,W,l)=>{"use strict";l.d(W,{c:()=>p});var M=l(503);function t(U,W,l,M){const t={externalResourceFunction:M};return l&&(t.uri="file:"===W?l:W+l),ArrayBuffer.isView(U)?GLTFValidator.validateBytes(U,t):GLTFValidator.validateString(U,t)}function L(){const U=[];onmessage=W=>{const l=W.data;switch(l.id){case"init":importScripts(l.url);break;case"validate":t(l.data,l.rootUrl,l.fileName,(W=>new Promise(((l,M)=>{const t=U.length;U.push({resolve:l,reject:M}),postMessage({id:"getExternalResource",index:t,uri:W})})))).then((U=>{postMessage({id:"validate.resolve",value:U})}),(U=>{postMessage({id:"validate.reject",reason:U})}));break;case"getExternalResource.resolve":U[l.index].resolve(l.value);break;case"getExternalResource.reject":U[l.index].reject(l.reason)}}}class p{static ValidateAsync(U,W,l,p){return"function"===typeof Worker?new Promise(((B,k)=>{const A=`${t}(${L})()`,q=URL.createObjectURL(new Blob([A],{type:"application/javascript"})),y=new Worker(q),j=U=>{y.removeEventListener("error",j),y.removeEventListener("message",s),k(U)},s=U=>{const W=U.data;switch(W.id){case"getExternalResource":p(W.uri).then((U=>{y.postMessage({id:"getExternalResource.resolve",index:W.index,value:U},[U.buffer])}),(U=>{y.postMessage({id:"getExternalResource.reject",index:W.index,reason:U})}));break;case"validate.resolve":y.removeEventListener("error",j),y.removeEventListener("message",s),B(W.value),y.terminate();break;case"validate.reject":y.removeEventListener("error",j),y.removeEventListener("message",s),k(W.reason),y.terminate()}};if(y.addEventListener("error",j),y.addEventListener("message",s),y.postMessage({id:"init",url:M.h.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(U)){const M=U.slice();y.postMessage({id:"validate",data:M,rootUrl:W,fileName:l},[M.buffer])}else y.postMessage({id:"validate",data:U,rootUrl:W,fileName:l})})):(this._LoadScriptPromise||(this._LoadScriptPromise=M.h.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>t(U,W,l,p))))}}p.Configuration={url:`${M.h._DefaultCdnUrl}/gltf_validator.js`}},13018:(U,W,l)=>{"use strict";l.d(W,{b:()=>D});var M=l(686),t=l(688),L=l(734),p=l(706),B=l(11816),k=l(11826),A=l(763),q=l(2178),y=l(655),j=l(604);l(12405),l(12301),l(12321),l(12306),l(12330),l(12337),l(12343);const s="imageProcessingCompatibility",w="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";j.d.IncludesShadersStore[s]||(j.d.IncludesShadersStore[s]=w);const K="skyPixelShader",r="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";j.d.ShadersStore[K]||(j.d.ShadersStore[K]=r);l(12417),l(12352),l(12359),l(12374),l(12368);const m="skyVertexShader",f="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";j.d.ShadersStore[m]||(j.d.ShadersStore[m]=f);var g=l(11832),E=l(868),Z=l(854);class N extends B.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends k.d{constructor(U,W){super(U,W),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new p.l(0,100,0),this.useSunPosition=!1,this.cameraOffset=p.l.Zero(),this.up=p.l.Up(),this.dithering=!1,this._cameraPosition=p.l.Zero(),this._skyOrientation=new p.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(U,W){const l=W._drawWrapper;if(this.isFrozen&&l.effect&&l._wasPreviouslyReady)return!0;W.materialDefines||(W.materialDefines=new N);const M=W.materialDefines,t=this.va();if(this._isReadyForSubMesh(W))return!0;if((0,Z.Z)(U,t,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,M),(0,Z.O)(U,M,!0,!1),M.IMAGEPROCESSINGPOSTPROCESS!==t.imageProcessingConfiguration.applyByPostProcess&&M.markAsMiscDirty(),M.DITHER!==this.dithering&&M.markAsMiscDirty(),M.isDirty){M.markAsProcessed(),t.resetCachedMaterial();const U=new g.e;M.FOG&&U.addFallback(1,"FOG"),M.IMAGEPROCESSINGPOSTPROCESS=t.imageProcessingConfiguration.applyByPostProcess,M.DITHER=this.dithering;const l=[A.e.PositionKind];M.VERTEXCOLOR&&l.push(A.e.ColorKind);const L="sky",p=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,E.c)(p);const B=M.toString();W.setEffect(t.getEngine().createEffect(L,l,p,[],B,U,this.onCompiled,this.onError),M,this._materialContext)}return!(!W.effect||!W.effect.isReady())&&(M._renderId=t.getRenderId(),l._wasPreviouslyReady=!0,!0)}bindForSubMesh(U,W,l){const M=this.va(),t=l.materialDefines;if(!t)return;const L=l.effect;if(!L)return;this._activeEffect=L,this.bindOnlyWorldMatrix(U),this._activeEffect.setMatrix("viewProjection",M.getTransformMatrix()),this._mustRebind(M,L,l)&&((0,E.g)(L,this,M),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,Z.n)(t,L,M)),M.fogEnabled&&W.applyFog&&M.fogMode!==q.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",M.getViewMatrix()),(0,Z.g)(M,W,this._activeEffect);const B=M.activeCamera;if(B){const U=B.getWorldMatrix();this._cameraPosition.x=U.m[12],this._cameraPosition.y=U.m[13],this._cameraPosition.z=U.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const U=Math.PI*(this.inclination-.5),W=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(W)*Math.cos(U),this.sunPosition.y=this.distance*Math.sin(-U),this.sunPosition.z=this.distance*Math.sin(W)*Math.cos(U),p.e.FromUnitVectorsToRef(p.l.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(W,this._activeEffect,l)}getAnimatables(){return[]}dispose(U){super.dispose(U)}clone(U){return L.e.Clone((()=>new D(U,this.va())),this)}serialize(){const U=super.serialize();return U.customType="BABYLON.SkyMaterial",U}getClassName(){return"SkyMaterial"}static Parse(U,W,l){return L.e.Parse((()=>new D(U.name,W)),U,W,l)}}(0,M.e)([(0,t.T)()],D.prototype,"luminance",void 0),(0,M.e)([(0,t.T)()],D.prototype,"turbidity",void 0),(0,M.e)([(0,t.T)()],D.prototype,"rayleigh",void 0),(0,M.e)([(0,t.T)()],D.prototype,"mieCoefficient",void 0),(0,M.e)([(0,t.T)()],D.prototype,"mieDirectionalG",void 0),(0,M.e)([(0,t.T)()],D.prototype,"distance",void 0),(0,M.e)([(0,t.T)()],D.prototype,"inclination",void 0),(0,M.e)([(0,t.T)()],D.prototype,"azimuth",void 0),(0,M.e)([(0,t.R)()],D.prototype,"sunPosition",void 0),(0,M.e)([(0,t.T)()],D.prototype,"useSunPosition",void 0),(0,M.e)([(0,t.R)()],D.prototype,"cameraOffset",void 0),(0,M.e)([(0,t.R)()],D.prototype,"up",void 0),(0,M.e)([(0,t.T)()],D.prototype,"dithering",void 0),(0,y.f)("BABYLON.SkyMaterial",D)},11933:(U,W,l)=>{"use strict";function M(U,W){W.headers=U.headers||{},W.statusMessage=U.statusText,W.statusCode=U.status,W.data=U.response}function t(U,W,l){return new Promise((function(t,L){l=l||{};var p,B,k,A=new XMLHttpRequest,q=l.body,y=l.headers||{};for(p in l.timeout&&(A.timeout=l.timeout),A.ontimeout=A.onerror=function(U){U.timeout="timeout"==U.type,L(U)},A.open(U,W.href||W),A.onload=function(){for(k=A.getAllResponseHeaders().trim().split(/[\r\n]+/),M(A,A);B=k.shift();)B=B.split(": "),A.headers[B.shift().toLowerCase()]=B.join(": ");if((B=A.headers["content-type"])&&~B.indexOf("application/json"))try{A.data=JSON.parse(A.data,l.reviver)}catch(U){return M(A,U),L(U)}(A.status>=400?L:t)(A)},typeof FormData<"u"&&q instanceof FormData||q&&"object"==typeof q&&(y["content-type"]="application/json",q=JSON.stringify(q)),A.withCredentials=!!l.withCredentials,y)A.setRequestHeader(p,y[p]);A.send(q)}))}l.r(W),l.d(W,{del:()=>k,get:()=>L,patch:()=>B,post:()=>p,put:()=>A,send:()=>t});var L=t.bind(t,"GET"),p=t.bind(t,"POST"),B=t.bind(t,"PATCH"),k=t.bind(t,"DELETE"),A=t.bind(t,"PUT")},13112:(U,W,l)=>{"use strict";l.d(W,{d:()=>y});const M=.5*(Math.sqrt(3)-1),t=(3-Math.sqrt(3))/6,L=1/3,p=1/6,B=(Math.sqrt(5)-1)/4,k=(5-Math.sqrt(5))/20,A=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),q=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const y=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const W="function"==typeof U?U:function(U){let W=0,l=0,M=0,t=1;const L=function(){let U=4022871197;return function(W){W=W.toString();for(let l=0;l<W.length;l++){U+=W.charCodeAt(l);let M=.02519603282416938*U;U=M>>>0,M-=U,M*=U,U=M>>>0,M-=U,U+=4294967296*M}return 2.3283064365386963e-10*(U>>>0)}}();W=L(" "),l=L(" "),M=L(" "),W-=L(U),W<0&&(W+=1);l-=L(U),l<0&&(l+=1);M-=L(U),M<0&&(M+=1);return function(){const U=2091639*W+2.3283064365386963e-10*t;return W=l,l=M,M=U-(t=0|U)}}(U);this.p=function(U){const W=new Uint8Array(256);for(let l=0;l<256;l++)W[l]=l;for(let l=0;l<255;l++){const M=l+~~(U()*(256-l)),t=W[l];W[l]=W[M],W[M]=t}return W}(W),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let l=0;l<512;l++)this.perm[l]=this.p[255&l],this.permMod12[l]=this.perm[l]%12}noise2D(U,W){const l=this.permMod12,L=this.perm;let p=0,B=0,k=0;const q=(U+W)*M,y=Math.floor(U+q),j=Math.floor(W+q),s=(y+j)*t,w=U-(y-s),K=W-(j-s);let r,m;w>K?(r=1,m=0):(r=0,m=1);const f=w-r+t,g=K-m+t,E=w-1+2*t,Z=K-1+2*t,N=255&y,D=255&j;let o=.5-w*w-K*K;if(o>=0){const U=3*l[N+L[D]];o*=o,p=o*o*(A[U]*w+A[U+1]*K)}let i=.5-f*f-g*g;if(i>=0){const U=3*l[N+r+L[D+m]];i*=i,B=i*i*(A[U]*f+A[U+1]*g)}let O=.5-E*E-Z*Z;if(O>=0){const U=3*l[N+1+L[D+1]];O*=O,k=O*O*(A[U]*E+A[U+1]*Z)}return 70*(p+B+k)}noise3D(U,W,l){const M=this.permMod12,t=this.perm;let B,k,q,y;const j=(U+W+l)*L,s=Math.floor(U+j),w=Math.floor(W+j),K=Math.floor(l+j),r=(s+w+K)*p,m=U-(s-r),f=W-(w-r),g=l-(K-r);let E,Z,N,D,o,i;m>=f?f>=g?(E=1,Z=0,N=0,D=1,o=1,i=0):m>=g?(E=1,Z=0,N=0,D=1,o=0,i=1):(E=0,Z=0,N=1,D=1,o=0,i=1):f<g?(E=0,Z=0,N=1,D=0,o=1,i=1):m<g?(E=0,Z=1,N=0,D=0,o=1,i=1):(E=0,Z=1,N=0,D=1,o=1,i=0);const O=m-E+p,e=f-Z+p,d=g-N+p,H=m-D+2*p,V=f-o+2*p,n=g-i+2*p,x=m-1+.5,I=f-1+.5,R=g-1+.5,F=255&s,v=255&w,J=255&K;let Q=.6-m*m-f*f-g*g;if(Q<0)B=0;else{const U=3*M[F+t[v+t[J]]];Q*=Q,B=Q*Q*(A[U]*m+A[U+1]*f+A[U+2]*g)}let G=.6-O*O-e*e-d*d;if(G<0)k=0;else{const U=3*M[F+E+t[v+Z+t[J+N]]];G*=G,k=G*G*(A[U]*O+A[U+1]*e+A[U+2]*d)}let u=.6-H*H-V*V-n*n;if(u<0)q=0;else{const U=3*M[F+D+t[v+o+t[J+i]]];u*=u,q=u*u*(A[U]*H+A[U+1]*V+A[U+2]*n)}let b=.6-x*x-I*I-R*R;if(b<0)y=0;else{const U=3*M[F+1+t[v+1+t[J+1]]];b*=b,y=b*b*(A[U]*x+A[U+1]*I+A[U+2]*R)}return 32*(B+k+q+y)}noise4D(U,W,l,M){const t=this.perm;let L,p,A,y,j;const s=(U+W+l+M)*B,w=Math.floor(U+s),K=Math.floor(W+s),r=Math.floor(l+s),m=Math.floor(M+s),f=(w+K+r+m)*k,g=U-(w-f),E=W-(K-f),Z=l-(r-f),N=M-(m-f);let D=0,o=0,i=0,O=0;g>E?D++:o++,g>Z?D++:i++,g>N?D++:O++,E>Z?o++:i++,E>N?o++:O++,Z>N?i++:O++;const e=D>=3?1:0,d=o>=3?1:0,H=i>=3?1:0,V=O>=3?1:0,n=D>=2?1:0,x=o>=2?1:0,I=i>=2?1:0,R=O>=2?1:0,F=D>=1?1:0,v=o>=1?1:0,J=i>=1?1:0,Q=O>=1?1:0,G=g-e+k,u=E-d+k,b=Z-H+k,C=N-V+k,P=g-n+2*k,S=E-x+2*k,c=Z-I+2*k,h=N-R+2*k,z=g-F+3*k,a=E-v+3*k,Y=Z-J+3*k,X=N-Q+3*k,T=g-1+4*k,UU=E-1+4*k,WU=Z-1+4*k,lU=N-1+4*k,MU=255&w,tU=255&K,LU=255&r,pU=255&m;let BU=.6-g*g-E*E-Z*Z-N*N;if(BU<0)L=0;else{const U=t[MU+t[tU+t[LU+t[pU]]]]%32*4;BU*=BU,L=BU*BU*(q[U]*g+q[U+1]*E+q[U+2]*Z+q[U+3]*N)}let kU=.6-G*G-u*u-b*b-C*C;if(kU<0)p=0;else{const U=t[MU+e+t[tU+d+t[LU+H+t[pU+V]]]]%32*4;kU*=kU,p=kU*kU*(q[U]*G+q[U+1]*u+q[U+2]*b+q[U+3]*C)}let AU=.6-P*P-S*S-c*c-h*h;if(AU<0)A=0;else{const U=t[MU+n+t[tU+x+t[LU+I+t[pU+R]]]]%32*4;AU*=AU,A=AU*AU*(q[U]*P+q[U+1]*S+q[U+2]*c+q[U+3]*h)}let qU=.6-z*z-a*a-Y*Y-X*X;if(qU<0)y=0;else{const U=t[MU+F+t[tU+v+t[LU+J+t[pU+Q]]]]%32*4;qU*=qU,y=qU*qU*(q[U]*z+q[U+1]*a+q[U+2]*Y+q[U+3]*X)}let yU=.6-T*T-UU*UU-WU*WU-lU*lU;if(yU<0)j=0;else{const U=t[MU+1+t[tU+1+t[LU+1+t[pU+1]]]]%32*4;yU*=yU,j=yU*yU*(q[U]*T+q[U+1]*UU+q[U+2]*WU+q[U+3]*lU)}return 27*(L+p+A+y+j)}}}}]);