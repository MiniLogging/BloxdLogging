"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{10211:(b,G,i)=>{i.r(G),i.d(G,{Dispose:()=>o,DumpData:()=>q,DumpDataAsync:()=>J,DumpFramebuffer:()=>Y,DumpTools:()=>s});var g=i(1563),c=i(1224),V=i(1045),z=i(1036);let E,Z=null;async function Y(b,G,i,g){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",V=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0;const E=await i.readPixels(0,0,b,G);q(b,G,new Uint8Array(E.buffer),g,c,V,!0,void 0,z)}function J(b,G,i){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4?arguments[4]:void 0,V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0;return new Promise((Z=>{q(b,G,i,(b=>Z(b)),g,c,V,z,E)}))}function q(b,G,Y,J){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",s=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8?arguments[8]:void 0;(async function(){return Z||(Z=new Promise(((b,G)=>{let c,V=null;const Z={je:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,1448)).then((Y=>{let{ThinEngine:J}=Y;try{c=new OffscreenCanvas(100,100),V=new J(c,!1,Z)}catch(s){c=document.createElement("canvas"),V=new J(c,!1,Z)}z.c.Instances.pop(),z.c.OnEnginesDisposedObservable.add((b=>{V&&b!==V&&!V.u&&0===z.c.Instances.length&&o()})),V.getCaps().parallelShaderCompile=void 0;const q=new g.c(V);i.e(32).then(i.bind(i,10915)).then((i=>{let{passPixelShader:z}=i;if(!V)return void G("Engine is not defined");const Z=new g.e({zd:V,name:z.name,fragmentShader:z.shader,samplerNames:["textureSampler"]});E={canvas:c,zd:V,renderer:q,wrapper:Z},b(E)}))})).catch(G)}))),await Z})().then((i=>{if(i.zd.setSize(b,G,!0),Y instanceof Float32Array){const b=new Uint8Array(Y.length);let G=Y.length;for(;G--;){const i=Y[G];b[G]=Math.round(255*(0,V.e)(i))}Y=b}const g=i.zd.createRawTexture(Y,b,G,5,!1,!F,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",g),i.renderer.draw(),l?c.g.ToBlob(i.canvas,(b=>{const G=new FileReader;G.onload=b=>{const G=b.target.result;J&&J(G)},G.readAsArrayBuffer(b)}),q,v):c.g.EncodeScreenshotCanvasData(i.canvas,J,q,s,v),g.dispose()}))}function o(){var b;E?(E.wrapper.dispose(),E.renderer.dispose(),E.zd.dispose()):null===(b=Z)||void 0===b||b.then((b=>{b.wrapper.dispose(),b.renderer.dispose(),b.zd.dispose()}));Z=null,E=null}const s={DumpData:q,DumpDataAsync:J,DumpFramebuffer:Y,Dispose:o};c.g.DumpData=q,c.g.DumpDataAsync=J,c.g.DumpFramebuffer=Y}}]);