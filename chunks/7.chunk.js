/*! For license information please see 1cco4t.7.5690189b.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{13128:n=>{"use strict";n.exports=function(n,k,T,c,K,Q){var G=+k[0],w=+k[1],E=+k[2],I=+T[0],S=+T[1],P=+T[2],W=Math.sqrt(I*I+S*S+P*P);if(0===W)throw new Error("Can't raycast along a zero vector");return function(n,k,T,c,K,Q,G,w,E,I){for(var S=0,P=Math.floor,W=0|P(k),J=0|P(T),H=0|P(c),s=K>0?1:-1,b=Q>0?1:-1,C=G>0?1:-1,z=Math.abs(1/K),r=Math.abs(1/Q),q=Math.abs(1/G),O=z<1/0?z*(s>0?W+1-k:k-W):1/0,u=r<1/0?r*(b>0?J+1-T:T-J):1/0,f=q<1/0?q*(C>0?H+1-c:c-H):1/0,A=-1;S<=w;){var v=n(W,J,H);if(v)return E&&(E[0]=k+S*K,E[1]=T+S*Q,E[2]=c+S*G),I&&(I[0]=I[1]=I[2]=0,0===A&&(I[0]=-s),1===A&&(I[1]=-b),2===A&&(I[2]=-C)),v;O<u?O<f?(W+=s,S=O,O+=z,A=0):(H+=C,S=f,f+=q,A=2):u<f?(J+=b,S=u,u+=r,A=1):(H+=C,S=f,f+=q,A=2)}return E&&(E[0]=k+S*K,E[1]=T+S*Q,E[2]=c+S*G),I&&(I[0]=I[1]=I[2]=0),0}(n,G,w,E,I/=W,S/=W,P/=W,c="undefined"===typeof c?64:+c,K,Q)}},13161:(n,k,T)=>{"use strict";T.d(k,{c:()=>Q});var c=T(96);function K(){this.Kl=!1,this.stopPropagation=!1,this.Ll=!1,this.disabled=!1}class Q{constructor(n,k){this.version="0.7.0";var T=Object.assign({},new K,k||{});this.element=n||document,this.Kl=!!T.Kl,this.stopPropagation=!!T.stopPropagation,this.Ll=!!T.Ll,this.disabled=!!T.disabled,this.filterEvents=(n,k)=>!0,this.down=new c.EventEmitter,this.up=new c.EventEmitter,this.state={},this.tk={dx:0,dy:0,rm:0,te:0,sm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?w(this):document.addEventListener("DOMContentLoaded",(n=>{w(this)}),{once:!0})}bind(n){for(var k=arguments.length,T=new Array(k>1?k-1:0),c=1;c<k;c++)T[c-1]=arguments[c];T.forEach((k=>{var T=this._keyBindmap[k]||[];T.includes(n)||(T.push(n),this._keyBindmap[k]=T)})),this.state[n]=!!this.state[n],this.pressCount[n]=this.pressCount[n]||0,this.releaseCount[n]=this.releaseCount[n]||0}unbind(n){for(var k in this._keyBindmap){var T=this._keyBindmap[k],c=T.indexOf(n);c>-1&&T.splice(c,1)}}getBindings(){var n={};for(var k in this._keyBindmap){this._keyBindmap[k].forEach((T=>{n[T]=n[T]||[],n[T].push(k)}))}return n}Xe(){G(this.tk),G(this.pressCount),G(this.releaseCount)}}function G(n){for(var k in n)n[k]=0}function w(n){window.addEventListener("keydown",H.bind(null,n,!0),!1),window.addEventListener("keyup",H.bind(null,n,!1),!1);var k={passive:!0};n.element.addEventListener("touchstart",P.bind(void 0,n),{passive:!1}),n.element.addEventListener("touchend",J.bind(void 0,n),k),n.element.addEventListener("mousedown",s.bind(null,n,!0),k),window.document.addEventListener("mouseup",s.bind(null,n,!1),k),n.element.addEventListener("touchmove",b.bind(null,n),k),n.element.addEventListener("mousemove",b.bind(null,n),k),window.PointerEvent,n.element.addEventListener("wheel",C.bind(null,n),k),n.element.addEventListener("contextmenu",z.bind(null,n),!1),window.addEventListener("blur",r.bind(null,n),!1)}var E=0,I=0,S=null;function P(n,k){k.preventDefault(),W(k)}function W(n){let k=!1;for(let T=0;T<n.touches.length;++T)if(n.touches[T].identifier===S){k=!0;break}if(!k){const k=n.changedTouches[0];E=k.clientX,I=k.clientY,S=k.identifier}}function J(n,k){for(var T=k.changedTouches,c=0;c<T.length;++c)T[c].identifier===S&&(S=null)}function H(n,k,T){q(T.code,k,n,T)}function s(n,k,T){if("pointerId"in T)if(k){if(null!==n._touches.currID)return;n._touches.currID=T.pointerId}else{if(n._touches.currID!==T.pointerId)return;n._touches.currID=null}return q("Mouse"+("button"in T?T.button+1:1),k,n,T),!1}function b(n,k){var T=k.movementX||k.mozMovementX||0,c=k.movementY||k.mozMovementY||0;if(k.touches&&0===(T|c)){var K=function(n){W(n);for(let k=0;k<n.changedTouches.length;++k)if(n.changedTouches[k].identifier==S){const T=n.changedTouches[k],c=[T.clientX-E,T.clientY-I];return E=T.clientX,I=T.clientY,c}return console.error(`Did not find touch id ${S}`),[0,0]}(k);T=K[0],c=K[1]}n.tk.dx+=T,n.tk.dy+=c}function C(n,k){var T=1;switch(k.deltaMode){case 0:T=1;break;case 1:T=12;break;case 2:T=n.element.clientHeight||window.innerHeight}n.tk.rm+=(k.deltaX||0)*T,n.tk.te+=(k.deltaY||0)*T,n.tk.sm+=(k.deltaZ||0)*T}function z(n,k){if(!n.Ll)return k.preventDefault(),!1}function r(n){for(var k in n._keyStates)n._keyStates[k]&&(/^Mouse\d/.test(k)||q(k,!1,n,{code:k,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function q(n,k,T,c){var K=T._keyBindmap[n];K&&(O(T._keyStates[n],k)&&(T._keyStates[n]=k,K.forEach((n=>{(!T.filterEvents||T.filterEvents(c,n))&&function(n,k,T,c){var K=k?T.pressCount:T.releaseCount;K[n]=(K[n]||0)+1;var Q=T._bindPressCount[n]||0;(Q+=k?1:-1)<0&&(Q=0);T._bindPressCount[n]=Q;var G=T.state[n];if(O(G,Q)){T.state[n]=Q>0;var w=k?T.down:T.up;T.disabled||w.emit(n,c)}}(n,k,T,c)}))),"button"in c||(T.Kl&&!c.defaultPrevented&&c.preventDefault(),T.stopPropagation&&c.stopPropagation()))}function O(n,k){return n?!k:k}},13134:(n,k,T)=>{"use strict";T.d(k,{d:()=>c});class c{constructor(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Qk=!1,this.Rk=!1,this.Fh=30,this.Pk=0,this.Yk=!1,this.fullscreen=!1,this.Tk=function(n){},this.Uk=function(){},this.Wk=function(){},this.k=function(){},this.Vk=function(n){},this.onFullscreenChanged=function(n){},I((()=>{!function(n,k){n._nowObject=performance||Date,n._lastTick=0,n._renderAccum=0,n._rt=0,n._frameCB=w.bind(null,n),requestAnimationFrame(n._frameCB),k>0&&(n._intervalCB=G.bind(null,n),n._interval=setInterval(n._intervalCB,Math.max(k,1e3/n.Fh/2)))}(this,k),function(n,k){if(!k)return;var T=!1,c=!1;document.addEventListener("pointerlockchange",(c=>{T=document.pointerLockElement===k,n.Vk(T)})),document.addEventListener("fullscreenchange",(T=>{c=document.fullscreenElement===k,n.onFullscreenChanged(c)})),Object.defineProperty(n,"Yk",{get:()=>T,set:n=>{n&&!T?E(k):T&&!n&&function(n){n.exitPointerLock&&n.exitPointerLock()}(document)}}),Object.defineProperty(n,"fullscreen",{get:()=>c,set:n=>{n&&!c?k.requestFullscreen():c&&!n&&document.exitFullscreen()}}),k.addEventListener("click",(K=>{n.Qk&&!T&&E(k),n.Rk&&!c&&k.requestFullscreen()}));var K=()=>n.k();if(window.ResizeObserver){new ResizeObserver(K).observe(k)}else window.addEventListener("resize",K)}(this,n),this.Wk()}))}}var K=3,Q=20;function G(n){for(var k=1e3/n.Fh,T=n._nowObject.now()+Q,c=0;n._nowObject.now()>=n._lastTick+k&&n._nowObject.now()<T&&++c<=K;)n.Tk(k),n._lastTick+=k;var G=5*(k+5),w=n._nowObject.now();if(w-n._lastTick>G)for(;w>=n._lastTick+k;)n._lastTick+=k}function w(n){requestAnimationFrame(n._frameCB),G(n);var k=n._nowObject.now(),T=k-n._rt;if(n._rt=k,n.Pk>0){n._renderAccum+=T;var c=1e3/n.Pk;if(n._renderAccum<c)return;n._renderAccum=Math.min(n._renderAccum-c,c)}var K=1e3/n.Fh,Q=(k-n._lastTick)/K;n.Uk(T,Q,K)}function E(n){n.requestPointerLock&&n.requestPointerLock()}var I=n=>{if("loading"===document.readyState){var k=()=>{document.removeEventListener("readystatechange",k),n()};document.addEventListener("readystatechange",k)}else setTimeout(n,1)}},13163:(n,k,T)=>{"use strict";T.d(k,{b:()=>P});var c=T(978),K=T(145);class Q{constructor(n,k,T,Q,G,w,E){this.Ih=new c(n.base,n.Jh),this.mass=k,this.friction=T,this.restitution=Q,this.yk=G,this.Qh=w,this.zk=!!E,this.wg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.jh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Kh=K.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=K.create(),this._impulses=K.create(),this._sleepFrameCount=10}loadFromCopy(n){K.i(this.Ih.base,n.Ih.base),K.i(this.Ih.Jh,n.Ih.Jh),K.i(this.Ih.max,n.Ih.max),this.Ih.mag=n.Ih.mag,this.mass=n.mass,this.friction=n.friction,this.restitution=n.restitution,this.yk=n.yk,this.Qh=n.Qh,this.zk=n.zk,this.wg=n.wg,this.fluidDrag=n.fluidDrag,this.jh=n.jh,this.preventFallOffEdge=n.preventFallOffEdge,this.rolledBackLastTick=n.rolledBackLastTick,K.i(this.Kh,n.Kh),K.i(this.resting,n.resting),this.inFluid=n.inFluid,this._ratioInFluid=n._ratioInFluid,K.i(this._forces,n._forces),K.i(this._impulses,n._impulses),this._sleepFrameCount=n._sleepFrameCount}setPosition(n){G(n),K.Fg(n,n,this.Ih.base),this.Ih.translate(n),this.Ig()}Re(){return K.clone(this.Ih.base)}applyForce(n){G(n),K.add(this._forces,this._forces,n),this.Ig()}applyImpulse(n){G(n),K.add(this._impulses,this._impulses,n),this.Ig()}Ig(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var G=n=>{};var w=T(978),E=T(145),I=T(980);function S(){this.wg=.1,this.fluidDrag=.4,this.pj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function P(n,k,T){n=Object.assign(new S,n),this.gravity=n.gravity||[0,-10,0],this.wg=n.wg||.1,this.pj=n.pj||2,this.fluidDrag=n.fluidDrag||.4,this.minBounceImpulse=n.minBounceImpulse,this.bodies=[],this.im=n.im,this.testSolid=k,this.testFluid=T}P.prototype.Bh=function(n,k,T,c,K,G){n=n||new w([0,0,0],[1,1,1]),"undefined"==typeof k&&(k=1),"undefined"==typeof T&&(T=1),"undefined"==typeof c&&(c=0),"undefined"==typeof K&&(K=1);var E=new Q(n,k,T,c,K,G);return this.bodies.push(E),E},P.prototype.Dh=function(n){var k=this.bodies.indexOf(n);k<0||(this.bodies.splice(k,1),n.Ih=n.Qh=null)};var W=E.create(),J=E.create(),H=E.create(),s=E.create(),b=E.create(),C=E.create(),z=E.create(),r=new w([0,0,0],[1,1,1]),q=new Q(r,1,1,0,1,(()=>{}),!1);function O(n,k,T){return k=T,k*=1-(1-n.ratioInFluid)**2}P.prototype.Xe=function(n){n/=1e3;var k=i(0,E.squaredLength(this.gravity));this.bodies.forEach((T=>function(n,k,T,c){E.i(b,k.resting),n.im&&q.loadFromCopy(k);if(k.mass<=0)return E.set(k.Kh,0,0,0),E.set(k._forces,0,0,0),void E.set(k._impulses,0,0,0);var K=c||0===k.yk;if(function(n,k,T,c){if(k._sleepFrameCount>0)return!1;if(c)return!0;var K=!1,Q=.5*T*T*k.yk;return E.scale(l,n.gravity,Q),I(n.testSolid,k.Ih,l,(function(){return K=!0,!0}),!0),K}(n,k,T,K))return;k._sleepFrameCount--,function(n,k){var T=k.Ih,c=Math.floor(T.base[0]),K=Math.floor(T.base[2]),Q=Math.floor(T.base[1]),G=Math.floor(T.max[1]);if(!n.testFluid(c,Q,K))return k.inFluid=!1,void(k.ratioInFluid=0);var w=1,I=Q+1;for(;I<=G&&n.testFluid(c,I,K);)w++,I++;var S=(Q+w-T.base[1])/T.Jh[1];S>1&&(S=1);var P=T.Jh[0]*T.Jh[1]*T.Jh[2]*S,W=f;E.scale(W,n.gravity,-n.pj*P*k.yk),k.applyForce(W),k.inFluid=!0,k.ratioInFluid=S}(n,k),t(k._forces),t(k._impulses),t(k.Kh),t(k.resting),E.scale(W,k._forces,1/k.mass),E.rh(W,W,n.gravity,k.yk),E.scale(J,k._impulses,1/k.mass),E.rh(J,J,W,T),E.add(k.Kh,k.Kh,J),k.friction&&(A(n,0,k,J,T),A(n,1,k,J,T),A(n,2,k,J,T));var Q=k.fluidDrag>=0?k.fluidDrag:n.fluidDrag,G=k.wg>=0?k.wg:n.wg,w=G,S=G;k.inFluid&&(w=O(k,w,k.fluidDragHoriz>=0?k.fluidDragHoriz:Q),S=O(k,S,k.fluidDragVert>=0?k.fluidDragVert:Q));w=Math.max(1-w*T/k.mass,0),S=Math.max(1-S*T/k.mass,0),E.set(u,w,S,w),E.multiply(k.Kh,k.Kh,u),E.scale(H,k.Kh,T),E.set(k._forces,0,0,0),E.set(k._impulses,0,0,0),k.zk&&B(m,k.Ih);E.i(C,H),E.set(z,0,0,0),k.preventFallOffEdge&&function(n,k,T,c){if(!k.resting[1]||T[1]>0)return;var K=Z;B(K,k.Ih);for(var Q=0;Q<3;Q+=2){E.set(Y,0,0,0),Y[Q]=T[Q];var G=!0;(G=(G=(G=(G=G&&!d(n,K.base[0]+Y[0]+1e-5,K.base[1],K.base[2]+Y[2]+1e-5))&&!d(n,K.max[0]+Y[0]-1e-5,K.base[1],K.base[2]+Y[2]+1e-5))&&!d(n,K.base[0]+Y[0]+1e-5,K.base[1],K.max[2]+Y[2]-1e-5))&&!d(n,K.max[0]+Y[0]-1e-5,K.base[1],K.max[2]+Y[2]-1e-5))?(c[Q]=T[Q]>0?1:-1,T[Q]=0):0===Q&&(E.set(e,T[0],0,0),F(n,K,e,c,k.slideOnCollision))}}(n,k,H,z);F(n,k.Ih,H,k.resting,k.slideOnCollision),k.zk&&function(n,k,T,c){if(k.resting[1]>=0&&!k.inFluid)return;var K=0!==k.resting[0],Q=0!==k.resting[2];if(!K&&!Q)return;var G=Math.abs(c[0]/c[2]),w=4;if(!K&&G>w)return;if(!Q&&G<1/w)return;E.add(g,T.base,c);var S=n.testSolid;I(S,T,c,(function(n,k,T,c){if(1!==k)return!0;c[k]=0}));var P=T.base[1],W=k.inFluid?1.951:1.001,J=Math.floor(P+W)-P;E.set(U,0,J,0);var H=!1;if(I(S,T,U,(function(n,k,T,c){return H=!0,!0})),H)return;E.Fg(V,g,T.base),V[1]=0,F(n,T,V,x,!0);var s=i(T.base[0],g[0]),b=i(T.base[2],g[2]);if(K&&!s&&(!b||!Q))return;if(Q&&(!s||!K)&&!b)return;var C=!0;if(C=C&&!d(n,T.base[0]+1e-5,T.base[1],T.base[2]+1e-5),C=C&&!d(n,T.max[0]-1e-5,T.base[1],T.base[2]+1e-5),C=C&&!d(n,T.base[0]+1e-5,T.base[1],T.max[2]-1e-5),C=C&&!d(n,T.max[0]-1e-5,T.base[1],T.max[2]-1e-5),C)return;B(k.Ih,T),k.resting[0]=x[0],k.resting[2]=x[2],k.jh&&k.jh()}(n,k,m,C);for(var P=0;P<3;++P)k.resting[P]=k.resting[P]||z[P],s[P]=0,k.resting[P]&&(b[P]||(s[P]=-k.Kh[P]),k.Kh[P]=0);var r=E.length(s);r>.001&&(E.scale(s,s,k.mass),k.Qh&&k.Qh(s),k.restitution>0&&r>n.minBounceImpulse&&(E.scale(s,s,k.restitution),k.applyImpulse(s)));var v=E.squaredLength(k.Kh);v>1e-5&&k.Ig();n.im&&n.im(k)?(k.loadFromCopy(q),k.rolledBackLastTick=!0):k.rolledBackLastTick=!1}(this,T,n,k)))};var u=E.create([0,0,0]);var f=E.create();function A(n,k,T,c,K){var Q=T.resting[k],G=c[k];if(!T.alwaysApplyHorizFriction||1!==k){if(0===Q)return;if(Q*G<=0)return}E.i(v,T.Kh),v[k]=0;var w=E.length(v);if(!i(w,0)){var I=Math.abs(T.friction*n.gravity[k]*K),S=w>I?(w-I)/w:0;T.Kh[(k+1)%3]*=S,T.Kh[(k+2)%3]*=S}}var v=E.create();function F(n,k,T,c,K){return E.set(c,0,0,0),I(n.testSolid,k,T,(function(n,k,T,Q){c[k]=T,Q[k]=0,K||(Q[0]=0,Q[1]=0,Q[2]=0)}))}var m=new w([],[]),x=E.create(),g=E.create(),U=E.create(),V=E.create();var Y=E.create(),Z=new w([],[]),e=E.create();function d(n,k,T,c){return n.testSolid(Math.floor(k),Math.floor(T-1),Math.floor(c))}var l=E.create();function i(n,k){return Math.abs(n-k)<1e-5}function B(n,k){for(var T=0;T<3;T++)n.base[T]=k.base[T],n.max[T]=k.max[T],n.Jh[T]=k.Jh[T]}var t=function(n){}},11926:function(n,k){!function(n){"use strict";var k=function(n,T){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,k){n.__proto__=k}||function(n,k){for(var T in k)Object.prototype.hasOwnProperty.call(k,T)&&(n[T]=k[T])},k(n,T)};function T(n,T){if("function"!==typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function c(){this.constructor=n}k(n,T),n.prototype=null===T?Object.create(T):(c.prototype=T.prototype,new c)}function c(n,k,T,c){var K,Q=arguments.length,G=Q<3?k:null===c?c=Object.getOwnPropertyDescriptor(k,T):c;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)G=Reflect.decorate(n,k,T,c);else for(var w=n.length-1;w>=0;w--)(K=n[w])&&(G=(Q<3?K(G):Q>3?K(k,T,G):K(k,T))||G);return Q>3&&G&&Object.defineProperty(k,T,G),G}function K(n,k,T){if(T||2===arguments.length)for(var c,K=0,Q=k.length;K<Q;K++)!c&&K in k||(c||(c=Array.prototype.slice.call(k,0,K)),c[K]=k[K]);return n.concat(c||Array.prototype.slice.call(k))}var Q,G=255,w=213;n.OPERATION=void 0,(Q=n.OPERATION||(n.OPERATION={}))[Q.ADD=128]="ADD",Q[Q.REPLACE=0]="REPLACE",Q[Q.DELETE=64]="DELETE",Q[Q.DELETE_AND_ADD=192]="DELETE_AND_ADD",Q[Q.TOUCH=1]="TOUCH",Q[Q.CLEAR=10]="CLEAR";var E=function(){function k(n,k,T){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=n,this.setParent(k,T)}return k.prototype.setParent=function(n,k,T){var c=this;if(this.indexes||(this.indexes=this.ref instanceof Vn?this.ref._definition.indexes:{}),this.parent=n,this.parentIndex=T,k)if(this.root=k,this.ref instanceof Vn){var K=this.ref._definition;for(var Q in K.schema){var G=this.ref[Q];if(G&&G.$changes){var w=K.indexes[Q];G.$changes.setParent(this.ref,k,w)}}}else"object"===typeof this.ref&&this.ref.forEach((function(n,k){if(n instanceof Vn){var T=n.$changes,K=c.ref.$changes.indexes[k];T.setParent(c.ref,c.root,K)}}))},k.prototype.operation=function(n){this.changes.set(--this.currentCustomOperation,n)},k.prototype.change=function(k,T){void 0===T&&(T=n.OPERATION.ADD);var c="number"===typeof k?k:this.indexes[k];this.assertValidIndex(c,k);var K=this.changes.get(c);K&&K.op!==n.OPERATION.DELETE&&K.op!==n.OPERATION.TOUCH||this.changes.set(c,{op:K&&K.op===n.OPERATION.DELETE?n.OPERATION.DELETE_AND_ADD:T,index:c}),this.allChanges.add(c),this.changed=!0,this.touchParents()},k.prototype.touch=function(k){var T="number"===typeof k?k:this.indexes[k];this.assertValidIndex(T,k),this.changes.has(T)||this.changes.set(T,{op:n.OPERATION.TOUCH,index:T}),this.allChanges.add(T),this.touchParents()},k.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},k.prototype.getType=function(n){if(this.ref._definition)return(k=this.ref._definition).schema[k.fieldsByIndex[n]];var k,T=(k=this.parent._definition).schema[k.fieldsByIndex[this.parentIndex]];return Object.values(T)[0]},k.prototype.getChildrenFilter=function(){var n=this.parent._definition.childFilters;return n&&n[this.parentIndex]},k.prototype.getValue=function(n){return this.ref.getByIndex(n)},k.prototype.delete=function(k){var T="number"===typeof k?k:this.indexes[k];if(void 0!==T){var c=this.getValue(T);this.changes.set(T,{op:n.OPERATION.DELETE,index:T}),this.allChanges.delete(T),delete this.caches[T],c&&c.$changes&&(c.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(k," (").concat(T,")"))},k.prototype.discard=function(k,T){var c=this;void 0===k&&(k=!1),void 0===T&&(T=!1),this.ref instanceof Vn||this.changes.forEach((function(k){if(k.op===n.OPERATION.DELETE){var T=c.ref.getIndex(k.index);delete c.indexes[T]}})),this.changes.clear(),this.changed=k,T&&this.allChanges.clear(),this.currentCustomOperation=0},k.prototype.discardAll=function(){var n=this;this.changes.forEach((function(k){var T=n.getValue(k.index);T&&T.$changes&&T.$changes.discardAll()})),this.discard()},k.prototype.cache=function(n,k){this.caches[n]=k},k.prototype.clone=function(){return new k(this.ref,this.parent,this.root)},k.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},k.prototype.assertValidIndex=function(n,k){if(void 0===n)throw new Error('ChangeTree: missing index for field "'.concat(k,'"'))},k}();function I(n,k,T,c){return n[k]||(n[k]=[]),n[k].push(T),null===c||void 0===c||c.forEach((function(n,k){return T(n,k)})),function(){return P(n[k],n[k].indexOf(T))}}function S(k){var T=this,c="string"!==typeof this.$changes.getType();this.$items.forEach((function(K,Q){k.push({refId:T.$changes.refId,op:n.OPERATION.DELETE,field:Q,value:void 0,previousValue:K}),c&&T.$changes.root.removeRef(K.$changes.refId)}))}function P(n,k){if(-1===k||k>=n.length)return!1;for(var T=n.length-1,c=k;c<T;c++)n[c]=n[c+1];return n.length=T,!0}var W=function(n,k){var T=n.toString(),c=k.toString();return T<c?-1:T>c?1:0};function J(n){return n.$proxy=!0,n=new Proxy(n,{get:function(n,k){return"symbol"===typeof k||isNaN(k)?n[k]:n.at(k)},set:function(n,k,T){if("symbol"===typeof k||isNaN(k))n[k]=T;else{var c=Array.from(n.$items.keys()),K=parseInt(c[k]||k);void 0===T||null===T?n.deleteAt(K):n.setAt(K,T)}return!0},deleteProperty:function(n,k){return"number"===typeof k?n.deleteAt(k):delete n[k],!0}})}var H=function(){function k(){for(var n=[],k=0;k<arguments.length;k++)n[k]=arguments[k];this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,n)}return k.prototype.nh=function(k,T){return void 0===T&&(T=!0),I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,k,T?this.$items:void 0)},k.prototype.kh=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,k)},k.is=function(n){return Array.isArray(n)||void 0!==n.array},Object.defineProperty(k.prototype,"length",{get:function(){return this.$items.size},set:function(n){0===n?this.clear():this.splice(n,this.length-n)},enumerable:!1,configurable:!0}),k.prototype.push=function(){for(var n,k=this,T=[],c=0;c<arguments.length;c++)T[c]=arguments[c];return T.forEach((function(T){n=k.$refId++,k.setAt(n,T)})),n},k.prototype.pop=function(){var n=Array.from(this.$indexes.values()).pop();if(void 0!==n){this.$changes.delete(n),this.$indexes.delete(n);var k=this.$items.get(n);return this.$items.delete(n),k}},k.prototype.at=function(n){var k=Array.from(this.$items.keys())[n];return this.$items.get(k)},k.prototype.setAt=function(k,T){var c,K;if(void 0!==T&&null!==T){if(this.$items.get(k)!==T){void 0!==T.$changes&&T.$changes.setParent(this,this.$changes.root,k);var Q=null!==(K=null===(c=this.$changes.indexes[k])||void 0===c?void 0:c.op)&&void 0!==K?K:n.OPERATION.ADD;this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,T),this.$changes.change(k,Q)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},k.prototype.deleteAt=function(n){var k=Array.from(this.$items.keys())[n];return void 0!==k&&this.$deleteAt(k)},k.prototype.$deleteAt=function(n){return this.$changes.delete(n),this.$indexes.delete(n),this.$items.delete(n)},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&S.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.concat=function(){for(var n,T=[],c=0;c<arguments.length;c++)T[c]=arguments[c];return new(k.bind.apply(k,K([void 0],(n=Array.from(this.$items.values())).concat.apply(n,T),!1)))},k.prototype.join=function(n){return Array.from(this.$items.values()).join(n)},k.prototype.reverse=function(){var n=this,k=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(T,c){n.setAt(k[c],T)})),this},k.prototype.shift=function(){var n=Array.from(this.$items.keys()).shift();if(void 0!==n){var k=this.$items.get(n);return this.$deleteAt(n),k}},k.prototype.slice=function(n,T){var c=new k;return c.push.apply(c,Array.from(this.$items.values()).slice(n,T)),c},k.prototype.sort=function(n){var k=this;void 0===n&&(n=W);var T=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(n).forEach((function(n,c){k.setAt(T[c],n)})),this},k.prototype.splice=function(n,k){void 0===k&&(k=this.length-n);for(var T=Array.from(this.$items.keys()),c=[],K=n;K<n+k;K++)c.push(this.$items.get(T[K])),this.$deleteAt(T[K]);return c},k.prototype.unshift=function(){for(var n=this,k=[],T=0;T<arguments.length;T++)k[T]=arguments[T];var c=this.length,K=k.length,Q=Array.from(this.$items.values());return k.forEach((function(k,T){n.setAt(T,k)})),Q.forEach((function(k,T){n.setAt(K+T,k)})),c+K},k.prototype.indexOf=function(n,k){return Array.from(this.$items.values()).indexOf(n,k)},k.prototype.lastIndexOf=function(n,k){return void 0===k&&(k=this.length-1),Array.from(this.$items.values()).lastIndexOf(n,k)},k.prototype.every=function(n,k){return Array.from(this.$items.values()).every(n,k)},k.prototype.some=function(n,k){return Array.from(this.$items.values()).some(n,k)},k.prototype.forEach=function(n,k){Array.from(this.$items.values()).forEach(n,k)},k.prototype.map=function(n,k){return Array.from(this.$items.values()).map(n,k)},k.prototype.filter=function(n,k){return Array.from(this.$items.values()).filter(n,k)},k.prototype.reduce=function(n,k){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},k.prototype.reduceRight=function(n,k){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},k.prototype.find=function(n,k){return Array.from(this.$items.values()).find(n,k)},k.prototype.findIndex=function(n,k){return Array.from(this.$items.values()).findIndex(n,k)},k.prototype.fill=function(n,k,T){throw new Error("ArraySchema#fill() not implemented")},k.prototype.copyWithin=function(n,k,T){throw new Error("ArraySchema#copyWithin() not implemented")},k.prototype.toString=function(){return this.$items.toString()},k.prototype.toLocaleString=function(){return this.$items.toLocaleString()},k.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(k,Symbol.species,{get:function(){return k},enumerable:!1,configurable:!0}),k.prototype.entries=function(){return this.$items.entries()},k.prototype.keys=function(){return this.$items.keys()},k.prototype.values=function(){return this.$items.values()},k.prototype.includes=function(n,k){return Array.from(this.$items.values()).includes(n,k)},k.prototype.flatMap=function(n,k){throw new Error("ArraySchema#flatMap() is not supported.")},k.prototype.flat=function(n){throw new Error("ArraySchema#flat() is not supported.")},k.prototype.findLast=function(){var n=Array.from(this.$items.values());return n.findLast.apply(n,arguments)},k.prototype.findLastIndex=function(){var n=Array.from(this.$items.values());return n.findLastIndex.apply(n,arguments)},k.prototype.setIndex=function(n,k){this.$indexes.set(n,k)},k.prototype.getIndex=function(n){return this.$indexes.get(n)},k.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},k.prototype.deleteByIndex=function(n){var k=this.$indexes.get(n);this.$items.delete(k),this.$indexes.delete(n)},k.prototype.toArray=function(){return Array.from(this.$items.values())},k.prototype.toJSON=function(){return this.toArray().map((function(n){return"function"===typeof n.toJSON?n.toJSON():n}))},k.prototype.clone=function(n){return n?new(k.bind.apply(k,K([void 0],Array.from(this.$items.values()),!1))):new(k.bind.apply(k,K([void 0],this.map((function(n){return n.$changes?n.clone():n})),!1)))},k}();function s(n){return n.$proxy=!0,n=new Proxy(n,{get:function(n,k){return"symbol"!==typeof k&&"undefined"===typeof n[k]?n.get(k):n[k]},set:function(n,k,T){return"symbol"!==typeof k&&-1===k.indexOf("$")&&"nh"!==k&&"kh"!==k&&"onChange"!==k?n.set(k,T):n[k]=T,!0},deleteProperty:function(n,k){return n.delete(k),!0}})}var b=function(){function k(n){var T=this;if(this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,n)if(n instanceof Map||n instanceof k)n.forEach((function(n,k){return T.set(k,n)}));else for(var c in n)this.set(c,n[c])}return k.prototype.nh=function(k,T){return void 0===T&&(T=!0),I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,k,T?this.$items:void 0)},k.prototype.kh=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,k)},k.is=function(n){return void 0!==n.map},k.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(k.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(k,Symbol.species,{get:function(){return k},enumerable:!1,configurable:!0}),k.prototype.set=function(k,T){if(void 0===T||null===T)throw new Error("MapSchema#set('".concat(k,"', ").concat(T,"): trying to set ").concat(T," value on '").concat(k,"'."));k=k.toString();var c="undefined"!==typeof this.$changes.indexes[k],K=c?this.$changes.indexes[k]:this.$refId++,Q=c?n.OPERATION.REPLACE:n.OPERATION.ADD,G=void 0!==T.$changes;if(G&&T.$changes.setParent(this,this.$changes.root,K),c){if(!G&&this.$items.get(k)===T)return;G&&this.$items.get(k)!==T&&(Q=n.OPERATION.ADD)}else this.$changes.indexes[k]=K,this.$indexes.set(K,k);return this.$items.set(k,T),this.$changes.change(k,Q),this},k.prototype.get=function(n){return this.$items.get(n)},k.prototype.delete=function(n){return this.$changes.delete(n),this.$items.delete(n)},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&S.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.has=function(n){return this.$items.has(n)},k.prototype.forEach=function(n){this.$items.forEach(n)},k.prototype.entries=function(){return this.$items.entries()},k.prototype.keys=function(){return this.$items.keys()},k.prototype.values=function(){return this.$items.values()},Object.defineProperty(k.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),k.prototype.setIndex=function(n,k){this.$indexes.set(n,k)},k.prototype.getIndex=function(n){return this.$indexes.get(n)},k.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},k.prototype.deleteByIndex=function(n){var k=this.$indexes.get(n);this.$items.delete(k),this.$indexes.delete(n)},k.prototype.toJSON=function(){var n={};return this.forEach((function(k,T){n[T]="function"===typeof k.toJSON?k.toJSON():k})),n},k.prototype.clone=function(n){var T;return n?T=Object.assign(new k,this):(T=new k,this.forEach((function(n,k){n.$changes?T.set(k,n.clone()):T.set(k,n)}))),T},k}(),C={};function z(n,k){C[n]=k}function r(n){return C[n]}var q=function(){function n(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return n.create=function(k){var T=new n;return T.schema=Object.assign({},k&&k.schema||{}),T.indexes=Object.assign({},k&&k.indexes||{}),T.fieldsByIndex=Object.assign({},k&&k.fieldsByIndex||{}),T.descriptors=Object.assign({},k&&k.descriptors||{}),T.deprecated=Object.assign({},k&&k.deprecated||{}),T},n.prototype.addField=function(n,k){var T=this.getNextFieldIndex();this.fieldsByIndex[T]=n,this.indexes[n]=T,this.schema[n]=Array.isArray(k)?{array:k[0]}:k},n.prototype.hasField=function(n){return void 0!==this.indexes[n]},n.prototype.addFilter=function(n,k){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[n]]=k,this.indexesWithFilters.push(this.indexes[n]),!0},n.prototype.addChildrenFilter=function(n,k){var T=this.indexes[n],c=this.schema[n];if(r(Object.keys(c)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[T]=k,!0;console.warn("@filterChildren: field '".concat(n,"' can't have children. Ignoring filter."))},n.prototype.getChildrenFilter=function(n){return this.childFilters&&this.childFilters[this.indexes[n]]},n.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},n}();function O(n){return n._context&&n._context.useFilters}var u=function(){function n(){this.types={},this.schemas=new Map,this.useFilters=!1}return n.prototype.has=function(n){return this.schemas.has(n)},n.prototype.get=function(n){return this.types[n]},n.prototype.add=function(n,k){void 0===k&&(k=this.schemas.size),n._definition=q.create(n._definition),n._typeid=k,this.types[k]=n,this.schemas.set(n,k)},n.create=function(k){return void 0===k&&(k={}),function(T){return k.context||(k.context=new n),A(T,k)}},n}(),f=new u;function A(n,k){return void 0===k&&(k={}),function(T,c){var Q=k.context||f,G=T.constructor;if(G._context=Q,!n)throw new Error("".concat(G.name,': @type() reference provided for "').concat(c,"\" is undefined. Make sure you don't have any circular dependencies."));Q.has(G)||Q.add(G);var w=G._definition;if(w.addField(c,n),w.descriptors[c]){if(w.deprecated[c])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(c,"' definition on '").concat(G.name,"'.\nCheck @type() annotation"))}catch(C){var E=C.stack.split("\n")[4].trim();throw new Error("".concat(C.message," ").concat(E))}}var I=H.is(n),S=!I&&b.is(n);if("string"!==typeof n&&!Vn.is(n)){var P=Object.values(n)[0];"string"===typeof P||Q.has(P)||Q.add(P)}if(k.manual)w.descriptors[c]={enumerable:!0,configurable:!0,writable:!0};else{var W="_".concat(c);w.descriptors[W]={enumerable:!1,configurable:!1,writable:!0},w.descriptors[c]={get:function(){return this[W]},set:function(n){n!==this[W]&&(void 0!==n&&null!==n?(!I||n instanceof H||(n=new(H.bind.apply(H,K([void 0],n,!1)))),!S||n instanceof b||(n=new b(n)),void 0===n.$proxy&&(S?n=s(n):I&&(n=J(n))),this.$changes.change(c),n.$changes&&n.$changes.setParent(this,this.$changes.root,this._definition.indexes[c])):this[W]&&this.$changes.delete(c),this[W]=n)},enumerable:!0,configurable:!0}}}}function v(n){return function(k,T){var c=k.constructor;c._definition.addFilter(T,n)&&(c._context.useFilters=!0)}}function F(n){return function(k,T){var c=k.constructor;c._definition.addChildrenFilter(T,n)&&(c._context.useFilters=!0)}}function m(n){return void 0===n&&(n=!0),function(k,T){var c=k.constructor._definition;c.deprecated[T]=!0,n&&(c.descriptors[T]={get:function(){throw new Error("".concat(T," is deprecated."))},set:function(n){},enumerable:!1,configurable:!0})}}function x(n,k,T){for(var c in void 0===T&&(T={}),T.context||(T.context=n._context||T.context||f),k)A(k[c],T)(n.prototype,c);return n}function g(n){for(var k=0,T=0,c=0,K=n.length;c<K;c++)(k=n.charCodeAt(c))<128?T+=1:k<2048?T+=2:k<55296||k>=57344?T+=3:(c++,T+=4);return T}function U(n,k,T){for(var c=0,K=0,Q=T.length;K<Q;K++)(c=T.charCodeAt(K))<128?n[k++]=c:c<2048?(n[k++]=192|c>>6,n[k++]=128|63&c):c<55296||c>=57344?(n[k++]=224|c>>12,n[k++]=128|c>>6&63,n[k++]=128|63&c):(K++,c=65536+((1023&c)<<10|1023&T.charCodeAt(K)),n[k++]=240|c>>18,n[k++]=128|c>>12&63,n[k++]=128|c>>6&63,n[k++]=128|63&c)}function V(n,k){n.push(255&k)}function Y(n,k){n.push(255&k)}function Z(n,k){n.push(255&k),n.push(k>>8&255)}function e(n,k){n.push(255&k),n.push(k>>8&255)}function d(n,k){n.push(255&k),n.push(k>>8&255),n.push(k>>16&255),n.push(k>>24&255)}function l(n,k){var T=k>>24,c=k>>16,K=k>>8,Q=k;n.push(255&Q),n.push(255&K),n.push(255&c),n.push(255&T)}function i(n,k){var T=Math.floor(k/Math.pow(2,32));l(n,k>>>0),l(n,T)}function B(n,k){var T=k/Math.pow(2,32)|0;l(n,k>>>0),l(n,T)}function t(n,k){L(n,k)}function M(n,k){h(n,k)}var o=new Int32Array(2),D=new Float32Array(o.buffer),R=new Float64Array(o.buffer);function L(n,k){D[0]=k,d(n,o[0])}function h(n,k){R[0]=k,d(n,o[0]),d(n,o[1])}function j(n,k){return Y(n,k?1:0)}function p(n,k){k||(k="");var T=g(k),c=0;if(T<32)n.push(160|T),c=1;else if(T<256)n.push(217),Y(n,T),c=2;else if(T<65536)n.push(218),e(n,T),c=3;else{if(!(T<4294967296))throw new Error("String too long");n.push(219),l(n,T),c=5}return U(n,n.length,k),c+T}function a(n,k){return isNaN(k)?a(n,0):isFinite(k)?k!==(0|k)?(n.push(203),h(n,k),9):k>=0?k<128?(Y(n,k),1):k<256?(n.push(204),Y(n,k),2):k<65536?(n.push(205),e(n,k),3):k<4294967296?(n.push(206),l(n,k),5):(n.push(207),B(n,k),9):k>=-32?(n.push(224|k+32),1):k>=-128?(n.push(208),V(n,k),2):k>=-32768?(n.push(209),Z(n,k),3):k>=-2147483648?(n.push(210),d(n,k),5):(n.push(211),i(n,k),9):a(n,k>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var X=Object.freeze({__proto__:null,utf8Write:U,int8:V,uint8:Y,int16:Z,uint16:e,int32:d,uint32:l,int64:i,uint64:B,float32:t,float64:M,writeFloat32:L,writeFloat64:h,boolean:j,string:p,number:a});function y(n,k,T){for(var c="",K=0,Q=k,G=k+T;Q<G;Q++){var w=n[Q];0!==(128&w)?192!==(224&w)?224!==(240&w)?240!==(248&w)?console.error("Invalid byte "+w.toString(16)):(K=(7&w)<<18|(63&n[++Q])<<12|(63&n[++Q])<<6|63&n[++Q])>=65536?(K-=65536,c+=String.fromCharCode(55296+(K>>>10),56320+(1023&K))):c+=String.fromCharCode(K):c+=String.fromCharCode((15&w)<<12|(63&n[++Q])<<6|63&n[++Q]):c+=String.fromCharCode((31&w)<<6|63&n[++Q]):c+=String.fromCharCode(w)}return c}function N(n,k){return nn(n,k)<<24>>24}function nn(n,k){return n[k.offset++]}function kn(n,k){return Tn(n,k)<<16>>16}function Tn(n,k){return n[k.offset++]|n[k.offset++]<<8}function cn(n,k){return n[k.offset++]|n[k.offset++]<<8|n[k.offset++]<<16|n[k.offset++]<<24}function Kn(n,k){return cn(n,k)>>>0}function Qn(n,k){return Wn(n,k)}function Gn(n,k){return Jn(n,k)}function wn(n,k){var T=Kn(n,k);return cn(n,k)*Math.pow(2,32)+T}function En(n,k){var T=Kn(n,k);return Kn(n,k)*Math.pow(2,32)+T}var In=new Int32Array(2),Sn=new Float32Array(In.buffer),Pn=new Float64Array(In.buffer);function Wn(n,k){return In[0]=cn(n,k),Sn[0]}function Jn(n,k){return In[0]=cn(n,k),In[1]=cn(n,k),Pn[0]}function Hn(n,k){return nn(n,k)>0}function sn(n,k){var T,c=n[k.offset++];c<192?T=31&c:217===c?T=nn(n,k):218===c?T=Tn(n,k):219===c&&(T=Kn(n,k));var K=y(n,k.offset,T);return k.offset+=T,K}function bn(n,k){var T=n[k.offset];return T<192&&T>160||217===T||218===T||219===T}function Cn(n,k){var T=n[k.offset++];return T<128?T:202===T?Wn(n,k):203===T?Jn(n,k):204===T?nn(n,k):205===T?Tn(n,k):206===T?Kn(n,k):207===T?En(n,k):208===T?N(n,k):209===T?kn(n,k):210===T?cn(n,k):211===T?wn(n,k):T>223?-1*(255-T+1):void 0}function zn(n,k){var T=n[k.offset];return T<128||T>=202&&T<=211}function rn(n,k){return n[k.offset]<160}function qn(n,k){return n[k.offset-1]===G&&(n[k.offset]<128||n[k.offset]>=202&&n[k.offset]<=211)}var On=Object.freeze({__proto__:null,int8:N,uint8:nn,int16:kn,uint16:Tn,int32:cn,uint32:Kn,float32:Qn,float64:Gn,int64:wn,uint64:En,readFloat32:Wn,readFloat64:Jn,boolean:Hn,string:sn,stringCheck:bn,number:Cn,numberCheck:zn,arrayCheck:rn,switchStructureCheck:qn}),un=function(){function k(n){var k=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,n&&n.forEach((function(n){return k.add(n)}))}return k.prototype.nh=function(k,T){return void 0===T&&(T=!0),I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,k,T?this.$items:void 0)},k.prototype.kh=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,k)},k.is=function(n){return void 0!==n.collection},k.prototype.add=function(n){var k=this.$refId++;return void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,k),this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,n),this.$changes.change(k),k},k.prototype.at=function(n){var k=Array.from(this.$items.keys())[n];return this.$items.get(k)},k.prototype.entries=function(){return this.$items.entries()},k.prototype.delete=function(n){for(var k,T,c=this.$items.entries();(T=c.next())&&!T.done;)if(n===T.value[1]){k=T.value[0];break}return void 0!==k&&(this.$changes.delete(k),this.$indexes.delete(k),this.$items.delete(k))},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&S.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.has=function(n){return Array.from(this.$items.values()).some((function(k){return k===n}))},k.prototype.forEach=function(n){var k=this;this.$items.forEach((function(T,c,K){return n(T,c,k)}))},k.prototype.values=function(){return this.$items.values()},Object.defineProperty(k.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),k.prototype.setIndex=function(n,k){this.$indexes.set(n,k)},k.prototype.getIndex=function(n){return this.$indexes.get(n)},k.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},k.prototype.deleteByIndex=function(n){var k=this.$indexes.get(n);this.$items.delete(k),this.$indexes.delete(n)},k.prototype.toArray=function(){return Array.from(this.$items.values())},k.prototype.toJSON=function(){var n=[];return this.forEach((function(k,T){n.push("function"===typeof k.toJSON?k.toJSON():k)})),n},k.prototype.clone=function(n){var T;return n?T=Object.assign(new k,this):(T=new k,this.forEach((function(n){n.$changes?T.add(n.clone()):T.add(n)}))),T},k}(),fn=function(){function k(n){var k=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,n&&n.forEach((function(n){return k.add(n)}))}return k.prototype.nh=function(k,T){return void 0===T&&(T=!0),I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,k,T?this.$items:void 0)},k.prototype.kh=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,k)},k.prototype.onChange=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,k)},k.is=function(n){return void 0!==n.set},k.prototype.add=function(k){var T,c;if(this.has(k))return!1;var K=this.$refId++;void 0!==k.$changes&&k.$changes.setParent(this,this.$changes.root,K);var Q=null!==(c=null===(T=this.$changes.indexes[K])||void 0===T?void 0:T.op)&&void 0!==c?c:n.OPERATION.ADD;return this.$changes.indexes[K]=K,this.$indexes.set(K,K),this.$items.set(K,k),this.$changes.change(K,Q),K},k.prototype.entries=function(){return this.$items.entries()},k.prototype.delete=function(n){for(var k,T,c=this.$items.entries();(T=c.next())&&!T.done;)if(n===T.value[1]){k=T.value[0];break}return void 0!==k&&(this.$changes.delete(k),this.$indexes.delete(k),this.$items.delete(k))},k.prototype.clear=function(k){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),k&&S.call(this,k),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},k.prototype.has=function(n){for(var k,T=this.$items.values(),c=!1;(k=T.next())&&!k.done;)if(n===k.value){c=!0;break}return c},k.prototype.forEach=function(n){var k=this;this.$items.forEach((function(T,c,K){return n(T,c,k)}))},k.prototype.values=function(){return this.$items.values()},Object.defineProperty(k.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),k.prototype.setIndex=function(n,k){this.$indexes.set(n,k)},k.prototype.getIndex=function(n){return this.$indexes.get(n)},k.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},k.prototype.deleteByIndex=function(n){var k=this.$indexes.get(n);this.$items.delete(k),this.$indexes.delete(n)},k.prototype.toArray=function(){return Array.from(this.$items.values())},k.prototype.toJSON=function(){var n=[];return this.forEach((function(k,T){n.push("function"===typeof k.toJSON?k.toJSON():k)})),n},k.prototype.clone=function(n){var T;return n?T=Object.assign(new k,this):(T=new k,this.forEach((function(n){n.$changes?T.add(n.clone()):T.add(n)}))),T},k}(),An=function(){function n(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return n.prototype.addRefId=function(n){this.refIds.has(n)||(this.refIds.add(n),this.containerIndexes.set(n,new Set))},n.get=function(k){return void 0===k.$filterState&&(k.$filterState=new n),k.$filterState},n}(),vn=function(){function n(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return n.prototype.getNextUniqueId=function(){return this.nextUniqueId++},n.prototype.addRef=function(n,k,T){void 0===T&&(T=!0),this.refs.set(n,k),T&&(this.refCounts[n]=(this.refCounts[n]||0)+1)},n.prototype.removeRef=function(n){this.refCounts[n]=this.refCounts[n]-1,this.deletedRefs.add(n)},n.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},n.prototype.garbageCollectDeletedRefs=function(){var n=this;this.deletedRefs.forEach((function(k){if(!(n.refCounts[k]>0)){var T=n.refs.get(k);if(T instanceof Vn)for(var c in T._definition.schema)"string"!==typeof T._definition.schema[c]&&T[c]&&T[c].$changes&&n.removeRef(T[c].$changes.refId);else{var K=T.$changes.parent._definition,Q=K.schema[K.fieldsByIndex[T.$changes.parentIndex]];"function"===typeof Object.values(Q)[0]&&Array.from(T.values()).forEach((function(k){return n.removeRef(k.$changes.refId)}))}n.refs.delete(k),delete n.refCounts[k]}})),this.deletedRefs.clear()},n}(),Fn=function(n){function k(){return null!==n&&n.apply(this,arguments)||this}return T(k,n),k}(Error);function mn(n,k,T,c){var K,Q=!1;switch(k){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":K="number",isNaN(n)&&console.log('trying to encode "NaN" in '.concat(T.constructor.name,"#").concat(c));break;case"string":K="string",Q=!0;break;case"boolean":return}if(typeof n!==K&&(!Q||Q&&null!==n)){var G="'".concat(JSON.stringify(n),"'").concat(n&&n.constructor&&" (".concat(n.constructor.name,")")||"");throw new Fn("a '".concat(K,"' was expected, but ").concat(G," was provided in ").concat(T.constructor.name,"#").concat(c))}}function xn(n,k,T,c){if(!(n instanceof k))throw new Fn("a '".concat(k.name,"' was expected, but '").concat(n.constructor.name,"' was provided in ").concat(T.constructor.name,"#").concat(c))}function gn(n,k,T,c,K){mn(T,n,c,K);var Q=X[n];if(!Q)throw new Fn("a '".concat(n,"' was expected, but ").concat(T," was provided in ").concat(c.constructor.name,"#").concat(K));Q(k,T)}function Un(n,k,T){return On[n](k,T)}var Vn=function(){function k(){for(var n=[],k=0;k<arguments.length;k++)n[k]=arguments[k];Object.defineProperties(this,{$changes:{value:new E(this,void 0,new vn),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var T=this._definition.descriptors;T&&Object.defineProperties(this,T),n[0]&&this.assign(n[0])}return k.onError=function(n){console.error(n)},k.is=function(n){return n._definition&&void 0!==n._definition.schema},k.prototype.onChange=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,k)},k.prototype.kh=function(k){return I(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,k)},k.prototype.assign=function(n){return Object.assign(this,n),this},Object.defineProperty(k.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),k.prototype.setDirty=function(n,k){this.$changes.change(n,k)},k.prototype.listen=function(n,k,T){var c=this;return void 0===T&&(T=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[n]||(this.$callbacks[n]=[]),this.$callbacks[n].push(k),T&&void 0!==this[n]&&k(this[n],void 0),function(){return P(c.$callbacks[n],c.$callbacks[n].indexOf(k))}},k.prototype.decode=function(T,c,K){var Q;void 0===c&&(c={offset:0}),void 0===K&&(K=this);var w=[],E=this.$changes.root,I=T.length,S=0;for(E.refs.set(S,this);c.offset<I;){var P=T[c.offset++];if(P!=G){var W=K.$changes,J=void 0!==K._definition,s=J?P>>6<<6:P;if(s!==n.OPERATION.CLEAR){var C=J?P%(s||255):Cn(T,c),z=J?K._definition.fieldsByIndex[C]:"",q=W.getType(C),O=void 0,u=void 0,f=void 0;if(J?u=K["_".concat(z)]:(u=K.getByIndex(C),(s&n.OPERATION.ADD)===n.OPERATION.ADD?(f=K instanceof b?sn(T,c):C,K.setIndex(C,f)):f=K.getIndex(C)),(s&n.OPERATION.DELETE)===n.OPERATION.DELETE&&(s!==n.OPERATION.DELETE_AND_ADD&&K.deleteByIndex(C),u&&u.$changes&&E.removeRef(u.$changes.refId),O=null),void 0!==z){if(s===n.OPERATION.DELETE);else if(k.is(q)){var A=Cn(T,c);if(O=E.refs.get(A),s!==n.OPERATION.REPLACE){var v=this.getSchemaType(T,c,q);O||((O=this.createTypeInstance(v)).$changes.refId=A,u&&(O.$callbacks=u.$callbacks,u.$changes.refId&&A!==u.$changes.refId&&E.removeRef(u.$changes.refId))),E.addRef(A,O,O!==u)}}else if("string"===typeof q)O=Un(q,T,c);else{var F=r(Object.keys(q)[0]),m=Cn(T,c),x=E.refs.has(m)?u||E.refs.get(m):new F.constructor;if((O=x.clone(!0)).$changes.refId=m,u&&(O.$callbacks=u.$callbacks,u.$changes.refId&&m!==u.$changes.refId)){E.removeRef(u.$changes.refId);for(var g=u.entries(),U=void 0;(U=g.next())&&!U.done;){var V=(Q=U.value)[0],Y=Q[1];w.push({refId:m,op:n.OPERATION.DELETE,field:V,value:void 0,previousValue:Y})}}E.addRef(m,O,x!==u)}if(null!==O&&void 0!==O)if(O.$changes&&O.$changes.setParent(W.ref,W.root,C),K instanceof k)K[z]=O;else if(K instanceof b)V=f,K.$items.set(V,O),K.$changes.allChanges.add(C);else if(K instanceof H)K.setAt(C,O);else if(K instanceof un){var Z=K.add(O);K.setIndex(C,Z)}else K instanceof fn&&!1!==(Z=K.add(O))&&K.setIndex(C,Z);u!==O&&w.push({refId:S,op:s,field:z,dynamicIndex:f,value:O,previousValue:u})}else{console.warn("@colyseus/schema: definition mismatch");for(var e={offset:c.offset};c.offset<I&&(!qn(T,c)||(e.offset=c.offset+1,!E.refs.has(Cn(T,e))));)c.offset++}}else K.clear(w)}else{S=Cn(T,c);var d=E.refs.get(S);if(!d)throw new Error('"refId" not found: '.concat(S));K=d}}return this._triggerChanges(w),E.garbageCollectDeletedRefs(),w},k.prototype.encode=function(T,c,K){void 0===T&&(T=!1),void 0===c&&(c=[]),void 0===K&&(K=!1);for(var Q=this.$changes,w=new WeakSet,E=[Q],I=1,S=0;S<I;S++){var P=E[S],W=P.ref,J=W instanceof k;P.ensureRefId(),w.add(P),P!==Q&&(P.changed||T)&&(Y(c,G),a(c,P.refId));for(var H=T?Array.from(P.allChanges):Array.from(P.changes.values()),s=0,C=H.length;s<C;s++){var z=T?{op:n.OPERATION.ADD,index:H[s]}:H[s],q=z.index,O=J?W._definition.fieldsByIndex&&W._definition.fieldsByIndex[q]:q,u=c.length;if(z.op!==n.OPERATION.TOUCH)if(J)Y(c,q|z.op);else{if(Y(c,z.op),z.op===n.OPERATION.CLEAR)continue;a(c,q)}if(J||(z.op&n.OPERATION.ADD)!=n.OPERATION.ADD||W instanceof b&&p(c,P.ref.$indexes.get(q)),z.op!==n.OPERATION.DELETE){var f=P.getType(q),A=P.getValue(q);if(A&&A.$changes&&!w.has(A.$changes)&&(E.push(A.$changes),A.$changes.ensureRefId(),I++),z.op!==n.OPERATION.TOUCH){if(k.is(f))xn(A,f,W,O),a(c,A.$changes.refId),(z.op&n.OPERATION.ADD)===n.OPERATION.ADD&&this.tryEncodeTypeId(c,f,A.constructor);else if("string"===typeof f)gn(f,c,A,W,O);else{var v=r(Object.keys(f)[0]);xn(W["_".concat(O)],v.constructor,W,O),a(c,A.$changes.refId)}K&&P.cache(q,c.slice(u))}}}T||K||P.discard()}return c},k.prototype.encodeAll=function(n){return this.encode(!0,[],n)},k.prototype.applyFilters=function(T,c){var K,Q;void 0===c&&(c=!1);for(var w=this,E=new Set,I=An.get(T),S=[this.$changes],P=1,W=[],J=function(J){var H=S[J];if(E.has(H.refId))return"continue";var s=H.ref,C=s instanceof k;Y(W,G),a(W,H.refId);var z=I.refIds.has(H),r=c||!z;I.addRefId(H);var q=I.containerIndexes.get(H),O=r?Array.from(H.allChanges):Array.from(H.changes.values());!c&&C&&s._definition.indexesWithFilters&&s._definition.indexesWithFilters.forEach((function(k){!q.has(k)&&H.allChanges.has(k)&&(r?O.push(k):O.push({op:n.OPERATION.ADD,index:k}))}));for(var u=0,f=O.length;u<f;u++){var A=r?{op:n.OPERATION.ADD,index:O[u]}:O[u];if(A.op!==n.OPERATION.CLEAR){var v=A.index;if(A.op!==n.OPERATION.DELETE){var F=H.getValue(v),m=H.getType(v);if(C){if((x=s._definition.filters&&s._definition.filters[v])&&!x.call(s,T,F,w)){F&&F.$changes&&E.add(F.$changes.refId);continue}}else{var x,g=H.parent;if((x=H.getChildrenFilter())&&!x.call(g,T,s.$indexes.get(v),F,w)){F&&F.$changes&&E.add(F.$changes.refId);continue}}if(F.$changes&&(S.push(F.$changes),P++),A.op!==n.OPERATION.TOUCH)if(A.op===n.OPERATION.ADD||C)W.push.apply(W,null!==(K=H.caches[v])&&void 0!==K?K:[]),q.add(v);else if(q.has(v))W.push.apply(W,null!==(Q=H.caches[v])&&void 0!==Q?Q:[]);else{if(q.add(v),Y(W,n.OPERATION.ADD),a(W,v),s instanceof b){var U=H.ref.$indexes.get(v);p(W,U)}F.$changes?a(W,F.$changes.refId):X[m](W,F)}else F.$changes&&!C&&(Y(W,n.OPERATION.ADD),a(W,v),s instanceof b&&(U=H.ref.$indexes.get(v),p(W,U)),a(W,F.$changes.refId))}else C?Y(W,A.op|v):(Y(W,A.op),a(W,v))}else Y(W,A.op)}},H=0;H<P;H++)J(H);return W},k.prototype.clone=function(){var n,k=new this.constructor,T=this._definition.schema;for(var c in T)"object"===typeof this[c]&&"function"===typeof(null===(n=this[c])||void 0===n?void 0:n.clone)?k[c]=this[c].clone():k[c]=this[c];return k},k.prototype.toJSON=function(){var n=this._definition.schema,k=this._definition.deprecated,T={};for(var c in n)k[c]||null===this[c]||"undefined"===typeof this[c]||(T[c]="function"===typeof this[c].toJSON?this[c].toJSON():this["_".concat(c)]);return T},k.prototype.discardAllChanges=function(){this.$changes.discardAll()},k.prototype.getByIndex=function(n){return this[this._definition.fieldsByIndex[n]]},k.prototype.deleteByIndex=function(n){this[this._definition.fieldsByIndex[n]]=void 0},k.prototype.tryEncodeTypeId=function(n,k,T){k._typeid!==T._typeid&&(Y(n,w),a(n,T._typeid))},k.prototype.getSchemaType=function(n,k,T){var c;return n[k.offset]===w&&(k.offset++,c=this.constructor._context.get(Cn(n,k))),c||T},k.prototype.createTypeInstance=function(n){var k=new n;return k.$changes.root=this.$changes.root,k},k.prototype._triggerChanges=function(T){for(var c,K,Q,G,w,E,I,S,P,W=new Set,J=this.$changes.root.refs,H=function(H){var s=T[H],b=s.refId,C=J.get(b),z=C.$callbacks;if((s.op&n.OPERATION.DELETE)===n.OPERATION.DELETE&&s.previousValue instanceof k&&(null===(K=null===(c=s.previousValue.$callbacks)||void 0===c?void 0:c[n.OPERATION.DELETE])||void 0===K||K.forEach((function(n){return n()}))),!z)return"continue";if(C instanceof k){if(!W.has(b))try{null===(Q=null===z||void 0===z?void 0:z[n.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(n){return n()}))}catch(r){k.onError(r)}try{z.hasOwnProperty(s.field)&&(null===(G=z[s.field])||void 0===G||G.forEach((function(n){return n(s.value,s.previousValue)})))}catch(r){k.onError(r)}}else s.op===n.OPERATION.ADD&&void 0===s.previousValue?null===(w=z[n.OPERATION.ADD])||void 0===w||w.forEach((function(n){var k;return n(s.value,null!==(k=s.dynamicIndex)&&void 0!==k?k:s.field)})):s.op===n.OPERATION.DELETE?void 0!==s.previousValue&&(null===(E=z[n.OPERATION.DELETE])||void 0===E||E.forEach((function(n){var k;return n(s.previousValue,null!==(k=s.dynamicIndex)&&void 0!==k?k:s.field)}))):s.op===n.OPERATION.DELETE_AND_ADD&&(void 0!==s.previousValue&&(null===(I=z[n.OPERATION.DELETE])||void 0===I||I.forEach((function(n){var k;return n(s.previousValue,null!==(k=s.dynamicIndex)&&void 0!==k?k:s.field)}))),null===(S=z[n.OPERATION.ADD])||void 0===S||S.forEach((function(n){var k;return n(s.value,null!==(k=s.dynamicIndex)&&void 0!==k?k:s.field)}))),s.value!==s.previousValue&&(null===(P=z[n.OPERATION.REPLACE])||void 0===P||P.forEach((function(n){var k;return n(s.value,null!==(k=s.dynamicIndex)&&void 0!==k?k:s.field)})));W.add(b)},s=0;s<T.length;s++)H(s)},k._definition=q.create(),k}();function Yn(n){for(var k=[n.$changes],T=1,c={},K=c,Q=function(n){var T=k[n];T.changes.forEach((function(n){var k=T.ref,c=n.index,Q=k._definition?k._definition.fieldsByIndex[c]:k.$indexes.get(c);K[Q]=T.getValue(c)}))},G=0;G<T;G++)Q(G);return c}var Zn={context:new u},en=function(n){function k(){return null!==n&&n.apply(this,arguments)||this}return T(k,n),c([A("string",Zn)],k.prototype,"name",void 0),c([A("string",Zn)],k.prototype,"type",void 0),c([A("number",Zn)],k.prototype,"referencedType",void 0),k}(Vn),dn=function(n){function k(){var k=null!==n&&n.apply(this,arguments)||this;return k.fields=new H,k}return T(k,n),c([A("number",Zn)],k.prototype,"id",void 0),c([A([en],Zn)],k.prototype,"fields",void 0),k}(Vn),ln=function(n){function k(){var k=null!==n&&n.apply(this,arguments)||this;return k.types=new H,k}return T(k,n),k.encode=function(n){var T=n.constructor,c=new k;c.rootType=T._typeid;var K=function(n,k){for(var T in k){var K=new en;K.name=T;var Q=void 0;if("string"===typeof k[T])Q=k[T];else{var G=k[T],w=void 0;Vn.is(G)?(Q="ref",w=k[T]):"string"===typeof G[Q=Object.keys(G)[0]]?Q+=":"+G[Q]:w=G[Q],K.referencedType=w?w._typeid:-1}K.type=Q,n.fields.push(K)}c.types.push(n)},Q=T._context.types;for(var G in Q){var w=new dn;w.id=Number(G),K(w,Q[G]._definition.schema)}return c.encodeAll()},k.decode=function(n,c){var K=new u,Q=new k;Q.decode(n,c);var G=Q.types.reduce((function(n,k){var c=function(n){function k(){return null!==n&&n.apply(this,arguments)||this}return T(k,n),k}(Vn),Q=k.id;return n[Q]=c,K.add(c,Q),n}),{});Q.types.forEach((function(n){var k=G[n.id];n.fields.forEach((function(n){var T;if(void 0!==n.referencedType){var c=n.type,Q=G[n.referencedType];if(!Q){var w=n.type.split(":");c=w[0],Q=w[1]}"ref"===c?A(Q,{context:K})(k.prototype,n.name):A(((T={})[c]=Q,T),{context:K})(k.prototype,n.name)}else A(n.type,{context:K})(k.prototype,n.name)}))}));var w=G[Q.rootType],E=new w;for(var I in w._definition.schema){var S=w._definition.schema[I];"string"!==typeof S&&(E[I]="function"===typeof S?new S:new(r(Object.keys(S)[0]).constructor))}return E},c([A([dn],Zn)],k.prototype,"types",void 0),c([A("number",Zn)],k.prototype,"rootType",void 0),k}(Vn);z("map",{constructor:b}),z("array",{constructor:H}),z("set",{constructor:fn}),z("collection",{constructor:un}),n.ArraySchema=H,n.CollectionSchema=un,n.Context=u,n.MapSchema=b,n.Reflection=ln,n.ReflectionField=en,n.ReflectionType=dn,n.Schema=Vn,n.SchemaDefinition=q,n.SetSchema=fn,n.decode=On,n.defineTypes=x,n.deprecated=m,n.dumpChanges=Yn,n.encode=X,n.filter=v,n.filterChildren=F,n.hasFilter=O,n.registerType=z,n.type=A,Object.defineProperty(n,"__esModule",{value:!0})}(k)},13037:n=>{"use strict";n.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13035:(n,k,T)=>{var c=T(13037),K=T(13044),Q=Object.hasOwnProperty,G=Object.create(null);for(var w in c)Q.call(c,w)&&(G[c[w]]=w);var E=n.exports={to:{},get:{}};function I(n,k,T){return Math.min(Math.max(k,n),T)}function S(n){var k=Math.round(n).toString(16).toUpperCase();return k.length<2?"0"+k:k}E.get=function(n){var k,T;switch(n.substring(0,3).toLowerCase()){case"hsl":k=E.get.hsl(n),T="hsl";break;case"hwb":k=E.get.hwb(n),T="hwb";break;default:k=E.get.rgb(n),T="rgb"}return k?{model:T,value:k}:null},E.get.rgb=function(n){if(!n)return null;var k,T,K,G=[0,0,0,1];if(k=n.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(K=k[2],k=k[1],T=0;T<3;T++){var w=2*T;G[T]=parseInt(k.slice(w,w+2),16)}K&&(G[3]=parseInt(K,16)/255)}else if(k=n.match(/^#([a-f0-9]{3,4})$/i)){for(K=(k=k[1])[3],T=0;T<3;T++)G[T]=parseInt(k[T]+k[T],16);K&&(G[3]=parseInt(K+K,16)/255)}else if(k=n.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(T=0;T<3;T++)G[T]=parseInt(k[T+1],0);k[4]&&(k[5]?G[3]=.01*parseFloat(k[4]):G[3]=parseFloat(k[4]))}else{if(!(k=n.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(k=n.match(/^(\w+)$/))?"transparent"===k[1]?[0,0,0,0]:Q.call(c,k[1])?((G=c[k[1]])[3]=1,G):null:null;for(T=0;T<3;T++)G[T]=Math.round(2.55*parseFloat(k[T+1]));k[4]&&(k[5]?G[3]=.01*parseFloat(k[4]):G[3]=parseFloat(k[4]))}for(T=0;T<3;T++)G[T]=I(G[T],0,255);return G[3]=I(G[3],0,1),G},E.get.hsl=function(n){if(!n)return null;var k=n.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(k){var T=parseFloat(k[4]);return[(parseFloat(k[1])%360+360)%360,I(parseFloat(k[2]),0,100),I(parseFloat(k[3]),0,100),I(isNaN(T)?1:T,0,1)]}return null},E.get.hwb=function(n){if(!n)return null;var k=n.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(k){var T=parseFloat(k[4]);return[(parseFloat(k[1])%360+360)%360,I(parseFloat(k[2]),0,100),I(parseFloat(k[3]),0,100),I(isNaN(T)?1:T,0,1)]}return null},E.to.hex=function(){var n=K(arguments);return"#"+S(n[0])+S(n[1])+S(n[2])+(n[3]<1?S(Math.round(255*n[3])):"")},E.to.rgb=function(){var n=K(arguments);return n.length<4||1===n[3]?"rgb("+Math.round(n[0])+", "+Math.round(n[1])+", "+Math.round(n[2])+")":"rgba("+Math.round(n[0])+", "+Math.round(n[1])+", "+Math.round(n[2])+", "+n[3]+")"},E.to.rgb.percent=function(){var n=K(arguments),k=Math.round(n[0]/255*100),T=Math.round(n[1]/255*100),c=Math.round(n[2]/255*100);return n.length<4||1===n[3]?"rgb("+k+"%, "+T+"%, "+c+"%)":"rgba("+k+"%, "+T+"%, "+c+"%, "+n[3]+")"},E.to.hsl=function(){var n=K(arguments);return n.length<4||1===n[3]?"hsl("+n[0]+", "+n[1]+"%, "+n[2]+"%)":"hsla("+n[0]+", "+n[1]+"%, "+n[2]+"%, "+n[3]+")"},E.to.hwb=function(){var n=K(arguments),k="";return n.length>=4&&1!==n[3]&&(k=", "+n[3]),"hwb("+n[0]+", "+n[1]+"%, "+n[2]+"%"+k+")"},E.to.keyword=function(n){return G[n.slice(0,3)]}},13027:(n,k,T)=>{const c=T(13035),K=T(13060),Q=["keyword","gray","hex"],G={};for(const J of Object.keys(K))G[[...K[J].labels].sort().join("")]=J;const w={};function E(n,k){if(!(this instanceof E))return new E(n,k);if(k&&k in Q&&(k=null),k&&!(k in K))throw new Error("Unknown model: "+k);let T,I;if(null==n)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(n instanceof E)this.model=n.model,this.color=[...n.color],this.valpha=n.valpha;else if("string"===typeof n){const k=c.get(n);if(null===k)throw new Error("Unable to parse color from string: "+n);this.model=k.model,I=K[this.model].channels,this.color=k.value.slice(0,I),this.valpha="number"===typeof k.value[I]?k.value[I]:1}else if(n.length>0){this.model=k||"rgb",I=K[this.model].channels;const T=Array.prototype.slice.call(n,0,I);this.color=W(T,I),this.valpha="number"===typeof n[I]?n[I]:1}else if("number"===typeof n)this.model="rgb",this.color=[n>>16&255,n>>8&255,255&n],this.valpha=1;else{this.valpha=1;const k=Object.keys(n);"alpha"in n&&(k.splice(k.indexOf("alpha"),1),this.valpha="number"===typeof n.alpha?n.alpha:0);const c=k.sort().join("");if(!(c in G))throw new Error("Unable to parse color from object: "+JSON.stringify(n));this.model=G[c];const{labels:Q}=K[this.model],w=[];for(T=0;T<Q.length;T++)w.push(n[Q[T]]);this.color=W(w)}if(w[this.model])for(I=K[this.model].channels,T=0;T<I;T++){const n=w[this.model][T];n&&(this.color[T]=n(this.color[T]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}E.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(n){let k=this.model in c.to?this:this.rgb();k=k.round("number"===typeof n?n:1);const T=1===k.valpha?k.color:[...k.color,this.valpha];return c.to[k.model](T)},percentString(n){const k=this.rgb().round("number"===typeof n?n:1),T=1===k.valpha?k.color:[...k.color,this.valpha];return c.to.rgb.percent(T)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const n={},{channels:k}=K[this.model],{labels:T}=K[this.model];for(let c=0;c<k;c++)n[T[c]]=this.color[c];return 1!==this.valpha&&(n.alpha=this.valpha),n},unitArray(){const n=this.rgb().color;return n[0]/=255,n[1]/=255,n[2]/=255,1!==this.valpha&&n.push(this.valpha),n},unitObject(){const n=this.rgb().object();return n.r/=255,n.g/=255,n.b/=255,1!==this.valpha&&(n.alpha=this.valpha),n},round(n){return n=Math.max(n||0,0),new E([...this.color.map(I(n)),this.valpha],this.model)},alpha(n){return void 0!==n?new E([...this.color,Math.max(0,Math.min(1,n))],this.model):this.valpha},red:S("rgb",0,P(255)),green:S("rgb",1,P(255)),blue:S("rgb",2,P(255)),hue:S(["hsl","hsv","hsl","hwb","hcg"],0,(n=>(n%360+360)%360)),saturationl:S("hsl",1,P(100)),lightness:S("hsl",2,P(100)),saturationv:S("hsv",1,P(100)),value:S("hsv",2,P(100)),chroma:S("hcg",1,P(100)),gray:S("hcg",2,P(100)),white:S("hwb",1,P(100)),wblack:S("hwb",2,P(100)),cyan:S("cmyk",0,P(100)),magenta:S("cmyk",1,P(100)),yellow:S("cmyk",2,P(100)),black:S("cmyk",3,P(100)),x:S("xyz",0,P(95.047)),y:S("xyz",1,P(100)),z:S("xyz",2,P(108.833)),l:S("lab",0,P(100)),a:S("lab",1),b:S("lab",2),keyword(n){return void 0!==n?new E(n):K[this.model].keyword(this.color)},hex(n){return void 0!==n?new E(n):c.to.hex(this.rgb().round().color)},hexa(n){if(void 0!==n)return new E(n);const k=this.rgb().round().color;let T=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===T.length&&(T="0"+T),c.to.hex(k)+T},rgbNumber(){const n=this.rgb().color;return(255&n[0])<<16|(255&n[1])<<8|255&n[2]},luminosity(){const n=this.rgb().color,k=[];for(const[T,c]of n.entries()){const n=c/255;k[T]=n<=.04045?n/12.92:((n+.055)/1.055)**2.4}return.2126*k[0]+.7152*k[1]+.0722*k[2]},contrast(n){const k=this.luminosity(),T=n.luminosity();return k>T?(k+.05)/(T+.05):(T+.05)/(k+.05)},level(n){const k=this.contrast(n);return k>=7?"AAA":k>=4.5?"AA":""},isDark(){const n=this.rgb().color;return(2126*n[0]+7152*n[1]+722*n[2])/1e4<128},isLight(){return!this.isDark()},negate(){const n=this.rgb();for(let k=0;k<3;k++)n.color[k]=255-n.color[k];return n},lighten(n){const k=this.hsl();return k.color[2]+=k.color[2]*n,k},darken(n){const k=this.hsl();return k.color[2]-=k.color[2]*n,k},saturate(n){const k=this.hsl();return k.color[1]+=k.color[1]*n,k},desaturate(n){const k=this.hsl();return k.color[1]-=k.color[1]*n,k},whiten(n){const k=this.hwb();return k.color[1]+=k.color[1]*n,k},blacken(n){const k=this.hwb();return k.color[2]+=k.color[2]*n,k},grayscale(){const n=this.rgb().color,k=.3*n[0]+.59*n[1]+.11*n[2];return E.rgb(k,k,k)},fade(n){return this.alpha(this.valpha-this.valpha*n)},opaquer(n){return this.alpha(this.valpha+this.valpha*n)},rotate(n){const k=this.hsl();let T=k.color[0];return T=(T+n)%360,T=T<0?360+T:T,k.color[0]=T,k},mix(n,k){if(!n||!n.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof n);const T=n.rgb(),c=this.rgb(),K=void 0===k?.5:k,Q=2*K-1,G=T.alpha()-c.alpha(),w=((Q*G===-1?Q:(Q+G)/(1+Q*G))+1)/2,I=1-w;return E.rgb(w*T.red()+I*c.red(),w*T.green()+I*c.green(),w*T.blue()+I*c.blue(),T.alpha()*K+c.alpha()*(1-K))}};for(const J of Object.keys(K)){if(Q.includes(J))continue;const{channels:n}=K[J];E.prototype[J]=function(){if(this.model===J)return new E(this);for(var n=arguments.length,k=new Array(n),T=0;T<n;T++)k[T]=arguments[T];return k.length>0?new E(k,J):new E([...(c=K[this.model][J].raw(this.color),Array.isArray(c)?c:[c]),this.valpha],J);var c},E[J]=function(){for(var k=arguments.length,T=new Array(k),c=0;c<k;c++)T[c]=arguments[c];let K=T[0];return"number"===typeof K&&(K=W(T,n)),new E(K,J)}}function I(n){return function(k){return function(n,k){return Number(n.toFixed(k))}(k,n)}}function S(n,k,T){n=Array.isArray(n)?n:[n];for(const c of n)(w[c]||(w[c]=[]))[k]=T;return n=n[0],function(c){let K;return void 0!==c?(T&&(c=T(c)),K=this[n](),K.color[k]=c,K):(K=this[n]().color[k],T&&(K=T(K)),K)}}function P(n){return function(k){return Math.max(0,Math.min(n,k))}}function W(n,k){for(let T=0;T<k;T++)"number"!==typeof n[T]&&(n[T]=0);return n}n.exports=E},13064:(n,k,T)=>{const c=T(13072),K={};for(const G of Object.keys(c))K[c[G]]=G;const Q={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};n.exports=Q;for(const G of Object.keys(Q)){if(!("channels"in Q[G]))throw new Error("missing channels property: "+G);if(!("labels"in Q[G]))throw new Error("missing channel labels property: "+G);if(Q[G].labels.length!==Q[G].channels)throw new Error("channel and label counts mismatch: "+G);const{channels:n,labels:k}=Q[G];delete Q[G].channels,delete Q[G].labels,Object.defineProperty(Q[G],"channels",{value:n}),Object.defineProperty(Q[G],"labels",{value:k})}Q.rgb.hsl=function(n){const k=n[0]/255,T=n[1]/255,c=n[2]/255,K=Math.min(k,T,c),Q=Math.max(k,T,c),G=Q-K;let w,E;Q===K?w=0:k===Q?w=(T-c)/G:T===Q?w=2+(c-k)/G:c===Q&&(w=4+(k-T)/G),w=Math.min(60*w,360),w<0&&(w+=360);const I=(K+Q)/2;return E=Q===K?0:I<=.5?G/(Q+K):G/(2-Q-K),[w,100*E,100*I]},Q.rgb.hsv=function(n){let k,T,c,K,Q;const G=n[0]/255,w=n[1]/255,E=n[2]/255,I=Math.max(G,w,E),S=I-Math.min(G,w,E),P=function(n){return(I-n)/6/S+.5};return 0===S?(K=0,Q=0):(Q=S/I,k=P(G),T=P(w),c=P(E),G===I?K=c-T:w===I?K=1/3+k-c:E===I&&(K=2/3+T-k),K<0?K+=1:K>1&&(K-=1)),[360*K,100*Q,100*I]},Q.rgb.hwb=function(n){const k=n[0],T=n[1];let c=n[2];const K=Q.rgb.hsl(n)[0],G=1/255*Math.min(k,Math.min(T,c));return c=1-1/255*Math.max(k,Math.max(T,c)),[K,100*G,100*c]},Q.rgb.cmyk=function(n){const k=n[0]/255,T=n[1]/255,c=n[2]/255,K=Math.min(1-k,1-T,1-c);return[100*((1-k-K)/(1-K)||0),100*((1-T-K)/(1-K)||0),100*((1-c-K)/(1-K)||0),100*K]},Q.rgb.keyword=function(n){const k=K[n];if(k)return k;let T,Q=1/0;for(const K of Object.keys(c)){const k=c[K],E=(w=k,((G=n)[0]-w[0])**2+(G[1]-w[1])**2+(G[2]-w[2])**2);E<Q&&(Q=E,T=K)}var G,w;return T},Q.keyword.rgb=function(n){return c[n]},Q.rgb.xyz=function(n){let k=n[0]/255,T=n[1]/255,c=n[2]/255;k=k>.04045?((k+.055)/1.055)**2.4:k/12.92,T=T>.04045?((T+.055)/1.055)**2.4:T/12.92,c=c>.04045?((c+.055)/1.055)**2.4:c/12.92;return[100*(.4124*k+.3576*T+.1805*c),100*(.2126*k+.7152*T+.0722*c),100*(.0193*k+.1192*T+.9505*c)]},Q.rgb.lab=function(n){const k=Q.rgb.xyz(n);let T=k[0],c=k[1],K=k[2];T/=95.047,c/=100,K/=108.883,T=T>.008856?T**(1/3):7.787*T+16/116,c=c>.008856?c**(1/3):7.787*c+16/116,K=K>.008856?K**(1/3):7.787*K+16/116;return[116*c-16,500*(T-c),200*(c-K)]},Q.hsl.rgb=function(n){const k=n[0]/360,T=n[1]/100,c=n[2]/100;let K,Q,G;if(0===T)return G=255*c,[G,G,G];K=c<.5?c*(1+T):c+T-c*T;const w=2*c-K,E=[0,0,0];for(let I=0;I<3;I++)Q=k+1/3*-(I-1),Q<0&&Q++,Q>1&&Q--,G=6*Q<1?w+6*(K-w)*Q:2*Q<1?K:3*Q<2?w+(K-w)*(2/3-Q)*6:w,E[I]=255*G;return E},Q.hsl.hsv=function(n){const k=n[0];let T=n[1]/100,c=n[2]/100,K=T;const Q=Math.max(c,.01);c*=2,T*=c<=1?c:2-c,K*=Q<=1?Q:2-Q;return[k,100*(0===c?2*K/(Q+K):2*T/(c+T)),100*((c+T)/2)]},Q.hsv.rgb=function(n){const k=n[0]/60,T=n[1]/100;let c=n[2]/100;const K=Math.floor(k)%6,Q=k-Math.floor(k),G=255*c*(1-T),w=255*c*(1-T*Q),E=255*c*(1-T*(1-Q));switch(c*=255,K){case 0:return[c,E,G];case 1:return[w,c,G];case 2:return[G,c,E];case 3:return[G,w,c];case 4:return[E,G,c];case 5:return[c,G,w]}},Q.hsv.hsl=function(n){const k=n[0],T=n[1]/100,c=n[2]/100,K=Math.max(c,.01);let Q,G;G=(2-T)*c;const w=(2-T)*K;return Q=T*K,Q/=w<=1?w:2-w,Q=Q||0,G/=2,[k,100*Q,100*G]},Q.hwb.rgb=function(n){const k=n[0]/360;let T=n[1]/100,c=n[2]/100;const K=T+c;let Q;K>1&&(T/=K,c/=K);const G=Math.floor(6*k),w=1-c;Q=6*k-G,0!==(1&G)&&(Q=1-Q);const E=T+Q*(w-T);let I,S,P;switch(G){default:case 6:case 0:I=w,S=E,P=T;break;case 1:I=E,S=w,P=T;break;case 2:I=T,S=w,P=E;break;case 3:I=T,S=E,P=w;break;case 4:I=E,S=T,P=w;break;case 5:I=w,S=T,P=E}return[255*I,255*S,255*P]},Q.cmyk.rgb=function(n){const k=n[0]/100,T=n[1]/100,c=n[2]/100,K=n[3]/100;return[255*(1-Math.min(1,k*(1-K)+K)),255*(1-Math.min(1,T*(1-K)+K)),255*(1-Math.min(1,c*(1-K)+K))]},Q.xyz.rgb=function(n){const k=n[0]/100,T=n[1]/100,c=n[2]/100;let K,Q,G;return K=3.2406*k+-1.5372*T+-.4986*c,Q=-.9689*k+1.8758*T+.0415*c,G=.0557*k+-.204*T+1.057*c,K=K>.0031308?1.055*K**(1/2.4)-.055:12.92*K,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,K=Math.min(Math.max(0,K),1),Q=Math.min(Math.max(0,Q),1),G=Math.min(Math.max(0,G),1),[255*K,255*Q,255*G]},Q.xyz.lab=function(n){let k=n[0],T=n[1],c=n[2];k/=95.047,T/=100,c/=108.883,k=k>.008856?k**(1/3):7.787*k+16/116,T=T>.008856?T**(1/3):7.787*T+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;return[116*T-16,500*(k-T),200*(T-c)]},Q.lab.xyz=function(n){let k,T,c;T=(n[0]+16)/116,k=n[1]/500+T,c=T-n[2]/200;const K=T**3,Q=k**3,G=c**3;return T=K>.008856?K:(T-16/116)/7.787,k=Q>.008856?Q:(k-16/116)/7.787,c=G>.008856?G:(c-16/116)/7.787,k*=95.047,T*=100,c*=108.883,[k,T,c]},Q.lab.lch=function(n){const k=n[0],T=n[1],c=n[2];let K;K=360*Math.atan2(c,T)/2/Math.PI,K<0&&(K+=360);return[k,Math.sqrt(T*T+c*c),K]},Q.lch.lab=function(n){const k=n[0],T=n[1],c=n[2]/360*2*Math.PI;return[k,T*Math.cos(c),T*Math.sin(c)]},Q.rgb.ansi16=function(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[T,c,K]=n;let G=null===k?Q.rgb.hsv(n)[2]:k;if(G=Math.round(G/50),0===G)return 30;let w=30+(Math.round(K/255)<<2|Math.round(c/255)<<1|Math.round(T/255));return 2===G&&(w+=60),w},Q.hsv.ansi16=function(n){return Q.rgb.ansi16(Q.hsv.rgb(n),n[2])},Q.rgb.ansi256=function(n){const k=n[0],T=n[1],c=n[2];if(k===T&&T===c)return k<8?16:k>248?231:Math.round((k-8)/247*24)+232;return 16+36*Math.round(k/255*5)+6*Math.round(T/255*5)+Math.round(c/255*5)},Q.ansi16.rgb=function(n){let k=n%10;if(0===k||7===k)return n>50&&(k+=3.5),k=k/10.5*255,[k,k,k];const T=.5*(1+~~(n>50));return[(1&k)*T*255,(k>>1&1)*T*255,(k>>2&1)*T*255]},Q.ansi256.rgb=function(n){if(n>=232){const k=10*(n-232)+8;return[k,k,k]}let k;n-=16;return[Math.floor(n/36)/5*255,Math.floor((k=n%36)/6)/5*255,k%6/5*255]},Q.rgb.hex=function(n){const k=(((255&Math.round(n[0]))<<16)+((255&Math.round(n[1]))<<8)+(255&Math.round(n[2]))).toString(16).toUpperCase();return"000000".substring(k.length)+k},Q.hex.rgb=function(n){const k=n.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!k)return[0,0,0];let T=k[0];3===k[0].length&&(T=T.split("").map((n=>n+n)).join(""));const c=parseInt(T,16);return[c>>16&255,c>>8&255,255&c]},Q.rgb.hcg=function(n){const k=n[0]/255,T=n[1]/255,c=n[2]/255,K=Math.max(Math.max(k,T),c),Q=Math.min(Math.min(k,T),c),G=K-Q;let w,E;return w=G<1?Q/(1-G):0,E=G<=0?0:K===k?(T-c)/G%6:K===T?2+(c-k)/G:4+(k-T)/G,E/=6,E%=1,[360*E,100*G,100*w]},Q.hsl.hcg=function(n){const k=n[1]/100,T=n[2]/100,c=T<.5?2*k*T:2*k*(1-T);let K=0;return c<1&&(K=(T-.5*c)/(1-c)),[n[0],100*c,100*K]},Q.hsv.hcg=function(n){const k=n[1]/100,T=n[2]/100,c=k*T;let K=0;return c<1&&(K=(T-c)/(1-c)),[n[0],100*c,100*K]},Q.hcg.rgb=function(n){const k=n[0]/360,T=n[1]/100,c=n[2]/100;if(0===T)return[255*c,255*c,255*c];const K=[0,0,0],Q=k%1*6,G=Q%1,w=1-G;let E=0;switch(Math.floor(Q)){case 0:K[0]=1,K[1]=G,K[2]=0;break;case 1:K[0]=w,K[1]=1,K[2]=0;break;case 2:K[0]=0,K[1]=1,K[2]=G;break;case 3:K[0]=0,K[1]=w,K[2]=1;break;case 4:K[0]=G,K[1]=0,K[2]=1;break;default:K[0]=1,K[1]=0,K[2]=w}return E=(1-T)*c,[255*(T*K[0]+E),255*(T*K[1]+E),255*(T*K[2]+E)]},Q.hcg.hsv=function(n){const k=n[1]/100,T=k+n[2]/100*(1-k);let c=0;return T>0&&(c=k/T),[n[0],100*c,100*T]},Q.hcg.hsl=function(n){const k=n[1]/100,T=n[2]/100*(1-k)+.5*k;let c=0;return T>0&&T<.5?c=k/(2*T):T>=.5&&T<1&&(c=k/(2*(1-T))),[n[0],100*c,100*T]},Q.hcg.hwb=function(n){const k=n[1]/100,T=k+n[2]/100*(1-k);return[n[0],100*(T-k),100*(1-T)]},Q.hwb.hcg=function(n){const k=n[1]/100,T=1-n[2]/100,c=T-k;let K=0;return c<1&&(K=(T-c)/(1-c)),[n[0],100*c,100*K]},Q.apple.rgb=function(n){return[n[0]/65535*255,n[1]/65535*255,n[2]/65535*255]},Q.rgb.apple=function(n){return[n[0]/255*65535,n[1]/255*65535,n[2]/255*65535]},Q.gray.rgb=function(n){return[n[0]/100*255,n[0]/100*255,n[0]/100*255]},Q.gray.hsl=function(n){return[0,0,n[0]]},Q.gray.hsv=Q.gray.hsl,Q.gray.hwb=function(n){return[0,100,n[0]]},Q.gray.cmyk=function(n){return[0,0,0,n[0]]},Q.gray.lab=function(n){return[n[0],0,0]},Q.gray.hex=function(n){const k=255&Math.round(n[0]/100*255),T=((k<<16)+(k<<8)+k).toString(16).toUpperCase();return"000000".substring(T.length)+T},Q.rgb.gray=function(n){return[(n[0]+n[1]+n[2])/3/255*100]}},13060:(n,k,T)=>{const c=T(13064),K=T(13078),Q={};Object.keys(c).forEach((n=>{Q[n]={},Object.defineProperty(Q[n],"channels",{value:c[n].channels}),Object.defineProperty(Q[n],"labels",{value:c[n].labels});const k=K(n);Object.keys(k).forEach((T=>{const c=k[T];Q[n][T]=function(n){const k=function(){for(var k=arguments.length,T=new Array(k),c=0;c<k;c++)T[c]=arguments[c];const K=T[0];if(void 0===K||null===K)return K;K.length>1&&(T=K);const Q=n(T);if("object"===typeof Q)for(let n=Q.length,G=0;G<n;G++)Q[G]=Math.round(Q[G]);return Q};return"conversion"in n&&(k.conversion=n.conversion),k}(c),Q[n][T].raw=function(n){const k=function(){for(var k=arguments.length,T=new Array(k),c=0;c<k;c++)T[c]=arguments[c];const K=T[0];return void 0===K||null===K?K:(K.length>1&&(T=K),n(T))};return"conversion"in n&&(k.conversion=n.conversion),k}(c)}))})),n.exports=Q},13078:(n,k,T)=>{const c=T(13064);function K(n){const k=function(){const n={},k=Object.keys(c);for(let T=k.length,c=0;c<T;c++)n[k[c]]={distance:-1,parent:null};return n}(),T=[n];for(k[n].distance=0;T.length;){const n=T.pop(),K=Object.keys(c[n]);for(let c=K.length,Q=0;Q<c;Q++){const c=K[Q],G=k[c];-1===G.distance&&(G.distance=k[n].distance+1,G.parent=n,T.unshift(c))}}return k}function Q(n,k){return function(T){return k(n(T))}}function G(n,k){const T=[k[n].parent,n];let K=c[k[n].parent][n],G=k[n].parent;for(;k[G].parent;)T.unshift(k[G].parent),K=Q(c[k[G].parent][G],K),G=k[G].parent;return K.conversion=T,K}n.exports=function(n){const k=K(n),T={},c=Object.keys(k);for(let K=c.length,Q=0;Q<K;Q++){const n=c[Q];null!==k[n].parent&&(T[n]=G(n,k))}return T}},13072:n=>{"use strict";n.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11930:function(n,k,T){"use strict";var c=this&&this.__createBinding||(Object.create?function(n,k,T,c){void 0===c&&(c=T);var K=Object.getOwnPropertyDescriptor(k,T);K&&!("get"in K?!k.__esModule:K.writable||K.configurable)||(K={enumerable:!0,get:function(){return k[T]}}),Object.defineProperty(n,c,K)}:function(n,k,T,c){void 0===c&&(c=T),n[c]=k[T]}),K=this&&this.__setModuleDefault||(Object.create?function(n,k){Object.defineProperty(n,"default",{enumerable:!0,value:k})}:function(n,k){n.default=k}),Q=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var k={};if(null!=n)for(var T in n)"default"!==T&&Object.prototype.hasOwnProperty.call(n,T)&&c(k,n,T);return K(k,n),k},G=this&&this.__awaiter||function(n,k,T,c){return new(T||(T=Promise))((function(K,Q){function G(n){try{E(c.next(n))}catch(k){Q(k)}}function w(n){try{E(c.throw(n))}catch(k){Q(k)}}function E(n){var k;n.done?K(n.value):(k=n.value,k instanceof T?k:new T((function(n){n(k)}))).then(G,w)}E((c=c.apply(n,k||[])).next())}))};Object.defineProperty(k,"__esModule",{value:!0}),k.Auth=k.Platform=void 0;const w=Q(T(11868)),E=T(11932),I="colyseus-auth-token";!function(n){n.ios="ios",n.android="android"}(k.Platform||(k.Platform={}));k.Auth=class{constructor(n){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=n.replace("ws","http"),(0,E.getItem)(I,(n=>this.token=n))}get hasToken(){return!!this.token}login(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return G(this,void 0,void 0,(function*(){const k=Object.assign({},n);this.hasToken&&(k.token=this.token);const T=yield this.request("post","/auth",k);this.token=T.token,(0,E.setItem)(I,this.token);for(let n in T)this.hasOwnProperty(n)&&(this[n]=T[n]);return this.registerPingService(),this}))}save(){return G(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return G(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return G(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return G(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(n){return G(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:n})}))}acceptFriendRequest(n){return G(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:n})}))}declineFriendRequest(n){return G(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:n})}))}blockUser(n){return G(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:n})}))}unblockUser(n){return G(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:n})}))}request(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3?arguments[3]:void 0,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return G(this,void 0,void 0,(function*(){K.Accept="application/json",this.hasToken&&(K.Authorization="Bearer "+this.token);const Q=[];for(const n in T)Q.push(`${n}=${T[n]}`);const G=Q.length>0?`?${Q.join("&")}`:"",E={headers:K};return c&&(E.body=c),(yield w[n](`${this.endpoint}${k}${G}`,E)).data}))}logout(){this.token=void 0,(0,E.removeItem)(I),this.unregisterPingService()}registerPingService(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),n)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11860:function(n,k,T){"use strict";var c,K=this&&this.__awaiter||function(n,k,T,c){return new(T||(T=Promise))((function(K,Q){function G(n){try{E(c.next(n))}catch(k){Q(k)}}function w(n){try{E(c.throw(n))}catch(k){Q(k)}}function E(n){var k;n.done?K(n.value):(k=n.value,k instanceof T?k:new T((function(n){n(k)}))).then(G,w)}E((c=c.apply(n,k||[])).next())}))};Object.defineProperty(k,"__esModule",{value:!0}),k.Client=k.MatchMakeError=void 0;const Q=T(11868),G=T(11873),w=T(11881);class E extends Error{constructor(n,k){super(n),this.code=k,Object.setPrototypeOf(this,E.prototype)}}k.MatchMakeError=E;const I="undefined"!==typeof window&&"undefined"!==typeof(null===(c=null===window||void 0===window?void 0:window.location)||void 0===c?void 0:c.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";k.Client=class{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;if("string"===typeof n){const k=new URL(n),T="https:"===k.protocol||"wss:"===k.protocol,c=Number(k.port||(T?443:80));this.settings={hostname:k.hostname,pathname:"/"!==k.pathname?k.pathname:"",port:c,secure:T}}else void 0===n.port&&(n.port=n.secure?443:80),void 0===n.pathname&&(n.pathname=""),this.settings=n}joinOrCreate(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",n,k,T)}))}create(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",n,k,T)}))}join(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",n,k,T)}))}joinById(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return K(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",n,k,T)}))}reconnect(n,k){return K(this,void 0,void 0,(function*(){if("string"===typeof n&&"string"===typeof k)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[T,c]=n.split(":");return yield this.createMatchMakeRequest("reconnect",T,{reconnectionToken:c},k)}))}getAvailableRooms(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return K(this,void 0,void 0,(function*(){return(yield(0,Q.get)(this.getHttpEndpoint(`${n}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(n,k,T){return K(this,void 0,void 0,(function*(){const c=this.createRoom(n.room.name,k);c.roomId=n.room.roomId,c.sessionId=n.sessionId;const Q={sessionId:c.sessionId};n.reconnectionToken&&(Q.reconnectionToken=n.reconnectionToken);const w=T||c;return c.connect(this.buildEndpoint(n.room,Q),n.devMode&&(()=>K(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${c.roomId}'...`);let T=0;const Q=()=>K(this,void 0,void 0,(function*(){T++;try{yield this.consumeSeatReservation(n,k,w),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${c.roomId}'`)}catch(K){T<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${T} out of 8)`),setTimeout(Q,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(Q,2e3)}))),w),new Promise(((n,k)=>{const T=(n,T)=>k(new G.ServerError(n,T));w.onError.once(T),w.onJoin.once((()=>{w.onError.remove(T),n(w)}))}))}))}createMatchMakeRequest(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0;return K(this,void 0,void 0,(function*(){const K=(yield(0,Q.post)(this.getHttpEndpoint(`${n}/${k}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(T)})).data;if(K.error)throw new E(K.error,K.code);return"reconnect"===n&&(K.reconnectionToken=T.reconnectionToken),yield this.consumeSeatReservation(K,c,G)}))}createRoom(n,k){return new w.Room(n,k)}buildEndpoint(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=[];for(const K in k)k.hasOwnProperty(K)&&T.push(`${K}=${k[K]}`);let c=this.settings.secure?"wss://":"ws://";return n.publicAddress?c+=`${n.publicAddress}`:c+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${c}/${n.processId}/${n.roomId}?${T.join("&")}`}getHttpEndpoint(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${n}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11893:(n,k,T)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.Connection=void 0;const c=T(11898);k.Connection=class{constructor(){this.events={},this.transport=new c.WebSocketTransport(this.events)}send(n){this.transport.send(n)}connect(n){this.transport.connect(n)}close(n,k){this.transport.close(n,k)}get isOpen(){return this.transport.isOpen}}},11907:(n,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.utf8Length=k.utf8Read=k.ErrorCode=k.Protocol=void 0,function(n){n[n.HANDSHAKE=9]="HANDSHAKE",n[n.JOIN_ROOM=10]="JOIN_ROOM",n[n.ERROR=11]="ERROR",n[n.LEAVE_ROOM=12]="LEAVE_ROOM",n[n.ROOM_DATA=13]="ROOM_DATA",n[n.ROOM_STATE=14]="ROOM_STATE",n[n.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",n[n.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",n[n.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(k.Protocol||(k.Protocol={})),function(n){n[n.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",n[n.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",n[n.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",n[n.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",n[n.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",n[n.AUTH_FAILED=4215]="AUTH_FAILED",n[n.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(k.ErrorCode||(k.ErrorCode={})),k.utf8Read=function(n,k){const T=n[k++];for(var c="",K=0,Q=k,G=k+T;Q<G;Q++){var w=n[Q];if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(K=(7&w)<<18|(63&n[++Q])<<12|(63&n[++Q])<<6|63&n[++Q])>=65536?(K-=65536,c+=String.fromCharCode(55296+(K>>>10),56320+(1023&K))):c+=String.fromCharCode(K)}else c+=String.fromCharCode((15&w)<<12|(63&n[++Q])<<6|63&n[++Q]);else c+=String.fromCharCode((31&w)<<6|63&n[++Q]);else c+=String.fromCharCode(w)}return c},k.utf8Length=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",k=0,T=0;for(let c=0,K=n.length;c<K;c++)k=n.charCodeAt(c),k<128?T+=1:k<2048?T+=2:k<55296||k>=57344?T+=3:(c++,T+=4);return T+1}},11881:function(n,k,T){"use strict";var c=this&&this.__createBinding||(Object.create?function(n,k,T,c){void 0===c&&(c=T);var K=Object.getOwnPropertyDescriptor(k,T);K&&!("get"in K?!k.__esModule:K.writable||K.configurable)||(K={enumerable:!0,get:function(){return k[T]}}),Object.defineProperty(n,c,K)}:function(n,k,T,c){void 0===c&&(c=T),n[c]=k[T]}),K=this&&this.__setModuleDefault||(Object.create?function(n,k){Object.defineProperty(n,"default",{enumerable:!0,value:k})}:function(n,k){n.default=k}),Q=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var k={};if(null!=n)for(var T in n)"default"!==T&&Object.prototype.hasOwnProperty.call(n,T)&&c(k,n,T);return K(k,n),k};Object.defineProperty(k,"__esModule",{value:!0}),k.Room=void 0;const G=Q(T(11888)),w=T(11893),E=T(11907),I=T(11909),S=T(11912),P=T(11921),W=T(11926),J=T(11873);class H{constructor(n,k){this.onStateChange=(0,P.createSignal)(),this.onError=(0,P.createSignal)(),this.onLeave=(0,P.createSignal)(),this.onJoin=(0,P.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,S.createNanoEvents)(),this.roomId=null,this.name=n,k&&(this.serializer=new((0,I.getSerializer)("schema")),this.rootSchema=k,this.serializer.state=new k),this.onError(((n,k)=>{var T;return null===(T=console.warn)||void 0===T?void 0:T.call(console,`colyseus.js - onError => (${n}) ${k}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const c=new w.Connection;T.connection=c,c.events.onmessage=H.prototype.onMessageCallback.bind(T),c.events.onclose=function(n){var c;if(!T.hasJoined)return null===(c=console.warn)||void 0===c||c.call(console,`Room connection was closed unexpectedly (${n.code}): ${n.reason}`),void T.onError.invoke(n.code,n.reason);n.code===J.CloseCode.DEVMODE_RESTART&&k?k():(T.onLeave.invoke(n.code),T.destroy())},c.events.onerror=function(n){var k;null===(k=console.warn)||void 0===k||k.call(console,`Room, onError (${n.code}): ${n.reason}`),T.onError.invoke(n.code,n.reason)},c.connect(n)}leave(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((k=>{this.onLeave((n=>k(n))),this.connection?n?this.connection.send([E.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(J.CloseCode.CONSENTED)}))}onMessage(n,k){return this.onMessageHandlers.on(this.getMessageHandlerKey(n),k)}send(n,k){const T=[E.Protocol.ROOM_DATA];let c;if("string"===typeof n?W.encode.string(T,n):W.encode.number(T,n),void 0!==k){const n=G.encode(k);c=new Uint8Array(T.length+n.byteLength),c.set(new Uint8Array(T),0),c.set(new Uint8Array(n),T.length)}else c=new Uint8Array(T);this.connection.send(c.buffer)}sendBytes(n,k){const T=[E.Protocol.ROOM_DATA_BYTES];let c;"string"===typeof n?W.encode.string(T,n):W.encode.number(T,n),c=new Uint8Array(T.length+(k.byteLength||k.length)),c.set(new Uint8Array(T),0),c.set(new Uint8Array(k),T.length),this.connection.send(c.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(n){const k=Array.from(new Uint8Array(n.data)),T=k[0];if(T===E.Protocol.JOIN_ROOM){let n=1;const T=(0,E.utf8Read)(k,n);if(n+=(0,E.utf8Length)(T),this.serializerId=(0,E.utf8Read)(k,n),n+=(0,E.utf8Length)(this.serializerId),!this.serializer){const n=(0,I.getSerializer)(this.serializerId);this.serializer=new n}k.length>n&&this.serializer.handshake&&this.serializer.handshake(k,{offset:n}),this.reconnectionToken=`${this.roomId}:${T}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([E.Protocol.JOIN_ROOM])}else if(T===E.Protocol.ERROR){const n={offset:1},T=W.decode.number(k,n),c=W.decode.string(k,n);this.onError.invoke(T,c)}else if(T===E.Protocol.LEAVE_ROOM)this.leave();else if(T===E.Protocol.ROOM_DATA_SCHEMA){const n={offset:1},T=this.serializer.getState().constructor._context.get(W.decode.number(k,n)),c=new T;c.decode(k,n),this.dispatchMessage(T,c)}else if(T===E.Protocol.ROOM_STATE)k.shift(),this.setState(k);else if(T===E.Protocol.ROOM_STATE_PATCH)k.shift(),this.patch(k);else if(T===E.Protocol.ROOM_DATA){const T={offset:1},c=W.decode.stringCheck(k,T)?W.decode.string(k,T):W.decode.number(k,T),K=k.length>T.offset?G.decode(n.data,T.offset):void 0;this.dispatchMessage(c,K)}else if(T===E.Protocol.ROOM_DATA_BYTES){const n={offset:1},T=W.decode.stringCheck(k,n)?W.decode.string(k,n):W.decode.number(k,n);this.dispatchMessage(T,new Uint8Array(k.slice(n.offset)))}}setState(n){this.serializer.setState(n),this.onStateChange.invoke(this.serializer.getState())}patch(n){this.serializer.patch(n),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(n,k){var T;const c=this.getMessageHandlerKey(n);this.onMessageHandlers.events[c]?this.onMessageHandlers.emit(c,k):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",n,k):null===(T=console.warn)||void 0===T||T.call(console,`colyseus.js: onMessage() not registered for type '${n}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(n){switch(typeof n){case"function":return`$${n._typeid}`;case"string":return n;case"number":return`i${n}`;default:throw new Error("invalid message type.")}}}k.Room=H},11932:(n,k)=>{"use strict";let T;function c(){return T||(T="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(n,k){this.cache[n]=k},getItem:function(n){this.cache[n]},removeItem:function(n){delete this.cache[n]}}),T}Object.defineProperty(k,"__esModule",{value:!0}),k.getItem=k.removeItem=k.setItem=void 0,k.setItem=function(n,k){c().setItem(n,k)},k.removeItem=function(n){c().removeItem(n)},k.getItem=function(n,k){const T=c().getItem(n);"undefined"!==typeof Promise&&T instanceof Promise?T.then((n=>k(n))):k(T)}},11912:(n,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.createNanoEvents=void 0;k.createNanoEvents=()=>({emit(n){let k=this.events[n]||[];for(var T=arguments.length,c=new Array(T>1?T-1:0),K=1;K<T;K++)c[K-1]=arguments[K];for(let Q=0,G=k.length;Q<G;Q++)k[Q](...c)},events:{},on(n,k){var T;return(null===(T=this.events[n])||void 0===T?void 0:T.push(k))||(this.events[n]=[k]),()=>{var T;this.events[n]=null===(T=this.events[n])||void 0===T?void 0:T.filter((n=>k!==n))}}})},11921:(n,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.createSignal=k.EventEmitter=void 0;class T{constructor(){this.handlers=[]}register(n){return this.handlers.push(n),this}invoke(){for(var n=arguments.length,k=new Array(n),T=0;T<n;T++)k[T]=arguments[T];this.handlers.forEach((n=>n.apply(this,k)))}invokeAsync(){for(var n=arguments.length,k=new Array(n),T=0;T<n;T++)k[T]=arguments[T];return Promise.all(this.handlers.map((n=>n.apply(this,k))))}remove(n){const k=this.handlers.indexOf(n);this.handlers[k]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}k.EventEmitter=T,k.createSignal=function(){const n=new T;function k(k){return n.register(k,null===this)}return k.once=k=>{const T=function(){for(var c=arguments.length,K=new Array(c),Q=0;Q<c;Q++)K[Q]=arguments[Q];k.apply(this,K),n.remove(T)};n.register(T)},k.remove=k=>n.remove(k),k.invoke=function(){return n.invoke(...arguments)},k.invokeAsync=function(){return n.invokeAsync(...arguments)},k.clear=()=>n.clear(),k}},11873:(n,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.ServerError=k.CloseCode=void 0,function(n){n[n.CONSENTED=4e3]="CONSENTED",n[n.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(k.CloseCode||(k.CloseCode={}));class T extends Error{constructor(n,k){super(k),this.name="ServerError",this.code=n}}k.ServerError=T},11847:(n,k,T)=>{"use strict";k.d=void 0,T(11852);var c=T(11860);Object.defineProperty(k,"d",{enumerable:!0,get:function(){return c.Client}});var K=T(11907);var Q=T(11881);var G=T(11930);const w=T(11936);const E=T(11938),I=T(11909);(0,I.registerSerializer)("schema",w.SchemaSerializer),(0,I.registerSerializer)("none",E.NoneSerializer)},11852:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=n=>null!==n&&"object"===typeof n&&n.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11888:(n,k)=>{"use strict";function T(n,k){if(this._offset=k,n instanceof ArrayBuffer)this._buffer=n,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(n))throw new Error("Invalid argument");this._buffer=n.buffer,this._view=new DataView(this._buffer,n.byteOffset,n.byteLength)}}Object.defineProperty(k,"__esModule",{value:!0}),k.decode=k.encode=void 0,T.prototype._array=function(n){for(var k=new Array(n),T=0;T<n;T++)k[T]=this._parse();return k},T.prototype._map=function(n){for(var k={},T=0;T<n;T++)k[this._parse()]=this._parse();return k},T.prototype._str=function(n){var k=function(n,k,T){for(var c="",K=0,Q=k,G=k+T;Q<G;Q++){var w=n.getUint8(Q);if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(K=(7&w)<<18|(63&n.getUint8(++Q))<<12|(63&n.getUint8(++Q))<<6|63&n.getUint8(++Q))>=65536?(K-=65536,c+=String.fromCharCode(55296+(K>>>10),56320+(1023&K))):c+=String.fromCharCode(K)}else c+=String.fromCharCode((15&w)<<12|(63&n.getUint8(++Q))<<6|63&n.getUint8(++Q));else c+=String.fromCharCode((31&w)<<6|63&n.getUint8(++Q));else c+=String.fromCharCode(w)}return c}(this._view,this._offset,n);return this._offset+=n,k},T.prototype._bin=function(n){var k=this._buffer.slice(this._offset,this._offset+n);return this._offset+=n,k},T.prototype._parse=function(){var n,k=this._view.getUint8(this._offset++),T=0,c=0,K=0,Q=0;if(k<192)return k<128?k:k<144?this._map(15&k):k<160?this._array(15&k):this._str(31&k);if(k>223)return-1*(255-k+1);switch(k){case 192:return null;case 194:return!1;case 195:return!0;case 196:return T=this._view.getUint8(this._offset),this._offset+=1,this._bin(T);case 197:return T=this._view.getUint16(this._offset),this._offset+=2,this._bin(T);case 198:return T=this._view.getUint32(this._offset),this._offset+=4,this._bin(T);case 199:if(T=this._view.getUint8(this._offset),c=this._view.getInt8(this._offset+1),this._offset+=2,-1===c){var G=this._view.getUint32(this._offset);return K=this._view.getInt32(this._offset+4),Q=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*K+Q)+G/1e6)}return[c,this._bin(T)];case 200:return T=this._view.getUint16(this._offset),c=this._view.getInt8(this._offset+2),this._offset+=3,[c,this._bin(T)];case 201:return T=this._view.getUint32(this._offset),c=this._view.getInt8(this._offset+4),this._offset+=5,[c,this._bin(T)];case 202:return n=this._view.getFloat32(this._offset),this._offset+=4,n;case 203:return n=this._view.getFloat64(this._offset),this._offset+=8,n;case 204:return n=this._view.getUint8(this._offset),this._offset+=1,n;case 205:return n=this._view.getUint16(this._offset),this._offset+=2,n;case 206:return n=this._view.getUint32(this._offset),this._offset+=4,n;case 207:return K=this._view.getUint32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,K+Q;case 208:return n=this._view.getInt8(this._offset),this._offset+=1,n;case 209:return n=this._view.getInt16(this._offset),this._offset+=2,n;case 210:return n=this._view.getInt32(this._offset),this._offset+=4,n;case 211:return K=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,K+Q;case 212:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?void(this._offset+=1):[c,this._bin(1)];case 213:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(2)];case 214:return c=this._view.getInt8(this._offset),this._offset+=1,-1===c?(n=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*n)):[c,this._bin(4)];case 215:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?(K=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(K+Q)):-1===c?(K=this._view.getUint32(this._offset),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&K)+Q)+(K>>>2)/1e6)):[c,this._bin(8)];case 216:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(16)];case 217:return T=this._view.getUint8(this._offset),this._offset+=1,this._str(T);case 218:return T=this._view.getUint16(this._offset),this._offset+=2,this._str(T);case 219:return T=this._view.getUint32(this._offset),this._offset+=4,this._str(T);case 220:return T=this._view.getUint16(this._offset),this._offset+=2,this._array(T);case 221:return T=this._view.getUint32(this._offset),this._offset+=4,this._array(T);case 222:return T=this._view.getUint16(this._offset),this._offset+=2,this._map(T);case 223:return T=this._view.getUint32(this._offset),this._offset+=4,this._map(T)}throw new Error("Could not parse")},k.decode=function(n){var k=new T(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),c=k._parse();if(k._offset!==n.byteLength)throw new Error(n.byteLength-k._offset+" trailing bytes");return c};function c(n,k,T){for(var c=0,K=0,Q=T.length;K<Q;K++)(c=T.charCodeAt(K))<128?n.setUint8(k++,c):c<2048?(n.setUint8(k++,192|c>>6),n.setUint8(k++,128|63&c)):c<55296||c>=57344?(n.setUint8(k++,224|c>>12),n.setUint8(k++,128|c>>6&63),n.setUint8(k++,128|63&c)):(K++,c=65536+((1023&c)<<10|1023&T.charCodeAt(K)),n.setUint8(k++,240|c>>18),n.setUint8(k++,128|c>>12&63),n.setUint8(k++,128|c>>6&63),n.setUint8(k++,128|63&c))}function K(n,k,T){var c=typeof T,Q=0,G=0,w=0,E=0,I=0,S=0;if("string"===c){if(I=function(n){for(var k=0,T=0,c=0,K=n.length;c<K;c++)(k=n.charCodeAt(c))<128?T+=1:k<2048?T+=2:k<55296||k>=57344?T+=3:(c++,T+=4);return T}(T),I<32)n.push(160|I),S=1;else if(I<256)n.push(217,I),S=2;else if(I<65536)n.push(218,I>>8,I),S=3;else{if(!(I<4294967296))throw new Error("String too long");n.push(219,I>>24,I>>16,I>>8,I),S=5}return k.push({_str:T,_length:I,_offset:n.length}),S+I}if("number"===c)return Math.floor(T)===T&&isFinite(T)?T>=0?T<128?(n.push(T),1):T<256?(n.push(204,T),2):T<65536?(n.push(205,T>>8,T),3):T<4294967296?(n.push(206,T>>24,T>>16,T>>8,T),5):(w=T/Math.pow(2,32)|0,E=T>>>0,n.push(207,w>>24,w>>16,w>>8,w,E>>24,E>>16,E>>8,E),9):T>=-32?(n.push(T),1):T>=-128?(n.push(208,T),2):T>=-32768?(n.push(209,T>>8,T),3):T>=-2147483648?(n.push(210,T>>24,T>>16,T>>8,T),5):(w=Math.floor(T/Math.pow(2,32)),E=T>>>0,n.push(211,w>>24,w>>16,w>>8,w,E>>24,E>>16,E>>8,E),9):(n.push(203),k.push({_float:T,_length:8,_offset:n.length}),9);if("object"===c){if(null===T)return n.push(192),1;if(Array.isArray(T)){if((I=T.length)<16)n.push(144|I),S=1;else if(I<65536)n.push(220,I>>8,I),S=3;else{if(!(I<4294967296))throw new Error("Array too large");n.push(221,I>>24,I>>16,I>>8,I),S=5}for(Q=0;Q<I;Q++)S+=K(n,k,T[Q]);return S}if(T instanceof Date){var P=T.getTime(),W=Math.floor(P/1e3),J=1e6*(P-1e3*W);return W>=0&&J>=0&&W<=17179869183?0===J&&W<=4294967295?(n.push(214,255,W>>24,W>>16,W>>8,W),6):(w=W/4294967296,E=4294967295&W,n.push(215,255,J>>22,J>>14,J>>6,w,E>>24,E>>16,E>>8,E),10):(w=Math.floor(W/4294967296),E=W>>>0,n.push(199,12,255,J>>24,J>>16,J>>8,J,w>>24,w>>16,w>>8,w,E>>24,E>>16,E>>8,E),15)}if(T instanceof ArrayBuffer){if((I=T.byteLength)<256)n.push(196,I),S=2;else if(I<65536)n.push(197,I>>8,I),S=3;else{if(!(I<4294967296))throw new Error("Buffer too large");n.push(198,I>>24,I>>16,I>>8,I),S=5}return k.push({_bin:T,_length:I,_offset:n.length}),S+I}if("function"===typeof T.toJSON)return K(n,k,T.toJSON());var H=[],s="",b=Object.keys(T);for(Q=0,G=b.length;Q<G;Q++)void 0!==T[s=b[Q]]&&"function"!==typeof T[s]&&H.push(s);if((I=H.length)<16)n.push(128|I),S=1;else if(I<65536)n.push(222,I>>8,I),S=3;else{if(!(I<4294967296))throw new Error("Object too large");n.push(223,I>>24,I>>16,I>>8,I),S=5}for(Q=0;Q<I;Q++)S+=K(n,k,s=H[Q]),S+=K(n,k,T[s]);return S}if("boolean"===c)return n.push(T?195:194),1;if("undefined"===c)return n.push(192),1;if("function"===typeof T.toJSON)return K(n,k,T.toJSON());throw new Error("Could not encode")}k.encode=function(n){var k=[],T=[],Q=K(k,T,n),G=new ArrayBuffer(Q),w=new DataView(G),E=0,I=0,S=-1;T.length>0&&(S=T[0]._offset);for(var P,W=0,J=0,H=0,s=k.length;H<s;H++)if(w.setUint8(I+H,k[H]),H+1===S){if(W=(P=T[E])._length,J=I+S,P._bin)for(var b=new Uint8Array(P._bin),C=0;C<W;C++)w.setUint8(J+C,b[C]);else P._str?c(w,J,P._str):void 0!==P._float&&w.setFloat64(J,P._float);I+=W,T[++E]&&(S=T[E]._offset)}return G}},11938:(n,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.NoneSerializer=void 0;k.NoneSerializer=class{setState(n){}getState(){return null}patch(n){}teardown(){}handshake(n){}}},11936:(n,k,T)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.SchemaSerializer=void 0;const c=T(11926);k.SchemaSerializer=class{setState(n){return this.state.decode(n)}getState(){return this.state}patch(n){return this.state.decode(n)}teardown(){var n,k;null===(k=null===(n=this.state)||void 0===n?void 0:n.$changes)||void 0===k||k.root.clearRefs()}handshake(n,k){if(this.state){(new c.Reflection).decode(n,k)}else this.state=c.Reflection.decode(n,k)}}},11909:(n,k)=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0}),k.getSerializer=k.registerSerializer=void 0;const T={};k.registerSerializer=function(n,k){T[n]=k},k.getSerializer=function(n){const k=T[n];if(!k)throw new Error("missing serializer: "+n);return k}},11898:function(n,k,T){"use strict";var c=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(k,"__esModule",{value:!0}),k.WebSocketTransport=void 0;const K=c(T(11900)),Q=globalThis.WebSocket||K.default;k.WebSocketTransport=class{constructor(n){this.events=n}send(n){n instanceof ArrayBuffer?this.ws.send(n):Array.isArray(n)&&this.ws.send(new Uint8Array(n).buffer)}connect(n){this.ws=new Q(n,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(n,k){this.ws.close(n,k)}get isOpen(){return this.ws.readyState===Q.OPEN}}},11900:n=>{"use strict";n.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12069:n=>{"use strict";n.exports=function(n){for(var k=new Array(n),T=0;T<n;++T)k[T]=T;return k}},12072:n=>{function k(n){return!!n.constructor&&"function"===typeof n.constructor.isBuffer&&n.constructor.isBuffer(n)}n.exports=function(n){return null!=n&&(k(n)||function(n){return"function"===typeof n.readFloatLE&&"function"===typeof n.slice&&k(n.slice(0,0))}(n)||!!n._isBuffer)}},12063:(n,k,T)=>{var c=T(12069),K=T(12072),Q="undefined"!==typeof Float64Array;function G(n,k){return n[0]-k[0]}function w(){var n,k=this.stride,T=new Array(k.length);for(n=0;n<T.length;++n)T[n]=[Math.abs(k[n]),n];T.sort(G);var c=new Array(T.length);for(n=0;n<c.length;++n)c[n]=T[n][1];return c}function E(n,k){var T=["View",k,"d",n].join("");k<0&&(T="View_Nil"+n);var K="generic"===n;if(-1===k){var Q="function "+T+"(a){this.data=a;};var proto="+T+".prototype;proto.dtype='"+n+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+T+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+T+"(a){return new "+T+"(a);}";return new Function(Q)()}if(0===k){Q="function "+T+"(a,d) {this.data = a;this.offset = d};var proto="+T+".prototype;proto.dtype='"+n+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+T+"_copy() {return new "+T+"(this.data,this.offset)};proto.pick=function "+T+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+T+"_get(){return "+(K?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+T+"_set(v){return "+(K?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+T+"(a,b,c,d){return new "+T+"(a,d)}";return new Function("TrivialArray",Q)(I[n][0])}Q=["'use strict'"];var G=c(k),E=G.map((function(n){return"i"+n})),S="this.offset+"+G.map((function(n){return"this.stride["+n+"]*i"+n})).join("+"),P=G.map((function(n){return"b"+n})).join(","),W=G.map((function(n){return"c"+n})).join(",");Q.push("function "+T+"(a,"+P+","+W+",d){this.data=a","this.shape=["+P+"]","this.stride=["+W+"]","this.offset=d|0}","var proto="+T+".prototype","proto.dtype='"+n+"'","proto.dimension="+k),Q.push("Object.defineProperty(proto,'size',{get:function "+T+"_size(){return "+G.map((function(n){return"this.shape["+n+"]"})).join("*"),"}})"),1===k?Q.push("proto.order=[0]"):(Q.push("Object.defineProperty(proto,'order',{get:"),k<4?(Q.push("function "+T+"_order(){"),2===k?Q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===k&&Q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Q.push("ORDER})")),Q.push("proto.set=function "+T+"_set("+E.join(",")+",v){"),K?Q.push("return this.data.set("+S+",v)}"):Q.push("return this.data["+S+"]=v}"),Q.push("proto.get=function "+T+"_get("+E.join(",")+"){"),K?Q.push("return this.data.get("+S+")}"):Q.push("return this.data["+S+"]}"),Q.push("proto.index=function "+T+"_index(",E.join(),"){return "+S+"}"),Q.push("proto.hi=function "+T+"_hi("+E.join(",")+"){return new "+T+"(this.data,"+G.map((function(n){return["(typeof i",n,"!=='number'||i",n,"<0)?this.shape[",n,"]:i",n,"|0"].join("")})).join(",")+","+G.map((function(n){return"this.stride["+n+"]"})).join(",")+",this.offset)}");var J=G.map((function(n){return"a"+n+"=this.shape["+n+"]"})),H=G.map((function(n){return"c"+n+"=this.stride["+n+"]"}));Q.push("proto.lo=function "+T+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+H.join(","));for(var s=0;s<k;++s)Q.push("if(typeof i"+s+"==='number'&&i"+s+">=0){d=i"+s+"|0;b+=c"+s+"*d;a"+s+"-=d}");Q.push("return new "+T+"(this.data,"+G.map((function(n){return"a"+n})).join(",")+","+G.map((function(n){return"c"+n})).join(",")+",b)}"),Q.push("proto.step=function "+T+"_step("+E.join(",")+"){var "+G.map((function(n){return"a"+n+"=this.shape["+n+"]"})).join(",")+","+G.map((function(n){return"b"+n+"=this.stride["+n+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(s=0;s<k;++s)Q.push("if(typeof i"+s+"==='number'){d=i"+s+"|0;if(d<0){c+=b"+s+"*(a"+s+"-1);a"+s+"=ceil(-a"+s+"/d)}else{a"+s+"=ceil(a"+s+"/d)}b"+s+"*=d}");Q.push("return new "+T+"(this.data,"+G.map((function(n){return"a"+n})).join(",")+","+G.map((function(n){return"b"+n})).join(",")+",c)}");var b=new Array(k),C=new Array(k);for(s=0;s<k;++s)b[s]="a[i"+s+"]",C[s]="b[i"+s+"]";Q.push("proto.transpose=function "+T+"_transpose("+E+"){"+E.map((function(n,k){return n+"=("+n+"===undefined?"+k+":"+n+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+T+"(this.data,"+b.join(",")+","+C.join(",")+",this.offset)}"),Q.push("proto.pick=function "+T+"_pick("+E+"){var a=[],b=[],c=this.offset");for(s=0;s<k;++s)Q.push("if(typeof i"+s+"==='number'&&i"+s+">=0){c=(c+this.stride["+s+"]*i"+s+")|0}else{a.push(this.shape["+s+"]);b.push(this.stride["+s+"])}");return Q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Q.push("return function construct_"+T+"(data,shape,stride,offset){return new "+T+"(data,"+G.map((function(n){return"shape["+n+"]"})).join(",")+","+G.map((function(n){return"stride["+n+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Q.join("\n"))(I[n],w)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};n.exports=function(n,k,T,c){if(void 0===n)return(0,I.array[0])([]);"number"===typeof n&&(n=[n]),void 0===k&&(k=[n.length]);var G=k.length;if(void 0===T){T=new Array(G);for(var w=G-1,S=1;w>=0;--w)T[w]=S,S*=k[w]}if(void 0===c){c=0;for(w=0;w<G;++w)T[w]<0&&(c-=(k[w]-1)*T[w])}for(var P=function(n){if(K(n))return"buffer";if(Q)switch(Object.prototype.toString.call(n)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(n)?"array":"generic"}(n),W=I[P];W.length<=G+1;)W.push(E(P,W.length-1));return(0,W[G+1])(n,k,T,c)}},13010:n=>{var k;self,k=()=>(()=>{"use strict";var n={d:(k,T)=>{for(var c in T)n.o(T,c)&&!n.o(k,c)&&Object.defineProperty(k,c,{enumerable:!0,get:T[c]})},o:(n,k)=>Object.prototype.hasOwnProperty.call(n,k)},k={};n.d(k,{default:()=>Y});var T,c=function(n,k){var T=k.x-n.x,c=k.y-n.y;return Math.sqrt(T*T+c*c)},K=function(n){return n*(Math.PI/180)},Q=new Map,G=function(n){Q.has(n)&&clearTimeout(Q.get(n)),Q.set(n,setTimeout(n,100))},w=function(n,k,T){for(var c,K=k.split(/[ ,]+/g),Q=0;Q<K.length;Q+=1)c=K[Q],n.addEventListener?n.addEventListener(c,T,!1):n.attachEvent&&n.attachEvent(c,T)},E=function(n,k,T){for(var c,K=k.split(/[ ,]+/g),Q=0;Q<K.length;Q+=1)c=K[Q],n.removeEventListener?n.removeEventListener(c,T):n.detachEvent&&n.detachEvent(c,T)},I=function(n){return n.preventDefault(),n.type.match(/^touch/)?n.changedTouches:n},S=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},P=function(n,k){k.top||k.right||k.bottom||k.left?(n.style.top=k.top,n.style.right=k.right,n.style.bottom=k.bottom,n.style.left=k.left):(n.style.left=k.x+"px",n.style.top=k.y+"px")},W=function(n,k,T){var c=J(n);for(var K in c)if(c.hasOwnProperty(K))if("string"==typeof k)c[K]=k+" "+T;else{for(var Q="",G=0,w=k.length;G<w;G+=1)Q+=k[G]+" "+T+", ";c[K]=Q.slice(0,-2)}return c},J=function(n){var k={};return k[n]="",["webkit","Moz","o"].forEach((function(T){k[T+n.charAt(0).toUpperCase()+n.slice(1)]=""})),k},H=function(n,k){for(var T in k)k.hasOwnProperty(T)&&(n[T]=k[T]);return n},s=function(n,k){if(n.length)for(var T=0,c=n.length;T<c;T+=1)k(n[T]);else k(n)},b="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,C=window.matchMedia("(any-hover: none)").matches,z=!!("ontouchstart"in window),r=!!window.PointerEvent,q=!!window.MSPointerEvent,O={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},u={start:"mousedown",move:"mousemove",end:"mouseup"},f={};function A(){}b&&!C?T=O:r?T={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:q?T={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:z?(T=O,f=u):T=u,A.prototype.on=function(n,k){var T,c=this,K=n.split(/[ ,]+/g);c._handlers_=c._handlers_||{};for(var Q=0;Q<K.length;Q+=1)T=K[Q],c._handlers_[T]=c._handlers_[T]||[],c._handlers_[T].push(k);return c},A.prototype.off=function(n,k){var T=this;return T._handlers_=T._handlers_||{},void 0===n?T._handlers_={}:void 0===k?T._handlers_[n]=null:T._handlers_[n]&&T._handlers_[n].indexOf(k)>=0&&T._handlers_[n].splice(T._handlers_[n].indexOf(k),1),T},A.prototype.trigger=function(n,k){var T,c=this,K=n.split(/[ ,]+/g);c._handlers_=c._handlers_||{};for(var Q=0;Q<K.length;Q+=1)T=K[Q],c._handlers_[T]&&c._handlers_[T].length&&c._handlers_[T].forEach((function(n){n.call(c,{type:T,target:c},k)}))},A.prototype.config=function(n){var k=this;k.options=k.defaults||{},n&&(k.options=function(n,k){var T={};for(var c in n)n.hasOwnProperty(c)&&k.hasOwnProperty(c)?T[c]=k[c]:n.hasOwnProperty(c)&&(T[c]=n[c]);return T}(k.options,n))},A.prototype.bindEvt=function(n,k){var c=this;return c._domHandlers_=c._domHandlers_||{},c._domHandlers_[k]=function(){"function"==typeof c["on"+k]?c["on"+k].apply(c,arguments):console.warn('[WARNING] : Missing "on'+k+'" handler.')},w(n,T[k],c._domHandlers_[k]),f[k]&&w(n,f[k],c._domHandlers_[k]),c},A.prototype.unbindEvt=function(n,k){var c=this;return c._domHandlers_=c._domHandlers_||{},E(n,T[k],c._domHandlers_[k]),f[k]&&E(n,f[k],c._domHandlers_[k]),delete c._domHandlers_[k],this};const v=A;function F(n,k){return this.identifier=k.identifier,this.position=k.position,this.frontPosition=k.frontPosition,this.collection=n,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(k),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=F.id,F.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}F.prototype=new v,F.constructor=F,F.id=0,F.prototype.buildEl=function(n){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},F.prototype.stylize=function(){if(this.options.dataOnly)return this;var n=this.options.fadeTime+"ms",k=function(){var n=J("borderRadius");for(var k in n)n.hasOwnProperty(k)&&(n[k]="50%");return n}(),T=W("transition","opacity",n),c={};return c.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},c.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},c.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},H(c.el,T),"circle"===this.options.shape&&H(c.back,k),H(c.front,k),this.applyStyles(c),this},F.prototype.applyStyles=function(n){for(var k in this.ui)if(this.ui.hasOwnProperty(k))for(var T in n[k])this.ui[k].style[T]=n[k][T];return this},F.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},F.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},F.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},F.prototype.show=function(n){var k=this;return k.options.dataOnly||(clearTimeout(k.removeTimeout),clearTimeout(k.showTimeout),clearTimeout(k.restTimeout),k.addToDom(),k.restCallback(),setTimeout((function(){k.ui.el.style.opacity=1}),0),k.showTimeout=setTimeout((function(){k.trigger("shown",k.instance),"function"==typeof n&&n.call(this)}),k.options.fadeTime)),k},F.prototype.hide=function(n){var k=this;if(k.options.dataOnly)return k;if(k.ui.el.style.opacity=k.options.restOpacity,clearTimeout(k.removeTimeout),clearTimeout(k.showTimeout),clearTimeout(k.restTimeout),k.removeTimeout=setTimeout((function(){var T="dynamic"===k.options.mode?"none":"block";k.ui.el.style.display=T,"function"==typeof n&&n.call(k),k.trigger("hidden",k.instance)}),k.options.fadeTime),k.options.restJoystick){var T=k.options.restJoystick,c={};c.x=!0===T||!1!==T.x?0:k.instance.frontPosition.x,c.y=!0===T||!1!==T.y?0:k.instance.frontPosition.y,k.setPosition(n,c)}return k},F.prototype.setPosition=function(n,k){var T=this;T.frontPosition={x:k.x,y:k.y};var c=T.options.fadeTime+"ms",K={};K.front=W("transition",["transform"],c);var Q={front:{}};Q.front={transform:"translate("+T.frontPosition.x+"px,"+T.frontPosition.y+"px)"},T.applyStyles(K),T.applyStyles(Q),T.restTimeout=setTimeout((function(){"function"==typeof n&&n.call(T),T.restCallback()}),T.options.fadeTime)},F.prototype.restCallback=function(){var n=this,k={};k.front=W("transition","none",""),n.applyStyles(k),n.trigger("rested",n.instance)},F.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},F.prototype.computeDirection=function(n){var k,T,c,K=n.angle.radian,Q=Math.PI/4,G=Math.PI/2;if(K>Q&&K<3*Q&&!n.lockX?k="up":K>-Q&&K<=Q&&!n.lockY?k="left":K>3*-Q&&K<=-Q&&!n.lockX?k="down":n.lockY||(k="right"),n.lockY||(T=K>-G&&K<G?"left":"right"),n.lockX||(c=K>0?"up":"down"),n.force>this.options.threshold){var w,E={};for(w in this.direction)this.direction.hasOwnProperty(w)&&(E[w]=this.direction[w]);var I={};for(w in this.direction={x:T,y:c,angle:k},n.direction=this.direction,E)E[w]===this.direction[w]&&(I[w]=!0);if(I.x&&I.y&&I.angle)return n;I.x&&I.y||this.trigger("plain",n),I.x||this.trigger("plain:"+T,n),I.y||this.trigger("plain:"+c,n),I.angle||this.trigger("dir dir:"+k,n)}else this.resetDirection();return n};const m=F;function x(n,k){var T=this;T.nipples=[],T.idles=[],T.actives=[],T.ids=[],T.pressureIntervals={},T.manager=n,T.id=x.id,x.id+=1,T.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},T.config(k),"static"!==T.options.mode&&"semi"!==T.options.mode||(T.options.multitouch=!1),T.options.multitouch||(T.options.maxNumberOfNipples=1);var c=getComputedStyle(T.options.zone.parentElement);return c&&"flex"===c.display&&(T.parentIsFlex=!0),T.updateBox(),T.prepareNipples(),T.Ml(),T.begin(),T.nipples}x.prototype=new v,x.constructor=x,x.id=0,x.prototype.prepareNipples=function(){var n=this,k=n.nipples;k.on=n.on.bind(n),k.off=n.off.bind(n),k.options=n.options,k.destroy=n.destroy.bind(n),k.ids=n.ids,k.id=n.id,k.processOnMove=n.processOnMove.bind(n),k.processOnEnd=n.processOnEnd.bind(n),k.get=function(n){if(void 0===n)return k[0];for(var T=0,c=k.length;T<c;T+=1)if(k[T].identifier===n)return k[T];return!1}},x.prototype.Ml=function(){var n=this;n.bindEvt(n.options.zone,"start"),n.options.zone.style.touchAction="none",n.options.zone.style.msTouchAction="none"},x.prototype.begin=function(){var n=this,k=n.options;if("static"===k.mode){var T=n.createNipple(k.position,n.manager.getIdentifier());T.add(),n.idles.push(T)}},x.prototype.createNipple=function(n,k){var T=this,c=T.manager.scroll,K={},Q=T.options,G=T.parentIsFlex?c.x:c.x+T.box.left,w=T.parentIsFlex?c.y:c.y+T.box.top;if(n.x&&n.y)K={x:n.x-G,y:n.y-w};else if(n.top||n.right||n.bottom||n.left){var E=document.createElement("DIV");E.style.display="hidden",E.style.top=n.top,E.style.right=n.right,E.style.bottom=n.bottom,E.style.left=n.left,E.style.position="absolute",Q.zone.appendChild(E);var I=E.getBoundingClientRect();Q.zone.removeChild(E),K=n,n={x:I.left+c.x,y:I.top+c.y}}var S=new m(T,{color:Q.color,size:Q.size,threshold:Q.threshold,fadeTime:Q.fadeTime,dataOnly:Q.dataOnly,restJoystick:Q.restJoystick,restOpacity:Q.restOpacity,mode:Q.mode,identifier:k,position:n,zone:Q.zone,frontPosition:{x:0,y:0},shape:Q.shape});return Q.dataOnly||(P(S.ui.el,K),P(S.ui.front,S.frontPosition)),T.nipples.push(S),T.trigger("added "+S.identifier+":added",S),T.manager.trigger("added "+S.identifier+":added",S),T.bindNipple(S),S},x.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},x.prototype.bindNipple=function(n){var k,T=this,c=function(n,c){k=n.type+" "+c.id+":"+n.type,T.trigger(k,c)};n.on("destroyed",T.onDestroyed.bind(T)),n.on("shown hidden rested dir plain",c),n.on("dir:up dir:right dir:down dir:left",c),n.on("plain:up plain:right plain:down plain:left",c)},x.prototype.pressureFn=function(n,k,T){var c=this,K=0;clearInterval(c.pressureIntervals[T]),c.pressureIntervals[T]=setInterval(function(){var T=n.force||n.pressure||n.webkitForce||0;T!==K&&(k.trigger("pressure",T),c.trigger("pressure "+k.identifier+":pressure",T),K=T)}.bind(c),100)},x.prototype.onstart=function(n){var k=this,T=k.options,c=n;return n=I(n),k.updateBox(),s(n,(function(K){k.actives.length<T.maxNumberOfNipples?k.processOnStart(K):c.type.match(/^touch/)&&(Object.keys(k.manager.ids).forEach((function(T){if(Object.values(c.touches).findIndex((function(n){return n.identifier===T}))<0){var K=[n[0]];K.identifier=T,k.processOnEnd(K)}})),k.actives.length<T.maxNumberOfNipples&&k.processOnStart(K))})),k.manager.bindDocument(),!1},x.prototype.processOnStart=function(n){var k,T=this,K=T.options,Q=T.manager.getIdentifier(n),G=n.force||n.pressure||n.webkitForce||0,w={x:n.pageX,y:n.pageY},E=T.getOrCreate(Q,w);E.identifier!==Q&&T.manager.removeIdentifier(E.identifier),E.identifier=Q;var I=function(k){k.trigger("start",k),T.trigger("start "+k.id+":start",k),k.show(),G>0&&T.pressureFn(n,k,k.identifier),T.processOnMove(n)};if((k=T.idles.indexOf(E))>=0&&T.idles.splice(k,1),T.actives.push(E),T.ids.push(E.identifier),"semi"!==K.mode)I(E);else{if(!(c(w,E.position)<=K.catchDistance))return E.destroy(),void T.processOnStart(n);I(E)}return E},x.prototype.getOrCreate=function(n,k){var T,c=this,K=c.options;return/(semi|static)/.test(K.mode)?(T=c.idles[0])?(c.idles.splice(0,1),T):"semi"===K.mode?c.createNipple(k,n):(console.warn("Coudln't find the needed nipple."),!1):T=c.createNipple(k,n)},x.prototype.processOnMove=function(n){var k=this,T=k.options,Q=k.manager.getIdentifier(n),G=k.nipples.get(Q),w=k.manager.scroll;if(function(n){return isNaN(n.buttons)?0!==n.pressure:0!==n.buttons}(n)){if(!G)return console.error("Found zombie joystick with ID "+Q),void k.manager.removeIdentifier(Q);if(T.dynamicPage){var E=G.el.getBoundingClientRect();G.position={x:w.x+E.left,y:w.y+E.top}}G.identifier=Q;var I=G.options.size/2,S={x:n.pageX,y:n.pageY};T.lockX&&(S.y=G.position.y),T.lockY&&(S.x=G.position.x);var P,W,J,H,s,b,C,z,r,q,O=c(S,G.position),u=(P=S,J=(W=G.position).x-P.x,H=W.y-P.y,function(n){return n*(180/Math.PI)}(Math.atan2(H,J))),f=K(u),A=O/I,v={distance:O,position:S};if("circle"===G.options.shape?(s=Math.min(O,I),C=G.position,z=s,q={x:0,y:0},r=K(r=u),q.x=C.x-z*Math.cos(r),q.y=C.y-z*Math.sin(r),b=q):(b=function(n,k,T){return{x:Math.min(Math.max(n.x,k.x-T),k.x+T),y:Math.min(Math.max(n.y,k.y-T),k.y+T)}}(S,G.position,I),s=c(b,G.position)),T.follow){if(O>I){var F=S.x-b.x,m=S.y-b.y;G.position.x+=F,G.position.y+=m,G.el.style.top=G.position.y-(k.box.top+w.y)+"px",G.el.style.left=G.position.x-(k.box.left+w.x)+"px",O=c(S,G.position)}}else S=b,O=s;var x=S.x-G.position.x,g=S.y-G.position.y;G.frontPosition={x:x,y:g},T.dataOnly||(G.ui.front.style.transform="translate("+x+"px,"+g+"px)");var U={identifier:G.identifier,position:S,force:A,pressure:n.force||n.pressure||n.webkitForce||0,distance:O,angle:{radian:f,degree:u},vector:{x:x/I,y:-g/I},raw:v,instance:G,lockX:T.lockX,lockY:T.lockY};(U=G.computeDirection(U)).angle={radian:K(180-u),degree:180-u},G.trigger("move",U),k.trigger("move "+G.id+":move",U)}else this.processOnEnd(n)},x.prototype.processOnEnd=function(n){var k=this,T=k.options,c=k.manager.getIdentifier(n),K=k.nipples.get(c),Q=k.manager.removeIdentifier(K.identifier);K&&(T.dataOnly||K.hide((function(){"dynamic"===T.mode&&(K.trigger("removed",K),k.trigger("removed "+K.id+":removed",K),k.manager.trigger("removed "+K.id+":removed",K),K.destroy())})),clearInterval(k.pressureIntervals[K.identifier]),K.resetDirection(),K.trigger("end",K),k.trigger("end "+K.id+":end",K),k.ids.indexOf(K.identifier)>=0&&k.ids.splice(k.ids.indexOf(K.identifier),1),k.actives.indexOf(K)>=0&&k.actives.splice(k.actives.indexOf(K),1),/(semi|static)/.test(T.mode)?k.idles.push(K):k.nipples.indexOf(K)>=0&&k.nipples.splice(k.nipples.indexOf(K),1),k.manager.unbindDocument(),/(semi|static)/.test(T.mode)&&(k.manager.ids[Q.id]=Q.identifier))},x.prototype.onDestroyed=function(n,k){var T=this;T.nipples.indexOf(k)>=0&&T.nipples.splice(T.nipples.indexOf(k),1),T.actives.indexOf(k)>=0&&T.actives.splice(T.actives.indexOf(k),1),T.idles.indexOf(k)>=0&&T.idles.splice(T.idles.indexOf(k),1),T.ids.indexOf(k.identifier)>=0&&T.ids.splice(T.ids.indexOf(k.identifier),1),T.manager.removeIdentifier(k.identifier),T.manager.unbindDocument()},x.prototype.destroy=function(){var n=this;for(var k in n.unbindEvt(n.options.zone,"start"),n.nipples.forEach((function(n){n.destroy()})),n.pressureIntervals)n.pressureIntervals.hasOwnProperty(k)&&clearInterval(n.pressureIntervals[k]);n.trigger("destroyed",n.nipples),n.manager.unbindDocument(),n.off()};const g=x;function U(n){var k=this;k.ids={},k.index=0,k.collections=[],k.scroll=S(),k.config(n),k.prepareCollections();var T=function(){var n;k.collections.forEach((function(T){T.forEach((function(T){n=T.el.getBoundingClientRect(),T.position={x:k.scroll.x+n.left,y:k.scroll.y+n.top}}))}))};w(window,"resize",(function(){G(T)}));var c=function(){k.scroll=S()};return w(window,"scroll",(function(){G(c)})),k.collections}U.prototype=new v,U.constructor=U,U.prototype.prepareCollections=function(){var n=this;n.collections.create=n.create.bind(n),n.collections.on=n.on.bind(n),n.collections.off=n.off.bind(n),n.collections.destroy=n.destroy.bind(n),n.collections.get=function(k){var T;return n.collections.every((function(n){return!(T=n.get(k))})),T}},U.prototype.create=function(n){return this.createCollection(n)},U.prototype.createCollection=function(n){var k=this,T=new g(k,n);return k.bindCollection(T),k.collections.push(T),T},U.prototype.bindCollection=function(n){var k,T=this,c=function(n,c){k=n.type+" "+c.id+":"+n.type,T.trigger(k,c)};n.on("destroyed",T.onDestroyed.bind(T)),n.on("shown hidden rested dir plain",c),n.on("dir:up dir:right dir:down dir:left",c),n.on("plain:up plain:right plain:down plain:left",c)},U.prototype.bindDocument=function(){var n=this;n.binded||(n.bindEvt(document,"move").bindEvt(document,"end"),n.binded=!0)},U.prototype.unbindDocument=function(n){var k=this;Object.keys(k.ids).length&&!0!==n||(k.unbindEvt(document,"move").unbindEvt(document,"end"),k.binded=!1)},U.prototype.getIdentifier=function(n){var k;return n?void 0===(k=void 0===n.identifier?n.pointerId:n.identifier)&&(k=this.latest||0):k=this.index,void 0===this.ids[k]&&(this.ids[k]=this.index,this.index+=1),this.latest=k,this.ids[k]},U.prototype.removeIdentifier=function(n){var k={};for(var T in this.ids)if(this.ids[T]===n){k.id=T,k.identifier=this.ids[T],delete this.ids[T];break}return k},U.prototype.onmove=function(n){return this.onAny("move",n),!1},U.prototype.onend=function(n){return this.onAny("end",n),!1},U.prototype.oncancel=function(n){return this.onAny("end",n),!1},U.prototype.onAny=function(n,k){var T,c=this,K="processOn"+n.charAt(0).toUpperCase()+n.slice(1);k=I(k);var Q=function(n,k,T){T.ids.indexOf(k)>=0&&(T[K](n),n._found_=!0)};return s(k,(function(n){T=c.getIdentifier(n),s(c.collections,Q.bind(null,n,T)),n._found_||c.removeIdentifier(T)})),!1},U.prototype.destroy=function(){var n=this;n.unbindDocument(!0),n.ids={},n.index=0,n.collections.forEach((function(n){n.destroy()})),n.off()},U.prototype.onDestroyed=function(n,k){var T=this;if(T.collections.indexOf(k)<0)return!1;T.collections.splice(T.collections.indexOf(k),1)};var V=new U;const Y={create:function(n){return V.create(n)},factory:V};return k.default})(),n.exports=k()},12099:(n,k,T)=>{"use strict";const{Deflate:c,deflate:K,deflateRaw:Q,gzip:G}=T(12105),{Inflate:w,inflate:E,inflateRaw:I,ungzip:S}=T(12171),P=T(12146);n.exports.Deflate=c,n.exports.deflate=K,n.exports.deflateRaw=Q,n.exports.gzip=G,n.exports.Inflate=w,n.exports.inflate=E,n.exports.inflateRaw=I,n.exports.ungzip=S,n.exports.constants=P},12105:(n,k,T)=>{"use strict";const c=T(12113),K=T(12154),Q=T(12159),G=T(12141),w=T(12166),E=Object.prototype.toString,{Z_NO_FLUSH:I,Z_SYNC_FLUSH:S,Z_FULL_FLUSH:P,Z_FINISH:W,Z_OK:J,Z_STREAM_END:H,Z_DEFAULT_COMPRESSION:s,Z_DEFAULT_STRATEGY:b,Z_DEFLATED:C}=T(12146);function z(n){this.options=K.assign({level:s,method:C,Ja:16384,windowBits:15,memLevel:8,strategy:b},n||{});let k=this.options;k.raw&&k.windowBits>0?k.windowBits=-k.windowBits:k.gzip&&k.windowBits>0&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let T=c.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(T!==J)throw new Error(G[T]);if(k.header&&c.deflateSetHeader(this.strm,k.header),k.dictionary){let n;if(n="string"===typeof k.dictionary?Q.string2buf(k.dictionary):"[object ArrayBuffer]"===E.call(k.dictionary)?new Uint8Array(k.dictionary):k.dictionary,T=c.deflateSetDictionary(this.strm,n),T!==J)throw new Error(G[T]);this._dict_set=!0}}function r(n,k){const T=new z(k);if(T.push(n,!0),T.err)throw T.msg||G[T.err];return T.result}z.prototype.push=function(n,k){const T=this.strm,K=this.options.Ja;let G,w;if(this.ended)return!1;for(w=k===~~k?k:!0===k?W:I,"string"===typeof n?T.input=Q.string2buf(n):"[object ArrayBuffer]"===E.call(n)?T.input=new Uint8Array(n):T.input=n,T.next_in=0,T.avail_in=T.input.length;;)if(0===T.avail_out&&(T.output=new Uint8Array(K),T.next_out=0,T.avail_out=K),(w===S||w===P)&&T.avail_out<=6)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else{if(G=c.deflate(T,w),G===H)return T.next_out>0&&this.onData(T.output.subarray(0,T.next_out)),G=c.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===J;if(0!==T.avail_out){if(w>0&&T.next_out>0)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else if(0===T.avail_in)break}else this.onData(T.output)}return!0},z.prototype.onData=function(n){this.chunks.push(n)},z.prototype.onEnd=function(n){n===J&&(this.result=K.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg},n.exports.Deflate=z,n.exports.deflate=r,n.exports.deflateRaw=function(n,k){return(k=k||{}).raw=!0,r(n,k)},n.exports.gzip=function(n,k){return(k=k||{}).gzip=!0,r(n,k)},n.exports.constants=T(12146)},12171:(n,k,T)=>{"use strict";const c=T(12178),K=T(12154),Q=T(12159),G=T(12141),w=T(12166),E=T(12194),I=Object.prototype.toString,{Z_NO_FLUSH:S,Z_FINISH:P,Z_OK:W,Z_STREAM_END:J,Z_NEED_DICT:H,Z_STREAM_ERROR:s,Z_DATA_ERROR:b,Z_MEM_ERROR:C}=T(12146);function z(n){this.options=K.assign({Ja:65536,windowBits:15,to:""},n||{});const k=this.options;k.raw&&k.windowBits>=0&&k.windowBits<16&&(k.windowBits=-k.windowBits,0===k.windowBits&&(k.windowBits=-15)),!(k.windowBits>=0&&k.windowBits<16)||n&&n.windowBits||(k.windowBits+=32),k.windowBits>15&&k.windowBits<48&&0===(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let T=c.inflateInit2(this.strm,k.windowBits);if(T!==W)throw new Error(G[T]);if(this.header=new E,c.inflateGetHeader(this.strm,this.header),k.dictionary&&("string"===typeof k.dictionary?k.dictionary=Q.string2buf(k.dictionary):"[object ArrayBuffer]"===I.call(k.dictionary)&&(k.dictionary=new Uint8Array(k.dictionary)),k.raw&&(T=c.inflateSetDictionary(this.strm,k.dictionary),T!==W)))throw new Error(G[T])}function r(n,k){const T=new z(k);if(T.push(n),T.err)throw T.msg||G[T.err];return T.result}z.prototype.push=function(n,k){const T=this.strm,K=this.options.Ja,G=this.options.dictionary;let w,E,z;if(this.ended)return!1;for(E=k===~~k?k:!0===k?P:S,"[object ArrayBuffer]"===I.call(n)?T.input=new Uint8Array(n):T.input=n,T.next_in=0,T.avail_in=T.input.length;;){for(0===T.avail_out&&(T.output=new Uint8Array(K),T.next_out=0,T.avail_out=K),w=c.inflate(T,E),w===H&&G&&(w=c.inflateSetDictionary(T,G),w===W?w=c.inflate(T,E):w===b&&(w=H));T.avail_in>0&&w===J&&T.state.wrap>0&&0!==n[T.next_in];)c.inflateReset(T),w=c.inflate(T,E);switch(w){case s:case b:case H:case C:return this.onEnd(w),this.ended=!0,!1}if(z=T.avail_out,T.next_out&&(0===T.avail_out||w===J))if("string"===this.options.to){let n=Q.utf8border(T.output,T.next_out),k=T.next_out-n,c=Q.buf2string(T.output,n);T.next_out=k,T.avail_out=K-k,k&&T.output.set(T.output.subarray(n,n+k),0),this.onData(c)}else this.onData(T.output.length===T.next_out?T.output:T.output.subarray(0,T.next_out));if(w!==W||0!==z){if(w===J)return w=c.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,!0;if(0===T.avail_in)break}}return!0},z.prototype.onData=function(n){this.chunks.push(n)},z.prototype.onEnd=function(n){n===W&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=K.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg},n.exports.Inflate=z,n.exports.inflate=r,n.exports.inflateRaw=function(n,k){return(k=k||{}).raw=!0,r(n,k)},n.exports.ungzip=r,n.exports.constants=T(12146)},12154:n=>{"use strict";const k=(n,k)=>Object.prototype.hasOwnProperty.call(n,k);n.exports.assign=function(n){const T=Array.prototype.slice.call(arguments,1);for(;T.length;){const c=T.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(const T in c)k(c,T)&&(n[T]=c[T])}}return n},n.exports.flattenChunks=n=>{let k=0;for(let c=0,K=n.length;c<K;c++)k+=n[c].length;const T=new Uint8Array(k);for(let c=0,K=0,Q=n.length;c<Q;c++){let k=n[c];T.set(k,K),K+=k.length}return T}},12159:n=>{"use strict";let k=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(c){k=!1}const T=new Uint8Array(256);for(let K=0;K<256;K++)T[K]=K>=252?6:K>=248?5:K>=240?4:K>=224?3:K>=192?2:1;T[254]=T[254]=1,n.exports.string2buf=n=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(n);let k,T,c,K,Q,G=n.length,w=0;for(K=0;K<G;K++)T=n.charCodeAt(K),55296===(64512&T)&&K+1<G&&(c=n.charCodeAt(K+1),56320===(64512&c)&&(T=65536+(T-55296<<10)+(c-56320),K++)),w+=T<128?1:T<2048?2:T<65536?3:4;for(k=new Uint8Array(w),Q=0,K=0;Q<w;K++)T=n.charCodeAt(K),55296===(64512&T)&&K+1<G&&(c=n.charCodeAt(K+1),56320===(64512&c)&&(T=65536+(T-55296<<10)+(c-56320),K++)),T<128?k[Q++]=T:T<2048?(k[Q++]=192|T>>>6,k[Q++]=128|63&T):T<65536?(k[Q++]=224|T>>>12,k[Q++]=128|T>>>6&63,k[Q++]=128|63&T):(k[Q++]=240|T>>>18,k[Q++]=128|T>>>12&63,k[Q++]=128|T>>>6&63,k[Q++]=128|63&T);return k};n.exports.buf2string=(n,c)=>{const K=c||n.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(n.subarray(0,c));let Q,G;const w=new Array(2*K);for(G=0,Q=0;Q<K;){let k=n[Q++];if(k<128){w[G++]=k;continue}let c=T[k];if(c>4)w[G++]=65533,Q+=c-1;else{for(k&=2===c?31:3===c?15:7;c>1&&Q<K;)k=k<<6|63&n[Q++],c--;c>1?w[G++]=65533:k<65536?w[G++]=k:(k-=65536,w[G++]=55296|k>>10&1023,w[G++]=56320|1023&k)}}return((n,T)=>{if(T<65534&&n.subarray&&k)return String.fromCharCode.apply(null,n.length===T?n:n.subarray(0,T));let c="";for(let k=0;k<T;k++)c+=String.fromCharCode(n[k]);return c})(w,G)},n.exports.utf8border=(n,k)=>{(k=k||n.length)>n.length&&(k=n.length);let c=k-1;for(;c>=0&&128===(192&n[c]);)c--;return c<0||0===c?k:c+T[n[c]]>k?c:k}},12131:n=>{"use strict";n.exports=(n,k,T,c)=>{let K=65535&n,Q=n>>>16&65535,G=0;for(;0!==T;){G=T>2e3?2e3:T,T-=G;do{K=K+k[c++]|0,Q=Q+K|0}while(--G);K%=65521,Q%=65521}return K|Q<<16}},12146:n=>{"use strict";n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12139:n=>{"use strict";const k=new Uint32Array((()=>{let n,k=[];for(var T=0;T<256;T++){n=T;for(var c=0;c<8;c++)n=1&n?3988292384^n>>>1:n>>>1;k[T]=n}return k})());n.exports=(n,T,c,K)=>{const Q=k,G=K+c;n^=-1;for(let k=K;k<G;k++)n=n>>>8^Q[255&(n^T[k])];return~n}},12113:(n,k,T)=>{"use strict";const{_tr_init:c,_tr_stored_block:K,_tr_flush_block:Q,_tr_tally:G,_tr_align:w}=T(12122),E=T(12131),I=T(12139),S=T(12141),{Z_NO_FLUSH:P,Z_PARTIAL_FLUSH:W,Z_FULL_FLUSH:J,Z_FINISH:H,Z_BLOCK:s,Z_OK:b,Z_STREAM_END:C,Z_STREAM_ERROR:z,Z_DATA_ERROR:r,Z_BUF_ERROR:q,Z_DEFAULT_COMPRESSION:O,Z_FILTERED:u,Z_HUFFMAN_ONLY:f,Z_RLE:A,Z_FIXED:v,Z_DEFAULT_STRATEGY:F,Z_UNKNOWN:m,Z_DEFLATED:x}=T(12146),g=258,U=262,V=103,Y=113,Z=666,e=(n,k)=>(n.msg=S[k],k),d=n=>(n<<1)-(n>4?9:0),l=n=>{let k=n.length;for(;--k>=0;)n[k]=0};let i=(n,k,T)=>(k<<n.hash_shift^T)&n.hash_mask;const B=n=>{const k=n.state;let T=k.pending;T>n.avail_out&&(T=n.avail_out),0!==T&&(n.output.set(k.pending_buf.subarray(k.pending_out,k.pending_out+T),n.next_out),n.next_out+=T,k.pending_out+=T,n.total_out+=T,n.avail_out-=T,k.pending-=T,0===k.pending&&(k.pending_out=0))},t=(n,k)=>{Q(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,k),n.block_start=n.strstart,B(n.strm)},M=(n,k)=>{n.pending_buf[n.pending++]=k},o=(n,k)=>{n.pending_buf[n.pending++]=k>>>8&255,n.pending_buf[n.pending++]=255&k},D=(n,k,T,c)=>{let K=n.avail_in;return K>c&&(K=c),0===K?0:(n.avail_in-=K,k.set(n.input.subarray(n.next_in,n.next_in+K),T),1===n.state.wrap?n.adler=E(n.adler,k,K,T):2===n.state.wrap&&(n.adler=I(n.adler,k,K,T)),n.next_in+=K,n.total_in+=K,K)},R=(n,k)=>{let T,c,K=n.max_chain_length,Q=n.strstart,G=n.prev_length,w=n.nice_match;const E=n.strstart>n.w_size-U?n.strstart-(n.w_size-U):0,I=n.window,S=n.w_mask,P=n.prev,W=n.strstart+g;let J=I[Q+G-1],H=I[Q+G];n.prev_length>=n.good_match&&(K>>=2),w>n.lookahead&&(w=n.lookahead);do{if(T=k,I[T+G]===H&&I[T+G-1]===J&&I[T]===I[Q]&&I[++T]===I[Q+1]){Q+=2,T++;do{}while(I[++Q]===I[++T]&&I[++Q]===I[++T]&&I[++Q]===I[++T]&&I[++Q]===I[++T]&&I[++Q]===I[++T]&&I[++Q]===I[++T]&&I[++Q]===I[++T]&&I[++Q]===I[++T]&&Q<W);if(c=g-(W-Q),Q=W-g,c>G){if(n.match_start=k,G=c,c>=w)break;J=I[Q+G-1],H=I[Q+G]}}}while((k=P[k&S])>E&&0!==--K);return G<=n.lookahead?G:n.lookahead},L=n=>{const k=n.w_size;let T,c,K,Q,G;do{if(Q=n.window_size-n.lookahead-n.strstart,n.strstart>=k+(k-U)){n.window.set(n.window.subarray(k,k+k),0),n.match_start-=k,n.strstart-=k,n.block_start-=k,c=n.hash_size,T=c;do{K=n.head[--T],n.head[T]=K>=k?K-k:0}while(--c);c=k,T=c;do{K=n.prev[--T],n.prev[T]=K>=k?K-k:0}while(--c);Q+=k}if(0===n.strm.avail_in)break;if(c=D(n.strm,n.window,n.strstart+n.lookahead,Q),n.lookahead+=c,n.lookahead+n.insert>=3)for(G=n.strstart-n.insert,n.ins_h=n.window[G],n.ins_h=i(n,n.ins_h,n.window[G+1]);n.insert&&(n.ins_h=i(n,n.ins_h,n.window[G+3-1]),n.prev[G&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=G,G++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<U&&0!==n.strm.avail_in)},h=(n,k)=>{let T,c;for(;;){if(n.lookahead<U){if(L(n),n.lookahead<U&&k===P)return 1;if(0===n.lookahead)break}if(T=0,n.lookahead>=3&&(n.ins_h=i(n,n.ins_h,n.window[n.strstart+3-1]),T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),0!==T&&n.strstart-T<=n.w_size-U&&(n.match_length=R(n,T)),n.match_length>=3)if(c=G(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do{n.strstart++,n.ins_h=i(n,n.ins_h,n.window[n.strstart+3-1]),T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart}while(0!==--n.match_length);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=i(n,n.ins_h,n.window[n.strstart+1]);else c=G(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(c&&(t(n,!1),0===n.strm.avail_out))return 1}return n.insert=n.strstart<2?n.strstart:2,k===H?(t(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(t(n,!1),0===n.strm.avail_out)?1:2},j=(n,k)=>{let T,c,K;for(;;){if(n.lookahead<U){if(L(n),n.lookahead<U&&k===P)return 1;if(0===n.lookahead)break}if(T=0,n.lookahead>=3&&(n.ins_h=i(n,n.ins_h,n.window[n.strstart+3-1]),T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,0!==T&&n.prev_length<n.max_lazy_match&&n.strstart-T<=n.w_size-U&&(n.match_length=R(n,T),n.match_length<=5&&(n.strategy===u||3===n.match_length&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){K=n.strstart+n.lookahead-3,c=G(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do{++n.strstart<=K&&(n.ins_h=i(n,n.ins_h,n.window[n.strstart+3-1]),T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart)}while(0!==--n.prev_length);if(n.match_available=0,n.match_length=2,n.strstart++,c&&(t(n,!1),0===n.strm.avail_out))return 1}else if(n.match_available){if(c=G(n,0,n.window[n.strstart-1]),c&&t(n,!1),n.strstart++,n.lookahead--,0===n.strm.avail_out)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(c=G(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,k===H?(t(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(t(n,!1),0===n.strm.avail_out)?1:2};function p(n,k,T,c,K){this.good_length=n,this.max_lazy=k,this.nice_length=T,this.max_chain=c,this.func=K}const a=[new p(0,0,0,0,((n,k)=>{let T=65535;for(T>n.pending_buf_size-5&&(T=n.pending_buf_size-5);;){if(n.lookahead<=1){if(L(n),0===n.lookahead&&k===P)return 1;if(0===n.lookahead)break}n.strstart+=n.lookahead,n.lookahead=0;const c=n.block_start+T;if((0===n.strstart||n.strstart>=c)&&(n.lookahead=n.strstart-c,n.strstart=c,t(n,!1),0===n.strm.avail_out))return 1;if(n.strstart-n.block_start>=n.w_size-U&&(t(n,!1),0===n.strm.avail_out))return 1}return n.insert=0,k===H?(t(n,!0),0===n.strm.avail_out?3:4):(n.strstart>n.block_start&&(t(n,!1),n.strm.avail_out),1)})),new p(4,4,8,4,h),new p(4,5,16,8,h),new p(4,6,32,32,h),new p(4,4,16,16,j),new p(8,16,32,32,j),new p(8,16,128,128,j),new p(8,32,128,256,j),new p(32,128,258,1024,j),new p(32,258,258,4096,j)];function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),l(this.dyn_ltree),l(this.dyn_dtree),l(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),l(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),l(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const y=n=>{if(!n||!n.state)return e(n,z);n.total_in=n.total_out=0,n.data_type=m;const k=n.state;return k.pending=0,k.pending_out=0,k.wrap<0&&(k.wrap=-k.wrap),k.status=k.wrap?42:Y,n.adler=2===k.wrap?0:1,k.last_flush=P,c(k),b},N=n=>{const k=y(n);var T;return k===b&&((T=n.state).window_size=2*T.w_size,l(T.head),T.max_lazy_match=a[T.level].max_lazy,T.good_match=a[T.level].good_length,T.nice_match=a[T.level].nice_length,T.max_chain_length=a[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=2,T.match_available=0,T.ins_h=0),k},nn=(n,k,T,c,K,Q)=>{if(!n)return z;let G=1;if(k===O&&(k=6),c<0?(G=0,c=-c):c>15&&(G=2,c-=16),K<1||K>9||T!==x||c<8||c>15||k<0||k>9||Q<0||Q>v)return e(n,z);8===c&&(c=9);const w=new X;return n.state=w,w.strm=n,w.wrap=G,w.gzhead=null,w.w_bits=c,w.w_size=1<<w.w_bits,w.w_mask=w.w_size-1,w.hash_bits=K+7,w.hash_size=1<<w.hash_bits,w.hash_mask=w.hash_size-1,w.hash_shift=~~((w.hash_bits+3-1)/3),w.window=new Uint8Array(2*w.w_size),w.head=new Uint16Array(w.hash_size),w.prev=new Uint16Array(w.w_size),w.lit_bufsize=1<<K+6,w.pending_buf_size=4*w.lit_bufsize,w.pending_buf=new Uint8Array(w.pending_buf_size),w.d_buf=1*w.lit_bufsize,w.l_buf=3*w.lit_bufsize,w.level=k,w.strategy=Q,w.method=T,N(n)};n.exports.deflateInit=(n,k)=>nn(n,k,x,15,8,F),n.exports.deflateInit2=nn,n.exports.deflateReset=N,n.exports.deflateResetKeep=y,n.exports.deflateSetHeader=(n,k)=>n&&n.state?2!==n.state.wrap?z:(n.state.gzhead=k,b):z,n.exports.deflate=(n,k)=>{let T,c;if(!n||!n.state||k>s||k<0)return n?e(n,z):z;const Q=n.state;if(!n.output||!n.input&&0!==n.avail_in||Q.status===Z&&k!==H)return e(n,0===n.avail_out?q:z);Q.strm=n;const E=Q.last_flush;if(Q.last_flush=k,42===Q.status)if(2===Q.wrap)n.adler=0,M(Q,31),M(Q,139),M(Q,8),Q.gzhead?(M(Q,(Q.gzhead.text?1:0)+(Q.gzhead.hcrc?2:0)+(Q.gzhead.extra?4:0)+(Q.gzhead.name?8:0)+(Q.gzhead.comment?16:0)),M(Q,255&Q.gzhead.time),M(Q,Q.gzhead.time>>8&255),M(Q,Q.gzhead.time>>16&255),M(Q,Q.gzhead.time>>24&255),M(Q,9===Q.level?2:Q.strategy>=f||Q.level<2?4:0),M(Q,255&Q.gzhead.os),Q.gzhead.extra&&Q.gzhead.extra.length&&(M(Q,255&Q.gzhead.extra.length),M(Q,Q.gzhead.extra.length>>8&255)),Q.gzhead.hcrc&&(n.adler=I(n.adler,Q.pending_buf,Q.pending,0)),Q.gzindex=0,Q.status=69):(M(Q,0),M(Q,0),M(Q,0),M(Q,0),M(Q,0),M(Q,9===Q.level?2:Q.strategy>=f||Q.level<2?4:0),M(Q,3),Q.status=Y);else{let k=x+(Q.w_bits-8<<4)<<8,T=-1;T=Q.strategy>=f||Q.level<2?0:Q.level<6?1:6===Q.level?2:3,k|=T<<6,0!==Q.strstart&&(k|=32),k+=31-k%31,Q.status=Y,o(Q,k),0!==Q.strstart&&(o(Q,n.adler>>>16),o(Q,65535&n.adler)),n.adler=1}if(69===Q.status)if(Q.gzhead.extra){for(T=Q.pending;Q.gzindex<(65535&Q.gzhead.extra.length)&&(Q.pending!==Q.pending_buf_size||(Q.gzhead.hcrc&&Q.pending>T&&(n.adler=I(n.adler,Q.pending_buf,Q.pending-T,T)),B(n),T=Q.pending,Q.pending!==Q.pending_buf_size));)M(Q,255&Q.gzhead.extra[Q.gzindex]),Q.gzindex++;Q.gzhead.hcrc&&Q.pending>T&&(n.adler=I(n.adler,Q.pending_buf,Q.pending-T,T)),Q.gzindex===Q.gzhead.extra.length&&(Q.gzindex=0,Q.status=73)}else Q.status=73;if(73===Q.status)if(Q.gzhead.name){T=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>T&&(n.adler=I(n.adler,Q.pending_buf,Q.pending-T,T)),B(n),T=Q.pending,Q.pending===Q.pending_buf_size)){c=1;break}c=Q.gzindex<Q.gzhead.name.length?255&Q.gzhead.name.charCodeAt(Q.gzindex++):0,M(Q,c)}while(0!==c);Q.gzhead.hcrc&&Q.pending>T&&(n.adler=I(n.adler,Q.pending_buf,Q.pending-T,T)),0===c&&(Q.gzindex=0,Q.status=91)}else Q.status=91;if(91===Q.status)if(Q.gzhead.comment){T=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>T&&(n.adler=I(n.adler,Q.pending_buf,Q.pending-T,T)),B(n),T=Q.pending,Q.pending===Q.pending_buf_size)){c=1;break}c=Q.gzindex<Q.gzhead.comment.length?255&Q.gzhead.comment.charCodeAt(Q.gzindex++):0,M(Q,c)}while(0!==c);Q.gzhead.hcrc&&Q.pending>T&&(n.adler=I(n.adler,Q.pending_buf,Q.pending-T,T)),0===c&&(Q.status=V)}else Q.status=V;if(Q.status===V&&(Q.gzhead.hcrc?(Q.pending+2>Q.pending_buf_size&&B(n),Q.pending+2<=Q.pending_buf_size&&(M(Q,255&n.adler),M(Q,n.adler>>8&255),n.adler=0,Q.status=Y)):Q.status=Y),0!==Q.pending){if(B(n),0===n.avail_out)return Q.last_flush=-1,b}else if(0===n.avail_in&&d(k)<=d(E)&&k!==H)return e(n,q);if(Q.status===Z&&0!==n.avail_in)return e(n,q);if(0!==n.avail_in||0!==Q.lookahead||k!==P&&Q.status!==Z){let T=Q.strategy===f?((n,k)=>{let T;for(;;){if(0===n.lookahead&&(L(n),0===n.lookahead)){if(k===P)return 1;break}if(n.match_length=0,T=G(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++,T&&(t(n,!1),0===n.strm.avail_out))return 1}return n.insert=0,k===H?(t(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(t(n,!1),0===n.strm.avail_out)?1:2})(Q,k):Q.strategy===A?((n,k)=>{let T,c,K,Q;const w=n.window;for(;;){if(n.lookahead<=g){if(L(n),n.lookahead<=g&&k===P)return 1;if(0===n.lookahead)break}if(n.match_length=0,n.lookahead>=3&&n.strstart>0&&(K=n.strstart-1,c=w[K],c===w[++K]&&c===w[++K]&&c===w[++K])){Q=n.strstart+g;do{}while(c===w[++K]&&c===w[++K]&&c===w[++K]&&c===w[++K]&&c===w[++K]&&c===w[++K]&&c===w[++K]&&c===w[++K]&&K<Q);n.match_length=g-(Q-K),n.match_length>n.lookahead&&(n.match_length=n.lookahead)}if(n.match_length>=3?(T=G(n,1,n.match_length-3),n.lookahead-=n.match_length,n.strstart+=n.match_length,n.match_length=0):(T=G(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++),T&&(t(n,!1),0===n.strm.avail_out))return 1}return n.insert=0,k===H?(t(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(t(n,!1),0===n.strm.avail_out)?1:2})(Q,k):a[Q.level].func(Q,k);if(3!==T&&4!==T||(Q.status=Z),1===T||3===T)return 0===n.avail_out&&(Q.last_flush=-1),b;if(2===T&&(k===W?w(Q):k!==s&&(K(Q,0,0,!1),k===J&&(l(Q.head),0===Q.lookahead&&(Q.strstart=0,Q.block_start=0,Q.insert=0))),B(n),0===n.avail_out))return Q.last_flush=-1,b}return k!==H?b:Q.wrap<=0?C:(2===Q.wrap?(M(Q,255&n.adler),M(Q,n.adler>>8&255),M(Q,n.adler>>16&255),M(Q,n.adler>>24&255),M(Q,255&n.total_in),M(Q,n.total_in>>8&255),M(Q,n.total_in>>16&255),M(Q,n.total_in>>24&255)):(o(Q,n.adler>>>16),o(Q,65535&n.adler)),B(n),Q.wrap>0&&(Q.wrap=-Q.wrap),0!==Q.pending?b:C)},n.exports.deflateEnd=n=>{if(!n||!n.state)return z;const k=n.state.status;return 42!==k&&69!==k&&73!==k&&91!==k&&k!==V&&k!==Y&&k!==Z?e(n,z):(n.state=null,k===Y?e(n,r):b)},n.exports.deflateSetDictionary=(n,k)=>{let T=k.length;if(!n||!n.state)return z;const c=n.state,K=c.wrap;if(2===K||1===K&&42!==c.status||c.lookahead)return z;if(1===K&&(n.adler=E(n.adler,k,T,0)),c.wrap=0,T>=c.w_size){0===K&&(l(c.head),c.strstart=0,c.block_start=0,c.insert=0);let n=new Uint8Array(c.w_size);n.set(k.subarray(T-c.w_size,T),0),k=n,T=c.w_size}const Q=n.avail_in,G=n.next_in,w=n.input;for(n.avail_in=T,n.next_in=0,n.input=k,L(c);c.lookahead>=3;){let n=c.strstart,k=c.lookahead-2;do{c.ins_h=i(c,c.ins_h,c.window[n+3-1]),c.prev[n&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=n,n++}while(--k);c.strstart=n,c.lookahead=2,L(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=2,c.match_available=0,n.next_in=G,n.input=w,n.avail_in=Q,c.wrap=K,b},n.exports.deflateInfo="pako deflate (from Nodeca project)"},12194:n=>{"use strict";n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12182:n=>{"use strict";n.exports=function(n,k){let T,c,K,Q,G,w,E,I,S,P,W,J,H,s,b,C,z,r,q,O,u,f,A,v;const F=n.state;T=n.next_in,A=n.input,c=T+(n.avail_in-5),K=n.next_out,v=n.output,Q=K-(k-n.avail_out),G=K+(n.avail_out-257),w=F.dmax,E=F.wsize,I=F.whave,S=F.wnext,P=F.window,W=F.hold,J=F.bits,H=F.lencode,s=F.distcode,b=(1<<F.lenbits)-1,C=(1<<F.distbits)-1;n:do{J<15&&(W+=A[T++]<<J,J+=8,W+=A[T++]<<J,J+=8),z=H[W&b];k:for(;;){if(r=z>>>24,W>>>=r,J-=r,r=z>>>16&255,0===r)v[K++]=65535&z;else{if(!(16&r)){if(0===(64&r)){z=H[(65535&z)+(W&(1<<r)-1)];continue k}if(32&r){F.mode=12;break n}n.msg="invalid literal/length code",F.mode=30;break n}q=65535&z,r&=15,r&&(J<r&&(W+=A[T++]<<J,J+=8),q+=W&(1<<r)-1,W>>>=r,J-=r),J<15&&(W+=A[T++]<<J,J+=8,W+=A[T++]<<J,J+=8),z=s[W&C];T:for(;;){if(r=z>>>24,W>>>=r,J-=r,r=z>>>16&255,!(16&r)){if(0===(64&r)){z=s[(65535&z)+(W&(1<<r)-1)];continue T}n.msg="invalid distance code",F.mode=30;break n}if(O=65535&z,r&=15,J<r&&(W+=A[T++]<<J,J+=8,J<r&&(W+=A[T++]<<J,J+=8)),O+=W&(1<<r)-1,O>w){n.msg="invalid distance too far back",F.mode=30;break n}if(W>>>=r,J-=r,r=K-Q,O>r){if(r=O-r,r>I&&F.sane){n.msg="invalid distance too far back",F.mode=30;break n}if(u=0,f=P,0===S){if(u+=E-r,r<q){q-=r;do{v[K++]=P[u++]}while(--r);u=K-O,f=v}}else if(S<r){if(u+=E+S-r,r-=S,r<q){q-=r;do{v[K++]=P[u++]}while(--r);if(u=0,S<q){r=S,q-=r;do{v[K++]=P[u++]}while(--r);u=K-O,f=v}}}else if(u+=S-r,r<q){q-=r;do{v[K++]=P[u++]}while(--r);u=K-O,f=v}for(;q>2;)v[K++]=f[u++],v[K++]=f[u++],v[K++]=f[u++],q-=3;q&&(v[K++]=f[u++],q>1&&(v[K++]=f[u++]))}else{u=K-O;do{v[K++]=v[u++],v[K++]=v[u++],v[K++]=v[u++],q-=3}while(q>2);q&&(v[K++]=v[u++],q>1&&(v[K++]=v[u++]))}break}}break}}while(T<c&&K<G);q=J>>3,T-=q,J-=q<<3,W&=(1<<J)-1,n.next_in=T,n.next_out=K,n.avail_in=T<c?c-T+5:5-(T-c),n.avail_out=K<G?G-K+257:257-(K-G),F.hold=W,F.bits=J}},12178:(n,k,T)=>{"use strict";const c=T(12131),K=T(12139),Q=T(12182),G=T(12186),{Z_FINISH:w,Z_BLOCK:E,Z_TREES:I,Z_OK:S,Z_STREAM_END:P,Z_NEED_DICT:W,Z_STREAM_ERROR:J,Z_DATA_ERROR:H,Z_MEM_ERROR:s,Z_BUF_ERROR:b,Z_DEFLATED:C}=T(12146),z=12,r=30,q=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function O(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const u=n=>{if(!n||!n.state)return J;const k=n.state;return n.total_in=n.total_out=k.total=0,n.msg="",k.wrap&&(n.adler=1&k.wrap),k.mode=1,k.last=0,k.havedict=0,k.dmax=32768,k.head=null,k.hold=0,k.bits=0,k.lencode=k.lendyn=new Int32Array(852),k.distcode=k.distdyn=new Int32Array(592),k.sane=1,k.back=-1,S},f=n=>{if(!n||!n.state)return J;const k=n.state;return k.wsize=0,k.whave=0,k.wnext=0,u(n)},A=(n,k)=>{let T;if(!n||!n.state)return J;const c=n.state;return k<0?(T=0,k=-k):(T=1+(k>>4),k<48&&(k&=15)),k&&(k<8||k>15)?J:(null!==c.window&&c.wbits!==k&&(c.window=null),c.wrap=T,c.wbits=k,f(n))},v=(n,k)=>{if(!n)return J;const T=new O;n.state=T,T.window=null;const c=A(n,k);return c!==S&&(n.state=null),c};let F,m,x=!0;const g=n=>{if(x){F=new Int32Array(512),m=new Int32Array(32);let k=0;for(;k<144;)n.lens[k++]=8;for(;k<256;)n.lens[k++]=9;for(;k<280;)n.lens[k++]=7;for(;k<288;)n.lens[k++]=8;for(G(1,n.lens,0,288,F,0,n.work,{bits:9}),k=0;k<32;)n.lens[k++]=5;G(2,n.lens,0,32,m,0,n.work,{bits:5}),x=!1}n.lencode=F,n.lenbits=9,n.distcode=m,n.distbits=5},U=(n,k,T,c)=>{let K;const Q=n.state;return null===Q.window&&(Q.wsize=1<<Q.wbits,Q.wnext=0,Q.whave=0,Q.window=new Uint8Array(Q.wsize)),c>=Q.wsize?(Q.window.set(k.subarray(T-Q.wsize,T),0),Q.wnext=0,Q.whave=Q.wsize):(K=Q.wsize-Q.wnext,K>c&&(K=c),Q.window.set(k.subarray(T-c,T-c+K),Q.wnext),(c-=K)?(Q.window.set(k.subarray(T-c,T),0),Q.wnext=c,Q.whave=Q.wsize):(Q.wnext+=K,Q.wnext===Q.wsize&&(Q.wnext=0),Q.whave<Q.wsize&&(Q.whave+=K))),0};n.exports.inflateReset=f,n.exports.inflateReset2=A,n.exports.inflateResetKeep=u,n.exports.inflateInit=n=>v(n,15),n.exports.inflateInit2=v,n.exports.inflate=(n,k)=>{let T,O,u,f,A,v,F,m,x,V,Y,Z,e,d,l,i,B,t,M,o,D,R,L=0;const h=new Uint8Array(4);let j,p;const a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!n||!n.state||!n.output||!n.input&&0!==n.avail_in)return J;T=n.state,T.mode===z&&(T.mode=13),A=n.next_out,u=n.output,F=n.avail_out,f=n.next_in,O=n.input,v=n.avail_in,m=T.hold,x=T.bits,V=v,Y=F,R=S;n:for(;;)switch(T.mode){case 1:if(0===T.wrap){T.mode=13;break}for(;x<16;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(2&T.wrap&&35615===m){T.check=0,h[0]=255&m,h[1]=m>>>8&255,T.check=K(T.check,h,2,0),m=0,x=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&m)<<8)+(m>>8))%31){n.msg="incorrect header check",T.mode=r;break}if((15&m)!==C){n.msg="unknown compression method",T.mode=r;break}if(m>>>=4,x-=4,D=8+(15&m),0===T.wbits)T.wbits=D;else if(D>T.wbits){n.msg="invalid window size",T.mode=r;break}T.dmax=1<<T.wbits,n.adler=T.check=1,T.mode=512&m?10:z,m=0,x=0;break;case 2:for(;x<16;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(T.flags=m,(255&T.flags)!==C){n.msg="unknown compression method",T.mode=r;break}if(57344&T.flags){n.msg="unknown header flags set",T.mode=r;break}T.head&&(T.head.text=m>>8&1),512&T.flags&&(h[0]=255&m,h[1]=m>>>8&255,T.check=K(T.check,h,2,0)),m=0,x=0,T.mode=3;case 3:for(;x<32;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}T.head&&(T.head.time=m),512&T.flags&&(h[0]=255&m,h[1]=m>>>8&255,h[2]=m>>>16&255,h[3]=m>>>24&255,T.check=K(T.check,h,4,0)),m=0,x=0,T.mode=4;case 4:for(;x<16;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}T.head&&(T.head.xflags=255&m,T.head.os=m>>8),512&T.flags&&(h[0]=255&m,h[1]=m>>>8&255,T.check=K(T.check,h,2,0)),m=0,x=0,T.mode=5;case 5:if(1024&T.flags){for(;x<16;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}T.length=m,T.head&&(T.head.extra_len=m),512&T.flags&&(h[0]=255&m,h[1]=m>>>8&255,T.check=K(T.check,h,2,0)),m=0,x=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(Z=T.length,Z>v&&(Z=v),Z&&(T.head&&(D=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Uint8Array(T.head.extra_len)),T.head.extra.set(O.subarray(f,f+Z),D)),512&T.flags&&(T.check=K(T.check,O,Z,f)),v-=Z,f+=Z,T.length-=Z),T.length))break n;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(0===v)break n;Z=0;do{D=O[f+Z++],T.head&&D&&T.length<65536&&(T.head.name+=String.fromCharCode(D))}while(D&&Z<v);if(512&T.flags&&(T.check=K(T.check,O,Z,f)),v-=Z,f+=Z,D)break n}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(0===v)break n;Z=0;do{D=O[f+Z++],T.head&&D&&T.length<65536&&(T.head.comment+=String.fromCharCode(D))}while(D&&Z<v);if(512&T.flags&&(T.check=K(T.check,O,Z,f)),v-=Z,f+=Z,D)break n}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;x<16;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(m!==(65535&T.check)){n.msg="header crc mismatch",T.mode=r;break}m=0,x=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),n.adler=T.check=0,T.mode=z;break;case 10:for(;x<32;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}n.adler=T.check=q(m),m=0,x=0,T.mode=11;case 11:if(0===T.havedict)return n.next_out=A,n.avail_out=F,n.next_in=f,n.avail_in=v,T.hold=m,T.bits=x,W;n.adler=T.check=1,T.mode=z;case z:if(k===E||k===I)break n;case 13:if(T.last){m>>>=7&x,x-=7&x,T.mode=27;break}for(;x<3;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}switch(T.last=1&m,m>>>=1,x-=1,3&m){case 0:T.mode=14;break;case 1:if(g(T),T.mode=20,k===I){m>>>=2,x-=2;break n}break;case 2:T.mode=17;break;case 3:n.msg="invalid block type",T.mode=r}m>>>=2,x-=2;break;case 14:for(m>>>=7&x,x-=7&x;x<32;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if((65535&m)!==(m>>>16^65535)){n.msg="invalid stored block lengths",T.mode=r;break}if(T.length=65535&m,m=0,x=0,T.mode=15,k===I)break n;case 15:T.mode=16;case 16:if(Z=T.length,Z){if(Z>v&&(Z=v),Z>F&&(Z=F),0===Z)break n;u.set(O.subarray(f,f+Z),A),v-=Z,f+=Z,F-=Z,A+=Z,T.length-=Z;break}T.mode=z;break;case 17:for(;x<14;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(T.nlen=257+(31&m),m>>>=5,x-=5,T.ndist=1+(31&m),m>>>=5,x-=5,T.ncode=4+(15&m),m>>>=4,x-=4,T.nlen>286||T.ndist>30){n.msg="too many length or distance symbols",T.mode=r;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;x<3;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}T.lens[a[T.have++]]=7&m,m>>>=3,x-=3}for(;T.have<19;)T.lens[a[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,j={bits:T.lenbits},R=G(0,T.lens,0,19,T.lencode,0,T.work,j),T.lenbits=j.bits,R){n.msg="invalid code lengths set",T.mode=r;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;L=T.lencode[m&(1<<T.lenbits)-1],l=L>>>24,i=L>>>16&255,B=65535&L,!(l<=x);){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(B<16)m>>>=l,x-=l,T.lens[T.have++]=B;else{if(16===B){for(p=l+2;x<p;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(m>>>=l,x-=l,0===T.have){n.msg="invalid bit length repeat",T.mode=r;break}D=T.lens[T.have-1],Z=3+(3&m),m>>>=2,x-=2}else if(17===B){for(p=l+3;x<p;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}m>>>=l,x-=l,D=0,Z=3+(7&m),m>>>=3,x-=3}else{for(p=l+7;x<p;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}m>>>=l,x-=l,D=0,Z=11+(127&m),m>>>=7,x-=7}if(T.have+Z>T.nlen+T.ndist){n.msg="invalid bit length repeat",T.mode=r;break}for(;Z--;)T.lens[T.have++]=D}}if(T.mode===r)break;if(0===T.lens[256]){n.msg="invalid code -- missing end-of-block",T.mode=r;break}if(T.lenbits=9,j={bits:T.lenbits},R=G(1,T.lens,0,T.nlen,T.lencode,0,T.work,j),T.lenbits=j.bits,R){n.msg="invalid literal/lengths set",T.mode=r;break}if(T.distbits=6,T.distcode=T.distdyn,j={bits:T.distbits},R=G(2,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,j),T.distbits=j.bits,R){n.msg="invalid distances set",T.mode=r;break}if(T.mode=20,k===I)break n;case 20:T.mode=21;case 21:if(v>=6&&F>=258){n.next_out=A,n.avail_out=F,n.next_in=f,n.avail_in=v,T.hold=m,T.bits=x,Q(n,Y),A=n.next_out,u=n.output,F=n.avail_out,f=n.next_in,O=n.input,v=n.avail_in,m=T.hold,x=T.bits,T.mode===z&&(T.back=-1);break}for(T.back=0;L=T.lencode[m&(1<<T.lenbits)-1],l=L>>>24,i=L>>>16&255,B=65535&L,!(l<=x);){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(i&&0===(240&i)){for(t=l,M=i,o=B;L=T.lencode[o+((m&(1<<t+M)-1)>>t)],l=L>>>24,i=L>>>16&255,B=65535&L,!(t+l<=x);){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}m>>>=t,x-=t,T.back+=t}if(m>>>=l,x-=l,T.back+=l,T.length=B,0===i){T.mode=26;break}if(32&i){T.back=-1,T.mode=z;break}if(64&i){n.msg="invalid literal/length code",T.mode=r;break}T.extra=15&i,T.mode=22;case 22:if(T.extra){for(p=T.extra;x<p;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}T.length+=m&(1<<T.extra)-1,m>>>=T.extra,x-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;L=T.distcode[m&(1<<T.distbits)-1],l=L>>>24,i=L>>>16&255,B=65535&L,!(l<=x);){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(0===(240&i)){for(t=l,M=i,o=B;L=T.distcode[o+((m&(1<<t+M)-1)>>t)],l=L>>>24,i=L>>>16&255,B=65535&L,!(t+l<=x);){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}m>>>=t,x-=t,T.back+=t}if(m>>>=l,x-=l,T.back+=l,64&i){n.msg="invalid distance code",T.mode=r;break}T.offset=B,T.extra=15&i,T.mode=24;case 24:if(T.extra){for(p=T.extra;x<p;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}T.offset+=m&(1<<T.extra)-1,m>>>=T.extra,x-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){n.msg="invalid distance too far back",T.mode=r;break}T.mode=25;case 25:if(0===F)break n;if(Z=Y-F,T.offset>Z){if(Z=T.offset-Z,Z>T.whave&&T.sane){n.msg="invalid distance too far back",T.mode=r;break}Z>T.wnext?(Z-=T.wnext,e=T.wsize-Z):e=T.wnext-Z,Z>T.length&&(Z=T.length),d=T.window}else d=u,e=A-T.offset,Z=T.length;Z>F&&(Z=F),F-=Z,T.length-=Z;do{u[A++]=d[e++]}while(--Z);0===T.length&&(T.mode=21);break;case 26:if(0===F)break n;u[A++]=T.length,F--,T.mode=21;break;case 27:if(T.wrap){for(;x<32;){if(0===v)break n;v--,m|=O[f++]<<x,x+=8}if(Y-=F,n.total_out+=Y,T.total+=Y,Y&&(n.adler=T.check=T.flags?K(T.check,u,Y,A-Y):c(T.check,u,Y,A-Y)),Y=F,(T.flags?m:q(m))!==T.check){n.msg="incorrect data check",T.mode=r;break}m=0,x=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;x<32;){if(0===v)break n;v--,m+=O[f++]<<x,x+=8}if(m!==(4294967295&T.total)){n.msg="incorrect length check",T.mode=r;break}m=0,x=0}T.mode=29;case 29:R=P;break n;case r:R=H;break n;case 31:return s;default:return J}return n.next_out=A,n.avail_out=F,n.next_in=f,n.avail_in=v,T.hold=m,T.bits=x,(T.wsize||Y!==n.avail_out&&T.mode<r&&(T.mode<27||k!==w))&&U(n,n.output,n.next_out,Y-n.avail_out)?(T.mode=31,s):(V-=n.avail_in,Y-=n.avail_out,n.total_in+=V,n.total_out+=Y,T.total+=Y,T.wrap&&Y&&(n.adler=T.check=T.flags?K(T.check,u,Y,n.next_out-Y):c(T.check,u,Y,n.next_out-Y)),n.data_type=T.bits+(T.last?64:0)+(T.mode===z?128:0)+(20===T.mode||15===T.mode?256:0),(0===V&&0===Y||k===w)&&R===S&&(R=b),R)},n.exports.inflateEnd=n=>{if(!n||!n.state)return J;let k=n.state;return k.window&&(k.window=null),n.state=null,S},n.exports.inflateGetHeader=(n,k)=>{if(!n||!n.state)return J;const T=n.state;return 0===(2&T.wrap)?J:(T.head=k,k.done=!1,S)},n.exports.inflateSetDictionary=(n,k)=>{const T=k.length;let K,Q,G;return n&&n.state?(K=n.state,0!==K.wrap&&11!==K.mode?J:11===K.mode&&(Q=1,Q=c(Q,k,T,0),Q!==K.check)?H:(G=U(n,k,T,T),G?(K.mode=31,s):(K.havedict=1,S))):J},n.exports.inflateInfo="pako inflate (from Nodeca project)"},12186:n=>{"use strict";const k=15,T=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),c=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),K=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Q=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);n.exports=(n,G,w,E,I,S,P,W)=>{const J=W.bits;let H,s,b,C,z,r,q=0,O=0,u=0,f=0,A=0,v=0,F=0,m=0,x=0,g=0,U=null,V=0;const Y=new Uint16Array(16),Z=new Uint16Array(16);let e,d,l,i=null,B=0;for(q=0;q<=k;q++)Y[q]=0;for(O=0;O<E;O++)Y[G[w+O]]++;for(A=J,f=k;f>=1&&0===Y[f];f--);if(A>f&&(A=f),0===f)return I[S++]=20971520,I[S++]=20971520,W.bits=1,0;for(u=1;u<f&&0===Y[u];u++);for(A<u&&(A=u),m=1,q=1;q<=k;q++)if(m<<=1,m-=Y[q],m<0)return-1;if(m>0&&(0===n||1!==f))return-1;for(Z[1]=0,q=1;q<k;q++)Z[q+1]=Z[q]+Y[q];for(O=0;O<E;O++)0!==G[w+O]&&(P[Z[G[w+O]]++]=O);if(0===n?(U=i=P,r=19):1===n?(U=T,V-=257,i=c,B-=257,r=256):(U=K,i=Q,r=-1),g=0,O=0,q=u,z=S,v=A,F=0,b=-1,x=1<<A,C=x-1,1===n&&x>852||2===n&&x>592)return 1;for(;;){e=q-F,P[O]<r?(d=0,l=P[O]):P[O]>r?(d=i[B+P[O]],l=U[V+P[O]]):(d=96,l=0),H=1<<q-F,s=1<<v,u=s;do{s-=H,I[z+(g>>F)+s]=e<<24|d<<16|l}while(0!==s);for(H=1<<q-1;g&H;)H>>=1;if(0!==H?(g&=H-1,g+=H):g=0,O++,0===--Y[q]){if(q===f)break;q=G[w+P[O]]}if(q>A&&(g&C)!==b){for(0===F&&(F=A),z+=u,v=q-F,m=1<<v;v+F<f&&(m-=Y[v+F],!(m<=0));)v++,m<<=1;if(x+=1<<v,1===n&&x>852||2===n&&x>592)return 1;b=g&C,I[b]=A<<24|v<<16|z-S}}return 0!==g&&(I[z+g]=q-F<<24|64<<16),W.bits=A,0}},12141:n=>{"use strict";n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12122:n=>{"use strict";function k(n){let k=n.length;for(;--k>=0;)n[k]=0}const T=256,c=286,K=30,Q=15,G=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),E=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S=new Array(576);k(S);const P=new Array(60);k(P);const W=new Array(512);k(W);const J=new Array(256);k(J);const H=new Array(29);k(H);const s=new Array(K);function b(n,k,T,c,K){this.static_tree=n,this.extra_bits=k,this.extra_base=T,this.elems=c,this.max_length=K,this.has_stree=n&&n.length}let C,z,r;function q(n,k){this.dyn_tree=n,this.max_code=0,this.stat_desc=k}k(s);const O=n=>n<256?W[n]:W[256+(n>>>7)],u=(n,k)=>{n.pending_buf[n.pending++]=255&k,n.pending_buf[n.pending++]=k>>>8&255},f=(n,k,T)=>{n.bi_valid>16-T?(n.bi_buf|=k<<n.bi_valid&65535,u(n,n.bi_buf),n.bi_buf=k>>16-n.bi_valid,n.bi_valid+=T-16):(n.bi_buf|=k<<n.bi_valid&65535,n.bi_valid+=T)},A=(n,k,T)=>{f(n,T[2*k],T[2*k+1])},v=(n,k)=>{let T=0;do{T|=1&n,n>>>=1,T<<=1}while(--k>0);return T>>>1},F=(n,k,T)=>{const c=new Array(16);let K,G,w=0;for(K=1;K<=Q;K++)c[K]=w=w+T[K-1]<<1;for(G=0;G<=k;G++){let k=n[2*G+1];0!==k&&(n[2*G]=v(c[k]++,k))}},m=n=>{let k;for(k=0;k<c;k++)n.dyn_ltree[2*k]=0;for(k=0;k<K;k++)n.dyn_dtree[2*k]=0;for(k=0;k<19;k++)n.bl_tree[2*k]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.last_lit=n.matches=0},x=n=>{n.bi_valid>8?u(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},g=(n,k,T,c)=>{const K=2*k,Q=2*T;return n[K]<n[Q]||n[K]===n[Q]&&c[k]<=c[T]},U=(n,k,T)=>{const c=n.heap[T];let K=T<<1;for(;K<=n.heap_len&&(K<n.heap_len&&g(k,n.heap[K+1],n.heap[K],n.depth)&&K++,!g(k,c,n.heap[K],n.depth));)n.heap[T]=n.heap[K],T=K,K<<=1;n.heap[T]=c},V=(n,k,c)=>{let K,Q,E,I,S=0;if(0!==n.last_lit)do{K=n.pending_buf[n.d_buf+2*S]<<8|n.pending_buf[n.d_buf+2*S+1],Q=n.pending_buf[n.l_buf+S],S++,0===K?A(n,Q,k):(E=J[Q],A(n,E+T+1,k),I=G[E],0!==I&&(Q-=H[E],f(n,Q,I)),K--,E=O(K),A(n,E,c),I=w[E],0!==I&&(K-=s[E],f(n,K,I)))}while(S<n.last_lit);A(n,256,k)},Y=(n,k)=>{const T=k.dyn_tree,c=k.stat_desc.static_tree,K=k.stat_desc.has_stree,G=k.stat_desc.elems;let w,E,I,S=-1;for(n.heap_len=0,n.heap_max=573,w=0;w<G;w++)0!==T[2*w]?(n.heap[++n.heap_len]=S=w,n.depth[w]=0):T[2*w+1]=0;for(;n.heap_len<2;)I=n.heap[++n.heap_len]=S<2?++S:0,T[2*I]=1,n.depth[I]=0,n.opt_len--,K&&(n.static_len-=c[2*I+1]);for(k.max_code=S,w=n.heap_len>>1;w>=1;w--)U(n,T,w);I=G;do{w=n.heap[1],n.heap[1]=n.heap[n.heap_len--],U(n,T,1),E=n.heap[1],n.heap[--n.heap_max]=w,n.heap[--n.heap_max]=E,T[2*I]=T[2*w]+T[2*E],n.depth[I]=(n.depth[w]>=n.depth[E]?n.depth[w]:n.depth[E])+1,T[2*w+1]=T[2*E+1]=I,n.heap[1]=I++,U(n,T,1)}while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((n,k)=>{const T=k.dyn_tree,c=k.max_code,K=k.stat_desc.static_tree,G=k.stat_desc.has_stree,w=k.stat_desc.extra_bits,E=k.stat_desc.extra_base,I=k.stat_desc.max_length;let S,P,W,J,H,s,b=0;for(J=0;J<=Q;J++)n.bl_count[J]=0;for(T[2*n.heap[n.heap_max]+1]=0,S=n.heap_max+1;S<573;S++)P=n.heap[S],J=T[2*T[2*P+1]+1]+1,J>I&&(J=I,b++),T[2*P+1]=J,P>c||(n.bl_count[J]++,H=0,P>=E&&(H=w[P-E]),s=T[2*P],n.opt_len+=s*(J+H),G&&(n.static_len+=s*(K[2*P+1]+H)));if(0!==b){do{for(J=I-1;0===n.bl_count[J];)J--;n.bl_count[J]--,n.bl_count[J+1]+=2,n.bl_count[I]--,b-=2}while(b>0);for(J=I;0!==J;J--)for(P=n.bl_count[J];0!==P;)W=n.heap[--S],W>c||(T[2*W+1]!==J&&(n.opt_len+=(J-T[2*W+1])*T[2*W],T[2*W+1]=J),P--)}})(n,k),F(T,S,n.bl_count)},Z=(n,k,T)=>{let c,K,Q=-1,G=k[1],w=0,E=7,I=4;for(0===G&&(E=138,I=3),k[2*(T+1)+1]=65535,c=0;c<=T;c++)K=G,G=k[2*(c+1)+1],++w<E&&K===G||(w<I?n.bl_tree[2*K]+=w:0!==K?(K!==Q&&n.bl_tree[2*K]++,n.bl_tree[32]++):w<=10?n.bl_tree[34]++:n.bl_tree[36]++,w=0,Q=K,0===G?(E=138,I=3):K===G?(E=6,I=3):(E=7,I=4))},e=(n,k,T)=>{let c,K,Q=-1,G=k[1],w=0,E=7,I=4;for(0===G&&(E=138,I=3),c=0;c<=T;c++)if(K=G,G=k[2*(c+1)+1],!(++w<E&&K===G)){if(w<I)do{A(n,K,n.bl_tree)}while(0!==--w);else 0!==K?(K!==Q&&(A(n,K,n.bl_tree),w--),A(n,16,n.bl_tree),f(n,w-3,2)):w<=10?(A(n,17,n.bl_tree),f(n,w-3,3)):(A(n,18,n.bl_tree),f(n,w-11,7));w=0,Q=K,0===G?(E=138,I=3):K===G?(E=6,I=3):(E=7,I=4)}};let d=!1;const l=(n,k,T,c)=>{f(n,0+(c?1:0),3),((n,k,T,c)=>{x(n),c&&(u(n,T),u(n,~T)),n.pending_buf.set(n.window.subarray(k,k+T),n.pending),n.pending+=T})(n,k,T,!0)};n.exports._tr_init=n=>{d||((()=>{let n,k,T,I,q;const O=new Array(16);for(T=0,I=0;I<28;I++)for(H[I]=T,n=0;n<1<<G[I];n++)J[T++]=I;for(J[T-1]=I,q=0,I=0;I<16;I++)for(s[I]=q,n=0;n<1<<w[I];n++)W[q++]=I;for(q>>=7;I<K;I++)for(s[I]=q<<7,n=0;n<1<<w[I]-7;n++)W[256+q++]=I;for(k=0;k<=Q;k++)O[k]=0;for(n=0;n<=143;)S[2*n+1]=8,n++,O[8]++;for(;n<=255;)S[2*n+1]=9,n++,O[9]++;for(;n<=279;)S[2*n+1]=7,n++,O[7]++;for(;n<=287;)S[2*n+1]=8,n++,O[8]++;for(F(S,287,O),n=0;n<K;n++)P[2*n+1]=5,P[2*n]=v(n,5);C=new b(S,G,257,c,Q),z=new b(P,w,0,K,Q),r=new b(new Array(0),E,0,19,7)})(),d=!0),n.l_desc=new q(n.dyn_ltree,C),n.d_desc=new q(n.dyn_dtree,z),n.bl_desc=new q(n.bl_tree,r),n.bi_buf=0,n.bi_valid=0,m(n)},n.exports._tr_stored_block=l,n.exports._tr_flush_block=(n,k,c,K)=>{let Q,G,w=0;n.level>0?(2===n.strm.data_type&&(n.strm.data_type=(n=>{let k,c=4093624447;for(k=0;k<=31;k++,c>>>=1)if(1&c&&0!==n.dyn_ltree[2*k])return 0;if(0!==n.dyn_ltree[18]||0!==n.dyn_ltree[20]||0!==n.dyn_ltree[26])return 1;for(k=32;k<T;k++)if(0!==n.dyn_ltree[2*k])return 1;return 0})(n)),Y(n,n.l_desc),Y(n,n.d_desc),w=(n=>{let k;for(Z(n,n.dyn_ltree,n.l_desc.max_code),Z(n,n.dyn_dtree,n.d_desc.max_code),Y(n,n.bl_desc),k=18;k>=3&&0===n.bl_tree[2*I[k]+1];k--);return n.opt_len+=3*(k+1)+5+5+4,k})(n),Q=n.opt_len+3+7>>>3,G=n.static_len+3+7>>>3,G<=Q&&(Q=G)):Q=G=c+5,c+4<=Q&&-1!==k?l(n,k,c,K):4===n.strategy||G===Q?(f(n,2+(K?1:0),3),V(n,S,P)):(f(n,4+(K?1:0),3),((n,k,T,c)=>{let K;for(f(n,k-257,5),f(n,T-1,5),f(n,c-4,4),K=0;K<c;K++)f(n,n.bl_tree[2*I[K]+1],3);e(n,n.dyn_ltree,k-1),e(n,n.dyn_dtree,T-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,w+1),V(n,n.dyn_ltree,n.dyn_dtree)),m(n),K&&x(n)},n.exports._tr_tally=(n,k,c)=>(n.pending_buf[n.d_buf+2*n.last_lit]=k>>>8&255,n.pending_buf[n.d_buf+2*n.last_lit+1]=255&k,n.pending_buf[n.l_buf+n.last_lit]=255&c,n.last_lit++,0===k?n.dyn_ltree[2*c]++:(n.matches++,k--,n.dyn_ltree[2*(J[c]+T+1)]++,n.dyn_dtree[2*O(k)]++),n.last_lit===n.lit_bufsize-1),n.exports._tr_align=n=>{f(n,2,3),A(n,256,S),(n=>{16===n.bi_valid?(u(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(n)}},12166:n=>{"use strict";n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12036:n=>{function k(n,k,T){for(var c=n.length,K=-1/0,Q=1/0,G=0;G<c;G++){var w=(T[0][G]-n[G])/k[G],E=(T[1][G]-n[G])/k[G];if(w>E){var I=w;w=E,E=I}if(E<K||w>Q)return 1/0;w>K&&(K=w),E<Q&&(Q=E)}return K>Q?1/0:K}n.exports=function(n,T,c,K){var Q=k(T,c,K);if(Q===1/0)n=null;else{n=n||[];for(var G=0;G<T.length;G++)n[G]=T[G]+c[G]*Q}return n},n.exports.distance=k},13094:(n,k,T)=>{"use strict";T.d(k,{c:()=>G});var c=T(43);const K=c.useLayoutEffect;const Q=function(n){var k=(0,c.useRef)(n);return K((function(){k.current=n})),k};var G=function(n){var k=Q(n);(0,c.ob)((function(){var n=function(n){var T;if(null!=k.current&&(T=k.current(n)),n.defaultPrevented&&(n.returnValue=""),"string"===typeof T)return n.returnValue=T,T};return window.addEventListener("beforeunload",n),function(){window.removeEventListener("beforeunload",n)}}),[])}},13044:(n,k,T)=>{"use strict";var c=T(13053),K=Array.prototype.concat,Q=Array.prototype.slice,G=n.exports=function(n){for(var k=[],T=0,G=n.length;T<G;T++){var w=n[T];c(w)?k=K.call(k,Q.call(w)):k.push(w)}return k};G.wrap=function(n){return function(){return n(G(arguments))}}},13053:n=>{n.exports=function(n){return!(!n||"string"===typeof n)&&(n instanceof Array||Array.isArray(n)||n.length>=0&&(n.splice instanceof Function||Object.getOwnPropertyDescriptor(n,n.length-1)&&"String"!==n.constructor.name))}},12052:(n,k,T)=>{var c=T(12059);function K(n){for(var k,T,K=0,Q=n.length,G=0;G<n.length;){for(k=n[G],T=0;G<Q&&n[G]===k;)++G,++T;K+=c.log2(T)/7|0,K+=c.log2(k>>>0)/7|0,K+=2}return K}k.size=K,k.encode=function(n,k){k||(k=new Uint8Array(K(n)));for(var T,c,Q=0,G=k.length,w=0;w<n.length;){for(T=n[w],c=0;w<n.length&&n[w]===T;)++w,++c;for(;Q<G&&c>=128;)k[Q++]=128+(127&c),c>>>=7;if(Q>=G)throw new Error("RLE buffer overflow");for(k[Q++]=c,T>>>=0;Q<G&&T>=128;)k[Q++]=128+(127&T),T>>>=7;if(Q>=G)throw new Error("RLE buffer overflow");k[Q++]=T}return k},k.decode=function(n,k){for(var T,c,K,Q,G=k.length,w=n.length,E=0,I=0;I<w;){for(T=0,c=0;I<w&&n[I]>=128;)T+=(127&n[I++])<<c,c+=7;if(T+=n[I++]<<c,I>=w)throw new Error("RLE buffer underrun");if(E+T>G)throw new Error("Chunk buffer overflow");for(K=0,c=0;I<w&&n[I]>=128;)K+=(127&n[I++])<<c,c+=7;if(I>=w)throw new Error("RLE buffer underrun");for(K+=n[I++]<<c,Q=0;Q<T;++Q)k[E++]=K}return k}},12059:(n,k)=>{"use strict";function T(n){var k=32;return(n&=-n)&&k--,65535&n&&(k-=16),16711935&n&&(k-=8),252645135&n&&(k-=4),858993459&n&&(k-=2),1431655765&n&&(k-=1),k}k.INT_BITS=32,k.INT_MAX=2147483647,k.INT_MIN=-1<<31,k.sign=function(n){return(n>0)-(n<0)},k.abs=function(n){var k=n>>31;return(n^k)-k},k.min=function(n,k){return k^(n^k)&-(n<k)},k.max=function(n,k){return n^(n^k)&-(n<k)},k.isPow2=function(n){return!(n&n-1)&&!!n},k.log2=function(n){var k,T;return k=(n>65535)<<4,k|=T=((n>>>=k)>255)<<3,k|=T=((n>>>=T)>15)<<2,(k|=T=((n>>>=T)>3)<<1)|(n>>>=T)>>1},k.log10=function(n){return n>=1e9?9:n>=1e8?8:n>=1e7?7:n>=1e6?6:n>=1e5?5:n>=1e4?4:n>=1e3?3:n>=100?2:n>=10?1:0},k.popCount=function(n){return 16843009*((n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135)>>>24},k.countTrailingZeros=T,k.nextPow2=function(n){return n+=0===n,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,(n|=n>>>16)+1},k.prevPow2=function(n){return n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,(n|=n>>>16)-(n>>>1)},k.parity=function(n){return n^=n>>>16,n^=n>>>8,n^=n>>>4,27030>>>(n&=15)&1};var c=new Array(256);!function(n){for(var k=0;k<256;++k){var T=k,c=k,K=7;for(T>>>=1;T;T>>>=1)c<<=1,c|=1&T,--K;n[k]=c<<K&255}}(c),k.reverse=function(n){return c[255&n]<<24|c[n>>>8&255]<<16|c[n>>>16&255]<<8|c[n>>>24&255]},k.interleave2=function(n,k){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n&=65535)|n<<8))|n<<4))|n<<2))|n<<1))|(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k&=65535)|k<<8))|k<<4))|k<<2))|k<<1))<<1},k.deinterleave2=function(n,k){return(n=65535&((n=16711935&((n=252645135&((n=858993459&((n=n>>>k&1431655765)|n>>>1))|n>>>2))|n>>>4))|n>>>16))<<16>>16},k.interleave3=function(n,k,T){return n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2),(n|=(k=1227133513&((k=3272356035&((k=251719695&((k=4278190335&((k&=1023)|k<<16))|k<<8))|k<<4))|k<<2))<<1)|(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<2},k.deinterleave3=function(n,k){return(n=1023&((n=4278190335&((n=251719695&((n=3272356035&((n=n>>>k&1227133513)|n>>>2))|n>>>4))|n>>>8))|n>>>16))<<22>>22},k.nextCombination=function(n){var k=n|n-1;return k+1|(~k&-~k)-1>>>T(n)+1}},12090:n=>{"use strict";n.exports=function(n,k,T,c){var K=self||window;try{try{var Q;try{Q=new K.Blob([n])}catch(I){(Q=new(K.BlobBuilder||K.WebKitBlobBuilder||K.MozBlobBuilder||K.MSBlobBuilder)).append(n),Q=Q.getBlob()}var G=K.URL||K.webkitURL,w=G.createObjectURL(Q),E=new K[k](w,T);return G.revokeObjectURL(w),E}catch(I){return new K[k]("data:application/javascript,".concat(encodeURIComponent(n)),T)}}catch(I){if(!c)throw Error("Inline worker is not supported");return new K[k](c,T)}}},12015:(n,k,T)=>{"use strict";function c(n,k,T,c,K){var Q={};return Object.keys(c).forEach((function(n){Q[n]=c[n]})),Q.enumerable=!!Q.enumerable,Q.configurable=!!Q.configurable,("value"in Q||Q.initializer)&&(Q.writable=!0),Q=T.slice().reverse().reduce((function(T,c){return c(n,k,T)||T}),Q),K&&void 0!==Q.initializer&&(Q.value=Q.initializer?Q.initializer.call(K):void 0,Q.initializer=void 0),void 0===Q.initializer&&(Object.defineProperty(n,k,Q),Q=null),Q}T.d(k,{c:()=>c})},12010:(n,k,T)=>{"use strict";function c(n,k,T,c){T&&Object.defineProperty(n,k,{enumerable:T.enumerable,configurable:T.configurable,writable:T.writable,value:T.initializer?T.initializer.call(c):void 0})}T.d(k,{d:()=>c})},12706:(n,k,T)=>{"use strict";T.d(k,{c:()=>r,d:()=>b,e:()=>C,h:()=>W,j:()=>s,k:()=>H,l:()=>J});var c=T(730),K=T(764),Q=T(747),G=T(675),w=T(12714),E=T(752),I=T(2313),S=T(582),P=T(760);const W=Object.freeze(new c.h(0,0,0,0)),J=Object.freeze(c.o.Zero()),H=Object.freeze(c.m.Zero()),s=Object.freeze(I.e.Zero()),b=Object.freeze(K.e.Black()),C=Object.freeze(new K.g(0,0,0,0)),z={key:0,repeatCount:0,loopMode:2};class r{static _PrepareAnimation(n,k,T,Q,G,w,E,S){let P;if(!isNaN(parseFloat(G))&&isFinite(G)?P=r.ANIMATIONTYPE_FLOAT:G instanceof c.h?P=r.ANIMATIONTYPE_QUATERNION:G instanceof c.o?P=r.ANIMATIONTYPE_VECTOR3:G instanceof c.m?P=r.ANIMATIONTYPE_VECTOR2:G instanceof K.e?P=r.ANIMATIONTYPE_COLOR3:G instanceof K.g?P=r.ANIMATIONTYPE_COLOR4:G instanceof I.e&&(P=r.ANIMATIONTYPE_SIZE),void 0==P)return null;const W=new r(n,k,T,P,E),J=[{frame:0,value:G},{frame:Q,value:w}];return W.setKeys(J),void 0!==S&&W.setEasingFunction(S),W}static CreateAnimation(n,k,T,c){const K=new r(n+"Animation",n,T,k,r.ANIMATIONLOOPMODE_CONSTANT);return K.setEasingFunction(c),K}static CreateAndStartAnimation(n,k,T,c,K,Q,G,w,E,I,S){const P=r._PrepareAnimation(n,T,c,K,Q,G,w,E);return P?(k.va&&(S=k.va()),S?S.beginDirectAnimation(k,[P],0,K,P.loopMode!==r.ANIMATIONLOOPMODE_CONSTANT,1,I):null):null}static CreateAndStartHierarchyAnimation(n,k,T,c,K,Q,G,w,E,I,S){const P=r._PrepareAnimation(n,c,K,Q,G,w,E,I);if(!P)return null;return k.va().beginDirectHierarchyAnimation(k,T,[P],0,Q,1===P.loopMode,1,S)}static CreateMergeAndStartAnimation(n,k,T,c,K,Q,G,w,E,I){const S=r._PrepareAnimation(n,T,c,K,Q,G,w,E);return S?(k.animations.push(S),k.va().beginAnimation(k,0,K,1===S.loopMode,1,I)):null}static MakeAnimationAdditive(n,k,T){let K;K="object"===typeof k?k:{referenceFrame:k??0,range:T,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let Q=n;if(K.cloneOriginalAnimation&&(Q=n.clone(),Q.name=K.clonedAnimationName||Q.name),!Q._keys.length)return Q;const G=K.referenceFrame&&K.referenceFrame>=0?K.referenceFrame:0;let w=0;const E=Q._keys[0];let I=Q._keys.length-1;const S=Q._keys[I],P={referenceValue:E.value,referencePosition:c.l.li[0],referenceQuaternion:c.l.Quaternion[0],referenceScaling:c.l.li[1],keyPosition:c.l.li[2],keyQuaternion:c.l.Quaternion[1],keyScaling:c.l.li[3]};let W=E.frame,J=S.frame;if(K.range){const n=Q.getRange(K.range);n&&(W=n.from,J=n.to)}else W=K.fromFrame??W,J=K.toFrame??J;if(W!==E.frame&&(w=Q.createKeyForFrame(W)),J!==S.frame&&(I=Q.createKeyForFrame(J)),1===Q._keys.length){const n=Q._getKeyValue(Q._keys[0]);P.referenceValue=n.clone?n.clone():n}else if(G<=E.frame){const n=Q._getKeyValue(E.value);P.referenceValue=n.clone?n.clone():n}else if(G>=S.frame){const n=Q._getKeyValue(S.value);P.referenceValue=n.clone?n.clone():n}else{z.key=0;const n=Q._interpolate(G,z);P.referenceValue=n.clone?n.clone():n}Q.dataType===r.ANIMATIONTYPE_QUATERNION?P.referenceValue.normalize().conjugateInPlace():Q.dataType===r.ANIMATIONTYPE_MATRIX&&(P.referenceValue.decompose(P.referenceScaling,P.referenceQuaternion,P.referencePosition),P.referenceQuaternion.normalize().conjugateInPlace());let H=Number.MAX_VALUE;const s=K.clipKeys?[]:null;for(let b=w;b<=I;b++){let n=Q._keys[b];if((s||K.cloneOriginalAnimation)&&(n={frame:n.frame,value:n.value.clone?n.value.clone():n.value,inTangent:n.inTangent,outTangent:n.outTangent,interpolation:n.interpolation,lockedTangent:n.lockedTangent},s&&(H===Number.MAX_VALUE&&(H=n.frame),n.frame-=H,s.push(n))),!b||Q.dataType===r.ANIMATIONTYPE_FLOAT||n.value!==E.value)switch(Q.dataType){case r.ANIMATIONTYPE_MATRIX:n.value.decompose(P.keyScaling,P.keyQuaternion,P.keyPosition),P.keyPosition.Oi(P.referencePosition),P.keyScaling.divideInPlace(P.referenceScaling),P.referenceQuaternion.multiplyToRef(P.keyQuaternion,P.keyQuaternion),c.d.ComposeToRef(P.keyScaling,P.keyQuaternion,P.keyPosition,n.value);break;case r.ANIMATIONTYPE_QUATERNION:P.referenceValue.multiplyToRef(n.value,n.value);break;case r.ANIMATIONTYPE_VECTOR2:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:n.value.subtractToRef(P.referenceValue,n.value);break;case r.ANIMATIONTYPE_SIZE:n.value.width-=P.referenceValue.width,n.value.height-=P.referenceValue.height;break;default:n.value-=P.referenceValue}}return s&&Q.setKeys(s,!0),Q}static TransitionTo(n,k,T,c,K,Q,G){let w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(G<=0)return T[n]=k,w&&w(),null;const E=K*(G/1e3);Q.setKeys([{frame:0,value:T[n].clone?T[n].clone():T[n]},{frame:E,value:k}]),T.animations||(T.animations=[]),T.animations.push(Q);const I=c.beginAnimation(T,0,E,!1);return I.onAnimationEnd=w,I}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const n of this._runtimeAnimations)if(!n.isStopped())return!0;return!1}constructor(n,k,T,c,K,Q){this.name=n,this.targetProperty=k,this.framePerSecond=T,this.dataType=c,this.loopMode=K,this.enableBlending=Q,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=k.split("."),this.dataType=c,this.loopMode=void 0===K?r.ANIMATIONLOOPMODE_CYCLE:K,this.uniqueId=r._UniqueIdGenerator++}toString(n){let k="Name: "+this.name+", property: "+this.targetProperty;if(k+=", datatype: "+["Float","li","Quaternion","Matrix","Ri","Vector2"][this.dataType],k+=", nKeys: "+(this._keys?this._keys.length:"none"),k+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),n){k+=", Ranges: {";let n=!0;for(const T in this._ranges)n&&(k+=", ",n=!1),k+=T;k+="}"}return k}addEvent(n){this._events.push(n),this._events.sort(((n,k)=>n.frame-k.frame))}removeEvents(n){for(let k=0;k<this._events.length;k++)this._events[k].frame===n&&(this._events.splice(k,1),k--)}getEvents(){return this._events}createRange(n,k,T){this._ranges[n]||(this._ranges[n]=new w.e(n,k,T))}deleteRange(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const T=this._ranges[n];if(T){if(k){const n=T.from,k=T.to;for(let T=this._keys.length-1;T>=0;T--)this._keys[T].frame>=n&&this._keys[T].frame<=k&&this._keys.splice(T,1)}this._ranges[n]=null}}getRange(n){return this._ranges[n]}getKeys(){return this._keys}getHighestFrame(){let n=0;for(let k=0,T=this._keys.length;k<T;k++)n<this._keys[k].frame&&(n=this._keys[k].frame);return n}getEasingFunction(){return this._easingFunction}setEasingFunction(n){this._easingFunction=n}floatInterpolateFunction(n,k,T){return(0,Q.i)(n,k,T)}floatInterpolateFunctionWithTangents(n,k,T,c,K){return(0,Q.c)(n,k,T,c,K)}quaternionInterpolateFunction(n,k,T){return c.h.Slerp(n,k,T)}quaternionInterpolateFunctionWithTangents(n,k,T,K,Q){return c.h.Hermite(n,k,T,K,Q).normalize()}vector3InterpolateFunction(n,k,T){return c.o.Lerp(n,k,T)}vector3InterpolateFunctionWithTangents(n,k,T,K,Q){return c.o.Hermite(n,k,T,K,Q)}vector2InterpolateFunction(n,k,T){return c.m.Lerp(n,k,T)}vector2InterpolateFunctionWithTangents(n,k,T,K,Q){return c.m.Hermite(n,k,T,K,Q)}sizeInterpolateFunction(n,k,T){return I.e.Lerp(n,k,T)}color3InterpolateFunction(n,k,T){return K.e.Lerp(n,k,T)}color3InterpolateFunctionWithTangents(n,k,T,c,Q){return K.e.Hermite(n,k,T,c,Q)}color4InterpolateFunction(n,k,T){return K.g.Lerp(n,k,T)}color4InterpolateFunctionWithTangents(n,k,T,c,Q){return K.g.Hermite(n,k,T,c,Q)}_getKeyValue(n){return"function"===typeof n?n():n}evaluate(n){return z.key=0,this._interpolate(n,z)}_interpolate(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(k.loopMode===r.ANIMATIONLOOPMODE_CONSTANT&&k.repeatCount>0)return k.highLimitValue.clone?k.highLimitValue.clone():k.highLimitValue;const c=this._keys;let K;if(this._coreAnimation)K=this._coreAnimation._key;else{const Q=c.length;for(K=k.key;K>=0&&n<c[K].frame;)--K;for(;K+1<=Q-1&&n>=c[K+1].frame;)++K;if(k.key=K,K<0)return T?void 0:this._getKeyValue(c[0].value);if(K+1>Q-1)return T?void 0:this._getKeyValue(c[Q-1].value);this._key=K}const Q=c[K],G=c[K+1];if(T&&(n===Q.frame||n===G.frame))return;const w=this._getKeyValue(Q.value),E=this._getKeyValue(G.value);if(1===Q.interpolation)return G.frame>n?w:E;const I=void 0!==Q.outTangent&&void 0!==G.inTangent,S=G.frame-Q.frame;let P=(n-Q.frame)/S;const z=Q.easingFunction||this.getEasingFunction();switch(z&&(P=z.ease(P)),this.dataType){case r.ANIMATIONTYPE_FLOAT:{const n=I?this.floatInterpolateFunctionWithTangents(w,Q.outTangent*S,E,G.inTangent*S,P):this.floatInterpolateFunction(w,E,P);switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return n;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(k.offsetValue??0)*k.repeatCount+n}break}case r.ANIMATIONTYPE_QUATERNION:{const n=I?this.quaternionInterpolateFunctionWithTangents(w,Q.outTangent.scale(S),E,G.inTangent.scale(S),P):this.quaternionInterpolateFunction(w,E,P);switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return n;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return n.addInPlace((k.offsetValue||W).scale(k.repeatCount))}return n}case r.ANIMATIONTYPE_VECTOR3:{const n=I?this.vector3InterpolateFunctionWithTangents(w,Q.outTangent.scale(S),E,G.inTangent.scale(S),P):this.vector3InterpolateFunction(w,E,P);switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return n;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return n.add((k.offsetValue||J).scale(k.repeatCount))}break}case r.ANIMATIONTYPE_VECTOR2:{const n=I?this.vector2InterpolateFunctionWithTangents(w,Q.outTangent.scale(S),E,G.inTangent.scale(S),P):this.vector2InterpolateFunction(w,E,P);switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return n;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return n.add((k.offsetValue||H).scale(k.repeatCount))}break}case r.ANIMATIONTYPE_SIZE:switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(w,E,P);case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(w,E,P).add((k.offsetValue||s).scale(k.repeatCount))}break;case r.ANIMATIONTYPE_COLOR3:{const n=I?this.color3InterpolateFunctionWithTangents(w,Q.outTangent.scale(S),E,G.inTangent.scale(S),P):this.color3InterpolateFunction(w,E,P);switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return n;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return n.add((k.offsetValue||b).scale(k.repeatCount))}break}case r.ANIMATIONTYPE_COLOR4:{const n=I?this.color4InterpolateFunctionWithTangents(w,Q.outTangent.scale(S),E,G.inTangent.scale(S),P):this.color4InterpolateFunction(w,E,P);switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return n;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return n.add((k.offsetValue||C).scale(k.repeatCount))}break}case r.ANIMATIONTYPE_MATRIX:switch(k.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:case r.ANIMATIONLOOPMODE_YOYO:return r.AllowMatricesInterpolation?this.matrixInterpolateFunction(w,E,P,k.workValue):w;case r.ANIMATIONLOOPMODE_RELATIVE:case r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return w}}return 0}matrixInterpolateFunction(n,k,T,K){return r.AllowMatrixDecomposeForInterpolation?K?(c.d.DecomposeLerpToRef(n,k,T,K),K):c.d.DecomposeLerp(n,k,T):K?(c.d.LerpToRef(n,k,T,K),K):c.d.Lerp(n,k,T)}clone(){const n=new r(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(n.enableBlending=this.enableBlending,n.blendingSpeed=this.blendingSpeed,this._keys&&n.setKeys(this._keys),this._ranges){n._ranges={};for(const k in this._ranges){const T=this._ranges[k];T&&(n._ranges[k]=T.clone())}}return n}setKeys(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=k?n:n.slice(0)}createKeyForFrame(n){z.key=0;const k=this._interpolate(n,z,!0);if(!k)return this._keys[z.key].frame===n?z.key:z.key+1;const T={frame:n,value:k.clone?k.clone():k};return this._keys.splice(z.key+1,0,T),z.key+1}serialize(){const n={};n.name=this.name,n.property=this.targetProperty,n.framePerSecond=this.framePerSecond,n.dataType=this.dataType,n.loopBehavior=this.loopMode,n.enableBlending=this.enableBlending,n.blendingSpeed=this.blendingSpeed;const k=this.dataType;n.keys=[];const T=this.getKeys();for(let c=0;c<T.length;c++){const K=T[c],Q={};switch(Q.frame=K.frame,k){case r.ANIMATIONTYPE_FLOAT:Q.values=[K.value],void 0!==K.inTangent&&Q.values.push(K.inTangent),void 0!==K.outTangent&&(void 0===K.inTangent&&Q.values.push(void 0),Q.values.push(K.outTangent)),void 0!==K.interpolation&&(void 0===K.inTangent&&Q.values.push(void 0),void 0===K.outTangent&&Q.values.push(void 0),Q.values.push(K.interpolation));break;case r.ANIMATIONTYPE_QUATERNION:case r.ANIMATIONTYPE_MATRIX:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:Q.values=K.value.wi(),void 0!=K.inTangent&&Q.values.push(K.inTangent.wi()),void 0!=K.outTangent&&(void 0===K.inTangent&&Q.values.push(void 0),Q.values.push(K.outTangent.wi())),void 0!==K.interpolation&&(void 0===K.inTangent&&Q.values.push(void 0),void 0===K.outTangent&&Q.values.push(void 0),Q.values.push(K.interpolation))}n.keys.push(Q)}n.ranges=[];for(const c in this._ranges){const k=this._ranges[c];if(!k)continue;const T={};T.name=c,T.from=k.from,T.to=k.to,n.ranges.push(T)}return n}static _UniversalLerp(n,k,T){const c=n.constructor;return c.Lerp?c.Lerp(n,k,T):c.Slerp?c.Slerp(n,k,T):n.toFixed?n*(1-T)+T*k:k}static Parse(n){const k=new r(n.name,n.property,n.framePerSecond,n.dataType,n.loopBehavior),T=n.dataType,Q=[];let G,w;for(n.enableBlending&&(k.enableBlending=n.enableBlending),n.blendingSpeed&&(k.blendingSpeed=n.blendingSpeed),w=0;w<n.keys.length;w++){const k=n.keys[w];let E,I,S;switch(T){case r.ANIMATIONTYPE_FLOAT:G=k.values[0],k.values.length>=2&&(E=k.values[1]),k.values.length>=3&&(I=k.values[2]),k.values.length>=4&&(S=k.values[3]);break;case r.ANIMATIONTYPE_QUATERNION:if(G=c.h.ji(k.values),k.values.length>=8){const n=c.h.ji(k.values.slice(4,8));n.equals(c.h.Zero())||(E=n)}if(k.values.length>=12){const n=c.h.ji(k.values.slice(8,12));n.equals(c.h.Zero())||(I=n)}k.values.length>=13&&(S=k.values[12]);break;case r.ANIMATIONTYPE_MATRIX:G=c.d.ji(k.values),k.values.length>=17&&(S=k.values[16]);break;case r.ANIMATIONTYPE_COLOR3:G=K.e.ji(k.values),k.values[3]&&(E=K.e.ji(k.values[3])),k.values[4]&&(I=K.e.ji(k.values[4])),k.values[5]&&(S=k.values[5]);break;case r.ANIMATIONTYPE_COLOR4:G=K.g.ji(k.values),k.values[4]&&(E=K.g.ji(k.values[4])),k.values[5]&&(I=K.g.ji(k.values[5])),k.values[6]&&(S=K.g.ji(k.values[6]));break;case r.ANIMATIONTYPE_VECTOR3:default:G=c.o.ji(k.values),k.values[3]&&(E=c.o.ji(k.values[3])),k.values[4]&&(I=c.o.ji(k.values[4])),k.values[5]&&(S=k.values[5])}const P={};P.frame=k.frame,P.value=G,void 0!=E&&(P.inTangent=E),void 0!=I&&(P.outTangent=I),void 0!=S&&(P.interpolation=S),Q.push(P)}if(k.setKeys(Q),n.ranges)for(w=0;w<n.ranges.length;w++)G=n.ranges[w],k.createRange(G.name,G.from,G.to);return k}static AppendSerializedAnimations(n,k){P.d.AppendSerializedAnimations(n,k)}static async ParseFromFileAsync(n,k){return await new Promise(((T,c)=>{const K=new S.b;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){let k=JSON.parse(K.responseText);if(k.animations&&(k=k.animations),k.length){const n=[];for(const T of k)n.push(this.Parse(T));T(n)}else{const c=this.Parse(k);n&&(c.name=n),T(c)}}else c("Unable to load the animation")})),K.open("GET",k),K.send()}))}static async ParseFromSnippetAsync(n){return await new Promise(((k,T)=>{const c=new S.b;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const T=JSON.parse(JSON.parse(c.responseText).jsonPayload);if(T.animations){const c=JSON.parse(T.animations),K=[];for(const k of c.animations){const T=this.Parse(k);T.snippetId=n,K.push(T)}k(K)}else{const c=JSON.parse(T.animation),K=this.Parse(c);K.snippetId=n,k(K)}}else T("Unable to load the snippet "+n)})),c.open("GET",this.SnippetUrl+"/"+n.replace(/#/g,"/")),c.send()}))}}r._UniqueIdGenerator=0,r.AllowMatricesInterpolation=!1,r.AllowMatrixDecomposeForInterpolation=!0,r.SnippetUrl="https://snippet.babylonjs.com",r.ANIMATIONTYPE_FLOAT=0,r.ANIMATIONTYPE_VECTOR3=1,r.ANIMATIONTYPE_QUATERNION=2,r.ANIMATIONTYPE_MATRIX=3,r.ANIMATIONTYPE_COLOR3=4,r.ANIMATIONTYPE_COLOR4=7,r.ANIMATIONTYPE_VECTOR2=5,r.ANIMATIONTYPE_SIZE=6,r.ANIMATIONLOOPMODE_RELATIVE=0,r.ANIMATIONLOOPMODE_CYCLE=1,r.ANIMATIONLOOPMODE_CONSTANT=2,r.ANIMATIONLOOPMODE_YOYO=4,r.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,r.CreateFromSnippetAsync=r.ParseFromSnippetAsync,(0,G.f)("BABYLON.Animation",r),E.c._AnimationRangeFactory=(n,k,T)=>new w.e(n,k,T)},12714:(n,k,T)=>{"use strict";T.d(k,{e:()=>c});class c{constructor(n,k,T){this.name=n,this.from=k,this.to=T}clone(){return new c(this.name,this.from,this.to)}}},13084:(n,k,T)=>{"use strict";T.d(k,{c:()=>G,e:()=>P,f:()=>w,i:()=>Q,k:()=>E,l:()=>K,m:()=>I,q:()=>S});var c=T(2308);class K{constructor(){this._easingMode=K.EASINGMODE_EASEIN}setEasingMode(n){const k=Math.min(Math.max(n,0),2);this._easingMode=k}getEasingMode(){return this._easingMode}easeInCore(n){throw new Error("You must implement this method")}ease(n){switch(this._easingMode){case K.EASINGMODE_EASEIN:return this.easeInCore(n);case K.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-n)}return n>=.5?.5*(1-this.easeInCore(2*(1-n)))+.5:.5*this.easeInCore(2*n)}}K.EASINGMODE_EASEIN=0,K.EASINGMODE_EASEOUT=1,K.EASINGMODE_EASEINOUT=2;class Q extends K{easeInCore(n){return n=Math.max(0,Math.min(1,n)),1-Math.sqrt(1-n*n)}}class G extends K{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=n}easeInCore(n){const k=Math.max(0,this.amplitude);return Math.pow(n,3)-n*k*Math.sin(3.141592653589793*n)}}class w extends K{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=n,this.bounciness=k}easeInCore(n){const k=Math.max(0,this.bounces);let T=this.bounciness;T<=1&&(T=1.001);const c=Math.pow(T,k),K=1-T,Q=(1-c)/K+.5*c,G=n*Q,w=Math.log(-G*(1-T)+1)/Math.log(T),E=Math.floor(w),I=E+1,S=(1-Math.pow(T,E))/(K*Q),P=.5*(S+(1-Math.pow(T,I))/(K*Q)),W=n-P,J=P-S;return-Math.pow(1/T,k-E)/(J*J)*(W-J)*(W+J)}}class E extends K{easeInCore(n){return n*n*n}}class I extends K{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=n,this.springiness=k}easeInCore(n){let k;const T=Math.max(0,this.oscillations),c=Math.max(0,this.springiness);return k=0==c?n:(Math.exp(c*n)-1)/(Math.exp(c)-1),k*Math.sin((6.283185307179586*T+1.5707963267948966)*n)}}class S extends K{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=n}easeInCore(n){return this.exponent<=0?n:(Math.exp(this.exponent*n)-1)/(Math.exp(this.exponent)-1)}}class P extends K{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=n,this.y1=k,this.x2=T,this.y2=c}easeInCore(n){return c.c.Interpolate(n,this.x1,this.y1,this.x2,this.y2)}}},12703:(n,k,T)=>{"use strict";T.d(k,{b:()=>G});var c=T(730),K=T(744),Q=T(752);class G extends Q.c{get _matrix(){return this._compose(),this.Yi}set _matrix(n){(n.updateFlag!==this.Yi.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Yi.p(n),this._markAsDirtyAndDecompose())}constructor(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(n,k.va(),!1),this.name=n,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=k,this.Yi=(null===K||void 0===K?void 0:K.clone())??c.d.Identity(),this._restMatrix=Q??this.Yi.clone(),this._bindMatrix=G??this.Yi.clone(),this._index=w,this._absoluteMatrix=new c.d,this._absoluteBindMatrix=new c.d,this._absoluteInverseBindMatrix=new c.d,this._finalMatrix=new c.d,k.bones.push(this),this.setParent(T,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(n){this.setParent(n)}setParent(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==n){if(this.parent){const n=this.parent.children.indexOf(this);-1!==n&&this.parent.children.splice(n,1)}this._parentNode=n,this.parent&&this.parent.children.push(this),k&&this._updateAbsoluteBindMatrices(),this.Li()}}getLocalMatrix(){return this._compose(),this.Yi}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(n){this._restMatrix.p(n)}setRestPose(n){this.setRestMatrix(n)}getBindPose(){return this.getBindMatrix()}setBindMatrix(n){this.Vi(n)}setBindPose(n){this.setBindMatrix(n)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const n=c.l.li[0],k=c.l.Quaternion[0],T=c.l.li[1];this.getRestMatrix().decompose(n,k,T),this._linkedTransformNode.position.p(T),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??c.h.Identity(),this._linkedTransformNode.rotationQuaternion.p(k),this._linkedTransformNode.ei.p(n)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(n){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=n,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.zg}set position(n){this._decompose(),this.zg.p(n),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(n){this.setRotation(n)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(n){this.setRotationQuaternion(n)}get ei(){return this.getScale()}set ei(n){this.setScale(n)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=c.o.Zero(),this._localRotation=c.h.Zero(),this.zg=c.o.Zero()),this.Yi.decompose(this._localScaling,this._localRotation,this.zg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,c.d.ComposeToRef(this._localScaling,this._localRotation,this.zg,this.Yi)):this._needToCompose=!1)}Vi(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(n),k&&this._updateAbsoluteBindMatrices(),T?this._matrix=n:this.Li()}_updateAbsoluteBindMatrices(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(n||(n=this._bindMatrix),this.parent?n.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(n),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),k)for(let T=0;T<this.children.length;T++)this.children[T]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Li(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Li(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Li(),this._needToDecompose=!0}_updatePosition(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0,K=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=this.getLocalMatrix();if(0==k)K?(Q.addAtIndex(12,n.x),Q.addAtIndex(13,n.y),Q.addAtIndex(14,n.z)):Q.setTranslationFromFloats(n.x,n.y,n.z);else{let k=null;T&&(k=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=G._TmpMats[0],E=G._TmpVecs[0];this.parent?T&&k?(w.p(this.parent.getAbsoluteMatrix()),w.multiplyToRef(k,w)):w.p(this.parent.getAbsoluteMatrix()):c.d.IdentityToRef(w),K&&w.setTranslationFromFloats(0,0,0),w.invert(),c.o.TransformCoordinatesToRef(n,w,E),K?(Q.addAtIndex(12,E.x),Q.addAtIndex(13,E.y),Q.addAtIndex(14,E.z)):Q.setTranslationFromFloats(E.x,E.y,E.z)}this._markAsDirtyAndDecompose()}translate(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(n,k,T,!0)}setPosition(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(n,k,T,!1)}setAbsolutePosition(n,k){this.setPosition(n,1,k)}scale(n,k,T){let K=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=this.getLocalMatrix(),w=G._TmpMats[0];c.d.ScalingToRef(n,k,T,w),w.multiplyToRef(Q,Q),w.invert();for(const c of this.children){const K=c.getLocalMatrix();K.multiplyToRef(w,K),K.multiplyAtIndex(12,n),K.multiplyAtIndex(13,k),K.multiplyAtIndex(14,T),c._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),K)for(const c of this.children)c.scale(n,k,T,K)}setScale(n){this._decompose(),this._localScaling.p(n),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(n){this._decompose(),n.p(this._localScaling)}setYawPitchRoll(n,k,T){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4?arguments[4]:void 0;if(0===K){const w=G._TmpQuat;return c.h.RotationYawPitchRollToRef(n,k,T,w),void this.setRotationQuaternion(w,K,Q)}const w=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,Q))return;const E=G._TmpMats[1];c.d.RotationYawPitchRollToRef(n,k,T,E),w.multiplyToRef(E,E),this._rotateWithMatrix(E,K,Q)}rotate(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,K=arguments.length>3?arguments[3]:void 0;const Q=G._TmpMats[0];Q.setTranslationFromFloats(0,0,0),c.d.RotationAxisToRef(n,k,Q),this._rotateWithMatrix(Q,T,K)}setAxisAngle(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,K=arguments.length>3?arguments[3]:void 0;if(0===T){const Q=G._TmpQuat;return c.h.RotationAxisToRef(n,k,Q),void this.setRotationQuaternion(Q,T,K)}const Q=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,K))return;const w=G._TmpMats[1];c.d.RotationAxisToRef(n,k,w),Q.multiplyToRef(w,w),this._rotateWithMatrix(w,T,K)}setRotation(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(n.y,n.x,n.z,k,T)}setRotationQuaternion(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===k)return this._decompose(),this._localRotation.p(n),void this._markAsDirtyAndCompose();const K=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,T))return;const Q=G._TmpMats[1];c.d.FromQuaternionToRef(n,Q),K.multiplyToRef(Q,Q),this._rotateWithMatrix(Q,k,T)}setRotationMatrix(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===k){const K=G._TmpQuat;return c.h.FromRotationMatrixToRef(n,K),void this.setRotationQuaternion(K,k,T)}const K=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,T))return;const Q=G._TmpMats[1];Q.p(n),K.multiplyToRef(n,Q),this._rotateWithMatrix(Q,k,T)}_rotateWithMatrix(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const c=this.getLocalMatrix(),K=c.m[12],Q=c.m[13],w=c.m[14],E=this.getParent(),I=G._TmpMats[3],S=G._TmpMats[4];E&&1==k?(T?(I.p(T.getWorldMatrix()),E.getAbsoluteMatrix().multiplyToRef(I,I)):I.p(E.getAbsoluteMatrix()),S.p(I),S.invert(),c.multiplyToRef(I,c),c.multiplyToRef(n,c),c.multiplyToRef(S,c)):1==k&&T?(I.p(T.getWorldMatrix()),S.p(I),S.invert(),c.multiplyToRef(I,c),c.multiplyToRef(n,c),c.multiplyToRef(S,c)):c.multiplyToRef(n,c),c.setTranslationFromFloats(K,Q,w),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(n,k){const T=G._TmpMats[2];return n.p(this.getAbsoluteMatrix()),k?(n.multiplyToRef(k.getWorldMatrix(),n),c.d.ScalingToRef(k.ei.x,k.ei.y,k.ei.z,T)):c.d.IdentityToRef(T),n.invert(),!isNaN(n.m[0])&&(T.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyToRef(T,n),!0)}Re(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=c.o.Zero();return this.getPositionToRef(n,k,T),T}getPositionToRef(){let n=arguments.length>1?arguments[1]:void 0,k=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const n=this.getLocalMatrix();k.x=n.m[12],k.y=n.m[13],k.z=n.m[14]}else{let T=null;n&&(T=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let c=G._TmpMats[0];n&&T?(c.p(this.getAbsoluteMatrix()),c.multiplyToRef(T,c)):c=this.getAbsoluteMatrix(),k.x=c.m[12],k.y=c.m[13],k.z=c.m[14]}}getAbsolutePosition(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const k=c.o.Zero();return this.getPositionToRef(1,n,k),k}getAbsolutePositionToRef(n,k){this.getPositionToRef(1,n,k)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Yi.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Yi);const n=this._skeleton.getPoseMatrix();n&&this._absoluteMatrix.multiplyToRef(n,this._absoluteMatrix)}const n=this.children,k=n.length;for(let T=0;T<k;T++)n[T].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Mi(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=c.o.Zero();return this.getDirectionToRef(n,k,T),T}getDirectionToRef(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,K=null;k&&(K=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=G._TmpMats[0];Q.p(this.getAbsoluteMatrix()),k&&K&&Q.multiplyToRef(K,Q),c.o.TransformNormalToRef(n,Q,T),T.normalize()}getRotation(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=c.o.Zero();return this.getRotationToRef(n,k,T),T}getRotationToRef(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;const c=G._TmpQuat;this.getRotationQuaternionToRef(n,k,c),c.toEulerAnglesToRef(T)}getRotationQuaternion(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=c.h.Identity();return this.getRotationQuaternionToRef(n,k,T),T}getRotationQuaternionToRef(){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,k=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),k.p(this._localRotation);else{const T=G._TmpMats[0],c=this.getAbsoluteMatrix();n?c.multiplyToRef(n.getWorldMatrix(),T):T.p(c),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.decompose(void 0,k,void 0)}}getRotationMatrix(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1?arguments[1]:void 0;const T=c.d.Identity();return this.getRotationMatrixToRef(n,k,T),T}getRotationMatrixToRef(){let n=arguments.length>1?arguments[1]:void 0,k=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(k);else{const T=G._TmpMats[0],c=this.getAbsoluteMatrix();n?c.multiplyToRef(n.getWorldMatrix(),T):T.p(c),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.getRotationMatrixToRef(k)}}getAbsolutePositionFromLocal(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=c.o.Zero();return this.getAbsolutePositionFromLocalToRef(n,k,T),T}getAbsolutePositionFromLocalToRef(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,K=null;k&&(K=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=G._TmpMats[0];Q.p(this.getAbsoluteMatrix()),k&&K&&Q.multiplyToRef(K,Q),c.o.TransformCoordinatesToRef(n,Q,T)}getLocalPositionFromAbsolute(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=c.o.Zero();return this.getLocalPositionFromAbsoluteToRef(n,k,T),T}getLocalPositionFromAbsoluteToRef(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,K=null;k&&(K=k.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=G._TmpMats[0];Q.p(this.getAbsoluteMatrix()),k&&K&&Q.multiplyToRef(K,Q),Q.invert(),c.o.TransformCoordinatesToRef(n,Q,T)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const n=this._skeleton.bones.indexOf(this);if(-1!==n&&this._skeleton.bones.splice(n,1),this._parentNode&&this._parentNode.children){const n=this._parentNode.children,k=n.indexOf(this);-1!==k&&n.splice(k,1)}super.dispose()}}G._TmpVecs=(0,K.d)(2,c.o.Zero),G._TmpQuat=c.h.Identity(),G._TmpMats=(0,K.d)(5,c.d.Identity)},13080:(n,k,T)=>{"use strict";T.d(k,{e:()=>Y});var c=T(706),K=T(712),Q=T(539),G=T(730),w=T(747),E=T(752),I=T(532),S=T(2501),P=T(573),W=T(736);class J{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(n){this._zoomStopsAnimation=n}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(n){this._idleRotationSpeed=n}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(n){this._idleRotationWaitTime=n}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(n){this._idleRotationSpinupTime=n}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(n){this._attachedCamera=n;const k=this._attachedCamera.va();this._onPrePointerObservableObserver=k.onPrePointerObservable.add((n=>{n.type!==S.c.POINTERDOWN?n.type===S.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=n.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const n=P.e.Now;let k=0;null!=this._lastFrameTime&&(k=n-this._lastFrameTime),this._lastFrameTime=n,this._applyUserInteraction();const T=n-this._lastInteractionTime-this._idleRotationWaitTime,c=Math.max(Math.min(T/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*c,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(k/1e3))}))}detach(){if(!this._attachedCamera)return;const n=this._attachedCamera.va();this._onPrePointerObservableObserver&&n.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(n){this._lastInteractionTime=n??P.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<W.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let n=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(n=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?n:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=P.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var H=T(13084),s=T(12706);class b{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(n){if(this._autoTransitionRange===n)return;this._autoTransitionRange=n;const k=this._attachedCamera;k&&(n?this._onMeshTargetChangedObserver=k.onMeshTargetChangedObservable.add((n=>{if(n&&(n.pi(!0),n.getBoundingInfo)){const k=n.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*k,this.upperRadiusTransitionRange=.05*k}})):this._onMeshTargetChangedObserver&&k.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(n){this._attachedCamera=n,this._onAfterCheckInputsObserver=n.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(n){return!!this._attachedCamera&&(this._attachedCamera.radius===n&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(n){if(!this._attachedCamera)return;this._radiusBounceTransition||(b.EasingFunction.setEasingMode(b.EasingMode),this._radiusBounceTransition=s.c.CreateAnimation("radius",s.c.ANIMATIONTYPE_FLOAT,60,b.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const k=s.c.TransitionTo("radius",this._attachedCamera.radius+n,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));k&&this._animatables.push(k)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}b.EasingFunction=new H.c(.3),b.EasingMode=H.l.EASINGMODE_EASEOUT;class C{constructor(){this.onTargetFramingAnimationEndObservable=new Q.b,this._mode=C.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(n){this._mode=n}get mode(){return this._mode}set radiusScale(n){this._radiusScale=n}get radiusScale(){return this._radiusScale}set positionScale(n){this._positionScale=n}get positionScale(){return this._positionScale}set defaultElevation(n){this._defaultElevation=n}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(n){this._elevationReturnTime=n}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(n){this._elevationReturnWaitTime=n}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(n){this._zoomStopsAnimation=n}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(n){this._framingTime=n}get framingTime(){return this._framingTime}init(){}attach(n){this._attachedCamera=n;const k=this._attachedCamera.va();C.EasingFunction.setEasingMode(C.EasingMode),this._onPrePointerObservableObserver=k.onPrePointerObservable.add((n=>{n.type!==S.c.POINTERDOWN?n.type===S.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add((n=>{n&&n.getBoundingInfo&&this.zoomOnMesh(n,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=n.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const n=this._attachedCamera.va();this._onPrePointerObservableObserver&&n.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n.pi(!0);const c=n.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(c.minimumWorld,c.maximumWorld,k,T)}zoomOnMeshHierarchy(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n.pi(!0);const c=n.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(c.min,c.max,k,T)}zoomOnMeshesHierarchy(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new G.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),K=new G.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Q=0;Q<n.length;Q++){const k=n[Q].getHierarchyBoundingVectors(!0);G.o.CheckExtends(k.min,c,K),G.o.CheckExtends(k.max,c,K)}this.zoomOnBoundingInfo(c,K,k,T)}zoomOnBoundingInfo(n,k){let T,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Q=n.y,w=Q+(k.y-Q)*this._positionScale,E=k.Fg(n).scale(.5);if(!isFinite(w))return!1;if(c)T=new G.o(0,w,0);else{const k=n.add(E);T=new G.o(k.x,w,k.z)}this._vectorTransition||(this._vectorTransition=s.c.CreateAnimation("target",s.c.ANIMATIONTYPE_VECTOR3,60,C.EasingFunction)),this._betaIsAnimating=!0;let I=s.c.TransitionTo("target",T,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);I&&this._animatables.push(I);let S=0;if(this._mode===C.FitFrustumSidesMode){const T=this._calculateLowerRadiusFromModelBoundingSphere(n,k);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=E.length()+this._attachedCamera.ri),S=T}else this._mode===C.IgnoreBoundsSizeMode&&(S=this._calculateLowerRadiusFromModelBoundingSphere(n,k),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ri));if(this.autoCorrectCameraLimitsAndSensibility){const T=k.Fg(n).length();this._attachedCamera.panningSensibility=5e3/T,this._attachedCamera.wheelPrecision=100/S}return this._radiusTransition||(this._radiusTransition=s.c.CreateAnimation("radius",s.c.ANIMATIONTYPE_FLOAT,60,C.EasingFunction)),I=s.c.TransitionTo("radius",S,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),K&&K(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),I&&this._animatables.push(I),!0}_calculateLowerRadiusFromModelBoundingSphere(n,k){const T=this._attachedCamera;if(!T)return 0;let c=T._calculateLowerRadiusFromModelBoundingSphere(n,k,this._radiusScale);return T.lowerRadiusLimit&&this._mode===C.IgnoreBoundsSizeMode&&(c=c<T.lowerRadiusLimit?T.lowerRadiusLimit:c),T.upperRadiusLimit&&(c=c>T.upperRadiusLimit?T.upperRadiusLimit:c),c}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const n=P.e.Now-this._lastInteractionTime,k=.5*Math.PI-this._defaultElevation,T=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>T&&n>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=s.c.CreateAnimation("beta",s.c.ANIMATIONTYPE_FLOAT,60,C.EasingFunction));const n=s.c.TransitionTo("beta",k,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));n&&this._animatables.push(n)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=P.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}C.EasingFunction=new H.q,C.EasingMode=H.l.EASINGMODE_EASEINOUT,C.IgnoreBoundsSizeMode=0,C.FitFrustumSidesMode=1;var z=T(701),r=T(12686),q=T(12695),O=T(542);class u{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(n){n=O.e.BackCompatCameraNoPreventDefault(arguments);const k=this.camera.getEngine(),T=k.getInputElement();let c=0,K=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Q=>{var G,w;const E=Q.event,I="touch"===E.pointerType;if(Q.type!==S.c.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const P=E.target;if(this._altKey=E.altKey,this._ctrlKey=E.ctrlKey,this._metaKey=E.metaKey,this._shiftKey=E.shiftKey,this._buttonsPressed=E.buttons,k.isPointerLock){const n=E.movementX,k=E.movementY;this.onTouch(null,n,k),this._pointA=null,this._pointB=null}else{if(Q.type!==S.c.POINTERDOWN&&Q.type!==S.c.POINTERDOUBLETAP&&I&&(null===(G=this._pointA)||void 0===G?void 0:G.pointerId)!==E.pointerId&&(null===(w=this._pointB)||void 0===w?void 0:w.pointerId)!==E.pointerId)return;if(Q.type!==S.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!I)if(Q.type===S.c.POINTERDOUBLETAP)this.onDoubleTap(E.pointerType);else if(Q.type!==S.c.POINTERUP||this._currentMousePointerIdDown!==E.pointerId&&!I){if(Q.type===S.c.POINTERMOVE)if(n||E.preventDefault(),this._pointA&&null===this._pointB){const n=E.clientX-this._pointA.x,k=E.clientY-this._pointA.y;this._pointA.x=E.clientX,this._pointA.y=E.clientY,this.onTouch(this._pointA,n,k)}else if(this._pointA&&this._pointB){const n=this._pointA.pointerId===E.pointerId?this._pointA:this._pointB;n.x=E.clientX,n.y=E.clientY;const k=this._pointA.x-this._pointB.x,T=this._pointA.y-this._pointB.y,G=k*k+T*T,w={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:E.pointerId,type:Q.type};this.onMultiTouch(this._pointA,this._pointB,c,G,K,w),K=w,c=G}}else{try{null===P||void 0===P||P.releasePointerCapture(E.pointerId)}catch(W){}I||(this._pointB=null),k._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==E.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==E.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==c||K)&&(this.onMultiTouch(this._pointA,this._pointB,c,0,K,null),c=0,K=null),this._currentMousePointerIdDown=-1,this.onButtonUp(E),n||E.preventDefault()}else{try{null===P||void 0===P||P.setPointerCapture(E.pointerId)}catch(W){}if(null===this._pointA)this._pointA={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType};else{if(null!==this._pointB)return;this._pointB={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType}}-1!==this._currentMousePointerIdDown||I||(this._currentMousePointerIdDown=E.pointerId),this.onButtonDown(E),n||(E.preventDefault(),T&&T.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,S.c.POINTERDOWN|S.c.POINTERUP|S.c.POINTERMOVE|S.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,c=0,K=null,this.onLostFocus()},this._contextMenuBind=n=>this.onContextMenu(n),T&&T.addEventListener("contextmenu",this._contextMenuBind,!1);const Q=this.camera.va().getEngine().getHostWindow();Q&&O.e.RegisterTopRootEvents(Q,[{name:"blur",handler:this._onLostFocus}])}Ki(){if(this._onLostFocus){const n=this.camera.va().getEngine().getHostWindow();n&&O.e.UnregisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const n=this.camera.va().getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(n){}onTouch(n,k,T){}onMultiTouch(n,k,T,c,K,Q){}onContextMenu(n){n.preventDefault()}onButtonDown(n){}onButtonUp(n){}onLostFocus(){}}(0,c.e)([(0,K.K)()],u.prototype,"buttons",void 0);class f extends u{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(n,k){if(0!==this.panningSensibility&&n&&k){const T=k.x-n.x,c=k.y-n.y;this.camera.inertialPanningX+=-T/this.panningSensibility,this.camera.inertialPanningY+=c/this.panningSensibility}}_computePinchZoom(n,k){const T=this.camera.radius||f.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=T*Math.sqrt(n)/Math.sqrt(k):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(k-n)*T*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(k-n)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(n,k,T){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-k/this.panningSensibility,this.camera.inertialPanningY+=T/this.panningSensibility):(this.camera.inertialAlphaOffset-=k/this.angularSensibilityX,this.camera.inertialBetaOffset-=T/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(n,k,T,c,K,Q){0===T&&null===K||0===c&&null===Q||(this.multiTouchPanAndZoom?(this._computePinchZoom(T,c),this._computeMultiTouchPanning(K,Q)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(c)-Math.sqrt(T))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(T,c),this._isPinching=!0):this._computeMultiTouchPanning(K,Q)):this.multiTouchPanning?this._computeMultiTouchPanning(K,Q):this.pinchZoom&&this._computePinchZoom(T,c))}onButtonDown(n){this._isPanClick=n.button===this.camera._panningMouseButton}onButtonUp(n){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}f.MinimumRadiusForPinch=.001,(0,c.e)([(0,K.K)()],f.prototype,"buttons",void 0),(0,c.e)([(0,K.K)()],f.prototype,"angularSensibilityX",void 0),(0,c.e)([(0,K.K)()],f.prototype,"angularSensibilityY",void 0),(0,c.e)([(0,K.K)()],f.prototype,"pinchPrecision",void 0),(0,c.e)([(0,K.K)()],f.prototype,"pinchDeltaPercentage",void 0),(0,c.e)([(0,K.K)()],f.prototype,"useNaturalPinchZoom",void 0),(0,c.e)([(0,K.K)()],f.prototype,"pinchZoom",void 0),(0,c.e)([(0,K.K)()],f.prototype,"panningSensibility",void 0),(0,c.e)([(0,K.K)()],f.prototype,"multiTouchPanning",void 0),(0,c.e)([(0,K.K)()],f.prototype,"multiTouchPanAndZoom",void 0),q.c.ArcRotateCameraPointersInput=f;var A=T(2508);class v{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(n){n=O.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((k=>{const T=k.event;if(!T.metaKey)if(k.type===A.d.KEYDOWN){if(this._ctrlPressed=T.ctrlKey,this._altPressed=T.altKey,-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),T.preventDefault&&(n||T.preventDefault())}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){const k=this._keys.indexOf(T.keyCode);k>=0&&this._keys.splice(k,1),T.preventDefault&&(n||T.preventDefault())}})))}Ki(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const n=this.camera;for(let k=0;k<this._keys.length;k++){const T=this._keys[k];-1!==this.keysLeft.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningX-=1/this.panningSensibility:n.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?n.inertialRadiusOffset+=1/this.zoomingSensibility:n.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningX+=1/this.panningSensibility:n.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?n.inertialRadiusOffset-=1/this.zoomingSensibility:n.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(T)&&n.useInputToRestoreState&&n.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,c.e)([(0,K.K)()],v.prototype,"keysUp",void 0),(0,c.e)([(0,K.K)()],v.prototype,"keysDown",void 0),(0,c.e)([(0,K.K)()],v.prototype,"keysLeft",void 0),(0,c.e)([(0,K.K)()],v.prototype,"keysRight",void 0),(0,c.e)([(0,K.K)()],v.prototype,"keysReset",void 0),(0,c.e)([(0,K.K)()],v.prototype,"panningSensibility",void 0),(0,c.e)([(0,K.K)()],v.prototype,"zoomingSensibility",void 0),(0,c.e)([(0,K.K)()],v.prototype,"useAltToZoom",void 0),(0,c.e)([(0,K.K)()],v.prototype,"angularSpeed",void 0),q.c.ArcRotateCameraKeyboardMoveInput=v;var F=T(775),m=T(2516);class x{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new G.o(0,0,0),this._globalOffset=new G.o(0,0,0),this._inertialPanning=G.o.Zero()}_computeDeltaFromMouseWheelLegacyEvent(n,k){let T=0;const c=.01*n*this.wheelDeltaPercentage*k;return T=n>0?c/(1+this.wheelDeltaPercentage):c*(1+this.wheelDeltaPercentage),T}attachControl(n){n=O.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=k=>{if(k.type!==S.c.POINTERWHEEL)return;const T=k.event;let c=0;const K=T.deltaMode===m.c.DOM_DELTA_LINE?40:1,Q=-T.deltaY*K;if(this.customComputeDeltaFromMouseWheel)c=this.customComputeDeltaFromMouseWheel(Q,this,T);else if(this.wheelDeltaPercentage){if(c=this._computeDeltaFromMouseWheelLegacyEvent(Q,this.camera.radius),c>0){let n=this.camera.radius,k=this.camera.inertialRadiusOffset+c;for(let T=0;T<20&&!(n<=k)&&!(Math.abs(k*this.camera.inertia)<.001);T++)n-=k,k*=this.camera.inertia;n=(0,w.b)(n,0,Number.MAX_VALUE),c=this._computeDeltaFromMouseWheelLegacyEvent(Q,n)}}else c=Q/(40*this.wheelPrecision);c&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(c)):this.camera.inertialRadiusOffset+=c),T.preventDefault&&(n||T.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,S.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ki(0)}Ki(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const n=this.camera;0+n.inertialAlphaOffset+n.inertialBetaOffset+n.inertialRadiusOffset&&(this._updateHitPlane(),n.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(n.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const n=this.camera,k=n.target.Fg(n.position);this._hitPlane=F.c.FromPositionAndNormal(n.target,k)}_getPosition(){const n=this.camera,k=n.va(),T=k.createPickingRay(k.pointerX,k.pointerY,G.d.Identity(),n,!1);0===n.targetScreenOffset.x&&0===n.targetScreenOffset.y||(this._viewOffset.set(n.targetScreenOffset.x,n.targetScreenOffset.y,0),n.getViewMatrix().invertToRef(n._cameraTransformMatrix),this._globalOffset=G.o.TransformNormal(this._viewOffset,n._cameraTransformMatrix),T.origin.addInPlace(this._globalOffset));let c=0;return this._hitPlane&&(c=T.intersectsPlane(this._hitPlane)??0),T.origin.addInPlace(T.direction.scaleInPlace(c))}_zoomToMouse(n){const k=this.camera,T=1-k.inertia;if(k.lowerRadiusLimit){const c=k.lowerRadiusLimit??0;k.radius-(k.inertialRadiusOffset+n)/T<c&&(n=(k.radius-c)*T-k.inertialRadiusOffset)}if(k.upperRadiusLimit){const c=k.upperRadiusLimit??0;k.radius-(k.inertialRadiusOffset+n)/T>c&&(n=(k.radius-c)*T-k.inertialRadiusOffset)}const c=n/T/k.radius,K=this._getPosition(),Q=G.l.li[6];K.subtractToRef(k.target,Q),Q.scaleInPlace(c),Q.scaleInPlace(T),this._inertialPanning.addInPlace(Q),k.inertialRadiusOffset+=n}_zeroIfClose(n){Math.abs(n.x)<W.b&&(n.x=0),Math.abs(n.y)<W.b&&(n.y=0),Math.abs(n.z)<W.b&&(n.z=0)}}(0,c.e)([(0,K.K)()],x.prototype,"wheelPrecision",void 0),(0,c.e)([(0,K.K)()],x.prototype,"zoomToMouseLocation",void 0),(0,c.e)([(0,K.K)()],x.prototype,"wheelDeltaPercentage",void 0),q.c.ArcRotateCameraMouseWheelInput=x;class g extends q.g{constructor(n){super(n)}addMouseWheel(){return this.add(new x),this}addPointers(){return this.add(new f),this}addKeyboard(){return this.add(new v),this}}var U=T(675);function V(n,k){return isNaN(n)?k:n}E.c.AddNodeConstructor("ArcRotateCamera",((n,k)=>()=>new Y(n,0,0,1,G.o.Zero(),k)));class Y extends r.c{get target(){return this._target}set target(n){this.setTarget(n)}get targetHost(){return this._targetHost}set targetHost(n){n&&this.setTarget(n)}getTarget(){return this.target}get position(){return this._position}set position(n){this.setPosition(n)}set upVector(n){this._upToYMatrix||(this._yToUpMatrix=new G.d,this._upToYMatrix=new G.d,this._upVector=G.o.Zero()),n.normalize(),this._upVector.p(n),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){G.d.RotationAlignToRef(G.o.UpReadOnly,this._upVector,this._yToUpMatrix),G.d.RotationAlignToRef(this._upVector,G.o.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const n=this.inputs.attached.pointers;return n?n.angularSensibilityX:0}set angularSensibilityX(n){const k=this.inputs.attached.pointers;k&&(k.angularSensibilityX=n)}get angularSensibilityY(){const n=this.inputs.attached.pointers;return n?n.angularSensibilityY:0}set angularSensibilityY(n){const k=this.inputs.attached.pointers;k&&(k.angularSensibilityY=n)}get pinchPrecision(){const n=this.inputs.attached.pointers;return n?n.pinchPrecision:0}set pinchPrecision(n){const k=this.inputs.attached.pointers;k&&(k.pinchPrecision=n)}get pinchDeltaPercentage(){const n=this.inputs.attached.pointers;return n?n.pinchDeltaPercentage:0}set pinchDeltaPercentage(n){const k=this.inputs.attached.pointers;k&&(k.pinchDeltaPercentage=n)}get useNaturalPinchZoom(){const n=this.inputs.attached.pointers;return!!n&&n.useNaturalPinchZoom}set useNaturalPinchZoom(n){const k=this.inputs.attached.pointers;k&&(k.useNaturalPinchZoom=n)}get panningSensibility(){const n=this.inputs.attached.pointers;return n?n.panningSensibility:0}set panningSensibility(n){const k=this.inputs.attached.pointers;k&&(k.panningSensibility=n)}get keysUp(){const n=this.inputs.attached.keyboard;return n?n.keysUp:[]}set keysUp(n){const k=this.inputs.attached.keyboard;k&&(k.keysUp=n)}get keysDown(){const n=this.inputs.attached.keyboard;return n?n.keysDown:[]}set keysDown(n){const k=this.inputs.attached.keyboard;k&&(k.keysDown=n)}get keysLeft(){const n=this.inputs.attached.keyboard;return n?n.keysLeft:[]}set keysLeft(n){const k=this.inputs.attached.keyboard;k&&(k.keysLeft=n)}get keysRight(){const n=this.inputs.attached.keyboard;return n?n.keysRight:[]}set keysRight(n){const k=this.inputs.attached.keyboard;k&&(k.keysRight=n)}get wheelPrecision(){const n=this.inputs.attached.mousewheel;return n?n.wheelPrecision:0}set wheelPrecision(n){const k=this.inputs.attached.mousewheel;k&&(k.wheelPrecision=n)}get zoomToMouseLocation(){const n=this.inputs.attached.mousewheel;return!!n&&n.zoomToMouseLocation}set zoomToMouseLocation(n){const k=this.inputs.attached.mousewheel;k&&(k.zoomToMouseLocation=n)}get wheelDeltaPercentage(){const n=this.inputs.attached.mousewheel;return n?n.wheelDeltaPercentage:0}set wheelDeltaPercentage(n){const k=this.inputs.attached.mousewheel;k&&(k.wheelDeltaPercentage=n)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(n){n!==this.useBouncingBehavior&&(n?(this._bouncingBehavior=new b,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(n){n!==this.useFramingBehavior&&(n?(this._framingBehavior=new C,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(n){n!==this.useAutoRotationBehavior&&(n?(this._autoRotationBehavior=new J,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(n,k,T,c,K,w){var E;let I=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(n,G.o.Zero(),w,I),E=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=G.o.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=G.m.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new G.d,this.panningAxis=new G.o(1,1,0),this._transformedDirection=new G.o,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new Q.b,this.checkCollisions=!1,this.collisionRadius=new G.o(.5,.5,.5),this._previousPosition=G.o.Zero(),this._collisionVelocity=G.o.Zero(),this._newPosition=G.o.Zero(),this._computationVector=G.o.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new G.o(NaN,NaN,NaN),this._goalTargetScreenOffset=new G.m(NaN,NaN),this._onCollisionPositionChange=function(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T?(E.setPosition(k),E.Qh&&E.Qh(T)):E._previousPosition.p(E._position);const c=Math.cos(E.alpha),K=Math.sin(E.alpha),Q=Math.cos(E.beta);let G=Math.sin(E.beta);0===G&&(G=1e-4);const w=E._getTargetPosition();E._computationVector.di(E.radius*c*G,E.radius*Q,E.radius*K*G),w.addToRef(E._computationVector,E._newPosition),E._position.p(E._newPosition);let I=E.upVector;E.allowUpsideDown&&E.beta<0&&(I=I.clone(),I=I.negate()),E._computeViewMatrix(E._position,w,I),E._viewMatrix.addAtIndex(12,E.targetScreenOffset.x),E._viewMatrix.addAtIndex(13,E.targetScreenOffset.y),E._collisionTriggered=!1},this._target=G.o.Zero(),K&&this.setTarget(K),this.alpha=k,this.beta=T,this.radius=c,this.getViewMatrix(),this.inputs=new g(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new G.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=G.m.Zero()}_updateCache(n){n||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const n=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?n.addToRef(this._targetBoundingCenter,this._target):this._target.p(n)}const n=this._getLockedTargetPosition();return n||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>W.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,Q=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=Q?this._currentInterpolationFactor=Q:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=V(n,this._goalAlpha),this._goalBeta=V(k,this._goalBeta),this._goalRadius=V(T,this._goalRadius),this._goalTarget.set(V(c.x,this._goalTarget.x),V(c.y,this._goalTarget.y),V(c.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(V(K.x,this._goalTargetScreenOffset.x),V(K.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,w.b)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,w.b)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,w.b)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,w.b)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(n,k){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const K=arguments;k=O.e.BackCompatCameraNoPreventDefault(K),this._useCtrlForPanning=T,this._panningMouseButton=c,"boolean"===typeof K[0]&&(K.length>1&&(this._useCtrlForPanning=K[1]),K.length>2&&(this._panningMouseButton=K[2])),this.inputs.attachElement(k),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ki(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let n=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){n=!0;const k=this.invertRotation?-1:1,T=this._calculateHandednessMultiplier();let c=this.inertialAlphaOffset*T;this.beta<0&&(c*=-1),this.alpha+=c*k,this.beta+=this.inertialBetaOffset*k,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<W.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<W.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*W.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){n=!0;const k=new G.o(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),k.multiplyInPlace(this.panningAxis),G.o.TransformNormalToRef(k,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const n=this.upVector,k=G.o.CrossToRef(this._transformedDirection,n,this._transformedDirection);G.o.CrossToRef(n,k,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);G.o.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const n=G.l.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(n),n.transposeToRef(n),G.o.TransformCoordinatesToRef(this._transformedDirection,n,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*W.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*W.b&&(this.inertialPanningY=0)}if(n)this.stopInterpolation();else if(this._isInterpolating){let n=!1;const k=this._scene.getEngine().getDeltaTime()/1e3,T=1-Math.pow(2,-k/this._currentInterpolationFactor),c=V(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const k=G.l.li[0].set(V(this._goalTarget.x,this._target.x),V(this._goalTarget.y,this._target.y),V(this._goalTarget.z,this._target.z));G.o.LerpToRef(this.target,k,T,this._target),10*G.o.Distance(this.target,k)/c<W.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(k),this.setTarget(this.target,!1,!0,!0)):n=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const k=G.h.RotationAlphaBetaGammaToRef(V(this._goalAlpha,this.alpha),V(this._goalBeta,this.beta),0,G.l.Quaternion[0]),c=G.h.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,G.l.Quaternion[1]),K=G.h.SlerpToRef(c,k,T,G.l.Quaternion[2]);K.normalize();const Q=K.toAlphaBetaGammaToRef(G.l.li[0]);if(this.alpha=Q.x,this.beta=Q.y,K.isApprox(k,W.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const n=k.toAlphaBetaGammaToRef(G.l.li[0]);this.alpha=n.x,this.beta=n.y}else n=!0}if(isNaN(this._goalRadius)||(this.radius+=(c-this.radius)*T,Math.abs(c/this.radius-1)<W.b?(this._goalRadius=NaN,this.radius=c):n=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const k=G.l.Vector2[0].set(V(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),V(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));G.m.LerpToRef(this.targetScreenOffset,k,T,this.targetScreenOffset),G.m.Distance(this.targetScreenOffset,k)<W.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(k)):n=!0}this._isInterpolating=n}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.o.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const n=this.alpha;var k,T;this.alpha=function(n){let k=Math.PI/2;return 0===n.x&&0===n.z||(k=Math.acos(n.x/Math.sqrt(Math.pow(n.x,2)+Math.pow(n.z,2)))),n.z<0&&(k=2*Math.PI-k),k}(this._computationVector),this.beta=(k=this._computationVector.y,T=this.radius,Math.acos(k/T));const c=Math.round((n-this.alpha)/(2*Math.PI));this.alpha+=2*c*Math.PI,this._checkLimits()}setPosition(n){this._position.equals(n)||(this._position.p(n),this.rebuildAnglesAndRadius())}setTarget(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(c=this.overrideCloneAlphaBetaRadius??c,n.pi)k&&n.getBoundingInfo?this._targetBoundingCenter=n.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,n.pi(),this._targetHost=n,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const k=n,c=this._getTargetPosition();if(c&&!T&&c.equals(k))return;this._targetHost=null,this._target=k,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}c||this.rebuildAnglesAndRadius()}_getViewMatrix(){const n=Math.cos(this.alpha),k=Math.sin(this.alpha),T=Math.cos(this.beta);let c=Math.sin(this.beta);0===c&&(c=1e-4),0===this.radius&&(this.radius=1e-4);const K=this._getTargetPosition();if(this._computationVector.di(this.radius*n*c,this.radius*T,this.radius*k*c),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.o.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),K.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const n=this.va().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,n.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let n=this.upVector;this.allowUpsideDown&&c<0&&(n=n.negate()),this._computeViewMatrix(this._position,K,n),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(K),this._viewMatrix}zoomOn(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=n||this.va().meshes;const T=I.b.MinMax(n);let c=this._calculateLowerRadiusFromModelBoundingSphere(T.min,T.max);if(c=Math.max(Math.min(c,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=c*this.zoomOnFactor,this.mode===z.c.ORTHOGRAPHIC_CAMERA){const n=this.va().getEngine().getAspectRatio(this),k=c*this.zoomOnFactor/2;this.orthoLeft=-k*n,this.orthoRight=k*n,this.orthoBottom=-k,this.orthoTop=k}this.focusOn({min:T.min,max:T.max,distance:c},k)}focusOn(n){let k,T,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===n.min){const c=n||this.va().meshes;k=I.b.MinMax(c),T=G.o.Distance(k.min,k.max)}else{k=n,T=n.distance}this._target=I.b.Center(k),c||(this.maxZ=2*T)}createRigCamera(n,k){let T=0;switch(this.cameraRigMode){case z.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case z.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case z.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case z.c.RIG_MODE_VR:T=this._cameraRigParams.stereoHalfAngle*(0===k?1:-1);break;case z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:T=this._cameraRigParams.stereoHalfAngle*(0===k?-1:1)}const c=new Y(n,this.alpha+T,this.beta,this.radius,this._target,this.va());return c._cameraRigParams={},c.isRigCamera=!0,c.rigParent=this,c.upVector=this.upVector,c.mode=this.mode,c.orthoLeft=this.orthoLeft,c.orthoRight=this.orthoRight,c.orthoBottom=this.orthoBottom,c.orthoTop=this.orthoTop,c}_updateRigCameras(){const n=this._rigCameras[0],k=this._rigCameras[1];switch(n.beta=k.beta=this.beta,this.cameraRigMode){case z.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case z.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case z.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case z.c.RIG_MODE_VR:n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,k.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case z.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,k.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const c=G.o.Distance(n,k),K=this.va().getEngine().getAspectRatio(this),Q=Math.tan(this.fov/2),w=Q*K,E=.5*c*T,I=E*Math.sqrt(1+1/(w*w)),S=E*Math.sqrt(1+1/(Q*Q));return Math.max(I,S)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,c.e)([(0,K.K)()],Y.prototype,"alpha",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"beta",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"radius",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,c.e)([(0,K.I)("target")],Y.prototype,"_target",void 0),(0,c.e)([(0,K.w)("targetHost")],Y.prototype,"_targetHost",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"inertialAlphaOffset",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"inertialBetaOffset",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"inertialRadiusOffset",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"lowerAlphaLimit",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"upperAlphaLimit",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"lowerBetaLimit",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"upperBetaLimit",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"lowerRadiusLimit",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"upperRadiusLimit",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"lowerTargetYLimit",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"inertialPanningX",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"inertialPanningY",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"pinchToPanMaxDistance",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"panningDistanceLimit",void 0),(0,c.e)([(0,K.I)()],Y.prototype,"panningOriginTarget",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"panningInertia",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"zoomToMouseLocation",null),(0,c.e)([(0,K.K)()],Y.prototype,"zoomOnFactor",void 0),(0,c.e)([(0,K.E)()],Y.prototype,"targetScreenOffset",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"allowUpsideDown",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"useInputToRestoreState",void 0),(0,c.e)([(0,K.K)()],Y.prototype,"restoreStateInterpolationFactor",void 0),(0,U.f)("BABYLON.ArcRotateCamera",Y)},12695:(n,k,T)=>{"use strict";T.d(k,{c:()=>G,g:()=>w});var c=T(556),K=T(760),Q=T(701),G={};class w{constructor(n){this.attachedToElement=!1,this.attached={},this.camera=n,this.checkInputs=()=>{}}add(n){const k=n.getSimpleName();this.attached[k]?c.d.Warn("camera input of type "+k+" already exists on camera"):(this.attached[k]=n,n.camera=this.camera,n.checkInputs&&(this.checkInputs=this._addCheckInputs(n.checkInputs.bind(n))),this.attachedToElement&&n.attachControl(this.noPreventDefault))}remove(n){for(const k in this.attached){const T=this.attached[k];if(T===n)return T.Ki(),T.camera=null,delete this.attached[k],void this.rebuildInputCheck()}}removeByType(n){for(const k in this.attached){const T=this.attached[k];T.getClassName()===n&&(T.Ki(),T.camera=null,delete this.attached[k],this.rebuildInputCheck())}}_addCheckInputs(n){const k=this.checkInputs;return()=>{k(),n()}}attachInput(n){this.attachedToElement&&n.attachControl(this.noPreventDefault)}attachElement(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){n=!Q.c.ForceAttachControlToAlwaysPreventDefault&&n,this.attachedToElement=!0,this.noPreventDefault=n;for(const k in this.attached)this.attached[k].attachControl(n)}}detachElement(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const k in this.attached)this.attached[k].Ki(),n&&(this.attached[k].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const n in this.attached){const k=this.attached[n];k.checkInputs&&(this.checkInputs=this._addCheckInputs(k.checkInputs.bind(k)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(n){const k={};for(const T in this.attached){const n=this.attached[T],c=K.d.Serialize(n);k[n.getClassName()]=c}n.inputsmgr=k}parse(n){const k=n.inputsmgr;if(k){this.clear();for(const n in k){const T=G[n];if(T){const c=k[n],Q=K.d.Parse((()=>new T),c,null);this.add(Q)}}}else for(const T in this.attached){const k=G[this.attached[T].getClassName()];if(k){const c=K.d.Parse((()=>new k),n,null);this.remove(this.attached[T]),this.add(c)}}}}},12678:(n,k,T)=>{"use strict";T.d(k,{e:()=>u});var c=T(706),K=T(712),Q=T(730),G=T(12686),w=T(12695),E=T(2508),I=T(542);class S{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(n){n=I.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((k=>{const T=k.event;if(!T.metaKey)if(k.type===E.d.KEYDOWN){if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),n||T.preventDefault()}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){const k=this._keys.indexOf(T.keyCode);k>=0&&this._keys.splice(k,1),n||T.preventDefault()}})))}Ki(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const n=this.camera;for(let k=0;k<this._keys.length;k++){const T=this._keys[k],c=n._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(T)?n._localDirection.di(-c,0,0):-1!==this.keysUp.indexOf(T)?n._localDirection.di(0,0,c):-1!==this.keysRight.indexOf(T)?n._localDirection.di(c,0,0):-1!==this.keysDown.indexOf(T)?n._localDirection.di(0,0,-c):-1!==this.keysUpward.indexOf(T)?n._localDirection.di(0,c,0):-1!==this.keysDownward.indexOf(T)?n._localDirection.di(0,-c,0):-1!==this.keysRotateLeft.indexOf(T)?(n._localDirection.di(0,0,0),n.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(T)?(n._localDirection.di(0,0,0),n.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(T)?(n._localDirection.di(0,0,0),n.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(T)&&(n._localDirection.di(0,0,0),n.cameraRotation.x+=this._getLocalRotation()),n.va().useRightHandedSystem&&(n._localDirection.z*=-1),n.getViewMatrix().invertToRef(n._cameraTransformMatrix),Q.o.TransformNormalToRef(n._localDirection,n._cameraTransformMatrix,n._transformedDirection),n.cameraDirection.addInPlace(n._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const n=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*n}}(0,c.e)([(0,K.K)()],S.prototype,"keysUp",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysUpward",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysDown",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysDownward",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysLeft",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysRight",void 0),(0,c.e)([(0,K.K)()],S.prototype,"rotationSpeed",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysRotateLeft",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysRotateRight",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysRotateUp",void 0),(0,c.e)([(0,K.K)()],S.prototype,"keysRotateDown",void 0),w.c.FreeCameraKeyboardMoveInput=S;var P=T(539),W=T(2501);class J{constructor(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=n,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new P.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(n){n=I.e.BackCompatCameraNoPreventDefault(arguments);const k=this.camera.getEngine(),T=k.getInputElement();this._pointerInput||(this._pointerInput=c=>{const K=c.event,Q="touch"===K.pointerType;if(!this.touchEnabled&&Q)return;if(c.type!==W.c.POINTERMOVE&&-1===this.buttons.indexOf(K.button))return;const G=K.target;if(c.type===W.c.POINTERDOWN){if(Q&&-1!==this._activePointerId||!Q&&-1!==this._currentActiveButton)return;this._activePointerId=K.pointerId;try{null===G||void 0===G||G.setPointerCapture(K.pointerId)}catch(w){}-1===this._currentActiveButton&&(this._currentActiveButton=K.button),this._previousPosition={x:K.clientX,y:K.clientY},n||(K.preventDefault(),T&&T.focus()),k.isPointerLock&&this._onMouseMove&&this._onMouseMove(c.event)}else if(c.type===W.c.POINTERUP){if(Q&&this._activePointerId!==K.pointerId||!Q&&this._currentActiveButton!==K.button)return;try{null===G||void 0===G||G.releasePointerCapture(K.pointerId)}catch(w){}this._currentActiveButton=-1,this._previousPosition=null,n||K.preventDefault(),this._activePointerId=-1}else if(c.type===W.c.POINTERMOVE&&(this._activePointerId===K.pointerId||!Q))if(k.isPointerLock&&this._onMouseMove)this._onMouseMove(c.event);else if(this._previousPosition){const k=this.camera._calculateHandednessMultiplier(),T=(K.clientX-this._previousPosition.x)*k,c=K.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=T/this.angularSensibility,this.camera.cameraRotation.x+=c/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:T,offsetY:c}),this._previousPosition={x:K.clientX,y:K.clientY},n||K.preventDefault()}}),this._onMouseMove=T=>{if(!k.isPointerLock)return;const c=this.camera._calculateHandednessMultiplier(),K=T.movementX*c;this.camera.cameraRotation.y+=K/this.angularSensibility;const Q=T.movementY;this.camera.cameraRotation.x+=Q/this.angularSensibility,this._previousPosition=null,n||T.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,W.c.POINTERDOWN|W.c.POINTERUP|W.c.POINTERMOVE),T&&(this._contextMenuBind=n=>this.onContextMenu(n),T.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(n){n.preventDefault()}Ki(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const n=this.camera.getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,c.e)([(0,K.K)()],J.prototype,"buttons",void 0),(0,c.e)([(0,K.K)()],J.prototype,"angularSensibility",void 0),w.c.FreeCameraMouseInput=J;var H,s=T(2516);class b{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new P.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(n){n=I.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=k=>{if(k.type!==W.c.POINTERWHEEL)return;const T=k.event,c=T.deltaMode===s.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*c*T.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*c*T.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*c*T.deltaZ/this._normalize,T.preventDefault&&(n||T.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,W.c.POINTERWHEEL)}Ki(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,c.e)([(0,K.K)()],b.prototype,"wheelPrecisionX",void 0),(0,c.e)([(0,K.K)()],b.prototype,"wheelPrecisionY",void 0),(0,c.e)([(0,K.K)()],b.prototype,"wheelPrecisionZ",void 0),function(n){n[n.MoveRelative=0]="MoveRelative",n[n.RotateRelative=1]="RotateRelative",n[n.MoveScene=2]="MoveScene"}(H||(H={}));class C extends b{constructor(){super(...arguments),this._moveRelative=Q.o.Zero(),this._rotateRelative=Q.o.Zero(),this._moveScene=Q.o.Zero(),this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(n){null===n&&this._wheelXAction!==H.MoveRelative||(this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=n)}get wheelXMoveRelative(){return this._wheelXAction!==H.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(n){null===n&&this._wheelYAction!==H.MoveRelative||(this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=n)}get wheelYMoveRelative(){return this._wheelYAction!==H.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(n){null===n&&this._wheelZAction!==H.MoveRelative||(this._wheelZAction=H.MoveRelative,this._wheelZActionCoordinate=n)}get wheelZMoveRelative(){return this._wheelZAction!==H.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(n){null===n&&this._wheelXAction!==H.RotateRelative||(this._wheelXAction=H.RotateRelative,this._wheelXActionCoordinate=n)}get wheelXRotateRelative(){return this._wheelXAction!==H.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(n){null===n&&this._wheelYAction!==H.RotateRelative||(this._wheelYAction=H.RotateRelative,this._wheelYActionCoordinate=n)}get wheelYRotateRelative(){return this._wheelYAction!==H.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(n){null===n&&this._wheelZAction!==H.RotateRelative||(this._wheelZAction=H.RotateRelative,this._wheelZActionCoordinate=n)}get wheelZRotateRelative(){return this._wheelZAction!==H.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(n){null===n&&this._wheelXAction!==H.MoveScene||(this._wheelXAction=H.MoveScene,this._wheelXActionCoordinate=n)}get wheelXMoveScene(){return this._wheelXAction!==H.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(n){null===n&&this._wheelYAction!==H.MoveScene||(this._wheelYAction=H.MoveScene,this._wheelYActionCoordinate=n)}get wheelYMoveScene(){return this._wheelYAction!==H.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(n){null===n&&this._wheelZAction!==H.MoveScene||(this._wheelZAction=H.MoveScene,this._wheelZActionCoordinate=n)}get wheelZMoveScene(){return this._wheelZAction!==H.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ki(0),this._rotateRelative.ki(0),this._moveScene.ki(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const n=Q.d.Zero();this.camera.getViewMatrix().invertToRef(n);const k=Q.o.Zero();Q.o.TransformNormalToRef(this._moveRelative,n,k),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(k),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(n,k,T){if(0===n)return;if(null===k||null===T)return;let c=null;switch(k){case H.MoveRelative:c=this._moveRelative;break;case H.RotateRelative:c=this._rotateRelative;break;case H.MoveScene:c=this._moveScene}switch(T){case 0:c.set(n,0,0);break;case 1:c.set(0,n,0);break;case 2:c.set(0,0,n)}}}(0,c.e)([(0,K.K)()],C.prototype,"wheelXMoveRelative",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelYMoveRelative",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelZMoveRelative",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelXRotateRelative",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelYRotateRelative",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelZRotateRelative",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelXMoveScene",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelYMoveScene",null),(0,c.e)([(0,K.K)()],C.prototype,"wheelZMoveScene",null),w.c.FreeCameraMouseWheelInput=C;class z{constructor(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=n,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=I.e.IsSafari()}attachControl(n){n=I.e.BackCompatCameraNoPreventDefault(arguments);let k=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=T=>{const c=T.event,K="mouse"===c.pointerType||this._isSafari&&"undefined"===typeof c.pointerType;if(this.allowMouse||!K)if(T.type===W.c.POINTERDOWN){if(n||c.preventDefault(),this._pointerPressed.push(c.pointerId),1!==this._pointerPressed.length)return;k={x:c.clientX,y:c.clientY}}else if(T.type===W.c.POINTERUP){n||c.preventDefault();const T=this._pointerPressed.indexOf(c.pointerId);if(-1===T)return;if(this._pointerPressed.splice(T,1),0!=T)return;k=null,this._offsetX=null,this._offsetY=null}else if(T.type===W.c.POINTERMOVE){if(n||c.preventDefault(),!k)return;if(0!=this._pointerPressed.indexOf(c.pointerId))return;this._offsetX=c.clientX-k.x,this._offsetY=-(c.clientY-k.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,W.c.POINTERDOWN|W.c.POINTERUP|W.c.POINTERMOVE),this._onLostFocus){const n=this.camera.getEngine().getInputElement();n&&n.addEventListener("blur",this._onLostFocus)}}Ki(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const n=this.camera.getEngine().getInputElement();n&&n.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const n=this.camera,k=n._calculateHandednessMultiplier();n.cameraRotation.y=k*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)n.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const k=n._computeLocalCameraSpeed(),T=new Q.o(0,0,0!==this.touchMoveSensibility?k*this._offsetY/this.touchMoveSensibility:0);Q.d.RotationYawPitchRollToRef(n.rotation.y,n.rotation.x,0,n._cameraRotationMatrix),n.cameraDirection.addInPlace(Q.o.TransformCoordinates(T,n._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,c.e)([(0,K.K)()],z.prototype,"touchAngularSensibility",void 0),(0,c.e)([(0,K.K)()],z.prototype,"touchMoveSensibility",void 0),w.c.FreeCameraTouchInput=z;class r extends w.g{constructor(n){super(n),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new S),this}addMouse(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new J(n),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new C,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new z),this}clear(){super.clear(),this._mouseInput=null}}var q=T(675),O=T(615);class u extends G.c{get angularSensibility(){const n=this.inputs.attached.mouse;return n?n.angularSensibility:0}set angularSensibility(n){const k=this.inputs.attached.mouse;k&&(k.angularSensibility=n)}get keysUp(){const n=this.inputs.attached.keyboard;return n?n.keysUp:[]}set keysUp(n){const k=this.inputs.attached.keyboard;k&&(k.keysUp=n)}get keysUpward(){const n=this.inputs.attached.keyboard;return n?n.keysUpward:[]}set keysUpward(n){const k=this.inputs.attached.keyboard;k&&(k.keysUpward=n)}get keysDown(){const n=this.inputs.attached.keyboard;return n?n.keysDown:[]}set keysDown(n){const k=this.inputs.attached.keyboard;k&&(k.keysDown=n)}get keysDownward(){const n=this.inputs.attached.keyboard;return n?n.keysDownward:[]}set keysDownward(n){const k=this.inputs.attached.keyboard;k&&(k.keysDownward=n)}get keysLeft(){const n=this.inputs.attached.keyboard;return n?n.keysLeft:[]}set keysLeft(n){const k=this.inputs.attached.keyboard;k&&(k.keysLeft=n)}get keysRight(){const n=this.inputs.attached.keyboard;return n?n.keysRight:[]}set keysRight(n){const k=this.inputs.attached.keyboard;k&&(k.keysRight=n)}get keysRotateLeft(){const n=this.inputs.attached.keyboard;return n?n.keysRotateLeft:[]}set keysRotateLeft(n){const k=this.inputs.attached.keyboard;k&&(k.keysRotateLeft=n)}get keysRotateRight(){const n=this.inputs.attached.keyboard;return n?n.keysRotateRight:[]}set keysRotateRight(n){const k=this.inputs.attached.keyboard;k&&(k.keysRotateRight=n)}get keysRotateUp(){const n=this.inputs.attached.keyboard;return n?n.keysRotateUp:[]}set keysRotateUp(n){const k=this.inputs.attached.keyboard;k&&(k.keysRotateUp=n)}get keysRotateDown(){const n=this.inputs.attached.keyboard;return n?n.keysRotateDown:[]}set keysRotateDown(n){const k=this.inputs.attached.keyboard;k&&(k.keysRotateDown=n)}constructor(n,k,T){var c;super(n,k,T,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),c=this,this.ellipsoid=new Q.o(.5,1,.5),this.ellipsoidOffset=new Q.o(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Q.o.Zero(),this._diffPosition=Q.o.Zero(),this._newPosition=Q.o.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c._newPosition.p(k),c._newPosition.subtractToRef(c._oldPosition,c._diffPosition),c._diffPosition.length()>O.b.CollisionsEpsilon&&(c.position.addToRef(c._diffPosition,c._deferredPositionUpdate),c._deferOnly?c._deferredUpdated=!0:c.position.p(c._deferredPositionUpdate),c.Qh&&T&&c.Qh(T))},this.inputs=new r(this),this.inputs.addKeyboard().addMouse()}attachControl(n,k){k=I.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(k)}Ki(){this.inputs.detachElement(),this.cameraDirection=new Q.o(0,0,0),this.cameraRotation=new Q.m(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(n){this._collisionMask=isNaN(n)?-1:n}_collideWithWorld(n){let k;k=this.parent?Q.o.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,k.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const T=this.va().collisionCoordinator;this._collider||(this._collider=T.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let c=n;this.applyGravity&&(c=n.add(this.va().gravity)),T.getNewPosition(this._oldPosition,c,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Q.o.Zero(),this._transformedDirection=Q.o.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(n){this._needMoveForGravity=n}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,c.e)([(0,K.I)()],u.prototype,"ellipsoid",void 0),(0,c.e)([(0,K.I)()],u.prototype,"ellipsoidOffset",void 0),(0,c.e)([(0,K.K)()],u.prototype,"checkCollisions",void 0),(0,c.e)([(0,K.K)()],u.prototype,"applyGravity",void 0),(0,q.f)("BABYLON.FreeCamera",u)},12686:(n,k,T)=>{"use strict";T.d(k,{c:()=>P});var c=T(706),K=T(712),Q=T(701),G=T(730),w=T(736),E=T(909);T(752).c.AddNodeConstructor("TargetCamera",((n,k)=>()=>new P(n,G.o.Zero(),k)));const I=G.d.Zero(),S=G.h.Identity();class P extends Q.c{constructor(n,k,T){super(n,k,T,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new G.o(0,0,0),this.cameraRotation=new G.m(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=G.o.Zero(),this._initialFocalDistance=1,this._viewMatrix=G.d.Zero(),this._cameraTransformMatrix=G.d.Zero(),this._cameraRotationMatrix=G.d.Zero(),this._transformedReferencePoint=G.o.Zero(),this._deferredPositionUpdate=new G.o,this._deferredRotationQuaternionUpdate=new G.h,this._deferredRotationUpdate=new G.o,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=G.o.Forward(this.va().useRightHandedSystem),this.rotation=new G.o(0,this.va().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(n){this.getWorldMatrix();const k=G.l.li[0],T=G.l.li[1];return T.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(T,k),k.scaleInPlace(n),this.globalPosition.add(k)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const n=this.lockedTarget;n.pi().getTranslationToRef(n.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.di(0,0,0),this.cameraRotation.di(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new G.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new G.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new G.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(n){n||super._updateCache();const k=this._getLockedTargetPosition();k?this._cache.lockedTarget?this._cache.lockedTarget.p(k):this._cache.lockedTarget=k.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const n=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(n):!n)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const n=this.getEngine();return this.speed*Math.sqrt(n.getDeltaTime()/(100*n.getFps()))}setTarget(n){this.upVector.normalize(),this._initialFocalDistance=n.Fg(this.position).length(),this.position.z===n.z&&(this.position.z+=w.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.va().useRightHandedSystem?G.d.LookAtRHToRef(this.position,n,G.o.UpReadOnly,I):G.d.LookAtLHToRef(this.position,n,G.o.UpReadOnly,I),I.invert();const k=this.rotationQuaternion||S;G.h.FromRotationMatrixToRef(I,k),k.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(n){this.setTarget(n)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(G.l.Matrix[0]),G.o.TransformNormalToRef(this.cameraDirection,G.l.Matrix[0],G.l.li[0]),this._deferredPositionUpdate.addInPlace(G.l.li[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const n=this.invertRotation?-this.inverseRotationSpeed:1,k=this._decideIfNeedsToMove(),T=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),k&&this._updatePosition(),T){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*n,this._deferredRotationUpdate.y+=this.cameraRotation.y*n,!this.noRotationConstraint){const n=1.570796;this._deferredRotationUpdate.x>n&&(this._deferredRotationUpdate.x=n),this._deferredRotationUpdate.x<-n&&(this._deferredRotationUpdate.x=-n)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(G.h.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}k&&(Math.abs(this.cameraDirection.x)<this.speed*w.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*w.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*w.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),T&&(Math.abs(this.cameraRotation.x)<this.speed*w.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*w.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):G.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return G.o.TransformNormalToRef(G.o.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),G.o.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?E.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(G.h.FromEulerVectorToRef(this.rotation,S),E.d.Y.rotateByQuaternionToRef(S,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(n,k,T){if(this.va().useRightHandedSystem?G.d.LookAtRHToRef(n,k,T,this._viewMatrix):G.d.LookAtLHToRef(n,k,T,this._viewMatrix),this.parent){const n=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(n,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(n)}createRigCamera(n,k){if(this.cameraRigMode!==Q.c.RIG_MODE_NONE){const k=new P(n,this.position.clone(),this.va());return k.isRigCamera=!0,k.rigParent=this,this.cameraRigMode===Q.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new G.h),k._cameraRigParams={},k.rotationQuaternion=new G.h),k.mode=this.mode,k.orthoLeft=this.orthoLeft,k.orthoRight=this.orthoRight,k.orthoTop=this.orthoTop,k.orthoBottom=this.orthoBottom,k}return null}_updateRigCameras(){const n=this._rigCameras[0],k=this._rigCameras[1];switch(this.pi(),this.cameraRigMode){case Q.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Q.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const T=this.cameraRigMode===Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,c=this.cameraRigMode===Q.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*T,n),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*c,k);break}case Q.c.RIG_MODE_VR:n.rotationQuaternion?(n.rotationQuaternion.p(this.rotationQuaternion),k.rotationQuaternion.p(this.rotationQuaternion)):(n.rotation.p(this.rotation),k.rotation.p(this.rotation)),n.position.p(this.position),k.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(n,k){this.getTarget().subtractToRef(this.position,P._TargetFocalPoint),P._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const T=P._TargetFocalPoint.addInPlace(this.position);G.d.TranslationToRef(-T.x,-T.y,-T.z,P._TargetTransformMatrix),P._TargetTransformMatrix.multiplyToRef(G.d.RotationAxis(k.upVector,n),P._RigCamTransformMatrix),G.d.TranslationToRef(T.x,T.y,T.z,P._TargetTransformMatrix),P._RigCamTransformMatrix.multiplyToRef(P._TargetTransformMatrix,P._RigCamTransformMatrix),G.o.TransformCoordinatesToRef(this.position,P._RigCamTransformMatrix,k.position),k.setTarget(T)}getClassName(){return"TargetCamera"}}P._RigCamTransformMatrix=new G.d,P._TargetTransformMatrix=new G.d,P._TargetFocalPoint=new G.o,(0,c.e)([(0,K.K)()],P.prototype,"updateUpVectorFromRotation",void 0),(0,c.e)([(0,K.I)()],P.prototype,"rotation",void 0),(0,c.e)([(0,K.K)()],P.prototype,"speed",void 0),(0,c.e)([(0,K.w)("lockedTargetId")],P.prototype,"lockedTarget",void 0)},13137:(n,k,T)=>{"use strict";T.d(k,{b:()=>Q});var c=T(727),K=T(13142);class Q{constructor(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=T,this._k=[],this._maxBlockCapacity=k||64,this._selectionContent=new c.e(1024),this._creationFunc=n}update(n,k,T){K.d._CreateBlocks(n,k,T,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Ui(n){for(let k=0;k<this.$i.length;k++){this.$i[k].addEntry(n)}}Wi(n){for(let k=0;k<this.$i.length;k++){this.$i[k].removeEntry(n)}}select(n,k){this._selectionContent.reset();for(let T=0;T<this.$i.length;T++){this.$i[T].select(n,this._selectionContent,k)}return k?this._selectionContent.concat(this._k):this._selectionContent.concatWithNoDuplicate(this._k),this._selectionContent}intersects(n,k,T){this._selectionContent.reset();for(let c=0;c<this.$i.length;c++){this.$i[c].intersects(n,k,this._selectionContent,T)}return T?this._selectionContent.concat(this._k):this._selectionContent.concatWithNoDuplicate(this._k),this._selectionContent}intersectsRay(n){this._selectionContent.reset();for(let k=0;k<this.$i.length;k++){this.$i[k].intersectsRay(n,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this._k),this._selectionContent}}Q.CreationFuncForMeshes=(n,k)=>{const T=n.getBoundingInfo();!n.isBlocked&&T.boundingBox.intersectsMinMax(k.bl,k.cl)&&k.entries.push(n)},Q.CreationFuncForSubMeshes=(n,k)=>{n.getBoundingInfo().boundingBox.intersectsMinMax(k.bl,k.cl)&&k.entries.push(n)}},13142:(n,k,T)=>{"use strict";T.d(k,{d:()=>Q});var c=T(730),K=T(824);class Q{constructor(n,k,T,c,K,Q){this.entries=[],this.dl=new Array,this._capacity=T,this._depth=c,this._maxDepth=K,this._creationFunc=Q,this._minPoint=n,this._maxPoint=k,this.dl.push(n.clone()),this.dl.push(k.clone()),this.dl.push(n.clone()),this.dl[2].x=k.x,this.dl.push(n.clone()),this.dl[3].y=k.y,this.dl.push(n.clone()),this.dl[4].z=k.z,this.dl.push(k.clone()),this.dl[5].z=n.z,this.dl.push(k.clone()),this.dl[6].x=n.x,this.dl.push(k.clone()),this.dl[7].y=n.y}get Vh(){return this._capacity}get bl(){return this._minPoint}get cl(){return this._maxPoint}addEntry(n){if(this.$i)for(let k=0;k<this.$i.length;k++){this.$i[k].addEntry(n)}else this._creationFunc(n,this),this.entries.length>this.Vh&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(n){if(this.$i){for(let k=0;k<this.$i.length;k++){this.$i[k].removeEntry(n)}return}const k=this.entries.indexOf(n);k>-1&&this.entries.splice(k,1)}addEntries(n){for(let k=0;k<n.length;k++){const T=n[k];this.addEntry(T)}}select(n,k,T){if(K.e.IsInFrustum(this.dl,n)){if(this.$i){for(let c=0;c<this.$i.length;c++){this.$i[c].select(n,k,T)}return}T?k.concat(this.entries):k.concatWithNoDuplicate(this.entries)}}intersects(n,k,T,c){if(K.e.IntersectsSphere(this._minPoint,this._maxPoint,n,k)){if(this.$i){for(let K=0;K<this.$i.length;K++){this.$i[K].intersects(n,k,T,c)}return}c?T.concat(this.entries):T.concatWithNoDuplicate(this.entries)}}intersectsRay(n,k){if(n.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.$i){for(let T=0;T<this.$i.length;T++){this.$i[T].intersectsRay(n,k)}return}k.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Q._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(n,k,T,K,G,w,E,I){E.$i=new Array;const S=new c.o((k.x-n.x)/2,(k.y-n.y)/2,(k.z-n.z)/2);for(let c=0;c<2;c++)for(let k=0;k<2;k++)for(let P=0;P<2;P++){const W=n.add(S.multiplyByFloats(c,k,P)),J=n.add(S.multiplyByFloats(c+1,k+1,P+1)),H=new Q(W,J,K,G+1,w,I);H.addEntries(T),E.$i.push(H)}}}},13150:(n,k,T)=>{"use strict";T.d(k,{e:()=>S});var c=T(2475),K=T(730),Q=T(878),G=T(12445),w=T(940),E=T(13137),I=T(588);c.c.prototype.createOrUpdateSelectionOctree=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,T=this._getComponent(w.e.NAME_OCTREE);T||(T=new S(this),this.o(T)),this.Zk||(this.Zk=new E.b(E.b.CreationFuncForMeshes,n,k));const c=this.getWorldExtends();return this.Zk.update(c.min,c.max,this.meshes),this.Zk},Object.defineProperty(c.c.prototype,"selectionOctree",{get:function(){return this.Zk},enumerable:!0,configurable:!0}),Q.e.prototype.createOrUpdateSubmeshesOctree=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const T=this.va();let c=T._getComponent(w.e.NAME_OCTREE);c||(c=new S(T),T.o(c)),this._submeshesOctree||(this._submeshesOctree=new E.b(E.b.CreationFuncForSubMeshes,n,k)),this.pi(!0);const K=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(K.minimumWorld,K.maximumWorld,this.si),this._submeshesOctree};class S{constructor(n){this.name=w.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new G.c(K.o.Zero(),new K.o(1,1,1)),(n=n||I.e.LastCreatedScene)&&(this.me=n,this.me.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.me.getActiveSubMeshCandidates=n=>this.getActiveSubMeshCandidates(n),this.me.getCollidingSubMeshCandidates=(n,k)=>this.getCollidingSubMeshCandidates(n,k),this.me.getIntersectingSubMeshCandidates=(n,k)=>this.getIntersectingSubMeshCandidates(n,k))}register(){this.me.onMeshRemovedObservable.add((n=>{const k=this.me.selectionOctree;if(void 0!==k&&null!==k){const T=k._k.indexOf(n);-1!==T&&k._k.splice(T,1)}})),this.me.onMeshImportedObservable.add((n=>{const k=this.me.selectionOctree;void 0!==k&&null!==k&&k.Ui(n)}))}getActiveMeshCandidates(){var n;return(null===(n=this.me.Zk)||void 0===n?void 0:n.select(this.me.frustumPlanes))||this.me._getDefaultMeshCandidates()}getActiveSubMeshCandidates(n){if(n._submeshesOctree&&n.useOctreeForRenderingSelection){return n._submeshesOctree.select(this.me.frustumPlanes)}return this.me._getDefaultSubMeshCandidates(n)}getIntersectingSubMeshCandidates(n,k){if(n._submeshesOctree&&n.useOctreeForPicking){G.c.TransformToRef(k,n.getWorldMatrix(),this._tempRay);return n._submeshesOctree.intersectsRay(this._tempRay)}return this.me._getDefaultSubMeshCandidates(n)}getCollidingSubMeshCandidates(n,k){if(n._submeshesOctree&&n.useOctreeForCollisions){const T=k._velocityWorldLength+Math.max(k._radius.x,k._radius.y,k._radius.z);return n._submeshesOctree.intersects(k._basePointWorld,T)}return this.me._getDefaultSubMeshCandidates(n)}rebuild(){}dispose(){}}},12445:(n,k,T)=>{"use strict";T.d(k,{c:()=>J});var c=T(2475),K=T(701),Q=T(736),G=T(730),w=T(744),E=T(815),I=T(892),S=T(588),P=T(2519);const W={internalPickerForMesh:void 0};class J{constructor(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.b;this.origin=n,this.direction=k,this.length=T,this.epsilon=c}clone(){return new J(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const c=J._TmpVector3[0].di(n.x-T,n.y-T,n.z-T),K=J._TmpVector3[1].di(k.x+T,k.y+T,k.z+T);let Q,G,w,E,I=0,S=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<c.x||this.origin.x>K.x)return!1}else if(Q=1/this.direction.x,G=(c.x-this.origin.x)*Q,w=(K.x-this.origin.x)*Q,w===-1/0&&(w=1/0),G>w&&(E=G,G=w,w=E),I=Math.max(G,I),S=Math.min(w,S),I>S)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<c.y||this.origin.y>K.y)return!1}else if(Q=1/this.direction.y,G=(c.y-this.origin.y)*Q,w=(K.y-this.origin.y)*Q,w===-1/0&&(w=1/0),G>w&&(E=G,G=w,w=E),I=Math.max(G,I),S=Math.min(w,S),I>S)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<c.z||this.origin.z>K.z)return!1}else if(Q=1/this.direction.z,G=(c.z-this.origin.z)*Q,w=(K.z-this.origin.z)*Q,w===-1/0&&(w=1/0),G>w&&(E=G,G=w,w=E),I=Math.max(G,I),S=Math.min(w,S),I>S)return!1;return!0}intersectsBox(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(n.minimum,n.maximum,k)}intersectsSphere(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=n.center.x-this.origin.x,c=n.center.y-this.origin.y,K=n.center.z-this.origin.z,Q=T*T+c*c+K*K,G=n.radius+k,w=G*G;if(Q<=w)return!0;const E=T*this.direction.x+c*this.direction.y+K*this.direction.z;if(E<0)return!1;return Q-E*E<=w}intersectsTriangle(n,k,T){const c=J._TmpVector3[0],K=J._TmpVector3[1],Q=J._TmpVector3[2],w=J._TmpVector3[3],I=J._TmpVector3[4];k.subtractToRef(n,c),T.subtractToRef(n,K),G.o.CrossToRef(this.direction,K,Q);const S=G.o.Dot(c,Q);if(0===S)return null;const P=1/S;this.origin.subtractToRef(n,w);const W=G.o.Dot(w,Q)*P;if(W<-this.epsilon||W>1+this.epsilon)return null;G.o.CrossToRef(w,c,I);const H=G.o.Dot(this.direction,I)*P;if(H<-this.epsilon||W+H>1+this.epsilon)return null;const s=G.o.Dot(K,I)*P;return s>this.length?null:new E.d(1-W-H,W,s)}intersectsPlane(n){let k;const T=G.o.Dot(n.Pi,this.direction);if(Math.abs(T)<9.99999997475243e-7)return null;{const c=G.o.Dot(n.Pi,this.origin);return k=(-n.d-c)/T,k<0?k<-9.99999997475243e-7?null:0:k}}intersectsAxis(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(n){case"y":{const n=(this.origin.y-k)/this.direction.y;return n>0?null:new G.o(this.origin.x+this.direction.x*-n,k,this.origin.z+this.direction.z*-n)}case"x":{const n=(this.origin.x-k)/this.direction.x;return n>0?null:new G.o(k,this.origin.y+this.direction.y*-n,this.origin.z+this.direction.z*-n)}case"z":{const n=(this.origin.z-k)/this.direction.z;return n>0?null:new G.o(this.origin.x+this.direction.x*-n,this.origin.y+this.direction.y*-n,k)}default:return null}}intersectsMesh(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=G.l.Matrix[0];return n.getWorldMatrix().invertToRef(w),this._tmpRay?J.TransformToRef(this,w,this._tmpRay):this._tmpRay=J.Transform(this,w),n.intersects(this._tmpRay,k,T,c,K,Q)}intersectsMeshes(n,k,T){T?T.length=0:T=[];for(let c=0;c<n.length;c++){const K=this.intersectsMesh(n[c],k);K.hit&&T.push(K)}return T.sort(this._comparePickingInfo),T}_comparePickingInfo(n,k){return n.distance<k.distance?-1:n.distance>k.distance?1:0}intersectionSegment(n,k,T){const c=this.origin,K=G.l.li[0],Q=G.l.li[1],w=G.l.li[2],E=G.l.li[3];k.subtractToRef(n,K),this.direction.scaleToRef(J._Rayl,w),c.addToRef(w,Q),n.subtractToRef(c,E);const I=G.o.Dot(K,K),S=G.o.Dot(K,w),P=G.o.Dot(w,w),W=G.o.Dot(K,E),H=G.o.Dot(w,E),s=I*P-S*S;let b,C,z=s,r=s;s<J._Smallnum?(b=0,z=1,C=H,r=P):(b=S*H-P*W,C=I*H-S*W,b<0?(b=0,C=H,r=P):b>z&&(b=z,C=H+S,r=P)),C<0?(C=0,-W<0?b=0:-W>I?b=z:(b=-W,z=I)):C>r&&(C=r,-W+S<0?b=0:-W+S>I?b=z:(b=-W+S,z=I));const q=Math.abs(b)<J._Smallnum?0:b/z,O=Math.abs(C)<J._Smallnum?0:C/r,u=G.l.li[4];w.scaleToRef(O,u);const f=G.l.li[5];K.scaleToRef(q,f),f.addInPlace(E);const A=G.l.li[6];f.subtractToRef(u,A);return O>0&&O<=this.length&&A.lengthSquared()<T*T?f.length():-1}update(n,k,T,c,K,Q,w){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){J._RayDistant||(J._RayDistant=J.Zero()),J._RayDistant.unprojectRayToRef(n,k,T,c,G.d.IdentityReadOnly,Q,w);const E=G.l.Matrix[0];K.invertToRef(E),J.TransformToRef(J._RayDistant,E,this)}else this.unprojectRayToRef(n,k,T,c,K,Q,w);return this}static Zero(){return new J(G.o.Zero(),G.o.Zero())}static CreateNew(n,k,T,c,K,Q,G){return J.Zero().update(n,k,T,c,K,Q,G)}static CreateNewFromTo(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.d.IdentityReadOnly;const c=new J(new G.o(0,0,0),new G.o(0,0,0));return J.CreateFromToToRef(n,k,c,T)}static CreateFromToToRef(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.d.IdentityReadOnly;T.origin.p(n);const K=k.subtractToRef(n,T.direction),Q=Math.sqrt(K.x*K.x+K.y*K.y+K.z*K.z);return T.length=Q,T.direction.normalize(),J.TransformToRef(T,c,T)}static Transform(n,k){const T=new J(new G.o(0,0,0),new G.o(0,0,0));return J.TransformToRef(n,k,T),T}static TransformToRef(n,k,T){G.o.TransformCoordinatesToRef(n.origin,k,T.origin),G.o.TransformNormalToRef(n.direction,k,T.direction),T.length=n.length,T.epsilon=n.epsilon;const c=T.direction,K=c.length();if(0!==K&&1!==K){const n=1/K;c.x*=n,c.y*=n,c.z*=n,T.length*=K}return T}unprojectRayToRef(n,k,T,c,K,Q,w){const E=G.l.Matrix[0];K.multiplyToRef(Q,E),E.multiplyToRef(w,E),E.invert();const I=S.e.LastCreatedEngine,P=G.l.li[0];P.x=n/T*2-1,P.y=-(k/c*2-1),P.z=null!==I&&void 0!==I&&I.useReverseDepthBuffer?1:null!==I&&void 0!==I&&I.isNDCHalfZRange?0:-1;const W=G.l.li[1].di(P.x,P.y,1-1e-8),J=G.l.li[2],H=G.l.li[3];G.o._UnprojectFromInvertedMatrixToRef(P,E,J),G.o._UnprojectFromInvertedMatrixToRef(W,E,H),this.origin.p(J),H.subtractToRef(J,this.direction),this.direction.normalize()}}function H(n,k,T,c,K){let Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=J.Zero();return s(n,k,T,c,G,K,Q),G}function s(n,k,T,c,K,Q){let w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const I=n.getEngine();if(!Q&&!(Q=n.activeCamera))return n;const S=Q.viewport,P=I.getRenderHeight(),{x:W,y:J,width:H,height:s}=S.toGlobal(I.getRenderWidth(),P),b=1/I.getHardwareScalingLevel();return k=k*b-W,T=T*b-(P-J-s),K.update(k,T,H,s,c||G.d.IdentityReadOnly,w?G.d.IdentityReadOnly:Q.getViewMatrix(),Q.getProjectionMatrix(),E),n}function b(n,k,T,c,K){if(!I.e)return n;const Q=n.getEngine();if(!K&&!(K=n.activeCamera))throw new Error("Active camera not set");const w=K.viewport,E=Q.getRenderHeight(),{x:S,y:P,width:W,height:J}=w.toGlobal(Q.getRenderWidth(),E),H=G.d.Identity(),s=1/Q.getHardwareScalingLevel();return k=k*s-S,T=T*s-(E-P-J),c.update(k,T,W,J,H,H,K.getProjectionMatrix()),n}function C(n,k,T,c,K,Q,G,w){const E=k(c,T.enableDistantPicking),I=T.intersects(E,K,G,Q,c,w);return I&&I.hit?!K&&null!=n&&I.distance>=n.distance?null:I:null}function z(n,k,T,c,K,Q){let w=null;const E=!!(n.activeCameras&&n.activeCameras.length>1&&n.cameraToUseForPointers!==n.activeCamera),S=n.cameraToUseForPointers||n.activeCamera,P=W.internalPickerForMesh||C;for(let I=0;I<n.meshes.length;I++){const W=n.meshes[I];if(T){if(!T(W,-1))continue}else if(!W.isEnabled()||!W.isVisible||!W.xi)continue;const J=E&&W.isWorldMatrixCameraDependent(),H=W.pi(J,S);if(W.hasThinInstances&&W.thinInstanceEnablePicking){const n=P(w,k,W,H,!0,!0,Q);if(n){if(K)return n;const E=G.l.Matrix[1],I=W.thinInstanceGetWorldMatrices();for(let n=0;n<I.length;n++){if(T&&!T(W,n))continue;I[n].multiplyToRef(H,E);const G=P(w,k,W,E,c,K,Q,!0);if(G&&(w=G,w.thinInstanceIndex=n,c))return w}}}else{const n=P(w,k,W,H,c,K,Q);if(n&&(w=n,c))return w}}return w||new I.e}function r(n,k,T,c){if(!I.e)return null;const K=[],Q=!!(n.activeCameras&&n.activeCameras.length>1&&n.cameraToUseForPointers!==n.activeCamera),w=n.cameraToUseForPointers||n.activeCamera,E=W.internalPickerForMesh||C;for(let I=0;I<n.meshes.length;I++){const S=n.meshes[I];if(T){if(!T(S,-1))continue}else if(!S.isEnabled()||!S.isVisible||!S.xi)continue;const P=Q&&S.isWorldMatrixCameraDependent(),W=S.pi(P,w);if(S.hasThinInstances&&S.thinInstanceEnablePicking){if(E(null,k,S,W,!0,!0,c)){const n=G.l.Matrix[1],Q=S.thinInstanceGetWorldMatrices();for(let G=0;G<Q.length;G++){if(T&&!T(S,G))continue;Q[G].multiplyToRef(W,n);const w=E(null,k,S,n,!1,!1,c,!0);w&&(w.thinInstanceIndex=G,K.push(w))}}}else{const n=E(null,k,S,W,!1,!1,c);n&&K.push(n)}}return K}function q(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,c=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0;c||(c=n.getWorldMatrix()),k.length=T,K?k.origin.p(K):k.origin.p(n.position);const Q=G.l.li[2];Q.set(0,0,n._scene.useRightHandedSystem?-1:1);const w=G.l.li[3];return G.o.TransformNormalToRef(Q,c,w),G.o.NormalizeToRef(w,k.direction),k}var O,u;J._TmpVector3=(0,w.d)(6,G.o.Zero),J._RayDistant=J.Zero(),J._Smallnum=1e-8,J._Rayl=1e9,O=c.c,(u=K.c)&&(u.prototype.getForwardRay=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,k=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;return q(this,new J(G.o.Zero(),G.o.Zero(),n),n,k,T)},u.prototype.getForwardRayToRef=function(n){return q(this,n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),O&&(P.e._IsPickingAvailable=!0,O.prototype.createPickingRay=function(n,k,T,c){return H(this,n,k,T,c,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),c.c.prototype.createPickingRayToRef=function(n,k,T,c,K){return s(this,n,k,T,c,K,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},c.c.prototype.createPickingRayInCameraSpace=function(n,k,T){return function(n,k,T,c){const K=J.Zero();return b(n,k,T,K,c),K}(this,n,k,T)},c.c.prototype.createPickingRayInCameraSpaceToRef=function(n,k,T,c){return b(this,n,k,T,c)},c.c.prototype.pickWithBoundingInfo=function(n,k,T,c,K){return function(n,k,T,c,K,Q){if(!I.e)return null;const w=z(n,(c=>(n._tempPickingRay||(n._tempPickingRay=J.Zero()),s(n,k,T,c,n._tempPickingRay,Q||null),n._tempPickingRay)),c,K,!0);return w&&(w.ray=H(n,k,T,G.d.Identity(),Q||null)),w}(this,n,k,T,c,K)},c.c.prototype.Ik=function(n,k,T,c,K,Q){return function(n,k,T,c,K,Q,w){const E=z(n,((c,K)=>(n._tempPickingRay||(n._tempPickingRay=J.Zero()),s(n,k,T,c,n._tempPickingRay,Q||null,!1,K),n._tempPickingRay)),c,K,!1,w);return E&&(E.ray=H(n,k,T,G.d.Identity(),Q||null)),E}(this,n,k,T,c,K,Q)},c.c.prototype.pickWithRay=function(n,k,T,c){return function(n,k,T,c,K){const Q=z(n,(T=>(n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=G.d.Identity()),T.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=J.Zero()),J.TransformToRef(k,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform)),T,c,!1,K);return Q&&(Q.ray=k),Q}(this,n,k,T,c)},c.c.prototype.multiPick=function(n,k,T,c,K){return function(n,k,T,c,K,Q){return r(n,(c=>H(n,k,T,c,K||null)),c,Q)}(this,n,k,T,c,K)},c.c.prototype.multiPickWithRay=function(n,k,T){return function(n,k,T,c){return r(n,(T=>(n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=G.d.Identity()),T.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=J.Zero()),J.TransformToRef(k,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform)),T,c)}(this,n,k,T)}},2454:(n,k,T)=>{"use strict";var c=T(654),K=T(556),Q=T(591),G=T(684),w=T(615),E=T(663);w.b.prototype._partialLoadFile=function(n,k,T,c){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(n,(n=>{T[k]=n,T._internalCount++,6===T._internalCount&&c(T)}),void 0,void 0,!0,((n,k)=>{K&&n&&K(n.status+" "+n.statusText,k)}))},w.b.prototype._cascadeLoadFiles=function(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const K=[];K._internalCount=0;for(let Q=0;Q<6;Q++)this._partialLoadFile(T[Q],Q,K,k,c)},w.b.prototype._cascadeLoadImgs=function(n,k,T,c){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5?arguments[5]:void 0;const G=[];G._internalCount=0;for(let w=0;w<6;w++)this._partialLoadImg(c[w],w,G,n,k,T,K,Q)},w.b.prototype._partialLoadImg=function(n,k,T,c,K,w){let E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7?arguments[7]:void 0;const S=(0,G.d)();(0,Q.m)(n,(n=>{T[k]=n,T._internalCount++,c&&c.removePendingData(S),6===T._internalCount&&w&&w(K,T)}),((n,k)=>{c&&c.removePendingData(S),E&&E(n,k)}),c?c.offlineProvider:null,I),c&&c.addPendingData(S)},w.b.prototype.createCubeTextureBase=function(n,k,T,Q){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,s=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,b=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,C=arguments.length>14&&void 0!==arguments[14]&&arguments[14],z=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const r=H||new c.d(this,7);r.isCube=!0,r.url=n,r.generateMipMaps=!Q,r._lodGenerationScale=W,r._lodGenerationOffset=J,r._useSRGBBuffer=!!C&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Q),r!==H&&(r.label=n.substring(0,60)),this._doNotHandleContextLost||(r._extension=S,r._files=T,r._buffer=z);const q=n;this._transformTextureUrl&&!H&&(n=this._transformTextureUrl(n));const O=S??function(n){const k=n.split("?")[0],T=k.lastIndexOf(".");return T>-1?k.substring(T).toLowerCase():""}(n),u=(0,E.c)(O),f=(n,k)=>{r.dispose(),w?w(n,k):n&&K.d.Warn(n)},A=(c,w)=>{n===q?c&&f(c.status+" "+c.statusText,w):(K.d.Warn(`Failed to load ${n}, falling back to the ${q}`),this.createCubeTextureBase(q,k,T,!!Q,G,f,I,S,P,W,J,r,s,b,C,z))};if(u)u.then((c=>{const K=n=>{s&&s(r,n),c.loadCubeData(n,r,P,G,((n,k)=>{f(n,k)}))};z?K(z):T&&6===T.length?c.supportCascades?this._cascadeLoadFiles(k,(n=>K(n.map((n=>new Uint8Array(n))))),T,f):f("Textures type does not support cascades."):this._loadFile(n,(n=>K(new Uint8Array(n))),void 0,void 0,!0,A)}));else{if(!T||0===T.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(k,r,((n,k)=>{b&&b(n,k)}),T,f)}return this._internalTexturesCache.push(r),r}},12766:(n,k,T)=>{"use strict";T.d(k,{b:()=>c});class c{}c.AUTOSAMPLERSUFFIX="Sampler",c.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",c.ALPHA_DISABLE=0,c.ALPHA_ADD=1,c.ALPHA_COMBINE=2,c.ALPHA_SUBTRACT=3,c.ALPHA_MULTIPLY=4,c.ALPHA_MAXIMIZED=5,c.ALPHA_ONEONE=6,c.ALPHA_PREMULTIPLIED=7,c.ALPHA_PREMULTIPLIED_PORTERDUFF=8,c.ALPHA_INTERPOLATE=9,c.ALPHA_SCREENMODE=10,c.ALPHA_ONEONE_ONEONE=11,c.ALPHA_ALPHATOCOLOR=12,c.ALPHA_REVERSEONEMINUS=13,c.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,c.ALPHA_ONEONE_ONEZERO=15,c.ALPHA_EXCLUSION=16,c.ALPHA_LAYER_ACCUMULATE=17,c.ALPHA_EQUATION_ADD=0,c.ALPHA_EQUATION_SUBSTRACT=1,c.ALPHA_EQUATION_REVERSE_SUBTRACT=2,c.ALPHA_EQUATION_MAX=3,c.ALPHA_EQUATION_MIN=4,c.ALPHA_EQUATION_DARKEN=5,c.DELAYLOADSTATE_NONE=0,c.DELAYLOADSTATE_LOADED=1,c.DELAYLOADSTATE_LOADING=2,c.DELAYLOADSTATE_NOTLOADED=4,c.NEVER=512,c.ALWAYS=519,c.LESS=513,c.EQUAL=514,c.LEQUAL=515,c.GREATER=516,c.GEQUAL=518,c.NOTEQUAL=517,c.KEEP=7680,c.ZERO=0,c.REPLACE=7681,c.INCR=7682,c.DECR=7683,c.INVERT=5386,c.INCR_WRAP=34055,c.DECR_WRAP=34056,c.TEXTURE_CLAMP_ADDRESSMODE=0,c.TEXTURE_WRAP_ADDRESSMODE=1,c.TEXTURE_MIRROR_ADDRESSMODE=2,c.TEXTURE_CREATIONFLAG_STORAGE=1,c.TEXTUREFORMAT_ALPHA=0,c.TEXTUREFORMAT_LUMINANCE=1,c.TEXTUREFORMAT_LUMINANCE_ALPHA=2,c.TEXTUREFORMAT_RGB=4,c.TEXTUREFORMAT_RGBA=5,c.TEXTUREFORMAT_RED=6,c.TEXTUREFORMAT_R=6,c.TEXTUREFORMAT_R16_UNORM=33322,c.TEXTUREFORMAT_RG16_UNORM=33324,c.TEXTUREFORMAT_RGB16_UNORM=32852,c.TEXTUREFORMAT_RGBA16_UNORM=32859,c.TEXTUREFORMAT_R16_SNORM=36760,c.TEXTUREFORMAT_RG16_SNORM=36761,c.TEXTUREFORMAT_RGB16_SNORM=36762,c.TEXTUREFORMAT_RGBA16_SNORM=36763,c.TEXTUREFORMAT_RG=7,c.TEXTUREFORMAT_RED_INTEGER=8,c.TEXTUREFORMAT_R_INTEGER=8,c.TEXTUREFORMAT_RG_INTEGER=9,c.TEXTUREFORMAT_RGB_INTEGER=10,c.TEXTUREFORMAT_RGBA_INTEGER=11,c.TEXTUREFORMAT_BGRA=12,c.TEXTUREFORMAT_DEPTH24_STENCIL8=13,c.TEXTUREFORMAT_DEPTH32_FLOAT=14,c.TEXTUREFORMAT_DEPTH16=15,c.TEXTUREFORMAT_DEPTH24=16,c.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,c.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,c.TEXTUREFORMAT_STENCIL8=19,c.TEXTUREFORMAT_UNDEFINED=4294967295,c.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,c.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,c.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,c.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,c.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,c.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,c.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,c.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,c.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,c.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,c.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,c.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,c.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,c.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,c.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,c.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,c.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,c.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,c.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,c.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,c.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,c.TEXTURETYPE_UNSIGNED_BYTE=0,c.TEXTURETYPE_UNSIGNED_INT=0,c.TEXTURETYPE_FLOAT=1,c.TEXTURETYPE_HALF_FLOAT=2,c.TEXTURETYPE_BYTE=3,c.TEXTURETYPE_SHORT=4,c.TEXTURETYPE_UNSIGNED_SHORT=5,c.TEXTURETYPE_INT=6,c.TEXTURETYPE_UNSIGNED_INTEGER=7,c.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,c.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,c.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,c.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,c.TEXTURETYPE_UNSIGNED_INT_24_8=12,c.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,c.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,c.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,c.TEXTURETYPE_UNDEFINED=16,c.TEXTURE_2D=3553,c.TEXTURE_2D_ARRAY=35866,c.TEXTURE_CUBE_MAP=34067,c.TEXTURE_CUBE_MAP_ARRAY=3735928559,c.TEXTURE_3D=32879,c.TEXTURE_NEAREST_SAMPLINGMODE=1,c.TEXTURE_NEAREST_NEAREST=1,c.TEXTURE_BILINEAR_SAMPLINGMODE=2,c.TEXTURE_LINEAR_LINEAR=2,c.TEXTURE_TRILINEAR_SAMPLINGMODE=3,c.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,c.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,c.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,c.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,c.TEXTURE_NEAREST_LINEAR=7,c.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,c.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,c.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,c.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,c.TEXTURE_LINEAR_NEAREST=12,c.TEXTURE_EXPLICIT_MODE=0,c.TEXTURE_SPHERICAL_MODE=1,c.TEXTURE_PLANAR_MODE=2,c.TEXTURE_CUBIC_MODE=3,c.TEXTURE_PROJECTION_MODE=4,c.TEXTURE_SKYBOX_MODE=5,c.TEXTURE_INVCUBIC_MODE=6,c.TEXTURE_EQUIRECTANGULAR_MODE=7,c.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,c.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,c.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,c.TEXTURE_FILTERING_QUALITY_HIGH=64,c.TEXTURE_FILTERING_QUALITY_MEDIUM=16,c.TEXTURE_FILTERING_QUALITY_LOW=8,c.SCALEMODE_FLOOR=1,c.SCALEMODE_NEAREST=2,c.SCALEMODE_CEILING=3,c.MATERIAL_TextureDirtyFlag=1,c.MATERIAL_LightDirtyFlag=2,c.MATERIAL_FresnelDirtyFlag=4,c.MATERIAL_AttributesDirtyFlag=8,c.MATERIAL_MiscDirtyFlag=16,c.MATERIAL_PrePassDirtyFlag=32,c.MATERIAL_ImageProcessingDirtyFlag=64,c.MATERIAL_AllDirtyFlag=127,c.MATERIAL_TriangleFillMode=0,c.MATERIAL_WireFrameFillMode=1,c.MATERIAL_PointFillMode=2,c.MATERIAL_PointListDrawMode=3,c.MATERIAL_LineListDrawMode=4,c.MATERIAL_LineLoopDrawMode=5,c.MATERIAL_LineStripDrawMode=6,c.MATERIAL_TriangleStripDrawMode=7,c.MATERIAL_TriangleFanDrawMode=8,c.MATERIAL_ClockWiseSideOrientation=0,c.MATERIAL_CounterClockWiseSideOrientation=1,c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,c.MATERIAL_DIFFUSE_MODEL_BURLEY=1,c.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,c.MATERIAL_DIFFUSE_MODEL_LEGACY=3,c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,c.ACTION_NothingTrigger=0,c.ACTION_OnPickTrigger=1,c.ACTION_OnLeftPickTrigger=2,c.ACTION_OnRightPickTrigger=3,c.ACTION_OnCenterPickTrigger=4,c.ACTION_OnPickDownTrigger=5,c.ACTION_OnDoublePickTrigger=6,c.ACTION_OnPickUpTrigger=7,c.ACTION_OnPickOutTrigger=16,c.ACTION_OnLongPressTrigger=8,c.ACTION_OnPointerOverTrigger=9,c.ACTION_OnPointerOutTrigger=10,c.ACTION_OnEveryFrameTrigger=11,c.ACTION_OnIntersectionEnterTrigger=12,c.ACTION_OnIntersectionExitTrigger=13,c.ACTION_OnKeyDownTrigger=14,c.ACTION_OnKeyUpTrigger=15,c.PARTICLES_BILLBOARDMODE_Y=2,c.PARTICLES_BILLBOARDMODE_ALL=7,c.PARTICLES_BILLBOARDMODE_STRETCHED=8,c.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,c.MESHES_CULLINGSTRATEGY_STANDARD=0,c.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,c.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,c.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,c.SCENELOADER_NO_LOGGING=0,c.SCENELOADER_MINIMAL_LOGGING=1,c.SCENELOADER_SUMMARY_LOGGING=2,c.SCENELOADER_DETAILED_LOGGING=3,c.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,c.PREPASS_POSITION_TEXTURE_TYPE=1,c.PREPASS_VELOCITY_TEXTURE_TYPE=2,c.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,c.PREPASS_COLOR_TEXTURE_TYPE=4,c.PREPASS_DEPTH_TEXTURE_TYPE=5,c.PREPASS_NORMAL_TEXTURE_TYPE=6,c.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,c.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,c.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,c.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,c.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,c.PREPASS_ALBEDO_TEXTURE_TYPE=12,c.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,c.BUFFER_CREATIONFLAG_READ=1,c.BUFFER_CREATIONFLAG_WRITE=2,c.BUFFER_CREATIONFLAG_READWRITE=3,c.BUFFER_CREATIONFLAG_UNIFORM=4,c.BUFFER_CREATIONFLAG_VERTEX=8,c.BUFFER_CREATIONFLAG_INDEX=16,c.BUFFER_CREATIONFLAG_STORAGE=32,c.BUFFER_CREATIONFLAG_INDIRECT=64,c.RENDERPASS_MAIN=0,c.INPUT_ALT_KEY=18,c.INPUT_CTRL_KEY=17,c.INPUT_META_KEY1=91,c.INPUT_META_KEY2=92,c.INPUT_META_KEY3=93,c.INPUT_SHIFT_KEY=16,c.SNAPSHOTRENDERING_STANDARD=0,c.SNAPSHOTRENDERING_FAST=1,c.PERSPECTIVE_CAMERA=0,c.ORTHOGRAPHIC_CAMERA=1,c.FOVMODE_VERTICAL_FIXED=0,c.FOVMODE_HORIZONTAL_FIXED=1,c.RIG_MODE_NONE=0,c.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c.RIG_MODE_STEREOSCOPIC_INTERLACED=14,c.RIG_MODE_VR=20,c.RIG_MODE_CUSTOM=22,c.MAX_SUPPORTED_UV_SETS=6,c.GL_ALPHA_EQUATION_ADD=32774,c.GL_ALPHA_EQUATION_MIN=32775,c.GL_ALPHA_EQUATION_MAX=32776,c.GL_ALPHA_EQUATION_SUBTRACT=32778,c.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,c.GL_ALPHA_FUNCTION_SRC=768,c.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,c.GL_ALPHA_FUNCTION_SRC_ALPHA=770,c.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,c.GL_ALPHA_FUNCTION_DST_ALPHA=772,c.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,c.GL_ALPHA_FUNCTION_DST_COLOR=774,c.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,c.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,c.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,c.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,c.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,c.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,c.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,c.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,c.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,c.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,c.SnippetUrl="https://snippet.babylonjs.com",c.FOGMODE_NONE=0,c.FOGMODE_EXP=1,c.FOGMODE_EXP2=2,c.FOGMODE_LINEAR=3,c.BYTE=5120,c.UNSIGNED_BYTE=5121,c.SHORT=5122,c.UNSIGNED_SHORT=5123,c.INT=5124,c.UNSIGNED_INT=5125,c.FLOAT=5126,c.PositionKind="position",c.NormalKind="Pi",c.TangentKind="tangent",c.UVKind="uv",c.UV2Kind="uv2",c.UV3Kind="uv3",c.UV4Kind="uv4",c.UV5Kind="uv5",c.UV6Kind="uv6",c.ColorKind="color",c.ColorInstanceKind="instanceColor",c.MatricesIndicesKind="matricesIndices",c.MatricesWeightsKind="matricesWeights",c.MatricesIndicesExtraKind="matricesIndicesExtra",c.MatricesWeightsExtraKind="matricesWeightsExtra",c.ANIMATIONTYPE_FLOAT=0,c.ANIMATIONTYPE_VECTOR3=1,c.ANIMATIONTYPE_QUATERNION=2,c.ANIMATIONTYPE_MATRIX=3,c.ANIMATIONTYPE_COLOR3=4,c.ANIMATIONTYPE_COLOR4=7,c.ANIMATIONTYPE_VECTOR2=5,c.ANIMATIONTYPE_SIZE=6,c.ShadowMinZ=0,c.ShadowMaxZ=1e4},13152:(n,k,T)=>{"use strict";T(556);var c=T(2388);T(654),T(787),T(646),T(2437),T(2394);c.b},12829:(n,k,T)=>{"use strict";T.d(k,{d:()=>K});var c=T(675);class K{constructor(n){this.value=this._toInt(n)}_toInt(n){return 0|n}add(n){return new K(this.value+n.value)}Fg(n){return new K(this.value-n.value)}multiply(n){return new K(Math.imul(this.value,n.value))}divide(n){return new K(this.value/n.value)}getClassName(){return K.ClassName}equals(n){return this.value===n.value}static FromValue(n){return new K(n)}toString(){return this.value.toString()}}K.ClassName="FlowGraphInteger",(0,c.f)("FlowGraphInteger",K)},12836:(n,k,T)=>{"use strict";T.d(k,{e:()=>K,h:()=>Q});var c=T(730);class K{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Ii=n}get m(){return this.Ii}transformVector(n){return this.transformVectorToRef(n,new c.m)}transformVectorToRef(n,k){return k.x=n.x*this.Ii[0]+n.y*this.Ii[1],k.y=n.x*this.Ii[2]+n.y*this.Ii[3],k}wi(){return this.toArray()}toArray(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let k=0;k<4;k++)n[k]=this.Ii[k];return n}Ni(n){for(let k=0;k<4;k++)this.Ii[k]=n[k];return this}multiplyToRef(n,k){const T=n.Ii,c=this.Ii,K=k.Ii;return K[0]=T[0]*c[0]+T[1]*c[2],K[1]=T[0]*c[1]+T[1]*c[3],K[2]=T[2]*c[0]+T[3]*c[2],K[3]=T[2]*c[1]+T[3]*c[3],k}multiply(n){return this.multiplyToRef(n,new K)}divideToRef(n,k){const T=this.Ii,c=n.Ii,K=k.Ii;return K[0]=T[0]/c[0],K[1]=T[1]/c[1],K[2]=T[2]/c[2],K[3]=T[3]/c[3],k}divide(n){return this.divideToRef(n,new K)}addToRef(n,k){const T=this.Ii,c=n.m,K=k.m;return K[0]=T[0]+c[0],K[1]=T[1]+c[1],K[2]=T[2]+c[2],K[3]=T[3]+c[3],k}add(n){return this.addToRef(n,new K)}subtractToRef(n,k){const T=this.Ii,c=n.m,K=k.m;return K[0]=T[0]-c[0],K[1]=T[1]-c[1],K[2]=T[2]-c[2],K[3]=T[3]-c[3],k}Fg(n){return this.subtractToRef(n,new K)}transpose(){const n=this.Ii;return new K([n[0],n[2],n[1],n[3]])}determinant(){const n=this.Ii;return n[0]*n[3]-n[1]*n[2]}inverse(){const n=this.determinant();if(0===n)throw new Error("Matrix is not invertible");const k=this.Ii,T=1/n;return new K([k[3]*T,-k[1]*T,-k[2]*T,k[0]*T])}equals(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.Ii,c=n.m;return 0===k?T[0]===c[0]&&T[1]===c[1]&&T[2]===c[2]&&T[3]===c[3]:Math.abs(T[0]-c[0])<k&&Math.abs(T[1]-c[1])<k&&Math.abs(T[2]-c[2])<k&&Math.abs(T[3]-c[3])<k}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Ii.join(", ")})`}}class Q{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Ii=n}get m(){return this.Ii}transformVector(n){return this.transformVectorToRef(n,new c.o)}transformVectorToRef(n,k){const T=this.Ii;return k.x=n.x*T[0]+n.y*T[1]+n.z*T[2],k.y=n.x*T[3]+n.y*T[4]+n.z*T[5],k.z=n.x*T[6]+n.y*T[7]+n.z*T[8],k}multiplyToRef(n,k){const T=n.Ii,c=this.Ii,K=k.m;return K[0]=T[0]*c[0]+T[1]*c[3]+T[2]*c[6],K[1]=T[0]*c[1]+T[1]*c[4]+T[2]*c[7],K[2]=T[0]*c[2]+T[1]*c[5]+T[2]*c[8],K[3]=T[3]*c[0]+T[4]*c[3]+T[5]*c[6],K[4]=T[3]*c[1]+T[4]*c[4]+T[5]*c[7],K[5]=T[3]*c[2]+T[4]*c[5]+T[5]*c[8],K[6]=T[6]*c[0]+T[7]*c[3]+T[8]*c[6],K[7]=T[6]*c[1]+T[7]*c[4]+T[8]*c[7],K[8]=T[6]*c[2]+T[7]*c[5]+T[8]*c[8],k}multiply(n){return this.multiplyToRef(n,new Q)}divideToRef(n,k){const T=this.Ii,c=n.m,K=k.m;return K[0]=T[0]/c[0],K[1]=T[1]/c[1],K[2]=T[2]/c[2],K[3]=T[3]/c[3],K[4]=T[4]/c[4],K[5]=T[5]/c[5],K[6]=T[6]/c[6],K[7]=T[7]/c[7],K[8]=T[8]/c[8],k}divide(n){return this.divideToRef(n,new Q)}addToRef(n,k){const T=this.Ii,c=n.m,K=k.m;return K[0]=T[0]+c[0],K[1]=T[1]+c[1],K[2]=T[2]+c[2],K[3]=T[3]+c[3],K[4]=T[4]+c[4],K[5]=T[5]+c[5],K[6]=T[6]+c[6],K[7]=T[7]+c[7],K[8]=T[8]+c[8],k}add(n){return this.addToRef(n,new Q)}subtractToRef(n,k){const T=this.Ii,c=n.m,K=k.m;return K[0]=T[0]-c[0],K[1]=T[1]-c[1],K[2]=T[2]-c[2],K[3]=T[3]-c[3],K[4]=T[4]-c[4],K[5]=T[5]-c[5],K[6]=T[6]-c[6],K[7]=T[7]-c[7],K[8]=T[8]-c[8],k}Fg(n){return this.subtractToRef(n,new Q)}toArray(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let k=0;k<9;k++)n[k]=this.Ii[k];return n}wi(){return this.toArray()}Ni(n){for(let k=0;k<9;k++)this.Ii[k]=n[k];return this}transpose(){const n=this.Ii;return new Q([n[0],n[3],n[6],n[1],n[4],n[7],n[2],n[5],n[8]])}determinant(){const n=this.Ii;return n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6])}inverse(){const n=this.determinant();if(0===n)throw new Error("Matrix is not invertible");const k=this.Ii,T=1/n;return new Q([(k[4]*k[8]-k[5]*k[7])*T,(k[2]*k[7]-k[1]*k[8])*T,(k[1]*k[5]-k[2]*k[4])*T,(k[5]*k[6]-k[3]*k[8])*T,(k[0]*k[8]-k[2]*k[6])*T,(k[2]*k[3]-k[0]*k[5])*T,(k[3]*k[7]-k[4]*k[6])*T,(k[1]*k[6]-k[0]*k[7])*T,(k[0]*k[4]-k[1]*k[3])*T])}equals(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.Ii,c=n.m;return 0===k?T[0]===c[0]&&T[1]===c[1]&&T[2]===c[2]&&T[3]===c[3]&&T[4]===c[4]&&T[5]===c[5]&&T[6]===c[6]&&T[7]===c[7]&&T[8]===c[8]:Math.abs(T[0]-c[0])<k&&Math.abs(T[1]-c[1])<k&&Math.abs(T[2]-c[2])<k&&Math.abs(T[3]-c[3])<k&&Math.abs(T[4]-c[4])<k&&Math.abs(T[5]-c[5])<k&&Math.abs(T[6]-c[6])<k&&Math.abs(T[7]-c[7])<k&&Math.abs(T[8]-c[8])<k}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Ii.join(", ")})`}}},12841:(n,k,T)=>{"use strict";var c;function K(n,k,T,c){switch(k){case"Animation":return c?n.animations.find((n=>n.uniqueId===T))??null:n.animations[T]??null;case"AnimationGroup":return c?n.animationGroups.find((n=>n.uniqueId===T))??null:n.animationGroups[T]??null;case"Mesh":return c?n.meshes.find((n=>n.uniqueId===T))??null:n.meshes[T]??null;case"Material":return c?n.materials.find((n=>n.uniqueId===T))??null:n.materials[T]??null;case"Ji":return c?n.cameras.find((n=>n.uniqueId===T))??null:n.cameras[T]??null;case"Light":return c?n.lights.find((n=>n.uniqueId===T))??null:n.lights[T]??null;default:return null}}T.d(k,{e:()=>K}),function(n){n.Animation="Animation",n.AnimationGroup="AnimationGroup",n.Mesh="Mesh",n.Material="Material",n.Ji="Ji",n.Light="Light"}(c||(c={}))},12871:(n,k,T)=>{"use strict";T.d(k,{e:()=>K});var c=T(12875);class K extends c.c{constructor(n,k){if(super(n),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),k)for(const T of k)this._eventsSignalOutputs[T]=this._registerSignalOutput(T+"Event")}_executeOnTick(n){}_startPendingTasks(n){n._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(n),this._resetAfterCanceled(n)),this._preparePendingTasks(n),n._addPendingBlock(this),this.out._activateSignal(n),n._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(n){n._deleteExecutionVariable(this,"_initialized"),n._removePendingBlock(this)}}},12845:(n,k,T)=>{"use strict";T.d(k,{b:()=>I});var c=T(684),K=T(675),Q=T(12852),G=T(539),w=T(12821);class E extends Q.b{constructor(n,k,T,c){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c.defaultValue,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(n,k,T),this.richType=c,this._defaultValue=K,this._optional=Q,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new G.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(n){this._isDisabled!==n&&(this._isDisabled=n,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(n,k){k._getConnectionValue(this)!==n&&(k._setConnectionValue(this,n),this.onValueChangedObservable.notifyObservers(n))}resetToDefaultValue(n){n._setConnectionValue(this,this._defaultValue)}connectTo(n){this._isDisabled||super.connectTo(n)}_getValueOrDefault(n){const k=n._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(k):k}getValue(n){if(1===this.connectionType){n._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(n);const k=this._getValueOrDefault(n);return this._lastValue=k,this.richType.typeTransformer?this.richType.typeTransformer(k):k}const k=this.isConnected()?this._connectedPoint[0].getValue(n):this._getValueOrDefault(n);return this._lastValue=k,this.richType.typeTransformer?this.richType.typeTransformer(k):k}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(n),n.richType={},this.richType.serialize(n.richType),n.optional=this._optional,(0,w.f)("defaultValue",this._defaultValue,n)}}(0,K.f)("FlowGraphDataConnection",E);class I{constructor(n){var k;this.config=n,this.uniqueId=(0,c.d)(),this.name=(null===(k=this.config)||void 0===k?void 0:k.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(n){}registerDataInput(n,k,T){const c=new E(n,0,this,k,T);return this.dataInputs.push(c),c}registerDataOutput(n,k,T){const c=new E(n,1,this,k,T);return this.dataOutputs.push(c),c}getDataInput(n){return this.dataInputs.find((k=>k.name===n))}getDataOutput(n){return this.dataOutputs.find((k=>k.name===n))}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.f;if(n.uniqueId=this.uniqueId,n.config={},this.config){const T=this.config,c=Object.keys(T);for(const K of c)k(K,T[K],n.config)}n.dataInputs=[],n.dataOutputs=[],n.className=this.getClassName();for(const T of this.dataInputs){const k={};T.serialize(k),n.dataInputs.push(k)}for(const T of this.dataOutputs){const k={};T.serialize(k),n.dataOutputs.push(k)}}deserialize(n){}_log(n,k,T){var c;null===(c=n.logger)||void 0===c||c.addLogItem({action:k,payload:T,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12852:(n,k,T)=>{"use strict";T.d(k,{b:()=>Q});var c,K=T(684);!function(n){n[n.Input=0]="Input",n[n.Output=1]="Output"}(c||(c={}));class Q{constructor(n,k,T){this._ownerBlock=T,this._connectedPoint=[],this.uniqueId=(0,K.d)(),this.connectedPointIds=[],this.name=n,this._connectionType=k}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(n){if(this._connectionType===n._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||n._isSingularConnection()&&n._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(n),n._connectedPoint.push(this)}disconnectFrom(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const T=this._connectedPoint.indexOf(n),c=n._connectedPoint.indexOf(this);-1!==T&&-1!==c&&(k&&this._connectedPoint.splice(T,1),n._connectedPoint.splice(c,1))}disconnectFromAll(){for(const n of this._connectedPoint)this.disconnectFrom(n,!1);this._connectedPoint.length=0}dispose(){for(const n of this._connectedPoint)this.disconnectFrom(n)}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.uniqueId=this.uniqueId,n.name=this.name,n._connectionType=this._connectionType,n.connectedPointIds=[],n.className=this.getClassName();for(const k of this._connectedPoint)n.connectedPointIds.push(k.uniqueId)}getClassName(){return"FGConnection"}deserialize(n){this.uniqueId=n.uniqueId,this.name=n.name,this._connectionType=n._connectionType,this.connectedPointIds=n.connectedPointIds}}},12817:(n,k,T)=>{"use strict";T.d(k,{e:()=>r});var c,K=T(539),Q=T(706),G=T(712),w=T(684),E=T(12821),I=T(12841),S=T(556);!function(n){n.ExecuteBlock="ExecuteBlock",n.ExecuteEvent="ExecuteEvent",n.TriggerConnection="TriggerConnection",n.ContextVariableSet="ContextVariableSet",n.GlobalVariableSet="GlobalVariableSet",n.GlobalVariableDelete="GlobalVariableDelete",n.GlobalVariableGet="GlobalVariableGet",n.AddConnection="AddConnection",n.GetConnectionValue="GetConnectionValue",n.SetConnectionValue="SetConnectionValue",n.ActivateSignal="ActivateSignal",n.ContextVariableGet="ContextVariableGet"}(c||(c={}));class P{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(n){if(n.time||(n.time=Date.now()),this.log.push(n),this.logToConsole){var k;const T=null===(k=n.payload)||void 0===k?void 0:k.value;"object"===typeof T&&T.getClassName?S.d.Log(`[FGLog] ${n.className}:${n.uniqueId.split("-")[0]} ${n.action} - ${JSON.stringify(T.getClassName())}: ${T.toString()}`):S.d.Log(`[FGLog] ${n.className}:${n.uniqueId.split("-")[0]} ${n.action} - ${JSON.stringify(n.payload)}`)}}getItemsOfType(n){return this.log.filter((k=>k.action===n))}}class W{get enableLogging(){return this._enableLogging}set enableLogging(n){this._enableLogging!==n&&(this._enableLogging=n,this._enableLogging?(this.logger=new P,this.logger.logToConsole=!0):this.logger=null)}constructor(n){this.uniqueId=(0,w.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new K.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=n,this.assetsContext=n.assetsContext??n.me}hasVariable(n){return n in this._userVariables}setVariable(n,k){var T;this._userVariables[n]=k,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:n,value:k}})}getAsset(n,k){return(0,I.e)(this.assetsContext,n,k)}getVariable(n){var k;return null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:n,value:this._userVariables[n]}}),this._userVariables[n]}get userVariables(){return this._userVariables}va(){return this._configuration.me}_getUniqueIdPrefixedName(n,k){return`${n.uniqueId}_${k}`}_getGlobalContextVariable(n,k){var T;return null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:n,defaultValue:k,possibleValue:this._globalContextVariables[n]}}),this._hasGlobalContextVariable(n)?this._globalContextVariables[n]:k}_setGlobalContextVariable(n,k){var T;null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:n,value:k}}),this._globalContextVariables[n]=k}_deleteGlobalContextVariable(n){var k;null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:n}}),delete this._globalContextVariables[n]}_hasGlobalContextVariable(n){return n in this._globalContextVariables}_setExecutionVariable(n,k,T){this._executionVariables[this._getUniqueIdPrefixedName(n,k)]=T}_getExecutionVariable(n,k,T){return this._hasExecutionVariable(n,k)?this._executionVariables[this._getUniqueIdPrefixedName(n,k)]:T}_deleteExecutionVariable(n,k){delete this._executionVariables[this._getUniqueIdPrefixedName(n,k)]}_hasExecutionVariable(n,k){return this._getUniqueIdPrefixedName(n,k)in this._executionVariables}_hasConnectionValue(n){return n.uniqueId in this._connectionValues}_setConnectionValue(n,k){var T;this._connectionValues[n.uniqueId]=k,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:n.uniqueId,value:k}})}_setConnectionValueByKey(n,k){this._connectionValues[n]=k}_getConnectionValue(n){var k;return null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:n.uniqueId,value:this._connectionValues[n.uniqueId]}}),this._connectionValues[n.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(n){this._pendingBlocks.includes(n)||(this._pendingBlocks.push(n),this._pendingBlocks.sort(((n,k)=>n.priority-k.priority)))}_removePendingBlock(n){const k=this._pendingBlocks.indexOf(n);-1!==k&&this._pendingBlocks.splice(k,1)}_clearPendingBlocks(){for(const n of this._pendingBlocks)n._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(n){var k;this.onNodeExecutedObservable.notifyObservers(n),null===(k=this.logger)||void 0===k||k.addLogItem({time:Date.now(),className:n.getClassName(),uniqueId:n.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(n){this._setGlobalContextVariable("timeSinceStart",n.timeSinceStart),this._setGlobalContextVariable("deltaTime",n.deltaTime);for(const T of this._pendingBlocks){var k;null===(k=T._executeOnTick)||void 0===k||k.call(T,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.f;n.uniqueId=this.uniqueId,n._userVariables={};for(const c in this._userVariables)k(c,this._userVariables[c],n._userVariables);n._connectionValues={};for(const c in this._connectionValues)k(c,this._connectionValues[c],n._connectionValues);var T;this.assetsContext!==this.va()&&(n._assetsContext={meshes:this.assetsContext.meshes.map((n=>n.id)),materials:this.assetsContext.materials.map((n=>n.id)),textures:this.assetsContext.textures.map((n=>n.name)),animations:this.assetsContext.animations.map((n=>n.name)),lights:this.assetsContext.lights.map((n=>n.id)),cameras:this.assetsContext.cameras.map((n=>n.id)),dm:null===(T=this.assetsContext.dm)||void 0===T?void 0:T.map((n=>n.name)),skeletons:this.assetsContext.skeletons.map((n=>n.id)),oi:this.assetsContext.oi.map((n=>n.name)),geometries:this.assetsContext.geometries.map((n=>n.id)),multiMaterials:this.assetsContext.multiMaterials.map((n=>n.id)),transformNodes:this.assetsContext.transformNodes.map((n=>n.id))})}getClassName(){return"FlowGraphContext"}}(0,Q.e)([(0,G.K)()],W.prototype,"uniqueId",void 0);var J=T(12843),H=T(2501);class s{constructor(n){this.onEventTriggeredObservable=new K.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=n,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Gi.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const n=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:n}}),this._startingTime+=n})),this._meshPickedObserver=this._scene.onPointerObservable.add((n=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:n})}),H.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((n=>{const k=n.pointerId,T=n.mesh,c=this._pointerUnderMeshState[k];!c&&T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:k,mesh:T}}):c&&!T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:k,mesh:c}}):c&&T&&c!==T&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:k,mesh:c,over:T}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:k,mesh:T,out:c}})),this._pointerUnderMeshState[k]=T}),H.c.POINTERMOVE)}dispose(){var n,k,T,c,K;null===(n=this._sceneDisposeObserver)||void 0===n||n.remove(),null===(k=this._sceneReadyObserver)||void 0===k||k.remove(),null===(T=this._sceneOnBeforeRenderObserver)||void 0===T||T.remove(),null===(c=this._meshPickedObserver)||void 0===c||c.remove(),null===(K=this._meshUnderPointerObserver)||void 0===K||K.remove(),this.onEventTriggeredObservable.clear()}}var b,C=T(12861);!function(n){n[n.Stopped=0]="Stopped",n[n.Started=1]="Started"}(b||(b={}));class z{get state(){return this._state}set state(n){this._state=n,this.onStateChangedObservable.notifyObservers(n)}constructor(n){this.onStateChangedObservable=new K.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=n.me,this._sceneEventCoordinator=new s(this._scene),this._coordinator=n.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((n=>{for(const k of this._executionContexts){const T=this._getContextualOrder(n.type,k);for(const c of T)if(!c._executeEvent(k,n.payload))break}switch(n.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const k of this._executionContexts)k._notifyOnTick(n.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const n=new W({me:this._scene,coordinator:this._coordinator});return this._executionContexts.push(n),n}getContext(n){return this._executionContexts[n]}addEventBlock(n){if("PointerOver"!==n.type&&"PointerOut"!==n.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==n.type&&this._eventBlocks[n.type].push(n),1===this.state)for(const k of this._executionContexts)n._startPendingTasks(k);else this.onStateChangedObservable.addOnce((k=>{if(1===k)for(const T of this._executionContexts)n._startPendingTasks(T)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((n=>{1===n&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const n of this._executionContexts)for(const k in this._eventBlocks){const T=this._getContextualOrder(k,n);for(const k of T)k._startPendingTasks(n)}}_getContextualOrder(n,k){const T=this._eventBlocks[n].sort(((n,k)=>k.initPriority-n.initPriority));if("MeshPick"===n){const n=[];for(const c of T){const K=c.asset.getValue(k);let Q=0;for(;Q<T.length;Q++){const n=T[Q].asset.getValue(k);if(K&&n&&(0,C.o)(K,n))break}n.splice(Q,0,c)}return n}return T}dispose(){var n;if(0!==this.state){this.state=0;for(const n of this._executionContexts)n._clearPendingBlocks();this._executionContexts.length=0;for(const n in this._eventBlocks)this._eventBlocks[n].length=0;null===(n=this._eventObserver)||void 0===n||n.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(n){const k=[],T=new Set;for(const c in this._eventBlocks)for(const n of this._eventBlocks[c])k.push(n),T.add(n.uniqueId);for(;k.length>0;){const c=k.pop();n(c);for(const n of c.dataInputs)for(const c of n._connectedPoint)T.has(c._ownerBlock.uniqueId)||(k.push(c._ownerBlock),T.add(c._ownerBlock.uniqueId));if(c instanceof J.d)for(const n of c.signalOutputs)for(const c of n._connectedPoint)T.has(c._ownerBlock.uniqueId)||(k.push(c._ownerBlock),T.add(c._ownerBlock.uniqueId))}}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=arguments.length>1?arguments[1]:void 0;n.allBlocks=[],this.visitAllBlocks((k=>{const T={};k.serialize(T),n.allBlocks.push(T)})),n.executionContexts=[];for(const T of this._executionContexts){const c={};T.serialize(c,k),n.executionContexts.push(c)}}}class r{constructor(n){this.config=n,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.me.Gi.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.me.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const n=this._executeOnNextFrame.slice(0);if(n.length)for(const k of n){this.notifyCustomEvent(k.id,k.data,!1);const n=this._executeOnNextFrame.findIndex((n=>n.uniqueId===k.uniqueId));-1!==n&&this._executeOnNextFrame.splice(n,1)}}));(r.SceneCoordinators.get(this.config.me)??[]).push(this)}createGraph(){const n=new z({me:this.config.me,coordinator:this});return this._flowGraphs.push(n),n}removeGraph(n){const k=this._flowGraphs.indexOf(n);-1!==k&&(n.dispose(),this._flowGraphs.splice(k,1))}start(){for(const n of this._flowGraphs)n.start()}dispose(){var n,k;for(const K of this._flowGraphs)K.dispose();this._flowGraphs.length=0,null===(n=this._disposeObserver)||void 0===n||n.remove(),null===(k=this._onBeforeRenderObserver)||void 0===k||k.remove();const T=r.SceneCoordinators.get(this.config.me)??[],c=T.indexOf(this);-1!==c&&T.splice(c,1)}serialize(n,k){n._flowGraphs=[];for(const T of this._flowGraphs){const c={};T.serialize(c,k),n._flowGraphs.push(c)}n.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(n){let k=this._customEventsMap.get(n);return k||(k=new K.b,this._customEventsMap.set(n,k)),k}notifyCustomEvent(n,k){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:n,data:k,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(n)){const k=this._eventExecutionCounter.get(n);if(this._eventExecutionCounter.set(n,k+1),k>=r.MaxEventTypeExecutionPerFrame)return void(k===r.MaxEventTypeExecutionPerFrame&&S.d.Warn(`FlowGraphCoordinator: Too many executions of event "${n}".`))}else this._eventExecutionCounter.set(n,1);const T=this._customEventsMap.get(n);T&&T.notifyObservers(k)}}r.MaxEventsPerType=30,r.MaxEventTypeExecutionPerFrame=30,r.SceneCoordinators=new Map},12869:(n,k,T)=>{"use strict";T.d(k,{d:()=>K});var c=T(12871);class K extends c.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(n){n._notifyExecuteNode(this),this.done._activateSignal(n)}}},12843:(n,k,T)=>{"use strict";T.d(k,{d:()=>w});var c=T(12845),K=T(12852),Q=T(675);class G extends K.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(n){super.connectTo(n),this._connectedPoint.sort(((n,k)=>k.priority-n.priority))}_activateSignal(n){var k;if(null===(k=n.logger)||void 0===k||k.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)n._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(n,this),n._increaseExecutionId();else for(const T of this._connectedPoint)T._activateSignal(n)}}(0,Q.f)("FlowGraphSignalConnection",G);class w extends c.b{constructor(n){super(n),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(n){const k=new G(n,0,this);return this.signalInputs.push(k),k}_registerSignalOutput(n){const k=new G(n,1,this);return this.signalOutputs.push(k),k}_unregisterSignalInput(n){const k=this.signalInputs.findIndex((k=>k.name===n));-1!==k&&(this.signalInputs[k].dispose(),this.signalInputs.splice(k,1))}_unregisterSignalOutput(n){const k=this.signalOutputs.findIndex((k=>k.name===n));-1!==k&&(this.signalOutputs[k].dispose(),this.signalOutputs.splice(k,1))}_reportError(n,k){this.error.payload="string"===typeof k?new Error(k):k,this.error._activateSignal(n)}getSignalInput(n){return this.signalInputs.find((k=>k.name===n))}getSignalOutput(n){return this.signalOutputs.find((k=>k.name===n))}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(n),n.signalInputs=[],n.signalOutputs=[];for(const k of this.signalInputs){const T={};k.serialize(T),n.signalInputs.push(T)}for(const k of this.signalOutputs){const T={};k.serialize(T),n.signalOutputs.push(T)}}deserialize(n){for(let k=0;k<n.signalInputs.length;k++){const T=this.getSignalInput(n.signalInputs[k].name);if(!T)throw new Error("Could not find signal input with name "+n.signalInputs[k].name+" in block "+n.className);T.deserialize(n.signalInputs[k])}for(let k=0;k<n.signalOutputs.length;k++){const T=this.getSignalOutput(n.signalOutputs[k].name);if(!T)throw new Error("Could not find signal output with name "+n.signalOutputs[k].name+" in block "+n.className);T.deserialize(n.signalOutputs[k])}}getClassName(){return"FlowGraphExecutionBlock"}}},12875:(n,k,T)=>{"use strict";T.d(k,{c:()=>K});var c=T(12843);class K extends c.d{constructor(n){super(n),this.out=this._registerSignalOutput("out")}}},12831:(n,k,T)=>{"use strict";T.d(k,{A:()=>J,C:()=>H,F:()=>s,G:()=>v,K:()=>F,L:()=>A,O:()=>f,e:()=>I,g:()=>W,j:()=>u,m:()=>b,o:()=>C,s:()=>z,w:()=>P,x:()=>O,y:()=>S});var c,K=T(730),Q=T(764),G=T(12829),w=T(12836);!function(n){n.Any="any",n.String="string",n.Number="number",n.Boolean="boolean",n.Object="object",n.Integer="FlowGraphInteger",n.Vector2="Vector2",n.li="li",n.Vector4="Vector4",n.Quaternion="Quaternion",n.Matrix="Matrix",n.Matrix2D="Matrix2D",n.Matrix3D="Matrix3D",n.Ri="Ri",n.Si="Si"}(c||(c={}));class E{constructor(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=n,this.defaultValue=k,this.animationType=T}serialize(n){n.typeName=this.typeName,n.defaultValue=this.defaultValue}}const I=new E("any",void 0),S=new E("string",""),P=new E("number",0,0),W=new E("boolean",!1),J=new E("Vector2",K.m.Zero(),5),H=new E("li",K.o.Zero(),1),s=new E("Vector4",K.p.Zero()),b=new E("Matrix",K.d.Identity(),3),C=new E("Matrix2D",new w.e),z=new E("Matrix3D",new w.h),r=new E("Ri",Q.e.Black(),4),q=new E("Si",new Q.g(0,0,0,0),7),O=new E("Quaternion",K.h.Identity(),2);O.typeTransformer=n=>{if(n.getClassName){if("Vector4"===n.getClassName())return K.h.ji(n.wi());if("li"===n.getClassName())return K.h.FromEulerVector(n);if("Matrix"===n.getClassName())return K.h.FromRotationMatrix(n)}return n};const u=new E("FlowGraphInteger",new G.d(0),0);function f(n){const k=n;switch(typeof n){case"string":return S;case"number":return P;case"boolean":return W;case"object":if(k.getClassName)switch(k.getClassName()){case"Vector2":return J;case"li":return H;case"Vector4":return s;case"Matrix":return b;case"Ri":return r;case"Si":return q;case"Quaternion":return O;case"FlowGraphInteger":return u;case"Matrix2D":return C;case"Matrix3D":return z}return I;default:return I}}function A(n){switch(n){case"string":return S;case"number":return P;case"boolean":return W;case"Vector2":return J;case"li":return H;case"Vector4":return s;case"Matrix":return b;case"Ri":return r;case"Si":return q;case"Quaternion":return O;case"FlowGraphInteger":return u;case"Matrix2D":return C;case"Matrix3D":return z;default:return I}}function v(n){switch(n){case"number":default:return 0;case"Vector2":return 5;case"li":return 1;case"Matrix":return 3;case"Ri":return 4;case"Si":return 7;case"Quaternion":return 2}}function F(n){switch(n){case 0:return P;case 5:return J;case 1:return H;case 3:return b;case 4:return r;case 7:return q;case 2:return O;default:return I}}},12821:(n,k,T)=>{"use strict";T.d(k,{d:()=>S,f:()=>I,h:()=>P});var c=T(764),K=T(730),Q=T(12829),G=T(12831),w=T(12836);function E(n){return"Vector2"===n||"li"===n||"Vector4"===n||"Quaternion"===n||"Ri"===n||"Si"===n}function I(n,k,T){var c;const K=(null===k||void 0===k||null===(c=k.getClassName)||void 0===c?void 0:c.call(k))??"";if(E(K)||function(n){return"Matrix"===n||"Matrix2D"===n||"Matrix3D"===n}(K))T[n]={value:k.wi(),className:K};else if("FlowGraphInteger"===K)T[n]={value:k.value,className:K};else if(K&&(k.id||k.name))T[n]={id:k.id,name:k.name,className:K};else{if("object"===typeof k)throw new Error(`Could not serialize value ${k}`);T[n]=k}}function S(n,k,T,I){const P=k[n];let W;const J=(null===P||void 0===P?void 0:P.type)??(null===P||void 0===P?void 0:P.className);if(function(n){return"Mesh"===n||"AbstractMesh"===n||"GroundMesh"===n||"InstanceMesh"===n||"LinesMesh"===n||"GoldbergMesh"===n||"GreasedLineMesh"===n||"TrailMesh"===n}(J)){let n=I.meshes.filter((n=>P.id?n.id===P.id:n.name===P.name));0===n.length&&(n=I.transformNodes.filter((n=>P.id?n.id===P.id:n.name===P.name))),W=P.uniqueId?n.find((n=>n.uniqueId===P.uniqueId)):n[0]}else if(E(J))W=function(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===n)return K.m.ji(k);if("li"===n)return T&&(k[2]*=-1),K.o.ji(k);if("Vector4"===n)return K.p.ji(k);if("Quaternion"===n)return T&&(k[2]*=-1,k[3]*=-1),K.h.ji(k);if("Ri"===n)return new c.e(k[0],k[1],k[2]);if("Si"===n)return new c.g(k[0],k[1],k[2],k[3]);throw new Error(`Unknown vector class name ${n}`)}(J,P.value);else if(function(n){return"AnimationGroup"===n}(J)){const n=I.animationGroups.filter((n=>n.name===P.name));W=1===n.length?n[0]:n.find((n=>n.uniqueId===P.uniqueId))}else W="Matrix"===J?K.d.ji(P.value):"Matrix2D"===J?new w.e(P.value):"Matrix3D"===J?new w.h(P.value):"FlowGraphInteger"===J?Q.d.FromValue(P.value):"number"===J||"string"===J||"boolean"===J?P.value[0]:P&&void 0!==P.value?P.value:Array.isArray(P)?P.reduce(((n,k)=>k.eventData?(n[k.id]={type:(0,G.L)(k.type)},"undefined"!==typeof k.value&&(n[k.id].value=S("value",k,T,I)),n):n),{}):P;return W}function P(n){return"FlowGraphJsonPointerParserBlock"===n}},12861:(n,k,T)=>{"use strict";function c(n,k){return!(!n.parent||n.parent!==k&&!c(n.parent,k))}function K(n){if(n.getClassName)return n.getClassName()}function Q(n,k){return n===k&&("Vector2"===n||"li"===n||"Vector4"===n||"Quaternion"===n)}function G(n,k){return n===k&&("Matrix"===n||"Matrix2D"===n||"Matrix3D"===n)}function w(n,k){return"FlowGraphInteger"===n&&"FlowGraphInteger"===k}function E(n,k){const T="number"===typeof n||"number"===typeof(null===n||void 0===n?void 0:n.value);return T&&!k?!isNaN(I(n)):T}function I(n){return"number"===typeof n?n:n.value}T.d(k,{e:()=>w,h:()=>G,k:()=>Q,m:()=>K,o:()=>c,r:()=>I,u:()=>E})},12081:(n,k,T)=>{"use strict";T.r(k),T.d(k,{SceneInstrumentation:()=>Q});var c=T(542),K=T(2447);class Q{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(n){n!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=n,n?(this._onBeforeActiveMeshesEvaluationObserver=this.me.onBeforeActiveMeshesEvaluationObservable.add((()=>{c.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.me.onAfterActiveMeshesEvaluationObservable.add((()=>{c.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.me.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.me.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(n){n!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=n,n?(this._onBeforeRenderTargetsRenderObserver=this.me.onBeforeRenderTargetsRenderObservable.add((()=>{c.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.me.onAfterRenderTargetsRenderObservable.add((()=>{c.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.me.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.me.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(n){n!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=n,n?(this._onBeforeParticlesRenderingObserver=this.me.onBeforeParticlesRenderingObservable.add((()=>{c.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.me.onAfterParticlesRenderingObservable.add((()=>{c.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.me.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.me.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(n){n!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=n,this.me.spriteManagers&&(n?(this._onBeforeSpritesRenderingObserver=this.me.onBeforeSpritesRenderingObservable.add((()=>{c.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.me.onAfterSpritesRenderingObservable.add((()=>{c.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.me.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.me.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(n){n!==this._capturePhysicsTime&&this.me.onBeforePhysicsObservable&&(this._capturePhysicsTime=n,n?(this._onBeforePhysicsObserver=this.me.onBeforePhysicsObservable.add((()=>{c.e.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.me.onAfterPhysicsObservable.add((()=>{c.e.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.me.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.me.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(n){n!==this._captureAnimationsTime&&(this._captureAnimationsTime=n,n?this._onAfterAnimationsObserver=this.me.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.me.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(n){this._captureFrameTime=n}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(n){this._captureInterFrameTime=n}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(n){n!==this._captureRenderTime&&(this._captureRenderTime=n,n?(this._onBeforeDrawPhaseObserver=this.me.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),c.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.me.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),c.e.EndPerformanceCounter("Main render")}))):(this.me.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.me.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(n){n!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=n,n?(this._onBeforeCameraRenderObserver=this.me.onBeforeCameraRenderObservable.add((n=>{this._cameraRenderTime.beginMonitoring(),c.e.StartPerformanceCounter(`Rendering camera ${n.name}`)})),this._onAfterCameraRenderObserver=this.me.onAfterCameraRenderObservable.add((n=>{this._cameraRenderTime.endMonitoring(!1),c.e.EndPerformanceCounter(`Rendering camera ${n.name}`)}))):(this.me.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.me.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.me.getEngine()._drawCalls}constructor(n){this.me=n,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new K.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new K.d,this._captureFrameTime=!1,this._frameTime=new K.d,this._captureRenderTime=!1,this._renderTime=new K.d,this._captureInterFrameTime=!1,this._interFrameTime=new K.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new K.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new K.d,this._capturePhysicsTime=!1,this._physicsTime=new K.d,this._captureAnimationsTime=!1,this._animationsTime=new K.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new K.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=n.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(c.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.me.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=n.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(c.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Fi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Fi(),this._captureParticlesRenderTime&&this._particlesRenderTime.Fi(),this._captureSpritesRenderTime&&this._spritesRenderTime.Fi(),this._captureRenderTime&&this._renderTime.Fi(),this._captureCameraRenderTime&&this._cameraRenderTime.Fi()}))}dispose(){this._disposed||(this.me.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.me.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.me.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.me.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.me.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.me.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.me.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.me.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.me.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.me.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.me.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.me.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.me.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.me.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.me.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.me.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.me.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.me=null,this._disposed=!0)}}},12810:(n,k,T)=>{"use strict";T.d(k,{c:()=>S});var c=T(706),K=T(712),Q=T(730),G=T(752),w=T(12746),E=T(12780),I=T(675);G.c.AddNodeConstructor("Light_Type_1",((n,k)=>()=>new S(n,Q.o.Zero(),k)));class S extends E.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(n){this._shadowFrustumSize=n,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(n){this._shadowOrthoScale=n,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(n){this._orthoLeft=n}get orthoRight(){return this._orthoRight}set orthoRight(n){this._orthoRight=n}get orthoTop(){return this._orthoTop}set orthoTop(n){this._orthoTop=n}get orthoBottom(){return this._orthoBottom}set orthoBottom(n){this._orthoBottom=n}constructor(n,k,T){super(n,T),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=k.scale(-1),this.direction=k}getClassName(){return"hb"}getTypeID(){return w.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(n,k,T){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(n):this._setDefaultAutoExtendShadowProjectionMatrix(n,k,T)}_setDefaultFixedFrustumShadowProjectionMatrix(n){const k=this.va().activeCamera;k&&Q.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:k.ri,void 0!==this.shadowMaxZ?this.shadowMaxZ:k.maxZ,n,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(n,k,T){const c=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const n=Q.o.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let c=Number.MAX_VALUE,K=-Number.MAX_VALUE;for(let G=0;G<T.length;G++){const w=T[G];if(!w)continue;const E=w.getBoundingInfo().boundingBox;for(let T=0;T<E.vectorsWorld.length;T++)Q.o.TransformCoordinatesToRef(E.vectorsWorld[T],k,n),n.x<this._orthoLeft&&(this._orthoLeft=n.x),n.y<this._orthoBottom&&(this._orthoBottom=n.y),n.x>this._orthoRight&&(this._orthoRight=n.x),n.y>this._orthoTop&&(this._orthoTop=n.y),this.autoCalcShadowZBounds&&(n.z<c&&(c=n.z),n.z>K&&(K=n.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=c,this._shadowMaxZ=K)}const K=this._orthoRight-this._orthoLeft,G=this._orthoTop-this._orthoBottom,w=void 0!==this.shadowMinZ?this.shadowMinZ:(null===c||void 0===c?void 0:c.ri)||0,E=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===c||void 0===c?void 0:c.maxZ)||1e4,I=this.va().getEngine().useReverseDepthBuffer;Q.d.OrthoOffCenterLHToRef(this._orthoLeft-K*this.shadowOrthoScale,this._orthoRight+K*this.shadowOrthoScale,this._orthoBottom-G*this.shadowOrthoScale,this._orthoTop+G*this.shadowOrthoScale,I?E:w,I?w:E,n,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(n,k){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,k),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,k),this)}transferToNodeMaterialEffect(n,k){return this.computeTransformedInformation()?(n.setFloat3(k,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(n.setFloat3(k,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(n){const k=this._scene.getEngine();return!k.useReverseDepthBuffer&&k.isNDCHalfZRange?0:1}getDepthMaxZ(n){const k=this._scene.getEngine();return k.useReverseDepthBuffer&&k.isNDCHalfZRange?0:1}prepareLightSpecificDefines(n,k){n["DIRLIGHT"+k]=!0}}(0,c.e)([(0,K.K)()],S.prototype,"shadowFrustumSize",null),(0,c.e)([(0,K.K)()],S.prototype,"shadowOrthoScale",null),(0,c.e)([(0,K.K)()],S.prototype,"autoUpdateExtends",void 0),(0,c.e)([(0,K.K)()],S.prototype,"autoCalcShadowZBounds",void 0),(0,c.e)([(0,K.K)("orthoLeft")],S.prototype,"_orthoLeft",void 0),(0,c.e)([(0,K.K)("orthoRight")],S.prototype,"_orthoRight",void 0),(0,c.e)([(0,K.K)("orthoTop")],S.prototype,"_orthoTop",void 0),(0,c.e)([(0,K.K)("orthoBottom")],S.prototype,"_orthoBottom",void 0),(0,I.f)("BABYLON.DirectionalLight",S)},13088:(n,k,T)=>{"use strict";T.d(k,{b:()=>S});var c=T(706),K=T(712),Q=T(730),G=T(764),w=T(752),E=T(12746),I=T(675);w.c.AddNodeConstructor("Light_Type_3",((n,k)=>()=>new S(n,Q.o.Zero(),k)));class S extends E.c{constructor(n,k,T){super(n,T),this.groundColor=new G.e(0,0,0),this.direction=k||Q.o.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(n){return this.direction=Q.o.Normalize(n.Fg(Q.o.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(n,k){const T=Q.o.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",T.x,T.y,T.z,0,k),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Bl),k),this}transferToNodeMaterialEffect(n,k){const T=Q.o.Normalize(this.direction);return n.setFloat3(k,T.x,T.y,T.z),this}pi(){return this._worldMatrix||(this._worldMatrix=Q.d.Identity()),this._worldMatrix}getTypeID(){return E.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(n,k){n["HEMILIGHT"+k]=!0}}(0,c.e)([(0,K.h)()],S.prototype,"groundColor",void 0),(0,c.e)([(0,K.I)()],S.prototype,"direction",void 0),(0,I.f)("BABYLON.HemisphericLight",S)},12746:(n,k,T)=>{"use strict";T.d(k,{c:()=>W});var c=T(706),K=T(712),Q=T(730),G=T(764),w=T(752),E=T(900),I=T(675),S=T(921),P=T(760);class W extends w.c{get range(){return this._range}set range(n){this._range=n,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(n){this._intensityMode=n,this._computePhotometricScale()}get radius(){return this._radius}set radius(n){this._radius=n,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(n){this._shadowEnabled!==n&&(this._shadowEnabled=n,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(n){this._includedOnlyMeshes=n,this._hookArrayForIncludedOnly(n)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(n){this._excludedMeshes=n,this._hookArrayForExcluded(n)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(n){this._excludeWithLayerMask=n,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(n){this._includeOnlyWithLayerMask=n,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(n){this._lightmapMode!==n&&(this._lightmapMode=n,this._markMeshesAsLightDirty())}getViewMatrix(n){return null}getProjectionMatrix(n,k){return null}constructor(n,k){super(n,k,!1),this.$g=new G.e(1,1,1),this.aj=new G.e(1,1,1),this.falloffType=W.FALLOFF_DEFAULT,this.Bl=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=W.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new E.b(this.va().getEngine(),void 0,void 0,n),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(n,k){return this}_bindLight(n,k,T,c){let K=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Q=n.toString();let w=!1;if(this._uniformBuffer.bindToEffect(T,"Light"+Q),this._renderId!==k.getRenderId()||this._lastUseSpecular!==c||!this._uniformBuffer.useUbo){this._renderId=k.getRenderId(),this._lastUseSpecular=c;const n=this.getScaledIntensity();this.transferToEffect(T,Q),this.$g.scaleToRef(n,G.h.Ri[0]),this._uniformBuffer.updateColor4("vLightDiffuse",G.h.Ri[0],this.range,Q),c&&(this.aj.scaleToRef(n,G.h.Ri[1]),this._uniformBuffer.updateColor4("vLightSpecular",G.h.Ri[1],this.radius,Q)),w=!0}if(this.transferTexturesToEffect(T,Q),k.shadowsEnabled&&this.shadowEnabled&&K){const n=this.getShadowGenerator(k.activeCamera)??this.getShadowGenerator();n&&(n.bindShadowLight(Q,T),w=!0)}w?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(n){let k="Name: "+this.name;if(k+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let T=0;T<this.animations.length;T++)k+=", animation[0]: "+this.animations[T].toString(n);return k}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}_h(n){super._h(n),this._resyncMeshes()}getShadowGenerator(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(n)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return Q.o.Zero()}canAffectMesh(n){return!n||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(n))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(n))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&n.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&n.layerMask)))}dispose(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const n=this._shadowGenerators.values();for(let k=n.next();!0!==k.done;k=n.next()){k.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const n=this._parentContainer.lights.indexOf(this);n>-1&&this._parentContainer.lights.splice(n,1),this._parentContainer=null}for(const T of this.va().meshes)T._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(n,k)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Bl}clone(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=W.GetConstructorFromName(this.getTypeID(),n,this.va());if(!T)return null;const c=P.d.Clone(T,this);return n&&(c.name=n),k&&(c.parent=k),c._h(this.isEnabled()),this.onClonedObservable.notifyObservers(c),c}serialize(){const n=P.d.Serialize(this);if(n.uniqueId=this.uniqueId,n.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(n),this.excludedMeshes.length>0){n.excludedMeshesIds=[];for(const k of this.excludedMeshes)n.excludedMeshesIds.push(k.id)}if(this.includedOnlyMeshes.length>0){n.includedOnlyMeshesIds=[];for(const k of this.includedOnlyMeshes)n.includedOnlyMeshesIds.push(k.id)}return P.d.AppendSerializedAnimations(this,n),n.ranges=this.serializeAnimationRanges(),n.isEnabled=this.isEnabled(),n}static GetConstructorFromName(n,k,T){const c=w.c.Construct("Light_Type_"+n,k,T);return c||null}static Parse(n,k){const T=W.GetConstructorFromName(n.type,n.name,k);if(!T)return null;const c=P.d.Parse(T,n,k);if(n.excludedMeshesIds&&(c._excludedMeshesIds=n.excludedMeshesIds),n.includedOnlyMeshesIds&&(c._includedOnlyMeshesIds=n.includedOnlyMeshesIds),void 0!==n.parentId&&(c._waitingParentId=n.parentId),void 0!==n.parentInstanceIndex&&(c._waitingParentInstanceIndex=n.parentInstanceIndex),void 0!==n.falloffType&&(c.falloffType=n.falloffType),void 0!==n.lightmapMode&&(c.lightmapMode=n.lightmapMode),n.animations){for(let k=0;k<n.animations.length;k++){const T=n.animations[k],K=(0,I.b)("BABYLON.Animation");K&&c.animations.push(K.Parse(T))}w.c.ParseAnimationRanges(c,n,k)}return n.autoAnimate&&k.beginAnimation(c,n.autoAnimateFrom,n.autoAnimateTo,n.autoAnimateLoop,n.autoAnimateSpeed||1),void 0!==n.isEnabled&&c._h(n.isEnabled),c}_hookArrayForExcluded(n){var k=this;const T=n.push;n.push=function(){for(var c=arguments.length,K=new Array(c),Q=0;Q<c;Q++)K[Q]=arguments[Q];const G=T.apply(n,K);for(const n of K)n._resyncLightSource(k);return G};const c=n.splice;n.splice=(k,T)=>{const K=c.apply(n,[k,T]);for(const n of K)n._resyncLightSource(this);return K};for(const K of n)K._resyncLightSource(this)}_hookArrayForIncludedOnly(n){var k=this;const T=n.push;n.push=function(){for(var c=arguments.length,K=new Array(c),Q=0;Q<c;Q++)K[Q]=arguments[Q];const G=T.apply(n,K);return k._resyncMeshes(),G};const c=n.splice;n.splice=(k,T)=>{const K=c.apply(n,[k,T]);return this._resyncMeshes(),K},this._resyncMeshes()}_resyncMeshes(){for(const n of this.va().meshes)n._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const n of this.va().meshes)-1!==n.lightSources.indexOf(this)&&n._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let n=0;const k=this.getTypeID();let T=this.intensityMode;switch(T===W.INTENSITYMODE_AUTOMATIC&&(T=k===W.LIGHTTYPEID_DIRECTIONALLIGHT?W.INTENSITYMODE_ILLUMINANCE:W.INTENSITYMODE_LUMINOUSINTENSITY),k){case W.LIGHTTYPEID_POINTLIGHT:case W.LIGHTTYPEID_SPOTLIGHT:switch(T){case W.INTENSITYMODE_LUMINOUSPOWER:n=1/(4*Math.PI);break;case W.INTENSITYMODE_LUMINOUSINTENSITY:n=1;break;case W.INTENSITYMODE_LUMINANCE:n=this.radius*this.radius}break;case W.LIGHTTYPEID_DIRECTIONALLIGHT:switch(T){case W.INTENSITYMODE_ILLUMINANCE:n=1;break;case W.INTENSITYMODE_LUMINANCE:{let k=this.radius;k=Math.max(k,.001);n=2*Math.PI*(1-Math.cos(k));break}}break;case W.LIGHTTYPEID_HEMISPHERICLIGHT:n=1}return n}_reorderLightsInScene(){const n=this.va();0!=this._renderPriority&&(n.requireLightSorting=!0),this.va().sortLightsByPriority()}_isReady(){return!0}}W.FALLOFF_DEFAULT=S.c.FALLOFF_DEFAULT,W.FALLOFF_PHYSICAL=S.c.FALLOFF_PHYSICAL,W.FALLOFF_GLTF=S.c.FALLOFF_GLTF,W.FALLOFF_STANDARD=S.c.FALLOFF_STANDARD,W.LIGHTMAP_DEFAULT=S.c.LIGHTMAP_DEFAULT,W.LIGHTMAP_SPECULAR=S.c.LIGHTMAP_SPECULAR,W.LIGHTMAP_SHADOWSONLY=S.c.LIGHTMAP_SHADOWSONLY,W.INTENSITYMODE_AUTOMATIC=S.c.INTENSITYMODE_AUTOMATIC,W.INTENSITYMODE_LUMINOUSPOWER=S.c.INTENSITYMODE_LUMINOUSPOWER,W.INTENSITYMODE_LUMINOUSINTENSITY=S.c.INTENSITYMODE_LUMINOUSINTENSITY,W.INTENSITYMODE_ILLUMINANCE=S.c.INTENSITYMODE_ILLUMINANCE,W.INTENSITYMODE_LUMINANCE=S.c.INTENSITYMODE_LUMINANCE,W.LIGHTTYPEID_POINTLIGHT=S.c.LIGHTTYPEID_POINTLIGHT,W.LIGHTTYPEID_DIRECTIONALLIGHT=S.c.LIGHTTYPEID_DIRECTIONALLIGHT,W.LIGHTTYPEID_SPOTLIGHT=S.c.LIGHTTYPEID_SPOTLIGHT,W.LIGHTTYPEID_HEMISPHERICLIGHT=S.c.LIGHTTYPEID_HEMISPHERICLIGHT,W.LIGHTTYPEID_RECT_AREALIGHT=S.c.LIGHTTYPEID_RECT_AREALIGHT,(0,c.e)([(0,K.h)()],W.prototype,"diffuse",void 0),(0,c.e)([(0,K.h)()],W.prototype,"specular",void 0),(0,c.e)([(0,K.K)()],W.prototype,"falloffType",void 0),(0,c.e)([(0,K.K)()],W.prototype,"intensity",void 0),(0,c.e)([(0,K.K)()],W.prototype,"range",null),(0,c.e)([(0,K.K)()],W.prototype,"intensityMode",null),(0,c.e)([(0,K.K)()],W.prototype,"radius",null),(0,c.e)([(0,K.K)()],W.prototype,"_renderPriority",void 0),(0,c.e)([(0,K.d)("_reorderLightsInScene")],W.prototype,"renderPriority",void 0),(0,c.e)([(0,K.K)("shadowEnabled")],W.prototype,"_shadowEnabled",void 0),(0,c.e)([(0,K.K)("excludeWithLayerMask")],W.prototype,"_excludeWithLayerMask",void 0),(0,c.e)([(0,K.K)("includeOnlyWithLayerMask")],W.prototype,"_includeOnlyWithLayerMask",void 0),(0,c.e)([(0,K.K)("lightmapMode")],W.prototype,"_lightmapMode",void 0)},12780:(n,k,T)=>{"use strict";T.d(k,{b:()=>E});var c=T(706),K=T(712),Q=T(730),G=T(12746),w=T(909);class E extends G.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=Q.d.Identity(),this._projectionMatrix=Q.d.Identity()}_setPosition(n){this._position=n}get position(){return this._position}set position(n){this._setPosition(n)}_setDirection(n){this._direction=n}get direction(){return this._direction}set direction(n){this._setDirection(n)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(n){this._shadowMinZ=n,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(n){this._shadowMaxZ=n,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=Q.o.Zero()),Q.o.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=Q.o.Zero()),Q.o.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(n){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(n){return this.direction=Q.o.Normalize(n.Fg(this.position)),this.direction}getRotation(){this.direction.normalize();const n=Q.o.Cross(this.direction,w.d.Y),k=Q.o.Cross(n,this.direction);return Q.o.RotationFromAxis(n,k,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=Q.o.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}pi(n){return!n&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=Q.d.Identity()),Q.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(n){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===n||void 0===n?void 0:n.ri)||0}getDepthMaxZ(n){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===n||void 0===n?void 0:n.maxZ)||1e4}setShadowProjectionMatrix(n,k,T){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(k,T,n):this._setDefaultShadowProjectionMatrix(n,k,T),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(n){const k=Q.l.li[0];let T=this.position;this.computeTransformedInformation()&&(T=this.transformedPosition),Q.o.NormalizeToRef(this.getShadowDirection(n),k),1===Math.abs(Q.o.Dot(k,Q.o.Up()))&&(k.z=1e-13);const c=Q.l.li[1];return T.addToRef(k,c),Q.d.LookAtLHToRef(T,c,Q.o.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(n,k){return this.setShadowProjectionMatrix(this._projectionMatrix,n??this._viewMatrix,k??[]),this._projectionMatrix}}(0,c.e)([(0,K.I)()],E.prototype,"position",null),(0,c.e)([(0,K.I)()],E.prototype,"direction",null),(0,c.e)([(0,K.K)()],E.prototype,"shadowMinZ",null),(0,c.e)([(0,K.K)()],E.prototype,"shadowMaxZ",null)},12775:(n,k,T)=>{"use strict";T.d(k,{d:()=>P});var c=T(706),K=T(712),Q=T(730),G=T(752),w=T(12746),E=T(12780),I=T(2334),S=T(675);G.c.AddNodeConstructor("Light_Type_2",((n,k)=>()=>new P(n,Q.o.Zero(),Q.o.Zero(),0,0,k)));class P extends E.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(n){this._iesProfileTexture!==n&&(this._iesProfileTexture=n,this._iesProfileTexture&&P._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(n){this._angle=n,this._cosHalfAngle=Math.cos(.5*n),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(n){this._innerAngle=n,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(n){this._shadowAngleScale=n,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(n){this._projectionTextureLightNear=n,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(n){this._projectionTextureLightFar=n,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(n){this._projectionTextureUpDirection=n,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(n){this._projectionTexture!==n&&(this._projectionTexture=n,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(P._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):P._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(n){return void 0!==n.onGeneratedObservable}static _IsTexture(n){return void 0!==n.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(n){this._projectionTextureProjectionLightMatrix=n,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(n,k,T,c,K,G){super(n,G),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=Q.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Q.o.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Q.o.Zero(),this._projectionTextureViewLightMatrix=Q.d.Zero(),this._projectionTextureProjectionLightMatrix=Q.d.Zero(),this._projectionTextureScalingMatrix=Q.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=k,this.direction=T,this.angle=c,this.exponent=K}getClassName(){return"SpotLight"}getTypeID(){return w.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(n){super._setDirection(n),this._projectionTextureViewLightDirty=!0}_setPosition(n){super._setPosition(n),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(n,k,T){const c=this.va().activeCamera;if(!c)return;this._shadowAngleScale=this._shadowAngleScale||1;const K=this._shadowAngleScale*this._angle,G=void 0!==this.shadowMinZ?this.shadowMinZ:c.ri,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,E=this.va().getEngine().useReverseDepthBuffer;Q.d.PerspectiveFovLHToRef(K,1,E?w:G,E?G:w,n,!0,this._scene.getEngine().isNDCHalfZRange,void 0,E)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Q.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const n=this.projectionTextureLightFar,k=this.projectionTextureLightNear,T=n/(n-k),c=-T*k,K=1/Math.tan(this._angle/2);Q.d.FromValuesToRef(K/1,0,0,0,0,K,0,0,0,0,T,1,0,0,c,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof I.b){const n=this._projectionTexture.uScale/2,k=this._projectionTexture.vScale/2;Q.d.FromValuesToRef(n,0,0,0,0,k,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(n,k){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),n.setMatrix("textureProjectionMatrix"+k,this._projectionTextureMatrix),n.setTexture("projectionLightTexture"+k,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&n.setTexture("iesLightTexture"+k,this._iesProfileTexture),this}transferToEffect(n,k){let T;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,k),T=Q.o.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,k),T=Q.o.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",T.x,T.y,T.z,this._cosHalfAngle,k),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,k),this}transferToNodeMaterialEffect(n,k){let T;return T=this.computeTransformedInformation()?Q.o.Normalize(this.transformedDirection):Q.o.Normalize(this.direction),this.va().useRightHandedSystem?n.setFloat3(k,-T.x,-T.y,-T.z):n.setFloat3(k,T.x,T.y,T.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(n){const k=this._scene.getEngine(),T=void 0!==this.shadowMinZ?this.shadowMinZ:(null===n||void 0===n?void 0:n.ri)??0;return k.useReverseDepthBuffer&&k.isNDCHalfZRange?T:this._scene.getEngine().isNDCHalfZRange?0:T}getDepthMaxZ(n){const k=this._scene.getEngine(),T=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===n||void 0===n?void 0:n.maxZ)??1e4;return k.useReverseDepthBuffer&&k.isNDCHalfZRange?0:T}prepareLightSpecificDefines(n,k){n["SPOTLIGHT"+k]=!0,n["PROJECTEDLIGHTTEXTURE"+k]=!(!this.projectionTexture||!this.projectionTexture.isReady()),n["IESLIGHTTEXTURE"+k]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,c.e)([(0,K.K)()],P.prototype,"angle",null),(0,c.e)([(0,K.K)()],P.prototype,"innerAngle",null),(0,c.e)([(0,K.K)()],P.prototype,"shadowAngleScale",null),(0,c.e)([(0,K.K)()],P.prototype,"exponent",void 0),(0,c.e)([(0,K.K)()],P.prototype,"projectionTextureLightNear",null),(0,c.e)([(0,K.K)()],P.prototype,"projectionTextureLightFar",null),(0,c.e)([(0,K.K)()],P.prototype,"projectionTextureUpDirection",null),(0,c.e)([(0,K.D)("projectedLightTexture")],P.prototype,"_projectionTexture",void 0),(0,S.f)("BABYLON.SpotLight",P)},12442:(n,k,T)=>{"use strict";T.d(k,{c:()=>G,f:()=>Q,j:()=>w});const c={},K={};function Q(n,k){c[n]=k}function G(n,k){K[n]=k}function w(n){return K[n]?K[n]:null}},12317:(n,k,T)=>{"use strict";T.d(k,{e:()=>f,g:()=>e});var c,K=T(542),Q=T(539),G=T(2475),w=T(588),E=T(556),I=T(864),S=T(591),P=T(594),W=T(684),J=T(615),H=T(582);!function(n){n[n.Clean=0]="Clean",n[n.Stop=1]="Stop",n[n.Sync=2]="Sync",n[n.NoSync=3]="NoSync"}(c||(c={}));const s=new Q.b,b={};let C=!1;function z(){return b[".babylon"]}function r(n,k){const T=b[n];return T||(E.d.Warn("Unable to find a plugin to load "+n+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),k?z():void 0)}function q(n,k,T){let c="Unable to load from "+(n.rawData?"binary data":n.url);return k?c+=`: ${k}`:T&&(c+=`: ${T}`),c}async function O(n,k,T,c,K,Q,G,w,E){var I;const P="data:"===(W=n.url).substring(0,5)?W.substring(5):null;var W;if(n.rawData&&!G)throw"When using ArrayBufferView to load data the file extension must be provided.";const C=P||G?"":function(n){const k=n.indexOf("?");-1!==k&&(n=n.substring(0,k));const T=n.lastIndexOf(".");return n.substring(T,n.length).toLowerCase()}(n.url);let q=G?r(G,!0):P?function(n){for(const k in b){const T=b[k].plugin;if(T.canDirectLoad&&T.canDirectLoad(n))return b[k]}return z()}(n.url):r(C,!1);if(!q&&C){if(n.url&&!n.url.startsWith("blob:")){const k=await async function(n,k){const T=k.method||"GET";return await new Promise(((c,K)=>{const Q=new H.b;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const n={};if(k.responseHeaders)for(const T of k.responseHeaders)n[T]=Q.getResponseHeader(T)||"";c({response:Q.response,headerValues:n})}else K(`Unable to fetch data from ${n}. Error code: ${Q.status}`)})),Q.open(T,n),Q.send()}))}(n.url,{method:"HEAD",responseHeaders:["Content-Type"]}),T=k.headerValues?k.headerValues["Content-Type"]:"";T&&(q=function(n){for(const k in b){const T=b[k];if(T.mimeType===n)return T}}(T))}q||(q=z())}if(!q)throw new Error(`No plugin or fallback for ${G??n.url}`);if(!1===(null===E||void 0===E||null===(I=E[q.plugin.name])||void 0===I?void 0:I.enabled))throw new Error(`The '${q.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(n.rawData&&!q.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(n=>{if(q.plugin.createPlugin){const k=q.plugin.createPlugin(E??{});return k instanceof Promise?(k.then(n).catch((n=>{K("Error instantiating plugin.",n)})),null):(n(k),k)}return n(q.plugin),q.plugin})((E=>{var I;if(!E)throw`The loader plugin corresponding to the '${G}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(s.notifyObservers(E),P&&(E.canDirectLoad&&E.canDirectLoad(n.url)||!(0,S.i)(n.url))){if(E.directLoad){const n=E.directLoad(k,P);n instanceof Promise?n.then((n=>{T(E,n)})).catch((n=>{K("Error in directLoad of _loadData: "+n,n)})):T(E,n)}else T(E,P);return}const W=q.isBinary,H=(n,c)=>{k.u?K("Scene has been disposed"):T(E,n,c)};let b=null,C=!1;null===(I=E.Gi)||void 0===I||I.add((()=>{C=!0,b&&(b.abort(),b=null),Q()}));const z=()=>{if(C)return;const T=(n,k)=>{K(null===n||void 0===n?void 0:n.statusText,k)};if(!E.loadFile&&n.rawData)throw"Plugin does not support loading ArrayBufferView.";b=E.loadFile?E.loadFile(k,n.rawData||n.file||n.url,n.rootUrl,H,c,W,T,w):k._loadFile(n.file||n.url,H,c,!0,W,T)},r=k.getEngine();let O=r.enableOfflineSupport;if(O){let T=!1;for(const c of k.disableOfflineSupportExceptionRules)if(c.test(n.url)){T=!0;break}O=!T}O&&J.b.OfflineProviderFactory?k.offlineProvider=J.b.OfflineProviderFactory(n.url,z,r.disableManifestCheck):z()}))}function u(n,k){let T,c,Q=null,G=null;if(k)if(k.name)T=`file:${k.name}`,c=k.name,Q=k;else if(ArrayBuffer.isView(k))T="",c=(0,W.d)(),G=k;else if(k.startsWith("data:"))T=k,c="";else if(n){const Q=k;if("/"===Q.substring(0,1))return K.e.Error("Wrong sceneFilename parameter"),null;T=n+Q,c=Q}else T=k,c=K.e.GetFilename(k),n=K.e.GetFolderPath(k);else T=n,c=K.e.GetFilename(n),n=K.e.GetFolderPath(n);return{url:T,rootUrl:n,name:c,file:Q,rawData:G}}function f(n){if("string"===typeof n.extensions){const k=n.extensions;b[k.toLowerCase()]={plugin:n,isBinary:!1}}else{const k=n.extensions,T=Object.keys(k);for(const c of T)b[c.toLowerCase()]={plugin:n,isBinary:k[c].isBinary,mimeType:k[c].mimeType}}}async function A(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.e.LastCreatedScene,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!c)return E.d.Error("No scene available to import mesh to"),null;const J=u(k,T);if(!J)return null;const H={};c.addPendingData(H);const s=()=>{c.removePendingData(H)},b=(n,k)=>{const T=q(J,n,k);G?G(c,T,new P.i(T,P.g.SceneLoaderError,k)):E.d.Error(T),s()},C=Q?n=>{try{Q(n)}catch(k){b("Error in onProgress callback: "+k,k)}}:void 0,z=(n,k,T,Q,G,w,E,I)=>{if(c.importedMeshesFiles.push(J.url),K)try{K(n,k,T,Q,G,w,E,I)}catch(S){b("Error in onSuccess callback: "+S,S)}c.removePendingData(H)};return await O(J,c,((k,T,K)=>{if(k.rewriteRootURL&&(J.rootUrl=k.rewriteRootURL(J.rootUrl,K)),k.importMesh){const K=[],Q=[],G=[];if(!k.importMesh(n,c,T,J.rootUrl,K,Q,G,b))return;c.loadingPluginName=k.name,z(K,Q,G,[],[],[],[],[])}else{k.importMeshAsync(n,c,T,J.rootUrl,C,J.name).then((n=>{c.loadingPluginName=k.name,z(n.meshes,n.oi,n.skeletons,n.animationGroups,n.transformNodes,n.geometries,n.lights,n.spriteManagers)})).catch((n=>{b(n.message,n)}))}}),C,b,s,I,S,W)}async function v(n,k,T,c,K,Q,G,w){return await new Promise(((E,I)=>{try{A(n,k,T,c,((n,k,T,c,K,Q,G,w)=>{E({meshes:n,oi:k,skeletons:T,animationGroups:c,transformNodes:K,geometries:Q,lights:G,spriteManagers:w})}),K,((n,k,T)=>{I(T||new Error(k))}),Q,G,w).catch(I)}catch(P){I(P)}}))}async function F(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedEngine,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};T?await x(n,k,new G.c(T),c,Q,E,I,S,P):K.e.Error("No engine available")}async function m(n,k,T,c,K,Q,G){return await new Promise(((w,E)=>{F(n,k,T,(n=>{w(n)}),c,((n,k,T)=>{E(T||new Error(k))}),K,Q,G)}))}async function x(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return E.d.Error("No scene available to append to"),null;const J=u(n,k);if(!J)return null;const H={};T.addPendingData(H);const s=()=>{T.removePendingData(H)};I.e.ShowLoadingScreen&&!C&&(C=!0,T.getEngine().displayLoadingUI(),T.executeWhenReady((()=>{T.getEngine().hideLoadingUI(),C=!1})));const b=(n,k)=>{const c=q(J,n,k);Q?Q(T,c,new P.i(c,P.g.SceneLoaderError,k)):E.d.Error(c),s()},z=K?n=>{try{K(n)}catch(k){b("Error in onProgress callback",k)}}:void 0,r=()=>{if(c)try{c(T)}catch(n){b("Error in onSuccess callback",n)}T.removePendingData(H)};return await O(J,T,((n,k)=>{if(n.load){if(!n.load(T,k,J.rootUrl,b))return;T.loadingPluginName=n.name,r()}else{n.loadAsync(T,k,J.rootUrl,z,J.name).then((()=>{T.loadingPluginName=n.name,r()})).catch((n=>{b(n.message,n)}))}}),z,b,s,G,S,W)}async function g(n,k,T,c,K,Q,G){return await new Promise(((w,E)=>{try{x(n,k,T,(n=>{w(n)}),c,((n,k,T)=>{E(T||new Error(k))}),K,Q,G).catch(E)}catch(P){E(P)}}))}async function U(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return E.d.Error("No scene available to load asset container to"),null;const W=u(n,k);if(!W)return null;const J={};T.addPendingData(J);const H=()=>{T.removePendingData(J)},s=(n,k)=>{const c=q(W,n,k);Q?Q(T,c,new P.i(c,P.g.SceneLoaderError,k)):E.d.Error(c),H()},b=K?n=>{try{K(n)}catch(k){s("Error in onProgress callback",k)}}:void 0,C=n=>{if(c)try{c(n)}catch(k){s("Error in onSuccess callback",k)}T.removePendingData(J)};return await O(W,T,((n,k)=>{if(n.loadAssetContainer){const c=n.loadAssetContainer(T,k,W.rootUrl,s);if(!c)return;c.populateRootNodes(),T.loadingPluginName=n.name,C(c)}else if(n.loadAssetContainerAsync){n.loadAssetContainerAsync(T,k,W.rootUrl,b,W.name).then((k=>{k.populateRootNodes(),T.loadingPluginName=n.name,C(k)})).catch((n=>{s(n.message,n)}))}else s("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),b,s,H,G,I,S)}async function V(n,k,T,c,K,Q,G){return await new Promise(((w,E)=>{try{U(n,k,T,(n=>{w(n)}),c,((n,k,T)=>{E(T||new Error(k))}),K,Q,G).catch(E)}catch(P){E(P)}}))}async function Y(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.e.LastCreatedScene,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!T)return void E.d.Error("No scene available to load animations to");if(c){for(const c of T.animatables)c.reset();T.stopAllAnimations();const n=T.animationGroups.slice();for(const T of n)T.dispose();const k=T.getNodes();for(const T of k)T.animations&&(T.animations=[])}else switch(K){case 0:const n=T.animationGroups.slice();for(const k of n)k.dispose();break;case 1:for(const k of T.animationGroups)k.stop();break;case 2:for(const k of T.animationGroups)k.reset(),k.restart();break;case 3:break;default:return void E.d.Error("Unknown animation group loading mode value '"+K+"'")}const H=T.animatables.length;await U(n,k,T,(n=>{n.mergeAnimationsTo(T,T.animatables.slice(H),Q),n.dispose(),T.onAnimationFileImportedObservable.notifyObservers(T),G&&G(T)}),I,S,P,W,J)}async function Z(n,k,T,c,K,Q,G,w,E,I){return await new Promise(((S,W)=>{try{Y(n,k,T,c,K,Q,(n=>{S(n)}),G,((n,k,T)=>{W(T||new Error(k))}),w,E,I).catch(W)}catch(P){W(P)}}))}class e{static get ForceFullSceneLoadingForIncremental(){return I.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(n){I.e.ForceFullSceneLoadingForIncremental=n}static get ShowLoadingScreen(){return I.e.ShowLoadingScreen}static set ShowLoadingScreen(n){I.e.ShowLoadingScreen=n}static get loggingLevel(){return I.e.loggingLevel}static set loggingLevel(n){I.e.loggingLevel=n}static get CleanBoneMatrixWeights(){return I.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(n){I.e.CleanBoneMatrixWeights=n}static GetDefaultPlugin(){return z()}static GetPluginForExtension(n){var k;return null===(k=r(n,!0))||void 0===k?void 0:k.plugin}static IsPluginForExtensionAvailable(n){return function(n){return!!b[n]}(n)}static RegisterPlugin(n){f(n)}static ImportMesh(n,k,T,c,K,Q,G,E,I){A(n,k,T,c,K,Q,G,E,I).catch((n=>null===G||void 0===G?void 0:G(w.e.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async ImportMeshAsync(n,k,T,c,K,Q,G){return await v(n,k,T,c,K,Q,G)}static Load(n,k,T,c,K,Q,G,E){F(n,k,T,c,K,Q,G,E).catch((n=>null===Q||void 0===Q?void 0:Q(w.e.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async LoadAsync(n,k,T,c,K,Q){return await m(n,k,T,c,K,Q)}static Append(n,k,T,c,K,Q,G,E){x(n,k,T,c,K,Q,G,E).catch((n=>null===Q||void 0===Q?void 0:Q(T??w.e.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async AppendAsync(n,k,T,c,K,Q){return await g(n,k,T,c,K,Q)}static LoadAssetContainer(n,k,T,c,K,Q,G,E){U(n,k,T,c,K,Q,G,E).catch((n=>null===Q||void 0===Q?void 0:Q(T??w.e.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async LoadAssetContainerAsync(n,k,T,c,K,Q){return await V(n,k,T,c,K,Q)}static ImportAnimations(n,k,T,c,K,Q,G,E,I,S,P){Y(n,k,T,c,K,Q,G,E,I,S,P).catch((n=>null===I||void 0===I?void 0:I(T??w.e.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async ImportAnimationsAsync(n,k,T,c,K,Q,G,w,E,I,S){return await Z(n,k,T,c,K,Q,w,I,S)}}e.NO_LOGGING=0,e.MINIMAL_LOGGING=1,e.SUMMARY_LOGGING=2,e.DETAILED_LOGGING=3,e.OnPluginActivatedObservable=s},12729:(n,k,T)=>{"use strict";T.d(k,{b:()=>t});var c=T(706),K=T(712),Q=T(556),G=T(727),w=T(12721),E=T(2475),I=T(730),S=T(781),P=T(12237),W=T(12262);class J extends P.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class H extends W.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(n,"PBRBRDF",90,new J,k),this._useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=H.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=H.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=H.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=H.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=H.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=H.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=H.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=H.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=H.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=H.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=n._dirtyCallbacks[16],this._enable(!0)}prepareDefines(n){n.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,n.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,n.SPHERICAL_HARMONICS=this._useSphericalHarmonics,n.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,n.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,n.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,n.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,n.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,n.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}H.DEFAULT_USE_ENERGY_CONSERVATION=!0,H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,H.DEFAULT_USE_SPHERICAL_HARMONICS=!0,H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,H.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,H.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,H.DEFAULT_DIFFUSE_MODEL=0,H.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,H.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useEnergyConservation",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSphericalHarmonics",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"mixIblRadianceWithIrradiance",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useLegacySpecularEnergyConservation",void 0),(0,c.e)([(0,K.K)("baseDiffuseModel"),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"baseDiffuseModel",void 0),(0,c.e)([(0,K.K)("dielectricSpecularModel"),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"dielectricSpecularModel",void 0),(0,c.e)([(0,K.K)("conductorSpecularModel"),(0,K.d)("_markAllSubMeshesAsMiscDirty")],H.prototype,"conductorSpecularModel",void 0);var s=T(12230),b=T(764),C=T(2483),z=T(915),r=T(12239),q=T(2334),O=T(12242),u=(T(2546),T(12251)),f=T(919);class A extends P.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class v extends W.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(n,"PBRClearCoat",100,new A,k),this._isEnabled=!1,this.isEnabled=!1,this.Bl=1,this.roughness=0,this._indexOfRefraction=v._DefaultIndexOfRefraction,this.indexOfRefraction=v._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=b.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=n._dirtyCallbacks[1]}isReadyForSubMesh(n,k,T){if(!this._isEnabled)return!0;const c=this._material._disableBumpMap;if(n._areTexturesDirty&&k.texturesEnabled){if(this._texture&&O.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&O.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(T.getCaps().standardDerivatives&&this._bumpTexture&&O.e.ClearCoatBumpTextureEnabled&&!c&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&O.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(n,k){this._isEnabled?(n.CLEARCOAT=!0,n.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,n.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,n._areTexturesDirty&&k.texturesEnabled&&(this._texture&&O.e.ClearCoatTextureEnabled?(0,f.J)(this._texture,n,"CLEARCOAT_TEXTURE"):n.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&O.e.ClearCoatTextureEnabled?(0,f.J)(this._textureRoughness,n,"CLEARCOAT_TEXTURE_ROUGHNESS"):n.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&O.e.ClearCoatBumpTextureEnabled?(0,f.J)(this._bumpTexture,n,"CLEARCOAT_BUMP"):n.CLEARCOAT_BUMP=!1,n.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===v._DefaultIndexOfRefraction,this._isTintEnabled?(n.CLEARCOAT_TINT=!0,this._tintTexture&&O.e.ClearCoatTintTextureEnabled?((0,f.J)(this._tintTexture,n,"CLEARCOAT_TINT_TEXTURE"),n.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):n.CLEARCOAT_TINT_TEXTURE=!1):(n.CLEARCOAT_TINT=!1,n.CLEARCOAT_TINT_TEXTURE=!1))):(n.CLEARCOAT=!1,n.CLEARCOAT_TEXTURE=!1,n.CLEARCOAT_TEXTURE_ROUGHNESS=!1,n.CLEARCOAT_BUMP=!1,n.CLEARCOAT_TINT=!1,n.CLEARCOAT_TINT_TEXTURE=!1,n.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,n.CLEARCOAT_DEFAULTIOR=!1,n.CLEARCOAT_TEXTUREDIRECTUV=0,n.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,n.CLEARCOAT_BUMPDIRECTUV=0,n.CLEARCOAT_REMAP_F0=!1,n.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,n.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(n,k,T,c){if(!this._isEnabled)return;const K=c.materialDefines,Q=this._material.isFrozen,G=this._material._disableBumpMap,w=this._material._invertNormalMapX,E=this._material._invertNormalMapY;if(!n.useUbo||!Q||!n.isSync){var I,S,P,W;if((this._texture||this._textureRoughness)&&O.e.ClearCoatTextureEnabled)n.updateFloat4("vClearCoatInfos",(null===(I=this._texture)||void 0===I?void 0:I.coordinatesIndex)??0,(null===(S=this._texture)||void 0===S?void 0:S.level)??0,(null===(P=this._textureRoughness)||void 0===P?void 0:P.coordinatesIndex)??0,(null===(W=this._textureRoughness)||void 0===W?void 0:W.level)??0),this._texture&&(0,f.m)(this._texture,n,"clearCoat"),this._textureRoughness&&!K.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,f.m)(this._textureRoughness,n,"clearCoatRoughness");this._bumpTexture&&T.getCaps().standardDerivatives&&O.e.ClearCoatTextureEnabled&&!G&&(n.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,f.m)(this._bumpTexture,n,"clearCoatBump"),k._mirroredCameraPosition?n.updateFloat2("vClearCoatTangentSpaceParams",w?1:-1,E?1:-1):n.updateFloat2("vClearCoatTangentSpaceParams",w?-1:1,E?-1:1)),this._tintTexture&&O.e.ClearCoatTintTextureEnabled&&(n.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,f.m)(this._tintTexture,n,"clearCoatTint")),n.updateFloat2("vClearCoatParams",this.Bl,this.roughness);const c=1-this._indexOfRefraction,Q=1+this._indexOfRefraction,J=Math.pow(-c/Q,2),H=1/this._indexOfRefraction;n.updateFloat4("vClearCoatRefractionParams",J,H,c,Q),this._isTintEnabled&&(n.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),n.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}k.texturesEnabled&&(this._texture&&O.e.ClearCoatTextureEnabled&&n.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!K.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&O.e.ClearCoatTextureEnabled&&n.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&T.getCaps().standardDerivatives&&O.e.ClearCoatBumpTextureEnabled&&!G&&n.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&O.e.ClearCoatTintTextureEnabled&&n.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(n){return this._texture===n||(this._textureRoughness===n||(this._bumpTexture===n||this._tintTexture===n))}getActiveTextures(n){this._texture&&n.push(this._texture),this._textureRoughness&&n.push(this._textureRoughness),this._bumpTexture&&n.push(this._bumpTexture),this._tintTexture&&n.push(this._tintTexture)}getAnimatables(n){this._texture&&this._texture.animations&&this._texture.animations.length>0&&n.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&n.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&n.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&n.push(this._tintTexture)}dispose(n){var k,T,c,K;n&&(null===(k=this._texture)||void 0===k||k.dispose(),null===(T=this._textureRoughness)||void 0===T||T.dispose(),null===(c=this._bumpTexture)||void 0===c||c.dispose(),null===(K=this._tintTexture)||void 0===K||K.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(n,k,T){return n.CLEARCOAT_BUMP&&k.addFallback(T++,"CLEARCOAT_BUMP"),n.CLEARCOAT_TINT&&k.addFallback(T++,"CLEARCOAT_TINT"),n.CLEARCOAT&&k.addFallback(T++,"CLEARCOAT"),T}getSamplers(n){n.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}v._DefaultIndexOfRefraction=1.5,(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0),(0,c.e)([(0,K.K)()],v.prototype,"intensity",void 0),(0,c.e)([(0,K.K)()],v.prototype,"roughness",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"indexOfRefraction",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"remapF0OnInterfaceChange",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isTintEnabled",void 0),(0,c.e)([(0,K.h)()],v.prototype,"tintColor",void 0),(0,c.e)([(0,K.K)()],v.prototype,"tintColorAtDistance",void 0),(0,c.e)([(0,K.K)()],v.prototype,"tintThickness",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"tintTexture",void 0);class F extends P.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class m extends W.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(n,"PBRIridescence",110,new F,k),this._isEnabled=!1,this.isEnabled=!1,this.Bl=1,this.minimumThickness=m._DefaultMinimumThickness,this.maximumThickness=m._DefaultMaximumThickness,this.indexOfRefraction=m._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=n._dirtyCallbacks[1]}isReadyForSubMesh(n,k){if(!this._isEnabled)return!0;if(n._areTexturesDirty&&k.texturesEnabled){if(this._texture&&O.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&O.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(n,k){this._isEnabled?(n.IRIDESCENCE=!0,n._areTexturesDirty&&k.texturesEnabled&&(this._texture&&O.e.IridescenceTextureEnabled?(0,f.J)(this._texture,n,"IRIDESCENCE_TEXTURE"):n.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&O.e.IridescenceTextureEnabled?(0,f.J)(this._thicknessTexture,n,"IRIDESCENCE_THICKNESS_TEXTURE"):n.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(n.IRIDESCENCE=!1,n.IRIDESCENCE_TEXTURE=!1,n.IRIDESCENCE_THICKNESS_TEXTURE=!1,n.IRIDESCENCE_TEXTUREDIRECTUV=0,n.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(n,k){if(!this._isEnabled)return;const T=this._material.isFrozen;if(!n.useUbo||!T||!n.isSync){var c,K,Q,G;if((this._texture||this._thicknessTexture)&&O.e.IridescenceTextureEnabled)n.updateFloat4("vIridescenceInfos",(null===(c=this._texture)||void 0===c?void 0:c.coordinatesIndex)??0,(null===(K=this._texture)||void 0===K?void 0:K.level)??0,(null===(Q=this._thicknessTexture)||void 0===Q?void 0:Q.coordinatesIndex)??0,(null===(G=this._thicknessTexture)||void 0===G?void 0:G.level)??0),this._texture&&(0,f.m)(this._texture,n,"iridescence"),this._thicknessTexture&&(0,f.m)(this._thicknessTexture,n,"iridescenceThickness");n.updateFloat4("vIridescenceParams",this.Bl,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}k.texturesEnabled&&(this._texture&&O.e.IridescenceTextureEnabled&&n.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&O.e.IridescenceTextureEnabled&&n.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(n){return this._texture===n||this._thicknessTexture===n}getActiveTextures(n){this._texture&&n.push(this._texture),this._thicknessTexture&&n.push(this._thicknessTexture)}getAnimatables(n){this._texture&&this._texture.animations&&this._texture.animations.length>0&&n.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&n.push(this._thicknessTexture)}dispose(n){var k,T;n&&(null===(k=this._texture)||void 0===k||k.dispose(),null===(T=this._thicknessTexture)||void 0===T||T.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(n,k,T){return n.IRIDESCENCE&&k.addFallback(T++,"IRIDESCENCE"),T}getSamplers(n){n.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}m._DefaultMinimumThickness=100,m._DefaultMaximumThickness=400,m._DefaultIndexOfRefraction=1.3,(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"isEnabled",void 0),(0,c.e)([(0,K.K)()],m.prototype,"intensity",void 0),(0,c.e)([(0,K.K)()],m.prototype,"minimumThickness",void 0),(0,c.e)([(0,K.K)()],m.prototype,"maximumThickness",void 0),(0,c.e)([(0,K.K)()],m.prototype,"indexOfRefraction",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"texture",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],m.prototype,"thicknessTexture",void 0);class x extends P.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class g extends W.d{set angle(n){this.direction.x=Math.cos(n),this.direction.y=Math.sin(n)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(n,"PBRAnisotropic",110,new x,k),this._isEnabled=!1,this.isEnabled=!1,this.Bl=1,this.direction=new I.m(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=n._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=n._dirtyCallbacks[16]}isReadyForSubMesh(n,k){return!this._isEnabled||!(n._areTexturesDirty&&k.texturesEnabled&&this._texture&&O.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(n,k,T){this._isEnabled?(n.ANISOTROPIC=this._isEnabled,this._isEnabled&&!T.isVerticesDataPresent(S.f.TangentKind)&&(n._needUVs=!0,n.MAINUV1=!0),n._areTexturesDirty&&k.texturesEnabled&&(this._texture&&O.e.AnisotropicTextureEnabled?(0,f.J)(this._texture,n,"ANISOTROPIC_TEXTURE"):n.ANISOTROPIC_TEXTURE=!1),n._areMiscDirty&&(n.ANISOTROPIC_LEGACY=this._legacy)):(n.ANISOTROPIC=!1,n.ANISOTROPIC_TEXTURE=!1,n.ANISOTROPIC_TEXTUREDIRECTUV=0,n.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(n,k){if(!this._isEnabled)return;const T=this._material.isFrozen;n.useUbo&&T&&n.isSync||(this._texture&&O.e.AnisotropicTextureEnabled&&(n.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,f.m)(this._texture,n,"anisotropy")),n.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Bl)),k.texturesEnabled&&this._texture&&O.e.AnisotropicTextureEnabled&&n.setTexture("anisotropySampler",this._texture)}hasTexture(n){return this._texture===n}getActiveTextures(n){this._texture&&n.push(this._texture)}getAnimatables(n){this._texture&&this._texture.animations&&this._texture.animations.length>0&&n.push(this._texture)}dispose(n){n&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(n,k,T){return n.ANISOTROPIC&&k.addFallback(T++,"ANISOTROPIC"),T}getSamplers(n){n.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(n,k,T){super.parse(n,k,T),void 0===n.legacy&&(this.legacy=!0)}}(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0),(0,c.e)([(0,K.K)()],g.prototype,"intensity",void 0),(0,c.e)([(0,K.E)()],g.prototype,"direction",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsMiscDirty")],g.prototype,"legacy",void 0);class U extends P.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class V extends W.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(n,"Sheen",120,new U,k),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Bl=1,this.color=b.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=n._dirtyCallbacks[1]}isReadyForSubMesh(n,k){if(!this._isEnabled)return!0;if(n._areTexturesDirty&&k.texturesEnabled){if(this._texture&&O.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&O.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(n,k){this._isEnabled?(n.SHEEN=!0,n.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,n.SHEEN_ROUGHNESS=null!==this._roughness,n.SHEEN_ALBEDOSCALING=this._albedoScaling,n.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,n._areTexturesDirty&&k.texturesEnabled&&(this._texture&&O.e.SheenTextureEnabled?((0,f.J)(this._texture,n,"SHEEN_TEXTURE"),n.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):n.SHEEN_TEXTURE=!1,this._textureRoughness&&O.e.SheenTextureEnabled?(0,f.J)(this._textureRoughness,n,"SHEEN_TEXTURE_ROUGHNESS"):n.SHEEN_TEXTURE_ROUGHNESS=!1)):(n.SHEEN=!1,n.SHEEN_TEXTURE=!1,n.SHEEN_TEXTURE_ROUGHNESS=!1,n.SHEEN_LINKWITHALBEDO=!1,n.SHEEN_ROUGHNESS=!1,n.SHEEN_ALBEDOSCALING=!1,n.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,n.SHEEN_GAMMATEXTURE=!1,n.SHEEN_TEXTUREDIRECTUV=0,n.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(n,k,T,c){if(!this._isEnabled)return;const K=c.materialDefines,Q=this._material.isFrozen;if(!n.useUbo||!Q||!n.isSync){var G,w,E,I;if((this._texture||this._textureRoughness)&&O.e.SheenTextureEnabled)n.updateFloat4("vSheenInfos",(null===(G=this._texture)||void 0===G?void 0:G.coordinatesIndex)??0,(null===(w=this._texture)||void 0===w?void 0:w.level)??0,(null===(E=this._textureRoughness)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(I=this._textureRoughness)||void 0===I?void 0:I.level)??0),this._texture&&(0,f.m)(this._texture,n,"sheen"),this._textureRoughness&&!K.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,f.m)(this._textureRoughness,n,"sheenRoughness");n.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Bl),null!==this._roughness&&n.updateFloat("vSheenRoughness",this._roughness)}k.texturesEnabled&&(this._texture&&O.e.SheenTextureEnabled&&n.setTexture("sheenSampler",this._texture),this._textureRoughness&&!K.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&O.e.SheenTextureEnabled&&n.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(n){return this._texture===n||this._textureRoughness===n}getActiveTextures(n){this._texture&&n.push(this._texture),this._textureRoughness&&n.push(this._textureRoughness)}getAnimatables(n){this._texture&&this._texture.animations&&this._texture.animations.length>0&&n.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&n.push(this._textureRoughness)}dispose(n){var k,T;n&&(null===(k=this._texture)||void 0===k||k.dispose(),null===(T=this._textureRoughness)||void 0===T||T.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(n,k,T){return n.SHEEN&&k.addFallback(T++,"SHEEN"),T}getSamplers(n){n.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"linkSheenWithAlbedo",void 0),(0,c.e)([(0,K.K)()],V.prototype,"intensity",void 0),(0,c.e)([(0,K.h)()],V.prototype,"color",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMainTexture",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"roughness",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"textureRoughness",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"albedoScaling",void 0);class Y extends P.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class Z extends W.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(n){this._scene.enableSubSurfaceForPrePass()&&n&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(n))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(n){this._volumeIndexOfRefraction=n>=1?n:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(n,"PBRSubSurface",130,new Y,k),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=b.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=b.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=Z.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=Z.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=n.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=n._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=n._dirtyCallbacks[32]}isReadyForSubMesh(n,k){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(n._areTexturesDirty&&k.texturesEnabled){if(this._thicknessTexture&&O.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&O.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&O.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const n=this._getRefractionTexture(k);if(n&&O.e.RefractionTextureEnabled&&!n.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(n,k){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return n.SUBSURFACE=!1,n.SS_DISPERSION=!1,n.SS_TRANSLUCENCY=!1,n.SS_SCATTERING=!1,n.SS_REFRACTION=!1,n.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,n.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,n.SS_THICKNESSANDMASK_TEXTURE=!1,n.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,n.SS_HAS_THICKNESS=!1,n.SS_REFRACTIONINTENSITY_TEXTURE=!1,n.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,n.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,n.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,n.SS_REFRACTIONMAP_3D=!1,n.SS_REFRACTIONMAP_OPPOSITEZ=!1,n.SS_LODINREFRACTIONALPHA=!1,n.SS_GAMMAREFRACTION=!1,n.SS_RGBDREFRACTION=!1,n.SS_LINEARSPECULARREFRACTION=!1,n.SS_LINKREFRACTIONTOTRANSPARENCY=!1,n.SS_ALBEDOFORREFRACTIONTINT=!1,n.SS_ALBEDOFORTRANSLUCENCYTINT=!1,n.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,n.SS_USE_THICKNESS_AS_DEPTH=!1,n.SS_USE_GLTF_TEXTURES=!1,n.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,n.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,n.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(n.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(n._areTexturesDirty){if(n.SUBSURFACE=!0,n.SS_DISPERSION=this._isDispersionEnabled,n.SS_TRANSLUCENCY=this._isTranslucencyEnabled,n.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,n.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,n.SS_SCATTERING=this._isScatteringEnabled,n.SS_THICKNESSANDMASK_TEXTURE=!1,n.SS_REFRACTIONINTENSITY_TEXTURE=!1,n.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,n.SS_HAS_THICKNESS=!1,n.SS_USE_GLTF_TEXTURES=!1,n.SS_REFRACTION=!1,n.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,n.SS_REFRACTIONMAP_3D=!1,n.SS_GAMMAREFRACTION=!1,n.SS_RGBDREFRACTION=!1,n.SS_LINEARSPECULARREFRACTION=!1,n.SS_REFRACTIONMAP_OPPOSITEZ=!1,n.SS_LODINREFRACTIONALPHA=!1,n.SS_LINKREFRACTIONTOTRANSPARENCY=!1,n.SS_ALBEDOFORREFRACTIONTINT=!1,n.SS_ALBEDOFORTRANSLUCENCYTINT=!1,n.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,n.SS_USE_THICKNESS_AS_DEPTH=!1,n.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,n.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,n._areTexturesDirty&&k.texturesEnabled&&(this._thicknessTexture&&O.e.ThicknessTextureEnabled&&(0,f.J)(this._thicknessTexture,n,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&O.e.RefractionIntensityTextureEnabled&&(0,f.J)(this._refractionIntensityTexture,n,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&O.e.TranslucencyIntensityTextureEnabled&&(0,f.J)(this._translucencyIntensityTexture,n,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&O.e.TranslucencyColorTextureEnabled&&((0,f.J)(this._translucencyColorTexture,n,"SS_TRANSLUCENCYCOLOR_TEXTURE"),n.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),n.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,n.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,n.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,n.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&k.texturesEnabled){const T=this._getRefractionTexture(k);T&&O.e.RefractionTextureEnabled&&(n.SS_REFRACTION=!0,n.SS_REFRACTIONMAP_3D=T.isCube,n.SS_GAMMAREFRACTION=T.gammaSpace,n.SS_RGBDREFRACTION=T.isRGBD,n.SS_LINEARSPECULARREFRACTION=T.linearSpecularLOD,n.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&T.isCube?!T.invertZ:T.invertZ,n.SS_LODINREFRACTIONALPHA=T.lodLevelInAlpha,n.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,n.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,n.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=T.isCube&&T.boundingBoxSize,n.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(n.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(n,k,T,c){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)n.updateFloat2("vThicknessParam",0,0);else{c.getRenderingMesh().getWorldMatrix().decompose(I.l.li[0]);const k=Math.max(Math.abs(I.l.li[0].x),Math.abs(I.l.li[0].y),Math.abs(I.l.li[0].z));n.updateFloat2("vThicknessParam",this.minimumThickness*k,(this.maximumThickness-this.minimumThickness)*k)}}bindForSubMesh(n,k,T,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const K=c.materialDefines,Q=this._material.isFrozen,G=this._material.realTimeFiltering,w=K.LODBASEDMICROSFURACE,E=this._getRefractionTexture(k);if(!n.useUbo||!Q||!n.isSync){if(this._thicknessTexture&&O.e.ThicknessTextureEnabled&&(n.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,f.m)(this._thicknessTexture,n,"thickness")),this._refractionIntensityTexture&&O.e.RefractionIntensityTextureEnabled&&K.SS_REFRACTIONINTENSITY_TEXTURE&&(n.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,f.m)(this._refractionIntensityTexture,n,"refractionIntensity")),this._translucencyColorTexture&&O.e.TranslucencyColorTextureEnabled&&K.SS_TRANSLUCENCYCOLOR_TEXTURE&&(n.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,f.m)(this._translucencyColorTexture,n,"translucencyColor")),this._translucencyIntensityTexture&&O.e.TranslucencyIntensityTextureEnabled&&K.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(n.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,f.m)(this._translucencyIntensityTexture,n,"translucencyIntensity")),E&&O.e.RefractionTextureEnabled){n.Vi("refractionMatrix",E.getRefractionTextureMatrix());let k=1;E.isCube||E.depth&&(k=E.depth);const T=E.getSize().width,c=this.volumeIndexOfRefraction;if(n.updateFloat4("vRefractionInfos",E.level,1/c,k,this._invertRefractionY?-1:1),n.updateFloat4("vRefractionMicrosurfaceInfos",T,E.lodGenerationScale,E.lodGenerationOffset,1/this.indexOfRefraction),G&&n.updateFloat2("vRefractionFilteringInfo",T,Math.log2(T)),E.boundingBoxSize){const k=E;n.updateVector3("vRefractionPosition",k.boundingBoxPosition),n.updateVector3("vRefractionSize",k.boundingBoxSize)}}this._isScatteringEnabled&&n.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),n.updateColor3("vDiffusionDistance",this.diffusionDistance),n.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),n.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),n.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),n.updateFloat("dispersion",this.dispersion)}k.texturesEnabled&&(this._thicknessTexture&&O.e.ThicknessTextureEnabled&&n.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&O.e.RefractionIntensityTextureEnabled&&K.SS_REFRACTIONINTENSITY_TEXTURE&&n.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&O.e.TranslucencyIntensityTextureEnabled&&K.SS_TRANSLUCENCYINTENSITY_TEXTURE&&n.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&O.e.TranslucencyColorTextureEnabled&&K.SS_TRANSLUCENCYCOLOR_TEXTURE&&n.setTexture("translucencyColorSampler",this._translucencyColorTexture),E&&O.e.RefractionTextureEnabled&&(w?n.setTexture("refractionSampler",E):(n.setTexture("refractionSampler",E._lodTextureMid||E),n.setTexture("refractionSamplerLow",E._lodTextureLow||E),n.setTexture("refractionSamplerHigh",E._lodTextureHigh||E))))}_getRefractionTexture(n){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?n.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(n){O.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&n.push(this._refractionTexture)}hasTexture(n){return this._thicknessTexture===n||(this._refractionTexture===n||(this._refractionIntensityTexture===n||(this._translucencyIntensityTexture===n||this._translucencyColorTexture===n)))}hasRenderTargetTextures(){return!!(O.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(n){this._thicknessTexture&&n.push(this._thicknessTexture),this._refractionTexture&&n.push(this._refractionTexture),this._translucencyColorTexture&&n.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&n.push(this._translucencyIntensityTexture)}getAnimatables(n){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&n.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&n.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&n.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&n.push(this._translucencyIntensityTexture)}dispose(n){n&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(n,k,T){return n.SS_SCATTERING&&k.addFallback(T++,"SS_SCATTERING"),n.SS_TRANSLUCENCY&&k.addFallback(T++,"SS_TRANSLUCENCY"),T}getSamplers(n){n.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}Z.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,Z.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isRefractionEnabled",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isTranslucencyEnabled",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isDispersionEnabled",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markScenePrePassDirty")],Z.prototype,"isScatteringEnabled",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"refractionIntensity",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"translucencyIntensity",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"useAlbedoToTintRefraction",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"useAlbedoToTintTranslucency",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"thicknessTexture",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"refractionTexture",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"indexOfRefraction",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"_volumeIndexOfRefraction",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"volumeIndexOfRefraction",null),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"invertRefractionY",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"linkRefractionWithTransparency",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"minimumThickness",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"maximumThickness",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"useThicknessAsDepth",void 0),(0,c.e)([(0,K.h)()],Z.prototype,"tintColor",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"tintColorAtDistance",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"dispersion",void 0),(0,c.e)([(0,K.h)()],Z.prototype,"diffusionDistance",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useMaskFromThicknessTexture",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"refractionIntensityTexture",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"translucencyIntensityTexture",void 0),(0,c.e)([(0,K.h)()],Z.prototype,"translucencyColor",void 0),(0,c.e)([(0,K.D)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"translucencyColorTexture",void 0),(0,c.e)([(0,K.K)(),(0,K.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useGltfStyleTextures",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"applyAlbedoAfterSubSurface",void 0),(0,c.e)([(0,K.K)()],Z.prototype,"legacyTransluceny",void 0);var e=T(12254),d=T(929),l=T(12267);const i={effect:null,subMesh:null};class B extends P.b{constructor(n){super(n),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class t extends r.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(n){this._realTimeFiltering=n,this.Li(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(n){this._realTimeFilteringQuality=n,this.Li(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(n){n!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=n||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(n,k){super(n,k,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||t.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new I.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=b.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new b.e(0,0,0),this._albedoColor=new b.e(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new b.e(1,1,1),this._reflectionColor=new b.e(1,1,1),this._emissiveColor=new b.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new G.g(16),this._globalAmbientColor=new b.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new H(this),this.clearCoat=new v(this),this.iridescence=new m(this),this.anisotropy=new g(this),this.sheen=new V(this),this.subSurface=new Z(this),this.detailMap=new e.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),O.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,w.d)(this.va()),this.prePassConfiguration=new s.c}get hasRenderTargetTextures(){return!!(O.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var n;return this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST||(null===(n=this.subSurface)||void 0===n?void 0:n.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var n;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(n=this.subSurface)||void 0===n||!n.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===t.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Bj&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Bj||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(n,k,T){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const c=k._drawWrapper;if(c.effect&&this.isFrozen&&c._wasPreviouslyReady&&c._wasPreviouslyUsingInstances===T)return!0;k.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),k.materialDefines=new B(this._eventInfo.defineNames));const K=k.materialDefines;if(this._isReadyForSubMesh(k))return!0;const G=this.va(),w=G.getEngine();if(K._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,G.texturesEnabled)){if(this._albedoTexture&&O.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&O.e.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&O.e.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&O.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&O.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const n=this._getReflectionTexture();if(n&&O.e.ReflectionTextureEnabled){if(!n.isReadyOrNotBlocking())return!1;var E;if(n.irradianceTexture){if(!n.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!n.sphericalPolynomial&&null!==(E=n.getInternalTexture())&&void 0!==E&&E._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&O.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&O.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(O.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(w.getCaps().standardDerivatives&&this._bumpTexture&&O.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&O.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=K,this._eventInfo.subMesh=k,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(K._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(K.AREALIGHTUSED)for(let Q=0;Q<n.lightSources.length;Q++)if(!n.lightSources[Q]._isReady())return!1;w.getCaps().standardDerivatives||n.isVerticesDataPresent(S.f.NormalKind)||(n.createNormals(!0),Q.d.Warn("PBRMaterial: Normals have been created for the mesh: "+n.name));const I=k.effect,P=K._areLightsDisposed;let W=this._prepareEffect(n,K,this.onCompiled,this.onError,T,null,k.getRenderingMesh().hasThinInstances),J=!1;if(W)if(this._onEffectCreatedObservable&&(i.effect=W,i.subMesh=k,this._onEffectCreatedObservable.notifyObservers(i)),this.allowShaderHotSwapping&&I&&!W.isReady()){if(W=I,K.markAsUnprocessed(),J=this.isFrozen,P)return K._areLightsDisposed=!0,!1}else G.resetCachedMaterial(),k.setEffect(W,K,this._materialContext);return!(!k.effect||!k.effect.isReady())&&(K._renderId=G.getRenderId(),c._wasPreviouslyReady=!J,c._wasPreviouslyUsingInstances=!!T,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(n,k){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(n,k,Q,G,w),!k.isDirty)return null;k.markAsProcessed();const E=this.va().getEngine(),I=new u.c;let P=0;k.USESPHERICALINVERTEX&&I.addFallback(P++,"USESPHERICALINVERTEX"),k.FOG&&I.addFallback(P,"FOG"),k.SPECULARAA&&I.addFallback(P,"SPECULARAA"),k.POINTSIZE&&I.addFallback(P,"POINTSIZE"),k.LOGARITHMICDEPTH&&I.addFallback(P,"LOGARITHMICDEPTH"),k.PARALLAX&&I.addFallback(P,"PARALLAX"),k.PARALLAX_RHS&&I.addFallback(P,"PARALLAX_RHS"),k.PARALLAXOCCLUSION&&I.addFallback(P++,"PARALLAXOCCLUSION"),k.ENVIRONMENTBRDF&&I.addFallback(P++,"ENVIRONMENTBRDF"),k.TANGENT&&I.addFallback(P++,"TANGENT"),k.BUMP&&I.addFallback(P++,"BUMP"),P=(0,f.n)(k,I,this._maxSimultaneousLights,P++),k.SPECULARTERM&&I.addFallback(P++,"SPECULARTERM"),k.USESPHERICALFROMREFLECTIONMAP&&I.addFallback(P++,"USESPHERICALFROMREFLECTIONMAP"),k.USEIRRADIANCEMAP&&I.addFallback(P++,"USEIRRADIANCEMAP"),k.LIGHTMAP&&I.addFallback(P++,"LIGHTMAP"),k.NORMAL&&I.addFallback(P++,"NORMAL"),k.AMBIENT&&I.addFallback(P++,"AMBIENT"),k.EMISSIVE&&I.addFallback(P++,"EMISSIVE"),k.VERTEXCOLOR&&I.addFallback(P++,"VERTEXCOLOR"),k.MORPHTARGETS&&I.addFallback(P++,"MORPHTARGETS"),k.MULTIVIEW&&I.addFallback(0,"MULTIVIEW");const W=[S.f.PositionKind];k.NORMAL&&W.push(S.f.NormalKind),k.TANGENT&&W.push(S.f.TangentKind);for(let T=1;T<=6;++T)k["UV"+T]&&W.push(`uv${1===T?"":T}`);k.VERTEXCOLOR&&W.push(S.f.ColorKind),(0,f.u)(W,n,k,I),(0,f.w)(W,k),(0,f.x)(W,n,k),(0,f.r)(W,n,k);let J="pbr";const H=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],b=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],z=["Material","Scene","Mesh"],r={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:k.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=I,this._eventInfo.fallbackRank=P,this._eventInfo.defines=k,this._eventInfo.uniforms=H,this._eventInfo.attributes=W,this._eventInfo.samplers=b,this._eventInfo.uniformBuffersNames=z,this._eventInfo.customCode=void 0,this._eventInfo.mesh=n,this._eventInfo.indexParameters=r,this._callbackPluginEventGeneric(128,this._eventInfo),l.b.AddUniformsAndSamplers(H,b),s.c.AddUniforms(H),s.c.AddSamplers(b),(0,d.c)(H),C.e&&(C.e.PrepareUniforms(H,k),C.e.PrepareSamplers(b,k)),(0,f.V)({uniformsNames:H,uniformBuffersNames:z,samplers:b,defines:k,maxSimultaneousLights:this._maxSimultaneousLights});const q={};this.customShaderNameResolve&&(J=this.customShaderNameResolve(J,H,z,b,k,W,q));const O=k.toString(),A=E.createEffect(J,{attributes:W,uniformsNames:H,uniformBuffersNames:z,samplers:b,defines:O,fallbacks:I,onCompiled:c,onError:K,indexParameters:r,processFinalCode:q.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:k.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([T.e(41),T.e(50)]).then(T.bind(T,13920)),Promise.all([T.e(42),T.e(51)]).then(T.bind(T,13939))]):await Promise.all([Promise.all([T.e(45),T.e(52)]).then(T.bind(T,13948)),Promise.all([T.e(47),T.e(53)]).then(T.bind(T,13971))]),this._shadersLoaded=!0}},E);return this._eventInfo.customCode=void 0,A}_prepareDefines(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Q=this.va(),G=Q.getEngine();(0,f.I)(Q,n,k,!0,this._maxSimultaneousLights,this._disableLighting),k._needNormals=!0,(0,f.R)(Q,k);const w=this.needAlphaBlendingForMesh(n)&&this.va().useOrderIndependentTransparency;if((0,f.U)(Q,k,this.canRenderToMRT&&!w),(0,f.S)(Q,k,w),l.b.PrepareDefines(G.currentRenderPassId,n,k),k.METALLICWORKFLOW=this.isMetallicWorkflow(),k._areTexturesDirty){k._needUVs=!1;for(let n=1;n<=6;++n)k["MAINUV"+n]=!1;if(Q.texturesEnabled){k.ALBEDODIRECTUV=0,k.BASE_WEIGHTDIRECTUV=0,k.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,k.AMBIENTDIRECTUV=0,k.OPACITYDIRECTUV=0,k.EMISSIVEDIRECTUV=0,k.REFLECTIVITYDIRECTUV=0,k.MICROSURFACEMAPDIRECTUV=0,k.METALLIC_REFLECTANCEDIRECTUV=0,k.REFLECTANCEDIRECTUV=0,k.BUMPDIRECTUV=0,k.LIGHTMAPDIRECTUV=0,G.getCaps().textureLOD&&(k.LODBASEDMICROSFURACE=!0),this._albedoTexture&&O.e.DiffuseTextureEnabled?((0,f.J)(this._albedoTexture,k,"ALBEDO"),k.GAMMAALBEDO=this._albedoTexture.gammaSpace):k.ALBEDO=!1,this._baseWeightTexture&&O.e.BaseWeightTextureEnabled?(0,f.J)(this._baseWeightTexture,k,"BASE_WEIGHT"):k.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&O.e.BaseDiffuseRoughnessTextureEnabled?(0,f.J)(this._baseDiffuseRoughnessTexture,k,"BASE_DIFFUSE_ROUGHNESS"):k.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&O.e.AmbientTextureEnabled?((0,f.J)(this._ambientTexture,k,"AMBIENT"),k.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):k.AMBIENT=!1,this._opacityTexture&&O.e.OpacityTextureEnabled?((0,f.J)(this._opacityTexture,k,"OPACITY"),k.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):k.OPACITY=!1;const n=this._getReflectionTexture();if(n&&O.e.ReflectionTextureEnabled){switch(k.REFLECTION=!0,k.GAMMAREFLECTION=n.gammaSpace,k.RGBDREFLECTION=n.isRGBD,k.LODINREFLECTIONALPHA=n.lodLevelInAlpha,k.LINEARSPECULARREFLECTION=n.linearSpecularLOD,k.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(k.NUM_SAMPLES=""+this.realTimeFilteringQuality,G._features.needTypeSuffixInShaderConstants&&(k.NUM_SAMPLES=k.NUM_SAMPLES+"u"),k.REALTIME_FILTERING=!0,this.va().iblCdfGenerator&&(k.IBL_CDF_FILTERING=!0)):k.REALTIME_FILTERING=!1,k.INVERTCUBICMAP=n.coordinatesMode===q.b.INVCUBIC_MODE,k.REFLECTIONMAP_3D=n.isCube,k.REFLECTIONMAP_OPPOSITEZ=k.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!n.invertZ:n.invertZ,k.REFLECTIONMAP_CUBIC=!1,k.REFLECTIONMAP_EXPLICIT=!1,k.REFLECTIONMAP_PLANAR=!1,k.REFLECTIONMAP_PROJECTION=!1,k.REFLECTIONMAP_SKYBOX=!1,k.REFLECTIONMAP_SPHERICAL=!1,k.REFLECTIONMAP_EQUIRECTANGULAR=!1,k.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,k.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.coordinatesMode){case q.b.EXPLICIT_MODE:k.REFLECTIONMAP_EXPLICIT=!0;break;case q.b.PLANAR_MODE:k.REFLECTIONMAP_PLANAR=!0;break;case q.b.PROJECTION_MODE:k.REFLECTIONMAP_PROJECTION=!0;break;case q.b.SKYBOX_MODE:k.REFLECTIONMAP_SKYBOX=!0;break;case q.b.SPHERICAL_MODE:k.REFLECTIONMAP_SPHERICAL=!0;break;case q.b.EQUIRECTANGULAR_MODE:k.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case q.b.FIXED_EQUIRECTANGULAR_MODE:k.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case q.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:k.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case q.b.CUBIC_MODE:case q.b.INVCUBIC_MODE:default:k.REFLECTIONMAP_CUBIC=!0,k.USE_LOCAL_REFLECTIONMAP_CUBIC=!!n.boundingBoxSize}n.coordinatesMode!==q.b.SKYBOX_MODE&&(n.irradianceTexture?(k.USEIRRADIANCEMAP=!0,k.USESPHERICALFROMREFLECTIONMAP=!1,k.USESPHERICALINVERTEX=!1,n.irradianceTexture._dominantDirection&&(k.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):n.isCube&&(k.USESPHERICALFROMREFLECTIONMAP=!0,k.USEIRRADIANCEMAP=!1,k.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||G.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?k.USESPHERICALINVERTEX=!1:k.USESPHERICALINVERTEX=!0))}else k.REFLECTION=!1,k.REFLECTIONMAP_3D=!1,k.REFLECTIONMAP_SPHERICAL=!1,k.REFLECTIONMAP_PLANAR=!1,k.REFLECTIONMAP_CUBIC=!1,k.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,k.REFLECTIONMAP_PROJECTION=!1,k.REFLECTIONMAP_SKYBOX=!1,k.REFLECTIONMAP_EXPLICIT=!1,k.REFLECTIONMAP_EQUIRECTANGULAR=!1,k.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,k.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,k.INVERTCUBICMAP=!1,k.USESPHERICALFROMREFLECTIONMAP=!1,k.USEIRRADIANCEMAP=!1,k.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,k.USESPHERICALINVERTEX=!1,k.REFLECTIONMAP_OPPOSITEZ=!1,k.LODINREFLECTIONALPHA=!1,k.GAMMAREFLECTION=!1,k.RGBDREFLECTION=!1,k.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&O.e.LightmapTextureEnabled?((0,f.J)(this._lightmapTexture,k,"LIGHTMAP"),k.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,k.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,k.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):k.LIGHTMAP=!1,this._emissiveTexture&&O.e.EmissiveTextureEnabled?((0,f.J)(this._emissiveTexture,k,"EMISSIVE"),k.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):k.EMISSIVE=!1,O.e.SpecularTextureEnabled?(this._metallicTexture?((0,f.J)(this._metallicTexture,k,"REFLECTIVITY"),k.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,k.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,k.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,k.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,k.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,f.J)(this._reflectivityTexture,k,"REFLECTIVITY"),k.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,k.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,k.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):k.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(k.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,f.J)(this._metallicReflectanceTexture,k,"METALLIC_REFLECTANCE"),k.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):k.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,f.J)(this._reflectanceTexture,k,"REFLECTANCE"),k.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):k.REFLECTANCE=!1):(k.METALLIC_REFLECTANCE=!1,k.REFLECTANCE=!1),this._microSurfaceTexture?(0,f.J)(this._microSurfaceTexture,k,"MICROSURFACEMAP"):k.MICROSURFACEMAP=!1):(k.REFLECTIVITY=!1,k.MICROSURFACEMAP=!1),G.getCaps().standardDerivatives&&this._bumpTexture&&O.e.BumpTextureEnabled&&!this._disableBumpMap?((0,f.J)(this._bumpTexture,k,"BUMP"),this._useParallax&&this._albedoTexture&&O.e.DiffuseTextureEnabled?(k.PARALLAX=!0,k.PARALLAX_RHS=Q.useRightHandedSystem,k.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):k.PARALLAX=!1,k.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(k.BUMP=!1,k.PARALLAX=!1,k.PARALLAX_RHS=!1,k.PARALLAXOCCLUSION=!1,k.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&O.e.ReflectionTextureEnabled?(k.ENVIRONMENTBRDF=!0,k.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(k.ENVIRONMENTBRDF=!1,k.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?k.ALPHAFROMALBEDO=!0:k.ALPHAFROMALBEDO=!1}k.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(k.USEPHYSICALLIGHTFALLOFF=!1,k.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(k.USEPHYSICALLIGHTFALLOFF=!1,k.USEGLTFLIGHTFALLOFF=!0):(k.USEPHYSICALLIGHTFALLOFF=!0,k.USEGLTFLIGHTFALLOFF=!1),k.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.ui&&this._twoSidedLighting?k.TWOSIDEDLIGHTING=!0:k.TWOSIDEDLIGHTING=!1,k.MIRRORED=!!Q._mirroredCameraPosition,k.SPECULARAA=G.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(k._areTexturesDirty||k._areMiscDirty)&&(k.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,k.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,k.ALPHABLEND=this.needAlphaBlendingForMesh(n),k.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,k.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),k._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(k),k.FORCENORMALFORWARD=this._forceNormalForward,k.RADIANCEOCCLUSION=this._useRadianceOcclusion,k.HORIZONOCCLUSION=this._useHorizonOcclusion,k._areMiscDirty&&((0,f.N)(n,Q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(n),k,this._applyDecalMapAfterDetailMap),k.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!n.isVerticesDataPresent(S.f.NormalKind),k.DEBUGMODE=this._debugMode),(0,f.F)(Q,G,this,k,!!T,c,K),this._eventInfo.defines=k,this._eventInfo.mesh=n,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,f.C)(n,k,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(n,k,T){const c={clipPlane:!1,useInstances:!1,...T};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const T=new B(this._eventInfo.defineNames),K=this._prepareEffect(n,T,void 0,void 0,c.useInstances,c.clipPlane,n.hasThinInstances);this._onEffectCreatedObservable&&(i.effect=K,i.subMesh=null,this._onEffectCreatedObservable.notifyObservers(i)),K.isReady()?k&&k(this):K.onCompileObservable.add((()=>{k&&k(this)}))})()}buildUniformLayout(){const n=this._uniformBuffer;n.addUniform("vAlbedoInfos",2),n.addUniform("vBaseWeightInfos",2),n.addUniform("vBaseDiffuseRoughnessInfos",2),n.addUniform("vAmbientInfos",4),n.addUniform("vOpacityInfos",2),n.addUniform("vEmissiveInfos",2),n.addUniform("vLightmapInfos",2),n.addUniform("vReflectivityInfos",3),n.addUniform("vMicroSurfaceSamplerInfos",2),n.addUniform("vReflectionInfos",2),n.addUniform("vReflectionFilteringInfo",2),n.addUniform("vReflectionPosition",3),n.addUniform("vReflectionSize",3),n.addUniform("vBumpInfos",3),n.addUniform("albedoMatrix",16),n.addUniform("baseWeightMatrix",16),n.addUniform("baseDiffuseRoughnessMatrix",16),n.addUniform("ambientMatrix",16),n.addUniform("opacityMatrix",16),n.addUniform("emissiveMatrix",16),n.addUniform("lightmapMatrix",16),n.addUniform("reflectivityMatrix",16),n.addUniform("microSurfaceSamplerMatrix",16),n.addUniform("bumpMatrix",16),n.addUniform("vTangentSpaceParams",2),n.addUniform("reflectionMatrix",16),n.addUniform("vReflectionColor",3),n.addUniform("vAlbedoColor",4),n.addUniform("baseWeight",1),n.addUniform("baseDiffuseRoughness",1),n.addUniform("vLightingIntensity",4),n.addUniform("vReflectionMicrosurfaceInfos",3),n.addUniform("vReflectionDominantDirection",3),n.addUniform("pointSize",1),n.addUniform("vReflectivityColor",4),n.addUniform("vEmissiveColor",3),n.addUniform("vAmbientColor",3),n.addUniform("vDebugMode",2),n.addUniform("vMetallicReflectanceFactors",4),n.addUniform("vMetallicReflectanceInfos",2),n.addUniform("metallicReflectanceMatrix",16),n.addUniform("vReflectanceInfos",2),n.addUniform("reflectanceMatrix",16),n.addUniform("vSphericalL00",3),n.addUniform("vSphericalL1_1",3),n.addUniform("vSphericalL10",3),n.addUniform("vSphericalL11",3),n.addUniform("vSphericalL2_2",3),n.addUniform("vSphericalL2_1",3),n.addUniform("vSphericalL20",3),n.addUniform("vSphericalL21",3),n.addUniform("vSphericalL22",3),n.addUniform("vSphericalX",3),n.addUniform("vSphericalY",3),n.addUniform("vSphericalZ",3),n.addUniform("vSphericalXX_ZZ",3),n.addUniform("vSphericalYY_ZZ",3),n.addUniform("vSphericalZZ",3),n.addUniform("vSphericalXY",3),n.addUniform("vSphericalYZ",3),n.addUniform("vSphericalZX",3),n.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(n,k,T){const c=this.va(),K=T.materialDefines;if(!K)return;const Q=T.effect;if(!Q)return;this._activeEffect=Q,k.getMeshUniformBuffer().bindToEffect(Q,"Mesh"),k.transferToEffect(n);const G=c.getEngine();this._uniformBuffer.bindToEffect(Q,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,c,k,n,this.isFrozen),l.b.Bind(G.currentRenderPassId,this._activeEffect,k,n,this);const w=c.activeCamera;w?this._uniformBuffer.updateFloat4("cameraInfo",w.ri,w.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=T,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),K.OBJECTSPACE_NORMALMAP&&(n.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const I=this._mustRebind(c,Q,T,k.visibility);(0,f.b)(k,this._activeEffect,this.prePassConfiguration);let S=null;const P=this._uniformBuffer;if(I){if(this.bindViewProjection(Q),S=this._getReflectionTexture(),!P.useUbo||!this.isFrozen||!P.isSync||T._drawWrapper._forceRebindOnNextCall){var W;if(c.texturesEnabled){if(this._albedoTexture&&O.e.DiffuseTextureEnabled&&(P.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,f.m)(this._albedoTexture,P,"albedo")),this._baseWeightTexture&&O.e.BaseWeightTextureEnabled&&(P.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,f.m)(this._baseWeightTexture,P,"baseWeight")),this._baseDiffuseRoughnessTexture&&O.e.BaseDiffuseRoughnessTextureEnabled&&(P.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,f.m)(this._baseDiffuseRoughnessTexture,P,"baseDiffuseRoughness")),this._ambientTexture&&O.e.AmbientTextureEnabled&&(P.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,f.m)(this._ambientTexture,P,"ambient")),this._opacityTexture&&O.e.OpacityTextureEnabled&&(P.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,f.m)(this._opacityTexture,P,"opacity")),S&&O.e.ReflectionTextureEnabled){if(P.Vi("reflectionMatrix",S.getReflectionTextureMatrix()),P.updateFloat2("vReflectionInfos",S.level*c.iblIntensity,0),S.boundingBoxSize){const n=S;P.updateVector3("vReflectionPosition",n.boundingBoxPosition),P.updateVector3("vReflectionSize",n.boundingBoxSize)}if(this.realTimeFiltering){const n=S.getSize().width;P.updateFloat2("vReflectionFilteringInfo",n,Math.log2(n))}if(K.USEIRRADIANCEMAP)K.USEIRRADIANCEMAP&&K.USE_IRRADIANCE_DOMINANT_DIRECTION&&P.updateVector3("vReflectionDominantDirection",S.irradianceTexture._dominantDirection);else{const n=S.sphericalPolynomial;if(K.USESPHERICALFROMREFLECTIONMAP&&n)if(K.SPHERICAL_HARMONICS){const k=n.preScaledHarmonics;P.updateVector3("vSphericalL00",k.l00),P.updateVector3("vSphericalL1_1",k.l1_1),P.updateVector3("vSphericalL10",k.l10),P.updateVector3("vSphericalL11",k.l11),P.updateVector3("vSphericalL2_2",k.l2_2),P.updateVector3("vSphericalL2_1",k.l2_1),P.updateVector3("vSphericalL20",k.l20),P.updateVector3("vSphericalL21",k.l21),P.updateVector3("vSphericalL22",k.l22)}else P.updateFloat3("vSphericalX",n.x.x,n.x.y,n.x.z),P.updateFloat3("vSphericalY",n.y.x,n.y.y,n.y.z),P.updateFloat3("vSphericalZ",n.z.x,n.z.y,n.z.z),P.updateFloat3("vSphericalXX_ZZ",n.xx.x-n.zz.x,n.xx.y-n.zz.y,n.xx.z-n.zz.z),P.updateFloat3("vSphericalYY_ZZ",n.yy.x-n.zz.x,n.yy.y-n.zz.y,n.yy.z-n.zz.z),P.updateFloat3("vSphericalZZ",n.zz.x,n.zz.y,n.zz.z),P.updateFloat3("vSphericalXY",n.xy.x,n.xy.y,n.xy.z),P.updateFloat3("vSphericalYZ",n.yz.x,n.yz.y,n.yz.z),P.updateFloat3("vSphericalZX",n.zx.x,n.zx.y,n.zx.z)}P.updateFloat3("vReflectionMicrosurfaceInfos",S.getSize().width,S.lodGenerationScale,S.lodGenerationOffset)}this._emissiveTexture&&O.e.EmissiveTextureEnabled&&(P.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,f.m)(this._emissiveTexture,P,"emissive")),this._lightmapTexture&&O.e.LightmapTextureEnabled&&(P.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,f.m)(this._lightmapTexture,P,"lightmap")),O.e.SpecularTextureEnabled&&(this._metallicTexture?(P.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,f.m)(this._metallicTexture,P,"reflectivity")):this._reflectivityTexture&&(P.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,f.m)(this._reflectivityTexture,P,"reflectivity")),this._metallicReflectanceTexture&&(P.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,f.m)(this._metallicReflectanceTexture,P,"metallicReflectance")),this._reflectanceTexture&&K.REFLECTANCE&&(P.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,f.m)(this._reflectanceTexture,P,"reflectance")),this._microSurfaceTexture&&(P.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,f.m)(this._microSurfaceTexture,P,"microSurfaceSampler"))),this._bumpTexture&&G.getCaps().standardDerivatives&&O.e.BumpTextureEnabled&&!this._disableBumpMap&&(P.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,f.m)(this._bumpTexture,P,"bump"),c._mirroredCameraPosition?P.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):P.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&P.updateFloat("pointSize",this.pointSize),K.METALLICWORKFLOW){var J;b.h.Si[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,b.h.Si[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const n=(null===(J=this.subSurface)||void 0===J?void 0:J._indexOfRefraction)??1.5,k=1;b.h.Si[0].b=n;const T=Math.pow((n-k)/(n+k),2);b.h.Si[0].a=T,P.updateDirectColor4("vReflectivityColor",b.h.Si[0]),P.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else P.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);P.updateColor3("vEmissiveColor",O.e.EmissiveTextureEnabled?this._emissiveColor:b.e.BlackReadOnly),P.updateColor3("vReflectionColor",this._reflectionColor),!K.SS_REFRACTION&&null!==(W=this.subSurface)&&void 0!==W&&W._linkRefractionWithTransparency?P.updateColor4("vAlbedoColor",this._albedoColor,1):P.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),P.updateFloat("baseWeight",this._baseWeight),P.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*c.environmentIntensity,this._lightingInfos.w=this._specularIntensity,P.updateVector4("vLightingIntensity",this._lightingInfos),c.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),P.updateColor3("vAmbientColor",this._globalAmbientColor),P.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(c.texturesEnabled){if(this._albedoTexture&&O.e.DiffuseTextureEnabled&&P.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&O.e.BaseWeightTextureEnabled&&P.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&O.e.BaseDiffuseRoughnessTextureEnabled&&P.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&O.e.AmbientTextureEnabled&&P.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&O.e.OpacityTextureEnabled&&P.setTexture("opacitySampler",this._opacityTexture),S&&O.e.ReflectionTextureEnabled){K.LODBASEDMICROSFURACE?P.setTexture("reflectionSampler",S):(P.setTexture("reflectionSampler",S._lodTextureMid||S),P.setTexture("reflectionSamplerLow",S._lodTextureLow||S),P.setTexture("reflectionSamplerHigh",S._lodTextureHigh||S)),K.USEIRRADIANCEMAP&&P.setTexture("irradianceSampler",S.irradianceTexture);const n=this.va().iblCdfGenerator;this.realTimeFiltering&&n&&P.setTexture("icdfSampler",n.getIcdfTexture())}K.ENVIRONMENTBRDF&&P.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&O.e.EmissiveTextureEnabled&&P.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&O.e.LightmapTextureEnabled&&P.setTexture("lightmapSampler",this._lightmapTexture),O.e.SpecularTextureEnabled&&(this._metallicTexture?P.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&P.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&P.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&K.REFLECTANCE&&P.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&P.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&G.getCaps().standardDerivatives&&O.e.BumpTextureEnabled&&!this._disableBumpMap&&P.setTexture("bumpSampler",this._bumpTexture)}this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(k)&&this.va().depthPeelingRenderer.bind(Q),this._eventInfo.subMesh=T,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,d.f)(this._activeEffect,this,c),this.bindEyePosition(Q)}else c.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(I||!this.isFrozen){var H;if(c.lightsEnabled&&!this._disableLighting&&(0,f.f)(c,k,this._activeEffect,K,this._maxSimultaneousLights),(c.fogEnabled&&k.applyFog&&c.fogMode!==E.c.FOGMODE_NONE||S||this.subSurface.refractionTexture||k.receiveShadows||K.PREPASS)&&this.bindView(Q),(0,f.c)(c,k,this._activeEffect,!0),K.NUM_MORPH_INFLUENCERS&&(0,f.k)(k,this._activeEffect),K.BAKED_VERTEX_ANIMATION_TEXTURE)null===(H=k.bakedVertexAnimationManager)||void 0===H||H.bind(Q,K.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,f.j)(K,this._activeEffect,c)}this._afterBind(k,this._activeEffect,T),P.update()}getAnimatables(){const n=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&n.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&n.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&n.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&n.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&n.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&n.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&n.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?n.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&n.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&n.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&n.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&n.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&n.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&n.push(this._microSurfaceTexture),n}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const n=super.getActiveTextures();return this._albedoTexture&&n.push(this._albedoTexture),this._baseWeightTexture&&n.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&n.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&n.push(this._ambientTexture),this._opacityTexture&&n.push(this._opacityTexture),this._reflectionTexture&&n.push(this._reflectionTexture),this._emissiveTexture&&n.push(this._emissiveTexture),this._reflectivityTexture&&n.push(this._reflectivityTexture),this._metallicTexture&&n.push(this._metallicTexture),this._metallicReflectanceTexture&&n.push(this._metallicReflectanceTexture),this._reflectanceTexture&&n.push(this._reflectanceTexture),this._microSurfaceTexture&&n.push(this._microSurfaceTexture),this._bumpTexture&&n.push(this._bumpTexture),this._lightmapTexture&&n.push(this._lightmapTexture),n}hasTexture(n){return!!super.hasTexture(n)||(this._albedoTexture===n||(this._baseWeightTexture===n||(this._baseDiffuseRoughnessTexture===n||(this._ambientTexture===n||(this._opacityTexture===n||(this._reflectionTexture===n||(this._emissiveTexture===n||(this._reflectivityTexture===n||(this._metallicTexture===n||(this._metallicReflectanceTexture===n||(this._reflectanceTexture===n||(this._microSurfaceTexture===n||(this._bumpTexture===n||this._lightmapTexture===n)))))))))))))}setPrePassRenderer(){var n;if(null===(n=this.subSurface)||void 0===n||!n.isScatteringEnabled)return!1;const k=this.va().enableSubSurfaceForPrePass();return k&&(k.enabled=!0),!0}dispose(n,k){var T,c,K,Q,G,w,E,I,S,P,W,J,H,s;(this._breakShaderLoadedCheck=!0,k)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(T=this._albedoTexture)||void 0===T||T.dispose(),null===(c=this._baseWeightTexture)||void 0===c||c.dispose(),null===(K=this._baseDiffuseRoughnessTexture)||void 0===K||K.dispose(),null===(Q=this._ambientTexture)||void 0===Q||Q.dispose(),null===(G=this._opacityTexture)||void 0===G||G.dispose(),null===(w=this._reflectionTexture)||void 0===w||w.dispose(),null===(E=this._emissiveTexture)||void 0===E||E.dispose(),null===(I=this._metallicTexture)||void 0===I||I.dispose(),null===(S=this._reflectivityTexture)||void 0===S||S.dispose(),null===(P=this._bumpTexture)||void 0===P||P.dispose(),null===(W=this._lightmapTexture)||void 0===W||W.dispose(),null===(J=this._metallicReflectanceTexture)||void 0===J||J.dispose(),null===(H=this._reflectanceTexture)||void 0===H||H.dispose(),null===(s=this._microSurfaceTexture)||void 0===s||s.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(n,k)}}t.PBRMATERIAL_OPAQUE=z.d.MATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=z.d.MATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=z.d.MATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=z.d.MATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,t.ForceGLSL=!1,(0,c.e)([(0,K.r)()],t.prototype,"_imageProcessingConfiguration",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0)},12793:(n,k,T)=>{"use strict";T.d(k,{c:()=>W});var c=T(706),K=T(712),Q=T(542),G=T(730),w=T(2342),E=T(2334),I=T(675),S=T(539),P=T(760);T(2454);class W extends w.b{set boundingBoxSize(n){if(this._boundingBoxSize&&this._boundingBoxSize.equals(n))return;this._boundingBoxSize=n;const k=this.va();k&&k.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(n){this._rotationY=n,this.setReflectionTextureMatrix(G.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(n,k,T){let c="";for(const K of n)c+=K;return new W(c,k,null,T,n)}static CreateFromPrefilteredData(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const K=k.useDelayedTextureLoading;k.useDelayedTextureLoading=!1;const Q=new W(n,k,null,!1,null,null,null,void 0,!0,T,c);return k.useDelayedTextureLoading=K,Q}constructor(n,k){var T;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,K=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]&&arguments[10],s=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,C=arguments.length>13?arguments[13]:void 0,z=arguments.length>14?arguments[14]:void 0;super(k),this.onLoadObservable=new S.b,this.boundingBoxPosition=G.o.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new G.d,this._buffer=null,this.name=n,this.url=n,this._noMipmap=K,this.Bj=!1,this.isCube=!0,this._textureMatrix=G.d.Identity(),this.coordinatesMode=E.b.CUBIC_MODE;let r=null,q=null;null===c||Array.isArray(c)?(this._noMipmap=K,this._format=P,this._createPolynomials=H,r=c,this._loaderOptions=C,this._useSRGBBuffer=z,this._lodScale=s,this._lodOffset=b):(r=c.extensions??null,this._noMipmap=c.noMipmap??!1,Q=c.files??null,q=c.buffer??null,this._format=c.format??5,W=c.prefiltered??!1,J=c.forcedExtension??null,this._createPolynomials=c.createPolynomials??!1,this._lodScale=c.lodScale??.8,this._lodOffset=c.lodOffset??0,this._loaderOptions=c.loaderOptions,this._useSRGBBuffer=c.useSRGBBuffer,w=c.X??null,I=c.onError??null),(n||Q)&&this.updateURL(n,J,w,W,I,r,null===(T=this.va())||void 0===T?void 0:T.useDelayedTextureLoading,Q,q)}getClassName(){return"CubeTexture"}updateURL(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=n),this.url=n,k&&(this._forcedExtension=k);const I=n.lastIndexOf("."),S=k||(I>-1?n.substring(I).toLowerCase():""),P=0===S.indexOf(".dds"),W=0===S.indexOf(".env"),J=0===S.indexOf(".basis");if(W?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=c,c&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),w)this._files=w;else if(J||W||P||Q||(Q=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Q){for(let k=0;k<Q.length;k++)this._files.push(n+Q[k]);this._extensions=Q}this._buffer=E,G?(this.delayLoadState=4,this._delayedOnLoad=T,this._delayedOnError=K):this._loadTexture(T,K)}delayLoad(n){4===this.delayLoadState&&(n&&(this._forcedExtension=n),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(n){var k,T;if(n.updateFlag===this._textureMatrix.updateFlag)return;n.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(T=this.va())||void 0===T||T.markAllMaterialsAsDirty(1,(n=>-1!==n.getActiveTextures().indexOf(this))));if(this._textureMatrix=n,null===(k=this.va())||void 0===k||!k.useRightHandedSystem)return;const c=G.l.li[0],K=G.l.Quaternion[0],Q=G.l.li[1];this._textureMatrix.decompose(c,K,Q),K.z*=-1,K.w*=-1,G.d.ComposeToRef(c,K,Q,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var n;return null!==(n=this.va())&&void 0!==n&&n.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=this.va(),c=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const K=()=>{var k;(this.onLoadObservable.notifyObservers(this),c)&&(c.dispose(),null===(k=this.va())||void 0===k||k.markAllMaterialsAsDirty(1));n&&n()},G=(n,T)=>{this._loadingError=!0,this._errorObject={message:n,exception:T},k&&k(n,T),E.b.OnTextureLoadErrorObservable.notifyObservers(this)};var w;this._texture?this._texture.isReady?Q.e.SetImmediate((()=>K())):this._texture.onLoadedObservable.add((()=>K())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,T,this._lodScale,this._lodOffset,n,G,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,T,this._files,this._noMipmap,n,G,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(w=this._texture)||void 0===w||w.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(n,k,T){const c=P.d.Parse((()=>{let c=!1;return n.prefiltered&&(c=n.prefiltered),new W(T+(n.url??n.name),k,n.extensions,!1,n.files||null,null,null,void 0,c,n.forcedExtension)}),n,k);if(n.boundingBoxPosition&&(c.boundingBoxPosition=G.o.ji(n.boundingBoxPosition)),n.boundingBoxSize&&(c.boundingBoxSize=G.o.ji(n.boundingBoxSize)),n.animations)for(let K=0;K<n.animations.length;K++){const k=n.animations[K],T=(0,I.b)("BABYLON.Animation");T&&c.animations.push(T.Parse(k))}return c}clone(){let n=0;const k=P.d.Clone((()=>{const k=new W(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return n=k.uniqueId,k}),this);return k.uniqueId=n,k}}(0,c.e)([(0,K.K)()],W.prototype,"url",void 0),(0,c.e)([(0,K.I)()],W.prototype,"boundingBoxPosition",void 0),(0,c.e)([(0,K.I)()],W.prototype,"boundingBoxSize",null),(0,c.e)([(0,K.K)("rotationY")],W.prototype,"rotationY",null),(0,c.e)([(0,K.K)("files")],W.prototype,"_files",void 0),(0,c.e)([(0,K.K)("forcedExtension")],W.prototype,"_forcedExtension",void 0),(0,c.e)([(0,K.K)("extensions")],W.prototype,"_extensions",void 0),(0,c.e)([(0,K.s)("textureMatrix")],W.prototype,"_textureMatrix",void 0),(0,c.e)([(0,K.s)("textureMatrixRefraction")],W.prototype,"_textureMatrixRefraction",void 0),E.b._CubeTextureParser=W.Parse,(0,I.f)("BABYLON.CubeTexture",W)},13098:(n,k,T)=>{"use strict";T.d(k,{c:()=>E});var c=T(556),K=T(2334),Q=T(693),G=T(2391),w=T(654);G.ThinEngine.prototype.createDynamicTexture=function(n,k,T,c){const K=new w.d(this,4);return K.baseWidth=n,K.baseHeight=k,T&&(n=this.needPOTTextures?(0,Q.h)(n,this._caps.maxTextureSize):n,k=this.needPOTTextures?(0,Q.h)(k,this._caps.maxTextureSize):k),K.width=n,K.height=k,K.isReady=!1,K.generateMipMaps=T,K.samplingMode=c,this.updateTextureSamplingMode(c,K),this._internalTexturesCache.push(K),K},G.ThinEngine.prototype.updateDynamicTexture=function(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!n)return;const G=this._gl,w=G.TEXTURE_2D,E=this._bindTextureDirectly(w,n,!0,Q);this._unpackFlipY(void 0===T?n.invertY:T),c&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const I=this._getWebGLTextureType(n.type),S=this._getInternalFormat(K||n.format),P=this._getRGBABufferInternalSizedFormat(n.type,S);G.texImage2D(w,0,P,S,I,k),n.generateMipMaps&&G.generateMipmap(w),E||this._bindTextureDirectly(w,null),c&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),K&&(n.format=K),n._dynamicTextureSource=k,n._premulAlpha=c,n.invertY=T||!1,n.isReady=!0};class E extends K.b{constructor(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,w=arguments.length>6?arguments[6]:void 0;const E=!T||T._isScene;super(null,E?T:null===T||void 0===T?void 0:T.me,E?!c:T,w,Q,void 0,void 0,void 0,void 0,G),this.name=n,this.wrapU=K.b.CLAMP_ADDRESSMODE,this.wrapV=K.b.CLAMP_ADDRESSMODE,this._generateMipMaps=c;const I=this._getEngine();if(!I)return;if(k.getContext)this._canvas=k,this._ownCanvas=!1,this._texture=I.createDynamicTexture(this._canvas.width,this._canvas.height,c,Q);else{this._canvas=I.createCanvas(1,1),this._ownCanvas=!0;const n=k;n.width||0===n.width?this._texture=I.createDynamicTexture(n.width,n.height,c,Q):this._texture=I.createDynamicTexture(k,k,c,Q)}const S=this.getSize();this._canvas.width!==S.width&&(this._canvas.width=S.width),this._canvas.height!==S.height&&(this._canvas.height=S.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(n){this._canvas.width=n.width,this._canvas.height=n.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(n.width,n.height,this._generateMipMaps,this.samplingMode)}scale(n){const k=this.getSize();k.width*=n,k.height*=n,this._recreate(k)}scaleTo(n,k){const T=this.getSize();T.width=n,T.height=k,this._recreate(T)}getContext(){return this._context}clear(n){const k=this.getSize();n&&(this._context.fillStyle=n),this._context.clearRect(0,0,k.width,k.height)}update(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===n||n,k,this._format||void 0,void 0,T)}drawText(n,k,T,c,K,Q,G){let w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const E=this.getSize();if(Q&&(this._context.fillStyle=Q,this._context.fillRect(0,0,E.width,E.height)),this._context.font=c,null===k||void 0===k){const T=this._context.measureText(n);k=(E.width-T.width)/2}if(null===T||void 0===T){const n=parseInt(c.replace(/\D/g,""));T=E.height/2+n/3.65}this._context.fillStyle=K||"",this._context.fillText(n,k,T),w&&this.update(G)}dispose(){var n,k;(super.dispose(),this._ownCanvas)&&(null===(n=this._canvas)||void 0===n||null===(k=n.remove)||void 0===k||k.call(n));this._canvas=null,this._context=null}clone(){const n=this.va();if(!n)return this;const k=this.getSize(),T=new E(this.name,k,n,this._generateMipMaps);return T.Bj=this.Bj,T.level=this.level,T.wrapU=this.wrapU,T.wrapV=this.wrapV,T}serialize(){const n=this.va();n&&!n.isReady()&&c.d.Warn("The scene must be ready before serializing the dynamic texture");const k=super.serialize();return E._IsCanvasElement(this._canvas)&&(k.base64String=this._canvas.toDataURL()),k.invertY=this._invertY,k.samplingMode=this.samplingMode,k}static _IsCanvasElement(n){return void 0!==n.toDataURL}_rebuild(){this.update()}}},12347:(n,k,T)=>{"use strict";T.d(k,{e:()=>K});var c=T(2334);class K extends c.b{constructor(n,k,T,K,Q){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,S=arguments.length>9?arguments[9]:void 0,P=arguments.length>10?arguments[10]:void 0,W=arguments.length>11?arguments[11]:void 0;super(null,Q,!G,w,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,S),this.format=K,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==I||(E=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==I||(E=1),this._texture=this._engine.createRawTexture(n,k,T,K,G,w,E,null,I,S??0,P??!1),this.wrapU=c.b.CLAMP_ADDRESSMODE,this.wrapV=c.b.CLAMP_ADDRESSMODE,this._waitingForData=!!W&&!n)}update(n){this._getEngine().updateRawTexture(this._texture,n,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const n=new K(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return n._texture=this._texture,this._texture.incrementReferences(),n}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(n,k,T,c){return new K(n,k,T,1,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(n,k,T,c){return new K(n,k,T,2,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(n,k,T,c){return new K(n,k,T,0,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(n,k,T,c){return new K(n,k,T,4,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(n,k,T,c){return new K(n,k,T,5,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(n,k,T,c){return new K(n,k,T,5,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(n,k,T,Q){let G=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:c.b.TRILINEAR_SAMPLINGMODE;return new K(n,k,T,6,Q,G,w,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(n,k,T,Q){let G=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:c.b.TRILINEAR_SAMPLINGMODE;return new K(n,k,T,6,Q,G,w,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12646:(n,k,T)=>{"use strict";T.d(k,{d:()=>K});var c=T(2334);class K extends c.b{get depth(){return this._depth}constructor(n,k,T,K,Q,G){let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:c.b.TRILINEAR_SAMPLINGMODE,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,P=arguments.length>10?arguments[10]:void 0;super(null,G,!w,E),this.format=Q,this._texture=G.getEngine().createRawTexture2DArray(n,k,T,K,Q,w,E,I,null,S,P),this._depth=K,this.is2DArray=!0}update(n){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,n,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(n,k,T,c,Q){return new K(n,k,T,c,5,Q,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12251:(n,k,T)=>{"use strict";T.d(k,{c:()=>c});class c{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(n,k){this._defines[n]||(n<this._currentRank&&(this._currentRank=n),n>this._maxRank&&(this._maxRank=n),this._defines[n]=new Array),this._defines[n].push(k)}addCPUSkinningFallback(n,k){this._mesh=k,n<this._currentRank&&(this._currentRank=n),n>this._maxRank&&(this._maxRank=n)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(n,k){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,n=n.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),k._bonesComputationForcedToCPU=!0;const T=this._mesh.va();for(let n=0;n<T.meshes.length;n++){const c=T.meshes[n];if(c.material){if(c.computeBonesUsingShaders&&0!==c.numBoneInfluencers)if(c.material.getEffect()===k)c.computeBonesUsingShaders=!1;else if(c.si)for(const n of c.si){if(n.effect===k){c.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&c.computeBonesUsingShaders&&c.numBoneInfluencers>0&&(c.computeBonesUsingShaders=!1)}}else{const k=this._defines[this._currentRank];if(k)for(let T=0;T<k.length;T++)n=n.replace("#define "+k[T],"");this._currentRank++}return n}}},12254:(n,k,T)=>{"use strict";T.d(k,{e:()=>P});var c=T(706),K=T(915),Q=T(712),G=T(12242),w=T(12237),E=T(12262),I=T(919);class S extends w.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class P extends E.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(n,"DetailMap",140,new S,k),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=K.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=n._dirtyCallbacks[1]}isReadyForSubMesh(n,k,T){return!this._isEnabled||!(n._areTexturesDirty&&k.texturesEnabled&&T.getCaps().standardDerivatives&&this._texture&&G.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(n,k){if(this._isEnabled){n.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const T=k.getEngine();n._areTexturesDirty&&(T.getCaps().standardDerivatives&&this._texture&&G.e.DetailTextureEnabled&&this._isEnabled?((0,I.J)(this._texture,n,"DETAIL"),n.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):n.DETAIL=!1)}else n.DETAIL=!1}bindForSubMesh(n,k){if(!this._isEnabled)return;const T=this._material.isFrozen;n.useUbo&&T&&n.isSync||this._texture&&G.e.DetailTextureEnabled&&(n.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,I.m)(this._texture,n,"detail")),k.texturesEnabled&&this._texture&&G.e.DetailTextureEnabled&&n.setTexture("detailSampler",this._texture)}hasTexture(n){return this._texture===n}getActiveTextures(n){this._texture&&n.push(this._texture)}getAnimatables(n){this._texture&&this._texture.animations&&this._texture.animations.length>0&&n.push(this._texture)}dispose(n){var k;n&&(null===(k=this._texture)||void 0===k||k.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(n){n.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,c.e)([(0,Q.D)("detailTexture"),(0,Q.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,c.e)([(0,Q.K)()],P.prototype,"diffuseBlendLevel",void 0),(0,c.e)([(0,Q.K)()],P.prototype,"roughnessBlendLevel",void 0),(0,c.e)([(0,Q.K)()],P.prototype,"bumpLevel",void 0),(0,c.e)([(0,Q.K)(),(0,Q.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"normalBlendMethod",void 0),(0,c.e)([(0,Q.K)(),(0,Q.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0)},12237:(n,k,T)=>{"use strict";T.d(k,{b:()=>c});class c{constructor(n){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=n,n)for(const k in n)Object.prototype.hasOwnProperty.call(n,k)&&this._setDefaultValue(k)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||n,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const n of Object.keys(this))"_"!==n[0]&&this._keys.push(n);if(this._externalProperties)for(const n in this._externalProperties)-1===this._keys.indexOf(n)&&this._keys.push(n)}isEqual(n){if(this._keys.length!==n._keys.length)return!1;for(let k=0;k<this._keys.length;k++){const T=this._keys[k];if(this[T]!==n[T])return!1}return!0}cloneTo(n){this._keys.length!==n._keys.length&&(n._keys=this._keys.slice(0));for(let k=0;k<this._keys.length;k++){const T=this._keys[k];n[T]=this[T]}}reset(){for(const n of this._keys)this._setDefaultValue(n)}_setDefaultValue(n){var k,T,c,K;const Q=(null===(k=this._externalProperties)||void 0===k||null===(T=k[n])||void 0===T?void 0:T.type)??typeof this[n],G=null===(c=this._externalProperties)||void 0===c||null===(K=c[n])||void 0===K?void 0:K.default;switch(Q){case"number":this[n]=G??0;break;case"string":this[n]=G??"";break;default:this[n]=G??!1}}toString(){let n="";for(let k=0;k<this._keys.length;k++){const T=this._keys[k],c=this[T];switch(typeof c){case"number":case"string":n+="#define "+T+" "+c+"\n";break;default:c&&(n+="#define "+T+"\n")}}return n}}},12242:(n,k,T)=>{"use strict";T.d(k,{e:()=>K});var c=T(615);class K{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(n){this._DiffuseTextureEnabled!==n&&(this._DiffuseTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(n){this._BaseWeightTextureEnabled!==n&&(this._BaseWeightTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(n){this._BaseDiffuseRoughnessTextureEnabled!==n&&(this._BaseDiffuseRoughnessTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(n){this._DetailTextureEnabled!==n&&(this._DetailTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(n){this._DecalMapEnabled!==n&&(this._DecalMapEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(n){this._AmbientTextureEnabled!==n&&(this._AmbientTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(n){this._OpacityTextureEnabled!==n&&(this._OpacityTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(n){this._ReflectionTextureEnabled!==n&&(this._ReflectionTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(n){this._EmissiveTextureEnabled!==n&&(this._EmissiveTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(n){this._SpecularTextureEnabled!==n&&(this._SpecularTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(n){this._BumpTextureEnabled!==n&&(this._BumpTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(n){this._LightmapTextureEnabled!==n&&(this._LightmapTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(n){this._RefractionTextureEnabled!==n&&(this._RefractionTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(n){this._ColorGradingTextureEnabled!==n&&(this._ColorGradingTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(n){this._FresnelEnabled!==n&&(this._FresnelEnabled=n,c.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(n){this._ClearCoatTextureEnabled!==n&&(this._ClearCoatTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(n){this._ClearCoatBumpTextureEnabled!==n&&(this._ClearCoatBumpTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(n){this._ClearCoatTintTextureEnabled!==n&&(this._ClearCoatTintTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(n){this._SheenTextureEnabled!==n&&(this._SheenTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(n){this._AnisotropicTextureEnabled!==n&&(this._AnisotropicTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(n){this._ThicknessTextureEnabled!==n&&(this._ThicknessTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(n){this._RefractionIntensityTextureEnabled!==n&&(this._RefractionIntensityTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(n){this._TranslucencyIntensityTextureEnabled!==n&&(this._TranslucencyIntensityTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(n){this._TranslucencyColorTextureEnabled!==n&&(this._TranslucencyColorTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(n){this._IridescenceTextureEnabled!==n&&(this._IridescenceTextureEnabled=n,c.b.MarkAllMaterialsAsDirty(1))}}K._DiffuseTextureEnabled=!0,K._BaseWeightTextureEnabled=!0,K._BaseDiffuseRoughnessTextureEnabled=!0,K._DetailTextureEnabled=!0,K._DecalMapEnabled=!0,K._AmbientTextureEnabled=!0,K._OpacityTextureEnabled=!0,K._ReflectionTextureEnabled=!0,K._EmissiveTextureEnabled=!0,K._SpecularTextureEnabled=!0,K._BumpTextureEnabled=!0,K._LightmapTextureEnabled=!0,K._RefractionTextureEnabled=!0,K._ColorGradingTextureEnabled=!0,K._FresnelEnabled=!0,K._ClearCoatTextureEnabled=!0,K._ClearCoatBumpTextureEnabled=!0,K._ClearCoatTintTextureEnabled=!0,K._SheenTextureEnabled=!0,K._AnisotropicTextureEnabled=!0,K._ThicknessTextureEnabled=!0,K._RefractionIntensityTextureEnabled=!0,K._TranslucencyIntensityTextureEnabled=!0,K._TranslucencyColorTextureEnabled=!0,K._IridescenceTextureEnabled=!0},12267:(n,k,T)=>{"use strict";T.d(k,{b:()=>Q});var c,K=T(730);!function(n){n[n.Zero=0]="Zero",n[n.One=1]="One",n[n.MaxViewZ=2]="MaxViewZ"}(c||(c={}));class Q{static CreateConfiguration(n){return Q._Configurations[n]={defines:{},previousWorldMatrices:{},previousViewProjection:K.d.Zero(),currentViewProjection:K.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},Q._Configurations[n]}static DeleteConfiguration(n){delete Q._Configurations[n]}static GetConfiguration(n){return Q._Configurations[n]}static AddUniformsAndSamplers(n,k){n.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(n,k){for(const T of k)if(T.si)for(const k of T.si)k._removeDrawWrapper(n)}static PrepareDefines(n,k,T){if(!T._arePrePassDirty)return;const c=Q._Configurations[n];if(!c)return;T.PREPASS=!0,T.PREPASS_COLOR=!1,T.PREPASS_COLOR_INDEX=-1;let K=0;for(let G=0;G<Q.GeometryTextureDescriptions.length;G++){const n=Q.GeometryTextureDescriptions[G],k=n.define,w=n.defineIndex,E=c.defines[w];void 0!==E?(T[k]=!0,T[w]=E,K++):(T[k]=!1,delete T[w])}T.SCENE_MRT_COUNT=K,T.BONES_VELOCITY_ENABLED=k.useBones&&k.computeBonesUsingShaders&&k.skeleton&&!k.skeleton.isUsingTextureForMatrices&&-1===c.excludedSkinnedMesh.indexOf(k)}static Bind(n,k,T,c,K){const G=Q._Configurations[n];if(!G)return;const w=T.va(),E=w.getEngine();if(G.reverseCulling&&E.setStateCullFaceType(w._mirroredCameraPosition?K.cullBackFaces:!K.cullBackFaces),(void 0!==G.defines.PREPASS_VELOCITY_INDEX||void 0!==G.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(G.previousWorldMatrices[T.uniqueId]||(G.previousWorldMatrices[T.uniqueId]=c.clone()),G.previousViewProjection||(G.previousViewProjection=w.getTransformMatrix().clone(),G.currentViewProjection=w.getTransformMatrix().clone()),G.currentViewProjection.updateFlag!==w.getTransformMatrix().updateFlag?(G.lastUpdateFrameId=E.frameId,G.previousViewProjection.p(G.currentViewProjection),G.currentViewProjection.p(w.getTransformMatrix())):G.lastUpdateFrameId!==E.frameId&&(G.lastUpdateFrameId=E.frameId,G.previousViewProjection.p(G.currentViewProjection)),k.setMatrix("previousWorld",G.previousWorldMatrices[T.uniqueId]),k.setMatrix("previousViewProjection",G.previousViewProjection),G.previousWorldMatrices[T.uniqueId]=c.clone(),T.useBones&&T.computeBonesUsingShaders&&T.skeleton)){const n=T.skeleton;if(!n.isUsingTextureForMatrices||-1===k.getUniformIndex("boneTextureWidth")){const c=n.getTransformMatrices(T);c&&(G.previousBones[T.uniqueId]||(G.previousBones[T.uniqueId]=c.slice()),k.setMatrices("mPreviousBones",G.previousBones[T.uniqueId]),G.previousBones[T.uniqueId].set(c))}}}}Q.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],Q._Configurations={}},12262:(n,k,T)=>{"use strict";T.d(k,{d:()=>C});var c=T(706),K=T(712),Q=T(915),G=T(588),w=T(601),E=T(624);const I=new RegExp("^([gimus]+)!");class S{constructor(n){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=n,this._scene=n.va(),this._engine=this._scene.getEngine()}_addPlugin(n){for(let c=0;c<this._plugins.length;++c)if(this._plugins[c].name===n.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!n.isCompatible(this._material.shaderLanguage))throw`The plugin "${n.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const k=n.getClassName();S._MaterialPluginClassToMainDefine[k]||(S._MaterialPluginClassToMainDefine[k]="MATERIALPLUGIN_"+ ++S._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(n,k)=>this._handlePluginEvent(n,k),this._plugins.push(n),this._plugins.sort(((n,k)=>n.priority-k.priority)),this._codeInjectionPoints={};const T={};T[S._MaterialPluginClassToMainDefine[k]]={type:"boolean",default:!0};for(const c of this._plugins)c.collectDefines(T),this._collectPointNames("vertex",c.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",c.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=T,!0}_activatePlugin(n){-1===this._activePlugins.indexOf(n)&&(this._activePlugins.push(n),this._activePlugins.sort(((n,k)=>n.priority-k.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),n.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(n),this._activePluginsForExtraEvents.sort(((n,k)=>n.priority-k.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(n){for(let k=0;k<this._plugins.length;++k)if(this._plugins[k].name===n)return this._plugins[k];return null}_handlePluginEventIsReadyForSubMesh(n){let k=!0;for(const T of this._activePlugins)k=k&&T.isReadyForSubMesh(n.defines,this._scene,this._engine,n.subMesh);n.isReadyForSubMesh=k}_handlePluginEventPrepareDefinesBeforeAttributes(n){for(const k of this._activePlugins)k.prepareDefinesBeforeAttributes(n.defines,this._scene,n.mesh)}_handlePluginEventPrepareDefines(n){for(const k of this._activePlugins)k.prepareDefines(n.defines,this._scene,n.mesh)}_handlePluginEventHardBindForSubMesh(n){for(const k of this._activePluginsForExtraEvents)k.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,n.subMesh)}_handlePluginEventBindForSubMesh(n){for(const k of this._activePlugins)k.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,n.subMesh)}_handlePluginEventHasRenderTargetTextures(n){let k=!1;for(const T of this._activePluginsForExtraEvents)if(k=T.hasRenderTargetTextures(),k)break;n.hasRenderTargetTextures=k}_handlePluginEventFillRenderTargetTextures(n){for(const k of this._activePluginsForExtraEvents)k.fillRenderTargetTextures(n.renderTargets)}_handlePluginEvent(n,k){switch(n){case 512:{const n=k;for(const k of this._activePlugins)k.getActiveTextures(n.activeTextures);break}case 256:{const n=k;for(const k of this._activePlugins)k.getAnimatables(n.animatables);break}case 1024:{const n=k;let T=!1;for(const k of this._activePlugins)if(T=k.hasTexture(n.texture),T)break;n.hasTexture=T;break}case 2:{const n=k;for(const k of this._plugins)k.dispose(n.forceDisposeTextures);break}case 4:k.defineNames=this._defineNamesFromPlugins;break;case 128:{const n=k;for(const k of this._activePlugins)n.fallbackRank=k.addFallbacks(n.defines,n.fallbacks,n.fallbackRank),k.getAttributes(n.attributes,this._scene,n.mesh);this._uniformList.length>0&&n.uniforms.push(...this._uniformList),this._samplerList.length>0&&n.samplers.push(...this._samplerList),this._uboList.length>0&&n.uniformBuffersNames.push(...this._uboList),n.customCode=this._injectCustomCode(n,n.customCode);break}case 8:{const n=k;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const T=1===this._material.shaderLanguage;for(const k of this._plugins){const c=k.getUniforms(this._material.shaderLanguage);if(c){if(c.ubo)for(const k of c.ubo){if(k.size&&k.type){const c=k.arraySize??0;if(n.ubo.addUniform(k.name,k.size,c),T){let n;switch(k.type){case"mat4":n="mat4x4f";break;case"float":n="f32";break;default:n=`${k.type}f`}this._uboDeclaration+=c>0?`uniform ${k.name}: array<${n}, ${c}>;\n`:`uniform ${k.name}: ${n};\n`}else this._uboDeclaration+=`${k.type} ${k.name}${c>0?`[${c}]`:""};\n`}this._uniformList.push(k.name)}c.vertex&&(this._vertexDeclaration+=c.vertex+"\n"),c.fragment&&(this._fragmentDeclaration+=c.fragment+"\n")}k.getSamplers(this._samplerList),k.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(n,k){if(k)for(const T in k)this._codeInjectionPoints[n]||(this._codeInjectionPoints[n]={}),this._codeInjectionPoints[n][T]=!0}_injectCustomCode(n,k){return(T,c)=>{var K;k&&(c=k(T,c)),this._uboDeclaration&&(c=c.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(c=c.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(c=c.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const Q=null===(K=this._codeInjectionPoints)||void 0===K?void 0:K[T];if(!Q)return c;let G=null;for(let k in Q){let K="";for(const c of this._activePlugins){var S;let Q=null===(S=c.getCustomCode(T,this._material.shaderLanguage))||void 0===S?void 0:S[k];if(Q){if(c.resolveIncludes){if(null===G){const k=0;G={defines:[],indexParameters:n.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:E.b.GetShadersRepository(k),includesShadersStore:E.b.GetIncludesShadersStore(k),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}G.isFragment="fragment"===T,(0,w.g)(Q,G,(n=>Q=n))}K+=Q+"\n"}}if(K.length>0)if("!"===k.charAt(0)){k=k.substring(1);let n="g";if("!"===k.charAt(0))n="",k=k.substring(1);else{const T=I.exec(k);T&&T.length>=2&&(n=T[1],k=k.substring(n.length+1))}n.indexOf("g")<0&&(n+="g");const T=c,Q=new RegExp(k,n);let G=Q.exec(T);for(;null!==G;){let n=K;for(let k=0;k<G.length;++k)n=n.replace("$"+k,G[k]);c=c.replace(G[0],n),G=Q.exec(T)}}else{const n="#define "+k;c=c.replace(n,"\n"+K+"\n"+n)}}return c}}}S._MaterialPluginClassToMainDefine={},S._MaterialPluginCounter=0,G.e.OnEnginesDisposedObservable.add((()=>{H()}));const P=[];let W=!1,J=null;function H(){P.length=0,W=!1,Q.d.OnEventObservable.remove(J),J=null}var s=T(760),b=T(675);class C{isCompatible(n){return 0===n}_enable(n){n&&this._pluginManager._activatePlugin(this)}constructor(n,k,T,c){let K=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=n,this.name=k,this.priority=T,this.resolveIncludes=G,n.pluginManager||(n.pluginManager=new S(n),n.Gi.add((()=>{n.pluginManager=void 0}))),this._pluginDefineNames=c,this._pluginManager=n.pluginManager,K&&this._pluginManager._addPlugin(this),Q&&this._enable(!0),this.markAllDefinesAsDirty=n._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(n,k,T,c){return!0}hardBindForSubMesh(n,k,T,c){}bindForSubMesh(n,k,T,c){}dispose(n){}getCustomCode(n){return null}collectDefines(n){if(this._pluginDefineNames)for(const k of Object.keys(this._pluginDefineNames)){if("_"===k[0])continue;const T=typeof this._pluginDefineNames[k];n[k]={type:"number"===T?"number":"string"===T?"string":"boolean"===T?"boolean":"object",default:this._pluginDefineNames[k]}}}prepareDefinesBeforeAttributes(n,k,T){}prepareDefines(n,k,T){}hasTexture(n){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(n){}getActiveTextures(n){}getAnimatables(n){}addFallbacks(n,k,T){return T}getSamplers(n){}getAttributes(n,k,T){}getUniformBuffersNames(n){}getUniforms(){return{}}copyTo(n){s.d.Clone((()=>n),this)}serialize(){return s.d.Serialize(this)}parse(n,k,T){s.d.Parse((()=>this),n,k,T)}}(0,c.e)([(0,K.K)()],C.prototype,"name",void 0),(0,c.e)([(0,K.K)()],C.prototype,"priority",void 0),(0,c.e)([(0,K.K)()],C.prototype,"resolveIncludes",void 0),(0,c.e)([(0,K.K)()],C.prototype,"registerForExtraEvents",void 0),(0,b.f)("BABYLON.MaterialPluginBase",C)},12230:(n,k,T)=>{"use strict";T.d(k,{c:()=>c});class c{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(n){n.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(n){}bindForSubMesh(n,k,T,c,K){if(k.prePassRenderer&&k.prePassRenderer.enabled&&k.prePassRenderer.currentRTisSceneRT&&(-1!==k.prePassRenderer.getIndex(2)||-1!==k.prePassRenderer.getIndex(11))){this.previousWorldMatrices[T.uniqueId]||(this.previousWorldMatrices[T.uniqueId]=c.clone()),this.previousViewProjection||(this.previousViewProjection=k.getTransformMatrix().clone(),this.currentViewProjection=k.getTransformMatrix().clone());const K=k.getEngine();this.currentViewProjection.updateFlag!==k.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=K.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(k.getTransformMatrix())):this._lastUpdateFrameId!==K.frameId&&(this._lastUpdateFrameId=K.frameId,this.previousViewProjection.p(this.currentViewProjection)),n.setMatrix("previousWorld",this.previousWorldMatrices[T.uniqueId]),n.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[T.uniqueId]=c.clone()}}}},12239:(n,k,T)=>{"use strict";T.d(k,{c:()=>Q});var c=T(730),K=T(915);class Q extends K.d{constructor(n,k){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(n,k,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new c.d,this._storeEffectOnSubMeshes=T}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(n,k){return!!n&&(!this._storeEffectOnSubMeshes||(!n.si||0===n.si.length||this.isReadyForSubMesh(n,n.si[0],k)))}_isReadyForSubMesh(n){const k=n.materialDefines;return!(this.checkReadyOnEveryCall||!n.effect||!k||k._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(n){this._activeEffect.setMatrix("world",n)}bindOnlyNormalMatrix(n){this._activeEffect.setMatrix("normalMatrix",n)}bind(n,k){k&&this.bindForSubMesh(n,k,k.si[0])}_afterBind(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;super._afterBind(n,k,T),this.va()._cachedEffect=k,T?T._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return T._drawWrapper._forceRebindOnNextCall||n.isCachedMaterialInvalid(this,k,c)}dispose(n,k,T){this._activeEffect=void 0,super.dispose(n,k,T)}}},12221:(n,k,T)=>{"use strict";T.d(k,{e:()=>v});var c=T(706),K=T(712),Q=T(727),G=T(2475),w=T(764),E=T(781),I=T(12230),S=T(2483),P=T(915),W=T(12237),J=T(12239),H=T(2334),s=T(675),b=T(12242),C=T(12251),z=T(12254),r=T(929),q=T(919),O=T(760),u=T(12267);const f={effect:null,subMesh:null};class A extends W.b{constructor(n){super(n),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(n){const k=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const T of k)this[T]=T===n}}class v extends J.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(n){this._attachImageProcessingConfiguration(n),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(n){n!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=n||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(n){this.imageProcessingConfiguration.colorCurvesEnabled=n}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(n){this.imageProcessingConfiguration.colorGradingEnabled=n}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(n){this._imageProcessingConfiguration.toneMappingEnabled=n}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(n){this._imageProcessingConfiguration.exposure=n}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(n){this._imageProcessingConfiguration.contrast=n}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(n){this._imageProcessingConfiguration.colorGradingTexture=n}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(n){this._imageProcessingConfiguration.colorCurves=n}get canRenderToMRT(){return!0}constructor(n,k){super(n,k,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||v.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new w.e(0,0,0),this.diffuseColor=new w.e(1,1,1),this.specularColor=new w.e(1,1,1),this.emissiveColor=new w.e(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new Q.g(16),this._globalAmbientColor=new w.e(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new z.e(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new I.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),v.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),v.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(v.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(v.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"cb"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===P.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Bj&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==P.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Bj||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(n,k){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const K=k._drawWrapper;if(K.effect&&this.isFrozen&&K._wasPreviouslyReady&&K._wasPreviouslyUsingInstances===c)return!0;k.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),k.materialDefines=new A(this._eventInfo.defineNames));const Q=this.va(),G=k.materialDefines;if(this._isReadyForSubMesh(k))return!0;const w=Q.getEngine();G._needNormals=(0,q.I)(Q,n,G,!0,this._maxSimultaneousLights,this._disableLighting),(0,q.R)(Q,G);const P=this.needAlphaBlendingForMesh(n)&&this.va().useOrderIndependentTransparency;if((0,q.U)(Q,G,this.canRenderToMRT&&!P),(0,q.S)(Q,G,P),u.b.PrepareDefines(w.currentRenderPassId,n,G),G._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,G._needUVs=!1;for(let n=1;n<=6;++n)G["MAINUV"+n]=!1;if(Q.texturesEnabled){if(G.DIFFUSEDIRECTUV=0,G.BUMPDIRECTUV=0,G.AMBIENTDIRECTUV=0,G.OPACITYDIRECTUV=0,G.EMISSIVEDIRECTUV=0,G.SPECULARDIRECTUV=0,G.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&v.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,q.J)(this._diffuseTexture,G,"DIFFUSE")}else G.DIFFUSE=!1;if(this._ambientTexture&&v.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,q.J)(this._ambientTexture,G,"AMBIENT")}else G.AMBIENT=!1;if(this._opacityTexture&&v.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,q.J)(this._opacityTexture,G,"OPACITY"),G.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else G.OPACITY=!1;if(this._reflectionTexture&&v.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(G._needNormals=!0,G.REFLECTION=!0,G.ROUGHNESS=this._roughness>0,G.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,G.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===H.b.INVCUBIC_MODE,G.REFLECTIONMAP_3D=this._reflectionTexture.isCube,G.REFLECTIONMAP_OPPOSITEZ=G.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,G.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case H.b.EXPLICIT_MODE:G.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case H.b.PLANAR_MODE:G.setReflectionMode("REFLECTIONMAP_PLANAR");break;case H.b.PROJECTION_MODE:G.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case H.b.SKYBOX_MODE:G.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case H.b.SPHERICAL_MODE:G.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case H.b.EQUIRECTANGULAR_MODE:G.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case H.b.FIXED_EQUIRECTANGULAR_MODE:G.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case H.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:G.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case H.b.CUBIC_MODE:case H.b.INVCUBIC_MODE:default:G.setReflectionMode("REFLECTIONMAP_CUBIC")}G.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else G.REFLECTION=!1,G.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&v.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,q.J)(this._emissiveTexture,G,"EMISSIVE")}else G.EMISSIVE=!1;if(this._lightmapTexture&&v.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,q.J)(this._lightmapTexture,G,"LIGHTMAP"),G.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,G.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else G.LIGHTMAP=!1;if(this._specularTexture&&v.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,q.J)(this._specularTexture,G,"SPECULAR"),G.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else G.SPECULAR=!1;if(Q.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&v.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,q.J)(this._bumpTexture,G,"BUMP"),G.PARALLAX=this._useParallax,G.PARALLAX_RHS=Q.useRightHandedSystem,G.PARALLAXOCCLUSION=this._useParallaxOcclusion,G.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else G.BUMP=!1,G.PARALLAX=!1,G.PARALLAX_RHS=!1,G.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&v.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;G._needUVs=!0,G.REFRACTION=!0,G.REFRACTIONMAP_3D=this._refractionTexture.isCube,G.RGBDREFRACTION=this._refractionTexture.isRGBD,G.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else G.REFRACTION=!1;G.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else G.DIFFUSE=!1,G.AMBIENT=!1,G.OPACITY=!1,G.REFLECTION=!1,G.EMISSIVE=!1,G.LIGHTMAP=!1,G.BUMP=!1,G.REFRACTION=!1;G.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),G.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,G.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,G.SPECULAROVERALPHA=this._useSpecularOverAlpha,G.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,G.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,G.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(n)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=G,this._eventInfo.subMesh=k,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(G._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(G),G.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,G.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(G._areFresnelDirty&&(v.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(G.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,G.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,G.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,G.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,G.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,G.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,G._needNormals=!0,G.FRESNEL=!0):G.FRESNEL=!1),G.AREALIGHTUSED)for(let T=0;T<n.lightSources.length;T++)if(!n.lightSources[T]._isReady())return!1;(0,q.N)(n,Q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(n),G,this._applyDecalMapAfterDetailMap),(0,q.F)(Q,w,this,G,c,null,k.getRenderingMesh().hasThinInstances),this._eventInfo.defines=G,this._eventInfo.mesh=n,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,q.C)(n,G,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let W=!1;if(G.isDirty){const c=G._areLightsDisposed;G.markAsProcessed();const K=new C.c;G.REFLECTION&&K.addFallback(0,"REFLECTION"),G.SPECULAR&&K.addFallback(0,"SPECULAR"),G.BUMP&&K.addFallback(0,"BUMP"),G.PARALLAX&&K.addFallback(1,"PARALLAX"),G.PARALLAX_RHS&&K.addFallback(1,"PARALLAX_RHS"),G.PARALLAXOCCLUSION&&K.addFallback(0,"PARALLAXOCCLUSION"),G.SPECULAROVERALPHA&&K.addFallback(0,"SPECULAROVERALPHA"),G.FOG&&K.addFallback(1,"FOG"),G.POINTSIZE&&K.addFallback(0,"POINTSIZE"),G.LOGARITHMICDEPTH&&K.addFallback(0,"LOGARITHMICDEPTH"),(0,q.n)(G,K,this._maxSimultaneousLights),G.SPECULARTERM&&K.addFallback(0,"SPECULARTERM"),G.DIFFUSEFRESNEL&&K.addFallback(1,"DIFFUSEFRESNEL"),G.OPACITYFRESNEL&&K.addFallback(2,"OPACITYFRESNEL"),G.REFLECTIONFRESNEL&&K.addFallback(3,"REFLECTIONFRESNEL"),G.EMISSIVEFRESNEL&&K.addFallback(4,"EMISSIVEFRESNEL"),G.FRESNEL&&K.addFallback(4,"FRESNEL"),G.MULTIVIEW&&K.addFallback(0,"MULTIVIEW");const P=[E.f.PositionKind];G.NORMAL&&P.push(E.f.NormalKind),G.TANGENT&&P.push(E.f.TangentKind);for(let n=1;n<=6;++n)G["UV"+n]&&P.push(`uv${1===n?"":n}`);G.VERTEXCOLOR&&P.push(E.f.ColorKind),(0,q.u)(P,n,G,K),(0,q.w)(P,G),(0,q.x)(P,n,G),(0,q.r)(P,n,G);let J="default";const H=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],s=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],b=["Material","Scene","Mesh"],z={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:G.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=K,this._eventInfo.fallbackRank=0,this._eventInfo.defines=G,this._eventInfo.uniforms=H,this._eventInfo.attributes=P,this._eventInfo.samplers=s,this._eventInfo.uniformBuffersNames=b,this._eventInfo.customCode=void 0,this._eventInfo.mesh=n,this._eventInfo.indexParameters=z,this._callbackPluginEventGeneric(128,this._eventInfo),u.b.AddUniformsAndSamplers(H,s),I.c.AddUniforms(H),I.c.AddSamplers(s),S.e&&(S.e.PrepareUniforms(H,G),S.e.PrepareSamplers(s,G)),(0,q.V)({uniformsNames:H,uniformBuffersNames:b,samplers:s,defines:G,maxSimultaneousLights:this._maxSimultaneousLights}),(0,r.c)(H);const O={};this.customShaderNameResolve&&(J=this.customShaderNameResolve(J,H,b,s,G,P,O));const A=G.toString(),v=k.effect;let F=Q.getEngine().createEffect(J,{attributes:P,uniformsNames:H,uniformBuffersNames:b,samplers:s,defines:A,fallbacks:K,onCompiled:this.onCompiled,onError:this.onError,indexParameters:z,processFinalCode:O.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:G.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([T.e(41),T.e(39)]).then(T.bind(T,13423)),Promise.all([T.e(42),T.e(40)]).then(T.bind(T,13588))]):await Promise.all([Promise.all([T.e(45),T.e(44)]).then(T.bind(T,13677)),Promise.all([T.e(47),T.e(46)]).then(T.bind(T,13831))]),this._shadersLoaded=!0}},w);if(this._eventInfo.customCode=void 0,F)if(this._onEffectCreatedObservable&&(f.effect=F,f.subMesh=k,this._onEffectCreatedObservable.notifyObservers(f)),this.allowShaderHotSwapping&&v&&!F.isReady()){if(F=v,G.markAsUnprocessed(),W=this.isFrozen,c)return G._areLightsDisposed=!0,!1}else Q.resetCachedMaterial(),k.setEffect(F,G,this._materialContext)}return!(!k.effect||!k.effect.isReady())&&(G._renderId=Q.getRenderId(),K._wasPreviouslyReady=!W,K._wasPreviouslyUsingInstances=c,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const n=this._uniformBuffer;n.addUniform("diffuseLeftColor",4),n.addUniform("diffuseRightColor",4),n.addUniform("opacityParts",4),n.addUniform("reflectionLeftColor",4),n.addUniform("reflectionRightColor",4),n.addUniform("refractionLeftColor",4),n.addUniform("refractionRightColor",4),n.addUniform("emissiveLeftColor",4),n.addUniform("emissiveRightColor",4),n.addUniform("vDiffuseInfos",2),n.addUniform("vAmbientInfos",2),n.addUniform("vOpacityInfos",2),n.addUniform("vReflectionInfos",2),n.addUniform("vReflectionPosition",3),n.addUniform("vReflectionSize",3),n.addUniform("vEmissiveInfos",2),n.addUniform("vLightmapInfos",2),n.addUniform("vSpecularInfos",2),n.addUniform("vBumpInfos",3),n.addUniform("diffuseMatrix",16),n.addUniform("ambientMatrix",16),n.addUniform("opacityMatrix",16),n.addUniform("reflectionMatrix",16),n.addUniform("emissiveMatrix",16),n.addUniform("lightmapMatrix",16),n.addUniform("specularMatrix",16),n.addUniform("bumpMatrix",16),n.addUniform("vTangentSpaceParams",2),n.addUniform("pointSize",1),n.addUniform("alphaCutOff",1),n.addUniform("refractionMatrix",16),n.addUniform("vRefractionInfos",4),n.addUniform("vRefractionPosition",3),n.addUniform("vRefractionSize",3),n.addUniform("vSpecularColor",4),n.addUniform("vEmissiveColor",3),n.addUniform("vDiffuseColor",4),n.addUniform("vAmbientColor",3),n.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(n,k,T){const c=this.va(),K=T.materialDefines;if(!K)return;const Q=T.effect;if(!Q)return;this._activeEffect=Q,k.getMeshUniformBuffer().bindToEffect(Q,"Mesh"),k.transferToEffect(n),this._uniformBuffer.bindToEffect(Q,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,c,k,n,this.isFrozen),u.b.Bind(c.getEngine().currentRenderPassId,this._activeEffect,k,n,this);const E=c.activeCamera;E?this._uniformBuffer.updateFloat4("cameraInfo",E.ri,E.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=T,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),K.OBJECTSPACE_NORMALMAP&&(n.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const I=this._mustRebind(c,Q,T,k.visibility);(0,q.b)(k,Q);const S=this._uniformBuffer;if(I){if(this.bindViewProjection(Q),!S.useUbo||!this.isFrozen||!S.isSync||T._drawWrapper._forceRebindOnNextCall){if(v.FresnelEnabled&&K.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(S.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),S.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&S.updateColor4("opacityParts",new w.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(S.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),S.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(S.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),S.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(S.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),S.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),c.texturesEnabled){if(this._diffuseTexture&&v.DiffuseTextureEnabled&&(S.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,q.m)(this._diffuseTexture,S,"diffuse")),this._ambientTexture&&v.AmbientTextureEnabled&&(S.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,q.m)(this._ambientTexture,S,"ambient")),this._opacityTexture&&v.OpacityTextureEnabled&&(S.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,q.m)(this._opacityTexture,S,"opacity")),this._hasAlphaChannel()&&S.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&v.ReflectionTextureEnabled){if(S.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),S.Vi("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const n=this._reflectionTexture;S.updateVector3("vReflectionPosition",n.boundingBoxPosition),S.updateVector3("vReflectionSize",n.boundingBoxSize)}}else S.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&v.EmissiveTextureEnabled&&(S.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,q.m)(this._emissiveTexture,S,"emissive")),this._lightmapTexture&&v.LightmapTextureEnabled&&(S.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,q.m)(this._lightmapTexture,S,"lightmap")),this._specularTexture&&v.SpecularTextureEnabled&&(S.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,q.m)(this._specularTexture,S,"specular")),this._bumpTexture&&c.getEngine().getCaps().standardDerivatives&&v.BumpTextureEnabled&&(S.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,q.m)(this._bumpTexture,S,"bump"),c._mirroredCameraPosition?S.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):S.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&v.RefractionTextureEnabled){let n=1;if(this._refractionTexture.isCube||(S.Vi("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(n=this._refractionTexture.depth)),S.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,n,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const n=this._refractionTexture;S.updateVector3("vRefractionPosition",n.boundingBoxPosition),S.updateVector3("vRefractionSize",n.boundingBoxSize)}}}this.pointsCloud&&S.updateFloat("pointSize",this.pointSize),S.updateColor4("vSpecularColor",this.specularColor,this.specularPower),S.updateColor3("vEmissiveColor",v.EmissiveTextureEnabled?this.emissiveColor:w.e.BlackReadOnly),S.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),c.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),S.updateColor3("vAmbientColor",this._globalAmbientColor)}c.texturesEnabled&&(this._diffuseTexture&&v.DiffuseTextureEnabled&&Q.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&v.AmbientTextureEnabled&&Q.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&v.OpacityTextureEnabled&&Q.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&v.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?Q.setTexture("reflectionCubeSampler",this._reflectionTexture):Q.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&v.EmissiveTextureEnabled&&Q.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&v.LightmapTextureEnabled&&Q.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&v.SpecularTextureEnabled&&Q.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&c.getEngine().getCaps().standardDerivatives&&v.BumpTextureEnabled&&Q.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&v.RefractionTextureEnabled&&(this._refractionTexture.isCube?Q.setTexture("refractionCubeSampler",this._refractionTexture):Q.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(k)&&this.va().depthPeelingRenderer.bind(Q),this._eventInfo.subMesh=T,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,r.f)(Q,this,c),this.bindEyePosition(Q)}else c.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(I||!this.isFrozen){var P;if(c.lightsEnabled&&!this._disableLighting&&(0,q.f)(c,k,Q,K,this._maxSimultaneousLights),(c.fogEnabled&&k.applyFog&&c.fogMode!==G.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||k.receiveShadows||K.PREPASS)&&this.bindView(Q),(0,q.c)(c,k,Q),K.NUM_MORPH_INFLUENCERS&&(0,q.k)(k,Q),K.BAKED_VERTEX_ANIMATION_TEXTURE)null===(P=k.bakedVertexAnimationManager)||void 0===P||P.bind(Q,K.INSTANCES);this.useLogarithmicDepth&&(0,q.j)(K,Q,c),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(k,this._activeEffect,T),S.update()}getAnimatables(){const n=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&n.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&n.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&n.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&n.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&n.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&n.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&n.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&n.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&n.push(this._refractionTexture),n}getActiveTextures(){const n=super.getActiveTextures();return this._diffuseTexture&&n.push(this._diffuseTexture),this._ambientTexture&&n.push(this._ambientTexture),this._opacityTexture&&n.push(this._opacityTexture),this._reflectionTexture&&n.push(this._reflectionTexture),this._emissiveTexture&&n.push(this._emissiveTexture),this._specularTexture&&n.push(this._specularTexture),this._bumpTexture&&n.push(this._bumpTexture),this._lightmapTexture&&n.push(this._lightmapTexture),this._refractionTexture&&n.push(this._refractionTexture),n}hasTexture(n){return!!super.hasTexture(n)||(this._diffuseTexture===n||(this._ambientTexture===n||(this._opacityTexture===n||(this._reflectionTexture===n||(this._emissiveTexture===n||(this._specularTexture===n||(this._bumpTexture===n||(this._lightmapTexture===n||this._refractionTexture===n))))))))}dispose(n,k){var T,c,K,Q,G,w,E,I,S;k&&(null===(T=this._diffuseTexture)||void 0===T||T.dispose(),null===(c=this._ambientTexture)||void 0===c||c.dispose(),null===(K=this._opacityTexture)||void 0===K||K.dispose(),null===(Q=this._reflectionTexture)||void 0===Q||Q.dispose(),null===(G=this._emissiveTexture)||void 0===G||G.dispose(),null===(w=this._specularTexture)||void 0===w||w.dispose(),null===(E=this._bumpTexture)||void 0===E||E.dispose(),null===(I=this._lightmapTexture)||void 0===I||I.dispose(),null===(S=this._refractionTexture)||void 0===S||S.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(n,k)}clone(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const c=O.d.Clone((()=>new v(n,this.va())),this,{cloneTexturesOnlyOnce:k});return c.name=n,c.id=n,this.stencil.copyTo(c.stencil),this._clonePlugins(c,T),c}static Parse(n,k,T){const c=O.d.Parse((()=>new v(n.name,k)),n,k,T);return n.stencil&&c.stencil.parse(n.stencil,k,T),P.d._ParsePlugins(n,c,k,T),c}static get DiffuseTextureEnabled(){return b.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(n){b.e.DiffuseTextureEnabled=n}static get DetailTextureEnabled(){return b.e.DetailTextureEnabled}static set DetailTextureEnabled(n){b.e.DetailTextureEnabled=n}static get AmbientTextureEnabled(){return b.e.AmbientTextureEnabled}static set AmbientTextureEnabled(n){b.e.AmbientTextureEnabled=n}static get OpacityTextureEnabled(){return b.e.OpacityTextureEnabled}static set OpacityTextureEnabled(n){b.e.OpacityTextureEnabled=n}static get ReflectionTextureEnabled(){return b.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(n){b.e.ReflectionTextureEnabled=n}static get EmissiveTextureEnabled(){return b.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(n){b.e.EmissiveTextureEnabled=n}static get SpecularTextureEnabled(){return b.e.SpecularTextureEnabled}static set SpecularTextureEnabled(n){b.e.SpecularTextureEnabled=n}static get BumpTextureEnabled(){return b.e.BumpTextureEnabled}static set BumpTextureEnabled(n){b.e.BumpTextureEnabled=n}static get LightmapTextureEnabled(){return b.e.LightmapTextureEnabled}static set LightmapTextureEnabled(n){b.e.LightmapTextureEnabled=n}static get RefractionTextureEnabled(){return b.e.RefractionTextureEnabled}static set RefractionTextureEnabled(n){b.e.RefractionTextureEnabled=n}static get ColorGradingTextureEnabled(){return b.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(n){b.e.ColorGradingTextureEnabled=n}static get FresnelEnabled(){return b.e.FresnelEnabled}static set FresnelEnabled(n){b.e.FresnelEnabled=n}}v.ForceGLSL=!1,(0,c.e)([(0,K.D)("diffuseTexture")],v.prototype,"_diffuseTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"diffuseTexture",void 0),(0,c.e)([(0,K.D)("ambientTexture")],v.prototype,"_ambientTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTexture",void 0),(0,c.e)([(0,K.D)("opacityTexture")],v.prototype,"_opacityTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"opacityTexture",void 0),(0,c.e)([(0,K.D)("reflectionTexture")],v.prototype,"_reflectionTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionTexture",void 0),(0,c.e)([(0,K.D)("emissiveTexture")],v.prototype,"_emissiveTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveTexture",void 0),(0,c.e)([(0,K.D)("specularTexture")],v.prototype,"_specularTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"specularTexture",void 0),(0,c.e)([(0,K.D)("bumpTexture")],v.prototype,"_bumpTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,c.e)([(0,K.D)("lightmapTexture")],v.prototype,"_lightmapTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"lightmapTexture",void 0),(0,c.e)([(0,K.D)("refractionTexture")],v.prototype,"_refractionTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"refractionTexture",void 0),(0,c.e)([(0,K.h)("ambient")],v.prototype,"ambientColor",void 0),(0,c.e)([(0,K.h)("diffuse")],v.prototype,"diffuseColor",void 0),(0,c.e)([(0,K.h)("specular")],v.prototype,"specularColor",void 0),(0,c.e)([(0,K.h)("emissive")],v.prototype,"emissiveColor",void 0),(0,c.e)([(0,K.K)()],v.prototype,"specularPower",void 0),(0,c.e)([(0,K.K)("useAlphaFromDiffuseTexture")],v.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"useAlphaFromDiffuseTexture",void 0),(0,c.e)([(0,K.K)("useEmissiveAsIllumination")],v.prototype,"_useEmissiveAsIllumination",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useEmissiveAsIllumination",void 0),(0,c.e)([(0,K.K)("linkEmissiveWithDiffuse")],v.prototype,"_linkEmissiveWithDiffuse",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkEmissiveWithDiffuse",void 0),(0,c.e)([(0,K.K)("useSpecularOverAlpha")],v.prototype,"_useSpecularOverAlpha",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useSpecularOverAlpha",void 0),(0,c.e)([(0,K.K)("useReflectionOverAlpha")],v.prototype,"_useReflectionOverAlpha",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useReflectionOverAlpha",void 0),(0,c.e)([(0,K.K)("disableLighting")],v.prototype,"_disableLighting",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsLightsDirty")],v.prototype,"disableLighting",void 0),(0,c.e)([(0,K.K)("useObjectSpaceNormalMap")],v.prototype,"_useObjectSpaceNormalMap",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useObjectSpaceNormalMap",void 0),(0,c.e)([(0,K.K)("useParallax")],v.prototype,"_useParallax",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallax",void 0),(0,c.e)([(0,K.K)("useParallaxOcclusion")],v.prototype,"_useParallaxOcclusion",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallaxOcclusion",void 0),(0,c.e)([(0,K.K)()],v.prototype,"parallaxScaleBias",void 0),(0,c.e)([(0,K.K)("roughness")],v.prototype,"_roughness",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,c.e)([(0,K.K)()],v.prototype,"indexOfRefraction",void 0),(0,c.e)([(0,K.K)()],v.prototype,"invertRefractionY",void 0),(0,c.e)([(0,K.K)()],v.prototype,"alphaCutOff",void 0),(0,c.e)([(0,K.K)("useLightmapAsShadowmap")],v.prototype,"_useLightmapAsShadowmap",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLightmapAsShadowmap",void 0),(0,c.e)([(0,K.n)("diffuseFresnelParameters")],v.prototype,"_diffuseFresnelParameters",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"diffuseFresnelParameters",void 0),(0,c.e)([(0,K.n)("opacityFresnelParameters")],v.prototype,"_opacityFresnelParameters",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],v.prototype,"opacityFresnelParameters",void 0),(0,c.e)([(0,K.n)("reflectionFresnelParameters")],v.prototype,"_reflectionFresnelParameters",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"reflectionFresnelParameters",void 0),(0,c.e)([(0,K.n)("refractionFresnelParameters")],v.prototype,"_refractionFresnelParameters",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"refractionFresnelParameters",void 0),(0,c.e)([(0,K.n)("emissiveFresnelParameters")],v.prototype,"_emissiveFresnelParameters",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"emissiveFresnelParameters",void 0),(0,c.e)([(0,K.K)("useReflectionFresnelFromSpecular")],v.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsFresnelDirty")],v.prototype,"useReflectionFresnelFromSpecular",void 0),(0,c.e)([(0,K.K)("useGlossinessFromSpecularMapAlpha")],v.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,c.e)([(0,K.K)("maxSimultaneousLights")],v.prototype,"_maxSimultaneousLights",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsLightsDirty")],v.prototype,"maxSimultaneousLights",void 0),(0,c.e)([(0,K.K)("invertNormalMapX")],v.prototype,"_invertNormalMapX",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapX",void 0),(0,c.e)([(0,K.K)("invertNormalMapY")],v.prototype,"_invertNormalMapY",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapY",void 0),(0,c.e)([(0,K.K)("twoSidedLighting")],v.prototype,"_twoSidedLighting",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"twoSidedLighting",void 0),(0,c.e)([(0,K.K)("applyDecalMapAfterDetailMap")],v.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,c.e)([(0,K.d)("_markAllSubMeshesAsMiscDirty")],v.prototype,"applyDecalMapAfterDetailMap",void 0),(0,s.f)("BABYLON.StandardMaterial",v),G.c.DefaultMaterialFactory=n=>new v("default material",n)},12454:(n,k,T)=>{"use strict";T.d(k,{e:()=>w,i:()=>E,j:()=>Q,l:()=>G});var c=T(747),K=T(730);function Q(n,k){return`{X: ${n.x.toFixed(k)} Y: ${n.y.toFixed(k)}}`}function G(n,k){return`{X: ${n._x.toFixed(k)} Y: ${n._y.toFixed(k)} Z: ${n._z.toFixed(k)}}`}function w(n,k){return 2*Math.acos((0,c.b)(K.h.Dot(n,k)))}function E(n,k){const T=new K.h;return function(n,k,T){const Q=K.o.Cross(n,k),G=Math.acos((0,c.b)(K.o.Dot(n,k),-1,1));K.h.RotationAxisToRef(Q,G,T)}(n,k,T),T}},12273:(n,k,T)=>{"use strict";T.d(k,{b:()=>I});var c=T(730),K=T(764),Q=T(532),G=T(798),w=T(871);T(12281);function E(n){let k=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const T=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Q=[];let E=[];const I=n.width||n.size||1,S=n.height||n.size||1,P=n.depth||n.size||1,W=n.wrap||!1;let J=void 0===n.topBaseAt?1:n.topBaseAt,H=void 0===n.bottomBaseAt?0:n.bottomBaseAt;J=(J+4)%4,H=(H+4)%4;let s=[2,0,3,1][J],b=[2,0,1,3][H],C=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(W){k=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],C=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let n=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],T=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const c=[17,18,19,16],K=[22,23,20,21];for(;s>0;)n.unshift(n.pop()),c.unshift(c.pop()),s--;for(;b>0;)T.unshift(T.pop()),K.unshift(K.pop()),b--;n=n.flat(),T=T.flat(),C=C.concat(n).concat(T),k.push(c[0],c[2],c[3],c[0],c[1],c[2]),k.push(K[0],K[2],K[3],K[0],K[1],K[2])}const z=[I/2,S/2,P/2];E=C.reduce(((n,k,T)=>n.concat(k*z[T%3])),[]);const r=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE,q=n.faceUV||new Array(6),O=n.faceColors,u=[];for(let G=0;G<6;G++)void 0===q[G]&&(q[G]=new c.p(0,0,1,1)),O&&void 0===O[G]&&(O[G]=new K.g(1,1,1,1));for(let c=0;c<6;c++)if(Q.push(q[c].z,w.e?1-q[c].w:q[c].w),Q.push(q[c].x,w.e?1-q[c].w:q[c].w),Q.push(q[c].x,w.e?1-q[c].y:q[c].y),Q.push(q[c].z,w.e?1-q[c].y:q[c].y),O)for(let n=0;n<4;n++)u.push(O[c].r,O[c].g,O[c].b,O[c].a);G.e._ComputeSides(r,E,k,T,Q,n.frontUVs,n.backUVs);const f=new G.e;if(f.indices=k,f.xa=E,f.ya=T,f.Aa=Q,O){const n=r===G.e.DOUBLESIDE?u.concat(u):u;f.za=n}return f}function I(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new Q.b(n,T);k.sideOrientation=Q.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return E(k).Ca(c,k.updatable),c}G.e.CreateBox=E,Q.b.CreateBox=function(n,k){return I(n,{size:k,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12281:(n,k,T)=>{"use strict";T.d(k,{e:()=>b,d:()=>z,i:()=>C});var c=T(730),K=T(764),Q=T(532),G=T(798),w=T(781);Q.b._GroundMeshParser=(n,k)=>E.Parse(n,k);class E extends Q.b{constructor(n,k){super(n,k),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=n,this._subdivisionsY=n,this.subdivide(n);const T=this;T.createOrUpdateSubmeshesOctree&&T.createOrUpdateSubmeshesOctree(k)}getHeightAtCoordinates(n,k){const T=this.getWorldMatrix(),K=c.l.Matrix[5];T.invertToRef(K);const Q=c.l.li[8];if(c.o.TransformCoordinatesFromFloatsToRef(n,0,k,K,Q),n=Q.x,k=Q.z,n<this._minX||n>=this._maxX||k<=this._minZ||k>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const G=this._getFacetAt(n,k),w=-(G.x*n+G.z*k+G.w)/G.y;return c.o.TransformCoordinatesFromFloatsToRef(0,w,0,T,Q),Q.y}getNormalAtCoordinates(n,k){const T=new c.o(0,1,0);return this.getNormalAtCoordinatesToRef(n,k,T),T}getNormalAtCoordinatesToRef(n,k,T){const K=this.getWorldMatrix(),Q=c.l.Matrix[5];K.invertToRef(Q);const G=c.l.li[8];if(c.o.TransformCoordinatesFromFloatsToRef(n,0,k,Q,G),n=G.x,k=G.z,n<this._minX||n>this._maxX||k<this._minZ||k>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(n,k);return c.o.TransformNormalFromFloatsToRef(w.x,w.y,w.z,K,T),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(n,k){const T=Math.floor((n+this._maxX)*this._subdivisionsX/this._width),c=Math.floor(-(k+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),K=this._heightQuads[c*this._subdivisionsX+T];let Q;return Q=k<K.slope.x*n+K.slope.y?K.facet1:K.facet2,Q}_initHeightQuads(){const n=this._subdivisionsX,k=this._subdivisionsY;this._heightQuads=[];for(let T=0;T<k;T++)for(let k=0;k<n;k++){const K={slope:c.m.Zero(),facet1:new c.p(0,0,0,0),facet2:new c.p(0,0,0,0)};this._heightQuads[T*n+k]=K}return this}_computeHeightQuads(){const n=this.getVerticesData(w.f.PositionKind);if(!n)return this;const k=c.l.li[3],T=c.l.li[2],K=c.l.li[1],Q=c.l.li[0],G=c.l.li[4],E=c.l.li[5],I=c.l.li[6],S=c.l.li[7],P=c.l.li[8];let W=0,J=0,H=0,s=0,b=0,C=0,z=0;const r=this._subdivisionsX,q=this._subdivisionsY;for(let w=0;w<q;w++)for(let q=0;q<r;q++){W=3*q,J=w*(r+1)*3,H=(w+1)*(r+1)*3,k.x=n[J+W],k.y=n[J+W+1],k.z=n[J+W+2],T.x=n[J+W+3],T.y=n[J+W+4],T.z=n[J+W+5],K.x=n[H+W],K.y=n[H+W+1],K.z=n[H+W+2],Q.x=n[H+W+3],Q.y=n[H+W+4],Q.z=n[H+W+5],s=(Q.z-k.z)/(Q.x-k.x),b=k.z-s*k.x,T.subtractToRef(k,G),K.subtractToRef(k,E),Q.subtractToRef(k,I),c.o.CrossToRef(I,E,S),c.o.CrossToRef(G,I,P),S.normalize(),P.normalize(),C=-(S.x*k.x+S.y*k.y+S.z*k.z),z=-(P.x*T.x+P.y*T.y+P.z*T.z);const O=this._heightQuads[w*r+q];O.slope.di(s,b),O.facet1.di(S.x,S.y,S.z,C),O.facet2.di(P.x,P.y,P.z,z)}return this}serialize(n){super.serialize(n),n.subdivisionsX=this._subdivisionsX,n.subdivisionsY=this._subdivisionsY,n.minX=this._minX,n.maxX=this._maxX,n.ri=this._minZ,n.maxZ=this._maxZ,n.width=this._width,n.height=this._height}static Parse(n,k){const T=new E(n.name,k);return T._subdivisionsX=n.subdivisionsX||1,T._subdivisionsY=n.subdivisionsY||1,T._minX=n.minX,T._maxX=n.maxX,T._minZ=n.ri,T._maxZ=n.maxZ,T._width=n.width,T._height=n.height,T}}var I=T(542),S=T(588),P=T(736),W=T(871);function J(n){const k=[],T=[],K=[],Q=[];let w,E;const I=n.width||n.size||1,S=n.height||n.size||1,P=0|(n.subdivisionsX||n.subdivisions||1),J=0|(n.subdivisionsY||n.subdivisions||1);for(w=0;w<=J;w++)for(E=0;E<=P;E++){const n=new c.o(E*I/P-I/2,0,(J-w)*S/J-S/2),k=new c.o(0,1,0);T.push(n.x,n.y,n.z),K.push(k.x,k.y,k.z),Q.push(E/P,W.e?w/J:1-w/J)}for(w=0;w<J;w++)for(E=0;E<P;E++)k.push(E+1+(w+1)*(P+1)),k.push(E+1+w*(P+1)),k.push(E+w*(P+1)),k.push(E+(w+1)*(P+1)),k.push(E+1+(w+1)*(P+1)),k.push(E+w*(P+1));const H=new G.e;return H.indices=k,H.xa=T,H.ya=K,H.Aa=Q,H}function H(n){const k=void 0!==n.xmin&&null!==n.xmin?n.xmin:-1,T=void 0!==n.zmin&&null!==n.zmin?n.zmin:-1,K=void 0!==n.xmax&&null!==n.xmax?n.xmax:1,Q=void 0!==n.zmax&&null!==n.zmax?n.zmax:1,w=n.subdivisions||{w:1,h:1},E=n.precision||{w:1,h:1},I=[],S=[],P=[],W=[];let J,H,s,b;w.h=w.h<1?1:w.h,w.w=w.w<1?1:w.w,E.w=E.w<1?1:E.w,E.h=E.h<1?1:E.h;const C=(K-k)/w.w,z=(Q-T)/w.h;function r(n,k,T,K){const Q=S.length/3,G=E.w+1;for(J=0;J<E.h;J++)for(H=0;H<E.w;H++){const n=[Q+H+J*G,Q+(H+1)+J*G,Q+(H+1)+(J+1)*G,Q+H+(J+1)*G];I.push(n[1]),I.push(n[2]),I.push(n[3]),I.push(n[0]),I.push(n[1]),I.push(n[3])}const w=c.o.Zero(),s=new c.o(0,1,0);for(J=0;J<=E.h;J++)for(w.z=J*(K-k)/E.h+k,H=0;H<=E.w;H++)w.x=H*(T-n)/E.w+n,w.y=0,S.push(w.x,w.y,w.z),P.push(s.x,s.y,s.z),W.push(H/E.w,J/E.h)}for(s=0;s<w.h;s++)for(b=0;b<w.w;b++)r(k+b*C,T+s*z,k+(b+1)*C,T+(s+1)*z);const q=new G.e;return q.indices=I,q.xa=S,q.ya=P,q.Aa=W,q}function s(n){const k=[],T=[],Q=[],w=[];let E,I;const S=n.colorFilter||new K.e(.3,.59,.11),W=n.alphaFilter||0;let J=!1;if(n.minHeight>n.maxHeight){J=!0;const k=n.maxHeight;n.maxHeight=n.minHeight,n.minHeight=k}for(E=0;E<=n.subdivisions;E++)for(I=0;I<=n.subdivisions;I++){const k=new c.o(I*n.width/n.subdivisions-n.width/2,0,(n.subdivisions-E)*n.height/n.subdivisions-n.height/2),K=4*(((k.x+n.width/2)/n.width*(n.bufferWidth-1)|0)+((1-(k.z+n.height/2)/n.height)*(n.bufferHeight-1)|0)*n.bufferWidth);let G=n.buffer[K]/255,H=n.buffer[K+1]/255,s=n.buffer[K+2]/255;const b=n.buffer[K+3]/255;J&&(G=1-G,H=1-H,s=1-s);const C=G*S.r+H*S.g+s*S.b;k.y=b>=W?n.minHeight+(n.maxHeight-n.minHeight)*C:n.minHeight-P.b,n.heightBuffer&&(n.heightBuffer[E*(n.subdivisions+1)+I]=k.y),T.push(k.x,k.y,k.z),Q.push(0,0,0),w.push(I/n.subdivisions,1-E/n.subdivisions)}for(E=0;E<n.subdivisions;E++)for(I=0;I<n.subdivisions;I++){const c=I+1+(E+1)*(n.subdivisions+1),K=I+1+E*(n.subdivisions+1),Q=I+E*(n.subdivisions+1),G=I+(E+1)*(n.subdivisions+1),w=T[3*c+1]>=n.minHeight,S=T[3*K+1]>=n.minHeight,P=T[3*Q+1]>=n.minHeight;w&&S&&P&&(k.push(c),k.push(K),k.push(Q));T[3*G+1]>=n.minHeight&&w&&P&&(k.push(G),k.push(c),k.push(Q))}G.e.ComputeNormals(T,k,Q);const H=new G.e;return H.indices=k,H.xa=T,H.ya=Q,H.Aa=w,H}function b(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=new E(n,arguments.length>2?arguments[2]:void 0);T._setReady(!1),T._subdivisionsX=k.subdivisionsX||k.subdivisions||1,T._subdivisionsY=k.subdivisionsY||k.subdivisions||1,T._width=k.width||1,T._height=k.height||1,T._maxX=T._width/2,T._maxZ=T._height/2,T._minX=-T._maxX,T._minZ=-T._maxZ;return J(k).Ca(T,k.updatable),T._setReady(!0),T}function C(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new Q.b(n,T);return H(k).Ca(c,k.updatable),c}function z(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=T.width||10,G=T.height||10,w=T.subdivisions||1,P=T.minHeight||0,W=T.maxHeight||1,J=T.colorFilter||new K.e(.3,.59,.11),H=T.alphaFilter||0,b=T.updatable,C=T.onReady;c=c||S.e.LastCreatedScene;const z=new E(n,c);let r;z._subdivisionsX=w,z._subdivisionsY=w,z._width=Q,z._height=G,z._maxX=z._width/2,z._maxZ=z._height/2,z._minX=-z._maxX,z._minZ=-z._maxZ,z._setReady(!1),T.passHeightBufferInCallback&&(r=new Float32Array((w+1)*(w+1)));const q=(n,k,T)=>{s({width:Q,height:G,subdivisions:w,minHeight:P,maxHeight:W,colorFilter:J,buffer:n,bufferWidth:k,bufferHeight:T,alphaFilter:H,heightBuffer:r}).Ca(z,b),C&&C(z,r),z._setReady(!0)};if("string"===typeof k){const n=n=>{var k;const T=n.width,K=n.height;if(c.u)return;const Q=null===(k=c)||void 0===k?void 0:k.getEngine().resizeImageBitmap(n,T,K);q(Q,T,K)};I.e.LoadImage(k,n,T.onError?T.onError:()=>{},c.offlineProvider)}else q(k.data,k.width,k.height);return z}G.e.CreateGround=J,G.e.CreateTiledGround=H,G.e.CreateGroundFromHeightMap=s,Q.b.CreateGround=(n,k,T,c,K,Q)=>b(n,{width:k,height:T,subdivisions:c,updatable:Q},K),Q.b.CreateTiledGround=(n,k,T,c,K,Q,G,w,E)=>C(n,{xmin:k,zmin:T,xmax:c,zmax:K,subdivisions:Q,precision:G,updatable:E},w),Q.b.CreateGroundFromHeightMap=(n,k,T,c,K,Q,G,w,E,I,S)=>z(n,k,{width:T,height:c,subdivisions:K,minHeight:Q,maxHeight:G,updatable:E,onReady:I,alphaFilter:S},w)},12991:(n,k,T)=>{"use strict";T.d(k,{b:()=>g,e:()=>m,i:()=>x});var c=T(730),K=T(532),Q=T(798),G=T(764),w=T(781),E=T(12741),I=T(915),S=T(760),P=T(2475),W=T(2334),J=T(675),H=T(12251),s=T(582),b=T(12239),C=T(588),z=T(929),r=T(919);const q={effect:null,subMesh:null};class O extends b.c{constructor(n,k,T){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(n,k,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new c.d,this._cachedWorldViewProjectionMatrix=new c.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=T,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Pi","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...K}}get shaderPath(){return this._shaderPath}set shaderPath(n){this._shaderPath=n}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(n){-1===this._options.uniforms.indexOf(n)&&this._options.uniforms.push(n)}setTexture(n,k){return-1===this._options.samplers.indexOf(n)&&this._options.samplers.push(n),this._textures[n]=k,this}removeTexture(n){delete this._textures[n]}setTextureArray(n,k){return-1===this._options.samplers.indexOf(n)&&this._options.samplers.push(n),this._checkUniform(n),this._textureArrays[n]=k,this}setExternalTexture(n,k){return-1===this._options.externalTextures.indexOf(n)&&this._options.externalTextures.push(n),this._externalTextures[n]=k,this}setFloat(n,k){return this._checkUniform(n),this._floats[n]=k,this}setInt(n,k){return this._checkUniform(n),this._ints[n]=k,this}setUInt(n,k){return this._checkUniform(n),this._uints[n]=k,this}setFloats(n,k){return this._checkUniform(n),this._floatsArrays[n]=k,this}setColor3(n,k){return this._checkUniform(n),this._colors3[n]=k,this}setColor3Array(n,k){return this._checkUniform(n),this._colors3Arrays[n]=k.reduce(((n,k)=>(n.push(k.r,k.g,k.b),n)),[]),this}setColor4(n,k){return this._checkUniform(n),this._colors4[n]=k,this}setColor4Array(n,k){return this._checkUniform(n),this._colors4Arrays[n]=k.reduce(((n,k)=>(n.push(k.r,k.g,k.b,k.a),n)),[]),this}setVector2(n,k){return this._checkUniform(n),this._vectors2[n]=k,this}setVector3(n,k){return this._checkUniform(n),this._vectors3[n]=k,this}setVector4(n,k){return this._checkUniform(n),this._vectors4[n]=k,this}setQuaternion(n,k){return this._checkUniform(n),this._quaternions[n]=k,this}setQuaternionArray(n,k){return this._checkUniform(n),this._quaternionsArrays[n]=k.reduce(((n,k)=>(k.toArray(n,n.length),n)),[]),this}setMatrix(n,k){return this._checkUniform(n),this._matrices[n]=k,this}setMatrices(n,k){this._checkUniform(n);const T=new Float32Array(16*k.length);for(let c=0;c<k.length;c++){k[c].copyToArray(T,16*c)}return this._matrixArrays[n]=T,this}setMatrix3x3(n,k){return this._checkUniform(n),this._matrices3x3[n]=k,this}setMatrix2x2(n,k){return this._checkUniform(n),this._matrices2x2[n]=k,this}setArray2(n,k){return this._checkUniform(n),this._vectors2Arrays[n]=k,this}setArray3(n,k){return this._checkUniform(n),this._vectors3Arrays[n]=k,this}setArray4(n,k){return this._checkUniform(n),this._vectors4Arrays[n]=k,this}setUniformBuffer(n,k){return-1===this._options.uniformBuffers.indexOf(n)&&this._options.uniformBuffers.push(n),this._uniformBuffers[n]=k,this}setTextureSampler(n,k){return-1===this._options.samplerObjects.indexOf(n)&&this._options.samplerObjects.push(n),this._textureSamplers[n]=k,this}setStorageBuffer(n,k){return-1===this._options.storageBuffers.indexOf(n)&&this._options.storageBuffers.push(n),this._storageBuffers[n]=k,this}setDefine(n,k){const T=n.trimEnd()+" ",c=this.options.defines.findIndex((k=>k===n||k.startsWith(T)));return c>=0&&this.options.defines.splice(c,1),("boolean"!==typeof k||k)&&this.options.defines.push(T+k),this}isReadyForSubMesh(n,k,T){return this.isReady(n,T,k)}isReady(n,k,T){var c;const K=T&&this._storeEffectOnSubMeshes;if(this.isFrozen){const n=K?T._drawWrapper:this._drawWrapper;if(n.effect&&n._wasPreviouslyReady&&n._wasPreviouslyUsingInstances===k)return!0}const Q=this.va(),G=Q.getEngine(),E=[],I=[];let S=null,W=this._shaderPath,J=this._options.uniforms,s=this._options.uniformBuffers,b=this._options.samplers;G.getCaps().multiview&&Q.activeCamera&&Q.activeCamera.outputRenderTarget&&Q.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,E.push("#define MULTIVIEW"),-1!==J.indexOf("viewProjection")&&-1===J.indexOf("viewProjectionR")&&J.push("viewProjectionR"));for(let w=0;w<this._options.defines.length;w++){const n=0===this._options.defines[w].indexOf("#define")?this._options.defines[w]:`#define ${this._options.defines[w]}`;E.push(n)}for(let w=0;w<this._options.attributes.length;w++)I.push(this._options.attributes[w]);if(n&&n.isVerticesDataPresent(w.f.ColorKind)&&(-1===I.indexOf(w.f.ColorKind)&&I.push(w.f.ColorKind),E.push("#define VERTEXCOLOR")),k&&(E.push("#define INSTANCES"),(0,r.W)(I,this._materialHelperNeedsPreviousMatrices),null!==n&&void 0!==n&&n.hasThinInstances&&(E.push("#define THIN_INSTANCES"),n&&n.isVerticesDataPresent(w.f.ColorInstanceKind)&&(I.push(w.f.ColorInstanceKind),E.push("#define INSTANCESCOLOR")))),n&&n.useBones&&n.computeBonesUsingShaders&&n.skeleton){I.push(w.f.MatricesIndicesKind),I.push(w.f.MatricesWeightsKind),n.numBoneInfluencers>4&&(I.push(w.f.MatricesIndicesExtraKind),I.push(w.f.MatricesWeightsExtraKind));const k=n.skeleton;E.push("#define NUM_BONE_INFLUENCERS "+n.numBoneInfluencers),S=new H.c,S.addCPUSkinningFallback(0,n),k.isUsingTextureForMatrices?(E.push("#define BONETEXTURE"),-1===J.indexOf("boneTextureWidth")&&J.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(E.push("#define BonesPerMesh "+(k.bones.length+1)),-1===J.indexOf("mBones")&&J.push("mBones"))}else E.push("#define NUM_BONE_INFLUENCERS 0");let C=0;const O=n?n.morphTargetManager:null;if(O){const k=-1!==E.indexOf("#define UV1"),T=-1!==E.indexOf("#define UV2"),c=-1!==E.indexOf("#define TANGENT"),K=-1!==E.indexOf("#define NORMAL"),Q=-1!==E.indexOf("#define VERTEXCOLOR");C=(0,r.A)(O,E,I,n,!0,K,c,k,T,Q),O.isUsingTextureForTargets&&(-1===J.indexOf("morphTargetTextureIndices")&&J.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),C>0&&(J=J.slice(),J.push("morphTargetInfluences"),J.push("morphTargetCount"),J.push("morphTargetTextureInfo"),J.push("morphTargetTextureIndices"))}else E.push("#define NUM_MORPH_INFLUENCERS 0");if(n){const k=n.bakedVertexAnimationManager;k&&k.isEnabled&&(E.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===J.indexOf("bakedVertexAnimationSettings")&&J.push("bakedVertexAnimationSettings"),-1===J.indexOf("bakedVertexAnimationTextureSizeInverted")&&J.push("bakedVertexAnimationTextureSizeInverted"),-1===J.indexOf("bakedVertexAnimationTime")&&J.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,r.r)(I,n,E)}for(const w in this._textures)if(!this._textures[w].isReady())return!1;n&&this.needAlphaTestingForMesh(n)&&E.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,z.c)(J),(0,z.i)(this,Q,E)),Q.fogEnabled&&null!==n&&void 0!==n&&n.applyFog&&Q.fogMode!==P.c.FOGMODE_NONE&&(E.push("#define FOG"),-1===J.indexOf("view")&&J.push("view"),-1===J.indexOf("vFogInfos")&&J.push("vFogInfos"),-1===J.indexOf("vFogColor")&&J.push("vFogColor")),this._useLogarithmicDepth&&(E.push("#define LOGARITHMICDEPTH"),-1===J.indexOf("logarithmicDepthConstant")&&J.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(J=J.slice(),s=s.slice(),b=b.slice(),W=this.customShaderNameResolve(this.name,J,s,b,E,I));const u=K?T._getDrawWrapper(void 0,!0):this._drawWrapper,f=(null===u||void 0===u?void 0:u.effect)??null,A=(null===u||void 0===u?void 0:u.defines)??null,v=E.join("\n");let F=f;return A!==v&&(F=G.createEffect(W,{attributes:I,uniformsNames:J,uniformBuffersNames:s,samplers:b,defines:v,fallbacks:S,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:C},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},G),K?T.setEffect(F,v,this._materialContext):u&&u.setEffect(F,v),this._onEffectCreatedObservable&&(q.effect=F,q.subMesh=T??(null===n||void 0===n?void 0:n.si[0])??null,this._onEffectCreatedObservable.notifyObservers(q))),u._wasPreviouslyUsingInstances=!!k,!(null===(c=F)||void 0===c||!c.isReady())&&(f!==F&&Q.resetCachedMaterial(),u._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(n,k){const T=k??this.getEffect();if(!T)return;const c=this._options.uniforms;-1!==c.indexOf("world")&&T.setMatrix("world",n);const K=this.va();-1!==c.indexOf("worldView")&&(n.multiplyToRef(K.getViewMatrix(),this._cachedWorldViewMatrix),T.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==c.indexOf("worldViewProjection")&&(n.multiplyToRef(K.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),T.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==c.indexOf("view")&&T.setMatrix("view",K.getViewMatrix())}bindForSubMesh(n,k,T){var c;this.bind(n,k,null===(c=T._drawWrapperOverride)||void 0===c?void 0:c.effect,T)}bind(n,k,T,c){const K=c&&this._storeEffectOnSubMeshes,Q=T??(K?c.effect:this.getEffect());if(!Q)return;const G=this.va();this._activeEffect=Q,this.bindOnlyWorldMatrix(n,T);const w=this._options.uniformBuffers;let E=!1;if(Q&&w&&w.length>0&&G.getEngine().supportsUniformBuffers)for(let P=0;P<w.length;++P){switch(w[P]){case"Mesh":k&&(k.getMeshUniformBuffer().bindToEffect(Q,"Mesh"),k.transferToEffect(n));break;case"Scene":(0,r.l)(Q,G.getSceneUniformBuffer()),G.finalizeSceneUbo(),E=!0}}const I=k&&K?this._mustRebind(G,Q,c,k.visibility):G.getCachedMaterial()!==this;if(Q&&I){let n;for(n in E||-1===this._options.uniforms.indexOf("view")||Q.setMatrix("view",G.getViewMatrix()),E||-1===this._options.uniforms.indexOf("projection")||Q.setMatrix("projection",G.getProjectionMatrix()),E||-1===this._options.uniforms.indexOf("viewProjection")||(Q.setMatrix("viewProjection",G.getTransformMatrix()),this._multiview&&Q.setMatrix("viewProjectionR",G._transformMatrixR)),G.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&Q.setVector3("cameraPosition",G.activeCamera.globalPosition),(0,r.b)(k,Q),(0,z.f)(Q,this,G),this._useLogarithmicDepth&&(0,r.j)(K?c.materialDefines:Q.defines,Q,G),k&&(0,r.c)(G,k,Q),this._textures)Q.setTexture(n,this._textures[n]);for(n in this._textureArrays)Q.setTextureArray(n,this._textureArrays[n]);for(n in this._ints)Q.setInt(n,this._ints[n]);for(n in this._uints)Q.setUInt(n,this._uints[n]);for(n in this._floats)Q.setFloat(n,this._floats[n]);for(n in this._floatsArrays)Q.setArray(n,this._floatsArrays[n]);for(n in this._colors3)Q.setColor3(n,this._colors3[n]);for(n in this._colors3Arrays)Q.setArray3(n,this._colors3Arrays[n]);for(n in this._colors4){const k=this._colors4[n];Q.setFloat4(n,k.r,k.g,k.b,k.a)}for(n in this._colors4Arrays)Q.setArray4(n,this._colors4Arrays[n]);for(n in this._vectors2)Q.setVector2(n,this._vectors2[n]);for(n in this._vectors3)Q.setVector3(n,this._vectors3[n]);for(n in this._vectors4)Q.setVector4(n,this._vectors4[n]);for(n in this._quaternions)Q.setQuaternion(n,this._quaternions[n]);for(n in this._matrices)Q.setMatrix(n,this._matrices[n]);for(n in this._matrixArrays)Q.setMatrices(n,this._matrixArrays[n]);for(n in this._matrices3x3)Q.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)Q.setMatrix2x2(n,this._matrices2x2[n]);for(n in this._vectors2Arrays)Q.setArray2(n,this._vectors2Arrays[n]);for(n in this._vectors3Arrays)Q.setArray3(n,this._vectors3Arrays[n]);for(n in this._vectors4Arrays)Q.setArray4(n,this._vectors4Arrays[n]);for(n in this._quaternionsArrays)Q.setArray4(n,this._quaternionsArrays[n]);for(n in this._uniformBuffers){const k=this._uniformBuffers[n].getBuffer();k&&Q.bindUniformBuffer(k,n)}const T=G.getEngine(),w=T.setExternalTexture;if(w)for(n in this._externalTextures)w.call(T,n,this._externalTextures[n]);const I=T.setTextureSampler;if(I)for(n in this._textureSamplers)I.call(T,n,this._textureSamplers[n]);const S=T.setStorageBuffer;if(S)for(n in this._storageBuffers)S.call(T,n,this._storageBuffers[n])}if(Q&&k&&(I||!this.isFrozen)){(0,r.k)(k,Q),k.morphTargetManager&&k.morphTargetManager.isUsingTextureForTargets&&k.morphTargetManager._bind(Q);const n=k.bakedVertexAnimationManager;if(n&&n.isEnabled){var S;const n=K?c._drawWrapper:this._drawWrapper;null===(S=k.bakedVertexAnimationManager)||void 0===S||S.bind(Q,!!n._wasPreviouslyUsingInstances)}}this._afterBind(k,Q,c)}getActiveTextures(){const n=super.getActiveTextures();for(const k in this._textures)n.push(this._textures[k]);for(const k in this._textureArrays){const T=this._textureArrays[k];for(let k=0;k<T.length;k++)n.push(T[k])}return n}hasTexture(n){if(super.hasTexture(n))return!0;for(const k in this._textures)if(this._textures[k]===n)return!0;for(const k in this._textureArrays){const T=this._textureArrays[k];for(let k=0;k<T.length;k++)if(T[k]===n)return!0}return!1}clone(n){const k=S.d.Clone((()=>new O(n,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);k.name=n,k.id=n,"object"===typeof k._shaderPath&&(k._shaderPath={...k._shaderPath}),this._options={...this._options};const T=Object.keys(this._options);for(const c of T){const n=this._options[c];Array.isArray(n)&&(this._options[c]=n.slice(0))}this.stencil.copyTo(k.stencil);for(const c in this._textures)k.setTexture(c,this._textures[c]);for(const c in this._textureArrays)k.setTextureArray(c,this._textureArrays[c]);for(const c in this._externalTextures)k.setExternalTexture(c,this._externalTextures[c]);for(const c in this._ints)k.setInt(c,this._ints[c]);for(const c in this._uints)k.setUInt(c,this._uints[c]);for(const c in this._floats)k.setFloat(c,this._floats[c]);for(const c in this._floatsArrays)k.setFloats(c,this._floatsArrays[c]);for(const c in this._colors3)k.setColor3(c,this._colors3[c]);for(const c in this._colors3Arrays)k._colors3Arrays[c]=this._colors3Arrays[c];for(const c in this._colors4)k.setColor4(c,this._colors4[c]);for(const c in this._colors4Arrays)k._colors4Arrays[c]=this._colors4Arrays[c];for(const c in this._vectors2)k.setVector2(c,this._vectors2[c]);for(const c in this._vectors3)k.setVector3(c,this._vectors3[c]);for(const c in this._vectors4)k.setVector4(c,this._vectors4[c]);for(const c in this._quaternions)k.setQuaternion(c,this._quaternions[c]);for(const c in this._quaternionsArrays)k._quaternionsArrays[c]=this._quaternionsArrays[c];for(const c in this._matrices)k.setMatrix(c,this._matrices[c]);for(const c in this._matrixArrays)k._matrixArrays[c]=this._matrixArrays[c].slice();for(const c in this._matrices3x3)k.setMatrix3x3(c,this._matrices3x3[c]);for(const c in this._matrices2x2)k.setMatrix2x2(c,this._matrices2x2[c]);for(const c in this._vectors2Arrays)k.setArray2(c,this._vectors2Arrays[c]);for(const c in this._vectors3Arrays)k.setArray3(c,this._vectors3Arrays[c]);for(const c in this._vectors4Arrays)k.setArray4(c,this._vectors4Arrays[c]);for(const c in this._uniformBuffers)k.setUniformBuffer(c,this._uniformBuffers[c]);for(const c in this._textureSamplers)k.setTextureSampler(c,this._textureSamplers[c]);for(const c in this._storageBuffers)k.setStorageBuffer(c,this._storageBuffers[c]);return k}dispose(n,k,T){if(k){let n;for(n in this._textures)this._textures[n].dispose();for(n in this._textureArrays){const k=this._textureArrays[n];for(let n=0;n<k.length;n++)k[n].dispose()}}this._textures={},super.dispose(n,k,T)}serialize(){const n=S.d.Serialize(this);let k;for(k in n.customType="BABYLON.ShaderMaterial",n.uniqueId=this.uniqueId,n.options=this._options,n.shaderPath=this._shaderPath,n.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,n.stencil=this.stencil.serialize(),n.textures={},this._textures)n.textures[k]=this._textures[k].serialize();for(k in n.textureArrays={},this._textureArrays){n.textureArrays[k]=[];const T=this._textureArrays[k];for(let c=0;c<T.length;c++)n.textureArrays[k].push(T[c].serialize())}for(k in n.ints={},this._ints)n.ints[k]=this._ints[k];for(k in n.uints={},this._uints)n.uints[k]=this._uints[k];for(k in n.floats={},this._floats)n.floats[k]=this._floats[k];for(k in n.floatsArrays={},this._floatsArrays)n.floatsArrays[k]=this._floatsArrays[k];for(k in n.colors3={},this._colors3){const T=this._colors3[k];n.colors3[k]=[T.r,T.g,T.b]}for(k in n.colors3Arrays={},this._colors3Arrays)n.colors3Arrays[k]=this._colors3Arrays[k];for(k in n.colors4={},this._colors4){const T=this._colors4[k];n.colors4[k]=[T.r,T.g,T.b,T.a]}for(k in n.colors4Arrays={},this._colors4Arrays)n.colors4Arrays[k]=this._colors4Arrays[k];for(k in n.vectors2={},this._vectors2){const T=this._vectors2[k];n.vectors2[k]=[T.x,T.y]}for(k in n.vectors3={},this._vectors3){const T=this._vectors3[k];n.vectors3[k]=[T.x,T.y,T.z]}for(k in n.vectors4={},this._vectors4){const T=this._vectors4[k];n.vectors4[k]=[T.x,T.y,T.z,T.w]}for(k in n.quaternions={},this._quaternions)n.quaternions[k]=this._quaternions[k].wi();for(k in n.matrices={},this._matrices)n.matrices[k]=this._matrices[k].wi();for(k in n.matrixArray={},this._matrixArrays)n.matrixArray[k]=this._matrixArrays[k];for(k in n.matrices3x3={},this._matrices3x3)n.matrices3x3[k]=this._matrices3x3[k];for(k in n.matrices2x2={},this._matrices2x2)n.matrices2x2[k]=this._matrices2x2[k];for(k in n.vectors2Arrays={},this._vectors2Arrays)n.vectors2Arrays[k]=this._vectors2Arrays[k];for(k in n.vectors3Arrays={},this._vectors3Arrays)n.vectors3Arrays[k]=this._vectors3Arrays[k];for(k in n.vectors4Arrays={},this._vectors4Arrays)n.vectors4Arrays[k]=this._vectors4Arrays[k];for(k in n.quaternionsArrays={},this._quaternionsArrays)n.quaternionsArrays[k]=this._quaternionsArrays[k];return n}static Parse(n,k,T){const K=S.d.Parse((()=>new O(n.name,k,n.shaderPath,n.options,n.storeEffectOnSubMeshes)),n,k,T);let Q;for(Q in n.stencil&&K.stencil.parse(n.stencil,k,T),n.textures)K.setTexture(Q,W.b.Parse(n.textures[Q],k,T));for(Q in n.textureArrays){const c=n.textureArrays[Q],G=[];for(let n=0;n<c.length;n++)G.push(W.b.Parse(c[n],k,T));K.setTextureArray(Q,G)}for(Q in n.ints)K.setInt(Q,n.ints[Q]);for(Q in n.uints)K.setUInt(Q,n.uints[Q]);for(Q in n.floats)K.setFloat(Q,n.floats[Q]);for(Q in n.floatsArrays)K.setFloats(Q,n.floatsArrays[Q]);for(Q in n.colors3){const k=n.colors3[Q];K.setColor3(Q,{r:k[0],g:k[1],b:k[2]})}for(Q in n.colors3Arrays){const k=n.colors3Arrays[Q].reduce(((n,k,T)=>(T%3===0?n.push([k]):n[n.length-1].push(k),n)),[]).map((n=>({r:n[0],g:n[1],b:n[2]})));K.setColor3Array(Q,k)}for(Q in n.colors4){const k=n.colors4[Q];K.setColor4(Q,{r:k[0],g:k[1],b:k[2],a:k[3]})}for(Q in n.colors4Arrays){const k=n.colors4Arrays[Q].reduce(((n,k,T)=>(T%4===0?n.push([k]):n[n.length-1].push(k),n)),[]).map((n=>({r:n[0],g:n[1],b:n[2],a:n[3]})));K.setColor4Array(Q,k)}for(Q in n.vectors2){const k=n.vectors2[Q];K.setVector2(Q,{x:k[0],y:k[1]})}for(Q in n.vectors3){const k=n.vectors3[Q];K.setVector3(Q,{x:k[0],y:k[1],z:k[2]})}for(Q in n.vectors4){const k=n.vectors4[Q];K.setVector4(Q,{x:k[0],y:k[1],z:k[2],w:k[3]})}for(Q in n.quaternions)K.setQuaternion(Q,c.h.ji(n.quaternions[Q]));for(Q in n.matrices)K.setMatrix(Q,c.d.ji(n.matrices[Q]));for(Q in n.matrixArray)K._matrixArrays[Q]=new Float32Array(n.matrixArray[Q]);for(Q in n.matrices3x3)K.setMatrix3x3(Q,n.matrices3x3[Q]);for(Q in n.matrices2x2)K.setMatrix2x2(Q,n.matrices2x2[Q]);for(Q in n.vectors2Arrays)K.setArray2(Q,n.vectors2Arrays[Q]);for(Q in n.vectors3Arrays)K.setArray3(Q,n.vectors3Arrays[Q]);for(Q in n.vectors4Arrays)K.setArray4(Q,n.vectors4Arrays[Q]);for(Q in n.quaternionsArrays)K.setArray4(Q,n.quaternionsArrays[Q]);return K}static async ParseFromFileAsync(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((K,Q)=>{const G=new s.b;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const k=JSON.parse(G.responseText),Q=this.Parse(k,T||C.e.LastCreatedScene,c);n&&(Q.name=n),K(Q)}else Q("Unable to load the ShaderMaterial")})),G.open("GET",k),G.send()}))}static async ParseFromSnippetAsync(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((c,K)=>{const Q=new s.b;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const K=JSON.parse(JSON.parse(Q.responseText).jsonPayload),G=JSON.parse(K.shaderMaterial),w=this.Parse(G,k||C.e.LastCreatedScene,T);w.snippetId=n,c(w)}else K("Unable to load the snippet "+n)})),Q.open("GET",this.SnippetUrl+"/"+n.replace(/#/g,"/")),Q.send()}))}}O.SnippetUrl="https://snippet.babylonjs.com",O.CreateFromSnippetAsync=O.ParseFromSnippetAsync,(0,J.f)("BABYLON.ShaderMaterial",O),K.b._LinesMeshParser=(n,k)=>u.Parse(n,k);class u extends K.b{_isShaderMaterial(n){return"ShaderMaterial"===n.getClassName()}constructor(n){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7?arguments[7]:void 0;super(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k,arguments.length>4?arguments[4]:void 0),this.useVertexColor=c,this.useVertexAlpha=K,this.color=new G.e(1,1,1),this.alpha=1,this._shaderLanguage=0,k&&(this.color=k.color.clone(),this.alpha=k.alpha,this.useVertexColor=k.useVertexColor,this.useVertexAlpha=k.useVertexAlpha),this.intersectionThreshold=.1;const E={attributes:[w.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?E.defines.push("#define VERTEXALPHA"):E.needAlphaBlending=!1,this.useVertexColor?(E.defines.push("#define VERTEXCOLOR"),E.attributes.push(w.f.ColorKind)):(E.uniforms.push("color"),this._color4=new G.g),Q)this.material=Q;else{this.va().getEngine().isWebGPU&&!u.ForceGLSL&&(this._shaderLanguage=1),E.shaderLanguage=this._shaderLanguage,E.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([T.e(43).then(T.bind(T,14265)),T.e(102).then(T.bind(T,14268))]):await Promise.all([T.e(48).then(T.bind(T,14276)),T.e(103).then(T.bind(T,14279))])},this.material=new O("colorShader",this.va(),"color",E,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(n){this._lineMaterial=n,this._lineMaterial.fillMode=I.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(n){}_bind(n,k){if(!this._geometry)return this;const T=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(k,T):this._geometry._bind(k,T,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:n,g:k,b:T}=this.color;this._color4.set(n,k,T,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(n,k,T){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const c=this.va().getEngine();return this._unIndexed?c.drawArraysType(I.d.LineListDrawMode,n.verticesStart,n.verticesCount,T):c.drawElementsType(I.d.LineListDrawMode,n.indexStart,n.indexCount,T),this}dispose(n){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(n)}clone(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;if(k&&void 0===k._addToSceneRootNodes){const T=k;return T.source=this,new u(n,this.va(),T.parent,T.source,T.doNotCloneChildren)}return new u(n,this.va(),k,this,T)}createInstance(n){const k=new f(n,this);if(this.instancedBuffers){k.instancedBuffers={};for(const n in this.instancedBuffers)k.instancedBuffers[n]=this.instancedBuffers[n]}return k}serialize(n){super.serialize(n),n.color=this.color.wi(),n.alpha=this.alpha}static Parse(n,k){const T=new u(n.name,k);return T.color=G.e.ji(n.color),T.alpha=n.alpha,T}}u.ForceGLSL=!1;class f extends E.d{constructor(n,k){super(n,k),this.intersectionThreshold=k.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var A=T(556);function v(n){const k=[],T=[],c=n.lines,K=n.za,G=[];let w=0;for(let Q=0;Q<c.length;Q++){const n=c[Q];for(let c=0;c<n.length;c++){const{x:E,y:I,z:S}=n[c];if(T.push(E,I,S),K){const n=K[Q],{r:k,g:T,b:w,a:E}=n[c];G.push(k,T,w,E)}c>0&&(k.push(w-1),k.push(w)),w++}}const E=new Q.e;return E.indices=k,E.xa=T,K&&(E.za=G),E}function F(n){const k=n.dashSize||3,T=n.gapSize||1,K=n.dashNb||200,G=n.points,w=[],E=[],I=c.o.Zero();let S=0,P=0,W=0,J=0,H=0,s=0,b=0;for(b=0;b<G.length-1;b++)G[b+1].subtractToRef(G[b],I),S+=I.length();for(W=S/K,J=k*W/(k+T),b=0;b<G.length-1;b++){G[b+1].subtractToRef(G[b],I),P=Math.floor(I.length()/W),I.normalize();for(let n=0;n<P;n++)H=W*n,w.push(G[b].x+H*I.x,G[b].y+H*I.y,G[b].z+H*I.z),w.push(G[b].x+(H+J)*I.x,G[b].y+(H+J)*I.y,G[b].z+(H+J)*I.z),E.push(s,s+1),s+=2}const C=new Q.e;return C.xa=w,C.indices=E,C}function m(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=k.instance,K=k.lines,Q=k.za;if(c){const n=c.getVerticesData(w.f.PositionKind);let k,T;Q&&(k=c.getVerticesData(w.f.ColorKind));let G=0,E=0;for(let c=0;c<K.length;c++){const w=K[c];for(let K=0;K<w.length;K++)n[G]=w[K].x,n[G+1]=w[K].y,n[G+2]=w[K].z,Q&&k&&(T=Q[c],k[E]=T[K].r,k[E+1]=T[K].g,k[E+2]=T[K].b,k[E+3]=T[K].a,E+=4),G+=3}return c.updateVerticesData(w.f.PositionKind,n,!1,!1),Q&&k&&c.updateVerticesData(w.f.ColorKind,k,!1,!1),c.refreshBoundingInfo(),c}const G=new u(n,T,null,void 0,void 0,!!Q,k.useVertexAlpha,k.material);return v(k).Ca(G,k.updatable),G}function x(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=k.za?[k.za]:null;return m(n,{lines:[k.points],updatable:k.updatable,instance:k.instance,za:c,useVertexAlpha:k.useVertexAlpha,material:k.material},T)}function g(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=k.points,G=k.instance,w=k.gapSize||1,E=k.dashSize||3;if(G){const n=n=>{const k=c.o.Zero(),T=n.length/6;let K=0,w=0,E=0,I=0,S=0,P=0,W=0,J=0;for(W=0;W<Q.length-1;W++)Q[W+1].subtractToRef(Q[W],k),K+=k.length();E=K/T;const H=G._creationDataStorage.dashSize;for(I=H*E/(H+G._creationDataStorage.gapSize),W=0;W<Q.length-1;W++)for(Q[W+1].subtractToRef(Q[W],k),w=Math.floor(k.length()/E),k.normalize(),J=0;J<w&&P<n.length;)S=E*J,n[P]=Q[W].x+S*k.x,n[P+1]=Q[W].y+S*k.y,n[P+2]=Q[W].z+S*k.z,n[P+3]=Q[W].x+(S+I)*k.x,n[P+4]=Q[W].y+(S+I)*k.y,n[P+5]=Q[W].z+(S+I)*k.z,P+=6,J++;for(;P<n.length;)n[P]=Q[W].x,n[P+1]=Q[W].y,n[P+2]=Q[W].z,P+=3};return(k.dashNb||k.dashSize||k.gapSize||k.useVertexAlpha||k.material)&&A.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),G.updateMeshPositions(n,!1),G}const I=new u(n,T,null,void 0,void 0,void 0,k.useVertexAlpha,k.material);return F(k).Ca(I,k.updatable),I._creationDataStorage=new K.e,I._creationDataStorage.dashSize=E,I._creationDataStorage.gapSize=w,I}Q.e.CreateLineSystem=v,Q.e.CreateDashedLines=F,K.b.Bi=function(n,k){return x(n,{points:k,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},K.b.CreateDashedLines=function(n,k,T,c,K){return g(n,{points:k,dashSize:T,gapSize:c,dashNb:K,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12325:(n,k,T)=>{"use strict";T.d(k,{c:()=>w,d:()=>E});var c=T(532),K=T(798),Q=T(871);function G(n){const k=[],T=[],c=[],G=[],w=void 0!==n.width?n.width:void 0!==n.size?n.size:1,E=void 0!==n.height?n.height:void 0!==n.size?n.size:1,I=0===n.sideOrientation?0:n.sideOrientation||K.e.DEFAULTSIDE,S=w/2,P=E/2;T.push(-S,-P,0),c.push(0,0,-1),G.push(0,Q.e?1:0),T.push(S,-P,0),c.push(0,0,-1),G.push(1,Q.e?1:0),T.push(S,P,0),c.push(0,0,-1),G.push(1,Q.e?0:1),T.push(-S,P,0),c.push(0,0,-1),G.push(0,Q.e?0:1),k.push(0),k.push(1),k.push(2),k.push(0),k.push(2),k.push(3),K.e._ComputeSides(I,T,k,c,G,n.frontUVs,n.backUVs);const W=new K.e;return W.indices=k,W.xa=T,W.ya=c,W.Aa=G,W}function w(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=new c.b(n,T);k.sideOrientation=c.b._GetDefaultSideOrientation(k.sideOrientation),K._originalBuilderSideOrientation=k.sideOrientation;return G(k).Ca(K,k.updatable),k.sourcePlane&&(K.translate(k.sourcePlane.Pi,-k.sourcePlane.d),K.setDirection(k.sourcePlane.Pi.scale(-1))),K}const E={Ci:w};K.e.Ci=G,c.b.Ci=(n,k,T,c,K)=>w(n,{size:k,width:k,height:k,sideOrientation:K,updatable:c},T)},12436:(n,k,T)=>{"use strict";T.d(k,{c:()=>E});var c=T(730),K=T(532),Q=T(798),G=T(871);function w(n){const k=0|(n.segments||32),T=n.diameterX||n.diameter||1,K=n.diameterY||n.diameter||1,w=n.diameterZ||n.diameter||1,E=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,I=n.slice&&n.slice<=0?1:n.slice||1,S=0===n.sideOrientation?0:n.sideOrientation||Q.e.DEFAULTSIDE,P=!!n.dedupTopBottomIndices,W=new c.o(T/2,K/2,w/2),J=2+k,H=2*J,s=[],b=[],C=[],z=[];for(let Q=0;Q<=J;Q++){const n=Q/J,k=n*Math.PI*I;for(let T=0;T<=H;T++){const K=T/H,Q=K*Math.PI*2*E,w=c.d.RotationZ(-k),I=c.d.RotationY(Q),S=c.o.TransformCoordinates(c.o.Up(),w),P=c.o.TransformCoordinates(S,I),J=P.multiply(W),s=P.divide(W).normalize();b.push(J.x,J.y,J.z),C.push(s.x,s.y,s.z),z.push(K,G.e?1-n:n)}if(Q>0){const n=b.length/3;for(let k=n-2*(H+1);k+H+2<n;k++)P?(Q>1&&(s.push(k),s.push(k+1),s.push(k+H+1)),(Q<J||I<1)&&(s.push(k+H+1),s.push(k+1),s.push(k+H+2))):(s.push(k),s.push(k+1),s.push(k+H+1),s.push(k+H+1),s.push(k+1),s.push(k+H+2))}}Q.e._ComputeSides(S,b,s,C,z,n.frontUVs,n.backUVs);const r=new Q.e;return r.indices=s,r.xa=b,r.ya=C,r.Aa=z,r}function E(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return w(k).Ca(c,k.updatable),c}Q.e.CreateSphere=w,K.b.CreateSphere=(n,k,T,c,K,Q)=>E(n,{segments:k,diameterX:T,diameterY:T,diameterZ:T,sideOrientation:Q,updatable:K},c)},12799:(n,k,T)=>{"use strict";T.d(k,{d:()=>E,h:()=>G,l:()=>w});var c=T(542),K=T(2570),Q=T(12801);function G(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function w(n){return!!(n.wasmUrl&&(n.wasmBinary||n.wasmBinaryUrl)&&"object"===typeof WebAssembly||n.fallbackUrl)}class E{constructor(n){if(n.workerPool)return void(this._workerPoolPromise=Promise.resolve(n.workerPool));const k=n.wasmBinary,T=n.numWorkers??G(),w=T&&"function"===typeof Worker&&"function"===typeof URL,E=w||!n.jsModule,I=n.wasmUrl&&n.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:E?c.e.GetBabylonScriptURL(n.wasmUrl,!0):"",wasmBinaryPromise:k?Promise.resolve(k):c.e.LoadFileAsync(c.e.GetBabylonScriptURL(n.wasmBinaryUrl,!0))}:{url:E?c.e.GetBabylonScriptURL(n.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};w?this._workerPoolPromise=I.wasmBinaryPromise.then((n=>{const k=this._getWorkerContent(),c=URL.createObjectURL(new Blob([k],{type:"application/javascript"}));return new K.b(T,(()=>{const k=new Worker(c);return(0,Q.i)(k,n,I.url)}))})):this._modulePromise=I.wasmBinaryPromise.then((async k=>{if(!this._isModuleAvailable()&&!n.jsModule){if(!I.url)throw new Error("Draco codec module is not available");await c.e.LoadBabylonScriptAsync(I.url)}return await this._createModuleAsync(k,n.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((n=>{n.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},13111:(n,k,T)=>{"use strict";T.d(k,{b:()=>w});var c=T(12799),K=T(12796),Q=T(12808),G=T(798);class w{static get Configuration(){return{get decoder(){return K.c.DefaultConfiguration},set decoder(n){K.c.DefaultConfiguration=n}}}static set Configuration(n){K.c.DefaultConfiguration=n.decoder}static get DecoderAvailable(){return(0,c.l)(K.c.DefaultConfiguration)}static get Default(){return w._Default??(w._Default=new w),w._Default}static ResetDefault(n){w._Default&&(n||w._Default.dispose(),w._Default=null)}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.DefaultNumWorkers;const k="number"===typeof n?{...K.c.DefaultConfiguration,numWorkers:n}:{...K.c.DefaultConfiguration,...n};this._decoder=new K.c(k)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(n,k,T){return this._decoder.decodeMeshToMeshDataAsync(n,k,T)}async decodeMeshToGeometryAsync(n,k,T,c){return await this._decoder.decodeMeshToGeometryAsync(n,k,T,c)}async _decodeMeshToGeometryForGltfAsync(n,k,T,c,K,Q){return await this._decoder._decodeMeshToGeometryForGltfAsync(n,k,T,c,K,Q)}async decodeMeshAsync(n,k){const T=await this._decoder.decodeMeshToMeshDataAsync(n,k),c=new G.e;T.indices&&(c.indices=T.indices);for(const K of T.attributes){const n=Q.b.GetFloatData(K.data,K.size,Q.b.GetDataType(K.data),K.byteOffset,K.byteStride,K.normalized,T.totalVertices);c.set(n,K.kind)}return c}}w.DefaultNumWorkers=(0,c.h)(),w._Default=null},12801:(n,k,T)=>{"use strict";function c(n,k,T,c,K){const Q=n;let G=null,w=null,E=null;try{let n;G=new Q.Decoder,w=new Q.DecoderBuffer,w.Init(k,k.byteLength);const I=G.GetEncodedGeometryType(w);switch(I){case Q.TRIANGULAR_MESH:{const k=new Q.Mesh;if(n=G.DecodeBufferToMesh(w,k),!n.ok()||0===k.ptr)throw new Error(n.error_msg());const T=3*k.num_faces(),K=4*T,I=Q._malloc(K);try{G.GetTrianglesUInt32Array(k,K,I);const n=new Uint32Array(T);n.set(new Uint32Array(Q.HEAPF32.buffer,I,T)),c(n)}finally{Q._free(I)}E=k;break}case Q.POINT_CLOUD:{const k=new Q.PointCloud;if(n=G.DecodeBufferToPointCloud(w,k),!n.ok()||!k.ptr)throw new Error(n.error_msg());E=k;break}default:throw new Error(`Invalid geometry type ${I}`)}const S=E.num_points(),P=(n,k,T,c)=>{const G=c.data_type(),w=c.num_components(),E=c.normalized(),I=c.byte_stride(),P=c.byte_offset(),W={[Q.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:Q.HEAPF32},[Q.DT_INT8]:{typedArrayConstructor:Int8Array,heap:Q.HEAP8},[Q.DT_INT16]:{typedArrayConstructor:Int16Array,heap:Q.HEAP16},[Q.DT_INT32]:{typedArrayConstructor:Int32Array,heap:Q.HEAP32},[Q.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:Q.HEAPU8},[Q.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:Q.HEAPU16},[Q.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:Q.HEAPU32}}[G];if(!W)throw new Error(`Invalid data type ${G}`);const J=S*w,H=J*W.typedArrayConstructor.BYTES_PER_ELEMENT,s=Q._malloc(H);try{n.GetAttributeDataArrayForAllPoints(k,c,G,H,s);const Q=new W.typedArrayConstructor(W.heap.buffer,s,J);K(T,Q.slice(),w,P,I,E)}finally{Q._free(s)}};if(T)for(const k in T){const n=T[k],c=G.GetAttributeByUniqueId(E,n);P(G,E,k,c)}else{const n={position:Q.POSITION,Pi:Q.NORMAL,color:Q.COLOR,uv:Q.TEX_COORD};for(const k in n){const T=G.GetAttributeId(E,n[k]);if(-1!==T){const n=G.GetAttribute(E,T);P(G,E,k,n)}}}return S}finally{E&&Q.destroy(E),w&&Q.destroy(w),G&&Q.destroy(G)}}function K(){let n;onmessage=k=>{const T=k.data;switch(T.id){case"init":{T.url&&importScripts(T.url);const k=T.wasmBinary?{wasmBinary:T.wasmBinary}:{};n=DracoDecoderModule(k),postMessage({id:"initDone"});break}case"decodeMesh":if(!n)throw new Error("Draco decoder module is not available");n.then((n=>{const k=c(n,T.dataView,T.attributes,(n=>{postMessage({id:"indices",data:n},[n.buffer])}),((n,k,T,c,K,Q)=>{postMessage({id:"attribute",kind:n,data:k,size:T,byteOffset:c,byteStride:K,normalized:Q},[k.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:k})}))}}}async function Q(n,k,T){return await new Promise(((c,K)=>{const Q=k=>{n.removeEventListener("error",Q),n.removeEventListener("message",G),K(k)},G=k=>{"initDone"===k.data.id&&(n.removeEventListener("error",Q),n.removeEventListener("message",G),c(n))};if(n.addEventListener("error",Q),n.addEventListener("message",G),k){const c=k.slice(0);n.postMessage({id:"init",url:T,wasmBinary:c},[c])}else n.postMessage({id:"init",url:T})}))}T.d(k,{e:()=>c,f:()=>K,i:()=>Q})},12796:(n,k,T)=>{"use strict";T.d(k,{c:()=>I});var c=T(12799),K=T(542),Q=T(855),G=T(12808),w=T(556),E=T(12801);class I extends c.d{static get DefaultAvailable(){return(0,c.l)(I.DefaultConfiguration)}static get Default(){return I._Default??(I._Default=new I),I._Default}static ResetDefault(n){I._Default&&(n||I._Default.dispose(),I._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(n,k){return{module:await(k||DracoDecoderModule)({wasmBinary:n})}}_getWorkerContent(){return`${E.e}(${E.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.DefaultConfiguration)}decodeMeshToMeshDataAsync(n,k,T){const c=n instanceof ArrayBuffer?new Int8Array(n):new Int8Array(n.buffer,n.byteOffset,n.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async n=>await new Promise(((K,Q)=>{n.push(((n,G)=>{let E=null;const I=[],S=k=>{n.removeEventListener("error",S),n.removeEventListener("message",P),Q(k),G()},P=k=>{const c=k.data;switch(c.id){case"indices":E=c.data;break;case"attribute":I.push({kind:c.kind,data:c.data,size:c.size,byteOffset:c.byteOffset,byteStride:c.byteStride,normalized:(Q=c.kind,W=c.normalized,T&&void 0!==T[Q]?(W!==T[Q]&&w.d.Warn(`Normalized flag from Draco data (${W}) does not match normalized flag from glTF accessor (${T[Q]}). Using flag from glTF accessor.`),T[Q]):W)});break;case"decodeMeshDone":n.removeEventListener("error",S),n.removeEventListener("message",P),K({indices:E,attributes:I,totalVertices:c.totalVertices}),G()}var Q,W};n.addEventListener("error",S),n.addEventListener("message",P);const W=c.slice();n.postMessage({id:"decodeMesh",dataView:W,attributes:k},[W.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((n=>{let T=null;const K=[],Q=(0,E.e)(n.module,c,k,(n=>{T=n}),((n,k,T,c,Q,G)=>{K.push({kind:n,data:k,size:T,byteOffset:c,byteStride:Q,normalized:G})}));return{indices:T,attributes:K,totalVertices:Q}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(n,k,T,c){const K=await this.decodeMeshToMeshDataAsync(T,c),w=new Q.d(n,k);K.indices&&w.setIndices(K.indices);for(const Q of K.attributes)w.setVerticesBuffer(new G.b(k.getEngine(),Q.data,Q.kind,!1,void 0,Q.byteStride,void 0,Q.byteOffset,Q.size,void 0,Q.normalized,!0),K.totalVertices);return w}async _decodeMeshToGeometryForGltfAsync(n,k,T,c,K,w){const E=await this.decodeMeshToMeshDataAsync(T,c,K),I=new Q.d(n,k);w&&(I._boundingInfo=w,I.useBoundingInfoFromGeometry=!0),E.indices&&I.setIndices(E.indices);for(const Q of E.attributes)I.setVerticesBuffer(new G.b(k.getEngine(),Q.data,Q.kind,!1,void 0,Q.byteStride,void 0,Q.byteOffset,Q.size,void 0,Q.normalized,!0),E.totalVertices);return I}}I.DefaultConfiguration={wasmUrl:`${K.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${K.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${K.e._DefaultCdnUrl}/draco_decoder_gltf.js`},I._Default=null},12808:(n,k,T)=>{"use strict";T.d(k,{b:()=>c.f});var c=T(781)},12741:(n,k,T)=>{"use strict";T.d(k,{d:()=>W});var c=T(730),K=T(556),Q=T(878),G=T(532),w=T(564),E=T(885),I=T(781),S=T(542),P=T(675);G.b._instancedMeshFactory=(n,k)=>{const T=new W(n,k);if(k.instancedBuffers){T.instancedBuffers={};for(const n in k.instancedBuffers)T.instancedBuffers[n]=k.instancedBuffers[n]}return T};class W extends Q.e{constructor(n,k){super(n,k.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,k.zi(this),this._sourceMesh=k,this._unIndexed=k._unIndexed,this.position.p(k.position),this.rotation.p(k.rotation),this.ei.p(k.ei),k.rotationQuaternion&&(this.rotationQuaternion=k.rotationQuaternion.clone()),this.animations=k.animations.slice();for(const T of k.getAnimationRanges())null!=T&&this.createAnimationRange(T.name,T.from,T.to);if(this.infiniteDistance=k.infiniteDistance,this.setPivotMatrix(k.getPivotMatrix()),k.skeleton||k.morphTargetManager||!k.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const n=k.getBoundingInfo();this.buildBoundingInfo(n.minimum,n.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(n){var k;(null===(k=this._sourceMesh)||void 0===k?void 0:k.receiveShadows)!==n&&S.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(n){var k;(null===(k=this._sourceMesh)||void 0===k?void 0:k.material)!==n&&S.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(n){var k;(null===(k=this._sourceMesh)||void 0===k?void 0:k.visibility)!==n&&S.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(n){var k;(null===(k=this._sourceMesh)||void 0===k?void 0:k.skeleton)!==n&&S.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(n){this._sourceMesh&&n!==this._sourceMesh.renderingGroupId&&K.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get mi(){return this._sourceMesh._geometry}createInstance(n){return this._sourceMesh.createInstance(n)}isReady(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(n,!0)}getVerticesData(n,k,T){return this._sourceMesh.getVerticesData(n,k,T)}copyVerticesData(n,k){this._sourceMesh.copyVerticesData(n,k)}Ga(n,k,T,c){return this.sourceMesh&&this.sourceMesh.Ga(n,k,T,c),this.sourceMesh}updateVerticesData(n,k,T,c){return this.sourceMesh&&this.sourceMesh.updateVerticesData(n,k,T,c),this.sourceMesh}setIndices(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(n,k),this.sourceMesh}isVerticesDataPresent(n){return this._sourceMesh.isVerticesDataPresent(n)}qi(){return this._sourceMesh.qi()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let n,k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;n="object"===typeof k?k:{applySkeleton:k,applyMorph:T};const c=this._sourceMesh.mi?this._sourceMesh.mi.boundingBias:null;return this.Fa(this._sourceMesh._getData(n,null,I.f.PositionKind),c),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(n,k){if(super._activate(n,k),this._sourceMesh.si||K.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,n),k){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==E.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new c.d);const n=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,c.l.li[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.pi(!0)),this._currentLOD.position.p(c.l.li[7]),this._currentLOD._masterMesh=n,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(n){if(!n)return this;const k=this.sourceMesh.getLODLevels();if(k&&0!==k.length){const k=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(n,k.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(n){return this.sourceMesh._preActivateForIntermediateRendering(n)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.si)for(let n=0;n<this._sourceMesh.si.length;n++)this._sourceMesh.si[n].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;const c=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(n);if(w.c.DeepCopy(this,c,["name","si","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","ni","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","mi"],[]),this.refreshBoundingInfo(),k&&(c.parent=k),!T)for(let K=0;K<this.va().meshes.length;K++){const n=this.va().meshes[K];n.parent===this&&n.clone(n.name,c)}return c.pi(!0),this.onClonedObservable.notifyObservers(c),c}dispose(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Ai(this),super.dispose(n,k)}_serializeAsParent(n){super._serializeAsParent(n),n.parentId=this._sourceMesh.uniqueId,n.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,k=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;const c=this.clone("Clone of "+(this.name||this.id),n||this.parent,!0,k&&k.newSourcedMesh);c&&T&&T(this,c);for(const K of this.getChildTransformNodes(!0))K.instantiateHierarchy(c,k,T);return c}}G.b.prototype.registerInstancedBuffer=function(n,k){var T,c;if(null===(T=this._userInstancedBuffersStorage)||void 0===T||null===(c=T.vertexBuffers[n])||void 0===c||c.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const n of this.instances)n.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[n]=null,this._userInstancedBuffersStorage.strides[n]=k,this._userInstancedBuffersStorage.sizes[n]=32*k,this._userInstancedBuffersStorage.data[n]=new Float32Array(this._userInstancedBuffersStorage.sizes[n]),this._userInstancedBuffersStorage.vertexBuffers[n]=new I.f(this.getEngine(),this._userInstancedBuffersStorage.data[n],n,!0,!1,k,!0);for(const K of this.instances)K.instancedBuffers[n]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},G.b.prototype._processInstancedBuffers=function(n,k){const T=n?n.length:0;for(const c in this.instancedBuffers){let K=this._userInstancedBuffersStorage.sizes[c];const Q=this._userInstancedBuffersStorage.strides[c],G=(T+1)*Q;for(;K<G;)K*=2;this._userInstancedBuffersStorage.data[c].length!=K&&(this._userInstancedBuffersStorage.data[c]=new Float32Array(K),this._userInstancedBuffersStorage.sizes[c]=K,this._userInstancedBuffersStorage.vertexBuffers[c]&&(this._userInstancedBuffersStorage.vertexBuffers[c].dispose(),this._userInstancedBuffersStorage.vertexBuffers[c]=null));const w=this._userInstancedBuffersStorage.data[c];let E=0;if(k){const n=this.instancedBuffers[c];n.toArray?n.toArray(w,E):n.copyToArray?n.copyToArray(w,E):w[E]=n,E+=Q}for(let k=0;k<T;k++){const T=n[k].instancedBuffers[c];T.toArray?T.toArray(w,E):T.copyToArray?T.copyToArray(w,E):w[E]=T,E+=Q}this._userInstancedBuffersStorage.vertexBuffers[c]?this._userInstancedBuffersStorage.vertexBuffers[c].updateDirectly(w,0):(this._userInstancedBuffersStorage.vertexBuffers[c]=new I.f(this.getEngine(),this._userInstancedBuffersStorage.data[c],c,!0,!1,Q,!0),this._invalidateInstanceVertexArrayObject())}},G.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const n in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[n]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},G.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const n in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[n]&&this._userInstancedBuffersStorage.vertexBuffers[n].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,P.f)("BABYLON.InstancedMesh",W)},12984:(n,k,T)=>{"use strict";T.d(k,{b:()=>sn});var c=T(730),K=T(532),Q=T(781),G=T(798),w=T(871);function E(n){let k=n.pathArray;const T=n.closeArray||!1,c=n.closePath||!1,K=n.invertUV||!1,E=Math.floor(k[0].length/2);let I=n.offset||E;I=I>E?E:Math.floor(I);const S=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE,P=n.Aa,W=n.za,J=[],H=[],s=[],b=[],C=[],z=[],r=[],q=[];let O;const u=[],f=[];let A,v,F;if(k.length<2){const n=[],T=[];for(v=0;v<k[0].length-I;v++)n.push(k[0][v]),T.push(k[0][v+I]);k=[n,T]}let m=0;const x=c?1:0,g=T?1:0;let U,V,Y,Z,e,d;for(O=k[0].length,A=0;A<k.length+g;A++){for(r[A]=0,C[A]=[0],U=A===k.length?k[0]:k[A],V=U.length,O=O<V?O:V,F=0;F<V;)J.push(U[F].x,U[F].y,U[F].z),F>0&&(Y=U[F].Fg(U[F-1]).length(),Z=Y+r[A],C[A].push(Z),r[A]=Z),F++;c&&(F--,J.push(U[0].x,U[0].y,U[0].z),Y=U[F].Fg(U[0]).length(),Z=Y+r[A],C[A].push(Z),r[A]=Z),u[A]=V+x,f[A]=m,m+=V+x}let l,i,B=null,t=null;for(v=0;v<O+x;v++)for(q[v]=0,z[v]=[0],A=0;A<k.length-1+g;A++)e=k[A],d=A===k.length-1?k[0]:k[A+1],v===O?(B=e[0],t=d[0]):(B=e[v],t=d[v]),Y=t.Fg(B).length(),Z=Y+q[v],z[v].push(Z),q[v]=Z;if(P)for(A=0;A<P.length;A++)b.push(P[A].x,w.e?1-P[A].y:P[A].y);else for(A=0;A<k.length+g;A++)for(v=0;v<O+x;v++)l=0!=r[A]?C[A][v]/r[A]:0,i=0!=q[v]?z[v][A]/q[v]:0,K?b.push(i,l):b.push(l,w.e?1-i:i);A=0;let M=0,o=u[A]-1,D=u[A+1]-1,R=o<D?o:D,L=f[1]-f[0];const h=u.length-1;for(;M<=R&&A<h;)H.push(M,M+L,M+1),H.push(M+L+1,M+1,M+L),M+=1,M===R&&(A++,L=f[A+1]-f[A],o=u[A]-1,D=u[A+1]-1,M=f[A],R=o<D?o+M:D+M);if(G.e.ComputeNormals(J,H,s),c){let n=0,T=0;for(A=0;A<k.length;A++){n=3*f[A],T=A+1<k.length?3*(f[A+1]-1):s.length-3,s[n]=.5*(s[n]+s[T]),s[n+1]=.5*(s[n+1]+s[T+1]),s[n+2]=.5*(s[n+2]+s[T+2]);const c=Math.sqrt(s[n]*s[n]+s[n+1]*s[n+1]+s[n+2]*s[n+2]);s[n]/=c,s[n+1]/=c,s[n+2]/=c,s[T]=s[n],s[T+1]=s[n+1],s[T+2]=s[n+2]}}if(T){let n=3*f[0],T=3*f[k.length];for(v=0;v<O+x;v++){s[n]=.5*(s[n]+s[T]),s[n+1]=.5*(s[n+1]+s[T+1]),s[n+2]=.5*(s[n+2]+s[T+2]);const k=Math.sqrt(s[n]*s[n]+s[n+1]*s[n+1]+s[n+2]*s[n+2]);s[n]/=k,s[n+1]/=k,s[n+2]/=k,s[T]=s[n],s[T+1]=s[n+1],s[T+2]=s[n+2],n+=3,T+=3}}G.e._ComputeSides(S,J,H,s,b,n.frontUVs,n.backUVs);let j=null;if(W){j=new Float32Array(4*W.length);for(let n=0;n<W.length;n++)j[4*n]=W[n].r,j[4*n+1]=W[n].g,j[4*n+2]=W[n].b,j[4*n+3]=W[n].a}const p=new G.e,a=new Float32Array(J),X=new Float32Array(s),y=new Float32Array(b);return p.indices=H,p.xa=a,p.ya=X,p.Aa=y,j&&p.set(j,Q.f.ColorKind),c&&(p._idx=f),p}function I(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=k.pathArray,S=k.closeArray,P=k.closePath,W=K.b._GetDefaultSideOrientation(k.sideOrientation),J=k.instance,H=k.updatable;if(J){const n=c.l.li[0].ki(Number.MAX_VALUE),T=c.l.li[1].ki(-Number.MAX_VALUE),E=k=>{let c=I[0].length;const Q=J;let G=0;const w=Q._originalBuilderSideOrientation===K.b.DOUBLESIDE?2:1;for(let K=1;K<=w;++K)for(let w=0;w<I.length;++w){const K=I[w],E=K.length;c=c<E?c:E;for(let Q=0;Q<c;++Q){const c=K[Q];k[G]=c.x,k[G+1]=c.y,k[G+2]=c.z,n.minimizeInPlaceFromFloats(c.x,c.y,c.z),T.maximizeInPlaceFromFloats(c.x,c.y,c.z),G+=3}if(Q._creationDataStorage&&Q._creationDataStorage.closePath){const n=K[0];k[G]=n.x,k[G+1]=n.y,k[G+2]=n.z,G+=3}}},S=J.getVerticesData(Q.f.PositionKind);if(E(S),J.hasBoundingInfo?J.getBoundingInfo().reConstruct(n,T,J._worldMatrix):J.buildBoundingInfo(n,T,J._worldMatrix),J.updateVerticesData(Q.f.PositionKind,S,!1,!1),k.za){const n=J.getVerticesData(Q.f.ColorKind);for(let T=0,c=0;T<k.za.length;T++,c+=4){const K=k.za[T];n[c]=K.r,n[c+1]=K.g,n[c+2]=K.b,n[c+3]=K.a}J.updateVerticesData(Q.f.ColorKind,n,!1,!1)}if(k.Aa){const n=J.getVerticesData(Q.f.UVKind);for(let T=0;T<k.Aa.length;T++)n[2*T]=k.Aa[T].x,n[2*T+1]=w.e?1-k.Aa[T].y:k.Aa[T].y;J.updateVerticesData(Q.f.UVKind,n,!1,!1)}if(!J.areNormalsFrozen||J.isFacetDataEnabled){const n=J.qi(),k=J.getVerticesData(Q.f.NormalKind),T=J.isFacetDataEnabled?J.getFacetDataParameters():null;if(G.e.ComputeNormals(S,n,k,T),J._creationDataStorage&&J._creationDataStorage.closePath){let n=0,T=0;for(let c=0;c<I.length;c++)n=3*J._creationDataStorage.idx[c],T=c+1<I.length?3*(J._creationDataStorage.idx[c+1]-1):k.length-3,k[n]=.5*(k[n]+k[T]),k[n+1]=.5*(k[n+1]+k[T+1]),k[n+2]=.5*(k[n+2]+k[T+2]),k[T]=k[n],k[T+1]=k[n+1],k[T+2]=k[n+2]}J.areNormalsFrozen||J.updateVerticesData(Q.f.NormalKind,k,!1,!1)}return J}{const c=new K.b(n,T);c._originalBuilderSideOrientation=W,c._creationDataStorage=new K.e;const Q=E(k);return P&&(c._creationDataStorage.idx=Q._idx),c._creationDataStorage.closePath=P,c._creationDataStorage.closeArray=S,Q.Ca(c,H),c}}G.e.CreateRibbon=E,K.b.CreateRibbon=function(n,k){return I(n,{pathArray:k,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var S=T(946),P=T(12273),W=T(764);function J(n){const k=n.pattern||K.b.NO_FLIP,T=n.tileWidth||n.tileSize||1,c=n.tileHeight||n.tileSize||1,Q=n.alignHorizontal||0,w=n.alignVertical||0,E=n.width||n.size||1,I=Math.floor(E/T);let S=E-I*T;const P=n.height||n.size||1,W=Math.floor(P/c);let J=P-W*c;const H=T*I/2,s=c*W/2;let b=0,C=0,z=0,r=0,q=0,O=0;if(S>0||J>0){switch(z=-H,r=-s,q=H,O=s,Q){case K.b.CENTER:S/=2,z-=S,q+=S;break;case K.b.LEFT:q+=S,b=-S/2;break;case K.b.RIGHT:z-=S,b=S/2}switch(w){case K.b.CENTER:J/=2,r-=J,O+=J;break;case K.b.BOTTOM:O+=J,C=-J/2;break;case K.b.TOP:r-=J,C=J/2}}const u=[],f=[],A=[];A[0]=[0,0,1,0,1,1,0,1],A[1]=[0,0,1,0,1,1,0,1],k!==K.b.ROTATE_TILE&&k!==K.b.ROTATE_ROW||(A[1]=[1,1,0,1,0,0,1,0]),k!==K.b.FLIP_TILE&&k!==K.b.FLIP_ROW||(A[1]=[1,0,0,0,0,1,1,1]),k!==K.b.FLIP_N_ROTATE_TILE&&k!==K.b.FLIP_N_ROTATE_ROW||(A[1]=[0,1,1,1,1,0,0,0]);let v=[];const F=[],m=[];let x=0;for(let G=0;G<W;G++)for(let n=0;n<I;n++)u.push(n*T-H+b,G*c-s+C,0),u.push((n+1)*T-H+b,G*c-s+C,0),u.push((n+1)*T-H+b,(G+1)*c-s+C,0),u.push(n*T-H+b,(G+1)*c-s+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),v=k===K.b.FLIP_TILE||k===K.b.ROTATE_TILE||k===K.b.FLIP_N_ROTATE_TILE?v.concat(A[(n%2+G%2)%2]):k===K.b.FLIP_ROW||k===K.b.ROTATE_ROW||k===K.b.FLIP_N_ROTATE_ROW?v.concat(A[G%2]):v.concat(A[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),x+=4;if(S>0||J>0){const n=J>0&&(w===K.b.CENTER||w===K.b.TOP),G=J>0&&(w===K.b.CENTER||w===K.b.BOTTOM),E=S>0&&(Q===K.b.CENTER||Q===K.b.RIGHT),P=S>0&&(Q===K.b.CENTER||Q===K.b.LEFT);let A,g,U,V,Y=[];if(n&&E&&(u.push(z+b,r+C,0),u.push(-H+b,r+C,0),u.push(-H+b,r+J+C,0),u.push(z+b,r+J+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=1-S/T,g=1-J/c,U=1,V=1,Y=[A,g,U,g,U,V,A,V],k===K.b.ROTATE_ROW&&(Y=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),k===K.b.FLIP_ROW&&(Y=[1-A,g,1-U,g,1-U,V,1-A,V]),k===K.b.FLIP_N_ROTATE_ROW&&(Y=[A,1-g,U,1-g,U,1-V,A,1-V]),v=v.concat(Y),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n&&P&&(u.push(H+b,r+C,0),u.push(q+b,r+C,0),u.push(q+b,r+J+C,0),u.push(H+b,r+J+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=0,g=1-J/c,U=S/T,V=1,Y=[A,g,U,g,U,V,A,V],(k===K.b.ROTATE_ROW||k===K.b.ROTATE_TILE&&I%2===0)&&(Y=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),(k===K.b.FLIP_ROW||k===K.b.FLIP_TILE&&I%2===0)&&(Y=[1-A,g,1-U,g,1-U,V,1-A,V]),(k===K.b.FLIP_N_ROTATE_ROW||k===K.b.FLIP_N_ROTATE_TILE&&I%2===0)&&(Y=[A,1-g,U,1-g,U,1-V,A,1-V]),v=v.concat(Y),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&E&&(u.push(z+b,s+C,0),u.push(-H+b,s+C,0),u.push(-H+b,O+C,0),u.push(z+b,O+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=1-S/T,g=0,U=1,V=J/c,Y=[A,g,U,g,U,V,A,V],(k===K.b.ROTATE_ROW&&W%2===1||k===K.b.ROTATE_TILE&&W%1===0)&&(Y=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),(k===K.b.FLIP_ROW&&W%2===1||k===K.b.FLIP_TILE&&W%2===0)&&(Y=[1-A,g,1-U,g,1-U,V,1-A,V]),(k===K.b.FLIP_N_ROTATE_ROW&&W%2===1||k===K.b.FLIP_N_ROTATE_TILE&&W%2===0)&&(Y=[A,1-g,U,1-g,U,1-V,A,1-V]),v=v.concat(Y),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&P&&(u.push(H+b,s+C,0),u.push(q+b,s+C,0),u.push(q+b,O+C,0),u.push(H+b,O+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,A=0,g=0,U=S/T,V=J/c,Y=[A,g,U,g,U,V,A,V],(k===K.b.ROTATE_ROW&&W%2===1||k===K.b.ROTATE_TILE&&(W+I)%2===1)&&(Y=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),(k===K.b.FLIP_ROW&&W%2===1||k===K.b.FLIP_TILE&&(W+I)%2===1)&&(Y=[1-A,g,1-U,g,1-U,V,1-A,V]),(k===K.b.FLIP_N_ROTATE_ROW&&W%2===1||k===K.b.FLIP_N_ROTATE_TILE&&(W+I)%2===1)&&(Y=[A,1-g,U,1-g,U,1-V,A,1-V]),v=v.concat(Y),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n){const n=[];A=0,g=1-J/c,U=1,V=1,n[0]=[A,g,U,g,U,V,A,V],n[1]=[A,g,U,g,U,V,A,V],k!==K.b.ROTATE_TILE&&k!==K.b.ROTATE_ROW||(n[1]=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),k!==K.b.FLIP_TILE&&k!==K.b.FLIP_ROW||(n[1]=[1-A,g,1-U,g,1-U,V,1-A,V]),k!==K.b.FLIP_N_ROTATE_TILE&&k!==K.b.FLIP_N_ROTATE_ROW||(n[1]=[A,1-g,U,1-g,U,1-V,A,1-V]);for(let c=0;c<I;c++)u.push(c*T-H+b,r+C,0),u.push((c+1)*T-H+b,r+C,0),u.push((c+1)*T-H+b,r+J+C,0),u.push(c*T-H+b,r+J+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,v=k===K.b.FLIP_TILE||k===K.b.ROTATE_TILE||k===K.b.FLIP_N_ROTATE_TILE?v.concat(n[(c+1)%2]):k===K.b.FLIP_ROW||k===K.b.ROTATE_ROW||k===K.b.FLIP_N_ROTATE_ROW?v.concat(n[1]):v.concat(n[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const n=[];A=0,g=0,U=1,V=J/c,n[0]=[A,g,U,g,U,V,A,V],n[1]=[A,g,U,g,U,V,A,V],k!==K.b.ROTATE_TILE&&k!==K.b.ROTATE_ROW||(n[1]=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),k!==K.b.FLIP_TILE&&k!==K.b.FLIP_ROW||(n[1]=[1-A,g,1-U,g,1-U,V,1-A,V]),k!==K.b.FLIP_N_ROTATE_TILE&&k!==K.b.FLIP_N_ROTATE_ROW||(n[1]=[A,1-g,U,1-g,U,1-V,A,1-V]);for(let c=0;c<I;c++)u.push(c*T-H+b,O-J+C,0),u.push((c+1)*T-H+b,O-J+C,0),u.push((c+1)*T-H+b,O+C,0),u.push(c*T-H+b,O+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,v=k===K.b.FLIP_TILE||k===K.b.ROTATE_TILE||k===K.b.FLIP_N_ROTATE_TILE?v.concat(n[(c+W)%2]):k===K.b.FLIP_ROW||k===K.b.ROTATE_ROW||k===K.b.FLIP_N_ROTATE_ROW?v.concat(n[W%2]):v.concat(n[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const n=[];A=1-S/T,g=0,U=1,V=1,n[0]=[A,g,U,g,U,V,A,V],n[1]=[A,g,U,g,U,V,A,V],k!==K.b.ROTATE_TILE&&k!==K.b.ROTATE_ROW||(n[1]=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),k!==K.b.FLIP_TILE&&k!==K.b.FLIP_ROW||(n[1]=[1-A,g,1-U,g,1-U,V,1-A,V]),k!==K.b.FLIP_N_ROTATE_TILE&&k!==K.b.FLIP_N_ROTATE_ROW||(n[1]=[A,1-g,U,1-g,U,1-V,A,1-V]);for(let T=0;T<W;T++)u.push(z+b,T*c-s+C,0),u.push(z+S+b,T*c-s+C,0),u.push(z+S+b,(T+1)*c-s+C,0),u.push(z+b,(T+1)*c-s+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,v=k===K.b.FLIP_TILE||k===K.b.ROTATE_TILE||k===K.b.FLIP_N_ROTATE_TILE?v.concat(n[(T+1)%2]):k===K.b.FLIP_ROW||k===K.b.ROTATE_ROW||k===K.b.FLIP_N_ROTATE_ROW?v.concat(n[T%2]):v.concat(n[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const n=[];A=0,g=0,U=S/c,V=1,n[0]=[A,g,U,g,U,V,A,V],n[1]=[A,g,U,g,U,V,A,V],k!==K.b.ROTATE_TILE&&k!==K.b.ROTATE_ROW||(n[1]=[1-A,1-g,1-U,1-g,1-U,1-V,1-A,1-V]),k!==K.b.FLIP_TILE&&k!==K.b.FLIP_ROW||(n[1]=[1-A,g,1-U,g,1-U,V,1-A,V]),k!==K.b.FLIP_N_ROTATE_TILE&&k!==K.b.FLIP_N_ROTATE_ROW||(n[1]=[A,1-g,U,1-g,U,1-V,A,1-V]);for(let T=0;T<W;T++)u.push(q-S+b,T*c-s+C,0),u.push(q+b,T*c-s+C,0),u.push(q+b,(T+1)*c-s+C,0),u.push(q-S+b,(T+1)*c-s+C,0),m.push(x,x+1,x+3,x+1,x+2,x+3),x+=4,v=k===K.b.FLIP_TILE||k===K.b.ROTATE_TILE||k===K.b.FLIP_N_ROTATE_TILE?v.concat(n[(T+I)%2]):k===K.b.FLIP_ROW||k===K.b.ROTATE_ROW||k===K.b.FLIP_N_ROTATE_ROW?v.concat(n[T%2]):v.concat(n[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const g=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE;G.e._ComputeSides(g,u,m,f,v,n.frontUVs,n.backUVs);const U=new G.e;U.indices=m,U.xa=u,U.ya=f,U.Aa=v;const V=g===G.e.DOUBLESIDE?F.concat(F):F;return U.za=V,U}function H(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return J(k).Ca(c,k.updatable),c}function s(n){const k=n.faceUV||new Array(6),T=n.faceColors,Q=n.pattern||K.b.NO_FLIP,E=n.width||n.size||1,I=n.height||n.size||1,S=n.depth||n.size||1,P=n.tileWidth||n.tileSize||1,H=n.tileHeight||n.tileSize||1,s=n.alignHorizontal||0,b=n.alignVertical||0,C=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE;for(let K=0;K<6;K++)void 0===k[K]&&(k[K]=new c.p(0,0,1,1)),T&&void 0===T[K]&&(T[K]=new W.g(1,1,1,1));const z=E/2,r=I/2,q=S/2,O=[];for(let c=0;c<2;c++)O[c]=J({pattern:Q,tileWidth:P,tileHeight:H,width:E,height:I,alignVertical:b,alignHorizontal:s,sideOrientation:C});for(let c=2;c<4;c++)O[c]=J({pattern:Q,tileWidth:P,tileHeight:H,width:S,height:I,alignVertical:b,alignHorizontal:s,sideOrientation:C});let u=b;b===K.b.BOTTOM?u=K.b.TOP:b===K.b.TOP&&(u=K.b.BOTTOM);for(let c=4;c<6;c++)O[c]=J({pattern:Q,tileWidth:P,tileHeight:H,width:E,height:S,alignVertical:u,alignHorizontal:s,sideOrientation:C});let f=[],A=[],v=[],F=[];const m=[],x=[],g=[],U=[];let V=0,Y=0;for(let K=0;K<6;K++){const n=O[K].xa.length;x[K]=[],g[K]=[];for(let k=0;k<n/3;k++)x[K].push(new c.o(O[K].xa[3*k],O[K].xa[3*k+1],O[K].xa[3*k+2])),g[K].push(new c.o(O[K].ya[3*k],O[K].ya[3*k+1],O[K].ya[3*k+2]));V=O[K].Aa.length,U[K]=[];for(let T=0;T<V;T+=2)U[K][T]=k[K].x+(k[K].z-k[K].x)*O[K].Aa[T],U[K][T+1]=k[K].y+(k[K].w-k[K].y)*O[K].Aa[T+1],w.e&&(U[K][T+1]=1-U[K][T+1]);if(v=v.concat(U[K]),F=F.concat(O[K].indices.map((n=>n+Y))),Y+=x[K].length,T)for(let k=0;k<4;k++)m.push(T[K].r,T[K].g,T[K].b,T[K].a)}const Z=new c.o(0,0,q),e=c.d.RotationY(Math.PI);f=x[0].map((n=>c.o.TransformNormal(n,e).add(Z))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[]),A=g[0].map((n=>c.o.TransformNormal(n,e))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[]),f=f.concat(x[1].map((n=>n.Fg(Z))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[])),A=A.concat(g[1].map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[]));const d=new c.o(z,0,0),l=c.d.RotationY(-Math.PI/2);f=f.concat(x[2].map((n=>c.o.TransformNormal(n,l).add(d))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[])),A=A.concat(g[2].map((n=>c.o.TransformNormal(n,l))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[]));const i=c.d.RotationY(Math.PI/2);f=f.concat(x[3].map((n=>c.o.TransformNormal(n,i).Fg(d))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[])),A=A.concat(g[3].map((n=>c.o.TransformNormal(n,i))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[]));const B=new c.o(0,r,0),t=c.d.RotationX(Math.PI/2);f=f.concat(x[4].map((n=>c.o.TransformNormal(n,t).add(B))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[])),A=A.concat(g[4].map((n=>c.o.TransformNormal(n,t))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[]));const M=c.d.RotationX(-Math.PI/2);f=f.concat(x[5].map((n=>c.o.TransformNormal(n,M).Fg(B))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[])),A=A.concat(g[5].map((n=>c.o.TransformNormal(n,M))).map((n=>[n.x,n.y,n.z])).reduce(((n,k)=>n.concat(k)),[])),G.e._ComputeSides(C,f,F,A,v);const o=new G.e;if(o.indices=F,o.xa=f,o.ya=A,o.Aa=v,T){const n=C===G.e.DOUBLESIDE?m.concat(m):m;o.za=n}return o}function b(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return s(k).Ca(c,k.updatable),c}G.e.CreateTiledPlane=J;G.e.CreateTiledBox=s;var C=T(12436),z=T(2475),r=T(909);function q(n){const k=n.height||2;let T=0===n.diameterTop?0:n.diameterTop||n.diameter||1,Q=0===n.diameterBottom?0:n.diameterBottom||n.diameter||1;T=T||1e-5,Q=Q||1e-5;const E=0|(n.tessellation||24),I=0|(n.subdivisions||1),S=!!n.hasRings,P=!!n.enclose,J=0===n.cap?0:n.cap||K.b.CAP_ALL,H=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,s=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE,b=n.faceUV||new Array(3),C=n.faceColors,z=2+(1+(1!==H&&P?2:0))*(S?I:1);let q;for(q=0;q<z;q++)C&&void 0===C[q]&&(C[q]=new W.g(1,1,1,1));for(q=0;q<z;q++)b&&void 0===b[q]&&(b[q]=new c.p(0,0,1,1));const O=[],u=[],f=[],A=[],v=[],F=2*Math.PI*H/E;let m,x,g;const U=(Q-T)/2/k,V=c.o.Zero(),Y=c.o.Zero(),Z=c.o.Zero(),e=c.o.Zero(),d=c.o.Zero(),l=r.d.Y;let i,B,t,M=1,o=1,D=0,R=0;for(i=0;i<=I;i++)for(x=i/I,g=(x*(T-Q)+Q)/2,M=S&&0!==i&&i!==I?2:1,t=0;t<M;t++){for(S&&(o+=t),P&&(o+=2*t),B=0;B<=E;B++)m=B*F,V.x=Math.cos(-m)*g,V.y=-k/2+x*k,V.z=Math.sin(-m)*g,0===T&&i===I?(Y.x=f[f.length-3*(E+1)],Y.y=f[f.length-3*(E+1)+1],Y.z=f[f.length-3*(E+1)+2]):(Y.x=V.x,Y.z=V.z,Y.y=Math.sqrt(Y.x*Y.x+Y.z*Y.z)*U,Y.normalize()),0===B&&(Z.p(V),e.p(Y)),u.push(V.x,V.y,V.z),f.push(Y.x,Y.y,Y.z),R=S?D!==o?b[o].y:b[o].w:b[o].y+(b[o].w-b[o].y)*x,A.push(b[o].x+(b[o].z-b[o].x)*B/E,w.e?1-R:R),C&&v.push(C[o].r,C[o].g,C[o].b,C[o].a);1!==H&&P&&(u.push(V.x,V.y,V.z),u.push(0,V.y,0),u.push(0,V.y,0),u.push(Z.x,Z.y,Z.z),c.o.CrossToRef(l,Y,d),d.normalize(),f.push(d.x,d.y,d.z,d.x,d.y,d.z),c.o.CrossToRef(e,l,d),d.normalize(),f.push(d.x,d.y,d.z,d.x,d.y,d.z),R=S?D!==o?b[o+1].y:b[o+1].w:b[o+1].y+(b[o+1].w-b[o+1].y)*x,A.push(b[o+1].x,w.e?1-R:R),A.push(b[o+1].z,w.e?1-R:R),R=S?D!==o?b[o+2].y:b[o+2].w:b[o+2].y+(b[o+2].w-b[o+2].y)*x,A.push(b[o+2].x,w.e?1-R:R),A.push(b[o+2].z,w.e?1-R:R),C&&(v.push(C[o+1].r,C[o+1].g,C[o+1].b,C[o+1].a),v.push(C[o+1].r,C[o+1].g,C[o+1].b,C[o+1].a),v.push(C[o+2].r,C[o+2].g,C[o+2].b,C[o+2].a),v.push(C[o+2].r,C[o+2].g,C[o+2].b,C[o+2].a))),D!==o&&(D=o)}const L=1!==H&&P?E+4:E;for(i=0,o=0;o<I;o++){let n=0,k=0,T=0,c=0;for(B=0;B<E;B++)n=i*(L+1)+B,k=(i+1)*(L+1)+B,T=i*(L+1)+(B+1),c=(i+1)*(L+1)+(B+1),O.push(n,k,T),O.push(c,T,k);1!==H&&P&&(O.push(n+2,k+2,T+2),O.push(c+2,T+2,k+2),O.push(n+4,k+4,T+4),O.push(c+4,T+4,k+4)),i=S?i+2:i+1}const h=n=>{const K=n?T/2:Q/2;if(0===K)return;let G,I,S;const P=n?b[z-1]:b[0];let W=null;C&&(W=n?C[z-1]:C[0]);const J=u.length/3,s=n?k/2:-k/2,r=new c.o(0,s,0);u.push(r.x,r.y,r.z),f.push(0,n?1:-1,0);const q=P.y+.5*(P.w-P.y);A.push(P.x+.5*(P.z-P.x),w.e?1-q:q),W&&v.push(W.r,W.g,W.b,W.a);const F=new c.m(.5,.5);for(S=0;S<=E;S++){G=2*Math.PI*S*H/E;const k=Math.cos(-G),T=Math.sin(-G);I=new c.o(k*K,s,T*K);const Q=new c.m(k*F.x+.5,T*F.y+.5);u.push(I.x,I.y,I.z),f.push(0,n?1:-1,0);const J=P.y+(P.w-P.y)*Q.y;A.push(P.x+(P.z-P.x)*Q.x,w.e?1-J:J),W&&v.push(W.r,W.g,W.b,W.a)}for(S=0;S<E;S++)n?(O.push(J),O.push(J+(S+2)),O.push(J+(S+1))):(O.push(J),O.push(J+(S+1)),O.push(J+(S+2)))};J!==K.b.CAP_START&&J!==K.b.CAP_ALL||h(!1),J!==K.b.CAP_END&&J!==K.b.CAP_ALL||h(!0),G.e._ComputeSides(s,u,O,f,A,n.frontUVs,n.backUVs);const j=new G.e;return j.indices=O,j.xa=u,j.ya=f,j.Aa=A,C&&(j.za=v),j}function O(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return q(k).Ca(c,k.updatable),c}function u(n){const k=[],T=[],K=[],Q=[],E=n.diameter||1,I=n.thickness||.5,S=0|(n.tessellation||16),P=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE,W=S+1;for(let G=0;G<=S;G++){const n=G/S,P=G*Math.PI*2/S-Math.PI/2,J=c.d.Translation(E/2,0,0).multiply(c.d.RotationY(P));for(let E=0;E<=S;E++){const P=1-E/S,H=E*Math.PI*2/S+Math.PI,s=Math.cos(H),b=Math.sin(H);let C=new c.o(s,b,0),z=C.scale(I/2);const r=new c.m(n,P);z=c.o.TransformCoordinates(z,J),C=c.o.TransformNormal(C,J),T.push(z.x,z.y,z.z),K.push(C.x,C.y,C.z),Q.push(r.x,w.e?1-r.y:r.y);const q=(G+1)%W,O=(E+1)%W;k.push(G*W+E),k.push(G*W+O),k.push(q*W+E),k.push(G*W+O),k.push(q*W+O),k.push(q*W+E)}}G.e._ComputeSides(P,T,k,K,Q,n.frontUVs,n.backUVs);const J=new G.e;return J.indices=k,J.xa=T,J.ya=K,J.Aa=Q,J}function f(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return u(k).Ca(c,k.updatable),c}G.e.CreateCylinder=q,K.b.CreateCylinder=(n,k,T,c,Q,G,w,E,I)=>{void 0!==w&&w instanceof z.c||(void 0!==w&&(I=E||K.b.DEFAULTSIDE,E=w),w=G,G=1);return O(n,{height:k,diameterTop:T,diameterBottom:c,tessellation:Q,subdivisions:G,sideOrientation:I,updatable:E},w)};function A(n){const k=[],T=[],K=[],Q=[],E=n.radius||2,I=n.tube||.5,S=n.radialSegments||32,P=n.tubularSegments||32,W=n.p||2,J=n.q||3,H=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE,s=n=>{const k=Math.cos(n),T=Math.sin(n),K=J/W*n,Q=Math.cos(K),G=E*(2+Q)*.5*k,w=E*(2+Q)*T*.5,I=E*Math.sin(K)*.5;return new c.o(G,w,I)};let b,C;for(b=0;b<=S;b++){const n=b%S/S*2*W*Math.PI,k=s(n),K=s(n+.01),G=K.Fg(k);let E=K.add(k);const J=c.o.Cross(G,E);for(E=c.o.Cross(J,G),J.normalize(),E.normalize(),C=0;C<P;C++){const n=C%P/P*2*Math.PI,c=-I*Math.cos(n),K=I*Math.sin(n);T.push(k.x+c*E.x+K*J.x),T.push(k.y+c*E.y+K*J.y),T.push(k.z+c*E.z+K*J.z),Q.push(b/S),Q.push(w.e?1-C/P:C/P)}}for(b=0;b<S;b++)for(C=0;C<P;C++){const n=(C+1)%P,T=b*P+C,c=(b+1)*P+C,K=(b+1)*P+n,Q=b*P+n;k.push(Q),k.push(c),k.push(T),k.push(Q),k.push(K),k.push(c)}G.e.ComputeNormals(T,k,K),G.e._ComputeSides(H,T,k,K,Q,n.frontUVs,n.backUVs);const z=new G.e;return z.indices=k,z.xa=T,z.ya=K,z.Aa=Q,z}function v(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return A(k).Ca(c,k.updatable),c}G.e.CreateTorus=u,K.b.CreateTorus=(n,k,T,c,K,Q,G)=>f(n,{diameter:k,thickness:T,tessellation:c,sideOrientation:G,updatable:Q},K);G.e.CreateTorusKnot=A,K.b.CreateTorusKnot=(n,k,T,c,K,Q,G,w,E,I)=>v(n,{radius:k,tube:T,radialSegments:c,tubularSegments:K,p:Q,q:G,sideOrientation:I,updatable:E},w);var F=T(12991),m=T(556),x=T(2308),g=T(736),U=T(588);class V extends c.m{constructor(n,k){super(n.x,n.y),this.index=k}}class Y{constructor(){this.elements=[]}add(n){const k=[];for(const T of n){const n=new V(T,this.elements.length);k.push(n),this.elements.push(n)}return k}computeBounds(){const n=new c.m(this.elements[0].x,this.elements[0].y),k=new c.m(this.elements[0].x,this.elements[0].y);for(const T of this.elements)T.x<n.x?n.x=T.x:T.x>k.x&&(k.x=T.x),T.y<n.y?n.y=T.y:T.y>k.y&&(k.y=T.y);return{min:n,max:k,width:k.x-n.x,height:k.y-n.y}}}class Z{_addToepoint(n){for(const k of n)this._epoints.push(k.x,k.y)}constructor(n,k,T){let c,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new Y,this._outlinepoints=new Y,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=K,this._name=n,this._scene=T||U.e.LastCreatedScene,c=k instanceof x.d?k.getPoints():k,this._addToepoint(c),this._points.add(c),this._outlinepoints.add(c),"undefined"===typeof this.bjsEarcut&&m.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(n){this._points.add(n);const k=new Y;return k.add(n),this._holes.push(k),this._eholes.push(this._epoints.length/2),this._addToepoint(n),this}build(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const c=new K.b(this._name,this._scene),G=this.buildVertexData(k,T);return c.Ga(Q.f.PositionKind,G.xa,n),c.Ga(Q.f.NormalKind,G.ya,n),c.Ga(Q.f.UVKind,G.Aa,n),c.setIndices(G.indices),c}buildVertexData(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const T=new G.e,c=[],K=[],Q=[],w=this._points.computeBounds();for(const G of this._points.elements)c.push(0,1,0),K.push(G.x,0,G.y),Q.push((G.x-w.min.x)/w.width,(G.y-w.min.y)/w.height);const E=[],I=this.bjsEarcut(this._epoints,this._eholes,2);for(let G=0;G<I.length;G++)E.push(I[G]);if(n>0){const T=K.length/3;for(const k of this._points.elements)c.push(0,-1,0),K.push(k.x,-n,k.y),Q.push(1-(k.x-w.min.x)/w.width,1-(k.y-w.min.y)/w.height);const G=E.length;for(let n=0;n<G;n+=3){const k=E[n+0],c=E[n+1],K=E[n+2];E.push(K+T),E.push(c+T),E.push(k+T)}this._addSide(K,c,Q,E,w,this._outlinepoints,n,!1,k);for(const I of this._holes)this._addSide(K,c,Q,E,w,I,n,!0,k)}return T.indices=E,T.xa=K,T.ya=c,T.Aa=Q,T}_addSide(n,k,T,K,Q,G,w,E,I){let S=n.length/3,P=0;for(let W=0;W<G.elements.length;W++){const J=G.elements[W],H=G.elements[(W+1)%G.elements.length];n.push(J.x,0,J.y),n.push(J.x,-w,J.y),n.push(H.x,0,H.y),n.push(H.x,-w,H.y);const s=G.elements[(W+G.elements.length-1)%G.elements.length],b=G.elements[(W+2)%G.elements.length];let C=new c.o(-(H.y-J.y),0,H.x-J.x),z=new c.o(-(J.y-s.y),0,J.x-s.x),r=new c.o(-(b.y-H.y),0,b.x-H.x);E||(C=C.scale(-1),z=z.scale(-1),r=r.scale(-1));const q=C.normalizeToNew();let O=z.normalizeToNew(),u=r.normalizeToNew();const f=c.o.Dot(O,q);O=f>I?f<g.b-1?new c.o(J.x,0,J.y).Fg(new c.o(H.x,0,H.y)).normalize():z.add(C).normalize():q;const A=c.o.Dot(r,C);u=A>I?A<g.b-1?new c.o(H.x,0,H.y).Fg(new c.o(J.x,0,J.y)).normalize():r.add(C).normalize():q,T.push(P/Q.width,0),T.push(P/Q.width,1),P+=C.length(),T.push(P/Q.width,0),T.push(P/Q.width,1),k.push(O.x,O.y,O.z),k.push(O.x,O.y,O.z),k.push(u.x,u.y,u.z),k.push(u.x,u.y,u.z),E?(K.push(S),K.push(S+2),K.push(S+1),K.push(S+1),K.push(S+2),K.push(S+3)):(K.push(S),K.push(S+1),K.push(S+2),K.push(S+1),K.push(S+3),K.push(S+2)),S+=4}}}function e(n,k,T,K,E,I,S){const P=T||new Array(3),J=K,H=[],s=S||!1;for(let Q=0;Q<3;Q++)void 0===P[Q]&&(P[Q]=new c.p(0,0,1,1)),J&&void 0===J[Q]&&(J[Q]=new W.g(1,1,1,1));const b=n.getVerticesData(Q.f.PositionKind),C=n.getVerticesData(Q.f.NormalKind),z=n.getVerticesData(Q.f.UVKind),r=n.qi(),q=b.length/9;let O=0,u=0,f=0,A=0,v=0;const F=[0];if(s)for(let c=q;c<b.length/3;c+=4)u=b[3*(c+2)]-b[3*c],f=b[3*(c+2)+2]-b[3*c+2],A=Math.sqrt(u*u+f*f),v+=A,F.push(v);let m=0,x=0;for(let c=0;c<C.length;c+=3)Math.abs(C[c+1])<.001&&(x=1),Math.abs(C[c+1]-1)<.001&&(x=0),Math.abs(C[c+1]+1)<.001&&(x=2),m=c/3,1===x?(O=m-q,z[2*m]=O%4<1.5?s?P[x].x+(P[x].z-P[x].x)*F[Math.floor(O/4)]/v:P[x].x:s?P[x].x+(P[x].z-P[x].x)*F[Math.floor(O/4)+1]/v:P[x].z,z[2*m+1]=O%2===0?w.e?1-P[x].w:P[x].w:w.e?1-P[x].y:P[x].y):(z[2*m]=(1-z[2*m])*P[x].x+z[2*m]*P[x].z,z[2*m+1]=(1-z[2*m+1])*P[x].y+z[2*m+1]*P[x].w,w.e&&(z[2*m+1]=1-z[2*m+1])),J&&H.push(J[x].r,J[x].g,J[x].b,J[x].a);G.e._ComputeSides(k,b,r,C,z,E,I);const g=new G.e;if(g.indices=r,g.xa=b,g.ya=C,g.Aa=z,J){const n=k===G.e.DOUBLESIDE?H.concat(H):H;g.za=n}return g}function d(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation);const G=k.shape,w=k.holes||[],E=k.depth||0,I=k.smoothingThreshold||2,S=[];let P=[];for(let K=0;K<G.length;K++)S[K]=new c.m(G[K].x,G[K].z);S[0].equalsWithEpsilon(S[S.length-1],1e-8)&&S.pop();const W=new Z(n,S,T||U.e.LastCreatedScene,Q);for(let K=0;K<w.length;K++){P=[];for(let n=0;n<w[K].length;n++)P.push(new c.m(w[K][n].x,w[K][n].z));W.addHole(P)}const J=W.build(!1,E,I);J._originalBuilderSideOrientation=k.sideOrientation;return e(J,k.sideOrientation,k.faceUV,k.faceColors,k.frontUVs,k.backUVs,k.wrap).Ca(J,k.updatable),J}function l(n,k){return d(n,k,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function i(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=k.path,Q=k.shape,G=k.scale||1,w=k.rotation||0,E=0===k.cap?0:k.cap||K.b.NO_CAP,I=k.updatable,S=K.b._GetDefaultSideOrientation(k.sideOrientation),P=k.instance||null,W=k.invertUV||!1,J=k.closeShape||!1,H=k.closePath||!1,s=k.capFunction||null;return t(n,Q,c,G,w,null,null,H,J,E,!1,T,!!I,S,P,W,k.frontUVs||null,k.backUVs||null,k.firstNormal||null,!!k.adjustFrame,s)}function B(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=k.path,Q=k.shape,G=k.scaleFunction||(()=>1),w=k.rotationFunction||(()=>0),E=k.closePath||k.ribbonCloseArray||!1,I=k.closeShape||k.ribbonClosePath||!1,S=0===k.cap?0:k.cap||K.b.NO_CAP,P=k.updatable,W=k.firstNormal||null,J=k.adjustFrame||!1,H=K.b._GetDefaultSideOrientation(k.sideOrientation),s=k.instance,b=k.invertUV||!1,C=k.capFunction||null;return t(n,Q,c,null,null,G,w,E,I,S,!0,T,!!P,H,s||null,b,k.frontUVs||null,k.backUVs||null,W,J,C||null)}function t(n,k,T,Q,G,w,E,S,P,W,J,H,s,b,C,z,r,q,O,u,f){const A=(n,k,T,Q,G,w,E,I,S,P,W)=>{const J=T.getTangents(),H=T.getNormals(),s=T.getBinormals(),b=T.getDistances();if(W)for(let K=0;K<J.length;K++)if(0==J[K].x&&0==J[K].y&&0==J[K].z&&J[K].p(J[K-1]),0==H[K].x&&0==H[K].y&&0==H[K].z&&H[K].p(H[K-1]),0==s[K].x&&0==s[K].y&&0==s[K].z&&s[K].p(s[K-1]),K>0){let n=J[K-1];c.o.Dot(n,J[K])<0&&J[K].scaleInPlace(-1),n=H[K-1],c.o.Dot(n,H[K])<0&&H[K].scaleInPlace(-1),n=s[K-1],c.o.Dot(n,s[K])<0&&s[K].scaleInPlace(-1)}let C=0;const z=P&&I?I:()=>null!==w?w:0,r=P&&E?E:()=>null!==G?G:1;let q=S===K.b.NO_CAP||S===K.b.CAP_END?0:2;const O=c.l.Matrix[0];for(let K=0;K<k.length;K++){const T=[],G=z(K,b[K]),w=r(K,b[K]);c.d.RotationAxisToRef(J[K],C,O);for(let Q=0;Q<n.length;Q++){const G=J[K].scale(n[Q].z).add(H[K].scale(n[Q].x)).add(s[K].scale(n[Q].y)),E=c.o.Zero();c.o.TransformCoordinatesToRef(G,O,E),E.scaleInPlace(w).addInPlace(k[K]),T[Q]=E}Q[q]=T,C+=G,q++}const u=f||(n=>{const k=Array(),T=c.o.Zero();let K;for(K=0;K<n.length;K++)T.addInPlace(n[K]);for(T.scaleInPlace(1/n.length),K=0;K<n.length;K++)k.push(T);return k});switch(S){case K.b.NO_CAP:break;case K.b.CAP_START:Q[0]=u(Q[2]),Q[1]=Q[2];break;case K.b.CAP_END:Q[q]=Q[q-1],Q[q+1]=u(Q[q-1]);break;case K.b.CAP_ALL:Q[0]=u(Q[2]),Q[1]=Q[2],Q[q]=Q[q-1],Q[q+1]=u(Q[q-1])}return Q};let v,F;if(C){const n=C._creationDataStorage;return v=O?n.path3D.update(T,O):n.path3D.update(T),F=A(k,T,n.path3D,n.pathArray,Q,G,w,E,n.cap,J,u),C=I("",{pathArray:F,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:C},H||void 0)}v=O?new x.f(T,O):new x.f(T);F=A(k,T,v,new Array,Q,G,w,E,W=W<0||W>3?0:W,J,u);const m=I(n,{pathArray:F,closeArray:S,closePath:P,updatable:s,sideOrientation:b,invertUV:z,frontUVs:r||void 0,backUVs:q||void 0},H);return m._creationDataStorage.pathArray=F,m._creationDataStorage.path3D=v,m._creationDataStorage.cap=W,m}G.e.CreatePolygon=e,K.b.CreatePolygon=function(n,k,T,c,K,Q){return d(n,{shape:k,holes:c,updatable:K,sideOrientation:Q},T,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},K.b.ExtrudePolygon=function(n,k,T,c,K,Q,G){return l(n,{shape:k,holes:K,depth:T,updatable:Q,sideOrientation:G},c,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function M(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=k.arc?k.arc<=0||k.arc>1?1:k.arc:1,G=void 0===k.closed||k.closed,w=k.shape,E=k.radius||1,S=k.tessellation||64,P=k.clip||0,W=k.updatable,J=K.b._GetDefaultSideOrientation(k.sideOrientation),H=k.cap||K.b.NO_CAP,s=2*Math.PI,b=[],C=k.invertUV||!1;let z=0,r=0;const q=s/S*Q;let O,u;for(z=0;z<=S-P;z++){for(u=[],H!=K.b.CAP_START&&H!=K.b.CAP_ALL||(u.push(new c.o(0,w[0].y,0)),u.push(new c.o(Math.cos(z*q)*w[0].x*E,w[0].y,Math.sin(z*q)*w[0].x*E))),r=0;r<w.length;r++)O=new c.o(Math.cos(z*q)*w[r].x*E,w[r].y,Math.sin(z*q)*w[r].x*E),u.push(O);H!=K.b.CAP_END&&H!=K.b.CAP_ALL||(u.push(new c.o(Math.cos(z*q)*w[w.length-1].x*E,w[w.length-1].y,Math.sin(z*q)*w[w.length-1].x*E)),u.push(new c.o(0,w[w.length-1].y,0))),b.push(u)}return I(n,{pathArray:b,closeArray:G,sideOrientation:J,updatable:W,invertUV:C,frontUVs:k.frontUVs,backUVs:k.backUVs},T)}K.b.ExtrudeShape=function(n,k,T,c,Q,G){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0,S=arguments.length>9?arguments[9]:void 0;return i(n,{shape:k,path:T,scale:c,rotation:Q,cap:0===G?0:G||K.b.NO_CAP,sideOrientation:I,instance:S,updatable:E},w)},K.b.ExtrudeShapeCustom=(n,k,T,c,Q,G,w,E,I,S,P,W)=>B(n,{shape:k,path:T,scaleFunction:c,rotationFunction:Q,ribbonCloseArray:G,ribbonClosePath:w,cap:0===E?0:E||K.b.NO_CAP,sideOrientation:P,instance:W,updatable:S},I);K.b.CreateLathe=(n,k,T,c,K,Q,G)=>M(n,{shape:k,radius:T,tessellation:c,sideOrientation:G,updatable:Q},K);var o=T(12325),D=T(12281);function R(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=k.path;let G=k.instance,w=1;void 0!==k.radius?w=k.radius:G&&(w=G._creationDataStorage.radius);const E=k.tessellation||64,S=k.radiusFunction||null;let P=k.cap||K.b.NO_CAP;const W=k.invertUV||!1,J=k.updatable,H=K.b._GetDefaultSideOrientation(k.sideOrientation);k.arc=k.arc&&(k.arc<=0||k.arc>1)?1:k.arc||1;const s=(n,k,T,Q,G,w,E,I)=>{const S=k.getTangents(),P=k.getNormals(),W=k.getDistances(),J=2*Math.PI/G*I,H=w||(()=>Q);let s,b,C,z;const r=c.l.Matrix[0];let q=E===K.b.NO_CAP||E===K.b.CAP_END?0:2;for(let K=0;K<n.length;K++){b=H(K,W[K]),s=Array(),C=P[K];for(let k=0;k<G;k++)c.d.RotationAxisToRef(S[K],J*k,r),z=s[k]?s[k]:c.o.Zero(),c.o.TransformCoordinatesToRef(C,r,z),z.scaleInPlace(b).addInPlace(n[K]),s[k]=z;T[q]=s,q++}const O=(k,T)=>{const c=Array();for(let K=0;K<k;K++)c.push(n[T]);return c};switch(E){case K.b.NO_CAP:break;case K.b.CAP_START:T[0]=O(G,0),T[1]=T[2].slice(0);break;case K.b.CAP_END:T[q]=T[q-1].slice(0),T[q+1]=O(G,n.length-1);break;case K.b.CAP_ALL:T[0]=O(G,0),T[1]=T[2].slice(0),T[q]=T[q-1].slice(0),T[q+1]=O(G,n.length-1)}return T};let b,C;if(G){const n=G._creationDataStorage,T=k.arc||n.arc;return b=n.path3D.update(Q),C=s(Q,b,n.pathArray,w,n.tessellation,S,n.cap,T),G=I("",{pathArray:C,instance:G}),n.path3D=b,n.pathArray=C,n.arc=T,n.radius=w,G}b=new x.f(Q);P=P<0||P>3?0:P,C=s(Q,b,new Array,w,E,S,P,k.arc);const z=I(n,{pathArray:C,closePath:!0,closeArray:!1,updatable:J,sideOrientation:H,invertUV:W,frontUVs:k.frontUVs,backUVs:k.backUVs},T);return z._creationDataStorage.pathArray=C,z._creationDataStorage.path3D=b,z._creationDataStorage.tessellation=E,z._creationDataStorage.cap=P,z._creationDataStorage.arc=k.arc,z._creationDataStorage.radius=w,z}function L(n){const k=[];k[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},k[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},k[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},k[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},k[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},k[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},k[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},k[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},k[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},k[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},k[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},k[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},k[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},k[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},k[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const T=n.type&&(n.type<0||n.type>=k.length)?0:n.type||0,K=n.size,Q=n.sizeX||K||1,E=n.sizeY||K||1,I=n.sizeZ||K||1,S=n.custom||k[T],P=S.face.length,J=n.faceUV||new Array(P),H=n.faceColors,s=void 0===n.flat||n.flat,b=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE,C=[],z=[],r=[],q=[],O=[];let u=0,f=0;const A=[];let v,F,m,x,g,U,V=0,Y=0;if(s)for(Y=0;Y<P;Y++)H&&void 0===H[Y]&&(H[Y]=new W.g(1,1,1,1)),J&&void 0===J[Y]&&(J[Y]=new c.p(0,0,1,1));if(s)for(Y=0;Y<P;Y++){const n=S.face[Y].length;for(m=2*Math.PI/n,x=.5*Math.tan(m/2),g=.5,V=0;V<n;V++)C.push(S.vertex[S.face[Y][V]][0]*Q,S.vertex[S.face[Y][V]][1]*E,S.vertex[S.face[Y][V]][2]*I),A.push(u),u++,v=J[Y].x+(J[Y].z-J[Y].x)*(.5+x),F=J[Y].y+(J[Y].w-J[Y].y)*(g-.5),q.push(v,w.e?1-F:F),U=x*Math.cos(m)-g*Math.sin(m),g=x*Math.sin(m)+g*Math.cos(m),x=U,H&&O.push(H[Y].r,H[Y].g,H[Y].b,H[Y].a);for(V=0;V<n-2;V++)z.push(A[0+f],A[V+2+f],A[V+1+f]);f+=n}else{for(V=0;V<S.vertex.length;V++)C.push(S.vertex[V][0]*Q,S.vertex[V][1]*E,S.vertex[V][2]*I),q.push(0,w.e?1:0);for(Y=0;Y<P;Y++)for(V=0;V<S.face[Y].length-2;V++)z.push(S.face[Y][0],S.face[Y][V+2],S.face[Y][V+1])}G.e.ComputeNormals(C,z,r),G.e._ComputeSides(b,C,z,r,q,n.frontUVs,n.backUVs);const Z=new G.e;return Z.xa=C,Z.indices=z,Z.ya=r,Z.Aa=q,H&&s&&(Z.za=O),Z}function h(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return L(k).Ca(c,k.updatable),c}K.b.CreateTube=(n,k,T,c,K,Q,G,w,E,I)=>R(n,{path:k,radius:T,tessellation:c,radiusFunction:K,arc:1,cap:Q,updatable:w,sideOrientation:E,instance:I},G);function j(n){const k=n.sideOrientation||G.e.DEFAULTSIDE,T=n.radius||1,K=void 0===n.flat||n.flat,Q=0|(n.subdivisions||4),E=n.radiusX||T,I=n.radiusY||T,S=n.radiusZ||T,P=(1+Math.sqrt(5))/2,W=[-1,P,-0,1,P,0,-1,-P,0,1,-P,0,0,-1,-P,0,1,-P,0,-1,P,0,1,P,P,0,1,P,0,-1,-P,0,1,-P,0,-1],J=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],H=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],s=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],b=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],C=[],z=[],r=[],q=[];let O=0;const u=new Array(3),f=new Array(3);let A;for(A=0;A<3;A++)u[A]=c.o.Zero(),f[A]=c.m.Zero();for(let G=0;G<20;G++){for(A=0;A<3;A++){const n=J[3*G+A];u[A].di(W[3*H[n]],W[3*H[n]+1],W[3*H[n]+2]),u[A].normalize(),f[A].di(.134765625*s[2*n]+.05859375+-.0390625*b[G],.2333984375*s[2*n+1]+.025390625+.01953125*b[G])}const n=(n,k,T,G)=>{const P=c.o.Lerp(u[0],u[2],k/Q),W=c.o.Lerp(u[1],u[2],k/Q),J=Q===k?u[2]:c.o.Lerp(P,W,n/(Q-k));let H;if(J.normalize(),K){const n=c.o.Lerp(u[0],u[2],G/Q),k=c.o.Lerp(u[1],u[2],G/Q);H=c.o.Lerp(n,k,T/(Q-G))}else H=new c.o(J.x,J.y,J.z);H.x/=E,H.y/=I,H.z/=S,H.normalize();const s=c.m.Lerp(f[0],f[2],k/Q),b=c.m.Lerp(f[1],f[2],k/Q),A=Q===k?f[2]:c.m.Lerp(s,b,n/(Q-k));z.push(J.x*E,J.y*I,J.z*S),r.push(H.x,H.y,H.z),q.push(A.x,w.e?1-A.y:A.y),C.push(O),O++};for(let k=0;k<Q;k++)for(let T=0;T+k<Q;T++)n(T,k,T+1/3,k+1/3),n(T+1,k,T+1/3,k+1/3),n(T,k+1,T+1/3,k+1/3),T+k+1<Q&&(n(T+1,k,T+2/3,k+2/3),n(T+1,k+1,T+2/3,k+2/3),n(T,k+1,T+2/3,k+2/3))}G.e._ComputeSides(k,z,C,r,q,n.frontUVs,n.backUVs);const v=new G.e;return v.indices=C,v.xa=z,v.ya=r,v.Aa=q,v}function p(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new K.b(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),c._originalBuilderSideOrientation=k.sideOrientation;return j(k).Ca(c,k.updatable),c}G.e.CreatePolyhedron=L,K.b.CreatePolyhedron=(n,k,T)=>h(n,k,T);G.e.CreateIcoSphere=j,K.b.CreateIcoSphere=(n,k,T)=>p(n,k,T);var a=T(747);const X=new c.o(1,0,0),y=new c.o(-1,0,0),N=new c.o(0,1,0),nn=new c.o(0,-1,0),kn=new c.o(0,0,1),Tn=new c.o(0,0,-1);class cn{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.o.Zero(),k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.o.Up(),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.m.Zero(),K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=n,this.Pi=k,this.uv=T,this.vertexIdx=K,this.vertexIdxForBones=Q,this.localPositionOverride=G,this.localNormalOverride=w,this.matrixIndicesOverride=E,this.matrixWeightsOverride=I}clone(){var n,k,T,c;return new cn(this.position.clone(),this.Pi.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(n=this.localPositionOverride)||void 0===n?void 0:n.slice(),null===(k=this.localNormalOverride)||void 0===k?void 0:k.slice(),null===(T=this.matrixIndicesOverride)||void 0===T?void 0:T.slice(),null===(c=this.matrixWeightsOverride)||void 0===c?void 0:c.slice())}}function Kn(n,k,T){var E,I,S,P,W;const J=!!k.skeleton,H=!(null===(E=k.morphTargetManager)||void 0===E||!E.numTargets),s=T.localMode||J,b=k.qi(),C=J||H?k.Kf(!0,!0):k.getVerticesData(Q.f.PositionKind),z=J||H?k.getNormalsData(!0,!0):k.getVerticesData(Q.f.NormalKind),r=s?J?k.getVerticesData(Q.f.PositionKind):C:null,q=s?J?k.getVerticesData(Q.f.NormalKind):z:null,O=k.getVerticesData(Q.f.UVKind),u=J?k.getVerticesData(Q.f.MatricesIndicesKind):null,f=J?k.getVerticesData(Q.f.MatricesWeightsKind):null,A=J?k.getVerticesData(Q.f.MatricesIndicesExtraKind):null,v=J?k.getVerticesData(Q.f.MatricesWeightsExtraKind):null,F=T.position||c.o.Zero();let m=T.Pi||c.o.Up();const x=T.size||c.o.One(),g=T.angle||0;if(!m){const n=new c.o(0,0,1),T=k.va().activeCamera,K=c.o.TransformCoordinates(n,T.getWorldMatrix());m=T.globalPosition.Fg(K)}const U=-Math.atan2(m.z,m.x)-Math.PI/2,V=Math.sqrt(m.x*m.x+m.z*m.z),Y=Math.atan2(m.y,V),Z=new G.e;Z.indices=[],Z.xa=[],Z.ya=[],Z.Aa=[],Z.matricesIndices=J?[]:null,Z.matricesWeights=J?[]:null,Z.matricesIndicesExtra=A?[]:null,Z.matricesWeightsExtra=v?[]:null;let e=0;const d=(n,k)=>{const K=new cn;if(!b||!C||!z)return K;const Q=b[n];if(K.vertexIdx=3*Q,K.vertexIdxForBones=4*Q,K.position=new c.o(C[3*Q],C[3*Q+1],C[3*Q+2]),c.o.TransformCoordinatesToRef(K.position,k,K.position),K.Pi=new c.o(z[3*Q],z[3*Q+1],z[3*Q+2]),c.o.TransformNormalToRef(K.Pi,k,K.Pi),T.captureUVS&&O){const n=O[2*Q+1];K.uv=new c.m(O[2*Q],w.e?1-n:n)}return K},l=[0,0,0,0],i=(n,k)=>{if(0===n.length)return n;const T=.5*Math.abs(c.o.Dot(x,k)),K=(n,k,T,c)=>{for(let K=0;K<c;++K)if(n[T+K]===k)return T+K;return-1},Q=(n,Q)=>{const G=c.o.GetClipFactor(n.position,Q.position,k,T);let w=l,E=l;if(u&&f){const k=n.matrixIndicesOverride?0:n.vertexIdxForBones,T=n.matrixIndicesOverride??u,c=n.matrixWeightsOverride??f,I=Q.matrixIndicesOverride?0:Q.vertexIdxForBones,S=Q.matrixIndicesOverride??u,P=Q.matrixWeightsOverride??f;w=[0,0,0,0],E=[0,0,0,0];let W=0;for(let n=0;n<4;++n)if(c[k+n]>0){const Q=K(S,T[k+n],I,4);w[W]=T[k+n],E[W]=(0,a.i)(c[k+n],Q>=0?P[Q]:0,G),W++}for(let n=0;n<4&&W<4;++n){const c=S[I+n];-1===K(T,c,k,4)&&(w[W]=c,E[W]=(0,a.i)(0,P[I+n],G),W++)}const J=E[0]+E[1]+E[2]+E[3];E[0]/=J,E[1]/=J,E[2]/=J,E[3]/=J}const I=n.localPositionOverride?n.localPositionOverride[0]:(null===r||void 0===r?void 0:r[n.vertexIdx])??0,S=n.localPositionOverride?n.localPositionOverride[1]:(null===r||void 0===r?void 0:r[n.vertexIdx+1])??0,P=n.localPositionOverride?n.localPositionOverride[2]:(null===r||void 0===r?void 0:r[n.vertexIdx+2])??0,W=Q.localPositionOverride?Q.localPositionOverride[0]:(null===r||void 0===r?void 0:r[Q.vertexIdx])??0,J=Q.localPositionOverride?Q.localPositionOverride[1]:(null===r||void 0===r?void 0:r[Q.vertexIdx+1])??0,H=Q.localPositionOverride?Q.localPositionOverride[2]:(null===r||void 0===r?void 0:r[Q.vertexIdx+2])??0,s=n.localNormalOverride?n.localNormalOverride[0]:(null===q||void 0===q?void 0:q[n.vertexIdx])??0,b=n.localNormalOverride?n.localNormalOverride[1]:(null===q||void 0===q?void 0:q[n.vertexIdx+1])??0,C=n.localNormalOverride?n.localNormalOverride[2]:(null===q||void 0===q?void 0:q[n.vertexIdx+2])??0,z=s+((Q.localNormalOverride?Q.localNormalOverride[0]:(null===q||void 0===q?void 0:q[Q.vertexIdx])??0)-s)*G,O=b+((Q.localNormalOverride?Q.localNormalOverride[1]:(null===q||void 0===q?void 0:q[Q.vertexIdx+1])??0)-b)*G,A=C+((Q.localNormalOverride?Q.localNormalOverride[2]:(null===q||void 0===q?void 0:q[Q.vertexIdx+2])??0)-C)*G,v=Math.sqrt(z*z+O*O+A*A);return new cn(c.o.Lerp(n.position,Q.position,G),c.o.Lerp(n.Pi,Q.Pi,G).normalize(),c.m.Lerp(n.uv,Q.uv,G),-1,-1,r?[I+(W-I)*G,S+(J-S)*G,P+(H-P)*G]:null,q?[z/v,O/v,A/v]:null,w,E)};let G=null;n.length>3&&(G=[]);for(let w=0;w<n.length;w+=3){let K=0,E=null,I=null,S=null,P=null;const W=c.o.Dot(n[w].position,k)-T>0,J=c.o.Dot(n[w+1].position,k)-T>0,H=c.o.Dot(n[w+2].position,k)-T>0;switch(K=(W?1:0)+(J?1:0)+(H?1:0),K){case 0:n.length>3?(G.push(n[w]),G.push(n[w+1]),G.push(n[w+2])):G=n;break;case 1:if(G=G??new Array,W&&(E=n[w+1],I=n[w+2],S=Q(n[w],E),P=Q(n[w],I)),J){E=n[w],I=n[w+2],S=Q(n[w+1],E),P=Q(n[w+1],I),G.push(S),G.push(I.clone()),G.push(E.clone()),G.push(I.clone()),G.push(S.clone()),G.push(P);break}H&&(E=n[w],I=n[w+1],S=Q(n[w+2],E),P=Q(n[w+2],I)),E&&I&&S&&P&&(G.push(E.clone()),G.push(I.clone()),G.push(S),G.push(P),G.push(S.clone()),G.push(I.clone()));break;case 2:G=G??new Array,W||(E=n[w].clone(),I=Q(E,n[w+1]),S=Q(E,n[w+2]),G.push(E),G.push(I),G.push(S)),J||(E=n[w+1].clone(),I=Q(E,n[w+2]),S=Q(E,n[w]),G.push(E),G.push(I),G.push(S)),H||(E=n[w+2].clone(),I=Q(E,n[w]),S=Q(E,n[w+1]),G.push(E),G.push(I),G.push(S))}}return G},B=k instanceof K.b?k:null,t=null===B||void 0===B?void 0:B._thinInstanceDataStorage.matrixData,M=(null===B||void 0===B?void 0:B.gi)||1,o=c.l.Matrix[0];o.p(c.d.IdentityReadOnly);for(let K=0;K<M;++K){if(null!==B&&void 0!==B&&B.hasThinInstances&&t){const n=16*K;o.setRowFromFloats(0,t[n+0],t[n+1],t[n+2],t[n+3]),o.setRowFromFloats(1,t[n+4],t[n+5],t[n+6],t[n+7]),o.setRowFromFloats(2,t[n+8],t[n+9],t[n+10],t[n+11]),o.setRowFromFloats(3,t[n+12],t[n+13],t[n+14],t[n+15])}const n=c.d.RotationYawPitchRoll(U,Y,g).multiply(c.d.Translation(F.x,F.y,F.z)),Q=c.d.Invert(n),G=k.getWorldMatrix(),E=o.multiply(G).multiply(Q),I=new Array(3);for(let k=0;k<b.length;k+=3){let n=I;if(n[0]=d(k,E),n[1]=d(k+1,E),n[2]=d(k+2,E),!(T.cullBackFaces&&-n[0].Pi.z<=0&&-n[1].Pi.z<=0&&-n[2].Pi.z<=0)&&(n=i(n,X),n&&(n=i(n,y),n&&(n=i(n,N),n&&(n=i(n,nn),n&&(n=i(n,kn),n&&(n=i(n,Tn),n)))))))for(let k=0;k<n.length;k++){const c=n[k];if(Z.indices.push(e),s?(c.localPositionOverride?(Z.xa[3*e]=c.localPositionOverride[0],Z.xa[3*e+1]=c.localPositionOverride[1],Z.xa[3*e+2]=c.localPositionOverride[2]):r&&(Z.xa[3*e]=r[c.vertexIdx],Z.xa[3*e+1]=r[c.vertexIdx+1],Z.xa[3*e+2]=r[c.vertexIdx+2]),c.localNormalOverride?(Z.ya[3*e]=c.localNormalOverride[0],Z.ya[3*e+1]=c.localNormalOverride[1],Z.ya[3*e+2]=c.localNormalOverride[2]):q&&(Z.ya[3*e]=q[c.vertexIdx],Z.ya[3*e+1]=q[c.vertexIdx+1],Z.ya[3*e+2]=q[c.vertexIdx+2])):(c.position.toArray(Z.xa,3*e),c.Pi.toArray(Z.ya,3*e)),Z.matricesIndices&&Z.matricesWeights&&(c.matrixIndicesOverride?(Z.matricesIndices[4*e]=c.matrixIndicesOverride[0],Z.matricesIndices[4*e+1]=c.matrixIndicesOverride[1],Z.matricesIndices[4*e+2]=c.matrixIndicesOverride[2],Z.matricesIndices[4*e+3]=c.matrixIndicesOverride[3]):(u&&(Z.matricesIndices[4*e]=u[c.vertexIdxForBones],Z.matricesIndices[4*e+1]=u[c.vertexIdxForBones+1],Z.matricesIndices[4*e+2]=u[c.vertexIdxForBones+2],Z.matricesIndices[4*e+3]=u[c.vertexIdxForBones+3]),A&&Z.matricesIndicesExtra&&(Z.matricesIndicesExtra[4*e]=A[c.vertexIdxForBones],Z.matricesIndicesExtra[4*e+1]=A[c.vertexIdxForBones+1],Z.matricesIndicesExtra[4*e+2]=A[c.vertexIdxForBones+2],Z.matricesIndicesExtra[4*e+3]=A[c.vertexIdxForBones+3])),c.matrixWeightsOverride?(Z.matricesWeights[4*e]=c.matrixWeightsOverride[0],Z.matricesWeights[4*e+1]=c.matrixWeightsOverride[1],Z.matricesWeights[4*e+2]=c.matrixWeightsOverride[2],Z.matricesWeights[4*e+3]=c.matrixWeightsOverride[3]):(f&&(Z.matricesWeights[4*e]=f[c.vertexIdxForBones],Z.matricesWeights[4*e+1]=f[c.vertexIdxForBones+1],Z.matricesWeights[4*e+2]=f[c.vertexIdxForBones+2],Z.matricesWeights[4*e+3]=f[c.vertexIdxForBones+3]),v&&Z.matricesWeightsExtra&&(Z.matricesWeightsExtra[4*e]=v[c.vertexIdxForBones],Z.matricesWeightsExtra[4*e+1]=v[c.vertexIdxForBones+1],Z.matricesWeightsExtra[4*e+2]=v[c.vertexIdxForBones+2],Z.matricesWeightsExtra[4*e+3]=v[c.vertexIdxForBones+3]))),T.captureUVS)c.uv.toArray(Z.Aa,2*e);else{Z.Aa.push(.5+c.position.x/x.x);const n=.5+c.position.y/x.y;Z.Aa.push(w.e?1-n:n)}e++}}}0===Z.indices.length&&(Z.indices=null),0===Z.xa.length&&(Z.xa=null),0===Z.ya.length&&(Z.ya=null),0===Z.Aa.length&&(Z.Aa=null),0===(null===(I=Z.matricesIndices)||void 0===I?void 0:I.length)&&(Z.matricesIndices=null),0===(null===(S=Z.matricesWeights)||void 0===S?void 0:S.length)&&(Z.matricesWeights=null),0===(null===(P=Z.matricesIndicesExtra)||void 0===P?void 0:P.length)&&(Z.matricesIndicesExtra=null),0===(null===(W=Z.matricesWeightsExtra)||void 0===W?void 0:W.length)&&(Z.matricesWeightsExtra=null);const D=new K.b(n,k.va());return Z.Ca(D),s?(D.skeleton=k.skeleton,D.parent=k):(D.position=F.clone(),D.rotation=new c.o(Y,U,g)),D.pi(!0),D.refreshBoundingInfo(!0,!0),D}function Qn(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const k=0|Math.max(n.subdivisions?n.subdivisions:2,1),T=0|Math.max(n.tessellation?n.tessellation:16,3),K=Math.max(n.height?n.height:1,0),Q=Math.max(n.radius?n.radius:.25,0),E=0|Math.max(n.capSubdivisions?n.capSubdivisions:6,1),I=T,S=k,P=Math.max(n.radiusTop?n.radiusTop:Q,0),W=Math.max(n.radiusBottom?n.radiusBottom:Q,0),J=K-(P+W),H=2*Math.PI,s=Math.max(n.topCapSubdivisions?n.topCapSubdivisions:E,1),b=Math.max(n.bottomCapSubdivisions?n.bottomCapSubdivisions:E,1),C=Math.acos((W-P)/K);let z=[];const r=[],q=[],O=[];let u=0;const f=[],A=.5*J,v=.5*Math.PI;let F,m;const x=c.o.Zero(),g=c.o.Zero(),U=Math.cos(C),V=Math.sin(C),Y=new c.m(P*V,A+P*U).Fg(new c.m(W*V,W*U-A)).length(),Z=P*C+Y+W*(v-C);let e=0;for(m=0;m<=s;m++){const n=[],k=v-C*(m/s);e+=P*C/s;const T=Math.cos(k),c=Math.sin(k),K=T*P;for(F=0;F<=I;F++){const k=F/I,Q=k*H+0,G=Math.sin(Q),E=Math.cos(Q);g.x=K*G,g.y=A+c*P,g.z=K*E,r.push(g.x,g.y,g.z),x.set(T*G,c,T*E),q.push(x.x,x.y,x.z),O.push(k,w.e?e/Z:1-e/Z),n.push(u),u++}f.push(n)}const d=K-P-W+U*P-U*W,l=V*(W-P)/d;for(m=1;m<=S;m++){const n=[];e+=Y/S;const k=V*(m*(W-P)/S+P);for(F=0;F<=I;F++){const T=F/I,c=T*H+0,K=Math.sin(c),Q=Math.cos(c);g.x=k*K,g.y=A+U*P-m*d/S,g.z=k*Q,r.push(g.x,g.y,g.z),x.set(K,l,Q).normalize(),q.push(x.x,x.y,x.z),O.push(T,w.e?e/Z:1-e/Z),n.push(u),u++}f.push(n)}for(m=1;m<=b;m++){const n=[],k=v-C-(Math.PI-C)*(m/b);e+=W*C/b;const T=Math.cos(k),c=Math.sin(k),K=T*W;for(F=0;F<=I;F++){const k=F/I,Q=k*H+0,G=Math.sin(Q),E=Math.cos(Q);g.x=K*G,g.y=c*W-A,g.z=K*E,r.push(g.x,g.y,g.z),x.set(T*G,c,T*E),q.push(x.x,x.y,x.z),O.push(k,w.e?e/Z:1-e/Z),n.push(u),u++}f.push(n)}for(F=0;F<I;F++)for(m=0;m<s+S+b;m++){const n=f[m][F],k=f[m+1][F],T=f[m+1][F+1],c=f[m][F+1];z.push(n),z.push(k),z.push(c),z.push(k),z.push(T),z.push(c)}if(z=z.reverse(),n.orientation&&!n.orientation.equals(c.o.Up())){const k=new c.d;n.orientation.clone().scale(.5*Math.PI).cross(c.o.Up()).toQuaternion().toRotationMatrix(k);const T=c.o.Zero();for(let n=0;n<r.length;n+=3)T.set(r[n],r[n+1],r[n+2]),c.o.TransformCoordinatesToRef(T.clone(),k,T),r[n]=T.x,r[n+1]=T.y,r[n+2]=T.z}const i=new G.e;return i.xa=r,i.ya=q,i.Aa=O,i.indices=z,i}function Gn(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:c.o.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new K.b(n,T);return Qn(k).Ca(Q,k.updatable),Q}K.b.CreateDecal=(n,k,T,c,K,Q)=>Kn(n,k,{position:T,Pi:c,size:K,angle:Q});K.b.CreateCapsule=(n,k,T)=>Gn(n,k,T),G.e.CreateCapsule=Qn;class wn{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=n,this.y=k,n!==Math.floor(n)&&(n=Math.floor(n),m.d.Warn("x is not an integer, floor(x) used")),k!==Math.floor(k)&&(k=Math.floor(k),m.d.Warn("y is not an integer, floor(y) used"))}clone(){return new wn(this.x,this.y)}rotate60About(n){const k=this.x;return this.x=n.x+n.y-this.y,this.y=k+this.y-n.x,this}rotateNeg60About(n){const k=this.x;return this.x=k+this.y-n.y,this.y=n.x+n.y-k,this}rotate120(n,k){n!==Math.floor(n)&&(n=Math.floor(n),m.d.Warn("m not an integer only floor(m) used")),k!==Math.floor(k)&&(k=Math.floor(k),m.d.Warn("n not an integer only floor(n) used"));const T=this.x;return this.x=n-T-this.y,this.y=k+T,this}rotateNeg120(n,k){n!==Math.floor(n)&&(n=Math.floor(n),m.d.Warn("m is not an integer, floor(m) used")),k!==Math.floor(k)&&(k=Math.floor(k),m.d.Warn("n is not an integer,   floor(n) used"));const T=this.x;return this.x=this.y-k,this.y=n+k-T-this.y,this}toCartesianOrigin(n,k){const T=c.o.Zero();return T.x=n.x+2*this.x*k+this.y*k,T.y=n.y+Math.sqrt(3)*this.y*k,T}static Zero(){return new wn(0,0)}}class En{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new In("icosahedron","Regular",[[0,g.d,-1],[-g.d,1,0],[-1,0,-g.d],[1,0,-g.d],[g.d,1,0],[0,g.d,1],[-1,0,g.d],[-g.d,-1,0],[0,-g.d,-1],[g.d,-1,0],[1,0,g.d],[0,-g.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let n=12;const k={},T=this.m,c=this.n;let K,Q,G,w,E,I=T,S=1,P=0;0!==c&&(I=(0,a.e)(T,c)),S=T/I,P=c/I;const W=wn.Zero(),J=new wn(T,c),H=new wn(-c,T+c),s=wn.Zero(),b=wn.Zero(),C=wn.Zero();let z,r,q,O,u=[];const f=[],A=this.vertByDist,v=(T,c,K,Q)=>{z=T+"|"+K,r=c+"|"+Q,z in k||r in k?z in k&&!(r in k)?k[r]=k[z]:r in k&&!(z in k)&&(k[z]=k[r]):(k[z]=n,k[r]=n,n++),A[K][0]>2?f[k[z]]=[-A[K][0],A[K][1],k[z]]:f[k[z]]=[u[A[K][0]],A[K][1],k[z]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let F=0;F<20;F++){if(u=this.IDATA.face[F],G=u[2],w=u[1],E=u[0],q=W.x+"|"+W.y,z=F+"|"+q,z in k||(k[z]=G,f[G]=[u[A[q][0]],A[q][1]]),q=J.x+"|"+J.y,z=F+"|"+q,z in k||(k[z]=w,f[w]=[u[A[q][0]],A[q][1]]),q=H.x+"|"+H.y,z=F+"|"+q,z in k||(k[z]=E,f[E]=[u[A[q][0]],A[q][1]]),K=this.IDATA.edgematch[F][0],Q=this.IDATA.edgematch[F][1],"B"===Q)for(let n=1;n<I;n++)b.x=T-n*(S+P),b.y=c+n*S,C.x=-n*P,C.y=n*(S+P),q=b.x+"|"+b.y,O=C.x+"|"+C.y,v(F,K,q,O);if("O"===Q)for(let n=1;n<I;n++)C.x=-n*P,C.y=n*(S+P),s.x=n*S,s.y=n*P,q=C.x+"|"+C.y,O=s.x+"|"+s.y,v(F,K,q,O);if(K=this.IDATA.edgematch[F][2],Q=this.IDATA.edgematch[F][3],Q&&"A"===Q)for(let n=1;n<I;n++)s.x=n*S,s.y=n*P,b.x=T-(I-n)*(S+P),b.y=c+(I-n)*S,q=s.x+"|"+s.y,O=b.x+"|"+b.y,v(F,K,q,O);for(let T=0;T<this.vertices.length;T++)q=this.vertices[T].x+"|"+this.vertices[T].y,z=F+"|"+q,z in k||(k[z]=n++,A[q][0]>2?f[k[z]]=[-A[q][0],A[q][1],k[z]]:f[k[z]]=[u[A[q][0]],A[q][1],k[z]])}this.closestTo=f,this.vecToidx=k}calcCoeffs(){const n=this.m,k=this.n,T=Math.sqrt(3)/3,c=n*n+k*k+n*k;this.coau=(n+k)/c,this.cobu=-k/c,this.coav=-T*(n-k)/c,this.cobv=T*(2*n+k)/c}createInnerFacets(){const n=this.m,k=this.n;for(let T=0;T<k+n+1;T++)for(let n=this.min[T];n<this.max[T]+1;n++)n<this.max[T]&&n<this.max[T+1]+1&&this.innerFacets.push(["|"+n+"|"+T,"|"+n+"|"+(T+1),"|"+(n+1)+"|"+T]),T>0&&n<this.max[T-1]&&n+1<this.max[T]+1&&this.innerFacets.push(["|"+n+"|"+T,"|"+(n+1)+"|"+T,"|"+(n+1)+"|"+(T-1)])}edgeVecsABOB(){const n=this.m,k=this.n,T=new wn(-k,n+k);for(let c=1;c<n+k;c++){const n=new wn(this.min[c],c),k=new wn(this.min[c-1],c-1),K=new wn(this.min[c+1],c+1),Q=n.clone(),G=k.clone(),w=K.clone();Q.rotate60About(T),G.rotate60About(T),w.rotate60About(T);const E=new wn(this.max[Q.y],Q.y),I=new wn(this.max[Q.y-1],Q.y-1),S=new wn(this.max[Q.y-1]-1,Q.y-1);Q.x===E.x&&Q.y===E.y||(Q.x!==I.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,I,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,S,E])):Q.y===w.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([n,k,I]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([n,I,K])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([n,k,I]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,I,E])))}}mapABOBtoOBOA(){const n=new wn(0,0);for(let k=0;k<this.isoVecsABOB.length;k++){const T=[];for(let c=0;c<3;c++)n.x=this.isoVecsABOB[k][c].x,n.y=this.isoVecsABOB[k][c].y,0===this.vertexTypes[k][c]&&n.rotateNeg120(this.m,this.n),T.push(n.clone());this.isoVecsOBOA.push(T)}}mapABOBtoBAOA(){const n=new wn(0,0);for(let k=0;k<this.isoVecsABOB.length;k++){const T=[];for(let c=0;c<3;c++)n.x=this.isoVecsABOB[k][c].x,n.y=this.isoVecsABOB[k][c].y,1===this.vertexTypes[k][c]&&n.rotate120(this.m,this.n),T.push(n.clone());this.isoVecsBAOA.push(T)}}MapToFace(n,k){const T=this.IDATA.face[n],K=T[2],Q=T[1],G=T[0],w=c.o.ji(this.IDATA.vertex[K]),E=c.o.ji(this.IDATA.vertex[Q]),I=c.o.ji(this.IDATA.vertex[G]),S=E.Fg(w),P=I.Fg(w),W=S.scale(this.coau).add(P.scale(this.cobu)),J=S.scale(this.coav).add(P.scale(this.cobv)),H=[];let s,b=c.l.li[0];for(let c=0;c<this.cartesian.length;c++)b=W.scale(this.cartesian[c].x).add(J.scale(this.cartesian[c].y)).add(w),H[c]=[b.x,b.y,b.z],s=n+"|"+this.vertices[c].x+"|"+this.vertices[c].y,k.vertex[this.vecToidx[s]]=[b.x,b.y,b.z]}build(n,k){const T=[],c=wn.Zero(),K=new wn(n,k),Q=new wn(-k,n+k);T.push(c,K,Q);for(let q=k;q<n+1;q++)for(let k=0;k<n+1-q;k++)T.push(new wn(k,q));if(k>0){const c=(0,a.e)(n,k),K=n/c,Q=k/c;for(let w=1;w<c;w++)T.push(new wn(w*K,w*Q)),T.push(new wn(-w*Q,w*(K+Q))),T.push(new wn(n-w*(K+Q),k+w*K));const G=n/k;for(let w=1;w<k;w++)for(let c=0;c<w*G;c++)T.push(new wn(c,w)),T.push(new wn(c,w).rotate120(n,k)),T.push(new wn(c,w).rotateNeg120(n,k))}T.sort(((n,k)=>n.x-k.x)),T.sort(((n,k)=>n.y-k.y));const G=new Array(n+k+1),w=new Array(n+k+1);for(let q=0;q<G.length;q++)G[q]=1/0,w[q]=-1/0;let E=0,I=0;const S=T.length;for(let q=0;q<S;q++)I=T[q].x,E=T[q].y,G[E]=Math.min(I,G[E]),w[E]=Math.max(I,w[E]);const P=(T,c)=>{const K=T.clone();return"A"===c&&K.rotateNeg120(n,k),"B"===c&&K.rotate120(n,k),K.x<0?K.y:K.x+K.y},W=[],J=[],H=[],s=[],b={},C=[];let z=-1,r=-1;for(let q=0;q<S;q++)W[q]=T[q].toCartesianOrigin(new wn(0,0),.5),J[q]=P(T[q],"O"),H[q]=P(T[q],"A"),s[q]=P(T[q],"B"),J[q]===H[q]&&H[q]===s[q]?(z=3,r=J[q]):J[q]===H[q]?(z=4,r=J[q]):H[q]===s[q]?(z=5,r=H[q]):s[q]===J[q]&&(z=6,r=J[q]),J[q]<H[q]&&J[q]<s[q]&&(z=2,r=J[q]),H[q]<J[q]&&H[q]<s[q]&&(z=1,r=H[q]),s[q]<H[q]&&s[q]<J[q]&&(z=0,r=s[q]),C.push([z,r,T[q].x,T[q].y]);C.sort(((n,k)=>n[2]-k[2])),C.sort(((n,k)=>n[3]-k[3])),C.sort(((n,k)=>n[1]-k[1])),C.sort(((n,k)=>n[0]-k[0]));for(let q=0;q<C.length;q++)b[C[q][2]+"|"+C[q][3]]=[C[q][0],C[q][1],q];return this.m=n,this.n=k,this.vertices=T,this.vertByDist=b,this.cartesian=W,this.min=G,this.max=w,this}}class In{constructor(n,k,T,c){this.name=n,this.category=k,this.vertex=T,this.face=c}}class Sn extends In{innerToData(n,k){for(let T=0;T<k.innerFacets.length;T++)this.face.push(k.innerFacets[T].map((T=>k.vecToidx[n+T])))}mapABOBtoDATA(n,k){const T=k.IDATA.edgematch[n][0];for(let c=0;c<k.isoVecsABOB.length;c++){const K=[];for(let Q=0;Q<3;Q++)0===k.vertexTypes[c][Q]?K.push(n+"|"+k.isoVecsABOB[c][Q].x+"|"+k.isoVecsABOB[c][Q].y):K.push(T+"|"+k.isoVecsABOB[c][Q].x+"|"+k.isoVecsABOB[c][Q].y);this.face.push([k.vecToidx[K[0]],k.vecToidx[K[1]],k.vecToidx[K[2]]])}}mapOBOAtoDATA(n,k){const T=k.IDATA.edgematch[n][0];for(let c=0;c<k.isoVecsOBOA.length;c++){const K=[];for(let Q=0;Q<3;Q++)1===k.vertexTypes[c][Q]?K.push(n+"|"+k.isoVecsOBOA[c][Q].x+"|"+k.isoVecsOBOA[c][Q].y):K.push(T+"|"+k.isoVecsOBOA[c][Q].x+"|"+k.isoVecsOBOA[c][Q].y);this.face.push([k.vecToidx[K[0]],k.vecToidx[K[1]],k.vecToidx[K[2]]])}}mapBAOAtoDATA(n,k){const T=k.IDATA.edgematch[n][2];for(let c=0;c<k.isoVecsBAOA.length;c++){const K=[];for(let Q=0;Q<3;Q++)1===k.vertexTypes[c][Q]?K.push(n+"|"+k.isoVecsBAOA[c][Q].x+"|"+k.isoVecsBAOA[c][Q].y):K.push(T+"|"+k.isoVecsBAOA[c][Q].x+"|"+k.isoVecsBAOA[c][Q].y);this.face.push([k.vecToidx[K[0]],k.vecToidx[K[1]],k.vecToidx[K[2]]])}}orderData(n){const k=[];for(let Q=0;Q<13;Q++)k[Q]=[];const T=n.closestTo;for(let Q=0;Q<T.length;Q++)T[Q][0]>-1?T[Q][1]>0&&k[T[Q][0]].push([Q,T[Q][1]]):k[12].push([Q,T[Q][0]]);const c=[];for(let Q=0;Q<12;Q++)c[Q]=Q;let K=12;for(let Q=0;Q<12;Q++){k[Q].sort(((n,k)=>n[1]-k[1]));for(let n=0;n<k[Q].length;n++)c[k[Q][n][0]]=K++}for(let Q=0;Q<k[12].length;Q++)c[k[12][Q][0]]=K++;for(let Q=0;Q<this.vertex.length;Q++)this.vertex[Q].push(c[Q]);this.vertex.sort(((n,k)=>n[3]-k[3]));for(let Q=0;Q<this.vertex.length;Q++)this.vertex[Q].pop();for(let Q=0;Q<this.face.length;Q++)for(let n=0;n<this.face[Q].length;n++)this.face[Q][n]=c[this.face[Q][n]];this.sharedNodes=k[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(n,k){const T=[],c=[];let K=k.pop();c.push(K);let Q=this.face[K].indexOf(n);Q=(Q+2)%3;let G=this.face[K][Q];T.push(G);let w=0;for(;k.length>0;)K=k[w],this.face[K].indexOf(G)>-1?(Q=(this.face[K].indexOf(G)+1)%3,G=this.face[K][Q],T.push(G),c.push(K),k.splice(w,1),w=0):w++;return this.adjacentFaces.push(T),c}toGoldbergPolyhedronData(){const n=new In("GeoDual","Goldberg",[],[]);n.name="GD dual";const k=this.vertex.length,T=new Array(k);for(let E=0;E<k;E++)T[E]=[];for(let E=0;E<this.face.length;E++)for(let n=0;n<3;n++)T[this.face[E][n]].push(E);let c=0,K=0,Q=0,G=[],w=[];this.adjacentFaces=[];for(let E=0;E<T.length;E++){n.face[E]=this.setOrder(E,T[E].concat([]));for(const k of T[E]){c=0,K=0,Q=0,G=this.face[k];for(let n=0;n<3;n++)w=this.vertex[G[n]],c+=w[0],K+=w[1],Q+=w[2];n.vertex[k]=[c/3,K/3,Q/3]}}return n}static BuildGeodesicData(n){const k=new Sn("Geodesic-m-n","Geodesic",[[0,g.d,-1],[-g.d,1,0],[-1,0,-g.d],[1,0,-g.d],[g.d,1,0],[0,g.d,1],[-1,0,g.d],[-g.d,-1,0],[0,-g.d,-1],[g.d,-1,0],[1,0,g.d],[0,-g.d,1]],[]);n.setIndices(),n.calcCoeffs(),n.createInnerFacets(),n.edgeVecsABOB(),n.mapABOBtoOBOA(),n.mapABOBtoBAOA();for(let T=0;T<n.IDATA.face.length;T++)n.MapToFace(T,k),k.innerToData(T,n),"B"===n.IDATA.edgematch[T][1]&&k.mapABOBtoDATA(T,n),"O"===n.IDATA.edgematch[T][1]&&k.mapOBOAtoDATA(T,n),"A"===n.IDATA.edgematch[T][3]&&k.mapBAOAtoDATA(T,n);k.orderData(n);return k.vertex=k.vertex.map((function(n){const k=n[0],T=n[1],c=n[2],K=Math.sqrt(k*k+T*T+c*c);return n[0]*=1/K,n[1]*=1/K,n[2]*=1/K,n})),k}}K.b._GoldbergMeshParser=(n,k)=>Pn.Parse(n,k);class Pn extends K.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(n,k){return void 0===k?(n>this.goldbergData.nbUnsharedFaces-1&&(m.d.Warn("Maximum number of unshared faces used"),n=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+n):(n>11&&(m.d.Warn("Last pole used"),n=11),k>this.goldbergData.nbFacesAtPole-1&&(m.d.Warn("Maximum number of faces at a pole used"),k=this.goldbergData.nbFacesAtPole-1),12+n*this.goldbergData.nbFacesAtPole+k)}_changeGoldbergFaceColors(n){for(let T=0;T<n.length;T++){const k=n[T][0],c=n[T][1],K=n[T][2];for(let n=k;n<c+1;n++)this.goldbergData.faceColors[n]=K}const k=[];for(let T=0;T<12;T++)for(let n=0;n<5;n++)k.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);for(let T=12;T<this.goldbergData.faceColors.length;T++)for(let n=0;n<6;n++)k.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);return k}setGoldbergFaceColors(n){const k=this._changeGoldbergFaceColors(n);this.Ga(Q.f.ColorKind,k)}updateGoldbergFaceColors(n){const k=this._changeGoldbergFaceColors(n);this.updateVerticesData(Q.f.ColorKind,k)}_changeGoldbergFaceUVs(n){const k=this.getVerticesData(Q.f.UVKind);for(let T=0;T<n.length;T++){const c=n[T][0],K=n[T][1],Q=n[T][2],G=n[T][3],w=n[T][4],E=[],I=[];let S,P;for(let n=0;n<5;n++)S=Q.x+G*Math.cos(w+n*Math.PI/2.5),P=Q.y+G*Math.sin(w+n*Math.PI/2.5),S<0&&(S=0),S>1&&(S=1),E.push(S,P);for(let n=0;n<6;n++)S=Q.x+G*Math.cos(w+n*Math.PI/3),P=Q.y+G*Math.sin(w+n*Math.PI/3),S<0&&(S=0),S>1&&(S=1),I.push(S,P);for(let n=c;n<Math.min(12,K+1);n++)for(let T=0;T<5;T++)k[10*n+2*T]=E[2*T],k[10*n+2*T+1]=E[2*T+1];for(let n=Math.max(12,c);n<K+1;n++)for(let T=0;T<6;T++)k[12*n-24+2*T]=I[2*T],k[12*n-23+2*T]=I[2*T+1]}return k}setGoldbergFaceUVs(n){const k=this._changeGoldbergFaceUVs(n);this.Ga(Q.f.UVKind,k)}updateGoldbergFaceUVs(n){const k=this._changeGoldbergFaceUVs(n);this.updateVerticesData(Q.f.UVKind,k)}placeOnGoldbergFaceAt(n,k,T){const K=c.o.RotationFromAxis(this.goldbergData.faceXaxis[k],this.goldbergData.faceYaxis[k],this.goldbergData.faceZaxis[k]);n.rotation=K,n.position=this.goldbergData.faceCenters[k].add(this.goldbergData.faceXaxis[k].scale(T.x)).add(this.goldbergData.faceYaxis[k].scale(T.y)).add(this.goldbergData.faceZaxis[k].scale(T.z))}serialize(n){super.serialize(n),n.type="GoldbergMesh";const k={};if(k.adjacentFaces=this.goldbergData.adjacentFaces,k.nbSharedFaces=this.goldbergData.nbSharedFaces,k.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,k.nbFaces=this.goldbergData.nbFaces,k.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){k.faceColors=[];for(const n of this.goldbergData.faceColors)k.faceColors.push(n.wi())}if(this.goldbergData.faceCenters){k.faceCenters=[];for(const n of this.goldbergData.faceCenters)k.faceCenters.push(n.wi())}if(this.goldbergData.faceZaxis){k.faceZaxis=[];for(const n of this.goldbergData.faceZaxis)k.faceZaxis.push(n.wi())}if(this.goldbergData.faceYaxis){k.faceYaxis=[];for(const n of this.goldbergData.faceYaxis)k.faceYaxis.push(n.wi())}if(this.goldbergData.faceXaxis){k.faceXaxis=[];for(const n of this.goldbergData.faceXaxis)k.faceXaxis.push(n.wi())}n.goldbergData=k}static Parse(n,k){const T=n.goldbergData;T.faceColors=T.faceColors.map((n=>W.g.ji(n))),T.faceCenters=T.faceCenters.map((n=>c.o.ji(n))),T.faceZaxis=T.faceZaxis.map((n=>c.o.ji(n))),T.faceXaxis=T.faceXaxis.map((n=>c.o.ji(n))),T.faceYaxis=T.faceYaxis.map((n=>c.o.ji(n)));const K=new Pn(n.name,k);return K.goldbergData=T,K}}var Wn=T(885);class Jn{constructor(n){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=n}moveTo(n,k){this._currentPath=new x.d(n,k),this._tempPaths.push(this._currentPath)}lineTo(n,k){this._currentPath.addLineTo(n,k)}quadraticCurveTo(n,k,T,c){this._currentPath.addQuadraticCurveTo(n,k,T,c,this._resolution)}bezierCurveTo(n,k,T,c,K,Q){this._currentPath.addBezierCurveTo(n,k,T,c,K,Q,this._resolution)}extractHoles(){for(const n of this._tempPaths)n.area()>0?this._holes.push(n):this._paths.push(n);if(!this._paths.length&&this._holes.length){const n=this._holes;this._holes=this._paths,this._paths=n}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Hn(n,k,T,c,K,Q){const G=Q.glyphs[n]||Q.glyphs["?"];if(!G)return null;const w=new Jn(K);if(G.o){const n=G.o.split(" ");for(let K=0,Q=n.length;K<Q;){switch(n[K++]){case"m":{const Q=parseInt(n[K++])*k+T,G=parseInt(n[K++])*k+c;w.moveTo(Q,G);break}case"l":{const Q=parseInt(n[K++])*k+T,G=parseInt(n[K++])*k+c;w.lineTo(Q,G);break}case"q":{const Q=parseInt(n[K++])*k+T,G=parseInt(n[K++])*k+c,E=parseInt(n[K++])*k+T,I=parseInt(n[K++])*k+c;w.quadraticCurveTo(E,I,Q,G);break}case"b":{const Q=parseInt(n[K++])*k+T,G=parseInt(n[K++])*k+c,E=parseInt(n[K++])*k+T,I=parseInt(n[K++])*k+c,S=parseInt(n[K++])*k+T,P=parseInt(n[K++])*k+c;w.bezierCurveTo(E,I,S,P,Q,G);break}}}}return w.extractHoles(),{offsetX:G.ha*k,shapePath:w}}const sn={CreateBox:P.b,CreateTiledBox:b,CreateSphere:C.c,CreateDisc:S.e,CreateIcoSphere:p,CreateRibbon:I,CreateCylinder:O,CreateTorus:f,CreateTorusKnot:v,CreateLineSystem:F.e,Bi:F.i,CreateDashedLines:F.b,ExtrudeShape:i,ExtrudeShapeCustom:B,CreateLathe:M,CreateTiledPlane:H,Ci:o.c,CreateGround:D.e,CreateTiledGround:D.i,CreateGroundFromHeightMap:D.d,CreatePolygon:d,ExtrudePolygon:l,CreateTube:R,CreatePolyhedron:h,CreateGeodesic:function(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=k.m||1;c!==Math.floor(c)&&(c=Math.floor(c),m.d.Warn("m not an integer only floor(m) used"));let K=k.n||0;if(K!==Math.floor(K)&&(K=Math.floor(K),m.d.Warn("n not an integer only floor(n) used")),K>c){const n=K;K=c,c=n,m.d.Warn("n > m therefore m and n swapped")}const Q=new En;return Q.build(c,K),h(n,{custom:Sn.BuildGeodesicData(Q),size:k.size,sizeX:k.sizeX,sizeY:k.sizeY,sizeZ:k.sizeZ,faceUV:k.faceUV,faceColors:k.faceColors,flat:k.flat,updatable:k.updatable,sideOrientation:k.sideOrientation,frontUVs:k.frontUVs,backUVs:k.backUVs},T)},CreateGoldberg:function(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=k.size,E=k.sizeX||Q||1,I=k.sizeY||Q||1,S=k.sizeZ||Q||1;let P=k.m||1;P!==Math.floor(P)&&(P=Math.floor(P),m.d.Warn("m not an integer only floor(m) used"));let J=k.n||0;if(J!==Math.floor(J)&&(J=Math.floor(J),m.d.Warn("n not an integer only floor(n) used")),J>P){const n=J;J=P,P=n,m.d.Warn("n > m therefore m and n swapped")}const H=new En;H.build(P,J);const s=Sn.BuildGeodesicData(H),b=s.toGoldbergPolyhedronData(),C=new Pn(n,T);k.sideOrientation=K.b._GetDefaultSideOrientation(k.sideOrientation),C._originalBuilderSideOrientation=k.sideOrientation;(function(n,k){const T=n.size,K=n.sizeX||T||1,Q=n.sizeY||T||1,E=n.sizeZ||T||1,I=0===n.sideOrientation?0:n.sideOrientation||G.e.DEFAULTSIDE,S=[],P=[],W=[],J=[];let H=1/0,s=-1/0,b=1/0,C=-1/0;for(let c=0;c<k.vertex.length;c++)H=Math.min(H,k.vertex[c][0]*K),s=Math.max(s,k.vertex[c][0]*K),b=Math.min(b,k.vertex[c][1]*Q),C=Math.max(C,k.vertex[c][1]*Q);let z=0;for(let G=0;G<k.face.length;G++){const n=k.face[G],T=c.o.ji(k.vertex[n[0]]),I=c.o.ji(k.vertex[n[2]]),r=c.o.ji(k.vertex[n[1]]),q=I.Fg(T),O=r.Fg(T),u=c.o.Cross(O,q).normalize();for(let c=0;c<n.length;c++){W.push(u.x,u.y,u.z);const T=k.vertex[n[c]];S.push(T[0]*K,T[1]*Q,T[2]*E);const G=(T[1]*Q-b)/(C-b);J.push((T[0]*K-H)/(s-H),w.e?1-G:G)}for(let k=0;k<n.length-2;k++)P.push(z,z+k+2,z+k+1);z+=n.length}G.e._ComputeSides(I,S,P,W,J);const r=new G.e;return r.xa=S,r.indices=P,r.ya=W,r.Aa=J,r})(k,b).Ca(C,k.updatable),C.goldbergData.nbSharedFaces=s.sharedNodes,C.goldbergData.nbUnsharedFaces=s.poleNodes,C.goldbergData.adjacentFaces=s.adjacentFaces,C.goldbergData.nbFaces=C.goldbergData.nbSharedFaces+C.goldbergData.nbUnsharedFaces,C.goldbergData.nbFacesAtPole=(C.goldbergData.nbUnsharedFaces-12)/12;for(let K=0;K<s.vertex.length;K++)C.goldbergData.faceCenters.push(c.o.ji(s.vertex[K])),C.goldbergData.faceCenters[K].x*=E,C.goldbergData.faceCenters[K].y*=I,C.goldbergData.faceCenters[K].z*=S,C.goldbergData.faceColors.push(new W.g(1,1,1,1));for(let K=0;K<b.face.length;K++){const n=b.face[K],k=c.o.ji(b.vertex[n[0]]),T=c.o.ji(b.vertex[n[2]]),Q=c.o.ji(b.vertex[n[1]]),G=T.Fg(k),w=Q.Fg(k),E=c.o.Cross(w,G).normalize(),I=c.o.Cross(w,E).normalize();C.goldbergData.faceXaxis.push(w.normalize()),C.goldbergData.faceYaxis.push(E),C.goldbergData.faceZaxis.push(I)}return C},CreateDecal:Kn,CreateCapsule:Gn,CreateText:function(n,k,T){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const E=function(n,k,T,c){const K=Array.from(n),Q=k/c.resolution,G=(c.boundingBox.yMax-c.boundingBox.yMin+c.underlineThickness)*Q,w=[];let E=0,I=0;for(let S=0;S<K.length;S++){const n=K[S];if("\n"===n)E=0,I-=G;else{const k=Hn(n,Q,E,I,T,c);k&&(E+=k.offsetX,w.push(k.shapePath))}}return w}(k,Q.size||50,Q.resolution||8,T),I=[];let S=0;for(const H of E){if(!H.paths.length)continue;const k=H.holes.slice();for(const T of H.paths){var P,W;const E=[],J=[],H=T.getPoints();for(const n of H)J.push(new c.o(n.x,0,n.y));const s=k.slice();for(const n of s){const K=n.getPoints();let Q=!1;for(const n of K)if(T.isPointInside(n)){Q=!0;break}if(!Q)continue;const G=[];for(const n of K)G.push(new c.o(n.x,0,n.y));E.push(G),k.splice(k.indexOf(n),1)}if(!E.length&&k.length)for(const n of k){const k=n.getPoints(),T=[];for(const n of k)T.push(new c.o(n.x,0,n.y));E.push(T)}const b=l(n,{shape:J,holes:E.length?E:void 0,depth:Q.depth||1,faceUV:Q.faceUV||(null===(P=Q.perLetterFaceUV)||void 0===P?void 0:P.call(Q,S)),faceColors:Q.faceColors||(null===(W=Q.perLetterFaceColors)||void 0===W?void 0:W.call(Q,S)),sideOrientation:K.b._GetDefaultSideOrientation(Q.sideOrientation||K.b.DOUBLESIDE)},G,w);I.push(b),S++}}const J=K.b.MergeMeshes(I,!0,!0);if(J){const k=J.getBoundingInfo().boundingBox;J.position.x+=-(k.minimumWorld.x+k.maximumWorld.x)/2,J.position.y+=-(k.minimumWorld.y+k.maximumWorld.y)/2,J.position.z+=-(k.minimumWorld.z+k.maximumWorld.z)/2+k.extendSize.z,J.name=n;const T=new Wn.d("pivot",G);T.rotation.x=-Math.PI/2,J.parent=T,J.bakeCurrentTransformIntoVertices(),J.parent=null,T.dispose()}return J}}},12721:(n,k,T)=>{"use strict";T.d(k,{d:()=>G});var c=T(2334),K=T(2534);let Q=0;const G=n=>{if(!n.environmentBRDFTexture){const k=n.useDelayedTextureLoading;n.useDelayedTextureLoading=!1;const T=n._blockEntityCollection;n._blockEntityCollection=!1;const G=c.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+Q++,n,!0,!1,c.b.BILINEAR_SAMPLINGMODE);n._blockEntityCollection=T;const w=n.getEngine().getLoadedTexturesCache(),E=w.indexOf(G.getInternalTexture());-1!==E&&w.splice(E,1),G.isRGBD=!0,G.wrapU=c.b.CLAMP_ADDRESSMODE,G.wrapV=c.b.CLAMP_ADDRESSMODE,n.environmentBRDFTexture=G,n.useDelayedTextureLoading=k,K.b.ExpandRGBDTexture(G);const I=n.getEngine().onContextRestoredObservable.add((()=>{G.isRGBD=!0;const k=n.onBeforeRenderObservable.add((()=>{G.isReady()&&(n.onBeforeRenderObservable.remove(k),K.b.ExpandRGBDTexture(G))}))}));n.Gi.add((()=>{n.getEngine().onContextRestoredObservable.remove(I)}))}return n.environmentBRDFTexture}},2570:(n,k,T)=>{"use strict";T.d(k,{b:()=>K});class c{constructor(n){this._pendingActions=new Array,this._workerInfos=n.map((n=>({workerPromise:Promise.resolve(n),idle:!0})))}dispose(){for(const n of this._workerInfos)n.workerPromise.then((n=>{n.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(n){this._executeOnIdleWorker(n)||this._pendingActions.push(n)}_executeOnIdleWorker(n){for(const k of this._workerInfos)if(k.idle)return this._execute(k,n),!0;return!1}_execute(n,k){n.idle=!1,n.workerPromise.then((T=>{k(T,(()=>{const k=this._pendingActions.shift();k?this._execute(n,k):n.idle=!0}))}))}}class K extends c{constructor(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.DefaultOptions;super([]),this._maxWorkers=n,this._createWorkerAsync=k,this._options=T}push(n){if(!this._executeOnIdleWorker(n))if(this._workerInfos.length<this._maxWorkers){const k={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(k),this._execute(k,n)}else this._pendingActions.push(n)}_execute(n,k){n.timeoutId&&(clearTimeout(n.timeoutId),delete n.timeoutId),super._execute(n,((T,c)=>{k(T,(()=>{c(),n.idle&&(n.timeoutId=setTimeout((()=>{n.workerPromise.then((n=>{n.terminate()}));const k=this._workerInfos.indexOf(n);-1!==k&&this._workerInfos.splice(k,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}K.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12342:(n,k,T)=>{"use strict";T.d(k,{d:()=>Ek});var c=T(730),K=T(12237);class Q extends K.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var G=T(764),w=(T(2422),T(675));class E{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(n){this._targetStopDuration!==n&&(this._targetStopDuration=n)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(n){this._noiseTexture!==n&&(this._noiseTexture=n,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(n){this._animationSheetEnabled!==n&&(this._animationSheetEnabled=n)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(n){this._isAnimationSheetEnabled!=n&&(this._isAnimationSheetEnabled=n,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(n){this._useLogarithmicDepth=n&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(n){switch(n){case E.BLENDMODE_MULTIPLYADD:return;case E.BLENDMODE_ADD:n=1;break;case E.BLENDMODE_ONEONE:n=6;break;case E.BLENDMODE_STANDARD:n=2;break;case E.BLENDMODE_MULTIPLY:n=4;break;case E.BLENDMODE_SUBTRACT:n=3}this._engine.setAlphaMode(n)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:c.o.Zero()}set direction1(n){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=n)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:c.o.Zero()}set direction2(n){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=n)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:c.o.Zero()}set minEmitBox(n){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=n)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:c.o.Zero()}set maxEmitBox(n){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=n)}get billboardMode(){return this._billboardMode}set billboardMode(n){this._billboardMode!==n&&(this._billboardMode=n,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(n){this._isBillboardBased!==n&&(this._isBillboardBased=n,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(n){this._attachImageProcessingConfiguration(n)}_attachImageProcessingConfiguration(n){n!==this._imageProcessingConfiguration&&(!n&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=n)}_reset(){}_removeGradientAndTexture(n,k,T){if(!k)return this;let c=0;for(const K of k){if(K.gradient===n){k.splice(c,1);break}c++}return T&&T.dispose(),this}constructor(n){this.animations=[],this.renderingGroupId=0,this.j=c.o.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new c.o(10,10,10),this.onAnimationEnd=null,this.blendMode=E.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new c.m(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ie=new c.o(0,0,0),this._useLogarithmicDepth=!1,this.gravity=c.o.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new G.g(1,1,1,1),this.color2=new G.g(1,1,1,1),this.colorDead=new G.g(0,0,0,1),this.textureMask=new G.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Q,this.id=n,this.name=n}createPointEmitter(n,k){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new c.o(0,1,0),arguments.length>2&&void 0!==arguments[2]||new c.o(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new c.o(0,1,0),arguments.length>4&&void 0!==arguments[4]||new c.o(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new c.o(0,1,0),arguments.length>3&&void 0!==arguments[3]||new c.o(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(n,k,T,c){throw new Error("Method not implemented.")}}E.BLENDMODE_ONEONE=0,E.BLENDMODE_STANDARD=1,E.BLENDMODE_ADD=2,E.BLENDMODE_MULTIPLY=3,E.BLENDMODE_MULTIPLYADD=4,E.BLENDMODE_SUBTRACT=-1,(0,w.f)("BABYLON.BaseParticleSystem",E);var I=T(747),S=T(564);class P{constructor(){this.direction1=new c.o(0,1,0),this.direction2=new c.o(0,1,0),this.minEmitBox=new c.o(-.5,-.5,-.5),this.maxEmitBox=new c.o(.5,.5,.5)}startDirectionFunction(n,k,T,K){const Q=(0,I.l)(this.direction1.x,this.direction2.x),G=(0,I.l)(this.direction1.y,this.direction2.y),w=(0,I.l)(this.direction1.z,this.direction2.z);if(K)return k.x=Q,k.y=G,void(k.z=w);c.o.TransformNormalFromFloatsToRef(Q,G,w,n,k)}startPositionFunction(n,k,T,K){const Q=(0,I.l)(this.minEmitBox.x,this.maxEmitBox.x),G=(0,I.l)(this.minEmitBox.y,this.maxEmitBox.y),w=(0,I.l)(this.minEmitBox.z,this.maxEmitBox.z);if(K)return k.x=Q,k.y=G,void(k.z=w);c.o.TransformCoordinatesFromFloatsToRef(Q,G,w,n,k)}clone(){const n=new P;return S.c.DeepCopy(this,n),n}applyToShader(n){n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2),n.setVector3("minEmitBox",this.minEmitBox),n.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(n){n.addUniform("direction1",3),n.addUniform("direction2",3),n.addUniform("minEmitBox",3),n.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.direction1=this.direction1.wi(),n.direction2=this.direction2.wi(),n.minEmitBox=this.minEmitBox.wi(),n.maxEmitBox=this.maxEmitBox.wi(),n}parse(n){c.o.FromArrayToRef(n.direction1,0,this.direction1),c.o.FromArrayToRef(n.direction2,0,this.direction2),c.o.FromArrayToRef(n.minEmitBox,0,this.minEmitBox),c.o.FromArrayToRef(n.maxEmitBox,0,this.maxEmitBox)}}class W{get radius(){return this._radius}set radius(n){this._radius=n,this._buildHeight()}get angle(){return this._angle}set angle(n){this._angle=n,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=T,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=k,this.radius=n}startDirectionFunction(n,k,T,K){K?c.l.li[0].p(T.zg).normalize():T.position.subtractToRef(n.getTranslation(),c.l.li[0]).normalize();const Q=(0,I.l)(0,this.directionRandomizer),G=(0,I.l)(0,this.directionRandomizer),w=(0,I.l)(0,this.directionRandomizer);k.x=c.l.li[0].x+Q,k.y=c.l.li[0].y+G,k.z=c.l.li[0].z+w,k.normalize()}startPositionFunction(n,k,T,K){const Q=(0,I.l)(0,2*Math.PI);let G;this.emitFromSpawnPointOnly?G=1e-4:(G=(0,I.l)(0,this.heightRange),G=1-G*G);let w=this._radius-(0,I.l)(0,this._radius*this.radiusRange);w*=G;const E=w*Math.sin(Q),S=w*Math.cos(Q),P=G*this._height;if(K)return k.x=E,k.y=P,void(k.z=S);c.o.TransformCoordinatesFromFloatsToRef(E,P,S,n,k)}clone(){const n=new W(this._radius,this._angle,this.directionRandomizer);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat2("radius",this._radius,this.radiusRange),n.setFloat("coneAngle",this._angle),n.setFloat2("height",this._height,this.heightRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",2),n.addUniform("coneAngle",1),n.addUniform("height",2),n.addUniform("directionRandomizer",1)}getEffectDefines(){let n="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(n+="\n#define CONEEMITTERSPAWNPOINT"),n}getClassName(){return"ConeParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this._radius,n.angle=this._angle,n.directionRandomizer=this.directionRandomizer,n.radiusRange=this.radiusRange,n.heightRange=this.heightRange,n.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,n}parse(n){this.radius=n.radius,this.angle=n.angle,this.directionRandomizer=n.directionRandomizer,this.radiusRange=void 0!==n.radiusRange?n.radiusRange:1,this.heightRange=void 0!==n.radiusRange?n.heightRange:1,this.emitFromSpawnPointOnly=void 0!==n.emitFromSpawnPointOnly&&n.emitFromSpawnPointOnly}}class J extends W{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0),K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0);super(n,k),this.direction1=T,this.direction2=K}startDirectionFunction(n,k){const T=(0,I.l)(this.direction1.x,this.direction2.x),K=(0,I.l)(this.direction1.y,this.direction2.y),Q=(0,I.l)(this.direction1.z,this.direction2.z);c.o.TransformNormalFromFloatsToRef(T,K,Q,n,k)}clone(){const n=new J(this.radius,this.angle,this.direction1,this.direction2);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const n=super.serialize();return n.direction1=this.direction1.wi(),n.direction2=this.direction2.wi(),n}parse(n){super.parse(n),this.direction1.p(n.direction1),this.direction2.p(n.direction2)}}class H{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=n,this.height=k,this.radiusRange=T,this.directionRandomizer=K,this._tempVector=c.o.Zero()}startDirectionFunction(n,k,T,K,Q){T.position.subtractToRef(n.getTranslation(),this._tempVector),this._tempVector.normalize(),c.o.TransformNormalToRef(this._tempVector,Q,this._tempVector);const G=(0,I.l)(-this.directionRandomizer/2,this.directionRandomizer/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,I.l)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=G,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),K?k.p(this._tempVector):c.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,n,k)}startPositionFunction(n,k,T,K){const Q=(0,I.l)(-this.height/2,this.height/2),G=(0,I.l)(0,2*Math.PI),w=(0,I.l)((1-this.radiusRange)*(1-this.radiusRange),1),E=Math.sqrt(w)*this.radius,S=E*Math.cos(G),P=E*Math.sin(G);K?k.di(S,Q,P):c.o.TransformCoordinatesFromFloatsToRef(S,Q,P,n,k)}clone(){const n=new H(this.radius,this.directionRandomizer);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("height",this.height),n.setFloat("radiusRange",this.radiusRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("height",1),n.addUniform("radiusRange",1),n.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this.radius,n.height=this.height,n.radiusRange=this.radiusRange,n.directionRandomizer=this.directionRandomizer,n}parse(n){this.radius=n.radius,this.height=n.height,this.radiusRange=n.radiusRange,this.directionRandomizer=n.directionRandomizer}}class s extends H{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0),Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.o(0,1,0);super(n,k,T),this.direction1=K,this.direction2=Q}startDirectionFunction(n,k,T,K){const Q=(0,I.l)(this.direction1.x,this.direction2.x),G=(0,I.l)(this.direction1.y,this.direction2.y),w=(0,I.l)(this.direction1.z,this.direction2.z);K?k.di(Q,G,w):c.o.TransformNormalFromFloatsToRef(Q,G,w,n,k)}clone(){const n=new s(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("height",this.height),n.setFloat("radiusRange",this.radiusRange),n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("height",1),n.addUniform("radiusRange",1),n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const n=super.serialize();return n.direction1=this.direction1.wi(),n.direction2=this.direction2.wi(),n}parse(n){super.parse(n),c.o.FromArrayToRef(n.direction1,0,this.direction1),c.o.FromArrayToRef(n.direction2,0,this.direction2)}}class b{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=n,this.radiusRange=k,this.directionRandomizer=T}startDirectionFunction(n,k,T,K){const Q=T.position.Fg(n.getTranslation()).normalize(),G=(0,I.l)(0,this.directionRandomizer),w=(0,I.l)(0,this.directionRandomizer),E=(0,I.l)(0,this.directionRandomizer);Q.x+=G,Q.y+=w,Q.z+=E,Q.normalize(),K?k.p(Q):c.o.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,n,k)}startPositionFunction(n,k,T,K){const Q=this.radius-(0,I.l)(0,this.radius*this.radiusRange),G=(0,I.l)(0,1),w=(0,I.l)(0,2*Math.PI),E=Math.acos(2*G-1),S=Q*Math.cos(w)*Math.sin(E),P=Q*Math.cos(E),W=Q*Math.sin(w)*Math.sin(E);K?k.di(S,Math.abs(P),W):c.o.TransformCoordinatesFromFloatsToRef(S,Math.abs(P),W,n,k)}clone(){const n=new b(this.radius,this.directionRandomizer);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this.radius,n.radiusRange=this.radiusRange,n.directionRandomizer=this.directionRandomizer,n}parse(n){this.radius=n.radius,this.radiusRange=n.radiusRange,this.directionRandomizer=n.directionRandomizer}}class C{constructor(){this.direction1=new c.o(0,1,0),this.direction2=new c.o(0,1,0)}startDirectionFunction(n,k,T,K){const Q=(0,I.l)(this.direction1.x,this.direction2.x),G=(0,I.l)(this.direction1.y,this.direction2.y),w=(0,I.l)(this.direction1.z,this.direction2.z);K?k.di(Q,G,w):c.o.TransformNormalFromFloatsToRef(Q,G,w,n,k)}startPositionFunction(n,k,T,K){K?k.di(0,0,0):c.o.TransformCoordinatesFromFloatsToRef(0,0,0,n,k)}clone(){const n=new C;return S.c.DeepCopy(this,n),n}applyToShader(n){n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.direction1=this.direction1.wi(),n.direction2=this.direction2.wi(),n}parse(n){c.o.FromArrayToRef(n.direction1,0,this.direction1),c.o.FromArrayToRef(n.direction2,0,this.direction2)}}class z{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=n,this.radiusRange=k,this.directionRandomizer=T}startDirectionFunction(n,k,T,K){const Q=T.position.Fg(n.getTranslation()).normalize(),G=(0,I.l)(0,this.directionRandomizer),w=(0,I.l)(0,this.directionRandomizer),E=(0,I.l)(0,this.directionRandomizer);Q.x+=G,Q.y+=w,Q.z+=E,Q.normalize(),K?k.p(Q):c.o.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,n,k)}startPositionFunction(n,k,T,K){const Q=this.radius-(0,I.l)(0,this.radius*this.radiusRange),G=(0,I.l)(0,1),w=(0,I.l)(0,2*Math.PI),E=Math.acos(2*G-1),S=Q*Math.cos(w)*Math.sin(E),P=Q*Math.cos(E),W=Q*Math.sin(w)*Math.sin(E);K?k.di(S,P,W):c.o.TransformCoordinatesFromFloatsToRef(S,P,W,n,k)}clone(){const n=new z(this.radius,this.directionRandomizer);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this.radius,n.radiusRange=this.radiusRange,n.directionRandomizer=this.directionRandomizer,n}parse(n){this.radius=n.radius,this.radiusRange=n.radiusRange,this.directionRandomizer=n.directionRandomizer}}class r extends z{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.o(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0);super(n),this.direction1=k,this.direction2=T}startDirectionFunction(n,k){const T=(0,I.l)(this.direction1.x,this.direction2.x),K=(0,I.l)(this.direction1.y,this.direction2.y),Q=(0,I.l)(this.direction1.z,this.direction2.z);c.o.TransformNormalFromFloatsToRef(T,K,Q,n,k)}clone(){const n=new r(this.radius,this.direction1,this.direction2);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const n=super.serialize();return n.direction1=this.direction1.wi(),n.direction2=this.direction2.wi(),n}parse(n){super.parse(n),this.direction1.p(n.direction1),this.direction2.p(n.direction2)}}class q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(n,k,T,K){const Q=c.l.li[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,T,Q);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,T,Q);const n=c.l.li[1];Q.subtractToRef(T.position,n),n.scaleToRef(1/T.lifeTime,Q)}else Q.set(0,0,0);K?k.p(Q):c.o.TransformNormalToRef(Q,n,k)}startPositionFunction(n,k,T,K){const Q=c.l.li[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,T,Q):Q.set(0,0,0),K?k.p(Q):c.o.TransformCoordinatesToRef(Q,n,k)}clone(){const n=new q;return S.c.DeepCopy(this,n),n}applyToShader(n){}buildUniformLayout(n){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.particlePositionGenerator=this.particlePositionGenerator,n.particleDestinationGenerator=this.particleDestinationGenerator,n}parse(n){n.particlePositionGenerator&&(this.particlePositionGenerator=n.particlePositionGenerator),n.particleDestinationGenerator&&(this.particleDestinationGenerator=n.particleDestinationGenerator)}}var O=T(781);class u{get mesh(){return this._mesh}set mesh(n){this._mesh!==n&&(this._mesh=n,n?(this._indices=n.qi(),this._positions=n.getVerticesData(O.f.PositionKind),this._normals=n.getVerticesData(O.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=c.o.Zero(),this._mesh=null,this.direction1=new c.o(0,1,0),this.direction2=new c.o(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=n}startDirectionFunction(n,k,T,K){if(this.useMeshNormalsForDirection&&this._normals)return void c.o.TransformNormalToRef(this._storedNormal,n,k);const Q=(0,I.l)(this.direction1.x,this.direction2.x),G=(0,I.l)(this.direction1.y,this.direction2.y),w=(0,I.l)(this.direction1.z,this.direction2.z);K?k.di(Q,G,w):c.o.TransformNormalFromFloatsToRef(Q,G,w,n,k)}startPositionFunction(n,k,T,K){if(!this._indices||!this._positions)return;const Q=3*(Math.random()*(this._indices.length/3)|0),G=Math.random(),w=Math.random()*(1-G),E=1-G-w,I=this._indices[Q],S=this._indices[Q+1],P=this._indices[Q+2],W=c.l.li[0],J=c.l.li[1],H=c.l.li[2],s=c.l.li[3];c.o.FromArrayToRef(this._positions,3*I,W),c.o.FromArrayToRef(this._positions,3*S,J),c.o.FromArrayToRef(this._positions,3*P,H),s.x=G*W.x+w*J.x+E*H.x,s.y=G*W.y+w*J.y+E*H.y,s.z=G*W.z+w*J.z+E*H.z,K?k.di(s.x,s.y,s.z):c.o.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,n,k),this.useMeshNormalsForDirection&&this._normals&&(c.o.FromArrayToRef(this._normals,3*I,W),c.o.FromArrayToRef(this._normals,3*S,J),c.o.FromArrayToRef(this._normals,3*P,H),this._storedNormal.x=G*W.x+w*J.x+E*H.x,this._storedNormal.y=G*W.y+w*J.y+E*H.y,this._storedNormal.z=G*W.z+w*J.z+E*H.z)}clone(){const n=new u(this.mesh);return S.c.DeepCopy(this,n),n}applyToShader(n){n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var n;const k={};return k.type=this.getClassName(),k.direction1=this.direction1.wi(),k.direction2=this.direction2.wi(),k.meshId=null===(n=this.mesh)||void 0===n?void 0:n.id,k.useMeshNormalsForDirection=this.useMeshNormalsForDirection,k}parse(n,k){c.o.FromArrayToRef(n.direction1,0,this.direction1),c.o.FromArrayToRef(n.direction2,0,this.direction2),n.meshId&&k&&(this.mesh=k.getLastMeshById(n.meshId)),this.useMeshNormalsForDirection=n.useMeshNormalsForDirection}}class f{_isUbo(n){return void 0!==n.addUniform}constructor(n){this._isUbo(n)?(this.setMatrix3x3=n.updateMatrix3x3.bind(n),this.setMatrix2x2=n.updateMatrix2x2.bind(n),this.setFloat=n.updateFloat.bind(n),this.setFloat2=n.updateFloat2.bind(n),this.setFloat3=n.updateFloat3.bind(n),this.setFloat4=n.updateFloat4.bind(n),this.setFloatArray=n.updateFloatArray.bind(n),this.setArray=n.updateArray.bind(n),this.setIntArray=n.updateIntArray.bind(n),this.setMatrix=n.Vi.bind(n),this.setMatrices=n.updateMatrices.bind(n),this.setVector3=n.updateVector3.bind(n),this.setVector4=n.updateVector4.bind(n),this.setColor3=n.updateColor3.bind(n),this.setColor4=n.updateColor4.bind(n),this.setDirectColor4=n.updateDirectColor4.bind(n),this.setInt=n.updateInt.bind(n),this.setInt2=n.updateInt2.bind(n),this.setInt3=n.updateInt3.bind(n),this.setInt4=n.updateInt4.bind(n)):(this.setMatrix3x3=n.setMatrix3x3.bind(n),this.setMatrix2x2=n.setMatrix2x2.bind(n),this.setFloat=n.setFloat.bind(n),this.setFloat2=n.setFloat2.bind(n),this.setFloat3=n.setFloat3.bind(n),this.setFloat4=n.setFloat4.bind(n),this.setFloatArray=n.setFloatArray.bind(n),this.setArray=n.setArray.bind(n),this.setIntArray=n.setIntArray.bind(n),this.setMatrix=n.setMatrix.bind(n),this.setMatrices=n.setMatrices.bind(n),this.setVector3=n.setVector3.bind(n),this.setVector4=n.setVector4.bind(n),this.setColor3=n.setColor3.bind(n),this.setColor4=n.setColor4.bind(n),this.setDirectColor4=n.setDirectColor4.bind(n),this.setInt=n.setInt.bind(n),this.setInt2=n.setInt2.bind(n),this.setInt3=n.setInt3.bind(n),this.setInt4=n.setInt4.bind(n))}}var A=T(624);const v="gpuUpdateParticlesPixelShader",F="#version 300 es\nvoid main() {discard;}\n";A.b.ShadersStore[v]||(A.b.ShadersStore[v]=F);const m="gpuUpdateParticlesVertexShader",x="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";A.b.ShadersStore[m]||(A.b.ShadersStore[m]=x);(0,w.f)("BABYLON.WebGL2ParticleSystem",class{constructor(n,k){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=n,this._engine=k,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var n;return(null===(n=this._updateEffect)||void 0===n?void 0:n.isReady())??!1}createUpdateBuffer(n){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=n,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new f(this._updateEffect)}createVertexBuffers(n,k){this._updateVAO.push(this._createUpdateVAO(n)),this._renderVAO.push(this._engine.recordVertexArrayObject(k,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=k}createParticleBuffer(n){return n}bindDrawBuffers(n,k,T){T?this._engine.bindBuffers(this._renderVertexBuffers,T,k):this._engine.bindVertexArrayObject(this._renderVAO[n],null)}preUpdateParticleBuffer(){const n=this._engine;if(this._engine.enableEffect(this._updateEffect),!n.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(n,k,T){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[n],null);const c=this._engine;c.bindTransformFeedbackBuffer(k.getBuffer()),c.setRasterizerState(!1),c.beginTransformFeedback(!0),c.drawArraysType(3,0,T),c.endTransformFeedback(),c.setRasterizerState(!0),c.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let n=0;n<this._updateVAO.length;n++)this._engine.releaseVertexArrayObject(this._updateVAO[n]);this._updateVAO.length=0;for(let n=0;n<this._renderVAO.length;n++)this._engine.releaseVertexArrayObject(this._renderVAO[n]);this._renderVAO.length=0}_createUpdateVAO(n){const k={};k.position=n.createVertexBuffer("position",0,3);let T=3;k.age=n.createVertexBuffer("age",T,1),T+=1,k.size=n.createVertexBuffer("size",T,3),T+=3,k.life=n.createVertexBuffer("life",T,1),T+=1,k.seed=n.createVertexBuffer("seed",T,4),T+=4,k.direction=n.createVertexBuffer("direction",T,3),T+=3,this._parent.particleEmitterType instanceof q&&(k.initialPosition=n.createVertexBuffer("initialPosition",T,3),T+=3),this._parent._colorGradientsTexture||(k.color=n.createVertexBuffer("color",T,4),T+=4),this._parent._isBillboardBased||(k.initialDirection=n.createVertexBuffer("initialDirection",T,3),T+=3),this._parent.noiseTexture&&(k.noiseCoordinates1=n.createVertexBuffer("noiseCoordinates1",T,3),T+=3,k.noiseCoordinates2=n.createVertexBuffer("noiseCoordinates2",T,3),T+=3),this._parent._angularSpeedGradientsTexture?(k.angle=n.createVertexBuffer("angle",T,1),T+=1):(k.angle=n.createVertexBuffer("angle",T,2),T+=2),this._parent._isAnimationSheetEnabled&&(k.cellIndex=n.createVertexBuffer("cellIndex",T,1),T+=1,this._parent.spriteRandomStartCell&&(k.cellStartOffset=n.createVertexBuffer("cellStartOffset",T,1),T+=1));const c=this._engine.recordVertexArrayObject(k,null,this._updateEffect);return this._engine.bindArrayBuffer(null),c}});class g{constructor(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,c=arguments.length>3?arguments[3]:void 0;this._engine=n,this._label=c,this._engine._storageBuffers.push(this),this._create(k,T)}_create(n,k){this._bufferSize=n,this._creationFlags=k,this._buffer=this._engine.createStorageBuffer(n,k,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(n,k,T){this._buffer&&this._engine.updateStorageBuffer(this._buffer,n,k,T)}async read(n,k,T,c){return await this._engine.readFromStorageBuffer(this._buffer,n,k,T,c)}dispose(){const n=this._engine._storageBuffers,k=n.indexOf(this);-1!==k&&(n[k]=n[n.length-1],n.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var U=T(706),V=T(712),Y=T(760),Z=T(2334),e=T(2528),d=T(556),l=T(656),i=T(2447);class B{constructor(){this._gpuTimeInFrameId=-1,this.counter=new i.d}_addDuration(n,k){n<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==n?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(k,!1),this._gpuTimeInFrameId=n):this.counter.addCount(k,!1))}}var t=T(610);class M{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=n,this._engine=k,this.uniqueId=e.e.UniqueId,k.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new B),this._engine.getCaps().supportComputeShaders?c.bindingsMapping?(this._context=k.createComputeContext(),this._shaderPath=T,this._options={bindingsMapping:{},defines:[],...c}):d.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):d.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(n,k){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const c=this._bindings[n];this._bindings[n]={type:T?0:4,object:k,indexInGroupEntries:null===c||void 0===c?void 0:c.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!c||c.object!==k||c.type!==this._bindings[n].type)}setStorageTexture(n,k){const T=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==k),this._bindings[n]={type:1,object:k,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setExternalTexture(n,k){const T=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==k),this._bindings[n]={type:6,object:k,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setVideoTexture(n,k){return!!k.externalTexture&&(this.setExternalTexture(n,k.externalTexture),!0)}setUniformBuffer(n,k){const T=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==k),this._bindings[n]={type:M._BufferIsDataBuffer(k)?7:2,object:k,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setStorageBuffer(n,k){const T=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==k),this._bindings[n]={type:M._BufferIsDataBuffer(k)?7:3,object:k,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setTextureSampler(n,k){const T=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!T||!k.compareSampler(T.object)),this._bindings[n]={type:5,object:k,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}isReady(){let n=this._effect;for(const K in this._bindings){const n=this._bindings[K],k=n.type,T=n.object;switch(k){case 0:case 4:case 1:if(!T.isReady())return!1;break;case 6:if(!T.isReady())return!1;break}}const k=[],T=this._shaderPath;if(this._options.defines)for(let K=0;K<this._options.defines.length;K++)k.push(this._options.defines[K]);const c=k.join("\n");return this._cachedDefines!==c&&(this._cachedDefines=c,n=this._engine.createComputeEffect(T,{defines:c,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=n),!!n.isReady()}dispatch(n,k,T){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,n,k,T,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const T=M._BufferIsDataBuffer(n)?n:n.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,T,k,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const k in this._bindings){const T=this._bindings[k];if(!this._options.bindingsMapping[k])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+k+"'");switch(T.type){case 0:{const c=this._samplers[k],K=T.object;var n;if(!c||!K._texture||!c.compareSampler(K._texture))this._samplers[k]=(new l.c).setParameters(K.wrapU,K.wrapV,K.wrapR,K.anisotropicFilteringLevel,K._texture.samplingMode,null===(n=K._texture)||void 0===n?void 0:n._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const n=T.object;n.getBuffer()!==T.buffer&&(T.buffer=n.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((K=>{(0,t.f)((()=>this.dispatch(n,k,T)),K,void 0,c)}))}serialize(){const n=Y.d.Serialize(this);n.options=this._options,n.shaderPath=this._shaderPath,n.Ml={},n.textures={};for(const k in this._bindings){const T=this._bindings[k],c=T.object;switch(T.type){case 0:case 4:case 1:{const K=c.serialize();K&&(n.textures[k]=K,n.Ml[k]={type:T.type});break}}}return n}static Parse(n,k,T){const c=Y.d.Parse((()=>new M(n.name,k.getEngine(),n.shaderPath,n.options)),n,k,T);for(const K in n.textures){const Q=n.Ml[K],G=Z.b.Parse(n.textures[K],k,T);0===Q.type?c.setTexture(K,G):4===Q.type?c.setTexture(K,G,!1):c.setStorageTexture(K,G)}return c}static _BufferIsDataBuffer(n){return void 0!==n.underlyingResource}}(0,U.e)([(0,V.K)()],M.prototype,"name",void 0),(0,U.e)([(0,V.K)()],M.prototype,"fastMode",void 0),(0,w.f)("BABYLON.ComputeShader",M);var o=T(900);const D="gpuUpdateParticlesComputeShader",R="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";A.b.ShadersStoreWGSL[D]||(A.b.ShadersStoreWGSL[D]=R);(0,w.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(n,k){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=n,this._engine=k}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var n;return(null===(n=this._updateComputeShader)||void 0===n?void 0:n.isReady())??!1}createUpdateBuffer(n){var k;const T={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(T.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(T.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(T.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(T.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(T.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(T.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(T.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new M("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:T,defines:n.split("\n")}),null===(k=this._simParamsComputeShader)||void 0===k||k.dispose(),this._simParamsComputeShader=new o.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new f(this._simParamsComputeShader)}createVertexBuffers(n,k){this._renderVertexBuffers.push(k)}createParticleBuffer(n){const k=new g(this._engine,4*n.length,11,"ComputeShaderParticleSystemBuffer");return k.update(n),this._bufferComputeShader.push(k),k.getBuffer()}bindDrawBuffers(n,k,T){this._engine.bindBuffers(this._renderVertexBuffers[n],T,k)}preUpdateParticleBuffer(){}updateParticleBuffer(n,k,T){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[n]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^n]),this._updateComputeShader.dispatch(Math.ceil(T/64))}releaseBuffers(){var n;for(let k=0;k<this._bufferComputeShader.length;++k)this._bufferComputeShader[k].dispose();this._bufferComputeShader.length=0,null===(n=this._simParamsComputeShader)||void 0===n||n.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class L{constructor(n,k,T){this.gradient=n,this.color1=k,this.color2=T}getColorToRef(n){this.color2?G.g.LerpToRef(this.color1,this.color2,Math.random(),n):n.p(this.color1)}}class h{constructor(n,k){this.gradient=n,this.color=k}}class j{constructor(n,k,T){this.gradient=n,this.factor1=k,this.factor2=T}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class p{static GetCurrentGradient(n,k,T){if(k[0].gradient>n)return void T(k[0],k[0],1);for(let K=0;K<k.length-1;K++){const c=k[K],Q=k[K+1];if(n>=c.gradient&&n<=Q.gradient){return void T(c,Q,(n-c.gradient)/(Q.gradient-c.gradient))}}const c=k.length-1;T(k[c],k[c],1)}}var a=T(539),X=T(12347),y=T(588);class N{constructor(n){this.particleSystem=n,this.position=c.o.Zero(),this.direction=c.o.Zero(),this.color=new G.g(0,0,0,0),this.colorStep=new G.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new c.m(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new G.g(0,0,0,0),this._currentColor2=new G.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=N._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let n=this.age,k=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===k?(k=1,n=this._randomCellOffset):n+=this._randomCellOffset);const T=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let c;c=this._initialSpriteCellLoop?(0,I.b)(n*k%this.lifeTime/this.lifeTime):(0,I.b)(n*k/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+c*T|0}_inheritParticleInfoToSubEmitter(n){if(n.particleSystem.j.position){const k=n.particleSystem.j;if(k.position.p(this.position),n.inheritDirection){const n=c.l.li[0];this.direction.normalizeToRef(n),k.setDirection(n,0,Math.PI/2)}}else{n.particleSystem.j.p(this.position)}this.direction.scaleToRef(n.inheritedVelocityAmount/2,c.l.li[0]),n.particleSystem._inheritedVelocityOffset.p(c.l.li[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const n of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(n)}_reset(){this.age=0,this.id=N._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(n){n.position.p(this.position),this._initialDirection?n._initialDirection?n._initialDirection.p(this._initialDirection):n._initialDirection=this._initialDirection.clone():n._initialDirection=null,n.direction.p(this.direction),this.zg&&(n.zg?n.zg.p(this.zg):n.zg=this.zg.clone()),n.color.p(this.color),n.colorStep.p(this.colorStep),n.lifeTime=this.lifeTime,n.age=this.age,n._randomCellOffset=this._randomCellOffset,n.size=this.size,n.scale.p(this.scale),n.angle=this.angle,n.angularSpeed=this.angularSpeed,n.particleSystem=this.particleSystem,n.cellIndex=this.cellIndex,n.id=this.id,n._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(n._currentColorGradient=this._currentColorGradient,n._currentColor1.p(this._currentColor1),n._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(n._currentSizeGradient=this._currentSizeGradient,n._currentSize1=this._currentSize1,n._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(n._currentAngularSpeedGradient=this._currentAngularSpeedGradient,n._currentAngularSpeed1=this._currentAngularSpeed1,n._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(n._currentVelocityGradient=this._currentVelocityGradient,n._currentVelocity1=this._currentVelocity1,n._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(n._currentLimitVelocityGradient=this._currentLimitVelocityGradient,n._currentLimitVelocity1=this._currentLimitVelocity1,n._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(n._currentDragGradient=this._currentDragGradient,n._currentDrag1=this._currentDrag1,n._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(n._initialStartSpriteCellId=this._initialStartSpriteCellId,n._initialEndSpriteCellId=this._initialEndSpriteCellId,n._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(n.remapData&&this.remapData?n.remapData.p(this.remapData):n.remapData=new c.p(0,0,0,0)),this._randomNoiseCoordinates1&&(n._randomNoiseCoordinates1?(n._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),n._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(n._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),n._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}N._Count=0;var nn=T(848),kn=(T(2415),T(929)),Tn=T(919),cn=T(2493);function Kn(n,k){const T=(0,I.l)(0,1);G.g.LerpToRef(k.color1,k.color2,T,n.color),k.colorDead.subtractToRef(n.color,k._colorDiff),k._colorDiff.scaleToRef(1/n.lifeTime,n.colorStep)}function Qn(n,k){n._currentColorGradient=k._colorGradients[0],n._currentColorGradient.getColorToRef(n.color),n._currentColor1.p(n.color),k._colorGradients.length>1?k._colorGradients[1].getColorToRef(n._currentColor2):n._currentColor2.p(n.color)}function Gn(n,k){const T=k._colorGradients;p.GetCurrentGradient(k._ratio,T,((k,T,c)=>{k!==n._currentColorGradient&&(n._currentColor1.p(n._currentColor2),T.getColorToRef(n._currentColor2),n._currentColorGradient=k),G.g.LerpToRef(n._currentColor1,n._currentColor2,c,n.color)}))}function wn(n,k){n.colorStep.scaleToRef(k._scaledUpdateSpeed,k._scaledColorStep),n.color.addInPlace(k._scaledColorStep),n.color.a<0&&(n.color.a=0)}function En(n,k){p.GetCurrentGradient(k._ratio,k._angularSpeedGradients,((k,T,c)=>{k!==n._currentAngularSpeedGradient&&(n._currentAngularSpeed1=n._currentAngularSpeed2,n._currentAngularSpeed2=T.getFactor(),n._currentAngularSpeedGradient=k),n.angularSpeed=(0,I.i)(n._currentAngularSpeed1,n._currentAngularSpeed2,c)}))}function In(n,k){n.angle+=n.angularSpeed*k._scaledUpdateSpeed}function Sn(n,k){k.particleEmitterType.startDirectionFunction(k._emitterWorldMatrix,n.direction,n,k.isLocal,k._emitterInverseWorldMatrix)}function Pn(n,k){k.startDirectionFunction(k._emitterWorldMatrix,n.direction,n,k.isLocal)}function Wn(n,k){n._currentVelocityGradient=k._velocityGradients[0],n._currentVelocity1=n._currentVelocityGradient.getFactor(),k._velocityGradients.length>1?n._currentVelocity2=k._velocityGradients[1].getFactor():n._currentVelocity2=n._currentVelocity1}function Jn(n,k){n._currentLimitVelocityGradient=k._limitVelocityGradients[0],n._currentLimitVelocity1=n._currentLimitVelocityGradient.getFactor(),k._limitVelocityGradients.length>1?n._currentLimitVelocity2=k._limitVelocityGradients[1].getFactor():n._currentLimitVelocity2=n._currentLimitVelocity1}function Hn(n,k){p.GetCurrentGradient(k._ratio,k._velocityGradients,((T,c,K)=>{T!==n._currentVelocityGradient&&(n._currentVelocity1=n._currentVelocity2,n._currentVelocity2=c.getFactor(),n._currentVelocityGradient=T),k._directionScale*=(0,I.i)(n._currentVelocity1,n._currentVelocity2,K)}))}function sn(n,k){p.GetCurrentGradient(k._ratio,k._limitVelocityGradients,((T,c,K)=>{T!==n._currentLimitVelocityGradient&&(n._currentLimitVelocity1=n._currentLimitVelocity2,n._currentLimitVelocity2=c.getFactor(),n._currentLimitVelocityGradient=T);const Q=(0,I.i)(n._currentLimitVelocity1,n._currentLimitVelocity2,K);n.direction.length()>Q&&n.direction.scaleInPlace(k.limitVelocityDamping)}))}function bn(n,k){n.direction.scaleToRef(k._directionScale,k._scaledDirection)}function Cn(n,k){k.particleEmitterType.startPositionFunction(k._emitterWorldMatrix,n.position,n,k.isLocal)}function zn(n,k){k.startPositionFunction(k._emitterWorldMatrix,n.position,n,k.isLocal)}function rn(n,k){n.zg?n.zg.p(n.position):n.zg=n.position.clone(),c.o.TransformCoordinatesToRef(n.zg,k._emitterWorldMatrix,n.position)}function qn(n,k){k.isLocal&&n.zg?(n.zg.addInPlace(k._scaledDirection),c.o.TransformCoordinatesToRef(n.zg,k._emitterWorldMatrix,n.position)):n.position.addInPlace(k._scaledDirection)}function On(n,k){n._currentDragGradient=k._dragGradients[0],n._currentDrag1=n._currentDragGradient.getFactor(),k._dragGradients.length>1?n._currentDrag2=k._dragGradients[1].getFactor():n._currentDrag2=n._currentDrag1}function un(n,k){p.GetCurrentGradient(k._ratio,k._dragGradients,((T,c,K)=>{T!==n._currentDragGradient&&(n._currentDrag1=n._currentDrag2,n._currentDrag2=c.getFactor(),n._currentDragGradient=T);const Q=(0,I.i)(n._currentDrag1,n._currentDrag2,K);k._scaledDirection.scaleInPlace(1-Q)}))}function fn(n,k){n._randomNoiseCoordinates1?(n._randomNoiseCoordinates1.di(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2.di(Math.random(),Math.random(),Math.random())):(n._randomNoiseCoordinates1=new c.o(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2=new c.o(Math.random(),Math.random(),Math.random()))}function An(n,k){const T=k._noiseTextureData,K=k._noiseTextureSize;if(T&&K&&n._randomNoiseCoordinates1){const Q=k._fetchR(n._randomNoiseCoordinates1.x,n._randomNoiseCoordinates1.y,K.width,K.height,T),G=k._fetchR(n._randomNoiseCoordinates1.z,n._randomNoiseCoordinates2.x,K.width,K.height,T),w=k._fetchR(n._randomNoiseCoordinates2.y,n._randomNoiseCoordinates2.z,K.width,K.height,T),E=c.l.li[0],I=c.l.li[1];E.di((2*Q-1)*k.noiseStrength.x,(2*G-1)*k.noiseStrength.y,(2*w-1)*k.noiseStrength.z),E.scaleToRef(k._tempScaledUpdateSpeed,I),n.direction.addInPlace(I)}}function vn(n,k){k.gravity.scaleToRef(k._tempScaledUpdateSpeed,k._scaledGravity),n.direction.addInPlace(k._scaledGravity)}function Fn(n,k){n.size=(0,I.l)(k.minSize,k.maxSize),n.scale.di((0,I.l)(k.minScaleX,k.maxScaleX),(0,I.l)(k.minScaleY,k.maxScaleY))}function mn(n,k){n._currentSizeGradient=k._sizeGradients[0],n._currentSize1=n._currentSizeGradient.getFactor(),n.size=n._currentSize1,k._sizeGradients.length>1?n._currentSize2=k._sizeGradients[1].getFactor():n._currentSize2=n._currentSize1,n.scale.di((0,I.l)(k.minScaleX,k.maxScaleX),(0,I.l)(k.minScaleY,k.maxScaleY))}function xn(n,k){const T=k._actualFrame/k.targetStopDuration;p.GetCurrentGradient(T,k._startSizeGradients,((T,c,K)=>{T!==k._currentStartSizeGradient&&(k._currentStartSize1=k._currentStartSize2,k._currentStartSize2=c.getFactor(),k._currentStartSizeGradient=T);const Q=(0,I.i)(k._currentStartSize1,k._currentStartSize2,K);n.scale.scaleInPlace(Q)}))}function gn(n,k){p.GetCurrentGradient(k._ratio,k._sizeGradients,((k,T,c)=>{k!==n._currentSizeGradient&&(n._currentSize1=n._currentSize2,n._currentSize2=T.getFactor(),n._currentSizeGradient=k),n.size=(0,I.i)(n._currentSize1,n._currentSize2,c)}))}function Un(n,k){n.remapData=new c.p(0,1,0,1)}function Vn(n,k){k._colorRemapGradients&&k._colorRemapGradients.length>0&&p.GetCurrentGradient(k._ratio,k._colorRemapGradients,((k,T,c)=>{const K=(0,I.i)(k.factor1,T.factor1,c),Q=(0,I.i)(k.factor2,T.factor2,c);n.remapData.x=K,n.remapData.y=Q-K})),k._alphaRemapGradients&&k._alphaRemapGradients.length>0&&p.GetCurrentGradient(k._ratio,k._alphaRemapGradients,((k,T,c)=>{const K=(0,I.i)(k.factor1,T.factor1,c),Q=(0,I.i)(k.factor2,T.factor2,c);n.remapData.z=K,n.remapData.w=Q-K}))}function Yn(n,k){const T=(0,I.b)(k._actualFrame/k.targetStopDuration);p.GetCurrentGradient(T,k._lifeTimeGradients,((k,c)=>{const K=k,Q=c,G=K.getFactor(),w=Q.getFactor(),E=(T-K.gradient)/(Q.gradient-K.gradient);n.lifeTime=(0,I.i)(G,w,E)})),k._emitPower=(0,I.l)(k.minEmitPower,k.maxEmitPower)}function Zn(n,k){n.lifeTime=(0,I.l)(k.minLifeTime,k.maxLifeTime),k._emitPower=(0,I.l)(k.minEmitPower,k.maxEmitPower)}function en(n,k){0===k._emitPower?(n._initialDirection?n._initialDirection.p(n.direction):n._initialDirection=n.direction.clone(),n.direction.set(0,0,0)):(n._initialDirection=null,n.direction.scaleInPlace(k._emitPower)),n.direction.addInPlace(k._inheritedVelocityOffset)}function dn(n,k){n.angularSpeed=(0,I.l)(k.minAngularSpeed,k.maxAngularSpeed),n.angle=(0,I.l)(k.minInitialRotation,k.maxInitialRotation)}function ln(n,k){n._currentAngularSpeedGradient=k._angularSpeedGradients[0],n.angularSpeed=n._currentAngularSpeedGradient.getFactor(),n._currentAngularSpeed1=n.angularSpeed,k._angularSpeedGradients.length>1?n._currentAngularSpeed2=k._angularSpeedGradients[1].getFactor():n._currentAngularSpeed2=n._currentAngularSpeed1,n.angle=(0,I.l)(k.minInitialRotation,k.maxInitialRotation)}function Bn(n,k){n._initialStartSpriteCellId=k.startSpriteCellID,n._initialEndSpriteCellId=k.endSpriteCellID,n._initialSpriteCellLoop=k.spriteCellLoop}function tn(n,k){n.previousItem=k.previousItem,n.nextItem=k,k.previousItem&&(k.previousItem.nextItem=n),k.previousItem=n}function Mn(n,k){n.previousItem=k,n.nextItem=k.nextItem,k.nextItem&&(k.nextItem.previousItem=n),k.nextItem=n}function on(n,k){let T=k;for(;T.nextItem;)T=T.nextItem;n.previousItem=T,n.nextItem=T.nextItem,T.nextItem=n}function Dn(n){n.previousItem&&(n.previousItem.nextItem=n.nextItem),n.nextItem&&(n.nextItem.previousItem=n.previousItem)}class Rn extends E{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(n){this._startDirectionFunction!==n&&(this._startDirectionFunction=n,this._directionProcessing.process=n?Pn:Sn)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(n){this._startPositionFunction!==n&&(this._startPositionFunction=n,this._positionCreation.process=n?zn:Cn)}set onDispose(n){this._onDisposeObserver&&this.Gi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Gi.add(n)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(n){this._useRampGradients!==n&&(this._useRampGradients=n,this._resetEffect(),n?(this._rampCreation={process:Un,previousItem:null,nextItem:null},Mn(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Vn,previousItem:null,nextItem:null},Mn(this._remapGradientProcessing,this._gravityProcessing)):(Dn(this._rampCreation),Dn(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(n){this._isLocal!==n&&(this._isLocal=n,n?(this._isLocalCreation={process:rn,previousItem:null,nextItem:null},Mn(this._isLocalCreation,this._positionCreation)):Dn(this._isLocalCreation))}get particles(){return this.Hl}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(n){this._animationSheetEnabled!==n&&(this._animationSheetEnabled=n,n?(this._sheetCreation={process:Bn,previousItem:null,nextItem:null},Mn(this._sheetCreation,this._colorCreation)):Dn(this._sheetCreation),this._reset())}getActiveCount(){return this.Hl.length}getClassName(){return"bj"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var n;let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(n=this._customWrappers[k])||void 0===n?void 0:n.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[n]??this._customWrappers[0]}setCustomEffect(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[k]=new nn.b(this._engine),this._customWrappers[k].effect=n,this._customWrappers[k].drawContext&&(this._customWrappers[k].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(n){if(this.noiseTexture!==n){if(this._noiseTexture=n,!n)return Dn(this._noiseCreation),void Dn(this._noiseProcessing);this._noiseCreation={process:fn,previousItem:null,nextItem:null},Mn(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:An,previousItem:null,nextItem:null},Mn(this._noiseProcessing,this._positionProcessing)}}constructor(n,k,T){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,E=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(n),this._emitterInverseWorldMatrix=c.d.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new c.o,this.Gi=new a.b,this.onStoppedObservable=new a.b,this.onStartedObservable=new a.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Hl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new G.g(0,0,0,0),this._colorDiff=new G.g(0,0,0,0),this._scaledDirection=c.o.Zero(),this._scaledGravity=c.o.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=n=>{},this.recycleParticle=n=>{const k=this.Hl.pop();k!==n&&k.copyTo(n),this._stockParticles.push(k)},this._createParticle=()=>{let n;return 0!==this._stockParticles.length?(n=this._stockParticles.pop(),n._reset()):n=new N(this),this._prepareParticle(n),n},this.paused=!1,this._shadersLoaded=!1,this._capacity=k,this._epsilon=w,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=c.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||y.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.oi.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Zn,previousItem:null,nextItem:null},this._positionCreation={process:Cn,previousItem:null,nextItem:null},Mn(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Sn,previousItem:null,nextItem:null},Mn(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:en,previousItem:null,nextItem:null},Mn(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Fn,previousItem:null,nextItem:null},Mn(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:dn,previousItem:null,nextItem:null},Mn(this._angleCreation,this._sizeCreation),this._colorCreation={process:Kn,previousItem:null,nextItem:null},Mn(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,E||(this._colorProcessing={process:wn,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:In,previousItem:null,nextItem:null},Mn(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:bn,previousItem:null,nextItem:null},Mn(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:qn,previousItem:null,nextItem:null},Mn(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:vn,previousItem:null,nextItem:null},Mn(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Q,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new nn.b(this._engine)},this._customWrappers[0].effect=K,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new P,this.updateFunction=n=>{var k;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(k=this.noiseTexture.getContent())||void 0===k||k.then((n=>{this._noiseTextureData=n})));const T=n===this.Hl;for(let c=0;c<n.length;c++){const k=n[c];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const K=k.age;if(k.age+=this._tempScaledUpdateSpeed,k.age>k.lifeTime){const n=k.age-K,T=k.lifeTime-K;this._tempScaledUpdateSpeed=T*this._tempScaledUpdateSpeed/n,k.age=k.lifeTime}this._ratio=k.age/k.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Q=this._updateQueueStart;for(;Q;)Q.process(k,this),Q=Q.nextItem;if(this._isAnimationSheetEnabled&&!E&&k.updateCellIndex(),k._inheritParticleInfoToSubEmitters(),k.age>=k.lifeTime){if(this._emitFromParticle(k),k._attachedSubEmitters){for(const n of k._attachedSubEmitters)n.particleSystem.disposeOnStop=!0,n.particleSystem.stop();k._attachedSubEmitters=null}this.recycleParticle(k),T&&c--}else;}}}serialize(n){throw new Error("Method not implemented.")}clone(n,k){throw new Error("Method not implemented.")}_addFactorGradient(n,k,T,c){const K=new j(k,T,c);n.push(K),n.sort(((n,k)=>n.gradient<k.gradient?-1:n.gradient>k.gradient?1:0))}_removeFactorGradient(n,k){if(!n)return;let T=0;for(const c of n){if(c.gradient===k){n.splice(T,1);break}T++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Yn:this._lifeTimeCreation.process=Zn}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:xn,previousItem:null,nextItem:null},Mn(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Dn(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(n){this.targetStopDuration!==n&&(this._targetStopDuration=n,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(n,k,T){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,n,k,T),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(n){return this._removeFactorGradient(this._lifeTimeGradients,n),this._syncLifeTimeCreation(),this}addSizeGradient(n,k,T){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=mn,this._sizeGradientProcessing={process:gn,previousItem:null,nextItem:null},tn(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,n,k,T),this}removeSizeGradient(n){var k;return this._removeFactorGradient(this._sizeGradients,n),0===(null===(k=this._sizeGradients)||void 0===k?void 0:k.length)&&(Dn(this._sizeGradientProcessing),this._sizeCreation.process=Fn),this}addColorRemapGradient(n,k,T){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,n,k,T),this}removeColorRemapGradient(n){return this._removeFactorGradient(this._colorRemapGradients,n),this}addAlphaRemapGradient(n,k,T){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,n,k,T),this}removeAlphaRemapGradient(n){return this._removeFactorGradient(this._alphaRemapGradients,n),this}addAngularSpeedGradient(n,k,T){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ln,this._angularSpeedGradientProcessing={process:En,previousItem:null,nextItem:null},tn(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,n,k,T),this}removeAngularSpeedGradient(n){var k;return this._removeFactorGradient(this._angularSpeedGradients,n),0===(null===(k=this._angularSpeedGradients)||void 0===k?void 0:k.length)&&(this._angleCreation.process=dn,Dn(this._angularSpeedGradientProcessing)),this}addVelocityGradient(n,k,T){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Wn,previousItem:null,nextItem:null},Mn(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Hn,previousItem:null,nextItem:null},tn(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,n,k,T),this}removeVelocityGradient(n){var k;return this._removeFactorGradient(this._velocityGradients,n),0===(null===(k=this._velocityGradients)||void 0===k?void 0:k.length)&&(Dn(this._velocityCreation),Dn(this._velocityGradientProcessing)),this}addLimitVelocityGradient(n,k,T){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Jn,previousItem:null,nextItem:null},Mn(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:sn,previousItem:null,nextItem:null},Mn(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,n,k,T),this}removeLimitVelocityGradient(n){var k;return this._removeFactorGradient(this._limitVelocityGradients,n),0===(null===(k=this._limitVelocityGradients)||void 0===k?void 0:k.length)&&(Dn(this._limitVelocityCreation),Dn(this._limitVelocityGradientProcessing)),this}addDragGradient(n,k,T){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:On,previousItem:null,nextItem:null},tn(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:un,previousItem:null,nextItem:null},tn(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,n,k,T),this}removeDragGradient(n){var k;return this._removeFactorGradient(this._dragGradients,n),0===(null===(k=this._dragGradients)||void 0===k?void 0:k.length)&&(Dn(this._dragCreation),Dn(this._dragGradientProcessing)),this}addEmitRateGradient(n,k,T){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,n,k,T),this}removeEmitRateGradient(n){return this._removeFactorGradient(this._emitRateGradients,n),this}addStartSizeGradient(n,k,T){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,n,k,T),this._syncStartSizeCreation(),this}removeStartSizeGradient(n){return this._removeFactorGradient(this._startSizeGradients,n),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const n=new Uint8Array(4*this._rawTextureWidth),k=G.h.Ri[0];for(let T=0;T<this._rawTextureWidth;T++){const c=T/this._rawTextureWidth;p.GetCurrentGradient(c,this._rampGradients,((c,K,Q)=>{G.e.LerpToRef(c.color,K.color,Q,k),n[4*T]=255*k.r,n[4*T+1]=255*k.g,n[4*T+2]=255*k.b,n[4*T+3]=255}))}this._rampGradientsTexture=X.e.CreateRGBATexture(n,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((n,k)=>n.gradient<k.gradient?-1:n.gradient>k.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(n,k){this._rampGradients||(this._rampGradients=[]);const T=new h(n,k);return this._rampGradients.push(T),this._syncRampGradientTexture(),this}removeRampGradient(n){return this._removeGradientAndTexture(n,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(n,k,T){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Qn,this._colorProcessing.process=Gn);const c=new L(n,k,T);return this._colorGradients.push(c),this._colorGradients.sort(((n,k)=>n.gradient<k.gradient?-1:n.gradient>k.gradient?1:0)),this}removeColorGradient(n){if(!this._colorGradients)return this;let k=0;for(const T of this._colorGradients){if(T.gradient===n){this._colorGradients.splice(k,1);break}k++}return 0===this._colorGradients.length&&(this._colorCreation.process=Kn,this._colorProcessing.process=wn),this}resetDrawCache(){if(this._drawWrappers){for(const n of this._drawWrappers)if(n)for(const k of n)null===k||void 0===k||k.dispose();this._drawWrappers=[]}}_fetchR(n,k,T,c,K){return K[4*(((n=.5*Math.abs(n)+.5)*T%T|0)+((k=.5*Math.abs(k)+.5)*c%c|0)*T)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const n=this._engine,k=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*k),this._vertexBuffer=new O.b(n,this._vertexData,!0,k);let T=0;const c=this._vertexBuffer.createVertexBuffer(O.f.PositionKind,T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[O.f.PositionKind]=c,T+=3;const K=this._vertexBuffer.createVertexBuffer(O.f.ColorKind,T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[O.f.ColorKind]=K,T+=4;const Q=this._vertexBuffer.createVertexBuffer("angle",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Q,T+=1;const G=this._vertexBuffer.createVertexBuffer("size",T,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=G,T+=2,this._isAnimationSheetEnabled){const n=this._vertexBuffer.createVertexBuffer("cellIndex",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=n,T+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const n=this._vertexBuffer.createVertexBuffer("direction",T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=n,T+=3}if(this._useRampGradients){const n=this._vertexBuffer.createVertexBuffer("remapData",T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=n,T+=4}let w;if(this._useInstancing){const k=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new O.b(n,k,!1,2),w=this._spriteBuffer.createVertexBuffer("offset",0,2)}else w=this._vertexBuffer.createVertexBuffer("offset",T,2,this._vertexBufferSize,this._useInstancing),T+=2;this._vertexBuffers.offset=w,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const n=[],k=[];let T=0;for(let c=0;c<this._capacity;c++)n.push(T),n.push(T+1),n.push(T+2),n.push(T),n.push(T+2),n.push(T+3),k.push(T,T+1,T+1,T+2,T+2,T+3,T+3,T,T,T+3),T+=4;this._indexBuffer=this._engine.createIndexBuffer(n),this._linesIndexBuffer=this._engine.createIndexBuffer(k)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(n)setTimeout((()=>{this.start(0)}),n);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var k;-1!==(null===(k=this.j)||void 0===k?void 0:k.getClassName().indexOf("Mesh"))&&this.j.pi(!0);const n=this.noiseTexture;if(n&&n.onGeneratedObservable)n.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let k=0;k<this.preWarmCycles;k++)this.animate(!0),n.render()}))}));else for(let k=0;k<this.preWarmCycles;k++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(n))}_postStop(n){}reset(){this._stockParticles.length=0,this.Hl.length=0}_appendParticleVertex(n,k,T,K){let Q=n*this._vertexBufferSize;if(this._vertexData[Q++]=k.position.x+this.ie.x,this._vertexData[Q++]=k.position.y+this.ie.y,this._vertexData[Q++]=k.position.z+this.ie.z,this._vertexData[Q++]=k.color.r,this._vertexData[Q++]=k.color.g,this._vertexData[Q++]=k.color.b,this._vertexData[Q++]=k.color.a,this._vertexData[Q++]=k.angle,this._vertexData[Q++]=k.scale.x*k.size,this._vertexData[Q++]=k.scale.y*k.size,this._isAnimationSheetEnabled&&(this._vertexData[Q++]=k.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Q++]=k.direction.x,this._vertexData[Q++]=k.direction.y,this._vertexData[Q++]=k.direction.z);else if(k._initialDirection){let n=k._initialDirection;this.isLocal&&(c.o.TransformNormalToRef(n,this._emitterWorldMatrix,c.l.li[0]),n=c.l.li[0]),0===n.x&&0===n.z&&(n.x=.001),this._vertexData[Q++]=n.x,this._vertexData[Q++]=n.y,this._vertexData[Q++]=n.z}else{let n=k.direction;this.isLocal&&(c.o.TransformNormalToRef(n,this._emitterWorldMatrix,c.l.li[0]),n=c.l.li[0]),0===n.x&&0===n.z&&(n.x=.001),this._vertexData[Q++]=n.x,this._vertexData[Q++]=n.y,this._vertexData[Q++]=n.z}this._useRampGradients&&k.remapData&&(this._vertexData[Q++]=k.remapData.x,this._vertexData[Q++]=k.remapData.y,this._vertexData[Q++]=k.remapData.z,this._vertexData[Q++]=k.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===T?T=this._epsilon:1===T&&(T=1-this._epsilon),0===K?K=this._epsilon:1===K&&(K=1-this._epsilon)),this._vertexData[Q++]=T,this._vertexData[Q++]=K)}_prepareParticle(n){}_createNewOnes(n){let k;for(let T=0;T<n&&this.Hl.length!==this._capacity;T++){k=this._createParticle(),this.Hl.push(k);let n=this._createQueueStart;for(;n;)n.process(k,this),n=n.nextItem;k._inheritParticleInfoToSubEmitters()}}_update(n){if(this._alive=this.Hl.length>0,this.j.position){const n=this.j;this._emitterWorldMatrix=n.getWorldMatrix()}else{const n=this.j;this._emitterWorldMatrix=c.d.Translation(n.x,n.y,n.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Hl),this._createNewOnes(n)}static _GetAttributeNamesOrOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=[O.f.PositionKind,O.f.ColorKind,"angle","offset","size"];return n&&c.push("cellIndex"),k||c.push("direction"),T&&c.push("remapData"),c}static _GetEffectCreationOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,kn.c)(c),n&&c.push("particlesInfos"),k&&c.push("logarithmicDepthConstant"),T&&(c.push("vFogInfos"),c.push("vFogColor")),c}fillDefines(n,k){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,kn.i)(this,this._scene,n),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&n.push("#define FOG")),this._isAnimationSheetEnabled&&n.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH"),k===E.BLENDMODE_MULTIPLY&&n.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&n.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(n.push("#define BILLBOARD"),this.billboardMode){case 2:n.push("#define BILLBOARDY");break;case 8:case 9:n.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&n.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:n.push("#define BILLBOARDMODE_ALL")}T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),n.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(n,k,T){k.push(...Rn._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),n.push(...Rn._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,cn.g)(n,this._imageProcessingConfigurationDefines),(0,cn.d)(T,this._imageProcessingConfigurationDefines))}_getWrapper(n){const k=this._getCustomDrawWrapper(n);if(null!==k&&void 0!==k&&k.effect)return k;const T=[];this.fillDefines(T,n);const c=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let K=this._drawWrappers[c];K||(K=this._drawWrappers[c]=[]);let Q=K[n];Q||(Q=new nn.b(this._engine),Q.drawContext&&(Q.drawContext.useInstancing=this._useInstancing),K[n]=Q);const G=T.join("\n");if(Q.defines!==G){const n=[],k=[],T=[];this.fillUniformsAttributesAndSamplerNames(k,n,T),Q.setEffect(this._engine.createEffect("particles",n,k,T,G,void 0,void 0,void 0,void 0,this._shaderLanguage),G)}return Q}animate(){var n;let k,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!T&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(T?this.preWarmStepOffset:(null===(n=this._scene)||void 0===n?void 0:n.getAnimationRatio())||1),this.manualEmitCount>-1)k=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let n=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const k=this._actualFrame/this.targetStopDuration;p.GetCurrentGradient(k,this._emitRateGradients,((k,T,c)=>{k!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=T.getFactor(),this._currentEmitRateGradient=k),n=(0,I.i)(this._currentEmitRate1,this._currentEmitRate2,c)}))}k=n*this._scaledUpdateSpeed|0,this._newPartsExcess+=n*this._scaledUpdateSpeed-k}if(this._newPartsExcess>1&&(k+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?k=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(k),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!T){let n=0;for(let k=0;k<this.Hl.length;k++){const T=this.Hl[k];this._appendParticleVertices(n,T),n+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Hl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(n,k){this._appendParticleVertex(n++,k,0,0),this._useInstancing||(this._appendParticleVertex(n++,k,1,0),this._appendParticleVertex(n++,k,1,1),this._appendParticleVertex(n++,k,0,1))}rebuild(){var n;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(n=this._spriteBuffer)||void 0===n||n._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Rn.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(T.bind(T,12538)),Promise.resolve().then(T.bind(T,12482))])):await Promise.all([Promise.resolve().then(T.bind(T,12476)),Promise.resolve().then(T.bind(T,12462))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==E.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(E.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(E.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(n){const k=this._getWrapper(n),T=k.effect,K=this._engine;K.enableEffect(k);const Q=this.defaultViewMatrix??this._scene.getViewMatrix();if(T.setTexture("diffuseSampler",this.particleTexture),T.setMatrix("view",Q),T.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const n=this.particleTexture.getBaseSize();T.setFloat3("particlesInfos",this.spriteCellWidth/n.width,this.spriteCellHeight/n.height,this.spriteCellWidth/n.width)}if(T.setVector2("translationPivot",this.translationPivot),T.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const n=this._scene.activeCamera;T.setVector3("eyePosition",n.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),T.setTexture("rampSampler",this._rampGradientsTexture));const G=T.defines;var w,E,I,S,P,W;(this._scene&&((0,kn.f)(T,this,this._scene),this.applyFog&&(0,Tn.c)(this._scene,void 0,T)),G.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Q.invertToRef(c.l.Matrix[0]),T.setMatrix("invView",c.l.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?K.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,T):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,T)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?K.bindBuffers(this._vertexBuffers,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBuffer:this._indexBuffer,T):K.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:null,T);(this.useLogarithmicDepth&&this._scene&&(0,Tn.j)(G,T,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(T),this._setEngineBasedOnBlendMode(n),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(T),this._useInstancing)?null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?K.drawElementsType(6,0,10,this.Hl.length):K.drawArraysType(7,0,4,this.Hl.length):null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?K.drawElementsType(1,0,10*this.Hl.length):K.drawElementsType(0,0,6*this.Hl.length);return this.Hl.length}render(){if(!this.isReady()||!this.Hl.length)return 0;const n=this._engine;n.setState&&(n.setState(!1),this.forceDepthWrite&&n.setDepthWrite(!0));let k=0;return k=this.blendMode===E.BLENDMODE_MULTIPLYADD?this._render(E.BLENDMODE_MULTIPLY)+this._render(E.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),k}_onDispose(){}dispose(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),n&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),n&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(k,T),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const n=this._scene.oi.indexOf(this);n>-1&&this._scene.oi.splice(n,1),this._scene._activeParticleSystems.dispose()}this.Gi.notifyObservers(this),this.Gi.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Rn.ForceGLSL=!1;var Ln,hn=T(576);!function(n){n[n.ATTACHED=0]="ATTACHED",n[n.END=1]="END"}(Ln||(Ln={}));class jn{constructor(n){if(this.particleSystem=n,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!n.j||!n.j.dispose){const k=(0,w.b)("BABYLON.AbstractMesh");n.j=new k("SubemitterSystemEmitter",n.va()),n._disposeEmitterOnDispose=!0}}clone(){let n=this.particleSystem.j;if(n){if(n instanceof c.o)n=n.clone();else if(-1!==n.getClassName().indexOf("Mesh")){n=new((0,w.b)("BABYLON.Mesh"))("",n.va()),n.isVisible=!1}}else n=new c.o;const k=new jn(this.particleSystem.clone(this.particleSystem.name,n));return k.particleSystem.name+="Clone",k.type=this.type,k.inheritDirection=this.inheritDirection,k.inheritedVelocityAmount=this.inheritedVelocityAmount,k.particleSystem._disposeEmitterOnDispose=!0,k.particleSystem.disposeOnStop=!0,k}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={};return k.type=this.type,k.inheritDirection=this.inheritDirection,k.inheritedVelocityAmount=this.inheritedVelocityAmount,k.particleSystem=this.particleSystem.serialize(n),k}static _ParseParticleSystem(n,k,T){throw(0,hn.e)("ParseParticle")}static Parse(n,k,T){const c=n.particleSystem,K=new jn(jn._ParseParticleSystem(c,k,T,!0));return K.type=n.type,K.inheritDirection=n.inheritDirection,K.inheritedVelocityAmount=n.inheritedVelocityAmount,K.particleSystem._isSubEmitter=!0,K}dispose(){this.particleSystem.dispose()}}var pn=T(615);function an(n,k){const T=new C;return T.direction1=n,T.direction2=k,T}function Xn(){return new b(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function yn(){return new z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Nn(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.o(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0);return new r(n,k,T)}function nk(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function kk(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0),Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.o(0,1,0);return new s(n,k,T,K,Q)}function Tk(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new W(n,k)}function ck(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0),K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0);return new J(n,k,T,K)}const Kk=c.o.Zero(),Qk=c.o.Zero(),Gk=c.o.Zero();class wk{constructor(){this.strength=0,this.position=c.o.Zero()}_processParticle(n,k){this.position.subtractToRef(n.position,Kk);const T=Kk.lengthSquared()+1;Kk.normalize().scaleToRef(this.strength/T,Qk),Qk.scaleToRef(k._tempScaledUpdateSpeed,Gk),n.direction.addInPlace(Gk)}serialize(){return{position:this.position.wi(),strength:this.strength}}}class Ek extends Rn{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=n=>{if(!this._subEmitters||0===this._subEmitters.length)return;const k=Math.floor(Math.random()*this._subEmitters.length);for(const T of this._subEmitters[k])if(1===T.type){const k=T.clone();n._inheritParticleInfoToSubEmitter(k),k.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(k.particleSystem),k.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(n,k){const T=an(n,k);return this.particleEmitterType=T,T}get flowMap(){return this._flowMap}set flowMap(n){this._flowMap!==n&&(this._flowMap=n,this._flowMapUpdate&&(Dn(this._flowMapUpdate),this._flowMapUpdate=null),n&&(this._flowMapUpdate={process:n=>{var k;const T=null===(k=this.va())||void 0===k?void 0:k.getTransformMatrix();this._flowMap._processParticle(n,this.flowMapStrength*this._tempScaledUpdateSpeed,T)},previousItem:null,nextItem:null},Mn(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(n){this._attractors.push(n),1===this._attractors.length&&(this._attractorUpdate={process:n=>{for(const k of this._attractors)k._processParticle(n,this)},previousItem:null,nextItem:null},Mn(this._attractorUpdate,this._directionProcessing))}removeAttractor(n){const k=this._attractors.indexOf(n);-1!==k&&this._attractors.splice(k,1),0===this._attractors.length&&Dn(this._attractorUpdate)}start(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(n)}createHemisphericEmitter(){const n=Xn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createSphereEmitter(){const n=yn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createDirectedSphereEmitter(){const n=Nn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0));return this.particleEmitterType=n,n}createCylinderEmitter(){const n=nk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=n,n}createDirectedCylinderEmitter(){const n=kk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.o(0,1,0));return this.particleEmitterType=n,n}createConeEmitter(){const n=Tk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=n,n}createDirectedConeEmitter(){const n=ck(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0));return this.particleEmitterType=n,n}createBoxEmitter(n,k,T,c){const K=new P;return this.particleEmitterType=K,this.direction1=n,this.direction2=k,this.minEmitBox=T,this.maxEmitBox=c,K}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const n of this.subEmitters)n instanceof Ek?this._subEmitters.push([new jn(n)]):n instanceof jn?this._subEmitters.push([n]):n instanceof Array&&this._subEmitters.push(n)}_stopSubEmitters(){if(this.activeSubSystems){for(const n of this.activeSubSystems)n.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const n=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==n&&this._rootParticleSystem.activeSubSystems.splice(n,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(n){n&&this._stopSubEmitters()}_prepareParticle(n){if(this._subEmitters&&this._subEmitters.length>0){const k=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];n._attachedSubEmitters=[];for(const T of k)if(0===T.type){const k=T.clone();n._attachedSubEmitters.push(k),k.particleSystem.start()}}}_onDispose(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),n&&this.particles)for(const T of this.particles)if(T._attachedSubEmitters)for(let n=T._attachedSubEmitters.length-1;n>=0;n-=1)T._attachedSubEmitters[n].dispose();if(k&&this.activeSubSystems)for(let T=this.activeSubSystems.length-1;T>=0;T-=1)this.activeSubSystems[T].dispose();if(this._subEmitters&&this._subEmitters.length){for(let n=0;n<this._subEmitters.length;n++)for(const k of this._subEmitters[n])k.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(n,k,T,K){let Q;Q=T instanceof pn.b?null:T;const E=(0,w.b)("BABYLON.Texture");if(E&&Q&&(n.texture?k.particleTexture=E.Parse(n.texture,Q,K):n.textureName&&(k.particleTexture=new E(K+n.textureName,Q,!1,void 0===n.invertY||n.invertY),k.particleTexture.name=n.textureName)),n.emitterId||0===n.emitterId||void 0!==n.j?n.emitterId&&Q?k.j=Q.getLastMeshById(n.emitterId):k.j=c.o.ji(n.j):k.j=c.o.Zero(),k.isLocal=!!n.isLocal,void 0!==n.renderingGroupId&&(k.renderingGroupId=n.renderingGroupId),void 0!==n.isBillboardBased&&(k.isBillboardBased=n.isBillboardBased),void 0!==n.billboardMode&&(k.billboardMode=n.billboardMode),void 0!==n.useLogarithmicDepth&&(k.useLogarithmicDepth=n.useLogarithmicDepth),n.animations){for(let T=0;T<n.animations.length;T++){const c=n.animations[T],K=(0,w.b)("BABYLON.Animation");K&&k.animations.push(K.Parse(c))}k.beginAnimationOnStart=n.beginAnimationOnStart,k.beginAnimationFrom=n.beginAnimationFrom,k.beginAnimationTo=n.beginAnimationTo,k.beginAnimationLoop=n.beginAnimationLoop}if(n.autoAnimate&&Q&&Q.beginAnimation(k,n.autoAnimateFrom,n.autoAnimateTo,n.autoAnimateLoop,n.autoAnimateSpeed||1),k.startDelay=0|n.startDelay,k.minAngularSpeed=n.minAngularSpeed,k.maxAngularSpeed=n.maxAngularSpeed,k.minSize=n.minSize,k.maxSize=n.maxSize,n.minScaleX&&(k.minScaleX=n.minScaleX,k.maxScaleX=n.maxScaleX,k.minScaleY=n.minScaleY,k.maxScaleY=n.maxScaleY),void 0!==n.preWarmCycles&&(k.preWarmCycles=n.preWarmCycles,k.preWarmStepOffset=n.preWarmStepOffset),void 0!==n.minInitialRotation&&(k.minInitialRotation=n.minInitialRotation,k.maxInitialRotation=n.maxInitialRotation),k.minLifeTime=n.minLifeTime,k.maxLifeTime=n.maxLifeTime,k.minEmitPower=n.minEmitPower,k.maxEmitPower=n.maxEmitPower,k.emitRate=n.emitRate,k.gravity=c.o.ji(n.gravity),n.noiseStrength&&(k.noiseStrength=c.o.ji(n.noiseStrength)),k.color1=G.g.ji(n.color1),k.color2=G.g.ji(n.color2),k.colorDead=G.g.ji(n.colorDead),k.updateSpeed=n.updateSpeed,k.targetStopDuration=n.targetStopDuration,k.blendMode=n.blendMode,n.colorGradients)for(const c of n.colorGradients)k.addColorGradient(c.gradient,G.g.ji(c.color1),c.color2?G.g.ji(c.color2):void 0);if(n.rampGradients){for(const T of n.rampGradients)k.addRampGradient(T.gradient,G.e.ji(T.color));k.useRampGradients=n.useRampGradients}if(n.colorRemapGradients)for(const c of n.colorRemapGradients)k.addColorRemapGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.alphaRemapGradients)for(const c of n.alphaRemapGradients)k.addAlphaRemapGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.sizeGradients)for(const c of n.sizeGradients)k.addSizeGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.angularSpeedGradients)for(const c of n.angularSpeedGradients)k.addAngularSpeedGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.velocityGradients)for(const c of n.velocityGradients)k.addVelocityGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.dragGradients)for(const c of n.dragGradients)k.addDragGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.emitRateGradients)for(const c of n.emitRateGradients)k.addEmitRateGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.startSizeGradients)for(const c of n.startSizeGradients)k.addStartSizeGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.lifeTimeGradients)for(const c of n.lifeTimeGradients)k.addLifeTimeGradient(c.gradient,void 0!==c.factor1?c.factor1:c.factor,c.factor2);if(n.limitVelocityGradients){for(const T of n.limitVelocityGradients)k.addLimitVelocityGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);k.limitVelocityDamping=n.limitVelocityDamping}if(n.noiseTexture&&Q){const T=(0,w.b)("BABYLON.ProceduralTexture");k.noiseTexture=T.Parse(n.noiseTexture,Q,K)}let I;if(n.particleEmitterType){switch(n.particleEmitterType.type){case"SphereParticleEmitter":I=new z;break;case"SphereDirectedParticleEmitter":I=new r;break;case"ConeEmitter":case"ConeParticleEmitter":I=new W;break;case"ConeDirectedParticleEmitter":I=new J;break;case"CylinderParticleEmitter":I=new H;break;case"CylinderDirectedParticleEmitter":I=new s;break;case"HemisphericParticleEmitter":I=new b;break;case"PointParticleEmitter":I=new C;break;case"MeshParticleEmitter":I=new u;break;case"CustomParticleEmitter":I=new q;break;default:I=new P}I.parse(n.particleEmitterType,Q)}else I=new P,I.parse(n,Q);k.particleEmitterType=I,k.startSpriteCellID=n.startSpriteCellID,k.endSpriteCellID=n.endSpriteCellID,k.spriteCellLoop=n.spriteCellLoop??!0,k.spriteCellWidth=n.spriteCellWidth,k.spriteCellHeight=n.spriteCellHeight,k.spriteCellChangeSpeed=n.spriteCellChangeSpeed,k.spriteRandomStartCell=n.spriteRandomStartCell,k.disposeOnStop=n.disposeOnStop??!1,k.manualEmitCount=n.manualEmitCount??-1}static Parse(n,k,T){let K=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0;const w=n.name;let E,I,S=null,P=null;if(k instanceof pn.b?E=k:(I=k,E=I.getEngine()),n.customShader&&E.createEffectForParticles){P=n.customShader;const k=P.shaderOptions.defines.length>0?P.shaderOptions.defines.join("\n"):"";S=E.createEffectForParticles(P.shaderPath.fragmentElement,P.shaderOptions.uniforms,P.shaderOptions.samplers,k)}const W=new Ek(w,Q||n.Vh,k,S,n.isAnimationSheetEnabled);if(W.customShader=P,W._rootUrl=T,n.id&&(W.id=n.id),n.subEmitters){W.subEmitters=[];for(const c of n.subEmitters){const n=[];for(const K of c)n.push(jn.Parse(K,k,T));W.subEmitters.push(n)}}if(n.attractors)for(const G of n.attractors){const n=new wk;n.position=c.o.ji(G.position),n.strength=G.strength,W.addAttractor(n)}return Ek._Parse(n,W,k,T),n.textureMask&&(W.textureMask=G.g.ji(n.textureMask)),n.ie&&(W.ie=c.o.ji(n.ie)),n.preventAutoStart&&(W.preventAutoStart=n.preventAutoStart),K||W.preventAutoStart||W.start(),W}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={};if(Ek._Serialize(k,this,n),k.textureMask=this.textureMask.wi(),k.customShader=this.customShader,k.preventAutoStart=this.preventAutoStart,k.ie=this.ie.wi(),this.subEmitters){k.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const T of this._subEmitters){const c=[];for(const k of T)c.push(k.serialize(n));k.subEmitters.push(c)}}if(this._attractors&&this._attractors.length){k.attractors=[];for(const n of this._attractors)k.attractors.push(n.serialize())}return k}static _Serialize(n,k,T){if(n.name=k.name,n.id=k.id,n.Vh=k.getCapacity(),n.disposeOnStop=k.disposeOnStop,n.manualEmitCount=k.manualEmitCount,k.j.position){const T=k.j;n.emitterId=T.id}else{const T=k.j;n.j=T.wi()}k.particleEmitterType&&(n.particleEmitterType=k.particleEmitterType.serialize()),k.particleTexture&&(T?n.texture=k.particleTexture.serialize():(n.textureName=k.particleTexture.name,n.invertY=!!k.particleTexture._invertY)),n.isLocal=k.isLocal,Y.d.AppendSerializedAnimations(k,n),n.beginAnimationOnStart=k.beginAnimationOnStart,n.beginAnimationFrom=k.beginAnimationFrom,n.beginAnimationTo=k.beginAnimationTo,n.beginAnimationLoop=k.beginAnimationLoop,n.startDelay=k.startDelay,n.renderingGroupId=k.renderingGroupId,n.isBillboardBased=k.isBillboardBased,n.billboardMode=k.billboardMode,n.minAngularSpeed=k.minAngularSpeed,n.maxAngularSpeed=k.maxAngularSpeed,n.minSize=k.minSize,n.maxSize=k.maxSize,n.minScaleX=k.minScaleX,n.maxScaleX=k.maxScaleX,n.minScaleY=k.minScaleY,n.maxScaleY=k.maxScaleY,n.minEmitPower=k.minEmitPower,n.maxEmitPower=k.maxEmitPower,n.minLifeTime=k.minLifeTime,n.maxLifeTime=k.maxLifeTime,n.emitRate=k.emitRate,n.gravity=k.gravity.wi(),n.noiseStrength=k.noiseStrength.wi(),n.color1=k.color1.wi(),n.color2=k.color2.wi(),n.colorDead=k.colorDead.wi(),n.updateSpeed=k.updateSpeed,n.targetStopDuration=k.targetStopDuration,n.blendMode=k.blendMode,n.preWarmCycles=k.preWarmCycles,n.preWarmStepOffset=k.preWarmStepOffset,n.minInitialRotation=k.minInitialRotation,n.maxInitialRotation=k.maxInitialRotation,n.startSpriteCellID=k.startSpriteCellID,n.spriteCellLoop=k.spriteCellLoop,n.endSpriteCellID=k.endSpriteCellID,n.spriteCellChangeSpeed=k.spriteCellChangeSpeed,n.spriteCellWidth=k.spriteCellWidth,n.spriteCellHeight=k.spriteCellHeight,n.spriteRandomStartCell=k.spriteRandomStartCell,n.isAnimationSheetEnabled=k.isAnimationSheetEnabled,n.useLogarithmicDepth=k.useLogarithmicDepth;const c=k.getColorGradients();if(c){n.colorGradients=[];for(const k of c){const T={gradient:k.gradient,color1:k.color1.wi()};k.color2?T.color2=k.color2.wi():T.color2=k.color1.wi(),n.colorGradients.push(T)}}const K=k.getRampGradients();if(K){n.rampGradients=[];for(const k of K){const T={gradient:k.gradient,color:k.color.wi()};n.rampGradients.push(T)}n.useRampGradients=k.useRampGradients}const Q=k.getColorRemapGradients();if(Q){n.colorRemapGradients=[];for(const k of Q){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.colorRemapGradients.push(T)}}const G=k.getAlphaRemapGradients();if(G){n.alphaRemapGradients=[];for(const k of G){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.alphaRemapGradients.push(T)}}const w=k.getSizeGradients();if(w){n.sizeGradients=[];for(const k of w){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.sizeGradients.push(T)}}const E=k.getAngularSpeedGradients();if(E){n.angularSpeedGradients=[];for(const k of E){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.angularSpeedGradients.push(T)}}const I=k.getVelocityGradients();if(I){n.velocityGradients=[];for(const k of I){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.velocityGradients.push(T)}}const S=k.getDragGradients();if(S){n.dragGradients=[];for(const k of S){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.dragGradients.push(T)}}const P=k.getEmitRateGradients();if(P){n.emitRateGradients=[];for(const k of P){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.emitRateGradients.push(T)}}const W=k.getStartSizeGradients();if(W){n.startSizeGradients=[];for(const k of W){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.startSizeGradients.push(T)}}const J=k.getLifeTimeGradients();if(J){n.lifeTimeGradients=[];for(const k of J){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.lifeTimeGradients.push(T)}}const H=k.getLimitVelocityGradients();if(H){n.limitVelocityGradients=[];for(const k of H){const T={gradient:k.gradient,factor1:k.factor1};void 0!==k.factor2?T.factor2=k.factor2:T.factor2=k.factor1,n.limitVelocityGradients.push(T)}n.limitVelocityDamping=k.limitVelocityDamping}k.noiseTexture&&(n.noiseTexture=k.noiseTexture.serialize())}clone(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c={...this._customWrappers};let K=null;const Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){K=this.customShader;const n=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"",k=Q.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,n);c[0]?c[0].effect=k:this.setCustomEffect(k,0)}const G=this.serialize(T),w=Ek.Parse(G,this._scene||this._engine,this._rootUrl);return w.name=n,w.customShader=K,w._customWrappers=c,void 0===k&&(k=this.j),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.j=k,this.preventAutoStart||w.start(),w}}Ek.BILLBOARDMODE_Y=2,Ek.BILLBOARDMODE_ALL=7,Ek.BILLBOARDMODE_STRETCHED=8,Ek.BILLBOARDMODE_STRETCHED_LOCAL=9,jn._ParseParticleSystem=Ek.Parse;var Ik=T(2483),Sk=T(2475),Pk=T(2388);Pk.b.prototype.createTransformFeedback=function(){const n=this._gl.createTransformFeedback();if(!n)throw new Error("Unable to create Transform Feedback");return n},Pk.b.prototype.deleteTransformFeedback=function(n){this._gl.deleteTransformFeedback(n)},Pk.b.prototype.bindTransformFeedback=function(n){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,n)},Pk.b.prototype.beginTransformFeedback=function(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(n?this._gl.POINTS:this._gl.TRIANGLES)},Pk.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Pk.b.prototype.setTranformFeedbackVaryings=function(n,k){this._gl.transformFeedbackVaryings(n,k,this._gl.INTERLEAVED_ATTRIBS)},Pk.b.prototype.bindTransformFeedbackBuffer=function(n){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,n?n.underlyingResource:null)},Pk.b.prototype.readTransformFeedbackBuffer=function(n){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,n)};const Wk="clipPlaneFragmentDeclaration2",Jk="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";A.b.IncludesShadersStore[Wk]||(A.b.IncludesShadersStore[Wk]=Jk);T(12353),T(12361),T(12368),T(12374),T(12382),T(12388),T(12394),T(12400);const Hk="gpuRenderParticlesPixelShader",sk="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";A.b.ShadersStore[Hk]||(A.b.ShadersStore[Hk]=sk);const bk="clipPlaneVertexDeclaration2",Ck="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";A.b.IncludesShadersStore[bk]||(A.b.IncludesShadersStore[bk]=Ck);T(12408),T(12415),T(12422),T(12427);const zk="gpuRenderParticlesVertexShader",rk="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";A.b.ShadersStore[zk]||(A.b.ShadersStore[zk]=rk);class qk extends E{static get IsSupported(){if(!y.e.LastCreatedEngine)return!1;const n=y.e.LastCreatedEngine.getCaps();return n.supportTransformFeedbacks||n.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(n){this._maxActiveParticleCount=Math.min(n,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(n){this.maxActiveParticleCount=n}createPointEmitter(n,k){const T=an(n,k);return this.particleEmitterType=T,T}createHemisphericEmitter(){const n=Xn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createSphereEmitter(){const n=yn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createDirectedSphereEmitter(){const n=Nn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0));return this.particleEmitterType=n,n}createCylinderEmitter(){const n=nk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=n,n}createDirectedCylinderEmitter(){const n=kk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.o(0,1,0));return this.particleEmitterType=n,n}createConeEmitter(){const n=Tk(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=n,n}createDirectedConeEmitter(){const n=ck(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new c.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new c.o(0,1,0));return this.particleEmitterType=n,n}createBoxEmitter(n,k,T,c){const K=new P;return this.particleEmitterType=K,this.direction1=n,this.direction2=k,this.minEmitBox=T,this.maxEmitBox=c,K}get flowMap(){return this._flowMap}set flowMap(n){this._flowMap!==n&&(this._flowMap=n)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Ek.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Ek.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Ek.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";n?setTimeout((()=>{this.start(0)}),n):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var n;let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(n=this._customWrappers[k])||void 0===n?void 0:n.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[n]??this._customWrappers[0]}setCustomEffect(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[k]=new nn.b(this._engine),this._customWrappers[k].effect=n}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(n,k,T){return super._removeGradientAndTexture(n,k,T),this._releaseBuffers(),this}addColorGradient(n,k){this._colorGradients||(this._colorGradients=[]);const T=new L(n,k);return this._colorGradients.push(T),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(n&&this._colorGradients.sort(((n,k)=>n.gradient<k.gradient?-1:n.gradient>k.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(n){return this._removeGradientAndTexture(n,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const k in this._drawWrappers){var n;null===(n=this._drawWrappers[k].drawContext)||void 0===n||n.reset()}}_addFactorGradient(n,k,T){const c=new j(k,T);n.push(c),this._releaseBuffers()}addSizeGradient(n,k){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,n,k),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(n){return this._removeGradientAndTexture(n,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(n,k){if(!n)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&n.sort(((n,k)=>n.gradient<k.gradient?-1:n.gradient>k.gradient?1:0));const T=this;T[k]&&(T[k].dispose(),T[k]=null)}addAngularSpeedGradient(n,k){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,n,k),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(n){return this._removeGradientAndTexture(n,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(n,k){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,n,k),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(n){return this._removeGradientAndTexture(n,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(n,k){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,n,k),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(n){return this._removeGradientAndTexture(n,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(n,k){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,n,k),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(n){return this._removeGradientAndTexture(n,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(n){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(n,k,T){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(n),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Gi=new a.b,this.onStoppedObservable=new a.b,this.onStartedObservable=new a.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=c.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||y.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.oi.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,w.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,w.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new nn.b(this._engine)},this._customWrappers[0].effect=K,this._drawWrappers={0:new nn.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(k=k??{}).randomTextureSize||delete k.randomTextureSize;const G={Vh:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...k},E=k;isFinite(E)&&(G.Vh=E),this._capacity=G.Vh,this._maxActiveParticleCount=G.Vh,this._currentActiveCount=0,this._isAnimationSheetEnabled=Q,this.particleEmitterType=new P;const I=Math.min(this._engine.getCaps().maxTextureSize,G.randomTextureSize);let S=[];for(let c=0;c<I;++c)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture=new X.e(new Float32Array(S),I,1,5,T,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,S=[];for(let c=0;c<I;++c)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture2=new X.e(new Float32Array(S),I,1,5,T,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=I}_reset(){this._releaseBuffers()}_createVertexBuffers(n,k,T){const c={};c.position=k.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let K=3;c.age=k.createVertexBuffer("age",K,1,this._attributesStrideSize,!0),K+=1,c.size=k.createVertexBuffer("size",K,3,this._attributesStrideSize,!0),K+=3,c.life=k.createVertexBuffer("life",K,1,this._attributesStrideSize,!0),K+=1,K+=4,this.billboardMode===Ek.BILLBOARDMODE_STRETCHED&&(c.direction=k.createVertexBuffer("direction",K,3,this._attributesStrideSize,!0)),K+=3,this._platform.alignDataInBuffer&&(K+=1),this.particleEmitterType instanceof q&&(K+=3,this._platform.alignDataInBuffer&&(K+=1)),this._colorGradientsTexture||(c.color=k.createVertexBuffer("color",K,4,this._attributesStrideSize,!0),K+=4),this._isBillboardBased||(c.initialDirection=k.createVertexBuffer("initialDirection",K,3,this._attributesStrideSize,!0),K+=3,this._platform.alignDataInBuffer&&(K+=1)),this.noiseTexture&&(c.noiseCoordinates1=k.createVertexBuffer("noiseCoordinates1",K,3,this._attributesStrideSize,!0),K+=3,this._platform.alignDataInBuffer&&(K+=1),c.noiseCoordinates2=k.createVertexBuffer("noiseCoordinates2",K,3,this._attributesStrideSize,!0),K+=3,this._platform.alignDataInBuffer&&(K+=1)),c.angle=k.createVertexBuffer("angle",K,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?K++:K+=2,this._isAnimationSheetEnabled&&(c.cellIndex=k.createVertexBuffer("cellIndex",K,1,this._attributesStrideSize,!0),K+=1,this.spriteRandomStartCell&&(c.cellStartOffset=k.createVertexBuffer("cellStartOffset",K,1,this._attributesStrideSize,!0),K+=1)),c.offset=T.createVertexBuffer("offset",0,2),c.uv=T.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(c),this._platform.createVertexBuffers(n,c),this.resetDrawCache()}_initialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!n)return;const k=this._engine,T=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const K=this.particleEmitterType instanceof q,Q=c.l.li[0];let G=0;for(let c=0;c<this._capacity;c++)if(T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),K?(this.particleEmitterType.particleDestinationGenerator(c,null,Q),T.push(Q.x),T.push(Q.y),T.push(Q.z)):(T.push(0),T.push(0),T.push(0)),this._platform.alignDataInBuffer&&T.push(0),G+=16,K&&(this.particleEmitterType.particlePositionGenerator(c,null,Q),T.push(Q.x),T.push(Q.y),T.push(Q.z),this._platform.alignDataInBuffer&&T.push(0),G+=4),this._colorGradientsTexture||(T.push(0),T.push(0),T.push(0),T.push(0),G+=4),this.isBillboardBased||(T.push(0),T.push(0),T.push(0),this._platform.alignDataInBuffer&&T.push(0),G+=4),this.noiseTexture&&(T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),G+=8),T.push(0),G+=1,this._angularSpeedGradientsTexture||(T.push(0),G+=1),this._isAnimationSheetEnabled&&(T.push(0),G+=1,this.spriteRandomStartCell&&(T.push(0),G+=1)),this._platform.alignDataInBuffer){let n=3-(G+3&3);for(G+=n;n-- >0;)T.push(0)}const w=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),E=this._platform.createParticleBuffer(T),I=this._platform.createParticleBuffer(T);this._buffer0=new O.b(k,E,!1,this._attributesStrideSize),this._buffer1=new O.b(k,I,!1,this._attributesStrideSize),this._spriteBuffer=new O.b(k,w,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let n=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(n+="\n#define BILLBOARD"),this._colorGradientsTexture&&(n+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(n+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(n+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(n+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(n+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(n+="\n#define DRAGGRADIENTS"),this._flowMap&&(n+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(n+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(n+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(n+="\n#define NOISE"),this.isLocal&&(n+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===n||(this._cachedUpdateDefines=n,this._updateBuffer=this._platform.createUpdateBuffer(n)),this._platform.isUpdateBufferReady()}_getWrapper(n){const k=this._getCustomDrawWrapper(n);if(null!==k&&void 0!==k&&k.effect)return k;const T=[];this.fillDefines(T,n);let c=this._drawWrappers[n];c||(c=new nn.b(this._engine),c.drawContext&&(c.drawContext.useInstancing=!0),this._drawWrappers[n]=c);const K=T.join("\n");if(c.defines!==K){const n=[],k=[],T=[];this.fillUniformsAttributesAndSamplerNames(k,n,T),c.setEffect(this._engine.createEffect("gpuRenderParticles",n,k,T,K),K)}return c}static _GetAttributeNamesOrOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const K=[O.f.PositionKind,"age","life","size","angle"];return n||K.push(O.f.ColorKind),k&&K.push("cellIndex"),T||K.push("initialDirection"),c&&K.push("direction"),K.push("offset",O.f.UVKind),K}static _GetEffectCreationOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=["emitterWM","ie","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,kn.c)(c),n&&c.push("sheetInfos"),k&&c.push("logarithmicDepthConstant"),T&&(c.push("vFogInfos"),c.push("vFogColor")),c}fillDefines(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,kn.i)(this,this._scene,n),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Sk.c.FOGMODE_NONE&&n.push("#define FOG")),k===Ek.BLENDMODE_MULTIPLY&&n.push("#define BLENDMULTIPLYMODE"),this.isLocal&&n.push("#define LOCAL"),this.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(n.push("#define BILLBOARD"),this.billboardMode){case Ek.BILLBOARDMODE_Y:n.push("#define BILLBOARDY");break;case Ek.BILLBOARDMODE_STRETCHED:n.push("#define BILLBOARDSTRETCHED");break;case Ek.BILLBOARDMODE_ALL:n.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&n.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&n.push("#define ANIMATESHEET"),T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),n.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(n,k,T){k.push(...qk._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Ek.BILLBOARDMODE_STRETCHED)),n.push(...qk._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ik.e.PrepareUniforms(n,this._imageProcessingConfigurationDefines),Ik.e.PrepareSamplers(T,this._imageProcessingConfigurationDefines))}animate(){var n;let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(k?this.preWarmStepOffset:(null===(n=this._scene)||void 0===n?void 0:n.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(n,k){const T=this[k];if(!n||!n.length||T)return;const c=new Float32Array(this._rawTextureWidth);for(let K=0;K<this._rawTextureWidth;K++){const k=K/this._rawTextureWidth;p.GetCurrentGradient(k,n,((n,k,T)=>{c[K]=(0,I.i)(n.factor1,k.factor1,T)}))}this[k]=X.e.CreateRTexture(c,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[k].name=k.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const n=new Uint8Array(4*this._rawTextureWidth),k=G.h.Si[0];for(let T=0;T<this._rawTextureWidth;T++){const c=T/this._rawTextureWidth;p.GetCurrentGradient(c,this._colorGradients,((c,K,Q)=>{G.g.LerpToRef(c.color1,K.color1,Q,k),n[4*T]=255*k.r,n[4*T+1]=255*k.g,n[4*T+2]=255*k.b,n[4*T+3]=255*k.a}))}this._colorGradientsTexture=X.e.CreateRGBATexture(n,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(n,k){var T,K,Q,G;const w=this._getWrapper(n),E=w.effect;this._engine.enableEffect(w);const I=(null===(T=this._scene)||void 0===T?void 0:T.getViewMatrix())||c.d.IdentityReadOnly;if(E.setMatrix("view",I),E.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),E.setTexture("diffuseSampler",this.particleTexture),E.setVector2("translationPivot",this.translationPivot),E.setVector3("ie",this.ie),this.isLocal&&E.setMatrix("emitterWM",k),this._colorGradientsTexture?E.setTexture("colorGradientSampler",this._colorGradientsTexture):E.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const n=this.particleTexture.getBaseSize();E.setFloat3("sheetInfos",this.spriteCellWidth/n.width,this.spriteCellHeight/n.height,n.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const n=this._scene.activeCamera;E.setVector3("eyePosition",n.globalPosition)}const S=E.defines;if(this._scene&&((0,kn.f)(E,this,this._scene),this.applyFog&&(0,Tn.c)(this._scene,void 0,E)),S.indexOf("#define BILLBOARDMODE_ALL")>=0){const n=I.clone();n.invert(),E.setMatrix("invView",n)}return this.useLogarithmicDepth&&this._scene&&(0,Tn.j)(S,E,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(E),this._setEngineBasedOnBlendMode(n),this._platform.bindDrawBuffers(this._targetIndex,E,null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(E),null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(n){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!n)if(this.j.position){n=this.j.getWorldMatrix()}else{const k=this.j;n=c.l.Matrix[0],c.d.TranslationToRef(k.x,k.y,k.z,n)}const k=this._engine,T=k.getDepthWrite();if(k.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const n=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",n.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",n),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const K=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=K,k.setDepthWrite(T)}render(){let n,k=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!k&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let n=0;n<this.preWarmCycles;n++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const n=0|this._accumulatedCount;this._accumulatedCount-=n,this._currentActiveCount+=n}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){n=this.j.getWorldMatrix()}else{const k=this.j;n=c.l.Matrix[0],c.d.TranslationToRef(k.x,k.y,k.z,n)}const K=this._engine;this.updateInAnimate||this._update(n);let Q=0;return k||T||(K.setState(!1),this.forceDepthWrite&&K.setDepthWrite(!0),Q=this.blendMode===Ek.BLENDMODE_MULTIPLYADD?this._render(Ek.BLENDMODE_MULTIPLY,n)+this._render(Ek.BLENDMODE_ADD,n):this._render(this.blendMode,n),this._engine.setAlphaMode(0)),Q}rebuild(){const n=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(n,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,n()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const k in this._drawWrappers){this._drawWrappers[k].dispose()}if(this._drawWrappers={},this._scene){const n=this._scene.oi.indexOf(this);n>-1&&this._scene.oi.splice(n,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let k=0;k<this._renderVertexBuffers.length;++k){const n=this._renderVertexBuffers[k];for(const k in n)n[k].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),n&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),n&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Gi.notifyObservers(this),this.Gi.clear()}clone(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c={...this._customWrappers};let K=null;const Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){K=this.customShader;const n=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"";c[0]=Q.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,n,void 0,void 0,void 0,this)}const G=this.serialize(T),w=qk.Parse(G,this._scene||this._engine,this._rootUrl);return w.name=n,w.customShader=K,w._customWrappers=c,void 0===k&&(k=this.j),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.j=k,w}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={};return Ek._Serialize(k,this,n),k.activeParticleCount=this.activeParticleCount,k.randomTextureSize=this._randomTextureSize,k.customShader=this.customShader,k}static Parse(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4?arguments[4]:void 0;const Q=n.name;let G,w;k instanceof pn.b?G=k:(w=k,G=w.getEngine());const E=new qk(Q,{Vh:K||n.Vh,randomTextureSize:n.randomTextureSize},k,null,n.isAnimationSheetEnabled);if(E._rootUrl=T,n.customShader&&G.createEffectForParticles){const k=n.customShader,T=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"",c=G.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,T,void 0,void 0,void 0,E);E.setCustomEffect(c,0),E.customShader=k}return n.id&&(E.id=n.id),n.activeParticleCount&&(E.activeParticleCount=n.activeParticleCount),Ek._Parse(n,E,k,T),n.preventAutoStart&&(E.preventAutoStart=n.preventAutoStart),c||E.preventAutoStart||E.start(),E}}var Ok=T(542),uk=T(12436),fk=T(12221);class Ak{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(n){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const k of this.systems)k.j=n;this._emitterNode=n}setEmitterAsSphere(n,k,T){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:n,renderingGroupId:k};const c=(0,uk.c)("emitterSphere",{diameter:n.diameter,segments:n.segments},T);c.renderingGroupId=k;const K=new fk.e("emitterSphereMaterial",T);K.emissiveColor=n.color,c.material=K;for(const Q of this.systems)Q.j=c;this._emitterNode=c}start(n){for(const k of this.systems)n&&(k.j=n),k.start()}dispose(){for(const n of this.systems)n.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k={systems:[]};for(const T of this.systems)k.systems.push(T.serialize(n));return this._emitterNode&&(k.j=this._emitterCreationOptions),k}static Parse(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3?arguments[3]:void 0;const K=new Ak,Q=this.BaseAssetsUrl+"/textures/";k=k||y.e.LastCreatedScene;for(const G of n.systems)K.systems.push(T?qk.Parse(G,k,Q,!0,c):Ek.Parse(G,k,Q,!0,c));if(n.j){const T=n.j.options;if("Sphere"===n.j.kind)K.setEmitterAsSphere({diameter:T.diameter,segments:T.segments,color:G.e.ji(T.color)},n.j.renderingGroupId,k)}return K}}Ak.BaseAssetsUrl="https://assets.babylonjs.com/particles";var vk=T(582);class Fk{static CreateDefault(n){let k,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,c=arguments.length>2?arguments[2]:void 0;k=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new qk("default system",{Vh:T},c):new Ek("default system",T,c),k.j=n;const K=Ok.e.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return k.particleTexture=new Z.b(K,k.va()),k.createConeEmitter(.1,Math.PI/4),k.color1=new G.g(1,1,1,1),k.color2=new G.g(1,1,1,1),k.colorDead=new G.g(1,1,1,0),k.minSize=.1,k.maxSize=.1,k.minEmitPower=2,k.maxEmitPower=2,k.updateSpeed=1/60,k.emitRate=30,k}static CreateAsync(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3?arguments[3]:void 0;k||(k=y.e.LastCreatedScene);const K={};return k.addPendingData(K),new Promise(((Q,G)=>{if(T&&!qk.IsSupported)return k.removePendingData(K),G("Particle system with GPU is not supported.");Ok.e.LoadFile(`${Fk.BaseAssetsUrl}/systems/${n}.json`,(n=>{k.removePendingData(K);const G=JSON.parse(n.toString());return Q(Ak.Parse(G,k,T,c))}),void 0,void 0,void 0,(()=>(k.removePendingData(K),G(`An error occurred with the creation of your particle system. Check if your type '${n}' exists.`))))}))}static ExportSet(n){const k=new Ak;for(const T of n)k.systems.push(T);return k}static ParseFromFileAsync(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Q=arguments.length>5?arguments[5]:void 0;return new Promise(((G,w)=>{const E=new vk.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const k=JSON.parse(E.responseText);let w;w=c?qk.Parse(k,T,K,!1,Q):Ek.Parse(k,T,K,!1,Q),n&&(w.name=n),G(w)}else w("Unable to load the particle system")})),E.open("GET",k),E.send()}))}static ParseFromSnippetAsync(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",K=arguments.length>4?arguments[4]:void 0;if("_BLANK"===n){const n=this.CreateDefault(null);return n.start(),Promise.resolve(n)}return new Promise(((Q,G)=>{const w=new vk.b;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const G=JSON.parse(JSON.parse(w.responseText).jsonPayload),E=JSON.parse(G.particleSystem);let I;I=T?qk.Parse(E,k,c,!1,K):Ek.Parse(E,k,c,!1,K),I.snippetId=n,Q(I)}else G("Unable to load the snippet "+n)})),w.open("GET",this.SnippetUrl+"/"+n.replace(/#/g,"/")),w.send()}))}}Fk.BaseAssetsUrl=Ak.BaseAssetsUrl,Fk.SnippetUrl="https://snippet.babylonjs.com",Fk.CreateFromSnippetAsync=Fk.ParseFromSnippetAsync;var mk=T(532),xk=T(940),gk=T(12442);(0,gk.f)(xk.e.NAME_PARTICLESYSTEM,((n,k,T,c)=>{const K=(0,gk.j)(xk.e.NAME_PARTICLESYSTEM);if(K&&void 0!==n.oi&&null!==n.oi)for(let Q=0,G=n.oi.length;Q<G;Q++){const G=n.oi[Q];T.oi.push(K(G,k,c))}})),(0,gk.c)(xk.e.NAME_PARTICLESYSTEM,((n,k,T)=>{if(n.activeParticleCount){return qk.Parse(n,k,T)}return Ek.Parse(n,k,T)})),pn.b.prototype.createEffectForParticles=function(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Q=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,S=arguments.length>9?arguments[9]:void 0,P=[],W=[];const J=[];return E?E.fillUniformsAttributesAndSamplerNames(W,P,J):(P=Ek._GetAttributeNamesOrOptions(),W=Ek._GetEffectCreationOptions()),-1===K.indexOf(" BILLBOARD")&&(K+="\n#define BILLBOARD\n"),null!==E&&void 0!==E&&E.isAnimationSheetEnabled&&-1===K.indexOf(" ANIMATESHEET")&&(K+="\n#define ANIMATESHEET\n"),-1===c.indexOf("diffuseSampler")&&c.push("diffuseSampler"),this.createEffect({vertex:S??(null===E||void 0===E?void 0:E.vertexShaderName)??"particles",fragmentElement:n},P,W.concat(k),J.concat(c),K,Q,G,w,void 0,I,(async()=>{0===I?await Promise.resolve().then(T.bind(T,12476)):await Promise.resolve().then(T.bind(T,12538))}))},mk.b.prototype.getEmittedParticleSystems=function(){const n=[];for(let k=0;k<this.va().oi.length;k++){const T=this.va().oi[k];T.j===this&&n.push(T)}return n},mk.b.prototype.getHierarchyEmittedParticleSystems=function(){const n=[],k=this.getDescendants();k.push(this);for(let T=0;T<this.va().oi.length;T++){const c=this.va().oi[T],K=c.j;K.position&&-1!==k.indexOf(K)&&n.push(c)}return n};T(820),T(833),T(878);T(798),T(946),T(909),T(807),T(935);T(2302);var Uk;T(12445),T(2342);!function(n){n[n.Color=2]="Color",n[n.UV=1]="UV",n[n.Random=0]="Random",n[n.Stated=3]="Stated"}(Uk||(Uk={}));var Vk=T(2329);const Yk=new c.o(0,0,0),Zk=new c.o(0,0,0),ek=new c.o(0,0,0);class dk{constructor(n,k,T){this.width=n,this.height=k,this.data=T}processFlowable(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;if(!T)return;T instanceof c.d?c.o.TransformCoordinatesToRef(n.position,T,ek):(ek.x=T.x,ek.y=T.y,ek.z=T.z);const K=.5*ek.x+.5,Q=1-(.5*ek.y+.5),G=Math.floor(K*this.width),w=Math.floor(Q*this.height);if(G<0||G>=this.width||w<0||w>=this.height)return;const E=4*(w*this.width+G),I=this.data[E]/255*2-1,S=this.data[E+1]/255*2-1,P=this.data[E+2]/255*2-1,W=this.data[E+3]/255;Yk.set(I,S,P),Yk.scaleToRef(k*W,Zk),n.direction.addInPlace(Zk)}_processParticle(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;this.processFlowable(n,k,T)}static async FromUrlAsync(n){return await new Promise(((k,T)=>{const c=document.createElement("canvas"),K=c.getContext("2d");let Q=null;const G=new Image;G.crossOrigin="anonymous",G.src=n,G.onerror=k=>{T(new Error(`Failed to load image: ${n} : ${k}`))},G.onload=()=>{c.width=G.width,c.height=G.height,K.drawImage(G,0,0),Q=K.getImageData(0,0,c.width,c.height),k(new dk(c.width,c.height,Q.data))}}))}static async ExtractFromTextureAsync(n){return await new Promise(((k,T)=>{if(!n.isReady())return void n.onLoadObservable.addOnce((async()=>{try{const T=await this.ExtractFromTextureAsync(n);k(T)}catch(c){T(c)}}));const c=n.getSize();Vk.i.GetTextureDataAsync(n,c.width,c.height).then((n=>{k(new dk(c.width,c.height,new Uint8ClampedArray(n)))})).catch(T)}))}}var lk,ik,Bk,tk,Mk,ok,Dk,Rk,Lk;!function(n){n[n.Int=1]="Int",n[n.Float=2]="Float",n[n.Vector2=4]="Vector2",n[n.li=8]="li",n[n.Matrix=16]="Matrix",n[n.Particle=32]="Particle",n[n.Texture=64]="Texture",n[n.Si=128]="Si",n[n.FloatGradient=256]="FloatGradient",n[n.Vector2Gradient=512]="Vector2Gradient",n[n.Vector3Gradient=1024]="Vector3Gradient",n[n.Color4Gradient=2048]="Color4Gradient",n[n.System=4096]="System",n[n.AutoDetect=8192]="AutoDetect",n[n.BasedOnInput=16384]="BasedOnInput",n[n.Undefined=32768]="Undefined",n[n.All=65535]="All"}(lk||(lk={})),function(n){n[n.Compatible=0]="Compatible",n[n.TypeIncompatible=1]="TypeIncompatible",n[n.HierarchyIssue=2]="HierarchyIssue"}(ik||(ik={})),function(n){n[n.Input=0]="Input",n[n.Output=1]="Output"}(Bk||(Bk={}));class hk{get direction(){return this._direction}get type(){if(this._type===lk.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===lk.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(n){this._type=n}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((n=>n.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(n,k,T){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=lk.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new a.b,this.onDisconnectionObservable=new a.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=k,this.name=n,this._direction=T}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(n){var k;return this.isConnected?null!==(k=this._connectedPoint)&&void 0!==k&&k._storedFunction?this._connectedPoint._storedFunction(n):this._connectedPoint._storedValue:this.value}canConnectTo(n){return 0===this.checkCompatibilityState(n)}checkCompatibilityState(n){const k=this._ownerBlock,T=n.ownerBlock;if(this.type!==n.type&&n.innerType!==lk.AutoDetect)return n.acceptedConnectionPointTypes&&-1!==n.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(n.excludedConnectionPointTypes&&-1!==n.excludedConnectionPointTypes.indexOf(this.type))return 1;let c=T,K=k;return 0===this.direction&&(c=k,K=T),c.isAnAncestorOf(K)?2:0}connectTo(n){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(n))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${n.ownerBlock.name}".${n.name}`;return this._endpoints.push(n),n._connectedPoint=this,this.onConnectionObservable.notifyObservers(n),n.onConnectionObservable.notifyObservers(this),this}disconnectFrom(n){const k=this._endpoints.indexOf(n);return-1===k||(this._endpoints.splice(k,1),n._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(n),n.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(n){let k=1;for(;k<lk.All;)n&k||this.excludedConnectionPointTypes.push(k),k<<=1}serialize(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const k={};return k.name=this.name,k.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.wi?(k.valueType="BABYLON."+this.value.getClassName(),k.value=this.value.wi()):(k.valueType="number",k.value=this.value)),n&&this.connectedPoint&&(k.inputName=this.name,k.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,k.targetConnectionName=this.connectedPoint.name,k.isExposedOnFrame=!0,k.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(k.isExposedOnFrame=!0,k.exposedPortPosition=this.exposedPortPosition),k}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class jk{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(n){this._name=n}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(n){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new a.b,this.Gi=new a.b,this.onInputChangedObservable=new a.b,this.visibleOnFrame=!1,this._name=n,this.uniqueId=e.e.UniqueId}_inputRename(n){return n}_outputRename(n){return n}isAnAncestorOf(n){for(const k of this._outputs)if(k.hasEndpoints)for(const T of k.endpoints){if(T.ownerBlock===n)return!0;if(T.ownerBlock.isAnAncestorOf(n))return!0}return!1}isAnAncestorOfType(n){if(this.getClassName()===n)return!0;for(const k of this._outputs)if(k.hasEndpoints)for(const T of k.endpoints)if(T.ownerBlock.isAnAncestorOfType(n))return!0;return!1}getInputByName(n){const k=this._inputs.filter((k=>k.name===n));return k.length?k[0]:null}_linkConnectionTypes(n,k){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[k]._acceptedConnectionPointType=this._inputs[n]:(this._inputs[n]._linkedConnectionSource=this._inputs[k],this._inputs[n]._isMainLinkSource=!0),this._inputs[k]._linkedConnectionSource=this._inputs[n]}registerInput(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0;const G=new hk(n,this,0);return G.type=k,G.isOptional=T,G.defaultValue=c,G.value=c,G.valueMin=K,G.valueMax=Q,this._inputs.push(G),this.onInputChangedObservable.notifyObservers(G),this}registerOutput(n,k,T){return(T=T??new hk(n,this,1)).type=k,this._outputs.push(T),this}_build(n){}_customBuildStep(n){}build(n){if(this._buildId===n.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((n=>n.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=n.buildId;for(const k of this._inputs){if(!k.connectedPoint){k.isOptional||n.notConnectedNonOptionalInputs.push(k);continue}const T=k.connectedPoint.ownerBlock;T&&T!==this&&!T.isSystem&&T.build(n)}return this._customBuildStep(n),n.verbose&&d.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(n),this.onBuildObservable.notifyObservers(this),!1}serialize(){const n={};n.customType="BABYLON."+this.getClassName(),n.id=this.uniqueId,n.name=this.name,n.visibleOnFrame=this.visibleOnFrame,n.inputs=[],n.outputs=[];for(const k of this.inputs)n.inputs.push(k.serialize());for(const k of this.outputs)n.outputs.push(k.serialize(!1));return n}_deserialize(n){this._name=n.name,this.comments=n.comments,this.visibleOnFrame=!!n.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(n)}_deserializePortDisplayNamesAndExposedOnFrame(n){const k=n.inputs,T=n.outputs;if(k)for(const c of k){const n=this.inputs.find((n=>n.name===c.name));if(!n)return;if(c.displayName&&(n.displayName=c.displayName),c.isExposedOnFrame&&(n.isExposedOnFrame=c.isExposedOnFrame,n.exposedPortPosition=c.exposedPortPosition),void 0!==c.value&&null!==c.value)if("number"===c.valueType)n.value=c.value;else{const k=(0,w.b)(c.valueType);k&&(n.value=k.ji(c.value))}}if(T)for(let c=0;c<T.length;c++){const n=T[c];n.displayName&&(this.outputs[c].displayName=n.displayName),n.isExposedOnFrame&&(this.outputs[c].isExposedOnFrame=n.isExposedOnFrame,this.outputs[c].exposedPortPosition=n.exposedPortPosition)}}clone(){const n=this.serialize(),k=(0,w.b)(n.customType);if(k){const T=new k;return T._deserialize(n),T}return null}dispose(){this.Gi.notifyObservers(this),this.Gi.clear();for(const n of this.inputs)n.dispose();for(const n of this.outputs)n.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function pk(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",c=arguments.length>3?arguments[3]:void 0;return(K,Q)=>{let G=K._propStore;G||(G=[],K._propStore=G),G.push({propertyName:Q,displayName:n,type:k,groupName:T,options:c??{},className:K.getClassName()})}}(0,U.e)([(0,V.K)("comment")],jk.prototype,"comments",void 0),function(n){n[n.Boolean=0]="Boolean",n[n.Float=1]="Float",n[n.Int=2]="Int",n[n.Vector2=3]="Vector2",n[n.List=4]="List",n[n.Si=5]="Si",n[n.SamplingMode=6]="SamplingMode",n[n.TextureFormat=7]="TextureFormat",n[n.TextureType=8]="TextureType"}(tk||(tk={})),function(n){n[n.None=0]="None",n[n.Position=1]="Position",n[n.Direction=2]="Direction",n[n.Age=3]="Age",n[n.Lifetime=4]="Lifetime",n[n.Color=5]="Color",n[n.ScaledDirection=6]="ScaledDirection",n[n.Scale=7]="Scale",n[n.AgeGradient=8]="AgeGradient",n[n.Angle=9]="Angle",n[n.SpriteCellIndex=16]="SpriteCellIndex",n[n.SpriteCellStart=17]="SpriteCellStart",n[n.SpriteCellEnd=18]="SpriteCellEnd"}(Mk||(Mk={})),function(n){n[n.None=0]="None",n[n.Time=1]="Time",n[n.Delta=2]="Delta",n[n.Emitter=3]="Emitter"}(ok||(ok={}));class ak{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let n="";for(const k of this.notConnectedNonOptionalInputs)n+=`input ${k.name} from block ${k.ownerBlock.name}[${k.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(n)throw"Build of Node Particle System Set failed:\n"+n}adapt(n,k){const T=n.getConnectedValue(this)||0;if(n.type===k)return T;switch(k){case lk.Vector2:return new c.m(T,T);case lk.li:return new c.o(T,T,T);case lk.Si:return new G.g(T,T,T,T)}return null}getContextualValue(n){if(!this.particleContext||!this.systemContext)return null;switch(n){case Mk.Position:return this.particleContext.position;case Mk.Direction:return this.particleContext.direction;case Mk.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Mk.Color:return this.particleContext.color;case Mk.Age:return this.particleContext.age;case Mk.Lifetime:return this.particleContext.lifeTime;case Mk.Angle:return this.particleContext.angle;case Mk.Scale:return this.particleContext.scale;case Mk.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Mk.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Mk.SpriteCellIndex:return this.particleContext.cellIndex;case Mk.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(n){if(!this.particleContext||!this.systemContext)return null;switch(n){case ok.Time:return this.systemContext._actualFrame;case ok.Delta:return this.systemContext._scaledUpdateSpeed;case ok.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function Xk(n,k,T){const c=new ak;c.me=k;const K=n.createSystem(c);return K.canStart=()=>!0,K.j=T.clone(),K.disposeOnStop=!0,K.start(),K}class yk extends jk{constructor(n){super(n),this.blendMode=E.BLENDMODE_ONEONE,this.Vh=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",lk.Particle),this.registerInput("texture",lk.Texture),this.registerInput("onStart",lk.System,!0),this.registerInput("onEnd",lk.System,!0),this.registerOutput("system",lk.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(n){n.Vh=this.Vh,n.buildId=this._buildId++,this.build(n);const k=this.particle.getConnectedValue(n);return k.particleTexture=this.texture.getConnectedValue(n),k.emitRate=this.emitRate,k.blendMode=this.blendMode,k.name=this.name,k._nodeGenerated=!0,k._targetStopDuration=this.targetStopDuration,k.startDelay=this.startDelay,this.system._storedValue=this,k.canStart=()=>!this.doNoStart,k.onStartedObservable.add((T=>{const c=this.onStart.getConnectedValue(n);c&&T.onStartedObservable.addOnce((()=>{n.systemContext=k;const T=Xk(c,n.me,n.emitterPosition);this.Gi.addOnce((()=>{T.dispose()}))}));const K=this.onEnd.getConnectedValue(n);K&&T.onStoppedObservable.addOnce((()=>{n.systemContext=k;const T=Xk(K,n.me,n.emitterPosition);this.Gi.addOnce((()=>{T.dispose()}))}))})),this.Gi.addOnce((()=>{k.dispose()})),k}serialize(){const n=super.serialize();return n.Vh=this.Vh,n.emitRate=this.emitRate,n.blendMode=this.blendMode,n.doNoStart=this.doNoStart,n.targetStopDuration=this.targetStopDuration,n.startDelay=this.startDelay,n}_deserialize(n){super._deserialize(n),this.Vh=n.Vh,this.emitRate=n.emitRate,this.doNoStart=!!n.doNoStart,void 0!==n.blendMode&&(this.blendMode=n.blendMode),void 0!==n.targetStopDuration&&(this.targetStopDuration=n.targetStopDuration),void 0!==n.startDelay&&(this.startDelay=n.startDelay)}}(0,U.e)([pk("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:E.BLENDMODE_ONEONE},{label:"Standard",value:E.BLENDMODE_STANDARD},{label:"Add",value:E.BLENDMODE_ADD},{label:"Multiply",value:E.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:E.BLENDMODE_MULTIPLYADD}]})],yk.prototype,"blendMode",void 0),(0,U.e)([pk("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],yk.prototype,"Vh",void 0),(0,U.e)([pk("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yk.prototype,"emitRate",void 0),(0,U.e)([pk("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yk.prototype,"targetStopDuration",void 0),(0,U.e)([pk("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yk.prototype,"startDelay",void 0),(0,U.e)([pk("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],yk.prototype,"doNoStart",void 0),(0,w.f)("BABYLON.SystemBlock",yk);class Nk extends jk{get type(){if(this._type===lk.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=lk.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=lk.Vector2,this._type;case"li":return this._type=lk.li,this._type;case"Si":return this._type=lk.Si,this._type;case"Matrix":return this._type=lk.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Mk.None&&this._systemSource!==ok.None}get systemSource(){return this._systemSource}set systemSource(n){if(this._systemSource=n,n!==ok.None){switch(this._contextualSource=Mk.None,this._type=lk.Float,n){case ok.Time:case ok.Delta:this._type=lk.Float;break;case ok.Emitter:this._type=lk.li}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Mk.None}get contextualValue(){return this._contextualSource}set contextualValue(n){if(this._contextualSource=n,n!==Mk.None){switch(this._systemSource=ok.None,n){case Mk.Scale:this._type=lk.Vector2;break;case Mk.Position:case Mk.Direction:case Mk.ScaledDirection:this._type=lk.li;break;case Mk.Color:this._type=lk.Si;break;case Mk.Age:case Mk.Lifetime:case Mk.Angle:case Mk.AgeGradient:this._type=lk.Float;break;case Mk.SpriteCellEnd:case Mk.SpriteCellStart:case Mk.SpriteCellIndex:this._type=lk.Int}this.output&&(this.output.type=this._type)}}constructor(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lk.AutoDetect;super(n),this._type=lk.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new a.b,this._systemSource=ok.None,this._contextualSource=Mk.None,this._type=k,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",k)}get value(){return this._storedValue}set value(n){this.type===lk.Float&&this.min!==this.max&&(n=Math.max(this.min,n),n=Math.min(this.max,n)),this._storedValue=n,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(n){this._valueCallback=n}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case lk.Int:case lk.Float:this.value=0;break;case lk.Vector2:this.value=c.m.Zero();break;case lk.li:this.value=c.o.Zero();break;case lk.Si:this.value=new G.g(1,1,1,1);break;case lk.Matrix:this.value=c.d.Identity()}}_build(n){super._build(n),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=n=>n.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=n=>n.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const n=super.serialize();return n.type=this.type,n.contextualValue=this.contextualValue,n.systemSource=this.systemSource,n.min=this.min,n.max=this.max,n.groupInInspector=this.groupInInspector,n.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.wi?(n.valueType="BABYLON."+this._storedValue.getClassName(),n.value=this._storedValue.wi()):(n.valueType="number",n.value=this._storedValue)),n}_deserialize(n){if(super._deserialize(n),this._type=n.type,this.contextualValue=n.contextualValue,this.systemSource=n.systemSource||ok.None,this.min=n.min||0,this.max=n.max||0,this.groupInInspector=n.groupInInspector||"",void 0!==n.displayInInspector&&(this.displayInInspector=n.displayInInspector),n.valueType)if("number"===n.valueType)this._storedValue=n.value;else{const k=(0,w.b)(n.valueType);k&&(this._storedValue=k.ji(n.value))}}}(0,w.f)("BABYLON.ParticleInputBlock",Nk);class nT extends jk{get url(){return this._url}set url(n){this._url!==n&&(this._cachedData=null,this._url=n,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(n){this._textureDataUrl!==n&&(this._cachedData=null,this._textureDataUrl=n,this._url="",this._sourceTexture=null)}set sourceTexture(n){this._sourceTexture!==n&&(this._cachedData=null,this._sourceTexture=n,this._url="",this._textureDataUrl="")}constructor(n){super(n),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",lk.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const n=this.texture._storedValue;return await new Promise(((k,T)=>{if(!n.isReady())return void n.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),k(this._cachedData)}catch(n){T(n)}}));const c=n.getSize();Vk.i.GetTextureDataAsync(n,c.width,c.height).then((T=>{this._cachedData={width:c.width,height:c.height,data:new Uint8ClampedArray(T)},n.dispose(),k(this._cachedData)})).catch(T)}))}_build(n){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new Z.b(this._textureDataUrl,n.me):this.texture._storedValue=new Z.b(this._url,n.me):this.texture._storedValue=null}serialize(){const n=super.serialize();return n.url=this.url,n.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(n.textureDataUrl=this.textureDataUrl),n}_deserialize(n){super._deserialize(n),this.url=n.url,this.serializedCachedData=!!n.serializedCachedData,n.textureDataUrl&&(this.textureDataUrl=n.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,w.f)("BABYLON.ParticleTextureSourceBlock",nT);class kT extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("position",lk.li),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(n){const k=this.particle.getConnectedValue(n);if(this.output._storedValue=k,!this.position.isConnected)return;const T={process:T=>{n.particleContext=T,n.systemContext=k,T.position.p(this.position.getConnectedValue(n))},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T}}(0,w.f)("BABYLON.UpdatePositionBlock",kT),function(n){n[n.Add=0]="Add",n[n.Subtract=1]="Subtract",n[n.Multiply=2]="Multiply",n[n.Divide=3]="Divide",n[n.Max=4]="Max",n[n.Min=5]="Min"}(Dk||(Dk={}));class TT extends jk{constructor(n){super(n),this.operation=Dk.Add,this.registerInput("left",lk.AutoDetect),this.registerInput("right",lk.AutoDetect),this.registerOutput("output",lk.BasedOnInput),this.output._typeConnectionSource=this.left;const k=[lk.Matrix,lk.Particle,lk.Texture,lk.System,lk.FloatGradient,lk.Color4Gradient,lk.Vector2Gradient,lk.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...k),this.right.excludedConnectionPointTypes.push(...k),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(n){let k;const T=this.left,K=this.right;if(!T.isConnected||!K.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Q=T.type===lk.Float||T.type===lk.Int,w=K.type===lk.Float||K.type===lk.Int,E=Q&&w;switch(this.operation){case Dk.Add:k=E?n=>T.getConnectedValue(n)+K.getConnectedValue(n):Q?n=>n.adapt(T,K.type).add(K.getConnectedValue(n)):n=>T.getConnectedValue(n).add(n.adapt(K,T.type));break;case Dk.Subtract:k=E?n=>T.getConnectedValue(n)-K.getConnectedValue(n):Q?n=>n.adapt(T,K.type).Fg(K.getConnectedValue(n)):n=>T.getConnectedValue(n).Fg(n.adapt(K,T.type));break;case Dk.Multiply:k=E?n=>T.getConnectedValue(n)*K.getConnectedValue(n):Q?n=>n.adapt(T,K.type).multiply(K.getConnectedValue(n)):n=>T.getConnectedValue(n).multiply(n.adapt(K,T.type));break;case Dk.Divide:k=E?n=>T.getConnectedValue(n)/K.getConnectedValue(n):Q?n=>n.adapt(T,K.type).divide(K.getConnectedValue(n)):n=>T.getConnectedValue(n).divide(n.adapt(K,T.type));break;case Dk.Min:if(E)k=n=>Math.min(T.getConnectedValue(n),K.getConnectedValue(n));else{const[n,w]=Q?[K,T]:[T,K];switch(n.type){case lk.Vector2:k=k=>c.m.Minimize(n.getConnectedValue(k),k.adapt(w,n.type));break;case lk.li:k=k=>c.o.Minimize(n.getConnectedValue(k),k.adapt(w,n.type));break;case lk.Si:k=k=>{const T=n.getConnectedValue(k),{r:c,g:K,b:Q,a:E}=k.adapt(w,n.type);return new G.g(Math.min(T.r,c),Math.min(T.g,K),Math.min(T.b,Q),Math.min(T.a,E))}}}break;case Dk.Max:if(!E){const[n,w]=Q?[K,T]:[T,K];switch(n.type){case lk.Vector2:k=k=>c.m.Maximize(n.getConnectedValue(k),k.adapt(w,n.type));break;case lk.li:k=k=>c.o.Maximize(n.getConnectedValue(k),k.adapt(w,n.type));break;case lk.Si:k=k=>{const T=n.getConnectedValue(k),{r:c,g:K,b:Q,a:E}=k.adapt(w,n.type);return new G.g(Math.max(T.r,c),Math.min(T.g,K),Math.min(T.b,Q),Math.min(T.a,E))}}break}k=n=>Math.max(T.getConnectedValue(n),K.getConnectedValue(n))}this.output._storedFunction=n=>T.type===lk.Int?0|k(n):k(n)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===lk.Int||this.left.type===lk.Float&&this.right.type!==lk.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[n,k]of[[this.left,this.right],[this.right,this.left]])n.acceptedConnectionPointTypes=[lk.Int,lk.Float],k.isConnected&&(n.acceptedConnectionPointTypes.push(k.type),k.type!==lk.Int&&k.type!==lk.Float||n.acceptedConnectionPointTypes.push(lk.Vector2,lk.li,lk.Si))}dispose(){super.dispose();for(const n of this._connectionObservers)n.remove();this._connectionObservers.length=0}serialize(){const n=super.serialize();return n.operation=this.operation,n}_deserialize(n){super._deserialize(n),this.operation=n.operation}}(0,U.e)([pk("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Dk.Add},{label:"Subtract",value:Dk.Subtract},{label:"Multiply",value:Dk.Multiply},{label:"Divide",value:Dk.Divide},{label:"Max",value:Dk.Max},{label:"Min",value:Dk.Min}]})],TT.prototype,"operation",void 0),(0,w.f)("BABYLON.ParticleMathBlock",TT);class cT extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("direction1",lk.li,!0,new c.o(0,1,0)),this.registerInput("direction2",lk.li,!0,new c.o(0,1,0)),this.registerInput("minEmitBox",lk.li,!0,new c.o(-.5,-.5,-.5)),this.registerInput("maxEmitBox",lk.li,!0,new c.o(.5,.5,.5)),this.registerOutput("output",lk.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(n){const k=this.particle.getConnectedValue(n);k._directionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.direction1.getConnectedValue(n),Q=this.direction2.getConnectedValue(n),G=(0,I.l)(K.x,Q.x),w=(0,I.l)(K.y,Q.y),E=(0,I.l)(K.z,Q.z);n.isEmitterTransformNode?c.o.TransformNormalFromFloatsToRef(G,w,E,n.emitterWorldMatrix,T.direction):T.direction.di(G,w,E)},k._positionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.minEmitBox.getConnectedValue(n),Q=this.maxEmitBox.getConnectedValue(n),G=(0,I.l)(K.x,Q.x),w=(0,I.l)(K.y,Q.y),E=(0,I.l)(K.z,Q.z);n.isEmitterTransformNode?c.o.TransformCoordinatesFromFloatsToRef(G,w,E,n.emitterWorldMatrix,T.position):(T.position.di(G,w,E),T.position.addInPlace(n.emitterPosition))},this.output._storedValue=k}}(0,w.f)("BABYLON.BoxShapeBlock",cT);class KT extends jk{constructor(n){super(n),this.registerInput("emitPower",lk.Float,!0,1),this.registerInput("lifeTime",lk.Float,!0,1),this.registerInput("color",lk.Si,!0,new G.g(1,1,1,1)),this.registerInput("scale",lk.Vector2,!0,new c.m(1,1)),this.registerInput("angle",lk.Float,!0,0),this.registerOutput("particle",lk.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(n){const k=new Ek(this.name,n.Vh,n.me,null,!1,void 0,!0);k.particleEmitterType=new C,k._lifeTimeCreation.process=(k,T)=>{n.particleContext=k,k.lifeTime=this.lifeTime.getConnectedValue(n),T._emitPower=this.emitPower.getConnectedValue(n)},k._colorCreation.process=k=>{n.particleContext=k,k.color.p(this.color.getConnectedValue(n))},k._sizeCreation.process=k=>{n.particleContext=k,k.size=1,k.scale.p(this.scale.getConnectedValue(n))},k._angleCreation.process=k=>{n.particleContext=k,k.angle=this.angle.getConnectedValue(n)},this.particle._storedValue=k}}(0,w.f)("BABYLON.CreateParticleBlock",KT);class QT{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const n=[];for(const k of this.attachedBlocks)k.isInput&&n.push(k);return n}constructor(n){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new a.b,this.name=n}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(n)&&this.attachedBlocks.push(n);for(const T of n.inputs){const c=T.connectedPoint;if(c){const T=c.ownerBlock;T!==n&&this._initializeBlock(T,k)}}}async buildAsync(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((T=>{const c=new Ak;for(const n of this._systemBlocks)this._initializeBlock(n);for(const K of this.systemBlocks){const T=new ak;T.buildId=this._buildId++,T.me=n,T.verbose=k;const Q=K.createSystem(T);T.emitErrors(),c.systems.push(Q)}this.onBuildObservable.notifyObservers(this),T(c)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const n=new yk("Particle system"),k=new kT("Update position");k.output.connectTo(n.particle);const T=new Nk("Position");T.contextualValue=Mk.Position;const c=new Nk("Scaled direction");c.contextualValue=Mk.ScaledDirection;const K=new TT("Add");K.operation=Dk.Add,T.output.connectTo(K.left),c.output.connectTo(K.right),K.output.connectTo(k.position);const Q=new KT("Create particle"),G=new cT("Box shape");Q.particle.connectTo(G.particle),G.output.connectTo(k.particle);const w=new nT("Texture");w.texture.connectTo(n.texture),w.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(n)}removeBlock(n){const k=this.attachedBlocks.indexOf(n);if(k>-1&&this.attachedBlocks.splice(k,1),n.isSystem){const k=this._systemBlocks.indexOf(n);k>-1&&this._systemBlocks.splice(k,1)}}parseSerializedObject(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k||this.clear();const T={};for(const c of n.$i){const n=(0,w.b)(c.customType);if(n){const k=new n;k._deserialize(c),T[c.id]=k,this.attachedBlocks.push(k),k.isSystem&&this._systemBlocks.push(k)}}for(const c of this.attachedBlocks)if(c.isTeleportOut){const n=c,k=n._tempEntryPointUniqueId;if(k){const c=T[k];c&&c.attachToEndpoint(n)}}for(let c=0;c<n.$i.length;c++){const K=n.$i[c],Q=T[K.id];Q&&(Q.inputs.length&&K.inputs.some((n=>n.targetConnectionName))&&!k||this._restoreConnections(Q,n,T))}if(n.locations||n.editorData&&n.editorData.locations){const c=n.locations||n.editorData.locations;for(const n of c)T[n.blockId]&&(n.blockId=T[n.blockId].uniqueId);k&&this.editorData&&this.editorData.locations&&c.concat(this.editorData.locations),n.locations?this.editorData={locations:c}:(this.editorData=n.editorData,this.editorData.locations=c);const K=[];for(const n in T)K[n]=T[n].uniqueId;this.editorData.map=K}this.comment=n.comment}_restoreConnections(n,k,T){for(const c of n.outputs)for(const K of k.$i){const Q=T[K.id];if(Q)for(const G of K.inputs)if(T[G.targetBlockId]!==n||G.targetConnectionName!==c.name);else{const n=Q.getInputByName(G.inputName);if(!n||n.isConnected)continue;c.connectTo(n,!0),this._restoreConnections(Q,k,T)}}}serialize(n){const k=n?{}:Y.d.Serialize(this);k.editorData=JSON.parse(JSON.stringify(this.editorData));let T=[];n?T=n:k.customType="BABYLON.NodeParticleSystemSet",k.$i=[];for(const c of T)k.$i.push(c.serialize());if(!n)for(const c of this.attachedBlocks)-1===T.indexOf(c)&&k.$i.push(c.serialize());return k}dispose(){for(const n of this.attachedBlocks)n.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(n){const k=new QT(n);return k.setToDefault(),k}static Parse(n){const k=Y.d.Parse((()=>new QT(n.name)),n,null);return k.parseSerializedObject(n),k}static ParseFromSnippetAsync(n,k){return"_BLANK"===n?Promise.resolve(QT.CreateDefault("blank")):new Promise(((T,c)=>{const K=new vk.b;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const G=JSON.parse(JSON.parse(K.responseText).jsonPayload),w=JSON.parse(G.nodeParticle);k||(k=Y.d.Parse((()=>new QT(n)),w,null)),k.parseSerializedObject(w),k.snippetId=n;try{T(k)}catch(Q){c(Q)}}else c("Unable to load the snippet "+n)})),K.open("GET",this.SnippetUrl+"/"+n.replace(/#/g,"/")),K.send()}))}}QT.EditorURL=`${Ok.e._DefaultCdnUrl}/v${pn.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,QT.SnippetUrl="https://snippet.babylonjs.com",(0,U.e)([(0,V.K)()],QT.prototype,"name",void 0),(0,U.e)([(0,V.K)("comment")],QT.prototype,"comment",void 0),function(n){n[n.None=0]="None",n[n.PerParticle=1]="PerParticle",n[n.PerSystem=2]="PerSystem"}(Rk||(Rk={}));class GT extends jk{constructor(n){super(n),this._currentLockId=-2,this.lockMode=Rk.PerParticle,this.registerInput("min",lk.AutoDetect,!0,0),this.registerInput("max",lk.AutoDetect,!0,1),this.registerOutput("output",lk.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lk.Float|lk.Int|lk.Vector2|lk.li|lk.Si),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lk.Float|lk.Int|lk.Vector2|lk.li|lk.Si),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=lk.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let n=null;switch(this._currentLockId=-2,this.min.type){case lk.AutoDetect:case lk.Int:case lk.Float:n=n=>{const k=this.min.getConnectedValue(n)||0,T=this.max.getConnectedValue(n)||1;return k+Math.random()*(T-k)};break;case lk.Vector2:n=n=>{const k=this.min.getConnectedValue(n)||c.m.Zero(),T=this.max.getConnectedValue(n)||c.m.One();return new c.m(k.x+Math.random()*(T.x-k.x),k.y+Math.random()*(T.y-k.y))};break;case lk.li:n=n=>{const k=this.min.getConnectedValue(n)||c.o.Zero(),T=this.max.getConnectedValue(n)||c.o.One();return new c.o(k.x+Math.random()*(T.x-k.x),k.y+Math.random()*(T.y-k.y),k.z+Math.random()*(T.z-k.z))};break;case lk.Si:n=n=>{const k=this.min.getConnectedValue(n)||new G.g(0,0,0,0),T=this.max.getConnectedValue(n)||new G.g(1,1,1,1);return new G.g(k.x+Math.random()*(T.x-k.x),k.y+Math.random()*(T.y-k.y),k.z+Math.random()*(T.z-k.z),k.w+Math.random()*(T.w-k.w))}}this.output._storedFunction=k=>{var T;let c=0;switch(this.lockMode){case Rk.PerParticle:c=(null===(T=k.particleContext)||void 0===T?void 0:T.id)||-1;break;case Rk.PerSystem:c=k.buildId||0}return this._currentLockId!==c&&(this.lockMode!==Rk.None&&(this._currentLockId=c),this.output._storedValue=n(k)),this.output._storedValue}}serialize(){const n=super.serialize();return n.lockMode=this.lockMode,n}_deserialize(n){super._deserialize(n),this.lockMode=n.lockMode}}(0,U.e)([pk("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Rk.None},{label:"Per particle",value:Rk.PerParticle},{label:"Per system",value:Rk.PerSystem}]})],GT.prototype,"lockMode",void 0),(0,w.f)("BABYLON.ParticleRandomBlock",GT);class wT extends jk{constructor(n){super(n),this._currentLockId=-2,this.lockMode=Rk.PerParticle,this.registerInput("min",lk.AutoDetect),this.registerInput("max",lk.AutoDetect),this.registerOutput("output",lk.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const k=[lk.Matrix,lk.Particle,lk.Texture,lk.System,lk.FloatGradient,lk.Color4Gradient,lk.Vector2Gradient,lk.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...k),this.max.excludedConnectionPointTypes.push(...k)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let n=null;switch(this._currentLockId=-2,this.min.type){case lk.Float:case lk.Int:n=n=>{const k=this.min.getConnectedValue(n),T=this.max.getConnectedValue(n);return Math.random()*(T-k)+k};break;case lk.Vector2:n=n=>{const k=this.min.getConnectedValue(n),T=this.max.getConnectedValue(n);return new c.m(Math.random()*(T.x-k.x)+k.x,Math.random()*(T.y-k.y)+k.y)};break;case lk.li:n=n=>{const k=this.min.getConnectedValue(n),T=this.max.getConnectedValue(n);return new c.o(Math.random()*(T.x-k.x)+k.x,Math.random()*(T.y-k.y)+k.y,Math.random()*(T.z-k.z)+k.z)};break;case lk.Si:n=n=>{const k=this.min.getConnectedValue(n),T=this.max.getConnectedValue(n);return new G.g(Math.random()*(T.r-k.r)+k.r,Math.random()*(T.g-k.g)+k.g,Math.random()*(T.b-k.b)+k.b,Math.random()*(T.a-k.a)+k.a)}}this.output._storedFunction=k=>{var T;let c=0;switch(this.lockMode){case Rk.PerParticle:c=(null===(T=k.particleContext)||void 0===T?void 0:T.id)||-1;break;case Rk.PerSystem:c=k.buildId||0}return this._currentLockId!==c&&(this.lockMode!==Rk.None&&(this._currentLockId=c),this.output._storedValue=n(k)),this.output._storedValue}}serialize(){const n=super.serialize();return n.lockMode=this.lockMode,n}_deserialize(n){super._deserialize(n),void 0!==n.lockMode&&(this.lockMode=n.lockMode)}}(0,U.e)([pk("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Rk.None},{label:"Per particle",value:Rk.PerParticle},{label:"Per system",value:Rk.PerSystem}]})],wT.prototype,"lockMode",void 0),(0,w.f)("BABYLON.RandomRangeBlock",wT);(0,w.f)("BABYLON.ParticleLerpBlock",class extends jk{constructor(n){super(n),this.registerInput("left",lk.AutoDetect),this.registerInput("right",lk.AutoDetect),this.registerInput("gradient",lk.Float,!0,0,0,1),this.registerOutput("output",lk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lk.Float|lk.Int|lk.Vector2|lk.li|lk.Si)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const n=(n,k,T)=>(1-n)*k+n*T;this.output._storedFunction=k=>{const T=this.left.getConnectedValue(k),K=this.right.getConnectedValue(k),Q=this.gradient.getConnectedValue(k);switch(this.left.type){case lk.Int:case lk.Float:return n(Q,T,K);case lk.Vector2:return new c.m(n(Q,T.x,K.x),n(Q,T.y,K.y));case lk.li:return new c.o(n(Q,T.x,K.x),n(Q,T.y,K.y),n(Q,T.z,K.z));case lk.Si:return new G.g(n(Q,T.r,K.r),n(Q,T.g,K.g),n(Q,T.b,K.b),n(Q,T.a,K.a))}return 0}}});(0,w.f)("BABYLON.UpdateDirectionBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("direction",lk.li),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(n){const k=this.particle.getConnectedValue(n);if(this.output._storedValue=k,!this.direction.isConnected)return;const T={process:T=>{n.particleContext=T,n.systemContext=k,T.direction.p(this.direction.getConnectedValue(n))},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T}});(0,w.f)("BABYLON.UpdateColorBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("color",lk.Si),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(n){const k=this.particle.getConnectedValue(n);if(this.output._storedValue=k,!this.color.isConnected)return;const T={process:T=>{n.particleContext=T,n.systemContext=k,T.color.p(this.color.getConnectedValue(n))},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T}});(0,w.f)("BABYLON.UpdateScaleBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("scale",lk.Vector2),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(n){const k=this.particle.getConnectedValue(n);if(this.output._storedValue=k,!this.scale.isConnected)return;const T={process:T=>{n.particleContext=T,n.systemContext=k,T.scale.p(this.scale.getConnectedValue(n))},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T}});(0,w.f)("BABYLON.UpdateAngleBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("angle",lk.Float),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(n){const k=this.particle.getConnectedValue(n);if(this.output._storedValue=k,!this.angle.isConnected)return;const T={process:T=>{n.particleContext=T,n.systemContext=k,T.angle=this.angle.getConnectedValue(n)},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T}});(0,w.f)("BABYLON.BasicPositionUpdateBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(n){const k=this.particle.getConnectedValue(n),T={process:T=>{n.particleContext=T,n.systemContext=k,T.direction.scaleToRef(k._directionScale,k._scaledDirection),T.position.addInPlace(k._scaledDirection)},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T,this.output._storedValue=k}});(0,w.f)("BABYLON.BasicSpriteUpdateBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(n){const k=this.particle.getConnectedValue(n),T={process:T=>{n.particleContext=T,n.systemContext=k,T.updateCellIndex()},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T,this.output._storedValue=k}});(0,w.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("cellIndex",lk.Int),this.registerOutput("output",lk.Particle),this.cellIndex.acceptedConnectionPointTypes=[lk.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(n){const k=this.particle.getConnectedValue(n);if(this.output._storedValue=k,!this.cellIndex.isConnected)return;const T={process:T=>{n.particleContext=T,n.systemContext=k,T.cellIndex=Math.floor(this.cellIndex.getConnectedValue(n))},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T}});class ET extends jk{constructor(n){super(n),this.strength=1,this.registerInput("particle",lk.Particle),this.registerInput("flowMap",lk.Texture),this.registerOutput("output",lk.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(n){var k;const T=this.particle.getConnectedValue(n),c=n.me;let K;(null===(k=this.flowMap.connectedPoint)||void 0===k?void 0:k.ownerBlock).extractTextureContentAsync().then((n=>{n&&(K=new dk(n.width,n.height,n.data))}));const Q={process:n=>{const k=c.getTransformMatrix();K&&K._processParticle(n,this.strength*T._tempScaledUpdateSpeed,k)},previousItem:null,nextItem:null};T._updateQueueStart?on(Q,T._updateQueueStart):T._updateQueueStart=Q,this.output._storedValue=T}serialize(){const n=super.serialize();return n.strength=this.strength,n}_deserialize(n){super._deserialize(n),this.strength=n.strength}}(0,U.e)([pk("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ET.prototype,"strength",void 0),(0,w.f)("BABYLON.UpdateFlowMapBlock",ET);(0,w.f)("BABYLON.SphereShapeBlock",class extends jk{constructor(n){super(n),this.registerInput("input",lk.Particle),this.registerInput("radius",lk.Float,!0,1),this.registerInput("radiusRange",lk.Float,!0,1,0,1),this.registerInput("directionRandomizer",lk.Float,!0,0,0,1),this.registerOutput("output",lk.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(n){const k=this.input.getConnectedValue(n);k._directionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.directionRandomizer.getConnectedValue(n),Q=T.position.Fg(n.emitterPosition).normalize(),G=(0,I.l)(0,K),w=(0,I.l)(0,K),E=(0,I.l)(0,K);Q.x+=G,Q.y+=w,Q.z+=E,Q.normalize(),n.isEmitterTransformNode?c.o.TransformNormalFromFloatsToRef(G,w,E,n.emitterWorldMatrix,T.direction):T.direction.di(G,w,E)},k._positionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.radius.getConnectedValue(n),Q=this.radiusRange.getConnectedValue(n),G=K-(0,I.l)(0,K*Q),w=(0,I.l)(0,1),E=(0,I.l)(0,2*Math.PI),S=Math.acos(2*w-1),P=G*Math.cos(E)*Math.sin(S),W=G*Math.cos(S),J=G*Math.sin(E)*Math.sin(S);n.isEmitterTransformNode?c.o.TransformCoordinatesFromFloatsToRef(P,W,J,n.emitterWorldMatrix,T.position):(T.position.di(P,W,J),T.position.addInPlace(n.emitterPosition))},this.output._storedValue=k}});(0,w.f)("BABYLON.PointShapeBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("direction1",lk.li,!0,new c.o(0,1,0)),this.registerInput("direction2",lk.li,!0,new c.o(0,1,0)),this.registerOutput("output",lk.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(n){const k=this.particle.getConnectedValue(n);k._directionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.direction1.getConnectedValue(n),Q=this.direction2.getConnectedValue(n),G=(0,I.l)(K.x,Q.x),w=(0,I.l)(K.y,Q.y),E=(0,I.l)(K.z,Q.z);n.isEmitterTransformNode?c.o.TransformNormalFromFloatsToRef(G,w,E,n.emitterWorldMatrix,T.direction):T.direction.di(G,w,E)},k._positionCreation.process=T=>{n.systemContext=k,n.isEmitterTransformNode?c.o.TransformCoordinatesFromFloatsToRef(0,0,0,n.emitterWorldMatrix,T.position):T.position.p(n.emitterPosition)},this.output._storedValue=k}});(0,w.f)("BABYLON.CustomShapeBlock",class extends jk{constructor(n){super(n),this.registerInput("particle",lk.Particle),this.registerInput("position",lk.li,!0,new c.o(0,0,0)),this.registerInput("direction",lk.li,!0,new c.o(0,1,0)),this.registerOutput("output",lk.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(n){const k=this.particle.getConnectedValue(n);k._directionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.direction.getConnectedValue(n);n.isEmitterTransformNode?c.o.TransformNormalToRef(K,n.emitterWorldMatrix,T.direction):T.direction.p(K)},k._positionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.position.getConnectedValue(n);n.isEmitterTransformNode?c.o.TransformCoordinatesToRef(K,n.emitterWorldMatrix,T.position):(T.position.p(K),T.position.addInPlace(n.emitterPosition))},this.output._storedValue=k}});(0,w.f)("BABYLON.CylinderShapeBlock",class extends jk{constructor(n){super(n),this._tempVector=c.o.Zero(),this.registerInput("particle",lk.Particle),this.registerInput("radius",lk.Float,!0,1),this.registerInput("height",lk.Float,!0,1,0),this.registerInput("radiusRange",lk.Float,!0,1,0,1),this.registerInput("directionRandomizer",lk.Float,!0,0,0,1),this.registerOutput("output",lk.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(n){const k=this.particle.getConnectedValue(n);k._directionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.directionRandomizer.getConnectedValue(n);T.position.subtractToRef(n.emitterPosition,this._tempVector),this._tempVector.normalize(),n.isEmitterTransformNode&&c.o.TransformNormalToRef(this._tempVector,n.emitterInverseWorldMatrix,this._tempVector);const Q=(0,I.l)(-K/2,K/2);let G=Math.atan2(this._tempVector.x,this._tempVector.z);G+=(0,I.l)(-Math.PI/2,Math.PI/2)*K,this._tempVector.y=Q,this._tempVector.x=Math.sin(G),this._tempVector.z=Math.cos(G),this._tempVector.normalize(),n.isEmitterTransformNode?c.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,n.emitterWorldMatrix,T.direction):T.direction.p(this._tempVector)},k._positionCreation.process=T=>{n.particleContext=T,n.systemContext=k;const K=this.height.getConnectedValue(n),Q=this.radiusRange.getConnectedValue(n),G=this.radius.getConnectedValue(n),w=(0,I.l)(-K/2,K/2),E=(0,I.l)(0,2*Math.PI),S=(0,I.l)((1-Q)*(1-Q),1),P=Math.sqrt(S)*G,W=P*Math.cos(E),J=P*Math.sin(E);n.isEmitterTransformNode?c.o.TransformCoordinatesFromFloatsToRef(W,w,J,n.emitterWorldMatrix,T.position):(T.position.di(W,w,J),T.position.addInPlace(n.emitterPosition))},this.output._storedValue=k}});class IT extends jk{constructor(n){super(n),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",lk.Particle),this.registerOutput("output",lk.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){super._build(n);const k=this.particle.getConnectedValue(n);k._isAnimationSheetEnabled=!0,k.spriteCellWidth=this.width,k.spriteCellHeight=this.height,k.startSpriteCellID=this.start,k.endSpriteCellID=this.end,k.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=k}serialize(){const n=super.serialize();return n.width=this.width,n.height=this.height,n.start=this.start,n.end=this.end,n.randomStartCell=this.randomStartCell,n}_deserialize(n){super._deserialize(n),this.width=n.width,this.height=n.height,this.start=n.start,this.end=n.end,this.randomStartCell=n.randomStartCell}}(0,U.e)([pk("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IT.prototype,"start",void 0),(0,U.e)([pk("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IT.prototype,"end",void 0),(0,U.e)([pk("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IT.prototype,"width",void 0),(0,U.e)([pk("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],IT.prototype,"height",void 0),(0,U.e)([pk("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],IT.prototype,"loop",void 0),(0,U.e)([pk("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],IT.prototype,"randomStartCell",void 0),(0,w.f)("BABYLON.SetupSpriteSheetBlock",IT);class ST extends jk{constructor(n){super(n),this.reference=0,this.registerInput("value",lk.AutoDetect),this.registerOutput("output",lk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=n=>{switch(n){case lk.Float:return lk.FloatGradient;case lk.Vector2:return lk.Vector2Gradient;case lk.li:return lk.Vector3Gradient;case lk.Si:return lk.Color4Gradient}return n},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lk.Float|lk.Vector2|lk.li|lk.Si)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=n=>null}serialize(){const n=super.serialize();return n.reference=this.reference,n}_deserialize(n){super._deserialize(n),this.reference=n.reference}}(0,U.e)([pk("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],ST.prototype,"reference",void 0),(0,w.f)("BABYLON.ParticleGradientValueBlock",ST);(0,w.f)("BABYLON.ParticleGradientBlock",class extends jk{constructor(n){super(n),this._entryCount=1,this.registerInput("gradient",lk.Float,!0,1,0,1),this.registerInput("value0",lk.AutoDetect),this.registerOutput("output",lk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=n=>{switch(n){case lk.FloatGradient:return lk.Float;case lk.Vector2Gradient:return lk.Vector2;case lk.Vector3Gradient:return lk.li;case lk.Color4Gradient:return lk.Si}return n},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lk.FloatGradient|lk.Vector2Gradient|lk.Vector3Gradient|lk.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(n){this._inputs[n].onConnectionObservable.add((()=>{this._entryCount>n||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),lk.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const n=[];for(let T=1;T<this._inputs.length;T++){var k;if(this._inputs[T].isConnected)n.push(null===(k=this._inputs[T].connectedPoint)||void 0===k?void 0:k.ownerBlock)}n.sort(((n,k)=>n.reference-k.reference)),this.output._storedFunction=k=>{const T=this.gradient.getConnectedValue(k);if(1===n.length)return n[0].value.getConnectedValue(k);let K=null;for(let Q=n.length-1;Q>=0;Q--){const w=n[Q];if(w.reference<=T){const n=w.value.getConnectedValue(k);if(K){const Q=K.value.getConnectedValue(k),E=K.reference,S=w.reference,P=Math.max(0,Math.min(1,(T-S)/(E-S)));switch(this.output.type){case lk.Float:return(0,I.i)(n,Q,P);case lk.Vector2:return c.m.Lerp(n,Q,P);case lk.li:return c.o.Lerp(n,Q,P);case lk.Si:return G.g.Lerp(n,Q,P)}}return n}K=w}return 0}}});(0,w.f)("BABYLON.ParticleConverterBlock",class extends jk{constructor(n){super(n),this.registerInput("color ",lk.Si,!0),this.registerInput("xyz ",lk.li,!0),this.registerInput("xy ",lk.Vector2,!0),this.registerInput("zw ",lk.Vector2,!0),this.registerInput("x ",lk.Float,!0),this.registerInput("y ",lk.Float,!0),this.registerInput("z ",lk.Float,!0),this.registerInput("w ",lk.Float,!0),this.registerOutput("color",lk.Si),this.registerOutput("xyz",lk.li),this.registerOutput("xy",lk.Vector2),this.registerOutput("zw",lk.Vector2),this.registerOutput("x",lk.Float),this.registerOutput("y",lk.Float),this.registerOutput("z",lk.Float),this.registerOutput("w",lk.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(n){return"color "===n?"colorIn":"xyz "===n?"xyzIn":"xy "===n?"xyIn":"zw "===n?"zwIn":"x "===n?"xIn":"y "===n?"yIn":"z "===n?"zIn":"w "===n?"wIn":n}_outputRename(n){switch(n){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return n}}_build(n){super._build(n);const k=this.xIn,T=this.yIn,K=this.zIn,Q=this.wIn,w=this.xyIn,E=this.zwIn,I=this.xyzIn,S=this.colorIn,P=this.colorOut,W=this.xyzOut,J=this.xyOut,H=this.zwOut,s=this.xOut,b=this.yOut,C=this.zOut,z=this.wOut,r=n=>{if(S.isConnected)return S.getConnectedValue(n);let c=0,P=0,W=0,J=0;if(k.isConnected&&(c=k.getConnectedValue(n)),T.isConnected&&(P=T.getConnectedValue(n)),K.isConnected&&(W=K.getConnectedValue(n)),Q.isConnected&&(J=Q.getConnectedValue(n)),w.isConnected){const k=w.getConnectedValue(n);k&&(c=k.x,P=k.y)}if(E.isConnected){const k=E.getConnectedValue(n);k&&(W=k.x,J=k.y)}if(I.isConnected){const k=I.getConnectedValue(n);k&&(c=k.x,P=k.y,W=k.z)}return new G.g(c,P,W,J)};P._storedFunction=n=>r(n),W._storedFunction=n=>{const k=r(n);return new c.o(k.r,k.g,k.b)},J._storedFunction=n=>{const k=r(n);return new c.m(k.r,k.g)},H._storedFunction=n=>{const k=r(n);return new c.m(k.b,k.a)},s._storedFunction=n=>r(n).r,b._storedFunction=n=>r(n).g,C._storedFunction=n=>r(n).b,z._storedFunction=n=>r(n).a}}),function(n){n[n.Cos=0]="Cos",n[n.Sin=1]="Sin",n[n.Abs=2]="Abs",n[n.Exp=3]="Exp",n[n.Exp2=4]="Exp2",n[n.Round=5]="Round",n[n.Floor=6]="Floor",n[n.Ceiling=7]="Ceiling",n[n.Sqrt=8]="Sqrt",n[n.Log=9]="Log",n[n.Tan=10]="Tan",n[n.ArcTan=11]="ArcTan",n[n.ArcCos=12]="ArcCos",n[n.ArcSin=13]="ArcSin",n[n.Sign=14]="Sign",n[n.Negate=15]="Negate",n[n.OneMinus=16]="OneMinus",n[n.Reciprocal=17]="Reciprocal",n[n.ToDegrees=18]="ToDegrees",n[n.ToRadians=19]="ToRadians",n[n.Fract=20]="Fract"}(Lk||(Lk={}));class PT extends jk{constructor(n){super(n),this.operation=Lk.Cos,this.registerInput("input",lk.AutoDetect),this.registerOutput("output",lk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lk.Float|lk.Int|lk.Vector2|lk.li|lk.Si)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){super._build(n);let k=null;switch(this.operation){case Lk.Cos:k=n=>Math.cos(n);break;case Lk.Sin:k=n=>Math.sin(n);break;case Lk.Abs:k=n=>Math.abs(n);break;case Lk.Exp:k=n=>Math.exp(n);break;case Lk.Exp2:k=n=>Math.pow(2,n);break;case Lk.Round:k=n=>Math.round(n);break;case Lk.Floor:k=n=>Math.floor(n);break;case Lk.Ceiling:k=n=>Math.ceil(n);break;case Lk.Sqrt:k=n=>Math.sqrt(n);break;case Lk.Log:k=n=>Math.log(n);break;case Lk.Tan:k=n=>Math.tan(n);break;case Lk.ArcTan:k=n=>Math.atan(n);break;case Lk.ArcCos:k=n=>Math.acos(n);break;case Lk.ArcSin:k=n=>Math.asin(n);break;case Lk.Sign:k=n=>Math.sign(n);break;case Lk.Negate:k=n=>-n;break;case Lk.OneMinus:k=n=>1-n;break;case Lk.Reciprocal:k=n=>1/n;break;case Lk.ToRadians:k=n=>n*Math.PI/180;break;case Lk.ToDegrees:k=n=>180*n/Math.PI;break;case Lk.Fract:k=n=>n>=0?n-Math.floor(n):n-Math.ceil(n)}if(!k)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case lk.Int:case lk.Float:this.output._storedFunction=n=>{const T=this.input.getConnectedValue(n);return k(T)};break;case lk.Vector2:this.output._storedFunction=n=>{const T=this.input.getConnectedValue(n);return new c.m(k(T.x),k(T.y))};break;case lk.li:this.output._storedFunction=n=>{const T=this.input.getConnectedValue(n);return new c.o(k(T.x),k(T.y),k(T.z))};break;case lk.Si:this.output._storedFunction=n=>{const T=this.input.getConnectedValue(n);return new G.g(k(T.r),k(T.g),k(T.b),k(T.a))}}return this}serialize(){const n=super.serialize();return n.operation=this.operation,n}_deserialize(n){super._deserialize(n),this.operation=n.operation}}(0,U.e)([pk("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Lk.Cos},{label:"Sin",value:Lk.Sin},{label:"Abs",value:Lk.Abs},{label:"Exp",value:Lk.Exp},{label:"Exp2",value:Lk.Exp2},{label:"Round",value:Lk.Round},{label:"Floor",value:Lk.Floor},{label:"Ceiling",value:Lk.Ceiling},{label:"Sqrt",value:Lk.Sqrt},{label:"Log",value:Lk.Log},{label:"Tan",value:Lk.Tan},{label:"ArcTan",value:Lk.ArcTan},{label:"ArcCos",value:Lk.ArcCos},{label:"ArcSin",value:Lk.ArcSin},{label:"Sign",value:Lk.Sign},{label:"Negate",value:Lk.Negate},{label:"OneMinus",value:Lk.OneMinus},{label:"Reciprocal",value:Lk.Reciprocal},{label:"ToDegrees",value:Lk.ToDegrees},{label:"ToRadians",value:Lk.ToRadians},{label:"Fract",value:Lk.Fract}]})],PT.prototype,"operation",void 0),(0,w.f)("BABYLON.ParticleTrigonometryBlock",PT);var WT,JT=T(12454);class HT extends jk{constructor(n){super(n),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",lk.AutoDetect),this.registerOutput("output",lk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(lk.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(lk.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(lk.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(lk.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(lk.System),this._inputs[0].excludedConnectionPointTypes.push(lk.Particle),this._inputs[0].excludedConnectionPointTypes.push(lk.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const k=n=>{const k=this.input.getConnectedValue(n);if(this.log.length>=this.stackSize)return k;if(null===k||void 0===k)return this.log.push(["null",""]),k;switch(this.input.type){case lk.Vector2:this.log.push([(0,JT.j)(k,4),k.toString()]);break;case lk.li:this.log.push([(0,JT.l)(k,4),k.toString()]);break;case lk.Si:this.log.push([`{R: ${k.r.toFixed(4)} G: ${k.g.toFixed(4)} B: ${k.b.toFixed(4)} A: ${k.a.toFixed(4)}}`,k.toString()]);break;default:this.log.push([k.toString(),k.toString()])}return k};this.output.isConnected?this.output._storedFunction=k:this.output._storedValue=k(n)}serialize(){const n=super.serialize();return n.stackSize=this.stackSize,n}_deserialize(n){super._deserialize(n),this.stackSize=n.stackSize}}(0,U.e)([pk("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],HT.prototype,"stackSize",void 0),(0,w.f)("BABYLON.ParticleDebugBlock",HT);(0,w.f)("BABYLON.ParticleElbowBlock",class extends jk{constructor(n){super(n),this.registerInput("input",lk.AutoDetect),this.registerOutput("output",lk.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){super._build(n);const k=this._outputs[0],T=this._inputs[0];k._storedFunction=n=>T.getConnectedValue(n)}});(0,w.f)("BABYLON.ParticleTeleportInBlock",class extends jk{get endpoints(){return this._endpoints}constructor(n){super(n),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",lk.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(n){if(this.getClassName()===n)return!0;for(const k of this.endpoints)if(k.isAnAncestorOfType(n))return!0;return!1}isAnAncestorOf(n){for(const k of this.endpoints){if(k===n)return!0;if(k.isAnAncestorOf(n))return!0}return!1}attachToEndpoint(n){n.detach(),this._endpoints.push(n),n._entryPoint=this,n._outputs[0]._typeConnectionSource=this._inputs[0],n._tempEntryPointUniqueId=null,n.name="> "+this.name}detachFromEndpoint(n){const k=this._endpoints.indexOf(n);-1!==k&&(this._endpoints.splice(k,1),n._outputs[0]._typeConnectionSource=null,n._entryPoint=null)}_build(){for(const n of this._endpoints)n.output._storedFunction=n=>this.input.getConnectedValue(n)}});(0,w.f)("BABYLON.ParticleTeleportOutBlock",class extends jk{constructor(n){super(n),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",lk.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(n){this.entryPoint&&this.entryPoint.build(n)}clone(){const n=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(n),n}serialize(){var n;const k=super.serialize();return k.entryPoint=(null===(n=this.entryPoint)||void 0===n?void 0:n.uniqueId)??"",k}_deserialize(n){super._deserialize(n),this._tempEntryPointUniqueId=n.entryPoint}}),function(n){n[n.Equal=0]="Equal",n[n.NotEqual=1]="NotEqual",n[n.LessThan=2]="LessThan",n[n.GreaterThan=3]="GreaterThan",n[n.LessOrEqual=4]="LessOrEqual",n[n.GreaterOrEqual=5]="GreaterOrEqual",n[n.Xor=6]="Xor",n[n.Or=7]="Or",n[n.And=8]="And"}(WT||(WT={}));class sT extends jk{constructor(n){super(n),this.test=WT.Equal,this.epsilon=0,this.registerInput("left",lk.Float),this.registerInput("right",lk.Float,!0,0),this.registerInput("ifTrue",lk.AutoDetect,!0,1),this.registerInput("ifFalse",lk.AutoDetect,!0,0),this.registerOutput("output",lk.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=lk.Float,this._inputs[0].acceptedConnectionPointTypes.push(lk.Int),this._inputs[1].acceptedConnectionPointTypes.push(lk.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const n=n=>{const k=this.left.getConnectedValue(n),T=this.right.getConnectedValue(n);let c=!1;switch(this.test){case WT.Equal:c=(0,I.p)(k,T,this.epsilon);break;case WT.NotEqual:c=!(0,I.p)(k,T,this.epsilon);break;case WT.LessThan:c=k<T+this.epsilon;break;case WT.GreaterThan:c=k>T-this.epsilon;break;case WT.LessOrEqual:c=k<=T+this.epsilon;break;case WT.GreaterOrEqual:c=k>=T-this.epsilon;break;case WT.Xor:c=!!k&&!T||!k&&!!T;break;case WT.Or:c=!!k||!!T;break;case WT.And:c=!!k&&!!T}return c};this.output._storedFunction=k=>n(k)?this.ifTrue.getConnectedValue(k):this.ifFalse.getConnectedValue(k)}serialize(){const n=super.serialize();return n.test=this.test,n.epsilon=this.epsilon,n}_deserialize(n){super._deserialize(n),this.test=n.test,void 0!==n.epsilon&&(this.epsilon=n.epsilon)}}(0,U.e)([pk("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:WT.Equal},{label:"NotEqual",value:WT.NotEqual},{label:"LessThan",value:WT.LessThan},{label:"GreaterThan",value:WT.GreaterThan},{label:"LessOrEqual",value:WT.LessOrEqual},{label:"GreaterOrEqual",value:WT.GreaterOrEqual},{label:"Xor",value:WT.Xor},{label:"Or",value:WT.Or},{label:"And",value:WT.And}]})],sT.prototype,"test",void 0),(0,U.e)([pk("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],sT.prototype,"epsilon",void 0),(0,w.f)("BABYLON.ParticleConditionBlock",sT);class bT extends jk{constructor(n){super(n),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",lk.Particle),this.registerInput("condition",lk.Float,!0,0),this.registerInput("system",lk.System),this.registerOutput("output",lk.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(n){this._triggerCount=0;const k=this.input.getConnectedValue(n),T={process:T=>{if(n.particleContext=T,n.systemContext=k,0!==this.condition.getConnectedValue(n)&&(0===this.limit||this._triggerCount<this.limit)){const c=(new Date).getTime();if(this._previousOne&&c-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=c;const K=this.system.getConnectedValue(n);if(K){const c=Xk(K,n.me,T.position);c.Gi.addOnce((()=>{this._triggerCount--})),k.Gi.addOnce((()=>{c.dispose()}))}}},previousItem:null,nextItem:null};k._updateQueueStart?on(T,k._updateQueueStart):k._updateQueueStart=T,this.output._storedValue=k}serialize(){const n=super.serialize();return n.limit=this.limit,n.delay=this.delay,n}_deserialize(n){super._deserialize(n),void 0!==n.limit&&(this.limit=n.limit),void 0!==n.delay&&(this.delay=n.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,U.e)([pk("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bT.prototype,"limit",void 0),(0,U.e)([pk("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bT.prototype,"delay",void 0),(0,w.f)("BABYLON.ParticleTriggerBlock",bT);T(12462),T(12476),T(12482),T(12538)},12521:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneFragment",Q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12491:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneFragmentDeclaration",Q="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12552:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneVertex",Q="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12543:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneVertexDeclaration",Q="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12532:(n,k,T)=>{"use strict";var c=T(624);const K="fogFragment",Q="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12519:(n,k,T)=>{"use strict";var c=T(624);const K="fogFragmentDeclaration",Q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12557:(n,k,T)=>{"use strict";var c=T(624);const K="fogVertex",Q="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12546:(n,k,T)=>{"use strict";var c=T(624);const K="fogVertexDeclaration",Q="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12509:(n,k,T)=>{"use strict";var c=T(624);const K="helperFunctions",Q="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12498:(n,k,T)=>{"use strict";var c=T(624);const K="imageProcessingDeclaration",Q="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12516:(n,k,T)=>{"use strict";var c=T(624);const K="imageProcessingFunctions",Q="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12504:(n,k,T)=>{"use strict";var c=T(624);const K="logDepthDeclaration",Q="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12529:(n,k,T)=>{"use strict";var c=T(624);const K="logDepthFragment",Q="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12562:(n,k,T)=>{"use strict";var c=T(624);const K="logDepthVertex",Q="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";c.b.IncludesShadersStoreWGSL[K]||(c.b.IncludesShadersStoreWGSL[K]=Q)},12482:(n,k,T)=>{"use strict";T.r(k),T.d(k,{particlesPixelShaderWGSL:()=>G});var c=T(624);T(12491),T(12498),T(12504),T(12509),T(12516),T(12519),T(12521),T(12529),T(12532);const K="particlesPixelShader",Q="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";c.b.ShadersStoreWGSL[K]||(c.b.ShadersStoreWGSL[K]=Q);const G={name:K,shader:Q}},12538:(n,k,T)=>{"use strict";T.r(k),T.d(k,{particlesVertexShaderWGSL:()=>G});var c=T(624);T(12543),T(12546),T(12504),T(12552),T(12557),T(12562);const K="particlesVertexShader",Q="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";c.b.ShadersStoreWGSL[K]||(c.b.ShadersStoreWGSL[K]=Q);const G={name:K,shader:Q}},12388:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneFragment",Q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12467:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneFragmentDeclaration",Q="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12415:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneVertex",Q="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12479:(n,k,T)=>{"use strict";var c=T(624);const K="clipPlaneVertexDeclaration",Q="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12400:(n,k,T)=>{"use strict";var c=T(624);const K="fogFragment",Q="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12382:(n,k,T)=>{"use strict";var c=T(624);const K="fogFragmentDeclaration",Q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12422:(n,k,T)=>{"use strict";var c=T(624);const K="fogVertex",Q="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12408:(n,k,T)=>{"use strict";var c=T(624);const K="fogVertexDeclaration",Q="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12368:(n,k,T)=>{"use strict";var c=T(624);const K="helperFunctions",Q="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12353:(n,k,T)=>{"use strict";var c=T(624);const K="imageProcessingDeclaration",Q="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12374:(n,k,T)=>{"use strict";var c=T(624);const K="imageProcessingFunctions",Q="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12361:(n,k,T)=>{"use strict";var c=T(624);const K="logDepthDeclaration",Q="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12394:(n,k,T)=>{"use strict";var c=T(624);const K="logDepthFragment",Q="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12427:(n,k,T)=>{"use strict";var c=T(624);const K="logDepthVertex",Q="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";c.b.IncludesShadersStore[K]||(c.b.IncludesShadersStore[K]=Q)},12462:(n,k,T)=>{"use strict";T.r(k),T.d(k,{particlesPixelShader:()=>G});var c=T(624);T(12467),T(12353),T(12361),T(12368),T(12374),T(12382),T(12388),T(12394),T(12400);const K="particlesPixelShader",Q="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";c.b.ShadersStore[K]||(c.b.ShadersStore[K]=Q);const G={name:K,shader:Q}},12476:(n,k,T)=>{"use strict";T.r(k),T.d(k,{particlesVertexShader:()=>G});var c=T(624);T(12479),T(12408),T(12361),T(12415),T(12422),T(12427);const K="particlesVertexShader",Q="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";c.b.ShadersStore[K]||(c.b.ShadersStore[K]=Q);const G={name:K,shader:Q}},12884:(n,k,T)=>{"use strict";T.r(k),T.d(k,{FlowGraphGLTFDataProvider:()=>Q});var c=T(12845),K=T(12831);class Q extends c.b{constructor(n){var k,T;super();const c=n.glTF,Q=(null===(k=c.animations)||void 0===k?void 0:k.map((n=>n._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",K.e,Q);const G=(null===(T=c.nodes)||void 0===T?void 0:T.map((n=>n._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",K.e,G)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12763:(n,k,T)=>{"use strict";T.d(k,{c:()=>b,e:()=>H,i:()=>J,m:()=>s});var c=T(730),K=T(12766),Q=T(764),G=T(12775);const w=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class E{constructor(n,k){this._gltf=n,this._infoTree=k}convert(n){let k,T=this._gltf,c=this._infoTree;if(!n.startsWith("/"))throw new Error("Path must start with a /");const K=n.split("/");if(K.shift(),K[K.length-1].includes(".length")){const n=K[K.length-1].split(".");K.pop(),K.push(...n)}let Q=!1;for(const E of K){const K="length"===E;if(K&&!c.__array__)throw new Error(`Path ${n} is invalid`);if(c.__ignoreObjectTree__&&(Q=!0),c.__array__&&!K)c=c.__array__;else if(c=c[E],!c)throw new Error(`Path ${n} is invalid`);if(!Q)if(void 0===T){if(!w.find((k=>k.regex.test(n))))throw new Error(`Path ${n} is invalid`)}else if(!K){var G;T=null===(G=T)||void 0===G?void 0:G[E]}(c.__target__||K)&&(k=T)}return{object:k,info:c}}}function I(n,k,T,c){const K=S(n,k);return c?K[T][c]:K[T]}function S(n,k,T){var c,Q;return null===(c=n._data)||void 0===c||null===(Q=c[(null===T||void 0===T?void 0:T.fillMode)??K.b.MATERIAL_TriangleFillMode])||void 0===Q?void 0:Q.babylonMaterial}function P(n,k){return{offset:{componentsCount:2,type:"Vector2",get:(T,K,Q)=>{const G=I(T,Q,n,k);return new c.m(null===G||void 0===G?void 0:G.uOffset,null===G||void 0===G?void 0:G.vOffset)},getTarget:S,set:(T,c,K,Q)=>{const G=I(c,Q,n,k);G.uOffset=T.x,G.vOffset=T.y},getPropertyName:[()=>`${n}${k?"."+k:""}.uOffset`,()=>`${n}${k?"."+k:""}.vOffset`]},rotation:{type:"number",get:(T,c,K)=>{var Q;return null===(Q=I(T,K,n,k))||void 0===Q?void 0:Q.wAng},getTarget:S,set:(T,c,K,Q)=>I(c,Q,n,k).wAng=T,getPropertyName:[()=>`${n}${k?"."+k:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(T,K,Q)=>{const G=I(T,Q,n,k);return new c.m(null===G||void 0===G?void 0:G.uScale,null===G||void 0===G?void 0:G.vScale)},getTarget:S,set:(T,c,K,Q)=>{const G=I(c,Q,n,k);G.uScale=T.x,G.vScale=T.y},getPropertyName:[()=>`${n}${k?"."+k:""}.uScale`,()=>`${n}${k?"."+k:""}.vScale`]}}}const W={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:n=>{var k,T;return new c.m((null===(k=n._babylonCamera)||void 0===k?void 0:k.orthoLeft)??0,(null===(T=n._babylonCamera)||void 0===T?void 0:T.orthoRight)??0)},set:(n,k)=>{k._babylonCamera&&(k._babylonCamera.orthoLeft=n.x,k._babylonCamera.orthoRight=n.y)},getTarget:n=>n,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:n=>{var k,T;return new c.m((null===(k=n._babylonCamera)||void 0===k?void 0:k.orthoBottom)??0,(null===(T=n._babylonCamera)||void 0===T?void 0:T.orthoTop)??0)},set:(n,k)=>{k._babylonCamera&&(k._babylonCamera.orthoBottom=n.x,k._babylonCamera.orthoTop=n.y)},getTarget:n=>n,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:n=>{var k;return null===(k=n._babylonCamera)||void 0===k?void 0:k.maxZ},set:(n,k)=>{k._babylonCamera&&(k._babylonCamera.maxZ=n)},getTarget:n=>n,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:n=>{var k;return null===(k=n._babylonCamera)||void 0===k?void 0:k.ri},set:(n,k)=>{k._babylonCamera&&(k._babylonCamera.ri=n)},getTarget:n=>n,getPropertyName:[()=>"ri"]}},perspective:{aspectRatio:{type:"number",get:n=>{var k;return null===(k=n._babylonCamera)||void 0===k?void 0:k.getEngine().getAspectRatio(n._babylonCamera)},getTarget:n=>n,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:n=>{var k;return null===(k=n._babylonCamera)||void 0===k?void 0:k.fov},set:(n,k)=>{k._babylonCamera&&(k._babylonCamera.fov=n)},getTarget:n=>n,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:n=>{var k;return null===(k=n._babylonCamera)||void 0===k?void 0:k.maxZ},set:(n,k)=>{k._babylonCamera&&(k._babylonCamera.maxZ=n)},getTarget:n=>n,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:n=>{var k;return null===(k=n._babylonCamera)||void 0===k?void 0:k.ri},set:(n,k)=>{k._babylonCamera&&(k._babylonCamera.ri=n)},getTarget:n=>n,getPropertyName:[()=>"ri"]}}}},nodes:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"li",get:n=>{var k;return null===(k=n._babylonTransformNode)||void 0===k?void 0:k.position},set:(n,k)=>{var T;return null===(T=k._babylonTransformNode)||void 0===T?void 0:T.position.p(n)},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:n=>{var k;return null===(k=n._babylonTransformNode)||void 0===k?void 0:k.rotationQuaternion},set:(n,k)=>{var T,c;return null===(T=k._babylonTransformNode)||void 0===T||null===(c=T.rotationQuaternion)||void 0===c?void 0:c.p(n)},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"li",get:n=>{var k;return null===(k=n._babylonTransformNode)||void 0===k?void 0:k.ei},set:(n,k)=>{var T;return null===(T=k._babylonTransformNode)||void 0===T?void 0:T.ei.p(n)},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"ei"]},weights:{length:{type:"number",get:n=>n._numMorphTargets,getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(n,k)=>{var T,c;return void 0!==k?null===(T=n._primitiveBabylonMeshes)||void 0===T||null===(c=T[0].morphTargetManager)||void 0===c?void 0:c.getTarget(k).influence:void 0},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(n,k)=>[0],getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:n=>{var k,T,K;return c.d.Compose(null===(k=n._babylonTransformNode)||void 0===k?void 0:k.ei,null===(T=n._babylonTransformNode)||void 0===T?void 0:T.rotationQuaternion,null===(K=n._babylonTransformNode)||void 0===K?void 0:K.position)},getTarget:n=>n._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:n=>{var k,T,K,Q;const G=c.d.Identity();let w=n.parent;for(;w&&w.parent;)w=w.parent;const E=(null===(k=n._babylonTransformNode)||void 0===k?void 0:k.position._isDirty)||(null===(T=n._babylonTransformNode)||void 0===T||null===(K=T.rotationQuaternion)||void 0===K?void 0:K._isDirty)||(null===(Q=n._babylonTransformNode)||void 0===Q?void 0:Q.ei._isDirty);if(w){var I;const k=null===(I=w._babylonTransformNode)||void 0===I?void 0:I.pi(!0).invert();var S,P;if(k)null===(S=n._babylonTransformNode)||void 0===S||null===(P=S.pi(E))||void 0===P||P.multiplyToRef(k,G)}else n._babylonTransformNode&&G.p(n._babylonTransformNode.pi(E));return G},getTarget:n=>n._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:n=>{var k,T;return null===(k=n._babylonTransformNode)||void 0===k||null===(T=k.getChildren((n=>n instanceof G.d),!0)[0])||void 0===T?void 0:T.Bl},getTarget:n=>{var k;return null===(k=n._babylonTransformNode)||void 0===k?void 0:k.getChildren((n=>n instanceof G.d),!0)[0]},set:(n,k)=>{if(k._babylonTransformNode){const T=k._babylonTransformNode.getChildren((n=>n instanceof G.d),!0)[0];T&&(T.Bl=n)}}},color:{type:"Ri",get:n=>{var k,T;return null===(k=n._babylonTransformNode)||void 0===k||null===(T=k.getChildren((n=>n instanceof G.d),!0)[0])||void 0===T?void 0:T.$g},getTarget:n=>{var k;return null===(k=n._babylonTransformNode)||void 0===k?void 0:k.getChildren((n=>n instanceof G.d),!0)[0]},set:(n,k)=>{if(k._babylonTransformNode){const T=k._babylonTransformNode.getChildren((n=>n instanceof G.d),!0)[0];T&&(T.$g=n)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Ri",get:(n,k,T)=>S(n,k,T).emissiveColor,set:(n,k,T,c)=>S(k,T,c).emissiveColor.p(n),getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:P("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(n,k,T)=>{var c;return null===(c=I(n,T,"bumpTexture"))||void 0===c?void 0:c.level},set:(n,k,T,c)=>{const K=I(k,c,"bumpTexture");K&&(K.level=n)},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:P("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(n,k,T)=>S(n,k,T).ambientTextureStrength,set:(n,k,T,c)=>{const K=S(k,T,c);K&&(K.ambientTextureStrength=n)},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:P("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Si",get:(n,k,T)=>{const c=S(n,k,T);return Q.g.FromColor3(c.albedoColor,c.alpha)},set:(n,k,T,c)=>{const K=S(k,T,c);K.albedoColor.set(n.r,n.g,n.b),K.alpha=n.a},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:P("albedoTexture")}},metallicFactor:{type:"number",get:(n,k,T)=>S(n,k,T).metallic,set:(n,k,T,c)=>{const K=S(k,T,c);K&&(K.metallic=n)},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(n,k,T)=>S(n,k,T).roughness,set:(n,k,T,c)=>{const K=S(k,T,c);K&&(K.roughness=n)},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:P("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(n,k,T)=>S(n,k,T).anisotropy.Bl,set:(n,k,T,c)=>{S(k,T,c).anisotropy.Bl=n},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(n,k,T)=>S(n,k,T).anisotropy.angle,set:(n,k,T,c)=>{S(k,T,c).anisotropy.angle=n},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:P("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(n,k,T)=>S(n,k,T).clearCoat.Bl,set:(n,k,T,c)=>{S(k,T,c).clearCoat.Bl=n},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(n,k,T)=>S(n,k,T).clearCoat.roughness,set:(n,k,T,c)=>{S(k,T,c).clearCoat.roughness=n},getTarget:(n,k,T)=>S(n,k,T),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:P("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(n,k,T)=>{var c;return null===(c=S(n,k,T).clearCoat.bumpTexture)||void 0===c?void 0:c.level},getTarget:S,set:(n,k,T,c)=>S(k,T,c).clearCoat.bumpTexture.level=n},extensions:{KHR_texture_transform:P("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:P("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(n,k,T)=>S(n,k,T).subSurface.dispersion,getTarget:S,set:(n,k,T,c)=>S(k,T,c).subSurface.dispersion=n}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(n,k,T)=>S(n,k,T).emissiveIntensity,getTarget:S,set:(n,k,T,c)=>S(k,T,c).emissiveIntensity=n}},KHR_materials_ior:{ior:{type:"number",get:(n,k,T)=>S(n,k,T).indexOfRefraction,getTarget:S,set:(n,k,T,c)=>S(k,T,c).indexOfRefraction=n}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(n,k,T)=>S(n,k,T).iridescence.Bl,getTarget:S,set:(n,k,T,c)=>S(k,T,c).iridescence.Bl=n},iridescenceIor:{type:"number",get:(n,k,T)=>S(n,k,T).iridescence.indexOfRefraction,getTarget:S,set:(n,k,T,c)=>S(k,T,c).iridescence.indexOfRefraction=n},iridescenceTexture:{extensions:{KHR_texture_transform:P("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(n,k,T)=>S(n,k,T).iridescence.maximumThickness,getTarget:S,set:(n,k,T,c)=>S(k,T,c).iridescence.maximumThickness=n},iridescenceThicknessMinimum:{type:"number",get:(n,k,T)=>S(n,k,T).iridescence.minimumThickness,getTarget:S,set:(n,k,T,c)=>S(k,T,c).iridescence.minimumThickness=n},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:P("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Ri",get:(n,k,T)=>S(n,k,T).sheen.color,getTarget:S,set:(n,k,T,c)=>S(k,T,c).sheen.color.p(n)},sheenColorTexture:{extensions:{KHR_texture_transform:P("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(n,k,T)=>S(n,k,T).sheen.Bl,getTarget:S,set:(n,k,T,c)=>S(k,T,c).sheen.Bl=n},sheenRoughnessTexture:{extensions:{KHR_texture_transform:P("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(n,k,T)=>S(n,k,T).metallicF0Factor,getTarget:S,set:(n,k,T,c)=>S(k,T,c).metallicF0Factor=n,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Ri",get:(n,k,T)=>S(n,k,T).metallicReflectanceColor,getTarget:S,set:(n,k,T,c)=>S(k,T,c).metallicReflectanceColor.p(n),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:P("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:P("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(n,k,T)=>S(n,k,T).subSurface.refractionIntensity,getTarget:S,set:(n,k,T,c)=>S(k,T,c).subSurface.refractionIntensity=n,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(n,k,T)=>S(n,k,T).subSurface.translucencyIntensity,getTarget:S,set:(n,k,T,c)=>S(k,T,c).subSurface.translucencyIntensity=n},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Ri",get:(n,k,T)=>S(n,k,T).subSurface.translucencyColor,getTarget:S,set:(n,k,T,c)=>{var K;return n&&(null===(K=S(k,T,c).subSurface.translucencyColor)||void 0===K?void 0:K.p(n))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:P("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Ri",get:(n,k,T)=>S(n,k,T).subSurface.tintColor,getTarget:S,set:(n,k,T,c)=>S(k,T,c).subSurface.tintColor.p(n)},attenuationDistance:{type:"number",get:(n,k,T)=>S(n,k,T).subSurface.tintColorAtDistance,getTarget:S,set:(n,k,T,c)=>S(k,T,c).subSurface.tintColorAtDistance=n},thicknessFactor:{type:"number",get:(n,k,T)=>S(n,k,T).subSurface.maximumThickness,getTarget:S,set:(n,k,T,c)=>S(k,T,c).subSurface.maximumThickness=n},thicknessTexture:{extensions:{KHR_texture_transform:P("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonLight)),getPropertyName:[n=>"length"]},__array__:{__target__:!0,color:{type:"Ri",get:n=>{var k;return null===(k=n._babylonLight)||void 0===k?void 0:k.$g},set:(n,k)=>{var T;return null===(T=k._babylonLight)||void 0===T?void 0:T.$g.p(n)},getTarget:n=>n._babylonLight,getPropertyName:[n=>"diffuse"]},Bl:{type:"number",get:n=>{var k;return null===(k=n._babylonLight)||void 0===k?void 0:k.Bl},set:(n,k)=>k._babylonLight?k._babylonLight.Bl=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"intensity"]},range:{type:"number",get:n=>{var k;return null===(k=n._babylonLight)||void 0===k?void 0:k.range},set:(n,k)=>k._babylonLight?k._babylonLight.range=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"range"]},spot:{innerConeAngle:{type:"number",get:n=>{var k;return null===(k=n._babylonLight)||void 0===k?void 0:k.innerAngle},set:(n,k)=>k._babylonLight?k._babylonLight.innerAngle=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"innerConeAngle"]},outerConeAngle:{type:"number",get:n=>{var k;return null===(k=n._babylonLight)||void 0===k?void 0:k.angle},set:(n,k)=>k._babylonLight?k._babylonLight.angle=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonLight)),getPropertyName:[n=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonTexture)),getPropertyName:[n=>"length"]},__array__:{__target__:!0,Bl:{type:"number",get:n=>{var k;return null===(k=n._babylonTexture)||void 0===k?void 0:k.level},set:(n,k)=>{k._babylonTexture&&(k._babylonTexture.level=n)},getTarget:n=>n._babylonTexture},rotation:{type:"Quaternion",get:n=>{var k;return n._babylonTexture&&c.h.FromRotationMatrix(null===(k=n._babylonTexture)||void 0===k?void 0:k.getReflectionTextureMatrix())},set:(n,k)=>{var T;k._babylonTexture&&(null!==(T=k._babylonTexture.va())&&void 0!==T&&T.useRightHandedSystem||(n=c.h.Inverse(n)),c.d.FromQuaternionToRef(n,k._babylonTexture.getReflectionTextureMatrix()))},getTarget:n=>n._babylonTexture}}}}},animations:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>{var k;return null===(k=n.primitives[0]._instanceData)||void 0===k?void 0:k.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function J(n){return new E(n,W)}function H(n){const k=n.split("/").map((n=>n.replace(/{}/g,"__array__")));let T=W;for(const c of k)c&&(T=T[c]);if(T&&T.type&&T.get)return T}function s(n,k){const T=n.split("/").map((n=>n.replace(/{}/g,"__array__")));let c=W;for(const K of T)K&&(c=c[K]);c&&c.type&&c.get&&(c.interpolation=k)}function b(n,k){const T=n.split("/").map((n=>n.replace(/{}/g,"__array__")));let c=W;for(const K of T)if(K){if(!c[K]){if("?"===K){c.__ignoreObjectTree__=!0;continue}c[K]={},"__array__"===K&&(c[K].__target__=!0)}c=c[K]}Object.assign(c,k)}},12788:(n,k,T)=>{"use strict";T.r(k),T.d(k,{AnimationPropertyInfo:()=>I,TransformNodeAnimationPropertyInfo:()=>S,WeightAnimationPropertyInfo:()=>P,getQuaternion:()=>w,getVector3:()=>G,getWeights:()=>E});var c=T(12706),K=T(730),Q=T(12763);function G(n,k,T,c){return K.o.ji(k,T).scaleInPlace(c)}function w(n,k,T,c){return K.h.ji(k,T).scaleInPlace(c)}function E(n,k,T,c){const K=new Array(n._numMorphTargets);for(let Q=0;Q<K.length;Q++)K[Q]=k[T++]*c;return K}class I{constructor(n,k,T,c){this.type=n,this.name=k,this.getValue=T,this.getStride=c}_buildAnimation(n,k,T){const K=new c.c(n,this.name,k,this.type);return K.setKeys(T),K}}class S extends I{buildAnimations(n,k,T,c){const K=[];return K.push({babylonAnimatable:n._babylonTransformNode,babylonAnimation:this._buildAnimation(k,T,c)}),K}}class P extends I{buildAnimations(n,k,T,K){const Q=[];if(n._numMorphTargets)for(let G=0;G<n._numMorphTargets;G++){const w=new c.c(`${k}_${G}`,this.name,T,this.type);if(w.setKeys(K.map((n=>({frame:n.frame,inTangent:n.inTangent?n.inTangent[G]:void 0,value:n.value[G],outTangent:n.outTangent?n.outTangent[G]:void 0,interpolation:n.interpolation})))),n._primitiveBabylonMeshes)for(const k of n._primitiveBabylonMeshes)if(k.morphTargetManager){const n=k.morphTargetManager.getTarget(G),T=w.clone();n.animations.push(T),Q.push({babylonAnimatable:n,babylonAnimation:T})}}return Q}}(0,Q.m)("/nodes/{}/translation",[new S(c.c.ANIMATIONTYPE_VECTOR3,"position",G,(()=>3))]),(0,Q.m)("/nodes/{}/rotation",[new S(c.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",w,(()=>4))]),(0,Q.m)("/nodes/{}/scale",[new S(c.c.ANIMATIONTYPE_VECTOR3,"ei",G,(()=>3))]),(0,Q.m)("/nodes/{}/weights",[new P(c.c.ANIMATIONTYPE_FLOAT,"influence",E,(n=>n._numMorphTargets))])},12676:(n,k,T)=>{"use strict";class c{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((n,k)=>{this._resolve=n,this._reject=k}))}}var K=T(730),Q=T(764),G=T(542),w=T(701),E=T(12678),I=T(12703),S=T(539),P=T(12347),W=T(12706),J=T(12714),H=T(588),s=T(556),b=T(564);class C{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(n){this._useTextureToStoreBoneMatrices=n,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(n){this._animationPropertiesOverride=n}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(n,k,T){this.name=n,this.id=k,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=K.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new S.b,this.bones=[],this._scene=T||H.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const c=this._scene.getEngine().getCaps();this._canUseTextureForBones=c.textureFloat&&c.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((n=>!n.getParent()))}getTransformMatrices(n){if(this.needInitialSkinMatrix){if(!n)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return n._bonesTransformMatrices||this.prepare(!0),n._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(n){return this.needInitialSkinMatrix&&n._transformMatrixTexture?n._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(n){let k=`Name: ${this.name}, nBones: ${this.bones.length}`;if(k+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,n){k+=", Ranges: {";let n=!0;for(const T in this._ranges)n&&(k+=", ",n=!1),k+=T;k+="}"}return k}getBoneIndexByName(n){for(let k=0,T=this.bones.length;k<T;k++)if(this.bones[k].name===n)return k;return-1}createAnimationRange(n,k,T){if(!this._ranges[n]){this._ranges[n]=new J.e(n,k,T);for(let c=0,K=this.bones.length;c<K;c++)this.bones[c].animations[0]&&this.bones[c].animations[0].createRange(n,k,T)}}deleteAnimationRange(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let T=0,c=this.bones.length;T<c;T++)this.bones[T].animations[0]&&this.bones[T].animations[0].deleteRange(n,k);this._ranges[n]=null}getAnimationRange(n){return this._ranges[n]||null}getAnimationRanges(){const n=[];let k;for(k in this._ranges)n.push(this._ranges[k]);return n}copyAnimationRange(n,k){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[k]||!n.getAnimationRange(k))return!1;let c=!0;const K=this._getHighestAnimationFrame()+1,Q={},G=n.bones;let w,E;for(E=0,w=G.length;E<w;E++)Q[G[E].name]=G[E];this.bones.length!==G.length&&(s.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${G.length}`),c=!1);const I=T&&this.dimensionsAtRest&&n.dimensionsAtRest?this.dimensionsAtRest.divide(n.dimensionsAtRest):null;for(E=0,w=this.bones.length;E<w;E++){const n=this.bones[E].name,G=Q[n];G?c=c&&this.bones[E].copyAnimationRange(G,k,K,T,I):(s.d.Warn("copyAnimationRange: not same rig, missing source bone "+n),c=!1)}const S=n.getAnimationRange(k);return S&&(this._ranges[k]=new J.e(k,S.from+K,S.to+K)),c}returnToRest(){for(const n of this.bones)-1!==n._index&&n.returnToRest()}_getHighestAnimationFrame(){let n=0;for(let k=0,T=this.bones.length;k<T;k++)if(this.bones[k].animations[0]){const T=this.bones[k].animations[0].getHighestFrame();n<T&&(n=T)}return n}beginAnimation(n,k,T,c){const K=this.getAnimationRange(n);return K?this._scene.beginAnimation(this,K.from,K.to,k,T,c):null}static MakeAnimationAdditive(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const c=n.getAnimationRange(T);if(!c)return null;const K=n._scene.getAllAnimatablesByTarget(n);let Q=null;for(let w=0;w<K.length;w++){const n=K[w];if(n.fromFrame===(null===c||void 0===c?void 0:c.from)&&n.toFrame===(null===c||void 0===c?void 0:c.to)){Q=n;break}}const G=n.getAnimatables();for(let w=0;w<G.length;w++){const n=G[w].animations;if(n)for(let c=0;c<n.length;c++)W.c.MakeAnimationAdditive(n[c],k,T)}return Q&&(Q.isAdditive=!0),n}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(n){this._meshesWithPoseMatrix.push(n)}_unregisterMeshWithPoseMatrix(n){const k=this._meshesWithPoseMatrix.indexOf(n);k>-1&&this._meshesWithPoseMatrix.splice(k,1)}_computeTransformMatrices(n,k){this.onBeforeComputeObservable.notifyObservers(this);for(let T=0;T<this.bones.length;T++){const c=this.bones[T];c._childUpdateId++;const K=c.getParent();if(K?c.getLocalMatrix().multiplyToRef(K.getFinalMatrix(),c.getFinalMatrix()):k?c.getLocalMatrix().multiplyToRef(k,c.getFinalMatrix()):c.getFinalMatrix().p(c.getLocalMatrix()),-1!==c._index){const k=null===c._index?T:c._index;c.getAbsoluteInverseBindMatrix().multiplyToArray(c.getFinalMatrix(),n,16*k)}}this._identity.copyToArray(n,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const n=this.va().getRenderId();if(this._currentRenderId===n)return;this._currentRenderId=n}if(this._numBonesWithLinkedTransformNode>0)for(const n of this.bones)if(n._linkedTransformNode){const k=n._linkedTransformNode;n.position=k.position,k.rotationQuaternion?n.rotationQuaternion=k.rotationQuaternion:n.rotation=k.rotation,n.ei=k.ei}if(this.needInitialSkinMatrix)for(const n of this._meshesWithPoseMatrix){const k=n.getPoseMatrix();let T=this._isDirty;if(n._bonesTransformMatrices&&n._bonesTransformMatrices.length===16*(this.bones.length+1)||(n._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),T=!0),T){if(this._synchronizedWithMesh!==n){this._synchronizedWithMesh=n;for(const n of this.bones)if(!n.getParent()){n.getBindMatrix().multiplyToRef(k,K.l.Matrix[1]),n._updateAbsoluteBindMatrices(K.l.Matrix[1])}if(this.isUsingTextureForMatrices){const k=4*(this.bones.length+1);n._transformMatrixTexture&&n._transformMatrixTexture.getSize().width===k||(n._transformMatrixTexture&&n._transformMatrixTexture.dispose(),n._transformMatrixTexture=P.e.CreateRGBATexture(n._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(n._bonesTransformMatrices,k),this.isUsingTextureForMatrices&&n._transformMatrixTexture&&n._transformMatrixTexture.update(n._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=P.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let n=0;n<this.bones.length;n++)this._animatables.push(this.bones[n])}return this._animatables}clone(n,k){const T=new C(n,k||n,this._scene);T.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let c=0;c<this.bones.length;c++){const n=this.bones[c];let k=null;const K=n.getParent();if(K){const n=this.bones.indexOf(K);k=T.bones[n]}const Q=new I.b(n.name,T,k,n.getBindMatrix().clone(),n.getRestMatrix().clone());Q._index=n._index,n._linkedTransformNode&&Q.linkTransformNode(n._linkedTransformNode),b.c.DeepCopy(n.animations,Q.animations)}if(this._ranges){T._ranges={};for(const n in this._ranges){const k=this._ranges[n];k&&(T._ranges[n]=k.clone())}}return this._isDirty=!0,T.prepare(!0),T}enableBlending(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const k of this.bones)for(const T of k.animations)T.enableBlending=!0,T.blendingSpeed=n}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const n=this._parentContainer.skeletons.indexOf(this);n>-1&&this._parentContainer.skeletons.splice(n,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const n={};n.name=this.name,n.id=this.id,this.dimensionsAtRest&&(n.dimensionsAtRest=this.dimensionsAtRest.wi()),n.bones=[],n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let T=0;T<this.bones.length;T++){var k;const c=this.bones[T],K=c.getParent(),Q={parentBoneIndex:K?this.bones.indexOf(K):-1,index:c.getIndex(),name:c.name,id:c.id,matrix:c.getBindMatrix().wi(),rest:c.getRestMatrix().wi(),linkedTransformNodeId:null===(k=c.getTransformNode())||void 0===k?void 0:k.id};n.bones.push(Q),c.length&&(Q.length=c.length),c.metadata&&(Q.metadata=c.metadata),c.animations&&c.animations.length>0&&(Q.animation=c.animations[0].serialize()),n.ranges=[];for(const k in this._ranges){const T=this._ranges[k];if(!T)continue;const c={};c.name=k,c.from=T.from,c.to=T.to,n.ranges.push(c)}}return n}static Parse(n,k){const T=new C(n.name,n.id,k);let c;for(n.dimensionsAtRest&&(T.dimensionsAtRest=K.o.ji(n.dimensionsAtRest)),T.needInitialSkinMatrix=n.needInitialSkinMatrix,c=0;c<n.bones.length;c++){const k=n.bones[c],Q=n.bones[c].index;let G=null;k.parentBoneIndex>-1&&(G=T.bones[k.parentBoneIndex]);const w=k.rest?K.d.ji(k.rest):null,E=new I.b(k.name,T,G,K.d.ji(k.matrix),w,null,Q);void 0!==k.id&&null!==k.id&&(E.id=k.id),k.length&&(E.length=k.length),k.metadata&&(E.metadata=k.metadata),k.animation&&E.animations.push(W.c.Parse(k.animation)),void 0!==k.linkedTransformNodeId&&null!==k.linkedTransformNodeId&&(T._hasWaitingData=!0,E._waitingTransformNodeId=k.linkedTransformNodeId)}if(n.ranges)for(c=0;c<n.ranges.length;c++){const k=n.ranges[c];T.createAnimationRange(k.name,k.from,k.to)}return T}computeAbsoluteMatrices(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||n)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(n)}getPoseMatrix(){let n=null;return this._meshesWithPoseMatrix.length>0&&(n=this._meshesWithPoseMatrix[0].getPoseMatrix()),n}sortBones(){const n=[],k=new Array(this.bones.length);for(let T=0;T<this.bones.length;T++)this._sortBones(T,n,k);this.bones=n}_sortBones(n,k,T){if(T[n])return;T[n]=!0;const c=this.bones[n];if(!c)return;void 0===c._index&&(c._index=n);const K=c.getParent();K&&this._sortBones(this.bones.indexOf(K),k,T),k.push(c)}setCurrentPoseAsRest(){for(const n of this.bones)n.setCurrentPoseAsRest()}}var z=T(915),r=T(706),q=T(712),O=T(12721),u=T(12729),f=T(675),A=T(760);class v extends u.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(n){this.subSurface.refractionTexture=n,n?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(n){this.subSurface.indexOfRefraction=n}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(n){this.subSurface.invertRefractionY=n}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(n){this.subSurface.linkRefractionWithTransparency=n,n&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===u.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(n){n!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=n?u.b.LIGHTFALLOFF_PHYSICAL:u.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===u.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(n){n!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=n?u.b.LIGHTFALLOFF_GLTF:u.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(n){this._attachImageProcessingConfiguration(n),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(n){this.imageProcessingConfiguration.colorCurvesEnabled=n}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(n){this.imageProcessingConfiguration.colorGradingEnabled=n}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(n){this._imageProcessingConfiguration.toneMappingEnabled=n}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(n){this._imageProcessingConfiguration.exposure=n}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(n){this._imageProcessingConfiguration.contrast=n}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(n){this._imageProcessingConfiguration.colorGradingTexture=n}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(n){this._imageProcessingConfiguration.colorCurves=n}constructor(n,k){super(n,k,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=Q.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new Q.e(0,0,0),this.albedoColor=new Q.e(1,1,1),this.baseWeight=1,this.reflectivityColor=new Q.e(1,1,1),this.reflectionColor=new Q.e(1,1,1),this.emissiveColor=new Q.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,O.d)(this.va())}getClassName(){return"PBRMaterial"}clone(n){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const c=A.d.Clone((()=>new v(n,this.va())),this,{cloneTexturesOnlyOnce:k});return c.id=n,c.name=n,this.stencil.copyTo(c.stencil),this._clonePlugins(c,T),c}serialize(){const n=super.serialize();return n.customType="BABYLON.PBRMaterial",n}static Parse(n,k,T){const c=A.d.Parse((()=>new v(n.name,k)),n,k,T);return n.stencil&&c.stencil.parse(n.stencil,k,T),z.d._ParsePlugins(n,c,k,T),n.clearCoat&&c.clearCoat.parse(n.clearCoat,k,T),n.anisotropy&&c.anisotropy.parse(n.anisotropy,k,T),n.brdf&&c.brdf.parse(n.brdf,k,T),n.sheen&&c.sheen.parse(n.sheen,k,T),n.subSurface&&c.subSurface.parse(n.subSurface,k,T),n.iridescence&&c.iridescence.parse(n.iridescence,k,T),c}}v.PBRMATERIAL_OPAQUE=u.b.PBRMATERIAL_OPAQUE,v.PBRMATERIAL_ALPHATEST=u.b.PBRMATERIAL_ALPHATEST,v.PBRMATERIAL_ALPHABLEND=u.b.PBRMATERIAL_ALPHABLEND,v.PBRMATERIAL_ALPHATESTANDBLEND=u.b.PBRMATERIAL_ALPHATESTANDBLEND,v.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=u.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"directIntensity",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveIntensity",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"environmentIntensity",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"specularIntensity",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"disableBumpMap",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"baseWeightTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"baseDiffuseRoughnessTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTexture",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTextureStrength",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"opacityTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectivityTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicTexture",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallic",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicF0Factor",void 0),(0,r.e)([(0,q.h)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicReflectanceColor",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"metallicReflectanceTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectanceTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"microSurfaceTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"bumpTexture",void 0),(0,r.e)([(0,q.D)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty",null)],v.prototype,"lightmapTexture",void 0),(0,r.e)([(0,q.h)("ambient"),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"ambientColor",void 0),(0,r.e)([(0,q.h)("albedo"),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoColor",void 0),(0,r.e)([(0,q.K)("baseWeight"),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"baseWeight",void 0),(0,r.e)([(0,q.K)("baseDiffuseRoughness"),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"baseDiffuseRoughness",void 0),(0,r.e)([(0,q.h)("reflectivity"),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectivityColor",void 0),(0,r.e)([(0,q.h)("reflection"),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"reflectionColor",void 0),(0,r.e)([(0,q.h)("emissive"),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"emissiveColor",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"microSurface",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLightmapAsShadowmap",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"useAlphaFromAlbedoTexture",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"forceAlphaTest",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],v.prototype,"alphaCutOff",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useSpecularOverAlpha",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAmbientInGrayScale",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,r.e)([(0,q.K)()],v.prototype,"usePhysicalLightFalloff",null),(0,r.e)([(0,q.K)()],v.prototype,"useGLTFLightFalloff",null),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRadianceOverAlpha",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useObjectSpaceNormalMap",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallax",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useParallaxOcclusion",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"parallaxScaleBias",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsLightsDirty")],v.prototype,"disableLighting",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"forceIrradianceInFragment",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsLightsDirty")],v.prototype,"maxSimultaneousLights",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapX",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"invertNormalMapY",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"twoSidedLighting",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useAlphaFresnel",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useLinearAlphaFresnel",void 0),(0,r.e)([(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"environmentBRDFTexture",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"forceNormalForward",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"enableSpecularAntiAliasing",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useHorizonOcclusion",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRadianceOcclusion",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsMiscDirty")],v.prototype,"unlit",void 0),(0,r.e)([(0,q.K)(),(0,q.d)("_markAllSubMeshesAsMiscDirty")],v.prototype,"applyDecalMapAfterDetailMap",void 0),(0,f.f)("BABYLON.PBRMaterial",v);var F=T(2334),m=T(885),x=T(781),g=T(855),U=T(878),V=T(532);class Y{get influence(){return this._influence}set influence(n){if(this._influence===n)return;const k=this._influence;this._influence=n,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===k||0===n)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(n){this._animationPropertiesOverride=n}constructor(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=n,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new S.b,this._onDataLayoutChanged=new S.b,this._animationPropertiesOverride=null,this.id=n,this._scene=T||H.e.LastCreatedScene,this.influence=k,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(n){const k=this.hasPositions;this._positions=n,k!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(n){const k=this.hasNormals;this._normals=n,k!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(n){const k=this.hasTangents;this._tangents=n,k!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(n){const k=this.hasUVs;this._uvs=n,k!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(n){const k=this.hasUV2s;this._uv2s=n,k!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(n){const k=this.hasColors;this._colors=n,k!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const n=A.d.Clone((()=>new Y(this.name,this.influence,this._scene)),this);return n._positions=this._positions,n._normals=this._normals,n._tangents=this._tangents,n._uvs=this._uvs,n._uv2s=this._uv2s,n._colors=this._colors,n}serialize(){const n={};return n.name=this.name,n.influence=this.influence,n.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(n.id=this.id),this.hasNormals&&(n.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(n.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(n.Aa=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(n.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(n.za=Array.prototype.slice.call(this.getColors())),A.d.AppendSerializedAnimations(this,n),n}getClassName(){return"MorphTarget"}static Parse(n,k){const T=new Y(n.name,n.influence);if(T.setPositions(n.xa),null!=n.id&&(T.id=n.id),n.ya&&T.setNormals(n.ya),n.tangents&&T.setTangents(n.tangents),n.Aa&&T.setUVs(n.Aa),n.uv2s&&T.setUV2s(n.uv2s),n.za&&T.setColors(n.za),n.animations){for(let k=0;k<n.animations.length;k++){const c=n.animations[k],K=(0,f.b)("BABYLON.Animation");K&&T.animations.push(K.Parse(c))}n.autoAnimate&&k&&k.beginAnimation(T,n.autoAnimateFrom,n.autoAnimateTo,n.autoAnimateLoop,n.autoAnimateSpeed||1)}return T}static FromMesh(n,k,T){k||(k=n.name);const c=new Y(k,T,n.va());return c.setPositions(n.getVerticesData(x.f.PositionKind)),n.isVerticesDataPresent(x.f.NormalKind)&&c.setNormals(n.getVerticesData(x.f.NormalKind)),n.isVerticesDataPresent(x.f.TangentKind)&&c.setTangents(n.getVerticesData(x.f.TangentKind)),n.isVerticesDataPresent(x.f.UVKind)&&c.setUVs(n.getVerticesData(x.f.UVKind)),n.isVerticesDataPresent(x.f.UV2Kind)&&c.setUV2s(n.getVerticesData(x.f.UV2Kind)),n.isVerticesDataPresent(x.f.ColorKind)&&c.setColors(n.getVerticesData(x.f.ColorKind)),c}}(0,r.e)([(0,q.K)()],Y.prototype,"id",void 0);var Z=T(727),e=T(12646);class d{set areUpdatesFrozen(n){n?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Z.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,n||(n=H.e.LastCreatedScene),this._scene=n,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const n=this._scene.getEngine().getCaps();this._canUseTextureForTargets=n.canUseGLVertexID&&n.textureFloat&&n.maxVertexTextureImageUnits>0&&n.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return d.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?d.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(n){this._numMaxInfluencers!==n&&(this._numMaxInfluencers=n,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(n){this._useTextureToStoreTargets!==n&&(this._useTextureToStoreTargets=n,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var n;return d.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(n=this._scene)&&void 0!==n&&n.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(n){return this._activeTargets.data[n]}getTarget(n){return this._targets[n]}getTargetByName(n){for(const k of this._targets)if(k.name===n)return k;return null}addTarget(n){this._targets.push(n),this._targetInfluenceChangedObservers.push(n.onInfluenceChanged.add((n=>{this.areUpdatesFrozen&&n&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(n)}))),this._targetDataLayoutChangedObservers.push(n._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(n){const k=this._targets.indexOf(n);k>=0&&(this._targets.splice(k,1),n.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(k,1)[0]),n._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(k,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(n)}_bind(n){n.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),n.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),n.setTexture("morphTargets",this._targetStoreTexture),n.setInt("morphTargetCount",this.numInfluencers)}clone(){const n=new d(this._scene);for(const k of this._targets)n.addTarget(k.clone());return n.enablePositionMorphing=this.enablePositionMorphing,n.enableNormalMorphing=this.enableNormalMorphing,n.enableTangentMorphing=this.enableTangentMorphing,n.enableUVMorphing=this.enableUVMorphing,n.enableUV2Morphing=this.enableUV2Morphing,n.enableColorMorphing=this.enableColorMorphing,n}serialize(){const n={};n.id=this.uniqueId,n.targets=[];for(const k of this._targets)n.targets.push(k.serialize());return n}_syncActiveTargets(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const k=!!this._targetStoreTexture,T=this.isUsingTextureForTargets;(this._mustSynchronize||k!==T)&&(this._mustSynchronize=!1,this.synchronize());let c=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let K=-1;for(const Q of this._targets)if(K++,0!==Q.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=d.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Q),this._morphTargetTextureIndices[c]=K,this._tempInfluences[c++]=Q.influence}this._morphTargetTextureIndices.length!==c&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,c)),this._influences&&this._influences.length===c||(this._influences=new Float32Array(c));for(let Q=0;Q<c;Q++)this._influences[Q]=this._tempInfluences[Q];if(n&&this._scene)for(const Q of this._scene.meshes)Q.morphTargetManager===this&&(T?Q._markSubMeshesAsAttributesDirty():Q._syncGeometryWithMorphTargetManager())}synchronize(){var n;if(!this._scene||this.areUpdatesFrozen)return;const k=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(n=this._targetStoreTexture)||void 0===n||n.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>k.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const T of this._targets){this._supportsPositions=this._supportsPositions&&T.hasPositions,this._supportsNormals=this._supportsNormals&&T.hasNormals,this._supportsTangents=this._supportsTangents&&T.hasTangents,this._supportsUVs=this._supportsUVs&&T.hasUVs,this._supportsUV2s=this._supportsUV2s&&T.hasUV2s,this._supportsColors=this._supportsColors&&T.hasColors;const n=T.vertexCount;if(0===this._vertexCount)this._vertexCount=n;else if(this._vertexCount!==n)return void s.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${T.name}": ${n}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const n=k.getCaps().maxTextureSize;this._textureWidth>n&&(this._textureHeight=Math.ceil(this._textureWidth/n),this._textureWidth=n);const T=this._targets.length,c=new Float32Array(T*this._textureWidth*this._textureHeight*4);let K=0;for(let k=0;k<T;k++){const n=this._targets[k],T=n.getPositions(),Q=n.getNormals(),G=n.getUVs(),w=n.getTangents(),E=n.getUV2s(),I=n.getColors();K=k*this._textureWidth*this._textureHeight*4;for(let k=0;k<this._vertexCount;k++)this._supportsPositions&&T&&(c[K]=T[3*k],c[K+1]=T[3*k+1],c[K+2]=T[3*k+2],K+=4),this._supportsNormals&&Q&&(c[K]=Q[3*k],c[K+1]=Q[3*k+1],c[K+2]=Q[3*k+2],K+=4),this._supportsUVs&&G&&(c[K]=G[2*k],c[K+1]=G[2*k+1],K+=4),this._supportsTangents&&w&&(c[K]=w[3*k],c[K+1]=w[3*k+1],c[K+2]=w[3*k+2],K+=4),this._supportsUV2s&&E&&(c[K]=E[2*k],c[K+1]=E[2*k+1],K+=4),this._supportsColors&&I&&(c[K]=I[4*k],c[K+1]=I[4*k+1],c[K+2]=I[4*k+2],c[K+3]=I[4*k+3],K+=4)}this._targetStoreTexture=e.d.CreateRGBATexture(c,this._textureWidth,this._textureHeight,T,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const T of this._scene.meshes)T.morphTargetManager===this&&T._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const n=this._parentContainer.morphTargetManagers.indexOf(this);n>-1&&this._parentContainer.morphTargetManagers.splice(n,1),this._parentContainer=null}for(const n of this._targets)this._scene.stopAnimation(n)}}static Parse(n,k){const T=new d(k);for(const c of n.targets)T.addTarget(Y.Parse(c,k));return T}}d.EnableTextureStorage=!0,d.MaxActiveMorphTargetsInVertexAttributeMode=8,d.ConstantTargetCountForTextureMode=0;var l=T(12737),i=T(591),B=T(820);const t=new Map,M=t;function o(n,k,T){D(n)&&s.d.Warn(`Extension with the name '${n}' already exists`),t.set(n,{isGLTFExtension:k,factory:T})}function D(n){return t.delete(n)}var R=T(12763);function L(){const n=n=>!!n&&"object"===typeof n;for(var k=arguments.length,T=new Array(k),c=0;c<k;c++)T[c]=arguments[c];return T.reduce(((k,T)=>{const c=Object.keys(T);for(const K of c){const c=k[K],Q=T[K];Array.isArray(c)&&Array.isArray(Q)?k[K]=c.concat(...Q):n(c)&&n(Q)?k[K]=L(c,Q):k[K]=Q}return k}),{})}var h=T(794);class j{static Get(n,k,T){if(!k||void 0==T||!k[T])throw new Error(`${n}: Failed to find index (${T})`);return k[T]}static TryGet(n,k){return n&&void 0!=k&&n[k]?n[k]:null}static Assign(n){if(n)for(let k=0;k<n.length;k++)n[k].index=k}}function p(n){if(n.min&&n.max){const k=n.min,T=n.max,c=K.l.li[0].di(k[0],k[1],k[2]),Q=K.l.li[1].di(T[0],T[1],T[2]);if(n.normalized&&5126!==n.componentType){let k=1;switch(n.componentType){case 5120:k=127;break;case 5121:k=255;break;case 5122:k=32767;break;case 5123:k=65535}const T=1/k;c.scaleInPlace(T),Q.scaleInPlace(T)}return new B.c(c,Q)}return null}class a{static RegisterExtension(n,k){o(n,!1,k)}static UnregisterExtension(n){return D(n)}get Di(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(n){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=n}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((n=>n.dispose&&n.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(n,k,T,c,K,Q){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=k,this._assetContainer=T,this._loadData(c);let Q=null;if(n){const k={};if(this._gltf.nodes)for(const n of this._gltf.nodes)n.name&&(k[n.name]=n.index);Q=(n instanceof Array?n:[n]).map((n=>{const T=k[n];if(void 0===T)throw new Error(`Failed to find node '${n}'`);return T}))}return await this._loadAsync(K,G,Q,(()=>({meshes:this._getMeshes(),oi:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(n,k,T,c){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=n,this._loadData(k),await this._loadAsync(T,K,null,(()=>{}))}async _loadAsync(n,k,T,c){return await Promise.resolve().then((async()=>{this._rootUrl=n,this._uniqueRootUrl=!n.startsWith("file:")&&k?n:`${n}${Date.now()}/`,this._fileName=k,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const K=`${l.m[l.m.LOADING]} => ${l.m[l.m.READY]}`,Q=`${l.m[l.m.LOADING]} => ${l.m[l.m.COMPLETE]}`;this._parent._startPerformanceCounter(K),this._parent._startPerformanceCounter(Q),this._parent._setState(l.m.LOADING),this._extensionsOnLoading();const w=new Array;if(!this.parent.loadOnlyMaterials)if(T)w.push(this.loadSceneAsync("/nodes",{nodes:T,index:-1}));else if(void 0!=this._gltf.me||this._gltf.scenes&&this._gltf.scenes[0]){const n=j.Get("/scene",this._gltf.scenes,this._gltf.me||0);w.push(this.loadSceneAsync(`/scenes/${n.index}`,n))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let n=0;n<this._gltf.materials.length;++n){const k=this._gltf.materials[n],T="/materials/"+n,c=z.d.TriangleFillMode;w.push(this._loadMaterialAsync(T,k,null,c,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&w.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&w.push(this._compileShadowGeneratorsAsync());const E=Promise.all(w).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh._h(!0);for(const n of this._babylonScene.materials){const k=n;void 0!==k.maxSimultaneousLights&&(k.maxSimultaneousLights=Math.max(k.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(l.m.READY),this._skipStartAnimationStep||this._startAnimations(),c()}));return await E.then((n=>(this._parent._endPerformanceCounter(K),G.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Q),this._parent._setState(l.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(n=>{this._parent.onErrorObservable.notifyObservers(n),this._parent.onErrorObservable.clear(),this.dispose()}))})),n)))})).catch((n=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(n),this._parent.onErrorObservable.clear(),this.dispose()),n}))}_loadData(n){if(this._gltf=n.json,this._setupData(),n.bin){const k=this._gltf.buffers;if(k&&k[0]&&!k[0].uri){const T=k[0];(T.byteLength<n.bin.byteLength-3||T.byteLength>n.bin.byteLength)&&s.d.Warn(`Binary buffer length (${T.byteLength}) from JSON does not match chunk length (${n.bin.byteLength})`),this._bin=n.bin}else s.d.Warn("Unexpected BIN chunk")}}_setupData(){if(j.Assign(this._gltf.accessors),j.Assign(this._gltf.animations),j.Assign(this._gltf.buffers),j.Assign(this._gltf.bufferViews),j.Assign(this._gltf.cameras),j.Assign(this._gltf.images),j.Assign(this._gltf.materials),j.Assign(this._gltf.meshes),j.Assign(this._gltf.nodes),j.Assign(this._gltf.samplers),j.Assign(this._gltf.scenes),j.Assign(this._gltf.skins),j.Assign(this._gltf.textures),this._gltf.nodes){const n={};for(const T of this._gltf.nodes)if(T.children)for(const k of T.children)n[k]=T.index;const k=this._createRootNode();for(const T of this._gltf.nodes){const c=n[T.index];T.parent=void 0===c?k:this._gltf.nodes[c]}}}async _loadExtensionsAsync(){const n=[];if(M.forEach(((k,T)=>{var c;!1===(null===(c=this.parent.extensionOptions[T])||void 0===c?void 0:c.enabled)?k.isGLTFExtension&&this.isExtensionUsed(T)&&s.d.Warn(`Extension ${T} is used but has been explicitly disabled.`):k.isGLTFExtension&&!this.isExtensionUsed(T)||n.push((async()=>{const n=await k.factory(this);return n.name!==T&&s.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${n.name} !== ${T}`),this._parent.onExtensionLoadedObservable.notifyObservers(n),n})())})),this._extensions.push(...await Promise.all(n)),this._extensions.sort(((n,k)=>(n.order||Number.MAX_VALUE)-(k.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const T of this._gltf.extensionsRequired){if(!this._extensions.some((n=>n.name===T&&n.enabled))){var k;if(!1===(null===(k=this.parent.extensionOptions[T])||void 0===k?void 0:k.enabled))throw new Error(`Required extension ${T} is disabled`);throw new Error(`Required extension ${T} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new V.b("__root__",this._babylonScene);this._rootBabylonMesh=n,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh._h(!1);const k={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case l.k.AUTO:this._babylonScene.useRightHandedSystem||(k.rotation=[0,1,0,0],k.scale=[1,1,-1],a._LoadTransform(k,this._rootBabylonMesh));break;case l.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(n),k}loadSceneAsync(n,k){const T=this._extensionsLoadSceneAsync(n,k);if(T)return T;const c=new Array;if(this.logOpen(`${n} ${k.name||""}`),k.nodes)for(const K of k.nodes){const k=j.Get(`${n}/nodes/${K}`,this._gltf.nodes,K);c.push(this.loadNodeAsync(`/nodes/${k.index}`,k,(n=>{n.parent=this._rootBabylonMesh})))}for(const K of this._postSceneLoadActions)K();return c.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(c).then((()=>{}))}_forEachPrimitive(n,k){if(n._primitiveBabylonMeshes)for(const T of n._primitiveBabylonMeshes)k(T)}_getGeometries(){const n=[],k=this._gltf.nodes;if(k)for(const T of k)this._forEachPrimitive(T,(k=>{const T=k.mi;T&&-1===n.indexOf(T)&&n.push(T)}));return n}_getMeshes(){const n=[];this._rootBabylonMesh instanceof U.e&&n.push(this._rootBabylonMesh);const k=this._gltf.nodes;if(k)for(const T of k)this._forEachPrimitive(T,(k=>{n.push(k)}));return n}_getTransformNodes(){const n=[],k=this._gltf.nodes;if(k)for(const T of k)T._babylonTransformNode&&"Zi"===T._babylonTransformNode.getClassName()&&n.push(T._babylonTransformNode),T._babylonTransformNodeForSkin&&n.push(T._babylonTransformNodeForSkin);return n}_getSkeletons(){const n=[],k=this._gltf.skins;if(k)for(const T of k)T._data&&n.push(T._data.babylonSkeleton);return n}_getAnimationGroups(){const n=[],k=this._gltf.animations;if(k)for(const T of k)T._babylonAnimationGroup&&n.push(T._babylonAnimationGroup);return n}_startAnimations(){switch(this._parent.animationStartMode){case l.i.NONE:break;case l.i.FIRST:{const n=this._getAnimationGroups();0!==n.length&&n[0].start(!0);break}case l.i.ALL:{const n=this._getAnimationGroups();for(const k of n)k.start(!0);break}default:return void s.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadNodeAsync(n,k,T);if(c)return c;if(k._babylonTransformNode)throw new Error(`${n}: Invalid recursive node hierarchy`);const K=new Array;this.logOpen(`${n} ${k.name||""}`);const Q=c=>{if(a.AddPointerMetadata(c,n),a._LoadTransform(k,c),void 0!=k.camera){const T=j.Get(`${n}/camera`,this._gltf.cameras,k.camera);K.push(this.loadCameraAsync(`/cameras/${T.index}`,T,(n=>{n.parent=c,this._babylonScene.useRightHandedSystem||(c.ei.x=-1)})))}if(k.children)for(const T of k.children){const k=j.Get(`${n}/children/${T}`,this._gltf.nodes,T);K.push(this.loadNodeAsync(`/nodes/${k.index}`,k,(n=>{n.parent=c})))}T(c)},G=void 0!=k.mesh,w=this._parent.loadSkins&&void 0!=k.skin;if(!G||w){const n=k.name||`node${k.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new m.d(n,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==k.mesh?k._babylonTransformNode=T:k._babylonTransformNodeForSkin=T,Q(T)}if(G)if(w){const T=j.Get(`${n}/mesh`,this._gltf.meshes,k.mesh);K.push(this._loadMeshAsync(`/meshes/${T.index}`,k,T,(T=>{const c=k._babylonTransformNodeForSkin;T.metadata=L(c.metadata,T.metadata||{});const Q=j.Get(`${n}/skin`,this._gltf.skins,k.skin);K.push(this._loadSkinAsync(`/skins/${Q.index}`,k,Q,(n=>{this._forEachPrimitive(k,(k=>{k.skeleton=n})),this._postSceneLoadActions.push((()=>{if(void 0!=Q.skeleton){const n=j.Get(`/skins/${Q.index}/skeleton`,this._gltf.nodes,Q.skeleton).parent;k.index===n.index?T.parent=c.parent:T.parent=n._babylonTransformNode}else T.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:c,skinnedNode:T})}))})))})))}else{const T=j.Get(`${n}/mesh`,this._gltf.meshes,k.mesh);K.push(this._loadMeshAsync(`/meshes/${T.index}`,k,T,Q))}return this.logClose(),Promise.all(K).then((()=>(this._forEachPrimitive(k,(n=>{const k=n;!k.isAnInstance&&k.mi&&k.mi.useBoundingInfoFromGeometry?n.Ea():n.refreshBoundingInfo(!0,!0)})),k._babylonTransformNode)))}_loadMeshAsync(n,k,T,c){const K=T.primitives;if(!K||!K.length)throw new Error(`${n}: Primitives are missing`);void 0==K[0].index&&j.Assign(K);const Q=new Array;this.logOpen(`${n} ${T.name||""}`);const G=k.name||`node${k.index}`;if(1===K.length){const c=T.primitives[0];Q.push(this._loadMeshPrimitiveAsync(`${n}/primitives/${c.index}`,G,k,T,c,(n=>{k._babylonTransformNode=n,k._primitiveBabylonMeshes=[n]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,k._babylonTransformNode=new m.d(G,this._babylonScene),k._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k._primitiveBabylonMeshes=[];for(const c of K)Q.push(this._loadMeshPrimitiveAsync(`${n}/primitives/${c.index}`,`${G}_primitive${c.index}`,k,T,c,(n=>{n.parent=k._babylonTransformNode,k._primitiveBabylonMeshes.push(n)})))}return c(k._babylonTransformNode),this.logClose(),Promise.all(Q).then((()=>k._babylonTransformNode))}_loadMeshPrimitiveAsync(n,k,T,c,K,Q){const G=this._extensionsLoadMeshPrimitiveAsync(n,k,T,c,K,Q);if(G)return G;this.logOpen(`${n}`);const w=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==T.skin&&!c.primitives[0].targets;let E,I;if(w&&K._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,E=K._instanceData.babylonSourceMesh.createInstance(k),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I=K._instanceData.promise;else{const Q=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new V.b(k,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.sideOrientation=this._babylonScene.useRightHandedSystem?z.d.CounterClockWiseSideOrientation:z.d.ClockWiseSideOrientation,this._createMorphTargets(n,T,c,K,G),Q.push(this._loadVertexDataAsync(n,K,G).then((async k=>await this._loadMorphTargetsAsync(n,K,G,k).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,k.Ca(G),k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const S=a._GetDrawMode(n,K.mode);if(void 0==K.material){let n=this._defaultBabylonMaterialData[S];n||(n=this._createDefaultMaterial("__GLTFLoader._default",S),this._parent.onMaterialLoadedObservable.notifyObservers(n),this._defaultBabylonMaterialData[S]=n),G.material=n}else if(!this.parent.skipMaterials){const k=j.Get(`${n}/material`,this._gltf.materials,K.material);Q.push(this._loadMaterialAsync(`/materials/${k.index}`,k,G,S,(n=>{G.material=n})))}I=Promise.all(Q),w&&(K._instanceData={babylonSourceMesh:G,promise:I}),E=G}return a.AddPointerMetadata(E,n),this._parent.onMeshLoadedObservable.notifyObservers(E),Q(E),this.logClose(),I.then((()=>E))}_loadVertexDataAsync(n,k,T){const c=this._extensionsLoadVertexDataAsync(n,k,T);if(c)return c;const K=k.attributes;if(!K)throw new Error(`${n}: Attributes are missing`);const Q=new Array,G=new g.d(T.name,this._babylonScene);if(void 0==k.indices)T.isUnIndexed=!0;else{const T=j.Get(`${n}/indices`,this._gltf.accessors,k.indices);Q.push(this._loadIndicesAccessorAsync(`/accessors/${T.index}`,T).then((n=>{G.setIndices(n)})))}const w=(k,c,w)=>{if(void 0==K[k])return;T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(c)&&T._delayInfo.push(c);const E=j.Get(`${n}/attributes/${k}`,this._gltf.accessors,K[k]);Q.push(this._loadVertexAccessorAsync(`/accessors/${E.index}`,E,c).then((n=>{if(n.getKind()===x.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!T.skeleton){const n=p(E);n&&(G._boundingInfo=n,G.useBoundingInfoFromGeometry=!0)}G.setVerticesBuffer(n,E.count)}))),c==x.f.MatricesIndicesExtraKind&&(T.numBoneInfluencers=8),w&&w(E)};return w("POSITION",x.f.PositionKind),w("NORMAL",x.f.NormalKind),w("TANGENT",x.f.TangentKind),w("TEXCOORD_0",x.f.UVKind),w("TEXCOORD_1",x.f.UV2Kind),w("TEXCOORD_2",x.f.UV3Kind),w("TEXCOORD_3",x.f.UV4Kind),w("TEXCOORD_4",x.f.UV5Kind),w("TEXCOORD_5",x.f.UV6Kind),w("JOINTS_0",x.f.MatricesIndicesKind),w("WEIGHTS_0",x.f.MatricesWeightsKind),w("JOINTS_1",x.f.MatricesIndicesExtraKind),w("WEIGHTS_1",x.f.MatricesWeightsExtraKind),w("COLOR_0",x.f.ColorKind,(n=>{"VEC4"===n.type&&(T.hasVertexAlpha=!0)})),Promise.all(Q).then((()=>G))}_createMorphTargets(n,k,T,c,K){if(!c.targets||!this._parent.loadMorphTargets)return;if(void 0==k._numMorphTargets)k._numMorphTargets=c.targets.length;else if(c.targets.length!==k._numMorphTargets)throw new Error(`${n}: Primitives do not have the same number of targets`);const Q=T.extras?T.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,K.morphTargetManager=new d(this._babylonScene),K.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K.morphTargetManager.areUpdatesFrozen=!0;for(let G=0;G<c.targets.length;G++){const n=k.weights?k.weights[G]:T.weights?T.weights[G]:0,c=Q?Q[G]:`morphTarget${G}`;K.morphTargetManager.addTarget(new Y(c,n,K.va()))}}_loadMorphTargetsAsync(n,k,T,c){if(!k.targets||!this._parent.loadMorphTargets)return Promise.resolve();const K=new Array,Q=T.morphTargetManager;for(let G=0;G<Q.numTargets;G++){const T=Q.getTarget(G);K.push(this._loadMorphTargetVertexDataAsync(`${n}/targets/${G}`,c,k.targets[G],T))}return Promise.all(K).then((()=>{Q.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(n,k,T,c){const K=new Array,Q=(c,Q,G)=>{if(void 0==T[c])return;const w=k.getVertexBuffer(Q);if(!w)return;const E=j.Get(`${n}/${c}`,this._gltf.accessors,T[c]);K.push(this._loadFloatAccessorAsync(`/accessors/${E.index}`,E).then((n=>{G(w,n)})))};return Q("POSITION",x.f.PositionKind,((n,k)=>{const T=new Float32Array(k.length);n.forEach(k.length,((n,c)=>{T[c]=k[c]+n})),c.setPositions(T)})),Q("NORMAL",x.f.NormalKind,((n,k)=>{const T=new Float32Array(k.length);n.forEach(T.length,((n,c)=>{T[c]=k[c]+n})),c.setNormals(T)})),Q("TANGENT",x.f.TangentKind,((n,k)=>{const T=new Float32Array(k.length/3*4);let K=0;n.forEach(k.length/3*4,((n,c)=>{(c+1)%4!==0&&(T[K]=k[K]+n,K++)})),c.setTangents(T)})),Q("TEXCOORD_0",x.f.UVKind,((n,k)=>{const T=new Float32Array(k.length);n.forEach(k.length,((n,c)=>{T[c]=k[c]+n})),c.setUVs(T)})),Q("TEXCOORD_1",x.f.UV2Kind,((n,k)=>{const T=new Float32Array(k.length);n.forEach(k.length,((n,c)=>{T[c]=k[c]+n})),c.setUV2s(T)})),Q("COLOR_0",x.f.ColorKind,((k,T)=>{let K=null;const Q=k.getSize();if(3===Q){K=new Float32Array(T.length/3*4),k.forEach(T.length,((n,k)=>{const c=Math.floor(k/3),Q=k%3;K[4*c+Q]=T[3*c+Q]+n}));for(let n=0;n<T.length/3;++n)K[4*n+3]=1}else{if(4!==Q)throw new Error(`${n}: Invalid number of components (${Q}) for COLOR_0 attribute`);K=new Float32Array(T.length),k.forEach(T.length,((n,k)=>{K[k]=T[k]+n}))}c.setColors(K)})),await Promise.all(K).then((()=>{}))}static _LoadTransform(n,k){if(void 0!=n.skin)return;let T=K.o.Zero(),c=K.h.Identity(),Q=K.o.One();if(n.matrix){K.d.ji(n.matrix).decompose(Q,c,T)}else n.translation&&(T=K.o.ji(n.translation)),n.rotation&&(c=K.h.ji(n.rotation)),n.scale&&(Q=K.o.ji(n.scale));k.position=T,k.rotationQuaternion=c,k.ei=Q}_loadSkinAsync(n,k,T,c){if(!this._parent.loadSkins)return Promise.resolve();const K=this._extensionsLoadSkinAsync(n,k,T);if(K)return K;if(T._data)return c(T._data.babylonSkeleton),T._data.promise;const Q=`skeleton${T.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new C(T.name||Q,Q,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(n,T,G);const w=this._loadSkinInverseBindMatricesDataAsync(n,T).then((n=>{this._updateBoneMatrices(G,n)}));return T._data={babylonSkeleton:G,promise:w},c(G),w}_loadBones(n,k,T){if(void 0==k.skeleton||this._parent.alwaysComputeSkeletonRootNode){const T=this._findSkeletonRootNode(`${n}/joints`,k.joints);if(T)if(void 0===k.skeleton)k.skeleton=T.index;else{const c=(n,k)=>{for(;k.parent;k=k.parent)if(k.parent===n)return!0;return!1},K=j.Get(`${n}/skeleton`,this._gltf.nodes,k.skeleton);K===T||c(K,T)||(s.d.Warn(`${n}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),k.skeleton=T.index)}else s.d.Warn(`${n}: Failed to find common root`)}const c={};for(const K of k.joints){const Q=j.Get(`${n}/joints/${K}`,this._gltf.nodes,K);this._loadBone(Q,k,T,c)}}_findSkeletonRootNode(n,k){if(0===k.length)return null;const T={};for(const K of k){const k=[];let c=j.Get(`${n}/${K}`,this._gltf.nodes,K);for(;-1!==c.index;)k.unshift(c),c=c.parent;T[K]=k}let c=null;for(let K=0;;++K){let n=T[k[0]];if(K>=n.length)return c;const Q=n[K];for(let G=1;G<k.length;++G)if(n=T[k[G]],K>=n.length||Q!==n[K])return c;c=Q}}_loadBone(n,k,T,c){n._isJoint=!0;let K=c[n.index];if(K)return K;let Q=null;n.index!==k.skeleton&&(n.parent&&-1!==n.parent.index?Q=this._loadBone(n.parent,k,T,c):void 0!==k.skeleton&&s.d.Warn(`/skins/${k.index}/skeleton: Skeleton node is not a common root`));const G=k.joints.indexOf(n.index);return K=new I.b(n.name||`joint${n.index}`,T,Q,this._getNodeMatrix(n),null,null,G),c[n.index]=K,this._postSceneLoadActions.push((()=>{K.linkTransformNode(n._babylonTransformNode)})),K}_loadSkinInverseBindMatricesDataAsync(n,k){if(void 0==k.inverseBindMatrices)return Promise.resolve(null);const T=j.Get(`${n}/inverseBindMatrices`,this._gltf.accessors,k.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${T.index}`,T)}_updateBoneMatrices(n,k){for(const T of n.bones){const n=K.d.Identity(),c=T._index;k&&-1!==c&&(K.d.FromArrayToRef(k,16*c,n),n.invertToRef(n));const Q=T.getParent();Q&&n.multiplyToRef(Q.getAbsoluteInverseBindMatrix(),n),T.Vi(n,!1,!1),T._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(n){return n.matrix?K.d.ji(n.matrix):K.d.Compose(n.scale?K.o.ji(n.scale):K.o.One(),n.rotation?K.h.ji(n.rotation):K.h.Identity(),n.translation?K.o.ji(n.translation):K.o.Zero())}loadCameraAsync(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadCameraAsync(n,k,T);if(c)return c;const Q=new Array;this.logOpen(`${n} ${k.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new E.e(k.name||`camera${k.index}`,K.o.Zero(),this._babylonScene,!1);switch(G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k._babylonCamera=G,G.setTarget(new K.o(0,0,-1)),k.type){case"perspective":{const T=k.perspective;if(!T)throw new Error(`${n}: Camera perspective properties are missing`);G.fov=T.yfov,G.ri=T.znear,G.maxZ=T.zfar||0;break}case"orthographic":if(!k.orthographic)throw new Error(`${n}: Camera orthographic properties are missing`);G.mode=w.c.ORTHOGRAPHIC_CAMERA,G.orthoLeft=-k.orthographic.xmag,G.orthoRight=k.orthographic.xmag,G.orthoBottom=-k.orthographic.ymag,G.orthoTop=k.orthographic.ymag,G.ri=k.orthographic.znear,G.maxZ=k.orthographic.zfar;break;default:throw new Error(`${n}: Invalid camera type (${k.type})`)}return a.AddPointerMetadata(G,n),this._parent.onCameraLoadedObservable.notifyObservers(G),T(G),this.logClose(),Promise.all(Q).then((()=>G))}_loadAnimationsAsync(){const n=this._gltf.animations;if(!n)return Promise.resolve();const k=new Array;for(let T=0;T<n.length;T++){const c=n[T];k.push(this.loadAnimationAsync(`/animations/${c.index}`,c).then((n=>{0===n.targetedAnimations.length&&n.dispose()})))}return Promise.all(k).then((()=>{}))}loadAnimationAsync(n,k){const c=this._extensionsLoadAnimationAsync(n,k);return c||T.e(49).then(T.bind(T,13915)).then((T=>{let{AnimationGroup:c}=T;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new c(k.name||`animation${k.index}`,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k._babylonAnimationGroup=K;const Q=new Array;j.Assign(k.channels),j.Assign(k.samplers);for(const G of k.channels)Q.push(this._loadAnimationChannelAsync(`${n}/channels/${G.index}`,n,k,G,((n,k)=>{n.animations=n.animations||[],n.animations.push(k),K.addTargetedAnimation(k,n)})));return Promise.all(Q).then((()=>(K.normalize(0),K)))}))}async _loadAnimationChannelAsync(n,k,c,K,Q){const G=this._extensionsLoadAnimationChannelAsync(n,k,c,K,Q);if(G)return await G;if(void 0==K.target.node)return await Promise.resolve();const w=j.Get(`${n}/target/node`,this._gltf.nodes,K.target.node),E=K.target.path,I="weights"===E;if(I&&!w._numMorphTargets||!I&&!w._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!I&&!w._isJoint)return await Promise.resolve();let S;switch(await Promise.resolve().then(T.bind(T,12788)),E){case"translation":var P;S=null===(P=(0,R.e)("/nodes/{}/translation"))||void 0===P?void 0:P.interpolation;break;case"rotation":var W;S=null===(W=(0,R.e)("/nodes/{}/rotation"))||void 0===W?void 0:W.interpolation;break;case"scale":var J;S=null===(J=(0,R.e)("/nodes/{}/scale"))||void 0===J?void 0:J.interpolation;break;case"weights":var H;S=null===(H=(0,R.e)("/nodes/{}/weights"))||void 0===H?void 0:H.interpolation;break;default:throw new Error(`${n}/target/path: Invalid value (${K.target.path})`)}if(!S)throw new Error(`${n}/target/path: Could not find interpolation properties for target path (${K.target.path})`);const s={object:w,info:S};return await this._loadAnimationChannelFromTargetInfoAsync(n,k,c,K,s,Q)}_loadAnimationChannelFromTargetInfoAsync(n,k,T,c,K,Q){const G=this.parent.targetFps,w=1/G,E=j.Get(`${n}/sampler`,T.samplers,c.sampler);return this._loadAnimationSamplerAsync(`${k}/samplers/${c.sampler}`,E).then((n=>{let k=0;const E=K.object,I=K.info;for(const K of I){const I=K.getStride(E),S=n.input,P=n.output,W=new Array(S.length);let J=0;switch(n.interpolation){case"STEP":for(let n=0;n<S.length;n++){const k=K.getValue(E,P,J,1);J+=I,W[n]={frame:S[n]*G,value:k,interpolation:1}}break;case"CUBICSPLINE":for(let n=0;n<S.length;n++){const k=K.getValue(E,P,J,w);J+=I;const T=K.getValue(E,P,J,1);J+=I;const c=K.getValue(E,P,J,w);J+=I,W[n]={frame:S[n]*G,inTangent:k,value:T,outTangent:c}}break;case"LINEAR":for(let n=0;n<S.length;n++){const k=K.getValue(E,P,J,1);J+=I,W[n]={frame:S[n]*G,value:k}}}if(J>0){const n=`${T.name||`animation${T.index}`}_channel${c.index}_${k}`,w=K.buildAnimations(E,n,G,W);for(const T of w)k++,Q(T.babylonAnimatable,T.babylonAnimation)}}}))}_loadAnimationSamplerAsync(n,k){if(k._data)return k._data;const T=k.interpolation||"LINEAR";switch(T){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${n}/interpolation: Invalid value (${k.interpolation})`)}const c=j.Get(`${n}/input`,this._gltf.accessors,k.input),K=j.Get(`${n}/output`,this._gltf.accessors,k.output);return k._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${c.index}`,c),this._loadFloatAccessorAsync(`/accessors/${K.index}`,K)]).then((n=>{let[k,c]=n;return{input:k,interpolation:T,output:c}})),k._data}loadBufferAsync(n,k,T,c){const K=this._extensionsLoadBufferAsync(n,k,T,c);if(K)return K;if(!k._data)if(k.uri)k._data=this.loadUriAsync(`${n}/uri`,k,k.uri);else{if(!this._bin)throw new Error(`${n}: Uri is missing or the binary glTF is missing its binary chunk`);k._data=this._bin.readAsync(0,k.byteLength)}return k._data.then((k=>{try{return new Uint8Array(k.buffer,k.byteOffset+T,c)}catch(K){throw new Error(`${n}: ${K.message}`)}}))}loadBufferViewAsync(n,k){const T=this._extensionsLoadBufferViewAsync(n,k);if(T)return T;if(k._data)return k._data;const c=j.Get(`${n}/buffer`,this._gltf.buffers,k.buffer);return k._data=this.loadBufferAsync(`/buffers/${c.index}`,c,k.byteOffset||0,k.byteLength),k._data}_loadAccessorAsync(n,k,T){if(k._data)return k._data;const c=a._GetNumComponents(n,k.type),K=c*x.f.GetTypeByteLength(k.componentType),Q=c*k.count;if(void 0==k.bufferView)k._data=Promise.resolve(new T(Q));else{const G=j.Get(`${n}/bufferView`,this._gltf.bufferViews,k.bufferView);k._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((w=>{if(5126!==k.componentType||k.normalized||G.byteStride&&G.byteStride!==K){const n=new T(Q);return x.f.ForEach(w,k.byteOffset||0,G.byteStride||K,c,k.componentType,n.length,k.normalized||!1,((k,T)=>{n[T]=k})),n}return a._GetTypedArray(n,k.componentType,w,k.byteOffset,Q)}))}if(k.sparse){const Q=k.sparse;k._data=k._data.then((G=>{const w=G,E=j.Get(`${n}/sparse/indices/bufferView`,this._gltf.bufferViews,Q.indices.bufferView),I=j.Get(`${n}/sparse/values/bufferView`,this._gltf.bufferViews,Q.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${E.index}`,E),this.loadBufferViewAsync(`/bufferViews/${I.index}`,I)]).then((G=>{let[E,I]=G;const S=a._GetTypedArray(`${n}/sparse/indices`,Q.indices.componentType,E,Q.indices.byteOffset,Q.count),P=c*Q.count;let W;if(5126!==k.componentType||k.normalized){const G=a._GetTypedArray(`${n}/sparse/values`,k.componentType,I,Q.values.byteOffset,P);W=new T(P),x.f.ForEach(G,0,K,c,k.componentType,W.length,k.normalized||!1,((n,k)=>{W[k]=n}))}else W=a._GetTypedArray(`${n}/sparse/values`,k.componentType,I,Q.values.byteOffset,P);let J=0;for(let n=0;n<S.length;n++){let k=S[n]*c;for(let n=0;n<c;n++)w[k++]=W[J++]}return w}))}))}return k._data}_loadFloatAccessorAsync(n,k){return this._loadAccessorAsync(n,k,Float32Array)}_loadIndicesAccessorAsync(n,k){if("SCALAR"!==k.type)throw new Error(`${n}/type: Invalid value ${k.type}`);if(5121!==k.componentType&&5123!==k.componentType&&5125!==k.componentType)throw new Error(`${n}/componentType: Invalid value ${k.componentType}`);if(k._data)return k._data;if(k.sparse){const T=a._GetTypedArrayConstructor(`${n}/componentType`,k.componentType);k._data=this._loadAccessorAsync(n,k,T)}else{const T=j.Get(`${n}/bufferView`,this._gltf.bufferViews,k.bufferView);k._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((T=>a._GetTypedArray(n,k.componentType,T,k.byteOffset,k.count)))}return k._data}_loadVertexBufferViewAsync(n){if(n._babylonBuffer)return n._babylonBuffer;const k=this._babylonScene.getEngine();return n._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>new x.b(k,n,!1))),n._babylonBuffer}_loadVertexAccessorAsync(n,k,T){var c;if(null!==(c=k._babylonVertexBuffer)&&void 0!==c&&c[T])return k._babylonVertexBuffer[T];k._babylonVertexBuffer||(k._babylonVertexBuffer={});const K=this._babylonScene.getEngine();if(k.sparse||void 0==k.bufferView)k._babylonVertexBuffer[T]=this._loadFloatAccessorAsync(n,k).then((n=>new x.f(K,n,T,!1)));else{const c=j.Get(`${n}/bufferView`,this._gltf.bufferViews,k.bufferView);k._babylonVertexBuffer[T]=this._loadVertexBufferViewAsync(c).then((Q=>{const G=a._GetNumComponents(n,k.type);return new x.f(K,Q,T,!1,void 0,c.byteStride,void 0,k.byteOffset,G,k.componentType,k.normalized,!0,void 0,!0)}))}return k._babylonVertexBuffer[T]}_loadMaterialMetallicRoughnessPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return k&&(k.baseColorFactor?(T.albedoColor=Q.e.ji(k.baseColorFactor),T.alpha=k.baseColorFactor[3]):T.albedoColor=Q.e.White(),T.metallic=void 0==k.metallicFactor?1:k.metallicFactor,T.roughness=void 0==k.roughnessFactor?1:k.roughnessFactor,k.baseColorTexture&&c.push(this.loadTextureInfoAsync(`${n}/baseColorTexture`,k.baseColorTexture,(n=>{n.name=`${T.name} (Base Color)`,T.albedoTexture=n}))),k.metallicRoughnessTexture&&(k.metallicRoughnessTexture.nonColorData=!0,c.push(this.loadTextureInfoAsync(`${n}/metallicRoughnessTexture`,k.metallicRoughnessTexture,(n=>{n.name=`${T.name} (Metallic Roughness)`,T.metallicTexture=n}))),T.useMetallnessFromMetallicTextureBlue=!0,T.useRoughnessFromMetallicTextureGreen=!0,T.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(c).then((()=>{}))}_loadMaterialAsync(n,k,T,c){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Q=this._extensionsLoadMaterialAsync(n,k,T,c,K);if(Q)return Q;k._data=k._data||{};let G=k._data[c];if(!G){this.logOpen(`${n} ${k.name||""}`);const T=this.createMaterial(n,k,c);G={babylonMaterial:T,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(n,k,T)},k._data[c]=G,a.AddPointerMetadata(T,n),this._parent.onMaterialLoadedObservable.notifyObservers(T),this.logClose()}return T&&(G.babylonMeshes.push(T),T.Gi.addOnce((()=>{const n=G.babylonMeshes.indexOf(T);-1!==n&&G.babylonMeshes.splice(n,1)}))),K(G.babylonMaterial),G.promise.then((()=>G.babylonMaterial))}_createDefaultMaterial(n,k){this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new v(n,this._babylonScene);return T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.fillMode=k,T.enableSpecularAntiAliasing=!0,T.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,T.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,T.transparencyMode=v.PBRMATERIAL_OPAQUE,T.metallic=1,T.roughness=1,T}createMaterial(n,k,T){const c=this._extensionsCreateMaterial(n,k,T);if(c)return c;const K=k.name||`material${k.index}`;return this._createDefaultMaterial(K,T)}loadMaterialPropertiesAsync(n,k,T){const c=this._extensionsLoadMaterialPropertiesAsync(n,k,T);if(c)return c;const K=new Array;return K.push(this.loadMaterialBasePropertiesAsync(n,k,T)),k.pbrMetallicRoughness&&K.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${n}/pbrMetallicRoughness`,k.pbrMetallicRoughness,T)),this.loadMaterialAlphaProperties(n,k,T),Promise.all(K).then((()=>{}))}loadMaterialBasePropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return T.emissiveColor=k.emissiveFactor?Q.e.ji(k.emissiveFactor):new Q.e(0,0,0),k.doubleSided&&(T.ui=!1,T.twoSidedLighting=!0),k.normalTexture&&(k.normalTexture.nonColorData=!0,c.push(this.loadTextureInfoAsync(`${n}/normalTexture`,k.normalTexture,(n=>{n.name=`${T.name} (Normal)`,T.bumpTexture=n}))),T.invertNormalMapX=!this._babylonScene.useRightHandedSystem,T.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=k.normalTexture.scale&&T.bumpTexture&&(T.bumpTexture.level=k.normalTexture.scale),T.forceIrradianceInFragment=!0),k.occlusionTexture&&(k.occlusionTexture.nonColorData=!0,c.push(this.loadTextureInfoAsync(`${n}/occlusionTexture`,k.occlusionTexture,(n=>{n.name=`${T.name} (Occlusion)`,T.ambientTexture=n}))),T.useAmbientInGrayScale=!0,void 0!=k.occlusionTexture.strength&&(T.ambientTextureStrength=k.occlusionTexture.strength)),k.emissiveTexture&&c.push(this.loadTextureInfoAsync(`${n}/emissiveTexture`,k.emissiveTexture,(n=>{n.name=`${T.name} (Emissive)`,T.emissiveTexture=n}))),Promise.all(c).then((()=>{}))}loadMaterialAlphaProperties(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);switch(k.alphaMode||"OPAQUE"){case"OPAQUE":T.transparencyMode=v.PBRMATERIAL_OPAQUE,T.alpha=1;break;case"MASK":T.transparencyMode=v.PBRMATERIAL_ALPHATEST,T.alphaCutOff=void 0==k.alphaCutoff?.5:k.alphaCutoff,T.albedoTexture&&(T.albedoTexture.Bj=!0);break;case"BLEND":T.transparencyMode=v.PBRMATERIAL_ALPHABLEND,T.albedoTexture&&(T.albedoTexture.Bj=!0,T.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${n}/alphaMode: Invalid value (${k.alphaMode})`)}}loadTextureInfoAsync(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadTextureInfoAsync(n,k,T);if(c)return c;if(this.logOpen(`${n}`),k.texCoord>=6)throw new Error(`${n}/texCoord: Invalid value (${k.texCoord})`);const K=j.Get(`${n}/index`,this._gltf.textures,k.index);K._textureInfo=k;const Q=this._loadTextureAsync(`/textures/${k.index}`,K,(c=>{c.coordinatesIndex=k.texCoord||0,a.AddPointerMetadata(c,n),this._parent.onTextureLoadedObservable.notifyObservers(c),T(c)}));return this.logClose(),Q}_loadTextureAsync(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const c=this._extensionsLoadTextureAsync(n,k,T);if(c)return c;this.logOpen(`${n} ${k.name||""}`);const K=void 0==k.sampler?a.DefaultSampler:j.Get(`${n}/sampler`,this._gltf.samplers,k.sampler),Q=j.Get(`${n}/source`,this._gltf.images,k.source),G=this._createTextureAsync(n,K,Q,T,void 0,!k._textureInfo.nonColorData);return this.logClose(),G}_createTextureAsync(n,k,T){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},Q=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;const w=this._loadSampler(`/samplers/${k.index}`,k),E=new Array,I=new c;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S={noMipmap:w.noMipMaps,invertY:!1,samplingMode:w.samplingMode,X:()=>{this._disposed||I.resolve()},onError:(k,T)=>{this._disposed||I.reject(new Error(`${n}: ${T&&T.message?T.message:k||"Failed to load texture"}`))},mimeType:T.mimeType??(0,i.h)(T.uri??""),loaderOptions:Q,useSRGBBuffer:!!G&&this._parent.useSRGBBuffers},P=new F.b(null,this._babylonScene,S);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.push(I.promise),E.push(this.loadImageAsync(`/images/${T.index}`,T).then((n=>{const k=T.uri||`${this._fileName}#image${T.index}`,c=`data:${this._uniqueRootUrl}${k}`;P.updateURL(c,n);const K=P.getInternalTexture();K&&(K.label=T.name)}))),P.wrapU=w.wrapU,P.wrapV=w.wrapV,K(P),this._parent.useGltfTextureNames&&(P.name=T.name||T.uri||`image${T.index}`),Promise.all(E).then((()=>P))}_loadSampler(n,k){return k._data||(k._data={noMipMaps:9728===k.minFilter||9729===k.minFilter,samplingMode:a._GetTextureSamplingMode(n,k),wrapU:a._GetTextureWrapMode(`${n}/wrapS`,k.wrapS),wrapV:a._GetTextureWrapMode(`${n}/wrapT`,k.wrapT)}),k._data}loadImageAsync(n,k){if(!k._data){if(this.logOpen(`${n} ${k.name||""}`),k.uri)k._data=this.loadUriAsync(`${n}/uri`,k,k.uri);else{const T=j.Get(`${n}/bufferView`,this._gltf.bufferViews,k.bufferView);k._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}this.logClose()}return k._data}loadUriAsync(n,k,T){const c=this._extensionsLoadUriAsync(n,k,T);if(c)return c;if(!a._ValidateUri(T))throw new Error(`${n}: '${T}' is invalid`);if((0,i.i)(T)){const k=new Uint8Array((0,i.d)(T));return this.log(`${n}: Decoded ${T.substring(0,64)}... (${k.length} bytes)`),Promise.resolve(k)}return this.log(`${n}: Loading ${T}`),this._parent.preprocessUrlAsync(this._rootUrl+T).then((k=>new Promise(((c,K)=>{this._parent._loadFile(this._babylonScene,k,(k=>{this._disposed||(this.log(`${n}: Loaded ${T} (${k.byteLength} bytes)`),c(new Uint8Array(k)))}),!0,(k=>{K(new i.j(`${n}: Failed to load '${T}'${k?": "+k.status+" "+k.statusText:""}`,k))}))}))))}static AddPointerMetadata(n,k){n.metadata=n.metadata||{};const T=n._internalMetadata=n._internalMetadata||{},c=T.Di=T.Di||{};(c.pointers=c.pointers||[]).push(k)}static _GetTextureWrapMode(n,k){switch(k=void 0==k?10497:k){case 33071:return F.b.CLAMP_ADDRESSMODE;case 33648:return F.b.MIRROR_ADDRESSMODE;case 10497:return F.b.WRAP_ADDRESSMODE;default:return s.d.Warn(`${n}: Invalid value (${k})`),F.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(n,k){const T=void 0==k.magFilter?9729:k.magFilter,c=void 0==k.minFilter?9987:k.minFilter;if(9729===T)switch(c){case 9728:return F.b.LINEAR_NEAREST;case 9729:return F.b.LINEAR_LINEAR;case 9984:return F.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return F.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return F.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return F.b.LINEAR_LINEAR_MIPLINEAR;default:return s.d.Warn(`${n}/minFilter: Invalid value (${c})`),F.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==T&&s.d.Warn(`${n}/magFilter: Invalid value (${T})`),c){case 9728:return F.b.NEAREST_NEAREST;case 9729:return F.b.NEAREST_LINEAR;case 9984:return F.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return F.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return F.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return F.b.NEAREST_LINEAR_MIPLINEAR;default:return s.d.Warn(`${n}/minFilter: Invalid value (${c})`),F.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(n,k){try{return(0,h.j)(k)}catch(T){throw new Error(`${n}: ${T.message}`)}}static _GetTypedArray(n,k,T,c,K){const Q=T.buffer;c=T.byteOffset+(c||0);const G=a._GetTypedArrayConstructor(`${n}/componentType`,k),w=x.f.GetTypeByteLength(k);return c%w!==0?(s.d.Warn(`${n}: Copying buffer as byte offset (${c}) is not a multiple of component type byte length (${w})`),new G(Q.slice(c,c+K*w),0)):new G(Q,c,K)}static _GetNumComponents(n,k){switch(k){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${n}: Invalid type (${k})`)}static _ValidateUri(n){return G.e.IsBase64(n)||-1===n.indexOf("..")}static _GetDrawMode(n,k){switch(void 0==k&&(k=4),k){case 0:return z.d.PointListDrawMode;case 1:return z.d.LineListDrawMode;case 2:return z.d.LineLoopDrawMode;case 3:return z.d.LineStripDrawMode;case 4:return z.d.TriangleFillMode;case 5:return z.d.TriangleStripDrawMode;case 6:return z.d.TriangleFanDrawMode}throw new Error(`${n}: Invalid mesh primitive mode (${k})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const n=new Array;if(this._gltf.materials)for(const k of this._gltf.materials)if(k._data)for(const T in k._data){const c=k._data[T];for(const k of c.babylonMeshes){k.pi(!0);const T=c.babylonMaterial;n.push(T.forceCompilationAsync(k)),n.push(T.forceCompilationAsync(k,{useInstances:!0})),this._parent.useClipPlane&&(n.push(T.forceCompilationAsync(k,{clipPlane:!0})),n.push(T.forceCompilationAsync(k,{clipPlane:!0,useInstances:!0})))}}return Promise.all(n).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const n=new Array,k=this._babylonScene.lights;for(const T of k){const k=T.getShadowGenerator();k&&n.push(k.forceCompilationAsync())}return Promise.all(n).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(n){for(const k of this._extensions)k.enabled&&n(k)}_applyExtensions(n,k,T){for(const c of this._extensions)if(c.enabled){const K=`${c.name}.${k}`,Q=n;Q._activeLoaderExtensionFunctions=Q._activeLoaderExtensionFunctions||{};const G=Q._activeLoaderExtensionFunctions;if(!G[K]){G[K]=!0;try{const n=T(c);if(n)return n}finally{delete G[K]}}}return null}_extensionsOnLoading(){this._forEachExtensions((n=>n.onLoading&&n.onLoading()))}_extensionsOnReady(){this._forEachExtensions((n=>n.onReady&&n.onReady()))}_extensionsLoadSceneAsync(n,k){return this._applyExtensions(k,"loadScene",(T=>T.loadSceneAsync&&T.loadSceneAsync(n,k)))}_extensionsLoadNodeAsync(n,k,T){return this._applyExtensions(k,"loadNode",(c=>c.loadNodeAsync&&c.loadNodeAsync(n,k,T)))}_extensionsLoadCameraAsync(n,k,T){return this._applyExtensions(k,"loadCamera",(c=>c.loadCameraAsync&&c.loadCameraAsync(n,k,T)))}_extensionsLoadVertexDataAsync(n,k,T){return this._applyExtensions(k,"loadVertexData",(c=>c._loadVertexDataAsync&&c._loadVertexDataAsync(n,k,T)))}_extensionsLoadMeshPrimitiveAsync(n,k,T,c,K,Q){return this._applyExtensions(K,"loadMeshPrimitive",(G=>G._loadMeshPrimitiveAsync&&G._loadMeshPrimitiveAsync(n,k,T,c,K,Q)))}_extensionsLoadMaterialAsync(n,k,T,c,K){return this._applyExtensions(k,"loadMaterial",(Q=>Q._loadMaterialAsync&&Q._loadMaterialAsync(n,k,T,c,K)))}_extensionsCreateMaterial(n,k,T){return this._applyExtensions(k,"createMaterial",(c=>c.createMaterial&&c.createMaterial(n,k,T)))}_extensionsLoadMaterialPropertiesAsync(n,k,T){return this._applyExtensions(k,"loadMaterialProperties",(c=>c.loadMaterialPropertiesAsync&&c.loadMaterialPropertiesAsync(n,k,T)))}_extensionsLoadTextureInfoAsync(n,k,T){return this._applyExtensions(k,"loadTextureInfo",(c=>c.loadTextureInfoAsync&&c.loadTextureInfoAsync(n,k,T)))}_extensionsLoadTextureAsync(n,k,T){return this._applyExtensions(k,"loadTexture",(c=>c._loadTextureAsync&&c._loadTextureAsync(n,k,T)))}_extensionsLoadAnimationAsync(n,k){return this._applyExtensions(k,"loadAnimation",(T=>T.loadAnimationAsync&&T.loadAnimationAsync(n,k)))}_extensionsLoadAnimationChannelAsync(n,k,T,c,K){return this._applyExtensions(T,"loadAnimationChannel",(Q=>Q._loadAnimationChannelAsync&&Q._loadAnimationChannelAsync(n,k,T,c,K)))}_extensionsLoadSkinAsync(n,k,T){return this._applyExtensions(T,"loadSkin",(c=>c._loadSkinAsync&&c._loadSkinAsync(n,k,T)))}_extensionsLoadUriAsync(n,k,T){return this._applyExtensions(k,"loadUri",(c=>c._loadUriAsync&&c._loadUriAsync(n,k,T)))}_extensionsLoadBufferViewAsync(n,k){return this._applyExtensions(k,"loadBufferView",(T=>T.loadBufferViewAsync&&T.loadBufferViewAsync(n,k)))}_extensionsLoadBufferAsync(n,k,T,c){return this._applyExtensions(k,"loadBuffer",(K=>K.loadBufferAsync&&K.loadBufferAsync(n,k,T,c)))}static LoadExtensionAsync(n,k,T,c){if(!k.extensions)return null;const K=k.extensions[T];return K?c(`${n}/extensions/${T}`,K):null}static LoadExtraAsync(n,k,T,c){if(!k.extras)return null;const K=k.extras[T];return K?c(`${n}/extras/${T}`,K):null}isExtensionUsed(n){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(n)}logOpen(n){this._parent._logOpen(n)}logClose(){this._parent._logClose()}log(n){this._parent._log(n)}startPerformanceCounter(n){this._parent._startPerformanceCounter(n)}endPerformanceCounter(n){this._parent._endPerformanceCounter(n)}}a.DefaultSampler={index:-1},l.e._CreateGLTF2Loader=n=>new a(n);var X=T(12788),y=T(2294),N=T(2468),nn=T(12793);class kn extends nn.c{constructor(n,k,T){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",n),this._texture=n.getEngine().createRawCubeTexture(k,T,c,K,Q,G,w,E)}update(n,k,T,c){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,n,k,T,c,K)}updateRGBDAsync(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,N.h)(this._texture,n,k,T,c).then((()=>{}))}clone(){return A.d.Clone((()=>{const n=this.va(),k=this._texture,T=new kn(n,k._bufferViewArray,k.width,k.format,k.type,k.generateMipMaps,k.invertY,k.samplingMode,k._compression);return 13===k.source&&T.updateRGBDAsync(k._bufferViewArrayArray,k._sphericalPolynomial,k._lodGenerationScale,k._lodGenerationOffset),T}),this)}}const Tn="EXT_lights_image_based";class cn{constructor(n){this.name=Tn,this._loader=n,this.enabled=this._loader.isExtensionUsed(Tn)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.Di.extensions;if(n&&n[this.name]){const k=n[this.name];this._lights=k.lights}}loadSceneAsync(n,k){return a.LoadExtensionAsync(n,k,this.name,(async(T,c)=>{this._loader._allMaterialsDirtyRequired=!0;const K=new Array;K.push(this._loader.loadSceneAsync(n,k)),this._loader.logOpen(`${T}`);const Q=j.Get(`${T}/light`,this._lights,c.bb);return K.push(this._loadLightAsync(`/extensions/${this.name}/lights/${c.bb}`,Q).then((n=>{this._loader.babylonScene.environmentTexture=n}))),this._loader.logClose(),await Promise.all(K).then((()=>{}))}))}_loadLightAsync(n,k){if(!k._loaded){const T=new Array;this._loader.logOpen(`${n}`);const c=new Array(k.specularImages.length);for(let K=0;K<k.specularImages.length;K++){const Q=k.specularImages[K];c[K]=new Array(Q.length);for(let k=0;k<Q.length;k++){const G=`${n}/specularImages/${K}/${k}`;this._loader.logOpen(`${G}`);const w=Q[k],E=j.Get(G,this._loader.Di.images,w);T.push(this._loader.loadImageAsync(`/images/${w}`,E).then((n=>{c[K][k]=n}))),this._loader.logClose()}}this._loader.logClose(),k._loaded=Promise.all(T).then((async()=>{const T=new kn(this._loader.babylonScene,null,k.specularImageSize);if(T.name=k.name||"environment",k._babylonTexture=T,void 0!=k.Bl&&(T.level=k.Bl),k.rotation){let n=K.h.ji(k.rotation);this._loader.babylonScene.useRightHandedSystem||(n=K.h.Inverse(n)),K.d.FromQuaternionToRef(n,T.getReflectionTextureMatrix())}if(!k.irradianceCoefficients)throw new Error(`${n}: Irradiance coefficients are missing`);const Q=y.b.ji(k.irradianceCoefficients);Q.scaleInPlace(k.Bl),Q.convertIrradianceToLambertianRadiance();const G=y.d.FromHarmonics(Q),w=(c.length-1)/Math.log2(k.specularImageSize);return await T.updateRGBDAsync(c,G,w)}))}return k._loaded.then((()=>k._babylonTexture))}}D(Tn),o(Tn,!0,(n=>new cn(n)));T(528);const Kn="EXT_mesh_gpu_instancing";class Qn{constructor(n){this.name=Kn,this._loader=n,this.enabled=this._loader.isExtensionUsed(Kn)}dispose(){this._loader=null}loadNodeAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(n,c)=>{this._loader._disableInstancedMesh++;const Q=this._loader.loadNodeAsync(`/nodes/${k.index}`,k,T);if(this._loader._disableInstancedMesh--,!k._primitiveBabylonMeshes)return await Q;const G=new Array;let w=0;const E=k=>{if(void 0==c.attributes[k])return void G.push(Promise.resolve(null));const T=j.Get(`${n}/attributes/${k}`,this._loader.Di.accessors,c.attributes[k]);if(G.push(this._loader._loadFloatAccessorAsync(`/accessors/${T.bufferView}`,T)),0===w)w=T.count;else if(w!==T.count)throw new Error(`${n}/attributes: Instance buffer accessors do not have the same count.`)};return E("TRANSLATION"),E("ROTATION"),E("SCALE"),await Q.then((async n=>{const[T,c,Q]=await Promise.all(G),E=new Float32Array(16*w);K.l.li[0].di(0,0,0),K.l.Quaternion[0].di(0,0,0,1),K.l.li[1].di(1,1,1);for(let k=0;k<w;++k)T&&K.o.FromArrayToRef(T,3*k,K.l.li[0]),c&&K.h.FromArrayToRef(c,4*k,K.l.Quaternion[0]),Q&&K.o.FromArrayToRef(Q,3*k,K.l.li[1]),K.d.ComposeToRef(K.l.li[1],K.l.Quaternion[0],K.l.li[0],K.l.Matrix[0]),K.l.Matrix[0].copyToArray(E,16*k);for(const K of k._primitiveBabylonMeshes)K.hi("matrix",E,16,!0);return n}))}))}}D(Kn),o(Kn,!0,(n=>new Qn(n)));let Gn=0,wn=null;class En{static get Default(){return En._Default||(En._Default=new En),En._Default}constructor(){const n=En.Configuration.decoder;this._decoderModulePromise=G.e.LoadBabylonScriptAsync(n.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(n,k,T,c,K){await this._decoderModulePromise,0===Gn&&(MeshoptDecoder.useWorkers(1),Gn=1);const Q=await MeshoptDecoder.decodeGltfBufferAsync(k,T,n,c,K);return null!==wn&&clearTimeout(wn),wn=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Gn=0,wn=null}),1e3),Q}}En.Configuration={decoder:{url:`${G.e._DefaultCdnUrl}/meshopt_decoder.js`}},En._Default=null;const In="EXT_meshopt_compression";class Sn{constructor(n){this.name=In,this.enabled=n.isExtensionUsed(In),this._loader=n}dispose(){this._loader=null}loadBufferViewAsync(n,k){return a.LoadExtensionAsync(n,k,this.name,(async(T,c)=>{const K=k;if(K._meshOptData)return await K._meshOptData;const Q=j.Get(`${n}/buffer`,this._loader.Di.buffers,c.buffer);return K._meshOptData=this._loader.loadBufferAsync(`/buffers/${Q.index}`,Q,c.byteOffset||0,c.byteLength).then((async n=>await En.Default.decodeGltfBufferAsync(n,c.count,c.byteStride,c.mode,c.filter))),await K._meshOptData}))}}D(In),o(In,!0,(n=>new Sn(n)));const Pn="EXT_texture_webp";class Wn{constructor(n){this.name=Pn,this._loader=n,this.enabled=n.isExtensionUsed(Pn)}dispose(){this._loader=null}_loadTextureAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=void 0==k.sampler?a.DefaultSampler:j.Get(`${n}/sampler`,this._loader.Di.samplers,k.sampler),G=j.Get(`${c}/source`,this._loader.Di.images,K.source);return await this._loader._createTextureAsync(n,Q,G,(n=>{T(n)}),void 0,!k._textureInfo.nonColorData)}))}}D(Pn),o(Pn,!0,(n=>new Wn(n)));const Jn="EXT_texture_avif";class Hn{constructor(n){this.name=Jn,this._loader=n,this.enabled=n.isExtensionUsed(Jn)}dispose(){this._loader=null}_loadTextureAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=void 0==k.sampler?a.DefaultSampler:j.Get(`${n}/sampler`,this._loader.Di.samplers,k.sampler),G=j.Get(`${c}/source`,this._loader.Di.images,K.source);return await this._loader._createTextureAsync(n,Q,G,(n=>{T(n)}),void 0,!k._textureInfo.nonColorData)}))}}D(Jn),o(Jn,!0,(n=>new Hn(n)));var sn=T(12775),bn=T(12746);const Cn="EXT_lights_ies";class zn{constructor(n){this.name=Cn,this._loader=n,this.enabled=this._loader.isExtensionUsed(Cn)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.Di.extensions;if(n&&n[this.name]){const k=n[this.name];this._lights=k.lights,j.Assign(this._lights)}}loadNodeAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,G)=>{let w,E;this._loader._allMaterialsDirtyRequired=!0;const I=await this._loader.loadNodeAsync(n,k,(n=>{E=j.Get(c,this._lights,G.bb);const k=E.name||n.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w=new sn.d(k,K.o.Zero(),K.o.Backward(),0,1,this._loader.babylonScene),w.angle=Math.PI/2,w.innerAngle=0,w._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,E._babylonLight=w,w.falloffType=bn.c.FALLOFF_GLTF,w.$g=G.color?Q.e.ji(G.color):Q.e.White(),w.Bl=G.multiplier||1,w.range=Number.MAX_VALUE,w.parent=n,this._loader._babylonLights.push(w),a.AddPointerMetadata(w,c),T(n)}));let S;if(E.uri)S=await this._loader.loadUriAsync(n,E,E.uri);else{const k=j.Get(`${n}/bufferView`,this._loader.Di.bufferViews,E.bufferView);S=await this._loader.loadBufferViewAsync(`/bufferViews/${k.index}`,k)}return w.iesProfileTexture=new F.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,S,!0,void 0,void 0,void 0,void 0,".ies"),I}))}}D(Cn),o(Cn,!0,(n=>new zn(n)));var rn=T(12796);const qn="KHR_draco_mesh_compression";class On{constructor(n){this.name=qn,this.useNormalizedFlagFromAccessor=!0,this._loader=n,this.enabled=rn.c.DefaultAvailable&&this._loader.isExtensionUsed(qn)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{if(void 0!=k.mode&&4!==k.mode&&5!==k.mode)throw new Error(`${n}: Unsupported mode ${k.mode}`);const Q={},G={},w=(n,c)=>{const w=K.attributes[n];if(void 0!=w&&(T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(c)&&T._delayInfo.push(c),Q[c]=w,this.useNormalizedFlagFromAccessor)){const T=j.TryGet(this._loader.Di.accessors,k.attributes[n]);T&&(G[c]=T.normalized||!1)}};w("POSITION",x.f.PositionKind),w("NORMAL",x.f.NormalKind),w("TANGENT",x.f.TangentKind),w("TEXCOORD_0",x.f.UVKind),w("TEXCOORD_1",x.f.UV2Kind),w("TEXCOORD_2",x.f.UV3Kind),w("TEXCOORD_3",x.f.UV4Kind),w("TEXCOORD_4",x.f.UV5Kind),w("TEXCOORD_5",x.f.UV6Kind),w("JOINTS_0",x.f.MatricesIndicesKind),w("WEIGHTS_0",x.f.MatricesWeightsKind),w("COLOR_0",x.f.ColorKind);const E=j.Get(c,this._loader.Di.bufferViews,K.bufferView);return E._dracoBabylonGeometry||(E._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((async c=>{const K=this.dracoDecoder||rn.c.Default,w=j.TryGet(this._loader.Di.accessors,k.attributes.POSITION),E=this._loader.parent.alwaysComputeBoundingBox||T.skeleton||!w?null:p(w);return await K._decodeMeshToGeometryForGltfAsync(T.name,this._loader.babylonScene,c,Q,G,E).catch((k=>{throw new Error(`${n}: ${k.message}`)}))}))),await E._dracoBabylonGeometry}))}}D(qn),o(qn,!0,(n=>new On(n)));var un=T(12810),fn=T(752),An=T(12780);fn.c.AddNodeConstructor("Light_Type_0",((n,k)=>()=>new vn(n,K.o.Zero(),k)));class vn extends An.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(n){this._shadowAngle=n,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(n){const k=this.needCube();if(this._direction=n,this.needCube()!==k&&this._shadowGenerators){const n=this._shadowGenerators.values();for(let k=n.next();!0!==k.done;k=n.next()){k.value.recreateShadowMap()}}}constructor(n,k,T){super(n,T),this._shadowAngle=Math.PI/2,this.position=k}getClassName(){return"PointLight"}getTypeID(){return bn.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(n){if(this.direction)return super.getShadowDirection(n);switch(n){case 0:return new K.o(1,0,0);case 1:return new K.o(-1,0,0);case 2:return new K.o(0,-1,0);case 3:return new K.o(0,1,0);case 4:return new K.o(0,0,1);case 5:return new K.o(0,0,-1)}return K.o.Zero()}_setDefaultShadowProjectionMatrix(n,k,T){const c=this.va().activeCamera;if(!c)return;const Q=void 0!==this.shadowMinZ?this.shadowMinZ:c.ri,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,w=this.va().getEngine().useReverseDepthBuffer;K.d.PerspectiveFovLHToRef(this.shadowAngle,1,w?G:Q,w?Q:G,n,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(n,k){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,k):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,k),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,k),this}transferToNodeMaterialEffect(n,k){return this.computeTransformedInformation()?n.setFloat3(k,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):n.setFloat3(k,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(n,k){n["POINTLIGHT"+k]=!0}}(0,r.e)([(0,q.K)()],vn.prototype,"shadowAngle",null),(0,f.f)("BABYLON.PointLight",vn);const Fn="KHR_lights_punctual";class mn{constructor(n){this.name=Fn,this._loader=n,this.enabled=this._loader.isExtensionUsed(Fn)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.Di.extensions;if(n&&n[this.name]){const k=n[this.name];this._lights=k.lights,j.Assign(this._lights)}}loadNodeAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,G)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(n,k,(n=>{let k;const w=j.Get(c,this._lights,G.bb),E=w.name||n.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w.type){case"directional":{const n=new un.c(E,K.o.Backward(),this._loader.babylonScene);n.position.ki(0),k=n;break}case"point":k=new vn(E,K.o.Zero(),this._loader.babylonScene);break;case"spot":{const n=new sn.d(E,K.o.Zero(),K.o.Backward(),0,1,this._loader.babylonScene);n.angle=2*(w.spot&&w.spot.outerConeAngle||Math.PI/4),n.innerAngle=2*(w.spot&&w.spot.innerConeAngle||0),k=n;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${c}: Invalid light type (${w.type})`)}k._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=k,k.falloffType=bn.c.FALLOFF_GLTF,k.$g=w.color?Q.e.ji(w.color):Q.e.White(),k.Bl=void 0==w.Bl?1:w.Bl,k.range=void 0==w.range?Number.MAX_VALUE:w.range,k.parent=n,this._loader._babylonLights.push(k),a.AddPointerMetadata(k,c),T(n)})))))}}D(Fn),o(Fn,!0,(n=>new mn(n)));const xn="KHR_materials_pbrSpecularGlossiness";class gn{constructor(n){this.name=xn,this.order=200,this._loader=n,this.enabled=this._loader.isExtensionUsed(xn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialBasePropertiesAsync(n,k,T)),Q.push(this._loadSpecularGlossinessPropertiesAsync(c,K,T)),this._loader.loadMaterialAlphaProperties(n,k,T),await Promise.all(Q).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return T.metallic=null,T.roughness=null,k.diffuseFactor?(T.albedoColor=Q.e.ji(k.diffuseFactor),T.alpha=k.diffuseFactor[3]):T.albedoColor=Q.e.White(),T.reflectivityColor=k.specularFactor?Q.e.ji(k.specularFactor):Q.e.White(),T.microSurface=void 0==k.glossinessFactor?1:k.glossinessFactor,k.diffuseTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/diffuseTexture`,k.diffuseTexture,(n=>{n.name=`${T.name} (Diffuse)`,T.albedoTexture=n}))),k.specularGlossinessTexture&&(c.push(this._loader.loadTextureInfoAsync(`${n}/specularGlossinessTexture`,k.specularGlossinessTexture,(n=>{n.name=`${T.name} (Specular Glossiness)`,T.reflectivityTexture=n,T.reflectivityTexture.Bj=!0}))),T.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(c).then((()=>{}))}}D(xn),o(xn,!0,(n=>new gn(n)));const Un="KHR_materials_unlit";class Vn{constructor(n){this.name=Un,this.order=210,this._loader=n,this.enabled=this._loader.isExtensionUsed(Un)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async()=>await this._loadUnlitPropertiesAsync(n,k,T)))}_loadUnlitPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;T.unlit=!0;const K=k.pbrMetallicRoughness;return K&&(K.baseColorFactor?(T.albedoColor=Q.e.ji(K.baseColorFactor),T.alpha=K.baseColorFactor[3]):T.albedoColor=Q.e.White(),K.baseColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/baseColorTexture`,K.baseColorTexture,(n=>{n.name=`${T.name} (Base Color)`,T.albedoTexture=n})))),k.doubleSided&&(T.ui=!1,T.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(n,k,T),Promise.all(c).then((()=>{}))}}D(Un),o(Un,!0,(n=>new Vn(n)));const Yn="KHR_materials_clearcoat";class Zn{constructor(n){this.name=Yn,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(Yn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadClearCoatPropertiesAsync(c,K,T)),await Promise.all(Q)}))}_loadClearCoatPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return T.clearCoat.isEnabled=!0,T.clearCoat.useRoughnessFromMainTexture=!1,T.clearCoat.remapF0OnInterfaceChange=!1,void 0!=k.clearcoatFactor?T.clearCoat.Bl=k.clearcoatFactor:T.clearCoat.Bl=0,k.clearcoatTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/clearcoatTexture`,k.clearcoatTexture,(n=>{n.name=`${T.name} (ClearCoat)`,T.clearCoat.texture=n}))),void 0!=k.clearcoatRoughnessFactor?T.clearCoat.roughness=k.clearcoatRoughnessFactor:T.clearCoat.roughness=0,k.clearcoatRoughnessTexture&&(k.clearcoatRoughnessTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${n}/clearcoatRoughnessTexture`,k.clearcoatRoughnessTexture,(n=>{n.name=`${T.name} (ClearCoat Roughness)`,T.clearCoat.textureRoughness=n})))),k.clearcoatNormalTexture&&(k.clearcoatNormalTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${n}/clearcoatNormalTexture`,k.clearcoatNormalTexture,(n=>{n.name=`${T.name} (ClearCoat Normal)`,T.clearCoat.bumpTexture=n}))),T.invertNormalMapX=!T.va().useRightHandedSystem,T.invertNormalMapY=T.va().useRightHandedSystem,void 0!=k.clearcoatNormalTexture.scale&&(T.clearCoat.bumpTexture.level=k.clearcoatNormalTexture.scale)),Promise.all(c).then((()=>{}))}}D(Yn),o(Yn,!0,(n=>new Zn(n)));const en="KHR_materials_iridescence";class dn{constructor(n){this.name=en,this.order=195,this._loader=n,this.enabled=this._loader.isExtensionUsed(en)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadIridescencePropertiesAsync(c,K,T)),await Promise.all(Q).then((()=>{}))}))}_loadIridescencePropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return T.iridescence.isEnabled=!0,T.iridescence.Bl=k.iridescenceFactor??0,T.iridescence.indexOfRefraction=k.iridescenceIor??k.iridescenceIOR??1.3,T.iridescence.minimumThickness=k.iridescenceThicknessMinimum??100,T.iridescence.maximumThickness=k.iridescenceThicknessMaximum??400,k.iridescenceTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/iridescenceTexture`,k.iridescenceTexture,(n=>{n.name=`${T.name} (Iridescence)`,T.iridescence.texture=n}))),k.iridescenceThicknessTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/iridescenceThicknessTexture`,k.iridescenceThicknessTexture,(n=>{n.name=`${T.name} (Iridescence Thickness)`,T.iridescence.thicknessTexture=n}))),Promise.all(c).then((()=>{}))}}D(en),o(en,!0,(n=>new dn(n)));const ln="KHR_materials_anisotropy";class Bn{constructor(n){this.name=ln,this.order=195,this._loader=n,this.enabled=this._loader.isExtensionUsed(ln)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadIridescencePropertiesAsync(c,K,T)),await Promise.all(Q)}))}async _loadIridescencePropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;T.anisotropy.isEnabled=!0,T.anisotropy.Bl=k.anisotropyStrength??0,T.anisotropy.angle=k.anisotropyRotation??0,k.anisotropyTexture&&(k.anisotropyTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${n}/anisotropyTexture`,k.anisotropyTexture,(n=>{n.name=`${T.name} (Anisotropy Intensity)`,T.anisotropy.texture=n})))),await Promise.all(c)}}D(ln),o(ln,!0,(n=>new Bn(n)));const tn="KHR_materials_emissive_strength";class Mn{constructor(n){this.name=tn,this.order=170,this._loader=n,this.enabled=this._loader.isExtensionUsed(tn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>await this._loader.loadMaterialPropertiesAsync(n,k,T).then((()=>{this._loadEmissiveProperties(c,K,T)}))))}_loadEmissiveProperties(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);void 0!==k.emissiveStrength&&(T.emissiveIntensity=k.emissiveStrength)}}D(tn),o(tn,!0,(n=>new Mn(n)));const on="KHR_materials_sheen";class Dn{constructor(n){this.name=on,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(on)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadSheenPropertiesAsync(c,K,T)),await Promise.all(Q).then((()=>{}))}))}_loadSheenPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return T.sheen.isEnabled=!0,T.sheen.Bl=1,void 0!=k.sheenColorFactor?T.sheen.color=Q.e.ji(k.sheenColorFactor):T.sheen.color=Q.e.Black(),k.sheenColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/sheenColorTexture`,k.sheenColorTexture,(n=>{n.name=`${T.name} (Sheen Color)`,T.sheen.texture=n}))),void 0!==k.sheenRoughnessFactor?T.sheen.roughness=k.sheenRoughnessFactor:T.sheen.roughness=0,k.sheenRoughnessTexture&&(k.sheenRoughnessTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${n}/sheenRoughnessTexture`,k.sheenRoughnessTexture,(n=>{n.name=`${T.name} (Sheen Roughness)`,T.sheen.textureRoughness=n})))),T.sheen.albedoScaling=!0,T.sheen.useRoughnessFromMainTexture=!1,Promise.all(c).then((()=>{}))}}D(on),o(on,!0,(n=>new Dn(n)));var Rn=T(12766);const Ln="KHR_materials_specular";class hn{constructor(n){this.name=Ln,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(Ln)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;if(Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadSpecularPropertiesAsync(c,K,T)),K.extensions&&K.extensions.EXT_materials_specular_edge_color&&T instanceof v){K.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(T.brdf.dielectricSpecularModel=Rn.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,T.brdf.conductorSpecularModel=Rn.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(Q).then((()=>{}))}))}_loadSpecularPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return void 0!==k.specularFactor&&(T.metallicF0Factor=k.specularFactor),void 0!==k.specularColorFactor&&(T.metallicReflectanceColor=Q.e.ji(k.specularColorFactor)),k.specularTexture&&(k.specularTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${n}/specularTexture`,k.specularTexture,(n=>{n.name=`${T.name} (Specular)`,T.metallicReflectanceTexture=n,T.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),k.specularColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/specularColorTexture`,k.specularColorTexture,(n=>{n.name=`${T.name} (Specular Color)`,T.reflectanceTexture=n}))),Promise.all(c).then((()=>{}))}}D(Ln),o(Ln,!0,(n=>new hn(n)));const jn="KHR_materials_ior";class pn{constructor(n){this.name=jn,this.order=180,this._loader=n,this.enabled=this._loader.isExtensionUsed(jn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadIorPropertiesAsync(c,K,T)),await Promise.all(Q).then((()=>{}))}))}_loadIorPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);return void 0!==k.ior?T.indexOfRefraction=k.ior:T.indexOfRefraction=pn._DEFAULT_IOR,Promise.resolve()}}pn._DEFAULT_IOR=1.5,D(jn),o(jn,!0,(n=>new pn(n)));const an="KHR_materials_variants";class Xn{constructor(n){this.name=an,this._loader=n,this.enabled=this._loader.isExtensionUsed(an)}dispose(){this._loader=null}static GetAvailableVariants(n){const k=this._GetExtensionMetadata(n);return k?Object.keys(k.variants):[]}getAvailableVariants(n){return Xn.GetAvailableVariants(n)}static SelectVariant(n,k){const T=this._GetExtensionMetadata(n);if(!T)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${an} extension`);const c=n=>{const k=T.variants[n];if(k)for(const T of k)T.mesh.material=T.material};if(k instanceof Array)for(const K of k)c(K);else c(k);T.lastSelected=k}selectVariant(n,k){Xn.SelectVariant(n,k)}static Reset(n){const k=this._GetExtensionMetadata(n);if(!k)throw new Error(`Cannot reset on a glTF mesh that does not have the ${an} extension`);for(const T of k.original)T.mesh.material=T.material;k.lastSelected=null}reset(n){Xn.Reset(n)}static GetLastSelectedVariant(n){const k=this._GetExtensionMetadata(n);if(!k)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${an} extension`);return k.lastSelected}getLastSelectedVariant(n){return Xn.GetLastSelectedVariant(n)}static _GetExtensionMetadata(n){var k,T;return(null===n||void 0===n||null===(k=n._internalMetadata)||void 0===k||null===(T=k.Di)||void 0===T?void 0:T[an])||null}onLoading(){const n=this._loader.Di.extensions;if(n&&n[this.name]){const k=n[this.name];this._variants=k.variants}}onReady(){const n=this._loader.rootBabylonMesh;if(n){var k;const T=this._loader.parent.extensionOptions[an];null!==T&&void 0!==T&&T.defaultVariant&&Xn.SelectVariant(n,T.defaultVariant),null===T||void 0===T||null===(k=T.onLoaded)||void 0===k||k.call(T,{get variants(){return Xn.GetAvailableVariants(n)},get selectedVariant(){const k=Xn.GetLastSelectedVariant(n);return k?Array.isArray(k)?k[0]:k:Xn.GetAvailableVariants(n)[0]},set selectedVariant(k){Xn.SelectVariant(n,k)}})}}_loadMeshPrimitiveAsync(n,k,T,c,K,Q){return a.LoadExtensionAsync(n,K,this.name,(async(G,w)=>{const E=new Array;return E.push(this._loader._loadMeshPrimitiveAsync(n,k,T,c,K,(k=>{if(Q(k),k instanceof V.b){const T=a._GetDrawMode(n,K.mode),c=this._loader.rootBabylonMesh,Q=c?c._internalMetadata=c._internalMetadata||{}:{},I=Q.Di=Q.Di||{},S=I[an]=I[an]||{lastSelected:null,original:[],variants:{}};S.original.push({mesh:k,material:k.material});for(let n=0;n<w.mappings.length;++n){const K=w.mappings[n],Q=j.Get(`${G}/mappings/${n}/material`,this._loader.Di.materials,K.material);E.push(this._loader._loadMaterialAsync(`#/materials/${K.material}`,Q,k,T,(n=>{for(let T=0;T<K.variants.length;++T){const Q=K.variants[T],G=j.Get(`/extensions/${an}/variants/${Q}`,this._variants,Q);S.variants[G.name]=S.variants[G.name]||[],S.variants[G.name].push({mesh:k,material:n}),k.onClonedObservable.add((n=>{const T=n;let K=null,Q=T;do{if(Q=Q.parent,!Q)return;K=Xn._GetExtensionMetadata(Q)}while(null===K);if(c&&K===Xn._GetExtensionMetadata(c)){Q._internalMetadata={};for(const n in c._internalMetadata)Q._internalMetadata[n]=c._internalMetadata[n];Q._internalMetadata.Di=[];for(const n in c._internalMetadata.Di)Q._internalMetadata.Di[n]=c._internalMetadata.Di[n];Q._internalMetadata.Di[an]={lastSelected:null,original:[],variants:{}};for(const n of K.original)Q._internalMetadata.Di[an].original.push({mesh:n.mesh,material:n.material});for(const n in K.variants)if(Object.prototype.hasOwnProperty.call(K.variants,n)){Q._internalMetadata.Di[an].variants[n]=[];for(const k of K.variants[n])Q._internalMetadata.Di[an].variants[n].push({mesh:k.mesh,material:k.material})}K=Q._internalMetadata.Di[an]}for(const c of K.original)c.mesh===k&&(c.mesh=T);for(const c of K.variants[G.name])c.mesh===k&&(c.mesh=T)}))}})))}}}))),await Promise.all(E).then((n=>{let[k]=n;return k}))}))}}D(an),o(an,!0,(n=>new Xn(n)));var yn=T(2350);class Nn{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Rn.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(n,k){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Nn._GetDefaultOptions(),...n},this._scene=k,this._scene._transmissionHelper=this,this.onErrorObservable=new S.b,this._scene.Gi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(n){if(!Object.keys(n).filter((k=>this._options[k]!==n[k])).length)return;const k={...this._options,...n},T=this._options;this._options=k,k.renderSize===T.renderSize&&k.renderTargetTextureType===T.renderTargetTextureType&&k.generateMipmaps===T.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=k.samples,this._opaqueRenderTarget.lodGenerationScale=k.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=k.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(n){return!!n&&!!(n instanceof v&&n.subSurface.isRefractionEnabled)}_addMesh(n){this._materialObservers[n.uniqueId]=n.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),G.e.SetImmediate((()=>{this._shouldRenderAsTransmission(n.material)?(n.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(n)&&this._transparentMeshesCache.push(n)):-1===this._opaqueMeshesCache.indexOf(n)&&this._opaqueMeshesCache.push(n)}))}_removeMesh(n){n.onMaterialChangedObservable.remove(this._materialObservers[n.uniqueId]),delete this._materialObservers[n.uniqueId];let k=this._transparentMeshesCache.indexOf(n);-1!==k&&this._transparentMeshesCache.splice(k,1),k=this._opaqueMeshesCache.indexOf(n),-1!==k&&this._opaqueMeshesCache.splice(k,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(n){const k=this._transparentMeshesCache.indexOf(n),T=this._opaqueMeshesCache.indexOf(n);this._shouldRenderAsTransmission(n.material)?(n.material instanceof v&&(n.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==T?(this._opaqueMeshesCache.splice(T,1),this._transparentMeshesCache.push(n)):-1===k&&this._transparentMeshesCache.push(n)):-1!==k?(this._transparentMeshesCache.splice(k,1),this._opaqueMeshesCache.push(n)):-1===T&&this._opaqueMeshesCache.push(n)}_isRenderTargetValid(){var n;return null!==(null===(n=this._opaqueRenderTarget)||void 0===n?void 0:n.getInternalTexture())}_setupRenderTargets(){var n;let k;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new yn.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(n=this._options.clearColor)||void 0===n?void 0:n.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((n=>{k=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?n.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(n.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=k}));for(const T of this._transparentMeshesCache)this._shouldRenderAsTransmission(T.material)&&(T.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const nk="KHR_materials_transmission";class kk{constructor(n){this.name=nk,this.order=175,this._loader=n,this.enabled=this._loader.isExtensionUsed(nk),this.enabled&&(n.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadTransparentPropertiesAsync(c,k,T,K)),await Promise.all(Q).then((()=>{}))}))}_loadTransparentPropertiesAsync(n,k,T,c){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const K=T;if(K.subSurface.isRefractionEnabled=!0,K.subSurface.volumeIndexOfRefraction=1,K.subSurface.useAlbedoToTintRefraction=!0,void 0===c.transmissionFactor)return K.subSurface.refractionIntensity=0,K.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Q;K.subSurface.refractionIntensity=c.transmissionFactor;const n=K.va();if(K.subSurface.refractionIntensity&&!n._transmissionHelper)new Nn({},K.va());else if(K.subSurface.refractionIntensity&&(null===(Q=n._transmissionHelper)||void 0===Q||!Q._isRenderTargetValid())){var G;null===(G=n._transmissionHelper)||void 0===G||G._setupRenderTargets()}}return K.subSurface.minimumThickness=0,K.subSurface.maximumThickness=0,c.transmissionTexture?(c.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${n}/transmissionTexture`,c.transmissionTexture,void 0).then((n=>{n.name=`${T.name} (Transmission)`,K.subSurface.refractionIntensityTexture=n,K.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}D(nk),o(nk,!0,(n=>new kk(n)));const Tk="KHR_materials_diffuse_transmission";class ck{constructor(n){this.name=Tk,this.order=174,this._loader=n,this.enabled=this._loader.isExtensionUsed(Tk),this.enabled&&(n.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadTranslucentPropertiesAsync(c,k,T,K)),await Promise.all(Q).then((()=>{}))}))}_loadTranslucentPropertiesAsync(n,k,T,c){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const K=T;if(K.subSurface.isTranslucencyEnabled=!0,K.subSurface.volumeIndexOfRefraction=1,K.subSurface.minimumThickness=0,K.subSurface.maximumThickness=0,K.subSurface.useAlbedoToTintTranslucency=!1,void 0===c.diffuseTransmissionFactor)return K.subSurface.translucencyIntensity=0,K.subSurface.isTranslucencyEnabled=!1,Promise.resolve();K.subSurface.translucencyIntensity=c.diffuseTransmissionFactor;const G=new Array;return K.subSurface.useGltfStyleTextures=!0,c.diffuseTransmissionTexture&&(c.diffuseTransmissionTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${n}/diffuseTransmissionTexture`,c.diffuseTransmissionTexture).then((n=>{n.name=`${T.name} (Diffuse Transmission)`,K.subSurface.translucencyIntensityTexture=n})))),void 0!==c.diffuseTransmissionColorFactor?K.subSurface.translucencyColor=Q.e.ji(c.diffuseTransmissionColorFactor):K.subSurface.translucencyColor=Q.e.White(),c.diffuseTransmissionColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${n}/diffuseTransmissionColorTexture`,c.diffuseTransmissionColorTexture).then((n=>{n.name=`${T.name} (Diffuse Transmission Color)`,K.subSurface.translucencyColorTexture=n}))),Promise.all(G).then((()=>{}))}}D(Tk),o(Tk,!0,(n=>new ck(n)));const Kk="KHR_materials_volume";class Qk{constructor(n){this.name=Kk,this.order=173,this._loader=n,this.enabled=this._loader.isExtensionUsed(Kk),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadVolumePropertiesAsync(c,k,T,K)),await Promise.all(Q).then((()=>{}))}))}_loadVolumePropertiesAsync(n,k,T,c){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);if(!T.subSurface.isRefractionEnabled&&!T.subSurface.isTranslucencyEnabled||!c.thicknessFactor)return Promise.resolve();T.subSurface.volumeIndexOfRefraction=T.indexOfRefraction;const K=void 0!==c.attenuationDistance?c.attenuationDistance:Number.MAX_VALUE;return T.subSurface.tintColorAtDistance=K,void 0!==c.attenuationColor&&3==c.attenuationColor.length&&T.subSurface.tintColor.di(c.attenuationColor[0],c.attenuationColor[1],c.attenuationColor[2]),T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=c.thicknessFactor,T.subSurface.useThicknessAsDepth=!0,c.thicknessTexture?(c.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${n}/thicknessTexture`,c.thicknessTexture).then((n=>{n.name=`${T.name} (Thickness)`,T.subSurface.thicknessTexture=n,T.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}D(Kk),o(Kk,!0,(n=>new Qk(n)));const Gk="KHR_materials_dispersion";class wk{constructor(n){this.name=Gk,this.order=174,this._loader=n,this.enabled=this._loader.isExtensionUsed(Gk)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadDispersionPropertiesAsync(c,k,T,K)),await Promise.all(Q).then((()=>{}))}))}_loadDispersionPropertiesAsync(n,k,T,c){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);return T.subSurface.isRefractionEnabled&&c.dispersion?(T.subSurface.isDispersionEnabled=!0,T.subSurface.dispersion=c.dispersion,Promise.resolve()):Promise.resolve()}}D(Gk),o(Gk,!0,(n=>new wk(n)));const Ek="EXT_materials_diffuse_roughness";class Ik{constructor(n){this.name=Ek,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(Ek)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(n,k,T)),Q.push(this._loadDiffuseRoughnessPropertiesAsync(c,K,T)),await Promise.all(Q).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(n,k,T){if(!(T instanceof v))throw new Error(`${n}: Material type not supported`);const c=new Array;return T.brdf.baseDiffuseModel=Rn.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=k.diffuseRoughnessFactor?T.baseDiffuseRoughness=k.diffuseRoughnessFactor:T.baseDiffuseRoughness=0,k.diffuseRoughnessTexture&&c.push(this._loader.loadTextureInfoAsync(`${n}/diffuseRoughnessTexture`,k.diffuseRoughnessTexture,(n=>{n.name=`${T.name} (Diffuse Roughness)`,T.baseDiffuseRoughnessTexture=n}))),Promise.all(c).then((()=>{}))}}D(Ek),o(Ek,!0,(n=>new Ik(n)));const Sk="KHR_mesh_quantization";class Pk{constructor(n){this.name=Sk,this.enabled=n.isExtensionUsed(Sk)}dispose(){}}D(Sk),o(Sk,!0,(n=>new Pk(n)));const Wk="KHR_texture_basisu";class Jk{constructor(n){this.name=Wk,this._loader=n,this.enabled=n.isExtensionUsed(Wk)}dispose(){this._loader=null}_loadTextureAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>{const Q=void 0==k.sampler?a.DefaultSampler:j.Get(`${n}/sampler`,this._loader.Di.samplers,k.sampler),G=j.Get(`${c}/source`,this._loader.Di.images,K.source);return await this._loader._createTextureAsync(n,Q,G,(n=>{T(n)}),k._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!k._textureInfo.nonColorData)}))}}D(Wk),o(Wk,!0,(n=>new Jk(n)));const Hk="KHR_texture_transform";class sk{constructor(n){this.name=Hk,this._loader=n,this.enabled=this._loader.isExtensionUsed(Hk)}dispose(){this._loader=null}loadTextureInfoAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(c,K)=>await this._loader.loadTextureInfoAsync(n,k,(n=>{if(!(n instanceof F.b))throw new Error(`${c}: Texture type not supported`);K.offset&&(n.uOffset=K.offset[0],n.vOffset=K.offset[1]),n.uRotationCenter=0,n.vRotationCenter=0,K.rotation&&(n.wAng=-K.rotation),K.scale&&(n.uScale=K.scale[0],n.vScale=K.scale[1]),void 0!=K.texCoord&&(n.coordinatesIndex=K.texCoord),T(n)}))))}}D(Hk),o(Hk,!0,(n=>new sk(n)));const bk="KHR_xmp_json_ld";class Ck{constructor(n){this.name=bk,this.order=100,this._loader=n,this.enabled=this._loader.isExtensionUsed(bk)}dispose(){this._loader=null}onLoading(){var n,k,T;if(null===this._loader.rootBabylonMesh)return;const c=null===(n=this._loader.Di.extensions)||void 0===n?void 0:n.KHR_xmp_json_ld,K=null===(k=this._loader.Di.asset)||void 0===k||null===(T=k.extensions)||void 0===T?void 0:T.KHR_xmp_json_ld;if(c&&K){const n=+K.packet;c.packets&&n<c.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=c.packets[n])}}}function zk(n,k,T,c){return Q.e.ji(k,T).scale(c)}function rk(n,k,T,c){return k[T]*c}function qk(n,k,T,c){return-k[T]*c}function Ok(n,k,T,c){return k[T+1]*c}function uk(n,k,T,c){return k[T]*c*2}function fk(n){return{scale:[new vk(W.c.ANIMATIONTYPE_FLOAT,`${n}.uScale`,rk,(()=>2)),new vk(W.c.ANIMATIONTYPE_FLOAT,`${n}.vScale`,Ok,(()=>2))],offset:[new vk(W.c.ANIMATIONTYPE_FLOAT,`${n}.uOffset`,rk,(()=>2)),new vk(W.c.ANIMATIONTYPE_FLOAT,`${n}.vOffset`,Ok,(()=>2))],rotation:[new vk(W.c.ANIMATIONTYPE_FLOAT,`${n}.wAng`,qk,(()=>1))]}}D(bk),o(bk,!0,(n=>new Ck(n)));class Ak extends X.AnimationPropertyInfo{buildAnimations(n,k,T,c){return[{babylonAnimatable:n._babylonCamera,babylonAnimation:this._buildAnimation(k,T,c)}]}}class vk extends X.AnimationPropertyInfo{buildAnimations(n,k,T,c){const K=[];for(const Q in n._data)K.push({babylonAnimatable:n._data[Q].babylonMaterial,babylonAnimation:this._buildAnimation(k,T,c)});return K}}class Fk extends X.AnimationPropertyInfo{buildAnimations(n,k,T,c){return[{babylonAnimatable:n._babylonLight,babylonAnimation:this._buildAnimation(k,T,c)}]}}(0,R.m)("/cameras/{}/orthographic/xmag",[new Ak(W.c.ANIMATIONTYPE_FLOAT,"orthoLeft",qk,(()=>1)),new Ak(W.c.ANIMATIONTYPE_FLOAT,"orthoRight",Ok,(()=>1))]),(0,R.m)("/cameras/{}/orthographic/ymag",[new Ak(W.c.ANIMATIONTYPE_FLOAT,"orthoBottom",qk,(()=>1)),new Ak(W.c.ANIMATIONTYPE_FLOAT,"orthoTop",Ok,(()=>1))]),(0,R.m)("/cameras/{}/orthographic/zfar",[new Ak(W.c.ANIMATIONTYPE_FLOAT,"maxZ",rk,(()=>1))]),(0,R.m)("/cameras/{}/orthographic/znear",[new Ak(W.c.ANIMATIONTYPE_FLOAT,"ri",rk,(()=>1))]),(0,R.m)("/cameras/{}/perspective/yfov",[new Ak(W.c.ANIMATIONTYPE_FLOAT,"fov",rk,(()=>1))]),(0,R.m)("/cameras/{}/perspective/zfar",[new Ak(W.c.ANIMATIONTYPE_FLOAT,"maxZ",rk,(()=>1))]),(0,R.m)("/cameras/{}/perspective/znear",[new Ak(W.c.ANIMATIONTYPE_FLOAT,"ri",rk,(()=>1))]),(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new vk(W.c.ANIMATIONTYPE_COLOR3,"albedoColor",zk,(()=>4)),new vk(W.c.ANIMATIONTYPE_FLOAT,"alpha",(function(n,k,T,c){return k[T+3]*c}),(()=>4))]),(0,R.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"metallic",rk,(()=>1))]),(0,R.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"roughness",rk,(()=>1))]);const mk=fk("albedoTexture");(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",mk.scale),(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",mk.offset),(0,R.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",mk.rotation);const xk=fk("metallicTexture");(0,R.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",xk.scale),(0,R.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",xk.offset),(0,R.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",xk.rotation),(0,R.m)("/materials/{}/emissiveFactor",[new vk(W.c.ANIMATIONTYPE_COLOR3,"emissiveColor",zk,(()=>3))]);const gk=fk("bumpTexture");(0,R.m)("/materials/{}/normalTexture/scale",[new vk(W.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",rk,(()=>1))]),(0,R.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",gk.scale),(0,R.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",gk.offset),(0,R.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",gk.rotation),(0,R.m)("/materials/{}/occlusionTexture/strength",[new vk(W.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",rk,(()=>1))]);const Uk=fk("ambientTexture");(0,R.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Uk.scale),(0,R.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Uk.offset),(0,R.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Uk.rotation);const Vk=fk("emissiveTexture");(0,R.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Vk.scale),(0,R.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Vk.offset),(0,R.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Vk.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new vk(W.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new vk(W.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",rk,(()=>1))]);const Yk=fk("anisotropy.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Yk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Yk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Yk.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",rk,(()=>1))]);const Zk=fk("clearCoat.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Zk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Zk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Zk.rotation);const ek=fk("clearCoat.bumpTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new vk(W.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",ek.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",ek.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",ek.rotation);const dk=fk("clearCoat.textureRoughness");(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",dk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",dk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",dk.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new vk(W.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new vk(W.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new vk(W.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new vk(W.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",rk,(()=>1))]);const lk=fk("iridescence.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",lk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",lk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",lk.rotation);const ik=fk("iridescence.thicknessTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ik.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ik.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ik.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new vk(W.c.ANIMATIONTYPE_COLOR3,"sheen.color",zk,(()=>3))]),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",rk,(()=>1))]);const Bk=fk("sheen.texture");(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Bk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Bk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Bk.rotation);const tk=fk("sheen.textureRoughness");(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",tk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",tk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",tk.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new vk(W.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",zk,(()=>3))]);const Mk=fk("metallicReflectanceTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Mk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Mk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Mk.rotation);const ok=fk("reflectanceTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ok.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ok.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ok.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",rk,(()=>1))]);const Dk=fk("subSurface.refractionIntensityTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Dk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Dk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Dk.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new vk(W.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",zk,(()=>3))]),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new vk(W.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",rk,(()=>1))]),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",rk,(()=>1))]);const Rk=fk("subSurface.thicknessTexture");(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Rk.scale),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Rk.offset),(0,R.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Rk.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new vk(W.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",rk,(()=>1))]);const Lk=fk("subSurface.translucencyIntensityTexture");(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Lk.scale),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Lk.offset),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Lk.rotation),(0,R.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new vk(W.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",zk,(()=>3))]);const hk=fk("subSurface.translucencyColorTexture");(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",hk.scale),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",hk.offset),(0,R.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",hk.rotation),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new Fk(W.c.ANIMATIONTYPE_COLOR3,"diffuse",zk,(()=>3))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Fk(W.c.ANIMATIONTYPE_FLOAT,"intensity",rk,(()=>1))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new Fk(W.c.ANIMATIONTYPE_FLOAT,"range",rk,(()=>1))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Fk(W.c.ANIMATIONTYPE_FLOAT,"innerAngle",uk,(()=>1))]),(0,R.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Fk(W.c.ANIMATIONTYPE_FLOAT,"angle",uk,(()=>1))]),(0,R.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new Fk(W.c.ANIMATIONTYPE_COLOR3,"diffuse",zk,(()=>3))]),(0,R.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Fk(W.c.ANIMATIONTYPE_FLOAT,"intensity",rk,(()=>1))]);const jk="KHR_animation_pointer";class pk{constructor(n){this.name=jk,this._loader=n,this._pathToObjectConverter=(0,R.i)(this._loader.Di)}get enabled(){return this._loader.isExtensionUsed(jk)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(n,k,T,c,K){var Q;const G=null===(Q=c.target.extensions)||void 0===Q?void 0:Q.KHR_animation_pointer;if(!G||!this._pathToObjectConverter)return null;"pointer"!==c.target.path&&s.d.Warn(`${n}/target/path: Value (${c.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=c.target.node&&s.d.Warn(`${n}/target/node: Value (${c.target.node}) must not be present when using the ${this.name} extension`);const w=`${n}/extensions/${this.name}`,E=G.pointer;if(!E)throw new Error(`${w}: Pointer is missing`);try{const Q=this._pathToObjectConverter.convert(E);if(!Q.info.interpolation)throw new Error(`${w}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(n,k,T,c,{object:Q.object,info:Q.info.interpolation},K)}catch(I){return s.d.Warn(`${w}/pointer: Invalid pointer (${E}) skipped`),null}}}D(jk),o(jk,!0,(n=>new pk(n)));class ak{constructor(n,k,T){this.frame=n,this.action=k,this.onlyOnce=T,this.isDone=!1}_clone(){return new ak(this.frame,this.action,this.onlyOnce)}}var Xk=T(576),yk=T(615),Nk=T(610);class nT{get loop(){return this._loop}set loop(n){n!==this._loop&&(this._loop=n,this.updateOptions({loop:n}))}get currentTime(){var n;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(n=yk.b.audioEngine)&&void 0!==n&&n.audioContext&&(this.isPlaying||this.isPaused)){const n=this.isPaused?0:yk.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+n}return 0}get spatialSound(){return this._spatialSound}set spatialSound(n){if(n==this._spatialSound)return;const k=this.isPlaying;this.pause(),n?(this._spatialSound=n,this._updateSpatialParameters()):this._disableSpatialSound(),k&&this.play()}constructor(n,k,T){var c;let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new S.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=K.o.Zero(),this._localDirection=new K.o(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=n,T=T||H.e.LastCreatedScene)if(this._scene=T,nT._SceneComponentInitialization(T),this._readyToPlayCallback=Q,this._customAttenuationFunction=(n,k,T,c,K)=>k<T?n*(1-k/T):0,w&&(this.autoplay=w.autoplay||!1,this._loop=w.loop||!1,void 0!==w.volume&&(this._volume=w.volume),this._spatialSound=w.spatialSound??!1,this.maxDistance=w.maxDistance??100,this.useCustomAttenuation=w.useCustomAttenuation??!1,this.rolloffFactor=w.rolloffFactor||1,this.refDistance=w.refDistance||1,this.distanceModel=w.distanceModel||"linear",this._playbackRate=w.playbackRate||1,this._streaming=w.streaming??!1,this._length=w.length,this._offset=w.offset),null!==(c=yk.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&yk.b.audioEngine.audioContext){this._soundGain=yk.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let n=!0;if(k)try{"string"===typeof k?(this._urlType="String",this._url=k):k instanceof ArrayBuffer?this._urlType="ArrayBuffer":k instanceof HTMLMediaElement?this._urlType="MediaElement":k instanceof MediaStream?this._urlType="MediaStream":k instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(k)&&(this._urlType="Array");let T=[],c=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=yk.b.audioEngine.audioContext.createMediaElementSource(k),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=yk.b.audioEngine.audioContext.createMediaStreamSource(k),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":k.byteLength>0&&(c=!0,this._soundLoaded(k));break;case"AudioBuffer":this._audioBufferLoaded(k);break;case"String":T.push(k);case"Array":0===T.length&&(T=k);for(let n=0;n<T.length;n++){const k=T[n];if(c=w&&w.skipCodecCheck||-1!==k.indexOf(".mp3",k.length-4)&&yk.b.audioEngine.isMP3supported||-1!==k.indexOf(".ogg",k.length-4)&&yk.b.audioEngine.isOGGsupported||-1!==k.indexOf(".wav",k.length-4)||-1!==k.indexOf(".m4a",k.length-4)||-1!==k.indexOf(".mp4",k.length-4)||-1!==k.indexOf("blob:"),c){this._streaming?(this._htmlAudioElement=new Audio(k),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,G.e.SetCorsBehavior(k,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(k,(n=>{this._soundLoaded(n)}),void 0,!0,!0,(n=>{n&&s.d.Error("XHR "+n.status+" error on: "+k+"."),s.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:n=!1}n?c||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):s.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(E){s.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),yk.b.audioEngine&&!yk.b.audioEngine.WarnedWebAudioUnsupported&&(s.d.Error("Web Audio is not supported by your browser."),yk.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var n;null!==(n=yk.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(n){var k;null!==(k=yk.b.audioEngine)&&void 0!==k&&k.audioContext&&(this._audioBuffer=n,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(n){var k;null!==(k=yk.b.audioEngine)&&void 0!==k&&k.audioContext&&yk.b.audioEngine.audioContext.decodeAudioData(n,(n=>{this._audioBufferLoaded(n)}),(n=>{s.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+n)}))}setAudioBuffer(n){var k;null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&(this._audioBuffer=n,this._isReadyToPlay=!0)}updateOptions(n){n&&(this.loop=n.loop??this.loop,this.maxDistance=n.maxDistance??this.maxDistance,this.useCustomAttenuation=n.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=n.rolloffFactor??this.rolloffFactor,this.refDistance=n.refDistance??this.refDistance,this.distanceModel=n.distanceModel??this.distanceModel,this._playbackRate=n.playbackRate??this._playbackRate,this._length=n.length??void 0,this.spatialSound=n.spatialSound??this._spatialSound,this._setOffset(n.offset??void 0),this.setVolume(n.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var n;null!==(n=yk.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&yk.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??yk.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var n;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(n=this._soundPanner)||void 0===n||n.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var n;null!==(n=yk.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(n){var k;null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(n),this._isOutputConnected=!0)}setDirectionalCone(n,k,T){k<n?s.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=n,this._coneOuterAngle=k,this._coneOuterGain=T,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(n){if(n!=this._coneInnerAngle){var k;if(this._coneOuterAngle<n)return void s.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=n,null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(n){if(n!=this._coneOuterAngle){var k;if(n<this._coneInnerAngle)return void s.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=n,null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(n){var k;n.equals(this._position)||(this._position.p(n),null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(n){var k;this._localDirection=n,null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const n=this._connectedTransformNode.getWorldMatrix(),k=K.o.TransformNormal(this._localDirection,n);k.normalize(),this._soundPanner.orientationX.value=k.x,this._soundPanner.orientationY.value=k.y,this._soundPanner.orientationZ.value=k.z}updateDistanceFromListener(){var n;if(null!==(n=yk.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const n=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Fg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,n,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(n){this._customAttenuationFunction=n}play(n,k,T){var c;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(c=yk.b.audioEngine)&&void 0!==c&&c.audioContext)try{var K,Q;this._clearTimeoutsAndObservers();let c=n?(null===(K=yk.b.audioEngine)||void 0===K?void 0:K.audioContext.currentTime)+n:null===(Q=yk.b.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=yk.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const n=()=>{var T;if(null!==(T=yk.b.audioEngine)&&void 0!==T&&T.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=k??0;const T=this._htmlAudioElement.play();void 0!==T&&T.catch((()=>{var k,T;(null===(k=yk.b.audioEngine)||void 0===k||k.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(T=yk.b.audioEngine)||void 0===T?void 0:T.onAudioUnlockedObservable.addOnce((()=>{n()})))}))}else{var c;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(c=yk.b.audioEngine)||void 0===c?void 0:c.onAudioUnlockedObservable.addOnce((()=>{n()}))}};n()}}else{var G;const K=()=>{var K;if(null!==(K=yk.b.audioEngine)&&void 0!==K&&K.audioContext){var Q;if(T=T||this._length,void 0!==k&&this._setOffset(k),this._soundSource){const n=this._soundSource;n.onended=()=>{n.disconnect()}}if(this._soundSource=null===(Q=yk.b.audioEngine)||void 0===Q?void 0:Q.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var G;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==k&&(this._soundSource.loopStart=k),void 0!==T&&(this._soundSource.loopEnd=(0|k)+T),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},c=n?(null===(G=yk.b.audioEngine)||void 0===G?void 0:G.audioContext.currentTime)+n:yk.b.audioEngine.audioContext.currentTime;const K=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(c,K,this.loop?void 0:T)}}};"suspended"===(null===(G=yk.b.audioEngine)||void 0===G?void 0:G.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var n;"suspended"===(null===(n=yk.b.audioEngine)||void 0===n?void 0:n.audioContext.state)?(yk.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=yk.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{K()})))):K()}),500):K()}this._startTime=c,this.isPlaying=!0,this.isPaused=!1}catch(w){s.d.Error("Error while trying to play audio: "+this.name+", "+w.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(n){var k;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var T;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(T=this._streamingSource)||void 0===T||T.disconnect();this.isPlaying=!1}else if(null!==(k=yk.b.audioEngine)&&void 0!==k&&k.audioContext&&this._soundSource){const k=n?yk.b.audioEngine.audioContext.currentTime+n:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(k)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var n;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var k;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(k=this._streamingSource)||void 0===k||k.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(n=yk.b.audioEngine)&&void 0!==n&&n.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=yk.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(n,k){var T;null!==(T=yk.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._soundGain&&(k&&yk.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(yk.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,yk.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(n,yk.b.audioEngine.audioContext.currentTime+k)):this._soundGain.gain.value=n),this._volume=n}setPlaybackRate(n){this._playbackRate=n,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(n){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=n,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=n=>this._onRegisterAfterWorldMatrixUpdate(n),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(n){var k;if(n.getBoundingInfo){const k=n.getBoundingInfo();this.setPosition(k.boundingSphere.centerWorld)}else this.setPosition(n.absolutePosition);null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const n=()=>{(0,Nk.f)((()=>this._isReadyToPlay),(()=>{T._audioBuffer=this.getAudioBuffer(),T._isReadyToPlay=!0,T.autoplay&&T.play(0,this._offset,this._length)}),void 0,300)},k={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},T=new nT(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,k);return this.useCustomAttenuation&&T.setAttenuationFunction(this._customAttenuationFunction),T.setPosition(this._position),T.setPlaybackRate(this._playbackRate),n(),T}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const n={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(n.connectedMeshId=this._connectedTransformNode.id),n.position=this._position.wi(),n.refDistance=this.refDistance,n.distanceModel=this.distanceModel,n.isDirectional=this._isDirectional,n.localDirectionToMesh=this._localDirection.wi(),n.coneInnerAngle=this._coneInnerAngle,n.coneOuterAngle=this._coneOuterAngle,n.coneOuterGain=this._coneOuterGain),n}static Parse(n,k,T,c){const Q=n.name;let G;G=n.url?T+n.url:T+Q;const w={autoplay:n.autoplay,loop:n.loop,volume:n.volume,spatialSound:n.spatialSound,maxDistance:n.maxDistance,rolloffFactor:n.rolloffFactor,refDistance:n.refDistance,distanceModel:n.distanceModel,playbackRate:n.playbackRate};let E;if(c){const n=()=>{(0,Nk.f)((()=>c._isReadyToPlay),(()=>{E._audioBuffer=c.getAudioBuffer(),E._isReadyToPlay=!0,E.autoplay&&E.play(0,E._offset,E._length)}),void 0,300)};E=new nT(Q,new ArrayBuffer(0),k,null,w),n()}else E=new nT(Q,G,k,(()=>{k.removePendingData(E)}),w),k.addPendingData(E);if(n.position){const k=K.o.ji(n.position);E.setPosition(k)}if(n.isDirectional&&(E.setDirectionalCone(n.coneInnerAngle||360,n.coneOuterAngle||360,n.coneOuterGain||0),n.localDirectionToMesh)){const k=K.o.ji(n.localDirectionToMesh);E.setLocalDirectionToMesh(k)}if(n.connectedMeshId){const T=k.getMeshById(n.connectedMeshId);T&&E.attachToMesh(T)}return n.metadata&&(E.metadata=n.metadata),E}_setOffset(n){this._offset!==n&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=n)}_clearTimeoutsAndObservers(){var n;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(n=yk.b.audioEngine)||void 0===n||n.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}nT._SceneComponentInitialization=n=>{throw(0,Xk.e)("AudioSceneComponent")},(0,f.f)("BABYLON.Sound",nT);class kT{constructor(n,k,T){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],k.length!==T.length)throw new Error("Sounds length does not equal weights length");this.loop=n,this._weights=T;let c=0;for(const Q of T)c+=Q;const K=c>0?1/c:0;for(let Q=0;Q<this._weights.length;Q++)this._weights[Q]*=K;this._sounds=k;for(const Q of this._sounds)Q.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(n){if(n!==this._coneInnerAngle){if(this._coneOuterAngle<n)return void s.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=n;for(const k of this._sounds)k.directionalConeInnerAngle=n}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(n){if(n!==this._coneOuterAngle){if(n<this._coneInnerAngle)return void s.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=n;for(const k of this._sounds)k.directionalConeOuterAngle=n}}get volume(){return this._volume}set volume(n){if(n!==this._volume)for(const k of this._sounds)k.setVolume(n)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(n){if(!this.isPaused){this.stop();const n=Math.random();let k=0;for(let T=0;T<this._weights.length;T++)if(k+=this._weights[T],n<=k){this._currentIndex=T;break}}const k=this._sounds[this._currentIndex??0];k.isReady()?k.play(0,this.isPaused?void 0:n):k.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class TT{constructor(n){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(n=n||H.e.LastCreatedScene)&&(this._scene=n,this.soundCollection=[],this._options=k,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var n;null!==(n=yk.b.audioEngine)&&void 0!==n&&n.canUseWebAudio&&yk.b.audioEngine.audioContext&&(this._outputAudioNode=yk.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(yk.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(yk.b.audioEngine&&yk.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(n){var k;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&n.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==n.soundTrackId&&(-1===n.soundTrackId?this._scene.mainSoundTrack.removeSound(n):this._scene.soundTracks&&this._scene.soundTracks[n.soundTrackId].removeSound(n)),this.soundCollection.push(n),n.soundTrackId=this.id}removeSound(n){const k=this.soundCollection.indexOf(n);-1!==k&&this.soundCollection.splice(k,1)}setVolume(n){var k;null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=n)}switchPanningModelToHRTF(){var n;if(null!==(n=yk.b.audioEngine)&&void 0!==n&&n.canUseWebAudio)for(let k=0;k<this.soundCollection.length;k++)this.soundCollection[k].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var n;if(null!==(n=yk.b.audioEngine)&&void 0!==n&&n.canUseWebAudio)for(let k=0;k<this.soundCollection.length;k++)this.soundCollection[k].switchPanningModelToEqualPower()}connectToAnalyser(n){var k;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=n,null!==(k=yk.b.audioEngine)&&void 0!==k&&k.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,yk.b.audioEngine.masterGain))}}var cT=T(940),KT=T(2475),QT=T(551);yk.b.AudioEngineFactory=(n,k,T)=>new GT(n,k,T);class GT{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.b,this.onAudioLockedObservable=new S.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,QT.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const c=document.createElement("audio");this._hostElement=n,this._audioContext=k,this._audioDestination=T;try{c&&c.canPlayType&&(c.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||c.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(K){}try{c&&c.canPlayType&&c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(K){}}lock(){this._triggerSuspendedState()}unlock(){var n,k;if("running"===(null===(n=this._audioContext)||void 0===n?void 0:n.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(k=this._audioContext)||void 0===k||k.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{s.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var n;null===(n=this._audioContext)||void 0===n||n.addEventListener("statechange",(()=>{var n;this.unlocked&&"running"!==(null===(n=this._audioContext)||void 0===n?void 0:n.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var n;return null!==(n=this._audioContext)&&void 0!==n&&n.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(n){this.canUseWebAudio=!1,s.d.Error("Web Audio: "+n.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(n){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const n=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",k=document.createElement("style");k.appendChild(document.createTextNode(n)),document.getElementsByTagName("head")[0].appendChild(k),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var n;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(n=this._audioContext)||void 0===n||n.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(n){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=n)}connectToAnalyser(n){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=n,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var wT=T(573);(0,T(12442).f)(cT.e.NAME_AUDIO,((n,k,T,c)=>{let K,Q=[];if(T.dm=T.dm||[],void 0!==n.dm&&null!==n.dm)for(let w=0,E=n.dm.length;w<E;w++){var G;const E=n.dm[w];null!==(G=yk.b.audioEngine)&&void 0!==G&&G.canUseWebAudio?(E.url||(E.url=E.name),Q[E.url]?T.dm.push(nT.Parse(E,k,c,Q[E.url])):(K=nT.Parse(E,k,c),Q[E.url]=K,T.dm.push(K))):T.dm.push(new nT(E.name,null,k))}Q=[]})),Object.defineProperty(KT.c.prototype,"mainSoundTrack",{get:function(){let n=this._getComponent(cT.e.NAME_AUDIO);return n||(n=new ET(this),this.o(n)),this._mainSoundTrack||(this._mainSoundTrack=new TT(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),KT.c.prototype.getSoundByName=function(n){let k;for(k=0;k<this.mainSoundTrack.soundCollection.length;k++)if(this.mainSoundTrack.soundCollection[k].name===n)return this.mainSoundTrack.soundCollection[k];if(this.soundTracks)for(let T=0;T<this.soundTracks.length;T++)for(k=0;k<this.soundTracks[T].soundCollection.length;k++)if(this.soundTracks[T].soundCollection[k].name===n)return this.soundTracks[T].soundCollection[k];return null},Object.defineProperty(KT.c.prototype,"audioEnabled",{get:function(){let n=this._getComponent(cT.e.NAME_AUDIO);return n||(n=new ET(this),this.o(n)),n.audioEnabled},set:function(n){let k=this._getComponent(cT.e.NAME_AUDIO);k||(k=new ET(this),this.o(k)),n?k.enableAudio():k.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(KT.c.prototype,"headphone",{get:function(){let n=this._getComponent(cT.e.NAME_AUDIO);return n||(n=new ET(this),this.o(n)),n.headphone},set:function(n){let k=this._getComponent(cT.e.NAME_AUDIO);k||(k=new ET(this),this.o(k)),n?k.switchAudioModeForHeadphones():k.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(KT.c.prototype,"audioListenerPositionProvider",{get:function(){let n=this._getComponent(cT.e.NAME_AUDIO);return n||(n=new ET(this),this.o(n)),n.audioListenerPositionProvider},set:function(n){let k=this._getComponent(cT.e.NAME_AUDIO);if(k||(k=new ET(this),this.o(k)),n&&"function"!==typeof n)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");k.audioListenerPositionProvider=n},enumerable:!0,configurable:!0}),Object.defineProperty(KT.c.prototype,"audioListenerRotationProvider",{get:function(){let n=this._getComponent(cT.e.NAME_AUDIO);return n||(n=new ET(this),this.o(n)),n.audioListenerRotationProvider},set:function(n){let k=this._getComponent(cT.e.NAME_AUDIO);if(k||(k=new ET(this),this.o(k)),n&&"function"!==typeof n)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");k.audioListenerRotationProvider=n},enumerable:!0,configurable:!0}),Object.defineProperty(KT.c.prototype,"audioPositioningRefreshRate",{get:function(){let n=this._getComponent(cT.e.NAME_AUDIO);return n||(n=new ET(this),this.o(n)),n.audioPositioningRefreshRate},set:function(n){let k=this._getComponent(cT.e.NAME_AUDIO);k||(k=new ET(this),this.o(k)),k.audioPositioningRefreshRate=n},enumerable:!0,configurable:!0});class ET{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(n){this.name=cT.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new K.o,this._cachedCameraPosition=new K.o,this._lastCheck=0,this._invertMatrixTemp=new K.d,this._cameraDirectionTemp=new K.o,(n=n||H.e.LastCreatedScene)&&(this.me=n,n.soundTracks=[],n.dm=[])}register(){this.me._afterRenderStage.registerStep(cT.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(n){if(n.dm=[],this.me.soundTracks)for(let k=0;k<this.me.soundTracks.length;k++){const T=this.me.soundTracks[k];for(let k=0;k<T.soundCollection.length;k++)n.dm.push(T.soundCollection[k].serialize())}}addFromContainer(n){if(n.dm)for(const k of n.dm)k.play(),k.autoplay=!0,this.me.mainSoundTrack.addSound(k)}removeFromContainer(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n.dm)for(const T of n.dm)T.stop(),T.autoplay=!1,this.me.mainSoundTrack.removeSound(T),k&&T.dispose()}dispose(){const n=this.me;if(n._mainSoundTrack&&n.mainSoundTrack.dispose(),n.soundTracks)for(let k=0;k<n.soundTracks.length;k++)n.soundTracks[k].dispose()}disableAudio(){const n=this.me;let k;for(this._audioEnabled=!1,yk.b.audioEngine&&yk.b.audioEngine.audioContext&&yk.b.audioEngine.audioContext.suspend(),k=0;k<n.mainSoundTrack.soundCollection.length;k++)n.mainSoundTrack.soundCollection[k].pause();if(n.soundTracks)for(k=0;k<n.soundTracks.length;k++)for(let T=0;T<n.soundTracks[k].soundCollection.length;T++)n.soundTracks[k].soundCollection[T].pause()}enableAudio(){const n=this.me;let k;for(this._audioEnabled=!0,yk.b.audioEngine&&yk.b.audioEngine.audioContext&&yk.b.audioEngine.audioContext.resume(),k=0;k<n.mainSoundTrack.soundCollection.length;k++)n.mainSoundTrack.soundCollection[k].isPaused&&n.mainSoundTrack.soundCollection[k].play();if(n.soundTracks)for(k=0;k<n.soundTracks.length;k++)for(let T=0;T<n.soundTracks[k].soundCollection.length;T++)n.soundTracks[k].soundCollection[T].isPaused&&n.soundTracks[k].soundCollection[T].play()}switchAudioModeForHeadphones(){const n=this.me;if(this._headphone=!0,n.mainSoundTrack.switchPanningModelToHRTF(),n.soundTracks)for(let k=0;k<n.soundTracks.length;k++)n.soundTracks[k].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const n=this.me;if(this._headphone=!1,n.mainSoundTrack.switchPanningModelToEqualPower(),n.soundTracks)for(let k=0;k<n.soundTracks.length;k++)n.soundTracks[k].switchPanningModelToEqualPower()}_afterRender(){const n=wT.e.Now;if(this._lastCheck&&n-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=n;const k=this.me;if(!this._audioEnabled||!k._mainSoundTrack||!k.soundTracks||0===k._mainSoundTrack.soundCollection.length&&1===k.soundTracks.length)return;const T=yk.b.audioEngine;if(T&&T.audioContext){let n,c=k.activeCamera;if(k.activeCameras&&k.activeCameras.length>0&&(c=k.activeCameras[0]),this.audioListenerPositionProvider){const n=this.audioListenerPositionProvider();T.audioContext.listener.setPosition(n.x||0,n.y||0,n.z||0)}else c?this._cachedCameraPosition.equals(c.globalPosition)||(this._cachedCameraPosition.p(c.globalPosition),T.audioContext.listener.setPosition(c.globalPosition.x,c.globalPosition.y,c.globalPosition.z)):T.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const n=this.audioListenerRotationProvider();T.audioContext.listener.setOrientation(n.x||0,n.y||0,n.z||0,0,1,0)}else c?(c.rigCameras&&c.rigCameras.length>0&&(c=c.rigCameras[0]),c.getViewMatrix().invertToRef(this._invertMatrixTemp),K.o.TransformNormalToRef(ET._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),T.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):T.audioContext.listener.setOrientation(0,0,0,0,1,0);for(n=0;n<k.mainSoundTrack.soundCollection.length;n++){const T=k.mainSoundTrack.soundCollection[n];T.useCustomAttenuation&&T.updateDistanceFromListener()}if(k.soundTracks)for(n=0;n<k.soundTracks.length;n++)for(let T=0;T<k.soundTracks[n].soundCollection.length;T++){const c=k.soundTracks[n].soundCollection[T];c.useCustomAttenuation&&c.updateDistanceFromListener()}}}}ET._CameraDirection=new K.o(0,0,-1),nT._SceneComponentInitialization=n=>{let k=n._getComponent(cT.e.NAME_AUDIO);k||(k=new ET(n),n.o(k))};const IT="MSFT_audio_emitter";class ST{constructor(n){this.name=IT,this._loader=n,this.enabled=this._loader.isExtensionUsed(IT)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const n=this._loader.Di.extensions;if(n&&n[this.name]){const k=n[this.name];this._clips=k.clips,this._emitters=k.emitters,j.Assign(this._clips),j.Assign(this._emitters)}}loadSceneAsync(n,k){return a.LoadExtensionAsync(n,k,this.name,(async(T,c)=>{const K=new Array;K.push(this._loader.loadSceneAsync(n,k));for(const n of c.emitters){const k=j.Get(`${T}/emitters`,this._emitters,n);if(void 0!=k.refDistance||void 0!=k.maxDistance||void 0!=k.rolloffFactor||void 0!=k.distanceModel||void 0!=k.innerAngle||void 0!=k.outerAngle)throw new Error(`${T}: Direction or Distance properties are not allowed on emitters attached to a scene`);K.push(this._loadEmitterAsync(`${T}/emitters/${k.index}`,k))}await Promise.all(K)}))}loadNodeAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(n,c)=>{const Q=new Array,w=await this._loader.loadNodeAsync(n,k,(k=>{for(const T of c.emitters){const c=j.Get(`${n}/emitters`,this._emitters,T);Q.push(this._loadEmitterAsync(`${n}/emitters/${c.index}`,c).then((()=>{for(const n of c._babylonSounds)n.attachToMesh(k),void 0==c.innerAngle&&void 0==c.outerAngle||(n.setLocalDirectionToMesh(K.o.Forward()),n.setDirectionalCone(2*G.e.ToDegrees(void 0==c.innerAngle?Math.PI:c.innerAngle),2*G.e.ToDegrees(void 0==c.outerAngle?Math.PI:c.outerAngle),0))})))}T(k)}));return await Promise.all(Q),w}))}loadAnimationAsync(n,k){return a.LoadExtensionAsync(n,k,this.name,(async(T,c)=>{const K=await this._loader.loadAnimationAsync(n,k),Q=new Array;j.Assign(c.events);for(const G of c.events)Q.push(this._loadAnimationEventAsync(`${T}/events/${G.index}`,n,k,G,K));return await Promise.all(Q),K}))}_loadClipAsync(n,k){if(k._objectURL)return k._objectURL;let T;if(k.uri)T=this._loader.loadUriAsync(n,k,k.uri);else{const c=j.Get(`${n}/bufferView`,this._loader.Di.bufferViews,k.bufferView);T=this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return k._objectURL=T.then((n=>URL.createObjectURL(new Blob([n],{type:k.mimeType})))),k._objectURL}_loadEmitterAsync(n,k){if(k._babylonSounds=k._babylonSounds||[],!k._babylonData){const n=new Array,T=k.name||`emitter${k.index}`,c={loop:!1,autoplay:!1,volume:void 0==k.volume?1:k.volume};for(let Q=0;Q<k.clips.length;Q++){const K=`/extensions/${this.name}/clips`,G=j.Get(K,this._clips,k.clips[Q].clip);n.push(this._loadClipAsync(`${K}/${k.clips[Q].clip}`,G).then((n=>{const K=k._babylonSounds[Q]=new nT(T,n,this._loader.babylonScene,null,c);K.refDistance=k.refDistance||1,K.maxDistance=k.maxDistance||256,K.rolloffFactor=k.rolloffFactor||1,K.distanceModel=k.distanceModel||"exponential"})))}const K=Promise.all(n).then((()=>{const n=k.clips.map((n=>n.weight||1)),T=new kT(k.loop||!1,k._babylonSounds,n);k.innerAngle&&(T.directionalConeInnerAngle=2*G.e.ToDegrees(k.innerAngle)),k.outerAngle&&(T.directionalConeOuterAngle=2*G.e.ToDegrees(k.outerAngle)),k.volume&&(T.volume=k.volume),k._babylonData.sound=T}));k._babylonData={loaded:K}}return k._babylonData.loaded}_getEventAction(n,k,T,c,K){switch(T){case"play":return n=>{const T=(K||0)+(n-c);k.play(T)};case"stop":return()=>{k.stop()};case"pause":return()=>{k.pause()};default:throw new Error(`${n}: Unsupported action ${T}`)}}_loadAnimationEventAsync(n,k,T,c,K){if(0==K.targetedAnimations.length)return Promise.resolve();const Q=K.targetedAnimations[0],G=c.j,w=j.Get(`/extensions/${this.name}/emitters`,this._emitters,G);return this._loadEmitterAsync(n,w).then((()=>{const k=w._babylonData.sound;if(k){const T=new ak(c.time,this._getEventAction(n,k,c.action,c.time,c.startOffset));Q.animation.addEvent(T),K.onAnimationGroupEndObservable.add((()=>{k.stop()})),K.onAnimationGroupPauseObservable.add((()=>{k.pause()}))}}))}}D(IT),o(IT,!0,(n=>new ST(n)));const PT="MSFT_lod";class WT{constructor(n){var k;this.name=PT,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new S.b,this.onMaterialLODsLoadedObservable=new S.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=n,this.maxLODsToLoad=(null===(k=this._loader.parent.extensionOptions[PT])||void 0===k?void 0:k.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(PT)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let n=0;n<this._nodePromiseLODs.length;n++){const k=Promise.all(this._nodePromiseLODs[n]).then((()=>{0!==n&&(this._loader.endPerformanceCounter(`Node LOD ${n}`),this._loader.log(`Loaded node LOD ${n}`)),this.onNodeLODsLoadedObservable.notifyObservers(n),n!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${n+1}`),this._loadBufferLOD(this._nodeBufferLODs,n+1),this._nodeSignalLODs[n]&&this._nodeSignalLODs[n].resolve())}));this._loader._completePromises.push(k)}for(let n=0;n<this._materialPromiseLODs.length;n++){const k=Promise.all(this._materialPromiseLODs[n]).then((()=>{0!==n&&(this._loader.endPerformanceCounter(`Material LOD ${n}`),this._loader.log(`Loaded material LOD ${n}`)),this.onMaterialLODsLoadedObservable.notifyObservers(n),n!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${n+1}`),this._loadBufferLOD(this._materialBufferLODs,n+1),this._materialSignalLODs[n]&&this._materialSignalLODs[n].resolve())}));this._loader._completePromises.push(k)}}loadSceneAsync(n,k){const T=this._loader.loadSceneAsync(n,k);return this._loadBufferLOD(this._bufferLODs,0),T}loadNodeAsync(n,k,T){return a.LoadExtensionAsync(n,k,this.name,(async(n,K)=>{let Q;const G=this._getLODs(n,k,this._loader.Di.nodes,K.ids);this._loader.logOpen(`${n}`);for(let k=0;k<G.length;k++){const n=G[k];0!==k&&(this._nodeIndexLOD=k,this._nodeSignalLODs[k]=this._nodeSignalLODs[k]||new c);const K=n=>{T(n),n._h(!1)},w=this._loader.loadNodeAsync(`/nodes/${n.index}`,n,K).then((n=>{if(0!==k){const n=G[k-1];n._babylonTransformNode&&(this._disposeTransformNode(n._babylonTransformNode),delete n._babylonTransformNode)}return n._h(!0),n}));this._nodePromiseLODs[k]=this._nodePromiseLODs[k]||[],0===k?Q=w:(this._nodeIndexLOD=null,this._nodePromiseLODs[k].push(w))}return this._loader.logClose(),await Q}))}_loadMaterialAsync(n,k,T,c,K){return this._nodeIndexLOD?null:a.LoadExtensionAsync(n,k,this.name,(async(n,Q)=>{let G;const w=this._getLODs(n,k,this._loader.Di.materials,Q.ids);this._loader.logOpen(`${n}`);for(let k=0;k<w.length;k++){const n=w[k];0!==k&&(this._materialIndexLOD=k);const Q=this._loader._loadMaterialAsync(`/materials/${n.index}`,n,T,c,(n=>{0===k&&K(n)})).then((n=>{if(0!==k){K(n);const T=w[k-1]._data;T[c]&&(this._disposeMaterials([T[c].babylonMaterial]),delete T[c])}return n}));this._materialPromiseLODs[k]=this._materialPromiseLODs[k]||[],0===k?G=Q:(this._materialIndexLOD=null,this._materialPromiseLODs[k].push(Q))}return this._loader.logClose(),await G}))}_loadUriAsync(n,k,T){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const K=this._nodeIndexLOD-1;return this._nodeSignalLODs[K]=this._nodeSignalLODs[K]||new c,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(n,k,T)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const K=this._materialIndexLOD-1;return this._materialSignalLODs[K]=this._materialSignalLODs[K]||new c,this._materialSignalLODs[K].promise.then((async()=>await this._loader.loadUriAsync(n,k,T)))}return null}loadBufferAsync(n,k,T,K){if(this._loader.parent.useRangeRequests&&!k.uri){if(!this._loader.bin)throw new Error(`${n}: Uri is missing or the binary glTF is missing its binary chunk`);const k=async(n,k)=>{const Q=T,G=Q+K-1;let w=n[k];return w?(w.start=Math.min(w.start,Q),w.end=Math.max(w.end,G)):(w={start:Q,end:G,loaded:new c},n[k]=w),await w.loaded.promise.then((n=>new Uint8Array(n.buffer,n.byteOffset+T-w.start,K)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?k(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?k(this._materialBufferLODs,this._materialIndexLOD):k(this._bufferLODs,0)}return null}_loadBufferLOD(n,k){const T=n[k];T&&(this._loader.log(`Loading buffer range [${T.start}-${T.end}]`),this._loader.bin.readAsync(T.start,T.end-T.start+1).then((n=>{T.loaded.resolve(n)}),(n=>{T.loaded.reject(n)})))}_getLODs(n,k,T,c){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const K=[];for(let Q=c.length-1;Q>=0;Q--)if(K.push(j.Get(`${n}/ids/${c[Q]}`,T,c[Q])),K.length===this.maxLODsToLoad)return K;return K.push(k),K}_disposeTransformNode(n){const k=[],T=n.material;T&&k.push(T);for(const K of n.getChildMeshes())K.material&&k.push(K.material);n.dispose();const c=k.filter((n=>this._loader.babylonScene.meshes.every((k=>k.material!=n))));this._disposeMaterials(c)}_disposeMaterials(n){const k={};for(const T of n){for(const n of T.getActiveTextures())k[n.uniqueId]=n;T.dispose()}for(const T in k)for(const n of this._loader.babylonScene.materials)n.hasTexture(k[T])&&delete k[T];for(const T in k)k[T].dispose()}}D(PT),o(PT,!0,(n=>new WT(n)));const JT="MSFT_minecraftMesh";class HT{constructor(n){this.name=JT,this._loader=n,this.enabled=this._loader.isExtensionUsed(JT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtraAsync(n,k,this.name,(async(c,K)=>{if(K){if(!(T instanceof v))throw new Error(`${c}: Material type not supported`);const K=this._loader.loadMaterialPropertiesAsync(n,k,T);return T.needAlphaBlending()&&(T.forceDepthWrite=!0,T.separateCullingPass=!0),T.ui=T.forceDepthWrite,T.twoSidedLighting=!0,await K}}))}}D(JT),o(JT,!0,(n=>new HT(n)));const sT="MSFT_sRGBFactors";class bT{constructor(n){this.name=sT,this._loader=n,this.enabled=this._loader.isExtensionUsed(sT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,k,T){return a.LoadExtraAsync(n,k,this.name,(async(c,K)=>{if(K){if(!(T instanceof v))throw new Error(`${c}: Material type not supported`);const K=this._loader.loadMaterialPropertiesAsync(n,k,T),Q=T.va().getEngine().useExactSrgbConversions;return T.albedoTexture||T.albedoColor.toLinearSpaceToRef(T.albedoColor,Q),T.reflectivityTexture||T.reflectivityColor.toLinearSpaceToRef(T.reflectivityColor,Q),await K}}))}}D(sT),o(sT,!0,(n=>new bT(n)));var CT=T(12817);const zT={};var rT=T(12869),qT=T(12843),OT=T(12821),uT=T(12831);function fT(n,k){for(const T of n)for(const n of T.dataOutputs)if(n.uniqueId===k)return n;throw new Error("Could not find data out connection with unique id "+k)}function AT(n,k){for(const T of n)if(T instanceof qT.d)for(const n of T.signalInputs)if(n.uniqueId===k)return n;throw new Error("Could not find signal in connection with unique id "+k)}async function vT(n,k){const c=await Promise.all(n.allBlocks.map((async n=>{const k=function(n){switch(n){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([T.e(49),T.e(54)]).then(T.bind(T,13976))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await T.e(55).then(T.bind(T,13980))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await T.e(56).then(T.bind(T,13989))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await T.e(57).then(T.bind(T,13992))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await T.e(58).then(T.bind(T,14001))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await T.e(59).then(T.bind(T,14009))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await T.e(60).then(T.bind(T,14016))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await T.e(61).then(T.bind(T,14024))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await T.e(62).then(T.bind(T,14031))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await T.e(65).then(T.bind(T,14064))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await T.e(65).then(T.bind(T,14064))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await T.e(65).then(T.bind(T,14064))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await T.e(65).then(T.bind(T,14064))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await T.e(70).then(T.bind(T,14069))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await T.e(71).then(T.bind(T,14076))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await T.e(72).then(T.bind(T,14078))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await T.e(73).then(T.bind(T,14083))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await T.e(74).then(T.bind(T,14089))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await T.e(75).then(T.bind(T,14094))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await T.e(76).then(T.bind(T,14098))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await T.e(77).then(T.bind(T,14106))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await T.e(78).then(T.bind(T,14108))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await T.e(79).then(T.bind(T,14110))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await T.e(80).then(T.bind(T,14112))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await T.e(81).then(T.bind(T,14120))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await T.e(82).then(T.bind(T,14125))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await T.e(83).then(T.bind(T,14131))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await T.e(84).then(T.bind(T,14140))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await T.e(85).then(T.bind(T,14149))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await T.e(86).then(T.bind(T,14152))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await T.e(87).then(T.bind(T,14159))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await T.e(88).then(T.bind(T,14167))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await T.e(67).then(T.bind(T,14171))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await T.e(89).then(T.bind(T,14173))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await T.e(90).then(T.bind(T,14181))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await T.e(91).then(T.bind(T,14189))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await T.e(68).then(T.bind(T,14192))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await T.e(63).then(T.bind(T,14038))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await T.e(69).then(T.bind(T,14194))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await T.e(64).then(T.bind(T,14061))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await T.e(65).then(T.bind(T,14064))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await T.e(65).then(T.bind(T,14064))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await T.e(66).then(T.bind(T,14203))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await T.e(66).then(T.bind(T,14203))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await T.e(66).then(T.bind(T,14203))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await T.e(66).then(T.bind(T,14203))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await T.e(66).then(T.bind(T,14203))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await T.e(66).then(T.bind(T,14203))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await T.e(92).then(T.bind(T,14209))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await T.e(93).then(T.bind(T,14218))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await T.e(94).then(T.bind(T,14222))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await T.e(95).then(T.bind(T,14227))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await T.e(96).then(T.bind(T,14229))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await T.e(97).then(T.bind(T,14238))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await T.e(98).then(T.bind(T,14241))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await T.e(99).then(T.bind(T,14247))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await T.e(100).then(T.bind(T,14249))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await T.e(101).then(T.bind(T,14257))).FlowGraphDataSwitchBlock;default:if(zT[n])return zT[n];throw new Error(`Unknown block name ${n}`)}}(n.className);return await k()})));return function(n,k,T){const c=k.coordinator.createGraph(),K=[],Q=k.valueParseFunction??OT.d;for(let G=0;G<n.allBlocks.length;G++){const w=mT(n.allBlocks[G],{me:k.coordinator.config.me,pathConverter:k.pathConverter,assetsContainer:k.coordinator.config.me,valueParseFunction:Q},T[G]);K.push(w),w instanceof rT.d&&c.addEventBlock(w)}for(const G of K){for(const n of G.dataInputs)for(const k of n.connectedPointIds){const T=fT(K,k);n.connectTo(T)}if(G instanceof qT.d)for(const n of G.signalOutputs)for(const k of n.connectedPointIds){const T=AT(K,k);n.connectTo(T)}}for(const G of n.executionContexts)FT(G,{graph:c,valueParseFunction:Q},n.rightHanded);return c}(n,k,c)}function FT(n,k,T){const c=k.graph.createContext();n.enableLogging&&(c.enableLogging=!0),c.treatDataAsRightHanded=T||!1;const K=k.valueParseFunction??OT.d;c.uniqueId=n.uniqueId;const Q=c.va();if(n._assetsContext){var G,w,E,I,S,P,W,J,H,s;const k=n._assetsContext,T={meshes:null===(G=k.meshes)||void 0===G?void 0:G.map((n=>Q.getMeshById(n))),lights:null===(w=k.lights)||void 0===w?void 0:w.map((n=>Q.getLightByName(n))),cameras:null===(E=k.cameras)||void 0===E?void 0:E.map((n=>Q.getCameraByName(n))),materials:null===(I=k.materials)||void 0===I?void 0:I.map((n=>Q.getMaterialById(n))),textures:null===(S=k.textures)||void 0===S?void 0:S.map((n=>Q.getTextureByName(n))),animations:null===(P=k.animations)||void 0===P?void 0:P.map((n=>Q.animations.find((k=>k.name===n)))),skeletons:null===(W=k.skeletons)||void 0===W?void 0:W.map((n=>Q.getSkeletonByName(n))),oi:null===(J=k.oi)||void 0===J?void 0:J.map((n=>Q.getParticleSystemById(n))),animationGroups:null===(H=k.animationGroups)||void 0===H?void 0:H.map((n=>Q.getAnimationGroupByName(n))),transformNodes:null===(s=k.transformNodes)||void 0===s?void 0:s.map((n=>Q.getTransformNodeById(n))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],dm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};c.assetsContext=T}for(const b in n._userVariables){const k=K(b,n._userVariables,c.assetsContext,Q);c.userVariables[b]=k}for(const b in n._connectionValues){const k=K(b,n._connectionValues,c.assetsContext,Q);c._setConnectionValueByKey(b,k)}return c}function mT(n,k,T){const c={},K=k.valueParseFunction??OT.d;if(n.config)for(const G in n.config)c[G]=K(G,n.config,k.assetsContainer||k.me,k.me);if((0,OT.h)(n.className)){if(!k.pathConverter)throw new Error("Path converter is required for this block");c.pathConverter=k.pathConverter}const Q=new T(c);Q.uniqueId=n.uniqueId;for(let G=0;G<n.dataInputs.length;G++){const k=Q.getDataInput(n.dataInputs[G].name);if(!k)throw new Error("Could not find data input with name "+n.dataInputs[G].name+" in block "+n.className);k.deserialize(n.dataInputs[G])}for(let G=0;G<n.dataOutputs.length;G++){const k=Q.getDataOutput(n.dataOutputs[G].name);if(!k)throw new Error("Could not find data output with name "+n.dataOutputs[G].name+" in block "+n.className);k.deserialize(n.dataOutputs[G])}return Q.metadata=n.metadata,Q.deserialize&&Q.deserialize(n),Q}function xT(n){const[k,T]=n.split(":");return gT({op:k,extension:T})}function gT(n){var k;let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const c=n.extension?null===(k=VT[n.extension])||void 0===k?void 0:k[n.op]:YT[n.op];if(!c&&(s.d.Warn(`No mapping found for operation ${n.op} and extension ${n.extension||"KHR_interactivity"}`),T)){const k={},T={flows:{}};if(n.inputValueSockets){k.values={};for(const T in n.inputValueSockets)k.values[T]={name:T}}return n.outputValueSockets&&(T.values={},Object.keys(n.outputValueSockets).forEach((n=>{T.values[n]={name:n}}))),{$i:[],inputs:k,outputs:T}}return c}function UT(n,k,T){VT[k]||(VT[k]={}),VT[k][n]=T}const VT={BABYLON:{"flow/log":{$i:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},YT={"event/onStart":{$i:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{$i:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{$i:["FlowGraphSendCustomEventBlock"],extraProcessor(n,k,T,c,K){if("event/send"!==k.op||!n.configuration||1!==Object.keys(n.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Q=n.configuration.event.value[0];if("number"!==typeof Q)throw new Error("Event id should be a number");const G=c.arrays.events[Q],w=K[0];return w.config||(w.config={}),w.config.eventId=G.eventId,w.config.eventData=G.eventData,K}},"event/receive":{$i:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(n,k){var T;if(!n.configuration)return s.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const c=n.configuration.event;if(!c)return s.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const K=c.value[0];if("number"!==typeof K)return s.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(T=k.events)||void 0===T?void 0:T[K])?{valid:!0}:(s.d.Error(`Event with id ${K} not found`),{valid:!1,error:`Event with id ${K} not found`})},extraProcessor(n,k,T,c,K){if("event/receive"!==k.op||!n.configuration||1!==Object.keys(n.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Q=n.configuration.event.value[0];if("number"!==typeof Q)throw new Error("Event id should be a number");const G=c.arrays.events[Q],w=K[0];return w.config||(w.config={}),w.config.eventId=G.eventId,w.config.eventData=G.eventData,K}},"math/e":ZT("FlowGraphEBlock"),"math/pi":ZT("FlowGraphPIBlock"),"math/inf":ZT("FlowGraphInfBlock"),"math/nan":ZT("FlowGraphNaNBlock"),"math/abs":ZT("FlowGraphAbsBlock"),"math/sign":ZT("FlowGraphSignBlock"),"math/trunc":ZT("FlowGraphTruncBlock"),"math/floor":ZT("FlowGraphFloorBlock"),"math/ceil":ZT("FlowGraphCeilBlock"),"math/round":{$i:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K){var Q;return(Q=K[0]).config||(Q.config={}),K[0].config.roundHalfAwayFromZero=!0,K}},"math/fract":ZT("FlowGraphFractBlock"),"math/neg":ZT("FlowGraphNegationBlock"),"math/add":ZT("FlowGraphAddBlock",["a","b"],!0),"math/sub":ZT("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{$i:["FlowGraphMultiplyBlock"],extraProcessor(n,k,T,c,K){var Q;(Q=K[0]).config||(Q.config={}),K[0].config.useMatrixPerComponent=!0,K[0].config.preventIntegerFloatArithmetic=!0;let G=-1;return Object.keys(n.values||{}).find((k=>{var T;return void 0!==(null===(T=n.values)||void 0===T?void 0:T[k].type)&&(G=n.values[k].type,!0)})),-1!==G&&(K[0].config.type=c.arrays.types[G].flowGraphType),K},validation:n=>n.values?eT(n):{valid:!0}},"math/div":ZT("FlowGraphDivideBlock",["a","b"],!0),"math/rem":ZT("FlowGraphModuloBlock",["a","b"]),"math/min":ZT("FlowGraphMinBlock",["a","b"]),"math/max":ZT("FlowGraphMaxBlock",["a","b"]),"math/clamp":ZT("FlowGraphClampBlock",["a","b","c"]),"math/saturate":ZT("FlowGraphSaturateBlock"),"math/mix":ZT("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":ZT("FlowGraphEqualityBlock",["a","b"]),"math/lt":ZT("FlowGraphLessThanBlock",["a","b"]),"math/le":ZT("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":ZT("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":ZT("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":ZT("FlowGraphIsNaNBlock"),"math/isinf":ZT("FlowGraphIsInfBlock"),"math/select":{$i:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{$i:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":ZT("FlowGraphSinBlock"),"math/cos":ZT("FlowGraphCosBlock"),"math/tan":ZT("FlowGraphTanBlock"),"math/asin":ZT("FlowGraphASinBlock"),"math/acos":ZT("FlowGraphACosBlock"),"math/atan":ZT("FlowGraphATanBlock"),"math/atan2":ZT("FlowGraphATan2Block",["a","b"]),"math/sinh":ZT("FlowGraphSinhBlock"),"math/cosh":ZT("FlowGraphCoshBlock"),"math/tanh":ZT("FlowGraphTanhBlock"),"math/asinh":ZT("FlowGraphASinhBlock"),"math/acosh":ZT("FlowGraphACoshBlock"),"math/atanh":ZT("FlowGraphATanhBlock"),"math/exp":ZT("FlowGraphExponentialBlock"),"math/log":ZT("FlowGraphLogBlock"),"math/log2":ZT("FlowGraphLog2Block"),"math/log10":ZT("FlowGraphLog10Block"),"math/sqrt":ZT("FlowGraphSquareRootBlock"),"math/cbrt":ZT("FlowGraphCubeRootBlock"),"math/pow":ZT("FlowGraphPowerBlock",["a","b"]),"math/length":ZT("FlowGraphLengthBlock"),"math/normalize":ZT("FlowGraphNormalizeBlock"),"math/dot":ZT("FlowGraphDotBlock",["a","b"]),"math/cross":ZT("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":ZT("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":ZT("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{$i:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{$i:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{$i:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{$i:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{$i:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{$i:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{$i:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":ZT("FlowGraphTransposeBlock"),"math/determinant":ZT("FlowGraphDeterminantBlock"),"math/inverse":ZT("FlowGraphInvertMatrixBlock"),"math/matmul":ZT("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{$i:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ei",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K,Q){const G=K[0].dataInputs.find((n=>"rotationQuaternion"===n.name));if(!G)throw new Error("Rotation quaternion input not found");return Q._connectionValues[G.uniqueId]&&(Q._connectionValues[G.uniqueId].type="Quaternion"),K}},"math/matDecompose":{$i:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ei"}}}},"math/quatConjugate":ZT("FlowGraphConjugateBlock",["a"]),"math/quatMul":{$i:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K){var Q;return(Q=K[0]).config||(Q.config={}),K[0].config.type="Quaternion",K}},"math/quatAngleBetween":ZT("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{$i:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":ZT("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":ZT("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{$i:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K){var Q;return(Q=K[0]).config||(Q.config={}),K[0].config.inputIsColumnMajor=!0,K}},"math/extract2x2":{$i:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{$i:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K){var Q;return(Q=K[0]).config||(Q.config={}),K[0].config.inputIsColumnMajor=!0,K}},"math/extract3x3":{$i:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{$i:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K){var Q;return(Q=K[0]).config||(Q.config={}),K[0].config.inputIsColumnMajor=!0,K}},"math/extract4x4":{$i:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{$i:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K,Q){var G,w;(w=K[0]).config||(w.config={});const E=K[0].dataInputs[0];return K[0].config.valueType=(null===(G=Q._connectionValues[E.uniqueId])||void 0===G?void 0:G.type)??"FlowGraphInteger",K}},"math/and":{$i:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K,Q){var G,w,E;(E=K[0]).config||(E.config={});const I=K[0].dataInputs[0],S=K[0].dataInputs[1];return K[0].config.valueType=(null===(G=Q._connectionValues[I.uniqueId])||void 0===G?void 0:G.type)??(null===(w=Q._connectionValues[S.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",K}},"math/or":{$i:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K,Q){var G,w,E;(E=K[0]).config||(E.config={});const I=K[0].dataInputs[0],S=K[0].dataInputs[1];return K[0].config.valueType=(null===(G=Q._connectionValues[I.uniqueId])||void 0===G?void 0:G.type)??(null===(w=Q._connectionValues[S.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",K}},"math/xor":{$i:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,k,T,c,K,Q){var G,w,E;(E=K[0]).config||(E.config={});const I=K[0].dataInputs[0],S=K[0].dataInputs[1];return K[0].config.valueType=(null===(G=Q._connectionValues[I.uniqueId])||void 0===G?void 0:G.type)??(null===(w=Q._connectionValues[S.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",K}},"math/asr":ZT("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":ZT("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":ZT("FlowGraphLeadingZerosBlock"),"math/ctz":ZT("FlowGraphTrailingZerosBlock"),"math/popcnt":ZT("FlowGraphOneBitsCounterBlock"),"math/rad":ZT("FlowGraphDegToRadBlock"),"math/deg":ZT("FlowGraphRadToDegBlock"),"type/boolToInt":ZT("FlowGraphBooleanToInt"),"type/boolToFloat":ZT("FlowGraphBooleanToFloat"),"type/intToBool":ZT("FlowGraphIntToBoolean"),"type/intToFloat":ZT("FlowGraphIntToFloat"),"type/floatToInt":ZT("FlowGraphFloatToInt"),"type/floatToBool":ZT("FlowGraphFloatToBoolean"),"flow/sequence":{$i:["FlowGraphSequenceBlock"],extraProcessor(n,k,T,c,K){const Q=K[0];return Q.config||(Q.config={}),Q.config.outputSignalCount=Object.keys(n.flows||[]).length,Q.signalOutputs.forEach(((n,k)=>{n.name="out_"+k})),K}},"flow/branch":{$i:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{$i:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(n){if(n.configuration&&n.configuration.cases){const k=n.configuration.cases.value;if(!k.every((n=>"number"===typeof n&&/^-?\d+$/.test(n.toString()))))return s.d.Warn("Switch cases should be integers. Using empty array instead."),n.configuration.cases.value=[],{valid:!0};const T=new Set(k);n.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(n,k,T,c,K){if("flow/switch"!==k.op||!n.flows||0===Object.keys(n.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return K[0].signalOutputs.forEach((n=>{"default"!==n.name&&(n.name="out_"+n.name)})),K}},"flow/while":{$i:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{$i:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(n,k,T,c,K){const Q=K[0];return Q.config||(Q.config={}),Q.config.incrementIndexWhenLoopDone=!0,K}},"flow/doN":{$i:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{$i:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(n,k,T,c,K){if("flow/multiGate"!==k.op||!n.flows||0===Object.keys(n.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const Q=K[0];return Q.config||(Q.config={}),Q.config.outputSignalCount=Object.keys(n.flows).length,Q.signalOutputs.forEach(((n,k)=>{n.name="out_"+k})),K}},"flow/waitAll":{$i:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(n){var k,T;return"number"!==typeof(null===(k=n.configuration)||void 0===k||null===(T=k.inputFlows)||void 0===T?void 0:T.value[0])&&(n.configuration=n.configuration||{inputFlows:{value:[0]}},n.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{$i:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{$i:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{$i:["FlowGraphCancelDelayBlock"]},"variable/get":{$i:["FlowGraphGetVariableBlock"],validation(n){var k,T;return null!==(k=n.configuration)&&void 0!==k&&null!==(T=k.variable)&&void 0!==T&&T.value?{valid:!0}:(s.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(n,k)=>[k.getVariableName(n[0])]}}},"variable/set":{$i:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(n,k)=>[k.getVariableName(n[0])]}}},"variable/setMultiple":{$i:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(n,k)=>[n[0].map((n=>k.getVariableName(n)))]}},extraProcessor:(n,k,T,c,K)=>(K[0].dataInputs.forEach((n=>{n.name=c.getVariableName(+n.name)})),K)},"variable/interpolate":{$i:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(n,k)=>[k.getVariableName(n[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:n=>!0===n[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(n,k,T,c,K){var Q,G,w;const E=K[0],I=null===(Q=n.configuration)||void 0===Q?void 0:Q.variable.value[0];if("number"!==typeof I)throw s.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const S=c.arrays.staticVariables[I];"undefined"===typeof E.config.animationType.value&&(c.arrays.staticVariables,E.config.animationType.value=(0,uT.G)(S.type));const P=K[4];return P.config||(P.config={}),(G=P.config).variable||(G.variable={}),P.config.variable.value=c.getVariableName(I),(w=K[3]).config||(w.config={}),K}},"pointer/get":{$i:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(n,k,T,c,K)=>(K.forEach((n=>{"FlowGraphJsonPointerParserBlock"===n.className&&(n.config||(n.config={}),n.config.outputValue=!0)})),K)},"pointer/set":{$i:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(n,k,T,c,K)=>(K.forEach((n=>{"FlowGraphJsonPointerParserBlock"===n.className&&(n.config||(n.config={}),n.config.outputValue=!0)})),K)},"pointer/interpolate":{$i:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(n,k,T,c,K)=>(K.forEach((k=>{"FlowGraphJsonPointerParserBlock"===k.className?(k.config||(k.config={}),k.config.outputValue=!0):"FlowGraphInterpolationBlock"===k.className&&(k.config||(k.config={}),Object.keys(n.values||[]).forEach((T=>{var K;const Q=null===(K=n.values)||void 0===K?void 0:K[T];if("value"===T&&Q){const n=Q.type;void 0!==n&&(k.config.animationType=c.arrays.types[n].flowGraphType)}})))})),K)},"animation/start":{$i:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(n,k)=>[n[0]*k._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(n,k)=>[n[0]*k._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(n,k,T,c,K,Q,G){const w=K[K.length-1];return w.config||(w.config={}),w.config.glTF=G,K}},"animation/stop":{$i:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(n,k,T,c,K,Q,G){const w=K[K.length-1];return w.config||(w.config={}),w.config.glTF=G,K}},"animation/stopAt":{$i:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(n,k)=>[n[0]*k._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(n,k,T,c,K,Q,G){const w=K[K.length-1];return w.config||(w.config={}),w.config.glTF=G,K}},"math/switch":{$i:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(n){if(n.configuration&&n.configuration.cases){const k=n.configuration.cases.value;if(!k.every((n=>"number"===typeof n&&/^-?\d+$/.test(n.toString()))))return s.d.Warn("Switch cases should be integers. Using empty array instead."),n.configuration.cases.value=[],{valid:!0};const T=new Set(k);n.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(n,k,T,c,K){const Q=K[0];return Q.dataInputs.forEach((n=>{"default"!==n.name&&"case"!==n.name&&(n.name="in_"+n.name)})),Q.config||(Q.config={}),Q.config.treatCasesAsIntegers=!0,K}},"debug/log":{$i:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function ZT(n){let k=arguments.length>2?arguments[2]:void 0;return{$i:[n],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((n,k)=>(n[k]={name:k},n)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(n,T,c,K,Q){var G;if(k){(G=Q[0]).config||(G.config={}),Q[0].config.preventIntegerFloatArithmetic=!0;let k=-1;Object.keys(n.values||{}).find((T=>{var c;return void 0!==(null===(c=n.values)||void 0===c?void 0:c[T].type)&&(k=n.values[T].type,!0)})),-1!==k&&(Q[0].config.type=K.arrays.types[k].flowGraphType)}return Q},validation:n=>k?eT(n):{valid:!0}}}function eT(n){if(n.values){const k=Object.keys(n.values).map((k=>n.values[k].type)).filter((n=>void 0!==n));if(!k.every((n=>n===k[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}YT["math/compose"]=YT["math/matCompose"],YT["math/decompose"]=YT["math/matDecompose"];var dT=T(684);const lT={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"li",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class iT{constructor(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=n,this._gltf=k,this._animationTargetFps=T,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const n of this._interactivityGraph.types)this._types.push(lT[n.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const n of this._interactivityGraph.declarations){const k=gT(n);if(!k)throw s.d.Error(["No mapping found for declaration",n]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:k,fullOperationName:n.extension?n.op+":"+n.extension:n.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const n of this._interactivityGraph.variables){const k=this._parseVariable(n);this._staticVariables.push(k)}}_parseVariable(n,k){const T=this._types[n.type];if(!T)throw s.d.Error(["No type found for variable",n]),new Error("Error parsing variables");if(n.value&&n.value.length!==T.length)throw s.d.Error(["Invalid value length for variable",n,T]),new Error("Error parsing variables");const c=n.value||[];if(!c.length)switch(T.flowGraphType){case"boolean":c.push(!1);break;case"FlowGraphInteger":c.push(0);break;case"number":c.push(NaN);break;case"Vector2":c.push(NaN,NaN);break;case"li":c.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":c.fill(NaN,0,4);break;case"Matrix":c.fill(NaN,0,16);break;case"Matrix3D":c.fill(NaN,0,9)}return"number"===T.elementType&&"string"===typeof c[0]&&(c[0]=parseFloat(c[0])),{type:T.flowGraphType,value:k?k(c,this):c}}_parseEvents(){if(this._interactivityGraph.events)for(const n of this._interactivityGraph.events){const k={eventId:n.id||"internalEvent_"+this._internalEventsCounter++};n.values&&(k.eventData=Object.keys(n.values).map((k=>{var T;const c=null===(T=n.values)||void 0===T?void 0:T[k];if(!c)throw s.d.Error(["No value found for event key",k]),new Error("Error parsing events");const K=this._types[c.type];if(!K)throw s.d.Error(["No type found for event value",c]),new Error("Error parsing events");const Q="undefined"!==typeof c.value?this._parseVariable(c):void 0;return{id:k,type:K.flowGraphType,eventData:!0,value:Q}}))),this._events.push(k)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const k of this._interactivityGraph.nodes){if("number"!==typeof k.declaration)throw s.d.Error(["No declaration found for node",k]),new Error("Error parsing nodes");const T=this._mappings[k.declaration];if(!T)throw s.d.Error(["No mapping found for node",k]),new Error("Error parsing nodes");if(T.flowGraphMapping.validation){const c=T.flowGraphMapping.validation(k,this._interactivityGraph,this._gltf);var n;if(!c.valid)throw new Error(`Error validating interactivity node ${null===(n=this._interactivityGraph.declarations)||void 0===n?void 0:n[k.declaration].op} - ${c.error}`)}const c=[];for(const n of T.flowGraphMapping.$i){const K=this._getEmptyBlock(n,T.fullOperationName);this._parseNodeConfiguration(k,K,T.flowGraphMapping,n),c.push(K)}this._nodes.push({$i:c,fullOperationName:T.fullOperationName})}}_getEmptyBlock(n,k){return{uniqueId:(0,dT.d)(),className:n,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:k,metadata:{}}}_parseNodeConfiguration(n,k,T,c){const K=k.config;if(n.configuration){const k=Object.keys(n.configuration);for(const w of k){var Q,G;const k=null===(Q=n.configuration)||void 0===Q?void 0:Q[w];if(!k)throw s.d.Error(["No value found for node configuration",w]),new Error("Error parsing node configuration");const E=null===(G=T.configuration)||void 0===G?void 0:G[w];if(E&&E.toBlock?E.toBlock===c:0===T.$i.indexOf(c)){const n=(null===E||void 0===E?void 0:E.name)||w;k&&"undefined"!==typeof k.value||"undefined"===typeof(null===E||void 0===E?void 0:E.defaultValue)?k.value.length>=0?K[n]={value:1===k.value.length?k.value[0]:k.value}:s.d.Warn(["Invalid value for node configuration",k]):K[n]={value:E.defaultValue},E&&E.dataTransformer&&(K[n].value=E.dataTransformer([K[n].value],this)[0])}}}}_parseNodeConnections(n){for(let u=0;u<this._nodes.length;u++){var k;const f=null===(k=this._interactivityGraph.nodes)||void 0===k?void 0:k[u];if(!f)throw s.d.Error(["No node found for interactivity node",this._nodes[u]]),new Error("Error parsing node connections");const A=this._nodes[u],v=this._mappings[f.declaration];if(!v)throw s.d.Error(["No mapping found for node",f]),new Error("Error parsing node connections");const F=f.flows||{},m=Object.keys(F).sort();for(const n of m){var T,c,K,Q;const k=F[n],I=null===(T=v.flowGraphMapping.outputs)||void 0===T||null===(c=T.flows)||void 0===c?void 0:c[n],S=(null===I||void 0===I?void 0:I.name)||n,P=this._createNewSocketConnection(S,!0);(I&&I.toBlock&&A.$i.find((n=>n.className===I.toBlock))||A.$i[0]).signalOutputs.push(P);const W=k.node,J=this._nodes[W];if(!J)throw s.d.Error(["No node found for input node id",W]),new Error("Error parsing node connections");const H=xT(J.fullOperationName);if(!H)throw s.d.Error(["No mapping found for input node",J]),new Error("Error parsing node connections");let b=null===(K=H.inputs)||void 0===K||null===(Q=K.flows)||void 0===Q?void 0:Q[k.socket||"in"],C=!1;if(!b)for(const n in null===(G=H.inputs)||void 0===G?void 0:G.flows){var G,w,E;if(n.startsWith("[")&&n.endsWith("]"))C=!0,b=null===(w=H.inputs)||void 0===w||null===(E=w.flows)||void 0===E?void 0:E[n]}const z=b?C?b.name.replace("$1",k.socket||""):b.name:k.socket||"in",r=b&&b.toBlock&&J.$i.find((n=>n.className===b.toBlock))||J.$i[0];let q=r.signalInputs.find((n=>n.name===z));q||(q=this._createNewSocketConnection(z),r.signalInputs.push(q)),q.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(q.uniqueId)}const x=f.values||{},g=Object.keys(x);for(const k of g){var I,S;const T=x[k];let c=null===(I=v.flowGraphMapping.inputs)||void 0===I||null===(S=I.values)||void 0===S?void 0:S[k],K=!1;if(!c)for(const n in null===(P=v.flowGraphMapping.inputs)||void 0===P?void 0:P.values){var P,W,J;if(n.startsWith("[")&&n.endsWith("]"))K=!0,c=null===(W=v.flowGraphMapping.inputs)||void 0===W||null===(J=W.values)||void 0===J?void 0:J[n]}const Q=c?K?c.name.replace("$1",k):c.name:k,G=this._createNewSocketConnection(Q);if((c&&c.toBlock&&A.$i.find((n=>n.className===c.toBlock))||A.$i[0]).dataInputs.push(G),void 0!==T.value){const k=this._parseVariable(T,c&&c.dataTransformer);n._connectionValues[G.uniqueId]=k}else{if("undefined"===typeof T.node)throw s.d.Error(["Invalid value for value connection",T]),new Error("Error parsing node connections");{var H,b,C;const n=T.node,k=T.socket||"value",c=this._nodes[n];if(!c)throw s.d.Error(["No node found for output socket reference",T]),new Error("Error parsing node connections");const K=xT(c.fullOperationName);if(!K)throw s.d.Error(["No mapping found for output socket reference",T]),new Error("Error parsing node connections");let Q=null===(H=K.outputs)||void 0===H||null===(b=H.values)||void 0===b?void 0:b[k],w=!1;if(!Q)for(const T in null===(z=K.outputs)||void 0===z?void 0:z.values){var z,r,q;if(T.startsWith("[")&&T.endsWith("]"))w=!0,Q=null===(r=K.outputs)||void 0===r||null===(q=r.values)||void 0===q?void 0:q[T]}const E=Q?w?Q.name.replace("$1",k):null===(C=Q)||void 0===C?void 0:C.name:k,I=Q&&Q.toBlock&&c.$i.find((n=>n.className===Q.toBlock))||c.$i[0];let S=I.dataOutputs.find((n=>n.name===E));S||(S=this._createNewSocketConnection(E,!0),I.dataOutputs.push(S)),G.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(G.uniqueId)}}}if(v.flowGraphMapping.interBlockConnectors)for(const n of v.flowGraphMapping.interBlockConnectors){const k=n.input,T=n.output,c=n.isVariable;this._connectFlowGraphNodes(k,T,A.$i[n.inputBlockIndex],A.$i[n.outputBlockIndex],c)}if(v.flowGraphMapping.extraProcessor){var O;const k=null===(O=this._interactivityGraph.declarations)||void 0===O?void 0:O[f.declaration];if(!k)throw s.d.Error(["No declaration found for extra processor",f]),new Error("Error parsing node connections");A.$i=v.flowGraphMapping.extraProcessor(f,k,v.flowGraphMapping,this,A.$i,n,this._gltf)}}}_createNewSocketConnection(n,k){return{uniqueId:(0,dT.d)(),name:n,_connectionType:k?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(n,k,T,c,K){const Q=K?T.dataInputs:T.signalInputs,G=K?c.dataOutputs:c.signalOutputs,w=Q.find((k=>k.name===n))||this._createNewSocketConnection(n),E=G.find((n=>n.name===k))||this._createNewSocketConnection(k,!0);Q.find((k=>k.name===n))||Q.push(w),G.find((n=>n.name===k))||G.push(E),w.connectedPointIds.push(E.uniqueId),E.connectedPointIds.push(w.uniqueId)}getVariableName(n){return"staticVariable_"+n}serializeToFlowGraph(){const n={uniqueId:(0,dT.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(n);for(let k=0;k<this._staticVariables.length;k++){const T=this._staticVariables[k];n._userVariables[this.getVariableName(k)]=T}return{rightHanded:!0,allBlocks:this._nodes.reduce(((n,k)=>n.concat(k.$i)),[]),executionContexts:[n]}}}const BT="KHR_interactivity";class tT{constructor(n){this._loader=n,this.name=BT,this.enabled=this._loader.isExtensionUsed(BT),this._pathConverter=(0,R.i)(this._loader.Di),n._skipStartAnimationStep=!0;const k=n.babylonScene;k&&function(n){(0,R.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!n.activeCamera)return new K.h(NaN,NaN,NaN,NaN);const k=K.h.FromRotationMatrix(n.activeCamera.getWorldMatrix()).normalize();return n.useRightHandedSystem||(k.w*=-1,k.x*=-1),k},type:"Quaternion",getTarget:()=>n.activeCamera}),(0,R.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!n.activeCamera)return new K.o(NaN,NaN,NaN);const k=n.activeCamera.getWorldMatrix().getTranslation();return n.useRightHandedSystem||(k.x*=-1),k},type:"li",getTarget:()=>n.activeCamera}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:n=>{var k;return(null===(k=n._babylonAnimationGroup)||void 0===k?void 0:k.isPlaying)??!1},type:"boolean",getTarget:n=>n._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:n=>{var k;return((null===(k=n._babylonAnimationGroup)||void 0===k?void 0:k.from)??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:n=>{var k;return((null===(k=n._babylonAnimationGroup)||void 0===k?void 0:k.to)??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:n=>{var k;return((null===(k=n._babylonAnimationGroup)||void 0===k?void 0:k.getCurrentFrame())??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup}),(0,R.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:n=>{var k;return((null===(k=n._babylonAnimationGroup)||void 0===k?void 0:k.getCurrentFrame())??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup})}(k)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var n;if(!this._loader.babylonScene||!this._pathConverter)return;const k=this._loader.babylonScene,T=null===(n=this._loader.Di.extensions)||void 0===n?void 0:n.KHR_interactivity;if(!T)return;const c=new CT.e({me:k});c.dispatchEventsSynchronously=!1;const K=T.graphs.map((n=>new iT(n,this._loader.Di,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(K.map((async n=>await vT(n,{coordinator:c,pathConverter:this._pathConverter})))),c.start()}}var MT;MT=async()=>(await Promise.resolve().then(T.bind(T,12884))).FlowGraphGLTFDataProvider,zT[`${BT}/${"FlowGraphGLTFDataProvider"}`]=MT,D(BT),o(BT,!0,(n=>new tT(n)));const oT="KHR_node_visibility";(0,R.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:n=>{const k=n._babylonTransformNode;return!k||void 0===k.isVisible||k.isVisible},set:(n,k)=>{var T,c;null===(T=k._primitiveBabylonMeshes)||void 0===T||T.forEach((n=>{n.inheritVisibility=!0})),k._babylonTransformNode&&(k._babylonTransformNode.isVisible=n),null===(c=k._primitiveBabylonMeshes)||void 0===c||c.forEach((k=>{k.isVisible=n}))},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class DT{constructor(n){this.name=oT,this._loader=n,this.enabled=n.isExtensionUsed(oT)}async onReady(){var n;null===(n=this._loader.Di.nodes)||void 0===n||n.forEach((n=>{var k,T,c,K;(null===(k=n._primitiveBabylonMeshes)||void 0===k||k.forEach((n=>{n.inheritVisibility=!0})),null!==(T=n.extensions)&&void 0!==T&&T.KHR_node_visibility)&&(!1===(null===(c=n.extensions)||void 0===c?void 0:c.KHR_node_visibility.visible)&&(n._babylonTransformNode&&(n._babylonTransformNode.isVisible=!1),null===(K=n._primitiveBabylonMeshes)||void 0===K||K.forEach((n=>{n.isVisible=!1}))))}))}dispose(){this._loader=null}}D(oT),o(oT,!0,(n=>new DT(n)));const RT="KHR_node_selectability";UT("event/onSelect",RT,{$i:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:n=>["pickedMesh_"+n[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(n,k,T,c,K,Q,G){var w,E,I,S,P,W;const J=K[K.length-1];J.config=J.config||{},J.config.glTF=G;const H=null===(w=n.configuration)||void 0===w||null===(E=w.nodeIndex)||void 0===E?void 0:E.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const s="pickedMesh_"+H;return K[1].config.variable=s,Q._userVariables[s]={className:"Mesh",id:null===G||void 0===G||null===(I=G.nodes)||void 0===I||null===(S=I[H]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===G||void 0===G||null===(P=G.nodes)||void 0===P||null===(W=P[H]._babylonTransformNode)||void 0===W?void 0:W.uniqueId},K}}),(0,R.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:n=>{const k=n._babylonTransformNode;return!k||void 0===k.xi||k.xi},set:(n,k)=>{var T;null===(T=k._primitiveBabylonMeshes)||void 0===T||T.forEach((k=>{k.xi=n}))},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"xi"],type:"boolean"});class LT{constructor(n){this.name=RT,this._loader=n,this.enabled=n.isExtensionUsed(RT)}async onReady(){var n;null===(n=this._loader.Di.nodes)||void 0===n||n.forEach((n=>{var k,T,c;null!==(k=n.extensions)&&void 0!==k&&k.KHR_node_selectability&&!1===(null===(T=n.extensions)||void 0===T?void 0:T.KHR_node_selectability.selectable)&&(null===(c=n._babylonTransformNode)||void 0===c||c.getChildMeshes().forEach((n=>{n.xi=!1})))}))}dispose(){this._loader=null}}D(RT),o(RT,!0,(n=>new LT(n)));const hT="KHR_node_hoverability",jT="targetMeshPointerOver_";UT("event/onHoverIn",hT,{$i:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:n=>[jT+n[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(n,k,T,c,K,Q,G){var w,E,I,S,P,W;const J=K[K.length-1];J.config=J.config||{},J.config.glTF=G;const H=null===(w=n.configuration)||void 0===w||null===(E=w.nodeIndex)||void 0===E?void 0:E.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const s=jT+H;return K[1].config.variable=s,Q._userVariables[s]={className:"Mesh",id:null===G||void 0===G||null===(I=G.nodes)||void 0===I||null===(S=I[H]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===G||void 0===G||null===(P=G.nodes)||void 0===P||null===(W=P[H]._babylonTransformNode)||void 0===W?void 0:W.uniqueId},K}});const pT="targetMeshPointerOut_";UT("event/onHoverOut",hT,{$i:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:n=>[pT+n[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(n,k,T,c,K,Q,G){var w,E,I,S,P,W;const J=K[K.length-1];J.config=J.config||{},J.config.glTF=G;const H=null===(w=n.configuration)||void 0===w||null===(E=w.nodeIndex)||void 0===E?void 0:E.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const s=pT+H;return K[1].config.variable=s,Q._userVariables[s]={className:"Mesh",id:null===G||void 0===G||null===(I=G.nodes)||void 0===I||null===(S=I[H]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===G||void 0===G||null===(P=G.nodes)||void 0===P||null===(W=P[H]._babylonTransformNode)||void 0===W?void 0:W.uniqueId},K}}),(0,R.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:n=>{const k=n._babylonTransformNode;return!k||void 0===k.pointerOverDisableMeshTesting||k.pointerOverDisableMeshTesting},set:(n,k)=>{var T;null===(T=k._primitiveBabylonMeshes)||void 0===T||T.forEach((k=>{k.pointerOverDisableMeshTesting=!n}))},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class aT{constructor(n){this.name=hT,this._loader=n,this.enabled=n.isExtensionUsed(hT)}async onReady(){var n;null===(n=this._loader.Di.nodes)||void 0===n||n.forEach((n=>{var k,T,c;null!==(k=n.extensions)&&void 0!==k&&k.KHR_node_hoverability&&!1===(null===(T=n.extensions)||void 0===T?void 0:T.KHR_node_hoverability.hoverable)&&(null===(c=n._babylonTransformNode)||void 0===c||c.getChildMeshes().forEach((n=>{n.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}D(hT),o(hT,!0,(n=>new aT(n)));const XT="ExtrasAsMetadata";class yT{_assignExtras(n,k){if(k.extras&&Object.keys(k.extras).length>0){const T=n.metadata=n.metadata||{};(T.Di=T.Di||{}).extras=k.extras}}constructor(n){this.name=XT,this.enabled=!0,this._loader=n}dispose(){this._loader=null}loadNodeAsync(n,k,T){return this._loader.loadNodeAsync(n,k,(n=>{this._assignExtras(n,k),T(n)}))}loadCameraAsync(n,k,T){return this._loader.loadCameraAsync(n,k,(n=>{this._assignExtras(n,k),T(n)}))}createMaterial(n,k,T){const c=this._loader.createMaterial(n,k,T);return this._assignExtras(c,k),c}}D(XT),o(XT,!1,(n=>new yT(n)));T(12884)},12737:(n,k,T)=>{"use strict";T.d(k,{e:()=>V,i:()=>v,k:()=>A,m:()=>F});var c=T(539),K=T(542),Q=T(12317),G=T(532),w=T(885),E=T(878),I=T(556),S=T(588),P=T(12741),W=T(12746),J=T(701),H=T(696);class s{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.oi=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.dm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(n){this._environmentTexture=n}getNodes(){let n=[];n=n.concat(this.meshes),n=n.concat(this.lights),n=n.concat(this.cameras),n=n.concat(this.transformNodes);for(const k of this.skeletons)n=n.concat(k.bones);return n}}class b extends s{}class C{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const n=this.rootNodes;for(const c of n)c.dispose();n.length=0;const k=this.skeletons;for(const c of k)c.dispose();k.length=0;const T=this.animationGroups;for(const c of T)c.dispose();T.length=0}}class z extends s{constructor(n){super(),this._wasAddedToScene=!1,(n=n||S.e.LastCreatedScene)&&(this.me=n,this.proceduralTextures=[],n.Gi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=n.getEngine().onContextRestoredObservable.add((()=>{for(const n of this.geometries)n._rebuild();for(const n of this.meshes)n._rebuild();for(const n of this.oi)n.rebuild();for(const n of this.textures)n._rebuild()})))}_topologicalSort(n){const k=new Map;for(const G of n)k.set(G.uniqueId,G);const T={dependsOn:new Map,dependedBy:new Map};for(const G of n){const n=G.uniqueId;T.dependsOn.set(n,new Set),T.dependedBy.set(n,new Set)}for(const G of n){const n=G.uniqueId,c=T.dependsOn.get(n);if(G instanceof P.d){const K=G.sourceMesh;k.has(K.uniqueId)&&(c.add(K.uniqueId),T.dependedBy.get(K.uniqueId).add(n))}const K=T.dependedBy.get(n);for(const Q of G.getDescendants()){const c=Q.uniqueId;if(k.has(c)){K.add(c);T.dependsOn.get(c).add(n)}}}const c=[],K=[];for(const G of n){const n=G.uniqueId;0===T.dependsOn.get(n).size&&(K.push(G),k.delete(n))}const Q=K;for(;Q.length>0;){const n=Q.shift();c.push(n);const K=T.dependedBy.get(n.uniqueId);for(const c of Array.from(K.values())){const K=T.dependsOn.get(c);K.delete(n.uniqueId),0===K.size&&k.get(c)&&(Q.push(k.get(c)),k.delete(c))}}return k.size>0&&(I.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),k.forEach((n=>{I.d.Error(n.name)}))),c}_addNodeAndDescendantsToList(n,k,T,c){if(T&&(!c||c(T))&&!k.has(T.uniqueId)){n.push(T),k.add(T.uniqueId);for(const K of T.getDescendants(!0))this._addNodeAndDescendantsToList(n,k,K,c)}}_isNodeInContainer(n){return n instanceof E.e&&-1!==this.meshes.indexOf(n)||(n instanceof w.d&&-1!==this.transformNodes.indexOf(n)||(n instanceof W.c&&-1!==this.lights.indexOf(n)||n instanceof J.c&&-1!==this.cameras.indexOf(n)))}_isValidHierarchy(){for(const n of this.meshes)if(n.parent&&!this._isNodeInContainer(n.parent))return I.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;for(const n of this.transformNodes)if(n.parent&&!this._isNodeInContainer(n.parent))return I.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;for(const n of this.lights)if(n.parent&&!this._isNodeInContainer(n.parent))return I.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;for(const n of this.cameras)if(n.parent&&!this._isNodeInContainer(n.parent))return I.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(n){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||K.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const c={},Q={},w=new C,E=[],I=[],S={doNotInstantiate:!0,...T},P=[],W=new Set;for(const K of this.transformNodes)null===K.parent&&this._addNodeAndDescendantsToList(P,W,K,S.predicate);for(const K of this.meshes)null===K.parent&&this._addNodeAndDescendantsToList(P,W,K,S.predicate);const J=this._topologicalSort(P),H=(T,K)=>{if(((k,T)=>{if(c[k.uniqueId]=T.uniqueId,Q[T.uniqueId]=T,n&&(T.name=n(k.name)),T instanceof G.b){const n=T;if(n.morphTargetManager){const T=k.morphTargetManager;n.morphTargetManager=T.clone();for(let k=0;k<T.numTargets;k++){const K=T.getTarget(k),G=n.morphTargetManager.getTarget(k);c[K.uniqueId]=G.uniqueId,Q[G.uniqueId]=G}}}})(T,K),T.parent){const n=c[T.parent.uniqueId],k=Q[n];K.parent=k||T.parent}if(K.position&&T.position&&K.position.p(T.position),K.rotationQuaternion&&T.rotationQuaternion&&K.rotationQuaternion.p(T.rotationQuaternion),K.rotation&&T.rotation&&K.rotation.p(T.rotation),K.ei&&T.ei&&K.ei.p(T.ei),K.material){const G=K;if(G.material)if(k){const k=T.material;if(-1===I.indexOf(k)){let T=k.clone(n?n(k.name):"Clone of "+k.name);if(I.push(k),c[k.uniqueId]=T.uniqueId,Q[T.uniqueId]=T,"MultiMaterial"===k.getClassName()){const K=k;for(const k of K.yi)k&&(T=k.clone(n?n(k.name):"Clone of "+k.name),I.push(k),c[k.uniqueId]=T.uniqueId,Q[T.uniqueId]=T);K.yi=K.yi.map((n=>n&&Q[c[n.uniqueId]]))}}"InstancedMesh"!==G.getClassName()&&(G.material=Q[c[k.uniqueId]])}else"MultiMaterial"===G.material.getClassName()?-1===this.me.multiMaterials.indexOf(G.material)&&this.me.addMultiMaterial(G.material):-1===this.me.materials.indexOf(G.material)&&this.me.addMaterial(G.material)}null===K.parent&&w.rootNodes.push(K)};for(const K of J)if("InstancedMesh"===K.getClassName()){const n=K,k=n.sourceMesh,T=c[k.uniqueId];H(n,("number"===typeof T?Q[T]:k).createInstance(n.name))}else{let n=!0;"Zi"===K.getClassName()||"Node"===K.getClassName()||K.skeleton||!K.getTotalVertices||0===K.getTotalVertices()?n=!1:S.doNotInstantiate&&(n="function"===typeof S.doNotInstantiate?!S.doNotInstantiate(K):!S.doNotInstantiate);const k=n?K.createInstance(`instance of ${K.name}`):K.clone(`Clone of ${K.name}`,null,!0);if(!k)throw new Error(`Could not clone or instantiate node on Asset Container ${K.name}`);H(K,k)}for(const K of this.skeletons){if(S.predicate&&!S.predicate(K))continue;const k=K.clone(n?n(K.name):"Clone of "+K.name);for(const n of this.meshes)if(n.skeleton===K&&!n.isAnInstance){const T=Q[c[n.uniqueId]];if(!T||T.isAnInstance)continue;if(T.skeleton=k,-1!==E.indexOf(k))continue;E.push(k);for(const n of k.bones)n._linkedTransformNode&&(n._linkedTransformNode=Q[c[n._linkedTransformNode.uniqueId]])}w.skeletons.push(k)}for(const K of this.animationGroups){if(S.predicate&&!S.predicate(K))continue;const k=K.clone(n?n(K.name):"Clone of "+K.name,(n=>Q[c[n.uniqueId]]||n));w.animationGroups.push(k)}return w}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||K.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.me.environmentTexture=this.environmentTexture);for(const n of this.me._serializableComponents)n.addFromContainer(this);this.me.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const k=[];for(const T of this.cameras)n&&!n(T)||(this.me.addCamera(T),k.push(T));for(const T of this.lights)n&&!n(T)||(this.me.addLight(T),k.push(T));for(const T of this.meshes)n&&!n(T)||(this.me.Ui(T),k.push(T));for(const T of this.skeletons)n&&!n(T)||this.me.addSkeleton(T);for(const T of this.animations)n&&!n(T)||this.me.addAnimation(T);for(const T of this.animationGroups)n&&!n(T)||this.me.addAnimationGroup(T);for(const T of this.multiMaterials)n&&!n(T)||this.me.addMultiMaterial(T);for(const T of this.materials)n&&!n(T)||this.me.addMaterial(T);for(const T of this.morphTargetManagers)n&&!n(T)||this.me.addMorphTargetManager(T);for(const T of this.geometries)n&&!n(T)||this.me.addGeometry(T);for(const T of this.transformNodes)n&&!n(T)||(this.me.addTransformNode(T),k.push(T));for(const T of this.actionManagers)n&&!n(T)||this.me.addActionManager(T);for(const T of this.textures)n&&!n(T)||this.me.addTexture(T);for(const T of this.reflectionProbes)n&&!n(T)||this.me.addReflectionProbe(T);for(const T of k)T.parent&&-1===this.me.getNodes().indexOf(T.parent)&&(T.setParent?T.setParent(null):T.parent=null)}removeAllFromScene(){this._isValidHierarchy()||K.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.me.environmentTexture&&(this.me.environmentTexture=null);for(const n of this.me._serializableComponents)n.removeFromContainer(this)}removeFromScene(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const k of this.cameras)n&&!n(k)||this.me.removeCamera(k);for(const k of this.lights)n&&!n(k)||this.me.removeLight(k);for(const k of this.meshes)n&&!n(k)||this.me.Wi(k,!0);for(const k of this.skeletons)n&&!n(k)||this.me.removeSkeleton(k);for(const k of this.animations)n&&!n(k)||this.me.removeAnimation(k);for(const k of this.animationGroups)n&&!n(k)||this.me.removeAnimationGroup(k);for(const k of this.multiMaterials)n&&!n(k)||this.me.removeMultiMaterial(k);for(const k of this.materials)n&&!n(k)||this.me.removeMaterial(k);for(const k of this.morphTargetManagers)n&&!n(k)||this.me.removeMorphTargetManager(k);for(const k of this.geometries)n&&!n(k)||this.me.removeGeometry(k);for(const k of this.transformNodes)n&&!n(k)||this.me.removeTransformNode(k);for(const k of this.actionManagers)n&&!n(k)||this.me.removeActionManager(k);for(const k of this.textures)n&&!n(k)||this.me.removeTexture(k);for(const k of this.reflectionProbes)n&&!n(k)||this.me.removeReflectionProbe(k)}dispose(){const n=this.cameras.slice(0);for(const J of n)J.dispose();this.cameras.length=0;const k=this.lights.slice(0);for(const J of k)J.dispose();this.lights.length=0;const T=this.meshes.slice(0);for(const J of T)J.dispose();this.meshes.length=0;const c=this.skeletons.slice(0);for(const J of c)J.dispose();this.skeletons.length=0;const K=this.animationGroups.slice(0);for(const J of K)J.dispose();this.animationGroups.length=0;const Q=this.multiMaterials.slice(0);for(const J of Q)J.dispose();this.multiMaterials.length=0;const G=this.materials.slice(0);for(const J of G)J.dispose();this.materials.length=0;const w=this.geometries.slice(0);for(const J of w)J.dispose();this.geometries.length=0;const E=this.transformNodes.slice(0);for(const J of E)J.dispose();this.transformNodes.length=0;const I=this.actionManagers.slice(0);for(const J of I)J.dispose();this.actionManagers.length=0;const S=this.textures.slice(0);for(const J of S)J.dispose();this.textures.length=0;const P=this.reflectionProbes.slice(0);for(const J of P)J.dispose();this.reflectionProbes.length=0;const W=this.morphTargetManagers.slice(0);for(const J of W)J.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const J of this.me._serializableComponents)J.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.me.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(n,k,T){if(n&&k)for(const c of n){let n=!0;if(T)for(const k of T)if(c===k){n=!1;break}n&&(k.push(c),c._parentContainer=this)}}moveAllFromScene(n){this._wasAddedToScene=!1,void 0===n&&(n=new b);for(const k in this)Object.prototype.hasOwnProperty.call(this,k)&&(this[k]=this[k]||("_environmentTexture"===k?null:[]),this._moveAssets(this.me[k],this[k],n[k]));this.environmentTexture=this.me.environmentTexture,this.removeAllFromScene()}createRootMesh(){const n=new G.b("assetContainerRootMesh",this.me);for(const k of this.meshes)k.parent||n.addChild(k);return this.meshes.unshift(n),n}mergeAnimationsTo(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.e.LastCreatedScene,k=arguments.length>1?arguments[1]:void 0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!n)return I.d.Error("No scene available to merge animations to"),[];const c=T||(k=>{let T=null;const c=k.animations.length?k.animations[0].targetProperty:"",K=k.name.split(".").join("").split("_primitive")[0];switch(c){case"position":case"rotationQuaternion":T=n.getTransformNodeByName(k.name)||n.getTransformNodeByName(K);break;case"influence":T=n.getMorphTargetByName(k.name)||n.getMorphTargetByName(K);break;default:T=n.getNodeByName(k.name)||n.getNodeByName(K)}return T}),K=this.getNodes();for(const w of K){const n=c(w);if(null!==n){for(const k of w.animations){const T=n.animations.filter((n=>n.targetProperty===k.targetProperty));for(const k of T){const T=n.animations.indexOf(k,0);T>-1&&n.animations.splice(T,1)}}n.animations=n.animations.concat(w.animations)}}const Q=[],G=this.animationGroups.slice();for(const w of G){Q.push(w.clone(w.name,c));for(const n of w.animatables)n.stop()}for(const w of k){const k=c(w.target);k&&(n.beginAnimation(k,w.fromFrame,w.toFrame,w.loopAnimation,w.speedRatio,w.onAnimationEnd?w.onAnimationEnd:void 0,void 0,!0,void 0,w.onAnimationLoop?w.onAnimationLoop:void 0),n.stopAnimation(w.target))}return Q}populateRootNodes(){this.rootNodes.length=0;for(const n of this.meshes)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n);for(const n of this.transformNodes)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n);for(const n of this.lights)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n);for(const n of this.cameras)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n)}addAllAssetsToContainer(n){if(!n)return;const k=[],T=new Set;for(k.push(n);k.length>0;){const n=k.pop();if(n instanceof G.b?(n.mi&&-1===this.geometries.indexOf(n.mi)&&this.geometries.push(n.mi),this.meshes.push(n)):n instanceof P.d?this.meshes.push(n):n instanceof w.d?this.transformNodes.push(n):n instanceof W.c?this.lights.push(n):n instanceof J.c&&this.cameras.push(n),n instanceof E.e){if(n.material&&-1===this.materials.indexOf(n.material)){this.materials.push(n.material);for(const k of n.material.getActiveTextures())-1===this.textures.indexOf(k)&&this.textures.push(k)}n.skeleton&&-1===this.skeletons.indexOf(n.skeleton)&&this.skeletons.push(n.skeleton),n.morphTargetManager&&-1===this.morphTargetManagers.indexOf(n.morphTargetManager)&&this.morphTargetManagers.push(n.morphTargetManager)}for(const c of n.getChildren())T.has(c)||k.push(c);T.add(n)}this.populateRootNodes()}_getByTags(n,k,T){if(void 0===k)return n;const c=[];for(const K in n){const Q=n[K];H.b&&H.b.MatchesQuery(Q,k)&&(!T||T(Q))&&c.push(Q)}return c}getMeshesByTags(n,k){return this._getByTags(this.meshes,n,k)}getCamerasByTags(n,k){return this._getByTags(this.cameras,n,k)}getLightsByTags(n,k){return this._getByTags(this.lights,n,k)}getMaterialsByTags(n,k){return this._getByTags(this.materials,n,k).concat(this._getByTags(this.multiMaterials,n,k))}getTransformNodesByTags(n,k){return this._getByTags(this.transformNodes,n,k)}}var r=T(598);class q{constructor(n){this.byteOffset=0,this.buffer=n}async loadAsync(n){const k=await this.buffer.readAsync(this.byteOffset,n);this._dataView=new DataView(k.buffer,k.byteOffset,k.byteLength),this._dataByteOffset=0}readUint32(){const n=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,n}readUint8Array(n){const k=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,n);return this._dataByteOffset+=n,this.byteOffset+=n,k}readString(n){return(0,r.g)(this.readUint8Array(n))}skipBytes(n){this._dataByteOffset+=n,this.byteOffset+=n}}var O=T(12754);const u="Z2xURg",f={name:"Di",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:n=>-1!==n.indexOf("asset")&&-1!==n.indexOf("version")||n.startsWith("data:base64,"+u)||n.startsWith("data:;base64,"+u)||n.startsWith("data:application/octet-stream;base64,"+u)||n.startsWith("data:model/gltf-binary;base64,"+u)};var A,v,F,m=T(591),x=T(594);function g(n,k,T){try{return Promise.resolve(new Uint8Array(n,k,T))}catch(c){return Promise.reject(c)}}!function(n){n[n.AUTO=0]="AUTO",n[n.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(A||(A={})),function(n){n[n.NONE=0]="NONE",n[n.FIRST=1]="FIRST",n[n.ALL=2]="ALL"}(v||(v={})),function(n){n[n.LOADING=0]="LOADING",n[n.READY=1]="READY",n[n.COMPLETE=2]="COMPLETE"}(F||(F={}));class U{constructor(){this.coordinateSystemMode=A.AUTO,this.animationStartMode=v.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=n=>Promise.resolve(n),this.extensionOptions={}}p(n){n&&(this.onParsed=n.onParsed,this.coordinateSystemMode=n.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=n.animationStartMode??this.animationStartMode,this.loadNodeAnimations=n.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=n.loadSkins??this.loadSkins,this.loadMorphTargets=n.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=n.compileMaterials??this.compileMaterials,this.useClipPlane=n.useClipPlane??this.useClipPlane,this.compileShadowGenerators=n.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=n.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=n.useRangeRequests??this.useRangeRequests,this.createInstances=n.createInstances??this.createInstances,this.alwaysComputeBoundingBox=n.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=n.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=n.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=n.skipMaterials??this.skipMaterials,this.useSRGBBuffers=n.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=n.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=n.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=n.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=n.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=n.customRootNode,this.onMeshLoaded=n.onMeshLoaded,this.onSkinLoaded=n.onSkinLoaded,this.onTextureLoaded=n.onTextureLoaded,this.onMaterialLoaded=n.onMaterialLoaded,this.onCameraLoaded=n.onCameraLoaded,this.extensionOptions=n.extensionOptions??this.extensionOptions)}}class V extends U{constructor(n){super(),this.onParsedObservable=new c.b,this.onMeshLoadedObservable=new c.b,this.onSkinLoadedObservable=new c.b,this.onTextureLoadedObservable=new c.b,this.onMaterialLoadedObservable=new c.b,this.onCameraLoadedObservable=new c.b,this.onCompleteObservable=new c.b,this.onErrorObservable=new c.b,this.Gi=new c.b,this.onExtensionLoadedObservable=new c.b,this.validate=!1,this.onValidatedObservable=new c.b,this._loader=null,this._state=null,this._requests=new Array,this.name=f.name,this.extensions=f.extensions,this.onLoaderStateChangedObservable=new c.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(n)}set onParsed(n){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),n&&(this._onParsedObserver=this.onParsedObservable.add(n))}set onMeshLoaded(n){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),n&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(n))}set onSkinLoaded(n){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),n&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((k=>n(k.node,k.skinnedNode))))}set onTextureLoaded(n){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),n&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(n))}set onMaterialLoaded(n){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),n&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(n))}set onCameraLoaded(n){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),n&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(n))}set onComplete(n){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(n)}set onError(n){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(n)}set onDispose(n){this._onDisposeObserver&&this.Gi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Gi.add(n)}set onExtensionLoaded(n){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(n)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(n){this._loggingEnabled!==n&&(this._loggingEnabled=n,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(n){this._capturePerformanceCounters!==n&&(this._capturePerformanceCounters=n,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(n){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(n)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const n of this._requests)n.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=n=>Promise.resolve(n),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Gi.notifyObservers(void 0),this.Gi.clear()}loadFile(n,k,T,Q,G,w,E,S){if(ArrayBuffer.isView(k))return this._loadBinary(n,k,T,Q,E,S),null;this._progressCallback=G;const P=k.name||K.e.GetFilename(k);if(w){if(this.useRangeRequests){this.validate&&I.d.Warn("glTF validation is not supported when range requests are enabled");const T={abort:()=>{},onCompleteObservable:new c.b},K={readAsync:(T,c)=>new Promise(((K,Q)=>{this._loadFile(n,k,(n=>{K(new Uint8Array(n))}),!0,(n=>{Q(n)}),(n=>{n.setRequestHeader("Range",`bytes=${T}-${T+c-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new q(K)).then((n=>{T.onCompleteObservable.notifyObservers(T),Q(n)}),E?n=>E(void 0,n):void 0),T}return this._loadFile(n,k,(k=>{this._validate(n,new Uint8Array(k,0,k.byteLength),T,P),this._unpackBinaryAsync(new q({readAsync:(n,T)=>g(k,n,T),byteLength:k.byteLength})).then((n=>{Q(n)}),E?n=>E(void 0,n):void 0)}),!0,E)}return this._loadFile(n,k,(k=>{try{this._validate(n,k,T,P),Q({json:this._parseJson(k)})}catch{E&&E()}}),!1,E)}_loadBinary(n,k,T,c,K,Q){this._validate(n,new Uint8Array(k.buffer,k.byteOffset,k.byteLength),T,Q),this._unpackBinaryAsync(new q({readAsync:(n,T)=>function(n,k,T){try{if(k<0||k>=n.byteLength)throw new RangeError("Offset is out of range.");if(k+T>n.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(n.buffer,n.byteOffset+k,T))}catch(c){return Promise.reject(c)}}(k,n,T),byteLength:k.byteLength})).then((n=>{c(n)}),K?n=>K(void 0,n):void 0)}importMeshAsync(n,k,T,c,K,Q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${Q||""}`),this._loader=this._getLoader(T),this._loader.importMeshAsync(n,k,null,T,c,K,Q))))}loadAsync(n,k,T,c,K){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(k),this.onParsedObservable.clear(),this._log(`Loading ${K||""}`),this._loader=this._getLoader(k),this._loader.loadAsync(n,k,T,c,K))))}loadAssetContainerAsync(n,k,T,c,K){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(k),this.onParsedObservable.clear(),this._log(`Loading ${K||""}`),this._loader=this._getLoader(k);const Q=new z(n),G=[];this.onMaterialLoadedObservable.add((n=>{G.push(n)}));const w=[];this.onTextureLoadedObservable.add((n=>{w.push(n)}));const E=[];this.onCameraLoadedObservable.add((n=>{E.push(n)}));const I=[];return this.onMeshLoadedObservable.add((n=>{n.morphTargetManager&&I.push(n.morphTargetManager)})),this._loader.importMeshAsync(null,n,Q,k,T,c,K).then((n=>(Array.prototype.push.apply(Q.geometries,n.geometries),Array.prototype.push.apply(Q.meshes,n.meshes),Array.prototype.push.apply(Q.oi,n.oi),Array.prototype.push.apply(Q.skeletons,n.skeletons),Array.prototype.push.apply(Q.animationGroups,n.animationGroups),Array.prototype.push.apply(Q.materials,G),Array.prototype.push.apply(Q.textures,w),Array.prototype.push.apply(Q.lights,n.lights),Array.prototype.push.apply(Q.transformNodes,n.transformNodes),Array.prototype.push.apply(Q.cameras,E),Array.prototype.push.apply(Q.morphTargetManagers,I),Q)))}))}canDirectLoad(n){return f.canDirectLoad(n)}directLoad(n,k){if(k.startsWith("base64,"+u)||k.startsWith(";base64,"+u)||k.startsWith("application/octet-stream;base64,"+u)||k.startsWith("model/gltf-binary;base64,"+u)){const T=(0,m.d)(k);return this._validate(n,new Uint8Array(T,0,T.byteLength)),this._unpackBinaryAsync(new q({readAsync:(n,k)=>g(T,n,k),byteLength:T.byteLength}))}return this._validate(n,k),Promise.resolve({json:this._parseJson(k)})}createPlugin(n){return new V(n[f.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((n,k)=>{this.onCompleteObservable.addOnce((()=>{n()})),this.onErrorObservable.addOnce((n=>{k(n)}))}))}_setState(n){this._state!==n&&(this._state=n,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(F[this._state]))}_loadFile(n,k,T,c,K,Q){const G=n._loadFile(k,T,(n=>{this._onProgress(n,G)}),!0,c,K,Q);return G.onCompleteObservable.add((()=>{G._lengthComputable=!0,G._total=G._loaded})),this._requests.push(G),G}_onProgress(n,k){if(!this._progressCallback)return;k._lengthComputable=n.lengthComputable,k._loaded=n.loaded,k._total=n.total;let T=!0,c=0,K=0;for(const Q of this._requests){if(void 0===Q._lengthComputable||void 0===Q._loaded||void 0===Q._total)return;T=T&&Q._lengthComputable,c+=Q._loaded,K+=Q._total}this._progressCallback({lengthComputable:T,loaded:c,total:T?K:0})}_validate(n,k){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),O.b.ValidateAsync(k,T,c,(k=>this.preprocessUrlAsync(T+k).then((k=>n._loadFileAsync(k,void 0,!0,!0).then((n=>new Uint8Array(n,0,n.byteLength))))))).then((n=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(n),this.onValidatedObservable.clear()}),(n=>{this._endPerformanceCounter("Validate JSON"),K.e.Warn(`Failed to validate: ${n.message}`),this.onValidatedObservable.clear()})))}_getLoader(n){const k=n.json.asset||{};this._log(`Asset version: ${k.version}`),k.minVersion&&this._log(`Asset minimum version: ${k.minVersion}`),k.generator&&this._log(`Asset generator: ${k.generator}`);const T=V._parseVersion(k.version);if(!T)throw new Error("Invalid version: "+k.version);if(void 0!==k.minVersion){const n=V._parseVersion(k.minVersion);if(!n)throw new Error("Invalid minimum version: "+k.minVersion);if(V._compareVersion(n,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+k.minVersion)}const c={1:V._CreateGLTF1Loader,2:V._CreateGLTF2Loader}[T.major];if(!c)throw new Error("Unsupported version: "+k.version);return c(this)}_parseJson(n){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${n.length}`);const k=JSON.parse(n);return this._endPerformanceCounter("Parse JSON"),k}_unpackBinaryAsync(n){return this._startPerformanceCounter("Unpack Binary"),n.loadAsync(20).then((()=>{const k=n.readUint32();if(1179937895!==k)throw new x.i("Unexpected magic: "+k,x.g.GLTFLoaderUnexpectedMagicError);const T=n.readUint32();this.loggingEnabled&&this._log(`Binary version: ${T}`);const c=n.readUint32();let K;switch(this.useRangeRequests||c===n.buffer.byteLength||I.d.Warn(`Length in header does not match actual data length: ${c} != ${n.buffer.byteLength}`),T){case 1:K=this._unpackBinaryV1Async(n,c);break;case 2:K=this._unpackBinaryV2Async(n,c);break;default:throw new Error("Unsupported version: "+T)}return this._endPerformanceCounter("Unpack Binary"),K}))}_unpackBinaryV1Async(n,k){const T=n.readUint32(),c=n.readUint32();if(0!==c)throw new Error(`Unexpected content format: ${c}`);const K=k-n.byteOffset,Q={json:this._parseJson(n.readString(T)),bin:null};if(0!==K){const k=n.byteOffset;Q.bin={readAsync:(T,c)=>n.buffer.readAsync(k+T,c),byteLength:K}}return Promise.resolve(Q)}_unpackBinaryV2Async(n,k){const T=1313821514,c=5130562,K=n.readUint32();if(n.readUint32()!==T)throw new Error("First chunk format is not JSON");return n.byteOffset+K===k?n.loadAsync(K).then((()=>({json:this._parseJson(n.readString(K)),bin:null}))):n.loadAsync(K+8).then((()=>{const Q={json:this._parseJson(n.readString(K)),bin:null},G=()=>{const K=n.readUint32();switch(n.readUint32()){case T:throw new Error("Unexpected JSON chunk");case c:{const k=n.byteOffset;Q.bin={readAsync:(T,c)=>n.buffer.readAsync(k+T,c),byteLength:K},n.skipBytes(K);break}default:n.skipBytes(K)}return n.byteOffset!==k?n.loadAsync(8).then(G):Promise.resolve(Q)};return G()}))}static _parseVersion(n){if("1.0"===n||"1.0.1"===n)return{major:1,minor:0};const k=(n+"").match(/^(\d+)\.(\d+)/);return k?{major:parseInt(k[1]),minor:parseInt(k[2])}:null}static _compareVersion(n,k){return n.major>k.major?1:n.major<k.major?-1:n.minor>k.minor?1:n.minor<k.minor?-1:0}_logOpen(n){this._log(n),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(n){const k=V._logSpaces.substring(0,2*this._logIndentLevel);I.d.Log(`${k}${n}`)}_logDisabled(n){}_startPerformanceCounterEnabled(n){K.e.StartPerformanceCounter(n)}_startPerformanceCounterDisabled(n){}_endPerformanceCounterEnabled(n){K.e.EndPerformanceCounter(n)}_endPerformanceCounterDisabled(n){}}V.IncrementalLoading=!0,V.HomogeneousCoordinates=!1,V._logSpaces="                                ",(0,Q.e)(new V)},12754:(n,k,T)=>{"use strict";T.d(k,{b:()=>G});var c=T(542);function K(n,k,T,c){const K={externalResourceFunction:c};return T&&(K.uri="file:"===k?T:k+T),ArrayBuffer.isView(n)?GLTFValidator.validateBytes(n,K):GLTFValidator.validateString(n,K)}function Q(){const n=[];onmessage=k=>{const T=k.data;switch(T.id){case"init":importScripts(T.url);break;case"validate":K(T.data,T.rootUrl,T.fileName,(k=>new Promise(((T,c)=>{const K=n.length;n.push({resolve:T,reject:c}),postMessage({id:"getExternalResource",index:K,uri:k})})))).then((n=>{postMessage({id:"validate.resolve",value:n})}),(n=>{postMessage({id:"validate.reject",reason:n})}));break;case"getExternalResource.resolve":n[T.index].resolve(T.value);break;case"getExternalResource.reject":n[T.index].reject(T.reason)}}}class G{static ValidateAsync(n,k,T,G){return"function"===typeof Worker?new Promise(((w,E)=>{const I=`${K}(${Q})()`,S=URL.createObjectURL(new Blob([I],{type:"application/javascript"})),P=new Worker(S),W=n=>{P.removeEventListener("error",W),P.removeEventListener("message",J),E(n)},J=n=>{const k=n.data;switch(k.id){case"getExternalResource":G(k.uri).then((n=>{P.postMessage({id:"getExternalResource.resolve",index:k.index,value:n},[n.buffer])}),(n=>{P.postMessage({id:"getExternalResource.reject",index:k.index,reason:n})}));break;case"validate.resolve":P.removeEventListener("error",W),P.removeEventListener("message",J),w(k.value),P.terminate();break;case"validate.reject":P.removeEventListener("error",W),P.removeEventListener("message",J),E(k.reason),P.terminate()}};if(P.addEventListener("error",W),P.addEventListener("message",J),P.postMessage({id:"init",url:c.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(n)){const c=n.slice();P.postMessage({id:"validate",data:c,rootUrl:k,fileName:T},[c.buffer])}else P.postMessage({id:"validate",data:n,rootUrl:k,fileName:T})})):(this._LoadScriptPromise||(this._LoadScriptPromise=c.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>K(n,k,T,G))))}}G.Configuration={url:`${c.e._DefaultCdnUrl}/gltf_validator.js`}},13105:(n,k,T)=>{"use strict";T.d(k,{e:()=>f});var c=T(706),K=T(712),Q=T(760),G=T(730),w=T(12237),E=T(12239),I=T(781),S=T(2475),P=T(675),W=T(624);T(12467),T(12361),T(12382),T(12368),T(12388),T(12394),T(12400);const J="imageProcessingCompatibility",H="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";W.b.IncludesShadersStore[J]||(W.b.IncludesShadersStore[J]=H);const s="skyPixelShader",b="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";W.b.ShadersStore[s]||(W.b.ShadersStore[s]=b);T(12479),T(12408),T(12415),T(12427),T(12422);const C="skyVertexShader",z="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";W.b.ShadersStore[C]||(W.b.ShadersStore[C]=z);var r=T(12251),q=T(929),O=T(919);class u extends w.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class f extends E.c{constructor(n,k){super(n,k),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new G.o(0,100,0),this.useSunPosition=!1,this.cameraOffset=G.o.Zero(),this.up=G.o.Up(),this.dithering=!1,this._cameraPosition=G.o.Zero(),this._skyOrientation=new G.h}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(n,k){const T=k._drawWrapper;if(this.isFrozen&&T.effect&&T._wasPreviouslyReady)return!0;k.materialDefines||(k.materialDefines=new u);const c=k.materialDefines,K=this.va();if(this._isReadyForSubMesh(k))return!0;if((0,O.N)(n,K,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,c),(0,O.C)(n,c,!0,!1),c.IMAGEPROCESSINGPOSTPROCESS!==K.imageProcessingConfiguration.applyByPostProcess&&c.markAsMiscDirty(),c.DITHER!==this.dithering&&c.markAsMiscDirty(),c.isDirty){c.markAsProcessed(),K.resetCachedMaterial();const n=new r.c;c.FOG&&n.addFallback(1,"FOG"),c.IMAGEPROCESSINGPOSTPROCESS=K.imageProcessingConfiguration.applyByPostProcess,c.DITHER=this.dithering;const T=[I.f.PositionKind];c.VERTEXCOLOR&&T.push(I.f.ColorKind);const Q="sky",G=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,q.c)(G);const w=c.toString();k.setEffect(K.getEngine().createEffect(Q,T,G,[],w,n,this.onCompiled,this.onError),c,this._materialContext)}return!(!k.effect||!k.effect.isReady())&&(c._renderId=K.getRenderId(),T._wasPreviouslyReady=!0,!0)}bindForSubMesh(n,k,T){const c=this.va(),K=T.materialDefines;if(!K)return;const Q=T.effect;if(!Q)return;this._activeEffect=Q,this.bindOnlyWorldMatrix(n),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),this._mustRebind(c,Q,T)&&((0,q.f)(Q,this,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,O.j)(K,Q,c)),c.fogEnabled&&k.applyFog&&c.fogMode!==S.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),(0,O.c)(c,k,this._activeEffect);const w=c.activeCamera;if(w){const n=w.getWorldMatrix();this._cameraPosition.x=n.m[12],this._cameraPosition.y=n.m[13],this._cameraPosition.z=n.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const n=Math.PI*(this.inclination-.5),k=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(k)*Math.cos(n),this.sunPosition.y=this.distance*Math.sin(-n),this.sunPosition.z=this.distance*Math.sin(k)*Math.cos(n),G.h.FromUnitVectorsToRef(G.o.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(k,this._activeEffect,T)}getAnimatables(){return[]}dispose(n){super.dispose(n)}clone(n){return Q.d.Clone((()=>new f(n,this.va())),this)}serialize(){const n=super.serialize();return n.customType="BABYLON.SkyMaterial",n}getClassName(){return"SkyMaterial"}static Parse(n,k,T){return Q.d.Parse((()=>new f(n.name,k)),n,k,T)}}(0,c.e)([(0,K.K)()],f.prototype,"luminance",void 0),(0,c.e)([(0,K.K)()],f.prototype,"turbidity",void 0),(0,c.e)([(0,K.K)()],f.prototype,"rayleigh",void 0),(0,c.e)([(0,K.K)()],f.prototype,"mieCoefficient",void 0),(0,c.e)([(0,K.K)()],f.prototype,"mieDirectionalG",void 0),(0,c.e)([(0,K.K)()],f.prototype,"distance",void 0),(0,c.e)([(0,K.K)()],f.prototype,"inclination",void 0),(0,c.e)([(0,K.K)()],f.prototype,"azimuth",void 0),(0,c.e)([(0,K.I)()],f.prototype,"sunPosition",void 0),(0,c.e)([(0,K.K)()],f.prototype,"useSunPosition",void 0),(0,c.e)([(0,K.I)()],f.prototype,"cameraOffset",void 0),(0,c.e)([(0,K.I)()],f.prototype,"up",void 0),(0,c.e)([(0,K.K)()],f.prototype,"dithering",void 0),(0,P.f)("BABYLON.SkyMaterial",f)},11868:(n,k,T)=>{"use strict";function c(n,k){k.headers=n.headers||{},k.statusMessage=n.statusText,k.statusCode=n.status,k.data=n.response}function K(n,k,T){return new Promise((function(K,Q){T=T||{};var G,w,E,I=new XMLHttpRequest,S=T.body,P=T.headers||{};for(G in T.timeout&&(I.timeout=T.timeout),I.ontimeout=I.onerror=function(n){n.timeout="timeout"==n.type,Q(n)},I.open(n,k.href||k),I.onload=function(){for(E=I.getAllResponseHeaders().trim().split(/[\r\n]+/),c(I,I);w=E.shift();)w=w.split(": "),I.headers[w.shift().toLowerCase()]=w.join(": ");if((w=I.headers["content-type"])&&~w.indexOf("application/json"))try{I.data=JSON.parse(I.data,T.reviver)}catch(n){return c(I,n),Q(n)}(I.status>=400?Q:K)(I)},typeof FormData<"u"&&S instanceof FormData||S&&"object"==typeof S&&(P["content-type"]="application/json",S=JSON.stringify(S)),I.withCredentials=!!T.withCredentials,P)I.setRequestHeader(G,P[G]);I.send(S)}))}T.r(k),T.d(k,{del:()=>E,get:()=>Q,patch:()=>w,post:()=>G,put:()=>I,send:()=>K});var Q=K.bind(K,"GET"),G=K.bind(K,"POST"),w=K.bind(K,"PATCH"),E=K.bind(K,"DELETE"),I=K.bind(K,"PUT")},13211:(n,k,T)=>{"use strict";T.d(k,{d:()=>P});const c=.5*(Math.sqrt(3)-1),K=(3-Math.sqrt(3))/6,Q=1/3,G=1/6,w=(Math.sqrt(5)-1)/4,E=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),S=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const P=class{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const k="function"==typeof n?n:function(n){let k=0,T=0,c=0,K=1;const Q=function(){let n=4022871197;return function(k){k=k.toString();for(let T=0;T<k.length;T++){n+=k.charCodeAt(T);let c=.02519603282416938*n;n=c>>>0,c-=n,c*=n,n=c>>>0,c-=n,n+=4294967296*c}return 2.3283064365386963e-10*(n>>>0)}}();k=Q(" "),T=Q(" "),c=Q(" "),k-=Q(n),k<0&&(k+=1);T-=Q(n),T<0&&(T+=1);c-=Q(n),c<0&&(c+=1);return function(){const n=2091639*k+2.3283064365386963e-10*K;return k=T,T=c,c=n-(K=0|n)}}(n);this.p=function(n){const k=new Uint8Array(256);for(let T=0;T<256;T++)k[T]=T;for(let T=0;T<255;T++){const c=T+~~(n()*(256-T)),K=k[T];k[T]=k[c],k[c]=K}return k}(k),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let T=0;T<512;T++)this.perm[T]=this.p[255&T],this.permMod12[T]=this.perm[T]%12}noise2D(n,k){const T=this.permMod12,Q=this.perm;let G=0,w=0,E=0;const S=(n+k)*c,P=Math.floor(n+S),W=Math.floor(k+S),J=(P+W)*K,H=n-(P-J),s=k-(W-J);let b,C;H>s?(b=1,C=0):(b=0,C=1);const z=H-b+K,r=s-C+K,q=H-1+2*K,O=s-1+2*K,u=255&P,f=255&W;let A=.5-H*H-s*s;if(A>=0){const n=3*T[u+Q[f]];A*=A,G=A*A*(I[n]*H+I[n+1]*s)}let v=.5-z*z-r*r;if(v>=0){const n=3*T[u+b+Q[f+C]];v*=v,w=v*v*(I[n]*z+I[n+1]*r)}let F=.5-q*q-O*O;if(F>=0){const n=3*T[u+1+Q[f+1]];F*=F,E=F*F*(I[n]*q+I[n+1]*O)}return 70*(G+w+E)}noise3D(n,k,T){const c=this.permMod12,K=this.perm;let w,E,S,P;const W=(n+k+T)*Q,J=Math.floor(n+W),H=Math.floor(k+W),s=Math.floor(T+W),b=(J+H+s)*G,C=n-(J-b),z=k-(H-b),r=T-(s-b);let q,O,u,f,A,v;C>=z?z>=r?(q=1,O=0,u=0,f=1,A=1,v=0):C>=r?(q=1,O=0,u=0,f=1,A=0,v=1):(q=0,O=0,u=1,f=1,A=0,v=1):z<r?(q=0,O=0,u=1,f=0,A=1,v=1):C<r?(q=0,O=1,u=0,f=0,A=1,v=1):(q=0,O=1,u=0,f=1,A=1,v=0);const F=C-q+G,m=z-O+G,x=r-u+G,g=C-f+2*G,U=z-A+2*G,V=r-v+2*G,Y=C-1+.5,Z=z-1+.5,e=r-1+.5,d=255&J,l=255&H,i=255&s;let B=.6-C*C-z*z-r*r;if(B<0)w=0;else{const n=3*c[d+K[l+K[i]]];B*=B,w=B*B*(I[n]*C+I[n+1]*z+I[n+2]*r)}let t=.6-F*F-m*m-x*x;if(t<0)E=0;else{const n=3*c[d+q+K[l+O+K[i+u]]];t*=t,E=t*t*(I[n]*F+I[n+1]*m+I[n+2]*x)}let M=.6-g*g-U*U-V*V;if(M<0)S=0;else{const n=3*c[d+f+K[l+A+K[i+v]]];M*=M,S=M*M*(I[n]*g+I[n+1]*U+I[n+2]*V)}let o=.6-Y*Y-Z*Z-e*e;if(o<0)P=0;else{const n=3*c[d+1+K[l+1+K[i+1]]];o*=o,P=o*o*(I[n]*Y+I[n+1]*Z+I[n+2]*e)}return 32*(w+E+S+P)}noise4D(n,k,T,c){const K=this.perm;let Q,G,I,P,W;const J=(n+k+T+c)*w,H=Math.floor(n+J),s=Math.floor(k+J),b=Math.floor(T+J),C=Math.floor(c+J),z=(H+s+b+C)*E,r=n-(H-z),q=k-(s-z),O=T-(b-z),u=c-(C-z);let f=0,A=0,v=0,F=0;r>q?f++:A++,r>O?f++:v++,r>u?f++:F++,q>O?A++:v++,q>u?A++:F++,O>u?v++:F++;const m=f>=3?1:0,x=A>=3?1:0,g=v>=3?1:0,U=F>=3?1:0,V=f>=2?1:0,Y=A>=2?1:0,Z=v>=2?1:0,e=F>=2?1:0,d=f>=1?1:0,l=A>=1?1:0,i=v>=1?1:0,B=F>=1?1:0,t=r-m+E,M=q-x+E,o=O-g+E,D=u-U+E,R=r-V+2*E,L=q-Y+2*E,h=O-Z+2*E,j=u-e+2*E,p=r-d+3*E,a=q-l+3*E,X=O-i+3*E,y=u-B+3*E,N=r-1+4*E,nn=q-1+4*E,kn=O-1+4*E,Tn=u-1+4*E,cn=255&H,Kn=255&s,Qn=255&b,Gn=255&C;let wn=.6-r*r-q*q-O*O-u*u;if(wn<0)Q=0;else{const n=K[cn+K[Kn+K[Qn+K[Gn]]]]%32*4;wn*=wn,Q=wn*wn*(S[n]*r+S[n+1]*q+S[n+2]*O+S[n+3]*u)}let En=.6-t*t-M*M-o*o-D*D;if(En<0)G=0;else{const n=K[cn+m+K[Kn+x+K[Qn+g+K[Gn+U]]]]%32*4;En*=En,G=En*En*(S[n]*t+S[n+1]*M+S[n+2]*o+S[n+3]*D)}let In=.6-R*R-L*L-h*h-j*j;if(In<0)I=0;else{const n=K[cn+V+K[Kn+Y+K[Qn+Z+K[Gn+e]]]]%32*4;In*=In,I=In*In*(S[n]*R+S[n+1]*L+S[n+2]*h+S[n+3]*j)}let Sn=.6-p*p-a*a-X*X-y*y;if(Sn<0)P=0;else{const n=K[cn+d+K[Kn+l+K[Qn+i+K[Gn+B]]]]%32*4;Sn*=Sn,P=Sn*Sn*(S[n]*p+S[n+1]*a+S[n+2]*X+S[n+3]*y)}let Pn=.6-N*N-nn*nn-kn*kn-Tn*Tn;if(Pn<0)W=0;else{const n=K[cn+1+K[Kn+1+K[Qn+1+K[Gn+1]]]]%32*4;Pn*=Pn,W=Pn*Pn*(S[n]*N+S[n+1]*nn+S[n+2]*kn+S[n+3]*Tn)}return 27*(Q+G+I+P+W)}}}}]);