/*! For license information please see xcm6t2.7.5eb0c8d4.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{13237:t=>{"use strict";t.exports=function(t,q,S,o,B,z){var L=+q[0],r=+q[1],e=+q[2],C=+S[0],Z=+S[1],b=+S[2],O=Math.sqrt(C*C+Z*Z+b*b);if(0===O)throw new Error("Can't raycast along a zero vector");return function(t,q,S,o,B,z,L,r,e,C){for(var Z=0,b=Math.floor,O=0|b(q),i=0|b(S),h=0|b(o),l=B>0?1:-1,I=z>0?1:-1,a=L>0?1:-1,v=Math.abs(1/B),M=Math.abs(1/z),x=Math.abs(1/L),k=v<1/0?v*(l>0?O+1-q:q-O):1/0,V=M<1/0?M*(I>0?i+1-S:S-i):1/0,J=x<1/0?x*(a>0?h+1-o:o-h):1/0,U=-1;Z<=r;){var H=t(O,i,h);if(H)return e&&(e[0]=q+Z*B,e[1]=S+Z*z,e[2]=o+Z*L),C&&(C[0]=C[1]=C[2]=0,0===U&&(C[0]=-l),1===U&&(C[1]=-I),2===U&&(C[2]=-a)),H;k<V?k<J?(O+=l,Z=k,k+=v,U=0):(h+=a,Z=J,J+=x,U=2):V<J?(i+=I,Z=V,V+=M,U=1):(h+=a,Z=J,J+=x,U=2)}return e&&(e[0]=q+Z*B,e[1]=S+Z*z,e[2]=o+Z*L),C&&(C[0]=C[1]=C[2]=0),0}(t,L,r,e,C/=O,Z/=O,b/=O,o="undefined"===typeof o?64:+o,B,z)}},13276:(t,q,S)=>{"use strict";S.d(q,{e:()=>z});var o=S(81);function B(){this.Wl=!1,this.stopPropagation=!1,this.Xl=!1,this.disabled=!1}class z{constructor(t,q){this.version="0.7.0";var S=Object.assign({},new B,q||{});this.element=t||document,this.Wl=!!S.Wl,this.stopPropagation=!!S.stopPropagation,this.Xl=!!S.Xl,this.disabled=!!S.disabled,this.filterEvents=(t,q)=>!0,this.down=new o.EventEmitter,this.up=new o.EventEmitter,this.state={},this.Dk={dx:0,dy:0,Dm:0,Fg:0,Em:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?r(this):document.addEventListener("DOMContentLoaded",(t=>{r(this)}),{once:!0})}bind(t){for(var q=arguments.length,S=new Array(q>1?q-1:0),o=1;o<q;o++)S[o-1]=arguments[o];S.forEach((q=>{var S=this._keyBindmap[q]||[];S.includes(t)||(S.push(t),this._keyBindmap[q]=S)})),this.state[t]=!!this.state[t],this.pressCount[t]=this.pressCount[t]||0,this.releaseCount[t]=this.releaseCount[t]||0}unbind(t){for(var q in this._keyBindmap){var S=this._keyBindmap[q],o=S.indexOf(t);o>-1&&S.splice(o,1)}}getBindings(){var t={};for(var q in this._keyBindmap){this._keyBindmap[q].forEach((S=>{t[S]=t[S]||[],t[S].push(q)}))}return t}Ze(){L(this.Dk),L(this.pressCount),L(this.releaseCount)}}function L(t){for(var q in t)t[q]=0}function r(t){window.addEventListener("keydown",h.bind(null,t,!0),!1),window.addEventListener("keyup",h.bind(null,t,!1),!1);var q={passive:!0};t.element.addEventListener("touchstart",b.bind(void 0,t),{passive:!1}),t.element.addEventListener("touchend",i.bind(void 0,t),q),t.element.addEventListener("mousedown",l.bind(null,t,!0),q),window.document.addEventListener("mouseup",l.bind(null,t,!1),q),t.element.addEventListener("touchmove",I.bind(null,t),q),t.element.addEventListener("mousemove",I.bind(null,t),q),window.PointerEvent,t.element.addEventListener("wheel",a.bind(null,t),q),t.element.addEventListener("contextmenu",v.bind(null,t),!1),window.addEventListener("blur",M.bind(null,t),!1)}var e=0,C=0,Z=null;function b(t,q){q.preventDefault(),O(q)}function O(t){let q=!1;for(let S=0;S<t.touches.length;++S)if(t.touches[S].identifier===Z){q=!0;break}if(!q){const q=t.changedTouches[0];e=q.clientX,C=q.clientY,Z=q.identifier}}function i(t,q){for(var S=q.changedTouches,o=0;o<S.length;++o)S[o].identifier===Z&&(Z=null)}function h(t,q,S){x(S.code,q,t,S)}function l(t,q,S){if("pointerId"in S)if(q){if(null!==t._touches.currID)return;t._touches.currID=S.pointerId}else{if(t._touches.currID!==S.pointerId)return;t._touches.currID=null}return x("Mouse"+("button"in S?S.button+1:1),q,t,S),!1}function I(t,q){var S=q.movementX||q.mozMovementX||0,o=q.movementY||q.mozMovementY||0;if(q.touches&&0===(S|o)){var B=function(t){O(t);for(let q=0;q<t.changedTouches.length;++q)if(t.changedTouches[q].identifier==Z){const S=t.changedTouches[q],o=[S.clientX-e,S.clientY-C];return e=S.clientX,C=S.clientY,o}return console.error(`Did not find touch id ${Z}`),[0,0]}(q);S=B[0],o=B[1]}t.Dk.dx+=S,t.Dk.dy+=o}function a(t,q){var S=1;switch(q.deltaMode){case 0:S=1;break;case 1:S=12;break;case 2:S=t.element.clientHeight||window.innerHeight}t.Dk.Dm+=(q.deltaX||0)*S,t.Dk.Fg+=(q.deltaY||0)*S,t.Dk.Em+=(q.deltaZ||0)*S}function v(t,q){if(!t.Xl)return q.preventDefault(),!1}function M(t){for(var q in t._keyStates)t._keyStates[q]&&(/^Mouse\d/.test(q)||x(q,!1,t,{code:q,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function x(t,q,S,o){var B=S._keyBindmap[t];B&&(k(S._keyStates[t],q)&&(S._keyStates[t]=q,B.forEach((t=>{(!S.filterEvents||S.filterEvents(o,t))&&function(t,q,S,o){var B=q?S.pressCount:S.releaseCount;B[t]=(B[t]||0)+1;var z=S._bindPressCount[t]||0;(z+=q?1:-1)<0&&(z=0);S._bindPressCount[t]=z;var L=S.state[t];if(k(L,z)){S.state[t]=z>0;var r=q?S.down:S.up;S.disabled||r.emit(t,o)}}(t,q,S,o)}))),"button"in o||(S.Wl&&!o.defaultPrevented&&o.preventDefault(),S.stopPropagation&&o.stopPropagation()))}function k(t,q){return t?!q:q}},13245:(t,q,S)=>{"use strict";S.d(q,{d:()=>o});class o{constructor(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.bl=!1,this.cl=!1,this.Lh=30,this.al=0,this.jl=!1,this.fullscreen=!1,this.el=function(t){},this.fl=function(){},this.hl=function(){},this.k=function(){},this.gl=function(t){},this.onFullscreenChanged=function(t){},C((()=>{!function(t,q){t._nowObject=performance||Date,t._lastTick=0,t._renderAccum=0,t._rt=0,t._frameCB=r.bind(null,t),requestAnimationFrame(t._frameCB),q>0&&(t._intervalCB=L.bind(null,t),t._interval=setInterval(t._intervalCB,Math.max(q,1e3/t.Lh/2)))}(this,q),function(t,q){if(!q)return;var S=!1,o=!1;document.addEventListener("pointerlockchange",(o=>{S=document.pointerLockElement===q,t.gl(S)})),document.addEventListener("fullscreenchange",(S=>{o=document.fullscreenElement===q,t.onFullscreenChanged(o)})),Object.defineProperty(t,"jl",{get:()=>S,set:t=>{t&&!S?e(q):S&&!t&&function(t){t.exitPointerLock&&t.exitPointerLock()}(document)}}),Object.defineProperty(t,"fullscreen",{get:()=>o,set:t=>{t&&!o?q.requestFullscreen():o&&!t&&document.exitFullscreen()}}),q.addEventListener("click",(B=>{t.bl&&!S&&e(q),t.cl&&!o&&q.requestFullscreen()}));var B=()=>t.k();if(window.ResizeObserver){new ResizeObserver(B).observe(q)}else window.addEventListener("resize",B)}(this,t),this.hl()}))}}var B=3,z=20;function L(t){for(var q=1e3/t.Lh,S=t._nowObject.now()+z,o=0;t._nowObject.now()>=t._lastTick+q&&t._nowObject.now()<S&&++o<=B;)t.el(q),t._lastTick+=q;var L=5*(q+5),r=t._nowObject.now();if(r-t._lastTick>L)for(;r>=t._lastTick+q;)t._lastTick+=q}function r(t){requestAnimationFrame(t._frameCB),L(t);var q=t._nowObject.now(),S=q-t._rt;if(t._rt=q,t.al>0){t._renderAccum+=S;var o=1e3/t.al;if(t._renderAccum<o)return;t._renderAccum=Math.min(t._renderAccum-o,o)}var B=1e3/t.Lh,z=(q-t._lastTick)/B;t.fl(S,z,B)}function e(t){t.requestPointerLock&&t.requestPointerLock()}var C=t=>{if("loading"===document.readyState){var q=()=>{document.removeEventListener("readystatechange",q),t()};document.addEventListener("readystatechange",q)}else setTimeout(t,1)}},13278:(t,q,S)=>{"use strict";S.d(q,{c:()=>b});var o=S(862),B=S(139);class z{constructor(t,q,S,z,L,r,e){this.Rh=new o(t.base,t.Sh),this.mass=q,this.friction=S,this.restitution=z,this.Ik=L,this.$h=r,this.Jk=!!e,this.$i=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.jh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Th=B.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=B.create(),this._impulses=B.create(),this._sleepFrameCount=10}loadFromCopy(t){B.i(this.Rh.base,t.Rh.base),B.i(this.Rh.Sh,t.Rh.Sh),B.i(this.Rh.max,t.Rh.max),this.Rh.mag=t.Rh.mag,this.mass=t.mass,this.friction=t.friction,this.restitution=t.restitution,this.Ik=t.Ik,this.$h=t.$h,this.Jk=t.Jk,this.$i=t.$i,this.fluidDrag=t.fluidDrag,this.jh=t.jh,this.preventFallOffEdge=t.preventFallOffEdge,this.rolledBackLastTick=t.rolledBackLastTick,B.i(this.Th,t.Th),B.i(this.resting,t.resting),this.inFluid=t.inFluid,this._ratioInFluid=t._ratioInFluid,B.i(this._forces,t._forces),B.i(this._impulses,t._impulses),this._sleepFrameCount=t._sleepFrameCount}setPosition(t){L(t),B.Kg(t,t,this.Rh.base),this.Rh.translate(t),this.Mg()}Se(){return B.clone(this.Rh.base)}applyForce(t){L(t),B.add(this._forces,this._forces,t),this.Mg()}applyImpulse(t){L(t),B.add(this._impulses,this._impulses,t),this.Mg()}Mg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var L=t=>{};var r=S(862),e=S(139),C=S(867);function Z(){this.$i=.1,this.fluidDrag=.4,this.zj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function b(t,q,S){t=Object.assign(new Z,t),this.gravity=t.gravity||[0,-10,0],this.$i=t.$i||.1,this.zj=t.zj||2,this.fluidDrag=t.fluidDrag||.4,this.minBounceImpulse=t.minBounceImpulse,this.bodies=[],this.vm=t.vm,this.testSolid=q,this.testFluid=S}b.prototype.Gh=function(t,q,S,o,B,L){t=t||new r([0,0,0],[1,1,1]),"undefined"==typeof q&&(q=1),"undefined"==typeof S&&(S=1),"undefined"==typeof o&&(o=0),"undefined"==typeof B&&(B=1);var e=new z(t,q,S,o,B,L);return this.bodies.push(e),e},b.prototype.Jh=function(t){var q=this.bodies.indexOf(t);q<0||(this.bodies.splice(q,1),t.Rh=t.$h=null)};var O=e.create(),i=e.create(),h=e.create(),l=e.create(),I=e.create(),a=e.create(),v=e.create(),M=new r([0,0,0],[1,1,1]),x=new z(M,1,1,0,1,(()=>{}),!1);function k(t,q,S){return q=S,q*=1-(1-t.ratioInFluid)**2}b.prototype.Ze=function(t){t/=1e3;var q=D(0,e.squaredLength(this.gravity));this.bodies.forEach((S=>function(t,q,S,o){e.i(I,q.resting),t.vm&&x.loadFromCopy(q);if(q.mass<=0)return e.set(q.Th,0,0,0),e.set(q._forces,0,0,0),void e.set(q._impulses,0,0,0);var B=o||0===q.Ik;if(function(t,q,S,o){if(q._sleepFrameCount>0)return!1;if(o)return!0;var B=!1,z=.5*S*S*q.Ik;return e.scale(f,t.gravity,z),C(t.testSolid,q.Rh,f,(function(){return B=!0,!0}),!0),B}(t,q,S,B))return;q._sleepFrameCount--,function(t,q){var S=q.Rh,o=Math.floor(S.base[0]),B=Math.floor(S.base[2]),z=Math.floor(S.base[1]),L=Math.floor(S.max[1]);if(!t.testFluid(o,z,B))return q.inFluid=!1,void(q.ratioInFluid=0);var r=1,C=z+1;for(;C<=L&&t.testFluid(o,C,B);)r++,C++;var Z=(z+r-S.base[1])/S.Sh[1];Z>1&&(Z=1);var b=S.Sh[0]*S.Sh[1]*S.Sh[2]*Z,O=J;e.scale(O,t.gravity,-t.zj*b*q.Ik),q.applyForce(O),q.inFluid=!0,q.ratioInFluid=Z}(t,q),A(q._forces),A(q._impulses),A(q.Th),A(q.resting),e.scale(O,q._forces,1/q.mass),e.uh(O,O,t.gravity,q.Ik),e.scale(i,q._impulses,1/q.mass),e.uh(i,i,O,S),e.add(q.Th,q.Th,i),q.friction&&(U(t,0,q,i,S),U(t,1,q,i,S),U(t,2,q,i,S));var z=q.fluidDrag>=0?q.fluidDrag:t.fluidDrag,L=q.$i>=0?q.$i:t.$i,r=L,Z=L;q.inFluid&&(r=k(q,r,q.fluidDragHoriz>=0?q.fluidDragHoriz:z),Z=k(q,Z,q.fluidDragVert>=0?q.fluidDragVert:z));r=Math.max(1-r*S/q.mass,0),Z=Math.max(1-Z*S/q.mass,0),e.set(V,r,Z,r),e.multiply(q.Th,q.Th,V),e.scale(h,q.Th,S),e.set(q._forces,0,0,0),e.set(q._impulses,0,0,0),q.Jk&&m(y,q.Rh);e.i(a,h),e.set(v,0,0,0),q.preventFallOffEdge&&function(t,q,S,o){if(!q.resting[1]||S[1]>0)return;var B=n;m(B,q.Rh);for(var z=0;z<3;z+=2){e.set(Y,0,0,0),Y[z]=S[z];var L=!0;(L=(L=(L=(L=L&&!W(t,B.base[0]+Y[0]+1e-5,B.base[1],B.base[2]+Y[2]+1e-5))&&!W(t,B.max[0]+Y[0]-1e-5,B.base[1],B.base[2]+Y[2]+1e-5))&&!W(t,B.base[0]+Y[0]+1e-5,B.base[1],B.max[2]+Y[2]-1e-5))&&!W(t,B.max[0]+Y[0]-1e-5,B.base[1],B.max[2]+Y[2]-1e-5))?(o[z]=S[z]>0?1:-1,S[z]=0):0===z&&(e.set(u,S[0],0,0),j(t,B,u,o,q.slideOnCollision))}}(t,q,h,v);j(t,q.Rh,h,q.resting,q.slideOnCollision),q.Jk&&function(t,q,S,o){if(q.resting[1]>=0&&!q.inFluid)return;var B=0!==q.resting[0],z=0!==q.resting[2];if(!B&&!z)return;var L=Math.abs(o[0]/o[2]),r=4;if(!B&&L>r)return;if(!z&&L<1/r)return;e.add(K,S.base,o);var Z=t.testSolid;C(Z,S,o,(function(t,q,S,o){if(1!==q)return!0;o[q]=0}));var b=S.base[1],O=q.inFluid?1.951:1.001,i=Math.floor(b+O)-b;e.set(X,0,i,0);var h=!1;if(C(Z,S,X,(function(t,q,S,o){return h=!0,!0})),h)return;e.Kg(G,K,S.base),G[1]=0,j(t,S,G,Q,!0);var l=D(S.base[0],K[0]),I=D(S.base[2],K[2]);if(B&&!l&&(!I||!z))return;if(z&&(!l||!B)&&!I)return;var a=!0;if(a=a&&!W(t,S.base[0]+1e-5,S.base[1],S.base[2]+1e-5),a=a&&!W(t,S.max[0]-1e-5,S.base[1],S.base[2]+1e-5),a=a&&!W(t,S.base[0]+1e-5,S.base[1],S.max[2]-1e-5),a=a&&!W(t,S.max[0]-1e-5,S.base[1],S.max[2]-1e-5),a)return;m(q.Rh,S),q.resting[0]=Q[0],q.resting[2]=Q[2],q.jh&&q.jh()}(t,q,y,a);for(var b=0;b<3;++b)q.resting[b]=q.resting[b]||v[b],l[b]=0,q.resting[b]&&(I[b]||(l[b]=-q.Th[b]),q.Th[b]=0);var M=e.length(l);M>.001&&(e.scale(l,l,q.mass),q.$h&&q.$h(l),q.restitution>0&&M>t.minBounceImpulse&&(e.scale(l,l,q.restitution),q.applyImpulse(l)));var H=e.squaredLength(q.Th);H>1e-5&&q.Mg();t.vm&&t.vm(q)?(q.loadFromCopy(x),q.rolledBackLastTick=!0):q.rolledBackLastTick=!1}(this,S,t,q)))};var V=e.create([0,0,0]);var J=e.create();function U(t,q,S,o,B){var z=S.resting[q],L=o[q];if(!S.alwaysApplyHorizFriction||1!==q){if(0===z)return;if(z*L<=0)return}e.i(H,S.Th),H[q]=0;var r=e.length(H);if(!D(r,0)){var C=Math.abs(S.friction*t.gravity[q]*B),Z=r>C?(r-C)/r:0;S.Th[(q+1)%3]*=Z,S.Th[(q+2)%3]*=Z}}var H=e.create();function j(t,q,S,o,B){return e.set(o,0,0,0),C(t.testSolid,q,S,(function(t,q,S,z){o[q]=S,z[q]=0,B||(z[0]=0,z[1]=0,z[2]=0)}))}var y=new r([],[]),Q=e.create(),K=e.create(),X=e.create(),G=e.create();var Y=e.create(),n=new r([],[]),u=e.create();function W(t,q,S,o){return t.testSolid(Math.floor(q),Math.floor(S-1),Math.floor(o))}var f=e.create();function D(t,q){return Math.abs(t-q)<1e-5}function m(t,q){for(var S=0;S<3;S++)t.base[S]=q.base[S],t.max[S]=q.max[S],t.Sh[S]=q.Sh[S]}var A=function(t){}},12181:function(t,q){!function(t){"use strict";var q=function(t,S){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,q){t.__proto__=q}||function(t,q){for(var S in q)Object.prototype.hasOwnProperty.call(q,S)&&(t[S]=q[S])},q(t,S)};function S(t,S){if("function"!==typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function o(){this.constructor=t}q(t,S),t.prototype=null===S?Object.create(S):(o.prototype=S.prototype,new o)}function o(t,q,S,o){var B,z=arguments.length,L=z<3?q:null===o?o=Object.getOwnPropertyDescriptor(q,S):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)L=Reflect.decorate(t,q,S,o);else for(var r=t.length-1;r>=0;r--)(B=t[r])&&(L=(z<3?B(L):z>3?B(q,S,L):B(q,S))||L);return z>3&&L&&Object.defineProperty(q,S,L),L}function B(t,q,S){if(S||2===arguments.length)for(var o,B=0,z=q.length;B<z;B++)!o&&B in q||(o||(o=Array.prototype.slice.call(q,0,B)),o[B]=q[B]);return t.concat(o||Array.prototype.slice.call(q))}var z,L=255,r=213;t.OPERATION=void 0,(z=t.OPERATION||(t.OPERATION={}))[z.ADD=128]="ADD",z[z.REPLACE=0]="REPLACE",z[z.DELETE=64]="DELETE",z[z.DELETE_AND_ADD=192]="DELETE_AND_ADD",z[z.TOUCH=1]="TOUCH",z[z.CLEAR=10]="CLEAR";var e=function(){function q(t,q,S){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(q,S)}return q.prototype.setParent=function(t,q,S){var o=this;if(this.indexes||(this.indexes=this.ref instanceof Gt?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=S,q)if(this.root=q,this.ref instanceof Gt){var B=this.ref._definition;for(var z in B.schema){var L=this.ref[z];if(L&&L.$changes){var r=B.indexes[z];L.$changes.setParent(this.ref,q,r)}}}else"object"===typeof this.ref&&this.ref.forEach((function(t,q){if(t instanceof Gt){var S=t.$changes,B=o.ref.$changes.indexes[q];S.setParent(o.ref,o.root,B)}}))},q.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},q.prototype.change=function(q,S){void 0===S&&(S=t.OPERATION.ADD);var o="number"===typeof q?q:this.indexes[q];this.assertValidIndex(o,q);var B=this.changes.get(o);B&&B.op!==t.OPERATION.DELETE&&B.op!==t.OPERATION.TOUCH||this.changes.set(o,{op:B&&B.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:S,index:o}),this.allChanges.add(o),this.changed=!0,this.touchParents()},q.prototype.touch=function(q){var S="number"===typeof q?q:this.indexes[q];this.assertValidIndex(S,q),this.changes.has(S)||this.changes.set(S,{op:t.OPERATION.TOUCH,index:S}),this.allChanges.add(S),this.touchParents()},q.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},q.prototype.getType=function(t){if(this.ref._definition)return(q=this.ref._definition).schema[q.fieldsByIndex[t]];var q,S=(q=this.parent._definition).schema[q.fieldsByIndex[this.parentIndex]];return Object.values(S)[0]},q.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},q.prototype.getValue=function(t){return this.ref.getByIndex(t)},q.prototype.delete=function(q){var S="number"===typeof q?q:this.indexes[q];if(void 0!==S){var o=this.getValue(S);this.changes.set(S,{op:t.OPERATION.DELETE,index:S}),this.allChanges.delete(S),delete this.caches[S],o&&o.$changes&&(o.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(q," (").concat(S,")"))},q.prototype.discard=function(q,S){var o=this;void 0===q&&(q=!1),void 0===S&&(S=!1),this.ref instanceof Gt||this.changes.forEach((function(q){if(q.op===t.OPERATION.DELETE){var S=o.ref.getIndex(q.index);delete o.indexes[S]}})),this.changes.clear(),this.changed=q,S&&this.allChanges.clear(),this.currentCustomOperation=0},q.prototype.discardAll=function(){var t=this;this.changes.forEach((function(q){var S=t.getValue(q.index);S&&S.$changes&&S.$changes.discardAll()})),this.discard()},q.prototype.cache=function(t,q){this.caches[t]=q},q.prototype.clone=function(){return new q(this.ref,this.parent,this.root)},q.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},q.prototype.assertValidIndex=function(t,q){if(void 0===t)throw new Error('ChangeTree: missing index for field "'.concat(q,'"'))},q}();function C(t,q,S,o){return t[q]||(t[q]=[]),t[q].push(S),null===o||void 0===o||o.forEach((function(t,q){return S(t,q)})),function(){return b(t[q],t[q].indexOf(S))}}function Z(q){var S=this,o="string"!==typeof this.$changes.getType();this.$items.forEach((function(B,z){q.push({refId:S.$changes.refId,op:t.OPERATION.DELETE,field:z,value:void 0,previousValue:B}),o&&S.$changes.root.removeRef(B.$changes.refId)}))}function b(t,q){if(-1===q||q>=t.length)return!1;for(var S=t.length-1,o=q;o<S;o++)t[o]=t[o+1];return t.length=S,!0}var O=function(t,q){var S=t.toString(),o=q.toString();return S<o?-1:S>o?1:0};function i(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,q){return"symbol"===typeof q||isNaN(q)?t[q]:t.at(q)},set:function(t,q,S){if("symbol"===typeof q||isNaN(q))t[q]=S;else{var o=Array.from(t.$items.keys()),B=parseInt(o[q]||q);void 0===S||null===S?t.deleteAt(B):t.setAt(B,S)}return!0},deleteProperty:function(t,q){return"number"===typeof q?t.deleteAt(q):delete t[q],!0}})}var h=function(){function q(){for(var t=[],q=0;q<arguments.length;q++)t[q]=arguments[q];this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return q.prototype.qh=function(q,S){return void 0===S&&(S=!0),C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,q,S?this.$items:void 0)},q.prototype.mh=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,q)},q.is=function(t){return Array.isArray(t)||void 0!==t.array},Object.defineProperty(q.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),q.prototype.push=function(){for(var t,q=this,S=[],o=0;o<arguments.length;o++)S[o]=arguments[o];return S.forEach((function(S){t=q.$refId++,q.setAt(t,S)})),t},q.prototype.pop=function(){var t=Array.from(this.$indexes.values()).pop();if(void 0!==t){this.$changes.delete(t),this.$indexes.delete(t);var q=this.$items.get(t);return this.$items.delete(t),q}},q.prototype.at=function(t){var q=Array.from(this.$items.keys())[t];return this.$items.get(q)},q.prototype.setAt=function(q,S){var o,B;if(void 0!==S&&null!==S){if(this.$items.get(q)!==S){void 0!==S.$changes&&S.$changes.setParent(this,this.$changes.root,q);var z=null!==(B=null===(o=this.$changes.indexes[q])||void 0===o?void 0:o.op)&&void 0!==B?B:t.OPERATION.ADD;this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,S),this.$changes.change(q,z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},q.prototype.deleteAt=function(t){var q=Array.from(this.$items.keys())[t];return void 0!==q&&this.$deleteAt(q)},q.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&Z.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.concat=function(){for(var t,S=[],o=0;o<arguments.length;o++)S[o]=arguments[o];return new(q.bind.apply(q,B([void 0],(t=Array.from(this.$items.values())).concat.apply(t,S),!1)))},q.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},q.prototype.reverse=function(){var t=this,q=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(S,o){t.setAt(q[o],S)})),this},q.prototype.shift=function(){var t=Array.from(this.$items.keys()).shift();if(void 0!==t){var q=this.$items.get(t);return this.$deleteAt(t),q}},q.prototype.slice=function(t,S){var o=new q;return o.push.apply(o,Array.from(this.$items.values()).slice(t,S)),o},q.prototype.sort=function(t){var q=this;void 0===t&&(t=O);var S=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(t).forEach((function(t,o){q.setAt(S[o],t)})),this},q.prototype.splice=function(t,q){void 0===q&&(q=this.length-t);for(var S=Array.from(this.$items.keys()),o=[],B=t;B<t+q;B++)o.push(this.$items.get(S[B])),this.$deleteAt(S[B]);return o},q.prototype.unshift=function(){for(var t=this,q=[],S=0;S<arguments.length;S++)q[S]=arguments[S];var o=this.length,B=q.length,z=Array.from(this.$items.values());return q.forEach((function(q,S){t.setAt(S,q)})),z.forEach((function(q,S){t.setAt(B+S,q)})),o+B},q.prototype.indexOf=function(t,q){return Array.from(this.$items.values()).indexOf(t,q)},q.prototype.lastIndexOf=function(t,q){return void 0===q&&(q=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,q)},q.prototype.every=function(t,q){return Array.from(this.$items.values()).every(t,q)},q.prototype.some=function(t,q){return Array.from(this.$items.values()).some(t,q)},q.prototype.forEach=function(t,q){Array.from(this.$items.values()).forEach(t,q)},q.prototype.map=function(t,q){return Array.from(this.$items.values()).map(t,q)},q.prototype.filter=function(t,q){return Array.from(this.$items.values()).filter(t,q)},q.prototype.reduce=function(t,q){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},q.prototype.reduceRight=function(t,q){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},q.prototype.find=function(t,q){return Array.from(this.$items.values()).find(t,q)},q.prototype.findIndex=function(t,q){return Array.from(this.$items.values()).findIndex(t,q)},q.prototype.fill=function(t,q,S){throw new Error("ArraySchema#fill() not implemented")},q.prototype.copyWithin=function(t,q,S){throw new Error("ArraySchema#copyWithin() not implemented")},q.prototype.toString=function(){return this.$items.toString()},q.prototype.toLocaleString=function(){return this.$items.toLocaleString()},q.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},q.prototype.includes=function(t,q){return Array.from(this.$items.values()).includes(t,q)},q.prototype.flatMap=function(t,q){throw new Error("ArraySchema#flatMap() is not supported.")},q.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},q.prototype.findLast=function(){var t=Array.from(this.$items.values());return t.findLast.apply(t,arguments)},q.prototype.findLastIndex=function(){var t=Array.from(this.$items.values());return t.findLastIndex.apply(t,arguments)},q.prototype.setIndex=function(t,q){this.$indexes.set(t,q)},q.prototype.getIndex=function(t){return this.$indexes.get(t)},q.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},q.prototype.deleteByIndex=function(t){var q=this.$indexes.get(t);this.$items.delete(q),this.$indexes.delete(t)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){return this.toArray().map((function(t){return"function"===typeof t.toJSON?t.toJSON():t}))},q.prototype.clone=function(t){return t?new(q.bind.apply(q,B([void 0],Array.from(this.$items.values()),!1))):new(q.bind.apply(q,B([void 0],this.map((function(t){return t.$changes?t.clone():t})),!1)))},q}();function l(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,q){return"symbol"!==typeof q&&"undefined"===typeof t[q]?t.get(q):t[q]},set:function(t,q,S){return"symbol"!==typeof q&&-1===q.indexOf("$")&&"qh"!==q&&"mh"!==q&&"onChange"!==q?t.set(q,S):t[q]=S,!0},deleteProperty:function(t,q){return t.delete(q),!0}})}var I=function(){function q(t){var S=this;if(this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map||t instanceof q)t.forEach((function(t,q){return S.set(q,t)}));else for(var o in t)this.set(o,t[o])}return q.prototype.qh=function(q,S){return void 0===S&&(S=!0),C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,q,S?this.$items:void 0)},q.prototype.mh=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,q)},q.is=function(t){return void 0!==t.map},q.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(q.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(q,Symbol.species,{get:function(){return q},enumerable:!1,configurable:!0}),q.prototype.set=function(q,S){if(void 0===S||null===S)throw new Error("MapSchema#set('".concat(q,"', ").concat(S,"): trying to set ").concat(S," value on '").concat(q,"'."));q=q.toString();var o="undefined"!==typeof this.$changes.indexes[q],B=o?this.$changes.indexes[q]:this.$refId++,z=o?t.OPERATION.REPLACE:t.OPERATION.ADD,L=void 0!==S.$changes;if(L&&S.$changes.setParent(this,this.$changes.root,B),o){if(!L&&this.$items.get(q)===S)return;L&&this.$items.get(q)!==S&&(z=t.OPERATION.ADD)}else this.$changes.indexes[q]=B,this.$indexes.set(B,q);return this.$items.set(q,S),this.$changes.change(q,z),this},q.prototype.get=function(t){return this.$items.get(t)},q.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&Z.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(t){return this.$items.has(t)},q.prototype.forEach=function(t){this.$items.forEach(t)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.keys=function(){return this.$items.keys()},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(t,q){this.$indexes.set(t,q)},q.prototype.getIndex=function(t){return this.$indexes.get(t)},q.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},q.prototype.deleteByIndex=function(t){var q=this.$indexes.get(t);this.$items.delete(q),this.$indexes.delete(t)},q.prototype.toJSON=function(){var t={};return this.forEach((function(q,S){t[S]="function"===typeof q.toJSON?q.toJSON():q})),t},q.prototype.clone=function(t){var S;return t?S=Object.assign(new q,this):(S=new q,this.forEach((function(t,q){t.$changes?S.set(q,t.clone()):S.set(q,t)}))),S},q}(),a={};function v(t,q){a[t]=q}function M(t){return a[t]}var x=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(q){var S=new t;return S.schema=Object.assign({},q&&q.schema||{}),S.indexes=Object.assign({},q&&q.indexes||{}),S.fieldsByIndex=Object.assign({},q&&q.fieldsByIndex||{}),S.descriptors=Object.assign({},q&&q.descriptors||{}),S.deprecated=Object.assign({},q&&q.deprecated||{}),S},t.prototype.addField=function(t,q){var S=this.getNextFieldIndex();this.fieldsByIndex[S]=t,this.indexes[t]=S,this.schema[t]=Array.isArray(q)?{array:q[0]}:q},t.prototype.hasField=function(t){return void 0!==this.indexes[t]},t.prototype.addFilter=function(t,q){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=q,this.indexesWithFilters.push(this.indexes[t]),!0},t.prototype.addChildrenFilter=function(t,q){var S=this.indexes[t],o=this.schema[t];if(M(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[S]=q,!0;console.warn("@filterChildren: field '".concat(t,"' can't have children. Ignoring filter."))},t.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();function k(t){return t._context&&t._context.useFilters}var V=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(t){return this.schemas.has(t)},t.prototype.get=function(t){return this.types[t]},t.prototype.add=function(t,q){void 0===q&&(q=this.schemas.size),t._definition=x.create(t._definition),t._typeid=q,this.types[q]=t,this.schemas.set(t,q)},t.create=function(q){return void 0===q&&(q={}),function(S){return q.context||(q.context=new t),U(S,q)}},t}(),J=new V;function U(t,q){return void 0===q&&(q={}),function(S,o){var z=q.context||J,L=S.constructor;if(L._context=z,!t)throw new Error("".concat(L.name,': @type() reference provided for "').concat(o,"\" is undefined. Make sure you don't have any circular dependencies."));z.has(L)||z.add(L);var r=L._definition;if(r.addField(o,t),r.descriptors[o]){if(r.deprecated[o])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(o,"' definition on '").concat(L.name,"'.\nCheck @type() annotation"))}catch(a){var e=a.stack.split("\n")[4].trim();throw new Error("".concat(a.message," ").concat(e))}}var C=h.is(t),Z=!C&&I.is(t);if("string"!==typeof t&&!Gt.is(t)){var b=Object.values(t)[0];"string"===typeof b||z.has(b)||z.add(b)}if(q.manual)r.descriptors[o]={enumerable:!0,configurable:!0,writable:!0};else{var O="_".concat(o);r.descriptors[O]={enumerable:!1,configurable:!1,writable:!0},r.descriptors[o]={get:function(){return this[O]},set:function(t){t!==this[O]&&(void 0!==t&&null!==t?(!C||t instanceof h||(t=new(h.bind.apply(h,B([void 0],t,!1)))),!Z||t instanceof I||(t=new I(t)),void 0===t.$proxy&&(Z?t=l(t):C&&(t=i(t))),this.$changes.change(o),t.$changes&&t.$changes.setParent(this,this.$changes.root,this._definition.indexes[o])):this[O]&&this.$changes.delete(o),this[O]=t)},enumerable:!0,configurable:!0}}}}function H(t){return function(q,S){var o=q.constructor;o._definition.addFilter(S,t)&&(o._context.useFilters=!0)}}function j(t){return function(q,S){var o=q.constructor;o._definition.addChildrenFilter(S,t)&&(o._context.useFilters=!0)}}function y(t){return void 0===t&&(t=!0),function(q,S){var o=q.constructor._definition;o.deprecated[S]=!0,t&&(o.descriptors[S]={get:function(){throw new Error("".concat(S," is deprecated."))},set:function(t){},enumerable:!1,configurable:!0})}}function Q(t,q,S){for(var o in void 0===S&&(S={}),S.context||(S.context=t._context||S.context||J),q)U(q[o],S)(t.prototype,o);return t}function K(t){for(var q=0,S=0,o=0,B=t.length;o<B;o++)(q=t.charCodeAt(o))<128?S+=1:q<2048?S+=2:q<55296||q>=57344?S+=3:(o++,S+=4);return S}function X(t,q,S){for(var o=0,B=0,z=S.length;B<z;B++)(o=S.charCodeAt(B))<128?t[q++]=o:o<2048?(t[q++]=192|o>>6,t[q++]=128|63&o):o<55296||o>=57344?(t[q++]=224|o>>12,t[q++]=128|o>>6&63,t[q++]=128|63&o):(B++,o=65536+((1023&o)<<10|1023&S.charCodeAt(B)),t[q++]=240|o>>18,t[q++]=128|o>>12&63,t[q++]=128|o>>6&63,t[q++]=128|63&o)}function G(t,q){t.push(255&q)}function Y(t,q){t.push(255&q)}function n(t,q){t.push(255&q),t.push(q>>8&255)}function u(t,q){t.push(255&q),t.push(q>>8&255)}function W(t,q){t.push(255&q),t.push(q>>8&255),t.push(q>>16&255),t.push(q>>24&255)}function f(t,q){var S=q>>24,o=q>>16,B=q>>8,z=q;t.push(255&z),t.push(255&B),t.push(255&o),t.push(255&S)}function D(t,q){var S=Math.floor(q/Math.pow(2,32));f(t,q>>>0),f(t,S)}function m(t,q){var S=q/Math.pow(2,32)|0;f(t,q>>>0),f(t,S)}function A(t,q){T(t,q)}function c(t,q){w(t,q)}var s=new Int32Array(2),g=new Float32Array(s.buffer),N=new Float64Array(s.buffer);function T(t,q){g[0]=q,W(t,s[0])}function w(t,q){N[0]=q,W(t,s[0]),W(t,s[1])}function E(t,q){return Y(t,q?1:0)}function p(t,q){q||(q="");var S=K(q),o=0;if(S<32)t.push(160|S),o=1;else if(S<256)t.push(217),Y(t,S),o=2;else if(S<65536)t.push(218),u(t,S),o=3;else{if(!(S<4294967296))throw new Error("String too long");t.push(219),f(t,S),o=5}return X(t,t.length,q),o+S}function P(t,q){return isNaN(q)?P(t,0):isFinite(q)?q!==(0|q)?(t.push(203),w(t,q),9):q>=0?q<128?(Y(t,q),1):q<256?(t.push(204),Y(t,q),2):q<65536?(t.push(205),u(t,q),3):q<4294967296?(t.push(206),f(t,q),5):(t.push(207),m(t,q),9):q>=-32?(t.push(224|q+32),1):q>=-128?(t.push(208),G(t,q),2):q>=-32768?(t.push(209),n(t,q),3):q>=-2147483648?(t.push(210),W(t,q),5):(t.push(211),D(t,q),9):P(t,q>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var F=Object.freeze({__proto__:null,utf8Write:X,int8:G,uint8:Y,int16:n,uint16:u,int32:W,uint32:f,int64:D,uint64:m,float32:A,float64:c,writeFloat32:T,writeFloat64:w,boolean:E,string:p,number:P});function d(t,q,S){for(var o="",B=0,z=q,L=q+S;z<L;z++){var r=t[z];0!==(128&r)?192!==(224&r)?224!==(240&r)?240!==(248&r)?console.error("Invalid byte "+r.toString(16)):(B=(7&r)<<18|(63&t[++z])<<12|(63&t[++z])<<6|63&t[++z])>=65536?(B-=65536,o+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):o+=String.fromCharCode(B):o+=String.fromCharCode((15&r)<<12|(63&t[++z])<<6|63&t[++z]):o+=String.fromCharCode((31&r)<<6|63&t[++z]):o+=String.fromCharCode(r)}return o}function R(t,q){return tt(t,q)<<24>>24}function tt(t,q){return t[q.offset++]}function qt(t,q){return St(t,q)<<16>>16}function St(t,q){return t[q.offset++]|t[q.offset++]<<8}function ot(t,q){return t[q.offset++]|t[q.offset++]<<8|t[q.offset++]<<16|t[q.offset++]<<24}function Bt(t,q){return ot(t,q)>>>0}function zt(t,q){return Ot(t,q)}function Lt(t,q){return it(t,q)}function rt(t,q){var S=Bt(t,q);return ot(t,q)*Math.pow(2,32)+S}function et(t,q){var S=Bt(t,q);return Bt(t,q)*Math.pow(2,32)+S}var Ct=new Int32Array(2),Zt=new Float32Array(Ct.buffer),bt=new Float64Array(Ct.buffer);function Ot(t,q){return Ct[0]=ot(t,q),Zt[0]}function it(t,q){return Ct[0]=ot(t,q),Ct[1]=ot(t,q),bt[0]}function ht(t,q){return tt(t,q)>0}function lt(t,q){var S,o=t[q.offset++];o<192?S=31&o:217===o?S=tt(t,q):218===o?S=St(t,q):219===o&&(S=Bt(t,q));var B=d(t,q.offset,S);return q.offset+=S,B}function It(t,q){var S=t[q.offset];return S<192&&S>160||217===S||218===S||219===S}function at(t,q){var S=t[q.offset++];return S<128?S:202===S?Ot(t,q):203===S?it(t,q):204===S?tt(t,q):205===S?St(t,q):206===S?Bt(t,q):207===S?et(t,q):208===S?R(t,q):209===S?qt(t,q):210===S?ot(t,q):211===S?rt(t,q):S>223?-1*(255-S+1):void 0}function vt(t,q){var S=t[q.offset];return S<128||S>=202&&S<=211}function Mt(t,q){return t[q.offset]<160}function xt(t,q){return t[q.offset-1]===L&&(t[q.offset]<128||t[q.offset]>=202&&t[q.offset]<=211)}var kt=Object.freeze({__proto__:null,int8:R,uint8:tt,int16:qt,uint16:St,int32:ot,uint32:Bt,float32:zt,float64:Lt,int64:rt,uint64:et,readFloat32:Ot,readFloat64:it,boolean:ht,string:lt,stringCheck:It,number:at,numberCheck:vt,arrayCheck:Mt,switchStructureCheck:xt}),Vt=function(){function q(t){var q=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return q.add(t)}))}return q.prototype.qh=function(q,S){return void 0===S&&(S=!0),C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,q,S?this.$items:void 0)},q.prototype.mh=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,q)},q.is=function(t){return void 0!==t.collection},q.prototype.add=function(t){var q=this.$refId++;return void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,q),this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,t),this.$changes.change(q),q},q.prototype.at=function(t){var q=Array.from(this.$items.keys())[t];return this.$items.get(q)},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(t){for(var q,S,o=this.$items.entries();(S=o.next())&&!S.done;)if(t===S.value[1]){q=S.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&Z.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(t){return Array.from(this.$items.values()).some((function(q){return q===t}))},q.prototype.forEach=function(t){var q=this;this.$items.forEach((function(S,o,B){return t(S,o,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(t,q){this.$indexes.set(t,q)},q.prototype.getIndex=function(t){return this.$indexes.get(t)},q.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},q.prototype.deleteByIndex=function(t){var q=this.$indexes.get(t);this.$items.delete(q),this.$indexes.delete(t)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var t=[];return this.forEach((function(q,S){t.push("function"===typeof q.toJSON?q.toJSON():q)})),t},q.prototype.clone=function(t){var S;return t?S=Object.assign(new q,this):(S=new q,this.forEach((function(t){t.$changes?S.add(t.clone()):S.add(t)}))),S},q}(),Jt=function(){function q(t){var q=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return q.add(t)}))}return q.prototype.qh=function(q,S){return void 0===S&&(S=!0),C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,q,S?this.$items:void 0)},q.prototype.mh=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,q)},q.prototype.onChange=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,q)},q.is=function(t){return void 0!==t.set},q.prototype.add=function(q){var S,o;if(this.has(q))return!1;var B=this.$refId++;void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,B);var z=null!==(o=null===(S=this.$changes.indexes[B])||void 0===S?void 0:S.op)&&void 0!==o?o:t.OPERATION.ADD;return this.$changes.indexes[B]=B,this.$indexes.set(B,B),this.$items.set(B,q),this.$changes.change(B,z),B},q.prototype.entries=function(){return this.$items.entries()},q.prototype.delete=function(t){for(var q,S,o=this.$items.entries();(S=o.next())&&!S.done;)if(t===S.value[1]){q=S.value[0];break}return void 0!==q&&(this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q))},q.prototype.clear=function(q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),q&&Z.call(this,q),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},q.prototype.has=function(t){for(var q,S=this.$items.values(),o=!1;(q=S.next())&&!q.done;)if(t===q.value){o=!0;break}return o},q.prototype.forEach=function(t){var q=this;this.$items.forEach((function(S,o,B){return t(S,o,q)}))},q.prototype.values=function(){return this.$items.values()},Object.defineProperty(q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),q.prototype.setIndex=function(t,q){this.$indexes.set(t,q)},q.prototype.getIndex=function(t){return this.$indexes.get(t)},q.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},q.prototype.deleteByIndex=function(t){var q=this.$indexes.get(t);this.$items.delete(q),this.$indexes.delete(t)},q.prototype.toArray=function(){return Array.from(this.$items.values())},q.prototype.toJSON=function(){var t=[];return this.forEach((function(q,S){t.push("function"===typeof q.toJSON?q.toJSON():q)})),t},q.prototype.clone=function(t){var S;return t?S=Object.assign(new q,this):(S=new q,this.forEach((function(t){t.$changes?S.add(t.clone()):S.add(t)}))),S},q}(),Ut=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},t.get=function(q){return void 0===q.$filterState&&(q.$filterState=new t),q.$filterState},t}(),Ht=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(t,q,S){void 0===S&&(S=!0),this.refs.set(t,q),S&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},t.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var t=this;this.deletedRefs.forEach((function(q){if(!(t.refCounts[q]>0)){var S=t.refs.get(q);if(S instanceof Gt)for(var o in S._definition.schema)"string"!==typeof S._definition.schema[o]&&S[o]&&S[o].$changes&&t.removeRef(S[o].$changes.refId);else{var B=S.$changes.parent._definition,z=B.schema[B.fieldsByIndex[S.$changes.parentIndex]];"function"===typeof Object.values(z)[0]&&Array.from(S.values()).forEach((function(q){return t.removeRef(q.$changes.refId)}))}t.refs.delete(q),delete t.refCounts[q]}})),this.deletedRefs.clear()},t}(),jt=function(t){function q(){return null!==t&&t.apply(this,arguments)||this}return S(q,t),q}(Error);function yt(t,q,S,o){var B,z=!1;switch(q){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":B="number",isNaN(t)&&console.log('trying to encode "NaN" in '.concat(S.constructor.name,"#").concat(o));break;case"string":B="string",z=!0;break;case"boolean":return}if(typeof t!==B&&(!z||z&&null!==t)){var L="'".concat(JSON.stringify(t),"'").concat(t&&t.constructor&&" (".concat(t.constructor.name,")")||"");throw new jt("a '".concat(B,"' was expected, but ").concat(L," was provided in ").concat(S.constructor.name,"#").concat(o))}}function Qt(t,q,S,o){if(!(t instanceof q))throw new jt("a '".concat(q.name,"' was expected, but '").concat(t.constructor.name,"' was provided in ").concat(S.constructor.name,"#").concat(o))}function Kt(t,q,S,o,B){yt(S,t,o,B);var z=F[t];if(!z)throw new jt("a '".concat(t,"' was expected, but ").concat(S," was provided in ").concat(o.constructor.name,"#").concat(B));z(q,S)}function Xt(t,q,S){return kt[t](q,S)}var Gt=function(){function q(){for(var t=[],q=0;q<arguments.length;q++)t[q]=arguments[q];Object.defineProperties(this,{$changes:{value:new e(this,void 0,new Ht),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var S=this._definition.descriptors;S&&Object.defineProperties(this,S),t[0]&&this.assign(t[0])}return q.onError=function(t){console.error(t)},q.is=function(t){return t._definition&&void 0!==t._definition.schema},q.prototype.onChange=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,q)},q.prototype.mh=function(q){return C(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,q)},q.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(q.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),q.prototype.setDirty=function(t,q){this.$changes.change(t,q)},q.prototype.listen=function(t,q,S){var o=this;return void 0===S&&(S=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[t]||(this.$callbacks[t]=[]),this.$callbacks[t].push(q),S&&void 0!==this[t]&&q(this[t],void 0),function(){return b(o.$callbacks[t],o.$callbacks[t].indexOf(q))}},q.prototype.decode=function(S,o,B){var z;void 0===o&&(o={offset:0}),void 0===B&&(B=this);var r=[],e=this.$changes.root,C=S.length,Z=0;for(e.refs.set(Z,this);o.offset<C;){var b=S[o.offset++];if(b!=L){var O=B.$changes,i=void 0!==B._definition,l=i?b>>6<<6:b;if(l!==t.OPERATION.CLEAR){var a=i?b%(l||255):at(S,o),v=i?B._definition.fieldsByIndex[a]:"",x=O.getType(a),k=void 0,V=void 0,J=void 0;if(i?V=B["_".concat(v)]:(V=B.getByIndex(a),(l&t.OPERATION.ADD)===t.OPERATION.ADD?(J=B instanceof I?lt(S,o):a,B.setIndex(a,J)):J=B.getIndex(a)),(l&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(l!==t.OPERATION.DELETE_AND_ADD&&B.deleteByIndex(a),V&&V.$changes&&e.removeRef(V.$changes.refId),k=null),void 0!==v){if(l===t.OPERATION.DELETE);else if(q.is(x)){var U=at(S,o);if(k=e.refs.get(U),l!==t.OPERATION.REPLACE){var H=this.getSchemaType(S,o,x);k||((k=this.createTypeInstance(H)).$changes.refId=U,V&&(k.$callbacks=V.$callbacks,V.$changes.refId&&U!==V.$changes.refId&&e.removeRef(V.$changes.refId))),e.addRef(U,k,k!==V)}}else if("string"===typeof x)k=Xt(x,S,o);else{var j=M(Object.keys(x)[0]),y=at(S,o),Q=e.refs.has(y)?V||e.refs.get(y):new j.constructor;if((k=Q.clone(!0)).$changes.refId=y,V&&(k.$callbacks=V.$callbacks,V.$changes.refId&&y!==V.$changes.refId)){e.removeRef(V.$changes.refId);for(var K=V.entries(),X=void 0;(X=K.next())&&!X.done;){var G=(z=X.value)[0],Y=z[1];r.push({refId:y,op:t.OPERATION.DELETE,field:G,value:void 0,previousValue:Y})}}e.addRef(y,k,Q!==V)}if(null!==k&&void 0!==k)if(k.$changes&&k.$changes.setParent(O.ref,O.root,a),B instanceof q)B[v]=k;else if(B instanceof I)G=J,B.$items.set(G,k),B.$changes.allChanges.add(a);else if(B instanceof h)B.setAt(a,k);else if(B instanceof Vt){var n=B.add(k);B.setIndex(a,n)}else B instanceof Jt&&!1!==(n=B.add(k))&&B.setIndex(a,n);V!==k&&r.push({refId:Z,op:l,field:v,dynamicIndex:J,value:k,previousValue:V})}else{console.warn("@colyseus/schema: definition mismatch");for(var u={offset:o.offset};o.offset<C&&(!xt(S,o)||(u.offset=o.offset+1,!e.refs.has(at(S,u))));)o.offset++}}else B.clear(r)}else{Z=at(S,o);var W=e.refs.get(Z);if(!W)throw new Error('"refId" not found: '.concat(Z));B=W}}return this._triggerChanges(r),e.garbageCollectDeletedRefs(),r},q.prototype.encode=function(S,o,B){void 0===S&&(S=!1),void 0===o&&(o=[]),void 0===B&&(B=!1);for(var z=this.$changes,r=new WeakSet,e=[z],C=1,Z=0;Z<C;Z++){var b=e[Z],O=b.ref,i=O instanceof q;b.ensureRefId(),r.add(b),b!==z&&(b.changed||S)&&(Y(o,L),P(o,b.refId));for(var h=S?Array.from(b.allChanges):Array.from(b.changes.values()),l=0,a=h.length;l<a;l++){var v=S?{op:t.OPERATION.ADD,index:h[l]}:h[l],x=v.index,k=i?O._definition.fieldsByIndex&&O._definition.fieldsByIndex[x]:x,V=o.length;if(v.op!==t.OPERATION.TOUCH)if(i)Y(o,x|v.op);else{if(Y(o,v.op),v.op===t.OPERATION.CLEAR)continue;P(o,x)}if(i||(v.op&t.OPERATION.ADD)!=t.OPERATION.ADD||O instanceof I&&p(o,b.ref.$indexes.get(x)),v.op!==t.OPERATION.DELETE){var J=b.getType(x),U=b.getValue(x);if(U&&U.$changes&&!r.has(U.$changes)&&(e.push(U.$changes),U.$changes.ensureRefId(),C++),v.op!==t.OPERATION.TOUCH){if(q.is(J))Qt(U,J,O,k),P(o,U.$changes.refId),(v.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(o,J,U.constructor);else if("string"===typeof J)Kt(J,o,U,O,k);else{var H=M(Object.keys(J)[0]);Qt(O["_".concat(k)],H.constructor,O,k),P(o,U.$changes.refId)}B&&b.cache(x,o.slice(V))}}}S||B||b.discard()}return o},q.prototype.encodeAll=function(t){return this.encode(!0,[],t)},q.prototype.applyFilters=function(S,o){var B,z;void 0===o&&(o=!1);for(var r=this,e=new Set,C=Ut.get(S),Z=[this.$changes],b=1,O=[],i=function(i){var h=Z[i];if(e.has(h.refId))return"continue";var l=h.ref,a=l instanceof q;Y(O,L),P(O,h.refId);var v=C.refIds.has(h),M=o||!v;C.addRefId(h);var x=C.containerIndexes.get(h),k=M?Array.from(h.allChanges):Array.from(h.changes.values());!o&&a&&l._definition.indexesWithFilters&&l._definition.indexesWithFilters.forEach((function(q){!x.has(q)&&h.allChanges.has(q)&&(M?k.push(q):k.push({op:t.OPERATION.ADD,index:q}))}));for(var V=0,J=k.length;V<J;V++){var U=M?{op:t.OPERATION.ADD,index:k[V]}:k[V];if(U.op!==t.OPERATION.CLEAR){var H=U.index;if(U.op!==t.OPERATION.DELETE){var j=h.getValue(H),y=h.getType(H);if(a){if((Q=l._definition.filters&&l._definition.filters[H])&&!Q.call(l,S,j,r)){j&&j.$changes&&e.add(j.$changes.refId);continue}}else{var Q,K=h.parent;if((Q=h.getChildrenFilter())&&!Q.call(K,S,l.$indexes.get(H),j,r)){j&&j.$changes&&e.add(j.$changes.refId);continue}}if(j.$changes&&(Z.push(j.$changes),b++),U.op!==t.OPERATION.TOUCH)if(U.op===t.OPERATION.ADD||a)O.push.apply(O,null!==(B=h.caches[H])&&void 0!==B?B:[]),x.add(H);else if(x.has(H))O.push.apply(O,null!==(z=h.caches[H])&&void 0!==z?z:[]);else{if(x.add(H),Y(O,t.OPERATION.ADD),P(O,H),l instanceof I){var X=h.ref.$indexes.get(H);p(O,X)}j.$changes?P(O,j.$changes.refId):F[y](O,j)}else j.$changes&&!a&&(Y(O,t.OPERATION.ADD),P(O,H),l instanceof I&&(X=h.ref.$indexes.get(H),p(O,X)),P(O,j.$changes.refId))}else a?Y(O,U.op|H):(Y(O,U.op),P(O,H))}else Y(O,U.op)}},h=0;h<b;h++)i(h);return O},q.prototype.clone=function(){var t,q=new this.constructor,S=this._definition.schema;for(var o in S)"object"===typeof this[o]&&"function"===typeof(null===(t=this[o])||void 0===t?void 0:t.clone)?q[o]=this[o].clone():q[o]=this[o];return q},q.prototype.toJSON=function(){var t=this._definition.schema,q=this._definition.deprecated,S={};for(var o in t)q[o]||null===this[o]||"undefined"===typeof this[o]||(S[o]="function"===typeof this[o].toJSON?this[o].toJSON():this["_".concat(o)]);return S},q.prototype.discardAllChanges=function(){this.$changes.discardAll()},q.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},q.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},q.prototype.tryEncodeTypeId=function(t,q,S){q._typeid!==S._typeid&&(Y(t,r),P(t,S._typeid))},q.prototype.getSchemaType=function(t,q,S){var o;return t[q.offset]===r&&(q.offset++,o=this.constructor._context.get(at(t,q))),o||S},q.prototype.createTypeInstance=function(t){var q=new t;return q.$changes.root=this.$changes.root,q},q.prototype._triggerChanges=function(S){for(var o,B,z,L,r,e,C,Z,b,O=new Set,i=this.$changes.root.refs,h=function(h){var l=S[h],I=l.refId,a=i.get(I),v=a.$callbacks;if((l.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&l.previousValue instanceof q&&(null===(B=null===(o=l.previousValue.$callbacks)||void 0===o?void 0:o[t.OPERATION.DELETE])||void 0===B||B.forEach((function(t){return t()}))),!v)return"continue";if(a instanceof q){if(!O.has(I))try{null===(z=null===v||void 0===v?void 0:v[t.OPERATION.REPLACE])||void 0===z||z.forEach((function(t){return t()}))}catch(M){q.onError(M)}try{v.hasOwnProperty(l.field)&&(null===(L=v[l.field])||void 0===L||L.forEach((function(t){return t(l.value,l.previousValue)})))}catch(M){q.onError(M)}}else l.op===t.OPERATION.ADD&&void 0===l.previousValue?null===(r=v[t.OPERATION.ADD])||void 0===r||r.forEach((function(t){var q;return t(l.value,null!==(q=l.dynamicIndex)&&void 0!==q?q:l.field)})):l.op===t.OPERATION.DELETE?void 0!==l.previousValue&&(null===(e=v[t.OPERATION.DELETE])||void 0===e||e.forEach((function(t){var q;return t(l.previousValue,null!==(q=l.dynamicIndex)&&void 0!==q?q:l.field)}))):l.op===t.OPERATION.DELETE_AND_ADD&&(void 0!==l.previousValue&&(null===(C=v[t.OPERATION.DELETE])||void 0===C||C.forEach((function(t){var q;return t(l.previousValue,null!==(q=l.dynamicIndex)&&void 0!==q?q:l.field)}))),null===(Z=v[t.OPERATION.ADD])||void 0===Z||Z.forEach((function(t){var q;return t(l.value,null!==(q=l.dynamicIndex)&&void 0!==q?q:l.field)}))),l.value!==l.previousValue&&(null===(b=v[t.OPERATION.REPLACE])||void 0===b||b.forEach((function(t){var q;return t(l.value,null!==(q=l.dynamicIndex)&&void 0!==q?q:l.field)})));O.add(I)},l=0;l<S.length;l++)h(l)},q._definition=x.create(),q}();function Yt(t){for(var q=[t.$changes],S=1,o={},B=o,z=function(t){var S=q[t];S.changes.forEach((function(t){var q=S.ref,o=t.index,z=q._definition?q._definition.fieldsByIndex[o]:q.$indexes.get(o);B[z]=S.getValue(o)}))},L=0;L<S;L++)z(L);return o}var nt={context:new V},ut=function(t){function q(){return null!==t&&t.apply(this,arguments)||this}return S(q,t),o([U("string",nt)],q.prototype,"name",void 0),o([U("string",nt)],q.prototype,"type",void 0),o([U("number",nt)],q.prototype,"referencedType",void 0),q}(Gt),Wt=function(t){function q(){var q=null!==t&&t.apply(this,arguments)||this;return q.fields=new h,q}return S(q,t),o([U("number",nt)],q.prototype,"id",void 0),o([U([ut],nt)],q.prototype,"fields",void 0),q}(Gt),ft=function(t){function q(){var q=null!==t&&t.apply(this,arguments)||this;return q.types=new h,q}return S(q,t),q.encode=function(t){var S=t.constructor,o=new q;o.rootType=S._typeid;var B=function(t,q){for(var S in q){var B=new ut;B.name=S;var z=void 0;if("string"===typeof q[S])z=q[S];else{var L=q[S],r=void 0;Gt.is(L)?(z="ref",r=q[S]):"string"===typeof L[z=Object.keys(L)[0]]?z+=":"+L[z]:r=L[z],B.referencedType=r?r._typeid:-1}B.type=z,t.fields.push(B)}o.types.push(t)},z=S._context.types;for(var L in z){var r=new Wt;r.id=Number(L),B(r,z[L]._definition.schema)}return o.encodeAll()},q.decode=function(t,o){var B=new V,z=new q;z.decode(t,o);var L=z.types.reduce((function(t,q){var o=function(t){function q(){return null!==t&&t.apply(this,arguments)||this}return S(q,t),q}(Gt),z=q.id;return t[z]=o,B.add(o,z),t}),{});z.types.forEach((function(t){var q=L[t.id];t.fields.forEach((function(t){var S;if(void 0!==t.referencedType){var o=t.type,z=L[t.referencedType];if(!z){var r=t.type.split(":");o=r[0],z=r[1]}"ref"===o?U(z,{context:B})(q.prototype,t.name):U(((S={})[o]=z,S),{context:B})(q.prototype,t.name)}else U(t.type,{context:B})(q.prototype,t.name)}))}));var r=L[z.rootType],e=new r;for(var C in r._definition.schema){var Z=r._definition.schema[C];"string"!==typeof Z&&(e[C]="function"===typeof Z?new Z:new(M(Object.keys(Z)[0]).constructor))}return e},o([U([Wt],nt)],q.prototype,"types",void 0),o([U("number",nt)],q.prototype,"rootType",void 0),q}(Gt);v("map",{constructor:I}),v("array",{constructor:h}),v("set",{constructor:Jt}),v("collection",{constructor:Vt}),t.ArraySchema=h,t.CollectionSchema=Vt,t.Context=V,t.MapSchema=I,t.Reflection=ft,t.ReflectionField=ut,t.ReflectionType=Wt,t.Schema=Gt,t.SchemaDefinition=x,t.SetSchema=Jt,t.decode=kt,t.defineTypes=Q,t.deprecated=y,t.dumpChanges=Yt,t.encode=F,t.filter=H,t.filterChildren=j,t.hasFilter=k,t.registerType=v,t.type=U,Object.defineProperty(t,"__esModule",{value:!0})}(q)},13159:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13156:(t,q,S)=>{var o=S(13159),B=S(13162),z=Object.hasOwnProperty,L=Object.create(null);for(var r in o)z.call(o,r)&&(L[o[r]]=r);var e=t.exports={to:{},get:{}};function C(t,q,S){return Math.min(Math.max(q,t),S)}function Z(t){var q=Math.round(t).toString(16).toUpperCase();return q.length<2?"0"+q:q}e.get=function(t){var q,S;switch(t.substring(0,3).toLowerCase()){case"hsl":q=e.get.hsl(t),S="hsl";break;case"hwb":q=e.get.hwb(t),S="hwb";break;default:q=e.get.rgb(t),S="rgb"}return q?{model:S,value:q}:null},e.get.rgb=function(t){if(!t)return null;var q,S,B,L=[0,0,0,1];if(q=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(B=q[2],q=q[1],S=0;S<3;S++){var r=2*S;L[S]=parseInt(q.slice(r,r+2),16)}B&&(L[3]=parseInt(B,16)/255)}else if(q=t.match(/^#([a-f0-9]{3,4})$/i)){for(B=(q=q[1])[3],S=0;S<3;S++)L[S]=parseInt(q[S]+q[S],16);B&&(L[3]=parseInt(B+B,16)/255)}else if(q=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(S=0;S<3;S++)L[S]=parseInt(q[S+1],0);q[4]&&(q[5]?L[3]=.01*parseFloat(q[4]):L[3]=parseFloat(q[4]))}else{if(!(q=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(q=t.match(/^(\w+)$/))?"transparent"===q[1]?[0,0,0,0]:z.call(o,q[1])?((L=o[q[1]])[3]=1,L):null:null;for(S=0;S<3;S++)L[S]=Math.round(2.55*parseFloat(q[S+1]));q[4]&&(q[5]?L[3]=.01*parseFloat(q[4]):L[3]=parseFloat(q[4]))}for(S=0;S<3;S++)L[S]=C(L[S],0,255);return L[3]=C(L[3],0,1),L},e.get.hsl=function(t){if(!t)return null;var q=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var S=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,C(parseFloat(q[2]),0,100),C(parseFloat(q[3]),0,100),C(isNaN(S)?1:S,0,1)]}return null},e.get.hwb=function(t){if(!t)return null;var q=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(q){var S=parseFloat(q[4]);return[(parseFloat(q[1])%360+360)%360,C(parseFloat(q[2]),0,100),C(parseFloat(q[3]),0,100),C(isNaN(S)?1:S,0,1)]}return null},e.to.hex=function(){var t=B(arguments);return"#"+Z(t[0])+Z(t[1])+Z(t[2])+(t[3]<1?Z(Math.round(255*t[3])):"")},e.to.rgb=function(){var t=B(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},e.to.rgb.percent=function(){var t=B(arguments),q=Math.round(t[0]/255*100),S=Math.round(t[1]/255*100),o=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+q+"%, "+S+"%, "+o+"%)":"rgba("+q+"%, "+S+"%, "+o+"%, "+t[3]+")"},e.to.hsl=function(){var t=B(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},e.to.hwb=function(){var t=B(arguments),q="";return t.length>=4&&1!==t[3]&&(q=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+q+")"},e.to.keyword=function(t){return L[t.slice(0,3)]}},13147:(t,q,S)=>{const o=S(13156),B=S(13171),z=["keyword","gray","hex"],L={};for(const i of Object.keys(B))L[[...B[i].labels].sort().join("")]=i;const r={};function e(t,q){if(!(this instanceof e))return new e(t,q);if(q&&q in z&&(q=null),q&&!(q in B))throw new Error("Unknown model: "+q);let S,C;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof e)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if("string"===typeof t){const q=o.get(t);if(null===q)throw new Error("Unable to parse color from string: "+t);this.model=q.model,C=B[this.model].channels,this.color=q.value.slice(0,C),this.valpha="number"===typeof q.value[C]?q.value[C]:1}else if(t.length>0){this.model=q||"rgb",C=B[this.model].channels;const S=Array.prototype.slice.call(t,0,C);this.color=O(S,C),this.valpha="number"===typeof t[C]?t[C]:1}else if("number"===typeof t)this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;const q=Object.keys(t);"alpha"in t&&(q.splice(q.indexOf("alpha"),1),this.valpha="number"===typeof t.alpha?t.alpha:0);const o=q.sort().join("");if(!(o in L))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=L[o];const{labels:z}=B[this.model],r=[];for(S=0;S<z.length;S++)r.push(t[z[S]]);this.color=O(r)}if(r[this.model])for(C=B[this.model].channels,S=0;S<C;S++){const t=r[this.model][S];t&&(this.color[S]=t(this.color[S]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}e.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let q=this.model in o.to?this:this.rgb();q=q.round("number"===typeof t?t:1);const S=1===q.valpha?q.color:[...q.color,this.valpha];return o.to[q.model](S)},percentString(t){const q=this.rgb().round("number"===typeof t?t:1),S=1===q.valpha?q.color:[...q.color,this.valpha];return o.to.rgb.percent(S)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:q}=B[this.model],{labels:S}=B[this.model];for(let o=0;o<q;o++)t[S[o]]=this.color[o];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new e([...this.color.map(C(t)),this.valpha],this.model)},alpha(t){return void 0!==t?new e([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:Z("rgb",0,b(255)),green:Z("rgb",1,b(255)),blue:Z("rgb",2,b(255)),hue:Z(["hsl","hsv","hsl","hwb","hcg"],0,(t=>(t%360+360)%360)),saturationl:Z("hsl",1,b(100)),lightness:Z("hsl",2,b(100)),saturationv:Z("hsv",1,b(100)),value:Z("hsv",2,b(100)),chroma:Z("hcg",1,b(100)),gray:Z("hcg",2,b(100)),white:Z("hwb",1,b(100)),wblack:Z("hwb",2,b(100)),cyan:Z("cmyk",0,b(100)),magenta:Z("cmyk",1,b(100)),yellow:Z("cmyk",2,b(100)),black:Z("cmyk",3,b(100)),x:Z("xyz",0,b(95.047)),y:Z("xyz",1,b(100)),z:Z("xyz",2,b(108.833)),l:Z("lab",0,b(100)),a:Z("lab",1),b:Z("lab",2),keyword(t){return void 0!==t?new e(t):B[this.model].keyword(this.color)},hex(t){return void 0!==t?new e(t):o.to.hex(this.rgb().round().color)},hexa(t){if(void 0!==t)return new e(t);const q=this.rgb().round().color;let S=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===S.length&&(S="0"+S),o.to.hex(q)+S},rgbNumber(){const t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity(){const t=this.rgb().color,q=[];for(const[S,o]of t.entries()){const t=o/255;q[S]=t<=.04045?t/12.92:((t+.055)/1.055)**2.4}return.2126*q[0]+.7152*q[1]+.0722*q[2]},contrast(t){const q=this.luminosity(),S=t.luminosity();return q>S?(q+.05)/(S+.05):(S+.05)/(q+.05)},level(t){const q=this.contrast(t);return q>=7?"AAA":q>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(2126*t[0]+7152*t[1]+722*t[2])/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let q=0;q<3;q++)t.color[q]=255-t.color[q];return t},lighten(t){const q=this.hsl();return q.color[2]+=q.color[2]*t,q},darken(t){const q=this.hsl();return q.color[2]-=q.color[2]*t,q},saturate(t){const q=this.hsl();return q.color[1]+=q.color[1]*t,q},desaturate(t){const q=this.hsl();return q.color[1]-=q.color[1]*t,q},whiten(t){const q=this.hwb();return q.color[1]+=q.color[1]*t,q},blacken(t){const q=this.hwb();return q.color[2]+=q.color[2]*t,q},grayscale(){const t=this.rgb().color,q=.3*t[0]+.59*t[1]+.11*t[2];return e.rgb(q,q,q)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const q=this.hsl();let S=q.color[0];return S=(S+t)%360,S=S<0?360+S:S,q.color[0]=S,q},mix(t,q){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const S=t.rgb(),o=this.rgb(),B=void 0===q?.5:q,z=2*B-1,L=S.alpha()-o.alpha(),r=((z*L===-1?z:(z+L)/(1+z*L))+1)/2,C=1-r;return e.rgb(r*S.red()+C*o.red(),r*S.green()+C*o.green(),r*S.blue()+C*o.blue(),S.alpha()*B+o.alpha()*(1-B))}};for(const i of Object.keys(B)){if(z.includes(i))continue;const{channels:t}=B[i];e.prototype[i]=function(){if(this.model===i)return new e(this);for(var t=arguments.length,q=new Array(t),S=0;S<t;S++)q[S]=arguments[S];return q.length>0?new e(q,i):new e([...(o=B[this.model][i].raw(this.color),Array.isArray(o)?o:[o]),this.valpha],i);var o},e[i]=function(){for(var q=arguments.length,S=new Array(q),o=0;o<q;o++)S[o]=arguments[o];let B=S[0];return"number"===typeof B&&(B=O(S,t)),new e(B,i)}}function C(t){return function(q){return function(t,q){return Number(t.toFixed(q))}(q,t)}}function Z(t,q,S){t=Array.isArray(t)?t:[t];for(const o of t)(r[o]||(r[o]=[]))[q]=S;return t=t[0],function(o){let B;return void 0!==o?(S&&(o=S(o)),B=this[t](),B.color[q]=o,B):(B=this[t]().color[q],S&&(B=S(B)),B)}}function b(t){return function(q){return Math.max(0,Math.min(t,q))}}function O(t,q){for(let S=0;S<q;S++)"number"!==typeof t[S]&&(t[S]=0);return t}t.exports=e},13178:(t,q,S)=>{const o=S(13185),B={};for(const L of Object.keys(o))B[o[L]]=L;const z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};t.exports=z;for(const L of Object.keys(z)){if(!("channels"in z[L]))throw new Error("missing channels property: "+L);if(!("labels"in z[L]))throw new Error("missing channel labels property: "+L);if(z[L].labels.length!==z[L].channels)throw new Error("channel and label counts mismatch: "+L);const{channels:t,labels:q}=z[L];delete z[L].channels,delete z[L].labels,Object.defineProperty(z[L],"channels",{value:t}),Object.defineProperty(z[L],"labels",{value:q})}z.rgb.hsl=function(t){const q=t[0]/255,S=t[1]/255,o=t[2]/255,B=Math.min(q,S,o),z=Math.max(q,S,o),L=z-B;let r,e;z===B?r=0:q===z?r=(S-o)/L:S===z?r=2+(o-q)/L:o===z&&(r=4+(q-S)/L),r=Math.min(60*r,360),r<0&&(r+=360);const C=(B+z)/2;return e=z===B?0:C<=.5?L/(z+B):L/(2-z-B),[r,100*e,100*C]},z.rgb.hsv=function(t){let q,S,o,B,z;const L=t[0]/255,r=t[1]/255,e=t[2]/255,C=Math.max(L,r,e),Z=C-Math.min(L,r,e),b=function(t){return(C-t)/6/Z+.5};return 0===Z?(B=0,z=0):(z=Z/C,q=b(L),S=b(r),o=b(e),L===C?B=o-S:r===C?B=1/3+q-o:e===C&&(B=2/3+S-q),B<0?B+=1:B>1&&(B-=1)),[360*B,100*z,100*C]},z.rgb.hwb=function(t){const q=t[0],S=t[1];let o=t[2];const B=z.rgb.hsl(t)[0],L=1/255*Math.min(q,Math.min(S,o));return o=1-1/255*Math.max(q,Math.max(S,o)),[B,100*L,100*o]},z.rgb.cmyk=function(t){const q=t[0]/255,S=t[1]/255,o=t[2]/255,B=Math.min(1-q,1-S,1-o);return[100*((1-q-B)/(1-B)||0),100*((1-S-B)/(1-B)||0),100*((1-o-B)/(1-B)||0),100*B]},z.rgb.keyword=function(t){const q=B[t];if(q)return q;let S,z=1/0;for(const B of Object.keys(o)){const q=o[B],e=(r=q,((L=t)[0]-r[0])**2+(L[1]-r[1])**2+(L[2]-r[2])**2);e<z&&(z=e,S=B)}var L,r;return S},z.keyword.rgb=function(t){return o[t]},z.rgb.xyz=function(t){let q=t[0]/255,S=t[1]/255,o=t[2]/255;q=q>.04045?((q+.055)/1.055)**2.4:q/12.92,S=S>.04045?((S+.055)/1.055)**2.4:S/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92;return[100*(.4124*q+.3576*S+.1805*o),100*(.2126*q+.7152*S+.0722*o),100*(.0193*q+.1192*S+.9505*o)]},z.rgb.lab=function(t){const q=z.rgb.xyz(t);let S=q[0],o=q[1],B=q[2];S/=95.047,o/=100,B/=108.883,S=S>.008856?S**(1/3):7.787*S+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*o-16,500*(S-o),200*(o-B)]},z.hsl.rgb=function(t){const q=t[0]/360,S=t[1]/100,o=t[2]/100;let B,z,L;if(0===S)return L=255*o,[L,L,L];B=o<.5?o*(1+S):o+S-o*S;const r=2*o-B,e=[0,0,0];for(let C=0;C<3;C++)z=q+1/3*-(C-1),z<0&&z++,z>1&&z--,L=6*z<1?r+6*(B-r)*z:2*z<1?B:3*z<2?r+(B-r)*(2/3-z)*6:r,e[C]=255*L;return e},z.hsl.hsv=function(t){const q=t[0];let S=t[1]/100,o=t[2]/100,B=S;const z=Math.max(o,.01);o*=2,S*=o<=1?o:2-o,B*=z<=1?z:2-z;return[q,100*(0===o?2*B/(z+B):2*S/(o+S)),100*((o+S)/2)]},z.hsv.rgb=function(t){const q=t[0]/60,S=t[1]/100;let o=t[2]/100;const B=Math.floor(q)%6,z=q-Math.floor(q),L=255*o*(1-S),r=255*o*(1-S*z),e=255*o*(1-S*(1-z));switch(o*=255,B){case 0:return[o,e,L];case 1:return[r,o,L];case 2:return[L,o,e];case 3:return[L,r,o];case 4:return[e,L,o];case 5:return[o,L,r]}},z.hsv.hsl=function(t){const q=t[0],S=t[1]/100,o=t[2]/100,B=Math.max(o,.01);let z,L;L=(2-S)*o;const r=(2-S)*B;return z=S*B,z/=r<=1?r:2-r,z=z||0,L/=2,[q,100*z,100*L]},z.hwb.rgb=function(t){const q=t[0]/360;let S=t[1]/100,o=t[2]/100;const B=S+o;let z;B>1&&(S/=B,o/=B);const L=Math.floor(6*q),r=1-o;z=6*q-L,0!==(1&L)&&(z=1-z);const e=S+z*(r-S);let C,Z,b;switch(L){default:case 6:case 0:C=r,Z=e,b=S;break;case 1:C=e,Z=r,b=S;break;case 2:C=S,Z=r,b=e;break;case 3:C=S,Z=e,b=r;break;case 4:C=e,Z=S,b=r;break;case 5:C=r,Z=S,b=e}return[255*C,255*Z,255*b]},z.cmyk.rgb=function(t){const q=t[0]/100,S=t[1]/100,o=t[2]/100,B=t[3]/100;return[255*(1-Math.min(1,q*(1-B)+B)),255*(1-Math.min(1,S*(1-B)+B)),255*(1-Math.min(1,o*(1-B)+B))]},z.xyz.rgb=function(t){const q=t[0]/100,S=t[1]/100,o=t[2]/100;let B,z,L;return B=3.2406*q+-1.5372*S+-.4986*o,z=-.9689*q+1.8758*S+.0415*o,L=.0557*q+-.204*S+1.057*o,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,B=Math.min(Math.max(0,B),1),z=Math.min(Math.max(0,z),1),L=Math.min(Math.max(0,L),1),[255*B,255*z,255*L]},z.xyz.lab=function(t){let q=t[0],S=t[1],o=t[2];q/=95.047,S/=100,o/=108.883,q=q>.008856?q**(1/3):7.787*q+16/116,S=S>.008856?S**(1/3):7.787*S+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*S-16,500*(q-S),200*(S-o)]},z.lab.xyz=function(t){let q,S,o;S=(t[0]+16)/116,q=t[1]/500+S,o=S-t[2]/200;const B=S**3,z=q**3,L=o**3;return S=B>.008856?B:(S-16/116)/7.787,q=z>.008856?z:(q-16/116)/7.787,o=L>.008856?L:(o-16/116)/7.787,q*=95.047,S*=100,o*=108.883,[q,S,o]},z.lab.lch=function(t){const q=t[0],S=t[1],o=t[2];let B;B=360*Math.atan2(o,S)/2/Math.PI,B<0&&(B+=360);return[q,Math.sqrt(S*S+o*o),B]},z.lch.lab=function(t){const q=t[0],S=t[1],o=t[2]/360*2*Math.PI;return[q,S*Math.cos(o),S*Math.sin(o)]},z.rgb.ansi16=function(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[S,o,B]=t;let L=null===q?z.rgb.hsv(t)[2]:q;if(L=Math.round(L/50),0===L)return 30;let r=30+(Math.round(B/255)<<2|Math.round(o/255)<<1|Math.round(S/255));return 2===L&&(r+=60),r},z.hsv.ansi16=function(t){return z.rgb.ansi16(z.hsv.rgb(t),t[2])},z.rgb.ansi256=function(t){const q=t[0],S=t[1],o=t[2];if(q===S&&S===o)return q<8?16:q>248?231:Math.round((q-8)/247*24)+232;return 16+36*Math.round(q/255*5)+6*Math.round(S/255*5)+Math.round(o/255*5)},z.ansi16.rgb=function(t){let q=t%10;if(0===q||7===q)return t>50&&(q+=3.5),q=q/10.5*255,[q,q,q];const S=.5*(1+~~(t>50));return[(1&q)*S*255,(q>>1&1)*S*255,(q>>2&1)*S*255]},z.ansi256.rgb=function(t){if(t>=232){const q=10*(t-232)+8;return[q,q,q]}let q;t-=16;return[Math.floor(t/36)/5*255,Math.floor((q=t%36)/6)/5*255,q%6/5*255]},z.rgb.hex=function(t){const q=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(q.length)+q},z.hex.rgb=function(t){const q=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!q)return[0,0,0];let S=q[0];3===q[0].length&&(S=S.split("").map((t=>t+t)).join(""));const o=parseInt(S,16);return[o>>16&255,o>>8&255,255&o]},z.rgb.hcg=function(t){const q=t[0]/255,S=t[1]/255,o=t[2]/255,B=Math.max(Math.max(q,S),o),z=Math.min(Math.min(q,S),o),L=B-z;let r,e;return r=L<1?z/(1-L):0,e=L<=0?0:B===q?(S-o)/L%6:B===S?2+(o-q)/L:4+(q-S)/L,e/=6,e%=1,[360*e,100*L,100*r]},z.hsl.hcg=function(t){const q=t[1]/100,S=t[2]/100,o=S<.5?2*q*S:2*q*(1-S);let B=0;return o<1&&(B=(S-.5*o)/(1-o)),[t[0],100*o,100*B]},z.hsv.hcg=function(t){const q=t[1]/100,S=t[2]/100,o=q*S;let B=0;return o<1&&(B=(S-o)/(1-o)),[t[0],100*o,100*B]},z.hcg.rgb=function(t){const q=t[0]/360,S=t[1]/100,o=t[2]/100;if(0===S)return[255*o,255*o,255*o];const B=[0,0,0],z=q%1*6,L=z%1,r=1-L;let e=0;switch(Math.floor(z)){case 0:B[0]=1,B[1]=L,B[2]=0;break;case 1:B[0]=r,B[1]=1,B[2]=0;break;case 2:B[0]=0,B[1]=1,B[2]=L;break;case 3:B[0]=0,B[1]=r,B[2]=1;break;case 4:B[0]=L,B[1]=0,B[2]=1;break;default:B[0]=1,B[1]=0,B[2]=r}return e=(1-S)*o,[255*(S*B[0]+e),255*(S*B[1]+e),255*(S*B[2]+e)]},z.hcg.hsv=function(t){const q=t[1]/100,S=q+t[2]/100*(1-q);let o=0;return S>0&&(o=q/S),[t[0],100*o,100*S]},z.hcg.hsl=function(t){const q=t[1]/100,S=t[2]/100*(1-q)+.5*q;let o=0;return S>0&&S<.5?o=q/(2*S):S>=.5&&S<1&&(o=q/(2*(1-S))),[t[0],100*o,100*S]},z.hcg.hwb=function(t){const q=t[1]/100,S=q+t[2]/100*(1-q);return[t[0],100*(S-q),100*(1-S)]},z.hwb.hcg=function(t){const q=t[1]/100,S=1-t[2]/100,o=S-q;let B=0;return o<1&&(B=(S-o)/(1-o)),[t[0],100*o,100*B]},z.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},z.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},z.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},z.gray.hsl=function(t){return[0,0,t[0]]},z.gray.hsv=z.gray.hsl,z.gray.hwb=function(t){return[0,100,t[0]]},z.gray.cmyk=function(t){return[0,0,0,t[0]]},z.gray.lab=function(t){return[t[0],0,0]},z.gray.hex=function(t){const q=255&Math.round(t[0]/100*255),S=((q<<16)+(q<<8)+q).toString(16).toUpperCase();return"000000".substring(S.length)+S},z.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},13171:(t,q,S)=>{const o=S(13178),B=S(13193),z={};Object.keys(o).forEach((t=>{z[t]={},Object.defineProperty(z[t],"channels",{value:o[t].channels}),Object.defineProperty(z[t],"labels",{value:o[t].labels});const q=B(t);Object.keys(q).forEach((S=>{const o=q[S];z[t][S]=function(t){const q=function(){for(var q=arguments.length,S=new Array(q),o=0;o<q;o++)S[o]=arguments[o];const B=S[0];if(void 0===B||null===B)return B;B.length>1&&(S=B);const z=t(S);if("object"===typeof z)for(let t=z.length,L=0;L<t;L++)z[L]=Math.round(z[L]);return z};return"conversion"in t&&(q.conversion=t.conversion),q}(o),z[t][S].raw=function(t){const q=function(){for(var q=arguments.length,S=new Array(q),o=0;o<q;o++)S[o]=arguments[o];const B=S[0];return void 0===B||null===B?B:(B.length>1&&(S=B),t(S))};return"conversion"in t&&(q.conversion=t.conversion),q}(o)}))})),t.exports=z},13193:(t,q,S)=>{const o=S(13178);function B(t){const q=function(){const t={},q=Object.keys(o);for(let S=q.length,o=0;o<S;o++)t[q[o]]={distance:-1,parent:null};return t}(),S=[t];for(q[t].distance=0;S.length;){const t=S.pop(),B=Object.keys(o[t]);for(let o=B.length,z=0;z<o;z++){const o=B[z],L=q[o];-1===L.distance&&(L.distance=q[t].distance+1,L.parent=t,S.unshift(o))}}return q}function z(t,q){return function(S){return q(t(S))}}function L(t,q){const S=[q[t].parent,t];let B=o[q[t].parent][t],L=q[t].parent;for(;q[L].parent;)S.unshift(q[L].parent),B=z(o[q[L].parent][L],B),L=q[L].parent;return B.conversion=S,B}t.exports=function(t){const q=B(t),S={},o=Object.keys(q);for(let B=o.length,z=0;z<B;z++){const t=o[z];null!==q[t].parent&&(S[t]=L(t,q))}return S}},13185:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12187:function(t,q,S){"use strict";var o=this&&this.__createBinding||(Object.create?function(t,q,S,o){void 0===o&&(o=S);var B=Object.getOwnPropertyDescriptor(q,S);B&&!("get"in B?!q.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return q[S]}}),Object.defineProperty(t,o,B)}:function(t,q,S,o){void 0===o&&(o=S),t[o]=q[S]}),B=this&&this.__setModuleDefault||(Object.create?function(t,q){Object.defineProperty(t,"default",{enumerable:!0,value:q})}:function(t,q){t.default=q}),z=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var q={};if(null!=t)for(var S in t)"default"!==S&&Object.prototype.hasOwnProperty.call(t,S)&&o(q,t,S);return B(q,t),q},L=this&&this.__awaiter||function(t,q,S,o){return new(S||(S=Promise))((function(B,z){function L(t){try{e(o.next(t))}catch(q){z(q)}}function r(t){try{e(o.throw(t))}catch(q){z(q)}}function e(t){var q;t.done?B(t.value):(q=t.value,q instanceof S?q:new S((function(t){t(q)}))).then(L,r)}e((o=o.apply(t,q||[])).next())}))};Object.defineProperty(q,"__esModule",{value:!0}),q.Auth=q.Platform=void 0;const r=z(S(12122)),e=S(12193),C="colyseus-auth-token";!function(t){t.ios="ios",t.android="android"}(q.Platform||(q.Platform={}));q.Auth=class{constructor(t){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=t.replace("ws","http"),(0,e.getItem)(C,(t=>this.token=t))}get hasToken(){return!!this.token}login(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return L(this,void 0,void 0,(function*(){const q=Object.assign({},t);this.hasToken&&(q.token=this.token);const S=yield this.request("post","/auth",q);this.token=S.token,(0,e.setItem)(C,this.token);for(let t in S)this.hasOwnProperty(t)&&(this[t]=S[t]);return this.registerPingService(),this}))}save(){return L(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(t){return L(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:t})}))}acceptFriendRequest(t){return L(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:t})}))}declineFriendRequest(t){return L(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:t})}))}blockUser(t){return L(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:t})}))}unblockUser(t){return L(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:t})}))}request(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return L(this,void 0,void 0,(function*(){B.Accept="application/json",this.hasToken&&(B.Authorization="Bearer "+this.token);const z=[];for(const t in S)z.push(`${t}=${S[t]}`);const L=z.length>0?`?${z.join("&")}`:"",e={headers:B};return o&&(e.body=o),(yield r[t](`${this.endpoint}${q}${L}`,e)).data}))}logout(){this.token=void 0,(0,e.removeItem)(C),this.unregisterPingService()}registerPingService(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),t)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},12116:function(t,q,S){"use strict";var o,B=this&&this.__awaiter||function(t,q,S,o){return new(S||(S=Promise))((function(B,z){function L(t){try{e(o.next(t))}catch(q){z(q)}}function r(t){try{e(o.throw(t))}catch(q){z(q)}}function e(t){var q;t.done?B(t.value):(q=t.value,q instanceof S?q:new S((function(t){t(q)}))).then(L,r)}e((o=o.apply(t,q||[])).next())}))};Object.defineProperty(q,"__esModule",{value:!0}),q.Client=q.MatchMakeError=void 0;const z=S(12122),L=S(12131),r=S(12139);class e extends Error{constructor(t,q){super(t),this.code=q,Object.setPrototypeOf(this,e.prototype)}}q.MatchMakeError=e;const C="undefined"!==typeof window&&"undefined"!==typeof(null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";q.Client=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;if("string"===typeof t){const q=new URL(t),S="https:"===q.protocol||"wss:"===q.protocol,o=Number(q.port||(S?443:80));this.settings={hostname:q.hostname,pathname:"/"!==q.pathname?q.pathname:"",port:o,secure:S}}else void 0===t.port&&(t.port=t.secure?443:80),void 0===t.pathname&&(t.pathname=""),this.settings=t}joinOrCreate(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",t,q,S)}))}create(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",t,q,S)}))}join(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",t,q,S)}))}joinById(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",t,q,S)}))}reconnect(t,q){return B(this,void 0,void 0,(function*(){if("string"===typeof t&&"string"===typeof q)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[S,o]=t.split(":");return yield this.createMatchMakeRequest("reconnect",S,{reconnectionToken:o},q)}))}getAvailableRooms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return B(this,void 0,void 0,(function*(){return(yield(0,z.get)(this.getHttpEndpoint(`${t}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(t,q,S){return B(this,void 0,void 0,(function*(){const o=this.createRoom(t.room.name,q);o.roomId=t.room.roomId,o.sessionId=t.sessionId;const z={sessionId:o.sessionId};t.reconnectionToken&&(z.reconnectionToken=t.reconnectionToken);const r=S||o;return o.connect(this.buildEndpoint(t.room,z),t.devMode&&(()=>B(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${o.roomId}'...`);let S=0;const z=()=>B(this,void 0,void 0,(function*(){S++;try{yield this.consumeSeatReservation(t,q,r),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${o.roomId}'`)}catch(B){S<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${S} out of 8)`),setTimeout(z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(z,2e3)}))),r),new Promise(((t,q)=>{const S=(t,S)=>q(new L.ServerError(t,S));r.onError.once(S),r.onJoin.once((()=>{r.onError.remove(S),t(r)}))}))}))}createMatchMakeRequest(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;return B(this,void 0,void 0,(function*(){const B=(yield(0,z.post)(this.getHttpEndpoint(`${t}/${q}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(S)})).data;if(B.error)throw new e(B.error,B.code);return"reconnect"===t&&(B.reconnectionToken=S.reconnectionToken),yield this.consumeSeatReservation(B,o,L)}))}createRoom(t,q){return new r.Room(t,q)}buildEndpoint(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const S=[];for(const B in q)q.hasOwnProperty(B)&&S.push(`${B}=${q[B]}`);let o=this.settings.secure?"wss://":"ws://";return t.publicAddress?o+=`${t.publicAddress}`:o+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${o}/${t.processId}/${t.roomId}?${S.join("&")}`}getHttpEndpoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${t}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12152:(t,q,S)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.Connection=void 0;const o=S(12157);q.Connection=class{constructor(){this.events={},this.transport=new o.WebSocketTransport(this.events)}send(t){this.transport.send(t)}connect(t){this.transport.connect(t)}close(t,q){this.transport.close(t,q)}get isOpen(){return this.transport.isOpen}}},12166:(t,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.utf8Length=q.utf8Read=q.ErrorCode=q.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(q.Protocol||(q.Protocol={})),function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(q.ErrorCode||(q.ErrorCode={})),q.utf8Read=function(t,q){const S=t[q++];for(var o="",B=0,z=q,L=q+S;z<L;z++){var r=t[z];if(0!==(128&r))if(192!==(224&r))if(224!==(240&r)){if(240!==(248&r))throw new Error("Invalid byte "+r.toString(16));(B=(7&r)<<18|(63&t[++z])<<12|(63&t[++z])<<6|63&t[++z])>=65536?(B-=65536,o+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):o+=String.fromCharCode(B)}else o+=String.fromCharCode((15&r)<<12|(63&t[++z])<<6|63&t[++z]);else o+=String.fromCharCode((31&r)<<6|63&t[++z]);else o+=String.fromCharCode(r)}return o},q.utf8Length=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",q=0,S=0;for(let o=0,B=t.length;o<B;o++)q=t.charCodeAt(o),q<128?S+=1:q<2048?S+=2:q<55296||q>=57344?S+=3:(o++,S+=4);return S+1}},12139:function(t,q,S){"use strict";var o=this&&this.__createBinding||(Object.create?function(t,q,S,o){void 0===o&&(o=S);var B=Object.getOwnPropertyDescriptor(q,S);B&&!("get"in B?!q.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return q[S]}}),Object.defineProperty(t,o,B)}:function(t,q,S,o){void 0===o&&(o=S),t[o]=q[S]}),B=this&&this.__setModuleDefault||(Object.create?function(t,q){Object.defineProperty(t,"default",{enumerable:!0,value:q})}:function(t,q){t.default=q}),z=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var q={};if(null!=t)for(var S in t)"default"!==S&&Object.prototype.hasOwnProperty.call(t,S)&&o(q,t,S);return B(q,t),q};Object.defineProperty(q,"__esModule",{value:!0}),q.Room=void 0;const L=z(S(12147)),r=S(12152),e=S(12166),C=S(12169),Z=S(12173),b=S(12177),O=S(12181),i=S(12131);class h{constructor(t,q){this.onStateChange=(0,b.createSignal)(),this.onError=(0,b.createSignal)(),this.onLeave=(0,b.createSignal)(),this.onJoin=(0,b.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,Z.createNanoEvents)(),this.roomId=null,this.name=t,q&&(this.serializer=new((0,C.getSerializer)("schema")),this.rootSchema=q,this.serializer.state=new q),this.onError(((t,q)=>{var S;return null===(S=console.warn)||void 0===S?void 0:S.call(console,`colyseus.js - onError => (${t}) ${q}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const o=new r.Connection;S.connection=o,o.events.onmessage=h.prototype.onMessageCallback.bind(S),o.events.onclose=function(t){var o;if(!S.hasJoined)return null===(o=console.warn)||void 0===o||o.call(console,`Room connection was closed unexpectedly (${t.code}): ${t.reason}`),void S.onError.invoke(t.code,t.reason);t.code===i.CloseCode.DEVMODE_RESTART&&q?q():(S.onLeave.invoke(t.code),S.destroy())},o.events.onerror=function(t){var q;null===(q=console.warn)||void 0===q||q.call(console,`Room, onError (${t.code}): ${t.reason}`),S.onError.invoke(t.code,t.reason)},o.connect(t)}leave(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((q=>{this.onLeave((t=>q(t))),this.connection?t?this.connection.send([e.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(i.CloseCode.CONSENTED)}))}onMessage(t,q){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),q)}send(t,q){const S=[e.Protocol.ROOM_DATA];let o;if("string"===typeof t?O.encode.string(S,t):O.encode.number(S,t),void 0!==q){const t=L.encode(q);o=new Uint8Array(S.length+t.byteLength),o.set(new Uint8Array(S),0),o.set(new Uint8Array(t),S.length)}else o=new Uint8Array(S);this.connection.send(o.buffer)}sendBytes(t,q){const S=[e.Protocol.ROOM_DATA_BYTES];let o;"string"===typeof t?O.encode.string(S,t):O.encode.number(S,t),o=new Uint8Array(S.length+(q.byteLength||q.length)),o.set(new Uint8Array(S),0),o.set(new Uint8Array(q),S.length),this.connection.send(o.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(t){const q=Array.from(new Uint8Array(t.data)),S=q[0];if(S===e.Protocol.JOIN_ROOM){let t=1;const S=(0,e.utf8Read)(q,t);if(t+=(0,e.utf8Length)(S),this.serializerId=(0,e.utf8Read)(q,t),t+=(0,e.utf8Length)(this.serializerId),!this.serializer){const t=(0,C.getSerializer)(this.serializerId);this.serializer=new t}q.length>t&&this.serializer.handshake&&this.serializer.handshake(q,{offset:t}),this.reconnectionToken=`${this.roomId}:${S}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(S===e.Protocol.ERROR){const t={offset:1},S=O.decode.number(q,t),o=O.decode.string(q,t);this.onError.invoke(S,o)}else if(S===e.Protocol.LEAVE_ROOM)this.leave();else if(S===e.Protocol.ROOM_DATA_SCHEMA){const t={offset:1},S=this.serializer.getState().constructor._context.get(O.decode.number(q,t)),o=new S;o.decode(q,t),this.dispatchMessage(S,o)}else if(S===e.Protocol.ROOM_STATE)q.shift(),this.setState(q);else if(S===e.Protocol.ROOM_STATE_PATCH)q.shift(),this.patch(q);else if(S===e.Protocol.ROOM_DATA){const S={offset:1},o=O.decode.stringCheck(q,S)?O.decode.string(q,S):O.decode.number(q,S),B=q.length>S.offset?L.decode(t.data,S.offset):void 0;this.dispatchMessage(o,B)}else if(S===e.Protocol.ROOM_DATA_BYTES){const t={offset:1},S=O.decode.stringCheck(q,t)?O.decode.string(q,t):O.decode.number(q,t);this.dispatchMessage(S,new Uint8Array(q.slice(t.offset)))}}setState(t){this.serializer.setState(t),this.onStateChange.invoke(this.serializer.getState())}patch(t){this.serializer.patch(t),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(t,q){var S;const o=this.getMessageHandlerKey(t);this.onMessageHandlers.events[o]?this.onMessageHandlers.emit(o,q):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,q):null===(S=console.warn)||void 0===S||S.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"function":return`$${t._typeid}`;case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}}q.Room=h},12193:(t,q)=>{"use strict";let S;function o(){return S||(S="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(t,q){this.cache[t]=q},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),S}Object.defineProperty(q,"__esModule",{value:!0}),q.getItem=q.removeItem=q.setItem=void 0,q.setItem=function(t,q){o().setItem(t,q)},q.removeItem=function(t){o().removeItem(t)},q.getItem=function(t,q){const S=o().getItem(t);"undefined"!==typeof Promise&&S instanceof Promise?S.then((t=>q(t))):q(S)}},12173:(t,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createNanoEvents=void 0;q.createNanoEvents=()=>({emit(t){let q=this.events[t]||[];for(var S=arguments.length,o=new Array(S>1?S-1:0),B=1;B<S;B++)o[B-1]=arguments[B];for(let z=0,L=q.length;z<L;z++)q[z](...o)},events:{},on(t,q){var S;return(null===(S=this.events[t])||void 0===S?void 0:S.push(q))||(this.events[t]=[q]),()=>{var S;this.events[t]=null===(S=this.events[t])||void 0===S?void 0:S.filter((t=>q!==t))}}})},12177:(t,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.createSignal=q.EventEmitter=void 0;class S{constructor(){this.handlers=[]}register(t){return this.handlers.push(t),this}invoke(){for(var t=arguments.length,q=new Array(t),S=0;S<t;S++)q[S]=arguments[S];this.handlers.forEach((t=>t.apply(this,q)))}invokeAsync(){for(var t=arguments.length,q=new Array(t),S=0;S<t;S++)q[S]=arguments[S];return Promise.all(this.handlers.map((t=>t.apply(this,q))))}remove(t){const q=this.handlers.indexOf(t);this.handlers[q]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}q.EventEmitter=S,q.createSignal=function(){const t=new S;function q(q){return t.register(q,null===this)}return q.once=q=>{const S=function(){for(var o=arguments.length,B=new Array(o),z=0;z<o;z++)B[z]=arguments[z];q.apply(this,B),t.remove(S)};t.register(S)},q.remove=q=>t.remove(q),q.invoke=function(){return t.invoke(...arguments)},q.invokeAsync=function(){return t.invokeAsync(...arguments)},q.clear=()=>t.clear(),q}},12131:(t,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.ServerError=q.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(q.CloseCode||(q.CloseCode={}));class S extends Error{constructor(t,q){super(q),this.name="ServerError",this.code=t}}q.ServerError=S},12103:(t,q,S)=>{"use strict";q.e=void 0,S(12111);var o=S(12116);Object.defineProperty(q,"e",{enumerable:!0,get:function(){return o.Client}});var B=S(12166);var z=S(12139);var L=S(12187);const r=S(12195);const e=S(12203),C=S(12169);(0,C.registerSerializer)("schema",r.SchemaSerializer),(0,C.registerSerializer)("none",e.NoneSerializer)},12111:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=t=>null!==t&&"object"===typeof t&&t.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12147:(t,q)=>{"use strict";function S(t,q){if(this._offset=q,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}Object.defineProperty(q,"__esModule",{value:!0}),q.decode=q.encode=void 0,S.prototype._array=function(t){for(var q=new Array(t),S=0;S<t;S++)q[S]=this._parse();return q},S.prototype._map=function(t){for(var q={},S=0;S<t;S++)q[this._parse()]=this._parse();return q},S.prototype._str=function(t){var q=function(t,q,S){for(var o="",B=0,z=q,L=q+S;z<L;z++){var r=t.getUint8(z);if(0!==(128&r))if(192!==(224&r))if(224!==(240&r)){if(240!==(248&r))throw new Error("Invalid byte "+r.toString(16));(B=(7&r)<<18|(63&t.getUint8(++z))<<12|(63&t.getUint8(++z))<<6|63&t.getUint8(++z))>=65536?(B-=65536,o+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):o+=String.fromCharCode(B)}else o+=String.fromCharCode((15&r)<<12|(63&t.getUint8(++z))<<6|63&t.getUint8(++z));else o+=String.fromCharCode((31&r)<<6|63&t.getUint8(++z));else o+=String.fromCharCode(r)}return o}(this._view,this._offset,t);return this._offset+=t,q},S.prototype._bin=function(t){var q=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,q},S.prototype._parse=function(){var t,q=this._view.getUint8(this._offset++),S=0,o=0,B=0,z=0;if(q<192)return q<128?q:q<144?this._map(15&q):q<160?this._array(15&q):this._str(31&q);if(q>223)return-1*(255-q+1);switch(q){case 192:return null;case 194:return!1;case 195:return!0;case 196:return S=this._view.getUint8(this._offset),this._offset+=1,this._bin(S);case 197:return S=this._view.getUint16(this._offset),this._offset+=2,this._bin(S);case 198:return S=this._view.getUint32(this._offset),this._offset+=4,this._bin(S);case 199:if(S=this._view.getUint8(this._offset),o=this._view.getInt8(this._offset+1),this._offset+=2,-1===o){var L=this._view.getUint32(this._offset);return B=this._view.getInt32(this._offset+4),z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*B+z)+L/1e6)}return[o,this._bin(S)];case 200:return S=this._view.getUint16(this._offset),o=this._view.getInt8(this._offset+2),this._offset+=3,[o,this._bin(S)];case 201:return S=this._view.getUint32(this._offset),o=this._view.getInt8(this._offset+4),this._offset+=5,[o,this._bin(S)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return B=this._view.getUint32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,B+z;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return B=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,B+z;case 212:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?void(this._offset+=1):[o,this._bin(1)];case 213:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(2)];case 214:return o=this._view.getInt8(this._offset),this._offset+=1,-1===o?(t=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*t)):[o,this._bin(4)];case 215:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?(B=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(B+z)):-1===o?(B=this._view.getUint32(this._offset),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&B)+z)+(B>>>2)/1e6)):[o,this._bin(8)];case 216:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(16)];case 217:return S=this._view.getUint8(this._offset),this._offset+=1,this._str(S);case 218:return S=this._view.getUint16(this._offset),this._offset+=2,this._str(S);case 219:return S=this._view.getUint32(this._offset),this._offset+=4,this._str(S);case 220:return S=this._view.getUint16(this._offset),this._offset+=2,this._array(S);case 221:return S=this._view.getUint32(this._offset),this._offset+=4,this._array(S);case 222:return S=this._view.getUint16(this._offset),this._offset+=2,this._map(S);case 223:return S=this._view.getUint32(this._offset),this._offset+=4,this._map(S)}throw new Error("Could not parse")},q.decode=function(t){var q=new S(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),o=q._parse();if(q._offset!==t.byteLength)throw new Error(t.byteLength-q._offset+" trailing bytes");return o};function o(t,q,S){for(var o=0,B=0,z=S.length;B<z;B++)(o=S.charCodeAt(B))<128?t.setUint8(q++,o):o<2048?(t.setUint8(q++,192|o>>6),t.setUint8(q++,128|63&o)):o<55296||o>=57344?(t.setUint8(q++,224|o>>12),t.setUint8(q++,128|o>>6&63),t.setUint8(q++,128|63&o)):(B++,o=65536+((1023&o)<<10|1023&S.charCodeAt(B)),t.setUint8(q++,240|o>>18),t.setUint8(q++,128|o>>12&63),t.setUint8(q++,128|o>>6&63),t.setUint8(q++,128|63&o))}function B(t,q,S){var o=typeof S,z=0,L=0,r=0,e=0,C=0,Z=0;if("string"===o){if(C=function(t){for(var q=0,S=0,o=0,B=t.length;o<B;o++)(q=t.charCodeAt(o))<128?S+=1:q<2048?S+=2:q<55296||q>=57344?S+=3:(o++,S+=4);return S}(S),C<32)t.push(160|C),Z=1;else if(C<256)t.push(217,C),Z=2;else if(C<65536)t.push(218,C>>8,C),Z=3;else{if(!(C<4294967296))throw new Error("String too long");t.push(219,C>>24,C>>16,C>>8,C),Z=5}return q.push({_str:S,_length:C,_offset:t.length}),Z+C}if("number"===o)return Math.floor(S)===S&&isFinite(S)?S>=0?S<128?(t.push(S),1):S<256?(t.push(204,S),2):S<65536?(t.push(205,S>>8,S),3):S<4294967296?(t.push(206,S>>24,S>>16,S>>8,S),5):(r=S/Math.pow(2,32)|0,e=S>>>0,t.push(207,r>>24,r>>16,r>>8,r,e>>24,e>>16,e>>8,e),9):S>=-32?(t.push(S),1):S>=-128?(t.push(208,S),2):S>=-32768?(t.push(209,S>>8,S),3):S>=-2147483648?(t.push(210,S>>24,S>>16,S>>8,S),5):(r=Math.floor(S/Math.pow(2,32)),e=S>>>0,t.push(211,r>>24,r>>16,r>>8,r,e>>24,e>>16,e>>8,e),9):(t.push(203),q.push({_float:S,_length:8,_offset:t.length}),9);if("object"===o){if(null===S)return t.push(192),1;if(Array.isArray(S)){if((C=S.length)<16)t.push(144|C),Z=1;else if(C<65536)t.push(220,C>>8,C),Z=3;else{if(!(C<4294967296))throw new Error("Array too large");t.push(221,C>>24,C>>16,C>>8,C),Z=5}for(z=0;z<C;z++)Z+=B(t,q,S[z]);return Z}if(S instanceof Date){var b=S.getTime(),O=Math.floor(b/1e3),i=1e6*(b-1e3*O);return O>=0&&i>=0&&O<=17179869183?0===i&&O<=4294967295?(t.push(214,255,O>>24,O>>16,O>>8,O),6):(r=O/4294967296,e=4294967295&O,t.push(215,255,i>>22,i>>14,i>>6,r,e>>24,e>>16,e>>8,e),10):(r=Math.floor(O/4294967296),e=O>>>0,t.push(199,12,255,i>>24,i>>16,i>>8,i,r>>24,r>>16,r>>8,r,e>>24,e>>16,e>>8,e),15)}if(S instanceof ArrayBuffer){if((C=S.byteLength)<256)t.push(196,C),Z=2;else if(C<65536)t.push(197,C>>8,C),Z=3;else{if(!(C<4294967296))throw new Error("Buffer too large");t.push(198,C>>24,C>>16,C>>8,C),Z=5}return q.push({_bin:S,_length:C,_offset:t.length}),Z+C}if("function"===typeof S.toJSON)return B(t,q,S.toJSON());var h=[],l="",I=Object.keys(S);for(z=0,L=I.length;z<L;z++)void 0!==S[l=I[z]]&&"function"!==typeof S[l]&&h.push(l);if((C=h.length)<16)t.push(128|C),Z=1;else if(C<65536)t.push(222,C>>8,C),Z=3;else{if(!(C<4294967296))throw new Error("Object too large");t.push(223,C>>24,C>>16,C>>8,C),Z=5}for(z=0;z<C;z++)Z+=B(t,q,l=h[z]),Z+=B(t,q,S[l]);return Z}if("boolean"===o)return t.push(S?195:194),1;if("undefined"===o)return t.push(192),1;if("function"===typeof S.toJSON)return B(t,q,S.toJSON());throw new Error("Could not encode")}q.encode=function(t){var q=[],S=[],z=B(q,S,t),L=new ArrayBuffer(z),r=new DataView(L),e=0,C=0,Z=-1;S.length>0&&(Z=S[0]._offset);for(var b,O=0,i=0,h=0,l=q.length;h<l;h++)if(r.setUint8(C+h,q[h]),h+1===Z){if(O=(b=S[e])._length,i=C+Z,b._bin)for(var I=new Uint8Array(b._bin),a=0;a<O;a++)r.setUint8(i+a,I[a]);else b._str?o(r,i,b._str):void 0!==b._float&&r.setFloat64(i,b._float);C+=O,S[++e]&&(Z=S[e]._offset)}return L}},12203:(t,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.NoneSerializer=void 0;q.NoneSerializer=class{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}},12195:(t,q,S)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.SchemaSerializer=void 0;const o=S(12181);q.SchemaSerializer=class{setState(t){return this.state.decode(t)}getState(){return this.state}patch(t){return this.state.decode(t)}teardown(){var t,q;null===(q=null===(t=this.state)||void 0===t?void 0:t.$changes)||void 0===q||q.root.clearRefs()}handshake(t,q){if(this.state){(new o.Reflection).decode(t,q)}else this.state=o.Reflection.decode(t,q)}}},12169:(t,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.getSerializer=q.registerSerializer=void 0;const S={};q.registerSerializer=function(t,q){S[t]=q},q.getSerializer=function(t){const q=S[t];if(!q)throw new Error("missing serializer: "+t);return q}},12157:function(t,q,S){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(q,"__esModule",{value:!0}),q.WebSocketTransport=void 0;const B=o(S(12160)),z=globalThis.WebSocket||B.default;q.WebSocketTransport=class{constructor(t){this.events=t}send(t){t instanceof ArrayBuffer?this.ws.send(t):Array.isArray(t)&&this.ws.send(new Uint8Array(t).buffer)}connect(t){this.ws=new z(t,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,q){this.ws.close(t,q)}get isOpen(){return this.ws.readyState===z.OPEN}}},12160:t=>{"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12336:t=>{"use strict";t.exports=function(t){for(var q=new Array(t),S=0;S<t;++S)q[S]=S;return q}},12340:t=>{function q(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(q(t)||function(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&q(t.slice(0,0))}(t)||!!t._isBuffer)}},12327:(t,q,S)=>{var o=S(12336),B=S(12340),z="undefined"!==typeof Float64Array;function L(t,q){return t[0]-q[0]}function r(){var t,q=this.stride,S=new Array(q.length);for(t=0;t<S.length;++t)S[t]=[Math.abs(q[t]),t];S.sort(L);var o=new Array(S.length);for(t=0;t<o.length;++t)o[t]=S[t][1];return o}function e(t,q){var S=["View",q,"d",t].join("");q<0&&(S="View_Nil"+t);var B="generic"===t;if(-1===q){var z="function "+S+"(a){this.data=a;};var proto="+S+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+S+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+S+"(a){return new "+S+"(a);}";return new Function(z)()}if(0===q){z="function "+S+"(a,d) {this.data = a;this.offset = d};var proto="+S+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+S+"_copy() {return new "+S+"(this.data,this.offset)};proto.pick=function "+S+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+S+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+S+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+S+"(a,b,c,d){return new "+S+"(a,d)}";return new Function("TrivialArray",z)(C[t][0])}z=["'use strict'"];var L=o(q),e=L.map((function(t){return"i"+t})),Z="this.offset+"+L.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),b=L.map((function(t){return"b"+t})).join(","),O=L.map((function(t){return"c"+t})).join(",");z.push("function "+S+"(a,"+b+","+O+",d){this.data=a","this.shape=["+b+"]","this.stride=["+O+"]","this.offset=d|0}","var proto="+S+".prototype","proto.dtype='"+t+"'","proto.dimension="+q),z.push("Object.defineProperty(proto,'size',{get:function "+S+"_size(){return "+L.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===q?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),q<4?(z.push("function "+S+"_order(){"),2===q?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===q&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+S+"_set("+e.join(",")+",v){"),B?z.push("return this.data.set("+Z+",v)}"):z.push("return this.data["+Z+"]=v}"),z.push("proto.get=function "+S+"_get("+e.join(",")+"){"),B?z.push("return this.data.get("+Z+")}"):z.push("return this.data["+Z+"]}"),z.push("proto.index=function "+S+"_index(",e.join(),"){return "+Z+"}"),z.push("proto.hi=function "+S+"_hi("+e.join(",")+"){return new "+S+"(this.data,"+L.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+L.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var i=L.map((function(t){return"a"+t+"=this.shape["+t+"]"})),h=L.map((function(t){return"c"+t+"=this.stride["+t+"]"}));z.push("proto.lo=function "+S+"_lo("+e.join(",")+"){var b=this.offset,d=0,"+i.join(",")+","+h.join(","));for(var l=0;l<q;++l)z.push("if(typeof i"+l+"==='number'&&i"+l+">=0){d=i"+l+"|0;b+=c"+l+"*d;a"+l+"-=d}");z.push("return new "+S+"(this.data,"+L.map((function(t){return"a"+t})).join(",")+","+L.map((function(t){return"c"+t})).join(",")+",b)}"),z.push("proto.step=function "+S+"_step("+e.join(",")+"){var "+L.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+L.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(l=0;l<q;++l)z.push("if(typeof i"+l+"==='number'){d=i"+l+"|0;if(d<0){c+=b"+l+"*(a"+l+"-1);a"+l+"=ceil(-a"+l+"/d)}else{a"+l+"=ceil(a"+l+"/d)}b"+l+"*=d}");z.push("return new "+S+"(this.data,"+L.map((function(t){return"a"+t})).join(",")+","+L.map((function(t){return"b"+t})).join(",")+",c)}");var I=new Array(q),a=new Array(q);for(l=0;l<q;++l)I[l]="a[i"+l+"]",a[l]="b[i"+l+"]";z.push("proto.transpose=function "+S+"_transpose("+e+"){"+e.map((function(t,q){return t+"=("+t+"===undefined?"+q+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+S+"(this.data,"+I.join(",")+","+a.join(",")+",this.offset)}"),z.push("proto.pick=function "+S+"_pick("+e+"){var a=[],b=[],c=this.offset");for(l=0;l<q;++l)z.push("if(typeof i"+l+"==='number'&&i"+l+">=0){c=(c+this.stride["+l+"]*i"+l+")|0}else{a.push(this.shape["+l+"]);b.push(this.stride["+l+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+S+"(data,shape,stride,offset){return new "+S+"(data,"+L.map((function(t){return"shape["+t+"]"})).join(",")+","+L.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(C[t],r)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,q,S,o){if(void 0===t)return(0,C.array[0])([]);"number"===typeof t&&(t=[t]),void 0===q&&(q=[t.length]);var L=q.length;if(void 0===S){S=new Array(L);for(var r=L-1,Z=1;r>=0;--r)S[r]=Z,Z*=q[r]}if(void 0===o){o=0;for(r=0;r<L;++r)S[r]<0&&(o-=(q[r]-1)*S[r])}for(var b=function(t){if(B(t))return"buffer";if(z)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),O=C[b];O.length<=L+1;)O.push(e(b,O.length-1));return(0,O[L+1])(t,q,S,o)}},13130:t=>{var q;self,q=()=>(()=>{"use strict";var t={d:(q,S)=>{for(var o in S)t.o(S,o)&&!t.o(q,o)&&Object.defineProperty(q,o,{enumerable:!0,get:S[o]})},o:(t,q)=>Object.prototype.hasOwnProperty.call(t,q)},q={};t.d(q,{default:()=>Y});var S,o=function(t,q){var S=q.x-t.x,o=q.y-t.y;return Math.sqrt(S*S+o*o)},B=function(t){return t*(Math.PI/180)},z=new Map,L=function(t){z.has(t)&&clearTimeout(z.get(t)),z.set(t,setTimeout(t,100))},r=function(t,q,S){for(var o,B=q.split(/[ ,]+/g),z=0;z<B.length;z+=1)o=B[z],t.addEventListener?t.addEventListener(o,S,!1):t.attachEvent&&t.attachEvent(o,S)},e=function(t,q,S){for(var o,B=q.split(/[ ,]+/g),z=0;z<B.length;z+=1)o=B[z],t.removeEventListener?t.removeEventListener(o,S):t.detachEvent&&t.detachEvent(o,S)},C=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},Z=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},b=function(t,q){q.top||q.right||q.bottom||q.left?(t.style.top=q.top,t.style.right=q.right,t.style.bottom=q.bottom,t.style.left=q.left):(t.style.left=q.x+"px",t.style.top=q.y+"px")},O=function(t,q,S){var o=i(t);for(var B in o)if(o.hasOwnProperty(B))if("string"==typeof q)o[B]=q+" "+S;else{for(var z="",L=0,r=q.length;L<r;L+=1)z+=q[L]+" "+S+", ";o[B]=z.slice(0,-2)}return o},i=function(t){var q={};return q[t]="",["webkit","Moz","o"].forEach((function(S){q[S+t.charAt(0).toUpperCase()+t.slice(1)]=""})),q},h=function(t,q){for(var S in q)q.hasOwnProperty(S)&&(t[S]=q[S]);return t},l=function(t,q){if(t.length)for(var S=0,o=t.length;S<o;S+=1)q(t[S]);else q(t)},I="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,a=window.matchMedia("(any-hover: none)").matches,v=!!("ontouchstart"in window),M=!!window.PointerEvent,x=!!window.MSPointerEvent,k={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},V={start:"mousedown",move:"mousemove",end:"mouseup"},J={};function U(){}I&&!a?S=k:M?S={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:x?S={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:v?(S=k,J=V):S=V,U.prototype.on=function(t,q){var S,o=this,B=t.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var z=0;z<B.length;z+=1)S=B[z],o._handlers_[S]=o._handlers_[S]||[],o._handlers_[S].push(q);return o},U.prototype.off=function(t,q){var S=this;return S._handlers_=S._handlers_||{},void 0===t?S._handlers_={}:void 0===q?S._handlers_[t]=null:S._handlers_[t]&&S._handlers_[t].indexOf(q)>=0&&S._handlers_[t].splice(S._handlers_[t].indexOf(q),1),S},U.prototype.trigger=function(t,q){var S,o=this,B=t.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var z=0;z<B.length;z+=1)S=B[z],o._handlers_[S]&&o._handlers_[S].length&&o._handlers_[S].forEach((function(t){t.call(o,{type:S,target:o},q)}))},U.prototype.config=function(t){var q=this;q.options=q.defaults||{},t&&(q.options=function(t,q){var S={};for(var o in t)t.hasOwnProperty(o)&&q.hasOwnProperty(o)?S[o]=q[o]:t.hasOwnProperty(o)&&(S[o]=t[o]);return S}(q.options,t))},U.prototype.bindEvt=function(t,q){var o=this;return o._domHandlers_=o._domHandlers_||{},o._domHandlers_[q]=function(){"function"==typeof o["on"+q]?o["on"+q].apply(o,arguments):console.warn('[WARNING] : Missing "on'+q+'" handler.')},r(t,S[q],o._domHandlers_[q]),J[q]&&r(t,J[q],o._domHandlers_[q]),o},U.prototype.unbindEvt=function(t,q){var o=this;return o._domHandlers_=o._domHandlers_||{},e(t,S[q],o._domHandlers_[q]),J[q]&&e(t,J[q],o._domHandlers_[q]),delete o._domHandlers_[q],this};const H=U;function j(t,q){return this.identifier=q.identifier,this.position=q.position,this.frontPosition=q.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(q),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=j.id,j.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}j.prototype=new H,j.constructor=j,j.id=0,j.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},j.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",q=function(){var t=i("borderRadius");for(var q in t)t.hasOwnProperty(q)&&(t[q]="50%");return t}(),S=O("transition","opacity",t),o={};return o.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},o.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},o.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},h(o.el,S),"circle"===this.options.shape&&h(o.back,q),h(o.front,q),this.applyStyles(o),this},j.prototype.applyStyles=function(t){for(var q in this.ui)if(this.ui.hasOwnProperty(q))for(var S in t[q])this.ui[q].style[S]=t[q][S];return this},j.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},j.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},j.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},j.prototype.show=function(t){var q=this;return q.options.dataOnly||(clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.addToDom(),q.restCallback(),setTimeout((function(){q.ui.el.style.opacity=1}),0),q.showTimeout=setTimeout((function(){q.trigger("shown",q.instance),"function"==typeof t&&t.call(this)}),q.options.fadeTime)),q},j.prototype.hide=function(t){var q=this;if(q.options.dataOnly)return q;if(q.ui.el.style.opacity=q.options.restOpacity,clearTimeout(q.removeTimeout),clearTimeout(q.showTimeout),clearTimeout(q.restTimeout),q.removeTimeout=setTimeout((function(){var S="dynamic"===q.options.mode?"none":"block";q.ui.el.style.display=S,"function"==typeof t&&t.call(q),q.trigger("hidden",q.instance)}),q.options.fadeTime),q.options.restJoystick){var S=q.options.restJoystick,o={};o.x=!0===S||!1!==S.x?0:q.instance.frontPosition.x,o.y=!0===S||!1!==S.y?0:q.instance.frontPosition.y,q.setPosition(t,o)}return q},j.prototype.setPosition=function(t,q){var S=this;S.frontPosition={x:q.x,y:q.y};var o=S.options.fadeTime+"ms",B={};B.front=O("transition",["transform"],o);var z={front:{}};z.front={transform:"translate("+S.frontPosition.x+"px,"+S.frontPosition.y+"px)"},S.applyStyles(B),S.applyStyles(z),S.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(S),S.restCallback()}),S.options.fadeTime)},j.prototype.restCallback=function(){var t=this,q={};q.front=O("transition","none",""),t.applyStyles(q),t.trigger("rested",t.instance)},j.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},j.prototype.computeDirection=function(t){var q,S,o,B=t.angle.radian,z=Math.PI/4,L=Math.PI/2;if(B>z&&B<3*z&&!t.lockX?q="up":B>-z&&B<=z&&!t.lockY?q="left":B>3*-z&&B<=-z&&!t.lockX?q="down":t.lockY||(q="right"),t.lockY||(S=B>-L&&B<L?"left":"right"),t.lockX||(o=B>0?"up":"down"),t.force>this.options.threshold){var r,e={};for(r in this.direction)this.direction.hasOwnProperty(r)&&(e[r]=this.direction[r]);var C={};for(r in this.direction={x:S,y:o,angle:q},t.direction=this.direction,e)e[r]===this.direction[r]&&(C[r]=!0);if(C.x&&C.y&&C.angle)return t;C.x&&C.y||this.trigger("plain",t),C.x||this.trigger("plain:"+S,t),C.y||this.trigger("plain:"+o,t),C.angle||this.trigger("dir dir:"+q,t)}else this.resetDirection();return t};const y=j;function Q(t,q){var S=this;S.nipples=[],S.idles=[],S.actives=[],S.ids=[],S.pressureIntervals={},S.manager=t,S.id=Q.id,Q.id+=1,S.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},S.config(q),"static"!==S.options.mode&&"semi"!==S.options.mode||(S.options.multitouch=!1),S.options.multitouch||(S.options.maxNumberOfNipples=1);var o=getComputedStyle(S.options.zone.parentElement);return o&&"flex"===o.display&&(S.parentIsFlex=!0),S.updateBox(),S.prepareNipples(),S.Yl(),S.begin(),S.nipples}Q.prototype=new H,Q.constructor=Q,Q.id=0,Q.prototype.prepareNipples=function(){var t=this,q=t.nipples;q.on=t.on.bind(t),q.off=t.off.bind(t),q.options=t.options,q.destroy=t.destroy.bind(t),q.ids=t.ids,q.id=t.id,q.processOnMove=t.processOnMove.bind(t),q.processOnEnd=t.processOnEnd.bind(t),q.get=function(t){if(void 0===t)return q[0];for(var S=0,o=q.length;S<o;S+=1)if(q[S].identifier===t)return q[S];return!1}},Q.prototype.Yl=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"},Q.prototype.begin=function(){var t=this,q=t.options;if("static"===q.mode){var S=t.createNipple(q.position,t.manager.getIdentifier());S.add(),t.idles.push(S)}},Q.prototype.createNipple=function(t,q){var S=this,o=S.manager.scroll,B={},z=S.options,L=S.parentIsFlex?o.x:o.x+S.box.left,r=S.parentIsFlex?o.y:o.y+S.box.top;if(t.x&&t.y)B={x:t.x-L,y:t.y-r};else if(t.top||t.right||t.bottom||t.left){var e=document.createElement("DIV");e.style.display="hidden",e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left,e.style.position="absolute",z.zone.appendChild(e);var C=e.getBoundingClientRect();z.zone.removeChild(e),B=t,t={x:C.left+o.x,y:C.top+o.y}}var Z=new y(S,{color:z.color,size:z.size,threshold:z.threshold,fadeTime:z.fadeTime,dataOnly:z.dataOnly,restJoystick:z.restJoystick,restOpacity:z.restOpacity,mode:z.mode,identifier:q,position:t,zone:z.zone,frontPosition:{x:0,y:0},shape:z.shape});return z.dataOnly||(b(Z.ui.el,B),b(Z.ui.front,Z.frontPosition)),S.nipples.push(Z),S.trigger("added "+Z.identifier+":added",Z),S.manager.trigger("added "+Z.identifier+":added",Z),S.bindNipple(Z),Z},Q.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Q.prototype.bindNipple=function(t){var q,S=this,o=function(t,o){q=t.type+" "+o.id+":"+t.type,S.trigger(q,o)};t.on("destroyed",S.onDestroyed.bind(S)),t.on("shown hidden rested dir plain",o),t.on("dir:up dir:right dir:down dir:left",o),t.on("plain:up plain:right plain:down plain:left",o)},Q.prototype.pressureFn=function(t,q,S){var o=this,B=0;clearInterval(o.pressureIntervals[S]),o.pressureIntervals[S]=setInterval(function(){var S=t.force||t.pressure||t.webkitForce||0;S!==B&&(q.trigger("pressure",S),o.trigger("pressure "+q.identifier+":pressure",S),B=S)}.bind(o),100)},Q.prototype.onstart=function(t){var q=this,S=q.options,o=t;return t=C(t),q.updateBox(),l(t,(function(B){q.actives.length<S.maxNumberOfNipples?q.processOnStart(B):o.type.match(/^touch/)&&(Object.keys(q.manager.ids).forEach((function(S){if(Object.values(o.touches).findIndex((function(t){return t.identifier===S}))<0){var B=[t[0]];B.identifier=S,q.processOnEnd(B)}})),q.actives.length<S.maxNumberOfNipples&&q.processOnStart(B))})),q.manager.bindDocument(),!1},Q.prototype.processOnStart=function(t){var q,S=this,B=S.options,z=S.manager.getIdentifier(t),L=t.force||t.pressure||t.webkitForce||0,r={x:t.pageX,y:t.pageY},e=S.getOrCreate(z,r);e.identifier!==z&&S.manager.removeIdentifier(e.identifier),e.identifier=z;var C=function(q){q.trigger("start",q),S.trigger("start "+q.id+":start",q),q.show(),L>0&&S.pressureFn(t,q,q.identifier),S.processOnMove(t)};if((q=S.idles.indexOf(e))>=0&&S.idles.splice(q,1),S.actives.push(e),S.ids.push(e.identifier),"semi"!==B.mode)C(e);else{if(!(o(r,e.position)<=B.catchDistance))return e.destroy(),void S.processOnStart(t);C(e)}return e},Q.prototype.getOrCreate=function(t,q){var S,o=this,B=o.options;return/(semi|static)/.test(B.mode)?(S=o.idles[0])?(o.idles.splice(0,1),S):"semi"===B.mode?o.createNipple(q,t):(console.warn("Coudln't find the needed nipple."),!1):S=o.createNipple(q,t)},Q.prototype.processOnMove=function(t){var q=this,S=q.options,z=q.manager.getIdentifier(t),L=q.nipples.get(z),r=q.manager.scroll;if(function(t){return isNaN(t.buttons)?0!==t.pressure:0!==t.buttons}(t)){if(!L)return console.error("Found zombie joystick with ID "+z),void q.manager.removeIdentifier(z);if(S.dynamicPage){var e=L.el.getBoundingClientRect();L.position={x:r.x+e.left,y:r.y+e.top}}L.identifier=z;var C=L.options.size/2,Z={x:t.pageX,y:t.pageY};S.lockX&&(Z.y=L.position.y),S.lockY&&(Z.x=L.position.x);var b,O,i,h,l,I,a,v,M,x,k=o(Z,L.position),V=(b=Z,i=(O=L.position).x-b.x,h=O.y-b.y,function(t){return t*(180/Math.PI)}(Math.atan2(h,i))),J=B(V),U=k/C,H={distance:k,position:Z};if("circle"===L.options.shape?(l=Math.min(k,C),a=L.position,v=l,x={x:0,y:0},M=B(M=V),x.x=a.x-v*Math.cos(M),x.y=a.y-v*Math.sin(M),I=x):(I=function(t,q,S){return{x:Math.min(Math.max(t.x,q.x-S),q.x+S),y:Math.min(Math.max(t.y,q.y-S),q.y+S)}}(Z,L.position,C),l=o(I,L.position)),S.follow){if(k>C){var j=Z.x-I.x,y=Z.y-I.y;L.position.x+=j,L.position.y+=y,L.el.style.top=L.position.y-(q.box.top+r.y)+"px",L.el.style.left=L.position.x-(q.box.left+r.x)+"px",k=o(Z,L.position)}}else Z=I,k=l;var Q=Z.x-L.position.x,K=Z.y-L.position.y;L.frontPosition={x:Q,y:K},S.dataOnly||(L.ui.front.style.transform="translate("+Q+"px,"+K+"px)");var X={identifier:L.identifier,position:Z,force:U,pressure:t.force||t.pressure||t.webkitForce||0,distance:k,angle:{radian:J,degree:V},vector:{x:Q/C,y:-K/C},raw:H,instance:L,lockX:S.lockX,lockY:S.lockY};(X=L.computeDirection(X)).angle={radian:B(180-V),degree:180-V},L.trigger("move",X),q.trigger("move "+L.id+":move",X)}else this.processOnEnd(t)},Q.prototype.processOnEnd=function(t){var q=this,S=q.options,o=q.manager.getIdentifier(t),B=q.nipples.get(o),z=q.manager.removeIdentifier(B.identifier);B&&(S.dataOnly||B.hide((function(){"dynamic"===S.mode&&(B.trigger("removed",B),q.trigger("removed "+B.id+":removed",B),q.manager.trigger("removed "+B.id+":removed",B),B.destroy())})),clearInterval(q.pressureIntervals[B.identifier]),B.resetDirection(),B.trigger("end",B),q.trigger("end "+B.id+":end",B),q.ids.indexOf(B.identifier)>=0&&q.ids.splice(q.ids.indexOf(B.identifier),1),q.actives.indexOf(B)>=0&&q.actives.splice(q.actives.indexOf(B),1),/(semi|static)/.test(S.mode)?q.idles.push(B):q.nipples.indexOf(B)>=0&&q.nipples.splice(q.nipples.indexOf(B),1),q.manager.unbindDocument(),/(semi|static)/.test(S.mode)&&(q.manager.ids[z.id]=z.identifier))},Q.prototype.onDestroyed=function(t,q){var S=this;S.nipples.indexOf(q)>=0&&S.nipples.splice(S.nipples.indexOf(q),1),S.actives.indexOf(q)>=0&&S.actives.splice(S.actives.indexOf(q),1),S.idles.indexOf(q)>=0&&S.idles.splice(S.idles.indexOf(q),1),S.ids.indexOf(q.identifier)>=0&&S.ids.splice(S.ids.indexOf(q.identifier),1),S.manager.removeIdentifier(q.identifier),S.manager.unbindDocument()},Q.prototype.destroy=function(){var t=this;for(var q in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(t){t.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(q)&&clearInterval(t.pressureIntervals[q]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};const K=Q;function X(t){var q=this;q.ids={},q.index=0,q.collections=[],q.scroll=Z(),q.config(t),q.prepareCollections();var S=function(){var t;q.collections.forEach((function(S){S.forEach((function(S){t=S.el.getBoundingClientRect(),S.position={x:q.scroll.x+t.left,y:q.scroll.y+t.top}}))}))};r(window,"resize",(function(){L(S)}));var o=function(){q.scroll=Z()};return r(window,"scroll",(function(){L(o)})),q.collections}X.prototype=new H,X.constructor=X,X.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(q){var S;return t.collections.every((function(t){return!(S=t.get(q))})),S}},X.prototype.create=function(t){return this.createCollection(t)},X.prototype.createCollection=function(t){var q=this,S=new K(q,t);return q.bindCollection(S),q.collections.push(S),S},X.prototype.bindCollection=function(t){var q,S=this,o=function(t,o){q=t.type+" "+o.id+":"+t.type,S.trigger(q,o)};t.on("destroyed",S.onDestroyed.bind(S)),t.on("shown hidden rested dir plain",o),t.on("dir:up dir:right dir:down dir:left",o),t.on("plain:up plain:right plain:down plain:left",o)},X.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)},X.prototype.unbindDocument=function(t){var q=this;Object.keys(q.ids).length&&!0!==t||(q.unbindEvt(document,"move").unbindEvt(document,"end"),q.binded=!1)},X.prototype.getIdentifier=function(t){var q;return t?void 0===(q=void 0===t.identifier?t.pointerId:t.identifier)&&(q=this.latest||0):q=this.index,void 0===this.ids[q]&&(this.ids[q]=this.index,this.index+=1),this.latest=q,this.ids[q]},X.prototype.removeIdentifier=function(t){var q={};for(var S in this.ids)if(this.ids[S]===t){q.id=S,q.identifier=this.ids[S],delete this.ids[S];break}return q},X.prototype.onmove=function(t){return this.onAny("move",t),!1},X.prototype.onend=function(t){return this.onAny("end",t),!1},X.prototype.oncancel=function(t){return this.onAny("end",t),!1},X.prototype.onAny=function(t,q){var S,o=this,B="processOn"+t.charAt(0).toUpperCase()+t.slice(1);q=C(q);var z=function(t,q,S){S.ids.indexOf(q)>=0&&(S[B](t),t._found_=!0)};return l(q,(function(t){S=o.getIdentifier(t),l(o.collections,z.bind(null,t,S)),t._found_||o.removeIdentifier(S)})),!1},X.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach((function(t){t.destroy()})),t.off()},X.prototype.onDestroyed=function(t,q){var S=this;if(S.collections.indexOf(q)<0)return!1;S.collections.splice(S.collections.indexOf(q),1)};var G=new X;const Y={create:function(t){return G.create(t)},factory:G};return q.default})(),t.exports=q()},12358:(t,q,S)=>{"use strict";const{Deflate:o,deflate:B,deflateRaw:z,gzip:L}=S(12363),{Inflate:r,inflate:e,inflateRaw:C,ungzip:Z}=S(12415),b=S(12392);t.exports.Deflate=o,t.exports.deflate=B,t.exports.deflateRaw=z,t.exports.gzip=L,t.exports.Inflate=r,t.exports.inflate=e,t.exports.inflateRaw=C,t.exports.ungzip=Z,t.exports.constants=b},12363:(t,q,S)=>{"use strict";const o=S(12367),B=S(12401),z=S(12406),L=S(12383),r=S(12408),e=Object.prototype.toString,{Z_NO_FLUSH:C,Z_SYNC_FLUSH:Z,Z_FULL_FLUSH:b,Z_FINISH:O,Z_OK:i,Z_STREAM_END:h,Z_DEFAULT_COMPRESSION:l,Z_DEFAULT_STRATEGY:I,Z_DEFLATED:a}=S(12392);function v(t){this.options=B.assign({level:l,method:a,Ja:16384,windowBits:15,memLevel:8,strategy:I},t||{});let q=this.options;q.raw&&q.windowBits>0?q.windowBits=-q.windowBits:q.gzip&&q.windowBits>0&&q.windowBits<16&&(q.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let S=o.deflateInit2(this.strm,q.level,q.method,q.windowBits,q.memLevel,q.strategy);if(S!==i)throw new Error(L[S]);if(q.header&&o.deflateSetHeader(this.strm,q.header),q.dictionary){let t;if(t="string"===typeof q.dictionary?z.string2buf(q.dictionary):"[object ArrayBuffer]"===e.call(q.dictionary)?new Uint8Array(q.dictionary):q.dictionary,S=o.deflateSetDictionary(this.strm,t),S!==i)throw new Error(L[S]);this._dict_set=!0}}function M(t,q){const S=new v(q);if(S.push(t,!0),S.err)throw S.msg||L[S.err];return S.result}v.prototype.push=function(t,q){const S=this.strm,B=this.options.Ja;let L,r;if(this.ended)return!1;for(r=q===~~q?q:!0===q?O:C,"string"===typeof t?S.input=z.string2buf(t):"[object ArrayBuffer]"===e.call(t)?S.input=new Uint8Array(t):S.input=t,S.next_in=0,S.avail_in=S.input.length;;)if(0===S.avail_out&&(S.output=new Uint8Array(B),S.next_out=0,S.avail_out=B),(r===Z||r===b)&&S.avail_out<=6)this.onData(S.output.subarray(0,S.next_out)),S.avail_out=0;else{if(L=o.deflate(S,r),L===h)return S.next_out>0&&this.onData(S.output.subarray(0,S.next_out)),L=o.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===i;if(0!==S.avail_out){if(r>0&&S.next_out>0)this.onData(S.output.subarray(0,S.next_out)),S.avail_out=0;else if(0===S.avail_in)break}else this.onData(S.output)}return!0},v.prototype.onData=function(t){this.chunks.push(t)},v.prototype.onEnd=function(t){t===i&&(this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Deflate=v,t.exports.deflate=M,t.exports.deflateRaw=function(t,q){return(q=q||{}).raw=!0,M(t,q)},t.exports.gzip=function(t,q){return(q=q||{}).gzip=!0,M(t,q)},t.exports.constants=S(12392)},12415:(t,q,S)=>{"use strict";const o=S(12419),B=S(12401),z=S(12406),L=S(12383),r=S(12408),e=S(12436),C=Object.prototype.toString,{Z_NO_FLUSH:Z,Z_FINISH:b,Z_OK:O,Z_STREAM_END:i,Z_NEED_DICT:h,Z_STREAM_ERROR:l,Z_DATA_ERROR:I,Z_MEM_ERROR:a}=S(12392);function v(t){this.options=B.assign({Ja:65536,windowBits:15,to:""},t||{});const q=this.options;q.raw&&q.windowBits>=0&&q.windowBits<16&&(q.windowBits=-q.windowBits,0===q.windowBits&&(q.windowBits=-15)),!(q.windowBits>=0&&q.windowBits<16)||t&&t.windowBits||(q.windowBits+=32),q.windowBits>15&&q.windowBits<48&&0===(15&q.windowBits)&&(q.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let S=o.inflateInit2(this.strm,q.windowBits);if(S!==O)throw new Error(L[S]);if(this.header=new e,o.inflateGetHeader(this.strm,this.header),q.dictionary&&("string"===typeof q.dictionary?q.dictionary=z.string2buf(q.dictionary):"[object ArrayBuffer]"===C.call(q.dictionary)&&(q.dictionary=new Uint8Array(q.dictionary)),q.raw&&(S=o.inflateSetDictionary(this.strm,q.dictionary),S!==O)))throw new Error(L[S])}function M(t,q){const S=new v(q);if(S.push(t),S.err)throw S.msg||L[S.err];return S.result}v.prototype.push=function(t,q){const S=this.strm,B=this.options.Ja,L=this.options.dictionary;let r,e,v;if(this.ended)return!1;for(e=q===~~q?q:!0===q?b:Z,"[object ArrayBuffer]"===C.call(t)?S.input=new Uint8Array(t):S.input=t,S.next_in=0,S.avail_in=S.input.length;;){for(0===S.avail_out&&(S.output=new Uint8Array(B),S.next_out=0,S.avail_out=B),r=o.inflate(S,e),r===h&&L&&(r=o.inflateSetDictionary(S,L),r===O?r=o.inflate(S,e):r===I&&(r=h));S.avail_in>0&&r===i&&S.state.wrap>0&&0!==t[S.next_in];)o.inflateReset(S),r=o.inflate(S,e);switch(r){case l:case I:case h:case a:return this.onEnd(r),this.ended=!0,!1}if(v=S.avail_out,S.next_out&&(0===S.avail_out||r===i))if("string"===this.options.to){let t=z.utf8border(S.output,S.next_out),q=S.next_out-t,o=z.buf2string(S.output,t);S.next_out=q,S.avail_out=B-q,q&&S.output.set(S.output.subarray(t,t+q),0),this.onData(o)}else this.onData(S.output.length===S.next_out?S.output:S.output.subarray(0,S.next_out));if(r!==O||0!==v){if(r===i)return r=o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===S.avail_in)break}}return!0},v.prototype.onData=function(t){this.chunks.push(t)},v.prototype.onEnd=function(t){t===O&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Inflate=v,t.exports.inflate=M,t.exports.inflateRaw=function(t,q){return(q=q||{}).raw=!0,M(t,q)},t.exports.ungzip=M,t.exports.constants=S(12392)},12401:t=>{"use strict";const q=(t,q)=>Object.prototype.hasOwnProperty.call(t,q);t.exports.assign=function(t){const S=Array.prototype.slice.call(arguments,1);for(;S.length;){const o=S.shift();if(o){if("object"!==typeof o)throw new TypeError(o+"must be non-object");for(const S in o)q(o,S)&&(t[S]=o[S])}}return t},t.exports.flattenChunks=t=>{let q=0;for(let o=0,B=t.length;o<B;o++)q+=t[o].length;const S=new Uint8Array(q);for(let o=0,B=0,z=t.length;o<z;o++){let q=t[o];S.set(q,B),B+=q.length}return S}},12406:t=>{"use strict";let q=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){q=!1}const S=new Uint8Array(256);for(let B=0;B<256;B++)S[B]=B>=252?6:B>=248?5:B>=240?4:B>=224?3:B>=192?2:1;S[254]=S[254]=1,t.exports.string2buf=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let q,S,o,B,z,L=t.length,r=0;for(B=0;B<L;B++)S=t.charCodeAt(B),55296===(64512&S)&&B+1<L&&(o=t.charCodeAt(B+1),56320===(64512&o)&&(S=65536+(S-55296<<10)+(o-56320),B++)),r+=S<128?1:S<2048?2:S<65536?3:4;for(q=new Uint8Array(r),z=0,B=0;z<r;B++)S=t.charCodeAt(B),55296===(64512&S)&&B+1<L&&(o=t.charCodeAt(B+1),56320===(64512&o)&&(S=65536+(S-55296<<10)+(o-56320),B++)),S<128?q[z++]=S:S<2048?(q[z++]=192|S>>>6,q[z++]=128|63&S):S<65536?(q[z++]=224|S>>>12,q[z++]=128|S>>>6&63,q[z++]=128|63&S):(q[z++]=240|S>>>18,q[z++]=128|S>>>12&63,q[z++]=128|S>>>6&63,q[z++]=128|63&S);return q};t.exports.buf2string=(t,o)=>{const B=o||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,o));let z,L;const r=new Array(2*B);for(L=0,z=0;z<B;){let q=t[z++];if(q<128){r[L++]=q;continue}let o=S[q];if(o>4)r[L++]=65533,z+=o-1;else{for(q&=2===o?31:3===o?15:7;o>1&&z<B;)q=q<<6|63&t[z++],o--;o>1?r[L++]=65533:q<65536?r[L++]=q:(q-=65536,r[L++]=55296|q>>10&1023,r[L++]=56320|1023&q)}}return((t,S)=>{if(S<65534&&t.subarray&&q)return String.fromCharCode.apply(null,t.length===S?t:t.subarray(0,S));let o="";for(let q=0;q<S;q++)o+=String.fromCharCode(t[q]);return o})(r,L)},t.exports.utf8border=(t,q)=>{(q=q||t.length)>t.length&&(q=t.length);let o=q-1;for(;o>=0&&128===(192&t[o]);)o--;return o<0||0===o?q:o+S[t[o]]>q?o:q}},12375:t=>{"use strict";t.exports=(t,q,S,o)=>{let B=65535&t,z=t>>>16&65535,L=0;for(;0!==S;){L=S>2e3?2e3:S,S-=L;do{B=B+q[o++]|0,z=z+B|0}while(--L);B%=65521,z%=65521}return B|z<<16}},12392:t=>{"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12377:t=>{"use strict";const q=new Uint32Array((()=>{let t,q=[];for(var S=0;S<256;S++){t=S;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;q[S]=t}return q})());t.exports=(t,S,o,B)=>{const z=q,L=B+o;t^=-1;for(let q=B;q<L;q++)t=t>>>8^z[255&(t^S[q])];return~t}},12367:(t,q,S)=>{"use strict";const{_tr_init:o,_tr_stored_block:B,_tr_flush_block:z,_tr_tally:L,_tr_align:r}=S(12371),e=S(12375),C=S(12377),Z=S(12383),{Z_NO_FLUSH:b,Z_PARTIAL_FLUSH:O,Z_FULL_FLUSH:i,Z_FINISH:h,Z_BLOCK:l,Z_OK:I,Z_STREAM_END:a,Z_STREAM_ERROR:v,Z_DATA_ERROR:M,Z_BUF_ERROR:x,Z_DEFAULT_COMPRESSION:k,Z_FILTERED:V,Z_HUFFMAN_ONLY:J,Z_RLE:U,Z_FIXED:H,Z_DEFAULT_STRATEGY:j,Z_UNKNOWN:y,Z_DEFLATED:Q}=S(12392),K=258,X=262,G=103,Y=113,n=666,u=(t,q)=>(t.msg=Z[q],q),W=t=>(t<<1)-(t>4?9:0),f=t=>{let q=t.length;for(;--q>=0;)t[q]=0};let D=(t,q,S)=>(q<<t.hash_shift^S)&t.hash_mask;const m=t=>{const q=t.state;let S=q.pending;S>t.avail_out&&(S=t.avail_out),0!==S&&(t.output.set(q.pending_buf.subarray(q.pending_out,q.pending_out+S),t.next_out),t.next_out+=S,q.pending_out+=S,t.total_out+=S,t.avail_out-=S,q.pending-=S,0===q.pending&&(q.pending_out=0))},A=(t,q)=>{z(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,q),t.block_start=t.strstart,m(t.strm)},c=(t,q)=>{t.pending_buf[t.pending++]=q},s=(t,q)=>{t.pending_buf[t.pending++]=q>>>8&255,t.pending_buf[t.pending++]=255&q},g=(t,q,S,o)=>{let B=t.avail_in;return B>o&&(B=o),0===B?0:(t.avail_in-=B,q.set(t.input.subarray(t.next_in,t.next_in+B),S),1===t.state.wrap?t.adler=e(t.adler,q,B,S):2===t.state.wrap&&(t.adler=C(t.adler,q,B,S)),t.next_in+=B,t.total_in+=B,B)},N=(t,q)=>{let S,o,B=t.max_chain_length,z=t.strstart,L=t.prev_length,r=t.nice_match;const e=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,C=t.window,Z=t.w_mask,b=t.prev,O=t.strstart+K;let i=C[z+L-1],h=C[z+L];t.prev_length>=t.good_match&&(B>>=2),r>t.lookahead&&(r=t.lookahead);do{if(S=q,C[S+L]===h&&C[S+L-1]===i&&C[S]===C[z]&&C[++S]===C[z+1]){z+=2,S++;do{}while(C[++z]===C[++S]&&C[++z]===C[++S]&&C[++z]===C[++S]&&C[++z]===C[++S]&&C[++z]===C[++S]&&C[++z]===C[++S]&&C[++z]===C[++S]&&C[++z]===C[++S]&&z<O);if(o=K-(O-z),z=O-K,o>L){if(t.match_start=q,L=o,o>=r)break;i=C[z+L-1],h=C[z+L]}}}while((q=b[q&Z])>e&&0!==--B);return L<=t.lookahead?L:t.lookahead},T=t=>{const q=t.w_size;let S,o,B,z,L;do{if(z=t.window_size-t.lookahead-t.strstart,t.strstart>=q+(q-X)){t.window.set(t.window.subarray(q,q+q),0),t.match_start-=q,t.strstart-=q,t.block_start-=q,o=t.hash_size,S=o;do{B=t.head[--S],t.head[S]=B>=q?B-q:0}while(--o);o=q,S=o;do{B=t.prev[--S],t.prev[S]=B>=q?B-q:0}while(--o);z+=q}if(0===t.strm.avail_in)break;if(o=g(t.strm,t.window,t.strstart+t.lookahead,z),t.lookahead+=o,t.lookahead+t.insert>=3)for(L=t.strstart-t.insert,t.ins_h=t.window[L],t.ins_h=D(t,t.ins_h,t.window[L+1]);t.insert&&(t.ins_h=D(t,t.ins_h,t.window[L+3-1]),t.prev[L&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=L,L++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<X&&0!==t.strm.avail_in)},w=(t,q)=>{let S,o;for(;;){if(t.lookahead<X){if(T(t),t.lookahead<X&&q===b)return 1;if(0===t.lookahead)break}if(S=0,t.lookahead>=3&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),S=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==S&&t.strstart-S<=t.w_size-X&&(t.match_length=N(t,S)),t.match_length>=3)if(o=L(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),S=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=D(t,t.ins_h,t.window[t.strstart+1]);else o=L(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(A(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,q===h?(A(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(A(t,!1),0===t.strm.avail_out)?1:2},E=(t,q)=>{let S,o,B;for(;;){if(t.lookahead<X){if(T(t),t.lookahead<X&&q===b)return 1;if(0===t.lookahead)break}if(S=0,t.lookahead>=3&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),S=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==S&&t.prev_length<t.max_lazy_match&&t.strstart-S<=t.w_size-X&&(t.match_length=N(t,S),t.match_length<=5&&(t.strategy===V||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){B=t.strstart+t.lookahead-3,o=L(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=B&&(t.ins_h=D(t,t.ins_h,t.window[t.strstart+3-1]),S=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(A(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(o=L(t,0,t.window[t.strstart-1]),o&&A(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=L(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,q===h?(A(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(A(t,!1),0===t.strm.avail_out)?1:2};function p(t,q,S,o,B){this.good_length=t,this.max_lazy=q,this.nice_length=S,this.max_chain=o,this.func=B}const P=[new p(0,0,0,0,((t,q)=>{let S=65535;for(S>t.pending_buf_size-5&&(S=t.pending_buf_size-5);;){if(t.lookahead<=1){if(T(t),0===t.lookahead&&q===b)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const o=t.block_start+S;if((0===t.strstart||t.strstart>=o)&&(t.lookahead=t.strstart-o,t.strstart=o,A(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-X&&(A(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,q===h?(A(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(A(t,!1),t.strm.avail_out),1)})),new p(4,4,8,4,w),new p(4,5,16,8,w),new p(4,6,32,32,w),new p(4,4,16,16,E),new p(8,16,32,32,E),new p(8,16,128,128,E),new p(8,32,128,256,E),new p(32,128,258,1024,E),new p(32,258,258,4096,E)];function F(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const d=t=>{if(!t||!t.state)return u(t,v);t.total_in=t.total_out=0,t.data_type=y;const q=t.state;return q.pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?42:Y,t.adler=2===q.wrap?0:1,q.last_flush=b,o(q),I},R=t=>{const q=d(t);var S;return q===I&&((S=t.state).window_size=2*S.w_size,f(S.head),S.max_lazy_match=P[S.level].max_lazy,S.good_match=P[S.level].good_length,S.nice_match=P[S.level].nice_length,S.max_chain_length=P[S.level].max_chain,S.strstart=0,S.block_start=0,S.lookahead=0,S.insert=0,S.match_length=S.prev_length=2,S.match_available=0,S.ins_h=0),q},tt=(t,q,S,o,B,z)=>{if(!t)return v;let L=1;if(q===k&&(q=6),o<0?(L=0,o=-o):o>15&&(L=2,o-=16),B<1||B>9||S!==Q||o<8||o>15||q<0||q>9||z<0||z>H)return u(t,v);8===o&&(o=9);const r=new F;return t.state=r,r.strm=t,r.wrap=L,r.gzhead=null,r.w_bits=o,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=B+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Uint8Array(2*r.w_size),r.head=new Uint16Array(r.hash_size),r.prev=new Uint16Array(r.w_size),r.lit_bufsize=1<<B+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Uint8Array(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=q,r.strategy=z,r.method=S,R(t)};t.exports.deflateInit=(t,q)=>tt(t,q,Q,15,8,j),t.exports.deflateInit2=tt,t.exports.deflateReset=R,t.exports.deflateResetKeep=d,t.exports.deflateSetHeader=(t,q)=>t&&t.state?2!==t.state.wrap?v:(t.state.gzhead=q,I):v,t.exports.deflate=(t,q)=>{let S,o;if(!t||!t.state||q>l||q<0)return t?u(t,v):v;const z=t.state;if(!t.output||!t.input&&0!==t.avail_in||z.status===n&&q!==h)return u(t,0===t.avail_out?x:v);z.strm=t;const e=z.last_flush;if(z.last_flush=q,42===z.status)if(2===z.wrap)t.adler=0,c(z,31),c(z,139),c(z,8),z.gzhead?(c(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),c(z,255&z.gzhead.time),c(z,z.gzhead.time>>8&255),c(z,z.gzhead.time>>16&255),c(z,z.gzhead.time>>24&255),c(z,9===z.level?2:z.strategy>=J||z.level<2?4:0),c(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(c(z,255&z.gzhead.extra.length),c(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(t.adler=C(t.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(c(z,0),c(z,0),c(z,0),c(z,0),c(z,0),c(z,9===z.level?2:z.strategy>=J||z.level<2?4:0),c(z,3),z.status=Y);else{let q=Q+(z.w_bits-8<<4)<<8,S=-1;S=z.strategy>=J||z.level<2?0:z.level<6?1:6===z.level?2:3,q|=S<<6,0!==z.strstart&&(q|=32),q+=31-q%31,z.status=Y,s(z,q),0!==z.strstart&&(s(z,t.adler>>>16),s(z,65535&t.adler)),t.adler=1}if(69===z.status)if(z.gzhead.extra){for(S=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>S&&(t.adler=C(t.adler,z.pending_buf,z.pending-S,S)),m(t),S=z.pending,z.pending!==z.pending_buf_size));)c(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>S&&(t.adler=C(t.adler,z.pending_buf,z.pending-S,S)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(73===z.status)if(z.gzhead.name){S=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>S&&(t.adler=C(t.adler,z.pending_buf,z.pending-S,S)),m(t),S=z.pending,z.pending===z.pending_buf_size)){o=1;break}o=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,c(z,o)}while(0!==o);z.gzhead.hcrc&&z.pending>S&&(t.adler=C(t.adler,z.pending_buf,z.pending-S,S)),0===o&&(z.gzindex=0,z.status=91)}else z.status=91;if(91===z.status)if(z.gzhead.comment){S=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>S&&(t.adler=C(t.adler,z.pending_buf,z.pending-S,S)),m(t),S=z.pending,z.pending===z.pending_buf_size)){o=1;break}o=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,c(z,o)}while(0!==o);z.gzhead.hcrc&&z.pending>S&&(t.adler=C(t.adler,z.pending_buf,z.pending-S,S)),0===o&&(z.status=G)}else z.status=G;if(z.status===G&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&m(t),z.pending+2<=z.pending_buf_size&&(c(z,255&t.adler),c(z,t.adler>>8&255),t.adler=0,z.status=Y)):z.status=Y),0!==z.pending){if(m(t),0===t.avail_out)return z.last_flush=-1,I}else if(0===t.avail_in&&W(q)<=W(e)&&q!==h)return u(t,x);if(z.status===n&&0!==t.avail_in)return u(t,x);if(0!==t.avail_in||0!==z.lookahead||q!==b&&z.status!==n){let S=z.strategy===J?((t,q)=>{let S;for(;;){if(0===t.lookahead&&(T(t),0===t.lookahead)){if(q===b)return 1;break}if(t.match_length=0,S=L(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,S&&(A(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,q===h?(A(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(A(t,!1),0===t.strm.avail_out)?1:2})(z,q):z.strategy===U?((t,q)=>{let S,o,B,z;const r=t.window;for(;;){if(t.lookahead<=K){if(T(t),t.lookahead<=K&&q===b)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(B=t.strstart-1,o=r[B],o===r[++B]&&o===r[++B]&&o===r[++B])){z=t.strstart+K;do{}while(o===r[++B]&&o===r[++B]&&o===r[++B]&&o===r[++B]&&o===r[++B]&&o===r[++B]&&o===r[++B]&&o===r[++B]&&B<z);t.match_length=K-(z-B),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(S=L(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(S=L(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),S&&(A(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,q===h?(A(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(A(t,!1),0===t.strm.avail_out)?1:2})(z,q):P[z.level].func(z,q);if(3!==S&&4!==S||(z.status=n),1===S||3===S)return 0===t.avail_out&&(z.last_flush=-1),I;if(2===S&&(q===O?r(z):q!==l&&(B(z,0,0,!1),q===i&&(f(z.head),0===z.lookahead&&(z.strstart=0,z.block_start=0,z.insert=0))),m(t),0===t.avail_out))return z.last_flush=-1,I}return q!==h?I:z.wrap<=0?a:(2===z.wrap?(c(z,255&t.adler),c(z,t.adler>>8&255),c(z,t.adler>>16&255),c(z,t.adler>>24&255),c(z,255&t.total_in),c(z,t.total_in>>8&255),c(z,t.total_in>>16&255),c(z,t.total_in>>24&255)):(s(z,t.adler>>>16),s(z,65535&t.adler)),m(t),z.wrap>0&&(z.wrap=-z.wrap),0!==z.pending?I:a)},t.exports.deflateEnd=t=>{if(!t||!t.state)return v;const q=t.state.status;return 42!==q&&69!==q&&73!==q&&91!==q&&q!==G&&q!==Y&&q!==n?u(t,v):(t.state=null,q===Y?u(t,M):I)},t.exports.deflateSetDictionary=(t,q)=>{let S=q.length;if(!t||!t.state)return v;const o=t.state,B=o.wrap;if(2===B||1===B&&42!==o.status||o.lookahead)return v;if(1===B&&(t.adler=e(t.adler,q,S,0)),o.wrap=0,S>=o.w_size){0===B&&(f(o.head),o.strstart=0,o.block_start=0,o.insert=0);let t=new Uint8Array(o.w_size);t.set(q.subarray(S-o.w_size,S),0),q=t,S=o.w_size}const z=t.avail_in,L=t.next_in,r=t.input;for(t.avail_in=S,t.next_in=0,t.input=q,T(o);o.lookahead>=3;){let t=o.strstart,q=o.lookahead-2;do{o.ins_h=D(o,o.ins_h,o.window[t+3-1]),o.prev[t&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=t,t++}while(--q);o.strstart=t,o.lookahead=2,T(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=L,t.input=r,t.avail_in=z,o.wrap=B,I},t.exports.deflateInfo="pako deflate (from Nodeca project)"},12436:t=>{"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12424:t=>{"use strict";t.exports=function(t,q){let S,o,B,z,L,r,e,C,Z,b,O,i,h,l,I,a,v,M,x,k,V,J,U,H;const j=t.state;S=t.next_in,U=t.input,o=S+(t.avail_in-5),B=t.next_out,H=t.output,z=B-(q-t.avail_out),L=B+(t.avail_out-257),r=j.dmax,e=j.wsize,C=j.whave,Z=j.wnext,b=j.window,O=j.hold,i=j.bits,h=j.lencode,l=j.distcode,I=(1<<j.lenbits)-1,a=(1<<j.distbits)-1;t:do{i<15&&(O+=U[S++]<<i,i+=8,O+=U[S++]<<i,i+=8),v=h[O&I];q:for(;;){if(M=v>>>24,O>>>=M,i-=M,M=v>>>16&255,0===M)H[B++]=65535&v;else{if(!(16&M)){if(0===(64&M)){v=h[(65535&v)+(O&(1<<M)-1)];continue q}if(32&M){j.mode=12;break t}t.msg="invalid literal/length code",j.mode=30;break t}x=65535&v,M&=15,M&&(i<M&&(O+=U[S++]<<i,i+=8),x+=O&(1<<M)-1,O>>>=M,i-=M),i<15&&(O+=U[S++]<<i,i+=8,O+=U[S++]<<i,i+=8),v=l[O&a];S:for(;;){if(M=v>>>24,O>>>=M,i-=M,M=v>>>16&255,!(16&M)){if(0===(64&M)){v=l[(65535&v)+(O&(1<<M)-1)];continue S}t.msg="invalid distance code",j.mode=30;break t}if(k=65535&v,M&=15,i<M&&(O+=U[S++]<<i,i+=8,i<M&&(O+=U[S++]<<i,i+=8)),k+=O&(1<<M)-1,k>r){t.msg="invalid distance too far back",j.mode=30;break t}if(O>>>=M,i-=M,M=B-z,k>M){if(M=k-M,M>C&&j.sane){t.msg="invalid distance too far back",j.mode=30;break t}if(V=0,J=b,0===Z){if(V+=e-M,M<x){x-=M;do{H[B++]=b[V++]}while(--M);V=B-k,J=H}}else if(Z<M){if(V+=e+Z-M,M-=Z,M<x){x-=M;do{H[B++]=b[V++]}while(--M);if(V=0,Z<x){M=Z,x-=M;do{H[B++]=b[V++]}while(--M);V=B-k,J=H}}}else if(V+=Z-M,M<x){x-=M;do{H[B++]=b[V++]}while(--M);V=B-k,J=H}for(;x>2;)H[B++]=J[V++],H[B++]=J[V++],H[B++]=J[V++],x-=3;x&&(H[B++]=J[V++],x>1&&(H[B++]=J[V++]))}else{V=B-k;do{H[B++]=H[V++],H[B++]=H[V++],H[B++]=H[V++],x-=3}while(x>2);x&&(H[B++]=H[V++],x>1&&(H[B++]=H[V++]))}break}}break}}while(S<o&&B<L);x=i>>3,S-=x,i-=x<<3,O&=(1<<i)-1,t.next_in=S,t.next_out=B,t.avail_in=S<o?o-S+5:5-(S-o),t.avail_out=B<L?L-B+257:257-(B-L),j.hold=O,j.bits=i}},12419:(t,q,S)=>{"use strict";const o=S(12375),B=S(12377),z=S(12424),L=S(12431),{Z_FINISH:r,Z_BLOCK:e,Z_TREES:C,Z_OK:Z,Z_STREAM_END:b,Z_NEED_DICT:O,Z_STREAM_ERROR:i,Z_DATA_ERROR:h,Z_MEM_ERROR:l,Z_BUF_ERROR:I,Z_DEFLATED:a}=S(12392),v=12,M=30,x=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const V=t=>{if(!t||!t.state)return i;const q=t.state;return t.total_in=t.total_out=q.total=0,t.msg="",q.wrap&&(t.adler=1&q.wrap),q.mode=1,q.last=0,q.havedict=0,q.dmax=32768,q.head=null,q.hold=0,q.bits=0,q.lencode=q.lendyn=new Int32Array(852),q.distcode=q.distdyn=new Int32Array(592),q.sane=1,q.back=-1,Z},J=t=>{if(!t||!t.state)return i;const q=t.state;return q.wsize=0,q.whave=0,q.wnext=0,V(t)},U=(t,q)=>{let S;if(!t||!t.state)return i;const o=t.state;return q<0?(S=0,q=-q):(S=1+(q>>4),q<48&&(q&=15)),q&&(q<8||q>15)?i:(null!==o.window&&o.wbits!==q&&(o.window=null),o.wrap=S,o.wbits=q,J(t))},H=(t,q)=>{if(!t)return i;const S=new k;t.state=S,S.window=null;const o=U(t,q);return o!==Z&&(t.state=null),o};let j,y,Q=!0;const K=t=>{if(Q){j=new Int32Array(512),y=new Int32Array(32);let q=0;for(;q<144;)t.lens[q++]=8;for(;q<256;)t.lens[q++]=9;for(;q<280;)t.lens[q++]=7;for(;q<288;)t.lens[q++]=8;for(L(1,t.lens,0,288,j,0,t.work,{bits:9}),q=0;q<32;)t.lens[q++]=5;L(2,t.lens,0,32,y,0,t.work,{bits:5}),Q=!1}t.lencode=j,t.lenbits=9,t.distcode=y,t.distbits=5},X=(t,q,S,o)=>{let B;const z=t.state;return null===z.window&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new Uint8Array(z.wsize)),o>=z.wsize?(z.window.set(q.subarray(S-z.wsize,S),0),z.wnext=0,z.whave=z.wsize):(B=z.wsize-z.wnext,B>o&&(B=o),z.window.set(q.subarray(S-o,S-o+B),z.wnext),(o-=B)?(z.window.set(q.subarray(S-o,S),0),z.wnext=o,z.whave=z.wsize):(z.wnext+=B,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=B))),0};t.exports.inflateReset=J,t.exports.inflateReset2=U,t.exports.inflateResetKeep=V,t.exports.inflateInit=t=>H(t,15),t.exports.inflateInit2=H,t.exports.inflate=(t,q)=>{let S,k,V,J,U,H,j,y,Q,G,Y,n,u,W,f,D,m,A,c,s,g,N,T=0;const w=new Uint8Array(4);let E,p;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return i;S=t.state,S.mode===v&&(S.mode=13),U=t.next_out,V=t.output,j=t.avail_out,J=t.next_in,k=t.input,H=t.avail_in,y=S.hold,Q=S.bits,G=H,Y=j,N=Z;t:for(;;)switch(S.mode){case 1:if(0===S.wrap){S.mode=13;break}for(;Q<16;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(2&S.wrap&&35615===y){S.check=0,w[0]=255&y,w[1]=y>>>8&255,S.check=B(S.check,w,2,0),y=0,Q=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",S.mode=M;break}if((15&y)!==a){t.msg="unknown compression method",S.mode=M;break}if(y>>>=4,Q-=4,g=8+(15&y),0===S.wbits)S.wbits=g;else if(g>S.wbits){t.msg="invalid window size",S.mode=M;break}S.dmax=1<<S.wbits,t.adler=S.check=1,S.mode=512&y?10:v,y=0,Q=0;break;case 2:for(;Q<16;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(S.flags=y,(255&S.flags)!==a){t.msg="unknown compression method",S.mode=M;break}if(57344&S.flags){t.msg="unknown header flags set",S.mode=M;break}S.head&&(S.head.text=y>>8&1),512&S.flags&&(w[0]=255&y,w[1]=y>>>8&255,S.check=B(S.check,w,2,0)),y=0,Q=0,S.mode=3;case 3:for(;Q<32;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}S.head&&(S.head.time=y),512&S.flags&&(w[0]=255&y,w[1]=y>>>8&255,w[2]=y>>>16&255,w[3]=y>>>24&255,S.check=B(S.check,w,4,0)),y=0,Q=0,S.mode=4;case 4:for(;Q<16;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}S.head&&(S.head.xflags=255&y,S.head.os=y>>8),512&S.flags&&(w[0]=255&y,w[1]=y>>>8&255,S.check=B(S.check,w,2,0)),y=0,Q=0,S.mode=5;case 5:if(1024&S.flags){for(;Q<16;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}S.length=y,S.head&&(S.head.extra_len=y),512&S.flags&&(w[0]=255&y,w[1]=y>>>8&255,S.check=B(S.check,w,2,0)),y=0,Q=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(n=S.length,n>H&&(n=H),n&&(S.head&&(g=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Uint8Array(S.head.extra_len)),S.head.extra.set(k.subarray(J,J+n),g)),512&S.flags&&(S.check=B(S.check,k,n,J)),H-=n,J+=n,S.length-=n),S.length))break t;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(0===H)break t;n=0;do{g=k[J+n++],S.head&&g&&S.length<65536&&(S.head.name+=String.fromCharCode(g))}while(g&&n<H);if(512&S.flags&&(S.check=B(S.check,k,n,J)),H-=n,J+=n,g)break t}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(0===H)break t;n=0;do{g=k[J+n++],S.head&&g&&S.length<65536&&(S.head.comment+=String.fromCharCode(g))}while(g&&n<H);if(512&S.flags&&(S.check=B(S.check,k,n,J)),H-=n,J+=n,g)break t}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;Q<16;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(y!==(65535&S.check)){t.msg="header crc mismatch",S.mode=M;break}y=0,Q=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),t.adler=S.check=0,S.mode=v;break;case 10:for(;Q<32;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}t.adler=S.check=x(y),y=0,Q=0,S.mode=11;case 11:if(0===S.havedict)return t.next_out=U,t.avail_out=j,t.next_in=J,t.avail_in=H,S.hold=y,S.bits=Q,O;t.adler=S.check=1,S.mode=v;case v:if(q===e||q===C)break t;case 13:if(S.last){y>>>=7&Q,Q-=7&Q,S.mode=27;break}for(;Q<3;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}switch(S.last=1&y,y>>>=1,Q-=1,3&y){case 0:S.mode=14;break;case 1:if(K(S),S.mode=20,q===C){y>>>=2,Q-=2;break t}break;case 2:S.mode=17;break;case 3:t.msg="invalid block type",S.mode=M}y>>>=2,Q-=2;break;case 14:for(y>>>=7&Q,Q-=7&Q;Q<32;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if((65535&y)!==(y>>>16^65535)){t.msg="invalid stored block lengths",S.mode=M;break}if(S.length=65535&y,y=0,Q=0,S.mode=15,q===C)break t;case 15:S.mode=16;case 16:if(n=S.length,n){if(n>H&&(n=H),n>j&&(n=j),0===n)break t;V.set(k.subarray(J,J+n),U),H-=n,J+=n,j-=n,U+=n,S.length-=n;break}S.mode=v;break;case 17:for(;Q<14;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(S.nlen=257+(31&y),y>>>=5,Q-=5,S.ndist=1+(31&y),y>>>=5,Q-=5,S.ncode=4+(15&y),y>>>=4,Q-=4,S.nlen>286||S.ndist>30){t.msg="too many length or distance symbols",S.mode=M;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;Q<3;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}S.lens[P[S.have++]]=7&y,y>>>=3,Q-=3}for(;S.have<19;)S.lens[P[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,E={bits:S.lenbits},N=L(0,S.lens,0,19,S.lencode,0,S.work,E),S.lenbits=E.bits,N){t.msg="invalid code lengths set",S.mode=M;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;T=S.lencode[y&(1<<S.lenbits)-1],f=T>>>24,D=T>>>16&255,m=65535&T,!(f<=Q);){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(m<16)y>>>=f,Q-=f,S.lens[S.have++]=m;else{if(16===m){for(p=f+2;Q<p;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(y>>>=f,Q-=f,0===S.have){t.msg="invalid bit length repeat",S.mode=M;break}g=S.lens[S.have-1],n=3+(3&y),y>>>=2,Q-=2}else if(17===m){for(p=f+3;Q<p;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}y>>>=f,Q-=f,g=0,n=3+(7&y),y>>>=3,Q-=3}else{for(p=f+7;Q<p;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}y>>>=f,Q-=f,g=0,n=11+(127&y),y>>>=7,Q-=7}if(S.have+n>S.nlen+S.ndist){t.msg="invalid bit length repeat",S.mode=M;break}for(;n--;)S.lens[S.have++]=g}}if(S.mode===M)break;if(0===S.lens[256]){t.msg="invalid code -- missing end-of-block",S.mode=M;break}if(S.lenbits=9,E={bits:S.lenbits},N=L(1,S.lens,0,S.nlen,S.lencode,0,S.work,E),S.lenbits=E.bits,N){t.msg="invalid literal/lengths set",S.mode=M;break}if(S.distbits=6,S.distcode=S.distdyn,E={bits:S.distbits},N=L(2,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,E),S.distbits=E.bits,N){t.msg="invalid distances set",S.mode=M;break}if(S.mode=20,q===C)break t;case 20:S.mode=21;case 21:if(H>=6&&j>=258){t.next_out=U,t.avail_out=j,t.next_in=J,t.avail_in=H,S.hold=y,S.bits=Q,z(t,Y),U=t.next_out,V=t.output,j=t.avail_out,J=t.next_in,k=t.input,H=t.avail_in,y=S.hold,Q=S.bits,S.mode===v&&(S.back=-1);break}for(S.back=0;T=S.lencode[y&(1<<S.lenbits)-1],f=T>>>24,D=T>>>16&255,m=65535&T,!(f<=Q);){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(D&&0===(240&D)){for(A=f,c=D,s=m;T=S.lencode[s+((y&(1<<A+c)-1)>>A)],f=T>>>24,D=T>>>16&255,m=65535&T,!(A+f<=Q);){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}y>>>=A,Q-=A,S.back+=A}if(y>>>=f,Q-=f,S.back+=f,S.length=m,0===D){S.mode=26;break}if(32&D){S.back=-1,S.mode=v;break}if(64&D){t.msg="invalid literal/length code",S.mode=M;break}S.extra=15&D,S.mode=22;case 22:if(S.extra){for(p=S.extra;Q<p;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}S.length+=y&(1<<S.extra)-1,y>>>=S.extra,Q-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;T=S.distcode[y&(1<<S.distbits)-1],f=T>>>24,D=T>>>16&255,m=65535&T,!(f<=Q);){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(0===(240&D)){for(A=f,c=D,s=m;T=S.distcode[s+((y&(1<<A+c)-1)>>A)],f=T>>>24,D=T>>>16&255,m=65535&T,!(A+f<=Q);){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}y>>>=A,Q-=A,S.back+=A}if(y>>>=f,Q-=f,S.back+=f,64&D){t.msg="invalid distance code",S.mode=M;break}S.offset=m,S.extra=15&D,S.mode=24;case 24:if(S.extra){for(p=S.extra;Q<p;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}S.offset+=y&(1<<S.extra)-1,y>>>=S.extra,Q-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){t.msg="invalid distance too far back",S.mode=M;break}S.mode=25;case 25:if(0===j)break t;if(n=Y-j,S.offset>n){if(n=S.offset-n,n>S.whave&&S.sane){t.msg="invalid distance too far back",S.mode=M;break}n>S.wnext?(n-=S.wnext,u=S.wsize-n):u=S.wnext-n,n>S.length&&(n=S.length),W=S.window}else W=V,u=U-S.offset,n=S.length;n>j&&(n=j),j-=n,S.length-=n;do{V[U++]=W[u++]}while(--n);0===S.length&&(S.mode=21);break;case 26:if(0===j)break t;V[U++]=S.length,j--,S.mode=21;break;case 27:if(S.wrap){for(;Q<32;){if(0===H)break t;H--,y|=k[J++]<<Q,Q+=8}if(Y-=j,t.total_out+=Y,S.total+=Y,Y&&(t.adler=S.check=S.flags?B(S.check,V,Y,U-Y):o(S.check,V,Y,U-Y)),Y=j,(S.flags?y:x(y))!==S.check){t.msg="incorrect data check",S.mode=M;break}y=0,Q=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;Q<32;){if(0===H)break t;H--,y+=k[J++]<<Q,Q+=8}if(y!==(4294967295&S.total)){t.msg="incorrect length check",S.mode=M;break}y=0,Q=0}S.mode=29;case 29:N=b;break t;case M:N=h;break t;case 31:return l;default:return i}return t.next_out=U,t.avail_out=j,t.next_in=J,t.avail_in=H,S.hold=y,S.bits=Q,(S.wsize||Y!==t.avail_out&&S.mode<M&&(S.mode<27||q!==r))&&X(t,t.output,t.next_out,Y-t.avail_out)?(S.mode=31,l):(G-=t.avail_in,Y-=t.avail_out,t.total_in+=G,t.total_out+=Y,S.total+=Y,S.wrap&&Y&&(t.adler=S.check=S.flags?B(S.check,V,Y,t.next_out-Y):o(S.check,V,Y,t.next_out-Y)),t.data_type=S.bits+(S.last?64:0)+(S.mode===v?128:0)+(20===S.mode||15===S.mode?256:0),(0===G&&0===Y||q===r)&&N===Z&&(N=I),N)},t.exports.inflateEnd=t=>{if(!t||!t.state)return i;let q=t.state;return q.window&&(q.window=null),t.state=null,Z},t.exports.inflateGetHeader=(t,q)=>{if(!t||!t.state)return i;const S=t.state;return 0===(2&S.wrap)?i:(S.head=q,q.done=!1,Z)},t.exports.inflateSetDictionary=(t,q)=>{const S=q.length;let B,z,L;return t&&t.state?(B=t.state,0!==B.wrap&&11!==B.mode?i:11===B.mode&&(z=1,z=o(z,q,S,0),z!==B.check)?h:(L=X(t,q,S,S),L?(B.mode=31,l):(B.havedict=1,Z))):i},t.exports.inflateInfo="pako inflate (from Nodeca project)"},12431:t=>{"use strict";const q=15,S=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),o=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),B=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(t,L,r,e,C,Z,b,O)=>{const i=O.bits;let h,l,I,a,v,M,x=0,k=0,V=0,J=0,U=0,H=0,j=0,y=0,Q=0,K=0,X=null,G=0;const Y=new Uint16Array(16),n=new Uint16Array(16);let u,W,f,D=null,m=0;for(x=0;x<=q;x++)Y[x]=0;for(k=0;k<e;k++)Y[L[r+k]]++;for(U=i,J=q;J>=1&&0===Y[J];J--);if(U>J&&(U=J),0===J)return C[Z++]=20971520,C[Z++]=20971520,O.bits=1,0;for(V=1;V<J&&0===Y[V];V++);for(U<V&&(U=V),y=1,x=1;x<=q;x++)if(y<<=1,y-=Y[x],y<0)return-1;if(y>0&&(0===t||1!==J))return-1;for(n[1]=0,x=1;x<q;x++)n[x+1]=n[x]+Y[x];for(k=0;k<e;k++)0!==L[r+k]&&(b[n[L[r+k]]++]=k);if(0===t?(X=D=b,M=19):1===t?(X=S,G-=257,D=o,m-=257,M=256):(X=B,D=z,M=-1),K=0,k=0,x=V,v=Z,H=U,j=0,I=-1,Q=1<<U,a=Q-1,1===t&&Q>852||2===t&&Q>592)return 1;for(;;){u=x-j,b[k]<M?(W=0,f=b[k]):b[k]>M?(W=D[m+b[k]],f=X[G+b[k]]):(W=96,f=0),h=1<<x-j,l=1<<H,V=l;do{l-=h,C[v+(K>>j)+l]=u<<24|W<<16|f}while(0!==l);for(h=1<<x-1;K&h;)h>>=1;if(0!==h?(K&=h-1,K+=h):K=0,k++,0===--Y[x]){if(x===J)break;x=L[r+b[k]]}if(x>U&&(K&a)!==I){for(0===j&&(j=U),v+=V,H=x-j,y=1<<H;H+j<J&&(y-=Y[H+j],!(y<=0));)H++,y<<=1;if(Q+=1<<H,1===t&&Q>852||2===t&&Q>592)return 1;I=K&a,C[I]=U<<24|H<<16|v-Z}}return 0!==K&&(C[v+K]=x-j<<24|64<<16),O.bits=U,0}},12383:t=>{"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12371:t=>{"use strict";function q(t){let q=t.length;for(;--q>=0;)t[q]=0}const S=256,o=286,B=30,z=15,L=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),r=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z=new Array(576);q(Z);const b=new Array(60);q(b);const O=new Array(512);q(O);const i=new Array(256);q(i);const h=new Array(29);q(h);const l=new Array(B);function I(t,q,S,o,B){this.static_tree=t,this.extra_bits=q,this.extra_base=S,this.elems=o,this.max_length=B,this.has_stree=t&&t.length}let a,v,M;function x(t,q){this.dyn_tree=t,this.max_code=0,this.stat_desc=q}q(l);const k=t=>t<256?O[t]:O[256+(t>>>7)],V=(t,q)=>{t.pending_buf[t.pending++]=255&q,t.pending_buf[t.pending++]=q>>>8&255},J=(t,q,S)=>{t.bi_valid>16-S?(t.bi_buf|=q<<t.bi_valid&65535,V(t,t.bi_buf),t.bi_buf=q>>16-t.bi_valid,t.bi_valid+=S-16):(t.bi_buf|=q<<t.bi_valid&65535,t.bi_valid+=S)},U=(t,q,S)=>{J(t,S[2*q],S[2*q+1])},H=(t,q)=>{let S=0;do{S|=1&t,t>>>=1,S<<=1}while(--q>0);return S>>>1},j=(t,q,S)=>{const o=new Array(16);let B,L,r=0;for(B=1;B<=z;B++)o[B]=r=r+S[B-1]<<1;for(L=0;L<=q;L++){let q=t[2*L+1];0!==q&&(t[2*L]=H(o[q]++,q))}},y=t=>{let q;for(q=0;q<o;q++)t.dyn_ltree[2*q]=0;for(q=0;q<B;q++)t.dyn_dtree[2*q]=0;for(q=0;q<19;q++)t.bl_tree[2*q]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},Q=t=>{t.bi_valid>8?V(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},K=(t,q,S,o)=>{const B=2*q,z=2*S;return t[B]<t[z]||t[B]===t[z]&&o[q]<=o[S]},X=(t,q,S)=>{const o=t.heap[S];let B=S<<1;for(;B<=t.heap_len&&(B<t.heap_len&&K(q,t.heap[B+1],t.heap[B],t.depth)&&B++,!K(q,o,t.heap[B],t.depth));)t.heap[S]=t.heap[B],S=B,B<<=1;t.heap[S]=o},G=(t,q,o)=>{let B,z,e,C,Z=0;if(0!==t.last_lit)do{B=t.pending_buf[t.d_buf+2*Z]<<8|t.pending_buf[t.d_buf+2*Z+1],z=t.pending_buf[t.l_buf+Z],Z++,0===B?U(t,z,q):(e=i[z],U(t,e+S+1,q),C=L[e],0!==C&&(z-=h[e],J(t,z,C)),B--,e=k(B),U(t,e,o),C=r[e],0!==C&&(B-=l[e],J(t,B,C)))}while(Z<t.last_lit);U(t,256,q)},Y=(t,q)=>{const S=q.dyn_tree,o=q.stat_desc.static_tree,B=q.stat_desc.has_stree,L=q.stat_desc.elems;let r,e,C,Z=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<L;r++)0!==S[2*r]?(t.heap[++t.heap_len]=Z=r,t.depth[r]=0):S[2*r+1]=0;for(;t.heap_len<2;)C=t.heap[++t.heap_len]=Z<2?++Z:0,S[2*C]=1,t.depth[C]=0,t.opt_len--,B&&(t.static_len-=o[2*C+1]);for(q.max_code=Z,r=t.heap_len>>1;r>=1;r--)X(t,S,r);C=L;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],X(t,S,1),e=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=e,S[2*C]=S[2*r]+S[2*e],t.depth[C]=(t.depth[r]>=t.depth[e]?t.depth[r]:t.depth[e])+1,S[2*r+1]=S[2*e+1]=C,t.heap[1]=C++,X(t,S,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,q)=>{const S=q.dyn_tree,o=q.max_code,B=q.stat_desc.static_tree,L=q.stat_desc.has_stree,r=q.stat_desc.extra_bits,e=q.stat_desc.extra_base,C=q.stat_desc.max_length;let Z,b,O,i,h,l,I=0;for(i=0;i<=z;i++)t.bl_count[i]=0;for(S[2*t.heap[t.heap_max]+1]=0,Z=t.heap_max+1;Z<573;Z++)b=t.heap[Z],i=S[2*S[2*b+1]+1]+1,i>C&&(i=C,I++),S[2*b+1]=i,b>o||(t.bl_count[i]++,h=0,b>=e&&(h=r[b-e]),l=S[2*b],t.opt_len+=l*(i+h),L&&(t.static_len+=l*(B[2*b+1]+h)));if(0!==I){do{for(i=C-1;0===t.bl_count[i];)i--;t.bl_count[i]--,t.bl_count[i+1]+=2,t.bl_count[C]--,I-=2}while(I>0);for(i=C;0!==i;i--)for(b=t.bl_count[i];0!==b;)O=t.heap[--Z],O>o||(S[2*O+1]!==i&&(t.opt_len+=(i-S[2*O+1])*S[2*O],S[2*O+1]=i),b--)}})(t,q),j(S,Z,t.bl_count)},n=(t,q,S)=>{let o,B,z=-1,L=q[1],r=0,e=7,C=4;for(0===L&&(e=138,C=3),q[2*(S+1)+1]=65535,o=0;o<=S;o++)B=L,L=q[2*(o+1)+1],++r<e&&B===L||(r<C?t.bl_tree[2*B]+=r:0!==B?(B!==z&&t.bl_tree[2*B]++,t.bl_tree[32]++):r<=10?t.bl_tree[34]++:t.bl_tree[36]++,r=0,z=B,0===L?(e=138,C=3):B===L?(e=6,C=3):(e=7,C=4))},u=(t,q,S)=>{let o,B,z=-1,L=q[1],r=0,e=7,C=4;for(0===L&&(e=138,C=3),o=0;o<=S;o++)if(B=L,L=q[2*(o+1)+1],!(++r<e&&B===L)){if(r<C)do{U(t,B,t.bl_tree)}while(0!==--r);else 0!==B?(B!==z&&(U(t,B,t.bl_tree),r--),U(t,16,t.bl_tree),J(t,r-3,2)):r<=10?(U(t,17,t.bl_tree),J(t,r-3,3)):(U(t,18,t.bl_tree),J(t,r-11,7));r=0,z=B,0===L?(e=138,C=3):B===L?(e=6,C=3):(e=7,C=4)}};let W=!1;const f=(t,q,S,o)=>{J(t,0+(o?1:0),3),((t,q,S,o)=>{Q(t),o&&(V(t,S),V(t,~S)),t.pending_buf.set(t.window.subarray(q,q+S),t.pending),t.pending+=S})(t,q,S,!0)};t.exports._tr_init=t=>{W||((()=>{let t,q,S,C,x;const k=new Array(16);for(S=0,C=0;C<28;C++)for(h[C]=S,t=0;t<1<<L[C];t++)i[S++]=C;for(i[S-1]=C,x=0,C=0;C<16;C++)for(l[C]=x,t=0;t<1<<r[C];t++)O[x++]=C;for(x>>=7;C<B;C++)for(l[C]=x<<7,t=0;t<1<<r[C]-7;t++)O[256+x++]=C;for(q=0;q<=z;q++)k[q]=0;for(t=0;t<=143;)Z[2*t+1]=8,t++,k[8]++;for(;t<=255;)Z[2*t+1]=9,t++,k[9]++;for(;t<=279;)Z[2*t+1]=7,t++,k[7]++;for(;t<=287;)Z[2*t+1]=8,t++,k[8]++;for(j(Z,287,k),t=0;t<B;t++)b[2*t+1]=5,b[2*t]=H(t,5);a=new I(Z,L,257,o,z),v=new I(b,r,0,B,z),M=new I(new Array(0),e,0,19,7)})(),W=!0),t.l_desc=new x(t.dyn_ltree,a),t.d_desc=new x(t.dyn_dtree,v),t.bl_desc=new x(t.bl_tree,M),t.bi_buf=0,t.bi_valid=0,y(t)},t.exports._tr_stored_block=f,t.exports._tr_flush_block=(t,q,o,B)=>{let z,L,r=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let q,o=4093624447;for(q=0;q<=31;q++,o>>>=1)if(1&o&&0!==t.dyn_ltree[2*q])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(q=32;q<S;q++)if(0!==t.dyn_ltree[2*q])return 1;return 0})(t)),Y(t,t.l_desc),Y(t,t.d_desc),r=(t=>{let q;for(n(t,t.dyn_ltree,t.l_desc.max_code),n(t,t.dyn_dtree,t.d_desc.max_code),Y(t,t.bl_desc),q=18;q>=3&&0===t.bl_tree[2*C[q]+1];q--);return t.opt_len+=3*(q+1)+5+5+4,q})(t),z=t.opt_len+3+7>>>3,L=t.static_len+3+7>>>3,L<=z&&(z=L)):z=L=o+5,o+4<=z&&-1!==q?f(t,q,o,B):4===t.strategy||L===z?(J(t,2+(B?1:0),3),G(t,Z,b)):(J(t,4+(B?1:0),3),((t,q,S,o)=>{let B;for(J(t,q-257,5),J(t,S-1,5),J(t,o-4,4),B=0;B<o;B++)J(t,t.bl_tree[2*C[B]+1],3);u(t,t.dyn_ltree,q-1),u(t,t.dyn_dtree,S-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),G(t,t.dyn_ltree,t.dyn_dtree)),y(t),B&&Q(t)},t.exports._tr_tally=(t,q,o)=>(t.pending_buf[t.d_buf+2*t.last_lit]=q>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&q,t.pending_buf[t.l_buf+t.last_lit]=255&o,t.last_lit++,0===q?t.dyn_ltree[2*o]++:(t.matches++,q--,t.dyn_ltree[2*(i[o]+S+1)]++,t.dyn_dtree[2*k(q)]++),t.last_lit===t.lit_bufsize-1),t.exports._tr_align=t=>{J(t,2,3),U(t,256,Z),(t=>{16===t.bi_valid?(V(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},12408:t=>{"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12293:t=>{function q(t,q,S){for(var o=t.length,B=-1/0,z=1/0,L=0;L<o;L++){var r=(S[0][L]-t[L])/q[L],e=(S[1][L]-t[L])/q[L];if(r>e){var C=r;r=e,e=C}if(e<B||r>z)return 1/0;r>B&&(B=r),e<z&&(z=e)}return B>z?1/0:B}t.exports=function(t,S,o,B){var z=q(S,o,B);if(z===1/0)t=null;else{t=t||[];for(var L=0;L<S.length;L++)t[L]=S[L]+o[L]*z}return t},t.exports.distance=q},13203:(t,q,S)=>{"use strict";S.d(q,{b:()=>L});var o=S(23);const B=o.useLayoutEffect;const z=function(t){var q=(0,o.useRef)(t);return B((function(){q.current=t})),q};var L=function(t){var q=z(t);(0,o.yb)((function(){var t=function(t){var S;if(null!=q.current&&(S=q.current(t)),t.defaultPrevented&&(t.returnValue=""),"string"===typeof S)return t.returnValue=S,S};return window.addEventListener("beforeunload",t),function(){window.removeEventListener("beforeunload",t)}}),[])}},13162:(t,q,S)=>{"use strict";var o=S(13169),B=Array.prototype.concat,z=Array.prototype.slice,L=t.exports=function(t){for(var q=[],S=0,L=t.length;S<L;S++){var r=t[S];o(r)?q=B.call(q,z.call(r)):q.push(r)}return q};L.wrap=function(t){return function(){return t(L(arguments))}}},13169:t=>{t.exports=function(t){return!(!t||"string"===typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))}},12319:(t,q,S)=>{var o=S(12321);function B(t){for(var q,S,B=0,z=t.length,L=0;L<t.length;){for(q=t[L],S=0;L<z&&t[L]===q;)++L,++S;B+=o.log2(S)/7|0,B+=o.log2(q>>>0)/7|0,B+=2}return B}q.size=B,q.encode=function(t,q){q||(q=new Uint8Array(B(t)));for(var S,o,z=0,L=q.length,r=0;r<t.length;){for(S=t[r],o=0;r<t.length&&t[r]===S;)++r,++o;for(;z<L&&o>=128;)q[z++]=128+(127&o),o>>>=7;if(z>=L)throw new Error("RLE buffer overflow");for(q[z++]=o,S>>>=0;z<L&&S>=128;)q[z++]=128+(127&S),S>>>=7;if(z>=L)throw new Error("RLE buffer overflow");q[z++]=S}return q},q.decode=function(t,q){for(var S,o,B,z,L=q.length,r=t.length,e=0,C=0;C<r;){for(S=0,o=0;C<r&&t[C]>=128;)S+=(127&t[C++])<<o,o+=7;if(S+=t[C++]<<o,C>=r)throw new Error("RLE buffer underrun");if(e+S>L)throw new Error("Chunk buffer overflow");for(B=0,o=0;C<r&&t[C]>=128;)B+=(127&t[C++])<<o,o+=7;if(C>=r)throw new Error("RLE buffer underrun");for(B+=t[C++]<<o,z=0;z<S;++z)q[e++]=B}return q}},12321:(t,q)=>{"use strict";function S(t){var q=32;return(t&=-t)&&q--,65535&t&&(q-=16),16711935&t&&(q-=8),252645135&t&&(q-=4),858993459&t&&(q-=2),1431655765&t&&(q-=1),q}q.INT_BITS=32,q.INT_MAX=2147483647,q.INT_MIN=-1<<31,q.sign=function(t){return(t>0)-(t<0)},q.abs=function(t){var q=t>>31;return(t^q)-q},q.min=function(t,q){return q^(t^q)&-(t<q)},q.max=function(t,q){return t^(t^q)&-(t<q)},q.isPow2=function(t){return!(t&t-1)&&!!t},q.log2=function(t){var q,S;return q=(t>65535)<<4,q|=S=((t>>>=q)>255)<<3,q|=S=((t>>>=S)>15)<<2,(q|=S=((t>>>=S)>3)<<1)|(t>>>=S)>>1},q.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},q.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},q.countTrailingZeros=S,q.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},q.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},q.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var o=new Array(256);!function(t){for(var q=0;q<256;++q){var S=q,o=q,B=7;for(S>>>=1;S;S>>>=1)o<<=1,o|=1&S,--B;t[q]=o<<B&255}}(o),q.reverse=function(t){return o[255&t]<<24|o[t>>>8&255]<<16|o[t>>>16&255]<<8|o[t>>>24&255]},q.interleave2=function(t,q){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))<<1},q.deinterleave2=function(t,q){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>q&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},q.interleave3=function(t,q,S){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<1)|(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<2},q.deinterleave3=function(t,q){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>q&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},q.nextCombination=function(t){var q=t|t-1;return q+1|(~q&-~q)-1>>>S(t)+1}},12349:t=>{"use strict";t.exports=function(t,q,S,o){var B=self||window;try{try{var z;try{z=new B.Blob([t])}catch(C){(z=new(B.BlobBuilder||B.WebKitBlobBuilder||B.MozBlobBuilder||B.MSBlobBuilder)).append(t),z=z.getBlob()}var L=B.URL||B.webkitURL,r=L.createObjectURL(z),e=new B[q](r,S);return L.revokeObjectURL(r),e}catch(C){return new B[q]("data:application/javascript,".concat(encodeURIComponent(t)),S)}}catch(C){if(!o)throw Error("Inline worker is not supported");return new B[q](o,S)}}},12278:(t,q,S)=>{"use strict";function o(t,q,S,o,B){var z={};return Object.keys(o).forEach((function(t){z[t]=o[t]})),z.enumerable=!!z.enumerable,z.configurable=!!z.configurable,("value"in z||z.initializer)&&(z.writable=!0),z=S.slice().reverse().reduce((function(S,o){return o(t,q,S)||S}),z),B&&void 0!==z.initializer&&(z.value=z.initializer?z.initializer.call(B):void 0,z.initializer=void 0),void 0===z.initializer&&(Object.defineProperty(t,q,z),z=null),z}S.d(q,{e:()=>o})},12274:(t,q,S)=>{"use strict";function o(t,q,S,o){S&&Object.defineProperty(t,q,{enumerable:S.enumerable,configurable:S.configurable,writable:S.writable,value:S.initializer?S.initializer.call(o):void 0})}S.d(q,{d:()=>o})},13198:(t,q,S)=>{"use strict";S.d(q,{d:()=>L,e:()=>b,h:()=>r,j:()=>z,m:()=>e,n:()=>B,q:()=>C,s:()=>Z});var o=S(2280);class B{constructor(){this._easingMode=B.EASINGMODE_EASEIN}setEasingMode(t){const q=Math.min(Math.max(t,0),2);this._easingMode=q}getEasingMode(){return this._easingMode}easeInCore(t){throw new Error("You must implement this method")}ease(t){switch(this._easingMode){case B.EASINGMODE_EASEIN:return this.easeInCore(t);case B.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}B.EASINGMODE_EASEIN=0,B.EASINGMODE_EASEOUT=1,B.EASINGMODE_EASEINOUT=2;class z extends B{easeInCore(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)}}class L extends B{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=t}easeInCore(t){const q=Math.max(0,this.amplitude);return Math.pow(t,3)-t*q*Math.sin(3.141592653589793*t)}}class r extends B{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=t,this.bounciness=q}easeInCore(t){const q=Math.max(0,this.bounces);let S=this.bounciness;S<=1&&(S=1.001);const o=Math.pow(S,q),B=1-S,z=(1-o)/B+.5*o,L=t*z,r=Math.log(-L*(1-S)+1)/Math.log(S),e=Math.floor(r),C=e+1,Z=(1-Math.pow(S,e))/(B*z),b=.5*(Z+(1-Math.pow(S,C))/(B*z)),O=t-b,i=b-Z;return-Math.pow(1/S,q-e)/(i*i)*(O-i)*(O+i)}}class e extends B{easeInCore(t){return t*t*t}}class C extends B{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=t,this.springiness=q}easeInCore(t){let q;const S=Math.max(0,this.oscillations),o=Math.max(0,this.springiness);return q=0==o?t:(Math.exp(o*t)-1)/(Math.exp(o)-1),q*Math.sin((6.283185307179586*S+1.5707963267948966)*t)}}class Z extends B{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=t}easeInCore(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)}}class b extends B{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=t,this.y1=q,this.x2=S,this.y2=o}easeInCore(t){return o.b.Interpolate(t,this.x1,this.y1,this.x2,this.y2)}}},12869:(t,q,S)=>{"use strict";S.d(q,{c:()=>L});var o=S(678),B=S(686),z=S(698);class L extends z.e{get _matrix(){return this._compose(),this.hj}set _matrix(t){(t.updateFlag!==this.hj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.hj.p(t),this._markAsDirtyAndDecompose())}constructor(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(t,q.va(),!1),this.name=t,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=q,this.hj=(null===B||void 0===B?void 0:B.clone())??o.e.Identity(),this._restMatrix=z??this.hj.clone(),this._bindMatrix=L??this.hj.clone(),this._index=r,this._absoluteMatrix=new o.e,this._absoluteBindMatrix=new o.e,this._absoluteInverseBindMatrix=new o.e,this._finalMatrix=new o.e,q.bones.push(this),this.setParent(S,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(t){this.setParent(t)}setParent(t){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==t){if(this.parent){const t=this.parent.children.indexOf(this);-1!==t&&this.parent.children.splice(t,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),q&&this._updateAbsoluteBindMatrices(),this.Vi()}}getLocalMatrix(){return this._compose(),this.hj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(t){this._restMatrix.p(t)}setRestPose(t){this.setRestMatrix(t)}getBindPose(){return this.getBindMatrix()}setBindMatrix(t){this.ej(t)}setBindPose(t){this.setBindMatrix(t)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const t=o.j.wi[0],q=o.j.Quaternion[0],S=o.j.wi[1];this.getRestMatrix().decompose(t,q,S),this._linkedTransformNode.position.p(S),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??o.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(q),this._linkedTransformNode.oi.p(t)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Ig}set position(t){this._decompose(),this.Ig.p(t),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(t){this.setRotation(t)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(t){this.setRotationQuaternion(t)}get oi(){return this.getScale()}set oi(t){this.setScale(t)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.o.Zero(),this._localRotation=o.g.Zero(),this.Ig=o.o.Zero()),this.hj.decompose(this._localScaling,this._localRotation,this.Ig))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,o.e.ComposeToRef(this._localScaling,this._localRotation,this.Ig,this.hj)):this._needToCompose=!1)}ej(t){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(t),q&&this._updateAbsoluteBindMatrices(),S?this._matrix=t:this.Vi()}_updateAbsoluteBindMatrices(t){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t||(t=this._bindMatrix),this.parent?t.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(t),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),q)for(let S=0;S<this.children.length;S++)this.children[S]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Vi(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Vi(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Vi(),this._needToDecompose=!0}_updatePosition(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=this.getLocalMatrix();if(0==q)B?(z.addAtIndex(12,t.x),z.addAtIndex(13,t.y),z.addAtIndex(14,t.z)):z.setTranslationFromFloats(t.x,t.y,t.z);else{let q=null;S&&(q=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const r=L._TmpMats[0],e=L._TmpVecs[0];this.parent?S&&q?(r.p(this.parent.getAbsoluteMatrix()),r.multiplyToRef(q,r)):r.p(this.parent.getAbsoluteMatrix()):o.e.IdentityToRef(r),B&&r.setTranslationFromFloats(0,0,0),r.invert(),o.o.TransformCoordinatesToRef(t,r,e),B?(z.addAtIndex(12,e.x),z.addAtIndex(13,e.y),z.addAtIndex(14,e.z)):z.setTranslationFromFloats(e.x,e.y,e.z)}this._markAsDirtyAndDecompose()}translate(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,q,S,!0)}setPosition(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,q,S,!1)}setAbsolutePosition(t,q){this.setPosition(t,1,q)}scale(t,q,S){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=this.getLocalMatrix(),r=L._TmpMats[0];o.e.ScalingToRef(t,q,S,r),r.multiplyToRef(z,z),r.invert();for(const o of this.children){const B=o.getLocalMatrix();B.multiplyToRef(r,B),B.multiplyAtIndex(12,t),B.multiplyAtIndex(13,q),B.multiplyAtIndex(14,S),o._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),B)for(const o of this.children)o.scale(t,q,S,B)}setScale(t){this._decompose(),this._localScaling.p(t),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(t){this._decompose(),t.p(this._localScaling)}setYawPitchRoll(t,q,S){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4?arguments[4]:void 0;if(0===B){const r=L._TmpQuat;return o.g.RotationYawPitchRollToRef(t,q,S,r),void this.setRotationQuaternion(r,B,z)}const r=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,z))return;const e=L._TmpMats[1];o.e.RotationYawPitchRollToRef(t,q,S,e),r.multiplyToRef(e,e),this._rotateWithMatrix(e,B,z)}rotate(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;const z=L._TmpMats[0];z.setTranslationFromFloats(0,0,0),o.e.RotationAxisToRef(t,q,z),this._rotateWithMatrix(z,S,B)}setAxisAngle(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;if(0===S){const z=L._TmpQuat;return o.g.RotationAxisToRef(t,q,z),void this.setRotationQuaternion(z,S,B)}const z=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,B))return;const r=L._TmpMats[1];o.e.RotationAxisToRef(t,q,r),z.multiplyToRef(r,r),this._rotateWithMatrix(r,S,B)}setRotation(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(t.y,t.x,t.z,q,S)}setRotationQuaternion(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;if(0===q)return this._decompose(),this._localRotation.p(t),void this._markAsDirtyAndCompose();const B=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,S))return;const z=L._TmpMats[1];o.e.FromQuaternionToRef(t,z),B.multiplyToRef(z,z),this._rotateWithMatrix(z,q,S)}setRotationMatrix(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;if(0===q){const B=L._TmpQuat;return o.g.FromRotationMatrixToRef(t,B),void this.setRotationQuaternion(B,q,S)}const B=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,S))return;const z=L._TmpMats[1];z.p(t),B.multiplyToRef(t,z),this._rotateWithMatrix(z,q,S)}_rotateWithMatrix(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;const o=this.getLocalMatrix(),B=o.m[12],z=o.m[13],r=o.m[14],e=this.getParent(),C=L._TmpMats[3],Z=L._TmpMats[4];e&&1==q?(S?(C.p(S.getWorldMatrix()),e.getAbsoluteMatrix().multiplyToRef(C,C)):C.p(e.getAbsoluteMatrix()),Z.p(C),Z.invert(),o.multiplyToRef(C,o),o.multiplyToRef(t,o),o.multiplyToRef(Z,o)):1==q&&S?(C.p(S.getWorldMatrix()),Z.p(C),Z.invert(),o.multiplyToRef(C,o),o.multiplyToRef(t,o),o.multiplyToRef(Z,o)):o.multiplyToRef(t,o),o.setTranslationFromFloats(B,z,r),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(t,q){const S=L._TmpMats[2];return t.p(this.getAbsoluteMatrix()),q?(t.multiplyToRef(q.getWorldMatrix(),t),o.e.ScalingToRef(q.oi.x,q.oi.y,q.oi.z,S)):o.e.IdentityToRef(S),t.invert(),!isNaN(t.m[0])&&(S.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(S,t),!0)}Se(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=o.o.Zero();return this.getPositionToRef(t,q,S),S}getPositionToRef(){let t=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const t=this.getLocalMatrix();q.x=t.m[12],q.y=t.m[13],q.z=t.m[14]}else{let S=null;t&&(S=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let o=L._TmpMats[0];t&&S?(o.p(this.getAbsoluteMatrix()),o.multiplyToRef(S,o)):o=this.getAbsoluteMatrix(),q.x=o.m[12],q.y=o.m[13],q.z=o.m[14]}}getAbsolutePosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=o.o.Zero();return this.getPositionToRef(1,t,q),q}getAbsolutePositionToRef(t,q){this.getPositionToRef(1,t,q)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.hj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.hj);const t=this._skeleton.getPoseMatrix();t&&this._absoluteMatrix.multiplyToRef(t,this._absoluteMatrix)}const t=this.children,q=t.length;for(let S=0;S<q;S++)t[S].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Wi(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=o.o.Zero();return this.getDirectionToRef(t,q,S),S}getDirectionToRef(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0,B=null;q&&(B=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=L._TmpMats[0];z.p(this.getAbsoluteMatrix()),q&&B&&z.multiplyToRef(B,z),o.o.TransformNormalToRef(t,z,S),S.normalize()}getRotation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=o.o.Zero();return this.getRotationToRef(t,q,S),S}getRotationToRef(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0;const o=L._TmpQuat;this.getRotationQuaternionToRef(t,q,o),o.toEulerAnglesToRef(S)}getRotationQuaternion(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=o.g.Identity();return this.getRotationQuaternionToRef(t,q,S),S}getRotationQuaternionToRef(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),q.p(this._localRotation);else{const S=L._TmpMats[0],o=this.getAbsoluteMatrix();t?o.multiplyToRef(t.getWorldMatrix(),S):S.p(o),S.multiplyAtIndex(0,this._scalingDeterminant),S.multiplyAtIndex(1,this._scalingDeterminant),S.multiplyAtIndex(2,this._scalingDeterminant),S.decompose(void 0,q,void 0)}}getRotationMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1?arguments[1]:void 0;const S=o.e.Identity();return this.getRotationMatrixToRef(t,q,S),S}getRotationMatrixToRef(){let t=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(q);else{const S=L._TmpMats[0],o=this.getAbsoluteMatrix();t?o.multiplyToRef(t.getWorldMatrix(),S):S.p(o),S.multiplyAtIndex(0,this._scalingDeterminant),S.multiplyAtIndex(1,this._scalingDeterminant),S.multiplyAtIndex(2,this._scalingDeterminant),S.getRotationMatrixToRef(q)}}getAbsolutePositionFromLocal(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=o.o.Zero();return this.getAbsolutePositionFromLocalToRef(t,q,S),S}getAbsolutePositionFromLocalToRef(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0,B=null;q&&(B=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=L._TmpMats[0];z.p(this.getAbsoluteMatrix()),q&&B&&z.multiplyToRef(B,z),o.o.TransformCoordinatesToRef(t,z,S)}getLocalPositionFromAbsolute(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=o.o.Zero();return this.getLocalPositionFromAbsoluteToRef(t,q,S),S}getLocalPositionFromAbsoluteToRef(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0,B=null;q&&(B=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=L._TmpMats[0];z.p(this.getAbsoluteMatrix()),q&&B&&z.multiplyToRef(B,z),z.invert(),o.o.TransformCoordinatesToRef(t,z,S)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const t=this._skeleton.bones.indexOf(this);if(-1!==t&&this._skeleton.bones.splice(t,1),this._parentNode&&this._parentNode.children){const t=this._parentNode.children,q=t.indexOf(this);-1!==q&&t.splice(q,1)}super.dispose()}}L._TmpVecs=(0,B.c)(2,o.o.Zero),L._TmpQuat=o.g.Identity(),L._TmpMats=(0,B.c)(5,o.e.Identity)},13195:(t,q,S)=>{"use strict";S.d(q,{c:()=>Y});var o=S(653),B=S(658),z=S(485),L=S(678),r=S(689),e=S(698),C=S(483),Z=S(2450),b=S(510),O=S(682);class i{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(t){this._idleRotationSpeed=t}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(t){this._idleRotationWaitTime=t}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(t){this._idleRotationSpinupTime=t}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(t){this._attachedCamera=t;const q=this._attachedCamera.va();this._onPrePointerObservableObserver=q.onPrePointerObservable.add((t=>{t.type!==Z.b.POINTERDOWN?t.type===Z.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const t=b.e.Now;let q=0;null!=this._lastFrameTime&&(q=t-this._lastFrameTime),this._lastFrameTime=t,this._applyUserInteraction();const S=t-this._lastInteractionTime-this._idleRotationWaitTime,o=Math.max(Math.min(S/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*o,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(q/1e3))}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.va();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(t){this._lastInteractionTime=t??b.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<O.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=b.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var h=S(13198),l=S(12019);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(t){if(this._autoTransitionRange===t)return;this._autoTransitionRange=t;const q=this._attachedCamera;q&&(t?this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((t=>{if(t&&(t.Ai(!0),t.getBoundingInfo)){const q=t.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*q,this.upperRadiusTransitionRange=.05*q}})):this._onMeshTargetChangedObserver&&q.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(t){this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(t){return!!this._attachedCamera&&(this._attachedCamera.radius===t&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=l.b.CreateAnimation("radius",l.b.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const q=l.b.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));q&&this._animatables.push(q)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new h.d(.3),I.EasingMode=h.n.EASINGMODE_EASEOUT;class a{constructor(){this.onTargetFramingAnimationEndObservable=new z.b,this._mode=a.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(t){this._mode=t}get mode(){return this._mode}set radiusScale(t){this._radiusScale=t}get radiusScale(){return this._radiusScale}set positionScale(t){this._positionScale=t}get positionScale(){return this._positionScale}set defaultElevation(t){this._defaultElevation=t}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(t){this._elevationReturnTime=t}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(t){this._elevationReturnWaitTime=t}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(t){this._framingTime=t}get framingTime(){return this._framingTime}init(){}attach(t){this._attachedCamera=t;const q=this._attachedCamera.va();a.EasingFunction.setEasingMode(a.EasingMode),this._onPrePointerObservableObserver=q.onPrePointerObservable.add((t=>{t.type!==Z.b.POINTERDOWN?t.type===Z.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((t=>{t&&t.getBoundingInfo&&this.zoomOnMesh(t,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.va();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.Ai(!0);const o=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(o.minimumWorld,o.maximumWorld,q,S)}zoomOnMeshHierarchy(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.Ai(!0);const o=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(o.min,o.max,q,S)}zoomOnMeshesHierarchy(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new L.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new L.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let z=0;z<t.length;z++){const q=t[z].getHierarchyBoundingVectors(!0);L.o.CheckExtends(q.min,o,B),L.o.CheckExtends(q.max,o,B)}this.zoomOnBoundingInfo(o,B,q,S)}zoomOnBoundingInfo(t,q){let S,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const z=t.y,r=z+(q.y-z)*this._positionScale,e=q.Kg(t).scale(.5);if(!isFinite(r))return!1;if(o)S=new L.o(0,r,0);else{const q=t.add(e);S=new L.o(q.x,r,q.z)}this._vectorTransition||(this._vectorTransition=l.b.CreateAnimation("target",l.b.ANIMATIONTYPE_VECTOR3,60,a.EasingFunction)),this._betaIsAnimating=!0;let C=l.b.TransitionTo("target",S,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);C&&this._animatables.push(C);let Z=0;if(this._mode===a.FitFrustumSidesMode){const S=this._calculateLowerRadiusFromModelBoundingSphere(t,q);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=e.length()+this._attachedCamera.Ci),Z=S}else this._mode===a.IgnoreBoundsSizeMode&&(Z=this._calculateLowerRadiusFromModelBoundingSphere(t,q),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ci));if(this.autoCorrectCameraLimitsAndSensibility){const S=q.Kg(t).length();this._attachedCamera.panningSensibility=5e3/S,this._attachedCamera.wheelPrecision=100/Z}return this._radiusTransition||(this._radiusTransition=l.b.CreateAnimation("radius",l.b.ANIMATIONTYPE_FLOAT,60,a.EasingFunction)),C=l.b.TransitionTo("radius",Z,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),B&&B(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),C&&this._animatables.push(C),!0}_calculateLowerRadiusFromModelBoundingSphere(t,q){const S=this._attachedCamera;if(!S)return 0;let o=S._calculateLowerRadiusFromModelBoundingSphere(t,q,this._radiusScale);return S.lowerRadiusLimit&&this._mode===a.IgnoreBoundsSizeMode&&(o=o<S.lowerRadiusLimit?S.lowerRadiusLimit:o),S.upperRadiusLimit&&(o=o>S.upperRadiusLimit?S.upperRadiusLimit:o),o}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=b.e.Now-this._lastInteractionTime,q=.5*Math.PI-this._defaultElevation,S=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>S&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=l.b.CreateAnimation("beta",l.b.ANIMATIONTYPE_FLOAT,60,a.EasingFunction));const t=l.b.TransitionTo("beta",q,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=b.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}a.EasingFunction=new h.s,a.EasingMode=h.n.EASINGMODE_EASEINOUT,a.IgnoreBoundsSizeMode=0,a.FitFrustumSidesMode=1;var v=S(644),M=S(11936),x=S(12866),k=S(490);class V{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(t){t=k.f.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),S=q.getInputElement();let o=0,B=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=z=>{var L,r;const e=z.event,C="touch"===e.pointerType;if(z.type!==Z.b.POINTERMOVE&&-1===this.buttons.indexOf(e.button))return;const b=e.target;if(this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey,this._buttonsPressed=e.buttons,q.isPointerLock){const t=e.movementX,q=e.movementY;this.onTouch(null,t,q),this._pointA=null,this._pointB=null}else{if(z.type!==Z.b.POINTERDOWN&&z.type!==Z.b.POINTERDOUBLETAP&&C&&(null===(L=this._pointA)||void 0===L?void 0:L.pointerId)!==e.pointerId&&(null===(r=this._pointB)||void 0===r?void 0:r.pointerId)!==e.pointerId)return;if(z.type!==Z.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!C)if(z.type===Z.b.POINTERDOUBLETAP)this.onDoubleTap(e.pointerType);else if(z.type!==Z.b.POINTERUP||this._currentMousePointerIdDown!==e.pointerId&&!C){if(z.type===Z.b.POINTERMOVE)if(t||e.preventDefault(),this._pointA&&null===this._pointB){const t=e.clientX-this._pointA.x,q=e.clientY-this._pointA.y;this._pointA.x=e.clientX,this._pointA.y=e.clientY,this.onTouch(this._pointA,t,q)}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===e.pointerId?this._pointA:this._pointB;t.x=e.clientX,t.y=e.clientY;const q=this._pointA.x-this._pointB.x,S=this._pointA.y-this._pointB.y,L=q*q+S*S,r={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:e.pointerId,type:z.type};this.onMultiTouch(this._pointA,this._pointB,o,L,B,r),B=r,o=L}}else{try{null===b||void 0===b||b.releasePointerCapture(e.pointerId)}catch(O){}C||(this._pointB=null),q._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==e.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==e.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==o||B)&&(this.onMultiTouch(this._pointA,this._pointB,o,0,B,null),o=0,B=null),this._currentMousePointerIdDown=-1,this.onButtonUp(e),t||e.preventDefault()}else{try{null===b||void 0===b||b.setPointerCapture(e.pointerId)}catch(O){}if(null===this._pointA)this._pointA={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType};else{if(null!==this._pointB)return;this._pointB={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType}}-1!==this._currentMousePointerIdDown||C||(this._currentMousePointerIdDown=e.pointerId),this.onButtonDown(e),t||(e.preventDefault(),S&&S.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Z.b.POINTERDOWN|Z.b.POINTERUP|Z.b.POINTERMOVE|Z.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,o=0,B=null,this.onLostFocus()},this._contextMenuBind=t=>this.onContextMenu(t),S&&S.addEventListener("contextmenu",this._contextMenuBind,!1);const z=this.camera.va().getEngine().getHostWindow();z&&k.f.RegisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}Ui(){if(this._onLostFocus){const t=this.camera.va().getEngine().getHostWindow();t&&k.f.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.va().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,q,S){}onMultiTouch(t,q,S,o,B,z){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,o.e)([(0,B.C)()],V.prototype,"buttons",void 0);class J extends V{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,q){if(0!==this.panningSensibility&&t&&q){const S=q.x-t.x,o=q.y-t.y;this.camera.inertialPanningX+=-S/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility}}_computePinchZoom(t,q){const S=this.camera.radius||J.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=S*Math.sqrt(t)/Math.sqrt(q):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(q-t)*S*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(q-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,q,S){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-q/this.panningSensibility,this.camera.inertialPanningY+=S/this.panningSensibility):(this.camera.inertialAlphaOffset-=q/this.angularSensibilityX,this.camera.inertialBetaOffset-=S/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,q,S,o,B,z){0===S&&null===B||0===o&&null===z||(this.multiTouchPanAndZoom?(this._computePinchZoom(S,o),this._computeMultiTouchPanning(B,z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(o)-Math.sqrt(S))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(S,o),this._isPinching=!0):this._computeMultiTouchPanning(B,z)):this.multiTouchPanning?this._computeMultiTouchPanning(B,z):this.pinchZoom&&this._computePinchZoom(S,o))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(t){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}J.MinimumRadiusForPinch=.001,(0,o.e)([(0,B.C)()],J.prototype,"buttons",void 0),(0,o.e)([(0,B.C)()],J.prototype,"angularSensibilityX",void 0),(0,o.e)([(0,B.C)()],J.prototype,"angularSensibilityY",void 0),(0,o.e)([(0,B.C)()],J.prototype,"pinchPrecision",void 0),(0,o.e)([(0,B.C)()],J.prototype,"pinchDeltaPercentage",void 0),(0,o.e)([(0,B.C)()],J.prototype,"useNaturalPinchZoom",void 0),(0,o.e)([(0,B.C)()],J.prototype,"pinchZoom",void 0),(0,o.e)([(0,B.C)()],J.prototype,"panningSensibility",void 0),(0,o.e)([(0,B.C)()],J.prototype,"multiTouchPanning",void 0),(0,o.e)([(0,B.C)()],J.prototype,"multiTouchPanAndZoom",void 0),x.d.ArcRotateCameraPointersInput=J;var U=S(2454);class H{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=k.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const S=q.event;if(!S.metaKey)if(q.type===U.e.KEYDOWN){if(this._ctrlPressed=S.ctrlKey,this._altPressed=S.altKey,-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysReset.indexOf(S.keyCode)){-1===this._keys.indexOf(S.keyCode)&&this._keys.push(S.keyCode),S.preventDefault&&(t||S.preventDefault())}}else if(-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysReset.indexOf(S.keyCode)){const q=this._keys.indexOf(S.keyCode);q>=0&&this._keys.splice(q,1),S.preventDefault&&(t||S.preventDefault())}})))}Ui(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let q=0;q<this._keys.length;q++){const S=this._keys[q];-1!==this.keysLeft.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(S)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,o.e)([(0,B.C)()],H.prototype,"keysUp",void 0),(0,o.e)([(0,B.C)()],H.prototype,"keysDown",void 0),(0,o.e)([(0,B.C)()],H.prototype,"keysLeft",void 0),(0,o.e)([(0,B.C)()],H.prototype,"keysRight",void 0),(0,o.e)([(0,B.C)()],H.prototype,"keysReset",void 0),(0,o.e)([(0,B.C)()],H.prototype,"panningSensibility",void 0),(0,o.e)([(0,B.C)()],H.prototype,"zoomingSensibility",void 0),(0,o.e)([(0,B.C)()],H.prototype,"useAltToZoom",void 0),(0,o.e)([(0,B.C)()],H.prototype,"angularSpeed",void 0),x.d.ArcRotateCameraKeyboardMoveInput=H;var j=S(714),y=S(2460);class Q{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new L.o(0,0,0),this._globalOffset=new L.o(0,0,0),this._inertialPanning=L.o.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,q){let S=0;const o=.01*t*this.wheelDeltaPercentage*q;return S=t>0?o/(1+this.wheelDeltaPercentage):o*(1+this.wheelDeltaPercentage),S}attachControl(t){t=k.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==Z.b.POINTERWHEEL)return;const S=q.event;let o=0;const B=S.deltaMode===y.e.DOM_DELTA_LINE?40:1,z=-S.deltaY*B;if(this.customComputeDeltaFromMouseWheel)o=this.customComputeDeltaFromMouseWheel(z,this,S);else if(this.wheelDeltaPercentage){if(o=this._computeDeltaFromMouseWheelLegacyEvent(z,this.camera.radius),o>0){let t=this.camera.radius,q=this.camera.inertialRadiusOffset+o;for(let S=0;S<20&&!(t<=q)&&!(Math.abs(q*this.camera.inertia)<.001);S++)t-=q,q*=this.camera.inertia;t=(0,r.Clamp)(t,0,Number.MAX_VALUE),o=this._computeDeltaFromMouseWheelLegacyEvent(z,t)}}else o=z/(40*this.wheelPrecision);o&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(o)):this.camera.inertialRadiusOffset+=o),S.preventDefault&&(t||S.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,Z.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ui(0)}Ui(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,q=t.target.Kg(t.position);this._hitPlane=j.c.FromPositionAndNormal(t.target,q)}_getPosition(){const t=this.camera,q=t.va(),S=q.createPickingRay(q.pointerX,q.pointerY,L.e.Identity(),t,!1);0===t.targetScreenOffset.x&&0===t.targetScreenOffset.y||(this._viewOffset.set(t.targetScreenOffset.x,t.targetScreenOffset.y,0),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),this._globalOffset=L.o.TransformNormal(this._viewOffset,t._cameraTransformMatrix),S.origin.addInPlace(this._globalOffset));let o=0;return this._hitPlane&&(o=S.intersectsPlane(this._hitPlane)??0),S.origin.addInPlace(S.direction.scaleInPlace(o))}_zoomToMouse(t){const q=this.camera,S=1-q.inertia;if(q.lowerRadiusLimit){const o=q.lowerRadiusLimit??0;q.radius-(q.inertialRadiusOffset+t)/S<o&&(t=(q.radius-o)*S-q.inertialRadiusOffset)}if(q.upperRadiusLimit){const o=q.upperRadiusLimit??0;q.radius-(q.inertialRadiusOffset+t)/S>o&&(t=(q.radius-o)*S-q.inertialRadiusOffset)}const o=t/S/q.radius,B=this._getPosition(),z=L.j.wi[6];B.subtractToRef(q.target,z),z.scaleInPlace(o),z.scaleInPlace(S),this._inertialPanning.addInPlace(z),q.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<O.d&&(t.x=0),Math.abs(t.y)<O.d&&(t.y=0),Math.abs(t.z)<O.d&&(t.z=0)}}(0,o.e)([(0,B.C)()],Q.prototype,"wheelPrecision",void 0),(0,o.e)([(0,B.C)()],Q.prototype,"zoomToMouseLocation",void 0),(0,o.e)([(0,B.C)()],Q.prototype,"wheelDeltaPercentage",void 0),x.d.ArcRotateCameraMouseWheelInput=Q;class K extends x.h{constructor(t){super(t)}addMouseWheel(){return this.add(new Q),this}addPointers(){return this.add(new J),this}addKeyboard(){return this.add(new H),this}}var X=S(622);function G(t,q){return isNaN(t)?q:t}e.e.AddNodeConstructor("ArcRotateCamera",((t,q)=>()=>new Y(t,0,0,1,L.o.Zero(),q)));class Y extends M.c{get target(){return this._target}set target(t){this.setTarget(t)}get targetHost(){return this._targetHost}set targetHost(t){t&&this.setTarget(t)}getTarget(){return this.target}get position(){return this._position}set position(t){this.setPosition(t)}set upVector(t){this._upToYMatrix||(this._yToUpMatrix=new L.e,this._upToYMatrix=new L.e,this._upVector=L.o.Zero()),t.normalize(),this._upVector.p(t),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){L.e.RotationAlignToRef(L.o.UpReadOnly,this._upVector,this._yToUpMatrix),L.e.RotationAlignToRef(this._upVector,L.o.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set angularSensibilityX(t){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityX=t)}get angularSensibilityY(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set angularSensibilityY(t){const q=this.inputs.attached.pointers;q&&(q.angularSensibilityY=t)}get pinchPrecision(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set pinchPrecision(t){const q=this.inputs.attached.pointers;q&&(q.pinchPrecision=t)}get pinchDeltaPercentage(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set pinchDeltaPercentage(t){const q=this.inputs.attached.pointers;q&&(q.pinchDeltaPercentage=t)}get useNaturalPinchZoom(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set useNaturalPinchZoom(t){const q=this.inputs.attached.pointers;q&&(q.useNaturalPinchZoom=t)}get panningSensibility(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set panningSensibility(t){const q=this.inputs.attached.pointers;q&&(q.panningSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const q=this.inputs.attached.keyboard;q&&(q.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const q=this.inputs.attached.keyboard;q&&(q.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const q=this.inputs.attached.keyboard;q&&(q.keysRight=t)}get wheelPrecision(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set wheelPrecision(t){const q=this.inputs.attached.mousewheel;q&&(q.wheelPrecision=t)}get zoomToMouseLocation(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set zoomToMouseLocation(t){const q=this.inputs.attached.mousewheel;q&&(q.zoomToMouseLocation=t)}get wheelDeltaPercentage(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set wheelDeltaPercentage(t){const q=this.inputs.attached.mousewheel;q&&(q.wheelDeltaPercentage=t)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new a,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new i,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(t,q,S,o,B,r){var e;let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(t,L.o.Zero(),r,C),e=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=L.o.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=L.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new L.e,this.panningAxis=new L.o(1,1,0),this._transformedDirection=new L.o,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new z.b,this.checkCollisions=!1,this.collisionRadius=new L.o(.5,.5,.5),this._previousPosition=L.o.Zero(),this._collisionVelocity=L.o.Zero(),this._newPosition=L.o.Zero(),this._computationVector=L.o.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new L.o(NaN,NaN,NaN),this._goalTargetScreenOffset=new L.l(NaN,NaN),this._onCollisionPositionChange=function(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S?(e.setPosition(q),e.$h&&e.$h(S)):e._previousPosition.p(e._position);const o=Math.cos(e.alpha),B=Math.sin(e.alpha),z=Math.cos(e.beta);let L=Math.sin(e.beta);0===L&&(L=1e-4);const r=e._getTargetPosition();e._computationVector.ni(e.radius*o*L,e.radius*z,e.radius*B*L),r.addToRef(e._computationVector,e._newPosition),e._position.p(e._newPosition);let C=e.upVector;e.allowUpsideDown&&e.beta<0&&(C=C.clone(),C=C.negate()),e._computeViewMatrix(e._position,r,C),e._viewMatrix.addAtIndex(12,e.targetScreenOffset.x),e._viewMatrix.addAtIndex(13,e.targetScreenOffset.y),e._collisionTriggered=!1},this._target=L.o.Zero(),B&&this.setTarget(B),this.alpha=q,this.beta=S,this.radius=o,this.getViewMatrix(),this.inputs=new K(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new L.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=L.l.Zero()}_updateCache(t){t||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.p(t)}const t=this._getLockedTargetPosition();return t||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>O.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,z=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=z?this._currentInterpolationFactor=z:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=G(t,this._goalAlpha),this._goalBeta=G(q,this._goalBeta),this._goalRadius=G(S,this._goalRadius),this._goalTarget.set(G(o.x,this._goalTarget.x),G(o.y,this._goalTarget.y),G(o.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(G(B.x,this._goalTargetScreenOffset.x),G(B.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,r.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,r.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,r.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,r.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(t,q){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const B=arguments;q=k.f.BackCompatCameraNoPreventDefault(B),this._useCtrlForPanning=S,this._panningMouseButton=o,"boolean"===typeof B[0]&&(B.length>1&&(this._useCtrlForPanning=B[1]),B.length>2&&(this._panningMouseButton=B[2])),this.inputs.attachElement(q),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ui(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let t=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){t=!0;const q=this.invertRotation?-1:1,S=this._calculateHandednessMultiplier();let o=this.inertialAlphaOffset*S;this.beta<0&&(o*=-1),this.alpha+=o*q,this.beta+=this.inertialBetaOffset*q,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<O.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<O.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*O.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){t=!0;const q=new L.o(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),q.multiplyInPlace(this.panningAxis),L.o.TransformNormalToRef(q,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const t=this.upVector,q=L.o.CrossToRef(this._transformedDirection,t,this._transformedDirection);L.o.CrossToRef(t,q,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);L.o.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const t=L.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.transposeToRef(t),L.o.TransformCoordinatesToRef(this._transformedDirection,t,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*O.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*O.d&&(this.inertialPanningY=0)}if(t)this.stopInterpolation();else if(this._isInterpolating){let t=!1;const q=this._scene.getEngine().getDeltaTime()/1e3,S=1-Math.pow(2,-q/this._currentInterpolationFactor),o=G(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const q=L.j.wi[0].set(G(this._goalTarget.x,this._target.x),G(this._goalTarget.y,this._target.y),G(this._goalTarget.z,this._target.z));L.o.LerpToRef(this.target,q,S,this._target),10*L.o.Distance(this.target,q)/o<O.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(q),this.setTarget(this.target,!1,!0,!0)):t=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const q=L.g.RotationAlphaBetaGammaToRef(G(this._goalAlpha,this.alpha),G(this._goalBeta,this.beta),0,L.j.Quaternion[0]),o=L.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,L.j.Quaternion[1]),B=L.g.SlerpToRef(o,q,S,L.j.Quaternion[2]);B.normalize();const z=B.toAlphaBetaGammaToRef(L.j.wi[0]);if(this.alpha=z.x,this.beta=z.y,B.isApprox(q,O.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const t=q.toAlphaBetaGammaToRef(L.j.wi[0]);this.alpha=t.x,this.beta=t.y}else t=!0}if(isNaN(this._goalRadius)||(this.radius+=(o-this.radius)*S,Math.abs(o/this.radius-1)<O.d?(this._goalRadius=NaN,this.radius=o):t=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const q=L.j.Vector2[0].set(G(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),G(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));L.l.LerpToRef(this.targetScreenOffset,q,S,this.targetScreenOffset),L.l.Distance(this.targetScreenOffset,q)<O.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(q)):t=!0}this._isInterpolating=t}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||L.o.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const t=this.alpha;var q,S;this.alpha=function(t){let q=Math.PI/2;return 0===t.x&&0===t.z||(q=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2)))),t.z<0&&(q=2*Math.PI-q),q}(this._computationVector),this.beta=(q=this._computationVector.y,S=this.radius,Math.acos(q/S));const o=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*o*Math.PI,this._checkLimits()}setPosition(t){this._position.equals(t)||(this._position.p(t),this.rebuildAnglesAndRadius())}setTarget(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(o=this.overrideCloneAlphaBetaRadius??o,t.Ai)q&&t.getBoundingInfo?this._targetBoundingCenter=t.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,t.Ai(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const q=t,o=this._getTargetPosition();if(o&&!S&&o.equals(q))return;this._targetHost=null,this._target=q,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}o||this.rebuildAnglesAndRadius()}_getViewMatrix(){const t=Math.cos(this.alpha),q=Math.sin(this.alpha),S=Math.cos(this.beta);let o=Math.sin(this.beta);0===o&&(o=1e-4),0===this.radius&&(this.radius=1e-4);const B=this._getTargetPosition();if(this._computationVector.ni(this.radius*t*o,this.radius*S,this.radius*q*o),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||L.o.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),B.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const t=this.va().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let t=this.upVector;this.allowUpsideDown&&o<0&&(t=t.negate()),this._computeViewMatrix(this._position,B,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(B),this._viewMatrix}zoomOn(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t||this.va().meshes;const S=C.c.MinMax(t);let o=this._calculateLowerRadiusFromModelBoundingSphere(S.min,S.max);if(o=Math.max(Math.min(o,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=o*this.zoomOnFactor,this.mode===v.d.ORTHOGRAPHIC_CAMERA){const t=this.va().getEngine().getAspectRatio(this),q=o*this.zoomOnFactor/2;this.orthoLeft=-q*t,this.orthoRight=q*t,this.orthoBottom=-q,this.orthoTop=q}this.focusOn({min:S.min,max:S.max,distance:o},q)}focusOn(t){let q,S,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===t.min){const o=t||this.va().meshes;q=C.c.MinMax(o),S=L.o.Distance(q.min,q.max)}else{q=t,S=t.distance}this._target=C.c.Center(q),o||(this.maxZ=2*S)}createRigCamera(t,q){let S=0;switch(this.cameraRigMode){case v.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case v.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case v.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case v.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case v.d.RIG_MODE_VR:S=this._cameraRigParams.stereoHalfAngle*(0===q?1:-1);break;case v.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:S=this._cameraRigParams.stereoHalfAngle*(0===q?-1:1)}const o=new Y(t,this.alpha+S,this.beta,this.radius,this._target,this.va());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o.mode=this.mode,o.orthoLeft=this.orthoLeft,o.orthoRight=this.orthoRight,o.orthoBottom=this.orthoBottom,o.orthoTop=this.orthoTop,o}_updateRigCameras(){const t=this._rigCameras[0],q=this._rigCameras[1];switch(t.beta=q.beta=this.beta,this.cameraRigMode){case v.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case v.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case v.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case v.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case v.d.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case v.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const o=L.o.Distance(t,q),B=this.va().getEngine().getAspectRatio(this),z=Math.tan(this.fov/2),r=z*B,e=.5*o*S,C=e*Math.sqrt(1+1/(r*r)),Z=e*Math.sqrt(1+1/(z*z));return Math.max(C,Z)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,o.e)([(0,B.C)()],Y.prototype,"alpha",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"beta",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"radius",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,o.e)([(0,B.B)("target")],Y.prototype,"_target",void 0),(0,o.e)([(0,B.r)("targetHost")],Y.prototype,"_targetHost",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"inertialAlphaOffset",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"inertialBetaOffset",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"inertialRadiusOffset",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"lowerAlphaLimit",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"upperAlphaLimit",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"lowerBetaLimit",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"upperBetaLimit",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"lowerRadiusLimit",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"upperRadiusLimit",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"lowerTargetYLimit",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"inertialPanningX",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"inertialPanningY",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"pinchToPanMaxDistance",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"panningDistanceLimit",void 0),(0,o.e)([(0,B.B)()],Y.prototype,"panningOriginTarget",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"panningInertia",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"zoomToMouseLocation",null),(0,o.e)([(0,B.C)()],Y.prototype,"zoomOnFactor",void 0),(0,o.e)([(0,B.x)()],Y.prototype,"targetScreenOffset",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"allowUpsideDown",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"useInputToRestoreState",void 0),(0,o.e)([(0,B.C)()],Y.prototype,"restoreStateInterpolationFactor",void 0),(0,X.c)("BABYLON.ArcRotateCamera",Y)},12866:(t,q,S)=>{"use strict";S.d(q,{d:()=>L,h:()=>r});var o=S(496),B=S(701),z=S(644),L={};class r{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const q=t.getSimpleName();this.attached[q]?o.c.Warn("camera input of type "+q+" already exists on camera"):(this.attached[q]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const q in this.attached){const S=this.attached[q];if(S===t)return S.Ui(),S.camera=null,delete this.attached[q],void this.rebuildInputCheck()}}removeByType(t){for(const q in this.attached){const S=this.attached[q];S.getClassName()===t&&(S.Ui(),S.camera=null,delete this.attached[q],this.rebuildInputCheck())}}_addCheckInputs(t){const q=this.checkInputs;return()=>{q(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){t=!z.d.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const q in this.attached)this.attached[q].attachControl(t)}}detachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const q in this.attached)this.attached[q].Ui(),t&&(this.attached[q].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const q=this.attached[t];q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const q={};for(const S in this.attached){const t=this.attached[S],o=B.b.Serialize(t);q[t.getClassName()]=o}t.inputsmgr=q}parse(t){const q=t.inputsmgr;if(q){this.clear();for(const t in q){const S=L[t];if(S){const o=q[t],z=B.b.Parse((()=>new S),o,null);this.add(z)}}}else for(const S in this.attached){const q=L[this.attached[S].getClassName()];if(q){const o=B.b.Parse((()=>new q),t,null);this.remove(this.attached[S]),this.add(o)}}}}},12859:(t,q,S)=>{"use strict";S.d(q,{e:()=>V});var o=S(653),B=S(658),z=S(678),L=S(11936),r=S(12866),e=S(2454),C=S(490);class Z{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(t){t=C.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((q=>{const S=q.event;if(!S.metaKey)if(q.type===e.e.KEYDOWN){if(-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysUpward.indexOf(S.keyCode)||-1!==this.keysDownward.indexOf(S.keyCode)||-1!==this.keysRotateLeft.indexOf(S.keyCode)||-1!==this.keysRotateRight.indexOf(S.keyCode)||-1!==this.keysRotateUp.indexOf(S.keyCode)||-1!==this.keysRotateDown.indexOf(S.keyCode)){-1===this._keys.indexOf(S.keyCode)&&this._keys.push(S.keyCode),t||S.preventDefault()}}else if(-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysUpward.indexOf(S.keyCode)||-1!==this.keysDownward.indexOf(S.keyCode)||-1!==this.keysRotateLeft.indexOf(S.keyCode)||-1!==this.keysRotateRight.indexOf(S.keyCode)||-1!==this.keysRotateUp.indexOf(S.keyCode)||-1!==this.keysRotateDown.indexOf(S.keyCode)){const q=this._keys.indexOf(S.keyCode);q>=0&&this._keys.splice(q,1),t||S.preventDefault()}})))}Ui(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let q=0;q<this._keys.length;q++){const S=this._keys[q],o=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(S)?t._localDirection.ni(-o,0,0):-1!==this.keysUp.indexOf(S)?t._localDirection.ni(0,0,o):-1!==this.keysRight.indexOf(S)?t._localDirection.ni(o,0,0):-1!==this.keysDown.indexOf(S)?t._localDirection.ni(0,0,-o):-1!==this.keysUpward.indexOf(S)?t._localDirection.ni(0,o,0):-1!==this.keysDownward.indexOf(S)?t._localDirection.ni(0,-o,0):-1!==this.keysRotateLeft.indexOf(S)?(t._localDirection.ni(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(S)?(t._localDirection.ni(0,0,0),t.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(S)?(t._localDirection.ni(0,0,0),t.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(S)&&(t._localDirection.ni(0,0,0),t.cameraRotation.x+=this._getLocalRotation()),t.va().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),z.o.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const t=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*t}}(0,o.e)([(0,B.C)()],Z.prototype,"keysUp",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysUpward",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysDown",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysDownward",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysLeft",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysRight",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"rotationSpeed",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysRotateLeft",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysRotateRight",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysRotateUp",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"keysRotateDown",void 0),r.d.FreeCameraKeyboardMoveInput=Z;var b=S(485),O=S(2450);class i{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new b.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(t){t=C.f.BackCompatCameraNoPreventDefault(arguments);const q=this.camera.getEngine(),S=q.getInputElement();this._pointerInput||(this._pointerInput=o=>{const B=o.event,z="touch"===B.pointerType;if(!this.touchEnabled&&z)return;if(o.type!==O.b.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const L=B.target;if(o.type===O.b.POINTERDOWN){if(z&&-1!==this._activePointerId||!z&&-1!==this._currentActiveButton)return;this._activePointerId=B.pointerId;try{null===L||void 0===L||L.setPointerCapture(B.pointerId)}catch(r){}-1===this._currentActiveButton&&(this._currentActiveButton=B.button),this._previousPosition={x:B.clientX,y:B.clientY},t||(B.preventDefault(),S&&S.focus()),q.isPointerLock&&this._onMouseMove&&this._onMouseMove(o.event)}else if(o.type===O.b.POINTERUP){if(z&&this._activePointerId!==B.pointerId||!z&&this._currentActiveButton!==B.button)return;try{null===L||void 0===L||L.releasePointerCapture(B.pointerId)}catch(r){}this._currentActiveButton=-1,this._previousPosition=null,t||B.preventDefault(),this._activePointerId=-1}else if(o.type===O.b.POINTERMOVE&&(this._activePointerId===B.pointerId||!z))if(q.isPointerLock&&this._onMouseMove)this._onMouseMove(o.event);else if(this._previousPosition){const q=this.camera._calculateHandednessMultiplier(),S=(B.clientX-this._previousPosition.x)*q,o=B.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=S/this.angularSensibility,this.camera.cameraRotation.x+=o/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:S,offsetY:o}),this._previousPosition={x:B.clientX,y:B.clientY},t||B.preventDefault()}}),this._onMouseMove=S=>{if(!q.isPointerLock)return;const o=this.camera._calculateHandednessMultiplier(),B=S.movementX*o;this.camera.cameraRotation.y+=B/this.angularSensibility;const z=S.movementY;this.camera.cameraRotation.x+=z/this.angularSensibility,this._previousPosition=null,t||S.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,O.b.POINTERDOWN|O.b.POINTERUP|O.b.POINTERMOVE),S&&(this._contextMenuBind=t=>this.onContextMenu(t),S.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(t){t.preventDefault()}Ui(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,o.e)([(0,B.C)()],i.prototype,"buttons",void 0),(0,o.e)([(0,B.C)()],i.prototype,"angularSensibility",void 0),r.d.FreeCameraMouseInput=i;var h,l=S(2460);class I{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new b.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(t){t=C.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=q=>{if(q.type!==O.b.POINTERWHEEL)return;const S=q.event,o=S.deltaMode===l.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*o*S.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*o*S.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*o*S.deltaZ/this._normalize,S.preventDefault&&(t||S.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,O.b.POINTERWHEEL)}Ui(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,o.e)([(0,B.C)()],I.prototype,"wheelPrecisionX",void 0),(0,o.e)([(0,B.C)()],I.prototype,"wheelPrecisionY",void 0),(0,o.e)([(0,B.C)()],I.prototype,"wheelPrecisionZ",void 0),function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(h||(h={}));class a extends I{constructor(){super(...arguments),this._moveRelative=z.o.Zero(),this._rotateRelative=z.o.Zero(),this._moveScene=z.o.Zero(),this._wheelXAction=h.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=h.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(t){null===t&&this._wheelXAction!==h.MoveRelative||(this._wheelXAction=h.MoveRelative,this._wheelXActionCoordinate=t)}get wheelXMoveRelative(){return this._wheelXAction!==h.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(t){null===t&&this._wheelYAction!==h.MoveRelative||(this._wheelYAction=h.MoveRelative,this._wheelYActionCoordinate=t)}get wheelYMoveRelative(){return this._wheelYAction!==h.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(t){null===t&&this._wheelZAction!==h.MoveRelative||(this._wheelZAction=h.MoveRelative,this._wheelZActionCoordinate=t)}get wheelZMoveRelative(){return this._wheelZAction!==h.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(t){null===t&&this._wheelXAction!==h.RotateRelative||(this._wheelXAction=h.RotateRelative,this._wheelXActionCoordinate=t)}get wheelXRotateRelative(){return this._wheelXAction!==h.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(t){null===t&&this._wheelYAction!==h.RotateRelative||(this._wheelYAction=h.RotateRelative,this._wheelYActionCoordinate=t)}get wheelYRotateRelative(){return this._wheelYAction!==h.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(t){null===t&&this._wheelZAction!==h.RotateRelative||(this._wheelZAction=h.RotateRelative,this._wheelZActionCoordinate=t)}get wheelZRotateRelative(){return this._wheelZAction!==h.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(t){null===t&&this._wheelXAction!==h.MoveScene||(this._wheelXAction=h.MoveScene,this._wheelXActionCoordinate=t)}get wheelXMoveScene(){return this._wheelXAction!==h.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(t){null===t&&this._wheelYAction!==h.MoveScene||(this._wheelYAction=h.MoveScene,this._wheelYActionCoordinate=t)}get wheelYMoveScene(){return this._wheelYAction!==h.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(t){null===t&&this._wheelZAction!==h.MoveScene||(this._wheelZAction=h.MoveScene,this._wheelZActionCoordinate=t)}get wheelZMoveScene(){return this._wheelZAction!==h.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ui(0),this._rotateRelative.ui(0),this._moveScene.ui(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const t=z.e.Zero();this.camera.getViewMatrix().invertToRef(t);const q=z.o.Zero();z.o.TransformNormalToRef(this._moveRelative,t,q),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(q),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(t,q,S){if(0===t)return;if(null===q||null===S)return;let o=null;switch(q){case h.MoveRelative:o=this._moveRelative;break;case h.RotateRelative:o=this._rotateRelative;break;case h.MoveScene:o=this._moveScene}switch(S){case 0:o.set(t,0,0);break;case 1:o.set(0,t,0);break;case 2:o.set(0,0,t)}}}(0,o.e)([(0,B.C)()],a.prototype,"wheelXMoveRelative",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelYMoveRelative",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelZMoveRelative",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelXRotateRelative",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelYRotateRelative",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelZRotateRelative",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelXMoveScene",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelYMoveScene",null),(0,o.e)([(0,B.C)()],a.prototype,"wheelZMoveScene",null),r.d.FreeCameraMouseWheelInput=a;class v{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=C.f.IsSafari()}attachControl(t){t=C.f.BackCompatCameraNoPreventDefault(arguments);let q=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=S=>{const o=S.event,B="mouse"===o.pointerType||this._isSafari&&"undefined"===typeof o.pointerType;if(this.allowMouse||!B)if(S.type===O.b.POINTERDOWN){if(t||o.preventDefault(),this._pointerPressed.push(o.pointerId),1!==this._pointerPressed.length)return;q={x:o.clientX,y:o.clientY}}else if(S.type===O.b.POINTERUP){t||o.preventDefault();const S=this._pointerPressed.indexOf(o.pointerId);if(-1===S)return;if(this._pointerPressed.splice(S,1),0!=S)return;q=null,this._offsetX=null,this._offsetY=null}else if(S.type===O.b.POINTERMOVE){if(t||o.preventDefault(),!q)return;if(0!=this._pointerPressed.indexOf(o.pointerId))return;this._offsetX=o.clientX-q.x,this._offsetY=-(o.clientY-q.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,O.b.POINTERDOWN|O.b.POINTERUP|O.b.POINTERMOVE),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.addEventListener("blur",this._onLostFocus)}}Ui(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const t=this.camera,q=t._calculateHandednessMultiplier();t.cameraRotation.y=q*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const q=t._computeLocalCameraSpeed(),S=new z.o(0,0,0!==this.touchMoveSensibility?q*this._offsetY/this.touchMoveSensibility:0);z.e.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(z.o.TransformCoordinates(S,t._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,o.e)([(0,B.C)()],v.prototype,"touchAngularSensibility",void 0),(0,o.e)([(0,B.C)()],v.prototype,"touchMoveSensibility",void 0),r.d.FreeCameraTouchInput=v;class M extends r.h{constructor(t){super(t),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new Z),this}addMouse(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new i(t),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new a,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new v),this}clear(){super.clear(),this._mouseInput=null}}var x=S(622),k=S(561);class V extends L.c{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const q=this.inputs.attached.mouse;q&&(q.angularSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const q=this.inputs.attached.keyboard;q&&(q.keysUp=t)}get keysUpward(){const t=this.inputs.attached.keyboard;return t?t.keysUpward:[]}set keysUpward(t){const q=this.inputs.attached.keyboard;q&&(q.keysUpward=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const q=this.inputs.attached.keyboard;q&&(q.keysDown=t)}get keysDownward(){const t=this.inputs.attached.keyboard;return t?t.keysDownward:[]}set keysDownward(t){const q=this.inputs.attached.keyboard;q&&(q.keysDownward=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const q=this.inputs.attached.keyboard;q&&(q.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const q=this.inputs.attached.keyboard;q&&(q.keysRight=t)}get keysRotateLeft(){const t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]}set keysRotateLeft(t){const q=this.inputs.attached.keyboard;q&&(q.keysRotateLeft=t)}get keysRotateRight(){const t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]}set keysRotateRight(t){const q=this.inputs.attached.keyboard;q&&(q.keysRotateRight=t)}get keysRotateUp(){const t=this.inputs.attached.keyboard;return t?t.keysRotateUp:[]}set keysRotateUp(t){const q=this.inputs.attached.keyboard;q&&(q.keysRotateUp=t)}get keysRotateDown(){const t=this.inputs.attached.keyboard;return t?t.keysRotateDown:[]}set keysRotateDown(t){const q=this.inputs.attached.keyboard;q&&(q.keysRotateDown=t)}constructor(t,q,S){var o;super(t,q,S,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),o=this,this.ellipsoid=new z.o(.5,1,.5),this.ellipsoidOffset=new z.o(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=z.o.Zero(),this._diffPosition=z.o.Zero(),this._newPosition=z.o.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o._newPosition.p(q),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o._diffPosition.length()>k.c.CollisionsEpsilon&&(o.position.addToRef(o._diffPosition,o._deferredPositionUpdate),o._deferOnly?o._deferredUpdated=!0:o.position.p(o._deferredPositionUpdate),o.$h&&S&&o.$h(S))},this.inputs=new M(this),this.inputs.addKeyboard().addMouse()}attachControl(t,q){q=C.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(q)}Ui(){this.inputs.detachElement(),this.cameraDirection=new z.o(0,0,0),this.cameraRotation=new z.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let q;q=this.parent?z.o.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,q.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const S=this.va().collisionCoordinator;this._collider||(this._collider=S.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let o=t;this.applyGravity&&(o=t.add(this.va().gravity)),S.getNewPosition(this._oldPosition,o,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=z.o.Zero(),this._transformedDirection=z.o.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(t){this._needMoveForGravity=t}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,o.e)([(0,B.B)()],V.prototype,"ellipsoid",void 0),(0,o.e)([(0,B.B)()],V.prototype,"ellipsoidOffset",void 0),(0,o.e)([(0,B.C)()],V.prototype,"checkCollisions",void 0),(0,o.e)([(0,B.C)()],V.prototype,"applyGravity",void 0),(0,x.c)("BABYLON.FreeCamera",V)},13251:(t,q,S)=>{"use strict";S.d(q,{e:()=>z});var o=S(670),B=S(13255);class z{constructor(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=S,this.ml=[],this._maxBlockCapacity=q||64,this._selectionContent=new o.d(1024),this._creationFunc=t}update(t,q,S){B.e._CreateBlocks(t,q,S,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}dj(t){for(let q=0;q<this.Xk.length;q++){this.Xk[q].addEntry(t)}}fj(t){for(let q=0;q<this.Xk.length;q++){this.Xk[q].removeEntry(t)}}select(t,q){this._selectionContent.reset();for(let S=0;S<this.Xk.length;S++){this.Xk[S].select(t,this._selectionContent,q)}return q?this._selectionContent.concat(this.ml):this._selectionContent.concatWithNoDuplicate(this.ml),this._selectionContent}intersects(t,q,S){this._selectionContent.reset();for(let o=0;o<this.Xk.length;o++){this.Xk[o].intersects(t,q,this._selectionContent,S)}return S?this._selectionContent.concat(this.ml):this._selectionContent.concatWithNoDuplicate(this.ml),this._selectionContent}intersectsRay(t){this._selectionContent.reset();for(let q=0;q<this.Xk.length;q++){this.Xk[q].intersectsRay(t,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.ml),this._selectionContent}}z.CreationFuncForMeshes=(t,q)=>{const S=t.getBoundingInfo();!t.isBlocked&&S.boundingBox.intersectsMinMax(q.ol,q.pl)&&q.entries.push(t)},z.CreationFuncForSubMeshes=(t,q)=>{t.getBoundingInfo().boundingBox.intersectsMinMax(q.ol,q.pl)&&q.entries.push(t)}},13255:(t,q,S)=>{"use strict";S.d(q,{e:()=>z});var o=S(678),B=S(755);class z{constructor(t,q,S,o,B,z){this.entries=[],this.ql=new Array,this._capacity=S,this._depth=o,this._maxDepth=B,this._creationFunc=z,this._minPoint=t,this._maxPoint=q,this.ql.push(t.clone()),this.ql.push(q.clone()),this.ql.push(t.clone()),this.ql[2].x=q.x,this.ql.push(t.clone()),this.ql[3].y=q.y,this.ql.push(t.clone()),this.ql[4].z=q.z,this.ql.push(q.clone()),this.ql[5].z=t.z,this.ql.push(q.clone()),this.ql[6].x=t.x,this.ql.push(q.clone()),this.ql[7].y=t.y}get di(){return this._capacity}get ol(){return this._minPoint}get pl(){return this._maxPoint}addEntry(t){if(this.Xk)for(let q=0;q<this.Xk.length;q++){this.Xk[q].addEntry(t)}else this._creationFunc(t,this),this.entries.length>this.di&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(t){if(this.Xk){for(let q=0;q<this.Xk.length;q++){this.Xk[q].removeEntry(t)}return}const q=this.entries.indexOf(t);q>-1&&this.entries.splice(q,1)}addEntries(t){for(let q=0;q<t.length;q++){const S=t[q];this.addEntry(S)}}select(t,q,S){if(B.c.IsInFrustum(this.ql,t)){if(this.Xk){for(let o=0;o<this.Xk.length;o++){this.Xk[o].select(t,q,S)}return}S?q.concat(this.entries):q.concatWithNoDuplicate(this.entries)}}intersects(t,q,S,o){if(B.c.IntersectsSphere(this._minPoint,this._maxPoint,t,q)){if(this.Xk){for(let B=0;B<this.Xk.length;B++){this.Xk[B].intersects(t,q,S,o)}return}o?S.concat(this.entries):S.concatWithNoDuplicate(this.entries)}}intersectsRay(t,q){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Xk){for(let S=0;S<this.Xk.length;S++){this.Xk[S].intersectsRay(t,q)}return}q.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(t,q,S,B,L,r,e,C){e.Xk=new Array;const Z=new o.o((q.x-t.x)/2,(q.y-t.y)/2,(q.z-t.z)/2);for(let o=0;o<2;o++)for(let q=0;q<2;q++)for(let b=0;b<2;b++){const O=t.add(Z.multiplyByFloats(o,q,b)),i=t.add(Z.multiplyByFloats(o+1,q+1,b+1)),h=new z(O,i,B,L+1,r,C);h.addEntries(S),e.Xk.push(h)}}}},13264:(t,q,S)=>{"use strict";S.d(q,{c:()=>Z});var o=S(2428),B=S(678),z=S(791),L=S(12620),r=S(842),e=S(13251),C=S(523);o.d.prototype.createOrUpdateSelectionOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,S=this._getComponent(r.e.NAME_OCTREE);S||(S=new Z(this),this.o(S)),this.kl||(this.kl=new e.e(e.e.CreationFuncForMeshes,t,q));const o=this.getWorldExtends();return this.kl.update(o.min,o.max,this.meshes),this.kl},Object.defineProperty(o.d.prototype,"selectionOctree",{get:function(){return this.kl},enumerable:!0,configurable:!0}),z.b.prototype.createOrUpdateSubmeshesOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const S=this.va();let o=S._getComponent(r.e.NAME_OCTREE);o||(o=new Z(S),S.o(o)),this._submeshesOctree||(this._submeshesOctree=new e.e(e.e.CreationFuncForSubMeshes,t,q)),this.Ai(!0);const B=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(B.minimumWorld,B.maximumWorld,this.Di),this._submeshesOctree};class Z{constructor(t){this.name=r.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new L.c(B.o.Zero(),new B.o(1,1,1)),(t=t||C.b.LastCreatedScene)&&(this.Tk=t,this.Tk.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Tk.getActiveSubMeshCandidates=t=>this.getActiveSubMeshCandidates(t),this.Tk.getCollidingSubMeshCandidates=(t,q)=>this.getCollidingSubMeshCandidates(t,q),this.Tk.getIntersectingSubMeshCandidates=(t,q)=>this.getIntersectingSubMeshCandidates(t,q))}register(){this.Tk.onMeshRemovedObservable.add((t=>{const q=this.Tk.selectionOctree;if(void 0!==q&&null!==q){const S=q.ml.indexOf(t);-1!==S&&q.ml.splice(S,1)}})),this.Tk.onMeshImportedObservable.add((t=>{const q=this.Tk.selectionOctree;void 0!==q&&null!==q&&q.dj(t)}))}getActiveMeshCandidates(){var t;return(null===(t=this.Tk.kl)||void 0===t?void 0:t.select(this.Tk.frustumPlanes))||this.Tk._getDefaultMeshCandidates()}getActiveSubMeshCandidates(t){if(t._submeshesOctree&&t.useOctreeForRenderingSelection){return t._submeshesOctree.select(this.Tk.frustumPlanes)}return this.Tk._getDefaultSubMeshCandidates(t)}getIntersectingSubMeshCandidates(t,q){if(t._submeshesOctree&&t.useOctreeForPicking){L.c.TransformToRef(q,t.getWorldMatrix(),this._tempRay);return t._submeshesOctree.intersectsRay(this._tempRay)}return this.Tk._getDefaultSubMeshCandidates(t)}getCollidingSubMeshCandidates(t,q){if(t._submeshesOctree&&t.useOctreeForCollisions){const S=q._velocityWorldLength+Math.max(q._radius.x,q._radius.y,q._radius.z);return t._submeshesOctree.intersects(q._basePointWorld,S)}return this.Tk._getDefaultSubMeshCandidates(t)}rebuild(){}dispose(){}}},12620:(t,q,S)=>{"use strict";S.d(q,{c:()=>i});var o=S(2428),B=S(644),z=S(682),L=S(678),r=S(686),e=S(747),C=S(800),Z=S(523),b=S(2468);const O={internalPickerForMesh:void 0};class i{constructor(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.d;this.origin=t,this.direction=q,this.length=S,this.epsilon=o}clone(){return new i(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=i._TmpVector3[0].ni(t.x-S,t.y-S,t.z-S),B=i._TmpVector3[1].ni(q.x+S,q.y+S,q.z+S);let z,L,r,e,C=0,Z=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<o.x||this.origin.x>B.x)return!1}else if(z=1/this.direction.x,L=(o.x-this.origin.x)*z,r=(B.x-this.origin.x)*z,r===-1/0&&(r=1/0),L>r&&(e=L,L=r,r=e),C=Math.max(L,C),Z=Math.min(r,Z),C>Z)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<o.y||this.origin.y>B.y)return!1}else if(z=1/this.direction.y,L=(o.y-this.origin.y)*z,r=(B.y-this.origin.y)*z,r===-1/0&&(r=1/0),L>r&&(e=L,L=r,r=e),C=Math.max(L,C),Z=Math.min(r,Z),C>Z)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<o.z||this.origin.z>B.z)return!1}else if(z=1/this.direction.z,L=(o.z-this.origin.z)*z,r=(B.z-this.origin.z)*z,r===-1/0&&(r=1/0),L>r&&(e=L,L=r,r=e),C=Math.max(L,C),Z=Math.min(r,Z),C>Z)return!1;return!0}intersectsBox(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(t.minimum,t.maximum,q)}intersectsSphere(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const S=t.center.x-this.origin.x,o=t.center.y-this.origin.y,B=t.center.z-this.origin.z,z=S*S+o*o+B*B,L=t.radius+q,r=L*L;if(z<=r)return!0;const e=S*this.direction.x+o*this.direction.y+B*this.direction.z;if(e<0)return!1;return z-e*e<=r}intersectsTriangle(t,q,S){const o=i._TmpVector3[0],B=i._TmpVector3[1],z=i._TmpVector3[2],r=i._TmpVector3[3],C=i._TmpVector3[4];q.subtractToRef(t,o),S.subtractToRef(t,B),L.o.CrossToRef(this.direction,B,z);const Z=L.o.Dot(o,z);if(0===Z)return null;const b=1/Z;this.origin.subtractToRef(t,r);const O=L.o.Dot(r,z)*b;if(O<-this.epsilon||O>1+this.epsilon)return null;L.o.CrossToRef(r,o,C);const h=L.o.Dot(this.direction,C)*b;if(h<-this.epsilon||O+h>1+this.epsilon)return null;const l=L.o.Dot(B,C)*b;return l>this.length?null:new e.d(1-O-h,O,l)}intersectsPlane(t){let q;const S=L.o.Dot(t.Zi,this.direction);if(Math.abs(S)<9.99999997475243e-7)return null;{const o=L.o.Dot(t.Zi,this.origin);return q=(-t.d-o)/S,q<0?q<-9.99999997475243e-7?null:0:q}}intersectsAxis(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(t){case"y":{const t=(this.origin.y-q)/this.direction.y;return t>0?null:new L.o(this.origin.x+this.direction.x*-t,q,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-q)/this.direction.x;return t>0?null:new L.o(q,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-q)/this.direction.z;return t>0?null:new L.o(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,q)}default:return null}}intersectsMesh(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=L.j.Matrix[0];return t.getWorldMatrix().invertToRef(r),this._tmpRay?i.TransformToRef(this,r,this._tmpRay):this._tmpRay=i.Transform(this,r),t.intersects(this._tmpRay,q,S,o,B,z)}intersectsMeshes(t,q,S){S?S.length=0:S=[];for(let o=0;o<t.length;o++){const B=this.intersectsMesh(t[o],q);B.hit&&S.push(B)}return S.sort(this._comparePickingInfo),S}_comparePickingInfo(t,q){return t.distance<q.distance?-1:t.distance>q.distance?1:0}intersectionSegment(t,q,S){const o=this.origin,B=L.j.wi[0],z=L.j.wi[1],r=L.j.wi[2],e=L.j.wi[3];q.subtractToRef(t,B),this.direction.scaleToRef(i._Rayl,r),o.addToRef(r,z),t.subtractToRef(o,e);const C=L.o.Dot(B,B),Z=L.o.Dot(B,r),b=L.o.Dot(r,r),O=L.o.Dot(B,e),h=L.o.Dot(r,e),l=C*b-Z*Z;let I,a,v=l,M=l;l<i._Smallnum?(I=0,v=1,a=h,M=b):(I=Z*h-b*O,a=C*h-Z*O,I<0?(I=0,a=h,M=b):I>v&&(I=v,a=h+Z,M=b)),a<0?(a=0,-O<0?I=0:-O>C?I=v:(I=-O,v=C)):a>M&&(a=M,-O+Z<0?I=0:-O+Z>C?I=v:(I=-O+Z,v=C));const x=Math.abs(I)<i._Smallnum?0:I/v,k=Math.abs(a)<i._Smallnum?0:a/M,V=L.j.wi[4];r.scaleToRef(k,V);const J=L.j.wi[5];B.scaleToRef(x,J),J.addInPlace(e);const U=L.j.wi[6];J.subtractToRef(V,U);return k>0&&k<=this.length&&U.lengthSquared()<S*S?J.length():-1}update(t,q,S,o,B,z,r){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){i._RayDistant||(i._RayDistant=i.Zero()),i._RayDistant.unprojectRayToRef(t,q,S,o,L.e.IdentityReadOnly,z,r);const e=L.j.Matrix[0];B.invertToRef(e),i.TransformToRef(i._RayDistant,e,this)}else this.unprojectRayToRef(t,q,S,o,B,z,r);return this}static Zero(){return new i(L.o.Zero(),L.o.Zero())}static CreateNew(t,q,S,o,B,z,L){return i.Zero().update(t,q,S,o,B,z,L)}static CreateNewFromTo(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.e.IdentityReadOnly;const o=new i(new L.o(0,0,0),new L.o(0,0,0));return i.CreateFromToToRef(t,q,o,S)}static CreateFromToToRef(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.e.IdentityReadOnly;S.origin.p(t);const B=q.subtractToRef(t,S.direction),z=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);return S.length=z,S.direction.normalize(),i.TransformToRef(S,o,S)}static Transform(t,q){const S=new i(new L.o(0,0,0),new L.o(0,0,0));return i.TransformToRef(t,q,S),S}static TransformToRef(t,q,S){L.o.TransformCoordinatesToRef(t.origin,q,S.origin),L.o.TransformNormalToRef(t.direction,q,S.direction),S.length=t.length,S.epsilon=t.epsilon;const o=S.direction,B=o.length();if(0!==B&&1!==B){const t=1/B;o.x*=t,o.y*=t,o.z*=t,S.length*=B}return S}unprojectRayToRef(t,q,S,o,B,z,r){const e=L.j.Matrix[0];B.multiplyToRef(z,e),e.multiplyToRef(r,e),e.invert();const C=Z.b.LastCreatedEngine,b=L.j.wi[0];b.x=t/S*2-1,b.y=-(q/o*2-1),b.z=null!==C&&void 0!==C&&C.useReverseDepthBuffer?1:null!==C&&void 0!==C&&C.isNDCHalfZRange?0:-1;const O=L.j.wi[1].ni(b.x,b.y,1-1e-8),i=L.j.wi[2],h=L.j.wi[3];L.o._UnprojectFromInvertedMatrixToRef(b,e,i),L.o._UnprojectFromInvertedMatrixToRef(O,e,h),this.origin.p(i),h.subtractToRef(i,this.direction),this.direction.normalize()}}function h(t,q,S,o,B){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const L=i.Zero();return l(t,q,S,o,L,B,z),L}function l(t,q,S,o,B,z){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const C=t.getEngine();if(!z&&!(z=t.activeCamera))return t;const Z=z.viewport,b=C.getRenderHeight(),{x:O,y:i,width:h,height:l}=Z.toGlobal(C.getRenderWidth(),b),I=1/C.getHardwareScalingLevel();return q=q*I-O,S=S*I-(b-i-l),B.update(q,S,h,l,o||L.e.IdentityReadOnly,r?L.e.IdentityReadOnly:z.getViewMatrix(),z.getProjectionMatrix(),e),t}function I(t,q,S,o,B){if(!C.e)return t;const z=t.getEngine();if(!B&&!(B=t.activeCamera))throw new Error("Active camera not set");const r=B.viewport,e=z.getRenderHeight(),{x:Z,y:b,width:O,height:i}=r.toGlobal(z.getRenderWidth(),e),h=L.e.Identity(),l=1/z.getHardwareScalingLevel();return q=q*l-Z,S=S*l-(e-b-i),o.update(q,S,O,i,h,h,B.getProjectionMatrix()),t}function a(t,q,S,o,B,z,L,r){const e=q(o,S.enableDistantPicking),C=S.intersects(e,B,L,z,o,r);return C&&C.hit?!B&&null!=t&&C.distance>=t.distance?null:C:null}function v(t,q,S,o,B,z){let r=null;const e=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),Z=t.cameraToUseForPointers||t.activeCamera,b=O.internalPickerForMesh||a;for(let C=0;C<t.meshes.length;C++){const O=t.meshes[C];if(S){if(!S(O,-1))continue}else if(!O.isEnabled()||!O.isVisible||!O.Hi)continue;const i=e&&O.isWorldMatrixCameraDependent(),h=O.Ai(i,Z);if(O.hasThinInstances&&O.thinInstanceEnablePicking){const t=b(r,q,O,h,!0,!0,z);if(t){if(B)return t;const e=L.j.Matrix[1],C=O.thinInstanceGetWorldMatrices();for(let t=0;t<C.length;t++){if(S&&!S(O,t))continue;C[t].multiplyToRef(h,e);const L=b(r,q,O,e,o,B,z,!0);if(L&&(r=L,r.thinInstanceIndex=t,o))return r}}}else{const t=b(r,q,O,h,o,B,z);if(t&&(r=t,o))return r}}return r||new C.e}function M(t,q,S,o){if(!C.e)return null;const B=[],z=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),r=t.cameraToUseForPointers||t.activeCamera,e=O.internalPickerForMesh||a;for(let C=0;C<t.meshes.length;C++){const Z=t.meshes[C];if(S){if(!S(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.Hi)continue;const b=z&&Z.isWorldMatrixCameraDependent(),O=Z.Ai(b,r);if(Z.hasThinInstances&&Z.thinInstanceEnablePicking){if(e(null,q,Z,O,!0,!0,o)){const t=L.j.Matrix[1],z=Z.thinInstanceGetWorldMatrices();for(let L=0;L<z.length;L++){if(S&&!S(Z,L))continue;z[L].multiplyToRef(O,t);const r=e(null,q,Z,t,!1,!1,o,!0);r&&(r.thinInstanceIndex=L,B.push(r))}}}else{const t=e(null,q,Z,O,!1,!1,o);t&&B.push(t)}}return B}function x(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;o||(o=t.getWorldMatrix()),q.length=S,B?q.origin.p(B):q.origin.p(t.position);const z=L.j.wi[2];z.set(0,0,t._scene.useRightHandedSystem?-1:1);const r=L.j.wi[3];return L.o.TransformNormalToRef(z,o,r),L.o.NormalizeToRef(r,q.direction),q}var k,V;i._TmpVector3=(0,r.c)(6,L.o.Zero),i._RayDistant=i.Zero(),i._Smallnum=1e-8,i._Rayl=1e9,k=o.d,(V=B.d)&&(V.prototype.getForwardRay=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,q=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;return x(this,new i(L.o.Zero(),L.o.Zero(),t),t,q,S)},V.prototype.getForwardRayToRef=function(t){return x(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),k&&(b.c._IsPickingAvailable=!0,k.prototype.createPickingRay=function(t,q,S,o){return h(this,t,q,S,o,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),o.d.prototype.createPickingRayToRef=function(t,q,S,o,B){return l(this,t,q,S,o,B,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},o.d.prototype.createPickingRayInCameraSpace=function(t,q,S){return function(t,q,S,o){const B=i.Zero();return I(t,q,S,B,o),B}(this,t,q,S)},o.d.prototype.createPickingRayInCameraSpaceToRef=function(t,q,S,o){return I(this,t,q,S,o)},o.d.prototype.pickWithBoundingInfo=function(t,q,S,o,B){return function(t,q,S,o,B,z){if(!C.e)return null;const r=v(t,(o=>(t._tempPickingRay||(t._tempPickingRay=i.Zero()),l(t,q,S,o,t._tempPickingRay,z||null),t._tempPickingRay)),o,B,!0);return r&&(r.ray=h(t,q,S,L.e.Identity(),z||null)),r}(this,t,q,S,o,B)},o.d.prototype.Sk=function(t,q,S,o,B,z){return function(t,q,S,o,B,z,r){const e=v(t,((o,B)=>(t._tempPickingRay||(t._tempPickingRay=i.Zero()),l(t,q,S,o,t._tempPickingRay,z||null,!1,B),t._tempPickingRay)),o,B,!1,r);return e&&(e.ray=h(t,q,S,L.e.Identity(),z||null)),e}(this,t,q,S,o,B,z)},o.d.prototype.pickWithRay=function(t,q,S,o){return function(t,q,S,o,B){const z=v(t,(S=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=L.e.Identity()),S.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=i.Zero()),i.TransformToRef(q,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),S,o,!1,B);return z&&(z.ray=q),z}(this,t,q,S,o)},o.d.prototype.multiPick=function(t,q,S,o,B){return function(t,q,S,o,B,z){return M(t,(o=>h(t,q,S,o,B||null)),o,z)}(this,t,q,S,o,B)},o.d.prototype.multiPickWithRay=function(t,q,S){return function(t,q,S,o){return M(t,(S=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=L.e.Identity()),S.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=i.Zero()),i.TransformToRef(q,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),S,o)}(this,t,q,S)}},2408:(t,q,S)=>{"use strict";var o=S(599),B=S(496),z=S(527),L=S(624),r=S(561),e=S(609);r.c.prototype._partialLoadFile=function(t,q,S,o){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(t,(t=>{S[q]=t,S._internalCount++,6===S._internalCount&&o(S)}),void 0,void 0,!0,((t,q)=>{B&&t&&B(t.status+" "+t.statusText,q)}))},r.c.prototype._cascadeLoadFiles=function(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=[];B._internalCount=0;for(let z=0;z<6;z++)this._partialLoadFile(S[z],z,B,q,o)},r.c.prototype._cascadeLoadImgs=function(t,q,S,o){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5?arguments[5]:void 0;const L=[];L._internalCount=0;for(let r=0;r<6;r++)this._partialLoadImg(o[r],r,L,t,q,S,B,z)},r.c.prototype._partialLoadImg=function(t,q,S,o,B,r){let e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0;const Z=(0,L.d)();(0,z.p)(t,(t=>{S[q]=t,S._internalCount++,o&&o.removePendingData(Z),6===S._internalCount&&r&&r(B,S)}),((t,q)=>{o&&o.removePendingData(Z),e&&e(t,q)}),o?o.offlineProvider:null,C),o&&o.addPendingData(Z)},r.c.prototype.createCubeTextureBase=function(t,q,S,z){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,l=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,a=arguments.length>14&&void 0!==arguments[14]&&arguments[14],v=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const M=h||new o.b(this,7);M.isCube=!0,M.url=t,M.generateMipMaps=!z,M._lodGenerationScale=O,M._lodGenerationOffset=i,M._useSRGBBuffer=!!a&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!z),M!==h&&(M.label=t.substring(0,60)),this._doNotHandleContextLost||(M._extension=Z,M._files=S,M._buffer=v);const x=t;this._transformTextureUrl&&!h&&(t=this._transformTextureUrl(t));const k=Z??function(t){const q=t.split("?")[0],S=q.lastIndexOf(".");return S>-1?q.substring(S).toLowerCase():""}(t),V=(0,e.d)(k),J=(t,q)=>{M.dispose(),r?r(t,q):t&&B.c.Warn(t)},U=(o,r)=>{t===x?o&&J(o.status+" "+o.statusText,r):(B.c.Warn(`Failed to load ${t}, falling back to the ${x}`),this.createCubeTextureBase(x,q,S,!!z,L,J,C,Z,b,O,i,M,l,I,a,v))};if(V)V.then((o=>{const B=t=>{l&&l(M,t),o.loadCubeData(t,M,b,L,((t,q)=>{J(t,q)}))};v?B(v):S&&6===S.length?o.supportCascades?this._cascadeLoadFiles(q,(t=>B(t.map((t=>new Uint8Array(t))))),S,J):J("Textures type does not support cascades."):this._loadFile(t,(t=>B(new Uint8Array(t))),void 0,void 0,!0,U)}));else{if(!S||0===S.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(q,M,((t,q)=>{I&&I(t,q)}),S,J)}return this._internalTexturesCache.push(M),M}},13269:(t,q,S)=>{"use strict";S(496);var o=S(2351);S(599),S(720),S(595),S(2395),S(2358);o.e},12922:(t,q,S)=>{"use strict";S.d(q,{e:()=>B});var o=S(622);class B{constructor(t){this.value=this._toInt(t)}_toInt(t){return 0|t}add(t){return new B(this.value+t.value)}Kg(t){return new B(this.value-t.value)}multiply(t){return new B(Math.imul(this.value,t.value))}divide(t){return new B(this.value/t.value)}getClassName(){return B.ClassName}equals(t){return this.value===t.value}static FromValue(t){return new B(t)}toString(){return this.value.toString()}}B.ClassName="FlowGraphInteger",(0,o.c)("FlowGraphInteger",B)},12934:(t,q,S)=>{"use strict";S.d(q,{b:()=>B,e:()=>z});var o=S(678);class B{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Si=t}get m(){return this.Si}transformVector(t){return this.transformVectorToRef(t,new o.l)}transformVectorToRef(t,q){return q.x=t.x*this.Si[0]+t.y*this.Si[1],q.y=t.x*this.Si[2]+t.y*this.Si[3],q}Gi(){return this.toArray()}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let q=0;q<4;q++)t[q]=this.Si[q];return t}Xi(t){for(let q=0;q<4;q++)this.Si[q]=t[q];return this}multiplyToRef(t,q){const S=t.Si,o=this.Si,B=q.Si;return B[0]=S[0]*o[0]+S[1]*o[2],B[1]=S[0]*o[1]+S[1]*o[3],B[2]=S[2]*o[0]+S[3]*o[2],B[3]=S[2]*o[1]+S[3]*o[3],q}multiply(t){return this.multiplyToRef(t,new B)}divideToRef(t,q){const S=this.Si,o=t.Si,B=q.Si;return B[0]=S[0]/o[0],B[1]=S[1]/o[1],B[2]=S[2]/o[2],B[3]=S[3]/o[3],q}divide(t){return this.divideToRef(t,new B)}addToRef(t,q){const S=this.Si,o=t.m,B=q.m;return B[0]=S[0]+o[0],B[1]=S[1]+o[1],B[2]=S[2]+o[2],B[3]=S[3]+o[3],q}add(t){return this.addToRef(t,new B)}subtractToRef(t,q){const S=this.Si,o=t.m,B=q.m;return B[0]=S[0]-o[0],B[1]=S[1]-o[1],B[2]=S[2]-o[2],B[3]=S[3]-o[3],q}Kg(t){return this.subtractToRef(t,new B)}transpose(){const t=this.Si;return new B([t[0],t[2],t[1],t[3]])}determinant(){const t=this.Si;return t[0]*t[3]-t[1]*t[2]}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible");const q=this.Si,S=1/t;return new B([q[3]*S,-q[1]*S,-q[2]*S,q[0]*S])}equals(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const S=this.Si,o=t.m;return 0===q?S[0]===o[0]&&S[1]===o[1]&&S[2]===o[2]&&S[3]===o[3]:Math.abs(S[0]-o[0])<q&&Math.abs(S[1]-o[1])<q&&Math.abs(S[2]-o[2])<q&&Math.abs(S[3]-o[3])<q}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Si.join(", ")})`}}class z{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Si=t}get m(){return this.Si}transformVector(t){return this.transformVectorToRef(t,new o.o)}transformVectorToRef(t,q){const S=this.Si;return q.x=t.x*S[0]+t.y*S[1]+t.z*S[2],q.y=t.x*S[3]+t.y*S[4]+t.z*S[5],q.z=t.x*S[6]+t.y*S[7]+t.z*S[8],q}multiplyToRef(t,q){const S=t.Si,o=this.Si,B=q.m;return B[0]=S[0]*o[0]+S[1]*o[3]+S[2]*o[6],B[1]=S[0]*o[1]+S[1]*o[4]+S[2]*o[7],B[2]=S[0]*o[2]+S[1]*o[5]+S[2]*o[8],B[3]=S[3]*o[0]+S[4]*o[3]+S[5]*o[6],B[4]=S[3]*o[1]+S[4]*o[4]+S[5]*o[7],B[5]=S[3]*o[2]+S[4]*o[5]+S[5]*o[8],B[6]=S[6]*o[0]+S[7]*o[3]+S[8]*o[6],B[7]=S[6]*o[1]+S[7]*o[4]+S[8]*o[7],B[8]=S[6]*o[2]+S[7]*o[5]+S[8]*o[8],q}multiply(t){return this.multiplyToRef(t,new z)}divideToRef(t,q){const S=this.Si,o=t.m,B=q.m;return B[0]=S[0]/o[0],B[1]=S[1]/o[1],B[2]=S[2]/o[2],B[3]=S[3]/o[3],B[4]=S[4]/o[4],B[5]=S[5]/o[5],B[6]=S[6]/o[6],B[7]=S[7]/o[7],B[8]=S[8]/o[8],q}divide(t){return this.divideToRef(t,new z)}addToRef(t,q){const S=this.Si,o=t.m,B=q.m;return B[0]=S[0]+o[0],B[1]=S[1]+o[1],B[2]=S[2]+o[2],B[3]=S[3]+o[3],B[4]=S[4]+o[4],B[5]=S[5]+o[5],B[6]=S[6]+o[6],B[7]=S[7]+o[7],B[8]=S[8]+o[8],q}add(t){return this.addToRef(t,new z)}subtractToRef(t,q){const S=this.Si,o=t.m,B=q.m;return B[0]=S[0]-o[0],B[1]=S[1]-o[1],B[2]=S[2]-o[2],B[3]=S[3]-o[3],B[4]=S[4]-o[4],B[5]=S[5]-o[5],B[6]=S[6]-o[6],B[7]=S[7]-o[7],B[8]=S[8]-o[8],q}Kg(t){return this.subtractToRef(t,new z)}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let q=0;q<9;q++)t[q]=this.Si[q];return t}Gi(){return this.toArray()}Xi(t){for(let q=0;q<9;q++)this.Si[q]=t[q];return this}transpose(){const t=this.Si;return new z([t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]])}determinant(){const t=this.Si;return t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6])}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible");const q=this.Si,S=1/t;return new z([(q[4]*q[8]-q[5]*q[7])*S,(q[2]*q[7]-q[1]*q[8])*S,(q[1]*q[5]-q[2]*q[4])*S,(q[5]*q[6]-q[3]*q[8])*S,(q[0]*q[8]-q[2]*q[6])*S,(q[2]*q[3]-q[0]*q[5])*S,(q[3]*q[7]-q[4]*q[6])*S,(q[1]*q[6]-q[0]*q[7])*S,(q[0]*q[4]-q[1]*q[3])*S])}equals(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const S=this.Si,o=t.m;return 0===q?S[0]===o[0]&&S[1]===o[1]&&S[2]===o[2]&&S[3]===o[3]&&S[4]===o[4]&&S[5]===o[5]&&S[6]===o[6]&&S[7]===o[7]&&S[8]===o[8]:Math.abs(S[0]-o[0])<q&&Math.abs(S[1]-o[1])<q&&Math.abs(S[2]-o[2])<q&&Math.abs(S[3]-o[3])<q&&Math.abs(S[4]-o[4])<q&&Math.abs(S[5]-o[5])<q&&Math.abs(S[6]-o[6])<q&&Math.abs(S[7]-o[7])<q&&Math.abs(S[8]-o[8])<q}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Si.join(", ")})`}}},12940:(t,q,S)=>{"use strict";var o;function B(t,q,S,o){switch(q){case"Animation":return o?t.animations.find((t=>t.uniqueId===S))??null:t.animations[S]??null;case"AnimationGroup":return o?t.animationGroups.find((t=>t.uniqueId===S))??null:t.animationGroups[S]??null;case"Mesh":return o?t.meshes.find((t=>t.uniqueId===S))??null:t.meshes[S]??null;case"Material":return o?t.materials.find((t=>t.uniqueId===S))??null:t.materials[S]??null;case"Ti":return o?t.cameras.find((t=>t.uniqueId===S))??null:t.cameras[S]??null;case"Light":return o?t.lights.find((t=>t.uniqueId===S))??null:t.lights[S]??null;default:return null}}S.d(q,{d:()=>B}),function(t){t.Animation="Animation",t.AnimationGroup="AnimationGroup",t.Mesh="Mesh",t.Material="Material",t.Ti="Ti",t.Light="Light"}(o||(o={}))},12974:(t,q,S)=>{"use strict";S.d(q,{b:()=>B});var o=S(12981);class B extends o.d{constructor(t,q){if(super(t),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),q)for(const S of q)this._eventsSignalOutputs[S]=this._registerSignalOutput(S+"Event")}_executeOnTick(t){}_startPendingTasks(t){t._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(t),this._resetAfterCanceled(t)),this._preparePendingTasks(t),t._addPendingBlock(this),this.out._activateSignal(t),t._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(t){t._deleteExecutionVariable(this,"_initialized"),t._removePendingBlock(this)}}},12946:(t,q,S)=>{"use strict";S.d(q,{d:()=>C});var o=S(624),B=S(622),z=S(12949),L=S(485),r=S(12913);class e extends z.d{constructor(t,q,S,o){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.defaultValue,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(t,q,S),this.richType=o,this._defaultValue=B,this._optional=z,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new L.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(t){this._isDisabled!==t&&(this._isDisabled=t,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(t,q){q._getConnectionValue(this)!==t&&(q._setConnectionValue(this,t),this.onValueChangedObservable.notifyObservers(t))}resetToDefaultValue(t){t._setConnectionValue(this,this._defaultValue)}connectTo(t){this._isDisabled||super.connectTo(t)}_getValueOrDefault(t){const q=t._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(q):q}getValue(t){if(1===this.connectionType){t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(t);const q=this._getValueOrDefault(t);return this._lastValue=q,this.richType.typeTransformer?this.richType.typeTransformer(q):q}const q=this.isConnected()?this._connectedPoint[0].getValue(t):this._getValueOrDefault(t);return this._lastValue=q,this.richType.typeTransformer?this.richType.typeTransformer(q):q}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.richType={},this.richType.serialize(t.richType),t.optional=this._optional,(0,r.e)("defaultValue",this._defaultValue,t)}}(0,B.c)("FlowGraphDataConnection",e);class C{constructor(t){var q;this.config=t,this.uniqueId=(0,o.d)(),this.name=(null===(q=this.config)||void 0===q?void 0:q.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(t){}registerDataInput(t,q,S){const o=new e(t,0,this,q,S);return this.dataInputs.push(o),o}registerDataOutput(t,q,S){const o=new e(t,1,this,q,S);return this.dataOutputs.push(o),o}getDataInput(t){return this.dataInputs.find((q=>q.name===t))}getDataOutput(t){return this.dataOutputs.find((q=>q.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.e;if(t.uniqueId=this.uniqueId,t.config={},this.config){const S=this.config,o=Object.keys(S);for(const B of o)q(B,S[B],t.config)}t.dataInputs=[],t.dataOutputs=[],t.className=this.getClassName();for(const S of this.dataInputs){const q={};S.serialize(q),t.dataInputs.push(q)}for(const S of this.dataOutputs){const q={};S.serialize(q),t.dataOutputs.push(q)}}deserialize(t){}_log(t,q,S){var o;null===(o=t.logger)||void 0===o||o.addLogItem({action:q,payload:S,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12949:(t,q,S)=>{"use strict";S.d(q,{d:()=>z});var o,B=S(624);!function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(o||(o={}));class z{constructor(t,q,S){this._ownerBlock=S,this._connectedPoint=[],this.uniqueId=(0,B.d)(),this.connectedPointIds=[],this.name=t,this._connectionType=q}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(t){if(this._connectionType===t._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||t._isSingularConnection()&&t._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(t),t._connectedPoint.push(this)}disconnectFrom(t){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const S=this._connectedPoint.indexOf(t),o=t._connectedPoint.indexOf(this);-1!==S&&-1!==o&&(q&&this._connectedPoint.splice(S,1),t._connectedPoint.splice(o,1))}disconnectFromAll(){for(const t of this._connectedPoint)this.disconnectFrom(t,!1);this._connectedPoint.length=0}dispose(){for(const t of this._connectedPoint)this.disconnectFrom(t)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.uniqueId=this.uniqueId,t.name=this.name,t._connectionType=this._connectionType,t.connectedPointIds=[],t.className=this.getClassName();for(const q of this._connectedPoint)t.connectedPointIds.push(q.uniqueId)}getClassName(){return"FGConnection"}deserialize(t){this.uniqueId=t.uniqueId,this.name=t.name,this._connectionType=t._connectionType,this.connectedPointIds=t.connectedPointIds}}},12910:(t,q,S)=>{"use strict";S.d(q,{d:()=>M});var o,B=S(485),z=S(653),L=S(658),r=S(624),e=S(12913),C=S(12940),Z=S(496);!function(t){t.ExecuteBlock="ExecuteBlock",t.ExecuteEvent="ExecuteEvent",t.TriggerConnection="TriggerConnection",t.ContextVariableSet="ContextVariableSet",t.GlobalVariableSet="GlobalVariableSet",t.GlobalVariableDelete="GlobalVariableDelete",t.GlobalVariableGet="GlobalVariableGet",t.AddConnection="AddConnection",t.GetConnectionValue="GetConnectionValue",t.SetConnectionValue="SetConnectionValue",t.ActivateSignal="ActivateSignal",t.ContextVariableGet="ContextVariableGet"}(o||(o={}));class b{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(t){if(t.time||(t.time=Date.now()),this.log.push(t),this.logToConsole){var q;const S=null===(q=t.payload)||void 0===q?void 0:q.value;"object"===typeof S&&S.getClassName?Z.c.Log(`[FGLog] ${t.className}:${t.uniqueId.split("-")[0]} ${t.action} - ${JSON.stringify(S.getClassName())}: ${S.toString()}`):Z.c.Log(`[FGLog] ${t.className}:${t.uniqueId.split("-")[0]} ${t.action} - ${JSON.stringify(t.payload)}`)}}getItemsOfType(t){return this.log.filter((q=>q.action===t))}}class O{get enableLogging(){return this._enableLogging}set enableLogging(t){this._enableLogging!==t&&(this._enableLogging=t,this._enableLogging?(this.logger=new b,this.logger.logToConsole=!0):this.logger=null)}constructor(t){this.uniqueId=(0,r.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new B.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=t,this.assetsContext=t.assetsContext??t.Tk}hasVariable(t){return t in this._userVariables}setVariable(t,q){var S;this._userVariables[t]=q,null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:t,value:q}})}getAsset(t,q){return(0,C.d)(this.assetsContext,t,q)}getVariable(t){var q;return null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:t,value:this._userVariables[t]}}),this._userVariables[t]}get userVariables(){return this._userVariables}va(){return this._configuration.Tk}_getUniqueIdPrefixedName(t,q){return`${t.uniqueId}_${q}`}_getGlobalContextVariable(t,q){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:t,defaultValue:q,possibleValue:this._globalContextVariables[t]}}),this._hasGlobalContextVariable(t)?this._globalContextVariables[t]:q}_setGlobalContextVariable(t,q){var S;null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:t,value:q}}),this._globalContextVariables[t]=q}_deleteGlobalContextVariable(t){var q;null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:t}}),delete this._globalContextVariables[t]}_hasGlobalContextVariable(t){return t in this._globalContextVariables}_setExecutionVariable(t,q,S){this._executionVariables[this._getUniqueIdPrefixedName(t,q)]=S}_getExecutionVariable(t,q,S){return this._hasExecutionVariable(t,q)?this._executionVariables[this._getUniqueIdPrefixedName(t,q)]:S}_deleteExecutionVariable(t,q){delete this._executionVariables[this._getUniqueIdPrefixedName(t,q)]}_hasExecutionVariable(t,q){return this._getUniqueIdPrefixedName(t,q)in this._executionVariables}_hasConnectionValue(t){return t.uniqueId in this._connectionValues}_setConnectionValue(t,q){var S;this._connectionValues[t.uniqueId]=q,null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:t.uniqueId,value:q}})}_setConnectionValueByKey(t,q){this._connectionValues[t]=q}_getConnectionValue(t){var q;return null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:t.uniqueId,value:this._connectionValues[t.uniqueId]}}),this._connectionValues[t.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(t){this._pendingBlocks.includes(t)||(this._pendingBlocks.push(t),this._pendingBlocks.sort(((t,q)=>t.priority-q.priority)))}_removePendingBlock(t){const q=this._pendingBlocks.indexOf(t);-1!==q&&this._pendingBlocks.splice(q,1)}_clearPendingBlocks(){for(const t of this._pendingBlocks)t._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(t){var q;this.onNodeExecutedObservable.notifyObservers(t),null===(q=this.logger)||void 0===q||q.addLogItem({time:Date.now(),className:t.getClassName(),uniqueId:t.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(t){this._setGlobalContextVariable("timeSinceStart",t.timeSinceStart),this._setGlobalContextVariable("deltaTime",t.deltaTime);for(const S of this._pendingBlocks){var q;null===(q=S._executeOnTick)||void 0===q||q.call(S,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.e;t.uniqueId=this.uniqueId,t._userVariables={};for(const o in this._userVariables)q(o,this._userVariables[o],t._userVariables);t._connectionValues={};for(const o in this._connectionValues)q(o,this._connectionValues[o],t._connectionValues);var S;this.assetsContext!==this.va()&&(t._assetsContext={meshes:this.assetsContext.meshes.map((t=>t.id)),materials:this.assetsContext.materials.map((t=>t.id)),textures:this.assetsContext.textures.map((t=>t.name)),animations:this.assetsContext.animations.map((t=>t.name)),lights:this.assetsContext.lights.map((t=>t.id)),cameras:this.assetsContext.cameras.map((t=>t.id)),rm:null===(S=this.assetsContext.rm)||void 0===S?void 0:S.map((t=>t.name)),skeletons:this.assetsContext.skeletons.map((t=>t.id)),zi:this.assetsContext.zi.map((t=>t.name)),geometries:this.assetsContext.geometries.map((t=>t.id)),multiMaterials:this.assetsContext.multiMaterials.map((t=>t.id)),transformNodes:this.assetsContext.transformNodes.map((t=>t.id))})}getClassName(){return"FlowGraphContext"}}(0,z.e)([(0,L.C)()],O.prototype,"uniqueId",void 0);var i=S(12942),h=S(2450);class l{constructor(t){this.onEventTriggeredObservable=new B.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=t,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Qi.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const t=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:t}}),this._startingTime+=t})),this._meshPickedObserver=this._scene.onPointerObservable.add((t=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:t})}),h.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((t=>{const q=t.pointerId,S=t.mesh,o=this._pointerUnderMeshState[q];!o&&S?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:q,mesh:S}}):o&&!S?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:q,mesh:o}}):o&&S&&o!==S&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:q,mesh:o,over:S}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:q,mesh:S,out:o}})),this._pointerUnderMeshState[q]=S}),h.b.POINTERMOVE)}dispose(){var t,q,S,o,B;null===(t=this._sceneDisposeObserver)||void 0===t||t.remove(),null===(q=this._sceneReadyObserver)||void 0===q||q.remove(),null===(S=this._sceneOnBeforeRenderObserver)||void 0===S||S.remove(),null===(o=this._meshPickedObserver)||void 0===o||o.remove(),null===(B=this._meshUnderPointerObserver)||void 0===B||B.remove(),this.onEventTriggeredObservable.clear()}}var I,a=S(12957);!function(t){t[t.Stopped=0]="Stopped",t[t.Started=1]="Started"}(I||(I={}));class v{get state(){return this._state}set state(t){this._state=t,this.onStateChangedObservable.notifyObservers(t)}constructor(t){this.onStateChangedObservable=new B.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=t.Tk,this._sceneEventCoordinator=new l(this._scene),this._coordinator=t.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((t=>{for(const q of this._executionContexts){const S=this._getContextualOrder(t.type,q);for(const o of S)if(!o._executeEvent(q,t.payload))break}switch(t.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const q of this._executionContexts)q._notifyOnTick(t.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const t=new O({Tk:this._scene,coordinator:this._coordinator});return this._executionContexts.push(t),t}getContext(t){return this._executionContexts[t]}addEventBlock(t){if("PointerOver"!==t.type&&"PointerOut"!==t.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==t.type&&this._eventBlocks[t.type].push(t),1===this.state)for(const q of this._executionContexts)t._startPendingTasks(q);else this.onStateChangedObservable.addOnce((q=>{if(1===q)for(const S of this._executionContexts)t._startPendingTasks(S)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((t=>{1===t&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const t of this._executionContexts)for(const q in this._eventBlocks){const S=this._getContextualOrder(q,t);for(const q of S)q._startPendingTasks(t)}}_getContextualOrder(t,q){const S=this._eventBlocks[t].sort(((t,q)=>q.initPriority-t.initPriority));if("MeshPick"===t){const t=[];for(const o of S){const B=o.asset.getValue(q);let z=0;for(;z<S.length;z++){const t=S[z].asset.getValue(q);if(B&&t&&(0,a.m)(B,t))break}t.splice(z,0,o)}return t}return S}dispose(){var t;if(0!==this.state){this.state=0;for(const t of this._executionContexts)t._clearPendingBlocks();this._executionContexts.length=0;for(const t in this._eventBlocks)this._eventBlocks[t].length=0;null===(t=this._eventObserver)||void 0===t||t.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(t){const q=[],S=new Set;for(const o in this._eventBlocks)for(const t of this._eventBlocks[o])q.push(t),S.add(t.uniqueId);for(;q.length>0;){const o=q.pop();t(o);for(const t of o.dataInputs)for(const o of t._connectedPoint)S.has(o._ownerBlock.uniqueId)||(q.push(o._ownerBlock),S.add(o._ownerBlock.uniqueId));if(o instanceof i.d)for(const t of o.signalOutputs)for(const o of t._connectedPoint)S.has(o._ownerBlock.uniqueId)||(q.push(o._ownerBlock),S.add(o._ownerBlock.uniqueId))}}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},q=arguments.length>1?arguments[1]:void 0;t.allBlocks=[],this.visitAllBlocks((q=>{const S={};q.serialize(S),t.allBlocks.push(S)})),t.executionContexts=[];for(const S of this._executionContexts){const o={};S.serialize(o,q),t.executionContexts.push(o)}}}class M{constructor(t){this.config=t,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Tk.Qi.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Tk.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const t=this._executeOnNextFrame.slice(0);if(t.length)for(const q of t){this.notifyCustomEvent(q.id,q.data,!1);const t=this._executeOnNextFrame.findIndex((t=>t.uniqueId===q.uniqueId));-1!==t&&this._executeOnNextFrame.splice(t,1)}}));(M.SceneCoordinators.get(this.config.Tk)??[]).push(this)}createGraph(){const t=new v({Tk:this.config.Tk,coordinator:this});return this._flowGraphs.push(t),t}removeGraph(t){const q=this._flowGraphs.indexOf(t);-1!==q&&(t.dispose(),this._flowGraphs.splice(q,1))}start(){for(const t of this._flowGraphs)t.start()}dispose(){var t,q;for(const B of this._flowGraphs)B.dispose();this._flowGraphs.length=0,null===(t=this._disposeObserver)||void 0===t||t.remove(),null===(q=this._onBeforeRenderObserver)||void 0===q||q.remove();const S=M.SceneCoordinators.get(this.config.Tk)??[],o=S.indexOf(this);-1!==o&&S.splice(o,1)}serialize(t,q){t._flowGraphs=[];for(const S of this._flowGraphs){const o={};S.serialize(o,q),t._flowGraphs.push(o)}t.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(t){let q=this._customEventsMap.get(t);return q||(q=new B.b,this._customEventsMap.set(t,q)),q}notifyCustomEvent(t,q){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:t,data:q,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(t)){const q=this._eventExecutionCounter.get(t);if(this._eventExecutionCounter.set(t,q+1),q>=M.MaxEventTypeExecutionPerFrame)return void(q===M.MaxEventTypeExecutionPerFrame&&Z.c.Warn(`FlowGraphCoordinator: Too many executions of event "${t}".`))}else this._eventExecutionCounter.set(t,1);const S=this._customEventsMap.get(t);S&&S.notifyObservers(q)}}M.MaxEventsPerType=30,M.MaxEventTypeExecutionPerFrame=30,M.SceneCoordinators=new Map},12966:(t,q,S)=>{"use strict";S.d(q,{c:()=>B});var o=S(12974);class B extends o.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(t){t._notifyExecuteNode(this),this.done._activateSignal(t)}}},12942:(t,q,S)=>{"use strict";S.d(q,{d:()=>r});var o=S(12946),B=S(12949),z=S(622);class L extends B.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(t){super.connectTo(t),this._connectedPoint.sort(((t,q)=>q.priority-t.priority))}_activateSignal(t){var q;if(null===(q=t.logger)||void 0===q||q.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(t,this),t._increaseExecutionId();else for(const S of this._connectedPoint)S._activateSignal(t)}}(0,z.c)("FlowGraphSignalConnection",L);class r extends o.d{constructor(t){super(t),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(t){const q=new L(t,0,this);return this.signalInputs.push(q),q}_registerSignalOutput(t){const q=new L(t,1,this);return this.signalOutputs.push(q),q}_unregisterSignalInput(t){const q=this.signalInputs.findIndex((q=>q.name===t));-1!==q&&(this.signalInputs[q].dispose(),this.signalInputs.splice(q,1))}_unregisterSignalOutput(t){const q=this.signalOutputs.findIndex((q=>q.name===t));-1!==q&&(this.signalOutputs[q].dispose(),this.signalOutputs.splice(q,1))}_reportError(t,q){this.error.payload="string"===typeof q?new Error(q):q,this.error._activateSignal(t)}getSignalInput(t){return this.signalInputs.find((q=>q.name===t))}getSignalOutput(t){return this.signalOutputs.find((q=>q.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.signalInputs=[],t.signalOutputs=[];for(const q of this.signalInputs){const S={};q.serialize(S),t.signalInputs.push(S)}for(const q of this.signalOutputs){const S={};q.serialize(S),t.signalOutputs.push(S)}}deserialize(t){for(let q=0;q<t.signalInputs.length;q++){const S=this.getSignalInput(t.signalInputs[q].name);if(!S)throw new Error("Could not find signal input with name "+t.signalInputs[q].name+" in block "+t.className);S.deserialize(t.signalInputs[q])}for(let q=0;q<t.signalOutputs.length;q++){const S=this.getSignalOutput(t.signalOutputs[q].name);if(!S)throw new Error("Could not find signal output with name "+t.signalOutputs[q].name+" in block "+t.className);S.deserialize(t.signalOutputs[q])}}getClassName(){return"FlowGraphExecutionBlock"}}},12981:(t,q,S)=>{"use strict";S.d(q,{d:()=>B});var o=S(12942);class B extends o.d{constructor(t){super(t),this.out=this._registerSignalOutput("out")}}},12927:(t,q,S)=>{"use strict";S.d(q,{D:()=>i,G:()=>h,K:()=>l,M:()=>H,O:()=>j,R:()=>U,V:()=>J,b:()=>C,f:()=>O,h:()=>V,l:()=>I,o:()=>a,s:()=>v,v:()=>b,x:()=>k,z:()=>Z});var o,B=S(678),z=S(706),L=S(12922),r=S(12934);!function(t){t.Any="any",t.String="string",t.Number="number",t.Boolean="boolean",t.Object="object",t.Integer="FlowGraphInteger",t.Vector2="Vector2",t.wi="wi",t.Vector4="Vector4",t.Quaternion="Quaternion",t.Matrix="Matrix",t.Matrix2D="Matrix2D",t.Matrix3D="Matrix3D",t.aj="aj",t.bj="bj"}(o||(o={}));class e{constructor(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=t,this.defaultValue=q,this.animationType=S}serialize(t){t.typeName=this.typeName,t.defaultValue=this.defaultValue}}const C=new e("any",void 0),Z=new e("string",""),b=new e("number",0,0),O=new e("boolean",!1),i=new e("Vector2",B.l.Zero(),5),h=new e("wi",B.o.Zero(),1),l=new e("Vector4",B.s.Zero()),I=new e("Matrix",B.e.Identity(),3),a=new e("Matrix2D",new r.b),v=new e("Matrix3D",new r.e),M=new e("aj",z.c.Black(),4),x=new e("bj",new z.d(0,0,0,0),7),k=new e("Quaternion",B.g.Identity(),2);k.typeTransformer=t=>{if(t.getClassName){if("Vector4"===t.getClassName())return B.g.ti(t.Gi());if("wi"===t.getClassName())return B.g.FromEulerVector(t);if("Matrix"===t.getClassName())return B.g.FromRotationMatrix(t)}return t};const V=new e("FlowGraphInteger",new L.e(0),0);function J(t){const q=t;switch(typeof t){case"string":return Z;case"number":return b;case"boolean":return O;case"object":if(q.getClassName)switch(q.getClassName()){case"Vector2":return i;case"wi":return h;case"Vector4":return l;case"Matrix":return I;case"aj":return M;case"bj":return x;case"Quaternion":return k;case"FlowGraphInteger":return V;case"Matrix2D":return a;case"Matrix3D":return v}return C;default:return C}}function U(t){switch(t){case"string":return Z;case"number":return b;case"boolean":return O;case"Vector2":return i;case"wi":return h;case"Vector4":return l;case"Matrix":return I;case"aj":return M;case"bj":return x;case"Quaternion":return k;case"FlowGraphInteger":return V;case"Matrix2D":return a;case"Matrix3D":return v;default:return C}}function H(t){switch(t){case"number":default:return 0;case"Vector2":return 5;case"wi":return 1;case"Matrix":return 3;case"aj":return 4;case"bj":return 7;case"Quaternion":return 2}}function j(t){switch(t){case 0:return b;case 5:return i;case 1:return h;case 3:return I;case 4:return M;case 7:return x;case 2:return k;default:return C}}},12913:(t,q,S)=>{"use strict";S.d(q,{c:()=>Z,e:()=>C,i:()=>b});var o=S(706),B=S(678),z=S(12922),L=S(12927),r=S(12934);function e(t){return"Vector2"===t||"wi"===t||"Vector4"===t||"Quaternion"===t||"aj"===t||"bj"===t}function C(t,q,S){var o;const B=(null===q||void 0===q||null===(o=q.getClassName)||void 0===o?void 0:o.call(q))??"";if(e(B)||function(t){return"Matrix"===t||"Matrix2D"===t||"Matrix3D"===t}(B))S[t]={value:q.Gi(),className:B};else if("FlowGraphInteger"===B)S[t]={value:q.value,className:B};else if(B&&(q.id||q.name))S[t]={id:q.id,name:q.name,className:B};else{if("object"===typeof q)throw new Error(`Could not serialize value ${q}`);S[t]=q}}function Z(t,q,S,C){const b=q[t];let O;const i=(null===b||void 0===b?void 0:b.type)??(null===b||void 0===b?void 0:b.className);if(function(t){return"Mesh"===t||"AbstractMesh"===t||"GroundMesh"===t||"InstanceMesh"===t||"LinesMesh"===t||"GoldbergMesh"===t||"GreasedLineMesh"===t||"TrailMesh"===t}(i)){let t=C.meshes.filter((t=>b.id?t.id===b.id:t.name===b.name));0===t.length&&(t=C.transformNodes.filter((t=>b.id?t.id===b.id:t.name===b.name))),O=b.uniqueId?t.find((t=>t.uniqueId===b.uniqueId)):t[0]}else if(e(i))O=function(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===t)return B.l.ti(q);if("wi"===t)return S&&(q[2]*=-1),B.o.ti(q);if("Vector4"===t)return B.s.ti(q);if("Quaternion"===t)return S&&(q[2]*=-1,q[3]*=-1),B.g.ti(q);if("aj"===t)return new o.c(q[0],q[1],q[2]);if("bj"===t)return new o.d(q[0],q[1],q[2],q[3]);throw new Error(`Unknown vector class name ${t}`)}(i,b.value);else if(function(t){return"AnimationGroup"===t}(i)){const t=C.animationGroups.filter((t=>t.name===b.name));O=1===t.length?t[0]:t.find((t=>t.uniqueId===b.uniqueId))}else O="Matrix"===i?B.e.ti(b.value):"Matrix2D"===i?new r.b(b.value):"Matrix3D"===i?new r.e(b.value):"FlowGraphInteger"===i?z.e.FromValue(b.value):"number"===i||"string"===i||"boolean"===i?b.value[0]:b&&void 0!==b.value?b.value:Array.isArray(b)?b.reduce(((t,q)=>q.eventData?(t[q.id]={type:(0,L.R)(q.type)},"undefined"!==typeof q.value&&(t[q.id].value=Z("value",q,S,C)),t):t),{}):b;return O}function b(t){return"FlowGraphJsonPointerParserBlock"===t}},12957:(t,q,S)=>{"use strict";function o(t,q){return!(!t.parent||t.parent!==q&&!o(t.parent,q))}function B(t){if(t.getClassName)return t.getClassName()}function z(t,q){return t===q&&("Vector2"===t||"wi"===t||"Vector4"===t||"Quaternion"===t)}function L(t,q){return t===q&&("Matrix"===t||"Matrix2D"===t||"Matrix3D"===t)}function r(t,q){return"FlowGraphInteger"===t&&"FlowGraphInteger"===q}function e(t,q){const S="number"===typeof t||"number"===typeof(null===t||void 0===t?void 0:t.value);return S&&!q?!isNaN(C(t)):S}function C(t){return"number"===typeof t?t:t.value}S.d(q,{c:()=>r,d:()=>L,h:()=>z,i:()=>B,m:()=>o,q:()=>C,u:()=>e})},12343:(t,q,S)=>{"use strict";S.r(q),S.d(q,{SceneInstrumentation:()=>z});var o=S(490),B=S(2404);class z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(t){t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.Tk.onBeforeActiveMeshesEvaluationObservable.add((()=>{o.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Tk.onAfterActiveMeshesEvaluationObservable.add((()=>{o.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Tk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Tk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(t){t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.Tk.onBeforeRenderTargetsRenderObservable.add((()=>{o.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Tk.onAfterRenderTargetsRenderObservable.add((()=>{o.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Tk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Tk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(t){t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.Tk.onBeforeParticlesRenderingObservable.add((()=>{o.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Tk.onAfterParticlesRenderingObservable.add((()=>{o.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Tk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Tk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(t){t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.Tk.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.Tk.onBeforeSpritesRenderingObservable.add((()=>{o.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Tk.onAfterSpritesRenderingObservable.add((()=>{o.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Tk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Tk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(t){t!==this._capturePhysicsTime&&this.Tk.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.Tk.onBeforePhysicsObservable.add((()=>{o.f.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Tk.onAfterPhysicsObservable.add((()=>{o.f.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Tk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Tk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(t){t!==this._captureAnimationsTime&&(this._captureAnimationsTime=t,t?this._onAfterAnimationsObserver=this.Tk.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Tk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(t){this._captureFrameTime=t}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(t){this._captureInterFrameTime=t}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(t){t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.Tk.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),o.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Tk.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),o.f.EndPerformanceCounter("Main render")}))):(this.Tk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Tk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(t){t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.Tk.onBeforeCameraRenderObservable.add((t=>{this._cameraRenderTime.beginMonitoring(),o.f.StartPerformanceCounter(`Rendering camera ${t.name}`)})),this._onAfterCameraRenderObserver=this.Tk.onAfterCameraRenderObservable.add((t=>{this._cameraRenderTime.endMonitoring(!1),o.f.EndPerformanceCounter(`Rendering camera ${t.name}`)}))):(this.Tk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Tk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Tk.getEngine()._drawCalls}constructor(t){this.Tk=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new B.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new B.c,this._captureFrameTime=!1,this._frameTime=new B.c,this._captureRenderTime=!1,this._renderTime=new B.c,this._captureInterFrameTime=!1,this._interFrameTime=new B.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new B.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new B.c,this._capturePhysicsTime=!1,this._physicsTime=new B.c,this._captureAnimationsTime=!1,this._animationsTime=new B.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new B.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(o.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Tk.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=t.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(o.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Pi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Pi(),this._captureParticlesRenderTime&&this._particlesRenderTime.Pi(),this._captureSpritesRenderTime&&this._spritesRenderTime.Pi(),this._captureRenderTime&&this._renderTime.Pi(),this._captureCameraRenderTime&&this._cameraRenderTime.Pi()}))}dispose(){this._disposed||(this.Tk.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Tk.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Tk.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Tk.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Tk.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Tk.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Tk.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Tk.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Tk.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Tk.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Tk.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Tk.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Tk.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Tk.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Tk.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Tk.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Tk.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Tk=null,this._disposed=!0)}}},12901:(t,q,S)=>{"use strict";S.d(q,{b:()=>Z});var o=S(653),B=S(658),z=S(678),L=S(698),r=S(12037),e=S(12094),C=S(622);L.e.AddNodeConstructor("Light_Type_1",((t,q)=>()=>new Z(t,z.o.Zero(),q)));class Z extends e.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(t){this._shadowFrustumSize=t,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(t){this._shadowOrthoScale=t,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(t){this._orthoLeft=t}get orthoRight(){return this._orthoRight}set orthoRight(t){this._orthoRight=t}get orthoTop(){return this._orthoTop}set orthoTop(t){this._orthoTop=t}get orthoBottom(){return this._orthoBottom}set orthoBottom(t){this._orthoBottom=t}constructor(t,q,S){super(t,S),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=q.scale(-1),this.direction=q}getClassName(){return"hb"}getTypeID(){return r.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(t,q,S){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(t):this._setDefaultAutoExtendShadowProjectionMatrix(t,q,S)}_setDefaultFixedFrustumShadowProjectionMatrix(t){const q=this.va().activeCamera;q&&z.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:q.Ci,void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,t,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(t,q,S){const o=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const t=z.o.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let o=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let L=0;L<S.length;L++){const r=S[L];if(!r)continue;const e=r.getBoundingInfo().boundingBox;for(let S=0;S<e.vectorsWorld.length;S++)z.o.TransformCoordinatesToRef(e.vectorsWorld[S],q,t),t.x<this._orthoLeft&&(this._orthoLeft=t.x),t.y<this._orthoBottom&&(this._orthoBottom=t.y),t.x>this._orthoRight&&(this._orthoRight=t.x),t.y>this._orthoTop&&(this._orthoTop=t.y),this.autoCalcShadowZBounds&&(t.z<o&&(o=t.z),t.z>B&&(B=t.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=o,this._shadowMaxZ=B)}const B=this._orthoRight-this._orthoLeft,L=this._orthoTop-this._orthoBottom,r=void 0!==this.shadowMinZ?this.shadowMinZ:(null===o||void 0===o?void 0:o.Ci)||0,e=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===o||void 0===o?void 0:o.maxZ)||1e4,C=this.va().getEngine().useReverseDepthBuffer;z.e.OrthoOffCenterLHToRef(this._orthoLeft-B*this.shadowOrthoScale,this._orthoRight+B*this.shadowOrthoScale,this._orthoBottom-L*this.shadowOrthoScale,this._orthoTop+L*this.shadowOrthoScale,C?e:r,C?r:e,t,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,q){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,q),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,q),this)}transferToNodeMaterialEffect(t,q){return this.computeTransformedInformation()?(t.setFloat3(q,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(t.setFloat3(q,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(t){const q=this._scene.getEngine();return!q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}getDepthMaxZ(t){const q=this._scene.getEngine();return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:1}prepareLightSpecificDefines(t,q){t["DIRLIGHT"+q]=!0}}(0,o.e)([(0,B.C)()],Z.prototype,"shadowFrustumSize",null),(0,o.e)([(0,B.C)()],Z.prototype,"shadowOrthoScale",null),(0,o.e)([(0,B.C)()],Z.prototype,"autoUpdateExtends",void 0),(0,o.e)([(0,B.C)()],Z.prototype,"autoCalcShadowZBounds",void 0),(0,o.e)([(0,B.C)("orthoLeft")],Z.prototype,"_orthoLeft",void 0),(0,o.e)([(0,B.C)("orthoRight")],Z.prototype,"_orthoRight",void 0),(0,o.e)([(0,B.C)("orthoTop")],Z.prototype,"_orthoTop",void 0),(0,o.e)([(0,B.C)("orthoBottom")],Z.prototype,"_orthoBottom",void 0),(0,C.c)("BABYLON.DirectionalLight",Z)},13200:(t,q,S)=>{"use strict";S.d(q,{b:()=>Z});var o=S(653),B=S(658),z=S(678),L=S(706),r=S(698),e=S(12037),C=S(622);r.e.AddNodeConstructor("Light_Type_3",((t,q)=>()=>new Z(t,z.o.Zero(),q)));class Z extends e.b{constructor(t,q,S){super(t,S),this.groundColor=new L.c(0,0,0),this.direction=q||z.o.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ib"}setDirectionToTarget(t){return this.direction=z.o.Normalize(t.Kg(z.o.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(t,q){const S=z.o.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",S.x,S.y,S.z,0,q),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.bb),q),this}transferToNodeMaterialEffect(t,q){const S=z.o.Normalize(this.direction);return t.setFloat3(q,S.x,S.y,S.z),this}Ai(){return this._worldMatrix||(this._worldMatrix=z.e.Identity()),this._worldMatrix}getTypeID(){return e.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(t,q){t["HEMILIGHT"+q]=!0}}(0,o.e)([(0,B.j)()],Z.prototype,"groundColor",void 0),(0,o.e)([(0,B.B)()],Z.prototype,"direction",void 0),(0,C.c)("BABYLON.HemisphericLight",Z)},12883:(t,q,S)=>{"use strict";S.d(q,{e:()=>b});var o=S(653),B=S(658),z=S(678),L=S(698),r=S(12037),e=S(12094),C=S(2306),Z=S(622);L.e.AddNodeConstructor("Light_Type_2",((t,q)=>()=>new b(t,z.o.Zero(),z.o.Zero(),0,0,q)));class b extends e.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(t){this._iesProfileTexture!==t&&(this._iesProfileTexture=t,this._iesProfileTexture&&b._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(t){this._angle=t,this._cosHalfAngle=Math.cos(.5*t),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(t){this._innerAngle=t,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(t){this._shadowAngleScale=t,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(t){this._projectionTextureLightNear=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(t){this._projectionTextureLightFar=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(t){this._projectionTextureUpDirection=t,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(t){this._projectionTexture!==t&&(this._projectionTexture=t,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(b._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):b._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(t){return void 0!==t.onGeneratedObservable}static _IsTexture(t){return void 0!==t.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(t){this._projectionTextureProjectionLightMatrix=t,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(t,q,S,o,B,L){super(t,L),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=z.e.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=z.o.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=z.o.Zero(),this._projectionTextureViewLightMatrix=z.e.Zero(),this._projectionTextureProjectionLightMatrix=z.e.Zero(),this._projectionTextureScalingMatrix=z.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=q,this.direction=S,this.angle=o,this.exponent=B}getClassName(){return"SpotLight"}getTypeID(){return r.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(t){super._setDirection(t),this._projectionTextureViewLightDirty=!0}_setPosition(t){super._setPosition(t),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(t,q,S){const o=this.va().activeCamera;if(!o)return;this._shadowAngleScale=this._shadowAngleScale||1;const B=this._shadowAngleScale*this._angle,L=void 0!==this.shadowMinZ?this.shadowMinZ:o.Ci,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,e=this.va().getEngine().useReverseDepthBuffer;z.e.PerspectiveFovLHToRef(B,1,e?r:L,e?L:r,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,e)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),z.e.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const t=this.projectionTextureLightFar,q=this.projectionTextureLightNear,S=t/(t-q),o=-S*q,B=1/Math.tan(this._angle/2);z.e.FromValuesToRef(B/1,0,0,0,0,B,0,0,0,0,S,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof C.b){const t=this._projectionTexture.uScale/2,q=this._projectionTexture.vScale/2;z.e.FromValuesToRef(t,0,0,0,0,q,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(t,q){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),t.setMatrix("textureProjectionMatrix"+q,this._projectionTextureMatrix),t.setTexture("projectionLightTexture"+q,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&t.setTexture("iesLightTexture"+q,this._iesProfileTexture),this}transferToEffect(t,q){let S;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,q),S=z.o.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,q),S=z.o.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",S.x,S.y,S.z,this._cosHalfAngle,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,q),this}transferToNodeMaterialEffect(t,q){let S;return S=this.computeTransformedInformation()?z.o.Normalize(this.transformedDirection):z.o.Normalize(this.direction),this.va().useRightHandedSystem?t.setFloat3(q,-S.x,-S.y,-S.z):t.setFloat3(q,S.x,S.y,S.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(t){const q=this._scene.getEngine(),S=void 0!==this.shadowMinZ?this.shadowMinZ:(null===t||void 0===t?void 0:t.Ci)??0;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?S:this._scene.getEngine().isNDCHalfZRange?0:S}getDepthMaxZ(t){const q=this._scene.getEngine(),S=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===t||void 0===t?void 0:t.maxZ)??1e4;return q.useReverseDepthBuffer&&q.isNDCHalfZRange?0:S}prepareLightSpecificDefines(t,q){t["SPOTLIGHT"+q]=!0,t["PROJECTEDLIGHTTEXTURE"+q]=!(!this.projectionTexture||!this.projectionTexture.isReady()),t["IESLIGHTTEXTURE"+q]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,o.e)([(0,B.C)()],b.prototype,"angle",null),(0,o.e)([(0,B.C)()],b.prototype,"innerAngle",null),(0,o.e)([(0,B.C)()],b.prototype,"shadowAngleScale",null),(0,o.e)([(0,B.C)()],b.prototype,"exponent",void 0),(0,o.e)([(0,B.C)()],b.prototype,"projectionTextureLightNear",null),(0,o.e)([(0,B.C)()],b.prototype,"projectionTextureLightFar",null),(0,o.e)([(0,B.C)()],b.prototype,"projectionTextureUpDirection",null),(0,o.e)([(0,B.v)("projectedLightTexture")],b.prototype,"_projectionTexture",void 0),(0,Z.c)("BABYLON.SpotLight",b)},12611:(t,q,S)=>{"use strict";S.d(q,{b:()=>L,f:()=>z,g:()=>r});const o={},B={};function z(t,q){o[t]=q}function L(t,q){B[t]=q}function r(t){return B[t]?B[t]:null}},12517:(t,q,S)=>{"use strict";S.d(q,{b:()=>J,d:()=>u});var o,B=S(490),z=S(485),L=S(2428),r=S(523),e=S(496),C=S(781),Z=S(527),b=S(536),O=S(624),i=S(561),h=S(520);!function(t){t[t.Clean=0]="Clean",t[t.Stop=1]="Stop",t[t.Sync=2]="Sync",t[t.NoSync=3]="NoSync"}(o||(o={}));const l=new z.b,I={};let a=!1;function v(){return I[".babylon"]}function M(t,q){const S=I[t];return S||(e.c.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),q?v():void 0)}function x(t,q,S){let o="Unable to load from "+(t.rawData?"binary data":t.url);return q?o+=`: ${q}`:S&&(o+=`: ${S}`),o}async function k(t,q,S,o,B,z,L,r,e){var C;const b="data:"===(O=t.url).substring(0,5)?O.substring(5):null;var O;if(t.rawData&&!L)throw"When using ArrayBufferView to load data the file extension must be provided.";const a=b||L?"":function(t){const q=t.indexOf("?");-1!==q&&(t=t.substring(0,q));const S=t.lastIndexOf(".");return t.substring(S,t.length).toLowerCase()}(t.url);let x=L?M(L,!0):b?function(t){for(const q in I){const S=I[q].plugin;if(S.canDirectLoad&&S.canDirectLoad(t))return I[q]}return v()}(t.url):M(a,!1);if(!x&&a){if(t.url&&!t.url.startsWith("blob:")){const q=await async function(t,q){const S=q.method||"GET";return await new Promise(((o,B)=>{const z=new h.e;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const t={};if(q.responseHeaders)for(const S of q.responseHeaders)t[S]=z.getResponseHeader(S)||"";o({response:z.response,headerValues:t})}else B(`Unable to fetch data from ${t}. Error code: ${z.status}`)})),z.open(S,t),z.send()}))}(t.url,{method:"HEAD",responseHeaders:["Content-Type"]}),S=q.headerValues?q.headerValues["Content-Type"]:"";S&&(x=function(t){for(const q in I){const S=I[q];if(S.mimeType===t)return S}}(S))}x||(x=v())}if(!x)throw new Error(`No plugin or fallback for ${L??t.url}`);if(!1===(null===e||void 0===e||null===(C=e[x.plugin.name])||void 0===C?void 0:C.enabled))throw new Error(`The '${x.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(t.rawData&&!x.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(t=>{if(x.plugin.createPlugin){const q=x.plugin.createPlugin(e??{});return q instanceof Promise?(q.then(t).catch((t=>{B("Error instantiating plugin.",t)})),null):(t(q),q)}return t(x.plugin),x.plugin})((e=>{var C;if(!e)throw`The loader plugin corresponding to the '${L}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(l.notifyObservers(e),b&&(e.canDirectLoad&&e.canDirectLoad(t.url)||!(0,Z.k)(t.url))){if(e.directLoad){const t=e.directLoad(q,b);t instanceof Promise?t.then((t=>{S(e,t)})).catch((t=>{B("Error in directLoad of _loadData: "+t,t)})):S(e,t)}else S(e,b);return}const O=x.isBinary,h=(t,o)=>{q.u?B("Scene has been disposed"):S(e,t,o)};let I=null,a=!1;null===(C=e.Qi)||void 0===C||C.add((()=>{a=!0,I&&(I.abort(),I=null),z()}));const v=()=>{if(a)return;const S=(t,q)=>{B(null===t||void 0===t?void 0:t.statusText,q)};if(!e.loadFile&&t.rawData)throw"Plugin does not support loading ArrayBufferView.";I=e.loadFile?e.loadFile(q,t.rawData||t.file||t.url,t.rootUrl,h,o,O,S,r):q._loadFile(t.file||t.url,h,o,!0,O,S)},M=q.getEngine();let k=M.enableOfflineSupport;if(k){let S=!1;for(const o of q.disableOfflineSupportExceptionRules)if(o.test(t.url)){S=!0;break}k=!S}k&&i.c.OfflineProviderFactory?q.offlineProvider=i.c.OfflineProviderFactory(t.url,v,M.disableManifestCheck):v()}))}function V(t,q){let S,o,z=null,L=null;if(q)if(q.name)S=`file:${q.name}`,o=q.name,z=q;else if(ArrayBuffer.isView(q))S="",o=(0,O.d)(),L=q;else if(q.startsWith("data:"))S=q,o="";else if(t){const z=q;if("/"===z.substring(0,1))return B.f.Error("Wrong sceneFilename parameter"),null;S=t+z,o=z}else S=q,o=B.f.GetFilename(q),t=B.f.GetFolderPath(q);else S=t,o=B.f.GetFilename(t),t=B.f.GetFolderPath(t);return{url:S,rootUrl:t,name:o,file:z,rawData:L}}function J(t){if("string"===typeof t.extensions){const q=t.extensions;I[q.toLowerCase()]={plugin:t,isBinary:!1}}else{const q=t.extensions,S=Object.keys(q);for(const o of S)I[o.toLowerCase()]={plugin:t,isBinary:q[o].isBinary,mimeType:q[o].mimeType}}}async function U(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.b.LastCreatedScene,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!o)return e.c.Error("No scene available to import mesh to"),null;const i=V(q,S);if(!i)return null;const h={};o.addPendingData(h);const l=()=>{o.removePendingData(h)},I=(t,q)=>{const S=x(i,t,q);L?L(o,S,new b.g(S,b.c.SceneLoaderError,q)):e.c.Error(S),l()},a=z?t=>{try{z(t)}catch(q){I("Error in onProgress callback: "+q,q)}}:void 0,v=(t,q,S,z,L,r,e,C)=>{if(o.importedMeshesFiles.push(i.url),B)try{B(t,q,S,z,L,r,e,C)}catch(Z){I("Error in onSuccess callback: "+Z,Z)}o.removePendingData(h)};return await k(i,o,((q,S,B)=>{if(q.rewriteRootURL&&(i.rootUrl=q.rewriteRootURL(i.rootUrl,B)),q.importMesh){const B=[],z=[],L=[];if(!q.importMesh(t,o,S,i.rootUrl,B,z,L,I))return;o.loadingPluginName=q.name,v(B,z,L,[],[],[],[],[])}else{q.importMeshAsync(t,o,S,i.rootUrl,a,i.name).then((t=>{o.loadingPluginName=q.name,v(t.meshes,t.zi,t.skeletons,t.animationGroups,t.transformNodes,t.geometries,t.lights,t.spriteManagers)})).catch((t=>{I(t.message,t)}))}}),a,I,l,C,Z,O)}async function H(t,q,S,o,B,z,L,r){return await new Promise(((e,C)=>{try{U(t,q,S,o,((t,q,S,o,B,z,L,r)=>{e({meshes:t,zi:q,skeletons:S,animationGroups:o,transformNodes:B,geometries:z,lights:L,spriteManagers:r})}),B,((t,q,S)=>{C(S||new Error(q))}),z,L,r).catch(C)}catch(b){C(b)}}))}async function j(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.b.LastCreatedEngine,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};S?await Q(t,q,new L.d(S),o,z,e,C,Z,b):B.f.Error("No engine available")}async function y(t,q,S,o,B,z,L){return await new Promise(((r,e)=>{j(t,q,S,(t=>{r(t)}),o,((t,q,S)=>{e(S||new Error(q))}),B,z,L)}))}async function Q(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.b.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!S)return e.c.Error("No scene available to append to"),null;const i=V(t,q);if(!i)return null;const h={};S.addPendingData(h);const l=()=>{S.removePendingData(h)};C.c.ShowLoadingScreen&&!a&&(a=!0,S.getEngine().displayLoadingUI(),S.executeWhenReady((()=>{S.getEngine().hideLoadingUI(),a=!1})));const I=(t,q)=>{const o=x(i,t,q);z?z(S,o,new b.g(o,b.c.SceneLoaderError,q)):e.c.Error(o),l()},v=B?t=>{try{B(t)}catch(q){I("Error in onProgress callback",q)}}:void 0,M=()=>{if(o)try{o(S)}catch(t){I("Error in onSuccess callback",t)}S.removePendingData(h)};return await k(i,S,((t,q)=>{if(t.load){if(!t.load(S,q,i.rootUrl,I))return;S.loadingPluginName=t.name,M()}else{t.loadAsync(S,q,i.rootUrl,v,i.name).then((()=>{S.loadingPluginName=t.name,M()})).catch((t=>{I(t.message,t)}))}}),v,I,l,L,Z,O)}async function K(t,q,S,o,B,z,L){return await new Promise(((r,e)=>{try{Q(t,q,S,(t=>{r(t)}),o,((t,q,S)=>{e(S||new Error(q))}),B,z,L).catch(e)}catch(b){e(b)}}))}async function X(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.b.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!S)return e.c.Error("No scene available to load asset container to"),null;const O=V(t,q);if(!O)return null;const i={};S.addPendingData(i);const h=()=>{S.removePendingData(i)},l=(t,q)=>{const o=x(O,t,q);z?z(S,o,new b.g(o,b.c.SceneLoaderError,q)):e.c.Error(o),h()},I=B?t=>{try{B(t)}catch(q){l("Error in onProgress callback",q)}}:void 0,a=t=>{if(o)try{o(t)}catch(q){l("Error in onSuccess callback",q)}S.removePendingData(i)};return await k(O,S,((t,q)=>{if(t.loadAssetContainer){const o=t.loadAssetContainer(S,q,O.rootUrl,l);if(!o)return;o.populateRootNodes(),S.loadingPluginName=t.name,a(o)}else if(t.loadAssetContainerAsync){t.loadAssetContainerAsync(S,q,O.rootUrl,I,O.name).then((q=>{q.populateRootNodes(),S.loadingPluginName=t.name,a(q)})).catch((t=>{l(t.message,t)}))}else l("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),I,l,h,L,C,Z)}async function G(t,q,S,o,B,z,L){return await new Promise(((r,e)=>{try{X(t,q,S,(t=>{r(t)}),o,((t,q,S)=>{e(S||new Error(q))}),B,z,L).catch(e)}catch(b){e(b)}}))}async function Y(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.b.LastCreatedScene,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!S)return void e.c.Error("No scene available to load animations to");if(o){for(const o of S.animatables)o.reset();S.stopAllAnimations();const t=S.animationGroups.slice();for(const S of t)S.dispose();const q=S.getNodes();for(const S of q)S.animations&&(S.animations=[])}else switch(B){case 0:const t=S.animationGroups.slice();for(const q of t)q.dispose();break;case 1:for(const q of S.animationGroups)q.stop();break;case 2:for(const q of S.animationGroups)q.reset(),q.restart();break;case 3:break;default:return void e.c.Error("Unknown animation group loading mode value '"+B+"'")}const h=S.animatables.length;await X(t,q,S,(t=>{t.mergeAnimationsTo(S,S.animatables.slice(h),z),t.dispose(),S.onAnimationFileImportedObservable.notifyObservers(S),L&&L(S)}),C,Z,b,O,i)}async function n(t,q,S,o,B,z,L,r,e,C){return await new Promise(((Z,O)=>{try{Y(t,q,S,o,B,z,(t=>{Z(t)}),L,((t,q,S)=>{O(S||new Error(q))}),r,e,C).catch(O)}catch(b){O(b)}}))}class u{static get ForceFullSceneLoadingForIncremental(){return C.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(t){C.c.ForceFullSceneLoadingForIncremental=t}static get ShowLoadingScreen(){return C.c.ShowLoadingScreen}static set ShowLoadingScreen(t){C.c.ShowLoadingScreen=t}static get loggingLevel(){return C.c.loggingLevel}static set loggingLevel(t){C.c.loggingLevel=t}static get CleanBoneMatrixWeights(){return C.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(t){C.c.CleanBoneMatrixWeights=t}static GetDefaultPlugin(){return v()}static GetPluginForExtension(t){var q;return null===(q=M(t,!0))||void 0===q?void 0:q.plugin}static IsPluginForExtensionAvailable(t){return function(t){return!!I[t]}(t)}static RegisterPlugin(t){J(t)}static ImportMesh(t,q,S,o,B,z,L,e,C){U(t,q,S,o,B,z,L,e,C).catch((t=>null===L||void 0===L?void 0:L(r.b.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async ImportMeshAsync(t,q,S,o,B,z,L){return await H(t,q,S,o,B,z,L)}static Load(t,q,S,o,B,z,L,e){j(t,q,S,o,B,z,L,e).catch((t=>null===z||void 0===z?void 0:z(r.b.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async LoadAsync(t,q,S,o,B,z){return await y(t,q,S,o,B,z)}static Append(t,q,S,o,B,z,L,e){Q(t,q,S,o,B,z,L,e).catch((t=>null===z||void 0===z?void 0:z(S??r.b.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async AppendAsync(t,q,S,o,B,z){return await K(t,q,S,o,B,z)}static LoadAssetContainer(t,q,S,o,B,z,L,e){X(t,q,S,o,B,z,L,e).catch((t=>null===z||void 0===z?void 0:z(S??r.b.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async LoadAssetContainerAsync(t,q,S,o,B,z){return await G(t,q,S,o,B,z)}static ImportAnimations(t,q,S,o,B,z,L,e,C,Z,b){Y(t,q,S,o,B,z,L,e,C,Z,b).catch((t=>null===C||void 0===C?void 0:C(S??r.b.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async ImportAnimationsAsync(t,q,S,o,B,z,L,r,e,C,Z){return await n(t,q,S,o,B,z,r,C,Z)}}u.NO_LOGGING=0,u.MINIMAL_LOGGING=1,u.SUMMARY_LOGGING=2,u.DETAILED_LOGGING=3,u.OnPluginActivatedObservable=l},12893:(t,q,S)=>{"use strict";S.d(q,{c:()=>O});var o=S(653),B=S(658),z=S(490),L=S(678),r=S(2311),e=S(2306),C=S(622),Z=S(485),b=S(701);S(2408);class O extends r.b{set boundingBoxSize(t){if(this._boundingBoxSize&&this._boundingBoxSize.equals(t))return;this._boundingBoxSize=t;const q=this.va();q&&q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(t){this._rotationY=t,this.setReflectionTextureMatrix(L.e.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,q,S){let o="";for(const B of t)o+=B;return new O(o,q,null,S,t)}static CreateFromPrefilteredData(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=q.useDelayedTextureLoading;q.useDelayedTextureLoading=!1;const z=new O(t,q,null,!1,null,null,null,void 0,!0,S,o);return q.useDelayedTextureLoading=B,z}constructor(t,q){var S;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]&&arguments[10],l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,a=arguments.length>13?arguments[13]:void 0,v=arguments.length>14?arguments[14]:void 0;super(q),this.onLoadObservable=new Z.b,this.boundingBoxPosition=L.o.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new L.e,this._buffer=null,this.name=t,this.url=t,this._noMipmap=B,this.Lj=!1,this.isCube=!0,this._textureMatrix=L.e.Identity(),this.coordinatesMode=e.b.CUBIC_MODE;let M=null,x=null;null===o||Array.isArray(o)?(this._noMipmap=B,this._format=b,this._createPolynomials=h,M=o,this._loaderOptions=a,this._useSRGBBuffer=v,this._lodScale=l,this._lodOffset=I):(M=o.extensions??null,this._noMipmap=o.noMipmap??!1,z=o.files??null,x=o.buffer??null,this._format=o.format??5,O=o.prefiltered??!1,i=o.forcedExtension??null,this._createPolynomials=o.createPolynomials??!1,this._lodScale=o.lodScale??.8,this._lodOffset=o.lodOffset??0,this._loaderOptions=o.loaderOptions,this._useSRGBBuffer=o.useSRGBBuffer,r=o.X??null,C=o.onError??null),(t||z)&&this.updateURL(t,i,r,O,C,M,null===(S=this.va())||void 0===S?void 0:S.useDelayedTextureLoading,z,x)}getClassName(){return"CubeTexture"}updateURL(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=t),this.url=t,q&&(this._forcedExtension=q);const C=t.lastIndexOf("."),Z=q||(C>-1?t.substring(C).toLowerCase():""),b=0===Z.indexOf(".dds"),O=0===Z.indexOf(".env"),i=0===Z.indexOf(".basis");if(O?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=o,o&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),r)this._files=r;else if(i||O||b||z||(z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,z){for(let q=0;q<z.length;q++)this._files.push(t+z[q]);this._extensions=z}this._buffer=e,L?(this.delayLoadState=4,this._delayedOnLoad=S,this._delayedOnError=B):this._loadTexture(S,B)}delayLoad(t){4===this.delayLoadState&&(t&&(this._forcedExtension=t),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(t){var q,S;if(t.updateFlag===this._textureMatrix.updateFlag)return;t.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(S=this.va())||void 0===S||S.markAllMaterialsAsDirty(1,(t=>-1!==t.getActiveTextures().indexOf(this))));if(this._textureMatrix=t,null===(q=this.va())||void 0===q||!q.useRightHandedSystem)return;const o=L.j.wi[0],B=L.j.Quaternion[0],z=L.j.wi[1];this._textureMatrix.decompose(o,B,z),B.z*=-1,B.w*=-1,L.e.ComposeToRef(o,B,z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var t;return null!==(t=this.va())&&void 0!==t&&t.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=this.va(),o=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const B=()=>{var q;(this.onLoadObservable.notifyObservers(this),o)&&(o.dispose(),null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1));t&&t()},L=(t,S)=>{this._loadingError=!0,this._errorObject={message:t,exception:S},q&&q(t,S),e.b.OnTextureLoadErrorObservable.notifyObservers(this)};var r;this._texture?this._texture.isReady?z.f.SetImmediate((()=>B())):this._texture.onLoadedObservable.add((()=>B())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,S,this._lodScale,this._lodOffset,t,L,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,S,this._files,this._noMipmap,t,L,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(r=this._texture)||void 0===r||r.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(t,q,S){const o=b.b.Parse((()=>{let o=!1;return t.prefiltered&&(o=t.prefiltered),new O(S+(t.url??t.name),q,t.extensions,!1,t.files||null,null,null,void 0,o,t.forcedExtension)}),t,q);if(t.boundingBoxPosition&&(o.boundingBoxPosition=L.o.ti(t.boundingBoxPosition)),t.boundingBoxSize&&(o.boundingBoxSize=L.o.ti(t.boundingBoxSize)),t.animations)for(let B=0;B<t.animations.length;B++){const q=t.animations[B],S=(0,C.b)("BABYLON.Animation");S&&o.animations.push(S.Parse(q))}return o}clone(){let t=0;const q=b.b.Clone((()=>{const q=new O(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=q.uniqueId,q}),this);return q.uniqueId=t,q}}(0,o.e)([(0,B.C)()],O.prototype,"url",void 0),(0,o.e)([(0,B.B)()],O.prototype,"boundingBoxPosition",void 0),(0,o.e)([(0,B.B)()],O.prototype,"boundingBoxSize",null),(0,o.e)([(0,B.C)("rotationY")],O.prototype,"rotationY",null),(0,o.e)([(0,B.C)("files")],O.prototype,"_files",void 0),(0,o.e)([(0,B.C)("forcedExtension")],O.prototype,"_forcedExtension",void 0),(0,o.e)([(0,B.C)("extensions")],O.prototype,"_extensions",void 0),(0,o.e)([(0,B.p)("textureMatrix")],O.prototype,"_textureMatrix",void 0),(0,o.e)([(0,B.p)("textureMatrixRefraction")],O.prototype,"_textureMatrixRefraction",void 0),e.b._CubeTextureParser=O.Parse,(0,C.c)("BABYLON.CubeTexture",O)},13210:(t,q,S)=>{"use strict";S.d(q,{b:()=>e});var o=S(496),B=S(2306),z=S(626),L=S(2356),r=S(599);L.ThinEngine.prototype.createDynamicTexture=function(t,q,S,o){const B=new r.b(this,4);return B.baseWidth=t,B.baseHeight=q,S&&(t=this.needPOTTextures?(0,z.e)(t,this._caps.maxTextureSize):t,q=this.needPOTTextures?(0,z.e)(q,this._caps.maxTextureSize):q),B.width=t,B.height=q,B.isReady=!1,B.generateMipMaps=S,B.samplingMode=o,this.updateTextureSamplingMode(o,B),this._internalTexturesCache.push(B),B},L.ThinEngine.prototype.updateDynamicTexture=function(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!t)return;const L=this._gl,r=L.TEXTURE_2D,e=this._bindTextureDirectly(r,t,!0,z);this._unpackFlipY(void 0===S?t.invertY:S),o&&L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const C=this._getWebGLTextureType(t.type),Z=this._getInternalFormat(B||t.format),b=this._getRGBABufferInternalSizedFormat(t.type,Z);L.texImage2D(r,0,b,Z,C,q),t.generateMipMaps&&L.generateMipmap(r),e||this._bindTextureDirectly(r,null),o&&L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),B&&(t.format=B),t._dynamicTextureSource=q,t._premulAlpha=o,t.invertY=S||!1,t.isReady=!0};class e extends B.b{constructor(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,r=arguments.length>6?arguments[6]:void 0;const e=!S||S._isScene;super(null,e?S:null===S||void 0===S?void 0:S.Tk,e?!o:S,r,z,void 0,void 0,void 0,void 0,L),this.name=t,this.wrapU=B.b.CLAMP_ADDRESSMODE,this.wrapV=B.b.CLAMP_ADDRESSMODE,this._generateMipMaps=o;const C=this._getEngine();if(!C)return;if(q.getContext)this._canvas=q,this._ownCanvas=!1,this._texture=C.createDynamicTexture(this._canvas.width,this._canvas.height,o,z);else{this._canvas=C.createCanvas(1,1),this._ownCanvas=!0;const t=q;t.width||0===t.width?this._texture=C.createDynamicTexture(t.width,t.height,o,z):this._texture=C.createDynamicTexture(q,q,o,z)}const Z=this.getSize();this._canvas.width!==Z.width&&(this._canvas.width=Z.width),this._canvas.height!==Z.height&&(this._canvas.height=Z.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(t){this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this.samplingMode)}scale(t){const q=this.getSize();q.width*=t,q.height*=t,this._recreate(q)}scaleTo(t,q){const S=this.getSize();S.width=t,S.height=q,this._recreate(S)}getContext(){return this._context}clear(t){const q=this.getSize();t&&(this._context.fillStyle=t),this._context.clearRect(0,0,q.width,q.height)}update(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===t||t,q,this._format||void 0,void 0,S)}drawText(t,q,S,o,B,z,L){let r=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const e=this.getSize();if(z&&(this._context.fillStyle=z,this._context.fillRect(0,0,e.width,e.height)),this._context.font=o,null===q||void 0===q){const S=this._context.measureText(t);q=(e.width-S.width)/2}if(null===S||void 0===S){const t=parseInt(o.replace(/\D/g,""));S=e.height/2+t/3.65}this._context.fillStyle=B||"",this._context.fillText(t,q,S),r&&this.update(L)}dispose(){var t,q;(super.dispose(),this._ownCanvas)&&(null===(t=this._canvas)||void 0===t||null===(q=t.remove)||void 0===q||q.call(t));this._canvas=null,this._context=null}clone(){const t=this.va();if(!t)return this;const q=this.getSize(),S=new e(this.name,q,t,this._generateMipMaps);return S.Lj=this.Lj,S.level=this.level,S.wrapU=this.wrapU,S.wrapV=this.wrapV,S}serialize(){const t=this.va();t&&!t.isReady()&&o.c.Warn("The scene must be ready before serializing the dynamic texture");const q=super.serialize();return e._IsCanvasElement(this._canvas)&&(q.base64String=this._canvas.toDataURL()),q.invertY=this._invertY,q.samplingMode=this.samplingMode,q}static _IsCanvasElement(t){return void 0!==t.toDataURL}_rebuild(){this.update()}}},12817:(t,q,S)=>{"use strict";S.d(q,{d:()=>B});var o=S(2306);class B extends o.b{get depth(){return this._depth}constructor(t,q,S,B,z,L){let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:o.b.TRILINEAR_SAMPLINGMODE,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,b=arguments.length>10?arguments[10]:void 0;super(null,L,!r,e),this.format=z,this._texture=L.getEngine().createRawTexture2DArray(t,q,S,B,z,r,e,C,null,Z,b),this._depth=B,this.is2DArray=!0}update(t){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,t,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(t,q,S,o,z){return new B(t,q,S,o,5,z,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12622:(t,q,S)=>{"use strict";S.d(q,{b:()=>r,d:()=>e,g:()=>z,i:()=>L});var o=S(689),B=S(678);function z(t,q){return`{X: ${t.x.toFixed(q)} Y: ${t.y.toFixed(q)}}`}function L(t,q){return`{X: ${t._x.toFixed(q)} Y: ${t._y.toFixed(q)} Z: ${t._z.toFixed(q)}}`}function r(t,q){return 2*Math.acos((0,o.Clamp)(B.g.Dot(t,q)))}function e(t,q){const S=new B.g;return function(t,q,S){const z=B.o.Cross(t,q),L=Math.acos((0,o.Clamp)(B.o.Dot(t,q),-1,1));B.g.RotationAxisToRef(z,L,S)}(t,q,S),S}},12461:(t,q,S)=>{"use strict";S.d(q,{e:()=>C});var o=S(678),B=S(706),z=S(483),L=S(732),r=S(788);S(12463);function e(t){let q=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const S=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],z=[];let e=[];const C=t.width||t.size||1,Z=t.height||t.size||1,b=t.depth||t.size||1,O=t.wrap||!1;let i=void 0===t.topBaseAt?1:t.topBaseAt,h=void 0===t.bottomBaseAt?0:t.bottomBaseAt;i=(i+4)%4,h=(h+4)%4;let l=[2,0,3,1][i],I=[2,0,1,3][h],a=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(O){q=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],a=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let t=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],S=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const o=[17,18,19,16],B=[22,23,20,21];for(;l>0;)t.unshift(t.pop()),o.unshift(o.pop()),l--;for(;I>0;)S.unshift(S.pop()),B.unshift(B.pop()),I--;t=t.flat(),S=S.flat(),a=a.concat(t).concat(S),q.push(o[0],o[2],o[3],o[0],o[1],o[2]),q.push(B[0],B[2],B[3],B[0],B[1],B[2])}const v=[C/2,Z/2,b/2];e=a.reduce(((t,q,S)=>t.concat(q*v[S%3])),[]);const M=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE,x=t.faceUV||new Array(6),k=t.faceColors,V=[];for(let L=0;L<6;L++)void 0===x[L]&&(x[L]=new o.s(0,0,1,1)),k&&void 0===k[L]&&(k[L]=new B.d(1,1,1,1));for(let o=0;o<6;o++)if(z.push(x[o].z,r.b?1-x[o].w:x[o].w),z.push(x[o].x,r.b?1-x[o].w:x[o].w),z.push(x[o].x,r.b?1-x[o].y:x[o].y),z.push(x[o].z,r.b?1-x[o].y:x[o].y),k)for(let t=0;t<4;t++)V.push(k[o].r,k[o].g,k[o].b,k[o].a);L.e._ComputeSides(M,e,q,S,z,t.frontUVs,t.backUVs);const J=new L.e;if(J.indices=q,J.xa=e,J.ya=S,J.Aa=z,k){const t=M===L.e.DOUBLESIDE?V.concat(V):V;J.za=t}return J}function C(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new z.c(t,S);q.sideOrientation=z.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return e(q).Ca(o,q.updatable),o}L.e.CreateBox=e,z.c.CreateBox=function(t,q){return C(t,{size:q,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12463:(t,q,S)=>{"use strict";S.d(q,{e:()=>I,d:()=>v,g:()=>a});var o=S(678),B=S(706),z=S(483),L=S(732),r=S(716);z.c._GroundMeshParser=(t,q)=>e.Parse(t,q);class e extends z.c{constructor(t,q){super(t,q),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);const S=this;S.createOrUpdateSubmeshesOctree&&S.createOrUpdateSubmeshesOctree(q)}getHeightAtCoordinates(t,q){const S=this.getWorldMatrix(),B=o.j.Matrix[5];S.invertToRef(B);const z=o.j.wi[8];if(o.o.TransformCoordinatesFromFloatsToRef(t,0,q,B,z),t=z.x,q=z.z,t<this._minX||t>=this._maxX||q<=this._minZ||q>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const L=this._getFacetAt(t,q),r=-(L.x*t+L.z*q+L.w)/L.y;return o.o.TransformCoordinatesFromFloatsToRef(0,r,0,S,z),z.y}getNormalAtCoordinates(t,q){const S=new o.o(0,1,0);return this.getNormalAtCoordinatesToRef(t,q,S),S}getNormalAtCoordinatesToRef(t,q,S){const B=this.getWorldMatrix(),z=o.j.Matrix[5];B.invertToRef(z);const L=o.j.wi[8];if(o.o.TransformCoordinatesFromFloatsToRef(t,0,q,z,L),t=L.x,q=L.z,t<this._minX||t>this._maxX||q<this._minZ||q>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(t,q);return o.o.TransformNormalFromFloatsToRef(r.x,r.y,r.z,B,S),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(t,q){const S=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(q+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),B=this._heightQuads[o*this._subdivisionsX+S];let z;return z=q<B.slope.x*t+B.slope.y?B.facet1:B.facet2,z}_initHeightQuads(){const t=this._subdivisionsX,q=this._subdivisionsY;this._heightQuads=[];for(let S=0;S<q;S++)for(let q=0;q<t;q++){const B={slope:o.l.Zero(),facet1:new o.s(0,0,0,0),facet2:new o.s(0,0,0,0)};this._heightQuads[S*t+q]=B}return this}_computeHeightQuads(){const t=this.getVerticesData(r.i.PositionKind);if(!t)return this;const q=o.j.wi[3],S=o.j.wi[2],B=o.j.wi[1],z=o.j.wi[0],L=o.j.wi[4],e=o.j.wi[5],C=o.j.wi[6],Z=o.j.wi[7],b=o.j.wi[8];let O=0,i=0,h=0,l=0,I=0,a=0,v=0;const M=this._subdivisionsX,x=this._subdivisionsY;for(let r=0;r<x;r++)for(let x=0;x<M;x++){O=3*x,i=r*(M+1)*3,h=(r+1)*(M+1)*3,q.x=t[i+O],q.y=t[i+O+1],q.z=t[i+O+2],S.x=t[i+O+3],S.y=t[i+O+4],S.z=t[i+O+5],B.x=t[h+O],B.y=t[h+O+1],B.z=t[h+O+2],z.x=t[h+O+3],z.y=t[h+O+4],z.z=t[h+O+5],l=(z.z-q.z)/(z.x-q.x),I=q.z-l*q.x,S.subtractToRef(q,L),B.subtractToRef(q,e),z.subtractToRef(q,C),o.o.CrossToRef(C,e,Z),o.o.CrossToRef(L,C,b),Z.normalize(),b.normalize(),a=-(Z.x*q.x+Z.y*q.y+Z.z*q.z),v=-(b.x*S.x+b.y*S.y+b.z*S.z);const k=this._heightQuads[r*M+x];k.slope.ni(l,I),k.facet1.ni(Z.x,Z.y,Z.z,a),k.facet2.ni(b.x,b.y,b.z,v)}return this}serialize(t){super.serialize(t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.Ci=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height}static Parse(t,q){const S=new e(t.name,q);return S._subdivisionsX=t.subdivisionsX||1,S._subdivisionsY=t.subdivisionsY||1,S._minX=t.minX,S._maxX=t.maxX,S._minZ=t.Ci,S._maxZ=t.maxZ,S._width=t.width,S._height=t.height,S}}var C=S(490),Z=S(523),b=S(682),O=S(788);function i(t){const q=[],S=[],B=[],z=[];let r,e;const C=t.width||t.size||1,Z=t.height||t.size||1,b=0|(t.subdivisionsX||t.subdivisions||1),i=0|(t.subdivisionsY||t.subdivisions||1);for(r=0;r<=i;r++)for(e=0;e<=b;e++){const t=new o.o(e*C/b-C/2,0,(i-r)*Z/i-Z/2),q=new o.o(0,1,0);S.push(t.x,t.y,t.z),B.push(q.x,q.y,q.z),z.push(e/b,O.b?r/i:1-r/i)}for(r=0;r<i;r++)for(e=0;e<b;e++)q.push(e+1+(r+1)*(b+1)),q.push(e+1+r*(b+1)),q.push(e+r*(b+1)),q.push(e+(r+1)*(b+1)),q.push(e+1+(r+1)*(b+1)),q.push(e+r*(b+1));const h=new L.e;return h.indices=q,h.xa=S,h.ya=B,h.Aa=z,h}function h(t){const q=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,S=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,B=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,z=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,r=t.subdivisions||{w:1,h:1},e=t.precision||{w:1,h:1},C=[],Z=[],b=[],O=[];let i,h,l,I;r.h=r.h<1?1:r.h,r.w=r.w<1?1:r.w,e.w=e.w<1?1:e.w,e.h=e.h<1?1:e.h;const a=(B-q)/r.w,v=(z-S)/r.h;function M(t,q,S,B){const z=Z.length/3,L=e.w+1;for(i=0;i<e.h;i++)for(h=0;h<e.w;h++){const t=[z+h+i*L,z+(h+1)+i*L,z+(h+1)+(i+1)*L,z+h+(i+1)*L];C.push(t[1]),C.push(t[2]),C.push(t[3]),C.push(t[0]),C.push(t[1]),C.push(t[3])}const r=o.o.Zero(),l=new o.o(0,1,0);for(i=0;i<=e.h;i++)for(r.z=i*(B-q)/e.h+q,h=0;h<=e.w;h++)r.x=h*(S-t)/e.w+t,r.y=0,Z.push(r.x,r.y,r.z),b.push(l.x,l.y,l.z),O.push(h/e.w,i/e.h)}for(l=0;l<r.h;l++)for(I=0;I<r.w;I++)M(q+I*a,S+l*v,q+(I+1)*a,S+(l+1)*v);const x=new L.e;return x.indices=C,x.xa=Z,x.ya=b,x.Aa=O,x}function l(t){const q=[],S=[],z=[],r=[];let e,C;const Z=t.colorFilter||new B.c(.3,.59,.11),O=t.alphaFilter||0;let i=!1;if(t.minHeight>t.maxHeight){i=!0;const q=t.maxHeight;t.maxHeight=t.minHeight,t.minHeight=q}for(e=0;e<=t.subdivisions;e++)for(C=0;C<=t.subdivisions;C++){const q=new o.o(C*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-e)*t.height/t.subdivisions-t.height/2),B=4*(((q.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(q.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth);let L=t.buffer[B]/255,h=t.buffer[B+1]/255,l=t.buffer[B+2]/255;const I=t.buffer[B+3]/255;i&&(L=1-L,h=1-h,l=1-l);const a=L*Z.r+h*Z.g+l*Z.b;q.y=I>=O?t.minHeight+(t.maxHeight-t.minHeight)*a:t.minHeight-b.d,t.heightBuffer&&(t.heightBuffer[e*(t.subdivisions+1)+C]=q.y),S.push(q.x,q.y,q.z),z.push(0,0,0),r.push(C/t.subdivisions,1-e/t.subdivisions)}for(e=0;e<t.subdivisions;e++)for(C=0;C<t.subdivisions;C++){const o=C+1+(e+1)*(t.subdivisions+1),B=C+1+e*(t.subdivisions+1),z=C+e*(t.subdivisions+1),L=C+(e+1)*(t.subdivisions+1),r=S[3*o+1]>=t.minHeight,Z=S[3*B+1]>=t.minHeight,b=S[3*z+1]>=t.minHeight;r&&Z&&b&&(q.push(o),q.push(B),q.push(z));S[3*L+1]>=t.minHeight&&r&&b&&(q.push(L),q.push(o),q.push(z))}L.e.ComputeNormals(S,q,z);const h=new L.e;return h.indices=q,h.xa=S,h.ya=z,h.Aa=r,h}function I(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const S=new e(t,arguments.length>2?arguments[2]:void 0);S._setReady(!1),S._subdivisionsX=q.subdivisionsX||q.subdivisions||1,S._subdivisionsY=q.subdivisionsY||q.subdivisions||1,S._width=q.width||1,S._height=q.height||1,S._maxX=S._width/2,S._maxZ=S._height/2,S._minX=-S._maxX,S._minZ=-S._maxZ;return i(q).Ca(S,q.updatable),S._setReady(!0),S}function a(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new z.c(t,S);return h(q).Ca(o,q.updatable),o}function v(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=S.width||10,L=S.height||10,r=S.subdivisions||1,b=S.minHeight||0,O=S.maxHeight||1,i=S.colorFilter||new B.c(.3,.59,.11),h=S.alphaFilter||0,I=S.updatable,a=S.onReady;o=o||Z.b.LastCreatedScene;const v=new e(t,o);let M;v._subdivisionsX=r,v._subdivisionsY=r,v._width=z,v._height=L,v._maxX=v._width/2,v._maxZ=v._height/2,v._minX=-v._maxX,v._minZ=-v._maxZ,v._setReady(!1),S.passHeightBufferInCallback&&(M=new Float32Array((r+1)*(r+1)));const x=(t,q,S)=>{l({width:z,height:L,subdivisions:r,minHeight:b,maxHeight:O,colorFilter:i,buffer:t,bufferWidth:q,bufferHeight:S,alphaFilter:h,heightBuffer:M}).Ca(v,I),a&&a(v,M),v._setReady(!0)};if("string"===typeof q){const t=t=>{var q;const S=t.width,B=t.height;if(o.u)return;const z=null===(q=o)||void 0===q?void 0:q.getEngine().resizeImageBitmap(t,S,B);x(z,S,B)};C.f.LoadImage(q,t,S.onError?S.onError:()=>{},o.offlineProvider)}else x(q.data,q.width,q.height);return v}L.e.CreateGround=i,L.e.CreateTiledGround=h,L.e.CreateGroundFromHeightMap=l,z.c.CreateGround=(t,q,S,o,B,z)=>I(t,{width:q,height:S,subdivisions:o,updatable:z},B),z.c.CreateTiledGround=(t,q,S,o,B,z,L,r,e)=>a(t,{xmin:q,zmin:S,xmax:o,zmax:B,subdivisions:z,precision:L,updatable:e},r),z.c.CreateGroundFromHeightMap=(t,q,S,o,B,z,L,r,e,C,Z)=>v(t,q,{width:S,height:o,subdivisions:B,minHeight:z,maxHeight:L,updatable:e,onReady:C,alphaFilter:Z},r)},13107:(t,q,S)=>{"use strict";S.d(q,{e:()=>i,f:()=>b,i:()=>O});var o=S(678),B=S(483),z=S(732),L=S(12045),r=S(716),e=S(496);function C(t){const q=[],S=[],o=t.lines,B=t.za,L=[];let r=0;for(let z=0;z<o.length;z++){const t=o[z];for(let o=0;o<t.length;o++){const{x:e,y:C,z:Z}=t[o];if(S.push(e,C,Z),B){const t=B[z],{r:q,g:S,b:r,a:e}=t[o];L.push(q,S,r,e)}o>0&&(q.push(r-1),q.push(r)),r++}}const e=new z.e;return e.indices=q,e.xa=S,B&&(e.za=L),e}function Z(t){const q=t.dashSize||3,S=t.gapSize||1,B=t.dashNb||200,L=t.points,r=[],e=[],C=o.o.Zero();let Z=0,b=0,O=0,i=0,h=0,l=0,I=0;for(I=0;I<L.length-1;I++)L[I+1].subtractToRef(L[I],C),Z+=C.length();for(O=Z/B,i=q*O/(q+S),I=0;I<L.length-1;I++){L[I+1].subtractToRef(L[I],C),b=Math.floor(C.length()/O),C.normalize();for(let t=0;t<b;t++)h=O*t,r.push(L[I].x+h*C.x,L[I].y+h*C.y,L[I].z+h*C.z),r.push(L[I].x+(h+i)*C.x,L[I].y+(h+i)*C.y,L[I].z+(h+i)*C.z),e.push(l,l+1),l+=2}const a=new z.e;return a.xa=r,a.indices=e,a}function b(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=q.instance,B=q.lines,z=q.za;if(o){const t=o.getVerticesData(r.i.PositionKind);let q,S;z&&(q=o.getVerticesData(r.i.ColorKind));let L=0,e=0;for(let o=0;o<B.length;o++){const r=B[o];for(let B=0;B<r.length;B++)t[L]=r[B].x,t[L+1]=r[B].y,t[L+2]=r[B].z,z&&q&&(S=z[o],q[e]=S[B].r,q[e+1]=S[B].g,q[e+2]=S[B].b,q[e+3]=S[B].a,e+=4),L+=3}return o.updateVerticesData(r.i.PositionKind,t,!1,!1),z&&q&&o.updateVerticesData(r.i.ColorKind,q,!1,!1),o.refreshBoundingInfo(),o}const e=!!z,Z=new L.c(t,S,null,void 0,void 0,e,q.useVertexAlpha,q.material);return C(q).Ca(Z,q.updatable),Z}function O(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=q.za?[q.za]:null;return b(t,{lines:[q.points],updatable:q.updatable,instance:q.instance,za:o,useVertexAlpha:q.useVertexAlpha,material:q.material},S)}function i(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.points,r=q.instance,C=q.gapSize||1,b=q.dashSize||3;if(r){const t=t=>{const q=o.o.Zero(),S=t.length/6;let B=0,L=0,e=0,C=0,Z=0,b=0,O=0,i=0;for(O=0;O<z.length-1;O++)z[O+1].subtractToRef(z[O],q),B+=q.length();e=B/S;const h=r._creationDataStorage.dashSize;for(C=h*e/(h+r._creationDataStorage.gapSize),O=0;O<z.length-1;O++)for(z[O+1].subtractToRef(z[O],q),L=Math.floor(q.length()/e),q.normalize(),i=0;i<L&&b<t.length;)Z=e*i,t[b]=z[O].x+Z*q.x,t[b+1]=z[O].y+Z*q.y,t[b+2]=z[O].z+Z*q.z,t[b+3]=z[O].x+(Z+C)*q.x,t[b+4]=z[O].y+(Z+C)*q.y,t[b+5]=z[O].z+(Z+C)*q.z,b+=6,i++;for(;b<t.length;)t[b]=z[O].x,t[b+1]=z[O].y,t[b+2]=z[O].z,b+=3};return(q.dashNb||q.dashSize||q.gapSize||q.useVertexAlpha||q.material)&&e.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),r.updateMeshPositions(t,!1),r}const O=new L.c(t,S,null,void 0,void 0,void 0,q.useVertexAlpha,q.material);return Z(q).Ca(O,q.updatable),O._creationDataStorage=new B.f,O._creationDataStorage.dashSize=b,O._creationDataStorage.gapSize=C,O}z.e.CreateLineSystem=C,z.e.CreateDashedLines=Z,B.c.Li=function(t,q){return O(t,{points:q,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},B.c.CreateDashedLines=function(t,q,S,o,B){return i(t,{points:q,dashSize:S,gapSize:o,dashNb:B,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12523:(t,q,S)=>{"use strict";S.d(q,{d:()=>r,g:()=>e});var o=S(483),B=S(732),z=S(788);function L(t){const q=[],S=[],o=[],L=[],r=void 0!==t.width?t.width:void 0!==t.size?t.size:1,e=void 0!==t.height?t.height:void 0!==t.size?t.size:1,C=0===t.sideOrientation?0:t.sideOrientation||B.e.DEFAULTSIDE,Z=r/2,b=e/2;S.push(-Z,-b,0),o.push(0,0,-1),L.push(0,z.b?1:0),S.push(Z,-b,0),o.push(0,0,-1),L.push(1,z.b?1:0),S.push(Z,b,0),o.push(0,0,-1),L.push(1,z.b?0:1),S.push(-Z,b,0),o.push(0,0,-1),L.push(0,z.b?0:1),q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),B.e._ComputeSides(C,S,q,o,L,t.frontUVs,t.backUVs);const O=new B.e;return O.indices=q,O.xa=S,O.ya=o,O.Aa=L,O}function r(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new o.c(t,S);q.sideOrientation=o.c._GetDefaultSideOrientation(q.sideOrientation),B._originalBuilderSideOrientation=q.sideOrientation;return L(q).Ca(B,q.updatable),q.sourcePlane&&(B.translate(q.sourcePlane.Zi,-q.sourcePlane.d),B.setDirection(q.sourcePlane.Zi.scale(-1))),B}const e={Mi:r};B.e.Mi=L,o.c.Mi=(t,q,S,o,B)=>r(t,{size:q,width:q,height:q,sideOrientation:B,updatable:o},S)},12607:(t,q,S)=>{"use strict";S.d(q,{e:()=>e});var o=S(678),B=S(483),z=S(732),L=S(788);function r(t){const q=0|(t.segments||32),S=t.diameterX||t.diameter||1,B=t.diameterY||t.diameter||1,r=t.diameterZ||t.diameter||1,e=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,C=t.slice&&t.slice<=0?1:t.slice||1,Z=0===t.sideOrientation?0:t.sideOrientation||z.e.DEFAULTSIDE,b=!!t.dedupTopBottomIndices,O=new o.o(S/2,B/2,r/2),i=2+q,h=2*i,l=[],I=[],a=[],v=[];for(let z=0;z<=i;z++){const t=z/i,q=t*Math.PI*C;for(let S=0;S<=h;S++){const B=S/h,z=B*Math.PI*2*e,r=o.e.RotationZ(-q),C=o.e.RotationY(z),Z=o.o.TransformCoordinates(o.o.Up(),r),b=o.o.TransformCoordinates(Z,C),i=b.multiply(O),l=b.divide(O).normalize();I.push(i.x,i.y,i.z),a.push(l.x,l.y,l.z),v.push(B,L.b?1-t:t)}if(z>0){const t=I.length/3;for(let q=t-2*(h+1);q+h+2<t;q++)b?(z>1&&(l.push(q),l.push(q+1),l.push(q+h+1)),(z<i||C<1)&&(l.push(q+h+1),l.push(q+1),l.push(q+h+2))):(l.push(q),l.push(q+1),l.push(q+h+1),l.push(q+h+1),l.push(q+1),l.push(q+h+2))}}z.e._ComputeSides(Z,I,l,a,v,t.frontUVs,t.backUVs);const M=new z.e;return M.indices=l,M.xa=I,M.ya=a,M.Aa=v,M}function e(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return r(q).Ca(o,q.updatable),o}z.e.CreateSphere=r,B.c.CreateSphere=(t,q,S,o,B,z)=>e(t,{segments:q,diameterX:S,diameterY:S,diameterZ:S,sideOrientation:z,updatable:B},o)},13222:(t,q,S)=>{"use strict";S.d(q,{e:()=>r});var o=S(12067),B=S(12895),z=S(12083),L=S(732);class r{static get Configuration(){return{get decoder(){return B.e.DefaultConfiguration},set decoder(t){B.e.DefaultConfiguration=t}}}static set Configuration(t){B.e.DefaultConfiguration=t.decoder}static get DecoderAvailable(){return(0,o.l)(B.e.DefaultConfiguration)}static get Default(){return r._Default??(r._Default=new r),r._Default}static ResetDefault(t){r._Default&&(t||r._Default.dispose(),r._Default=null)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.DefaultNumWorkers;const q="number"===typeof t?{...B.e.DefaultConfiguration,numWorkers:t}:{...B.e.DefaultConfiguration,...t};this._decoder=new B.e(q)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(t,q,S){return this._decoder.decodeMeshToMeshDataAsync(t,q,S)}async decodeMeshToGeometryAsync(t,q,S,o){return await this._decoder.decodeMeshToGeometryAsync(t,q,S,o)}async _decodeMeshToGeometryForGltfAsync(t,q,S,o,B,z){return await this._decoder._decodeMeshToGeometryForGltfAsync(t,q,S,o,B,z)}async decodeMeshAsync(t,q){const S=await this._decoder.decodeMeshToMeshDataAsync(t,q),o=new L.e;S.indices&&(o.indices=S.indices);for(const B of S.attributes){const t=z.e.GetFloatData(B.data,B.size,z.e.GetDataType(B.data),B.byteOffset,B.byteStride,B.normalized,S.totalVertices);o.set(t,B.kind)}return o}}r.DefaultNumWorkers=(0,o.h)(),r._Default=null},12895:(t,q,S)=>{"use strict";S.d(q,{e:()=>C});var o=S(12067),B=S(490),z=S(776),L=S(12083),r=S(496),e=S(12075);class C extends o.e{static get DefaultAvailable(){return(0,o.l)(C.DefaultConfiguration)}static get Default(){return C._Default??(C._Default=new C),C._Default}static ResetDefault(t){C._Default&&(t||C._Default.dispose(),C._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(t,q){return{module:await(q||DracoDecoderModule)({wasmBinary:t})}}_getWorkerContent(){return`${e.c}(${e.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultConfiguration)}decodeMeshToMeshDataAsync(t,q,S){const o=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t.buffer,t.byteOffset,t.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async t=>await new Promise(((B,z)=>{t.push(((t,L)=>{let e=null;const C=[],Z=q=>{t.removeEventListener("error",Z),t.removeEventListener("message",b),z(q),L()},b=q=>{const o=q.data;switch(o.id){case"indices":e=o.data;break;case"attribute":C.push({kind:o.kind,data:o.data,size:o.size,byteOffset:o.byteOffset,byteStride:o.byteStride,normalized:(z=o.kind,O=o.normalized,S&&void 0!==S[z]?(O!==S[z]&&r.c.Warn(`Normalized flag from Draco data (${O}) does not match normalized flag from glTF accessor (${S[z]}). Using flag from glTF accessor.`),S[z]):O)});break;case"decodeMeshDone":t.removeEventListener("error",Z),t.removeEventListener("message",b),B({indices:e,attributes:C,totalVertices:o.totalVertices}),L()}var z,O};t.addEventListener("error",Z),t.addEventListener("message",b);const O=o.slice();t.postMessage({id:"decodeMesh",dataView:O,attributes:q},[O.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((t=>{let S=null;const B=[],z=(0,e.c)(t.module,o,q,(t=>{S=t}),((t,q,S,o,z,L)=>{B.push({kind:t,data:q,size:S,byteOffset:o,byteStride:z,normalized:L})}));return{indices:S,attributes:B,totalVertices:z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(t,q,S,o){const B=await this.decodeMeshToMeshDataAsync(S,o),r=new z.c(t,q);B.indices&&r.setIndices(B.indices);for(const z of B.attributes)r.setVerticesBuffer(new L.e(q.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),B.totalVertices);return r}async _decodeMeshToGeometryForGltfAsync(t,q,S,o,B,r){const e=await this.decodeMeshToMeshDataAsync(S,o,B),C=new z.c(t,q);r&&(C._boundingInfo=r,C.useBoundingInfoFromGeometry=!0),e.indices&&C.setIndices(e.indices);for(const z of e.attributes)C.setVerticesBuffer(new L.e(q.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),e.totalVertices);return C}}C.DefaultConfiguration={wasmUrl:`${B.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${B.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${B.f._DefaultCdnUrl}/draco_decoder_gltf.js`},C._Default=null},13105:(t,q,S)=>{"use strict";S.d(q,{e:()=>rt});var o=S(678),B=S(483),z=S(716),L=S(732),r=S(788);function e(t){let q=t.pathArray;const S=t.closeArray||!1,o=t.closePath||!1,B=t.invertUV||!1,e=Math.floor(q[0].length/2);let C=t.offset||e;C=C>e?e:Math.floor(C);const Z=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE,b=t.Aa,O=t.za,i=[],h=[],l=[],I=[],a=[],v=[],M=[],x=[];let k;const V=[],J=[];let U,H,j;if(q.length<2){const t=[],S=[];for(H=0;H<q[0].length-C;H++)t.push(q[0][H]),S.push(q[0][H+C]);q=[t,S]}let y=0;const Q=o?1:0,K=S?1:0;let X,G,Y,n,u,W;for(k=q[0].length,U=0;U<q.length+K;U++){for(M[U]=0,a[U]=[0],X=U===q.length?q[0]:q[U],G=X.length,k=k<G?k:G,j=0;j<G;)i.push(X[j].x,X[j].y,X[j].z),j>0&&(Y=X[j].Kg(X[j-1]).length(),n=Y+M[U],a[U].push(n),M[U]=n),j++;o&&(j--,i.push(X[0].x,X[0].y,X[0].z),Y=X[j].Kg(X[0]).length(),n=Y+M[U],a[U].push(n),M[U]=n),V[U]=G+Q,J[U]=y,y+=G+Q}let f,D,m=null,A=null;for(H=0;H<k+Q;H++)for(x[H]=0,v[H]=[0],U=0;U<q.length-1+K;U++)u=q[U],W=U===q.length-1?q[0]:q[U+1],H===k?(m=u[0],A=W[0]):(m=u[H],A=W[H]),Y=A.Kg(m).length(),n=Y+x[H],v[H].push(n),x[H]=n;if(b)for(U=0;U<b.length;U++)I.push(b[U].x,r.b?1-b[U].y:b[U].y);else for(U=0;U<q.length+K;U++)for(H=0;H<k+Q;H++)f=0!=M[U]?a[U][H]/M[U]:0,D=0!=x[H]?v[H][U]/x[H]:0,B?I.push(D,f):I.push(f,r.b?1-D:D);U=0;let c=0,s=V[U]-1,g=V[U+1]-1,N=s<g?s:g,T=J[1]-J[0];const w=V.length-1;for(;c<=N&&U<w;)h.push(c,c+T,c+1),h.push(c+T+1,c+1,c+T),c+=1,c===N&&(U++,T=J[U+1]-J[U],s=V[U]-1,g=V[U+1]-1,c=J[U],N=s<g?s+c:g+c);if(L.e.ComputeNormals(i,h,l),o){let t=0,S=0;for(U=0;U<q.length;U++){t=3*J[U],S=U+1<q.length?3*(J[U+1]-1):l.length-3,l[t]=.5*(l[t]+l[S]),l[t+1]=.5*(l[t+1]+l[S+1]),l[t+2]=.5*(l[t+2]+l[S+2]);const o=Math.sqrt(l[t]*l[t]+l[t+1]*l[t+1]+l[t+2]*l[t+2]);l[t]/=o,l[t+1]/=o,l[t+2]/=o,l[S]=l[t],l[S+1]=l[t+1],l[S+2]=l[t+2]}}if(S){let t=3*J[0],S=3*J[q.length];for(H=0;H<k+Q;H++){l[t]=.5*(l[t]+l[S]),l[t+1]=.5*(l[t+1]+l[S+1]),l[t+2]=.5*(l[t+2]+l[S+2]);const q=Math.sqrt(l[t]*l[t]+l[t+1]*l[t+1]+l[t+2]*l[t+2]);l[t]/=q,l[t+1]/=q,l[t+2]/=q,l[S]=l[t],l[S+1]=l[t+1],l[S+2]=l[t+2],t+=3,S+=3}}L.e._ComputeSides(Z,i,h,l,I,t.frontUVs,t.backUVs);let E=null;if(O){E=new Float32Array(4*O.length);for(let t=0;t<O.length;t++)E[4*t]=O[t].r,E[4*t+1]=O[t].g,E[4*t+2]=O[t].b,E[4*t+3]=O[t].a}const p=new L.e,P=new Float32Array(i),F=new Float32Array(l),d=new Float32Array(I);return p.indices=h,p.xa=P,p.ya=F,p.Aa=d,E&&p.set(E,z.i.ColorKind),o&&(p._idx=J),p}function C(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=q.pathArray,Z=q.closeArray,b=q.closePath,O=B.c._GetDefaultSideOrientation(q.sideOrientation),i=q.instance,h=q.updatable;if(i){const t=o.j.wi[0].ui(Number.MAX_VALUE),S=o.j.wi[1].ui(-Number.MAX_VALUE),e=q=>{let o=C[0].length;const z=i;let L=0;const r=z._originalBuilderSideOrientation===B.c.DOUBLESIDE?2:1;for(let B=1;B<=r;++B)for(let r=0;r<C.length;++r){const B=C[r],e=B.length;o=o<e?o:e;for(let z=0;z<o;++z){const o=B[z];q[L]=o.x,q[L+1]=o.y,q[L+2]=o.z,t.minimizeInPlaceFromFloats(o.x,o.y,o.z),S.maximizeInPlaceFromFloats(o.x,o.y,o.z),L+=3}if(z._creationDataStorage&&z._creationDataStorage.closePath){const t=B[0];q[L]=t.x,q[L+1]=t.y,q[L+2]=t.z,L+=3}}},Z=i.getVerticesData(z.i.PositionKind);if(e(Z),i.hasBoundingInfo?i.getBoundingInfo().reConstruct(t,S,i._worldMatrix):i.buildBoundingInfo(t,S,i._worldMatrix),i.updateVerticesData(z.i.PositionKind,Z,!1,!1),q.za){const t=i.getVerticesData(z.i.ColorKind);for(let S=0,o=0;S<q.za.length;S++,o+=4){const B=q.za[S];t[o]=B.r,t[o+1]=B.g,t[o+2]=B.b,t[o+3]=B.a}i.updateVerticesData(z.i.ColorKind,t,!1,!1)}if(q.Aa){const t=i.getVerticesData(z.i.UVKind);for(let S=0;S<q.Aa.length;S++)t[2*S]=q.Aa[S].x,t[2*S+1]=r.b?1-q.Aa[S].y:q.Aa[S].y;i.updateVerticesData(z.i.UVKind,t,!1,!1)}if(!i.areNormalsFrozen||i.isFacetDataEnabled){const t=i.Bi(),q=i.getVerticesData(z.i.NormalKind),S=i.isFacetDataEnabled?i.getFacetDataParameters():null;if(L.e.ComputeNormals(Z,t,q,S),i._creationDataStorage&&i._creationDataStorage.closePath){let t=0,S=0;for(let o=0;o<C.length;o++)t=3*i._creationDataStorage.idx[o],S=o+1<C.length?3*(i._creationDataStorage.idx[o+1]-1):q.length-3,q[t]=.5*(q[t]+q[S]),q[t+1]=.5*(q[t+1]+q[S+1]),q[t+2]=.5*(q[t+2]+q[S+2]),q[S]=q[t],q[S+1]=q[t+1],q[S+2]=q[t+2]}i.areNormalsFrozen||i.updateVerticesData(z.i.NormalKind,q,!1,!1)}return i}{const o=new B.c(t,S);o._originalBuilderSideOrientation=O,o._creationDataStorage=new B.f;const z=e(q);return b&&(o._creationDataStorage.idx=z._idx),o._creationDataStorage.closePath=b,o._creationDataStorage.closeArray=Z,z.Ca(o,h),o}}L.e.CreateRibbon=e,B.c.CreateRibbon=function(t,q){return C(t,{pathArray:q,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var Z=S(846),b=S(12461),O=S(706);function i(t){const q=t.pattern||B.c.NO_FLIP,S=t.tileWidth||t.tileSize||1,o=t.tileHeight||t.tileSize||1,z=t.alignHorizontal||0,r=t.alignVertical||0,e=t.width||t.size||1,C=Math.floor(e/S);let Z=e-C*S;const b=t.height||t.size||1,O=Math.floor(b/o);let i=b-O*o;const h=S*C/2,l=o*O/2;let I=0,a=0,v=0,M=0,x=0,k=0;if(Z>0||i>0){switch(v=-h,M=-l,x=h,k=l,z){case B.c.CENTER:Z/=2,v-=Z,x+=Z;break;case B.c.LEFT:x+=Z,I=-Z/2;break;case B.c.RIGHT:v-=Z,I=Z/2}switch(r){case B.c.CENTER:i/=2,M-=i,k+=i;break;case B.c.BOTTOM:k+=i,a=-i/2;break;case B.c.TOP:M-=i,a=i/2}}const V=[],J=[],U=[];U[0]=[0,0,1,0,1,1,0,1],U[1]=[0,0,1,0,1,1,0,1],q!==B.c.ROTATE_TILE&&q!==B.c.ROTATE_ROW||(U[1]=[1,1,0,1,0,0,1,0]),q!==B.c.FLIP_TILE&&q!==B.c.FLIP_ROW||(U[1]=[1,0,0,0,0,1,1,1]),q!==B.c.FLIP_N_ROTATE_TILE&&q!==B.c.FLIP_N_ROTATE_ROW||(U[1]=[0,1,1,1,1,0,0,0]);let H=[];const j=[],y=[];let Q=0;for(let L=0;L<O;L++)for(let t=0;t<C;t++)V.push(t*S-h+I,L*o-l+a,0),V.push((t+1)*S-h+I,L*o-l+a,0),V.push((t+1)*S-h+I,(L+1)*o-l+a,0),V.push(t*S-h+I,(L+1)*o-l+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),H=q===B.c.FLIP_TILE||q===B.c.ROTATE_TILE||q===B.c.FLIP_N_ROTATE_TILE?H.concat(U[(t%2+L%2)%2]):q===B.c.FLIP_ROW||q===B.c.ROTATE_ROW||q===B.c.FLIP_N_ROTATE_ROW?H.concat(U[L%2]):H.concat(U[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Q+=4;if(Z>0||i>0){const t=i>0&&(r===B.c.CENTER||r===B.c.TOP),L=i>0&&(r===B.c.CENTER||r===B.c.BOTTOM),e=Z>0&&(z===B.c.CENTER||z===B.c.RIGHT),b=Z>0&&(z===B.c.CENTER||z===B.c.LEFT);let U,K,X,G,Y=[];if(t&&e&&(V.push(v+I,M+a,0),V.push(-h+I,M+a,0),V.push(-h+I,M+i+a,0),V.push(v+I,M+i+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,U=1-Z/S,K=1-i/o,X=1,G=1,Y=[U,K,X,K,X,G,U,G],q===B.c.ROTATE_ROW&&(Y=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),q===B.c.FLIP_ROW&&(Y=[1-U,K,1-X,K,1-X,G,1-U,G]),q===B.c.FLIP_N_ROTATE_ROW&&(Y=[U,1-K,X,1-K,X,1-G,U,1-G]),H=H.concat(Y),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&b&&(V.push(h+I,M+a,0),V.push(x+I,M+a,0),V.push(x+I,M+i+a,0),V.push(h+I,M+i+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,U=0,K=1-i/o,X=Z/S,G=1,Y=[U,K,X,K,X,G,U,G],(q===B.c.ROTATE_ROW||q===B.c.ROTATE_TILE&&C%2===0)&&(Y=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),(q===B.c.FLIP_ROW||q===B.c.FLIP_TILE&&C%2===0)&&(Y=[1-U,K,1-X,K,1-X,G,1-U,G]),(q===B.c.FLIP_N_ROTATE_ROW||q===B.c.FLIP_N_ROTATE_TILE&&C%2===0)&&(Y=[U,1-K,X,1-K,X,1-G,U,1-G]),H=H.concat(Y),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&e&&(V.push(v+I,l+a,0),V.push(-h+I,l+a,0),V.push(-h+I,k+a,0),V.push(v+I,k+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,U=1-Z/S,K=0,X=1,G=i/o,Y=[U,K,X,K,X,G,U,G],(q===B.c.ROTATE_ROW&&O%2===1||q===B.c.ROTATE_TILE&&O%1===0)&&(Y=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),(q===B.c.FLIP_ROW&&O%2===1||q===B.c.FLIP_TILE&&O%2===0)&&(Y=[1-U,K,1-X,K,1-X,G,1-U,G]),(q===B.c.FLIP_N_ROTATE_ROW&&O%2===1||q===B.c.FLIP_N_ROTATE_TILE&&O%2===0)&&(Y=[U,1-K,X,1-K,X,1-G,U,1-G]),H=H.concat(Y),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&b&&(V.push(h+I,l+a,0),V.push(x+I,l+a,0),V.push(x+I,k+a,0),V.push(h+I,k+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,U=0,K=0,X=Z/S,G=i/o,Y=[U,K,X,K,X,G,U,G],(q===B.c.ROTATE_ROW&&O%2===1||q===B.c.ROTATE_TILE&&(O+C)%2===1)&&(Y=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),(q===B.c.FLIP_ROW&&O%2===1||q===B.c.FLIP_TILE&&(O+C)%2===1)&&(Y=[1-U,K,1-X,K,1-X,G,1-U,G]),(q===B.c.FLIP_N_ROTATE_ROW&&O%2===1||q===B.c.FLIP_N_ROTATE_TILE&&(O+C)%2===1)&&(Y=[U,1-K,X,1-K,X,1-G,U,1-G]),H=H.concat(Y),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t){const t=[];U=0,K=1-i/o,X=1,G=1,t[0]=[U,K,X,K,X,G,U,G],t[1]=[U,K,X,K,X,G,U,G],q!==B.c.ROTATE_TILE&&q!==B.c.ROTATE_ROW||(t[1]=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),q!==B.c.FLIP_TILE&&q!==B.c.FLIP_ROW||(t[1]=[1-U,K,1-X,K,1-X,G,1-U,G]),q!==B.c.FLIP_N_ROTATE_TILE&&q!==B.c.FLIP_N_ROTATE_ROW||(t[1]=[U,1-K,X,1-K,X,1-G,U,1-G]);for(let o=0;o<C;o++)V.push(o*S-h+I,M+a,0),V.push((o+1)*S-h+I,M+a,0),V.push((o+1)*S-h+I,M+i+a,0),V.push(o*S-h+I,M+i+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,H=q===B.c.FLIP_TILE||q===B.c.ROTATE_TILE||q===B.c.FLIP_N_ROTATE_TILE?H.concat(t[(o+1)%2]):q===B.c.FLIP_ROW||q===B.c.ROTATE_ROW||q===B.c.FLIP_N_ROTATE_ROW?H.concat(t[1]):H.concat(t[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const t=[];U=0,K=0,X=1,G=i/o,t[0]=[U,K,X,K,X,G,U,G],t[1]=[U,K,X,K,X,G,U,G],q!==B.c.ROTATE_TILE&&q!==B.c.ROTATE_ROW||(t[1]=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),q!==B.c.FLIP_TILE&&q!==B.c.FLIP_ROW||(t[1]=[1-U,K,1-X,K,1-X,G,1-U,G]),q!==B.c.FLIP_N_ROTATE_TILE&&q!==B.c.FLIP_N_ROTATE_ROW||(t[1]=[U,1-K,X,1-K,X,1-G,U,1-G]);for(let o=0;o<C;o++)V.push(o*S-h+I,k-i+a,0),V.push((o+1)*S-h+I,k-i+a,0),V.push((o+1)*S-h+I,k+a,0),V.push(o*S-h+I,k+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,H=q===B.c.FLIP_TILE||q===B.c.ROTATE_TILE||q===B.c.FLIP_N_ROTATE_TILE?H.concat(t[(o+O)%2]):q===B.c.FLIP_ROW||q===B.c.ROTATE_ROW||q===B.c.FLIP_N_ROTATE_ROW?H.concat(t[O%2]):H.concat(t[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const t=[];U=1-Z/S,K=0,X=1,G=1,t[0]=[U,K,X,K,X,G,U,G],t[1]=[U,K,X,K,X,G,U,G],q!==B.c.ROTATE_TILE&&q!==B.c.ROTATE_ROW||(t[1]=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),q!==B.c.FLIP_TILE&&q!==B.c.FLIP_ROW||(t[1]=[1-U,K,1-X,K,1-X,G,1-U,G]),q!==B.c.FLIP_N_ROTATE_TILE&&q!==B.c.FLIP_N_ROTATE_ROW||(t[1]=[U,1-K,X,1-K,X,1-G,U,1-G]);for(let S=0;S<O;S++)V.push(v+I,S*o-l+a,0),V.push(v+Z+I,S*o-l+a,0),V.push(v+Z+I,(S+1)*o-l+a,0),V.push(v+I,(S+1)*o-l+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,H=q===B.c.FLIP_TILE||q===B.c.ROTATE_TILE||q===B.c.FLIP_N_ROTATE_TILE?H.concat(t[(S+1)%2]):q===B.c.FLIP_ROW||q===B.c.ROTATE_ROW||q===B.c.FLIP_N_ROTATE_ROW?H.concat(t[S%2]):H.concat(t[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(b){const t=[];U=0,K=0,X=Z/o,G=1,t[0]=[U,K,X,K,X,G,U,G],t[1]=[U,K,X,K,X,G,U,G],q!==B.c.ROTATE_TILE&&q!==B.c.ROTATE_ROW||(t[1]=[1-U,1-K,1-X,1-K,1-X,1-G,1-U,1-G]),q!==B.c.FLIP_TILE&&q!==B.c.FLIP_ROW||(t[1]=[1-U,K,1-X,K,1-X,G,1-U,G]),q!==B.c.FLIP_N_ROTATE_TILE&&q!==B.c.FLIP_N_ROTATE_ROW||(t[1]=[U,1-K,X,1-K,X,1-G,U,1-G]);for(let S=0;S<O;S++)V.push(x-Z+I,S*o-l+a,0),V.push(x+I,S*o-l+a,0),V.push(x+I,(S+1)*o-l+a,0),V.push(x-Z+I,(S+1)*o-l+a,0),y.push(Q,Q+1,Q+3,Q+1,Q+2,Q+3),Q+=4,H=q===B.c.FLIP_TILE||q===B.c.ROTATE_TILE||q===B.c.FLIP_N_ROTATE_TILE?H.concat(t[(S+C)%2]):q===B.c.FLIP_ROW||q===B.c.ROTATE_ROW||q===B.c.FLIP_N_ROTATE_ROW?H.concat(t[S%2]):H.concat(t[0]),j.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),J.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const K=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE;L.e._ComputeSides(K,V,y,J,H,t.frontUVs,t.backUVs);const X=new L.e;X.indices=y,X.xa=V,X.ya=J,X.Aa=H;const G=K===L.e.DOUBLESIDE?j.concat(j):j;return X.za=G,X}function h(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return i(q).Ca(o,q.updatable),o}function l(t){const q=t.faceUV||new Array(6),S=t.faceColors,z=t.pattern||B.c.NO_FLIP,e=t.width||t.size||1,C=t.height||t.size||1,Z=t.depth||t.size||1,b=t.tileWidth||t.tileSize||1,h=t.tileHeight||t.tileSize||1,l=t.alignHorizontal||0,I=t.alignVertical||0,a=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE;for(let B=0;B<6;B++)void 0===q[B]&&(q[B]=new o.s(0,0,1,1)),S&&void 0===S[B]&&(S[B]=new O.d(1,1,1,1));const v=e/2,M=C/2,x=Z/2,k=[];for(let o=0;o<2;o++)k[o]=i({pattern:z,tileWidth:b,tileHeight:h,width:e,height:C,alignVertical:I,alignHorizontal:l,sideOrientation:a});for(let o=2;o<4;o++)k[o]=i({pattern:z,tileWidth:b,tileHeight:h,width:Z,height:C,alignVertical:I,alignHorizontal:l,sideOrientation:a});let V=I;I===B.c.BOTTOM?V=B.c.TOP:I===B.c.TOP&&(V=B.c.BOTTOM);for(let o=4;o<6;o++)k[o]=i({pattern:z,tileWidth:b,tileHeight:h,width:e,height:Z,alignVertical:V,alignHorizontal:l,sideOrientation:a});let J=[],U=[],H=[],j=[];const y=[],Q=[],K=[],X=[];let G=0,Y=0;for(let B=0;B<6;B++){const t=k[B].xa.length;Q[B]=[],K[B]=[];for(let q=0;q<t/3;q++)Q[B].push(new o.o(k[B].xa[3*q],k[B].xa[3*q+1],k[B].xa[3*q+2])),K[B].push(new o.o(k[B].ya[3*q],k[B].ya[3*q+1],k[B].ya[3*q+2]));G=k[B].Aa.length,X[B]=[];for(let S=0;S<G;S+=2)X[B][S]=q[B].x+(q[B].z-q[B].x)*k[B].Aa[S],X[B][S+1]=q[B].y+(q[B].w-q[B].y)*k[B].Aa[S+1],r.b&&(X[B][S+1]=1-X[B][S+1]);if(H=H.concat(X[B]),j=j.concat(k[B].indices.map((t=>t+Y))),Y+=Q[B].length,S)for(let q=0;q<4;q++)y.push(S[B].r,S[B].g,S[B].b,S[B].a)}const n=new o.o(0,0,x),u=o.e.RotationY(Math.PI);J=Q[0].map((t=>o.o.TransformNormal(t,u).add(n))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[]),U=K[0].map((t=>o.o.TransformNormal(t,u))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[]),J=J.concat(Q[1].map((t=>t.Kg(n))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[])),U=U.concat(K[1].map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[]));const W=new o.o(v,0,0),f=o.e.RotationY(-Math.PI/2);J=J.concat(Q[2].map((t=>o.o.TransformNormal(t,f).add(W))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[])),U=U.concat(K[2].map((t=>o.o.TransformNormal(t,f))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[]));const D=o.e.RotationY(Math.PI/2);J=J.concat(Q[3].map((t=>o.o.TransformNormal(t,D).Kg(W))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[])),U=U.concat(K[3].map((t=>o.o.TransformNormal(t,D))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[]));const m=new o.o(0,M,0),A=o.e.RotationX(Math.PI/2);J=J.concat(Q[4].map((t=>o.o.TransformNormal(t,A).add(m))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[])),U=U.concat(K[4].map((t=>o.o.TransformNormal(t,A))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[]));const c=o.e.RotationX(-Math.PI/2);J=J.concat(Q[5].map((t=>o.o.TransformNormal(t,c).Kg(m))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[])),U=U.concat(K[5].map((t=>o.o.TransformNormal(t,c))).map((t=>[t.x,t.y,t.z])).reduce(((t,q)=>t.concat(q)),[])),L.e._ComputeSides(a,J,j,U,H);const s=new L.e;if(s.indices=j,s.xa=J,s.ya=U,s.Aa=H,S){const t=a===L.e.DOUBLESIDE?y.concat(y):y;s.za=t}return s}function I(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return l(q).Ca(o,q.updatable),o}L.e.CreateTiledPlane=i;L.e.CreateTiledBox=l;var a=S(12607),v=S(2428),M=S(812);function x(t){const q=t.height||2;let S=0===t.diameterTop?0:t.diameterTop||t.diameter||1,z=0===t.diameterBottom?0:t.diameterBottom||t.diameter||1;S=S||1e-5,z=z||1e-5;const e=0|(t.tessellation||24),C=0|(t.subdivisions||1),Z=!!t.hasRings,b=!!t.enclose,i=0===t.cap?0:t.cap||B.c.CAP_ALL,h=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,l=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE,I=t.faceUV||new Array(3),a=t.faceColors,v=2+(1+(1!==h&&b?2:0))*(Z?C:1);let x;for(x=0;x<v;x++)a&&void 0===a[x]&&(a[x]=new O.d(1,1,1,1));for(x=0;x<v;x++)I&&void 0===I[x]&&(I[x]=new o.s(0,0,1,1));const k=[],V=[],J=[],U=[],H=[],j=2*Math.PI*h/e;let y,Q,K;const X=(z-S)/2/q,G=o.o.Zero(),Y=o.o.Zero(),n=o.o.Zero(),u=o.o.Zero(),W=o.o.Zero(),f=M.b.Y;let D,m,A,c=1,s=1,g=0,N=0;for(D=0;D<=C;D++)for(Q=D/C,K=(Q*(S-z)+z)/2,c=Z&&0!==D&&D!==C?2:1,A=0;A<c;A++){for(Z&&(s+=A),b&&(s+=2*A),m=0;m<=e;m++)y=m*j,G.x=Math.cos(-y)*K,G.y=-q/2+Q*q,G.z=Math.sin(-y)*K,0===S&&D===C?(Y.x=J[J.length-3*(e+1)],Y.y=J[J.length-3*(e+1)+1],Y.z=J[J.length-3*(e+1)+2]):(Y.x=G.x,Y.z=G.z,Y.y=Math.sqrt(Y.x*Y.x+Y.z*Y.z)*X,Y.normalize()),0===m&&(n.p(G),u.p(Y)),V.push(G.x,G.y,G.z),J.push(Y.x,Y.y,Y.z),N=Z?g!==s?I[s].y:I[s].w:I[s].y+(I[s].w-I[s].y)*Q,U.push(I[s].x+(I[s].z-I[s].x)*m/e,r.b?1-N:N),a&&H.push(a[s].r,a[s].g,a[s].b,a[s].a);1!==h&&b&&(V.push(G.x,G.y,G.z),V.push(0,G.y,0),V.push(0,G.y,0),V.push(n.x,n.y,n.z),o.o.CrossToRef(f,Y,W),W.normalize(),J.push(W.x,W.y,W.z,W.x,W.y,W.z),o.o.CrossToRef(u,f,W),W.normalize(),J.push(W.x,W.y,W.z,W.x,W.y,W.z),N=Z?g!==s?I[s+1].y:I[s+1].w:I[s+1].y+(I[s+1].w-I[s+1].y)*Q,U.push(I[s+1].x,r.b?1-N:N),U.push(I[s+1].z,r.b?1-N:N),N=Z?g!==s?I[s+2].y:I[s+2].w:I[s+2].y+(I[s+2].w-I[s+2].y)*Q,U.push(I[s+2].x,r.b?1-N:N),U.push(I[s+2].z,r.b?1-N:N),a&&(H.push(a[s+1].r,a[s+1].g,a[s+1].b,a[s+1].a),H.push(a[s+1].r,a[s+1].g,a[s+1].b,a[s+1].a),H.push(a[s+2].r,a[s+2].g,a[s+2].b,a[s+2].a),H.push(a[s+2].r,a[s+2].g,a[s+2].b,a[s+2].a))),g!==s&&(g=s)}const T=1!==h&&b?e+4:e;for(D=0,s=0;s<C;s++){let t=0,q=0,S=0,o=0;for(m=0;m<e;m++)t=D*(T+1)+m,q=(D+1)*(T+1)+m,S=D*(T+1)+(m+1),o=(D+1)*(T+1)+(m+1),k.push(t,q,S),k.push(o,S,q);1!==h&&b&&(k.push(t+2,q+2,S+2),k.push(o+2,S+2,q+2),k.push(t+4,q+4,S+4),k.push(o+4,S+4,q+4)),D=Z?D+2:D+1}const w=t=>{const B=t?S/2:z/2;if(0===B)return;let L,C,Z;const b=t?I[v-1]:I[0];let O=null;a&&(O=t?a[v-1]:a[0]);const i=V.length/3,l=t?q/2:-q/2,M=new o.o(0,l,0);V.push(M.x,M.y,M.z),J.push(0,t?1:-1,0);const x=b.y+.5*(b.w-b.y);U.push(b.x+.5*(b.z-b.x),r.b?1-x:x),O&&H.push(O.r,O.g,O.b,O.a);const j=new o.l(.5,.5);for(Z=0;Z<=e;Z++){L=2*Math.PI*Z*h/e;const q=Math.cos(-L),S=Math.sin(-L);C=new o.o(q*B,l,S*B);const z=new o.l(q*j.x+.5,S*j.y+.5);V.push(C.x,C.y,C.z),J.push(0,t?1:-1,0);const i=b.y+(b.w-b.y)*z.y;U.push(b.x+(b.z-b.x)*z.x,r.b?1-i:i),O&&H.push(O.r,O.g,O.b,O.a)}for(Z=0;Z<e;Z++)t?(k.push(i),k.push(i+(Z+2)),k.push(i+(Z+1))):(k.push(i),k.push(i+(Z+1)),k.push(i+(Z+2)))};i!==B.c.CAP_START&&i!==B.c.CAP_ALL||w(!1),i!==B.c.CAP_END&&i!==B.c.CAP_ALL||w(!0),L.e._ComputeSides(l,V,k,J,U,t.frontUVs,t.backUVs);const E=new L.e;return E.indices=k,E.xa=V,E.ya=J,E.Aa=U,a&&(E.za=H),E}function k(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return x(q).Ca(o,q.updatable),o}function V(t){const q=[],S=[],B=[],z=[],e=t.diameter||1,C=t.thickness||.5,Z=0|(t.tessellation||16),b=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE,O=Z+1;for(let L=0;L<=Z;L++){const t=L/Z,b=L*Math.PI*2/Z-Math.PI/2,i=o.e.Translation(e/2,0,0).multiply(o.e.RotationY(b));for(let e=0;e<=Z;e++){const b=1-e/Z,h=e*Math.PI*2/Z+Math.PI,l=Math.cos(h),I=Math.sin(h);let a=new o.o(l,I,0),v=a.scale(C/2);const M=new o.l(t,b);v=o.o.TransformCoordinates(v,i),a=o.o.TransformNormal(a,i),S.push(v.x,v.y,v.z),B.push(a.x,a.y,a.z),z.push(M.x,r.b?1-M.y:M.y);const x=(L+1)%O,k=(e+1)%O;q.push(L*O+e),q.push(L*O+k),q.push(x*O+e),q.push(L*O+k),q.push(x*O+k),q.push(x*O+e)}}L.e._ComputeSides(b,S,q,B,z,t.frontUVs,t.backUVs);const i=new L.e;return i.indices=q,i.xa=S,i.ya=B,i.Aa=z,i}function J(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return V(q).Ca(o,q.updatable),o}L.e.CreateCylinder=x,B.c.CreateCylinder=(t,q,S,o,z,L,r,e,C)=>{void 0!==r&&r instanceof v.d||(void 0!==r&&(C=e||B.c.DEFAULTSIDE,e=r),r=L,L=1);return k(t,{height:q,diameterTop:S,diameterBottom:o,tessellation:z,subdivisions:L,sideOrientation:C,updatable:e},r)};function U(t){const q=[],S=[],B=[],z=[],e=t.radius||2,C=t.tube||.5,Z=t.radialSegments||32,b=t.tubularSegments||32,O=t.p||2,i=t.q||3,h=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE,l=t=>{const q=Math.cos(t),S=Math.sin(t),B=i/O*t,z=Math.cos(B),L=e*(2+z)*.5*q,r=e*(2+z)*S*.5,C=e*Math.sin(B)*.5;return new o.o(L,r,C)};let I,a;for(I=0;I<=Z;I++){const t=I%Z/Z*2*O*Math.PI,q=l(t),B=l(t+.01),L=B.Kg(q);let e=B.add(q);const i=o.o.Cross(L,e);for(e=o.o.Cross(i,L),i.normalize(),e.normalize(),a=0;a<b;a++){const t=a%b/b*2*Math.PI,o=-C*Math.cos(t),B=C*Math.sin(t);S.push(q.x+o*e.x+B*i.x),S.push(q.y+o*e.y+B*i.y),S.push(q.z+o*e.z+B*i.z),z.push(I/Z),z.push(r.b?1-a/b:a/b)}}for(I=0;I<Z;I++)for(a=0;a<b;a++){const t=(a+1)%b,S=I*b+a,o=(I+1)*b+a,B=(I+1)*b+t,z=I*b+t;q.push(z),q.push(o),q.push(S),q.push(z),q.push(B),q.push(o)}L.e.ComputeNormals(S,q,B),L.e._ComputeSides(h,S,q,B,z,t.frontUVs,t.backUVs);const v=new L.e;return v.indices=q,v.xa=S,v.ya=B,v.Aa=z,v}function H(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return U(q).Ca(o,q.updatable),o}L.e.CreateTorus=V,B.c.CreateTorus=(t,q,S,o,B,z,L)=>J(t,{diameter:q,thickness:S,tessellation:o,sideOrientation:L,updatable:z},B);L.e.CreateTorusKnot=U,B.c.CreateTorusKnot=(t,q,S,o,B,z,L,r,e,C)=>H(t,{radius:q,tube:S,radialSegments:o,tubularSegments:B,p:z,q:L,sideOrientation:C,updatable:e},r);var j=S(13107),y=S(12062),Q=S(2280);function K(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=q.path,z=q.shape,L=q.scale||1,r=q.rotation||0,e=0===q.cap?0:q.cap||B.c.NO_CAP,C=q.updatable,Z=B.c._GetDefaultSideOrientation(q.sideOrientation),b=q.instance||null,O=q.invertUV||!1,i=q.closeShape||!1,h=q.closePath||!1,l=q.capFunction||null;return G(t,z,o,L,r,null,null,h,i,e,!1,S,!!C,Z,b,O,q.frontUVs||null,q.backUVs||null,q.firstNormal||null,!!q.adjustFrame,l)}function X(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=q.path,z=q.shape,L=q.scaleFunction||(()=>1),r=q.rotationFunction||(()=>0),e=q.closePath||q.ribbonCloseArray||!1,C=q.closeShape||q.ribbonClosePath||!1,Z=0===q.cap?0:q.cap||B.c.NO_CAP,b=q.updatable,O=q.firstNormal||null,i=q.adjustFrame||!1,h=B.c._GetDefaultSideOrientation(q.sideOrientation),l=q.instance,I=q.invertUV||!1,a=q.capFunction||null;return G(t,z,o,null,null,L,r,e,C,Z,!0,S,!!b,h,l||null,I,q.frontUVs||null,q.backUVs||null,O,i,a||null)}function G(t,q,S,z,L,r,e,Z,b,O,i,h,l,I,a,v,M,x,k,V,J){const U=(t,q,S,z,L,r,e,C,Z,b,O)=>{const i=S.getTangents(),h=S.getNormals(),l=S.getBinormals(),I=S.getDistances();if(O)for(let B=0;B<i.length;B++)if(0==i[B].x&&0==i[B].y&&0==i[B].z&&i[B].p(i[B-1]),0==h[B].x&&0==h[B].y&&0==h[B].z&&h[B].p(h[B-1]),0==l[B].x&&0==l[B].y&&0==l[B].z&&l[B].p(l[B-1]),B>0){let t=i[B-1];o.o.Dot(t,i[B])<0&&i[B].scaleInPlace(-1),t=h[B-1],o.o.Dot(t,h[B])<0&&h[B].scaleInPlace(-1),t=l[B-1],o.o.Dot(t,l[B])<0&&l[B].scaleInPlace(-1)}let a=0;const v=b&&C?C:()=>null!==r?r:0,M=b&&e?e:()=>null!==L?L:1;let x=Z===B.c.NO_CAP||Z===B.c.CAP_END?0:2;const k=o.j.Matrix[0];for(let B=0;B<q.length;B++){const S=[],L=v(B,I[B]),r=M(B,I[B]);o.e.RotationAxisToRef(i[B],a,k);for(let z=0;z<t.length;z++){const L=i[B].scale(t[z].z).add(h[B].scale(t[z].x)).add(l[B].scale(t[z].y)),e=o.o.Zero();o.o.TransformCoordinatesToRef(L,k,e),e.scaleInPlace(r).addInPlace(q[B]),S[z]=e}z[x]=S,a+=L,x++}const V=J||(t=>{const q=Array(),S=o.o.Zero();let B;for(B=0;B<t.length;B++)S.addInPlace(t[B]);for(S.scaleInPlace(1/t.length),B=0;B<t.length;B++)q.push(S);return q});switch(Z){case B.c.NO_CAP:break;case B.c.CAP_START:z[0]=V(z[2]),z[1]=z[2];break;case B.c.CAP_END:z[x]=z[x-1],z[x+1]=V(z[x-1]);break;case B.c.CAP_ALL:z[0]=V(z[2]),z[1]=z[2],z[x]=z[x-1],z[x+1]=V(z[x-1])}return z};let H,j;if(a){const t=a._creationDataStorage;return H=k?t.path3D.update(S,k):t.path3D.update(S),j=U(q,S,t.path3D,t.pathArray,z,L,r,e,t.cap,i,V),a=C("",{pathArray:j,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:a},h||void 0)}H=k?new Q.i(S,k):new Q.i(S);j=U(q,S,H,new Array,z,L,r,e,O=O<0||O>3?0:O,i,V);const y=C(t,{pathArray:j,closeArray:Z,closePath:b,updatable:l,sideOrientation:I,invertUV:v,frontUVs:M||void 0,backUVs:x||void 0},h);return y._creationDataStorage.pathArray=j,y._creationDataStorage.path3D=H,y._creationDataStorage.cap=O,y}function Y(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.arc?q.arc<=0||q.arc>1?1:q.arc:1,L=void 0===q.closed||q.closed,r=q.shape,e=q.radius||1,Z=q.tessellation||64,b=q.clip||0,O=q.updatable,i=B.c._GetDefaultSideOrientation(q.sideOrientation),h=q.cap||B.c.NO_CAP,l=2*Math.PI,I=[],a=q.invertUV||!1;let v=0,M=0;const x=l/Z*z;let k,V;for(v=0;v<=Z-b;v++){for(V=[],h!=B.c.CAP_START&&h!=B.c.CAP_ALL||(V.push(new o.o(0,r[0].y,0)),V.push(new o.o(Math.cos(v*x)*r[0].x*e,r[0].y,Math.sin(v*x)*r[0].x*e))),M=0;M<r.length;M++)k=new o.o(Math.cos(v*x)*r[M].x*e,r[M].y,Math.sin(v*x)*r[M].x*e),V.push(k);h!=B.c.CAP_END&&h!=B.c.CAP_ALL||(V.push(new o.o(Math.cos(v*x)*r[r.length-1].x*e,r[r.length-1].y,Math.sin(v*x)*r[r.length-1].x*e)),V.push(new o.o(0,r[r.length-1].y,0))),I.push(V)}return C(t,{pathArray:I,closeArray:L,sideOrientation:i,updatable:O,invertUV:a,frontUVs:q.frontUVs,backUVs:q.backUVs},S)}B.c.ExtrudeShape=function(t,q,S,o,z,L){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,Z=arguments.length>9?arguments[9]:void 0;return K(t,{shape:q,path:S,scale:o,rotation:z,cap:0===L?0:L||B.c.NO_CAP,sideOrientation:C,instance:Z,updatable:e},r)},B.c.ExtrudeShapeCustom=(t,q,S,o,z,L,r,e,C,Z,b,O)=>X(t,{shape:q,path:S,scaleFunction:o,rotationFunction:z,ribbonCloseArray:L,ribbonClosePath:r,cap:0===e?0:e||B.c.NO_CAP,sideOrientation:b,instance:O,updatable:Z},C);B.c.CreateLathe=(t,q,S,o,B,z,L)=>Y(t,{shape:q,radius:S,tessellation:o,sideOrientation:L,updatable:z},B);var n=S(12523),u=S(12463);function W(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.path;let L=q.instance,r=1;void 0!==q.radius?r=q.radius:L&&(r=L._creationDataStorage.radius);const e=q.tessellation||64,Z=q.radiusFunction||null;let b=q.cap||B.c.NO_CAP;const O=q.invertUV||!1,i=q.updatable,h=B.c._GetDefaultSideOrientation(q.sideOrientation);q.arc=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1;const l=(t,q,S,z,L,r,e,C)=>{const Z=q.getTangents(),b=q.getNormals(),O=q.getDistances(),i=2*Math.PI/L*C,h=r||(()=>z);let l,I,a,v;const M=o.j.Matrix[0];let x=e===B.c.NO_CAP||e===B.c.CAP_END?0:2;for(let B=0;B<t.length;B++){I=h(B,O[B]),l=Array(),a=b[B];for(let q=0;q<L;q++)o.e.RotationAxisToRef(Z[B],i*q,M),v=l[q]?l[q]:o.o.Zero(),o.o.TransformCoordinatesToRef(a,M,v),v.scaleInPlace(I).addInPlace(t[B]),l[q]=v;S[x]=l,x++}const k=(q,S)=>{const o=Array();for(let B=0;B<q;B++)o.push(t[S]);return o};switch(e){case B.c.NO_CAP:break;case B.c.CAP_START:S[0]=k(L,0),S[1]=S[2].slice(0);break;case B.c.CAP_END:S[x]=S[x-1].slice(0),S[x+1]=k(L,t.length-1);break;case B.c.CAP_ALL:S[0]=k(L,0),S[1]=S[2].slice(0),S[x]=S[x-1].slice(0),S[x+1]=k(L,t.length-1)}return S};let I,a;if(L){const t=L._creationDataStorage,S=q.arc||t.arc;return I=t.path3D.update(z),a=l(z,I,t.pathArray,r,t.tessellation,Z,t.cap,S),L=C("",{pathArray:a,instance:L}),t.path3D=I,t.pathArray=a,t.arc=S,t.radius=r,L}I=new Q.i(z);b=b<0||b>3?0:b,a=l(z,I,new Array,r,e,Z,b,q.arc);const v=C(t,{pathArray:a,closePath:!0,closeArray:!1,updatable:i,sideOrientation:h,invertUV:O,frontUVs:q.frontUVs,backUVs:q.backUVs},S);return v._creationDataStorage.pathArray=a,v._creationDataStorage.path3D=I,v._creationDataStorage.tessellation=e,v._creationDataStorage.cap=b,v._creationDataStorage.arc=q.arc,v._creationDataStorage.radius=r,v}function f(t){const q=[];q[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},q[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},q[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},q[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},q[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},q[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},q[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},q[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},q[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},q[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},q[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},q[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},q[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},q[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},q[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const S=t.type&&(t.type<0||t.type>=q.length)?0:t.type||0,B=t.size,z=t.sizeX||B||1,e=t.sizeY||B||1,C=t.sizeZ||B||1,Z=t.custom||q[S],b=Z.face.length,i=t.faceUV||new Array(b),h=t.faceColors,l=void 0===t.flat||t.flat,I=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE,a=[],v=[],M=[],x=[],k=[];let V=0,J=0;const U=[];let H,j,y,Q,K,X,G=0,Y=0;if(l)for(Y=0;Y<b;Y++)h&&void 0===h[Y]&&(h[Y]=new O.d(1,1,1,1)),i&&void 0===i[Y]&&(i[Y]=new o.s(0,0,1,1));if(l)for(Y=0;Y<b;Y++){const t=Z.face[Y].length;for(y=2*Math.PI/t,Q=.5*Math.tan(y/2),K=.5,G=0;G<t;G++)a.push(Z.vertex[Z.face[Y][G]][0]*z,Z.vertex[Z.face[Y][G]][1]*e,Z.vertex[Z.face[Y][G]][2]*C),U.push(V),V++,H=i[Y].x+(i[Y].z-i[Y].x)*(.5+Q),j=i[Y].y+(i[Y].w-i[Y].y)*(K-.5),x.push(H,r.b?1-j:j),X=Q*Math.cos(y)-K*Math.sin(y),K=Q*Math.sin(y)+K*Math.cos(y),Q=X,h&&k.push(h[Y].r,h[Y].g,h[Y].b,h[Y].a);for(G=0;G<t-2;G++)v.push(U[0+J],U[G+2+J],U[G+1+J]);J+=t}else{for(G=0;G<Z.vertex.length;G++)a.push(Z.vertex[G][0]*z,Z.vertex[G][1]*e,Z.vertex[G][2]*C),x.push(0,r.b?1:0);for(Y=0;Y<b;Y++)for(G=0;G<Z.face[Y].length-2;G++)v.push(Z.face[Y][0],Z.face[Y][G+2],Z.face[Y][G+1])}L.e.ComputeNormals(a,v,M),L.e._ComputeSides(I,a,v,M,x,t.frontUVs,t.backUVs);const n=new L.e;return n.xa=a,n.indices=v,n.ya=M,n.Aa=x,h&&l&&(n.za=k),n}function D(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return f(q).Ca(o,q.updatable),o}B.c.CreateTube=(t,q,S,o,B,z,L,r,e,C)=>W(t,{path:q,radius:S,tessellation:o,radiusFunction:B,arc:1,cap:z,updatable:r,sideOrientation:e,instance:C},L);function m(t){const q=t.sideOrientation||L.e.DEFAULTSIDE,S=t.radius||1,B=void 0===t.flat||t.flat,z=0|(t.subdivisions||4),e=t.radiusX||S,C=t.radiusY||S,Z=t.radiusZ||S,b=(1+Math.sqrt(5))/2,O=[-1,b,-0,1,b,0,-1,-b,0,1,-b,0,0,-1,-b,0,1,-b,0,-1,b,0,1,b,b,0,1,b,0,-1,-b,0,1,-b,0,-1],i=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],h=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],l=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],a=[],v=[],M=[],x=[];let k=0;const V=new Array(3),J=new Array(3);let U;for(U=0;U<3;U++)V[U]=o.o.Zero(),J[U]=o.l.Zero();for(let L=0;L<20;L++){for(U=0;U<3;U++){const t=i[3*L+U];V[U].ni(O[3*h[t]],O[3*h[t]+1],O[3*h[t]+2]),V[U].normalize(),J[U].ni(.134765625*l[2*t]+.05859375+-.0390625*I[L],.2333984375*l[2*t+1]+.025390625+.01953125*I[L])}const t=(t,q,S,L)=>{const b=o.o.Lerp(V[0],V[2],q/z),O=o.o.Lerp(V[1],V[2],q/z),i=z===q?V[2]:o.o.Lerp(b,O,t/(z-q));let h;if(i.normalize(),B){const t=o.o.Lerp(V[0],V[2],L/z),q=o.o.Lerp(V[1],V[2],L/z);h=o.o.Lerp(t,q,S/(z-L))}else h=new o.o(i.x,i.y,i.z);h.x/=e,h.y/=C,h.z/=Z,h.normalize();const l=o.l.Lerp(J[0],J[2],q/z),I=o.l.Lerp(J[1],J[2],q/z),U=z===q?J[2]:o.l.Lerp(l,I,t/(z-q));v.push(i.x*e,i.y*C,i.z*Z),M.push(h.x,h.y,h.z),x.push(U.x,r.b?1-U.y:U.y),a.push(k),k++};for(let q=0;q<z;q++)for(let S=0;S+q<z;S++)t(S,q,S+1/3,q+1/3),t(S+1,q,S+1/3,q+1/3),t(S,q+1,S+1/3,q+1/3),S+q+1<z&&(t(S+1,q,S+2/3,q+2/3),t(S+1,q+1,S+2/3,q+2/3),t(S,q+1,S+2/3,q+2/3))}L.e._ComputeSides(q,v,a,M,x,t.frontUVs,t.backUVs);const H=new L.e;return H.indices=a,H.xa=v,H.ya=M,H.Aa=x,H}function A(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new B.c(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),o._originalBuilderSideOrientation=q.sideOrientation;return m(q).Ca(o,q.updatable),o}L.e.CreatePolyhedron=f,B.c.CreatePolyhedron=(t,q,S)=>D(t,q,S);L.e.CreateIcoSphere=m,B.c.CreateIcoSphere=(t,q,S)=>A(t,q,S);var c=S(689);const s=new o.o(1,0,0),g=new o.o(-1,0,0),N=new o.o(0,1,0),T=new o.o(0,-1,0),w=new o.o(0,0,1),E=new o.o(0,0,-1);class p{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.o.Zero(),q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.o.Up(),S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.l.Zero(),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=t,this.Zi=q,this.uv=S,this.vertexIdx=B,this.vertexIdxForBones=z,this.localPositionOverride=L,this.localNormalOverride=r,this.matrixIndicesOverride=e,this.matrixWeightsOverride=C}clone(){var t,q,S,o;return new p(this.position.clone(),this.Zi.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(t=this.localPositionOverride)||void 0===t?void 0:t.slice(),null===(q=this.localNormalOverride)||void 0===q?void 0:q.slice(),null===(S=this.matrixIndicesOverride)||void 0===S?void 0:S.slice(),null===(o=this.matrixWeightsOverride)||void 0===o?void 0:o.slice())}}function P(t,q,S){var e,C,Z,b,O;const i=!!q.skeleton,h=!(null===(e=q.morphTargetManager)||void 0===e||!e.numTargets),l=S.localMode||i,I=q.Bi(),a=i||h?q.Nf(!0,!0):q.getVerticesData(z.i.PositionKind),v=i||h?q.getNormalsData(!0,!0):q.getVerticesData(z.i.NormalKind),M=l?i?q.getVerticesData(z.i.PositionKind):a:null,x=l?i?q.getVerticesData(z.i.NormalKind):v:null,k=q.getVerticesData(z.i.UVKind),V=i?q.getVerticesData(z.i.MatricesIndicesKind):null,J=i?q.getVerticesData(z.i.MatricesWeightsKind):null,U=i?q.getVerticesData(z.i.MatricesIndicesExtraKind):null,H=i?q.getVerticesData(z.i.MatricesWeightsExtraKind):null,j=S.position||o.o.Zero();let y=S.Zi||o.o.Up();const Q=S.size||o.o.One(),K=S.angle||0;if(!y){const t=new o.o(0,0,1),S=q.va().activeCamera,B=o.o.TransformCoordinates(t,S.getWorldMatrix());y=S.globalPosition.Kg(B)}const X=-Math.atan2(y.z,y.x)-Math.PI/2,G=Math.sqrt(y.x*y.x+y.z*y.z),Y=Math.atan2(y.y,G),n=new L.e;n.indices=[],n.xa=[],n.ya=[],n.Aa=[],n.matricesIndices=i?[]:null,n.matricesWeights=i?[]:null,n.matricesIndicesExtra=U?[]:null,n.matricesWeightsExtra=H?[]:null;let u=0;const W=(t,q)=>{const B=new p;if(!I||!a||!v)return B;const z=I[t];if(B.vertexIdx=3*z,B.vertexIdxForBones=4*z,B.position=new o.o(a[3*z],a[3*z+1],a[3*z+2]),o.o.TransformCoordinatesToRef(B.position,q,B.position),B.Zi=new o.o(v[3*z],v[3*z+1],v[3*z+2]),o.o.TransformNormalToRef(B.Zi,q,B.Zi),S.captureUVS&&k){const t=k[2*z+1];B.uv=new o.l(k[2*z],r.b?1-t:t)}return B},f=[0,0,0,0],D=(t,q)=>{if(0===t.length)return t;const S=.5*Math.abs(o.o.Dot(Q,q)),B=(t,q,S,o)=>{for(let B=0;B<o;++B)if(t[S+B]===q)return S+B;return-1},z=(t,z)=>{const L=o.o.GetClipFactor(t.position,z.position,q,S);let r=f,e=f;if(V&&J){const q=t.matrixIndicesOverride?0:t.vertexIdxForBones,S=t.matrixIndicesOverride??V,o=t.matrixWeightsOverride??J,C=z.matrixIndicesOverride?0:z.vertexIdxForBones,Z=z.matrixIndicesOverride??V,b=z.matrixWeightsOverride??J;r=[0,0,0,0],e=[0,0,0,0];let O=0;for(let t=0;t<4;++t)if(o[q+t]>0){const z=B(Z,S[q+t],C,4);r[O]=S[q+t],e[O]=(0,c.Lerp)(o[q+t],z>=0?b[z]:0,L),O++}for(let t=0;t<4&&O<4;++t){const o=Z[C+t];-1===B(S,o,q,4)&&(r[O]=o,e[O]=(0,c.Lerp)(0,b[C+t],L),O++)}const i=e[0]+e[1]+e[2]+e[3];e[0]/=i,e[1]/=i,e[2]/=i,e[3]/=i}const C=t.localPositionOverride?t.localPositionOverride[0]:(null===M||void 0===M?void 0:M[t.vertexIdx])??0,Z=t.localPositionOverride?t.localPositionOverride[1]:(null===M||void 0===M?void 0:M[t.vertexIdx+1])??0,b=t.localPositionOverride?t.localPositionOverride[2]:(null===M||void 0===M?void 0:M[t.vertexIdx+2])??0,O=z.localPositionOverride?z.localPositionOverride[0]:(null===M||void 0===M?void 0:M[z.vertexIdx])??0,i=z.localPositionOverride?z.localPositionOverride[1]:(null===M||void 0===M?void 0:M[z.vertexIdx+1])??0,h=z.localPositionOverride?z.localPositionOverride[2]:(null===M||void 0===M?void 0:M[z.vertexIdx+2])??0,l=t.localNormalOverride?t.localNormalOverride[0]:(null===x||void 0===x?void 0:x[t.vertexIdx])??0,I=t.localNormalOverride?t.localNormalOverride[1]:(null===x||void 0===x?void 0:x[t.vertexIdx+1])??0,a=t.localNormalOverride?t.localNormalOverride[2]:(null===x||void 0===x?void 0:x[t.vertexIdx+2])??0,v=l+((z.localNormalOverride?z.localNormalOverride[0]:(null===x||void 0===x?void 0:x[z.vertexIdx])??0)-l)*L,k=I+((z.localNormalOverride?z.localNormalOverride[1]:(null===x||void 0===x?void 0:x[z.vertexIdx+1])??0)-I)*L,U=a+((z.localNormalOverride?z.localNormalOverride[2]:(null===x||void 0===x?void 0:x[z.vertexIdx+2])??0)-a)*L,H=Math.sqrt(v*v+k*k+U*U);return new p(o.o.Lerp(t.position,z.position,L),o.o.Lerp(t.Zi,z.Zi,L).normalize(),o.l.Lerp(t.uv,z.uv,L),-1,-1,M?[C+(O-C)*L,Z+(i-Z)*L,b+(h-b)*L]:null,x?[v/H,k/H,U/H]:null,r,e)};let L=null;t.length>3&&(L=[]);for(let r=0;r<t.length;r+=3){let B=0,e=null,C=null,Z=null,b=null;const O=o.o.Dot(t[r].position,q)-S>0,i=o.o.Dot(t[r+1].position,q)-S>0,h=o.o.Dot(t[r+2].position,q)-S>0;switch(B=(O?1:0)+(i?1:0)+(h?1:0),B){case 0:t.length>3?(L.push(t[r]),L.push(t[r+1]),L.push(t[r+2])):L=t;break;case 1:if(L=L??new Array,O&&(e=t[r+1],C=t[r+2],Z=z(t[r],e),b=z(t[r],C)),i){e=t[r],C=t[r+2],Z=z(t[r+1],e),b=z(t[r+1],C),L.push(Z),L.push(C.clone()),L.push(e.clone()),L.push(C.clone()),L.push(Z.clone()),L.push(b);break}h&&(e=t[r],C=t[r+1],Z=z(t[r+2],e),b=z(t[r+2],C)),e&&C&&Z&&b&&(L.push(e.clone()),L.push(C.clone()),L.push(Z),L.push(b),L.push(Z.clone()),L.push(C.clone()));break;case 2:L=L??new Array,O||(e=t[r].clone(),C=z(e,t[r+1]),Z=z(e,t[r+2]),L.push(e),L.push(C),L.push(Z)),i||(e=t[r+1].clone(),C=z(e,t[r+2]),Z=z(e,t[r]),L.push(e),L.push(C),L.push(Z)),h||(e=t[r+2].clone(),C=z(e,t[r]),Z=z(e,t[r+1]),L.push(e),L.push(C),L.push(Z))}}return L},m=q instanceof B.c?q:null,A=null===m||void 0===m?void 0:m._thinInstanceDataStorage.matrixData,P=(null===m||void 0===m?void 0:m.qi)||1,F=o.j.Matrix[0];F.p(o.e.IdentityReadOnly);for(let B=0;B<P;++B){if(null!==m&&void 0!==m&&m.hasThinInstances&&A){const t=16*B;F.setRowFromFloats(0,A[t+0],A[t+1],A[t+2],A[t+3]),F.setRowFromFloats(1,A[t+4],A[t+5],A[t+6],A[t+7]),F.setRowFromFloats(2,A[t+8],A[t+9],A[t+10],A[t+11]),F.setRowFromFloats(3,A[t+12],A[t+13],A[t+14],A[t+15])}const t=o.e.RotationYawPitchRoll(X,Y,K).multiply(o.e.Translation(j.x,j.y,j.z)),z=o.e.Invert(t),L=q.getWorldMatrix(),e=F.multiply(L).multiply(z),C=new Array(3);for(let q=0;q<I.length;q+=3){let t=C;if(t[0]=W(q,e),t[1]=W(q+1,e),t[2]=W(q+2,e),!(S.cullBackFaces&&-t[0].Zi.z<=0&&-t[1].Zi.z<=0&&-t[2].Zi.z<=0)&&(t=D(t,s),t&&(t=D(t,g),t&&(t=D(t,N),t&&(t=D(t,T),t&&(t=D(t,w),t&&(t=D(t,E),t)))))))for(let q=0;q<t.length;q++){const o=t[q];if(n.indices.push(u),l?(o.localPositionOverride?(n.xa[3*u]=o.localPositionOverride[0],n.xa[3*u+1]=o.localPositionOverride[1],n.xa[3*u+2]=o.localPositionOverride[2]):M&&(n.xa[3*u]=M[o.vertexIdx],n.xa[3*u+1]=M[o.vertexIdx+1],n.xa[3*u+2]=M[o.vertexIdx+2]),o.localNormalOverride?(n.ya[3*u]=o.localNormalOverride[0],n.ya[3*u+1]=o.localNormalOverride[1],n.ya[3*u+2]=o.localNormalOverride[2]):x&&(n.ya[3*u]=x[o.vertexIdx],n.ya[3*u+1]=x[o.vertexIdx+1],n.ya[3*u+2]=x[o.vertexIdx+2])):(o.position.toArray(n.xa,3*u),o.Zi.toArray(n.ya,3*u)),n.matricesIndices&&n.matricesWeights&&(o.matrixIndicesOverride?(n.matricesIndices[4*u]=o.matrixIndicesOverride[0],n.matricesIndices[4*u+1]=o.matrixIndicesOverride[1],n.matricesIndices[4*u+2]=o.matrixIndicesOverride[2],n.matricesIndices[4*u+3]=o.matrixIndicesOverride[3]):(V&&(n.matricesIndices[4*u]=V[o.vertexIdxForBones],n.matricesIndices[4*u+1]=V[o.vertexIdxForBones+1],n.matricesIndices[4*u+2]=V[o.vertexIdxForBones+2],n.matricesIndices[4*u+3]=V[o.vertexIdxForBones+3]),U&&n.matricesIndicesExtra&&(n.matricesIndicesExtra[4*u]=U[o.vertexIdxForBones],n.matricesIndicesExtra[4*u+1]=U[o.vertexIdxForBones+1],n.matricesIndicesExtra[4*u+2]=U[o.vertexIdxForBones+2],n.matricesIndicesExtra[4*u+3]=U[o.vertexIdxForBones+3])),o.matrixWeightsOverride?(n.matricesWeights[4*u]=o.matrixWeightsOverride[0],n.matricesWeights[4*u+1]=o.matrixWeightsOverride[1],n.matricesWeights[4*u+2]=o.matrixWeightsOverride[2],n.matricesWeights[4*u+3]=o.matrixWeightsOverride[3]):(J&&(n.matricesWeights[4*u]=J[o.vertexIdxForBones],n.matricesWeights[4*u+1]=J[o.vertexIdxForBones+1],n.matricesWeights[4*u+2]=J[o.vertexIdxForBones+2],n.matricesWeights[4*u+3]=J[o.vertexIdxForBones+3]),H&&n.matricesWeightsExtra&&(n.matricesWeightsExtra[4*u]=H[o.vertexIdxForBones],n.matricesWeightsExtra[4*u+1]=H[o.vertexIdxForBones+1],n.matricesWeightsExtra[4*u+2]=H[o.vertexIdxForBones+2],n.matricesWeightsExtra[4*u+3]=H[o.vertexIdxForBones+3]))),S.captureUVS)o.uv.toArray(n.Aa,2*u);else{n.Aa.push(.5+o.position.x/Q.x);const t=.5+o.position.y/Q.y;n.Aa.push(r.b?1-t:t)}u++}}}0===n.indices.length&&(n.indices=null),0===n.xa.length&&(n.xa=null),0===n.ya.length&&(n.ya=null),0===n.Aa.length&&(n.Aa=null),0===(null===(C=n.matricesIndices)||void 0===C?void 0:C.length)&&(n.matricesIndices=null),0===(null===(Z=n.matricesWeights)||void 0===Z?void 0:Z.length)&&(n.matricesWeights=null),0===(null===(b=n.matricesIndicesExtra)||void 0===b?void 0:b.length)&&(n.matricesIndicesExtra=null),0===(null===(O=n.matricesWeightsExtra)||void 0===O?void 0:O.length)&&(n.matricesWeightsExtra=null);const d=new B.c(t,q.va());return n.Ca(d),l?(d.skeleton=q.skeleton,d.parent=q):(d.position=j.clone(),d.rotation=new o.o(Y,X,K)),d.Ai(!0),d.refreshBoundingInfo(!0,!0),d}function F(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const q=0|Math.max(t.subdivisions?t.subdivisions:2,1),S=0|Math.max(t.tessellation?t.tessellation:16,3),B=Math.max(t.height?t.height:1,0),z=Math.max(t.radius?t.radius:.25,0),e=0|Math.max(t.capSubdivisions?t.capSubdivisions:6,1),C=S,Z=q,b=Math.max(t.radiusTop?t.radiusTop:z,0),O=Math.max(t.radiusBottom?t.radiusBottom:z,0),i=B-(b+O),h=2*Math.PI,l=Math.max(t.topCapSubdivisions?t.topCapSubdivisions:e,1),I=Math.max(t.bottomCapSubdivisions?t.bottomCapSubdivisions:e,1),a=Math.acos((O-b)/B);let v=[];const M=[],x=[],k=[];let V=0;const J=[],U=.5*i,H=.5*Math.PI;let j,y;const Q=o.o.Zero(),K=o.o.Zero(),X=Math.cos(a),G=Math.sin(a),Y=new o.l(b*G,U+b*X).Kg(new o.l(O*G,O*X-U)).length(),n=b*a+Y+O*(H-a);let u=0;for(y=0;y<=l;y++){const t=[],q=H-a*(y/l);u+=b*a/l;const S=Math.cos(q),o=Math.sin(q),B=S*b;for(j=0;j<=C;j++){const q=j/C,z=q*h+0,L=Math.sin(z),e=Math.cos(z);K.x=B*L,K.y=U+o*b,K.z=B*e,M.push(K.x,K.y,K.z),Q.set(S*L,o,S*e),x.push(Q.x,Q.y,Q.z),k.push(q,r.b?u/n:1-u/n),t.push(V),V++}J.push(t)}const W=B-b-O+X*b-X*O,f=G*(O-b)/W;for(y=1;y<=Z;y++){const t=[];u+=Y/Z;const q=G*(y*(O-b)/Z+b);for(j=0;j<=C;j++){const S=j/C,o=S*h+0,B=Math.sin(o),z=Math.cos(o);K.x=q*B,K.y=U+X*b-y*W/Z,K.z=q*z,M.push(K.x,K.y,K.z),Q.set(B,f,z).normalize(),x.push(Q.x,Q.y,Q.z),k.push(S,r.b?u/n:1-u/n),t.push(V),V++}J.push(t)}for(y=1;y<=I;y++){const t=[],q=H-a-(Math.PI-a)*(y/I);u+=O*a/I;const S=Math.cos(q),o=Math.sin(q),B=S*O;for(j=0;j<=C;j++){const q=j/C,z=q*h+0,L=Math.sin(z),e=Math.cos(z);K.x=B*L,K.y=o*O-U,K.z=B*e,M.push(K.x,K.y,K.z),Q.set(S*L,o,S*e),x.push(Q.x,Q.y,Q.z),k.push(q,r.b?u/n:1-u/n),t.push(V),V++}J.push(t)}for(j=0;j<C;j++)for(y=0;y<l+Z+I;y++){const t=J[y][j],q=J[y+1][j],S=J[y+1][j+1],o=J[y][j+1];v.push(t),v.push(q),v.push(o),v.push(q),v.push(S),v.push(o)}if(v=v.reverse(),t.orientation&&!t.orientation.equals(o.o.Up())){const q=new o.e;t.orientation.clone().scale(.5*Math.PI).cross(o.o.Up()).toQuaternion().toRotationMatrix(q);const S=o.o.Zero();for(let t=0;t<M.length;t+=3)S.set(M[t],M[t+1],M[t+2]),o.o.TransformCoordinatesToRef(S.clone(),q,S),M[t]=S.x,M[t+1]=S.y,M[t+2]=S.z}const D=new L.e;return D.xa=M,D.ya=x,D.Aa=k,D.indices=v,D}function d(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:o.o.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new B.c(t,S);return F(q).Ca(z,q.updatable),z}B.c.CreateDecal=(t,q,S,o,B,z)=>P(t,q,{position:S,Zi:o,size:B,angle:z});B.c.CreateCapsule=(t,q,S)=>d(t,q,S),L.e.CreateCapsule=F;var R=S(496),tt=S(682);class qt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=q,t!==Math.floor(t)&&(t=Math.floor(t),R.c.Warn("x is not an integer, floor(x) used")),q!==Math.floor(q)&&(q=Math.floor(q),R.c.Warn("y is not an integer, floor(y) used"))}clone(){return new qt(this.x,this.y)}rotate60About(t){const q=this.x;return this.x=t.x+t.y-this.y,this.y=q+this.y-t.x,this}rotateNeg60About(t){const q=this.x;return this.x=q+this.y-t.y,this.y=t.x+t.y-q,this}rotate120(t,q){t!==Math.floor(t)&&(t=Math.floor(t),R.c.Warn("m not an integer only floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),R.c.Warn("n not an integer only floor(n) used"));const S=this.x;return this.x=t-S-this.y,this.y=q+S,this}rotateNeg120(t,q){t!==Math.floor(t)&&(t=Math.floor(t),R.c.Warn("m is not an integer, floor(m) used")),q!==Math.floor(q)&&(q=Math.floor(q),R.c.Warn("n is not an integer,   floor(n) used"));const S=this.x;return this.x=this.y-q,this.y=t+q-S-this.y,this}toCartesianOrigin(t,q){const S=o.o.Zero();return S.x=t.x+2*this.x*q+this.y*q,S.y=t.y+Math.sqrt(3)*this.y*q,S}static Zero(){return new qt(0,0)}}class St{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ot("icosahedron","Regular",[[0,tt.g,-1],[-tt.g,1,0],[-1,0,-tt.g],[1,0,-tt.g],[tt.g,1,0],[0,tt.g,1],[-1,0,tt.g],[-tt.g,-1,0],[0,-tt.g,-1],[tt.g,-1,0],[1,0,tt.g],[0,-tt.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let t=12;const q={},S=this.m,o=this.n;let B,z,L,r,e,C=S,Z=1,b=0;0!==o&&(C=(0,c.HighestCommonFactor)(S,o)),Z=S/C,b=o/C;const O=qt.Zero(),i=new qt(S,o),h=new qt(-o,S+o),l=qt.Zero(),I=qt.Zero(),a=qt.Zero();let v,M,x,k,V=[];const J=[],U=this.vertByDist,H=(S,o,B,z)=>{v=S+"|"+B,M=o+"|"+z,v in q||M in q?v in q&&!(M in q)?q[M]=q[v]:M in q&&!(v in q)&&(q[v]=q[M]):(q[v]=t,q[M]=t,t++),U[B][0]>2?J[q[v]]=[-U[B][0],U[B][1],q[v]]:J[q[v]]=[V[U[B][0]],U[B][1],q[v]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let j=0;j<20;j++){if(V=this.IDATA.face[j],L=V[2],r=V[1],e=V[0],x=O.x+"|"+O.y,v=j+"|"+x,v in q||(q[v]=L,J[L]=[V[U[x][0]],U[x][1]]),x=i.x+"|"+i.y,v=j+"|"+x,v in q||(q[v]=r,J[r]=[V[U[x][0]],U[x][1]]),x=h.x+"|"+h.y,v=j+"|"+x,v in q||(q[v]=e,J[e]=[V[U[x][0]],U[x][1]]),B=this.IDATA.edgematch[j][0],z=this.IDATA.edgematch[j][1],"B"===z)for(let t=1;t<C;t++)I.x=S-t*(Z+b),I.y=o+t*Z,a.x=-t*b,a.y=t*(Z+b),x=I.x+"|"+I.y,k=a.x+"|"+a.y,H(j,B,x,k);if("O"===z)for(let t=1;t<C;t++)a.x=-t*b,a.y=t*(Z+b),l.x=t*Z,l.y=t*b,x=a.x+"|"+a.y,k=l.x+"|"+l.y,H(j,B,x,k);if(B=this.IDATA.edgematch[j][2],z=this.IDATA.edgematch[j][3],z&&"A"===z)for(let t=1;t<C;t++)l.x=t*Z,l.y=t*b,I.x=S-(C-t)*(Z+b),I.y=o+(C-t)*Z,x=l.x+"|"+l.y,k=I.x+"|"+I.y,H(j,B,x,k);for(let S=0;S<this.vertices.length;S++)x=this.vertices[S].x+"|"+this.vertices[S].y,v=j+"|"+x,v in q||(q[v]=t++,U[x][0]>2?J[q[v]]=[-U[x][0],U[x][1],q[v]]:J[q[v]]=[V[U[x][0]],U[x][1],q[v]])}this.closestTo=J,this.vecToidx=q}calcCoeffs(){const t=this.m,q=this.n,S=Math.sqrt(3)/3,o=t*t+q*q+t*q;this.coau=(t+q)/o,this.cobu=-q/o,this.coav=-S*(t-q)/o,this.cobv=S*(2*t+q)/o}createInnerFacets(){const t=this.m,q=this.n;for(let S=0;S<q+t+1;S++)for(let t=this.min[S];t<this.max[S]+1;t++)t<this.max[S]&&t<this.max[S+1]+1&&this.innerFacets.push(["|"+t+"|"+S,"|"+t+"|"+(S+1),"|"+(t+1)+"|"+S]),S>0&&t<this.max[S-1]&&t+1<this.max[S]+1&&this.innerFacets.push(["|"+t+"|"+S,"|"+(t+1)+"|"+S,"|"+(t+1)+"|"+(S-1)])}edgeVecsABOB(){const t=this.m,q=this.n,S=new qt(-q,t+q);for(let o=1;o<t+q;o++){const t=new qt(this.min[o],o),q=new qt(this.min[o-1],o-1),B=new qt(this.min[o+1],o+1),z=t.clone(),L=q.clone(),r=B.clone();z.rotate60About(S),L.rotate60About(S),r.rotate60About(S);const e=new qt(this.max[z.y],z.y),C=new qt(this.max[z.y-1],z.y-1),Z=new qt(this.max[z.y-1]-1,z.y-1);z.x===e.x&&z.y===e.y||(z.x!==C.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,C,Z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,Z,e])):z.y===r.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,q,C]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([t,C,B])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,q,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,C,e])))}}mapABOBtoOBOA(){const t=new qt(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const S=[];for(let o=0;o<3;o++)t.x=this.isoVecsABOB[q][o].x,t.y=this.isoVecsABOB[q][o].y,0===this.vertexTypes[q][o]&&t.rotateNeg120(this.m,this.n),S.push(t.clone());this.isoVecsOBOA.push(S)}}mapABOBtoBAOA(){const t=new qt(0,0);for(let q=0;q<this.isoVecsABOB.length;q++){const S=[];for(let o=0;o<3;o++)t.x=this.isoVecsABOB[q][o].x,t.y=this.isoVecsABOB[q][o].y,1===this.vertexTypes[q][o]&&t.rotate120(this.m,this.n),S.push(t.clone());this.isoVecsBAOA.push(S)}}MapToFace(t,q){const S=this.IDATA.face[t],B=S[2],z=S[1],L=S[0],r=o.o.ti(this.IDATA.vertex[B]),e=o.o.ti(this.IDATA.vertex[z]),C=o.o.ti(this.IDATA.vertex[L]),Z=e.Kg(r),b=C.Kg(r),O=Z.scale(this.coau).add(b.scale(this.cobu)),i=Z.scale(this.coav).add(b.scale(this.cobv)),h=[];let l,I=o.j.wi[0];for(let o=0;o<this.cartesian.length;o++)I=O.scale(this.cartesian[o].x).add(i.scale(this.cartesian[o].y)).add(r),h[o]=[I.x,I.y,I.z],l=t+"|"+this.vertices[o].x+"|"+this.vertices[o].y,q.vertex[this.vecToidx[l]]=[I.x,I.y,I.z]}build(t,q){const S=[],o=qt.Zero(),B=new qt(t,q),z=new qt(-q,t+q);S.push(o,B,z);for(let x=q;x<t+1;x++)for(let q=0;q<t+1-x;q++)S.push(new qt(q,x));if(q>0){const o=(0,c.HighestCommonFactor)(t,q),B=t/o,z=q/o;for(let r=1;r<o;r++)S.push(new qt(r*B,r*z)),S.push(new qt(-r*z,r*(B+z))),S.push(new qt(t-r*(B+z),q+r*B));const L=t/q;for(let r=1;r<q;r++)for(let o=0;o<r*L;o++)S.push(new qt(o,r)),S.push(new qt(o,r).rotate120(t,q)),S.push(new qt(o,r).rotateNeg120(t,q))}S.sort(((t,q)=>t.x-q.x)),S.sort(((t,q)=>t.y-q.y));const L=new Array(t+q+1),r=new Array(t+q+1);for(let x=0;x<L.length;x++)L[x]=1/0,r[x]=-1/0;let e=0,C=0;const Z=S.length;for(let x=0;x<Z;x++)C=S[x].x,e=S[x].y,L[e]=Math.min(C,L[e]),r[e]=Math.max(C,r[e]);const b=(S,o)=>{const B=S.clone();return"A"===o&&B.rotateNeg120(t,q),"B"===o&&B.rotate120(t,q),B.x<0?B.y:B.x+B.y},O=[],i=[],h=[],l=[],I={},a=[];let v=-1,M=-1;for(let x=0;x<Z;x++)O[x]=S[x].toCartesianOrigin(new qt(0,0),.5),i[x]=b(S[x],"O"),h[x]=b(S[x],"A"),l[x]=b(S[x],"B"),i[x]===h[x]&&h[x]===l[x]?(v=3,M=i[x]):i[x]===h[x]?(v=4,M=i[x]):h[x]===l[x]?(v=5,M=h[x]):l[x]===i[x]&&(v=6,M=i[x]),i[x]<h[x]&&i[x]<l[x]&&(v=2,M=i[x]),h[x]<i[x]&&h[x]<l[x]&&(v=1,M=h[x]),l[x]<h[x]&&l[x]<i[x]&&(v=0,M=l[x]),a.push([v,M,S[x].x,S[x].y]);a.sort(((t,q)=>t[2]-q[2])),a.sort(((t,q)=>t[3]-q[3])),a.sort(((t,q)=>t[1]-q[1])),a.sort(((t,q)=>t[0]-q[0]));for(let x=0;x<a.length;x++)I[a[x][2]+"|"+a[x][3]]=[a[x][0],a[x][1],x];return this.m=t,this.n=q,this.vertices=S,this.vertByDist=I,this.cartesian=O,this.min=L,this.max=r,this}}class ot{constructor(t,q,S,o){this.name=t,this.category=q,this.vertex=S,this.face=o}}class Bt extends ot{innerToData(t,q){for(let S=0;S<q.innerFacets.length;S++)this.face.push(q.innerFacets[S].map((S=>q.vecToidx[t+S])))}mapABOBtoDATA(t,q){const S=q.IDATA.edgematch[t][0];for(let o=0;o<q.isoVecsABOB.length;o++){const B=[];for(let z=0;z<3;z++)0===q.vertexTypes[o][z]?B.push(t+"|"+q.isoVecsABOB[o][z].x+"|"+q.isoVecsABOB[o][z].y):B.push(S+"|"+q.isoVecsABOB[o][z].x+"|"+q.isoVecsABOB[o][z].y);this.face.push([q.vecToidx[B[0]],q.vecToidx[B[1]],q.vecToidx[B[2]]])}}mapOBOAtoDATA(t,q){const S=q.IDATA.edgematch[t][0];for(let o=0;o<q.isoVecsOBOA.length;o++){const B=[];for(let z=0;z<3;z++)1===q.vertexTypes[o][z]?B.push(t+"|"+q.isoVecsOBOA[o][z].x+"|"+q.isoVecsOBOA[o][z].y):B.push(S+"|"+q.isoVecsOBOA[o][z].x+"|"+q.isoVecsOBOA[o][z].y);this.face.push([q.vecToidx[B[0]],q.vecToidx[B[1]],q.vecToidx[B[2]]])}}mapBAOAtoDATA(t,q){const S=q.IDATA.edgematch[t][2];for(let o=0;o<q.isoVecsBAOA.length;o++){const B=[];for(let z=0;z<3;z++)1===q.vertexTypes[o][z]?B.push(t+"|"+q.isoVecsBAOA[o][z].x+"|"+q.isoVecsBAOA[o][z].y):B.push(S+"|"+q.isoVecsBAOA[o][z].x+"|"+q.isoVecsBAOA[o][z].y);this.face.push([q.vecToidx[B[0]],q.vecToidx[B[1]],q.vecToidx[B[2]]])}}orderData(t){const q=[];for(let z=0;z<13;z++)q[z]=[];const S=t.closestTo;for(let z=0;z<S.length;z++)S[z][0]>-1?S[z][1]>0&&q[S[z][0]].push([z,S[z][1]]):q[12].push([z,S[z][0]]);const o=[];for(let z=0;z<12;z++)o[z]=z;let B=12;for(let z=0;z<12;z++){q[z].sort(((t,q)=>t[1]-q[1]));for(let t=0;t<q[z].length;t++)o[q[z][t][0]]=B++}for(let z=0;z<q[12].length;z++)o[q[12][z][0]]=B++;for(let z=0;z<this.vertex.length;z++)this.vertex[z].push(o[z]);this.vertex.sort(((t,q)=>t[3]-q[3]));for(let z=0;z<this.vertex.length;z++)this.vertex[z].pop();for(let z=0;z<this.face.length;z++)for(let t=0;t<this.face[z].length;t++)this.face[z][t]=o[this.face[z][t]];this.sharedNodes=q[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(t,q){const S=[],o=[];let B=q.pop();o.push(B);let z=this.face[B].indexOf(t);z=(z+2)%3;let L=this.face[B][z];S.push(L);let r=0;for(;q.length>0;)B=q[r],this.face[B].indexOf(L)>-1?(z=(this.face[B].indexOf(L)+1)%3,L=this.face[B][z],S.push(L),o.push(B),q.splice(r,1),r=0):r++;return this.adjacentFaces.push(S),o}toGoldbergPolyhedronData(){const t=new ot("GeoDual","Goldberg",[],[]);t.name="GD dual";const q=this.vertex.length,S=new Array(q);for(let e=0;e<q;e++)S[e]=[];for(let e=0;e<this.face.length;e++)for(let t=0;t<3;t++)S[this.face[e][t]].push(e);let o=0,B=0,z=0,L=[],r=[];this.adjacentFaces=[];for(let e=0;e<S.length;e++){t.face[e]=this.setOrder(e,S[e].concat([]));for(const q of S[e]){o=0,B=0,z=0,L=this.face[q];for(let t=0;t<3;t++)r=this.vertex[L[t]],o+=r[0],B+=r[1],z+=r[2];t.vertex[q]=[o/3,B/3,z/3]}}return t}static BuildGeodesicData(t){const q=new Bt("Geodesic-m-n","Geodesic",[[0,tt.g,-1],[-tt.g,1,0],[-1,0,-tt.g],[1,0,-tt.g],[tt.g,1,0],[0,tt.g,1],[-1,0,tt.g],[-tt.g,-1,0],[0,-tt.g,-1],[tt.g,-1,0],[1,0,tt.g],[0,-tt.g,1]],[]);t.setIndices(),t.calcCoeffs(),t.createInnerFacets(),t.edgeVecsABOB(),t.mapABOBtoOBOA(),t.mapABOBtoBAOA();for(let S=0;S<t.IDATA.face.length;S++)t.MapToFace(S,q),q.innerToData(S,t),"B"===t.IDATA.edgematch[S][1]&&q.mapABOBtoDATA(S,t),"O"===t.IDATA.edgematch[S][1]&&q.mapOBOAtoDATA(S,t),"A"===t.IDATA.edgematch[S][3]&&q.mapBAOAtoDATA(S,t);q.orderData(t);return q.vertex=q.vertex.map((function(t){const q=t[0],S=t[1],o=t[2],B=Math.sqrt(q*q+S*S+o*o);return t[0]*=1/B,t[1]*=1/B,t[2]*=1/B,t})),q}}B.c._GoldbergMeshParser=(t,q)=>zt.Parse(t,q);class zt extends B.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(t,q){return void 0===q?(t>this.goldbergData.nbUnsharedFaces-1&&(R.c.Warn("Maximum number of unshared faces used"),t=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+t):(t>11&&(R.c.Warn("Last pole used"),t=11),q>this.goldbergData.nbFacesAtPole-1&&(R.c.Warn("Maximum number of faces at a pole used"),q=this.goldbergData.nbFacesAtPole-1),12+t*this.goldbergData.nbFacesAtPole+q)}_changeGoldbergFaceColors(t){for(let S=0;S<t.length;S++){const q=t[S][0],o=t[S][1],B=t[S][2];for(let t=q;t<o+1;t++)this.goldbergData.faceColors[t]=B}const q=[];for(let S=0;S<12;S++)for(let t=0;t<5;t++)q.push(this.goldbergData.faceColors[S].r,this.goldbergData.faceColors[S].g,this.goldbergData.faceColors[S].b,this.goldbergData.faceColors[S].a);for(let S=12;S<this.goldbergData.faceColors.length;S++)for(let t=0;t<6;t++)q.push(this.goldbergData.faceColors[S].r,this.goldbergData.faceColors[S].g,this.goldbergData.faceColors[S].b,this.goldbergData.faceColors[S].a);return q}setGoldbergFaceColors(t){const q=this._changeGoldbergFaceColors(t);this.Ga(z.i.ColorKind,q)}updateGoldbergFaceColors(t){const q=this._changeGoldbergFaceColors(t);this.updateVerticesData(z.i.ColorKind,q)}_changeGoldbergFaceUVs(t){const q=this.getVerticesData(z.i.UVKind);for(let S=0;S<t.length;S++){const o=t[S][0],B=t[S][1],z=t[S][2],L=t[S][3],r=t[S][4],e=[],C=[];let Z,b;for(let t=0;t<5;t++)Z=z.x+L*Math.cos(r+t*Math.PI/2.5),b=z.y+L*Math.sin(r+t*Math.PI/2.5),Z<0&&(Z=0),Z>1&&(Z=1),e.push(Z,b);for(let t=0;t<6;t++)Z=z.x+L*Math.cos(r+t*Math.PI/3),b=z.y+L*Math.sin(r+t*Math.PI/3),Z<0&&(Z=0),Z>1&&(Z=1),C.push(Z,b);for(let t=o;t<Math.min(12,B+1);t++)for(let S=0;S<5;S++)q[10*t+2*S]=e[2*S],q[10*t+2*S+1]=e[2*S+1];for(let t=Math.max(12,o);t<B+1;t++)for(let S=0;S<6;S++)q[12*t-24+2*S]=C[2*S],q[12*t-23+2*S]=C[2*S+1]}return q}setGoldbergFaceUVs(t){const q=this._changeGoldbergFaceUVs(t);this.Ga(z.i.UVKind,q)}updateGoldbergFaceUVs(t){const q=this._changeGoldbergFaceUVs(t);this.updateVerticesData(z.i.UVKind,q)}placeOnGoldbergFaceAt(t,q,S){const B=o.o.RotationFromAxis(this.goldbergData.faceXaxis[q],this.goldbergData.faceYaxis[q],this.goldbergData.faceZaxis[q]);t.rotation=B,t.position=this.goldbergData.faceCenters[q].add(this.goldbergData.faceXaxis[q].scale(S.x)).add(this.goldbergData.faceYaxis[q].scale(S.y)).add(this.goldbergData.faceZaxis[q].scale(S.z))}serialize(t){super.serialize(t),t.type="GoldbergMesh";const q={};if(q.adjacentFaces=this.goldbergData.adjacentFaces,q.nbSharedFaces=this.goldbergData.nbSharedFaces,q.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,q.nbFaces=this.goldbergData.nbFaces,q.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){q.faceColors=[];for(const t of this.goldbergData.faceColors)q.faceColors.push(t.Gi())}if(this.goldbergData.faceCenters){q.faceCenters=[];for(const t of this.goldbergData.faceCenters)q.faceCenters.push(t.Gi())}if(this.goldbergData.faceZaxis){q.faceZaxis=[];for(const t of this.goldbergData.faceZaxis)q.faceZaxis.push(t.Gi())}if(this.goldbergData.faceYaxis){q.faceYaxis=[];for(const t of this.goldbergData.faceYaxis)q.faceYaxis.push(t.Gi())}if(this.goldbergData.faceXaxis){q.faceXaxis=[];for(const t of this.goldbergData.faceXaxis)q.faceXaxis.push(t.Gi())}t.goldbergData=q}static Parse(t,q){const S=t.goldbergData;S.faceColors=S.faceColors.map((t=>O.d.ti(t))),S.faceCenters=S.faceCenters.map((t=>o.o.ti(t))),S.faceZaxis=S.faceZaxis.map((t=>o.o.ti(t))),S.faceXaxis=S.faceXaxis.map((t=>o.o.ti(t))),S.faceYaxis=S.faceYaxis.map((t=>o.o.ti(t)));const B=new zt(t.name,q);return B.goldbergData=S,B}}var Lt=S(12059);const rt={CreateBox:b.e,CreateTiledBox:I,CreateSphere:a.e,CreateDisc:Z.e,CreateIcoSphere:A,CreateRibbon:C,CreateCylinder:k,CreateTorus:J,CreateTorusKnot:H,CreateLineSystem:j.f,Li:j.i,CreateDashedLines:j.e,ExtrudeShape:K,ExtrudeShapeCustom:X,CreateLathe:Y,CreateTiledPlane:h,Mi:n.d,CreateGround:u.e,CreateTiledGround:u.g,CreateGroundFromHeightMap:u.d,CreatePolygon:y.d,ExtrudePolygon:y.g,CreateTube:W,CreatePolyhedron:D,CreateGeodesic:function(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=q.m||1;o!==Math.floor(o)&&(o=Math.floor(o),R.c.Warn("m not an integer only floor(m) used"));let B=q.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),R.c.Warn("n not an integer only floor(n) used")),B>o){const t=B;B=o,o=t,R.c.Warn("n > m therefore m and n swapped")}const z=new St;return z.build(o,B),D(t,{custom:Bt.BuildGeodesicData(z),size:q.size,sizeX:q.sizeX,sizeY:q.sizeY,sizeZ:q.sizeZ,faceUV:q.faceUV,faceColors:q.faceColors,flat:q.flat,updatable:q.updatable,sideOrientation:q.sideOrientation,frontUVs:q.frontUVs,backUVs:q.backUVs},S)},CreateGoldberg:function(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=q.size,e=q.sizeX||z||1,C=q.sizeY||z||1,Z=q.sizeZ||z||1;let b=q.m||1;b!==Math.floor(b)&&(b=Math.floor(b),R.c.Warn("m not an integer only floor(m) used"));let i=q.n||0;if(i!==Math.floor(i)&&(i=Math.floor(i),R.c.Warn("n not an integer only floor(n) used")),i>b){const t=i;i=b,b=t,R.c.Warn("n > m therefore m and n swapped")}const h=new St;h.build(b,i);const l=Bt.BuildGeodesicData(h),I=l.toGoldbergPolyhedronData(),a=new zt(t,S);q.sideOrientation=B.c._GetDefaultSideOrientation(q.sideOrientation),a._originalBuilderSideOrientation=q.sideOrientation;(function(t,q){const S=t.size,B=t.sizeX||S||1,z=t.sizeY||S||1,e=t.sizeZ||S||1,C=0===t.sideOrientation?0:t.sideOrientation||L.e.DEFAULTSIDE,Z=[],b=[],O=[],i=[];let h=1/0,l=-1/0,I=1/0,a=-1/0;for(let o=0;o<q.vertex.length;o++)h=Math.min(h,q.vertex[o][0]*B),l=Math.max(l,q.vertex[o][0]*B),I=Math.min(I,q.vertex[o][1]*z),a=Math.max(a,q.vertex[o][1]*z);let v=0;for(let L=0;L<q.face.length;L++){const t=q.face[L],S=o.o.ti(q.vertex[t[0]]),C=o.o.ti(q.vertex[t[2]]),M=o.o.ti(q.vertex[t[1]]),x=C.Kg(S),k=M.Kg(S),V=o.o.Cross(k,x).normalize();for(let o=0;o<t.length;o++){O.push(V.x,V.y,V.z);const S=q.vertex[t[o]];Z.push(S[0]*B,S[1]*z,S[2]*e);const L=(S[1]*z-I)/(a-I);i.push((S[0]*B-h)/(l-h),r.b?1-L:L)}for(let q=0;q<t.length-2;q++)b.push(v,v+q+2,v+q+1);v+=t.length}L.e._ComputeSides(C,Z,b,O,i);const M=new L.e;return M.xa=Z,M.indices=b,M.ya=O,M.Aa=i,M})(q,I).Ca(a,q.updatable),a.goldbergData.nbSharedFaces=l.sharedNodes,a.goldbergData.nbUnsharedFaces=l.poleNodes,a.goldbergData.adjacentFaces=l.adjacentFaces,a.goldbergData.nbFaces=a.goldbergData.nbSharedFaces+a.goldbergData.nbUnsharedFaces,a.goldbergData.nbFacesAtPole=(a.goldbergData.nbUnsharedFaces-12)/12;for(let B=0;B<l.vertex.length;B++)a.goldbergData.faceCenters.push(o.o.ti(l.vertex[B])),a.goldbergData.faceCenters[B].x*=e,a.goldbergData.faceCenters[B].y*=C,a.goldbergData.faceCenters[B].z*=Z,a.goldbergData.faceColors.push(new O.d(1,1,1,1));for(let B=0;B<I.face.length;B++){const t=I.face[B],q=o.o.ti(I.vertex[t[0]]),S=o.o.ti(I.vertex[t[2]]),z=o.o.ti(I.vertex[t[1]]),L=S.Kg(q),r=z.Kg(q),e=o.o.Cross(r,L).normalize(),C=o.o.Cross(r,e).normalize();a.goldbergData.faceXaxis.push(r.normalize()),a.goldbergData.faceYaxis.push(e),a.goldbergData.faceZaxis.push(C)}return a},CreateDecal:P,CreateCapsule:d,CreateText:Lt.f}},12540:(t,q,S)=>{"use strict";S.d(q,{c:()=>rq});var o=S(678),B=S(11965);class z extends B.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var L=S(706),r=(S(2387),S(622));class e{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(t){this._targetStopDuration!==t&&(this._targetStopDuration=t)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(t){this._animationSheetEnabled!==t&&(this._animationSheetEnabled=t)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(t){this._useLogarithmicDepth=t&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(t){switch(t){case e.BLENDMODE_MULTIPLYADD:return;case e.BLENDMODE_ADD:t=1;break;case e.BLENDMODE_ONEONE:t=6;break;case e.BLENDMODE_STANDARD:t=2;break;case e.BLENDMODE_MULTIPLY:t=4;break;case e.BLENDMODE_SUBTRACT:t=3}this._engine.setAlphaMode(t)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:o.o.Zero()}set direction1(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:o.o.Zero()}set direction2(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:o.o.Zero()}set minEmitBox(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:o.o.Zero()}set maxEmitBox(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)}get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(t){this._attachImageProcessingConfiguration(t)}_attachImageProcessingConfiguration(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)}_reset(){}_removeGradientAndTexture(t,q,S){if(!q)return this;let o=0;for(const B of q){if(B.gradient===t){q.splice(o,1);break}o++}return S&&S.dispose(),this}constructor(t){this.animations=[],this.renderingGroupId=0,this.j=o.o.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new o.o(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new o.l(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.tg=new o.o(0,0,0),this._useLogarithmicDepth=!1,this.gravity=o.o.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new L.d(1,1,1,1),this.color2=new L.d(1,1,1,1),this.colorDead=new L.d(0,0,0,1),this.textureMask=new L.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new z,this.id=t,this.name=t}createPointEmitter(t,q){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new o.o(0,1,0),arguments.length>2&&void 0!==arguments[2]||new o.o(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new o.o(0,1,0),arguments.length>4&&void 0!==arguments[4]||new o.o(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new o.o(0,1,0),arguments.length>3&&void 0!==arguments[3]||new o.o(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(t,q,S,o){throw new Error("Method not implemented.")}}e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e.BLENDMODE_SUBTRACT=-1,(0,r.c)("BABYLON.BaseParticleSystem",e);var C=S(689),Z=S(503);class b{constructor(){this.direction1=new o.o(0,1,0),this.direction2=new o.o(0,1,0),this.minEmitBox=new o.o(-.5,-.5,-.5),this.maxEmitBox=new o.o(.5,.5,.5)}startDirectionFunction(t,q,S,B){const z=(0,C.RandomRange)(this.direction1.x,this.direction2.x),L=(0,C.RandomRange)(this.direction1.y,this.direction2.y),r=(0,C.RandomRange)(this.direction1.z,this.direction2.z);if(B)return q.x=z,q.y=L,void(q.z=r);o.o.TransformNormalFromFloatsToRef(z,L,r,t,q)}startPositionFunction(t,q,S,B){const z=(0,C.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),L=(0,C.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),r=(0,C.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(B)return q.x=z,q.y=L,void(q.z=r);o.o.TransformCoordinatesFromFloatsToRef(z,L,r,t,q)}clone(){const t=new b;return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3),t.addUniform("minEmitBox",3),t.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.Gi(),t.direction2=this.direction2.Gi(),t.minEmitBox=this.minEmitBox.Gi(),t.maxEmitBox=this.maxEmitBox.Gi(),t}parse(t){o.o.FromArrayToRef(t.direction1,0,this.direction1),o.o.FromArrayToRef(t.direction2,0,this.direction2),o.o.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),o.o.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)}}class O{get radius(){return this._radius}set radius(t){this._radius=t,this._buildHeight()}get angle(){return this._angle}set angle(t){this._angle=t,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=S,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=q,this.radius=t}startDirectionFunction(t,q,S,B){B?o.j.wi[0].p(S.Ig).normalize():S.position.subtractToRef(t.getTranslation(),o.j.wi[0]).normalize();const z=(0,C.RandomRange)(0,this.directionRandomizer),L=(0,C.RandomRange)(0,this.directionRandomizer),r=(0,C.RandomRange)(0,this.directionRandomizer);q.x=o.j.wi[0].x+z,q.y=o.j.wi[0].y+L,q.z=o.j.wi[0].z+r,q.normalize()}startPositionFunction(t,q,S,B){const z=(0,C.RandomRange)(0,2*Math.PI);let L;this.emitFromSpawnPointOnly?L=1e-4:(L=(0,C.RandomRange)(0,this.heightRange),L=1-L*L);let r=this._radius-(0,C.RandomRange)(0,this._radius*this.radiusRange);r*=L;const e=r*Math.sin(z),Z=r*Math.cos(z),b=L*this._height;if(B)return q.x=e,q.y=b,void(q.z=Z);o.o.TransformCoordinatesFromFloatsToRef(e,b,Z,t,q)}clone(){const t=new O(this._radius,this._angle,this.directionRandomizer);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",2),t.addUniform("coneAngle",1),t.addUniform("height",2),t.addUniform("directionRandomizer",1)}getEffectDefines(){let t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+="\n#define CONEEMITTERSPAWNPOINT"),t}getClassName(){return"ConeParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t}parse(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=void 0!==t.radiusRange?t.radiusRange:1,this.heightRange=void 0!==t.radiusRange?t.heightRange:1,this.emitFromSpawnPointOnly=void 0!==t.emitFromSpawnPointOnly&&t.emitFromSpawnPointOnly}}class i extends O{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0);super(t,q),this.direction1=S,this.direction2=B}startDirectionFunction(t,q){const S=(0,C.RandomRange)(this.direction1.x,this.direction2.x),B=(0,C.RandomRange)(this.direction1.y,this.direction2.y),z=(0,C.RandomRange)(this.direction1.z,this.direction2.z);o.o.TransformNormalFromFloatsToRef(S,B,z,t,q)}clone(){const t=new i(this.radius,this.angle,this.direction1,this.direction2);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.Gi(),t.direction2=this.direction2.Gi(),t}parse(t){super.parse(t),this.direction1.p(t.direction1),this.direction2.p(t.direction2)}}class h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=t,this.height=q,this.radiusRange=S,this.directionRandomizer=B,this._tempVector=o.o.Zero()}startDirectionFunction(t,q,S,B,z){S.position.subtractToRef(t.getTranslation(),this._tempVector),this._tempVector.normalize(),o.o.TransformNormalToRef(this._tempVector,z,this._tempVector);const L=(0,C.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let r=Math.atan2(this._tempVector.x,this._tempVector.z);r+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=L,this._tempVector.x=Math.sin(r),this._tempVector.z=Math.cos(r),this._tempVector.normalize(),B?q.p(this._tempVector):o.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t,q)}startPositionFunction(t,q,S,B){const z=(0,C.RandomRange)(-this.height/2,this.height/2),L=(0,C.RandomRange)(0,2*Math.PI),r=(0,C.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),e=Math.sqrt(r)*this.radius,Z=e*Math.cos(L),b=e*Math.sin(L);B?q.ni(Z,z,b):o.o.TransformCoordinatesFromFloatsToRef(Z,z,b,t,q)}clone(){const t=new h(this.radius,this.directionRandomizer);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class l extends h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.o(0,1,0);super(t,q,S),this.direction1=B,this.direction2=z}startDirectionFunction(t,q,S,B){const z=(0,C.RandomRange)(this.direction1.x,this.direction2.x),L=(0,C.RandomRange)(this.direction1.y,this.direction2.y),r=(0,C.RandomRange)(this.direction1.z,this.direction2.z);B?q.ni(z,L,r):o.o.TransformNormalFromFloatsToRef(z,L,r,t,q)}clone(){const t=new l(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.Gi(),t.direction2=this.direction2.Gi(),t}parse(t){super.parse(t),o.o.FromArrayToRef(t.direction1,0,this.direction1),o.o.FromArrayToRef(t.direction2,0,this.direction2)}}class I{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.radiusRange=q,this.directionRandomizer=S}startDirectionFunction(t,q,S,B){const z=S.position.Kg(t.getTranslation()).normalize(),L=(0,C.RandomRange)(0,this.directionRandomizer),r=(0,C.RandomRange)(0,this.directionRandomizer),e=(0,C.RandomRange)(0,this.directionRandomizer);z.x+=L,z.y+=r,z.z+=e,z.normalize(),B?q.p(z):o.o.TransformNormalFromFloatsToRef(z.x,z.y,z.z,t,q)}startPositionFunction(t,q,S,B){const z=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),L=(0,C.RandomRange)(0,1),r=(0,C.RandomRange)(0,2*Math.PI),e=Math.acos(2*L-1),Z=z*Math.cos(r)*Math.sin(e),b=z*Math.cos(e),O=z*Math.sin(r)*Math.sin(e);B?q.ni(Z,Math.abs(b),O):o.o.TransformCoordinatesFromFloatsToRef(Z,Math.abs(b),O,t,q)}clone(){const t=new I(this.radius,this.directionRandomizer);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class a{constructor(){this.direction1=new o.o(0,1,0),this.direction2=new o.o(0,1,0)}startDirectionFunction(t,q,S,B){const z=(0,C.RandomRange)(this.direction1.x,this.direction2.x),L=(0,C.RandomRange)(this.direction1.y,this.direction2.y),r=(0,C.RandomRange)(this.direction1.z,this.direction2.z);B?q.ni(z,L,r):o.o.TransformNormalFromFloatsToRef(z,L,r,t,q)}startPositionFunction(t,q,S,B){B?q.ni(0,0,0):o.o.TransformCoordinatesFromFloatsToRef(0,0,0,t,q)}clone(){const t=new a;return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.Gi(),t.direction2=this.direction2.Gi(),t}parse(t){o.o.FromArrayToRef(t.direction1,0,this.direction1),o.o.FromArrayToRef(t.direction2,0,this.direction2)}}class v{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.radiusRange=q,this.directionRandomizer=S}startDirectionFunction(t,q,S,B){const z=S.position.Kg(t.getTranslation()).normalize(),L=(0,C.RandomRange)(0,this.directionRandomizer),r=(0,C.RandomRange)(0,this.directionRandomizer),e=(0,C.RandomRange)(0,this.directionRandomizer);z.x+=L,z.y+=r,z.z+=e,z.normalize(),B?q.p(z):o.o.TransformNormalFromFloatsToRef(z.x,z.y,z.z,t,q)}startPositionFunction(t,q,S,B){const z=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),L=(0,C.RandomRange)(0,1),r=(0,C.RandomRange)(0,2*Math.PI),e=Math.acos(2*L-1),Z=z*Math.cos(r)*Math.sin(e),b=z*Math.cos(e),O=z*Math.sin(r)*Math.sin(e);B?q.ni(Z,b,O):o.o.TransformCoordinatesFromFloatsToRef(Z,b,O,t,q)}clone(){const t=new v(this.radius,this.directionRandomizer);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class M extends v{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.o(0,1,0),S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0);super(t),this.direction1=q,this.direction2=S}startDirectionFunction(t,q){const S=(0,C.RandomRange)(this.direction1.x,this.direction2.x),B=(0,C.RandomRange)(this.direction1.y,this.direction2.y),z=(0,C.RandomRange)(this.direction1.z,this.direction2.z);o.o.TransformNormalFromFloatsToRef(S,B,z,t,q)}clone(){const t=new M(this.radius,this.direction1,this.direction2);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.Gi(),t.direction2=this.direction2.Gi(),t}parse(t){super.parse(t),this.direction1.p(t.direction1),this.direction2.p(t.direction2)}}class x{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(t,q,S,B){const z=o.j.wi[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,S,z);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,S,z);const t=o.j.wi[1];z.subtractToRef(S.position,t),t.scaleToRef(1/S.lifeTime,z)}else z.set(0,0,0);B?q.p(z):o.o.TransformNormalToRef(z,t,q)}startPositionFunction(t,q,S,B){const z=o.j.wi[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,S,z):z.set(0,0,0),B?q.p(z):o.o.TransformCoordinatesToRef(z,t,q)}clone(){const t=new x;return Z.c.DeepCopy(this,t),t}applyToShader(t){}buildUniformLayout(t){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.particlePositionGenerator=this.particlePositionGenerator,t.particleDestinationGenerator=this.particleDestinationGenerator,t}parse(t){t.particlePositionGenerator&&(this.particlePositionGenerator=t.particlePositionGenerator),t.particleDestinationGenerator&&(this.particleDestinationGenerator=t.particleDestinationGenerator)}}var k=S(716);class V{get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh=t,t?(this._indices=t.Bi(),this._positions=t.getVerticesData(k.i.PositionKind),this._normals=t.getVerticesData(k.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=o.o.Zero(),this._mesh=null,this.direction1=new o.o(0,1,0),this.direction2=new o.o(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}startDirectionFunction(t,q,S,B){if(this.useMeshNormalsForDirection&&this._normals)return void o.o.TransformNormalToRef(this._storedNormal,t,q);const z=(0,C.RandomRange)(this.direction1.x,this.direction2.x),L=(0,C.RandomRange)(this.direction1.y,this.direction2.y),r=(0,C.RandomRange)(this.direction1.z,this.direction2.z);B?q.ni(z,L,r):o.o.TransformNormalFromFloatsToRef(z,L,r,t,q)}startPositionFunction(t,q,S,B){if(!this._indices||!this._positions)return;const z=3*(Math.random()*(this._indices.length/3)|0),L=Math.random(),r=Math.random()*(1-L),e=1-L-r,C=this._indices[z],Z=this._indices[z+1],b=this._indices[z+2],O=o.j.wi[0],i=o.j.wi[1],h=o.j.wi[2],l=o.j.wi[3];o.o.FromArrayToRef(this._positions,3*C,O),o.o.FromArrayToRef(this._positions,3*Z,i),o.o.FromArrayToRef(this._positions,3*b,h),l.x=L*O.x+r*i.x+e*h.x,l.y=L*O.y+r*i.y+e*h.y,l.z=L*O.z+r*i.z+e*h.z,B?q.ni(l.x,l.y,l.z):o.o.TransformCoordinatesFromFloatsToRef(l.x,l.y,l.z,t,q),this.useMeshNormalsForDirection&&this._normals&&(o.o.FromArrayToRef(this._normals,3*C,O),o.o.FromArrayToRef(this._normals,3*Z,i),o.o.FromArrayToRef(this._normals,3*b,h),this._storedNormal.x=L*O.x+r*i.x+e*h.x,this._storedNormal.y=L*O.y+r*i.y+e*h.y,this._storedNormal.z=L*O.z+r*i.z+e*h.z)}clone(){const t=new V(this.mesh);return Z.c.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var t;const q={};return q.type=this.getClassName(),q.direction1=this.direction1.Gi(),q.direction2=this.direction2.Gi(),q.meshId=null===(t=this.mesh)||void 0===t?void 0:t.id,q.useMeshNormalsForDirection=this.useMeshNormalsForDirection,q}parse(t,q){o.o.FromArrayToRef(t.direction1,0,this.direction1),o.o.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&q&&(this.mesh=q.getLastMeshById(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection}}class J{_isUbo(t){return void 0!==t.addUniform}constructor(t){this._isUbo(t)?(this.setMatrix3x3=t.updateMatrix3x3.bind(t),this.setMatrix2x2=t.updateMatrix2x2.bind(t),this.setFloat=t.updateFloat.bind(t),this.setFloat2=t.updateFloat2.bind(t),this.setFloat3=t.updateFloat3.bind(t),this.setFloat4=t.updateFloat4.bind(t),this.setFloatArray=t.updateFloatArray.bind(t),this.setArray=t.updateArray.bind(t),this.setIntArray=t.updateIntArray.bind(t),this.setMatrix=t.ej.bind(t),this.setMatrices=t.updateMatrices.bind(t),this.setVector3=t.updateVector3.bind(t),this.setVector4=t.updateVector4.bind(t),this.setColor3=t.updateColor3.bind(t),this.setColor4=t.updateColor4.bind(t),this.setDirectColor4=t.updateDirectColor4.bind(t),this.setInt=t.updateInt.bind(t),this.setInt2=t.updateInt2.bind(t),this.setInt3=t.updateInt3.bind(t),this.setInt4=t.updateInt4.bind(t)):(this.setMatrix3x3=t.setMatrix3x3.bind(t),this.setMatrix2x2=t.setMatrix2x2.bind(t),this.setFloat=t.setFloat.bind(t),this.setFloat2=t.setFloat2.bind(t),this.setFloat3=t.setFloat3.bind(t),this.setFloat4=t.setFloat4.bind(t),this.setFloatArray=t.setFloatArray.bind(t),this.setArray=t.setArray.bind(t),this.setIntArray=t.setIntArray.bind(t),this.setMatrix=t.setMatrix.bind(t),this.setMatrices=t.setMatrices.bind(t),this.setVector3=t.setVector3.bind(t),this.setVector4=t.setVector4.bind(t),this.setColor3=t.setColor3.bind(t),this.setColor4=t.setColor4.bind(t),this.setDirectColor4=t.setDirectColor4.bind(t),this.setInt=t.setInt.bind(t),this.setInt2=t.setInt2.bind(t),this.setInt3=t.setInt3.bind(t),this.setInt4=t.setInt4.bind(t))}}var U=S(572);const H="gpuUpdateParticlesPixelShader",j="#version 300 es\nvoid main() {discard;}\n";U.e.ShadersStore[H]||(U.e.ShadersStore[H]=j);const y="gpuUpdateParticlesVertexShader",Q="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";U.e.ShadersStore[y]||(U.e.ShadersStore[y]=Q);(0,r.c)("BABYLON.WebGL2ParticleSystem",class{constructor(t,q){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=t,this._engine=q,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var t;return(null===(t=this._updateEffect)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof x&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=t,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new J(this._updateEffect)}createVertexBuffers(t,q){this._updateVAO.push(this._createUpdateVAO(t)),this._renderVAO.push(this._engine.recordVertexArrayObject(q,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=q}createParticleBuffer(t){return t}bindDrawBuffers(t,q,S){S?this._engine.bindBuffers(this._renderVertexBuffers,S,q):this._engine.bindVertexArrayObject(this._renderVAO[t],null)}preUpdateParticleBuffer(){const t=this._engine;if(this._engine.enableEffect(this._updateEffect),!t.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(t,q,S){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[t],null);const o=this._engine;o.bindTransformFeedbackBuffer(q.getBuffer()),o.setRasterizerState(!1),o.beginTransformFeedback(!0),o.drawArraysType(3,0,S),o.endTransformFeedback(),o.setRasterizerState(!0),o.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let t=0;t<this._updateVAO.length;t++)this._engine.releaseVertexArrayObject(this._updateVAO[t]);this._updateVAO.length=0;for(let t=0;t<this._renderVAO.length;t++)this._engine.releaseVertexArrayObject(this._renderVAO[t]);this._renderVAO.length=0}_createUpdateVAO(t){const q={};q.position=t.createVertexBuffer("position",0,3);let S=3;q.age=t.createVertexBuffer("age",S,1),S+=1,q.size=t.createVertexBuffer("size",S,3),S+=3,q.life=t.createVertexBuffer("life",S,1),S+=1,q.seed=t.createVertexBuffer("seed",S,4),S+=4,q.direction=t.createVertexBuffer("direction",S,3),S+=3,this._parent.particleEmitterType instanceof x&&(q.initialPosition=t.createVertexBuffer("initialPosition",S,3),S+=3),this._parent._colorGradientsTexture||(q.color=t.createVertexBuffer("color",S,4),S+=4),this._parent._isBillboardBased||(q.initialDirection=t.createVertexBuffer("initialDirection",S,3),S+=3),this._parent.noiseTexture&&(q.noiseCoordinates1=t.createVertexBuffer("noiseCoordinates1",S,3),S+=3,q.noiseCoordinates2=t.createVertexBuffer("noiseCoordinates2",S,3),S+=3),this._parent._angularSpeedGradientsTexture?(q.angle=t.createVertexBuffer("angle",S,1),S+=1):(q.angle=t.createVertexBuffer("angle",S,2),S+=2),this._parent._isAnimationSheetEnabled&&(q.cellIndex=t.createVertexBuffer("cellIndex",S,1),S+=1,this._parent.spriteRandomStartCell&&(q.cellStartOffset=t.createVertexBuffer("cellStartOffset",S,1),S+=1));const o=this._engine.recordVertexArrayObject(q,null,this._updateEffect);return this._engine.bindArrayBuffer(null),o}});class K{constructor(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=arguments.length>3?arguments[3]:void 0;this._engine=t,this._label=o,this._engine._storageBuffers.push(this),this._create(q,S)}_create(t,q){this._bufferSize=t,this._creationFlags=q,this._buffer=this._engine.createStorageBuffer(t,q,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(t,q,S){this._buffer&&this._engine.updateStorageBuffer(this._buffer,t,q,S)}async read(t,q,S,o){return await this._engine.readFromStorageBuffer(this._buffer,t,q,S,o)}dispose(){const t=this._engine._storageBuffers,q=t.indexOf(this);-1!==q&&(t[q]=t[t.length-1],t.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var X=S(653),G=S(658),Y=S(701),n=S(2306),u=S(2476),W=S(496),f=S(601),D=S(2404);class m{constructor(){this._gpuTimeInFrameId=-1,this.counter=new D.c}_addDuration(t,q){t<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==t?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(q,!1),this._gpuTimeInFrameId=t):this.counter.addCount(q,!1))}}var A=S(555);class c{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=t,this._engine=q,this.uniqueId=u.b.UniqueId,q.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new m),this._engine.getCaps().supportComputeShaders?o.bindingsMapping?(this._context=q.createComputeContext(),this._shaderPath=S,this._options={bindingsMapping:{},defines:[],...o}):W.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):W.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(t,q){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=this._bindings[t];this._bindings[t]={type:S?0:4,object:q,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!o||o.object!==q||o.type!==this._bindings[t].type)}setStorageTexture(t,q){const S=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==q),this._bindings[t]={type:1,object:q,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setExternalTexture(t,q){const S=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==q),this._bindings[t]={type:6,object:q,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setVideoTexture(t,q){return!!q.externalTexture&&(this.setExternalTexture(t,q.externalTexture),!0)}setUniformBuffer(t,q){const S=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==q),this._bindings[t]={type:c._BufferIsDataBuffer(q)?7:2,object:q,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setStorageBuffer(t,q){const S=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==q),this._bindings[t]={type:c._BufferIsDataBuffer(q)?7:3,object:q,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setTextureSampler(t,q){const S=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!S||!q.compareSampler(S.object)),this._bindings[t]={type:5,object:q,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}isReady(){let t=this._effect;for(const B in this._bindings){const t=this._bindings[B],q=t.type,S=t.object;switch(q){case 0:case 4:case 1:if(!S.isReady())return!1;break;case 6:if(!S.isReady())return!1;break}}const q=[],S=this._shaderPath;if(this._options.defines)for(let B=0;B<this._options.defines.length;B++)q.push(this._options.defines[B]);const o=q.join("\n");return this._cachedDefines!==o&&(this._cachedDefines=o,t=this._engine.createComputeEffect(S,{defines:o,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=t),!!t.isReady()}dispatch(t,q,S){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,t,q,S,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const S=c._BufferIsDataBuffer(t)?t:t.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,S,q,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const q in this._bindings){const S=this._bindings[q];if(!this._options.bindingsMapping[q])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+q+"'");switch(S.type){case 0:{const o=this._samplers[q],B=S.object;var t;if(!o||!B._texture||!o.compareSampler(B._texture))this._samplers[q]=(new f.c).setParameters(B.wrapU,B.wrapV,B.wrapR,B.anisotropicFilteringLevel,B._texture.samplingMode,null===(t=B._texture)||void 0===t?void 0:t._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const t=S.object;t.getBuffer()!==S.buffer&&(S.buffer=t.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((B=>{(0,A.g)((()=>this.dispatch(t,q,S)),B,void 0,o)}))}serialize(){const t=Y.b.Serialize(this);t.options=this._options,t.shaderPath=this._shaderPath,t.Yl={},t.textures={};for(const q in this._bindings){const S=this._bindings[q],o=S.object;switch(S.type){case 0:case 4:case 1:{const B=o.serialize();B&&(t.textures[q]=B,t.Yl[q]={type:S.type});break}}}return t}static Parse(t,q,S){const o=Y.b.Parse((()=>new c(t.name,q.getEngine(),t.shaderPath,t.options)),t,q,S);for(const B in t.textures){const z=t.Yl[B],L=n.b.Parse(t.textures[B],q,S);0===z.type?o.setTexture(B,L):4===z.type?o.setTexture(B,L,!1):o.setStorageTexture(B,L)}return o}static _BufferIsDataBuffer(t){return void 0!==t.underlyingResource}}(0,X.e)([(0,G.C)()],c.prototype,"name",void 0),(0,X.e)([(0,G.C)()],c.prototype,"fastMode",void 0),(0,r.c)("BABYLON.ComputeShader",c);var s=S(806);const g="gpuUpdateParticlesComputeShader",N="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";U.e.ShadersStoreWGSL[g]||(U.e.ShadersStoreWGSL[g]=N);(0,r.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(t,q){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=t,this._engine=q}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var t;return(null===(t=this._updateComputeShader)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){var q;const S={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(S.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(S.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(S.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(S.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(S.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(S.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(S.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new c("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:S,defines:t.split("\n")}),null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=new s.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new J(this._simParamsComputeShader)}createVertexBuffers(t,q){this._renderVertexBuffers.push(q)}createParticleBuffer(t){const q=new K(this._engine,4*t.length,11,"ComputeShaderParticleSystemBuffer");return q.update(t),this._bufferComputeShader.push(q),q.getBuffer()}bindDrawBuffers(t,q,S){this._engine.bindBuffers(this._renderVertexBuffers[t],S,q)}preUpdateParticleBuffer(){}updateParticleBuffer(t,q,S){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[t]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^t]),this._updateComputeShader.dispatch(Math.ceil(S/64))}releaseBuffers(){var t;for(let q=0;q<this._bufferComputeShader.length;++q)this._bufferComputeShader[q].dispose();this._bufferComputeShader.length=0,null===(t=this._simParamsComputeShader)||void 0===t||t.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class T{constructor(t,q,S){this.gradient=t,this.color1=q,this.color2=S}getColorToRef(t){this.color2?L.d.LerpToRef(this.color1,this.color2,Math.random(),t):t.p(this.color1)}}class w{constructor(t,q){this.gradient=t,this.color=q}}class E{constructor(t,q,S){this.gradient=t,this.factor1=q,this.factor2=S}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class p{static GetCurrentGradient(t,q,S){if(q[0].gradient>t)return void S(q[0],q[0],1);for(let B=0;B<q.length-1;B++){const o=q[B],z=q[B+1];if(t>=o.gradient&&t<=z.gradient){return void S(o,z,(t-o.gradient)/(z.gradient-o.gradient))}}const o=q.length-1;S(q[o],q[o],1)}}var P=S(485),F=S(11925),d=S(523);class R{constructor(t){this.particleSystem=t,this.position=o.o.Zero(),this.direction=o.o.Zero(),this.color=new L.d(0,0,0,0),this.colorStep=new L.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new o.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new L.d(0,0,0,0),this._currentColor2=new L.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=R._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let t=this.age,q=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===q?(q=1,t=this._randomCellOffset):t+=this._randomCellOffset);const S=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let o;o=this._initialSpriteCellLoop?(0,C.Clamp)(t*q%this.lifeTime/this.lifeTime):(0,C.Clamp)(t*q/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+o*S|0}_inheritParticleInfoToSubEmitter(t){if(t.particleSystem.j.position){const q=t.particleSystem.j;if(q.position.p(this.position),t.inheritDirection){const t=o.j.wi[0];this.direction.normalizeToRef(t),q.setDirection(t,0,Math.PI/2)}}else{t.particleSystem.j.p(this.position)}this.direction.scaleToRef(t.inheritedVelocityAmount/2,o.j.wi[0]),t.particleSystem._inheritedVelocityOffset.p(o.j.wi[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const t of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(t)}_reset(){this.age=0,this.id=R._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(t){t.position.p(this.position),this._initialDirection?t._initialDirection?t._initialDirection.p(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.p(this.direction),this.Ig&&(t.Ig?t.Ig.p(this.Ig):t.Ig=this.Ig.clone()),t.color.p(this.color),t.colorStep.p(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.p(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.p(this._currentColor1),t._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellId=this._initialStartSpriteCellId,t._initialEndSpriteCellId=this._initialEndSpriteCellId,t._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.p(this.remapData):t.remapData=new o.s(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}R._Count=0;var tt=S(771),qt=(S(2380),S(833)),St=S(825),ot=S(2446);function Bt(t,q){const S=(0,C.RandomRange)(0,1);L.d.LerpToRef(q.color1,q.color2,S,t.color),q.colorDead.subtractToRef(t.color,q._colorDiff),q._colorDiff.scaleToRef(1/t.lifeTime,t.colorStep)}function zt(t,q){t._currentColorGradient=q._colorGradients[0],t._currentColorGradient.getColorToRef(t.color),t._currentColor1.p(t.color),q._colorGradients.length>1?q._colorGradients[1].getColorToRef(t._currentColor2):t._currentColor2.p(t.color)}function Lt(t,q){const S=q._colorGradients;p.GetCurrentGradient(q._ratio,S,((q,S,o)=>{q!==t._currentColorGradient&&(t._currentColor1.p(t._currentColor2),S.getColorToRef(t._currentColor2),t._currentColorGradient=q),L.d.LerpToRef(t._currentColor1,t._currentColor2,o,t.color)}))}function rt(t,q){t.colorStep.scaleToRef(q._scaledUpdateSpeed,q._scaledColorStep),t.color.addInPlace(q._scaledColorStep),t.color.a<0&&(t.color.a=0)}function et(t,q){p.GetCurrentGradient(q._ratio,q._angularSpeedGradients,((q,S,o)=>{q!==t._currentAngularSpeedGradient&&(t._currentAngularSpeed1=t._currentAngularSpeed2,t._currentAngularSpeed2=S.getFactor(),t._currentAngularSpeedGradient=q),t.angularSpeed=(0,C.Lerp)(t._currentAngularSpeed1,t._currentAngularSpeed2,o)}))}function Ct(t,q){t.angle+=t.angularSpeed*q._scaledUpdateSpeed}function Zt(t,q){q.particleEmitterType.startDirectionFunction(q._emitterWorldMatrix,t.direction,t,q.isLocal,q._emitterInverseWorldMatrix)}function bt(t,q){q.startDirectionFunction(q._emitterWorldMatrix,t.direction,t,q.isLocal)}function Ot(t,q){t._currentVelocityGradient=q._velocityGradients[0],t._currentVelocity1=t._currentVelocityGradient.getFactor(),q._velocityGradients.length>1?t._currentVelocity2=q._velocityGradients[1].getFactor():t._currentVelocity2=t._currentVelocity1}function it(t,q){t._currentLimitVelocityGradient=q._limitVelocityGradients[0],t._currentLimitVelocity1=t._currentLimitVelocityGradient.getFactor(),q._limitVelocityGradients.length>1?t._currentLimitVelocity2=q._limitVelocityGradients[1].getFactor():t._currentLimitVelocity2=t._currentLimitVelocity1}function ht(t,q){p.GetCurrentGradient(q._ratio,q._velocityGradients,((S,o,B)=>{S!==t._currentVelocityGradient&&(t._currentVelocity1=t._currentVelocity2,t._currentVelocity2=o.getFactor(),t._currentVelocityGradient=S),q._directionScale*=(0,C.Lerp)(t._currentVelocity1,t._currentVelocity2,B)}))}function lt(t,q){p.GetCurrentGradient(q._ratio,q._limitVelocityGradients,((S,o,B)=>{S!==t._currentLimitVelocityGradient&&(t._currentLimitVelocity1=t._currentLimitVelocity2,t._currentLimitVelocity2=o.getFactor(),t._currentLimitVelocityGradient=S);const z=(0,C.Lerp)(t._currentLimitVelocity1,t._currentLimitVelocity2,B);t.direction.length()>z&&t.direction.scaleInPlace(q.limitVelocityDamping)}))}function It(t,q){t.direction.scaleToRef(q._directionScale,q._scaledDirection)}function at(t,q){q.particleEmitterType.startPositionFunction(q._emitterWorldMatrix,t.position,t,q.isLocal)}function vt(t,q){q.startPositionFunction(q._emitterWorldMatrix,t.position,t,q.isLocal)}function Mt(t,q){t.Ig?t.Ig.p(t.position):t.Ig=t.position.clone(),o.o.TransformCoordinatesToRef(t.Ig,q._emitterWorldMatrix,t.position)}function xt(t,q){q.isLocal&&t.Ig?(t.Ig.addInPlace(q._scaledDirection),o.o.TransformCoordinatesToRef(t.Ig,q._emitterWorldMatrix,t.position)):t.position.addInPlace(q._scaledDirection)}function kt(t,q){t._currentDragGradient=q._dragGradients[0],t._currentDrag1=t._currentDragGradient.getFactor(),q._dragGradients.length>1?t._currentDrag2=q._dragGradients[1].getFactor():t._currentDrag2=t._currentDrag1}function Vt(t,q){p.GetCurrentGradient(q._ratio,q._dragGradients,((S,o,B)=>{S!==t._currentDragGradient&&(t._currentDrag1=t._currentDrag2,t._currentDrag2=o.getFactor(),t._currentDragGradient=S);const z=(0,C.Lerp)(t._currentDrag1,t._currentDrag2,B);q._scaledDirection.scaleInPlace(1-z)}))}function Jt(t,q){t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.ni(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2.ni(Math.random(),Math.random(),Math.random())):(t._randomNoiseCoordinates1=new o.o(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2=new o.o(Math.random(),Math.random(),Math.random()))}function Ut(t,q){const S=q._noiseTextureData,B=q._noiseTextureSize;if(S&&B&&t._randomNoiseCoordinates1){const z=q._fetchR(t._randomNoiseCoordinates1.x,t._randomNoiseCoordinates1.y,B.width,B.height,S),L=q._fetchR(t._randomNoiseCoordinates1.z,t._randomNoiseCoordinates2.x,B.width,B.height,S),r=q._fetchR(t._randomNoiseCoordinates2.y,t._randomNoiseCoordinates2.z,B.width,B.height,S),e=o.j.wi[0],C=o.j.wi[1];e.ni((2*z-1)*q.noiseStrength.x,(2*L-1)*q.noiseStrength.y,(2*r-1)*q.noiseStrength.z),e.scaleToRef(q._tempScaledUpdateSpeed,C),t.direction.addInPlace(C)}}function Ht(t,q){q.gravity.scaleToRef(q._tempScaledUpdateSpeed,q._scaledGravity),t.direction.addInPlace(q._scaledGravity)}function jt(t,q){t.size=(0,C.RandomRange)(q.minSize,q.maxSize),t.scale.ni((0,C.RandomRange)(q.minScaleX,q.maxScaleX),(0,C.RandomRange)(q.minScaleY,q.maxScaleY))}function yt(t,q){t._currentSizeGradient=q._sizeGradients[0],t._currentSize1=t._currentSizeGradient.getFactor(),t.size=t._currentSize1,q._sizeGradients.length>1?t._currentSize2=q._sizeGradients[1].getFactor():t._currentSize2=t._currentSize1,t.scale.ni((0,C.RandomRange)(q.minScaleX,q.maxScaleX),(0,C.RandomRange)(q.minScaleY,q.maxScaleY))}function Qt(t,q){const S=q._actualFrame/q.targetStopDuration;p.GetCurrentGradient(S,q._startSizeGradients,((S,o,B)=>{S!==q._currentStartSizeGradient&&(q._currentStartSize1=q._currentStartSize2,q._currentStartSize2=o.getFactor(),q._currentStartSizeGradient=S);const z=(0,C.Lerp)(q._currentStartSize1,q._currentStartSize2,B);t.scale.scaleInPlace(z)}))}function Kt(t,q){p.GetCurrentGradient(q._ratio,q._sizeGradients,((q,S,o)=>{q!==t._currentSizeGradient&&(t._currentSize1=t._currentSize2,t._currentSize2=S.getFactor(),t._currentSizeGradient=q),t.size=(0,C.Lerp)(t._currentSize1,t._currentSize2,o)}))}function Xt(t,q){t.remapData=new o.s(0,1,0,1)}function Gt(t,q){q._colorRemapGradients&&q._colorRemapGradients.length>0&&p.GetCurrentGradient(q._ratio,q._colorRemapGradients,((q,S,o)=>{const B=(0,C.Lerp)(q.factor1,S.factor1,o),z=(0,C.Lerp)(q.factor2,S.factor2,o);t.remapData.x=B,t.remapData.y=z-B})),q._alphaRemapGradients&&q._alphaRemapGradients.length>0&&p.GetCurrentGradient(q._ratio,q._alphaRemapGradients,((q,S,o)=>{const B=(0,C.Lerp)(q.factor1,S.factor1,o),z=(0,C.Lerp)(q.factor2,S.factor2,o);t.remapData.z=B,t.remapData.w=z-B}))}function Yt(t,q){const S=(0,C.Clamp)(q._actualFrame/q.targetStopDuration);p.GetCurrentGradient(S,q._lifeTimeGradients,((q,o)=>{const B=q,z=o,L=B.getFactor(),r=z.getFactor(),e=(S-B.gradient)/(z.gradient-B.gradient);t.lifeTime=(0,C.Lerp)(L,r,e)})),q._emitPower=(0,C.RandomRange)(q.minEmitPower,q.maxEmitPower)}function nt(t,q){t.lifeTime=(0,C.RandomRange)(q.minLifeTime,q.maxLifeTime),q._emitPower=(0,C.RandomRange)(q.minEmitPower,q.maxEmitPower)}function ut(t,q){0===q._emitPower?(t._initialDirection?t._initialDirection.p(t.direction):t._initialDirection=t.direction.clone(),t.direction.set(0,0,0)):(t._initialDirection=null,t.direction.scaleInPlace(q._emitPower)),t.direction.addInPlace(q._inheritedVelocityOffset)}function Wt(t,q){t.angularSpeed=(0,C.RandomRange)(q.minAngularSpeed,q.maxAngularSpeed),t.angle=(0,C.RandomRange)(q.minInitialRotation,q.maxInitialRotation)}function ft(t,q){t._currentAngularSpeedGradient=q._angularSpeedGradients[0],t.angularSpeed=t._currentAngularSpeedGradient.getFactor(),t._currentAngularSpeed1=t.angularSpeed,q._angularSpeedGradients.length>1?t._currentAngularSpeed2=q._angularSpeedGradients[1].getFactor():t._currentAngularSpeed2=t._currentAngularSpeed1,t.angle=(0,C.RandomRange)(q.minInitialRotation,q.maxInitialRotation)}function Dt(t,q){t._initialStartSpriteCellId=q.startSpriteCellID,t._initialEndSpriteCellId=q.endSpriteCellID,t._initialSpriteCellLoop=q.spriteCellLoop}function mt(t,q){t.previousItem=q.previousItem,t.nextItem=q,q.previousItem&&(q.previousItem.nextItem=t),q.previousItem=t}function At(t,q){t.previousItem=q,t.nextItem=q.nextItem,q.nextItem&&(q.nextItem.previousItem=t),q.nextItem=t}function ct(t,q){let S=q;for(;S.nextItem;)S=S.nextItem;t.previousItem=S,t.nextItem=S.nextItem,S.nextItem=t}function st(t){t.previousItem&&(t.previousItem.nextItem=t.nextItem),t.nextItem&&(t.nextItem.previousItem=t.previousItem)}class gt extends e{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(t){this._startDirectionFunction!==t&&(this._startDirectionFunction=t,this._directionProcessing.process=t?bt:Zt)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(t){this._startPositionFunction!==t&&(this._startPositionFunction=t,this._positionCreation.process=t?vt:at)}set onDispose(t){this._onDisposeObserver&&this.Qi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qi.add(t)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(t){this._useRampGradients!==t&&(this._useRampGradients=t,this._resetEffect(),t?(this._rampCreation={process:Xt,previousItem:null,nextItem:null},At(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Gt,previousItem:null,nextItem:null},At(this._remapGradientProcessing,this._gravityProcessing)):(st(this._rampCreation),st(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(t){this._isLocal!==t&&(this._isLocal=t,t?(this._isLocalCreation={process:Mt,previousItem:null,nextItem:null},At(this._isLocalCreation,this._positionCreation)):st(this._isLocalCreation))}get particles(){return this.Tl}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(t){this._animationSheetEnabled!==t&&(this._animationSheetEnabled=t,t?(this._sheetCreation={process:Dt,previousItem:null,nextItem:null},At(this._sheetCreation,this._colorCreation)):st(this._sheetCreation),this._reset())}getActiveCount(){return this.Tl.length}getClassName(){return"lj"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var t;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[q])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new tt.e(this._engine),this._customWrappers[q].effect=t,this._customWrappers[q].drawContext&&(this._customWrappers[q].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new P.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(t){if(this.noiseTexture!==t){if(this._noiseTexture=t,!t)return st(this._noiseCreation),void st(this._noiseProcessing);this._noiseCreation={process:Jt,previousItem:null,nextItem:null},At(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Ut,previousItem:null,nextItem:null},At(this._noiseProcessing,this._positionProcessing)}}constructor(t,q,S){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,e=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(t),this._emitterInverseWorldMatrix=o.e.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new o.o,this.Qi=new P.b,this.onStoppedObservable=new P.b,this.onStartedObservable=new P.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Tl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new L.d(0,0,0,0),this._colorDiff=new L.d(0,0,0,0),this._scaledDirection=o.o.Zero(),this._scaledGravity=o.o.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=t=>{},this.recycleParticle=t=>{const q=this.Tl.pop();q!==t&&q.copyTo(t),this._stockParticles.push(q)},this._createParticle=()=>{let t;return 0!==this._stockParticles.length?(t=this._stockParticles.pop(),t._reset()):t=new R(this),this._prepareParticle(t),t},this.paused=!1,this._shadersLoaded=!1,this._capacity=q,this._epsilon=r,S&&"Scene"!==S.getClassName()?(this._engine=S,this.defaultProjectionMatrix=o.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=S||d.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.zi.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:nt,previousItem:null,nextItem:null},this._positionCreation={process:at,previousItem:null,nextItem:null},At(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Zt,previousItem:null,nextItem:null},At(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:ut,previousItem:null,nextItem:null},At(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:jt,previousItem:null,nextItem:null},At(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Wt,previousItem:null,nextItem:null},At(this._angleCreation,this._sizeCreation),this._colorCreation={process:Bt,previousItem:null,nextItem:null},At(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,e||(this._colorProcessing={process:rt,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Ct,previousItem:null,nextItem:null},At(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:It,previousItem:null,nextItem:null},At(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:xt,previousItem:null,nextItem:null},At(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Ht,previousItem:null,nextItem:null},At(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=z,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new b,this.updateFunction=t=>{var q;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(q=this.noiseTexture.getContent())||void 0===q||q.then((t=>{this._noiseTextureData=t})));const S=t===this.Tl;for(let o=0;o<t.length;o++){const q=t[o];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const B=q.age;if(q.age+=this._tempScaledUpdateSpeed,q.age>q.lifeTime){const t=q.age-B,S=q.lifeTime-B;this._tempScaledUpdateSpeed=S*this._tempScaledUpdateSpeed/t,q.age=q.lifeTime}this._ratio=q.age/q.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let z=this._updateQueueStart;for(;z;)z.process(q,this),z=z.nextItem;if(this._isAnimationSheetEnabled&&!e&&q.updateCellIndex(),q._inheritParticleInfoToSubEmitters(),q.age>=q.lifeTime){if(this._emitFromParticle(q),q._attachedSubEmitters){for(const t of q._attachedSubEmitters)t.particleSystem.disposeOnStop=!0,t.particleSystem.stop();q._attachedSubEmitters=null}this.recycleParticle(q),S&&o--}else;}}}serialize(t){throw new Error("Method not implemented.")}clone(t,q){throw new Error("Method not implemented.")}_addFactorGradient(t,q,S,o){const B=new E(q,S,o);t.push(B),t.sort(((t,q)=>t.gradient<q.gradient?-1:t.gradient>q.gradient?1:0))}_removeFactorGradient(t,q){if(!t)return;let S=0;for(const o of t){if(o.gradient===q){t.splice(S,1);break}S++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Yt:this._lifeTimeCreation.process=nt}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Qt,previousItem:null,nextItem:null},At(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(st(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(t){this.targetStopDuration!==t&&(this._targetStopDuration=t,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(t,q,S){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,t,q,S),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(t){return this._removeFactorGradient(this._lifeTimeGradients,t),this._syncLifeTimeCreation(),this}addSizeGradient(t,q,S){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=yt,this._sizeGradientProcessing={process:Kt,previousItem:null,nextItem:null},mt(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,t,q,S),this}removeSizeGradient(t){var q;return this._removeFactorGradient(this._sizeGradients,t),0===(null===(q=this._sizeGradients)||void 0===q?void 0:q.length)&&(st(this._sizeGradientProcessing),this._sizeCreation.process=jt),this}addColorRemapGradient(t,q,S){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,t,q,S),this}removeColorRemapGradient(t){return this._removeFactorGradient(this._colorRemapGradients,t),this}addAlphaRemapGradient(t,q,S){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,t,q,S),this}removeAlphaRemapGradient(t){return this._removeFactorGradient(this._alphaRemapGradients,t),this}addAngularSpeedGradient(t,q,S){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ft,this._angularSpeedGradientProcessing={process:et,previousItem:null,nextItem:null},mt(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,t,q,S),this}removeAngularSpeedGradient(t){var q;return this._removeFactorGradient(this._angularSpeedGradients,t),0===(null===(q=this._angularSpeedGradients)||void 0===q?void 0:q.length)&&(this._angleCreation.process=Wt,st(this._angularSpeedGradientProcessing)),this}addVelocityGradient(t,q,S){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Ot,previousItem:null,nextItem:null},At(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:ht,previousItem:null,nextItem:null},mt(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,t,q,S),this}removeVelocityGradient(t){var q;return this._removeFactorGradient(this._velocityGradients,t),0===(null===(q=this._velocityGradients)||void 0===q?void 0:q.length)&&(st(this._velocityCreation),st(this._velocityGradientProcessing)),this}addLimitVelocityGradient(t,q,S){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:it,previousItem:null,nextItem:null},At(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:lt,previousItem:null,nextItem:null},At(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,t,q,S),this}removeLimitVelocityGradient(t){var q;return this._removeFactorGradient(this._limitVelocityGradients,t),0===(null===(q=this._limitVelocityGradients)||void 0===q?void 0:q.length)&&(st(this._limitVelocityCreation),st(this._limitVelocityGradientProcessing)),this}addDragGradient(t,q,S){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:kt,previousItem:null,nextItem:null},mt(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Vt,previousItem:null,nextItem:null},mt(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,t,q,S),this}removeDragGradient(t){var q;return this._removeFactorGradient(this._dragGradients,t),0===(null===(q=this._dragGradients)||void 0===q?void 0:q.length)&&(st(this._dragCreation),st(this._dragGradientProcessing)),this}addEmitRateGradient(t,q,S){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,t,q,S),this}removeEmitRateGradient(t){return this._removeFactorGradient(this._emitRateGradients,t),this}addStartSizeGradient(t,q,S){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,t,q,S),this._syncStartSizeCreation(),this}removeStartSizeGradient(t){return this._removeFactorGradient(this._startSizeGradients,t),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const t=new Uint8Array(4*this._rawTextureWidth),q=L.h.aj[0];for(let S=0;S<this._rawTextureWidth;S++){const o=S/this._rawTextureWidth;p.GetCurrentGradient(o,this._rampGradients,((o,B,z)=>{L.c.LerpToRef(o.color,B.color,z,q),t[4*S]=255*q.r,t[4*S+1]=255*q.g,t[4*S+2]=255*q.b,t[4*S+3]=255}))}this._rampGradientsTexture=F.d.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((t,q)=>t.gradient<q.gradient?-1:t.gradient>q.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(t,q){this._rampGradients||(this._rampGradients=[]);const S=new w(t,q);return this._rampGradients.push(S),this._syncRampGradientTexture(),this}removeRampGradient(t){return this._removeGradientAndTexture(t,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(t,q,S){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=zt,this._colorProcessing.process=Lt);const o=new T(t,q,S);return this._colorGradients.push(o),this._colorGradients.sort(((t,q)=>t.gradient<q.gradient?-1:t.gradient>q.gradient?1:0)),this}removeColorGradient(t){if(!this._colorGradients)return this;let q=0;for(const S of this._colorGradients){if(S.gradient===t){this._colorGradients.splice(q,1);break}q++}return 0===this._colorGradients.length&&(this._colorCreation.process=Bt,this._colorProcessing.process=rt),this}resetDrawCache(){if(this._drawWrappers){for(const t of this._drawWrappers)if(t)for(const q of t)null===q||void 0===q||q.dispose();this._drawWrappers=[]}}_fetchR(t,q,S,o,B){return B[4*(((t=.5*Math.abs(t)+.5)*S%S|0)+((q=.5*Math.abs(q)+.5)*o%o|0)*S)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const t=this._engine,q=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*q),this._vertexBuffer=new k.e(t,this._vertexData,!0,q);let S=0;const o=this._vertexBuffer.createVertexBuffer(k.i.PositionKind,S,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[k.i.PositionKind]=o,S+=3;const B=this._vertexBuffer.createVertexBuffer(k.i.ColorKind,S,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[k.i.ColorKind]=B,S+=4;const z=this._vertexBuffer.createVertexBuffer("angle",S,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=z,S+=1;const L=this._vertexBuffer.createVertexBuffer("size",S,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=L,S+=2,this._isAnimationSheetEnabled){const t=this._vertexBuffer.createVertexBuffer("cellIndex",S,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=t,S+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const t=this._vertexBuffer.createVertexBuffer("direction",S,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=t,S+=3}if(this._useRampGradients){const t=this._vertexBuffer.createVertexBuffer("remapData",S,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=t,S+=4}let r;if(this._useInstancing){const q=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new k.e(t,q,!1,2),r=this._spriteBuffer.createVertexBuffer("offset",0,2)}else r=this._vertexBuffer.createVertexBuffer("offset",S,2,this._vertexBufferSize,this._useInstancing),S+=2;this._vertexBuffers.offset=r,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const t=[],q=[];let S=0;for(let o=0;o<this._capacity;o++)t.push(S),t.push(S+1),t.push(S+2),t.push(S),t.push(S+2),t.push(S+3),q.push(S,S+1,S+1,S+2,S+2,S+3,S+3,S,S,S+3),S+=4;this._indexBuffer=this._engine.createIndexBuffer(t),this._linesIndexBuffer=this._engine.createIndexBuffer(q)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(t)setTimeout((()=>{this.start(0)}),t);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var q;-1!==(null===(q=this.j)||void 0===q?void 0:q.getClassName().indexOf("Mesh"))&&this.j.Ai(!0);const t=this.noiseTexture;if(t&&t.onGeneratedObservable)t.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),t.render()}))}));else for(let q=0;q<this.preWarmCycles;q++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(t))}_postStop(t){}reset(){this._stockParticles.length=0,this.Tl.length=0}_appendParticleVertex(t,q,S,B){let z=t*this._vertexBufferSize;if(this._vertexData[z++]=q.position.x+this.tg.x,this._vertexData[z++]=q.position.y+this.tg.y,this._vertexData[z++]=q.position.z+this.tg.z,this._vertexData[z++]=q.color.r,this._vertexData[z++]=q.color.g,this._vertexData[z++]=q.color.b,this._vertexData[z++]=q.color.a,this._vertexData[z++]=q.angle,this._vertexData[z++]=q.scale.x*q.size,this._vertexData[z++]=q.scale.y*q.size,this._isAnimationSheetEnabled&&(this._vertexData[z++]=q.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[z++]=q.direction.x,this._vertexData[z++]=q.direction.y,this._vertexData[z++]=q.direction.z);else if(q._initialDirection){let t=q._initialDirection;this.isLocal&&(o.o.TransformNormalToRef(t,this._emitterWorldMatrix,o.j.wi[0]),t=o.j.wi[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[z++]=t.x,this._vertexData[z++]=t.y,this._vertexData[z++]=t.z}else{let t=q.direction;this.isLocal&&(o.o.TransformNormalToRef(t,this._emitterWorldMatrix,o.j.wi[0]),t=o.j.wi[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[z++]=t.x,this._vertexData[z++]=t.y,this._vertexData[z++]=t.z}this._useRampGradients&&q.remapData&&(this._vertexData[z++]=q.remapData.x,this._vertexData[z++]=q.remapData.y,this._vertexData[z++]=q.remapData.z,this._vertexData[z++]=q.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===S?S=this._epsilon:1===S&&(S=1-this._epsilon),0===B?B=this._epsilon:1===B&&(B=1-this._epsilon)),this._vertexData[z++]=S,this._vertexData[z++]=B)}_prepareParticle(t){}_createNewOnes(t){let q;for(let S=0;S<t&&this.Tl.length!==this._capacity;S++){q=this._createParticle(),this.Tl.push(q);let t=this._createQueueStart;for(;t;)t.process(q,this),t=t.nextItem;q._inheritParticleInfoToSubEmitters()}}_update(t){if(this._alive=this.Tl.length>0,this.j.position){const t=this.j;this._emitterWorldMatrix=t.getWorldMatrix()}else{const t=this.j;this._emitterWorldMatrix=o.e.Translation(t.x,t.y,t.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Tl),this._createNewOnes(t)}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=[k.i.PositionKind,k.i.ColorKind,"angle","offset","size"];return t&&o.push("cellIndex"),q||o.push("direction"),S&&o.push("remapData"),o}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,qt.c)(o),t&&o.push("particlesInfos"),q&&o.push("logarithmicDepthConstant"),S&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(t,q){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qt.m)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&t.push("#define FOG")),this._isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),q===e.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&t.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case 2:t.push("#define BILLBOARDY");break;case 8:case 9:t.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&t.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:t.push("#define BILLBOARDMODE_ALL")}S&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,q,S){q.push(...gt._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),t.push(...gt._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),S.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ot.e)(t,this._imageProcessingConfigurationDefines),(0,ot.c)(S,this._imageProcessingConfigurationDefines))}_getWrapper(t){const q=this._getCustomDrawWrapper(t);if(null!==q&&void 0!==q&&q.effect)return q;const S=[];this.fillDefines(S,t);const o=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let B=this._drawWrappers[o];B||(B=this._drawWrappers[o]=[]);let z=B[t];z||(z=new tt.e(this._engine),z.drawContext&&(z.drawContext.useInstancing=this._useInstancing),B[t]=z);const L=S.join("\n");if(z.defines!==L){const t=[],q=[],S=[];this.fillUniformsAttributesAndSamplerNames(q,t,S),z.setEffect(this._engine.createEffect("particles",t,q,S,L,void 0,void 0,void 0,void 0,this._shaderLanguage),L)}return z}animate(){var t;let q,S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!S&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(S?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this.manualEmitCount>-1)q=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let t=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const q=this._actualFrame/this.targetStopDuration;p.GetCurrentGradient(q,this._emitRateGradients,((q,S,o)=>{q!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=S.getFactor(),this._currentEmitRateGradient=q),t=(0,C.Lerp)(this._currentEmitRate1,this._currentEmitRate2,o)}))}q=t*this._scaledUpdateSpeed|0,this._newPartsExcess+=t*this._scaledUpdateSpeed-q}if(this._newPartsExcess>1&&(q+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?q=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(q),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!S){let t=0;for(let q=0;q<this.Tl.length;q++){const S=this.Tl[q];this._appendParticleVertices(t,S),t+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Tl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(t,q){this._appendParticleVertex(t++,q,0,0),this._useInstancing||(this._appendParticleVertex(t++,q,1,0),this._appendParticleVertex(t++,q,1,1),this._appendParticleVertex(t++,q,0,1))}rebuild(){var t;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(t=this._spriteBuffer)||void 0===t||t._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!gt.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(S.bind(S,12716)),Promise.resolve().then(S.bind(S,12650))])):await Promise.all([Promise.resolve().then(S.bind(S,12635)),Promise.resolve().then(S.bind(S,12626))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==e.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(e.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(e.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(t){const q=this._getWrapper(t),S=q.effect,B=this._engine;B.enableEffect(q);const z=this.defaultViewMatrix??this._scene.getViewMatrix();if(S.setTexture("diffuseSampler",this.particleTexture),S.setMatrix("view",z),S.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();S.setFloat3("particlesInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,this.spriteCellWidth/t.width)}if(S.setVector2("translationPivot",this.translationPivot),S.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;S.setVector3("eyePosition",t.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),S.setTexture("rampSampler",this._rampGradientsTexture));const L=S.defines;var r,e,C,Z,b,O;(this._scene&&((0,qt.f)(S,this,this._scene),this.applyFog&&(0,St.f)(this._scene,void 0,S)),L.indexOf("#define BILLBOARDMODE_ALL")>=0&&(z.invertToRef(o.j.Matrix[0]),S.setMatrix("invView",o.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?B.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,S):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,S)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?B.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBuffer:this._indexBuffer,S):B.bindBuffers(this._vertexBuffers,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:null,S);(this.useLogarithmicDepth&&this._scene&&(0,St.k)(L,S,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(S),this._setEngineBasedOnBlendMode(t),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(S),this._useInstancing)?null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?B.drawElementsType(6,0,10,this.Tl.length):B.drawArraysType(7,0,4,this.Tl.length):null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?B.drawElementsType(1,0,10*this.Tl.length):B.drawElementsType(0,0,6*this.Tl.length);return this.Tl.length}render(){if(!this.isReady()||!this.Tl.length)return 0;const t=this._engine;t.setState&&(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0));let q=0;return q=this.blendMode===e.BLENDMODE_MULTIPLYADD?this._render(e.BLENDMODE_MULTIPLY)+this._render(e.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),q}_onDispose(){}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(q,S),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const t=this._scene.zi.indexOf(this);t>-1&&this._scene.zi.splice(t,1),this._scene._activeParticleSystems.dispose()}this.Qi.notifyObservers(this),this.Qi.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}gt.ForceGLSL=!1;var Nt,Tt=S(518);!function(t){t[t.ATTACHED=0]="ATTACHED",t[t.END=1]="END"}(Nt||(Nt={}));class wt{constructor(t){if(this.particleSystem=t,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.j||!t.j.dispose){const q=(0,r.b)("BABYLON.AbstractMesh");t.j=new q("SubemitterSystemEmitter",t.va()),t._disposeEmitterOnDispose=!0}}clone(){let t=this.particleSystem.j;if(t){if(t instanceof o.o)t=t.clone();else if(-1!==t.getClassName().indexOf("Mesh")){t=new((0,r.b)("BABYLON.Mesh"))("",t.va()),t.isVisible=!1}}else t=new o.o;const q=new wt(this.particleSystem.clone(this.particleSystem.name,t));return q.particleSystem.name+="Clone",q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem._disposeEmitterOnDispose=!0,q.particleSystem.disposeOnStop=!0,q}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return q.type=this.type,q.inheritDirection=this.inheritDirection,q.inheritedVelocityAmount=this.inheritedVelocityAmount,q.particleSystem=this.particleSystem.serialize(t),q}static _ParseParticleSystem(t,q,S){throw(0,Tt.d)("ParseParticle")}static Parse(t,q,S){const o=t.particleSystem,B=new wt(wt._ParseParticleSystem(o,q,S,!0));return B.type=t.type,B.inheritDirection=t.inheritDirection,B.inheritedVelocityAmount=t.inheritedVelocityAmount,B.particleSystem._isSubEmitter=!0,B}dispose(){this.particleSystem.dispose()}}var Et=S(561);function pt(t,q){const S=new a;return S.direction1=t,S.direction2=q,S}function Pt(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ft(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function dt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.o(0,1,0),S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0);return new M(t,q,S)}function Rt(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function tq(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.o(0,1,0);return new l(t,q,S,B,z)}function qq(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new O(t,q)}function Sq(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0);return new i(t,q,S,B)}const oq=o.o.Zero(),Bq=o.o.Zero(),zq=o.o.Zero();class Lq{constructor(){this.strength=0,this.position=o.o.Zero()}_processParticle(t,q){this.position.subtractToRef(t.position,oq);const S=oq.lengthSquared()+1;oq.normalize().scaleToRef(this.strength/S,Bq),Bq.scaleToRef(q._tempScaledUpdateSpeed,zq),t.direction.addInPlace(zq)}serialize(){return{position:this.position.Gi(),strength:this.strength}}}class rq extends gt{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=t=>{if(!this._subEmitters||0===this._subEmitters.length)return;const q=Math.floor(Math.random()*this._subEmitters.length);for(const S of this._subEmitters[q])if(1===S.type){const q=S.clone();t._inheritParticleInfoToSubEmitter(q),q.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(q.particleSystem),q.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(t,q){const S=pt(t,q);return this.particleEmitterType=S,S}get flowMap(){return this._flowMap}set flowMap(t){this._flowMap!==t&&(this._flowMap=t,this._flowMapUpdate&&(st(this._flowMapUpdate),this._flowMapUpdate=null),t&&(this._flowMapUpdate={process:t=>{var q;const S=null===(q=this.va())||void 0===q?void 0:q.getTransformMatrix();this._flowMap._processParticle(t,this.flowMapStrength*this._tempScaledUpdateSpeed,S)},previousItem:null,nextItem:null},At(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(t){this._attractors.push(t),1===this._attractors.length&&(this._attractorUpdate={process:t=>{for(const q of this._attractors)q._processParticle(t,this)},previousItem:null,nextItem:null},At(this._attractorUpdate,this._directionProcessing))}removeAttractor(t){const q=this._attractors.indexOf(t);-1!==q&&this._attractors.splice(q,1),0===this._attractors.length&&st(this._attractorUpdate)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(t)}createHemisphericEmitter(){const t=Pt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=Ft(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=dt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=Rt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=tq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.o(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=qq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=Sq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,q,S,o){const B=new b;return this.particleEmitterType=B,this.direction1=t,this.direction2=q,this.minEmitBox=S,this.maxEmitBox=o,B}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const t of this.subEmitters)t instanceof rq?this._subEmitters.push([new wt(t)]):t instanceof wt?this._subEmitters.push([t]):t instanceof Array&&this._subEmitters.push(t)}_stopSubEmitters(){if(this.activeSubSystems){for(const t of this.activeSubSystems)t.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const t=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==t&&this._rootParticleSystem.activeSubSystems.splice(t,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(t){t&&this._stopSubEmitters()}_prepareParticle(t){if(this._subEmitters&&this._subEmitters.length>0){const q=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];t._attachedSubEmitters=[];for(const S of q)if(0===S.type){const q=S.clone();t._attachedSubEmitters.push(q),q.particleSystem.start()}}}_onDispose(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),t&&this.particles)for(const S of this.particles)if(S._attachedSubEmitters)for(let t=S._attachedSubEmitters.length-1;t>=0;t-=1)S._attachedSubEmitters[t].dispose();if(q&&this.activeSubSystems)for(let S=this.activeSubSystems.length-1;S>=0;S-=1)this.activeSubSystems[S].dispose();if(this._subEmitters&&this._subEmitters.length){for(let t=0;t<this._subEmitters.length;t++)for(const q of this._subEmitters[t])q.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(t,q,S,B){let z;z=S instanceof Et.c?null:S;const e=(0,r.b)("BABYLON.Texture");if(e&&z&&(t.texture?q.particleTexture=e.Parse(t.texture,z,B):t.textureName&&(q.particleTexture=new e(B+t.textureName,z,!1,void 0===t.invertY||t.invertY),q.particleTexture.name=t.textureName)),t.emitterId||0===t.emitterId||void 0!==t.j?t.emitterId&&z?q.j=z.getLastMeshById(t.emitterId):q.j=o.o.ti(t.j):q.j=o.o.Zero(),q.isLocal=!!t.isLocal,void 0!==t.renderingGroupId&&(q.renderingGroupId=t.renderingGroupId),void 0!==t.isBillboardBased&&(q.isBillboardBased=t.isBillboardBased),void 0!==t.billboardMode&&(q.billboardMode=t.billboardMode),void 0!==t.useLogarithmicDepth&&(q.useLogarithmicDepth=t.useLogarithmicDepth),t.animations){for(let S=0;S<t.animations.length;S++){const o=t.animations[S],B=(0,r.b)("BABYLON.Animation");B&&q.animations.push(B.Parse(o))}q.beginAnimationOnStart=t.beginAnimationOnStart,q.beginAnimationFrom=t.beginAnimationFrom,q.beginAnimationTo=t.beginAnimationTo,q.beginAnimationLoop=t.beginAnimationLoop}if(t.autoAnimate&&z&&z.beginAnimation(q,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),q.startDelay=0|t.startDelay,q.minAngularSpeed=t.minAngularSpeed,q.maxAngularSpeed=t.maxAngularSpeed,q.minSize=t.minSize,q.maxSize=t.maxSize,t.minScaleX&&(q.minScaleX=t.minScaleX,q.maxScaleX=t.maxScaleX,q.minScaleY=t.minScaleY,q.maxScaleY=t.maxScaleY),void 0!==t.preWarmCycles&&(q.preWarmCycles=t.preWarmCycles,q.preWarmStepOffset=t.preWarmStepOffset),void 0!==t.minInitialRotation&&(q.minInitialRotation=t.minInitialRotation,q.maxInitialRotation=t.maxInitialRotation),q.minLifeTime=t.minLifeTime,q.maxLifeTime=t.maxLifeTime,q.minEmitPower=t.minEmitPower,q.maxEmitPower=t.maxEmitPower,q.emitRate=t.emitRate,q.gravity=o.o.ti(t.gravity),t.noiseStrength&&(q.noiseStrength=o.o.ti(t.noiseStrength)),q.color1=L.d.ti(t.color1),q.color2=L.d.ti(t.color2),q.colorDead=L.d.ti(t.colorDead),q.updateSpeed=t.updateSpeed,q.targetStopDuration=t.targetStopDuration,q.blendMode=t.blendMode,t.colorGradients)for(const o of t.colorGradients)q.addColorGradient(o.gradient,L.d.ti(o.color1),o.color2?L.d.ti(o.color2):void 0);if(t.rampGradients){for(const S of t.rampGradients)q.addRampGradient(S.gradient,L.c.ti(S.color));q.useRampGradients=t.useRampGradients}if(t.colorRemapGradients)for(const o of t.colorRemapGradients)q.addColorRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.alphaRemapGradients)for(const o of t.alphaRemapGradients)q.addAlphaRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.sizeGradients)for(const o of t.sizeGradients)q.addSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.angularSpeedGradients)for(const o of t.angularSpeedGradients)q.addAngularSpeedGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.velocityGradients)for(const o of t.velocityGradients)q.addVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.dragGradients)for(const o of t.dragGradients)q.addDragGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.emitRateGradients)for(const o of t.emitRateGradients)q.addEmitRateGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.startSizeGradients)for(const o of t.startSizeGradients)q.addStartSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.lifeTimeGradients)for(const o of t.lifeTimeGradients)q.addLifeTimeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(t.limitVelocityGradients){for(const S of t.limitVelocityGradients)q.addLimitVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);q.limitVelocityDamping=t.limitVelocityDamping}if(t.noiseTexture&&z){const S=(0,r.b)("BABYLON.ProceduralTexture");q.noiseTexture=S.Parse(t.noiseTexture,z,B)}let C;if(t.particleEmitterType){switch(t.particleEmitterType.type){case"SphereParticleEmitter":C=new v;break;case"SphereDirectedParticleEmitter":C=new M;break;case"ConeEmitter":case"ConeParticleEmitter":C=new O;break;case"ConeDirectedParticleEmitter":C=new i;break;case"CylinderParticleEmitter":C=new h;break;case"CylinderDirectedParticleEmitter":C=new l;break;case"HemisphericParticleEmitter":C=new I;break;case"PointParticleEmitter":C=new a;break;case"MeshParticleEmitter":C=new V;break;case"CustomParticleEmitter":C=new x;break;default:C=new b}C.parse(t.particleEmitterType,z)}else C=new b,C.parse(t,z);q.particleEmitterType=C,q.startSpriteCellID=t.startSpriteCellID,q.endSpriteCellID=t.endSpriteCellID,q.spriteCellLoop=t.spriteCellLoop??!0,q.spriteCellWidth=t.spriteCellWidth,q.spriteCellHeight=t.spriteCellHeight,q.spriteCellChangeSpeed=t.spriteCellChangeSpeed,q.spriteRandomStartCell=t.spriteRandomStartCell,q.disposeOnStop=t.disposeOnStop??!1,q.manualEmitCount=t.manualEmitCount??-1}static Parse(t,q,S){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const r=t.name;let e,C,Z=null,b=null;if(q instanceof Et.c?e=q:(C=q,e=C.getEngine()),t.customShader&&e.createEffectForParticles){b=t.customShader;const q=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"";Z=e.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,q)}const O=new rq(r,z||t.di,q,Z,t.isAnimationSheetEnabled);if(O.customShader=b,O._rootUrl=S,t.id&&(O.id=t.id),t.subEmitters){O.subEmitters=[];for(const o of t.subEmitters){const t=[];for(const B of o)t.push(wt.Parse(B,q,S));O.subEmitters.push(t)}}if(t.attractors)for(const L of t.attractors){const t=new Lq;t.position=o.o.ti(L.position),t.strength=L.strength,O.addAttractor(t)}return rq._Parse(t,O,q,S),t.textureMask&&(O.textureMask=L.d.ti(t.textureMask)),t.tg&&(O.tg=o.o.ti(t.tg)),t.preventAutoStart&&(O.preventAutoStart=t.preventAutoStart),B||O.preventAutoStart||O.start(),O}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};if(rq._Serialize(q,this,t),q.textureMask=this.textureMask.Gi(),q.customShader=this.customShader,q.preventAutoStart=this.preventAutoStart,q.tg=this.tg.Gi(),this.subEmitters){q.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const S of this._subEmitters){const o=[];for(const q of S)o.push(q.serialize(t));q.subEmitters.push(o)}}if(this._attractors&&this._attractors.length){q.attractors=[];for(const t of this._attractors)q.attractors.push(t.serialize())}return q}static _Serialize(t,q,S){if(t.name=q.name,t.id=q.id,t.di=q.getCapacity(),t.disposeOnStop=q.disposeOnStop,t.manualEmitCount=q.manualEmitCount,q.j.position){const S=q.j;t.emitterId=S.id}else{const S=q.j;t.j=S.Gi()}q.particleEmitterType&&(t.particleEmitterType=q.particleEmitterType.serialize()),q.particleTexture&&(S?t.texture=q.particleTexture.serialize():(t.textureName=q.particleTexture.name,t.invertY=!!q.particleTexture._invertY)),t.isLocal=q.isLocal,Y.b.AppendSerializedAnimations(q,t),t.beginAnimationOnStart=q.beginAnimationOnStart,t.beginAnimationFrom=q.beginAnimationFrom,t.beginAnimationTo=q.beginAnimationTo,t.beginAnimationLoop=q.beginAnimationLoop,t.startDelay=q.startDelay,t.renderingGroupId=q.renderingGroupId,t.isBillboardBased=q.isBillboardBased,t.billboardMode=q.billboardMode,t.minAngularSpeed=q.minAngularSpeed,t.maxAngularSpeed=q.maxAngularSpeed,t.minSize=q.minSize,t.maxSize=q.maxSize,t.minScaleX=q.minScaleX,t.maxScaleX=q.maxScaleX,t.minScaleY=q.minScaleY,t.maxScaleY=q.maxScaleY,t.minEmitPower=q.minEmitPower,t.maxEmitPower=q.maxEmitPower,t.minLifeTime=q.minLifeTime,t.maxLifeTime=q.maxLifeTime,t.emitRate=q.emitRate,t.gravity=q.gravity.Gi(),t.noiseStrength=q.noiseStrength.Gi(),t.color1=q.color1.Gi(),t.color2=q.color2.Gi(),t.colorDead=q.colorDead.Gi(),t.updateSpeed=q.updateSpeed,t.targetStopDuration=q.targetStopDuration,t.blendMode=q.blendMode,t.preWarmCycles=q.preWarmCycles,t.preWarmStepOffset=q.preWarmStepOffset,t.minInitialRotation=q.minInitialRotation,t.maxInitialRotation=q.maxInitialRotation,t.startSpriteCellID=q.startSpriteCellID,t.spriteCellLoop=q.spriteCellLoop,t.endSpriteCellID=q.endSpriteCellID,t.spriteCellChangeSpeed=q.spriteCellChangeSpeed,t.spriteCellWidth=q.spriteCellWidth,t.spriteCellHeight=q.spriteCellHeight,t.spriteRandomStartCell=q.spriteRandomStartCell,t.isAnimationSheetEnabled=q.isAnimationSheetEnabled,t.useLogarithmicDepth=q.useLogarithmicDepth;const o=q.getColorGradients();if(o){t.colorGradients=[];for(const q of o){const S={gradient:q.gradient,color1:q.color1.Gi()};q.color2?S.color2=q.color2.Gi():S.color2=q.color1.Gi(),t.colorGradients.push(S)}}const B=q.getRampGradients();if(B){t.rampGradients=[];for(const q of B){const S={gradient:q.gradient,color:q.color.Gi()};t.rampGradients.push(S)}t.useRampGradients=q.useRampGradients}const z=q.getColorRemapGradients();if(z){t.colorRemapGradients=[];for(const q of z){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.colorRemapGradients.push(S)}}const L=q.getAlphaRemapGradients();if(L){t.alphaRemapGradients=[];for(const q of L){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.alphaRemapGradients.push(S)}}const r=q.getSizeGradients();if(r){t.sizeGradients=[];for(const q of r){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.sizeGradients.push(S)}}const e=q.getAngularSpeedGradients();if(e){t.angularSpeedGradients=[];for(const q of e){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.angularSpeedGradients.push(S)}}const C=q.getVelocityGradients();if(C){t.velocityGradients=[];for(const q of C){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.velocityGradients.push(S)}}const Z=q.getDragGradients();if(Z){t.dragGradients=[];for(const q of Z){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.dragGradients.push(S)}}const b=q.getEmitRateGradients();if(b){t.emitRateGradients=[];for(const q of b){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.emitRateGradients.push(S)}}const O=q.getStartSizeGradients();if(O){t.startSizeGradients=[];for(const q of O){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.startSizeGradients.push(S)}}const i=q.getLifeTimeGradients();if(i){t.lifeTimeGradients=[];for(const q of i){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.lifeTimeGradients.push(S)}}const h=q.getLimitVelocityGradients();if(h){t.limitVelocityGradients=[];for(const q of h){const S={gradient:q.gradient,factor1:q.factor1};void 0!==q.factor2?S.factor2=q.factor2:S.factor2=q.factor1,t.limitVelocityGradients.push(S)}t.limitVelocityDamping=q.limitVelocityDamping}q.noiseTexture&&(t.noiseTexture=q.noiseTexture.serialize())}clone(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let B=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){B=this.customShader;const t=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"",q=z.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,t);o[0]?o[0].effect=q:this.setCustomEffect(q,0)}const L=this.serialize(S),r=rq.Parse(L,this._scene||this._engine,this._rootUrl);return r.name=t,r.customShader=B,r._customWrappers=o,void 0===q&&(q=this.j),this.noiseTexture&&(r.noiseTexture=this.noiseTexture.clone()),r.j=q,this.preventAutoStart||r.start(),r}}rq.BILLBOARDMODE_Y=2,rq.BILLBOARDMODE_ALL=7,rq.BILLBOARDMODE_STRETCHED=8,rq.BILLBOARDMODE_STRETCHED_LOCAL=9,wt._ParseParticleSystem=rq.Parse;var eq=S(2436),Cq=S(2428),Zq=S(2351);Zq.e.prototype.createTransformFeedback=function(){const t=this._gl.createTransformFeedback();if(!t)throw new Error("Unable to create Transform Feedback");return t},Zq.e.prototype.deleteTransformFeedback=function(t){this._gl.deleteTransformFeedback(t)},Zq.e.prototype.bindTransformFeedback=function(t){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,t)},Zq.e.prototype.beginTransformFeedback=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(t?this._gl.POINTS:this._gl.TRIANGLES)},Zq.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Zq.e.prototype.setTranformFeedbackVaryings=function(t,q){this._gl.transformFeedbackVaryings(t,q,this._gl.INTERLEAVED_ATTRIBS)},Zq.e.prototype.bindTransformFeedbackBuffer=function(t){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t?t.underlyingResource:null)},Zq.e.prototype.readTransformFeedbackBuffer=function(t){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t)};const bq="clipPlaneFragmentDeclaration2",Oq="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";U.e.IncludesShadersStore[bq]||(U.e.IncludesShadersStore[bq]=Oq);S(12547),S(12552),S(12556),S(12564),S(12568),S(12571),S(12575),S(12583);const iq="gpuRenderParticlesPixelShader",hq="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";U.e.ShadersStore[iq]||(U.e.ShadersStore[iq]=hq);const lq="clipPlaneVertexDeclaration2",Iq="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";U.e.IncludesShadersStore[lq]||(U.e.IncludesShadersStore[lq]=Iq);S(12587),S(12591),S(12596),S(12601);const aq="gpuRenderParticlesVertexShader",vq="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";U.e.ShadersStore[aq]||(U.e.ShadersStore[aq]=vq);class Mq extends e{static get IsSupported(){if(!d.b.LastCreatedEngine)return!1;const t=d.b.LastCreatedEngine.getCaps();return t.supportTransformFeedbacks||t.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(t){this._maxActiveParticleCount=Math.min(t,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(t){this.maxActiveParticleCount=t}createPointEmitter(t,q){const S=pt(t,q);return this.particleEmitterType=S,S}createHemisphericEmitter(){const t=Pt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=Ft(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=dt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=Rt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=tq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.o(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=qq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=Sq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.o(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,q,S,o){const B=new b;return this.particleEmitterType=B,this.direction1=t,this.direction2=q,this.minEmitBox=S,this.maxEmitBox=o,B}get flowMap(){return this._flowMap}set flowMap(t){this._flowMap!==t&&(this._flowMap=t)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==rq.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(rq.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(rq.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";t?setTimeout((()=>{this.start(0)}),t):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var t;let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[q])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[q]=new tt.e(this._engine),this._customWrappers[q].effect=t}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new P.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(t,q,S){return super._removeGradientAndTexture(t,q,S),this._releaseBuffers(),this}addColorGradient(t,q){this._colorGradients||(this._colorGradients=[]);const S=new T(t,q);return this._colorGradients.push(S),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(t&&this._colorGradients.sort(((t,q)=>t.gradient<q.gradient?-1:t.gradient>q.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(t){return this._removeGradientAndTexture(t,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const q in this._drawWrappers){var t;null===(t=this._drawWrappers[q].drawContext)||void 0===t||t.reset()}}_addFactorGradient(t,q,S){const o=new E(q,S);t.push(o),this._releaseBuffers()}addSizeGradient(t,q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,t,q),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(t){return this._removeGradientAndTexture(t,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(t,q){if(!t)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&t.sort(((t,q)=>t.gradient<q.gradient?-1:t.gradient>q.gradient?1:0));const S=this;S[q]&&(S[q].dispose(),S[q]=null)}addAngularSpeedGradient(t,q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,t,q),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(t){return this._removeGradientAndTexture(t,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(t,q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,t,q),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(t){return this._removeGradientAndTexture(t,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(t,q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,t,q),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(t){return this._removeGradientAndTexture(t,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(t,q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,t,q),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(t){return this._removeGradientAndTexture(t,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(t){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(t,q,S){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(t),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Qi=new P.b,this.onStoppedObservable=new P.b,this.onStartedObservable=new P.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,S&&"Scene"!==S.getClassName()?(this._engine=S,this.defaultProjectionMatrix=o.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=S||d.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.zi.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,r.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,r.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,r.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,r.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers={0:new tt.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(q=q??{}).randomTextureSize||delete q.randomTextureSize;const L={di:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...q},e=q;isFinite(e)&&(L.di=e),this._capacity=L.di,this._maxActiveParticleCount=L.di,this._currentActiveCount=0,this._isAnimationSheetEnabled=z,this.particleEmitterType=new b;const C=Math.min(this._engine.getCaps().maxTextureSize,L.randomTextureSize);let Z=[];for(let o=0;o<C;++o)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture=new F.d(new Float32Array(Z),C,1,5,S,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,Z=[];for(let o=0;o<C;++o)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture2=new F.d(new Float32Array(Z),C,1,5,S,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=C}_reset(){this._releaseBuffers()}_createVertexBuffers(t,q,S){const o={};o.position=q.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let B=3;o.age=q.createVertexBuffer("age",B,1,this._attributesStrideSize,!0),B+=1,o.size=q.createVertexBuffer("size",B,3,this._attributesStrideSize,!0),B+=3,o.life=q.createVertexBuffer("life",B,1,this._attributesStrideSize,!0),B+=1,B+=4,this.billboardMode===rq.BILLBOARDMODE_STRETCHED&&(o.direction=q.createVertexBuffer("direction",B,3,this._attributesStrideSize,!0)),B+=3,this._platform.alignDataInBuffer&&(B+=1),this.particleEmitterType instanceof x&&(B+=3,this._platform.alignDataInBuffer&&(B+=1)),this._colorGradientsTexture||(o.color=q.createVertexBuffer("color",B,4,this._attributesStrideSize,!0),B+=4),this._isBillboardBased||(o.initialDirection=q.createVertexBuffer("initialDirection",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),this.noiseTexture&&(o.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1),o.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),o.angle=q.createVertexBuffer("angle",B,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?B++:B+=2,this._isAnimationSheetEnabled&&(o.cellIndex=q.createVertexBuffer("cellIndex",B,1,this._attributesStrideSize,!0),B+=1,this.spriteRandomStartCell&&(o.cellStartOffset=q.createVertexBuffer("cellStartOffset",B,1,this._attributesStrideSize,!0),B+=1)),o.offset=S.createVertexBuffer("offset",0,2),o.uv=S.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(o),this._platform.createVertexBuffers(t,o),this.resetDrawCache()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!t)return;const q=this._engine,S=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof x&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const B=this.particleEmitterType instanceof x,z=o.j.wi[0];let L=0;for(let o=0;o<this._capacity;o++)if(S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),B?(this.particleEmitterType.particleDestinationGenerator(o,null,z),S.push(z.x),S.push(z.y),S.push(z.z)):(S.push(0),S.push(0),S.push(0)),this._platform.alignDataInBuffer&&S.push(0),L+=16,B&&(this.particleEmitterType.particlePositionGenerator(o,null,z),S.push(z.x),S.push(z.y),S.push(z.z),this._platform.alignDataInBuffer&&S.push(0),L+=4),this._colorGradientsTexture||(S.push(0),S.push(0),S.push(0),S.push(0),L+=4),this.isBillboardBased||(S.push(0),S.push(0),S.push(0),this._platform.alignDataInBuffer&&S.push(0),L+=4),this.noiseTexture&&(S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),this._platform.alignDataInBuffer&&S.push(0),S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),this._platform.alignDataInBuffer&&S.push(0),L+=8),S.push(0),L+=1,this._angularSpeedGradientsTexture||(S.push(0),L+=1),this._isAnimationSheetEnabled&&(S.push(0),L+=1,this.spriteRandomStartCell&&(S.push(0),L+=1)),this._platform.alignDataInBuffer){let t=3-(L+3&3);for(L+=t;t-- >0;)S.push(0)}const r=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),e=this._platform.createParticleBuffer(S),C=this._platform.createParticleBuffer(S);this._buffer0=new k.e(q,e,!1,this._attributesStrideSize),this._buffer1=new k.e(q,C,!1,this._attributesStrideSize),this._spriteBuffer=new k.e(q,r,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let t=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(t+="\n#define BILLBOARD"),this._colorGradientsTexture&&(t+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(t+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(t+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(t+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(t+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(t+="\n#define DRAGGRADIENTS"),this._flowMap&&(t+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(t+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(t+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(t+="\n#define NOISE"),this.isLocal&&(t+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===t||(this._cachedUpdateDefines=t,this._updateBuffer=this._platform.createUpdateBuffer(t)),this._platform.isUpdateBufferReady()}_getWrapper(t){const q=this._getCustomDrawWrapper(t);if(null!==q&&void 0!==q&&q.effect)return q;const S=[];this.fillDefines(S,t);let o=this._drawWrappers[t];o||(o=new tt.e(this._engine),o.drawContext&&(o.drawContext.useInstancing=!0),this._drawWrappers[t]=o);const B=S.join("\n");if(o.defines!==B){const t=[],q=[],S=[];this.fillUniformsAttributesAndSamplerNames(q,t,S),o.setEffect(this._engine.createEffect("gpuRenderParticles",t,q,S,B),B)}return o}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=[k.i.PositionKind,"age","life","size","angle"];return t||B.push(k.i.ColorKind),q&&B.push("cellIndex"),S||B.push("initialDirection"),o&&B.push("direction"),B.push("offset",k.i.UVKind),B}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["emitterWM","tg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,qt.c)(o),t&&o.push("sheetInfos"),q&&o.push("logarithmicDepthConstant"),S&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,qt.m)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Cq.d.FOGMODE_NONE&&t.push("#define FOG")),q===rq.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this.isLocal&&t.push("#define LOCAL"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case rq.BILLBOARDMODE_Y:t.push("#define BILLBOARDY");break;case rq.BILLBOARDMODE_STRETCHED:t.push("#define BILLBOARDSTRETCHED");break;case rq.BILLBOARDMODE_ALL:t.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&t.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),S&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,q,S){q.push(...Mq._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===rq.BILLBOARDMODE_STRETCHED)),t.push(...Mq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),S.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(eq.c.PrepareUniforms(t,this._imageProcessingConfigurationDefines),eq.c.PrepareSamplers(S,this._imageProcessingConfigurationDefines))}animate(){var t;let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(q?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(t,q){const S=this[q];if(!t||!t.length||S)return;const o=new Float32Array(this._rawTextureWidth);for(let B=0;B<this._rawTextureWidth;B++){const q=B/this._rawTextureWidth;p.GetCurrentGradient(q,t,((t,q,S)=>{o[B]=(0,C.Lerp)(t.factor1,q.factor1,S)}))}this[q]=F.d.CreateRTexture(o,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[q].name=q.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const t=new Uint8Array(4*this._rawTextureWidth),q=L.h.bj[0];for(let S=0;S<this._rawTextureWidth;S++){const o=S/this._rawTextureWidth;p.GetCurrentGradient(o,this._colorGradients,((o,B,z)=>{L.d.LerpToRef(o.color1,B.color1,z,q),t[4*S]=255*q.r,t[4*S+1]=255*q.g,t[4*S+2]=255*q.b,t[4*S+3]=255*q.a}))}this._colorGradientsTexture=F.d.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(t,q){var S,B,z,L;const r=this._getWrapper(t),e=r.effect;this._engine.enableEffect(r);const C=(null===(S=this._scene)||void 0===S?void 0:S.getViewMatrix())||o.e.IdentityReadOnly;if(e.setMatrix("view",C),e.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),e.setTexture("diffuseSampler",this.particleTexture),e.setVector2("translationPivot",this.translationPivot),e.setVector3("tg",this.tg),this.isLocal&&e.setMatrix("emitterWM",q),this._colorGradientsTexture?e.setTexture("colorGradientSampler",this._colorGradientsTexture):e.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();e.setFloat3("sheetInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,t.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;e.setVector3("eyePosition",t.globalPosition)}const Z=e.defines;if(this._scene&&((0,qt.f)(e,this,this._scene),this.applyFog&&(0,St.f)(this._scene,void 0,e)),Z.indexOf("#define BILLBOARDMODE_ALL")>=0){const t=C.clone();t.invert(),e.setMatrix("invView",t)}return this.useLogarithmicDepth&&this._scene&&(0,St.k)(Z,e,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(e),this._setEngineBasedOnBlendMode(t),this._platform.bindDrawBuffers(this._targetIndex,e,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(e),null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(t){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!t)if(this.j.position){t=this.j.getWorldMatrix()}else{const q=this.j;t=o.j.Matrix[0],o.e.TranslationToRef(q.x,q.y,q.z,t)}const q=this._engine,S=q.getDepthWrite();if(q.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const t=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",t.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",t),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const B=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=B,q.setDepthWrite(S)}render(){let t,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!q&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let t=0;t<this.preWarmCycles;t++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const t=0|this._accumulatedCount;this._accumulatedCount-=t,this._currentActiveCount+=t}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){t=this.j.getWorldMatrix()}else{const q=this.j;t=o.j.Matrix[0],o.e.TranslationToRef(q.x,q.y,q.z,t)}const B=this._engine;this.updateInAnimate||this._update(t);let z=0;return q||S||(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0),z=this.blendMode===rq.BLENDMODE_MULTIPLYADD?this._render(rq.BLENDMODE_MULTIPLY,t)+this._render(rq.BLENDMODE_ADD,t):this._render(this.blendMode,t),this._engine.setAlphaMode(0)),z}rebuild(){const t=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(t,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,t()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const q in this._drawWrappers){this._drawWrappers[q].dispose()}if(this._drawWrappers={},this._scene){const t=this._scene.zi.indexOf(this);t>-1&&this._scene.zi.splice(t,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let q=0;q<this._renderVertexBuffers.length;++q){const t=this._renderVertexBuffers[q];for(const q in t)t[q].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Qi.notifyObservers(this),this.Qi.clear()}clone(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let B=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){B=this.customShader;const t=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"";o[0]=z.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,t,void 0,void 0,void 0,this)}const L=this.serialize(S),r=Mq.Parse(L,this._scene||this._engine,this._rootUrl);return r.name=t,r.customShader=B,r._customWrappers=o,void 0===q&&(q=this.j),this.noiseTexture&&(r.noiseTexture=this.noiseTexture.clone()),r.j=q,r}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={};return rq._Serialize(q,this,t),q.activeParticleCount=this.activeParticleCount,q.randomTextureSize=this._randomTextureSize,q.customShader=this.customShader,q}static Parse(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const z=t.name;let L,r;q instanceof Et.c?L=q:(r=q,L=r.getEngine());const e=new Mq(z,{di:B||t.di,randomTextureSize:t.randomTextureSize},q,null,t.isAnimationSheetEnabled);if(e._rootUrl=S,t.customShader&&L.createEffectForParticles){const q=t.customShader,S=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",o=L.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,S,void 0,void 0,void 0,e);e.setCustomEffect(o,0),e.customShader=q}return t.id&&(e.id=t.id),t.activeParticleCount&&(e.activeParticleCount=t.activeParticleCount),rq._Parse(t,e,q,S),t.preventAutoStart&&(e.preventAutoStart=t.preventAutoStart),o||e.preventAutoStart||e.start(),e}}var xq=S(490),kq=S(12607),Vq=S(12011);class Jq{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(t){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const q of this.systems)q.j=t;this._emitterNode=t}setEmitterAsSphere(t,q,S){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:q};const o=(0,kq.e)("emitterSphere",{diameter:t.diameter,segments:t.segments},S);o.renderingGroupId=q;const B=new Vq.e("emitterSphereMaterial",S);B.emissiveColor=t.color,o.material=B;for(const z of this.systems)z.j=o;this._emitterNode=o}start(t){for(const q of this.systems)t&&(q.j=t),q.start()}dispose(){for(const t of this.systems)t.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q={systems:[]};for(const S of this.systems)q.systems.push(S.serialize(t));return this._emitterNode&&(q.j=this._emitterCreationOptions),q}static Parse(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;const B=new Jq,z=this.BaseAssetsUrl+"/textures/";q=q||d.b.LastCreatedScene;for(const L of t.systems)B.systems.push(S?Mq.Parse(L,q,z,!0,o):rq.Parse(L,q,z,!0,o));if(t.j){const S=t.j.options;if("Sphere"===t.j.kind)B.setEmitterAsSphere({diameter:S.diameter,segments:S.segments,color:L.c.ti(S.color)},t.j.renderingGroupId,q)}return B}}Jq.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Uq=S(520);class Hq{static CreateDefault(t){let q,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,o=arguments.length>2?arguments[2]:void 0;q=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Mq("default system",{di:S},o):new rq("default system",S,o),q.j=t;const B=xq.f.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return q.particleTexture=new n.b(B,q.va()),q.createConeEmitter(.1,Math.PI/4),q.color1=new L.d(1,1,1,1),q.color2=new L.d(1,1,1,1),q.colorDead=new L.d(1,1,1,0),q.minSize=.1,q.maxSize=.1,q.minEmitPower=2,q.maxEmitPower=2,q.updateSpeed=1/60,q.emitRate=30,q}static CreateAsync(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;q||(q=d.b.LastCreatedScene);const B={};return q.addPendingData(B),new Promise(((z,L)=>{if(S&&!Mq.IsSupported)return q.removePendingData(B),L("Particle system with GPU is not supported.");xq.f.LoadFile(`${Hq.BaseAssetsUrl}/systems/${t}.json`,(t=>{q.removePendingData(B);const L=JSON.parse(t.toString());return z(Jq.Parse(L,q,S,o))}),void 0,void 0,void 0,(()=>(q.removePendingData(B),L(`An error occurred with the creation of your particle system. Check if your type '${t}' exists.`))))}))}static ExportSet(t){const q=new Jq;for(const S of t)q.systems.push(S);return q}static ParseFromFileAsync(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",z=arguments.length>5?arguments[5]:void 0;return new Promise(((L,r)=>{const e=new Uq.e;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const q=JSON.parse(e.responseText);let r;r=o?Mq.Parse(q,S,B,!1,z):rq.Parse(q,S,B,!1,z),t&&(r.name=t),L(r)}else r("Unable to load the particle system")})),e.open("GET",q),e.send()}))}static ParseFromSnippetAsync(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0;if("_BLANK"===t){const t=this.CreateDefault(null);return t.start(),Promise.resolve(t)}return new Promise(((z,L)=>{const r=new Uq.e;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const L=JSON.parse(JSON.parse(r.responseText).jsonPayload),e=JSON.parse(L.particleSystem);let C;C=S?Mq.Parse(e,q,o,!1,B):rq.Parse(e,q,o,!1,B),C.snippetId=t,z(C)}else L("Unable to load the snippet "+t)})),r.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),r.send()}))}}Hq.BaseAssetsUrl=Jq.BaseAssetsUrl,Hq.SnippetUrl="https://snippet.babylonjs.com",Hq.CreateFromSnippetAsync=Hq.ParseFromSnippetAsync;var jq=S(483),yq=S(842),Qq=S(12611);(0,Qq.f)(yq.e.NAME_PARTICLESYSTEM,((t,q,S,o)=>{const B=(0,Qq.g)(yq.e.NAME_PARTICLESYSTEM);if(B&&void 0!==t.zi&&null!==t.zi)for(let z=0,L=t.zi.length;z<L;z++){const L=t.zi[z];S.zi.push(B(L,q,o))}})),(0,Qq.b)(yq.e.NAME_PARTICLESYSTEM,((t,q,S)=>{if(t.activeParticleCount){return Mq.Parse(t,q,S)}return rq.Parse(t,q,S)})),Et.c.prototype.createEffectForParticles=function(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,e=arguments.length>7?arguments[7]:void 0,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=arguments.length>9?arguments[9]:void 0,b=[],O=[];const i=[];return e?e.fillUniformsAttributesAndSamplerNames(O,b,i):(b=rq._GetAttributeNamesOrOptions(),O=rq._GetEffectCreationOptions()),-1===B.indexOf(" BILLBOARD")&&(B+="\n#define BILLBOARD\n"),null!==e&&void 0!==e&&e.isAnimationSheetEnabled&&-1===B.indexOf(" ANIMATESHEET")&&(B+="\n#define ANIMATESHEET\n"),-1===o.indexOf("diffuseSampler")&&o.push("diffuseSampler"),this.createEffect({vertex:Z??(null===e||void 0===e?void 0:e.vertexShaderName)??"particles",fragmentElement:t},b,O.concat(q),i.concat(o),B,z,L,r,void 0,C,(async()=>{0===C?await Promise.resolve().then(S.bind(S,12635)):await Promise.resolve().then(S.bind(S,12716))}))},jq.c.prototype.getEmittedParticleSystems=function(){const t=[];for(let q=0;q<this.va().zi.length;q++){const S=this.va().zi[q];S.j===this&&t.push(S)}return t},jq.c.prototype.getHierarchyEmittedParticleSystems=function(){const t=[],q=this.getDescendants();q.push(this);for(let S=0;S<this.va().zi.length;S++){const o=this.va().zi[S],B=o.j;B.position&&-1!==q.indexOf(B)&&t.push(o)}return t};S(752),S(760),S(791);S(732),S(846),S(812),S(738),S(836);S(2273);var Kq;S(12620),S(2311);!function(t){t[t.Color=2]="Color",t[t.UV=1]="UV",t[t.Random=0]="Random",t[t.Stated=3]="Stated"}(Kq||(Kq={}));var Xq=S(2300);const Gq=new o.o(0,0,0),Yq=new o.o(0,0,0),nq=new o.o(0,0,0);class uq{constructor(t,q,S){this.width=t,this.height=q,this.data=S}processFlowable(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2?arguments[2]:void 0;if(!S)return;S instanceof o.e?o.o.TransformCoordinatesToRef(t.position,S,nq):(nq.x=S.x,nq.y=S.y,nq.z=S.z);const B=.5*nq.x+.5,z=1-(.5*nq.y+.5),L=Math.floor(B*this.width),r=Math.floor(z*this.height);if(L<0||L>=this.width||r<0||r>=this.height)return;const e=4*(r*this.width+L),C=this.data[e]/255*2-1,Z=this.data[e+1]/255*2-1,b=this.data[e+2]/255*2-1,O=this.data[e+3]/255;Gq.set(C,Z,b),Gq.scaleToRef(q*O,Yq),t.direction.addInPlace(Yq)}_processParticle(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2?arguments[2]:void 0;this.processFlowable(t,q,S)}static async FromUrlAsync(t){return await new Promise(((q,S)=>{const o=document.createElement("canvas"),B=o.getContext("2d");let z=null;const L=new Image;L.crossOrigin="anonymous",L.src=t,L.onerror=q=>{S(new Error(`Failed to load image: ${t} : ${q}`))},L.onload=()=>{o.width=L.width,o.height=L.height,B.drawImage(L,0,0),z=B.getImageData(0,0,o.width,o.height),q(new uq(o.width,o.height,z.data))}}))}static async ExtractFromTextureAsync(t){return await new Promise(((q,S)=>{if(!t.isReady())return void t.onLoadObservable.addOnce((async()=>{try{const S=await this.ExtractFromTextureAsync(t);q(S)}catch(o){S(o)}}));const o=t.getSize();Xq.m.GetTextureDataAsync(t,o.width,o.height).then((t=>{q(new uq(o.width,o.height,new Uint8ClampedArray(t)))})).catch(S)}))}}var Wq,fq,Dq,mq,Aq,cq,sq,gq,Nq;!function(t){t[t.Int=1]="Int",t[t.Float=2]="Float",t[t.Vector2=4]="Vector2",t[t.wi=8]="wi",t[t.Matrix=16]="Matrix",t[t.Particle=32]="Particle",t[t.Texture=64]="Texture",t[t.bj=128]="bj",t[t.FloatGradient=256]="FloatGradient",t[t.Vector2Gradient=512]="Vector2Gradient",t[t.Vector3Gradient=1024]="Vector3Gradient",t[t.Color4Gradient=2048]="Color4Gradient",t[t.System=4096]="System",t[t.AutoDetect=8192]="AutoDetect",t[t.BasedOnInput=16384]="BasedOnInput",t[t.Undefined=32768]="Undefined",t[t.All=65535]="All"}(Wq||(Wq={})),function(t){t[t.Compatible=0]="Compatible",t[t.TypeIncompatible=1]="TypeIncompatible",t[t.HierarchyIssue=2]="HierarchyIssue"}(fq||(fq={})),function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(Dq||(Dq={}));class Tq{get direction(){return this._direction}get type(){if(this._type===Wq.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Wq.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(t){this._type=t}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((t=>t.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(t,q,S){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Wq.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new P.b,this.onDisconnectionObservable=new P.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=q,this.name=t,this._direction=S}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(t){var q;return this.isConnected?null!==(q=this._connectedPoint)&&void 0!==q&&q._storedFunction?this._connectedPoint._storedFunction(t):this._connectedPoint._storedValue:this.value}canConnectTo(t){return 0===this.checkCompatibilityState(t)}checkCompatibilityState(t){const q=this._ownerBlock,S=t.ownerBlock;if(this.type!==t.type&&t.innerType!==Wq.AutoDetect)return t.acceptedConnectionPointTypes&&-1!==t.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(t.excludedConnectionPointTypes&&-1!==t.excludedConnectionPointTypes.indexOf(this.type))return 1;let o=S,B=q;return 0===this.direction&&(o=q,B=S),o.isAnAncestorOf(B)?2:0}connectTo(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(t))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${t.ownerBlock.name}".${t.name}`;return this._endpoints.push(t),t._connectedPoint=this,this.onConnectionObservable.notifyObservers(t),t.onConnectionObservable.notifyObservers(this),this}disconnectFrom(t){const q=this._endpoints.indexOf(t);return-1===q||(this._endpoints.splice(q,1),t._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(t),t.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(t){let q=1;for(;q<Wq.All;)t&q||this.excludedConnectionPointTypes.push(q),q<<=1}serialize(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const q={};return q.name=this.name,q.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Gi?(q.valueType="BABYLON."+this.value.getClassName(),q.value=this.value.Gi()):(q.valueType="number",q.value=this.value)),t&&this.connectedPoint&&(q.inputName=this.name,q.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,q.targetConnectionName=this.connectedPoint.name,q.isExposedOnFrame=!0,q.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(q.isExposedOnFrame=!0,q.exposedPortPosition=this.exposedPortPosition),q}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class wq{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(t){this._name=t}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(t){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new P.b,this.Qi=new P.b,this.onInputChangedObservable=new P.b,this.visibleOnFrame=!1,this._name=t,this.uniqueId=u.b.UniqueId}_inputRename(t){return t}_outputRename(t){return t}isAnAncestorOf(t){for(const q of this._outputs)if(q.hasEndpoints)for(const S of q.endpoints){if(S.ownerBlock===t)return!0;if(S.ownerBlock.isAnAncestorOf(t))return!0}return!1}isAnAncestorOfType(t){if(this.getClassName()===t)return!0;for(const q of this._outputs)if(q.hasEndpoints)for(const S of q.endpoints)if(S.ownerBlock.isAnAncestorOfType(t))return!0;return!1}getInputByName(t){const q=this._inputs.filter((q=>q.name===t));return q.length?q[0]:null}_linkConnectionTypes(t,q){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[q]._acceptedConnectionPointType=this._inputs[t]:(this._inputs[t]._linkedConnectionSource=this._inputs[q],this._inputs[t]._isMainLinkSource=!0),this._inputs[q]._linkedConnectionSource=this._inputs[t]}registerInput(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;const L=new Tq(t,this,0);return L.type=q,L.isOptional=S,L.defaultValue=o,L.value=o,L.valueMin=B,L.valueMax=z,this._inputs.push(L),this.onInputChangedObservable.notifyObservers(L),this}registerOutput(t,q,S){return(S=S??new Tq(t,this,1)).type=q,this._outputs.push(S),this}_build(t){}_customBuildStep(t){}build(t){if(this._buildId===t.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((t=>t.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=t.buildId;for(const q of this._inputs){if(!q.connectedPoint){q.isOptional||t.notConnectedNonOptionalInputs.push(q);continue}const S=q.connectedPoint.ownerBlock;S&&S!==this&&!S.isSystem&&S.build(t)}return this._customBuildStep(t),t.verbose&&W.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(t),this.onBuildObservable.notifyObservers(this),!1}serialize(){const t={};t.customType="BABYLON."+this.getClassName(),t.id=this.uniqueId,t.name=this.name,t.visibleOnFrame=this.visibleOnFrame,t.inputs=[],t.outputs=[];for(const q of this.inputs)t.inputs.push(q.serialize());for(const q of this.outputs)t.outputs.push(q.serialize(!1));return t}_deserialize(t){this._name=t.name,this.comments=t.comments,this.visibleOnFrame=!!t.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(t)}_deserializePortDisplayNamesAndExposedOnFrame(t){const q=t.inputs,S=t.outputs;if(q)for(const o of q){const t=this.inputs.find((t=>t.name===o.name));if(!t)return;if(o.displayName&&(t.displayName=o.displayName),o.isExposedOnFrame&&(t.isExposedOnFrame=o.isExposedOnFrame,t.exposedPortPosition=o.exposedPortPosition),void 0!==o.value&&null!==o.value)if("number"===o.valueType)t.value=o.value;else{const q=(0,r.b)(o.valueType);q&&(t.value=q.ti(o.value))}}if(S)for(let o=0;o<S.length;o++){const t=S[o];t.displayName&&(this.outputs[o].displayName=t.displayName),t.isExposedOnFrame&&(this.outputs[o].isExposedOnFrame=t.isExposedOnFrame,this.outputs[o].exposedPortPosition=t.exposedPortPosition)}}clone(){const t=this.serialize(),q=(0,r.b)(t.customType);if(q){const S=new q;return S._deserialize(t),S}return null}dispose(){this.Qi.notifyObservers(this),this.Qi.clear();for(const t of this.inputs)t.dispose();for(const t of this.outputs)t.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Eq(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",o=arguments.length>3?arguments[3]:void 0;return(B,z)=>{let L=B._propStore;L||(L=[],B._propStore=L),L.push({propertyName:z,displayName:t,type:q,groupName:S,options:o??{},className:B.getClassName()})}}(0,X.e)([(0,G.C)("comment")],wq.prototype,"comments",void 0),function(t){t[t.Boolean=0]="Boolean",t[t.Float=1]="Float",t[t.Int=2]="Int",t[t.Vector2=3]="Vector2",t[t.List=4]="List",t[t.bj=5]="bj",t[t.SamplingMode=6]="SamplingMode",t[t.TextureFormat=7]="TextureFormat",t[t.TextureType=8]="TextureType"}(mq||(mq={})),function(t){t[t.None=0]="None",t[t.Position=1]="Position",t[t.Direction=2]="Direction",t[t.Age=3]="Age",t[t.Lifetime=4]="Lifetime",t[t.Color=5]="Color",t[t.ScaledDirection=6]="ScaledDirection",t[t.Scale=7]="Scale",t[t.AgeGradient=8]="AgeGradient",t[t.Angle=9]="Angle",t[t.SpriteCellIndex=16]="SpriteCellIndex",t[t.SpriteCellStart=17]="SpriteCellStart",t[t.SpriteCellEnd=18]="SpriteCellEnd"}(Aq||(Aq={})),function(t){t[t.None=0]="None",t[t.Time=1]="Time",t[t.Delta=2]="Delta",t[t.Emitter=3]="Emitter"}(cq||(cq={}));class pq{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let t="";for(const q of this.notConnectedNonOptionalInputs)t+=`input ${q.name} from block ${q.ownerBlock.name}[${q.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(t)throw"Build of Node Particle System Set failed:\n"+t}adapt(t,q){const S=t.getConnectedValue(this)||0;if(t.type===q)return S;switch(q){case Wq.Vector2:return new o.l(S,S);case Wq.wi:return new o.o(S,S,S);case Wq.bj:return new L.d(S,S,S,S)}return null}getContextualValue(t){if(!this.particleContext||!this.systemContext)return null;switch(t){case Aq.Position:return this.particleContext.position;case Aq.Direction:return this.particleContext.direction;case Aq.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Aq.Color:return this.particleContext.color;case Aq.Age:return this.particleContext.age;case Aq.Lifetime:return this.particleContext.lifeTime;case Aq.Angle:return this.particleContext.angle;case Aq.Scale:return this.particleContext.scale;case Aq.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Aq.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Aq.SpriteCellIndex:return this.particleContext.cellIndex;case Aq.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(t){if(!this.particleContext||!this.systemContext)return null;switch(t){case cq.Time:return this.systemContext._actualFrame;case cq.Delta:return this.systemContext._scaledUpdateSpeed;case cq.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function Pq(t,q,S){const o=new pq;o.Tk=q;const B=t.createSystem(o);return B.canStart=()=>!0,B.j=S.clone(),B.disposeOnStop=!0,B.start(),B}class Fq extends wq{constructor(t){super(t),this.blendMode=e.BLENDMODE_ONEONE,this.di=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Wq.Particle),this.registerInput("texture",Wq.Texture),this.registerInput("onStart",Wq.System,!0),this.registerInput("onEnd",Wq.System,!0),this.registerOutput("system",Wq.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(t){t.di=this.di,t.buildId=this._buildId++,this.build(t);const q=this.particle.getConnectedValue(t);return q.particleTexture=this.texture.getConnectedValue(t),q.emitRate=this.emitRate,q.blendMode=this.blendMode,q.name=this.name,q._nodeGenerated=!0,q._targetStopDuration=this.targetStopDuration,q.startDelay=this.startDelay,this.system._storedValue=this,q.canStart=()=>!this.doNoStart,q.onStartedObservable.add((S=>{const o=this.onStart.getConnectedValue(t);o&&S.onStartedObservable.addOnce((()=>{t.systemContext=q;const S=Pq(o,t.Tk,t.emitterPosition);this.Qi.addOnce((()=>{S.dispose()}))}));const B=this.onEnd.getConnectedValue(t);B&&S.onStoppedObservable.addOnce((()=>{t.systemContext=q;const S=Pq(B,t.Tk,t.emitterPosition);this.Qi.addOnce((()=>{S.dispose()}))}))})),this.Qi.addOnce((()=>{q.dispose()})),q}serialize(){const t=super.serialize();return t.di=this.di,t.emitRate=this.emitRate,t.blendMode=this.blendMode,t.doNoStart=this.doNoStart,t.targetStopDuration=this.targetStopDuration,t.startDelay=this.startDelay,t}_deserialize(t){super._deserialize(t),this.di=t.di,this.emitRate=t.emitRate,this.doNoStart=!!t.doNoStart,void 0!==t.blendMode&&(this.blendMode=t.blendMode),void 0!==t.targetStopDuration&&(this.targetStopDuration=t.targetStopDuration),void 0!==t.startDelay&&(this.startDelay=t.startDelay)}}(0,X.e)([Eq("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:e.BLENDMODE_ONEONE},{label:"Standard",value:e.BLENDMODE_STANDARD},{label:"Add",value:e.BLENDMODE_ADD},{label:"Multiply",value:e.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:e.BLENDMODE_MULTIPLYADD}]})],Fq.prototype,"blendMode",void 0),(0,X.e)([Eq("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Fq.prototype,"di",void 0),(0,X.e)([Eq("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fq.prototype,"emitRate",void 0),(0,X.e)([Eq("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fq.prototype,"targetStopDuration",void 0),(0,X.e)([Eq("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fq.prototype,"startDelay",void 0),(0,X.e)([Eq("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Fq.prototype,"doNoStart",void 0),(0,r.c)("BABYLON.SystemBlock",Fq);class dq extends wq{get type(){if(this._type===Wq.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Wq.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Wq.Vector2,this._type;case"wi":return this._type=Wq.wi,this._type;case"bj":return this._type=Wq.bj,this._type;case"Matrix":return this._type=Wq.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Aq.None&&this._systemSource!==cq.None}get systemSource(){return this._systemSource}set systemSource(t){if(this._systemSource=t,t!==cq.None){switch(this._contextualSource=Aq.None,this._type=Wq.Float,t){case cq.Time:case cq.Delta:this._type=Wq.Float;break;case cq.Emitter:this._type=Wq.wi}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Aq.None}get contextualValue(){return this._contextualSource}set contextualValue(t){if(this._contextualSource=t,t!==Aq.None){switch(this._systemSource=cq.None,t){case Aq.Scale:this._type=Wq.Vector2;break;case Aq.Position:case Aq.Direction:case Aq.ScaledDirection:this._type=Wq.wi;break;case Aq.Color:this._type=Wq.bj;break;case Aq.Age:case Aq.Lifetime:case Aq.Angle:case Aq.AgeGradient:this._type=Wq.Float;break;case Aq.SpriteCellEnd:case Aq.SpriteCellStart:case Aq.SpriteCellIndex:this._type=Wq.Int}this.output&&(this.output.type=this._type)}}constructor(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wq.AutoDetect;super(t),this._type=Wq.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new P.b,this._systemSource=cq.None,this._contextualSource=Aq.None,this._type=q,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",q)}get value(){return this._storedValue}set value(t){this.type===Wq.Float&&this.min!==this.max&&(t=Math.max(this.min,t),t=Math.min(this.max,t)),this._storedValue=t,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(t){this._valueCallback=t}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Wq.Int:case Wq.Float:this.value=0;break;case Wq.Vector2:this.value=o.l.Zero();break;case Wq.wi:this.value=o.o.Zero();break;case Wq.bj:this.value=new L.d(1,1,1,1);break;case Wq.Matrix:this.value=o.e.Identity()}}_build(t){super._build(t),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=t=>t.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=t=>t.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const t=super.serialize();return t.type=this.type,t.contextualValue=this.contextualValue,t.systemSource=this.systemSource,t.min=this.min,t.max=this.max,t.groupInInspector=this.groupInInspector,t.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Gi?(t.valueType="BABYLON."+this._storedValue.getClassName(),t.value=this._storedValue.Gi()):(t.valueType="number",t.value=this._storedValue)),t}_deserialize(t){if(super._deserialize(t),this._type=t.type,this.contextualValue=t.contextualValue,this.systemSource=t.systemSource||cq.None,this.min=t.min||0,this.max=t.max||0,this.groupInInspector=t.groupInInspector||"",void 0!==t.displayInInspector&&(this.displayInInspector=t.displayInInspector),t.valueType)if("number"===t.valueType)this._storedValue=t.value;else{const q=(0,r.b)(t.valueType);q&&(this._storedValue=q.ti(t.value))}}}(0,r.c)("BABYLON.ParticleInputBlock",dq);class Rq extends wq{get url(){return this._url}set url(t){this._url!==t&&(this._cachedData=null,this._url=t,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(t){this._textureDataUrl!==t&&(this._cachedData=null,this._textureDataUrl=t,this._url="",this._sourceTexture=null)}set sourceTexture(t){this._sourceTexture!==t&&(this._cachedData=null,this._sourceTexture=t,this._url="",this._textureDataUrl="")}constructor(t){super(t),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Wq.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const t=this.texture._storedValue;return await new Promise(((q,S)=>{if(!t.isReady())return void t.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),q(this._cachedData)}catch(t){S(t)}}));const o=t.getSize();Xq.m.GetTextureDataAsync(t,o.width,o.height).then((S=>{this._cachedData={width:o.width,height:o.height,data:new Uint8ClampedArray(S)},t.dispose(),q(this._cachedData)})).catch(S)}))}_build(t){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.b(this._textureDataUrl,t.Tk):this.texture._storedValue=new n.b(this._url,t.Tk):this.texture._storedValue=null}serialize(){const t=super.serialize();return t.url=this.url,t.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(t.textureDataUrl=this.textureDataUrl),t}_deserialize(t){super._deserialize(t),this.url=t.url,this.serializedCachedData=!!t.serializedCachedData,t.textureDataUrl&&(this.textureDataUrl=t.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,r.c)("BABYLON.ParticleTextureSourceBlock",Rq);class tS extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("position",Wq.wi),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(t){const q=this.particle.getConnectedValue(t);if(this.output._storedValue=q,!this.position.isConnected)return;const S={process:S=>{t.particleContext=S,t.systemContext=q,S.position.p(this.position.getConnectedValue(t))},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S}}(0,r.c)("BABYLON.UpdatePositionBlock",tS),function(t){t[t.Add=0]="Add",t[t.Subtract=1]="Subtract",t[t.Multiply=2]="Multiply",t[t.Divide=3]="Divide",t[t.Max=4]="Max",t[t.Min=5]="Min"}(sq||(sq={}));class qS extends wq{constructor(t){super(t),this.operation=sq.Add,this.registerInput("left",Wq.AutoDetect),this.registerInput("right",Wq.AutoDetect),this.registerOutput("output",Wq.BasedOnInput),this.output._typeConnectionSource=this.left;const q=[Wq.Matrix,Wq.Particle,Wq.Texture,Wq.System,Wq.FloatGradient,Wq.Color4Gradient,Wq.Vector2Gradient,Wq.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...q),this.right.excludedConnectionPointTypes.push(...q),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(t){let q;const S=this.left,B=this.right;if(!S.isConnected||!B.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const z=S.type===Wq.Float||S.type===Wq.Int,r=B.type===Wq.Float||B.type===Wq.Int,e=z&&r;switch(this.operation){case sq.Add:q=e?t=>S.getConnectedValue(t)+B.getConnectedValue(t):z?t=>t.adapt(S,B.type).add(B.getConnectedValue(t)):t=>S.getConnectedValue(t).add(t.adapt(B,S.type));break;case sq.Subtract:q=e?t=>S.getConnectedValue(t)-B.getConnectedValue(t):z?t=>t.adapt(S,B.type).Kg(B.getConnectedValue(t)):t=>S.getConnectedValue(t).Kg(t.adapt(B,S.type));break;case sq.Multiply:q=e?t=>S.getConnectedValue(t)*B.getConnectedValue(t):z?t=>t.adapt(S,B.type).multiply(B.getConnectedValue(t)):t=>S.getConnectedValue(t).multiply(t.adapt(B,S.type));break;case sq.Divide:q=e?t=>S.getConnectedValue(t)/B.getConnectedValue(t):z?t=>t.adapt(S,B.type).divide(B.getConnectedValue(t)):t=>S.getConnectedValue(t).divide(t.adapt(B,S.type));break;case sq.Min:if(e)q=t=>Math.min(S.getConnectedValue(t),B.getConnectedValue(t));else{const[t,r]=z?[B,S]:[S,B];switch(t.type){case Wq.Vector2:q=q=>o.l.Minimize(t.getConnectedValue(q),q.adapt(r,t.type));break;case Wq.wi:q=q=>o.o.Minimize(t.getConnectedValue(q),q.adapt(r,t.type));break;case Wq.bj:q=q=>{const S=t.getConnectedValue(q),{r:o,g:B,b:z,a:e}=q.adapt(r,t.type);return new L.d(Math.min(S.r,o),Math.min(S.g,B),Math.min(S.b,z),Math.min(S.a,e))}}}break;case sq.Max:if(!e){const[t,r]=z?[B,S]:[S,B];switch(t.type){case Wq.Vector2:q=q=>o.l.Maximize(t.getConnectedValue(q),q.adapt(r,t.type));break;case Wq.wi:q=q=>o.o.Maximize(t.getConnectedValue(q),q.adapt(r,t.type));break;case Wq.bj:q=q=>{const S=t.getConnectedValue(q),{r:o,g:B,b:z,a:e}=q.adapt(r,t.type);return new L.d(Math.max(S.r,o),Math.min(S.g,B),Math.min(S.b,z),Math.min(S.a,e))}}break}q=t=>Math.max(S.getConnectedValue(t),B.getConnectedValue(t))}this.output._storedFunction=t=>S.type===Wq.Int?0|q(t):q(t)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Wq.Int||this.left.type===Wq.Float&&this.right.type!==Wq.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[t,q]of[[this.left,this.right],[this.right,this.left]])t.acceptedConnectionPointTypes=[Wq.Int,Wq.Float],q.isConnected&&(t.acceptedConnectionPointTypes.push(q.type),q.type!==Wq.Int&&q.type!==Wq.Float||t.acceptedConnectionPointTypes.push(Wq.Vector2,Wq.wi,Wq.bj))}dispose(){super.dispose();for(const t of this._connectionObservers)t.remove();this._connectionObservers.length=0}serialize(){const t=super.serialize();return t.operation=this.operation,t}_deserialize(t){super._deserialize(t),this.operation=t.operation}}(0,X.e)([Eq("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:sq.Add},{label:"Subtract",value:sq.Subtract},{label:"Multiply",value:sq.Multiply},{label:"Divide",value:sq.Divide},{label:"Max",value:sq.Max},{label:"Min",value:sq.Min}]})],qS.prototype,"operation",void 0),(0,r.c)("BABYLON.ParticleMathBlock",qS);class SS extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("direction1",Wq.wi,!0,new o.o(0,1,0)),this.registerInput("direction2",Wq.wi,!0,new o.o(0,1,0)),this.registerInput("minEmitBox",Wq.wi,!0,new o.o(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Wq.wi,!0,new o.o(.5,.5,.5)),this.registerOutput("output",Wq.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(t){const q=this.particle.getConnectedValue(t);q._directionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.direction1.getConnectedValue(t),z=this.direction2.getConnectedValue(t),L=(0,C.RandomRange)(B.x,z.x),r=(0,C.RandomRange)(B.y,z.y),e=(0,C.RandomRange)(B.z,z.z);t.isEmitterTransformNode?o.o.TransformNormalFromFloatsToRef(L,r,e,t.emitterWorldMatrix,S.direction):S.direction.ni(L,r,e)},q._positionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.minEmitBox.getConnectedValue(t),z=this.maxEmitBox.getConnectedValue(t),L=(0,C.RandomRange)(B.x,z.x),r=(0,C.RandomRange)(B.y,z.y),e=(0,C.RandomRange)(B.z,z.z);t.isEmitterTransformNode?o.o.TransformCoordinatesFromFloatsToRef(L,r,e,t.emitterWorldMatrix,S.position):(S.position.ni(L,r,e),S.position.addInPlace(t.emitterPosition))},this.output._storedValue=q}}(0,r.c)("BABYLON.BoxShapeBlock",SS);class oS extends wq{constructor(t){super(t),this.registerInput("emitPower",Wq.Float,!0,1),this.registerInput("lifeTime",Wq.Float,!0,1),this.registerInput("color",Wq.bj,!0,new L.d(1,1,1,1)),this.registerInput("scale",Wq.Vector2,!0,new o.l(1,1)),this.registerInput("angle",Wq.Float,!0,0),this.registerOutput("particle",Wq.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(t){const q=new rq(this.name,t.di,t.Tk,null,!1,void 0,!0);q.particleEmitterType=new a,q._lifeTimeCreation.process=(q,S)=>{t.particleContext=q,q.lifeTime=this.lifeTime.getConnectedValue(t),S._emitPower=this.emitPower.getConnectedValue(t)},q._colorCreation.process=q=>{t.particleContext=q,q.color.p(this.color.getConnectedValue(t))},q._sizeCreation.process=q=>{t.particleContext=q,q.size=1,q.scale.p(this.scale.getConnectedValue(t))},q._angleCreation.process=q=>{t.particleContext=q,q.angle=this.angle.getConnectedValue(t)},this.particle._storedValue=q}}(0,r.c)("BABYLON.CreateParticleBlock",oS);class BS{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const t=[];for(const q of this.attachedBlocks)q.isInput&&t.push(q);return t}constructor(t){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new P.b,this.name=t}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(t){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(t)&&this.attachedBlocks.push(t);for(const S of t.inputs){const o=S.connectedPoint;if(o){const S=o.ownerBlock;S!==t&&this._initializeBlock(S,q)}}}async buildAsync(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((S=>{const o=new Jq;for(const t of this._systemBlocks)this._initializeBlock(t);for(const B of this.systemBlocks){const S=new pq;S.buildId=this._buildId++,S.Tk=t,S.verbose=q;const z=B.createSystem(S);S.emitErrors(),o.systems.push(z)}this.onBuildObservable.notifyObservers(this),S(o)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const t=new Fq("Particle system"),q=new tS("Update position");q.output.connectTo(t.particle);const S=new dq("Position");S.contextualValue=Aq.Position;const o=new dq("Scaled direction");o.contextualValue=Aq.ScaledDirection;const B=new qS("Add");B.operation=sq.Add,S.output.connectTo(B.left),o.output.connectTo(B.right),B.output.connectTo(q.position);const z=new oS("Create particle"),L=new SS("Box shape");z.particle.connectTo(L.particle),L.output.connectTo(q.particle);const r=new Rq("Texture");r.texture.connectTo(t.texture),r.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(t)}removeBlock(t){const q=this.attachedBlocks.indexOf(t);if(q>-1&&this.attachedBlocks.splice(q,1),t.isSystem){const q=this._systemBlocks.indexOf(t);q>-1&&this._systemBlocks.splice(q,1)}}parseSerializedObject(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q||this.clear();const S={};for(const o of t.Xk){const t=(0,r.b)(o.customType);if(t){const q=new t;q._deserialize(o),S[o.id]=q,this.attachedBlocks.push(q),q.isSystem&&this._systemBlocks.push(q)}}for(const o of this.attachedBlocks)if(o.isTeleportOut){const t=o,q=t._tempEntryPointUniqueId;if(q){const o=S[q];o&&o.attachToEndpoint(t)}}for(let o=0;o<t.Xk.length;o++){const B=t.Xk[o],z=S[B.id];z&&(z.inputs.length&&B.inputs.some((t=>t.targetConnectionName))&&!q||this._restoreConnections(z,t,S))}if(t.locations||t.editorData&&t.editorData.locations){const o=t.locations||t.editorData.locations;for(const t of o)S[t.blockId]&&(t.blockId=S[t.blockId].uniqueId);q&&this.editorData&&this.editorData.locations&&o.concat(this.editorData.locations),t.locations?this.editorData={locations:o}:(this.editorData=t.editorData,this.editorData.locations=o);const B=[];for(const t in S)B[t]=S[t].uniqueId;this.editorData.map=B}this.comment=t.comment}_restoreConnections(t,q,S){for(const o of t.outputs)for(const B of q.Xk){const z=S[B.id];if(z)for(const L of B.inputs)if(S[L.targetBlockId]!==t||L.targetConnectionName!==o.name);else{const t=z.getInputByName(L.inputName);if(!t||t.isConnected)continue;o.connectTo(t,!0),this._restoreConnections(z,q,S)}}}serialize(t){const q=t?{}:Y.b.Serialize(this);q.editorData=JSON.parse(JSON.stringify(this.editorData));let S=[];t?S=t:q.customType="BABYLON.NodeParticleSystemSet",q.Xk=[];for(const o of S)q.Xk.push(o.serialize());if(!t)for(const o of this.attachedBlocks)-1===S.indexOf(o)&&q.Xk.push(o.serialize());return q}dispose(){for(const t of this.attachedBlocks)t.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(t){const q=new BS(t);return q.setToDefault(),q}static Parse(t){const q=Y.b.Parse((()=>new BS(t.name)),t,null);return q.parseSerializedObject(t),q}static ParseFromSnippetAsync(t,q){return"_BLANK"===t?Promise.resolve(BS.CreateDefault("blank")):new Promise(((S,o)=>{const B=new Uq.e;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const L=JSON.parse(JSON.parse(B.responseText).jsonPayload),r=JSON.parse(L.nodeParticle);q||(q=Y.b.Parse((()=>new BS(t)),r,null)),q.parseSerializedObject(r),q.snippetId=t;try{S(q)}catch(z){o(z)}}else o("Unable to load the snippet "+t)})),B.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),B.send()}))}}BS.EditorURL=`${xq.f._DefaultCdnUrl}/v${Et.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,BS.SnippetUrl="https://snippet.babylonjs.com",(0,X.e)([(0,G.C)()],BS.prototype,"name",void 0),(0,X.e)([(0,G.C)("comment")],BS.prototype,"comment",void 0),function(t){t[t.None=0]="None",t[t.PerParticle=1]="PerParticle",t[t.PerSystem=2]="PerSystem"}(gq||(gq={}));class zS extends wq{constructor(t){super(t),this._currentLockId=-2,this.lockMode=gq.PerParticle,this.registerInput("min",Wq.AutoDetect,!0,0),this.registerInput("max",Wq.AutoDetect,!0,1),this.registerOutput("output",Wq.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Wq.Float|Wq.Int|Wq.Vector2|Wq.wi|Wq.bj),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Wq.Float|Wq.Int|Wq.Vector2|Wq.wi|Wq.bj),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Wq.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let t=null;switch(this._currentLockId=-2,this.min.type){case Wq.AutoDetect:case Wq.Int:case Wq.Float:t=t=>{const q=this.min.getConnectedValue(t)||0,S=this.max.getConnectedValue(t)||1;return q+Math.random()*(S-q)};break;case Wq.Vector2:t=t=>{const q=this.min.getConnectedValue(t)||o.l.Zero(),S=this.max.getConnectedValue(t)||o.l.One();return new o.l(q.x+Math.random()*(S.x-q.x),q.y+Math.random()*(S.y-q.y))};break;case Wq.wi:t=t=>{const q=this.min.getConnectedValue(t)||o.o.Zero(),S=this.max.getConnectedValue(t)||o.o.One();return new o.o(q.x+Math.random()*(S.x-q.x),q.y+Math.random()*(S.y-q.y),q.z+Math.random()*(S.z-q.z))};break;case Wq.bj:t=t=>{const q=this.min.getConnectedValue(t)||new L.d(0,0,0,0),S=this.max.getConnectedValue(t)||new L.d(1,1,1,1);return new L.d(q.x+Math.random()*(S.x-q.x),q.y+Math.random()*(S.y-q.y),q.z+Math.random()*(S.z-q.z),q.w+Math.random()*(S.w-q.w))}}this.output._storedFunction=q=>{var S;let o=0;switch(this.lockMode){case gq.PerParticle:o=(null===(S=q.particleContext)||void 0===S?void 0:S.id)||-1;break;case gq.PerSystem:o=q.buildId||0}return this._currentLockId!==o&&(this.lockMode!==gq.None&&(this._currentLockId=o),this.output._storedValue=t(q)),this.output._storedValue}}serialize(){const t=super.serialize();return t.lockMode=this.lockMode,t}_deserialize(t){super._deserialize(t),this.lockMode=t.lockMode}}(0,X.e)([Eq("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:gq.None},{label:"Per particle",value:gq.PerParticle},{label:"Per system",value:gq.PerSystem}]})],zS.prototype,"lockMode",void 0),(0,r.c)("BABYLON.ParticleRandomBlock",zS);class LS extends wq{constructor(t){super(t),this._currentLockId=-2,this.lockMode=gq.PerParticle,this.registerInput("min",Wq.AutoDetect),this.registerInput("max",Wq.AutoDetect),this.registerOutput("output",Wq.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const q=[Wq.Matrix,Wq.Particle,Wq.Texture,Wq.System,Wq.FloatGradient,Wq.Color4Gradient,Wq.Vector2Gradient,Wq.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...q),this.max.excludedConnectionPointTypes.push(...q)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let t=null;switch(this._currentLockId=-2,this.min.type){case Wq.Float:case Wq.Int:t=t=>{const q=this.min.getConnectedValue(t),S=this.max.getConnectedValue(t);return Math.random()*(S-q)+q};break;case Wq.Vector2:t=t=>{const q=this.min.getConnectedValue(t),S=this.max.getConnectedValue(t);return new o.l(Math.random()*(S.x-q.x)+q.x,Math.random()*(S.y-q.y)+q.y)};break;case Wq.wi:t=t=>{const q=this.min.getConnectedValue(t),S=this.max.getConnectedValue(t);return new o.o(Math.random()*(S.x-q.x)+q.x,Math.random()*(S.y-q.y)+q.y,Math.random()*(S.z-q.z)+q.z)};break;case Wq.bj:t=t=>{const q=this.min.getConnectedValue(t),S=this.max.getConnectedValue(t);return new L.d(Math.random()*(S.r-q.r)+q.r,Math.random()*(S.g-q.g)+q.g,Math.random()*(S.b-q.b)+q.b,Math.random()*(S.a-q.a)+q.a)}}this.output._storedFunction=q=>{var S;let o=0;switch(this.lockMode){case gq.PerParticle:o=(null===(S=q.particleContext)||void 0===S?void 0:S.id)||-1;break;case gq.PerSystem:o=q.buildId||0}return this._currentLockId!==o&&(this.lockMode!==gq.None&&(this._currentLockId=o),this.output._storedValue=t(q)),this.output._storedValue}}serialize(){const t=super.serialize();return t.lockMode=this.lockMode,t}_deserialize(t){super._deserialize(t),void 0!==t.lockMode&&(this.lockMode=t.lockMode)}}(0,X.e)([Eq("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:gq.None},{label:"Per particle",value:gq.PerParticle},{label:"Per system",value:gq.PerSystem}]})],LS.prototype,"lockMode",void 0),(0,r.c)("BABYLON.RandomRangeBlock",LS);(0,r.c)("BABYLON.ParticleLerpBlock",class extends wq{constructor(t){super(t),this.registerInput("left",Wq.AutoDetect),this.registerInput("right",Wq.AutoDetect),this.registerInput("gradient",Wq.Float,!0,0,0,1),this.registerOutput("output",Wq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Wq.Float|Wq.Int|Wq.Vector2|Wq.wi|Wq.bj)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const t=(t,q,S)=>(1-t)*q+t*S;this.output._storedFunction=q=>{const S=this.left.getConnectedValue(q),B=this.right.getConnectedValue(q),z=this.gradient.getConnectedValue(q);switch(this.left.type){case Wq.Int:case Wq.Float:return t(z,S,B);case Wq.Vector2:return new o.l(t(z,S.x,B.x),t(z,S.y,B.y));case Wq.wi:return new o.o(t(z,S.x,B.x),t(z,S.y,B.y),t(z,S.z,B.z));case Wq.bj:return new L.d(t(z,S.r,B.r),t(z,S.g,B.g),t(z,S.b,B.b),t(z,S.a,B.a))}return 0}}});(0,r.c)("BABYLON.UpdateDirectionBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("direction",Wq.wi),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(t){const q=this.particle.getConnectedValue(t);if(this.output._storedValue=q,!this.direction.isConnected)return;const S={process:S=>{t.particleContext=S,t.systemContext=q,S.direction.p(this.direction.getConnectedValue(t))},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S}});(0,r.c)("BABYLON.UpdateColorBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("color",Wq.bj),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(t){const q=this.particle.getConnectedValue(t);if(this.output._storedValue=q,!this.color.isConnected)return;const S={process:S=>{t.particleContext=S,t.systemContext=q,S.color.p(this.color.getConnectedValue(t))},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S}});(0,r.c)("BABYLON.UpdateScaleBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("scale",Wq.Vector2),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(t){const q=this.particle.getConnectedValue(t);if(this.output._storedValue=q,!this.scale.isConnected)return;const S={process:S=>{t.particleContext=S,t.systemContext=q,S.scale.p(this.scale.getConnectedValue(t))},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S}});(0,r.c)("BABYLON.UpdateAngleBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("angle",Wq.Float),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(t){const q=this.particle.getConnectedValue(t);if(this.output._storedValue=q,!this.angle.isConnected)return;const S={process:S=>{t.particleContext=S,t.systemContext=q,S.angle=this.angle.getConnectedValue(t)},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S}});(0,r.c)("BABYLON.BasicPositionUpdateBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(t){const q=this.particle.getConnectedValue(t),S={process:S=>{t.particleContext=S,t.systemContext=q,S.direction.scaleToRef(q._directionScale,q._scaledDirection),S.position.addInPlace(q._scaledDirection)},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S,this.output._storedValue=q}});(0,r.c)("BABYLON.BasicSpriteUpdateBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(t){const q=this.particle.getConnectedValue(t),S={process:S=>{t.particleContext=S,t.systemContext=q,S.updateCellIndex()},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S,this.output._storedValue=q}});(0,r.c)("BABYLON.UpdateSpriteCellIndexBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("cellIndex",Wq.Int),this.registerOutput("output",Wq.Particle),this.cellIndex.acceptedConnectionPointTypes=[Wq.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(t){const q=this.particle.getConnectedValue(t);if(this.output._storedValue=q,!this.cellIndex.isConnected)return;const S={process:S=>{t.particleContext=S,t.systemContext=q,S.cellIndex=Math.floor(this.cellIndex.getConnectedValue(t))},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S}});class rS extends wq{constructor(t){super(t),this.strength=1,this.registerInput("particle",Wq.Particle),this.registerInput("flowMap",Wq.Texture),this.registerOutput("output",Wq.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(t){var q;const S=this.particle.getConnectedValue(t),o=t.Tk;let B;(null===(q=this.flowMap.connectedPoint)||void 0===q?void 0:q.ownerBlock).extractTextureContentAsync().then((t=>{t&&(B=new uq(t.width,t.height,t.data))}));const z={process:t=>{const q=o.getTransformMatrix();B&&B._processParticle(t,this.strength*S._tempScaledUpdateSpeed,q)},previousItem:null,nextItem:null};S._updateQueueStart?ct(z,S._updateQueueStart):S._updateQueueStart=z,this.output._storedValue=S}serialize(){const t=super.serialize();return t.strength=this.strength,t}_deserialize(t){super._deserialize(t),this.strength=t.strength}}(0,X.e)([Eq("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rS.prototype,"strength",void 0),(0,r.c)("BABYLON.UpdateFlowMapBlock",rS);(0,r.c)("BABYLON.SphereShapeBlock",class extends wq{constructor(t){super(t),this.registerInput("input",Wq.Particle),this.registerInput("radius",Wq.Float,!0,1),this.registerInput("radiusRange",Wq.Float,!0,1,0,1),this.registerInput("directionRandomizer",Wq.Float,!0,0,0,1),this.registerOutput("output",Wq.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(t){const q=this.input.getConnectedValue(t);q._directionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.directionRandomizer.getConnectedValue(t),z=S.position.Kg(t.emitterPosition).normalize(),L=(0,C.RandomRange)(0,B),r=(0,C.RandomRange)(0,B),e=(0,C.RandomRange)(0,B);z.x+=L,z.y+=r,z.z+=e,z.normalize(),t.isEmitterTransformNode?o.o.TransformNormalFromFloatsToRef(L,r,e,t.emitterWorldMatrix,S.direction):S.direction.ni(L,r,e)},q._positionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.radius.getConnectedValue(t),z=this.radiusRange.getConnectedValue(t),L=B-(0,C.RandomRange)(0,B*z),r=(0,C.RandomRange)(0,1),e=(0,C.RandomRange)(0,2*Math.PI),Z=Math.acos(2*r-1),b=L*Math.cos(e)*Math.sin(Z),O=L*Math.cos(Z),i=L*Math.sin(e)*Math.sin(Z);t.isEmitterTransformNode?o.o.TransformCoordinatesFromFloatsToRef(b,O,i,t.emitterWorldMatrix,S.position):(S.position.ni(b,O,i),S.position.addInPlace(t.emitterPosition))},this.output._storedValue=q}});(0,r.c)("BABYLON.PointShapeBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("direction1",Wq.wi,!0,new o.o(0,1,0)),this.registerInput("direction2",Wq.wi,!0,new o.o(0,1,0)),this.registerOutput("output",Wq.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){const q=this.particle.getConnectedValue(t);q._directionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.direction1.getConnectedValue(t),z=this.direction2.getConnectedValue(t),L=(0,C.RandomRange)(B.x,z.x),r=(0,C.RandomRange)(B.y,z.y),e=(0,C.RandomRange)(B.z,z.z);t.isEmitterTransformNode?o.o.TransformNormalFromFloatsToRef(L,r,e,t.emitterWorldMatrix,S.direction):S.direction.ni(L,r,e)},q._positionCreation.process=S=>{t.systemContext=q,t.isEmitterTransformNode?o.o.TransformCoordinatesFromFloatsToRef(0,0,0,t.emitterWorldMatrix,S.position):S.position.p(t.emitterPosition)},this.output._storedValue=q}});(0,r.c)("BABYLON.CustomShapeBlock",class extends wq{constructor(t){super(t),this.registerInput("particle",Wq.Particle),this.registerInput("position",Wq.wi,!0,new o.o(0,0,0)),this.registerInput("direction",Wq.wi,!0,new o.o(0,1,0)),this.registerOutput("output",Wq.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){const q=this.particle.getConnectedValue(t);q._directionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.direction.getConnectedValue(t);t.isEmitterTransformNode?o.o.TransformNormalToRef(B,t.emitterWorldMatrix,S.direction):S.direction.p(B)},q._positionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.position.getConnectedValue(t);t.isEmitterTransformNode?o.o.TransformCoordinatesToRef(B,t.emitterWorldMatrix,S.position):(S.position.p(B),S.position.addInPlace(t.emitterPosition))},this.output._storedValue=q}});(0,r.c)("BABYLON.CylinderShapeBlock",class extends wq{constructor(t){super(t),this._tempVector=o.o.Zero(),this.registerInput("particle",Wq.Particle),this.registerInput("radius",Wq.Float,!0,1),this.registerInput("height",Wq.Float,!0,1,0),this.registerInput("radiusRange",Wq.Float,!0,1,0,1),this.registerInput("directionRandomizer",Wq.Float,!0,0,0,1),this.registerOutput("output",Wq.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(t){const q=this.particle.getConnectedValue(t);q._directionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.directionRandomizer.getConnectedValue(t);S.position.subtractToRef(t.emitterPosition,this._tempVector),this._tempVector.normalize(),t.isEmitterTransformNode&&o.o.TransformNormalToRef(this._tempVector,t.emitterInverseWorldMatrix,this._tempVector);const z=(0,C.RandomRange)(-B/2,B/2);let L=Math.atan2(this._tempVector.x,this._tempVector.z);L+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*B,this._tempVector.y=z,this._tempVector.x=Math.sin(L),this._tempVector.z=Math.cos(L),this._tempVector.normalize(),t.isEmitterTransformNode?o.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t.emitterWorldMatrix,S.direction):S.direction.p(this._tempVector)},q._positionCreation.process=S=>{t.particleContext=S,t.systemContext=q;const B=this.height.getConnectedValue(t),z=this.radiusRange.getConnectedValue(t),L=this.radius.getConnectedValue(t),r=(0,C.RandomRange)(-B/2,B/2),e=(0,C.RandomRange)(0,2*Math.PI),Z=(0,C.RandomRange)((1-z)*(1-z),1),b=Math.sqrt(Z)*L,O=b*Math.cos(e),i=b*Math.sin(e);t.isEmitterTransformNode?o.o.TransformCoordinatesFromFloatsToRef(O,r,i,t.emitterWorldMatrix,S.position):(S.position.ni(O,r,i),S.position.addInPlace(t.emitterPosition))},this.output._storedValue=q}});class eS extends wq{constructor(t){super(t),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Wq.Particle),this.registerOutput("output",Wq.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);const q=this.particle.getConnectedValue(t);q._isAnimationSheetEnabled=!0,q.spriteCellWidth=this.width,q.spriteCellHeight=this.height,q.startSpriteCellID=this.start,q.endSpriteCellID=this.end,q.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=q}serialize(){const t=super.serialize();return t.width=this.width,t.height=this.height,t.start=this.start,t.end=this.end,t.randomStartCell=this.randomStartCell,t}_deserialize(t){super._deserialize(t),this.width=t.width,this.height=t.height,this.start=t.start,this.end=t.end,this.randomStartCell=t.randomStartCell}}(0,X.e)([Eq("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eS.prototype,"start",void 0),(0,X.e)([Eq("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eS.prototype,"end",void 0),(0,X.e)([Eq("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eS.prototype,"width",void 0),(0,X.e)([Eq("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eS.prototype,"height",void 0),(0,X.e)([Eq("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eS.prototype,"loop",void 0),(0,X.e)([Eq("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eS.prototype,"randomStartCell",void 0),(0,r.c)("BABYLON.SetupSpriteSheetBlock",eS);class CS extends wq{constructor(t){super(t),this.reference=0,this.registerInput("value",Wq.AutoDetect),this.registerOutput("output",Wq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=t=>{switch(t){case Wq.Float:return Wq.FloatGradient;case Wq.Vector2:return Wq.Vector2Gradient;case Wq.wi:return Wq.Vector3Gradient;case Wq.bj:return Wq.Color4Gradient}return t},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Wq.Float|Wq.Vector2|Wq.wi|Wq.bj)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=t=>null}serialize(){const t=super.serialize();return t.reference=this.reference,t}_deserialize(t){super._deserialize(t),this.reference=t.reference}}(0,X.e)([Eq("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],CS.prototype,"reference",void 0),(0,r.c)("BABYLON.ParticleGradientValueBlock",CS);(0,r.c)("BABYLON.ParticleGradientBlock",class extends wq{constructor(t){super(t),this._entryCount=1,this.registerInput("gradient",Wq.Float,!0,1,0,1),this.registerInput("value0",Wq.AutoDetect),this.registerOutput("output",Wq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=t=>{switch(t){case Wq.FloatGradient:return Wq.Float;case Wq.Vector2Gradient:return Wq.Vector2;case Wq.Vector3Gradient:return Wq.wi;case Wq.Color4Gradient:return Wq.bj}return t},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Wq.FloatGradient|Wq.Vector2Gradient|Wq.Vector3Gradient|Wq.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(t){this._inputs[t].onConnectionObservable.add((()=>{this._entryCount>t||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Wq.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const t=[];for(let S=1;S<this._inputs.length;S++){var q;if(this._inputs[S].isConnected)t.push(null===(q=this._inputs[S].connectedPoint)||void 0===q?void 0:q.ownerBlock)}t.sort(((t,q)=>t.reference-q.reference)),this.output._storedFunction=q=>{const S=this.gradient.getConnectedValue(q);if(1===t.length)return t[0].value.getConnectedValue(q);let B=null;for(let z=t.length-1;z>=0;z--){const r=t[z];if(r.reference<=S){const t=r.value.getConnectedValue(q);if(B){const z=B.value.getConnectedValue(q),e=B.reference,Z=r.reference,b=Math.max(0,Math.min(1,(S-Z)/(e-Z)));switch(this.output.type){case Wq.Float:return(0,C.Lerp)(t,z,b);case Wq.Vector2:return o.l.Lerp(t,z,b);case Wq.wi:return o.o.Lerp(t,z,b);case Wq.bj:return L.d.Lerp(t,z,b)}}return t}B=r}return 0}}});(0,r.c)("BABYLON.ParticleConverterBlock",class extends wq{constructor(t){super(t),this.registerInput("color ",Wq.bj,!0),this.registerInput("xyz ",Wq.wi,!0),this.registerInput("xy ",Wq.Vector2,!0),this.registerInput("zw ",Wq.Vector2,!0),this.registerInput("x ",Wq.Float,!0),this.registerInput("y ",Wq.Float,!0),this.registerInput("z ",Wq.Float,!0),this.registerInput("w ",Wq.Float,!0),this.registerOutput("color",Wq.bj),this.registerOutput("xyz",Wq.wi),this.registerOutput("xy",Wq.Vector2),this.registerOutput("zw",Wq.Vector2),this.registerOutput("x",Wq.Float),this.registerOutput("y",Wq.Float),this.registerOutput("z",Wq.Float),this.registerOutput("w",Wq.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(t){return"color "===t?"colorIn":"xyz "===t?"xyzIn":"xy "===t?"xyIn":"zw "===t?"zwIn":"x "===t?"xIn":"y "===t?"yIn":"z "===t?"zIn":"w "===t?"wIn":t}_outputRename(t){switch(t){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return t}}_build(t){super._build(t);const q=this.xIn,S=this.yIn,B=this.zIn,z=this.wIn,r=this.xyIn,e=this.zwIn,C=this.xyzIn,Z=this.colorIn,b=this.colorOut,O=this.xyzOut,i=this.xyOut,h=this.zwOut,l=this.xOut,I=this.yOut,a=this.zOut,v=this.wOut,M=t=>{if(Z.isConnected)return Z.getConnectedValue(t);let o=0,b=0,O=0,i=0;if(q.isConnected&&(o=q.getConnectedValue(t)),S.isConnected&&(b=S.getConnectedValue(t)),B.isConnected&&(O=B.getConnectedValue(t)),z.isConnected&&(i=z.getConnectedValue(t)),r.isConnected){const q=r.getConnectedValue(t);q&&(o=q.x,b=q.y)}if(e.isConnected){const q=e.getConnectedValue(t);q&&(O=q.x,i=q.y)}if(C.isConnected){const q=C.getConnectedValue(t);q&&(o=q.x,b=q.y,O=q.z)}return new L.d(o,b,O,i)};b._storedFunction=t=>M(t),O._storedFunction=t=>{const q=M(t);return new o.o(q.r,q.g,q.b)},i._storedFunction=t=>{const q=M(t);return new o.l(q.r,q.g)},h._storedFunction=t=>{const q=M(t);return new o.l(q.b,q.a)},l._storedFunction=t=>M(t).r,I._storedFunction=t=>M(t).g,a._storedFunction=t=>M(t).b,v._storedFunction=t=>M(t).a}}),function(t){t[t.Cos=0]="Cos",t[t.Sin=1]="Sin",t[t.Abs=2]="Abs",t[t.Exp=3]="Exp",t[t.Exp2=4]="Exp2",t[t.Round=5]="Round",t[t.Floor=6]="Floor",t[t.Ceiling=7]="Ceiling",t[t.Sqrt=8]="Sqrt",t[t.Log=9]="Log",t[t.Tan=10]="Tan",t[t.ArcTan=11]="ArcTan",t[t.ArcCos=12]="ArcCos",t[t.ArcSin=13]="ArcSin",t[t.Sign=14]="Sign",t[t.Negate=15]="Negate",t[t.OneMinus=16]="OneMinus",t[t.Reciprocal=17]="Reciprocal",t[t.ToDegrees=18]="ToDegrees",t[t.ToRadians=19]="ToRadians",t[t.Fract=20]="Fract"}(Nq||(Nq={}));class ZS extends wq{constructor(t){super(t),this.operation=Nq.Cos,this.registerInput("input",Wq.AutoDetect),this.registerOutput("output",Wq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Wq.Float|Wq.Int|Wq.Vector2|Wq.wi|Wq.bj)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);let q=null;switch(this.operation){case Nq.Cos:q=t=>Math.cos(t);break;case Nq.Sin:q=t=>Math.sin(t);break;case Nq.Abs:q=t=>Math.abs(t);break;case Nq.Exp:q=t=>Math.exp(t);break;case Nq.Exp2:q=t=>Math.pow(2,t);break;case Nq.Round:q=t=>Math.round(t);break;case Nq.Floor:q=t=>Math.floor(t);break;case Nq.Ceiling:q=t=>Math.ceil(t);break;case Nq.Sqrt:q=t=>Math.sqrt(t);break;case Nq.Log:q=t=>Math.log(t);break;case Nq.Tan:q=t=>Math.tan(t);break;case Nq.ArcTan:q=t=>Math.atan(t);break;case Nq.ArcCos:q=t=>Math.acos(t);break;case Nq.ArcSin:q=t=>Math.asin(t);break;case Nq.Sign:q=t=>Math.sign(t);break;case Nq.Negate:q=t=>-t;break;case Nq.OneMinus:q=t=>1-t;break;case Nq.Reciprocal:q=t=>1/t;break;case Nq.ToRadians:q=t=>t*Math.PI/180;break;case Nq.ToDegrees:q=t=>180*t/Math.PI;break;case Nq.Fract:q=t=>t>=0?t-Math.floor(t):t-Math.ceil(t)}if(!q)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Wq.Int:case Wq.Float:this.output._storedFunction=t=>{const S=this.input.getConnectedValue(t);return q(S)};break;case Wq.Vector2:this.output._storedFunction=t=>{const S=this.input.getConnectedValue(t);return new o.l(q(S.x),q(S.y))};break;case Wq.wi:this.output._storedFunction=t=>{const S=this.input.getConnectedValue(t);return new o.o(q(S.x),q(S.y),q(S.z))};break;case Wq.bj:this.output._storedFunction=t=>{const S=this.input.getConnectedValue(t);return new L.d(q(S.r),q(S.g),q(S.b),q(S.a))}}return this}serialize(){const t=super.serialize();return t.operation=this.operation,t}_deserialize(t){super._deserialize(t),this.operation=t.operation}}(0,X.e)([Eq("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Nq.Cos},{label:"Sin",value:Nq.Sin},{label:"Abs",value:Nq.Abs},{label:"Exp",value:Nq.Exp},{label:"Exp2",value:Nq.Exp2},{label:"Round",value:Nq.Round},{label:"Floor",value:Nq.Floor},{label:"Ceiling",value:Nq.Ceiling},{label:"Sqrt",value:Nq.Sqrt},{label:"Log",value:Nq.Log},{label:"Tan",value:Nq.Tan},{label:"ArcTan",value:Nq.ArcTan},{label:"ArcCos",value:Nq.ArcCos},{label:"ArcSin",value:Nq.ArcSin},{label:"Sign",value:Nq.Sign},{label:"Negate",value:Nq.Negate},{label:"OneMinus",value:Nq.OneMinus},{label:"Reciprocal",value:Nq.Reciprocal},{label:"ToDegrees",value:Nq.ToDegrees},{label:"ToRadians",value:Nq.ToRadians},{label:"Fract",value:Nq.Fract}]})],ZS.prototype,"operation",void 0),(0,r.c)("BABYLON.ParticleTrigonometryBlock",ZS);var bS,OS=S(12622);class iS extends wq{constructor(t){super(t),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Wq.AutoDetect),this.registerOutput("output",Wq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Wq.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Wq.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Wq.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Wq.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Wq.System),this._inputs[0].excludedConnectionPointTypes.push(Wq.Particle),this._inputs[0].excludedConnectionPointTypes.push(Wq.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const q=t=>{const q=this.input.getConnectedValue(t);if(this.log.length>=this.stackSize)return q;if(null===q||void 0===q)return this.log.push(["null",""]),q;switch(this.input.type){case Wq.Vector2:this.log.push([(0,OS.g)(q,4),q.toString()]);break;case Wq.wi:this.log.push([(0,OS.i)(q,4),q.toString()]);break;case Wq.bj:this.log.push([`{R: ${q.r.toFixed(4)} G: ${q.g.toFixed(4)} B: ${q.b.toFixed(4)} A: ${q.a.toFixed(4)}}`,q.toString()]);break;default:this.log.push([q.toString(),q.toString()])}return q};this.output.isConnected?this.output._storedFunction=q:this.output._storedValue=q(t)}serialize(){const t=super.serialize();return t.stackSize=this.stackSize,t}_deserialize(t){super._deserialize(t),this.stackSize=t.stackSize}}(0,X.e)([Eq("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],iS.prototype,"stackSize",void 0),(0,r.c)("BABYLON.ParticleDebugBlock",iS);(0,r.c)("BABYLON.ParticleElbowBlock",class extends wq{constructor(t){super(t),this.registerInput("input",Wq.AutoDetect),this.registerOutput("output",Wq.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);const q=this._outputs[0],S=this._inputs[0];q._storedFunction=t=>S.getConnectedValue(t)}});(0,r.c)("BABYLON.ParticleTeleportInBlock",class extends wq{get endpoints(){return this._endpoints}constructor(t){super(t),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Wq.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(t){if(this.getClassName()===t)return!0;for(const q of this.endpoints)if(q.isAnAncestorOfType(t))return!0;return!1}isAnAncestorOf(t){for(const q of this.endpoints){if(q===t)return!0;if(q.isAnAncestorOf(t))return!0}return!1}attachToEndpoint(t){t.detach(),this._endpoints.push(t),t._entryPoint=this,t._outputs[0]._typeConnectionSource=this._inputs[0],t._tempEntryPointUniqueId=null,t.name="> "+this.name}detachFromEndpoint(t){const q=this._endpoints.indexOf(t);-1!==q&&(this._endpoints.splice(q,1),t._outputs[0]._typeConnectionSource=null,t._entryPoint=null)}_build(){for(const t of this._endpoints)t.output._storedFunction=t=>this.input.getConnectedValue(t)}});(0,r.c)("BABYLON.ParticleTeleportOutBlock",class extends wq{constructor(t){super(t),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Wq.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(t){this.entryPoint&&this.entryPoint.build(t)}clone(){const t=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(t),t}serialize(){var t;const q=super.serialize();return q.entryPoint=(null===(t=this.entryPoint)||void 0===t?void 0:t.uniqueId)??"",q}_deserialize(t){super._deserialize(t),this._tempEntryPointUniqueId=t.entryPoint}}),function(t){t[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.LessThan=2]="LessThan",t[t.GreaterThan=3]="GreaterThan",t[t.LessOrEqual=4]="LessOrEqual",t[t.GreaterOrEqual=5]="GreaterOrEqual",t[t.Xor=6]="Xor",t[t.Or=7]="Or",t[t.And=8]="And"}(bS||(bS={}));class hS extends wq{constructor(t){super(t),this.test=bS.Equal,this.epsilon=0,this.registerInput("left",Wq.Float),this.registerInput("right",Wq.Float,!0,0),this.registerInput("ifTrue",Wq.AutoDetect,!0,1),this.registerInput("ifFalse",Wq.AutoDetect,!0,0),this.registerOutput("output",Wq.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Wq.Float,this._inputs[0].acceptedConnectionPointTypes.push(Wq.Int),this._inputs[1].acceptedConnectionPointTypes.push(Wq.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const t=t=>{const q=this.left.getConnectedValue(t),S=this.right.getConnectedValue(t);let o=!1;switch(this.test){case bS.Equal:o=(0,C.WithinEpsilon)(q,S,this.epsilon);break;case bS.NotEqual:o=!(0,C.WithinEpsilon)(q,S,this.epsilon);break;case bS.LessThan:o=q<S+this.epsilon;break;case bS.GreaterThan:o=q>S-this.epsilon;break;case bS.LessOrEqual:o=q<=S+this.epsilon;break;case bS.GreaterOrEqual:o=q>=S-this.epsilon;break;case bS.Xor:o=!!q&&!S||!q&&!!S;break;case bS.Or:o=!!q||!!S;break;case bS.And:o=!!q&&!!S}return o};this.output._storedFunction=q=>t(q)?this.ifTrue.getConnectedValue(q):this.ifFalse.getConnectedValue(q)}serialize(){const t=super.serialize();return t.test=this.test,t.epsilon=this.epsilon,t}_deserialize(t){super._deserialize(t),this.test=t.test,void 0!==t.epsilon&&(this.epsilon=t.epsilon)}}(0,X.e)([Eq("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:bS.Equal},{label:"NotEqual",value:bS.NotEqual},{label:"LessThan",value:bS.LessThan},{label:"GreaterThan",value:bS.GreaterThan},{label:"LessOrEqual",value:bS.LessOrEqual},{label:"GreaterOrEqual",value:bS.GreaterOrEqual},{label:"Xor",value:bS.Xor},{label:"Or",value:bS.Or},{label:"And",value:bS.And}]})],hS.prototype,"test",void 0),(0,X.e)([Eq("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],hS.prototype,"epsilon",void 0),(0,r.c)("BABYLON.ParticleConditionBlock",hS);class lS extends wq{constructor(t){super(t),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Wq.Particle),this.registerInput("condition",Wq.Float,!0,0),this.registerInput("system",Wq.System),this.registerOutput("output",Wq.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){this._triggerCount=0;const q=this.input.getConnectedValue(t),S={process:S=>{if(t.particleContext=S,t.systemContext=q,0!==this.condition.getConnectedValue(t)&&(0===this.limit||this._triggerCount<this.limit)){const o=(new Date).getTime();if(this._previousOne&&o-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=o;const B=this.system.getConnectedValue(t);if(B){const o=Pq(B,t.Tk,S.position);o.Qi.addOnce((()=>{this._triggerCount--})),q.Qi.addOnce((()=>{o.dispose()}))}}},previousItem:null,nextItem:null};q._updateQueueStart?ct(S,q._updateQueueStart):q._updateQueueStart=S,this.output._storedValue=q}serialize(){const t=super.serialize();return t.limit=this.limit,t.delay=this.delay,t}_deserialize(t){super._deserialize(t),void 0!==t.limit&&(this.limit=t.limit),void 0!==t.delay&&(this.delay=t.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,X.e)([Eq("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lS.prototype,"limit",void 0),(0,X.e)([Eq("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],lS.prototype,"delay",void 0),(0,r.c)("BABYLON.ParticleTriggerBlock",lS);S(12626),S(12635),S(12650),S(12716)},12695:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12654:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12734:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneVertex",z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12723:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12708:(t,q,S)=>{"use strict";var o=S(572);const B="fogFragment",z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12686:(t,q,S)=>{"use strict";var o=S(572);const B="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12736:(t,q,S)=>{"use strict";var o=S(572);const B="fogVertex",z="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12729:(t,q,S)=>{"use strict";var o=S(572);const B="fogVertexDeclaration",z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12673:(t,q,S)=>{"use strict";var o=S(572);const B="helperFunctions",z="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12663:(t,q,S)=>{"use strict";var o=S(572);const B="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12679:(t,q,S)=>{"use strict";var o=S(572);const B="imageProcessingFunctions",z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12666:(t,q,S)=>{"use strict";var o=S(572);const B="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12704:(t,q,S)=>{"use strict";var o=S(572);const B="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12739:(t,q,S)=>{"use strict";var o=S(572);const B="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";o.e.IncludesShadersStoreWGSL[B]||(o.e.IncludesShadersStoreWGSL[B]=z)},12650:(t,q,S)=>{"use strict";S.r(q),S.d(q,{particlesPixelShaderWGSL:()=>L});var o=S(572);S(12654),S(12663),S(12666),S(12673),S(12679),S(12686),S(12695),S(12704),S(12708);const B="particlesPixelShader",z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.e.ShadersStoreWGSL[B]||(o.e.ShadersStoreWGSL[B]=z);const L={name:B,shader:z}},12716:(t,q,S)=>{"use strict";S.r(q),S.d(q,{particlesVertexShaderWGSL:()=>L});var o=S(572);S(12723),S(12729),S(12666),S(12734),S(12736),S(12739);const B="particlesVertexShader",z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.e.ShadersStoreWGSL[B]||(o.e.ShadersStoreWGSL[B]=z);const L={name:B,shader:z}},12571:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12631:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12591:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneVertex",z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12641:(t,q,S)=>{"use strict";var o=S(572);const B="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12583:(t,q,S)=>{"use strict";var o=S(572);const B="fogFragment",z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12568:(t,q,S)=>{"use strict";var o=S(572);const B="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12596:(t,q,S)=>{"use strict";var o=S(572);const B="fogVertex",z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12587:(t,q,S)=>{"use strict";var o=S(572);const B="fogVertexDeclaration",z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12556:(t,q,S)=>{"use strict";var o=S(572);const B="helperFunctions",z="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12547:(t,q,S)=>{"use strict";var o=S(572);const B="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12564:(t,q,S)=>{"use strict";var o=S(572);const B="imageProcessingFunctions",z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12552:(t,q,S)=>{"use strict";var o=S(572);const B="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12575:(t,q,S)=>{"use strict";var o=S(572);const B="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12601:(t,q,S)=>{"use strict";var o=S(572);const B="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";o.e.IncludesShadersStore[B]||(o.e.IncludesShadersStore[B]=z)},12626:(t,q,S)=>{"use strict";S.r(q),S.d(q,{particlesPixelShader:()=>L});var o=S(572);S(12631),S(12547),S(12552),S(12556),S(12564),S(12568),S(12571),S(12575),S(12583);const B="particlesPixelShader",z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.e.ShadersStore[B]||(o.e.ShadersStore[B]=z);const L={name:B,shader:z}},12635:(t,q,S)=>{"use strict";S.r(q),S.d(q,{particlesVertexShader:()=>L});var o=S(572);S(12641),S(12587),S(12552),S(12591),S(12596),S(12601);const B="particlesVertexShader",z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.e.ShadersStore[B]||(o.e.ShadersStore[B]=z);const L={name:B,shader:z}},12987:(t,q,S)=>{"use strict";S.r(q),S.d(q,{FlowGraphGLTFDataProvider:()=>z});var o=S(12946),B=S(12927);class z extends o.d{constructor(t){var q,S;super();const o=t.glTF,z=(null===(q=o.animations)||void 0===q?void 0:q.map((t=>t._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",B.b,z);const L=(null===(S=o.nodes)||void 0===S?void 0:S.map((t=>t._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",B.b,L)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12877:(t,q,S)=>{"use strict";S.d(q,{c:()=>I,d:()=>h,g:()=>i,i:()=>l});var o=S(678),B=S(11932),z=S(706),L=S(12883);const r=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class e{constructor(t,q){this._gltf=t,this._infoTree=q}convert(t){let q,S=this._gltf,o=this._infoTree;if(!t.startsWith("/"))throw new Error("Path must start with a /");const B=t.split("/");if(B.shift(),B[B.length-1].includes(".length")){const t=B[B.length-1].split(".");B.pop(),B.push(...t)}let z=!1;for(const e of B){const B="length"===e;if(B&&!o.__array__)throw new Error(`Path ${t} is invalid`);if(o.__ignoreObjectTree__&&(z=!0),o.__array__&&!B)o=o.__array__;else if(o=o[e],!o)throw new Error(`Path ${t} is invalid`);if(!z)if(void 0===S){if(!r.find((q=>q.regex.test(t))))throw new Error(`Path ${t} is invalid`)}else if(!B){var L;S=null===(L=S)||void 0===L?void 0:L[e]}(o.__target__||B)&&(q=S)}return{object:q,info:o}}}function C(t,q,S,o){const B=Z(t,q);return o?B[S][o]:B[S]}function Z(t,q,S){var o,z;return null===(o=t._data)||void 0===o||null===(z=o[(null===S||void 0===S?void 0:S.fillMode)??B.d.MATERIAL_TriangleFillMode])||void 0===z?void 0:z.babylonMaterial}function b(t,q){return{offset:{componentsCount:2,type:"Vector2",get:(S,B,z)=>{const L=C(S,z,t,q);return new o.l(null===L||void 0===L?void 0:L.uOffset,null===L||void 0===L?void 0:L.vOffset)},getTarget:Z,set:(S,o,B,z)=>{const L=C(o,z,t,q);L.uOffset=S.x,L.vOffset=S.y},getPropertyName:[()=>`${t}${q?"."+q:""}.uOffset`,()=>`${t}${q?"."+q:""}.vOffset`]},rotation:{type:"number",get:(S,o,B)=>{var z;return null===(z=C(S,B,t,q))||void 0===z?void 0:z.wAng},getTarget:Z,set:(S,o,B,z)=>C(o,z,t,q).wAng=S,getPropertyName:[()=>`${t}${q?"."+q:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(S,B,z)=>{const L=C(S,z,t,q);return new o.l(null===L||void 0===L?void 0:L.uScale,null===L||void 0===L?void 0:L.vScale)},getTarget:Z,set:(S,o,B,z)=>{const L=C(o,z,t,q);L.uScale=S.x,L.vScale=S.y},getPropertyName:[()=>`${t}${q?"."+q:""}.uScale`,()=>`${t}${q?"."+q:""}.vScale`]}}}const O={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:t=>{var q,S;return new o.l((null===(q=t._babylonCamera)||void 0===q?void 0:q.orthoLeft)??0,(null===(S=t._babylonCamera)||void 0===S?void 0:S.orthoRight)??0)},set:(t,q)=>{q._babylonCamera&&(q._babylonCamera.orthoLeft=t.x,q._babylonCamera.orthoRight=t.y)},getTarget:t=>t,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:t=>{var q,S;return new o.l((null===(q=t._babylonCamera)||void 0===q?void 0:q.orthoBottom)??0,(null===(S=t._babylonCamera)||void 0===S?void 0:S.orthoTop)??0)},set:(t,q)=>{q._babylonCamera&&(q._babylonCamera.orthoBottom=t.x,q._babylonCamera.orthoTop=t.y)},getTarget:t=>t,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:t=>{var q;return null===(q=t._babylonCamera)||void 0===q?void 0:q.maxZ},set:(t,q)=>{q._babylonCamera&&(q._babylonCamera.maxZ=t)},getTarget:t=>t,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:t=>{var q;return null===(q=t._babylonCamera)||void 0===q?void 0:q.Ci},set:(t,q)=>{q._babylonCamera&&(q._babylonCamera.Ci=t)},getTarget:t=>t,getPropertyName:[()=>"Ci"]}},perspective:{aspectRatio:{type:"number",get:t=>{var q;return null===(q=t._babylonCamera)||void 0===q?void 0:q.getEngine().getAspectRatio(t._babylonCamera)},getTarget:t=>t,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:t=>{var q;return null===(q=t._babylonCamera)||void 0===q?void 0:q.fov},set:(t,q)=>{q._babylonCamera&&(q._babylonCamera.fov=t)},getTarget:t=>t,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:t=>{var q;return null===(q=t._babylonCamera)||void 0===q?void 0:q.maxZ},set:(t,q)=>{q._babylonCamera&&(q._babylonCamera.maxZ=t)},getTarget:t=>t,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:t=>{var q;return null===(q=t._babylonCamera)||void 0===q?void 0:q.Ci},set:(t,q)=>{q._babylonCamera&&(q._babylonCamera.Ci=t)},getTarget:t=>t,getPropertyName:[()=>"Ci"]}}}},nodes:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"wi",get:t=>{var q;return null===(q=t._babylonTransformNode)||void 0===q?void 0:q.position},set:(t,q)=>{var S;return null===(S=q._babylonTransformNode)||void 0===S?void 0:S.position.p(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:t=>{var q;return null===(q=t._babylonTransformNode)||void 0===q?void 0:q.rotationQuaternion},set:(t,q)=>{var S,o;return null===(S=q._babylonTransformNode)||void 0===S||null===(o=S.rotationQuaternion)||void 0===o?void 0:o.p(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"wi",get:t=>{var q;return null===(q=t._babylonTransformNode)||void 0===q?void 0:q.oi},set:(t,q)=>{var S;return null===(S=q._babylonTransformNode)||void 0===S?void 0:S.oi.p(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"oi"]},weights:{length:{type:"number",get:t=>t._numMorphTargets,getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(t,q)=>{var S,o;return void 0!==q?null===(S=t._primitiveBabylonMeshes)||void 0===S||null===(o=S[0].morphTargetManager)||void 0===o?void 0:o.getTarget(q).influence:void 0},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(t,q)=>[0],getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:t=>{var q,S,B;return o.e.Compose(null===(q=t._babylonTransformNode)||void 0===q?void 0:q.oi,null===(S=t._babylonTransformNode)||void 0===S?void 0:S.rotationQuaternion,null===(B=t._babylonTransformNode)||void 0===B?void 0:B.position)},getTarget:t=>t._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:t=>{var q,S,B,z;const L=o.e.Identity();let r=t.parent;for(;r&&r.parent;)r=r.parent;const e=(null===(q=t._babylonTransformNode)||void 0===q?void 0:q.position._isDirty)||(null===(S=t._babylonTransformNode)||void 0===S||null===(B=S.rotationQuaternion)||void 0===B?void 0:B._isDirty)||(null===(z=t._babylonTransformNode)||void 0===z?void 0:z.oi._isDirty);if(r){var C;const q=null===(C=r._babylonTransformNode)||void 0===C?void 0:C.Ai(!0).invert();var Z,b;if(q)null===(Z=t._babylonTransformNode)||void 0===Z||null===(b=Z.Ai(e))||void 0===b||b.multiplyToRef(q,L)}else t._babylonTransformNode&&L.p(t._babylonTransformNode.Ai(e));return L},getTarget:t=>t._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:t=>{var q,S;return null===(q=t._babylonTransformNode)||void 0===q||null===(S=q.getChildren((t=>t instanceof L.e),!0)[0])||void 0===S?void 0:S.bb},getTarget:t=>{var q;return null===(q=t._babylonTransformNode)||void 0===q?void 0:q.getChildren((t=>t instanceof L.e),!0)[0]},set:(t,q)=>{if(q._babylonTransformNode){const S=q._babylonTransformNode.getChildren((t=>t instanceof L.e),!0)[0];S&&(S.bb=t)}}},color:{type:"aj",get:t=>{var q,S;return null===(q=t._babylonTransformNode)||void 0===q||null===(S=q.getChildren((t=>t instanceof L.e),!0)[0])||void 0===S?void 0:S.cb},getTarget:t=>{var q;return null===(q=t._babylonTransformNode)||void 0===q?void 0:q.getChildren((t=>t instanceof L.e),!0)[0]},set:(t,q)=>{if(q._babylonTransformNode){const S=q._babylonTransformNode.getChildren((t=>t instanceof L.e),!0)[0];S&&(S.cb=t)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"aj",get:(t,q,S)=>Z(t,q,S).emissiveColor,set:(t,q,S,o)=>Z(q,S,o).emissiveColor.p(t),getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:b("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(t,q,S)=>{var o;return null===(o=C(t,S,"bumpTexture"))||void 0===o?void 0:o.level},set:(t,q,S,o)=>{const B=C(q,o,"bumpTexture");B&&(B.level=t)},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:b("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(t,q,S)=>Z(t,q,S).ambientTextureStrength,set:(t,q,S,o)=>{const B=Z(q,S,o);B&&(B.ambientTextureStrength=t)},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:b("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"bj",get:(t,q,S)=>{const o=Z(t,q,S);return z.d.FromColor3(o.albedoColor,o.alpha)},set:(t,q,S,o)=>{const B=Z(q,S,o);B.albedoColor.set(t.r,t.g,t.b),B.alpha=t.a},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:b("albedoTexture")}},metallicFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).metallic,set:(t,q,S,o)=>{const B=Z(q,S,o);B&&(B.metallic=t)},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).roughness,set:(t,q,S,o)=>{const B=Z(q,S,o);B&&(B.roughness=t)},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:b("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(t,q,S)=>Z(t,q,S).anisotropy.bb,set:(t,q,S,o)=>{Z(q,S,o).anisotropy.bb=t},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(t,q,S)=>Z(t,q,S).anisotropy.angle,set:(t,q,S,o)=>{Z(q,S,o).anisotropy.angle=t},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:b("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).clearCoat.bb,set:(t,q,S,o)=>{Z(q,S,o).clearCoat.bb=t},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).clearCoat.roughness,set:(t,q,S,o)=>{Z(q,S,o).clearCoat.roughness=t},getTarget:(t,q,S)=>Z(t,q,S),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:b("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(t,q,S)=>{var o;return null===(o=Z(t,q,S).clearCoat.bumpTexture)||void 0===o?void 0:o.level},getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).clearCoat.bumpTexture.level=t},extensions:{KHR_texture_transform:b("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:b("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(t,q,S)=>Z(t,q,S).subSurface.dispersion,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).subSurface.dispersion=t}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(t,q,S)=>Z(t,q,S).emissiveIntensity,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).emissiveIntensity=t}},KHR_materials_ior:{ior:{type:"number",get:(t,q,S)=>Z(t,q,S).indexOfRefraction,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).indexOfRefraction=t}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).iridescence.bb,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).iridescence.bb=t},iridescenceIor:{type:"number",get:(t,q,S)=>Z(t,q,S).iridescence.indexOfRefraction,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).iridescence.indexOfRefraction=t},iridescenceTexture:{extensions:{KHR_texture_transform:b("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(t,q,S)=>Z(t,q,S).iridescence.maximumThickness,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).iridescence.maximumThickness=t},iridescenceThicknessMinimum:{type:"number",get:(t,q,S)=>Z(t,q,S).iridescence.minimumThickness,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).iridescence.minimumThickness=t},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:b("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"aj",get:(t,q,S)=>Z(t,q,S).sheen.color,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).sheen.color.p(t)},sheenColorTexture:{extensions:{KHR_texture_transform:b("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).sheen.bb,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).sheen.bb=t},sheenRoughnessTexture:{extensions:{KHR_texture_transform:b("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).metallicF0Factor,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).metallicF0Factor=t,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"aj",get:(t,q,S)=>Z(t,q,S).metallicReflectanceColor,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).metallicReflectanceColor.p(t),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:b("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:b("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).subSurface.refractionIntensity,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).subSurface.refractionIntensity=t,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:b("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).subSurface.translucencyIntensity,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).subSurface.translucencyIntensity=t},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:b("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"aj",get:(t,q,S)=>Z(t,q,S).subSurface.translucencyColor,getTarget:Z,set:(t,q,S,o)=>{var B;return t&&(null===(B=Z(q,S,o).subSurface.translucencyColor)||void 0===B?void 0:B.p(t))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:b("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"aj",get:(t,q,S)=>Z(t,q,S).subSurface.tintColor,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).subSurface.tintColor.p(t)},attenuationDistance:{type:"number",get:(t,q,S)=>Z(t,q,S).subSurface.tintColorAtDistance,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).subSurface.tintColorAtDistance=t},thicknessFactor:{type:"number",get:(t,q,S)=>Z(t,q,S).subSurface.maximumThickness,getTarget:Z,set:(t,q,S,o)=>Z(q,S,o).subSurface.maximumThickness=t},thicknessTexture:{extensions:{KHR_texture_transform:b("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonLight)),getPropertyName:[t=>"length"]},__array__:{__target__:!0,color:{type:"aj",get:t=>{var q;return null===(q=t._babylonLight)||void 0===q?void 0:q.cb},set:(t,q)=>{var S;return null===(S=q._babylonLight)||void 0===S?void 0:S.cb.p(t)},getTarget:t=>t._babylonLight,getPropertyName:[t=>"diffuse"]},bb:{type:"number",get:t=>{var q;return null===(q=t._babylonLight)||void 0===q?void 0:q.bb},set:(t,q)=>q._babylonLight?q._babylonLight.bb=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"intensity"]},range:{type:"number",get:t=>{var q;return null===(q=t._babylonLight)||void 0===q?void 0:q.range},set:(t,q)=>q._babylonLight?q._babylonLight.range=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"range"]},spot:{innerConeAngle:{type:"number",get:t=>{var q;return null===(q=t._babylonLight)||void 0===q?void 0:q.innerAngle},set:(t,q)=>q._babylonLight?q._babylonLight.innerAngle=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"innerConeAngle"]},outerConeAngle:{type:"number",get:t=>{var q;return null===(q=t._babylonLight)||void 0===q?void 0:q.angle},set:(t,q)=>q._babylonLight?q._babylonLight.angle=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonLight)),getPropertyName:[t=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonTexture)),getPropertyName:[t=>"length"]},__array__:{__target__:!0,bb:{type:"number",get:t=>{var q;return null===(q=t._babylonTexture)||void 0===q?void 0:q.level},set:(t,q)=>{q._babylonTexture&&(q._babylonTexture.level=t)},getTarget:t=>t._babylonTexture},rotation:{type:"Quaternion",get:t=>{var q;return t._babylonTexture&&o.g.FromRotationMatrix(null===(q=t._babylonTexture)||void 0===q?void 0:q.getReflectionTextureMatrix())},set:(t,q)=>{var S;q._babylonTexture&&(null!==(S=q._babylonTexture.va())&&void 0!==S&&S.useRightHandedSystem||(t=o.g.Inverse(t)),o.e.FromQuaternionToRef(t,q._babylonTexture.getReflectionTextureMatrix()))},getTarget:t=>t._babylonTexture}}}}},animations:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>{var q;return null===(q=t.primitives[0]._instanceData)||void 0===q?void 0:q.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function i(t){return new e(t,O)}function h(t){const q=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let S=O;for(const o of q)o&&(S=S[o]);if(S&&S.type&&S.get)return S}function l(t,q){const S=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let o=O;for(const B of S)B&&(o=o[B]);o&&o.type&&o.get&&(o.interpolation=q)}function I(t,q){const S=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let o=O;for(const B of S)if(B){if(!o[B]){if("?"===B){o.__ignoreObjectTree__=!0;continue}o[B]={},"__array__"===B&&(o[B].__target__=!0)}o=o[B]}Object.assign(o,q)}},12891:(t,q,S)=>{"use strict";S.r(q),S.d(q,{AnimationPropertyInfo:()=>C,TransformNodeAnimationPropertyInfo:()=>Z,WeightAnimationPropertyInfo:()=>b,getQuaternion:()=>r,getVector3:()=>L,getWeights:()=>e});var o=S(12019),B=S(678),z=S(12877);function L(t,q,S,o){return B.o.ti(q,S).scaleInPlace(o)}function r(t,q,S,o){return B.g.ti(q,S).scaleInPlace(o)}function e(t,q,S,o){const B=new Array(t._numMorphTargets);for(let z=0;z<B.length;z++)B[z]=q[S++]*o;return B}class C{constructor(t,q,S,o){this.type=t,this.name=q,this.getValue=S,this.getStride=o}_buildAnimation(t,q,S){const B=new o.b(t,this.name,q,this.type);return B.setKeys(S),B}}class Z extends C{buildAnimations(t,q,S,o){const B=[];return B.push({babylonAnimatable:t._babylonTransformNode,babylonAnimation:this._buildAnimation(q,S,o)}),B}}class b extends C{buildAnimations(t,q,S,B){const z=[];if(t._numMorphTargets)for(let L=0;L<t._numMorphTargets;L++){const r=new o.b(`${q}_${L}`,this.name,S,this.type);if(r.setKeys(B.map((t=>({frame:t.frame,inTangent:t.inTangent?t.inTangent[L]:void 0,value:t.value[L],outTangent:t.outTangent?t.outTangent[L]:void 0,interpolation:t.interpolation})))),t._primitiveBabylonMeshes)for(const q of t._primitiveBabylonMeshes)if(q.morphTargetManager){const t=q.morphTargetManager.getTarget(L),S=r.clone();t.animations.push(S),z.push({babylonAnimatable:t,babylonAnimation:S})}}return z}}(0,z.i)("/nodes/{}/translation",[new Z(o.b.ANIMATIONTYPE_VECTOR3,"position",L,(()=>3))]),(0,z.i)("/nodes/{}/rotation",[new Z(o.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",r,(()=>4))]),(0,z.i)("/nodes/{}/scale",[new Z(o.b.ANIMATIONTYPE_VECTOR3,"oi",L,(()=>3))]),(0,z.i)("/nodes/{}/weights",[new b(o.b.ANIMATIONTYPE_FLOAT,"influence",e,(t=>t._numMorphTargets))])},12856:(t,q,S)=>{"use strict";class o{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((t,q)=>{this._resolve=t,this._reject=q}))}}var B=S(678),z=S(706),L=S(490),r=S(644),e=S(12859),C=S(12869),Z=S(485),b=S(11925),O=S(12019),i=S(12026),h=S(523),l=S(496),I=S(503);class a{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(t,q,S){this.name=t,this.id=q,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=B.e.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Z.b,this.bones=[],this._scene=S||h.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const o=this._scene.getEngine().getCaps();this._canUseTextureForBones=o.textureFloat&&o.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((t=>!t.getParent()))}getTransformMatrices(t){if(this.needInitialSkinMatrix){if(!t)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return t._bonesTransformMatrices||this.prepare(!0),t._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(t){let q=`Name: ${this.name}, nBones: ${this.bones.length}`;if(q+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,t){q+=", Ranges: {";let t=!0;for(const S in this._ranges)t&&(q+=", ",t=!1),q+=S;q+="}"}return q}getBoneIndexByName(t){for(let q=0,S=this.bones.length;q<S;q++)if(this.bones[q].name===t)return q;return-1}createAnimationRange(t,q,S){if(!this._ranges[t]){this._ranges[t]=new i.b(t,q,S);for(let o=0,B=this.bones.length;o<B;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].createRange(t,q,S)}}deleteAnimationRange(t){let q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let S=0,o=this.bones.length;S<o;S++)this.bones[S].animations[0]&&this.bones[S].animations[0].deleteRange(t,q);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}getAnimationRanges(){const t=[];let q;for(q in this._ranges)t.push(this._ranges[q]);return t}copyAnimationRange(t,q){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[q]||!t.getAnimationRange(q))return!1;let o=!0;const B=this._getHighestAnimationFrame()+1,z={},L=t.bones;let r,e;for(e=0,r=L.length;e<r;e++)z[L[e].name]=L[e];this.bones.length!==L.length&&(l.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${L.length}`),o=!1);const C=S&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(e=0,r=this.bones.length;e<r;e++){const t=this.bones[e].name,L=z[t];L?o=o&&this.bones[e].copyAnimationRange(L,q,B,S,C):(l.c.Warn("copyAnimationRange: not same rig, missing source bone "+t),o=!1)}const Z=t.getAnimationRange(q);return Z&&(this._ranges[q]=new i.b(q,Z.from+B,Z.to+B)),o}returnToRest(){for(const t of this.bones)-1!==t._index&&t.returnToRest()}_getHighestAnimationFrame(){let t=0;for(let q=0,S=this.bones.length;q<S;q++)if(this.bones[q].animations[0]){const S=this.bones[q].animations[0].getHighestFrame();t<S&&(t=S)}return t}beginAnimation(t,q,S,o){const B=this.getAnimationRange(t);return B?this._scene.beginAnimation(this,B.from,B.to,q,S,o):null}static MakeAnimationAdditive(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;const o=t.getAnimationRange(S);if(!o)return null;const B=t._scene.getAllAnimatablesByTarget(t);let z=null;for(let r=0;r<B.length;r++){const t=B[r];if(t.fromFrame===(null===o||void 0===o?void 0:o.from)&&t.toFrame===(null===o||void 0===o?void 0:o.to)){z=t;break}}const L=t.getAnimatables();for(let r=0;r<L.length;r++){const t=L[r].animations;if(t)for(let o=0;o<t.length;o++)O.b.MakeAnimationAdditive(t[o],q,S)}return z&&(z.isAdditive=!0),t}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(t){this._meshesWithPoseMatrix.push(t)}_unregisterMeshWithPoseMatrix(t){const q=this._meshesWithPoseMatrix.indexOf(t);q>-1&&this._meshesWithPoseMatrix.splice(q,1)}_computeTransformMatrices(t,q){this.onBeforeComputeObservable.notifyObservers(this);for(let S=0;S<this.bones.length;S++){const o=this.bones[S];o._childUpdateId++;const B=o.getParent();if(B?o.getLocalMatrix().multiplyToRef(B.getFinalMatrix(),o.getFinalMatrix()):q?o.getLocalMatrix().multiplyToRef(q,o.getFinalMatrix()):o.getFinalMatrix().p(o.getLocalMatrix()),-1!==o._index){const q=null===o._index?S:o._index;o.getAbsoluteInverseBindMatrix().multiplyToArray(o.getFinalMatrix(),t,16*q)}}this._identity.copyToArray(t,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const t=this.va().getRenderId();if(this._currentRenderId===t)return;this._currentRenderId=t}if(this._numBonesWithLinkedTransformNode>0)for(const t of this.bones)if(t._linkedTransformNode){const q=t._linkedTransformNode;t.position=q.position,q.rotationQuaternion?t.rotationQuaternion=q.rotationQuaternion:t.rotation=q.rotation,t.oi=q.oi}if(this.needInitialSkinMatrix)for(const t of this._meshesWithPoseMatrix){const q=t.getPoseMatrix();let S=this._isDirty;if(t._bonesTransformMatrices&&t._bonesTransformMatrices.length===16*(this.bones.length+1)||(t._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),S=!0),S){if(this._synchronizedWithMesh!==t){this._synchronizedWithMesh=t;for(const t of this.bones)if(!t.getParent()){t.getBindMatrix().multiplyToRef(q,B.j.Matrix[1]),t._updateAbsoluteBindMatrices(B.j.Matrix[1])}if(this.isUsingTextureForMatrices){const q=4*(this.bones.length+1);t._transformMatrixTexture&&t._transformMatrixTexture.getSize().width===q||(t._transformMatrixTexture&&t._transformMatrixTexture.dispose(),t._transformMatrixTexture=b.d.CreateRGBATexture(t._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(t._bonesTransformMatrices,q),this.isUsingTextureForMatrices&&t._transformMatrixTexture&&t._transformMatrixTexture.update(t._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=b.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables}clone(t,q){const S=new a(t,q||t,this._scene);S.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){const t=this.bones[o];let q=null;const B=t.getParent();if(B){const t=this.bones.indexOf(B);q=S.bones[t]}const z=new C.c(t.name,S,q,t.getBindMatrix().clone(),t.getRestMatrix().clone());z._index=t._index,t._linkedTransformNode&&z.linkTransformNode(t._linkedTransformNode),I.c.DeepCopy(t.animations,z.animations)}if(this._ranges){S._ranges={};for(const t in this._ranges){const q=this._ranges[t];q&&(S._ranges[t]=q.clone())}}return this._isDirty=!0,S.prepare(!0),S}enableBlending(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const q of this.bones)for(const S of q.animations)S.enableBlending=!0,S.blendingSpeed=t}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const t=this._parentContainer.skeletons.indexOf(this);t>-1&&this._parentContainer.skeletons.splice(t,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const t={};t.name=this.name,t.id=this.id,this.dimensionsAtRest&&(t.dimensionsAtRest=this.dimensionsAtRest.Gi()),t.bones=[],t.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let S=0;S<this.bones.length;S++){var q;const o=this.bones[S],B=o.getParent(),z={parentBoneIndex:B?this.bones.indexOf(B):-1,index:o.getIndex(),name:o.name,id:o.id,matrix:o.getBindMatrix().Gi(),rest:o.getRestMatrix().Gi(),linkedTransformNodeId:null===(q=o.getTransformNode())||void 0===q?void 0:q.id};t.bones.push(z),o.length&&(z.length=o.length),o.metadata&&(z.metadata=o.metadata),o.animations&&o.animations.length>0&&(z.animation=o.animations[0].serialize()),t.ranges=[];for(const q in this._ranges){const S=this._ranges[q];if(!S)continue;const o={};o.name=q,o.from=S.from,o.to=S.to,t.ranges.push(o)}}return t}static Parse(t,q){const S=new a(t.name,t.id,q);let o;for(t.dimensionsAtRest&&(S.dimensionsAtRest=B.o.ti(t.dimensionsAtRest)),S.needInitialSkinMatrix=t.needInitialSkinMatrix,o=0;o<t.bones.length;o++){const q=t.bones[o],z=t.bones[o].index;let L=null;q.parentBoneIndex>-1&&(L=S.bones[q.parentBoneIndex]);const r=q.rest?B.e.ti(q.rest):null,e=new C.c(q.name,S,L,B.e.ti(q.matrix),r,null,z);void 0!==q.id&&null!==q.id&&(e.id=q.id),q.length&&(e.length=q.length),q.metadata&&(e.metadata=q.metadata),q.animation&&e.animations.push(O.b.Parse(q.animation)),void 0!==q.linkedTransformNodeId&&null!==q.linkedTransformNodeId&&(S._hasWaitingData=!0,e._waitingTransformNodeId=q.linkedTransformNodeId)}if(t.ranges)for(o=0;o<t.ranges.length;o++){const q=t.ranges[o];S.createAnimationRange(q.name,q.from,q.to)}return S}computeAbsoluteMatrices(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||t)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(t)}getPoseMatrix(){let t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t}sortBones(){const t=[],q=new Array(this.bones.length);for(let S=0;S<this.bones.length;S++)this._sortBones(S,t,q);this.bones=t}_sortBones(t,q,S){if(S[t])return;S[t]=!0;const o=this.bones[t];if(!o)return;void 0===o._index&&(o._index=t);const B=o.getParent();B&&this._sortBones(this.bones.indexOf(B),q,S),q.push(o)}setCurrentPoseAsRest(){for(const t of this.bones)t.setCurrentPoseAsRest()}}var v=S(819),M=S(11942),x=S(2306),k=S(793),V=S(716),J=S(776),U=S(791),H=S(483),j=S(12032),y=S(670),Q=S(12817);class K{set areUpdatesFrozen(t){t?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new y.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,t||(t=h.b.LastCreatedScene),this._scene=t,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const t=this._scene.getEngine().getCaps();this._canUseTextureForTargets=t.canUseGLVertexID&&t.textureFloat&&t.maxVertexTextureImageUnits>0&&t.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return K.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?K.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(t){this._numMaxInfluencers!==t&&(this._numMaxInfluencers=t,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(t){this._useTextureToStoreTargets!==t&&(this._useTextureToStoreTargets=t,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var t;return K.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(t=this._scene)&&void 0!==t&&t.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(t){return this._activeTargets.data[t]}getTarget(t){return this._targets[t]}getTargetByName(t){for(const q of this._targets)if(q.name===t)return q;return null}addTarget(t){this._targets.push(t),this._targetInfluenceChangedObservers.push(t.onInfluenceChanged.add((t=>{this.areUpdatesFrozen&&t&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(t)}))),this._targetDataLayoutChangedObservers.push(t._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(t){const q=this._targets.indexOf(t);q>=0&&(this._targets.splice(q,1),t.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(q,1)[0]),t._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(q,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(t)}_bind(t){t.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),t.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),t.setTexture("morphTargets",this._targetStoreTexture),t.setInt("morphTargetCount",this.numInfluencers)}clone(){const t=new K(this._scene);for(const q of this._targets)t.addTarget(q.clone());return t.enablePositionMorphing=this.enablePositionMorphing,t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t.enableUV2Morphing=this.enableUV2Morphing,t.enableColorMorphing=this.enableColorMorphing,t}serialize(){const t={};t.id=this.uniqueId,t.targets=[];for(const q of this._targets)t.targets.push(q.serialize());return t}_syncActiveTargets(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const q=!!this._targetStoreTexture,S=this.isUsingTextureForTargets;(this._mustSynchronize||q!==S)&&(this._mustSynchronize=!1,this.synchronize());let o=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let B=-1;for(const z of this._targets)if(B++,0!==z.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=K.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(z),this._morphTargetTextureIndices[o]=B,this._tempInfluences[o++]=z.influence}this._morphTargetTextureIndices.length!==o&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,o)),this._influences&&this._influences.length===o||(this._influences=new Float32Array(o));for(let z=0;z<o;z++)this._influences[z]=this._tempInfluences[z];if(t&&this._scene)for(const z of this._scene.meshes)z.morphTargetManager===this&&(S?z._markSubMeshesAsAttributesDirty():z._syncGeometryWithMorphTargetManager())}synchronize(){var t;if(!this._scene||this.areUpdatesFrozen)return;const q=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(t=this._targetStoreTexture)||void 0===t||t.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>q.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const S of this._targets){this._supportsPositions=this._supportsPositions&&S.hasPositions,this._supportsNormals=this._supportsNormals&&S.hasNormals,this._supportsTangents=this._supportsTangents&&S.hasTangents,this._supportsUVs=this._supportsUVs&&S.hasUVs,this._supportsUV2s=this._supportsUV2s&&S.hasUV2s,this._supportsColors=this._supportsColors&&S.hasColors;const t=S.vertexCount;if(0===this._vertexCount)this._vertexCount=t;else if(this._vertexCount!==t)return void l.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${S.name}": ${t}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const t=q.getCaps().maxTextureSize;this._textureWidth>t&&(this._textureHeight=Math.ceil(this._textureWidth/t),this._textureWidth=t);const S=this._targets.length,o=new Float32Array(S*this._textureWidth*this._textureHeight*4);let B=0;for(let q=0;q<S;q++){const t=this._targets[q],S=t.getPositions(),z=t.getNormals(),L=t.getUVs(),r=t.getTangents(),e=t.getUV2s(),C=t.getColors();B=q*this._textureWidth*this._textureHeight*4;for(let q=0;q<this._vertexCount;q++)this._supportsPositions&&S&&(o[B]=S[3*q],o[B+1]=S[3*q+1],o[B+2]=S[3*q+2],B+=4),this._supportsNormals&&z&&(o[B]=z[3*q],o[B+1]=z[3*q+1],o[B+2]=z[3*q+2],B+=4),this._supportsUVs&&L&&(o[B]=L[2*q],o[B+1]=L[2*q+1],B+=4),this._supportsTangents&&r&&(o[B]=r[3*q],o[B+1]=r[3*q+1],o[B+2]=r[3*q+2],B+=4),this._supportsUV2s&&e&&(o[B]=e[2*q],o[B+1]=e[2*q+1],B+=4),this._supportsColors&&C&&(o[B]=C[4*q],o[B+1]=C[4*q+1],o[B+2]=C[4*q+2],o[B+3]=C[4*q+3],B+=4)}this._targetStoreTexture=Q.d.CreateRGBATexture(o,this._textureWidth,this._textureHeight,S,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const S of this._scene.meshes)S.morphTargetManager===this&&S._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const t=this._parentContainer.morphTargetManagers.indexOf(this);t>-1&&this._parentContainer.morphTargetManagers.splice(t,1),this._parentContainer=null}for(const t of this._targets)this._scene.stopAnimation(t)}}static Parse(t,q){const S=new K(q);for(const o of t.targets)S.addTarget(j.b.Parse(o,q));return S}}K.EnableTextureStorage=!0,K.MaxActiveMorphTargetsInVertexAttributeMode=8,K.ConstantTargetCountForTextureMode=0;var X=S(12872),G=S(527),Y=S(752);const n=new Map,u=n;function W(t,q,S){f(t)&&l.c.Warn(`Extension with the name '${t}' already exists`),n.set(t,{isGLTFExtension:q,factory:S})}function f(t){return n.delete(t)}var D=S(12877),m=S(12088),A=S(726);class c{static Get(t,q,S){if(!q||void 0==S||!q[S])throw new Error(`${t}: Failed to find index (${S})`);return q[S]}static TryGet(t,q){return t&&void 0!=q&&t[q]?t[q]:null}static Assign(t){if(t)for(let q=0;q<t.length;q++)t[q].index=q}}function s(t){if(t.min&&t.max){const q=t.min,S=t.max,o=B.j.wi[0].ni(q[0],q[1],q[2]),z=B.j.wi[1].ni(S[0],S[1],S[2]);if(t.normalized&&5126!==t.componentType){let q=1;switch(t.componentType){case 5120:q=127;break;case 5121:q=255;break;case 5122:q=32767;break;case 5123:q=65535}const S=1/q;o.scaleInPlace(S),z.scaleInPlace(S)}return new Y.c(o,z)}return null}class g{static RegisterExtension(t,q){W(t,!1,q)}static UnregisterExtension(t){return f(t)}get Ni(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=t}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((t=>t.dispose&&t.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(t,q,S,o,B,z){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=q,this._assetContainer=S,this._loadData(o);let z=null;if(t){const q={};if(this._gltf.nodes)for(const t of this._gltf.nodes)t.name&&(q[t.name]=t.index);z=(t instanceof Array?t:[t]).map((t=>{const S=q[t];if(void 0===S)throw new Error(`Failed to find node '${t}'`);return S}))}return await this._loadAsync(B,L,z,(()=>({meshes:this._getMeshes(),zi:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(t,q,S,o){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=t,this._loadData(q),await this._loadAsync(S,B,null,(()=>{}))}async _loadAsync(t,q,S,o){return await Promise.resolve().then((async()=>{this._rootUrl=t,this._uniqueRootUrl=!t.startsWith("file:")&&q?t:`${t}${Date.now()}/`,this._fileName=q,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const B=`${X.n[X.n.LOADING]} => ${X.n[X.n.READY]}`,z=`${X.n[X.n.LOADING]} => ${X.n[X.n.COMPLETE]}`;this._parent._startPerformanceCounter(B),this._parent._startPerformanceCounter(z),this._parent._setState(X.n.LOADING),this._extensionsOnLoading();const r=new Array;if(!this.parent.loadOnlyMaterials)if(S)r.push(this.loadSceneAsync("/nodes",{nodes:S,index:-1}));else if(void 0!=this._gltf.Tk||this._gltf.scenes&&this._gltf.scenes[0]){const t=c.Get("/scene",this._gltf.scenes,this._gltf.Tk||0);r.push(this.loadSceneAsync(`/scenes/${t.index}`,t))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let t=0;t<this._gltf.materials.length;++t){const q=this._gltf.materials[t],S="/materials/"+t,o=v.c.TriangleFillMode;r.push(this._loadMaterialAsync(S,q,null,o,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&r.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&r.push(this._compileShadowGeneratorsAsync());const e=Promise.all(r).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ji(!0);for(const t of this._babylonScene.materials){const q=t;void 0!==q.maxSimultaneousLights&&(q.maxSimultaneousLights=Math.max(q.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(X.n.READY),this._skipStartAnimationStep||this._startAnimations(),o()}));return await e.then((t=>(this._parent._endPerformanceCounter(B),L.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(z),this._parent._setState(X.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(t=>{this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()}))})),t)))})).catch((t=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()),t}))}_loadData(t){if(this._gltf=t.json,this._setupData(),t.bin){const q=this._gltf.buffers;if(q&&q[0]&&!q[0].uri){const S=q[0];(S.byteLength<t.bin.byteLength-3||S.byteLength>t.bin.byteLength)&&l.c.Warn(`Binary buffer length (${S.byteLength}) from JSON does not match chunk length (${t.bin.byteLength})`),this._bin=t.bin}else l.c.Warn("Unexpected BIN chunk")}}_setupData(){if(c.Assign(this._gltf.accessors),c.Assign(this._gltf.animations),c.Assign(this._gltf.buffers),c.Assign(this._gltf.bufferViews),c.Assign(this._gltf.cameras),c.Assign(this._gltf.images),c.Assign(this._gltf.materials),c.Assign(this._gltf.meshes),c.Assign(this._gltf.nodes),c.Assign(this._gltf.samplers),c.Assign(this._gltf.scenes),c.Assign(this._gltf.skins),c.Assign(this._gltf.textures),this._gltf.nodes){const t={};for(const S of this._gltf.nodes)if(S.children)for(const q of S.children)t[q]=S.index;const q=this._createRootNode();for(const S of this._gltf.nodes){const o=t[S.index];S.parent=void 0===o?q:this._gltf.nodes[o]}}}async _loadExtensionsAsync(){const t=[];if(u.forEach(((q,S)=>{var o;!1===(null===(o=this.parent.extensionOptions[S])||void 0===o?void 0:o.enabled)?q.isGLTFExtension&&this.isExtensionUsed(S)&&l.c.Warn(`Extension ${S} is used but has been explicitly disabled.`):q.isGLTFExtension&&!this.isExtensionUsed(S)||t.push((async()=>{const t=await q.factory(this);return t.name!==S&&l.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${t.name} !== ${S}`),this._parent.onExtensionLoadedObservable.notifyObservers(t),t})())})),this._extensions.push(...await Promise.all(t)),this._extensions.sort(((t,q)=>(t.order||Number.MAX_VALUE)-(q.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const S of this._gltf.extensionsRequired){if(!this._extensions.some((t=>t.name===S&&t.enabled))){var q;if(!1===(null===(q=this.parent.extensionOptions[S])||void 0===q?void 0:q.enabled))throw new Error(`Required extension ${S} is disabled`);throw new Error(`Required extension ${S} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new H.c("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ji(!1);const q={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case X.j.AUTO:this._babylonScene.useRightHandedSystem||(q.rotation=[0,1,0,0],q.scale=[1,1,-1],g._LoadTransform(q,this._rootBabylonMesh));break;case X.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),q}loadSceneAsync(t,q){const S=this._extensionsLoadSceneAsync(t,q);if(S)return S;const o=new Array;if(this.logOpen(`${t} ${q.name||""}`),q.nodes)for(const B of q.nodes){const q=c.Get(`${t}/nodes/${B}`,this._gltf.nodes,B);o.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(t=>{t.parent=this._rootBabylonMesh})))}for(const B of this._postSceneLoadActions)B();return o.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(o).then((()=>{}))}_forEachPrimitive(t,q){if(t._primitiveBabylonMeshes)for(const S of t._primitiveBabylonMeshes)q(S)}_getGeometries(){const t=[],q=this._gltf.nodes;if(q)for(const S of q)this._forEachPrimitive(S,(q=>{const S=q.xi;S&&-1===t.indexOf(S)&&t.push(S)}));return t}_getMeshes(){const t=[];this._rootBabylonMesh instanceof U.b&&t.push(this._rootBabylonMesh);const q=this._gltf.nodes;if(q)for(const S of q)this._forEachPrimitive(S,(q=>{t.push(q)}));return t}_getTransformNodes(){const t=[],q=this._gltf.nodes;if(q)for(const S of q)S._babylonTransformNode&&"ij"===S._babylonTransformNode.getClassName()&&t.push(S._babylonTransformNode),S._babylonTransformNodeForSkin&&t.push(S._babylonTransformNodeForSkin);return t}_getSkeletons(){const t=[],q=this._gltf.skins;if(q)for(const S of q)S._data&&t.push(S._data.babylonSkeleton);return t}_getAnimationGroups(){const t=[],q=this._gltf.animations;if(q)for(const S of q)S._babylonAnimationGroup&&t.push(S._babylonAnimationGroup);return t}_startAnimations(){switch(this._parent.animationStartMode){case X.f.NONE:break;case X.f.FIRST:{const t=this._getAnimationGroups();0!==t.length&&t[0].start(!0);break}case X.f.ALL:{const t=this._getAnimationGroups();for(const q of t)q.start(!0);break}default:return void l.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadNodeAsync(t,q,S);if(o)return o;if(q._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const B=new Array;this.logOpen(`${t} ${q.name||""}`);const z=o=>{if(g.AddPointerMetadata(o,t),g._LoadTransform(q,o),void 0!=q.camera){const S=c.Get(`${t}/camera`,this._gltf.cameras,q.camera);B.push(this.loadCameraAsync(`/cameras/${S.index}`,S,(t=>{t.parent=o,this._babylonScene.useRightHandedSystem||(o.oi.x=-1)})))}if(q.children)for(const S of q.children){const q=c.Get(`${t}/children/${S}`,this._gltf.nodes,S);B.push(this.loadNodeAsync(`/nodes/${q.index}`,q,(t=>{t.parent=o})))}S(o)},L=void 0!=q.mesh,r=this._parent.loadSkins&&void 0!=q.skin;if(!L||r){const t=q.name||`node${q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new k.e(t,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==q.mesh?q._babylonTransformNode=S:q._babylonTransformNodeForSkin=S,z(S)}if(L)if(r){const S=c.Get(`${t}/mesh`,this._gltf.meshes,q.mesh);B.push(this._loadMeshAsync(`/meshes/${S.index}`,q,S,(S=>{const o=q._babylonTransformNodeForSkin;S.metadata=(0,m.c)(o.metadata,S.metadata||{});const z=c.Get(`${t}/skin`,this._gltf.skins,q.skin);B.push(this._loadSkinAsync(`/skins/${z.index}`,q,z,(t=>{this._forEachPrimitive(q,(q=>{q.skeleton=t})),this._postSceneLoadActions.push((()=>{if(void 0!=z.skeleton){const t=c.Get(`/skins/${z.index}/skeleton`,this._gltf.nodes,z.skeleton).parent;q.index===t.index?S.parent=o.parent:S.parent=t._babylonTransformNode}else S.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:o,skinnedNode:S})}))})))})))}else{const S=c.Get(`${t}/mesh`,this._gltf.meshes,q.mesh);B.push(this._loadMeshAsync(`/meshes/${S.index}`,q,S,z))}return this.logClose(),Promise.all(B).then((()=>(this._forEachPrimitive(q,(t=>{const q=t;!q.isAnInstance&&q.xi&&q.xi.useBoundingInfoFromGeometry?t.Ea():t.refreshBoundingInfo(!0,!0)})),q._babylonTransformNode)))}_loadMeshAsync(t,q,S,o){const B=S.primitives;if(!B||!B.length)throw new Error(`${t}: Primitives are missing`);void 0==B[0].index&&c.Assign(B);const z=new Array;this.logOpen(`${t} ${S.name||""}`);const L=q.name||`node${q.index}`;if(1===B.length){const o=S.primitives[0];z.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${o.index}`,L,q,S,o,(t=>{q._babylonTransformNode=t,q._primitiveBabylonMeshes=[t]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,q._babylonTransformNode=new k.e(L,this._babylonScene),q._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._primitiveBabylonMeshes=[];for(const o of B)z.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${o.index}`,`${L}_primitive${o.index}`,q,S,o,(t=>{t.parent=q._babylonTransformNode,q._primitiveBabylonMeshes.push(t)})))}return o(q._babylonTransformNode),this.logClose(),Promise.all(z).then((()=>q._babylonTransformNode))}_loadMeshPrimitiveAsync(t,q,S,o,B,z){const L=this._extensionsLoadMeshPrimitiveAsync(t,q,S,o,B,z);if(L)return L;this.logOpen(`${t}`);const r=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==S.skin&&!o.primitives[0].targets;let e,C;if(r&&B._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,e=B._instanceData.babylonSourceMesh.createInstance(q),e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C=B._instanceData.promise;else{const z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new H.c(q,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.sideOrientation=this._babylonScene.useRightHandedSystem?v.c.CounterClockWiseSideOrientation:v.c.ClockWiseSideOrientation,this._createMorphTargets(t,S,o,B,L),z.push(this._loadVertexDataAsync(t,B,L).then((async q=>await this._loadMorphTargetsAsync(t,B,L,q).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,q.Ca(L),q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const Z=g._GetDrawMode(t,B.mode);if(void 0==B.material){let t=this._defaultBabylonMaterialData[Z];t||(t=this._createDefaultMaterial("__GLTFLoader._default",Z),this._parent.onMaterialLoadedObservable.notifyObservers(t),this._defaultBabylonMaterialData[Z]=t),L.material=t}else if(!this.parent.skipMaterials){const q=c.Get(`${t}/material`,this._gltf.materials,B.material);z.push(this._loadMaterialAsync(`/materials/${q.index}`,q,L,Z,(t=>{L.material=t})))}C=Promise.all(z),r&&(B._instanceData={babylonSourceMesh:L,promise:C}),e=L}return g.AddPointerMetadata(e,t),this._parent.onMeshLoadedObservable.notifyObservers(e),z(e),this.logClose(),C.then((()=>e))}_loadVertexDataAsync(t,q,S){const o=this._extensionsLoadVertexDataAsync(t,q,S);if(o)return o;const B=q.attributes;if(!B)throw new Error(`${t}: Attributes are missing`);const z=new Array,L=new J.c(S.name,this._babylonScene);if(void 0==q.indices)S.isUnIndexed=!0;else{const S=c.Get(`${t}/indices`,this._gltf.accessors,q.indices);z.push(this._loadIndicesAccessorAsync(`/accessors/${S.index}`,S).then((t=>{L.setIndices(t)})))}const r=(q,o,r)=>{if(void 0==B[q])return;S._delayInfo=S._delayInfo||[],-1===S._delayInfo.indexOf(o)&&S._delayInfo.push(o);const e=c.Get(`${t}/attributes/${q}`,this._gltf.accessors,B[q]);z.push(this._loadVertexAccessorAsync(`/accessors/${e.index}`,e,o).then((t=>{if(t.getKind()===V.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!S.skeleton){const t=s(e);t&&(L._boundingInfo=t,L.useBoundingInfoFromGeometry=!0)}L.setVerticesBuffer(t,e.count)}))),o==V.i.MatricesIndicesExtraKind&&(S.numBoneInfluencers=8),r&&r(e)};return r("POSITION",V.i.PositionKind),r("NORMAL",V.i.NormalKind),r("TANGENT",V.i.TangentKind),r("TEXCOORD_0",V.i.UVKind),r("TEXCOORD_1",V.i.UV2Kind),r("TEXCOORD_2",V.i.UV3Kind),r("TEXCOORD_3",V.i.UV4Kind),r("TEXCOORD_4",V.i.UV5Kind),r("TEXCOORD_5",V.i.UV6Kind),r("JOINTS_0",V.i.MatricesIndicesKind),r("WEIGHTS_0",V.i.MatricesWeightsKind),r("JOINTS_1",V.i.MatricesIndicesExtraKind),r("WEIGHTS_1",V.i.MatricesWeightsExtraKind),r("COLOR_0",V.i.ColorKind,(t=>{"VEC4"===t.type&&(S.hasVertexAlpha=!0)})),Promise.all(z).then((()=>L))}_createMorphTargets(t,q,S,o,B){if(!o.targets||!this._parent.loadMorphTargets)return;if(void 0==q._numMorphTargets)q._numMorphTargets=o.targets.length;else if(o.targets.length!==q._numMorphTargets)throw new Error(`${t}: Primitives do not have the same number of targets`);const z=S.extras?S.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,B.morphTargetManager=new K(this._babylonScene),B.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.morphTargetManager.areUpdatesFrozen=!0;for(let L=0;L<o.targets.length;L++){const t=q.weights?q.weights[L]:S.weights?S.weights[L]:0,o=z?z[L]:`morphTarget${L}`;B.morphTargetManager.addTarget(new j.b(o,t,B.va()))}}_loadMorphTargetsAsync(t,q,S,o){if(!q.targets||!this._parent.loadMorphTargets)return Promise.resolve();const B=new Array,z=S.morphTargetManager;for(let L=0;L<z.numTargets;L++){const S=z.getTarget(L);B.push(this._loadMorphTargetVertexDataAsync(`${t}/targets/${L}`,o,q.targets[L],S))}return Promise.all(B).then((()=>{z.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(t,q,S,o){const B=new Array,z=(o,z,L)=>{if(void 0==S[o])return;const r=q.getVertexBuffer(z);if(!r)return;const e=c.Get(`${t}/${o}`,this._gltf.accessors,S[o]);B.push(this._loadFloatAccessorAsync(`/accessors/${e.index}`,e).then((t=>{L(r,t)})))};return z("POSITION",V.i.PositionKind,((t,q)=>{const S=new Float32Array(q.length);t.forEach(q.length,((t,o)=>{S[o]=q[o]+t})),o.setPositions(S)})),z("NORMAL",V.i.NormalKind,((t,q)=>{const S=new Float32Array(q.length);t.forEach(S.length,((t,o)=>{S[o]=q[o]+t})),o.setNormals(S)})),z("TANGENT",V.i.TangentKind,((t,q)=>{const S=new Float32Array(q.length/3*4);let B=0;t.forEach(q.length/3*4,((t,o)=>{(o+1)%4!==0&&(S[B]=q[B]+t,B++)})),o.setTangents(S)})),z("TEXCOORD_0",V.i.UVKind,((t,q)=>{const S=new Float32Array(q.length);t.forEach(q.length,((t,o)=>{S[o]=q[o]+t})),o.setUVs(S)})),z("TEXCOORD_1",V.i.UV2Kind,((t,q)=>{const S=new Float32Array(q.length);t.forEach(q.length,((t,o)=>{S[o]=q[o]+t})),o.setUV2s(S)})),z("COLOR_0",V.i.ColorKind,((q,S)=>{let B=null;const z=q.getSize();if(3===z){B=new Float32Array(S.length/3*4),q.forEach(S.length,((t,q)=>{const o=Math.floor(q/3),z=q%3;B[4*o+z]=S[3*o+z]+t}));for(let t=0;t<S.length/3;++t)B[4*t+3]=1}else{if(4!==z)throw new Error(`${t}: Invalid number of components (${z}) for COLOR_0 attribute`);B=new Float32Array(S.length),q.forEach(S.length,((t,q)=>{B[q]=S[q]+t}))}o.setColors(B)})),await Promise.all(B).then((()=>{}))}static _LoadTransform(t,q){if(void 0!=t.skin)return;let S=B.o.Zero(),o=B.g.Identity(),z=B.o.One();if(t.matrix){B.e.ti(t.matrix).decompose(z,o,S)}else t.translation&&(S=B.o.ti(t.translation)),t.rotation&&(o=B.g.ti(t.rotation)),t.scale&&(z=B.o.ti(t.scale));q.position=S,q.rotationQuaternion=o,q.oi=z}_loadSkinAsync(t,q,S,o){if(!this._parent.loadSkins)return Promise.resolve();const B=this._extensionsLoadSkinAsync(t,q,S);if(B)return B;if(S._data)return o(S._data.babylonSkeleton),S._data.promise;const z=`skeleton${S.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new a(S.name||z,z,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,S,L);const r=this._loadSkinInverseBindMatricesDataAsync(t,S).then((t=>{this._updateBoneMatrices(L,t)}));return S._data={babylonSkeleton:L,promise:r},o(L),r}_loadBones(t,q,S){if(void 0==q.skeleton||this._parent.alwaysComputeSkeletonRootNode){const S=this._findSkeletonRootNode(`${t}/joints`,q.joints);if(S)if(void 0===q.skeleton)q.skeleton=S.index;else{const o=(t,q)=>{for(;q.parent;q=q.parent)if(q.parent===t)return!0;return!1},B=c.Get(`${t}/skeleton`,this._gltf.nodes,q.skeleton);B===S||o(B,S)||(l.c.Warn(`${t}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),q.skeleton=S.index)}else l.c.Warn(`${t}: Failed to find common root`)}const o={};for(const B of q.joints){const z=c.Get(`${t}/joints/${B}`,this._gltf.nodes,B);this._loadBone(z,q,S,o)}}_findSkeletonRootNode(t,q){if(0===q.length)return null;const S={};for(const B of q){const q=[];let o=c.Get(`${t}/${B}`,this._gltf.nodes,B);for(;-1!==o.index;)q.unshift(o),o=o.parent;S[B]=q}let o=null;for(let B=0;;++B){let t=S[q[0]];if(B>=t.length)return o;const z=t[B];for(let L=1;L<q.length;++L)if(t=S[q[L]],B>=t.length||z!==t[B])return o;o=z}}_loadBone(t,q,S,o){t._isJoint=!0;let B=o[t.index];if(B)return B;let z=null;t.index!==q.skeleton&&(t.parent&&-1!==t.parent.index?z=this._loadBone(t.parent,q,S,o):void 0!==q.skeleton&&l.c.Warn(`/skins/${q.index}/skeleton: Skeleton node is not a common root`));const L=q.joints.indexOf(t.index);return B=new C.c(t.name||`joint${t.index}`,S,z,this._getNodeMatrix(t),null,null,L),o[t.index]=B,this._postSceneLoadActions.push((()=>{B.linkTransformNode(t._babylonTransformNode)})),B}_loadSkinInverseBindMatricesDataAsync(t,q){if(void 0==q.inverseBindMatrices)return Promise.resolve(null);const S=c.Get(`${t}/inverseBindMatrices`,this._gltf.accessors,q.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${S.index}`,S)}_updateBoneMatrices(t,q){for(const S of t.bones){const t=B.e.Identity(),o=S._index;q&&-1!==o&&(B.e.FromArrayToRef(q,16*o,t),t.invertToRef(t));const z=S.getParent();z&&t.multiplyToRef(z.getAbsoluteInverseBindMatrix(),t),S.ej(t,!1,!1),S._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(t){return t.matrix?B.e.ti(t.matrix):B.e.Compose(t.scale?B.o.ti(t.scale):B.o.One(),t.rotation?B.g.ti(t.rotation):B.g.Identity(),t.translation?B.o.ti(t.translation):B.o.Zero())}loadCameraAsync(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadCameraAsync(t,q,S);if(o)return o;const z=new Array;this.logOpen(`${t} ${q.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new e.e(q.name||`camera${q.index}`,B.o.Zero(),this._babylonScene,!1);switch(L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._babylonCamera=L,L.setTarget(new B.o(0,0,-1)),q.type){case"perspective":{const S=q.perspective;if(!S)throw new Error(`${t}: Camera perspective properties are missing`);L.fov=S.yfov,L.Ci=S.znear,L.maxZ=S.zfar||0;break}case"orthographic":if(!q.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);L.mode=r.d.ORTHOGRAPHIC_CAMERA,L.orthoLeft=-q.orthographic.xmag,L.orthoRight=q.orthographic.xmag,L.orthoBottom=-q.orthographic.ymag,L.orthoTop=q.orthographic.ymag,L.Ci=q.orthographic.znear,L.maxZ=q.orthographic.zfar;break;default:throw new Error(`${t}: Invalid camera type (${q.type})`)}return g.AddPointerMetadata(L,t),this._parent.onCameraLoadedObservable.notifyObservers(L),S(L),this.logClose(),Promise.all(z).then((()=>L))}_loadAnimationsAsync(){const t=this._gltf.animations;if(!t)return Promise.resolve();const q=new Array;for(let S=0;S<t.length;S++){const o=t[S];q.push(this.loadAnimationAsync(`/animations/${o.index}`,o).then((t=>{0===t.targetedAnimations.length&&t.dispose()})))}return Promise.all(q).then((()=>{}))}loadAnimationAsync(t,q){const o=this._extensionsLoadAnimationAsync(t,q);return o||S.e(62).then(S.bind(S,14100)).then((S=>{let{AnimationGroup:o}=S;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new o(q.name||`animation${q.index}`,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q._babylonAnimationGroup=B;const z=new Array;c.Assign(q.channels),c.Assign(q.samplers);for(const L of q.channels)z.push(this._loadAnimationChannelAsync(`${t}/channels/${L.index}`,t,q,L,((t,q)=>{t.animations=t.animations||[],t.animations.push(q),B.addTargetedAnimation(q,t)})));return Promise.all(z).then((()=>(B.normalize(0),B)))}))}async _loadAnimationChannelAsync(t,q,o,B,z){const L=this._extensionsLoadAnimationChannelAsync(t,q,o,B,z);if(L)return await L;if(void 0==B.target.node)return await Promise.resolve();const r=c.Get(`${t}/target/node`,this._gltf.nodes,B.target.node),e=B.target.path,C="weights"===e;if(C&&!r._numMorphTargets||!C&&!r._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!C&&!r._isJoint)return await Promise.resolve();let Z;switch(await Promise.resolve().then(S.bind(S,12891)),e){case"translation":var b;Z=null===(b=(0,D.d)("/nodes/{}/translation"))||void 0===b?void 0:b.interpolation;break;case"rotation":var O;Z=null===(O=(0,D.d)("/nodes/{}/rotation"))||void 0===O?void 0:O.interpolation;break;case"scale":var i;Z=null===(i=(0,D.d)("/nodes/{}/scale"))||void 0===i?void 0:i.interpolation;break;case"weights":var h;Z=null===(h=(0,D.d)("/nodes/{}/weights"))||void 0===h?void 0:h.interpolation;break;default:throw new Error(`${t}/target/path: Invalid value (${B.target.path})`)}if(!Z)throw new Error(`${t}/target/path: Could not find interpolation properties for target path (${B.target.path})`);const l={object:r,info:Z};return await this._loadAnimationChannelFromTargetInfoAsync(t,q,o,B,l,z)}_loadAnimationChannelFromTargetInfoAsync(t,q,S,o,B,z){const L=this.parent.targetFps,r=1/L,e=c.Get(`${t}/sampler`,S.samplers,o.sampler);return this._loadAnimationSamplerAsync(`${q}/samplers/${o.sampler}`,e).then((t=>{let q=0;const e=B.object,C=B.info;for(const B of C){const C=B.getStride(e),Z=t.input,b=t.output,O=new Array(Z.length);let i=0;switch(t.interpolation){case"STEP":for(let t=0;t<Z.length;t++){const q=B.getValue(e,b,i,1);i+=C,O[t]={frame:Z[t]*L,value:q,interpolation:1}}break;case"CUBICSPLINE":for(let t=0;t<Z.length;t++){const q=B.getValue(e,b,i,r);i+=C;const S=B.getValue(e,b,i,1);i+=C;const o=B.getValue(e,b,i,r);i+=C,O[t]={frame:Z[t]*L,inTangent:q,value:S,outTangent:o}}break;case"LINEAR":for(let t=0;t<Z.length;t++){const q=B.getValue(e,b,i,1);i+=C,O[t]={frame:Z[t]*L,value:q}}}if(i>0){const t=`${S.name||`animation${S.index}`}_channel${o.index}_${q}`,r=B.buildAnimations(e,t,L,O);for(const S of r)q++,z(S.babylonAnimatable,S.babylonAnimation)}}}))}_loadAnimationSamplerAsync(t,q){if(q._data)return q._data;const S=q.interpolation||"LINEAR";switch(S){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${t}/interpolation: Invalid value (${q.interpolation})`)}const o=c.Get(`${t}/input`,this._gltf.accessors,q.input),B=c.Get(`${t}/output`,this._gltf.accessors,q.output);return q._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${o.index}`,o),this._loadFloatAccessorAsync(`/accessors/${B.index}`,B)]).then((t=>{let[q,o]=t;return{input:q,interpolation:S,output:o}})),q._data}loadBufferAsync(t,q,S,o){const B=this._extensionsLoadBufferAsync(t,q,S,o);if(B)return B;if(!q._data)if(q.uri)q._data=this.loadUriAsync(`${t}/uri`,q,q.uri);else{if(!this._bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);q._data=this._bin.readAsync(0,q.byteLength)}return q._data.then((q=>{try{return new Uint8Array(q.buffer,q.byteOffset+S,o)}catch(B){throw new Error(`${t}: ${B.message}`)}}))}loadBufferViewAsync(t,q){const S=this._extensionsLoadBufferViewAsync(t,q);if(S)return S;if(q._data)return q._data;const o=c.Get(`${t}/buffer`,this._gltf.buffers,q.buffer);return q._data=this.loadBufferAsync(`/buffers/${o.index}`,o,q.byteOffset||0,q.byteLength),q._data}_loadAccessorAsync(t,q,S){if(q._data)return q._data;const o=g._GetNumComponents(t,q.type),B=o*V.i.GetTypeByteLength(q.componentType),z=o*q.count;if(void 0==q.bufferView)q._data=Promise.resolve(new S(z));else{const L=c.Get(`${t}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((r=>{if(5126!==q.componentType||q.normalized||L.byteStride&&L.byteStride!==B){const t=new S(z);return V.i.ForEach(r,q.byteOffset||0,L.byteStride||B,o,q.componentType,t.length,q.normalized||!1,((q,S)=>{t[S]=q})),t}return g._GetTypedArray(t,q.componentType,r,q.byteOffset,z)}))}if(q.sparse){const z=q.sparse;q._data=q._data.then((L=>{const r=L,e=c.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,z.indices.bufferView),C=c.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${e.index}`,e),this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)]).then((L=>{let[e,C]=L;const Z=g._GetTypedArray(`${t}/sparse/indices`,z.indices.componentType,e,z.indices.byteOffset,z.count),b=o*z.count;let O;if(5126!==q.componentType||q.normalized){const L=g._GetTypedArray(`${t}/sparse/values`,q.componentType,C,z.values.byteOffset,b);O=new S(b),V.i.ForEach(L,0,B,o,q.componentType,O.length,q.normalized||!1,((t,q)=>{O[q]=t}))}else O=g._GetTypedArray(`${t}/sparse/values`,q.componentType,C,z.values.byteOffset,b);let i=0;for(let t=0;t<Z.length;t++){let q=Z[t]*o;for(let t=0;t<o;t++)r[q++]=O[i++]}return r}))}))}return q._data}_loadFloatAccessorAsync(t,q){return this._loadAccessorAsync(t,q,Float32Array)}_loadIndicesAccessorAsync(t,q){if("SCALAR"!==q.type)throw new Error(`${t}/type: Invalid value ${q.type}`);if(5121!==q.componentType&&5123!==q.componentType&&5125!==q.componentType)throw new Error(`${t}/componentType: Invalid value ${q.componentType}`);if(q._data)return q._data;if(q.sparse){const S=g._GetTypedArrayConstructor(`${t}/componentType`,q.componentType);q._data=this._loadAccessorAsync(t,q,S)}else{const S=c.Get(`${t}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((S=>g._GetTypedArray(t,q.componentType,S,q.byteOffset,q.count)))}return q._data}_loadVertexBufferViewAsync(t){if(t._babylonBuffer)return t._babylonBuffer;const q=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((t=>new V.e(q,t,!1))),t._babylonBuffer}_loadVertexAccessorAsync(t,q,S){var o;if(null!==(o=q._babylonVertexBuffer)&&void 0!==o&&o[S])return q._babylonVertexBuffer[S];q._babylonVertexBuffer||(q._babylonVertexBuffer={});const B=this._babylonScene.getEngine();if(q.sparse||void 0==q.bufferView)q._babylonVertexBuffer[S]=this._loadFloatAccessorAsync(t,q).then((t=>new V.i(B,t,S,!1)));else{const o=c.Get(`${t}/bufferView`,this._gltf.bufferViews,q.bufferView);q._babylonVertexBuffer[S]=this._loadVertexBufferViewAsync(o).then((z=>{const L=g._GetNumComponents(t,q.type);return new V.i(B,z,S,!1,void 0,o.byteStride,void 0,q.byteOffset,L,q.componentType,q.normalized,!0,void 0,!0)}))}return q._babylonVertexBuffer[S]}_loadMaterialMetallicRoughnessPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return q&&(q.baseColorFactor?(S.albedoColor=z.c.ti(q.baseColorFactor),S.alpha=q.baseColorFactor[3]):S.albedoColor=z.c.White(),S.metallic=void 0==q.metallicFactor?1:q.metallicFactor,S.roughness=void 0==q.roughnessFactor?1:q.roughnessFactor,q.baseColorTexture&&o.push(this.loadTextureInfoAsync(`${t}/baseColorTexture`,q.baseColorTexture,(t=>{t.name=`${S.name} (Base Color)`,S.albedoTexture=t}))),q.metallicRoughnessTexture&&(q.metallicRoughnessTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${t}/metallicRoughnessTexture`,q.metallicRoughnessTexture,(t=>{t.name=`${S.name} (Metallic Roughness)`,S.metallicTexture=t}))),S.useMetallnessFromMetallicTextureBlue=!0,S.useRoughnessFromMetallicTextureGreen=!0,S.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(o).then((()=>{}))}_loadMaterialAsync(t,q,S,o){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const z=this._extensionsLoadMaterialAsync(t,q,S,o,B);if(z)return z;q._data=q._data||{};let L=q._data[o];if(!L){this.logOpen(`${t} ${q.name||""}`);const S=this.createMaterial(t,q,o);L={babylonMaterial:S,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,q,S)},q._data[o]=L,g.AddPointerMetadata(S,t),this._parent.onMaterialLoadedObservable.notifyObservers(S),this.logClose()}return S&&(L.babylonMeshes.push(S),S.Qi.addOnce((()=>{const t=L.babylonMeshes.indexOf(S);-1!==t&&L.babylonMeshes.splice(t,1)}))),B(L.babylonMaterial),L.promise.then((()=>L.babylonMaterial))}_createDefaultMaterial(t,q){this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new M.e(t,this._babylonScene);return S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.fillMode=q,S.enableSpecularAntiAliasing=!0,S.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,S.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,S.transparencyMode=M.e.PBRMATERIAL_OPAQUE,S.metallic=1,S.roughness=1,S}createMaterial(t,q,S){const o=this._extensionsCreateMaterial(t,q,S);if(o)return o;const B=q.name||`material${q.index}`;return this._createDefaultMaterial(B,S)}loadMaterialPropertiesAsync(t,q,S){const o=this._extensionsLoadMaterialPropertiesAsync(t,q,S);if(o)return o;const B=new Array;return B.push(this.loadMaterialBasePropertiesAsync(t,q,S)),q.pbrMetallicRoughness&&B.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${t}/pbrMetallicRoughness`,q.pbrMetallicRoughness,S)),this.loadMaterialAlphaProperties(t,q,S),Promise.all(B).then((()=>{}))}loadMaterialBasePropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return S.emissiveColor=q.emissiveFactor?z.c.ti(q.emissiveFactor):new z.c(0,0,0),q.doubleSided&&(S.Fi=!1,S.twoSidedLighting=!0),q.normalTexture&&(q.normalTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${t}/normalTexture`,q.normalTexture,(t=>{t.name=`${S.name} (Normal)`,S.bumpTexture=t}))),S.invertNormalMapX=!this._babylonScene.useRightHandedSystem,S.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=q.normalTexture.scale&&S.bumpTexture&&(S.bumpTexture.level=q.normalTexture.scale),S.forceIrradianceInFragment=!0),q.occlusionTexture&&(q.occlusionTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${t}/occlusionTexture`,q.occlusionTexture,(t=>{t.name=`${S.name} (Occlusion)`,S.ambientTexture=t}))),S.useAmbientInGrayScale=!0,void 0!=q.occlusionTexture.strength&&(S.ambientTextureStrength=q.occlusionTexture.strength)),q.emissiveTexture&&o.push(this.loadTextureInfoAsync(`${t}/emissiveTexture`,q.emissiveTexture,(t=>{t.name=`${S.name} (Emissive)`,S.emissiveTexture=t}))),Promise.all(o).then((()=>{}))}loadMaterialAlphaProperties(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);switch(q.alphaMode||"OPAQUE"){case"OPAQUE":S.transparencyMode=M.e.PBRMATERIAL_OPAQUE,S.alpha=1;break;case"MASK":S.transparencyMode=M.e.PBRMATERIAL_ALPHATEST,S.alphaCutOff=void 0==q.alphaCutoff?.5:q.alphaCutoff,S.albedoTexture&&(S.albedoTexture.Lj=!0);break;case"BLEND":S.transparencyMode=M.e.PBRMATERIAL_ALPHABLEND,S.albedoTexture&&(S.albedoTexture.Lj=!0,S.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${t}/alphaMode: Invalid value (${q.alphaMode})`)}}loadTextureInfoAsync(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureInfoAsync(t,q,S);if(o)return o;if(this.logOpen(`${t}`),q.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${q.texCoord})`);const B=c.Get(`${t}/index`,this._gltf.textures,q.index);B._textureInfo=q;const z=this._loadTextureAsync(`/textures/${q.index}`,B,(o=>{o.coordinatesIndex=q.texCoord||0,g.AddPointerMetadata(o,t),this._parent.onTextureLoadedObservable.notifyObservers(o),S(o)}));return this.logClose(),z}_loadTextureAsync(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureAsync(t,q,S);if(o)return o;this.logOpen(`${t} ${q.name||""}`);const B=void 0==q.sampler?g.DefaultSampler:c.Get(`${t}/sampler`,this._gltf.samplers,q.sampler),z=c.Get(`${t}/source`,this._gltf.images,q.source),L=this._createTextureAsync(t,B,z,S,void 0,!q._textureInfo.nonColorData);return this.logClose(),L}_createTextureAsync(t,q,S){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},z=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;const r=this._loadSampler(`/samplers/${q.index}`,q),e=new Array,C=new o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z={noMipmap:r.noMipMaps,invertY:!1,samplingMode:r.samplingMode,X:()=>{this._disposed||C.resolve()},onError:(q,S)=>{this._disposed||C.reject(new Error(`${t}: ${S&&S.message?S.message:q||"Failed to load texture"}`))},mimeType:S.mimeType??(0,G.h)(S.uri??""),loaderOptions:z,useSRGBBuffer:!!L&&this._parent.useSRGBBuffers},b=new x.b(null,this._babylonScene,Z);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.push(C.promise),e.push(this.loadImageAsync(`/images/${S.index}`,S).then((t=>{const q=S.uri||`${this._fileName}#image${S.index}`,o=`data:${this._uniqueRootUrl}${q}`;b.updateURL(o,t);const B=b.getInternalTexture();B&&(B.label=S.name)}))),b.wrapU=r.wrapU,b.wrapV=r.wrapV,B(b),this._parent.useGltfTextureNames&&(b.name=S.name||S.uri||`image${S.index}`),Promise.all(e).then((()=>b))}_loadSampler(t,q){return q._data||(q._data={noMipMaps:9728===q.minFilter||9729===q.minFilter,samplingMode:g._GetTextureSamplingMode(t,q),wrapU:g._GetTextureWrapMode(`${t}/wrapS`,q.wrapS),wrapV:g._GetTextureWrapMode(`${t}/wrapT`,q.wrapT)}),q._data}loadImageAsync(t,q){if(!q._data){if(this.logOpen(`${t} ${q.name||""}`),q.uri)q._data=this.loadUriAsync(`${t}/uri`,q,q.uri);else{const S=c.Get(`${t}/bufferView`,this._gltf.bufferViews,q.bufferView);q._data=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}this.logClose()}return q._data}loadUriAsync(t,q,S){const o=this._extensionsLoadUriAsync(t,q,S);if(o)return o;if(!g._ValidateUri(S))throw new Error(`${t}: '${S}' is invalid`);if((0,G.k)(S)){const q=new Uint8Array((0,G.b)(S));return this.log(`${t}: Decoded ${S.substring(0,64)}... (${q.length} bytes)`),Promise.resolve(q)}return this.log(`${t}: Loading ${S}`),this._parent.preprocessUrlAsync(this._rootUrl+S).then((q=>new Promise(((o,B)=>{this._parent._loadFile(this._babylonScene,q,(q=>{this._disposed||(this.log(`${t}: Loaded ${S} (${q.byteLength} bytes)`),o(new Uint8Array(q)))}),!0,(q=>{B(new G.m(`${t}: Failed to load '${S}'${q?": "+q.status+" "+q.statusText:""}`,q))}))}))))}static AddPointerMetadata(t,q){t.metadata=t.metadata||{};const S=t._internalMetadata=t._internalMetadata||{},o=S.Ni=S.Ni||{};(o.pointers=o.pointers||[]).push(q)}static _GetTextureWrapMode(t,q){switch(q=void 0==q?10497:q){case 33071:return x.b.CLAMP_ADDRESSMODE;case 33648:return x.b.MIRROR_ADDRESSMODE;case 10497:return x.b.WRAP_ADDRESSMODE;default:return l.c.Warn(`${t}: Invalid value (${q})`),x.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(t,q){const S=void 0==q.magFilter?9729:q.magFilter,o=void 0==q.minFilter?9987:q.minFilter;if(9729===S)switch(o){case 9728:return x.b.LINEAR_NEAREST;case 9729:return x.b.LINEAR_LINEAR;case 9984:return x.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return x.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return x.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return x.b.LINEAR_LINEAR_MIPLINEAR;default:return l.c.Warn(`${t}/minFilter: Invalid value (${o})`),x.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==S&&l.c.Warn(`${t}/magFilter: Invalid value (${S})`),o){case 9728:return x.b.NEAREST_NEAREST;case 9729:return x.b.NEAREST_LINEAR;case 9984:return x.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return x.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return x.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return x.b.NEAREST_LINEAR_MIPLINEAR;default:return l.c.Warn(`${t}/minFilter: Invalid value (${o})`),x.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(t,q){try{return(0,A.q)(q)}catch(S){throw new Error(`${t}: ${S.message}`)}}static _GetTypedArray(t,q,S,o,B){const z=S.buffer;o=S.byteOffset+(o||0);const L=g._GetTypedArrayConstructor(`${t}/componentType`,q),r=V.i.GetTypeByteLength(q);return o%r!==0?(l.c.Warn(`${t}: Copying buffer as byte offset (${o}) is not a multiple of component type byte length (${r})`),new L(z.slice(o,o+B*r),0)):new L(z,o,B)}static _GetNumComponents(t,q){switch(q){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${t}: Invalid type (${q})`)}static _ValidateUri(t){return L.f.IsBase64(t)||-1===t.indexOf("..")}static _GetDrawMode(t,q){switch(void 0==q&&(q=4),q){case 0:return v.c.PointListDrawMode;case 1:return v.c.LineListDrawMode;case 2:return v.c.LineLoopDrawMode;case 3:return v.c.LineStripDrawMode;case 4:return v.c.TriangleFillMode;case 5:return v.c.TriangleStripDrawMode;case 6:return v.c.TriangleFanDrawMode}throw new Error(`${t}: Invalid mesh primitive mode (${q})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const t=new Array;if(this._gltf.materials)for(const q of this._gltf.materials)if(q._data)for(const S in q._data){const o=q._data[S];for(const q of o.babylonMeshes){q.Ai(!0);const S=o.babylonMaterial;t.push(S.forceCompilationAsync(q)),t.push(S.forceCompilationAsync(q,{useInstances:!0})),this._parent.useClipPlane&&(t.push(S.forceCompilationAsync(q,{clipPlane:!0})),t.push(S.forceCompilationAsync(q,{clipPlane:!0,useInstances:!0})))}}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const t=new Array,q=this._babylonScene.lights;for(const S of q){const q=S.getShadowGenerator();q&&t.push(q.forceCompilationAsync())}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(t){for(const q of this._extensions)q.enabled&&t(q)}_applyExtensions(t,q,S){for(const o of this._extensions)if(o.enabled){const B=`${o.name}.${q}`,z=t;z._activeLoaderExtensionFunctions=z._activeLoaderExtensionFunctions||{};const L=z._activeLoaderExtensionFunctions;if(!L[B]){L[B]=!0;try{const t=S(o);if(t)return t}finally{delete L[B]}}}return null}_extensionsOnLoading(){this._forEachExtensions((t=>t.onLoading&&t.onLoading()))}_extensionsOnReady(){this._forEachExtensions((t=>t.onReady&&t.onReady()))}_extensionsLoadSceneAsync(t,q){return this._applyExtensions(q,"loadScene",(S=>S.loadSceneAsync&&S.loadSceneAsync(t,q)))}_extensionsLoadNodeAsync(t,q,S){return this._applyExtensions(q,"loadNode",(o=>o.loadNodeAsync&&o.loadNodeAsync(t,q,S)))}_extensionsLoadCameraAsync(t,q,S){return this._applyExtensions(q,"loadCamera",(o=>o.loadCameraAsync&&o.loadCameraAsync(t,q,S)))}_extensionsLoadVertexDataAsync(t,q,S){return this._applyExtensions(q,"loadVertexData",(o=>o._loadVertexDataAsync&&o._loadVertexDataAsync(t,q,S)))}_extensionsLoadMeshPrimitiveAsync(t,q,S,o,B,z){return this._applyExtensions(B,"loadMeshPrimitive",(L=>L._loadMeshPrimitiveAsync&&L._loadMeshPrimitiveAsync(t,q,S,o,B,z)))}_extensionsLoadMaterialAsync(t,q,S,o,B){return this._applyExtensions(q,"loadMaterial",(z=>z._loadMaterialAsync&&z._loadMaterialAsync(t,q,S,o,B)))}_extensionsCreateMaterial(t,q,S){return this._applyExtensions(q,"createMaterial",(o=>o.createMaterial&&o.createMaterial(t,q,S)))}_extensionsLoadMaterialPropertiesAsync(t,q,S){return this._applyExtensions(q,"loadMaterialProperties",(o=>o.loadMaterialPropertiesAsync&&o.loadMaterialPropertiesAsync(t,q,S)))}_extensionsLoadTextureInfoAsync(t,q,S){return this._applyExtensions(q,"loadTextureInfo",(o=>o.loadTextureInfoAsync&&o.loadTextureInfoAsync(t,q,S)))}_extensionsLoadTextureAsync(t,q,S){return this._applyExtensions(q,"loadTexture",(o=>o._loadTextureAsync&&o._loadTextureAsync(t,q,S)))}_extensionsLoadAnimationAsync(t,q){return this._applyExtensions(q,"loadAnimation",(S=>S.loadAnimationAsync&&S.loadAnimationAsync(t,q)))}_extensionsLoadAnimationChannelAsync(t,q,S,o,B){return this._applyExtensions(S,"loadAnimationChannel",(z=>z._loadAnimationChannelAsync&&z._loadAnimationChannelAsync(t,q,S,o,B)))}_extensionsLoadSkinAsync(t,q,S){return this._applyExtensions(S,"loadSkin",(o=>o._loadSkinAsync&&o._loadSkinAsync(t,q,S)))}_extensionsLoadUriAsync(t,q,S){return this._applyExtensions(q,"loadUri",(o=>o._loadUriAsync&&o._loadUriAsync(t,q,S)))}_extensionsLoadBufferViewAsync(t,q){return this._applyExtensions(q,"loadBufferView",(S=>S.loadBufferViewAsync&&S.loadBufferViewAsync(t,q)))}_extensionsLoadBufferAsync(t,q,S,o){return this._applyExtensions(q,"loadBuffer",(B=>B.loadBufferAsync&&B.loadBufferAsync(t,q,S,o)))}static LoadExtensionAsync(t,q,S,o){if(!q.extensions)return null;const B=q.extensions[S];return B?o(`${t}/extensions/${S}`,B):null}static LoadExtraAsync(t,q,S,o){if(!q.extras)return null;const B=q.extras[S];return B?o(`${t}/extras/${S}`,B):null}isExtensionUsed(t){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(t)}logOpen(t){this._parent._logOpen(t)}logClose(){this._parent._logClose()}log(t){this._parent._log(t)}startPerformanceCounter(t){this._parent._startPerformanceCounter(t)}endPerformanceCounter(t){this._parent._endPerformanceCounter(t)}}g.DefaultSampler={index:-1},X.d._CreateGLTF2Loader=t=>new g(t);var N=S(12891),T=S(2270),w=S(701),E=S(2423),p=S(12893);class P extends p.c{constructor(t,q,S){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",t),this._texture=t.getEngine().createRawCubeTexture(q,S,o,B,z,L,r,e)}update(t,q,S,o){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,t,q,S,o,B)}updateRGBDAsync(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,E.k)(this._texture,t,q,S,o).then((()=>{}))}clone(){return w.b.Clone((()=>{const t=this.va(),q=this._texture,S=new P(t,q._bufferViewArray,q.width,q.format,q.type,q.generateMipMaps,q.invertY,q.samplingMode,q._compression);return 13===q.source&&S.updateRGBDAsync(q._bufferViewArrayArray,q._sphericalPolynomial,q._lodGenerationScale,q._lodGenerationOffset),S}),this)}}const F="EXT_lights_image_based";class d{constructor(t){this.name=F,this._loader=t,this.enabled=this._loader.isExtensionUsed(F)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.Ni.extensions;if(t&&t[this.name]){const q=t[this.name];this._lights=q.lights}}loadSceneAsync(t,q){return g.LoadExtensionAsync(t,q,this.name,(async(S,o)=>{this._loader._allMaterialsDirtyRequired=!0;const B=new Array;B.push(this._loader.loadSceneAsync(t,q)),this._loader.logOpen(`${S}`);const z=c.Get(`${S}/light`,this._lights,o.ab);return B.push(this._loadLightAsync(`/extensions/${this.name}/lights/${o.ab}`,z).then((t=>{this._loader.babylonScene.environmentTexture=t}))),this._loader.logClose(),await Promise.all(B).then((()=>{}))}))}_loadLightAsync(t,q){if(!q._loaded){const S=new Array;this._loader.logOpen(`${t}`);const o=new Array(q.specularImages.length);for(let B=0;B<q.specularImages.length;B++){const z=q.specularImages[B];o[B]=new Array(z.length);for(let q=0;q<z.length;q++){const L=`${t}/specularImages/${B}/${q}`;this._loader.logOpen(`${L}`);const r=z[q],e=c.Get(L,this._loader.Ni.images,r);S.push(this._loader.loadImageAsync(`/images/${r}`,e).then((t=>{o[B][q]=t}))),this._loader.logClose()}}this._loader.logClose(),q._loaded=Promise.all(S).then((async()=>{const S=new P(this._loader.babylonScene,null,q.specularImageSize);if(S.name=q.name||"environment",q._babylonTexture=S,void 0!=q.bb&&(S.level=q.bb),q.rotation){let t=B.g.ti(q.rotation);this._loader.babylonScene.useRightHandedSystem||(t=B.g.Inverse(t)),B.e.FromQuaternionToRef(t,S.getReflectionTextureMatrix())}if(!q.irradianceCoefficients)throw new Error(`${t}: Irradiance coefficients are missing`);const z=T.e.ti(q.irradianceCoefficients);z.scaleInPlace(q.bb),z.convertIrradianceToLambertianRadiance();const L=T.h.FromHarmonics(z),r=(o.length-1)/Math.log2(q.specularImageSize);return await S.updateRGBDAsync(o,L,r)}))}return q._loaded.then((()=>q._babylonTexture))}}f(F),W(F,!0,(t=>new d(t)));S(480);const R="EXT_mesh_gpu_instancing";class tt{constructor(t){this.name=R,this._loader=t,this.enabled=this._loader.isExtensionUsed(R)}dispose(){this._loader=null}loadNodeAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(t,o)=>{this._loader._disableInstancedMesh++;const z=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,S);if(this._loader._disableInstancedMesh--,!q._primitiveBabylonMeshes)return await z;const L=new Array;let r=0;const e=q=>{if(void 0==o.attributes[q])return void L.push(Promise.resolve(null));const S=c.Get(`${t}/attributes/${q}`,this._loader.Ni.accessors,o.attributes[q]);if(L.push(this._loader._loadFloatAccessorAsync(`/accessors/${S.bufferView}`,S)),0===r)r=S.count;else if(r!==S.count)throw new Error(`${t}/attributes: Instance buffer accessors do not have the same count.`)};return e("TRANSLATION"),e("ROTATION"),e("SCALE"),await z.then((async t=>{const[S,o,z]=await Promise.all(L),e=new Float32Array(16*r);B.j.wi[0].ni(0,0,0),B.j.Quaternion[0].ni(0,0,0,1),B.j.wi[1].ni(1,1,1);for(let q=0;q<r;++q)S&&B.o.FromArrayToRef(S,3*q,B.j.wi[0]),o&&B.g.FromArrayToRef(o,4*q,B.j.Quaternion[0]),z&&B.o.FromArrayToRef(z,3*q,B.j.wi[1]),B.e.ComposeToRef(B.j.wi[1],B.j.Quaternion[0],B.j.wi[0],B.j.Matrix[0]),B.j.Matrix[0].copyToArray(e,16*q);for(const B of q._primitiveBabylonMeshes)B.ri("matrix",e,16,!0);return t}))}))}}f(R),W(R,!0,(t=>new tt(t)));let qt=0,St=null;class ot{static get Default(){return ot._Default||(ot._Default=new ot),ot._Default}constructor(){const t=ot.Configuration.decoder;this._decoderModulePromise=L.f.LoadBabylonScriptAsync(t.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(t,q,S,o,B){await this._decoderModulePromise,0===qt&&(MeshoptDecoder.useWorkers(1),qt=1);const z=await MeshoptDecoder.decodeGltfBufferAsync(q,S,t,o,B);return null!==St&&clearTimeout(St),St=setTimeout((()=>{MeshoptDecoder.useWorkers(0),qt=0,St=null}),1e3),z}}ot.Configuration={decoder:{url:`${L.f._DefaultCdnUrl}/meshopt_decoder.js`}},ot._Default=null;const Bt="EXT_meshopt_compression";class zt{constructor(t){this.name=Bt,this.enabled=t.isExtensionUsed(Bt),this._loader=t}dispose(){this._loader=null}loadBufferViewAsync(t,q){return g.LoadExtensionAsync(t,q,this.name,(async(S,o)=>{const B=q;if(B._meshOptData)return await B._meshOptData;const z=c.Get(`${t}/buffer`,this._loader.Ni.buffers,o.buffer);return B._meshOptData=this._loader.loadBufferAsync(`/buffers/${z.index}`,z,o.byteOffset||0,o.byteLength).then((async t=>await ot.Default.decodeGltfBufferAsync(t,o.count,o.byteStride,o.mode,o.filter))),await B._meshOptData}))}}f(Bt),W(Bt,!0,(t=>new zt(t)));const Lt="EXT_texture_webp";class rt{constructor(t){this.name=Lt,this._loader=t,this.enabled=t.isExtensionUsed(Lt)}dispose(){this._loader=null}_loadTextureAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=void 0==q.sampler?g.DefaultSampler:c.Get(`${t}/sampler`,this._loader.Ni.samplers,q.sampler),L=c.Get(`${o}/source`,this._loader.Ni.images,B.source);return await this._loader._createTextureAsync(t,z,L,(t=>{S(t)}),void 0,!q._textureInfo.nonColorData)}))}}f(Lt),W(Lt,!0,(t=>new rt(t)));const et="EXT_texture_avif";class Ct{constructor(t){this.name=et,this._loader=t,this.enabled=t.isExtensionUsed(et)}dispose(){this._loader=null}_loadTextureAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=void 0==q.sampler?g.DefaultSampler:c.Get(`${t}/sampler`,this._loader.Ni.samplers,q.sampler),L=c.Get(`${o}/source`,this._loader.Ni.images,B.source);return await this._loader._createTextureAsync(t,z,L,(t=>{S(t)}),void 0,!q._textureInfo.nonColorData)}))}}f(et),W(et,!0,(t=>new Ct(t)));var Zt=S(12883),bt=S(12037);const Ot="EXT_lights_ies";class it{constructor(t){this.name=Ot,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ot)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.Ni.extensions;if(t&&t[this.name]){const q=t[this.name];this._lights=q.lights,c.Assign(this._lights)}}loadNodeAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,L)=>{let r,e;this._loader._allMaterialsDirtyRequired=!0;const C=await this._loader.loadNodeAsync(t,q,(t=>{e=c.Get(o,this._lights,L.ab);const q=e.name||t.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,r=new Zt.e(q,B.o.Zero(),B.o.Backward(),0,1,this._loader.babylonScene),r.angle=Math.PI/2,r.innerAngle=0,r._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=r,r.falloffType=bt.b.FALLOFF_GLTF,r.cb=L.color?z.c.ti(L.color):z.c.White(),r.bb=L.multiplier||1,r.range=Number.MAX_VALUE,r.parent=t,this._loader._babylonLights.push(r),g.AddPointerMetadata(r,o),S(t)}));let Z;if(e.uri)Z=await this._loader.loadUriAsync(t,e,e.uri);else{const q=c.Get(`${t}/bufferView`,this._loader.Ni.bufferViews,e.bufferView);Z=await this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q)}return r.iesProfileTexture=new x.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,Z,!0,void 0,void 0,void 0,void 0,".ies"),C}))}}f(Ot),W(Ot,!0,(t=>new it(t)));var ht=S(12895);const lt="KHR_draco_mesh_compression";class It{constructor(t){this.name=lt,this.useNormalizedFlagFromAccessor=!0,this._loader=t,this.enabled=ht.e.DefaultAvailable&&this._loader.isExtensionUsed(lt)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{if(void 0!=q.mode&&4!==q.mode&&5!==q.mode)throw new Error(`${t}: Unsupported mode ${q.mode}`);const z={},L={},r=(t,o)=>{const r=B.attributes[t];if(void 0!=r&&(S._delayInfo=S._delayInfo||[],-1===S._delayInfo.indexOf(o)&&S._delayInfo.push(o),z[o]=r,this.useNormalizedFlagFromAccessor)){const S=c.TryGet(this._loader.Ni.accessors,q.attributes[t]);S&&(L[o]=S.normalized||!1)}};r("POSITION",V.i.PositionKind),r("NORMAL",V.i.NormalKind),r("TANGENT",V.i.TangentKind),r("TEXCOORD_0",V.i.UVKind),r("TEXCOORD_1",V.i.UV2Kind),r("TEXCOORD_2",V.i.UV3Kind),r("TEXCOORD_3",V.i.UV4Kind),r("TEXCOORD_4",V.i.UV5Kind),r("TEXCOORD_5",V.i.UV6Kind),r("JOINTS_0",V.i.MatricesIndicesKind),r("WEIGHTS_0",V.i.MatricesWeightsKind),r("COLOR_0",V.i.ColorKind);const e=c.Get(o,this._loader.Ni.bufferViews,B.bufferView);return e._dracoBabylonGeometry||(e._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((async o=>{const B=this.dracoDecoder||ht.e.Default,r=c.TryGet(this._loader.Ni.accessors,q.attributes.POSITION),e=this._loader.parent.alwaysComputeBoundingBox||S.skeleton||!r?null:s(r);return await B._decodeMeshToGeometryForGltfAsync(S.name,this._loader.babylonScene,o,z,L,e).catch((q=>{throw new Error(`${t}: ${q.message}`)}))}))),await e._dracoBabylonGeometry}))}}f(lt),W(lt,!0,(t=>new It(t)));var at=S(12901),vt=S(653),Mt=S(658),xt=S(698),kt=S(12094),Vt=S(622);xt.e.AddNodeConstructor("Light_Type_0",((t,q)=>()=>new Jt(t,B.o.Zero(),q)));class Jt extends kt.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(t){this._shadowAngle=t,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(t){const q=this.needCube();if(this._direction=t,this.needCube()!==q&&this._shadowGenerators){const t=this._shadowGenerators.values();for(let q=t.next();!0!==q.done;q=t.next()){q.value.recreateShadowMap()}}}constructor(t,q,S){super(t,S),this._shadowAngle=Math.PI/2,this.position=q}getClassName(){return"PointLight"}getTypeID(){return bt.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(t){if(this.direction)return super.getShadowDirection(t);switch(t){case 0:return new B.o(1,0,0);case 1:return new B.o(-1,0,0);case 2:return new B.o(0,-1,0);case 3:return new B.o(0,1,0);case 4:return new B.o(0,0,1);case 5:return new B.o(0,0,-1)}return B.o.Zero()}_setDefaultShadowProjectionMatrix(t,q,S){const o=this.va().activeCamera;if(!o)return;const z=void 0!==this.shadowMinZ?this.shadowMinZ:o.Ci,L=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,r=this.va().getEngine().useReverseDepthBuffer;B.e.PerspectiveFovLHToRef(this.shadowAngle,1,r?L:z,r?z:L,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,q){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,q):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,q),this}transferToNodeMaterialEffect(t,q){return this.computeTransformedInformation()?t.setFloat3(q,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):t.setFloat3(q,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(t,q){t["POINTLIGHT"+q]=!0}}(0,vt.e)([(0,Mt.C)()],Jt.prototype,"shadowAngle",null),(0,Vt.c)("BABYLON.PointLight",Jt);const Ut="KHR_lights_punctual";class Ht{constructor(t){this.name=Ut,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ut)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.Ni.extensions;if(t&&t[this.name]){const q=t[this.name];this._lights=q.lights,c.Assign(this._lights)}}loadNodeAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,L)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(t,q,(t=>{let q;const r=c.Get(o,this._lights,L.ab),e=r.name||t.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,r.type){case"directional":{const t=new at.b(e,B.o.Backward(),this._loader.babylonScene);t.position.ui(0),q=t;break}case"point":q=new Jt(e,B.o.Zero(),this._loader.babylonScene);break;case"spot":{const t=new Zt.e(e,B.o.Zero(),B.o.Backward(),0,1,this._loader.babylonScene);t.angle=2*(r.spot&&r.spot.outerConeAngle||Math.PI/4),t.innerAngle=2*(r.spot&&r.spot.innerConeAngle||0),q=t;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${o}: Invalid light type (${r.type})`)}q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,r._babylonLight=q,q.falloffType=bt.b.FALLOFF_GLTF,q.cb=r.color?z.c.ti(r.color):z.c.White(),q.bb=void 0==r.bb?1:r.bb,q.range=void 0==r.range?Number.MAX_VALUE:r.range,q.parent=t,this._loader._babylonLights.push(q),g.AddPointerMetadata(q,o),S(t)})))))}}f(Ut),W(Ut,!0,(t=>new Ht(t)));const jt="KHR_materials_pbrSpecularGlossiness";class yt{constructor(t){this.name=jt,this.order=200,this._loader=t,this.enabled=this._loader.isExtensionUsed(jt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialBasePropertiesAsync(t,q,S)),z.push(this._loadSpecularGlossinessPropertiesAsync(o,B,S)),this._loader.loadMaterialAlphaProperties(t,q,S),await Promise.all(z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return S.metallic=null,S.roughness=null,q.diffuseFactor?(S.albedoColor=z.c.ti(q.diffuseFactor),S.alpha=q.diffuseFactor[3]):S.albedoColor=z.c.White(),S.reflectivityColor=q.specularFactor?z.c.ti(q.specularFactor):z.c.White(),S.microSurface=void 0==q.glossinessFactor?1:q.glossinessFactor,q.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTexture`,q.diffuseTexture,(t=>{t.name=`${S.name} (Diffuse)`,S.albedoTexture=t}))),q.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync(`${t}/specularGlossinessTexture`,q.specularGlossinessTexture,(t=>{t.name=`${S.name} (Specular Glossiness)`,S.reflectivityTexture=t,S.reflectivityTexture.Lj=!0}))),S.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then((()=>{}))}}f(jt),W(jt,!0,(t=>new yt(t)));const Qt="KHR_materials_unlit";class Kt{constructor(t){this.name=Qt,this.order=210,this._loader=t,this.enabled=this._loader.isExtensionUsed(Qt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async()=>await this._loadUnlitPropertiesAsync(t,q,S)))}_loadUnlitPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;S.unlit=!0;const B=q.pbrMetallicRoughness;return B&&(B.baseColorFactor?(S.albedoColor=z.c.ti(B.baseColorFactor),S.alpha=B.baseColorFactor[3]):S.albedoColor=z.c.White(),B.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/baseColorTexture`,B.baseColorTexture,(t=>{t.name=`${S.name} (Base Color)`,S.albedoTexture=t})))),q.doubleSided&&(S.Fi=!1,S.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(t,q,S),Promise.all(o).then((()=>{}))}}f(Qt),W(Qt,!0,(t=>new Kt(t)));const Xt="KHR_materials_clearcoat";class Gt{constructor(t){this.name=Xt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(Xt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadClearCoatPropertiesAsync(o,B,S)),await Promise.all(z)}))}_loadClearCoatPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return S.clearCoat.isEnabled=!0,S.clearCoat.useRoughnessFromMainTexture=!1,S.clearCoat.remapF0OnInterfaceChange=!1,void 0!=q.clearcoatFactor?S.clearCoat.bb=q.clearcoatFactor:S.clearCoat.bb=0,q.clearcoatTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatTexture`,q.clearcoatTexture,(t=>{t.name=`${S.name} (ClearCoat)`,S.clearCoat.texture=t}))),void 0!=q.clearcoatRoughnessFactor?S.clearCoat.roughness=q.clearcoatRoughnessFactor:S.clearCoat.roughness=0,q.clearcoatRoughnessTexture&&(q.clearcoatRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatRoughnessTexture`,q.clearcoatRoughnessTexture,(t=>{t.name=`${S.name} (ClearCoat Roughness)`,S.clearCoat.textureRoughness=t})))),q.clearcoatNormalTexture&&(q.clearcoatNormalTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatNormalTexture`,q.clearcoatNormalTexture,(t=>{t.name=`${S.name} (ClearCoat Normal)`,S.clearCoat.bumpTexture=t}))),S.invertNormalMapX=!S.va().useRightHandedSystem,S.invertNormalMapY=S.va().useRightHandedSystem,void 0!=q.clearcoatNormalTexture.scale&&(S.clearCoat.bumpTexture.level=q.clearcoatNormalTexture.scale)),Promise.all(o).then((()=>{}))}}f(Xt),W(Xt,!0,(t=>new Gt(t)));const Yt="KHR_materials_iridescence";class nt{constructor(t){this.name=Yt,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(Yt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadIridescencePropertiesAsync(o,B,S)),await Promise.all(z).then((()=>{}))}))}_loadIridescencePropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return S.iridescence.isEnabled=!0,S.iridescence.bb=q.iridescenceFactor??0,S.iridescence.indexOfRefraction=q.iridescenceIor??q.iridescenceIOR??1.3,S.iridescence.minimumThickness=q.iridescenceThicknessMinimum??100,S.iridescence.maximumThickness=q.iridescenceThicknessMaximum??400,q.iridescenceTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceTexture`,q.iridescenceTexture,(t=>{t.name=`${S.name} (Iridescence)`,S.iridescence.texture=t}))),q.iridescenceThicknessTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceThicknessTexture`,q.iridescenceThicknessTexture,(t=>{t.name=`${S.name} (Iridescence Thickness)`,S.iridescence.thicknessTexture=t}))),Promise.all(o).then((()=>{}))}}f(Yt),W(Yt,!0,(t=>new nt(t)));const ut="KHR_materials_anisotropy";class Wt{constructor(t){this.name=ut,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(ut)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadIridescencePropertiesAsync(o,B,S)),await Promise.all(z)}))}async _loadIridescencePropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;S.anisotropy.isEnabled=!0,S.anisotropy.bb=q.anisotropyStrength??0,S.anisotropy.angle=q.anisotropyRotation??0,q.anisotropyTexture&&(q.anisotropyTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/anisotropyTexture`,q.anisotropyTexture,(t=>{t.name=`${S.name} (Anisotropy Intensity)`,S.anisotropy.texture=t})))),await Promise.all(o)}}f(ut),W(ut,!0,(t=>new Wt(t)));const ft="KHR_materials_emissive_strength";class Dt{constructor(t){this.name=ft,this.order=170,this._loader=t,this.enabled=this._loader.isExtensionUsed(ft)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>await this._loader.loadMaterialPropertiesAsync(t,q,S).then((()=>{this._loadEmissiveProperties(o,B,S)}))))}_loadEmissiveProperties(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);void 0!==q.emissiveStrength&&(S.emissiveIntensity=q.emissiveStrength)}}f(ft),W(ft,!0,(t=>new Dt(t)));const mt="KHR_materials_sheen";class At{constructor(t){this.name=mt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(mt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadSheenPropertiesAsync(o,B,S)),await Promise.all(z).then((()=>{}))}))}_loadSheenPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return S.sheen.isEnabled=!0,S.sheen.bb=1,void 0!=q.sheenColorFactor?S.sheen.color=z.c.ti(q.sheenColorFactor):S.sheen.color=z.c.Black(),q.sheenColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/sheenColorTexture`,q.sheenColorTexture,(t=>{t.name=`${S.name} (Sheen Color)`,S.sheen.texture=t}))),void 0!==q.sheenRoughnessFactor?S.sheen.roughness=q.sheenRoughnessFactor:S.sheen.roughness=0,q.sheenRoughnessTexture&&(q.sheenRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/sheenRoughnessTexture`,q.sheenRoughnessTexture,(t=>{t.name=`${S.name} (Sheen Roughness)`,S.sheen.textureRoughness=t})))),S.sheen.albedoScaling=!0,S.sheen.useRoughnessFromMainTexture=!1,Promise.all(o).then((()=>{}))}}f(mt),W(mt,!0,(t=>new At(t)));var ct=S(11932);const st="KHR_materials_specular";class gt{constructor(t){this.name=st,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(st)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;if(z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadSpecularPropertiesAsync(o,B,S)),B.extensions&&B.extensions.EXT_materials_specular_edge_color&&S instanceof M.e){B.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(S.brdf.dielectricSpecularModel=ct.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,S.brdf.conductorSpecularModel=ct.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(z).then((()=>{}))}))}_loadSpecularPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return void 0!==q.specularFactor&&(S.metallicF0Factor=q.specularFactor),void 0!==q.specularColorFactor&&(S.metallicReflectanceColor=z.c.ti(q.specularColorFactor)),q.specularTexture&&(q.specularTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${t}/specularTexture`,q.specularTexture,(t=>{t.name=`${S.name} (Specular)`,S.metallicReflectanceTexture=t,S.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),q.specularColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/specularColorTexture`,q.specularColorTexture,(t=>{t.name=`${S.name} (Specular Color)`,S.reflectanceTexture=t}))),Promise.all(o).then((()=>{}))}}f(st),W(st,!0,(t=>new gt(t)));const Nt="KHR_materials_ior";class Tt{constructor(t){this.name=Nt,this.order=180,this._loader=t,this.enabled=this._loader.isExtensionUsed(Nt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadIorPropertiesAsync(o,B,S)),await Promise.all(z).then((()=>{}))}))}_loadIorPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);return void 0!==q.ior?S.indexOfRefraction=q.ior:S.indexOfRefraction=Tt._DEFAULT_IOR,Promise.resolve()}}Tt._DEFAULT_IOR=1.5,f(Nt),W(Nt,!0,(t=>new Tt(t)));const wt="KHR_materials_variants";class Et{constructor(t){this.name=wt,this._loader=t,this.enabled=this._loader.isExtensionUsed(wt)}dispose(){this._loader=null}static GetAvailableVariants(t){const q=this._GetExtensionMetadata(t);return q?Object.keys(q.variants):[]}getAvailableVariants(t){return Et.GetAvailableVariants(t)}static SelectVariant(t,q){const S=this._GetExtensionMetadata(t);if(!S)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${wt} extension`);const o=t=>{const q=S.variants[t];if(q)for(const S of q)S.mesh.material=S.material};if(q instanceof Array)for(const B of q)o(B);else o(q);S.lastSelected=q}selectVariant(t,q){Et.SelectVariant(t,q)}static Reset(t){const q=this._GetExtensionMetadata(t);if(!q)throw new Error(`Cannot reset on a glTF mesh that does not have the ${wt} extension`);for(const S of q.original)S.mesh.material=S.material;q.lastSelected=null}reset(t){Et.Reset(t)}static GetLastSelectedVariant(t){const q=this._GetExtensionMetadata(t);if(!q)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${wt} extension`);return q.lastSelected}getLastSelectedVariant(t){return Et.GetLastSelectedVariant(t)}static _GetExtensionMetadata(t){var q,S;return(null===t||void 0===t||null===(q=t._internalMetadata)||void 0===q||null===(S=q.Ni)||void 0===S?void 0:S[wt])||null}onLoading(){const t=this._loader.Ni.extensions;if(t&&t[this.name]){const q=t[this.name];this._variants=q.variants}}onReady(){const t=this._loader.rootBabylonMesh;if(t){var q;const S=this._loader.parent.extensionOptions[wt];null!==S&&void 0!==S&&S.defaultVariant&&Et.SelectVariant(t,S.defaultVariant),null===S||void 0===S||null===(q=S.onLoaded)||void 0===q||q.call(S,{get variants(){return Et.GetAvailableVariants(t)},get selectedVariant(){const q=Et.GetLastSelectedVariant(t);return q?Array.isArray(q)?q[0]:q:Et.GetAvailableVariants(t)[0]},set selectedVariant(q){Et.SelectVariant(t,q)}})}}_loadMeshPrimitiveAsync(t,q,S,o,B,z){return g.LoadExtensionAsync(t,B,this.name,(async(L,r)=>{const e=new Array;return e.push(this._loader._loadMeshPrimitiveAsync(t,q,S,o,B,(q=>{if(z(q),q instanceof H.c){const S=g._GetDrawMode(t,B.mode),o=this._loader.rootBabylonMesh,z=o?o._internalMetadata=o._internalMetadata||{}:{},C=z.Ni=z.Ni||{},Z=C[wt]=C[wt]||{lastSelected:null,original:[],variants:{}};Z.original.push({mesh:q,material:q.material});for(let t=0;t<r.mappings.length;++t){const B=r.mappings[t],z=c.Get(`${L}/mappings/${t}/material`,this._loader.Ni.materials,B.material);e.push(this._loader._loadMaterialAsync(`#/materials/${B.material}`,z,q,S,(t=>{for(let S=0;S<B.variants.length;++S){const z=B.variants[S],L=c.Get(`/extensions/${wt}/variants/${z}`,this._variants,z);Z.variants[L.name]=Z.variants[L.name]||[],Z.variants[L.name].push({mesh:q,material:t}),q.onClonedObservable.add((t=>{const S=t;let B=null,z=S;do{if(z=z.parent,!z)return;B=Et._GetExtensionMetadata(z)}while(null===B);if(o&&B===Et._GetExtensionMetadata(o)){z._internalMetadata={};for(const t in o._internalMetadata)z._internalMetadata[t]=o._internalMetadata[t];z._internalMetadata.Ni=[];for(const t in o._internalMetadata.Ni)z._internalMetadata.Ni[t]=o._internalMetadata.Ni[t];z._internalMetadata.Ni[wt]={lastSelected:null,original:[],variants:{}};for(const t of B.original)z._internalMetadata.Ni[wt].original.push({mesh:t.mesh,material:t.material});for(const t in B.variants)if(Object.prototype.hasOwnProperty.call(B.variants,t)){z._internalMetadata.Ni[wt].variants[t]=[];for(const q of B.variants[t])z._internalMetadata.Ni[wt].variants[t].push({mesh:q.mesh,material:q.material})}B=z._internalMetadata.Ni[wt]}for(const o of B.original)o.mesh===q&&(o.mesh=S);for(const o of B.variants[L.name])o.mesh===q&&(o.mesh=S)}))}})))}}}))),await Promise.all(e).then((t=>{let[q]=t;return q}))}))}}f(wt),W(wt,!0,(t=>new Et(t)));var pt=S(2316);class Pt{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:ct.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(t,q){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Pt._GetDefaultOptions(),...t},this._scene=q,this._scene._transmissionHelper=this,this.onErrorObservable=new Z.b,this._scene.Qi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(t){if(!Object.keys(t).filter((q=>this._options[q]!==t[q])).length)return;const q={...this._options,...t},S=this._options;this._options=q,q.renderSize===S.renderSize&&q.renderTargetTextureType===S.renderTargetTextureType&&q.generateMipmaps===S.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=q.samples,this._opaqueRenderTarget.lodGenerationScale=q.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=q.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(t){return!!t&&!!(t instanceof M.e&&t.subSurface.isRefractionEnabled)}_addMesh(t){this._materialObservers[t.uniqueId]=t.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),L.f.SetImmediate((()=>{this._shouldRenderAsTransmission(t.material)?(t.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(t)&&this._transparentMeshesCache.push(t)):-1===this._opaqueMeshesCache.indexOf(t)&&this._opaqueMeshesCache.push(t)}))}_removeMesh(t){t.onMaterialChangedObservable.remove(this._materialObservers[t.uniqueId]),delete this._materialObservers[t.uniqueId];let q=this._transparentMeshesCache.indexOf(t);-1!==q&&this._transparentMeshesCache.splice(q,1),q=this._opaqueMeshesCache.indexOf(t),-1!==q&&this._opaqueMeshesCache.splice(q,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(t){const q=this._transparentMeshesCache.indexOf(t),S=this._opaqueMeshesCache.indexOf(t);this._shouldRenderAsTransmission(t.material)?(t.material instanceof M.e&&(t.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==S?(this._opaqueMeshesCache.splice(S,1),this._transparentMeshesCache.push(t)):-1===q&&this._transparentMeshesCache.push(t)):-1!==q?(this._transparentMeshesCache.splice(q,1),this._opaqueMeshesCache.push(t)):-1===S&&this._opaqueMeshesCache.push(t)}_isRenderTargetValid(){var t;return null!==(null===(t=this._opaqueRenderTarget)||void 0===t?void 0:t.getInternalTexture())}_setupRenderTargets(){var t;let q;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new pt.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(t=this._options.clearColor)||void 0===t?void 0:t.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((t=>{q=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?t.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(t.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=q}));for(const S of this._transparentMeshesCache)this._shouldRenderAsTransmission(S.material)&&(S.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Ft="KHR_materials_transmission";class dt{constructor(t){this.name=Ft,this.order=175,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ft),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadTransparentPropertiesAsync(o,q,S,B)),await Promise.all(z).then((()=>{}))}))}_loadTransparentPropertiesAsync(t,q,S,o){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const B=S;if(B.subSurface.isRefractionEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.useAlbedoToTintRefraction=!0,void 0===o.transmissionFactor)return B.subSurface.refractionIntensity=0,B.subSurface.isRefractionEnabled=!1,Promise.resolve();{var z;B.subSurface.refractionIntensity=o.transmissionFactor;const t=B.va();if(B.subSurface.refractionIntensity&&!t._transmissionHelper)new Pt({},B.va());else if(B.subSurface.refractionIntensity&&(null===(z=t._transmissionHelper)||void 0===z||!z._isRenderTargetValid())){var L;null===(L=t._transmissionHelper)||void 0===L||L._setupRenderTargets()}}return B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,o.transmissionTexture?(o.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/transmissionTexture`,o.transmissionTexture,void 0).then((t=>{t.name=`${S.name} (Transmission)`,B.subSurface.refractionIntensityTexture=t,B.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(Ft),W(Ft,!0,(t=>new dt(t)));const Rt="KHR_materials_diffuse_transmission";class tq{constructor(t){this.name=Rt,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(Rt),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadTranslucentPropertiesAsync(o,q,S,B)),await Promise.all(z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(t,q,S,o){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const B=S;if(B.subSurface.isTranslucencyEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,B.subSurface.useAlbedoToTintTranslucency=!1,void 0===o.diffuseTransmissionFactor)return B.subSurface.translucencyIntensity=0,B.subSurface.isTranslucencyEnabled=!1,Promise.resolve();B.subSurface.translucencyIntensity=o.diffuseTransmissionFactor;const L=new Array;return B.subSurface.useGltfStyleTextures=!0,o.diffuseTransmissionTexture&&(o.diffuseTransmissionTexture.nonColorData=!0,L.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionTexture`,o.diffuseTransmissionTexture).then((t=>{t.name=`${S.name} (Diffuse Transmission)`,B.subSurface.translucencyIntensityTexture=t})))),void 0!==o.diffuseTransmissionColorFactor?B.subSurface.translucencyColor=z.c.ti(o.diffuseTransmissionColorFactor):B.subSurface.translucencyColor=z.c.White(),o.diffuseTransmissionColorTexture&&L.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionColorTexture`,o.diffuseTransmissionColorTexture).then((t=>{t.name=`${S.name} (Diffuse Transmission Color)`,B.subSurface.translucencyColorTexture=t}))),Promise.all(L).then((()=>{}))}}f(Rt),W(Rt,!0,(t=>new tq(t)));const qq="KHR_materials_volume";class Sq{constructor(t){this.name=qq,this.order=173,this._loader=t,this.enabled=this._loader.isExtensionUsed(qq),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadVolumePropertiesAsync(o,q,S,B)),await Promise.all(z).then((()=>{}))}))}_loadVolumePropertiesAsync(t,q,S,o){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);if(!S.subSurface.isRefractionEnabled&&!S.subSurface.isTranslucencyEnabled||!o.thicknessFactor)return Promise.resolve();S.subSurface.volumeIndexOfRefraction=S.indexOfRefraction;const B=void 0!==o.attenuationDistance?o.attenuationDistance:Number.MAX_VALUE;return S.subSurface.tintColorAtDistance=B,void 0!==o.attenuationColor&&3==o.attenuationColor.length&&S.subSurface.tintColor.ni(o.attenuationColor[0],o.attenuationColor[1],o.attenuationColor[2]),S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=o.thicknessFactor,S.subSurface.useThicknessAsDepth=!0,o.thicknessTexture?(o.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/thicknessTexture`,o.thicknessTexture).then((t=>{t.name=`${S.name} (Thickness)`,S.subSurface.thicknessTexture=t,S.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(qq),W(qq,!0,(t=>new Sq(t)));const oq="KHR_materials_dispersion";class Bq{constructor(t){this.name=oq,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(oq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadDispersionPropertiesAsync(o,q,S,B)),await Promise.all(z).then((()=>{}))}))}_loadDispersionPropertiesAsync(t,q,S,o){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);return S.subSurface.isRefractionEnabled&&o.dispersion?(S.subSurface.isDispersionEnabled=!0,S.subSurface.dispersion=o.dispersion,Promise.resolve()):Promise.resolve()}}f(oq),W(oq,!0,(t=>new Bq(t)));const zq="EXT_materials_diffuse_roughness";class Lq{constructor(t){this.name=zq,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(zq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(t,q,S)),z.push(this._loadDiffuseRoughnessPropertiesAsync(o,B,S)),await Promise.all(z).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(t,q,S){if(!(S instanceof M.e))throw new Error(`${t}: Material type not supported`);const o=new Array;return S.brdf.baseDiffuseModel=ct.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=q.diffuseRoughnessFactor?S.baseDiffuseRoughness=q.diffuseRoughnessFactor:S.baseDiffuseRoughness=0,q.diffuseRoughnessTexture&&o.push(this._loader.loadTextureInfoAsync(`${t}/diffuseRoughnessTexture`,q.diffuseRoughnessTexture,(t=>{t.name=`${S.name} (Diffuse Roughness)`,S.baseDiffuseRoughnessTexture=t}))),Promise.all(o).then((()=>{}))}}f(zq),W(zq,!0,(t=>new Lq(t)));const rq="KHR_mesh_quantization";class eq{constructor(t){this.name=rq,this.enabled=t.isExtensionUsed(rq)}dispose(){}}f(rq),W(rq,!0,(t=>new eq(t)));const Cq="KHR_texture_basisu";class Zq{constructor(t){this.name=Cq,this._loader=t,this.enabled=t.isExtensionUsed(Cq)}dispose(){this._loader=null}_loadTextureAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>{const z=void 0==q.sampler?g.DefaultSampler:c.Get(`${t}/sampler`,this._loader.Ni.samplers,q.sampler),L=c.Get(`${o}/source`,this._loader.Ni.images,B.source);return await this._loader._createTextureAsync(t,z,L,(t=>{S(t)}),q._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!q._textureInfo.nonColorData)}))}}f(Cq),W(Cq,!0,(t=>new Zq(t)));const bq="KHR_texture_transform";class Oq{constructor(t){this.name=bq,this._loader=t,this.enabled=this._loader.isExtensionUsed(bq)}dispose(){this._loader=null}loadTextureInfoAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(o,B)=>await this._loader.loadTextureInfoAsync(t,q,(t=>{if(!(t instanceof x.b))throw new Error(`${o}: Texture type not supported`);B.offset&&(t.uOffset=B.offset[0],t.vOffset=B.offset[1]),t.uRotationCenter=0,t.vRotationCenter=0,B.rotation&&(t.wAng=-B.rotation),B.scale&&(t.uScale=B.scale[0],t.vScale=B.scale[1]),void 0!=B.texCoord&&(t.coordinatesIndex=B.texCoord),S(t)}))))}}f(bq),W(bq,!0,(t=>new Oq(t)));const iq="KHR_xmp_json_ld";class hq{constructor(t){this.name=iq,this.order=100,this._loader=t,this.enabled=this._loader.isExtensionUsed(iq)}dispose(){this._loader=null}onLoading(){var t,q,S;if(null===this._loader.rootBabylonMesh)return;const o=null===(t=this._loader.Ni.extensions)||void 0===t?void 0:t.KHR_xmp_json_ld,B=null===(q=this._loader.Ni.asset)||void 0===q||null===(S=q.extensions)||void 0===S?void 0:S.KHR_xmp_json_ld;if(o&&B){const t=+B.packet;o.packets&&t<o.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=o.packets[t])}}}function lq(t,q,S,o){return z.c.ti(q,S).scale(o)}function Iq(t,q,S,o){return q[S]*o}function aq(t,q,S,o){return-q[S]*o}function vq(t,q,S,o){return q[S+1]*o}function Mq(t,q,S,o){return q[S]*o*2}function xq(t){return{scale:[new Vq(O.b.ANIMATIONTYPE_FLOAT,`${t}.uScale`,Iq,(()=>2)),new Vq(O.b.ANIMATIONTYPE_FLOAT,`${t}.vScale`,vq,(()=>2))],offset:[new Vq(O.b.ANIMATIONTYPE_FLOAT,`${t}.uOffset`,Iq,(()=>2)),new Vq(O.b.ANIMATIONTYPE_FLOAT,`${t}.vOffset`,vq,(()=>2))],rotation:[new Vq(O.b.ANIMATIONTYPE_FLOAT,`${t}.wAng`,aq,(()=>1))]}}f(iq),W(iq,!0,(t=>new hq(t)));class kq extends N.AnimationPropertyInfo{buildAnimations(t,q,S,o){return[{babylonAnimatable:t._babylonCamera,babylonAnimation:this._buildAnimation(q,S,o)}]}}class Vq extends N.AnimationPropertyInfo{buildAnimations(t,q,S,o){const B=[];for(const z in t._data)B.push({babylonAnimatable:t._data[z].babylonMaterial,babylonAnimation:this._buildAnimation(q,S,o)});return B}}class Jq extends N.AnimationPropertyInfo{buildAnimations(t,q,S,o){return[{babylonAnimatable:t._babylonLight,babylonAnimation:this._buildAnimation(q,S,o)}]}}(0,D.i)("/cameras/{}/orthographic/xmag",[new kq(O.b.ANIMATIONTYPE_FLOAT,"orthoLeft",aq,(()=>1)),new kq(O.b.ANIMATIONTYPE_FLOAT,"orthoRight",vq,(()=>1))]),(0,D.i)("/cameras/{}/orthographic/ymag",[new kq(O.b.ANIMATIONTYPE_FLOAT,"orthoBottom",aq,(()=>1)),new kq(O.b.ANIMATIONTYPE_FLOAT,"orthoTop",vq,(()=>1))]),(0,D.i)("/cameras/{}/orthographic/zfar",[new kq(O.b.ANIMATIONTYPE_FLOAT,"maxZ",Iq,(()=>1))]),(0,D.i)("/cameras/{}/orthographic/znear",[new kq(O.b.ANIMATIONTYPE_FLOAT,"Ci",Iq,(()=>1))]),(0,D.i)("/cameras/{}/perspective/yfov",[new kq(O.b.ANIMATIONTYPE_FLOAT,"fov",Iq,(()=>1))]),(0,D.i)("/cameras/{}/perspective/zfar",[new kq(O.b.ANIMATIONTYPE_FLOAT,"maxZ",Iq,(()=>1))]),(0,D.i)("/cameras/{}/perspective/znear",[new kq(O.b.ANIMATIONTYPE_FLOAT,"Ci",Iq,(()=>1))]),(0,D.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Vq(O.b.ANIMATIONTYPE_COLOR3,"albedoColor",lq,(()=>4)),new Vq(O.b.ANIMATIONTYPE_FLOAT,"alpha",(function(t,q,S,o){return q[S+3]*o}),(()=>4))]),(0,D.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"metallic",Iq,(()=>1))]),(0,D.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"roughness",Iq,(()=>1))]);const Uq=xq("albedoTexture");(0,D.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Uq.scale),(0,D.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Uq.offset),(0,D.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Uq.rotation);const Hq=xq("metallicTexture");(0,D.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Hq.scale),(0,D.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Hq.offset),(0,D.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Hq.rotation),(0,D.i)("/materials/{}/emissiveFactor",[new Vq(O.b.ANIMATIONTYPE_COLOR3,"emissiveColor",lq,(()=>3))]);const jq=xq("bumpTexture");(0,D.i)("/materials/{}/normalTexture/scale",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Iq,(()=>1))]),(0,D.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",jq.scale),(0,D.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",jq.offset),(0,D.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",jq.rotation),(0,D.i)("/materials/{}/occlusionTexture/strength",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Iq,(()=>1))]);const yq=xq("ambientTexture");(0,D.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",yq.scale),(0,D.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",yq.offset),(0,D.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",yq.rotation);const Qq=xq("emissiveTexture");(0,D.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Qq.scale),(0,D.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Qq.offset),(0,D.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Qq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Iq,(()=>1))]);const Kq=xq("anisotropy.texture");(0,D.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Kq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Kq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Kq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Iq,(()=>1))]);const Xq=xq("clearCoat.texture");(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Xq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Xq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Xq.rotation);const Gq=xq("clearCoat.bumpTexture");(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Gq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Gq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Gq.rotation);const Yq=xq("clearCoat.textureRoughness");(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Yq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Yq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Yq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Iq,(()=>1))]);const nq=xq("iridescence.texture");(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",nq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",nq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",nq.rotation);const uq=xq("iridescence.thicknessTexture");(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",uq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",uq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",uq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Vq(O.b.ANIMATIONTYPE_COLOR3,"sheen.color",lq,(()=>3))]),(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Iq,(()=>1))]);const Wq=xq("sheen.texture");(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Wq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Wq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Wq.rotation);const fq=xq("sheen.textureRoughness");(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",fq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",fq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",fq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Vq(O.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",lq,(()=>3))]);const Dq=xq("metallicReflectanceTexture");(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Dq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Dq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Dq.rotation);const mq=xq("reflectanceTexture");(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",mq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",mq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",mq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Iq,(()=>1))]);const Aq=xq("subSurface.refractionIntensityTexture");(0,D.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Aq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Aq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Aq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Vq(O.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",lq,(()=>3))]),(0,D.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Iq,(()=>1))]),(0,D.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Iq,(()=>1))]);const cq=xq("subSurface.thicknessTexture");(0,D.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",cq.scale),(0,D.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",cq.offset),(0,D.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",cq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Vq(O.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Iq,(()=>1))]);const sq=xq("subSurface.translucencyIntensityTexture");(0,D.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",sq.scale),(0,D.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",sq.offset),(0,D.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",sq.rotation),(0,D.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Vq(O.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",lq,(()=>3))]);const gq=xq("subSurface.translucencyColorTexture");(0,D.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",gq.scale),(0,D.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",gq.offset),(0,D.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",gq.rotation),(0,D.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new Jq(O.b.ANIMATIONTYPE_COLOR3,"diffuse",lq,(()=>3))]),(0,D.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Jq(O.b.ANIMATIONTYPE_FLOAT,"intensity",Iq,(()=>1))]),(0,D.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new Jq(O.b.ANIMATIONTYPE_FLOAT,"range",Iq,(()=>1))]),(0,D.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Jq(O.b.ANIMATIONTYPE_FLOAT,"innerAngle",Mq,(()=>1))]),(0,D.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Jq(O.b.ANIMATIONTYPE_FLOAT,"angle",Mq,(()=>1))]),(0,D.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new Jq(O.b.ANIMATIONTYPE_COLOR3,"diffuse",lq,(()=>3))]),(0,D.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Jq(O.b.ANIMATIONTYPE_FLOAT,"intensity",Iq,(()=>1))]);const Nq="KHR_animation_pointer";class Tq{constructor(t){this.name=Nq,this._loader=t,this._pathToObjectConverter=(0,D.g)(this._loader.Ni)}get enabled(){return this._loader.isExtensionUsed(Nq)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(t,q,S,o,B){var z;const L=null===(z=o.target.extensions)||void 0===z?void 0:z.KHR_animation_pointer;if(!L||!this._pathToObjectConverter)return null;"pointer"!==o.target.path&&l.c.Warn(`${t}/target/path: Value (${o.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=o.target.node&&l.c.Warn(`${t}/target/node: Value (${o.target.node}) must not be present when using the ${this.name} extension`);const r=`${t}/extensions/${this.name}`,e=L.pointer;if(!e)throw new Error(`${r}: Pointer is missing`);try{const z=this._pathToObjectConverter.convert(e);if(!z.info.interpolation)throw new Error(`${r}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(t,q,S,o,{object:z.object,info:z.info.interpolation},B)}catch(C){return l.c.Warn(`${r}/pointer: Invalid pointer (${e}) skipped`),null}}}f(Nq),W(Nq,!0,(t=>new Tq(t)));class wq{constructor(t,q,S){this.frame=t,this.action=q,this.onlyOnce=S,this.isDone=!1}_clone(){return new wq(this.frame,this.action,this.onlyOnce)}}var Eq=S(518),pq=S(561),Pq=S(555);class Fq{get loop(){return this._loop}set loop(t){t!==this._loop&&(this._loop=t,this.updateOptions({loop:t}))}get currentTime(){var t;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(t=pq.c.audioEngine)&&void 0!==t&&t.audioContext&&(this.isPlaying||this.isPaused)){const t=this.isPaused?0:pq.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+t}return 0}get spatialSound(){return this._spatialSound}set spatialSound(t){if(t==this._spatialSound)return;const q=this.isPlaying;this.pause(),t?(this._spatialSound=t,this._updateSpatialParameters()):this._disableSpatialSound(),q&&this.play()}constructor(t,q,S){var o;let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Z.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=B.o.Zero(),this._localDirection=new B.o(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,S=S||h.b.LastCreatedScene)if(this._scene=S,Fq._SceneComponentInitialization(S),this._readyToPlayCallback=z,this._customAttenuationFunction=(t,q,S,o,B)=>q<S?t*(1-q/S):0,r&&(this.autoplay=r.autoplay||!1,this._loop=r.loop||!1,void 0!==r.volume&&(this._volume=r.volume),this._spatialSound=r.spatialSound??!1,this.maxDistance=r.maxDistance??100,this.useCustomAttenuation=r.useCustomAttenuation??!1,this.rolloffFactor=r.rolloffFactor||1,this.refDistance=r.refDistance||1,this.distanceModel=r.distanceModel||"linear",this._playbackRate=r.playbackRate||1,this._streaming=r.streaming??!1,this._length=r.length,this._offset=r.offset),null!==(o=pq.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&pq.c.audioEngine.audioContext){this._soundGain=pq.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let t=!0;if(q)try{"string"===typeof q?(this._urlType="String",this._url=q):q instanceof ArrayBuffer?this._urlType="ArrayBuffer":q instanceof HTMLMediaElement?this._urlType="MediaElement":q instanceof MediaStream?this._urlType="MediaStream":q instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(q)&&(this._urlType="Array");let S=[],o=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=pq.c.audioEngine.audioContext.createMediaElementSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=pq.c.audioEngine.audioContext.createMediaStreamSource(q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":q.byteLength>0&&(o=!0,this._soundLoaded(q));break;case"AudioBuffer":this._audioBufferLoaded(q);break;case"String":S.push(q);case"Array":0===S.length&&(S=q);for(let t=0;t<S.length;t++){const q=S[t];if(o=r&&r.skipCodecCheck||-1!==q.indexOf(".mp3",q.length-4)&&pq.c.audioEngine.isMP3supported||-1!==q.indexOf(".ogg",q.length-4)&&pq.c.audioEngine.isOGGsupported||-1!==q.indexOf(".wav",q.length-4)||-1!==q.indexOf(".m4a",q.length-4)||-1!==q.indexOf(".mp4",q.length-4)||-1!==q.indexOf("blob:"),o){this._streaming?(this._htmlAudioElement=new Audio(q),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,L.f.SetCorsBehavior(q,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(q,(t=>{this._soundLoaded(t)}),void 0,!0,!0,(t=>{t&&l.c.Error("XHR "+t.status+" error on: "+q+"."),l.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:t=!1}t?o||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):l.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){l.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),pq.c.audioEngine&&!pq.c.audioEngine.WarnedWebAudioUnsupported&&(l.c.Error("Web Audio is not supported by your browser."),pq.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var t;null!==(t=pq.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(t){var q;null!==(q=pq.c.audioEngine)&&void 0!==q&&q.audioContext&&(this._audioBuffer=t,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(t){var q;null!==(q=pq.c.audioEngine)&&void 0!==q&&q.audioContext&&pq.c.audioEngine.audioContext.decodeAudioData(t,(t=>{this._audioBufferLoaded(t)}),(t=>{l.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+t)}))}setAudioBuffer(t){var q;null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)}updateOptions(t){t&&(this.loop=t.loop??this.loop,this.maxDistance=t.maxDistance??this.maxDistance,this.useCustomAttenuation=t.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=t.rolloffFactor??this.rolloffFactor,this.refDistance=t.refDistance??this.refDistance,this.distanceModel=t.distanceModel??this.distanceModel,this._playbackRate=t.playbackRate??this._playbackRate,this._length=t.length??void 0,this.spatialSound=t.spatialSound??this._spatialSound,this._setOffset(t.offset??void 0),this.setVolume(t.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var t;null!==(t=pq.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&pq.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??pq.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var t;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(t=this._soundPanner)||void 0===t||t.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var t;null!==(t=pq.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(t){var q;null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)}setDirectionalCone(t,q,S){q<t?l.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=q,this._coneOuterGain=S,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!=this._coneInnerAngle){var q;if(this._coneOuterAngle<t)return void l.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!=this._coneOuterAngle){var q;if(t<this._coneInnerAngle)return void l.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(t){var q;t.equals(this._position)||(this._position.p(t),null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(t){var q;this._localDirection=t,null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const t=this._connectedTransformNode.getWorldMatrix(),q=B.o.TransformNormal(this._localDirection,t);q.normalize(),this._soundPanner.orientationX.value=q.x,this._soundPanner.orientationY.value=q.y,this._soundPanner.orientationZ.value=q.z}updateDistanceFromListener(){var t;if(null!==(t=pq.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const t=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Kg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(t){this._customAttenuationFunction=t}play(t,q,S){var o;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(o=pq.c.audioEngine)&&void 0!==o&&o.audioContext)try{var B,z;this._clearTimeoutsAndObservers();let o=t?(null===(B=pq.c.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+t:null===(z=pq.c.audioEngine)||void 0===z?void 0:z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=pq.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const t=()=>{var S;if(null!==(S=pq.c.audioEngine)&&void 0!==S&&S.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=q??0;const S=this._htmlAudioElement.play();void 0!==S&&S.catch((()=>{var q,S;(null===(q=pq.c.audioEngine)||void 0===q||q.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(S=pq.c.audioEngine)||void 0===S?void 0:S.onAudioUnlockedObservable.addOnce((()=>{t()})))}))}else{var o;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(o=pq.c.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{t()}))}};t()}}else{var L;const B=()=>{var B;if(null!==(B=pq.c.audioEngine)&&void 0!==B&&B.audioContext){var z;if(S=S||this._length,void 0!==q&&this._setOffset(q),this._soundSource){const t=this._soundSource;t.onended=()=>{t.disconnect()}}if(this._soundSource=null===(z=pq.c.audioEngine)||void 0===z?void 0:z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var L;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==q&&(this._soundSource.loopStart=q),void 0!==S&&(this._soundSource.loopEnd=(0|q)+S),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},o=t?(null===(L=pq.c.audioEngine)||void 0===L?void 0:L.audioContext.currentTime)+t:pq.c.audioEngine.audioContext.currentTime;const B=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(o,B,this.loop?void 0:S)}}};"suspended"===(null===(L=pq.c.audioEngine)||void 0===L?void 0:L.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var t;"suspended"===(null===(t=pq.c.audioEngine)||void 0===t?void 0:t.audioContext.state)?(pq.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=pq.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{B()})))):B()}),500):B()}this._startTime=o,this.isPlaying=!0,this.isPaused=!1}catch(r){l.c.Error("Error while trying to play audio: "+this.name+", "+r.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(t){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var S;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(S=this._streamingSource)||void 0===S||S.disconnect();this.isPlaying=!1}else if(null!==(q=pq.c.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource){const q=t?pq.c.audioEngine.audioContext.currentTime+t:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(q)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var t;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var q;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(q=this._streamingSource)||void 0===q||q.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(t=pq.c.audioEngine)&&void 0!==t&&t.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=pq.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(t,q){var S;null!==(S=pq.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._soundGain&&(q&&pq.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(pq.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,pq.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,pq.c.audioEngine.audioContext.currentTime+q)):this._soundGain.gain.value=t),this._volume=t}setPlaybackRate(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(t){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=t=>this._onRegisterAfterWorldMatrixUpdate(t),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(t){var q;if(t.getBoundingInfo){const q=t.getBoundingInfo();this.setPosition(q.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const t=()=>{(0,Pq.g)((()=>this._isReadyToPlay),(()=>{S._audioBuffer=this.getAudioBuffer(),S._isReadyToPlay=!0,S.autoplay&&S.play(0,this._offset,this._length)}),void 0,300)},q={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},S=new Fq(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,q);return this.useCustomAttenuation&&S.setAttenuationFunction(this._customAttenuationFunction),S.setPosition(this._position),S.setPlaybackRate(this._playbackRate),t(),S}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const t={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.Gi(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.Gi(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t}static Parse(t,q,S,o){const z=t.name;let L;L=t.url?S+t.url:S+z;const r={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};let e;if(o){const t=()=>{(0,Pq.g)((()=>o._isReadyToPlay),(()=>{e._audioBuffer=o.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play(0,e._offset,e._length)}),void 0,300)};e=new Fq(z,new ArrayBuffer(0),q,null,r),t()}else e=new Fq(z,L,q,(()=>{q.removePendingData(e)}),r),q.addPendingData(e);if(t.position){const q=B.o.ti(t.position);e.setPosition(q)}if(t.isDirectional&&(e.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){const q=B.o.ti(t.localDirectionToMesh);e.setLocalDirectionToMesh(q)}if(t.connectedMeshId){const S=q.getMeshById(t.connectedMeshId);S&&e.attachToMesh(S)}return t.metadata&&(e.metadata=t.metadata),e}_setOffset(t){this._offset!==t&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=t)}_clearTimeoutsAndObservers(){var t;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(t=pq.c.audioEngine)||void 0===t||t.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Fq._SceneComponentInitialization=t=>{throw(0,Eq.d)("AudioSceneComponent")},(0,Vt.c)("BABYLON.Sound",Fq);class dq{constructor(t,q,S){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],q.length!==S.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=S;let o=0;for(const z of S)o+=z;const B=o>0?1/o:0;for(let z=0;z<this._weights.length;z++)this._weights[z]*=B;this._sounds=q;for(const z of this._sounds)z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void l.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(const q of this._sounds)q.directionalConeInnerAngle=t}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void l.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(const q of this._sounds)q.directionalConeOuterAngle=t}}get volume(){return this._volume}set volume(t){if(t!==this._volume)for(const q of this._sounds)q.setVolume(t)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(t){if(!this.isPaused){this.stop();const t=Math.random();let q=0;for(let S=0;S<this._weights.length;S++)if(q+=this._weights[S],t<=q){this._currentIndex=S;break}}const q=this._sounds[this._currentIndex??0];q.isReady()?q.play(0,this.isPaused?void 0:t):q.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Rq{constructor(t){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(t=t||h.b.LastCreatedScene)&&(this._scene=t,this.soundCollection=[],this._options=q,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var t;null!==(t=pq.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&pq.c.audioEngine.audioContext&&(this._outputAudioNode=pq.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(pq.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(pq.c.audioEngine&&pq.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(t){var q;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id}removeSound(t){const q=this.soundCollection.indexOf(t);-1!==q&&this.soundCollection.splice(q,1)}setVolume(t){var q;null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)}switchPanningModelToHRTF(){var t;if(null!==(t=pq.c.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var t;if(null!==(t=pq.c.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let q=0;q<this.soundCollection.length;q++)this.soundCollection[q].switchPanningModelToEqualPower()}connectToAnalyser(t){var q;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,null!==(q=pq.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,pq.c.audioEngine.masterGain))}}var tS=S(842),qS=S(2428),SS=S(493);pq.c.AudioEngineFactory=(t,q,S)=>new oS(t,q,S);class oS{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Z.b,this.onAudioLockedObservable=new Z.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,SS.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const o=document.createElement("audio");this._hostElement=t,this._audioContext=q,this._audioDestination=S;try{o&&o.canPlayType&&(o.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||o.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(B){}try{o&&o.canPlayType&&o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(B){}}lock(){this._triggerSuspendedState()}unlock(){var t,q;if("running"===(null===(t=this._audioContext)||void 0===t?void 0:t.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(q=this._audioContext)||void 0===q||q.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{l.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var t;null===(t=this._audioContext)||void 0===t||t.addEventListener("statechange",(()=>{var t;this.unlocked&&"running"!==(null===(t=this._audioContext)||void 0===t?void 0:t.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var t;return null!==(t=this._audioContext)&&void 0!==t&&t.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(t){this.canUseWebAudio=!1,l.c.Error("Web Audio: "+t.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(t){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const t=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",q=document.createElement("style");q.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(q),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var t;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(t=this._audioContext)||void 0===t||t.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var BS=S(510);(0,S(12611).f)(tS.e.NAME_AUDIO,((t,q,S,o)=>{let B,z=[];if(S.rm=S.rm||[],void 0!==t.rm&&null!==t.rm)for(let r=0,e=t.rm.length;r<e;r++){var L;const e=t.rm[r];null!==(L=pq.c.audioEngine)&&void 0!==L&&L.canUseWebAudio?(e.url||(e.url=e.name),z[e.url]?S.rm.push(Fq.Parse(e,q,o,z[e.url])):(B=Fq.Parse(e,q,o),z[e.url]=B,S.rm.push(B))):S.rm.push(new Fq(e.name,null,q))}z=[]})),Object.defineProperty(qS.d.prototype,"mainSoundTrack",{get:function(){let t=this._getComponent(tS.e.NAME_AUDIO);return t||(t=new zS(this),this.o(t)),this._mainSoundTrack||(this._mainSoundTrack=new Rq(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),qS.d.prototype.getSoundByName=function(t){let q;for(q=0;q<this.mainSoundTrack.soundCollection.length;q++)if(this.mainSoundTrack.soundCollection[q].name===t)return this.mainSoundTrack.soundCollection[q];if(this.soundTracks)for(let S=0;S<this.soundTracks.length;S++)for(q=0;q<this.soundTracks[S].soundCollection.length;q++)if(this.soundTracks[S].soundCollection[q].name===t)return this.soundTracks[S].soundCollection[q];return null},Object.defineProperty(qS.d.prototype,"audioEnabled",{get:function(){let t=this._getComponent(tS.e.NAME_AUDIO);return t||(t=new zS(this),this.o(t)),t.audioEnabled},set:function(t){let q=this._getComponent(tS.e.NAME_AUDIO);q||(q=new zS(this),this.o(q)),t?q.enableAudio():q.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(qS.d.prototype,"headphone",{get:function(){let t=this._getComponent(tS.e.NAME_AUDIO);return t||(t=new zS(this),this.o(t)),t.headphone},set:function(t){let q=this._getComponent(tS.e.NAME_AUDIO);q||(q=new zS(this),this.o(q)),t?q.switchAudioModeForHeadphones():q.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(qS.d.prototype,"audioListenerPositionProvider",{get:function(){let t=this._getComponent(tS.e.NAME_AUDIO);return t||(t=new zS(this),this.o(t)),t.audioListenerPositionProvider},set:function(t){let q=this._getComponent(tS.e.NAME_AUDIO);if(q||(q=new zS(this),this.o(q)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");q.audioListenerPositionProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(qS.d.prototype,"audioListenerRotationProvider",{get:function(){let t=this._getComponent(tS.e.NAME_AUDIO);return t||(t=new zS(this),this.o(t)),t.audioListenerRotationProvider},set:function(t){let q=this._getComponent(tS.e.NAME_AUDIO);if(q||(q=new zS(this),this.o(q)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");q.audioListenerRotationProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(qS.d.prototype,"audioPositioningRefreshRate",{get:function(){let t=this._getComponent(tS.e.NAME_AUDIO);return t||(t=new zS(this),this.o(t)),t.audioPositioningRefreshRate},set:function(t){let q=this._getComponent(tS.e.NAME_AUDIO);q||(q=new zS(this),this.o(q)),q.audioPositioningRefreshRate=t},enumerable:!0,configurable:!0});class zS{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(t){this.name=tS.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new B.o,this._cachedCameraPosition=new B.o,this._lastCheck=0,this._invertMatrixTemp=new B.e,this._cameraDirectionTemp=new B.o,(t=t||h.b.LastCreatedScene)&&(this.Tk=t,t.soundTracks=[],t.rm=[])}register(){this.Tk._afterRenderStage.registerStep(tS.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(t){if(t.rm=[],this.Tk.soundTracks)for(let q=0;q<this.Tk.soundTracks.length;q++){const S=this.Tk.soundTracks[q];for(let q=0;q<S.soundCollection.length;q++)t.rm.push(S.soundCollection[q].serialize())}}addFromContainer(t){if(t.rm)for(const q of t.rm)q.play(),q.autoplay=!0,this.Tk.mainSoundTrack.addSound(q)}removeFromContainer(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.rm)for(const S of t.rm)S.stop(),S.autoplay=!1,this.Tk.mainSoundTrack.removeSound(S),q&&S.dispose()}dispose(){const t=this.Tk;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(let q=0;q<t.soundTracks.length;q++)t.soundTracks[q].dispose()}disableAudio(){const t=this.Tk;let q;for(this._audioEnabled=!1,pq.c.audioEngine&&pq.c.audioEngine.audioContext&&pq.c.audioEngine.audioContext.suspend(),q=0;q<t.mainSoundTrack.soundCollection.length;q++)t.mainSoundTrack.soundCollection[q].pause();if(t.soundTracks)for(q=0;q<t.soundTracks.length;q++)for(let S=0;S<t.soundTracks[q].soundCollection.length;S++)t.soundTracks[q].soundCollection[S].pause()}enableAudio(){const t=this.Tk;let q;for(this._audioEnabled=!0,pq.c.audioEngine&&pq.c.audioEngine.audioContext&&pq.c.audioEngine.audioContext.resume(),q=0;q<t.mainSoundTrack.soundCollection.length;q++)t.mainSoundTrack.soundCollection[q].isPaused&&t.mainSoundTrack.soundCollection[q].play();if(t.soundTracks)for(q=0;q<t.soundTracks.length;q++)for(let S=0;S<t.soundTracks[q].soundCollection.length;S++)t.soundTracks[q].soundCollection[S].isPaused&&t.soundTracks[q].soundCollection[S].play()}switchAudioModeForHeadphones(){const t=this.Tk;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(let q=0;q<t.soundTracks.length;q++)t.soundTracks[q].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const t=this.Tk;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(let q=0;q<t.soundTracks.length;q++)t.soundTracks[q].switchPanningModelToEqualPower()}_afterRender(){const t=BS.e.Now;if(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=t;const q=this.Tk;if(!this._audioEnabled||!q._mainSoundTrack||!q.soundTracks||0===q._mainSoundTrack.soundCollection.length&&1===q.soundTracks.length)return;const S=pq.c.audioEngine;if(S&&S.audioContext){let t,o=q.activeCamera;if(q.activeCameras&&q.activeCameras.length>0&&(o=q.activeCameras[0]),this.audioListenerPositionProvider){const t=this.audioListenerPositionProvider();S.audioContext.listener.setPosition(t.x||0,t.y||0,t.z||0)}else o?this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.p(o.globalPosition),S.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)):S.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const t=this.audioListenerRotationProvider();S.audioContext.listener.setOrientation(t.x||0,t.y||0,t.z||0,0,1,0)}else o?(o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]),o.getViewMatrix().invertToRef(this._invertMatrixTemp),B.o.TransformNormalToRef(zS._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),S.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):S.audioContext.listener.setOrientation(0,0,0,0,1,0);for(t=0;t<q.mainSoundTrack.soundCollection.length;t++){const S=q.mainSoundTrack.soundCollection[t];S.useCustomAttenuation&&S.updateDistanceFromListener()}if(q.soundTracks)for(t=0;t<q.soundTracks.length;t++)for(let S=0;S<q.soundTracks[t].soundCollection.length;S++){const o=q.soundTracks[t].soundCollection[S];o.useCustomAttenuation&&o.updateDistanceFromListener()}}}}zS._CameraDirection=new B.o(0,0,-1),Fq._SceneComponentInitialization=t=>{let q=t._getComponent(tS.e.NAME_AUDIO);q||(q=new zS(t),t.o(q))};const LS="MSFT_audio_emitter";class rS{constructor(t){this.name=LS,this._loader=t,this.enabled=this._loader.isExtensionUsed(LS)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const t=this._loader.Ni.extensions;if(t&&t[this.name]){const q=t[this.name];this._clips=q.clips,this._emitters=q.emitters,c.Assign(this._clips),c.Assign(this._emitters)}}loadSceneAsync(t,q){return g.LoadExtensionAsync(t,q,this.name,(async(S,o)=>{const B=new Array;B.push(this._loader.loadSceneAsync(t,q));for(const t of o.emitters){const q=c.Get(`${S}/emitters`,this._emitters,t);if(void 0!=q.refDistance||void 0!=q.maxDistance||void 0!=q.rolloffFactor||void 0!=q.distanceModel||void 0!=q.innerAngle||void 0!=q.outerAngle)throw new Error(`${S}: Direction or Distance properties are not allowed on emitters attached to a scene`);B.push(this._loadEmitterAsync(`${S}/emitters/${q.index}`,q))}await Promise.all(B)}))}loadNodeAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(t,o)=>{const z=new Array,r=await this._loader.loadNodeAsync(t,q,(q=>{for(const S of o.emitters){const o=c.Get(`${t}/emitters`,this._emitters,S);z.push(this._loadEmitterAsync(`${t}/emitters/${o.index}`,o).then((()=>{for(const t of o._babylonSounds)t.attachToMesh(q),void 0==o.innerAngle&&void 0==o.outerAngle||(t.setLocalDirectionToMesh(B.o.Forward()),t.setDirectionalCone(2*L.f.ToDegrees(void 0==o.innerAngle?Math.PI:o.innerAngle),2*L.f.ToDegrees(void 0==o.outerAngle?Math.PI:o.outerAngle),0))})))}S(q)}));return await Promise.all(z),r}))}loadAnimationAsync(t,q){return g.LoadExtensionAsync(t,q,this.name,(async(S,o)=>{const B=await this._loader.loadAnimationAsync(t,q),z=new Array;c.Assign(o.events);for(const L of o.events)z.push(this._loadAnimationEventAsync(`${S}/events/${L.index}`,t,q,L,B));return await Promise.all(z),B}))}_loadClipAsync(t,q){if(q._objectURL)return q._objectURL;let S;if(q.uri)S=this._loader.loadUriAsync(t,q,q.uri);else{const o=c.Get(`${t}/bufferView`,this._loader.Ni.bufferViews,q.bufferView);S=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}return q._objectURL=S.then((t=>URL.createObjectURL(new Blob([t],{type:q.mimeType})))),q._objectURL}_loadEmitterAsync(t,q){if(q._babylonSounds=q._babylonSounds||[],!q._babylonData){const t=new Array,S=q.name||`emitter${q.index}`,o={loop:!1,autoplay:!1,volume:void 0==q.volume?1:q.volume};for(let z=0;z<q.clips.length;z++){const B=`/extensions/${this.name}/clips`,L=c.Get(B,this._clips,q.clips[z].clip);t.push(this._loadClipAsync(`${B}/${q.clips[z].clip}`,L).then((t=>{const B=q._babylonSounds[z]=new Fq(S,t,this._loader.babylonScene,null,o);B.refDistance=q.refDistance||1,B.maxDistance=q.maxDistance||256,B.rolloffFactor=q.rolloffFactor||1,B.distanceModel=q.distanceModel||"exponential"})))}const B=Promise.all(t).then((()=>{const t=q.clips.map((t=>t.weight||1)),S=new dq(q.loop||!1,q._babylonSounds,t);q.innerAngle&&(S.directionalConeInnerAngle=2*L.f.ToDegrees(q.innerAngle)),q.outerAngle&&(S.directionalConeOuterAngle=2*L.f.ToDegrees(q.outerAngle)),q.volume&&(S.volume=q.volume),q._babylonData.sound=S}));q._babylonData={loaded:B}}return q._babylonData.loaded}_getEventAction(t,q,S,o,B){switch(S){case"play":return t=>{const S=(B||0)+(t-o);q.play(S)};case"stop":return()=>{q.stop()};case"pause":return()=>{q.pause()};default:throw new Error(`${t}: Unsupported action ${S}`)}}_loadAnimationEventAsync(t,q,S,o,B){if(0==B.targetedAnimations.length)return Promise.resolve();const z=B.targetedAnimations[0],L=o.j,r=c.Get(`/extensions/${this.name}/emitters`,this._emitters,L);return this._loadEmitterAsync(t,r).then((()=>{const q=r._babylonData.sound;if(q){const S=new wq(o.time,this._getEventAction(t,q,o.action,o.time,o.startOffset));z.animation.addEvent(S),B.onAnimationGroupEndObservable.add((()=>{q.stop()})),B.onAnimationGroupPauseObservable.add((()=>{q.pause()}))}}))}}f(LS),W(LS,!0,(t=>new rS(t)));const eS="MSFT_lod";class CS{constructor(t){var q;this.name=eS,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Z.b,this.onMaterialLODsLoadedObservable=new Z.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=t,this.maxLODsToLoad=(null===(q=this._loader.parent.extensionOptions[eS])||void 0===q?void 0:q.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(eS)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let t=0;t<this._nodePromiseLODs.length;t++){const q=Promise.all(this._nodePromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Node LOD ${t}`),this._loader.log(`Loaded node LOD ${t}`)),this.onNodeLODsLoadedObservable.notifyObservers(t),t!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${t+1}`),this._loadBufferLOD(this._nodeBufferLODs,t+1),this._nodeSignalLODs[t]&&this._nodeSignalLODs[t].resolve())}));this._loader._completePromises.push(q)}for(let t=0;t<this._materialPromiseLODs.length;t++){const q=Promise.all(this._materialPromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Material LOD ${t}`),this._loader.log(`Loaded material LOD ${t}`)),this.onMaterialLODsLoadedObservable.notifyObservers(t),t!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${t+1}`),this._loadBufferLOD(this._materialBufferLODs,t+1),this._materialSignalLODs[t]&&this._materialSignalLODs[t].resolve())}));this._loader._completePromises.push(q)}}loadSceneAsync(t,q){const S=this._loader.loadSceneAsync(t,q);return this._loadBufferLOD(this._bufferLODs,0),S}loadNodeAsync(t,q,S){return g.LoadExtensionAsync(t,q,this.name,(async(t,B)=>{let z;const L=this._getLODs(t,q,this._loader.Ni.nodes,B.ids);this._loader.logOpen(`${t}`);for(let q=0;q<L.length;q++){const t=L[q];0!==q&&(this._nodeIndexLOD=q,this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new o);const B=t=>{S(t),t.ji(!1)},r=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,B).then((t=>{if(0!==q){const t=L[q-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.ji(!0),t}));this._nodePromiseLODs[q]=this._nodePromiseLODs[q]||[],0===q?z=r:(this._nodeIndexLOD=null,this._nodePromiseLODs[q].push(r))}return this._loader.logClose(),await z}))}_loadMaterialAsync(t,q,S,o,B){return this._nodeIndexLOD?null:g.LoadExtensionAsync(t,q,this.name,(async(t,z)=>{let L;const r=this._getLODs(t,q,this._loader.Ni.materials,z.ids);this._loader.logOpen(`${t}`);for(let q=0;q<r.length;q++){const t=r[q];0!==q&&(this._materialIndexLOD=q);const z=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,S,o,(t=>{0===q&&B(t)})).then((t=>{if(0!==q){B(t);const S=r[q-1]._data;S[o]&&(this._disposeMaterials([S[o].babylonMaterial]),delete S[o])}return t}));this._materialPromiseLODs[q]=this._materialPromiseLODs[q]||[],0===q?L=z:(this._materialIndexLOD=null,this._materialPromiseLODs[q].push(z))}return this._loader.logClose(),await L}))}_loadUriAsync(t,q,S){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const B=this._nodeIndexLOD-1;return this._nodeSignalLODs[B]=this._nodeSignalLODs[B]||new o,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(t,q,S)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const B=this._materialIndexLOD-1;return this._materialSignalLODs[B]=this._materialSignalLODs[B]||new o,this._materialSignalLODs[B].promise.then((async()=>await this._loader.loadUriAsync(t,q,S)))}return null}loadBufferAsync(t,q,S,B){if(this._loader.parent.useRangeRequests&&!q.uri){if(!this._loader.bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);const q=async(t,q)=>{const z=S,L=z+B-1;let r=t[q];return r?(r.start=Math.min(r.start,z),r.end=Math.max(r.end,L)):(r={start:z,end:L,loaded:new o},t[q]=r),await r.loaded.promise.then((t=>new Uint8Array(t.buffer,t.byteOffset+S-r.start,B)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?q(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?q(this._materialBufferLODs,this._materialIndexLOD):q(this._bufferLODs,0)}return null}_loadBufferLOD(t,q){const S=t[q];S&&(this._loader.log(`Loading buffer range [${S.start}-${S.end}]`),this._loader.bin.readAsync(S.start,S.end-S.start+1).then((t=>{S.loaded.resolve(t)}),(t=>{S.loaded.reject(t)})))}_getLODs(t,q,S,o){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const B=[];for(let z=o.length-1;z>=0;z--)if(B.push(c.Get(`${t}/ids/${o[z]}`,S,o[z])),B.length===this.maxLODsToLoad)return B;return B.push(q),B}_disposeTransformNode(t){const q=[],S=t.material;S&&q.push(S);for(const B of t.getChildMeshes())B.material&&q.push(B.material);t.dispose();const o=q.filter((t=>this._loader.babylonScene.meshes.every((q=>q.material!=t))));this._disposeMaterials(o)}_disposeMaterials(t){const q={};for(const S of t){for(const t of S.getActiveTextures())q[t.uniqueId]=t;S.dispose()}for(const S in q)for(const t of this._loader.babylonScene.materials)t.hasTexture(q[S])&&delete q[S];for(const S in q)q[S].dispose()}}f(eS),W(eS,!0,(t=>new CS(t)));const ZS="MSFT_minecraftMesh";class bS{constructor(t){this.name=ZS,this._loader=t,this.enabled=this._loader.isExtensionUsed(ZS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtraAsync(t,q,this.name,(async(o,B)=>{if(B){if(!(S instanceof M.e))throw new Error(`${o}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(t,q,S);return S.needAlphaBlending()&&(S.forceDepthWrite=!0,S.separateCullingPass=!0),S.Fi=S.forceDepthWrite,S.twoSidedLighting=!0,await B}}))}}f(ZS),W(ZS,!0,(t=>new bS(t)));const OS="MSFT_sRGBFactors";class iS{constructor(t){this.name=OS,this._loader=t,this.enabled=this._loader.isExtensionUsed(OS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,q,S){return g.LoadExtraAsync(t,q,this.name,(async(o,B)=>{if(B){if(!(S instanceof M.e))throw new Error(`${o}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(t,q,S),z=S.va().getEngine().useExactSrgbConversions;return S.albedoTexture||S.albedoColor.toLinearSpaceToRef(S.albedoColor,z),S.reflectivityTexture||S.reflectivityColor.toLinearSpaceToRef(S.reflectivityColor,z),await B}}))}}f(OS),W(OS,!0,(t=>new iS(t)));var hS=S(12910);const lS={};var IS=S(12966),aS=S(12942),vS=S(12913),MS=S(12927);function xS(t,q){for(const S of t)for(const t of S.dataOutputs)if(t.uniqueId===q)return t;throw new Error("Could not find data out connection with unique id "+q)}function kS(t,q){for(const S of t)if(S instanceof aS.d)for(const t of S.signalInputs)if(t.uniqueId===q)return t;throw new Error("Could not find signal in connection with unique id "+q)}async function VS(t,q){const o=await Promise.all(t.allBlocks.map((async t=>{const q=function(t){switch(t){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([S.e(62),S.e(63)]).then(S.bind(S,14102))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await S.e(64).then(S.bind(S,14110))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await S.e(65).then(S.bind(S,14115))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await S.e(66).then(S.bind(S,14117))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await S.e(67).then(S.bind(S,14125))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await S.e(68).then(S.bind(S,14133))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await S.e(69).then(S.bind(S,14138))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await S.e(70).then(S.bind(S,14141))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await S.e(71).then(S.bind(S,14150))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await S.e(74).then(S.bind(S,14180))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await S.e(74).then(S.bind(S,14180))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await S.e(74).then(S.bind(S,14180))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await S.e(74).then(S.bind(S,14180))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await S.e(79).then(S.bind(S,14183))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await S.e(80).then(S.bind(S,14188))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await S.e(81).then(S.bind(S,14192))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await S.e(82).then(S.bind(S,14198))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await S.e(83).then(S.bind(S,14204))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await S.e(84).then(S.bind(S,14210))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await S.e(85).then(S.bind(S,14213))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await S.e(86).then(S.bind(S,14218))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await S.e(87).then(S.bind(S,14222))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await S.e(88).then(S.bind(S,14231))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await S.e(89).then(S.bind(S,14236))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await S.e(90).then(S.bind(S,14243))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await S.e(91).then(S.bind(S,14249))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await S.e(92).then(S.bind(S,14256))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await S.e(93).then(S.bind(S,14261))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await S.e(94).then(S.bind(S,14265))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await S.e(95).then(S.bind(S,14273))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await S.e(96).then(S.bind(S,14281))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await S.e(97).then(S.bind(S,14289))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await S.e(76).then(S.bind(S,14297))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await S.e(98).then(S.bind(S,14305))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await S.e(99).then(S.bind(S,14313))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await S.e(100).then(S.bind(S,14315))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await S.e(77).then(S.bind(S,14323))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await S.e(72).then(S.bind(S,14155))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await S.e(78).then(S.bind(S,14329))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await S.e(73).then(S.bind(S,14173))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await S.e(74).then(S.bind(S,14180))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await S.e(74).then(S.bind(S,14180))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await S.e(75).then(S.bind(S,14336))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await S.e(75).then(S.bind(S,14336))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await S.e(75).then(S.bind(S,14336))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await S.e(75).then(S.bind(S,14336))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await S.e(75).then(S.bind(S,14336))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await S.e(75).then(S.bind(S,14336))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await S.e(101).then(S.bind(S,14342))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await S.e(102).then(S.bind(S,14351))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await S.e(103).then(S.bind(S,14359))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await S.e(104).then(S.bind(S,14365))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await S.e(105).then(S.bind(S,14372))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await S.e(106).then(S.bind(S,14377))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await S.e(107).then(S.bind(S,14386))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await S.e(108).then(S.bind(S,14395))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await S.e(109).then(S.bind(S,14397))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await S.e(110).then(S.bind(S,14404))).FlowGraphDataSwitchBlock;default:if(lS[t])return lS[t];throw new Error(`Unknown block name ${t}`)}}(t.className);return await q()})));return function(t,q,S){const o=q.coordinator.createGraph(),B=[],z=q.valueParseFunction??vS.c;for(let L=0;L<t.allBlocks.length;L++){const r=US(t.allBlocks[L],{Tk:q.coordinator.config.Tk,pathConverter:q.pathConverter,assetsContainer:q.coordinator.config.Tk,valueParseFunction:z},S[L]);B.push(r),r instanceof IS.c&&o.addEventBlock(r)}for(const L of B){for(const t of L.dataInputs)for(const q of t.connectedPointIds){const S=xS(B,q);t.connectTo(S)}if(L instanceof aS.d)for(const t of L.signalOutputs)for(const q of t.connectedPointIds){const S=kS(B,q);t.connectTo(S)}}for(const L of t.executionContexts)JS(L,{graph:o,valueParseFunction:z},t.rightHanded);return o}(t,q,o)}function JS(t,q,S){const o=q.graph.createContext();t.enableLogging&&(o.enableLogging=!0),o.treatDataAsRightHanded=S||!1;const B=q.valueParseFunction??vS.c;o.uniqueId=t.uniqueId;const z=o.va();if(t._assetsContext){var L,r,e,C,Z,b,O,i,h,l;const q=t._assetsContext,S={meshes:null===(L=q.meshes)||void 0===L?void 0:L.map((t=>z.getMeshById(t))),lights:null===(r=q.lights)||void 0===r?void 0:r.map((t=>z.getLightByName(t))),cameras:null===(e=q.cameras)||void 0===e?void 0:e.map((t=>z.getCameraByName(t))),materials:null===(C=q.materials)||void 0===C?void 0:C.map((t=>z.getMaterialById(t))),textures:null===(Z=q.textures)||void 0===Z?void 0:Z.map((t=>z.getTextureByName(t))),animations:null===(b=q.animations)||void 0===b?void 0:b.map((t=>z.animations.find((q=>q.name===t)))),skeletons:null===(O=q.skeletons)||void 0===O?void 0:O.map((t=>z.getSkeletonByName(t))),zi:null===(i=q.zi)||void 0===i?void 0:i.map((t=>z.getParticleSystemById(t))),animationGroups:null===(h=q.animationGroups)||void 0===h?void 0:h.map((t=>z.getAnimationGroupByName(t))),transformNodes:null===(l=q.transformNodes)||void 0===l?void 0:l.map((t=>z.getTransformNodeById(t))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],rm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};o.assetsContext=S}for(const I in t._userVariables){const q=B(I,t._userVariables,o.assetsContext,z);o.userVariables[I]=q}for(const I in t._connectionValues){const q=B(I,t._connectionValues,o.assetsContext,z);o._setConnectionValueByKey(I,q)}return o}function US(t,q,S){const o={},B=q.valueParseFunction??vS.c;if(t.config)for(const L in t.config)o[L]=B(L,t.config,q.assetsContainer||q.Tk,q.Tk);if((0,vS.i)(t.className)){if(!q.pathConverter)throw new Error("Path converter is required for this block");o.pathConverter=q.pathConverter}const z=new S(o);z.uniqueId=t.uniqueId;for(let L=0;L<t.dataInputs.length;L++){const q=z.getDataInput(t.dataInputs[L].name);if(!q)throw new Error("Could not find data input with name "+t.dataInputs[L].name+" in block "+t.className);q.deserialize(t.dataInputs[L])}for(let L=0;L<t.dataOutputs.length;L++){const q=z.getDataOutput(t.dataOutputs[L].name);if(!q)throw new Error("Could not find data output with name "+t.dataOutputs[L].name+" in block "+t.className);q.deserialize(t.dataOutputs[L])}return z.metadata=t.metadata,z.deserialize&&z.deserialize(t),z}function HS(t){const[q,S]=t.split(":");return jS({op:q,extension:S})}function jS(t){var q;let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=t.extension?null===(q=QS[t.extension])||void 0===q?void 0:q[t.op]:KS[t.op];if(!o&&(l.c.Warn(`No mapping found for operation ${t.op} and extension ${t.extension||"KHR_interactivity"}`),S)){const q={},S={flows:{}};if(t.inputValueSockets){q.values={};for(const S in t.inputValueSockets)q.values[S]={name:S}}return t.outputValueSockets&&(S.values={},Object.keys(t.outputValueSockets).forEach((t=>{S.values[t]={name:t}}))),{Xk:[],inputs:q,outputs:S}}return o}function yS(t,q,S){QS[q]||(QS[q]={}),QS[q][t]=S}const QS={BABYLON:{"flow/log":{Xk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},KS={"event/onStart":{Xk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Xk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Xk:["FlowGraphSendCustomEventBlock"],extraProcessor(t,q,S,o,B){if("event/send"!==q.op||!t.configuration||1!==Object.keys(t.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=t.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const L=o.arrays.events[z],r=B[0];return r.config||(r.config={}),r.config.eventId=L.eventId,r.config.eventData=L.eventData,B}},"event/receive":{Xk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(t,q){var S;if(!t.configuration)return l.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const o=t.configuration.event;if(!o)return l.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const B=o.value[0];if("number"!==typeof B)return l.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(S=q.events)||void 0===S?void 0:S[B])?{valid:!0}:(l.c.Error(`Event with id ${B} not found`),{valid:!1,error:`Event with id ${B} not found`})},extraProcessor(t,q,S,o,B){if("event/receive"!==q.op||!t.configuration||1!==Object.keys(t.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=t.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const L=o.arrays.events[z],r=B[0];return r.config||(r.config={}),r.config.eventId=L.eventId,r.config.eventData=L.eventData,B}},"math/e":XS("FlowGraphEBlock"),"math/pi":XS("FlowGraphPIBlock"),"math/inf":XS("FlowGraphInfBlock"),"math/nan":XS("FlowGraphNaNBlock"),"math/abs":XS("FlowGraphAbsBlock"),"math/sign":XS("FlowGraphSignBlock"),"math/trunc":XS("FlowGraphTruncBlock"),"math/floor":XS("FlowGraphFloorBlock"),"math/ceil":XS("FlowGraphCeilBlock"),"math/round":{Xk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B){var z;return(z=B[0]).config||(z.config={}),B[0].config.roundHalfAwayFromZero=!0,B}},"math/fract":XS("FlowGraphFractBlock"),"math/neg":XS("FlowGraphNegationBlock"),"math/add":XS("FlowGraphAddBlock",["a","b"],!0),"math/sub":XS("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Xk:["FlowGraphMultiplyBlock"],extraProcessor(t,q,S,o,B){var z;(z=B[0]).config||(z.config={}),B[0].config.useMatrixPerComponent=!0,B[0].config.preventIntegerFloatArithmetic=!0;let L=-1;return Object.keys(t.values||{}).find((q=>{var S;return void 0!==(null===(S=t.values)||void 0===S?void 0:S[q].type)&&(L=t.values[q].type,!0)})),-1!==L&&(B[0].config.type=o.arrays.types[L].flowGraphType),B},validation:t=>t.values?GS(t):{valid:!0}},"math/div":XS("FlowGraphDivideBlock",["a","b"],!0),"math/rem":XS("FlowGraphModuloBlock",["a","b"]),"math/min":XS("FlowGraphMinBlock",["a","b"]),"math/max":XS("FlowGraphMaxBlock",["a","b"]),"math/clamp":XS("FlowGraphClampBlock",["a","b","c"]),"math/saturate":XS("FlowGraphSaturateBlock"),"math/mix":XS("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":XS("FlowGraphEqualityBlock",["a","b"]),"math/lt":XS("FlowGraphLessThanBlock",["a","b"]),"math/le":XS("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":XS("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":XS("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":XS("FlowGraphIsNaNBlock"),"math/isinf":XS("FlowGraphIsInfBlock"),"math/select":{Xk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Xk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":XS("FlowGraphSinBlock"),"math/cos":XS("FlowGraphCosBlock"),"math/tan":XS("FlowGraphTanBlock"),"math/asin":XS("FlowGraphASinBlock"),"math/acos":XS("FlowGraphACosBlock"),"math/atan":XS("FlowGraphATanBlock"),"math/atan2":XS("FlowGraphATan2Block",["a","b"]),"math/sinh":XS("FlowGraphSinhBlock"),"math/cosh":XS("FlowGraphCoshBlock"),"math/tanh":XS("FlowGraphTanhBlock"),"math/asinh":XS("FlowGraphASinhBlock"),"math/acosh":XS("FlowGraphACoshBlock"),"math/atanh":XS("FlowGraphATanhBlock"),"math/exp":XS("FlowGraphExponentialBlock"),"math/log":XS("FlowGraphLogBlock"),"math/log2":XS("FlowGraphLog2Block"),"math/log10":XS("FlowGraphLog10Block"),"math/sqrt":XS("FlowGraphSquareRootBlock"),"math/cbrt":XS("FlowGraphCubeRootBlock"),"math/pow":XS("FlowGraphPowerBlock",["a","b"]),"math/length":XS("FlowGraphLengthBlock"),"math/normalize":XS("FlowGraphNormalizeBlock"),"math/dot":XS("FlowGraphDotBlock",["a","b"]),"math/cross":XS("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":XS("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":XS("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Xk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Xk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Xk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Xk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Xk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Xk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Xk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":XS("FlowGraphTransposeBlock"),"math/determinant":XS("FlowGraphDeterminantBlock"),"math/inverse":XS("FlowGraphInvertMatrixBlock"),"math/matmul":XS("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Xk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"oi",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B,z){const L=B[0].dataInputs.find((t=>"rotationQuaternion"===t.name));if(!L)throw new Error("Rotation quaternion input not found");return z._connectionValues[L.uniqueId]&&(z._connectionValues[L.uniqueId].type="Quaternion"),B}},"math/matDecompose":{Xk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"oi"}}}},"math/quatConjugate":XS("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Xk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B){var z;return(z=B[0]).config||(z.config={}),B[0].config.type="Quaternion",B}},"math/quatAngleBetween":XS("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Xk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":XS("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":XS("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Xk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B){var z;return(z=B[0]).config||(z.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract2x2":{Xk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Xk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B){var z;return(z=B[0]).config||(z.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract3x3":{Xk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Xk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B){var z;return(z=B[0]).config||(z.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract4x4":{Xk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Xk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B,z){var L,r;(r=B[0]).config||(r.config={});const e=B[0].dataInputs[0];return B[0].config.valueType=(null===(L=z._connectionValues[e.uniqueId])||void 0===L?void 0:L.type)??"FlowGraphInteger",B}},"math/and":{Xk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B,z){var L,r,e;(e=B[0]).config||(e.config={});const C=B[0].dataInputs[0],Z=B[0].dataInputs[1];return B[0].config.valueType=(null===(L=z._connectionValues[C.uniqueId])||void 0===L?void 0:L.type)??(null===(r=z._connectionValues[Z.uniqueId])||void 0===r?void 0:r.type)??"FlowGraphInteger",B}},"math/or":{Xk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B,z){var L,r,e;(e=B[0]).config||(e.config={});const C=B[0].dataInputs[0],Z=B[0].dataInputs[1];return B[0].config.valueType=(null===(L=z._connectionValues[C.uniqueId])||void 0===L?void 0:L.type)??(null===(r=z._connectionValues[Z.uniqueId])||void 0===r?void 0:r.type)??"FlowGraphInteger",B}},"math/xor":{Xk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,q,S,o,B,z){var L,r,e;(e=B[0]).config||(e.config={});const C=B[0].dataInputs[0],Z=B[0].dataInputs[1];return B[0].config.valueType=(null===(L=z._connectionValues[C.uniqueId])||void 0===L?void 0:L.type)??(null===(r=z._connectionValues[Z.uniqueId])||void 0===r?void 0:r.type)??"FlowGraphInteger",B}},"math/asr":XS("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":XS("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":XS("FlowGraphLeadingZerosBlock"),"math/ctz":XS("FlowGraphTrailingZerosBlock"),"math/popcnt":XS("FlowGraphOneBitsCounterBlock"),"math/rad":XS("FlowGraphDegToRadBlock"),"math/deg":XS("FlowGraphRadToDegBlock"),"type/boolToInt":XS("FlowGraphBooleanToInt"),"type/boolToFloat":XS("FlowGraphBooleanToFloat"),"type/intToBool":XS("FlowGraphIntToBoolean"),"type/intToFloat":XS("FlowGraphIntToFloat"),"type/floatToInt":XS("FlowGraphFloatToInt"),"type/floatToBool":XS("FlowGraphFloatToBoolean"),"flow/sequence":{Xk:["FlowGraphSequenceBlock"],extraProcessor(t,q,S,o,B){const z=B[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(t.flows||[]).length,z.signalOutputs.forEach(((t,q)=>{t.name="out_"+q})),B}},"flow/branch":{Xk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Xk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(t){if(t.configuration&&t.configuration.cases){const q=t.configuration.cases.value;if(!q.every((t=>"number"===typeof t&&/^-?\d+$/.test(t.toString()))))return l.c.Warn("Switch cases should be integers. Using empty array instead."),t.configuration.cases.value=[],{valid:!0};const S=new Set(q);t.configuration.cases.value=Array.from(S)}return{valid:!0}},extraProcessor(t,q,S,o,B){if("flow/switch"!==q.op||!t.flows||0===Object.keys(t.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return B[0].signalOutputs.forEach((t=>{"default"!==t.name&&(t.name="out_"+t.name)})),B}},"flow/while":{Xk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Xk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(t,q,S,o,B){const z=B[0];return z.config||(z.config={}),z.config.incrementIndexWhenLoopDone=!0,B}},"flow/doN":{Xk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Xk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(t,q,S,o,B){if("flow/multiGate"!==q.op||!t.flows||0===Object.keys(t.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const z=B[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(t.flows).length,z.signalOutputs.forEach(((t,q)=>{t.name="out_"+q})),B}},"flow/waitAll":{Xk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(t){var q,S;return"number"!==typeof(null===(q=t.configuration)||void 0===q||null===(S=q.inputFlows)||void 0===S?void 0:S.value[0])&&(t.configuration=t.configuration||{inputFlows:{value:[0]}},t.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Xk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Xk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Xk:["FlowGraphCancelDelayBlock"]},"variable/get":{Xk:["FlowGraphGetVariableBlock"],validation(t){var q,S;return null!==(q=t.configuration)&&void 0!==q&&null!==(S=q.variable)&&void 0!==S&&S.value?{valid:!0}:(l.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(t,q)=>[q.getVariableName(t[0])]}}},"variable/set":{Xk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(t,q)=>[q.getVariableName(t[0])]}}},"variable/setMultiple":{Xk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(t,q)=>[t[0].map((t=>q.getVariableName(t)))]}},extraProcessor:(t,q,S,o,B)=>(B[0].dataInputs.forEach((t=>{t.name=o.getVariableName(+t.name)})),B)},"variable/interpolate":{Xk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(t,q)=>[q.getVariableName(t[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:t=>!0===t[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(t,q,S,o,B){var z,L,r;const e=B[0],C=null===(z=t.configuration)||void 0===z?void 0:z.variable.value[0];if("number"!==typeof C)throw l.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const Z=o.arrays.staticVariables[C];"undefined"===typeof e.config.animationType.value&&(o.arrays.staticVariables,e.config.animationType.value=(0,MS.M)(Z.type));const b=B[4];return b.config||(b.config={}),(L=b.config).variable||(L.variable={}),b.config.variable.value=o.getVariableName(C),(r=B[3]).config||(r.config={}),B}},"pointer/get":{Xk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,q,S,o,B)=>(B.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className&&(t.config||(t.config={}),t.config.outputValue=!0)})),B)},"pointer/set":{Xk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,q,S,o,B)=>(B.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className&&(t.config||(t.config={}),t.config.outputValue=!0)})),B)},"pointer/interpolate":{Xk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,q,S,o,B)=>(B.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className?(q.config||(q.config={}),q.config.outputValue=!0):"FlowGraphInterpolationBlock"===q.className&&(q.config||(q.config={}),Object.keys(t.values||[]).forEach((S=>{var B;const z=null===(B=t.values)||void 0===B?void 0:B[S];if("value"===S&&z){const t=z.type;void 0!==t&&(q.config.animationType=o.arrays.types[t].flowGraphType)}})))})),B)},"animation/start":{Xk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(t,q)=>[t[0]*q._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(t,q)=>[t[0]*q._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,q,S,o,B,z,L){const r=B[B.length-1];return r.config||(r.config={}),r.config.glTF=L,B}},"animation/stop":{Xk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,q,S,o,B,z,L){const r=B[B.length-1];return r.config||(r.config={}),r.config.glTF=L,B}},"animation/stopAt":{Xk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(t,q)=>[t[0]*q._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,q,S,o,B,z,L){const r=B[B.length-1];return r.config||(r.config={}),r.config.glTF=L,B}},"math/switch":{Xk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(t){if(t.configuration&&t.configuration.cases){const q=t.configuration.cases.value;if(!q.every((t=>"number"===typeof t&&/^-?\d+$/.test(t.toString()))))return l.c.Warn("Switch cases should be integers. Using empty array instead."),t.configuration.cases.value=[],{valid:!0};const S=new Set(q);t.configuration.cases.value=Array.from(S)}return{valid:!0}},extraProcessor(t,q,S,o,B){const z=B[0];return z.dataInputs.forEach((t=>{"default"!==t.name&&"case"!==t.name&&(t.name="in_"+t.name)})),z.config||(z.config={}),z.config.treatCasesAsIntegers=!0,B}},"debug/log":{Xk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function XS(t){let q=arguments.length>2?arguments[2]:void 0;return{Xk:[t],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((t,q)=>(t[q]={name:q},t)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(t,S,o,B,z){var L;if(q){(L=z[0]).config||(L.config={}),z[0].config.preventIntegerFloatArithmetic=!0;let q=-1;Object.keys(t.values||{}).find((S=>{var o;return void 0!==(null===(o=t.values)||void 0===o?void 0:o[S].type)&&(q=t.values[S].type,!0)})),-1!==q&&(z[0].config.type=B.arrays.types[q].flowGraphType)}return z},validation:t=>q?GS(t):{valid:!0}}}function GS(t){if(t.values){const q=Object.keys(t.values).map((q=>t.values[q].type)).filter((t=>void 0!==t));if(!q.every((t=>t===q[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}KS["math/compose"]=KS["math/matCompose"],KS["math/decompose"]=KS["math/matDecompose"];var YS=S(624);const nS={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"wi",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class uS{constructor(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=t,this._gltf=q,this._animationTargetFps=S,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const t of this._interactivityGraph.types)this._types.push(nS[t.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const t of this._interactivityGraph.declarations){const q=jS(t);if(!q)throw l.c.Error(["No mapping found for declaration",t]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:q,fullOperationName:t.extension?t.op+":"+t.extension:t.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const t of this._interactivityGraph.variables){const q=this._parseVariable(t);this._staticVariables.push(q)}}_parseVariable(t,q){const S=this._types[t.type];if(!S)throw l.c.Error(["No type found for variable",t]),new Error("Error parsing variables");if(t.value&&t.value.length!==S.length)throw l.c.Error(["Invalid value length for variable",t,S]),new Error("Error parsing variables");const o=t.value||[];if(!o.length)switch(S.flowGraphType){case"boolean":o.push(!1);break;case"FlowGraphInteger":o.push(0);break;case"number":o.push(NaN);break;case"Vector2":o.push(NaN,NaN);break;case"wi":o.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":o.fill(NaN,0,4);break;case"Matrix":o.fill(NaN,0,16);break;case"Matrix3D":o.fill(NaN,0,9)}return"number"===S.elementType&&"string"===typeof o[0]&&(o[0]=parseFloat(o[0])),{type:S.flowGraphType,value:q?q(o,this):o}}_parseEvents(){if(this._interactivityGraph.events)for(const t of this._interactivityGraph.events){const q={eventId:t.id||"internalEvent_"+this._internalEventsCounter++};t.values&&(q.eventData=Object.keys(t.values).map((q=>{var S;const o=null===(S=t.values)||void 0===S?void 0:S[q];if(!o)throw l.c.Error(["No value found for event key",q]),new Error("Error parsing events");const B=this._types[o.type];if(!B)throw l.c.Error(["No type found for event value",o]),new Error("Error parsing events");const z="undefined"!==typeof o.value?this._parseVariable(o):void 0;return{id:q,type:B.flowGraphType,eventData:!0,value:z}}))),this._events.push(q)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const q of this._interactivityGraph.nodes){if("number"!==typeof q.declaration)throw l.c.Error(["No declaration found for node",q]),new Error("Error parsing nodes");const S=this._mappings[q.declaration];if(!S)throw l.c.Error(["No mapping found for node",q]),new Error("Error parsing nodes");if(S.flowGraphMapping.validation){const o=S.flowGraphMapping.validation(q,this._interactivityGraph,this._gltf);var t;if(!o.valid)throw new Error(`Error validating interactivity node ${null===(t=this._interactivityGraph.declarations)||void 0===t?void 0:t[q.declaration].op} - ${o.error}`)}const o=[];for(const t of S.flowGraphMapping.Xk){const B=this._getEmptyBlock(t,S.fullOperationName);this._parseNodeConfiguration(q,B,S.flowGraphMapping,t),o.push(B)}this._nodes.push({Xk:o,fullOperationName:S.fullOperationName})}}_getEmptyBlock(t,q){return{uniqueId:(0,YS.d)(),className:t,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:q,metadata:{}}}_parseNodeConfiguration(t,q,S,o){const B=q.config;if(t.configuration){const q=Object.keys(t.configuration);for(const r of q){var z,L;const q=null===(z=t.configuration)||void 0===z?void 0:z[r];if(!q)throw l.c.Error(["No value found for node configuration",r]),new Error("Error parsing node configuration");const e=null===(L=S.configuration)||void 0===L?void 0:L[r];if(e&&e.toBlock?e.toBlock===o:0===S.Xk.indexOf(o)){const t=(null===e||void 0===e?void 0:e.name)||r;q&&"undefined"!==typeof q.value||"undefined"===typeof(null===e||void 0===e?void 0:e.defaultValue)?q.value.length>=0?B[t]={value:1===q.value.length?q.value[0]:q.value}:l.c.Warn(["Invalid value for node configuration",q]):B[t]={value:e.defaultValue},e&&e.dataTransformer&&(B[t].value=e.dataTransformer([B[t].value],this)[0])}}}}_parseNodeConnections(t){for(let V=0;V<this._nodes.length;V++){var q;const J=null===(q=this._interactivityGraph.nodes)||void 0===q?void 0:q[V];if(!J)throw l.c.Error(["No node found for interactivity node",this._nodes[V]]),new Error("Error parsing node connections");const U=this._nodes[V],H=this._mappings[J.declaration];if(!H)throw l.c.Error(["No mapping found for node",J]),new Error("Error parsing node connections");const j=J.flows||{},y=Object.keys(j).sort();for(const t of y){var S,o,B,z;const q=j[t],C=null===(S=H.flowGraphMapping.outputs)||void 0===S||null===(o=S.flows)||void 0===o?void 0:o[t],Z=(null===C||void 0===C?void 0:C.name)||t,b=this._createNewSocketConnection(Z,!0);(C&&C.toBlock&&U.Xk.find((t=>t.className===C.toBlock))||U.Xk[0]).signalOutputs.push(b);const O=q.node,i=this._nodes[O];if(!i)throw l.c.Error(["No node found for input node id",O]),new Error("Error parsing node connections");const h=HS(i.fullOperationName);if(!h)throw l.c.Error(["No mapping found for input node",i]),new Error("Error parsing node connections");let I=null===(B=h.inputs)||void 0===B||null===(z=B.flows)||void 0===z?void 0:z[q.socket||"in"],a=!1;if(!I)for(const t in null===(L=h.inputs)||void 0===L?void 0:L.flows){var L,r,e;if(t.startsWith("[")&&t.endsWith("]"))a=!0,I=null===(r=h.inputs)||void 0===r||null===(e=r.flows)||void 0===e?void 0:e[t]}const v=I?a?I.name.replace("$1",q.socket||""):I.name:q.socket||"in",M=I&&I.toBlock&&i.Xk.find((t=>t.className===I.toBlock))||i.Xk[0];let x=M.signalInputs.find((t=>t.name===v));x||(x=this._createNewSocketConnection(v),M.signalInputs.push(x)),x.connectedPointIds.push(b.uniqueId),b.connectedPointIds.push(x.uniqueId)}const Q=J.values||{},K=Object.keys(Q);for(const q of K){var C,Z;const S=Q[q];let o=null===(C=H.flowGraphMapping.inputs)||void 0===C||null===(Z=C.values)||void 0===Z?void 0:Z[q],B=!1;if(!o)for(const t in null===(b=H.flowGraphMapping.inputs)||void 0===b?void 0:b.values){var b,O,i;if(t.startsWith("[")&&t.endsWith("]"))B=!0,o=null===(O=H.flowGraphMapping.inputs)||void 0===O||null===(i=O.values)||void 0===i?void 0:i[t]}const z=o?B?o.name.replace("$1",q):o.name:q,L=this._createNewSocketConnection(z);if((o&&o.toBlock&&U.Xk.find((t=>t.className===o.toBlock))||U.Xk[0]).dataInputs.push(L),void 0!==S.value){const q=this._parseVariable(S,o&&o.dataTransformer);t._connectionValues[L.uniqueId]=q}else{if("undefined"===typeof S.node)throw l.c.Error(["Invalid value for value connection",S]),new Error("Error parsing node connections");{var h,I,a;const t=S.node,q=S.socket||"value",o=this._nodes[t];if(!o)throw l.c.Error(["No node found for output socket reference",S]),new Error("Error parsing node connections");const B=HS(o.fullOperationName);if(!B)throw l.c.Error(["No mapping found for output socket reference",S]),new Error("Error parsing node connections");let z=null===(h=B.outputs)||void 0===h||null===(I=h.values)||void 0===I?void 0:I[q],r=!1;if(!z)for(const S in null===(v=B.outputs)||void 0===v?void 0:v.values){var v,M,x;if(S.startsWith("[")&&S.endsWith("]"))r=!0,z=null===(M=B.outputs)||void 0===M||null===(x=M.values)||void 0===x?void 0:x[S]}const e=z?r?z.name.replace("$1",q):null===(a=z)||void 0===a?void 0:a.name:q,C=z&&z.toBlock&&o.Xk.find((t=>t.className===z.toBlock))||o.Xk[0];let Z=C.dataOutputs.find((t=>t.name===e));Z||(Z=this._createNewSocketConnection(e,!0),C.dataOutputs.push(Z)),L.connectedPointIds.push(Z.uniqueId),Z.connectedPointIds.push(L.uniqueId)}}}if(H.flowGraphMapping.interBlockConnectors)for(const t of H.flowGraphMapping.interBlockConnectors){const q=t.input,S=t.output,o=t.isVariable;this._connectFlowGraphNodes(q,S,U.Xk[t.inputBlockIndex],U.Xk[t.outputBlockIndex],o)}if(H.flowGraphMapping.extraProcessor){var k;const q=null===(k=this._interactivityGraph.declarations)||void 0===k?void 0:k[J.declaration];if(!q)throw l.c.Error(["No declaration found for extra processor",J]),new Error("Error parsing node connections");U.Xk=H.flowGraphMapping.extraProcessor(J,q,H.flowGraphMapping,this,U.Xk,t,this._gltf)}}}_createNewSocketConnection(t,q){return{uniqueId:(0,YS.d)(),name:t,_connectionType:q?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(t,q,S,o,B){const z=B?S.dataInputs:S.signalInputs,L=B?o.dataOutputs:o.signalOutputs,r=z.find((q=>q.name===t))||this._createNewSocketConnection(t),e=L.find((t=>t.name===q))||this._createNewSocketConnection(q,!0);z.find((q=>q.name===t))||z.push(r),L.find((t=>t.name===q))||L.push(e),r.connectedPointIds.push(e.uniqueId),e.connectedPointIds.push(r.uniqueId)}getVariableName(t){return"staticVariable_"+t}serializeToFlowGraph(){const t={uniqueId:(0,YS.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(t);for(let q=0;q<this._staticVariables.length;q++){const S=this._staticVariables[q];t._userVariables[this.getVariableName(q)]=S}return{rightHanded:!0,allBlocks:this._nodes.reduce(((t,q)=>t.concat(q.Xk)),[]),executionContexts:[t]}}}const WS="KHR_interactivity";class fS{constructor(t){this._loader=t,this.name=WS,this.enabled=this._loader.isExtensionUsed(WS),this._pathConverter=(0,D.g)(this._loader.Ni),t._skipStartAnimationStep=!0;const q=t.babylonScene;q&&function(t){(0,D.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!t.activeCamera)return new B.g(NaN,NaN,NaN,NaN);const q=B.g.FromRotationMatrix(t.activeCamera.getWorldMatrix()).normalize();return t.useRightHandedSystem||(q.w*=-1,q.x*=-1),q},type:"Quaternion",getTarget:()=>t.activeCamera}),(0,D.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!t.activeCamera)return new B.o(NaN,NaN,NaN);const q=t.activeCamera.getWorldMatrix().getTranslation();return t.useRightHandedSystem||(q.x*=-1),q},type:"wi",getTarget:()=>t.activeCamera}),(0,D.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:t=>{var q;return(null===(q=t._babylonAnimationGroup)||void 0===q?void 0:q.isPlaying)??!1},type:"boolean",getTarget:t=>t._babylonAnimationGroup}),(0,D.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:t=>{var q;return((null===(q=t._babylonAnimationGroup)||void 0===q?void 0:q.from)??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,D.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:t=>{var q;return((null===(q=t._babylonAnimationGroup)||void 0===q?void 0:q.to)??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,D.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:t=>{var q;return((null===(q=t._babylonAnimationGroup)||void 0===q?void 0:q.getCurrentFrame())??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,D.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:t=>{var q;return((null===(q=t._babylonAnimationGroup)||void 0===q?void 0:q.getCurrentFrame())??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup})}(q)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var t;if(!this._loader.babylonScene||!this._pathConverter)return;const q=this._loader.babylonScene,S=null===(t=this._loader.Ni.extensions)||void 0===t?void 0:t.KHR_interactivity;if(!S)return;const o=new hS.d({Tk:q});o.dispatchEventsSynchronously=!1;const B=S.graphs.map((t=>new uS(t,this._loader.Ni,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(B.map((async t=>await VS(t,{coordinator:o,pathConverter:this._pathConverter})))),o.start()}}var DS;DS=async()=>(await Promise.resolve().then(S.bind(S,12987))).FlowGraphGLTFDataProvider,lS[`${WS}/${"FlowGraphGLTFDataProvider"}`]=DS,f(WS),W(WS,!0,(t=>new fS(t)));const mS="KHR_node_visibility";(0,D.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:t=>{const q=t._babylonTransformNode;return!q||void 0===q.isVisible||q.isVisible},set:(t,q)=>{var S,o;null===(S=q._primitiveBabylonMeshes)||void 0===S||S.forEach((t=>{t.inheritVisibility=!0})),q._babylonTransformNode&&(q._babylonTransformNode.isVisible=t),null===(o=q._primitiveBabylonMeshes)||void 0===o||o.forEach((q=>{q.isVisible=t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class AS{constructor(t){this.name=mS,this._loader=t,this.enabled=t.isExtensionUsed(mS)}async onReady(){var t;null===(t=this._loader.Ni.nodes)||void 0===t||t.forEach((t=>{var q,S,o,B;(null===(q=t._primitiveBabylonMeshes)||void 0===q||q.forEach((t=>{t.inheritVisibility=!0})),null!==(S=t.extensions)&&void 0!==S&&S.KHR_node_visibility)&&(!1===(null===(o=t.extensions)||void 0===o?void 0:o.KHR_node_visibility.visible)&&(t._babylonTransformNode&&(t._babylonTransformNode.isVisible=!1),null===(B=t._primitiveBabylonMeshes)||void 0===B||B.forEach((t=>{t.isVisible=!1}))))}))}dispose(){this._loader=null}}f(mS),W(mS,!0,(t=>new AS(t)));const cS="KHR_node_selectability";yS("event/onSelect",cS,{Xk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:t=>["pickedMesh_"+t[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,q,S,o,B,z,L){var r,e,C,Z,b,O;const i=B[B.length-1];i.config=i.config||{},i.config.glTF=L;const h=null===(r=t.configuration)||void 0===r||null===(e=r.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===h||"number"!==typeof h)throw new Error("nodeIndex not found in configuration");const l="pickedMesh_"+h;return B[1].config.variable=l,z._userVariables[l]={className:"Mesh",id:null===L||void 0===L||null===(C=L.nodes)||void 0===C||null===(Z=C[h]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===L||void 0===L||null===(b=L.nodes)||void 0===b||null===(O=b[h]._babylonTransformNode)||void 0===O?void 0:O.uniqueId},B}}),(0,D.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:t=>{const q=t._babylonTransformNode;return!q||void 0===q.Hi||q.Hi},set:(t,q)=>{var S;null===(S=q._primitiveBabylonMeshes)||void 0===S||S.forEach((q=>{q.Hi=t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"Hi"],type:"boolean"});class sS{constructor(t){this.name=cS,this._loader=t,this.enabled=t.isExtensionUsed(cS)}async onReady(){var t;null===(t=this._loader.Ni.nodes)||void 0===t||t.forEach((t=>{var q,S,o;null!==(q=t.extensions)&&void 0!==q&&q.KHR_node_selectability&&!1===(null===(S=t.extensions)||void 0===S?void 0:S.KHR_node_selectability.selectable)&&(null===(o=t._babylonTransformNode)||void 0===o||o.getChildMeshes().forEach((t=>{t.Hi=!1})))}))}dispose(){this._loader=null}}f(cS),W(cS,!0,(t=>new sS(t)));const gS="KHR_node_hoverability",NS="targetMeshPointerOver_";yS("event/onHoverIn",gS,{Xk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:t=>[NS+t[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,q,S,o,B,z,L){var r,e,C,Z,b,O;const i=B[B.length-1];i.config=i.config||{},i.config.glTF=L;const h=null===(r=t.configuration)||void 0===r||null===(e=r.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===h||"number"!==typeof h)throw new Error("nodeIndex not found in configuration");const l=NS+h;return B[1].config.variable=l,z._userVariables[l]={className:"Mesh",id:null===L||void 0===L||null===(C=L.nodes)||void 0===C||null===(Z=C[h]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===L||void 0===L||null===(b=L.nodes)||void 0===b||null===(O=b[h]._babylonTransformNode)||void 0===O?void 0:O.uniqueId},B}});const TS="targetMeshPointerOut_";yS("event/onHoverOut",gS,{Xk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:t=>[TS+t[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,q,S,o,B,z,L){var r,e,C,Z,b,O;const i=B[B.length-1];i.config=i.config||{},i.config.glTF=L;const h=null===(r=t.configuration)||void 0===r||null===(e=r.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===h||"number"!==typeof h)throw new Error("nodeIndex not found in configuration");const l=TS+h;return B[1].config.variable=l,z._userVariables[l]={className:"Mesh",id:null===L||void 0===L||null===(C=L.nodes)||void 0===C||null===(Z=C[h]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===L||void 0===L||null===(b=L.nodes)||void 0===b||null===(O=b[h]._babylonTransformNode)||void 0===O?void 0:O.uniqueId},B}}),(0,D.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:t=>{const q=t._babylonTransformNode;return!q||void 0===q.pointerOverDisableMeshTesting||q.pointerOverDisableMeshTesting},set:(t,q)=>{var S;null===(S=q._primitiveBabylonMeshes)||void 0===S||S.forEach((q=>{q.pointerOverDisableMeshTesting=!t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class wS{constructor(t){this.name=gS,this._loader=t,this.enabled=t.isExtensionUsed(gS)}async onReady(){var t;null===(t=this._loader.Ni.nodes)||void 0===t||t.forEach((t=>{var q,S,o;null!==(q=t.extensions)&&void 0!==q&&q.KHR_node_hoverability&&!1===(null===(S=t.extensions)||void 0===S?void 0:S.KHR_node_hoverability.hoverable)&&(null===(o=t._babylonTransformNode)||void 0===o||o.getChildMeshes().forEach((t=>{t.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}f(gS),W(gS,!0,(t=>new wS(t)));const ES="ExtrasAsMetadata";class pS{_assignExtras(t,q){if(q.extras&&Object.keys(q.extras).length>0){const S=t.metadata=t.metadata||{};(S.Ni=S.Ni||{}).extras=q.extras}}constructor(t){this.name=ES,this.enabled=!0,this._loader=t}dispose(){this._loader=null}loadNodeAsync(t,q,S){return this._loader.loadNodeAsync(t,q,(t=>{this._assignExtras(t,q),S(t)}))}loadCameraAsync(t,q,S){return this._loader.loadCameraAsync(t,q,(t=>{this._assignExtras(t,q),S(t)}))}createMaterial(t,q,S){const o=this._loader.createMaterial(t,q,S);return this._assignExtras(o,q),o}}f(ES),W(ES,!1,(t=>new pS(t)));S(12987)},12872:(t,q,S)=>{"use strict";S.d(q,{d:()=>G,f:()=>H,j:()=>U,n:()=>j});var o=S(485),B=S(490),z=S(12517),L=S(483),r=S(793),e=S(791),C=S(496),Z=S(523),b=S(11922),O=S(12037),i=S(644),h=S(634);class l{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.zi=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.rm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(t){this._environmentTexture=t}getNodes(){let t=[];t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes);for(const q of this.skeletons)t=t.concat(q.bones);return t}}class I extends l{}class a{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const t=this.rootNodes;for(const o of t)o.dispose();t.length=0;const q=this.skeletons;for(const o of q)o.dispose();q.length=0;const S=this.animationGroups;for(const o of S)o.dispose();S.length=0}}class v extends l{constructor(t){super(),this._wasAddedToScene=!1,(t=t||Z.b.LastCreatedScene)&&(this.Tk=t,this.proceduralTextures=[],t.Qi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=t.getEngine().onContextRestoredObservable.add((()=>{for(const t of this.geometries)t._rebuild();for(const t of this.meshes)t._rebuild();for(const t of this.zi)t.rebuild();for(const t of this.textures)t._rebuild()})))}_topologicalSort(t){const q=new Map;for(const L of t)q.set(L.uniqueId,L);const S={dependsOn:new Map,dependedBy:new Map};for(const L of t){const t=L.uniqueId;S.dependsOn.set(t,new Set),S.dependedBy.set(t,new Set)}for(const L of t){const t=L.uniqueId,o=S.dependsOn.get(t);if(L instanceof b.c){const B=L.sourceMesh;q.has(B.uniqueId)&&(o.add(B.uniqueId),S.dependedBy.get(B.uniqueId).add(t))}const B=S.dependedBy.get(t);for(const z of L.getDescendants()){const o=z.uniqueId;if(q.has(o)){B.add(o);S.dependsOn.get(o).add(t)}}}const o=[],B=[];for(const L of t){const t=L.uniqueId;0===S.dependsOn.get(t).size&&(B.push(L),q.delete(t))}const z=B;for(;z.length>0;){const t=z.shift();o.push(t);const B=S.dependedBy.get(t.uniqueId);for(const o of Array.from(B.values())){const B=S.dependsOn.get(o);B.delete(t.uniqueId),0===B.size&&q.get(o)&&(z.push(q.get(o)),q.delete(o))}}return q.size>0&&(C.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),q.forEach((t=>{C.c.Error(t.name)}))),o}_addNodeAndDescendantsToList(t,q,S,o){if(S&&(!o||o(S))&&!q.has(S.uniqueId)){t.push(S),q.add(S.uniqueId);for(const B of S.getDescendants(!0))this._addNodeAndDescendantsToList(t,q,B,o)}}_isNodeInContainer(t){return t instanceof e.b&&-1!==this.meshes.indexOf(t)||(t instanceof r.e&&-1!==this.transformNodes.indexOf(t)||(t instanceof O.b&&-1!==this.lights.indexOf(t)||t instanceof i.d&&-1!==this.cameras.indexOf(t)))}_isValidHierarchy(){for(const t of this.meshes)if(t.parent&&!this._isNodeInContainer(t.parent))return C.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.transformNodes)if(t.parent&&!this._isNodeInContainer(t.parent))return C.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.lights)if(t.parent&&!this._isNodeInContainer(t.parent))return C.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.cameras)if(t.parent&&!this._isNodeInContainer(t.parent))return C.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(t){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||B.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const o={},z={},r=new a,e=[],C=[],Z={doNotInstantiate:!0,...S},b=[],O=new Set;for(const B of this.transformNodes)null===B.parent&&this._addNodeAndDescendantsToList(b,O,B,Z.predicate);for(const B of this.meshes)null===B.parent&&this._addNodeAndDescendantsToList(b,O,B,Z.predicate);const i=this._topologicalSort(b),h=(S,B)=>{if(((q,S)=>{if(o[q.uniqueId]=S.uniqueId,z[S.uniqueId]=S,t&&(S.name=t(q.name)),S instanceof L.c){const t=S;if(t.morphTargetManager){const S=q.morphTargetManager;t.morphTargetManager=S.clone();for(let q=0;q<S.numTargets;q++){const B=S.getTarget(q),L=t.morphTargetManager.getTarget(q);o[B.uniqueId]=L.uniqueId,z[L.uniqueId]=L}}}})(S,B),S.parent){const t=o[S.parent.uniqueId],q=z[t];B.parent=q||S.parent}if(B.position&&S.position&&B.position.p(S.position),B.rotationQuaternion&&S.rotationQuaternion&&B.rotationQuaternion.p(S.rotationQuaternion),B.rotation&&S.rotation&&B.rotation.p(S.rotation),B.oi&&S.oi&&B.oi.p(S.oi),B.material){const L=B;if(L.material)if(q){const q=S.material;if(-1===C.indexOf(q)){let S=q.clone(t?t(q.name):"Clone of "+q.name);if(C.push(q),o[q.uniqueId]=S.uniqueId,z[S.uniqueId]=S,"MultiMaterial"===q.getClassName()){const B=q;for(const q of B.Ii)q&&(S=q.clone(t?t(q.name):"Clone of "+q.name),C.push(q),o[q.uniqueId]=S.uniqueId,z[S.uniqueId]=S);B.Ii=B.Ii.map((t=>t&&z[o[t.uniqueId]]))}}"InstancedMesh"!==L.getClassName()&&(L.material=z[o[q.uniqueId]])}else"MultiMaterial"===L.material.getClassName()?-1===this.Tk.multiMaterials.indexOf(L.material)&&this.Tk.addMultiMaterial(L.material):-1===this.Tk.materials.indexOf(L.material)&&this.Tk.addMaterial(L.material)}null===B.parent&&r.rootNodes.push(B)};for(const B of i)if("InstancedMesh"===B.getClassName()){const t=B,q=t.sourceMesh,S=o[q.uniqueId];h(t,("number"===typeof S?z[S]:q).createInstance(t.name))}else{let t=!0;"ij"===B.getClassName()||"Node"===B.getClassName()||B.skeleton||!B.getTotalVertices||0===B.getTotalVertices()?t=!1:Z.doNotInstantiate&&(t="function"===typeof Z.doNotInstantiate?!Z.doNotInstantiate(B):!Z.doNotInstantiate);const q=t?B.createInstance(`instance of ${B.name}`):B.clone(`Clone of ${B.name}`,null,!0);if(!q)throw new Error(`Could not clone or instantiate node on Asset Container ${B.name}`);h(B,q)}for(const B of this.skeletons){if(Z.predicate&&!Z.predicate(B))continue;const q=B.clone(t?t(B.name):"Clone of "+B.name);for(const t of this.meshes)if(t.skeleton===B&&!t.isAnInstance){const S=z[o[t.uniqueId]];if(!S||S.isAnInstance)continue;if(S.skeleton=q,-1!==e.indexOf(q))continue;e.push(q);for(const t of q.bones)t._linkedTransformNode&&(t._linkedTransformNode=z[o[t._linkedTransformNode.uniqueId]])}r.skeletons.push(q)}for(const B of this.animationGroups){if(Z.predicate&&!Z.predicate(B))continue;const q=B.clone(t?t(B.name):"Clone of "+B.name,(t=>z[o[t.uniqueId]]||t));r.animationGroups.push(q)}return r}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||B.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Tk.environmentTexture=this.environmentTexture);for(const t of this.Tk._serializableComponents)t.addFromContainer(this);this.Tk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const q=[];for(const S of this.cameras)t&&!t(S)||(this.Tk.addCamera(S),q.push(S));for(const S of this.lights)t&&!t(S)||(this.Tk.addLight(S),q.push(S));for(const S of this.meshes)t&&!t(S)||(this.Tk.dj(S),q.push(S));for(const S of this.skeletons)t&&!t(S)||this.Tk.addSkeleton(S);for(const S of this.animations)t&&!t(S)||this.Tk.addAnimation(S);for(const S of this.animationGroups)t&&!t(S)||this.Tk.addAnimationGroup(S);for(const S of this.multiMaterials)t&&!t(S)||this.Tk.addMultiMaterial(S);for(const S of this.materials)t&&!t(S)||this.Tk.addMaterial(S);for(const S of this.morphTargetManagers)t&&!t(S)||this.Tk.addMorphTargetManager(S);for(const S of this.geometries)t&&!t(S)||this.Tk.addGeometry(S);for(const S of this.transformNodes)t&&!t(S)||(this.Tk.addTransformNode(S),q.push(S));for(const S of this.actionManagers)t&&!t(S)||this.Tk.addActionManager(S);for(const S of this.textures)t&&!t(S)||this.Tk.addTexture(S);for(const S of this.reflectionProbes)t&&!t(S)||this.Tk.addReflectionProbe(S);for(const S of q)S.parent&&-1===this.Tk.getNodes().indexOf(S.parent)&&(S.setParent?S.setParent(null):S.parent=null)}removeAllFromScene(){this._isValidHierarchy()||B.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Tk.environmentTexture&&(this.Tk.environmentTexture=null);for(const t of this.Tk._serializableComponents)t.removeFromContainer(this)}removeFromScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const q of this.cameras)t&&!t(q)||this.Tk.removeCamera(q);for(const q of this.lights)t&&!t(q)||this.Tk.removeLight(q);for(const q of this.meshes)t&&!t(q)||this.Tk.fj(q,!0);for(const q of this.skeletons)t&&!t(q)||this.Tk.removeSkeleton(q);for(const q of this.animations)t&&!t(q)||this.Tk.removeAnimation(q);for(const q of this.animationGroups)t&&!t(q)||this.Tk.removeAnimationGroup(q);for(const q of this.multiMaterials)t&&!t(q)||this.Tk.removeMultiMaterial(q);for(const q of this.materials)t&&!t(q)||this.Tk.removeMaterial(q);for(const q of this.morphTargetManagers)t&&!t(q)||this.Tk.removeMorphTargetManager(q);for(const q of this.geometries)t&&!t(q)||this.Tk.removeGeometry(q);for(const q of this.transformNodes)t&&!t(q)||this.Tk.removeTransformNode(q);for(const q of this.actionManagers)t&&!t(q)||this.Tk.removeActionManager(q);for(const q of this.textures)t&&!t(q)||this.Tk.removeTexture(q);for(const q of this.reflectionProbes)t&&!t(q)||this.Tk.removeReflectionProbe(q)}dispose(){const t=this.cameras.slice(0);for(const i of t)i.dispose();this.cameras.length=0;const q=this.lights.slice(0);for(const i of q)i.dispose();this.lights.length=0;const S=this.meshes.slice(0);for(const i of S)i.dispose();this.meshes.length=0;const o=this.skeletons.slice(0);for(const i of o)i.dispose();this.skeletons.length=0;const B=this.animationGroups.slice(0);for(const i of B)i.dispose();this.animationGroups.length=0;const z=this.multiMaterials.slice(0);for(const i of z)i.dispose();this.multiMaterials.length=0;const L=this.materials.slice(0);for(const i of L)i.dispose();this.materials.length=0;const r=this.geometries.slice(0);for(const i of r)i.dispose();this.geometries.length=0;const e=this.transformNodes.slice(0);for(const i of e)i.dispose();this.transformNodes.length=0;const C=this.actionManagers.slice(0);for(const i of C)i.dispose();this.actionManagers.length=0;const Z=this.textures.slice(0);for(const i of Z)i.dispose();this.textures.length=0;const b=this.reflectionProbes.slice(0);for(const i of b)i.dispose();this.reflectionProbes.length=0;const O=this.morphTargetManagers.slice(0);for(const i of O)i.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const i of this.Tk._serializableComponents)i.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Tk.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(t,q,S){if(t&&q)for(const o of t){let t=!0;if(S)for(const q of S)if(o===q){t=!1;break}t&&(q.push(o),o._parentContainer=this)}}moveAllFromScene(t){this._wasAddedToScene=!1,void 0===t&&(t=new I);for(const q in this)Object.prototype.hasOwnProperty.call(this,q)&&(this[q]=this[q]||("_environmentTexture"===q?null:[]),this._moveAssets(this.Tk[q],this[q],t[q]));this.environmentTexture=this.Tk.environmentTexture,this.removeAllFromScene()}createRootMesh(){const t=new L.c("assetContainerRootMesh",this.Tk);for(const q of this.meshes)q.parent||t.addChild(q);return this.meshes.unshift(t),t}mergeAnimationsTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.b.LastCreatedScene,q=arguments.length>1?arguments[1]:void 0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return C.c.Error("No scene available to merge animations to"),[];const o=S||(q=>{let S=null;const o=q.animations.length?q.animations[0].targetProperty:"",B=q.name.split(".").join("").split("_primitive")[0];switch(o){case"position":case"rotationQuaternion":S=t.getTransformNodeByName(q.name)||t.getTransformNodeByName(B);break;case"influence":S=t.getMorphTargetByName(q.name)||t.getMorphTargetByName(B);break;default:S=t.getNodeByName(q.name)||t.getNodeByName(B)}return S}),B=this.getNodes();for(const r of B){const t=o(r);if(null!==t){for(const q of r.animations){const S=t.animations.filter((t=>t.targetProperty===q.targetProperty));for(const q of S){const S=t.animations.indexOf(q,0);S>-1&&t.animations.splice(S,1)}}t.animations=t.animations.concat(r.animations)}}const z=[],L=this.animationGroups.slice();for(const r of L){z.push(r.clone(r.name,o));for(const t of r.animatables)t.stop()}for(const r of q){const q=o(r.target);q&&(t.beginAnimation(q,r.fromFrame,r.toFrame,r.loopAnimation,r.speedRatio,r.onAnimationEnd?r.onAnimationEnd:void 0,void 0,!0,void 0,r.onAnimationLoop?r.onAnimationLoop:void 0),t.stopAnimation(r.target))}return z}populateRootNodes(){this.rootNodes.length=0;for(const t of this.meshes)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.transformNodes)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.lights)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.cameras)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t)}addAllAssetsToContainer(t){if(!t)return;const q=[],S=new Set;for(q.push(t);q.length>0;){const t=q.pop();if(t instanceof L.c?(t.xi&&-1===this.geometries.indexOf(t.xi)&&this.geometries.push(t.xi),this.meshes.push(t)):t instanceof b.c?this.meshes.push(t):t instanceof r.e?this.transformNodes.push(t):t instanceof O.b?this.lights.push(t):t instanceof i.d&&this.cameras.push(t),t instanceof e.b){if(t.material&&-1===this.materials.indexOf(t.material)){this.materials.push(t.material);for(const q of t.material.getActiveTextures())-1===this.textures.indexOf(q)&&this.textures.push(q)}t.skeleton&&-1===this.skeletons.indexOf(t.skeleton)&&this.skeletons.push(t.skeleton),t.morphTargetManager&&-1===this.morphTargetManagers.indexOf(t.morphTargetManager)&&this.morphTargetManagers.push(t.morphTargetManager)}for(const o of t.getChildren())S.has(o)||q.push(o);S.add(t)}this.populateRootNodes()}_getByTags(t,q,S){if(void 0===q)return t;const o=[];for(const B in t){const z=t[B];h.e&&h.e.MatchesQuery(z,q)&&(!S||S(z))&&o.push(z)}return o}getMeshesByTags(t,q){return this._getByTags(this.meshes,t,q)}getCamerasByTags(t,q){return this._getByTags(this.cameras,t,q)}getLightsByTags(t,q){return this._getByTags(this.lights,t,q)}getMaterialsByTags(t,q){return this._getByTags(this.materials,t,q).concat(this._getByTags(this.multiMaterials,t,q))}getTransformNodesByTags(t,q){return this._getByTags(this.transformNodes,t,q)}}var M=S(544);class x{constructor(t){this.byteOffset=0,this.buffer=t}async loadAsync(t){const q=await this.buffer.readAsync(this.byteOffset,t);this._dataView=new DataView(q.buffer,q.byteOffset,q.byteLength),this._dataByteOffset=0}readUint32(){const t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t}readUint8Array(t){const q=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,q}readString(t){return(0,M.j)(this.readUint8Array(t))}skipBytes(t){this._dataByteOffset+=t,this.byteOffset+=t}}var k=S(12874);const V="Z2xURg",J={name:"Ni",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:t=>-1!==t.indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+V)||t.startsWith("data:;base64,"+V)||t.startsWith("data:application/octet-stream;base64,"+V)||t.startsWith("data:model/gltf-binary;base64,"+V)};var U,H,j,y=S(527),Q=S(536);function K(t,q,S){try{return Promise.resolve(new Uint8Array(t,q,S))}catch(o){return Promise.reject(o)}}!function(t){t[t.AUTO=0]="AUTO",t[t.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(U||(U={})),function(t){t[t.NONE=0]="NONE",t[t.FIRST=1]="FIRST",t[t.ALL=2]="ALL"}(H||(H={})),function(t){t[t.LOADING=0]="LOADING",t[t.READY=1]="READY",t[t.COMPLETE=2]="COMPLETE"}(j||(j={}));class X{constructor(){this.coordinateSystemMode=U.AUTO,this.animationStartMode=H.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=t=>Promise.resolve(t),this.extensionOptions={}}p(t){t&&(this.onParsed=t.onParsed,this.coordinateSystemMode=t.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=t.animationStartMode??this.animationStartMode,this.loadNodeAnimations=t.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=t.loadSkins??this.loadSkins,this.loadMorphTargets=t.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=t.compileMaterials??this.compileMaterials,this.useClipPlane=t.useClipPlane??this.useClipPlane,this.compileShadowGenerators=t.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=t.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=t.useRangeRequests??this.useRangeRequests,this.createInstances=t.createInstances??this.createInstances,this.alwaysComputeBoundingBox=t.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=t.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=t.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=t.skipMaterials??this.skipMaterials,this.useSRGBBuffers=t.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=t.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=t.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=t.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=t.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=t.customRootNode,this.onMeshLoaded=t.onMeshLoaded,this.onSkinLoaded=t.onSkinLoaded,this.onTextureLoaded=t.onTextureLoaded,this.onMaterialLoaded=t.onMaterialLoaded,this.onCameraLoaded=t.onCameraLoaded,this.extensionOptions=t.extensionOptions??this.extensionOptions)}}class G extends X{constructor(t){super(),this.onParsedObservable=new o.b,this.onMeshLoadedObservable=new o.b,this.onSkinLoadedObservable=new o.b,this.onTextureLoadedObservable=new o.b,this.onMaterialLoadedObservable=new o.b,this.onCameraLoadedObservable=new o.b,this.onCompleteObservable=new o.b,this.onErrorObservable=new o.b,this.Qi=new o.b,this.onExtensionLoadedObservable=new o.b,this.validate=!1,this.onValidatedObservable=new o.b,this._loader=null,this._state=null,this._requests=new Array,this.name=J.name,this.extensions=J.extensions,this.onLoaderStateChangedObservable=new o.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(t)}set onParsed(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),t&&(this._onParsedObserver=this.onParsedObservable.add(t))}set onMeshLoaded(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),t&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t))}set onSkinLoaded(t){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),t&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((q=>t(q.node,q.skinnedNode))))}set onTextureLoaded(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),t&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t))}set onMaterialLoaded(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),t&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t))}set onCameraLoaded(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),t&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t))}set onComplete(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)}set onError(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)}set onDispose(t){this._onDisposeObserver&&this.Qi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qi.add(t)}set onExtensionLoaded(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const t of this._requests)t.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=t=>Promise.resolve(t),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Qi.notifyObservers(void 0),this.Qi.clear()}loadFile(t,q,S,z,L,r,e,Z){if(ArrayBuffer.isView(q))return this._loadBinary(t,q,S,z,e,Z),null;this._progressCallback=L;const b=q.name||B.f.GetFilename(q);if(r){if(this.useRangeRequests){this.validate&&C.c.Warn("glTF validation is not supported when range requests are enabled");const S={abort:()=>{},onCompleteObservable:new o.b},B={readAsync:(S,o)=>new Promise(((B,z)=>{this._loadFile(t,q,(t=>{B(new Uint8Array(t))}),!0,(t=>{z(t)}),(t=>{t.setRequestHeader("Range",`bytes=${S}-${S+o-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new x(B)).then((t=>{S.onCompleteObservable.notifyObservers(S),z(t)}),e?t=>e(void 0,t):void 0),S}return this._loadFile(t,q,(q=>{this._validate(t,new Uint8Array(q,0,q.byteLength),S,b),this._unpackBinaryAsync(new x({readAsync:(t,S)=>K(q,t,S),byteLength:q.byteLength})).then((t=>{z(t)}),e?t=>e(void 0,t):void 0)}),!0,e)}return this._loadFile(t,q,(q=>{try{this._validate(t,q,S,b),z({json:this._parseJson(q)})}catch{e&&e()}}),!1,e)}_loadBinary(t,q,S,o,B,z){this._validate(t,new Uint8Array(q.buffer,q.byteOffset,q.byteLength),S,z),this._unpackBinaryAsync(new x({readAsync:(t,S)=>function(t,q,S){try{if(q<0||q>=t.byteLength)throw new RangeError("Offset is out of range.");if(q+S>t.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(t.buffer,t.byteOffset+q,S))}catch(o){return Promise.reject(o)}}(q,t,S),byteLength:q.byteLength})).then((t=>{o(t)}),B?t=>B(void 0,t):void 0)}importMeshAsync(t,q,S,o,B,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(S),this._loader.importMeshAsync(t,q,null,S,o,B,z))))}loadAsync(t,q,S,o,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(q),this._loader.loadAsync(t,q,S,o,B))))}loadAssetContainerAsync(t,q,S,o,B){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(q);const z=new v(t),L=[];this.onMaterialLoadedObservable.add((t=>{L.push(t)}));const r=[];this.onTextureLoadedObservable.add((t=>{r.push(t)}));const e=[];this.onCameraLoadedObservable.add((t=>{e.push(t)}));const C=[];return this.onMeshLoadedObservable.add((t=>{t.morphTargetManager&&C.push(t.morphTargetManager)})),this._loader.importMeshAsync(null,t,z,q,S,o,B).then((t=>(Array.prototype.push.apply(z.geometries,t.geometries),Array.prototype.push.apply(z.meshes,t.meshes),Array.prototype.push.apply(z.zi,t.zi),Array.prototype.push.apply(z.skeletons,t.skeletons),Array.prototype.push.apply(z.animationGroups,t.animationGroups),Array.prototype.push.apply(z.materials,L),Array.prototype.push.apply(z.textures,r),Array.prototype.push.apply(z.lights,t.lights),Array.prototype.push.apply(z.transformNodes,t.transformNodes),Array.prototype.push.apply(z.cameras,e),Array.prototype.push.apply(z.morphTargetManagers,C),z)))}))}canDirectLoad(t){return J.canDirectLoad(t)}directLoad(t,q){if(q.startsWith("base64,"+V)||q.startsWith(";base64,"+V)||q.startsWith("application/octet-stream;base64,"+V)||q.startsWith("model/gltf-binary;base64,"+V)){const S=(0,y.b)(q);return this._validate(t,new Uint8Array(S,0,S.byteLength)),this._unpackBinaryAsync(new x({readAsync:(t,q)=>K(S,t,q),byteLength:S.byteLength}))}return this._validate(t,q),Promise.resolve({json:this._parseJson(q)})}createPlugin(t){return new G(t[J.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((t,q)=>{this.onCompleteObservable.addOnce((()=>{t()})),this.onErrorObservable.addOnce((t=>{q(t)}))}))}_setState(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(j[this._state]))}_loadFile(t,q,S,o,B,z){const L=t._loadFile(q,S,(t=>{this._onProgress(t,L)}),!0,o,B,z);return L.onCompleteObservable.add((()=>{L._lengthComputable=!0,L._total=L._loaded})),this._requests.push(L),L}_onProgress(t,q){if(!this._progressCallback)return;q._lengthComputable=t.lengthComputable,q._loaded=t.loaded,q._total=t.total;let S=!0,o=0,B=0;for(const z of this._requests){if(void 0===z._lengthComputable||void 0===z._loaded||void 0===z._total)return;S=S&&z._lengthComputable,o+=z._loaded,B+=z._total}this._progressCallback({lengthComputable:S,loaded:o,total:S?B:0})}_validate(t,q){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),k.d.ValidateAsync(q,S,o,(q=>this.preprocessUrlAsync(S+q).then((q=>t._loadFileAsync(q,void 0,!0,!0).then((t=>new Uint8Array(t,0,t.byteLength))))))).then((t=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(t),this.onValidatedObservable.clear()}),(t=>{this._endPerformanceCounter("Validate JSON"),B.f.Warn(`Failed to validate: ${t.message}`),this.onValidatedObservable.clear()})))}_getLoader(t){const q=t.json.asset||{};this._log(`Asset version: ${q.version}`),q.minVersion&&this._log(`Asset minimum version: ${q.minVersion}`),q.generator&&this._log(`Asset generator: ${q.generator}`);const S=G._parseVersion(q.version);if(!S)throw new Error("Invalid version: "+q.version);if(void 0!==q.minVersion){const t=G._parseVersion(q.minVersion);if(!t)throw new Error("Invalid minimum version: "+q.minVersion);if(G._compareVersion(t,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+q.minVersion)}const o={1:G._CreateGLTF1Loader,2:G._CreateGLTF2Loader}[S.major];if(!o)throw new Error("Unsupported version: "+q.version);return o(this)}_parseJson(t){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${t.length}`);const q=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),q}_unpackBinaryAsync(t){return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then((()=>{const q=t.readUint32();if(1179937895!==q)throw new Q.g("Unexpected magic: "+q,Q.c.GLTFLoaderUnexpectedMagicError);const S=t.readUint32();this.loggingEnabled&&this._log(`Binary version: ${S}`);const o=t.readUint32();let B;switch(this.useRangeRequests||o===t.buffer.byteLength||C.c.Warn(`Length in header does not match actual data length: ${o} != ${t.buffer.byteLength}`),S){case 1:B=this._unpackBinaryV1Async(t,o);break;case 2:B=this._unpackBinaryV2Async(t,o);break;default:throw new Error("Unsupported version: "+S)}return this._endPerformanceCounter("Unpack Binary"),B}))}_unpackBinaryV1Async(t,q){const S=t.readUint32(),o=t.readUint32();if(0!==o)throw new Error(`Unexpected content format: ${o}`);const B=q-t.byteOffset,z={json:this._parseJson(t.readString(S)),bin:null};if(0!==B){const q=t.byteOffset;z.bin={readAsync:(S,o)=>t.buffer.readAsync(q+S,o),byteLength:B}}return Promise.resolve(z)}_unpackBinaryV2Async(t,q){const S=1313821514,o=5130562,B=t.readUint32();if(t.readUint32()!==S)throw new Error("First chunk format is not JSON");return t.byteOffset+B===q?t.loadAsync(B).then((()=>({json:this._parseJson(t.readString(B)),bin:null}))):t.loadAsync(B+8).then((()=>{const z={json:this._parseJson(t.readString(B)),bin:null},L=()=>{const B=t.readUint32();switch(t.readUint32()){case S:throw new Error("Unexpected JSON chunk");case o:{const q=t.byteOffset;z.bin={readAsync:(S,o)=>t.buffer.readAsync(q+S,o),byteLength:B},t.skipBytes(B);break}default:t.skipBytes(B)}return t.byteOffset!==q?t.loadAsync(8).then(L):Promise.resolve(z)};return L()}))}static _parseVersion(t){if("1.0"===t||"1.0.1"===t)return{major:1,minor:0};const q=(t+"").match(/^(\d+)\.(\d+)/);return q?{major:parseInt(q[1]),minor:parseInt(q[2])}:null}static _compareVersion(t,q){return t.major>q.major?1:t.major<q.major?-1:t.minor>q.minor?1:t.minor<q.minor?-1:0}_logOpen(t){this._log(t),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(t){const q=G._logSpaces.substring(0,2*this._logIndentLevel);C.c.Log(`${q}${t}`)}_logDisabled(t){}_startPerformanceCounterEnabled(t){B.f.StartPerformanceCounter(t)}_startPerformanceCounterDisabled(t){}_endPerformanceCounterEnabled(t){B.f.EndPerformanceCounter(t)}_endPerformanceCounterDisabled(t){}}G.IncrementalLoading=!0,G.HomogeneousCoordinates=!1,G._logSpaces="                                ",(0,z.b)(new G)},12874:(t,q,S)=>{"use strict";S.d(q,{d:()=>L});var o=S(490);function B(t,q,S,o){const B={externalResourceFunction:o};return S&&(B.uri="file:"===q?S:q+S),ArrayBuffer.isView(t)?GLTFValidator.validateBytes(t,B):GLTFValidator.validateString(t,B)}function z(){const t=[];onmessage=q=>{const S=q.data;switch(S.id){case"init":importScripts(S.url);break;case"validate":B(S.data,S.rootUrl,S.fileName,(q=>new Promise(((S,o)=>{const B=t.length;t.push({resolve:S,reject:o}),postMessage({id:"getExternalResource",index:B,uri:q})})))).then((t=>{postMessage({id:"validate.resolve",value:t})}),(t=>{postMessage({id:"validate.reject",reason:t})}));break;case"getExternalResource.resolve":t[S.index].resolve(S.value);break;case"getExternalResource.reject":t[S.index].reject(S.reason)}}}class L{static ValidateAsync(t,q,S,L){return"function"===typeof Worker?new Promise(((r,e)=>{const C=`${B}(${z})()`,Z=URL.createObjectURL(new Blob([C],{type:"application/javascript"})),b=new Worker(Z),O=t=>{b.removeEventListener("error",O),b.removeEventListener("message",i),e(t)},i=t=>{const q=t.data;switch(q.id){case"getExternalResource":L(q.uri).then((t=>{b.postMessage({id:"getExternalResource.resolve",index:q.index,value:t},[t.buffer])}),(t=>{b.postMessage({id:"getExternalResource.reject",index:q.index,reason:t})}));break;case"validate.resolve":b.removeEventListener("error",O),b.removeEventListener("message",i),r(q.value),b.terminate();break;case"validate.reject":b.removeEventListener("error",O),b.removeEventListener("message",i),e(q.reason),b.terminate()}};if(b.addEventListener("error",O),b.addEventListener("message",i),b.postMessage({id:"init",url:o.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(t)){const o=t.slice();b.postMessage({id:"validate",data:o,rootUrl:q,fileName:S},[o.buffer])}else b.postMessage({id:"validate",data:t,rootUrl:q,fileName:S})})):(this._LoadScriptPromise||(this._LoadScriptPromise=o.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>B(t,q,S,L))))}}L.Configuration={url:`${o.f._DefaultCdnUrl}/gltf_validator.js`}},13219:(t,q,S)=>{"use strict";S.d(q,{b:()=>J});var o=S(653),B=S(658),z=S(701),L=S(678),r=S(11965),e=S(11980),C=S(716),Z=S(2428),b=S(622),O=S(572);S(12631),S(12552),S(12568),S(12556),S(12571),S(12575),S(12583);const i="imageProcessingCompatibility",h="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";O.e.IncludesShadersStore[i]||(O.e.IncludesShadersStore[i]=h);const l="skyPixelShader",I="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";O.e.ShadersStore[l]||(O.e.ShadersStore[l]=I);S(12641),S(12587),S(12591),S(12601),S(12596);const a="skyVertexShader",v="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";O.e.ShadersStore[a]||(O.e.ShadersStore[a]=v);var M=S(11988),x=S(833),k=S(825);class V extends r.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class J extends e.b{constructor(t,q){super(t,q),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new L.o(0,100,0),this.useSunPosition=!1,this.cameraOffset=L.o.Zero(),this.up=L.o.Up(),this.dithering=!1,this._cameraPosition=L.o.Zero(),this._skyOrientation=new L.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,q){const S=q._drawWrapper;if(this.isFrozen&&S.effect&&S._wasPreviouslyReady)return!0;q.materialDefines||(q.materialDefines=new V);const o=q.materialDefines,B=this.va();if(this._isReadyForSubMesh(q))return!0;if((0,k.U)(t,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,o),(0,k.H)(t,o,!0,!1),o.IMAGEPROCESSINGPOSTPROCESS!==B.imageProcessingConfiguration.applyByPostProcess&&o.markAsMiscDirty(),o.DITHER!==this.dithering&&o.markAsMiscDirty(),o.isDirty){o.markAsProcessed(),B.resetCachedMaterial();const t=new M.c;o.FOG&&t.addFallback(1,"FOG"),o.IMAGEPROCESSINGPOSTPROCESS=B.imageProcessingConfiguration.applyByPostProcess,o.DITHER=this.dithering;const S=[C.i.PositionKind];o.VERTEXCOLOR&&S.push(C.i.ColorKind);const z="sky",L=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,x.c)(L);const r=o.toString();q.setEffect(B.getEngine().createEffect(z,S,L,[],r,t,this.onCompiled,this.onError),o,this._materialContext)}return!(!q.effect||!q.effect.isReady())&&(o._renderId=B.getRenderId(),S._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,q,S){const o=this.va(),B=S.materialDefines;if(!B)return;const z=S.effect;if(!z)return;this._activeEffect=z,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",o.getTransformMatrix()),this._mustRebind(o,z,S)&&((0,x.f)(z,this,o),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,k.k)(B,z,o)),o.fogEnabled&&q.applyFog&&o.fogMode!==Z.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",o.getViewMatrix()),(0,k.f)(o,q,this._activeEffect);const r=o.activeCamera;if(r){const t=r.getWorldMatrix();this._cameraPosition.x=t.m[12],this._cameraPosition.y=t.m[13],this._cameraPosition.z=t.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const t=Math.PI*(this.inclination-.5),q=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(q)*Math.cos(t),this.sunPosition.y=this.distance*Math.sin(-t),this.sunPosition.z=this.distance*Math.sin(q)*Math.cos(t),L.g.FromUnitVectorsToRef(L.o.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(q,this._activeEffect,S)}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return z.b.Clone((()=>new J(t,this.va())),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.SkyMaterial",t}getClassName(){return"SkyMaterial"}static Parse(t,q,S){return z.b.Parse((()=>new J(t.name,q)),t,q,S)}}(0,o.e)([(0,B.C)()],J.prototype,"luminance",void 0),(0,o.e)([(0,B.C)()],J.prototype,"turbidity",void 0),(0,o.e)([(0,B.C)()],J.prototype,"rayleigh",void 0),(0,o.e)([(0,B.C)()],J.prototype,"mieCoefficient",void 0),(0,o.e)([(0,B.C)()],J.prototype,"mieDirectionalG",void 0),(0,o.e)([(0,B.C)()],J.prototype,"distance",void 0),(0,o.e)([(0,B.C)()],J.prototype,"inclination",void 0),(0,o.e)([(0,B.C)()],J.prototype,"azimuth",void 0),(0,o.e)([(0,B.B)()],J.prototype,"sunPosition",void 0),(0,o.e)([(0,B.C)()],J.prototype,"useSunPosition",void 0),(0,o.e)([(0,B.B)()],J.prototype,"cameraOffset",void 0),(0,o.e)([(0,B.B)()],J.prototype,"up",void 0),(0,o.e)([(0,B.C)()],J.prototype,"dithering",void 0),(0,b.c)("BABYLON.SkyMaterial",J)},12122:(t,q,S)=>{"use strict";function o(t,q){q.headers=t.headers||{},q.statusMessage=t.statusText,q.statusCode=t.status,q.data=t.response}function B(t,q,S){return new Promise((function(B,z){S=S||{};var L,r,e,C=new XMLHttpRequest,Z=S.body,b=S.headers||{};for(L in S.timeout&&(C.timeout=S.timeout),C.ontimeout=C.onerror=function(t){t.timeout="timeout"==t.type,z(t)},C.open(t,q.href||q),C.onload=function(){for(e=C.getAllResponseHeaders().trim().split(/[\r\n]+/),o(C,C);r=e.shift();)r=r.split(": "),C.headers[r.shift().toLowerCase()]=r.join(": ");if((r=C.headers["content-type"])&&~r.indexOf("application/json"))try{C.data=JSON.parse(C.data,S.reviver)}catch(t){return o(C,t),z(t)}(C.status>=400?z:B)(C)},typeof FormData<"u"&&Z instanceof FormData||Z&&"object"==typeof Z&&(b["content-type"]="application/json",Z=JSON.stringify(Z)),C.withCredentials=!!S.withCredentials,b)C.setRequestHeader(L,b[L]);C.send(Z)}))}S.r(q),S.d(q,{del:()=>e,get:()=>z,patch:()=>r,post:()=>L,put:()=>C,send:()=>B});var z=B.bind(B,"GET"),L=B.bind(B,"POST"),r=B.bind(B,"PATCH"),e=B.bind(B,"DELETE"),C=B.bind(B,"PUT")},13328:(t,q,S)=>{"use strict";S.d(q,{b:()=>b});const o=.5*(Math.sqrt(3)-1),B=(3-Math.sqrt(3))/6,z=1/3,L=1/6,r=(Math.sqrt(5)-1)/4,e=(5-Math.sqrt(5))/20,C=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const b=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const q="function"==typeof t?t:function(t){let q=0,S=0,o=0,B=1;const z=function(){let t=4022871197;return function(q){q=q.toString();for(let S=0;S<q.length;S++){t+=q.charCodeAt(S);let o=.02519603282416938*t;t=o>>>0,o-=t,o*=t,t=o>>>0,o-=t,t+=4294967296*o}return 2.3283064365386963e-10*(t>>>0)}}();q=z(" "),S=z(" "),o=z(" "),q-=z(t),q<0&&(q+=1);S-=z(t),S<0&&(S+=1);o-=z(t),o<0&&(o+=1);return function(){const t=2091639*q+2.3283064365386963e-10*B;return q=S,S=o,o=t-(B=0|t)}}(t);this.p=function(t){const q=new Uint8Array(256);for(let S=0;S<256;S++)q[S]=S;for(let S=0;S<255;S++){const o=S+~~(t()*(256-S)),B=q[S];q[S]=q[o],q[o]=B}return q}(q),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let S=0;S<512;S++)this.perm[S]=this.p[255&S],this.permMod12[S]=this.perm[S]%12}noise2D(t,q){const S=this.permMod12,z=this.perm;let L=0,r=0,e=0;const Z=(t+q)*o,b=Math.floor(t+Z),O=Math.floor(q+Z),i=(b+O)*B,h=t-(b-i),l=q-(O-i);let I,a;h>l?(I=1,a=0):(I=0,a=1);const v=h-I+B,M=l-a+B,x=h-1+2*B,k=l-1+2*B,V=255&b,J=255&O;let U=.5-h*h-l*l;if(U>=0){const t=3*S[V+z[J]];U*=U,L=U*U*(C[t]*h+C[t+1]*l)}let H=.5-v*v-M*M;if(H>=0){const t=3*S[V+I+z[J+a]];H*=H,r=H*H*(C[t]*v+C[t+1]*M)}let j=.5-x*x-k*k;if(j>=0){const t=3*S[V+1+z[J+1]];j*=j,e=j*j*(C[t]*x+C[t+1]*k)}return 70*(L+r+e)}noise3D(t,q,S){const o=this.permMod12,B=this.perm;let r,e,Z,b;const O=(t+q+S)*z,i=Math.floor(t+O),h=Math.floor(q+O),l=Math.floor(S+O),I=(i+h+l)*L,a=t-(i-I),v=q-(h-I),M=S-(l-I);let x,k,V,J,U,H;a>=v?v>=M?(x=1,k=0,V=0,J=1,U=1,H=0):a>=M?(x=1,k=0,V=0,J=1,U=0,H=1):(x=0,k=0,V=1,J=1,U=0,H=1):v<M?(x=0,k=0,V=1,J=0,U=1,H=1):a<M?(x=0,k=1,V=0,J=0,U=1,H=1):(x=0,k=1,V=0,J=1,U=1,H=0);const j=a-x+L,y=v-k+L,Q=M-V+L,K=a-J+2*L,X=v-U+2*L,G=M-H+2*L,Y=a-1+.5,n=v-1+.5,u=M-1+.5,W=255&i,f=255&h,D=255&l;let m=.6-a*a-v*v-M*M;if(m<0)r=0;else{const t=3*o[W+B[f+B[D]]];m*=m,r=m*m*(C[t]*a+C[t+1]*v+C[t+2]*M)}let A=.6-j*j-y*y-Q*Q;if(A<0)e=0;else{const t=3*o[W+x+B[f+k+B[D+V]]];A*=A,e=A*A*(C[t]*j+C[t+1]*y+C[t+2]*Q)}let c=.6-K*K-X*X-G*G;if(c<0)Z=0;else{const t=3*o[W+J+B[f+U+B[D+H]]];c*=c,Z=c*c*(C[t]*K+C[t+1]*X+C[t+2]*G)}let s=.6-Y*Y-n*n-u*u;if(s<0)b=0;else{const t=3*o[W+1+B[f+1+B[D+1]]];s*=s,b=s*s*(C[t]*Y+C[t+1]*n+C[t+2]*u)}return 32*(r+e+Z+b)}noise4D(t,q,S,o){const B=this.perm;let z,L,C,b,O;const i=(t+q+S+o)*r,h=Math.floor(t+i),l=Math.floor(q+i),I=Math.floor(S+i),a=Math.floor(o+i),v=(h+l+I+a)*e,M=t-(h-v),x=q-(l-v),k=S-(I-v),V=o-(a-v);let J=0,U=0,H=0,j=0;M>x?J++:U++,M>k?J++:H++,M>V?J++:j++,x>k?U++:H++,x>V?U++:j++,k>V?H++:j++;const y=J>=3?1:0,Q=U>=3?1:0,K=H>=3?1:0,X=j>=3?1:0,G=J>=2?1:0,Y=U>=2?1:0,n=H>=2?1:0,u=j>=2?1:0,W=J>=1?1:0,f=U>=1?1:0,D=H>=1?1:0,m=j>=1?1:0,A=M-y+e,c=x-Q+e,s=k-K+e,g=V-X+e,N=M-G+2*e,T=x-Y+2*e,w=k-n+2*e,E=V-u+2*e,p=M-W+3*e,P=x-f+3*e,F=k-D+3*e,d=V-m+3*e,R=M-1+4*e,tt=x-1+4*e,qt=k-1+4*e,St=V-1+4*e,ot=255&h,Bt=255&l,zt=255&I,Lt=255&a;let rt=.6-M*M-x*x-k*k-V*V;if(rt<0)z=0;else{const t=B[ot+B[Bt+B[zt+B[Lt]]]]%32*4;rt*=rt,z=rt*rt*(Z[t]*M+Z[t+1]*x+Z[t+2]*k+Z[t+3]*V)}let et=.6-A*A-c*c-s*s-g*g;if(et<0)L=0;else{const t=B[ot+y+B[Bt+Q+B[zt+K+B[Lt+X]]]]%32*4;et*=et,L=et*et*(Z[t]*A+Z[t+1]*c+Z[t+2]*s+Z[t+3]*g)}let Ct=.6-N*N-T*T-w*w-E*E;if(Ct<0)C=0;else{const t=B[ot+G+B[Bt+Y+B[zt+n+B[Lt+u]]]]%32*4;Ct*=Ct,C=Ct*Ct*(Z[t]*N+Z[t+1]*T+Z[t+2]*w+Z[t+3]*E)}let Zt=.6-p*p-P*P-F*F-d*d;if(Zt<0)b=0;else{const t=B[ot+W+B[Bt+f+B[zt+D+B[Lt+m]]]]%32*4;Zt*=Zt,b=Zt*Zt*(Z[t]*p+Z[t+1]*P+Z[t+2]*F+Z[t+3]*d)}let bt=.6-R*R-tt*tt-qt*qt-St*St;if(bt<0)O=0;else{const t=B[ot+1+B[Bt+1+B[zt+1+B[Lt+1]]]]%32*4;bt*=bt,O=bt*bt*(Z[t]*R+Z[t+1]*tt+Z[t+2]*qt+Z[t+3]*St)}return 27*(z+L+C+b+O)}}}}]);