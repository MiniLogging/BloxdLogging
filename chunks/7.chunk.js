(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[7],{12050:function(c,b){!function(c){"use strict";var b=function(c,A){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,b){c.__proto__=b}||function(c,b){for(var A in b)Object.prototype.hasOwnProperty.call(b,A)&&(c[A]=b[A])},b(c,A)};function A(c,A){if("function"!==typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function o(){this.constructor=c}b(c,A),c.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}function o(c,b,A,o){var t,n=arguments.length,h=n<3?b:null===o?o=Object.getOwnPropertyDescriptor(b,A):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)h=Reflect.decorate(c,b,A,o);else for(var s=c.length-1;s>=0;s--)(t=c[s])&&(h=(n<3?t(h):n>3?t(b,A,h):t(b,A))||h);return n>3&&h&&Object.defineProperty(b,A,h),h}function t(c,b,A){if(A||2===arguments.length)for(var o,t=0,n=b.length;t<n;t++)!o&&t in b||(o||(o=Array.prototype.slice.call(b,0,t)),o[t]=b[t]);return c.concat(o||Array.prototype.slice.call(b))}var n,h=255,s=213;c.OPERATION=void 0,(n=c.OPERATION||(c.OPERATION={}))[n.ADD=128]="ADD",n[n.REPLACE=0]="REPLACE",n[n.DELETE=64]="DELETE",n[n.DELETE_AND_ADD=192]="DELETE_AND_ADD",n[n.TOUCH=1]="TOUCH",n[n.CLEAR=10]="CLEAR";var L=function(){function b(c,b,A){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=c,this.setParent(b,A)}return b.prototype.setParent=function(c,b,A){var o=this;if(this.indexes||(this.indexes=this.ref instanceof Oc?this.ref._definition.indexes:{}),this.parent=c,this.parentIndex=A,b)if(this.root=b,this.ref instanceof Oc){var t=this.ref._definition;for(var n in t.schema){var h=this.ref[n];if(h&&h.$changes){var s=t.indexes[n];h.$changes.setParent(this.ref,b,s)}}}else"object"===typeof this.ref&&this.ref.forEach((function(c,b){if(c instanceof Oc){var A=c.$changes,t=o.ref.$changes.indexes[b];A.setParent(o.ref,o.root,t)}}))},b.prototype.operation=function(c){this.changes.set(--this.currentCustomOperation,c)},b.prototype.change=function(b,A){void 0===A&&(A=c.OPERATION.ADD);var o="number"===typeof b?b:this.indexes[b];this.assertValidIndex(o,b);var t=this.changes.get(o);t&&t.op!==c.OPERATION.DELETE&&t.op!==c.OPERATION.TOUCH||this.changes.set(o,{op:t&&t.op===c.OPERATION.DELETE?c.OPERATION.DELETE_AND_ADD:A,index:o}),this.allChanges.add(o),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var A="number"===typeof b?b:this.indexes[b];this.assertValidIndex(A,b),this.changes.has(A)||this.changes.set(A,{op:c.OPERATION.TOUCH,index:A}),this.allChanges.add(A),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(c){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[c]];var b,A=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(A)[0]},b.prototype.getChildrenFilter=function(){var c=this.parent._definition.childFilters;return c&&c[this.parentIndex]},b.prototype.getValue=function(c){return this.ref.getByIndex(c)},b.prototype.delete=function(b){var A="number"===typeof b?b:this.indexes[b];if(void 0!==A){var o=this.getValue(A);this.changes.set(A,{op:c.OPERATION.DELETE,index:A}),this.allChanges.delete(A),delete this.caches[A],o&&o.$changes&&(o.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(A,")"))},b.prototype.discard=function(b,A){var o=this;void 0===b&&(b=!1),void 0===A&&(A=!1),this.ref instanceof Oc||this.changes.forEach((function(b){if(b.op===c.OPERATION.DELETE){var A=o.ref.getIndex(b.index);delete o.indexes[A]}})),this.changes.clear(),this.changed=b,A&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var c=this;this.changes.forEach((function(b){var A=c.getValue(b.index);A&&A.$changes&&A.$changes.discardAll()})),this.discard()},b.prototype.cache=function(c,b){this.caches[c]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(c,b){if(void 0===c)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function C(c,b,A,o){return c[b]||(c[b]=[]),c[b].push(A),null===o||void 0===o||o.forEach((function(c,b){return A(c,b)})),function(){return X(c[b],c[b].indexOf(A))}}function J(b){var A=this,o="string"!==typeof this.$changes.getType();this.$items.forEach((function(t,n){b.push({refId:A.$changes.refId,op:c.OPERATION.DELETE,field:n,value:void 0,previousValue:t}),o&&A.$changes.root.removeRef(t.$changes.refId)}))}function X(c,b){if(-1===b||b>=c.length)return!1;for(var A=c.length-1,o=b;o<A;o++)c[o]=c[o+1];return c.length=A,!0}var R=function(c,b){var A=c.toString(),o=b.toString();return A<o?-1:A>o?1:0};function N(c){return c.$proxy=!0,c=new Proxy(c,{get:function(c,b){return"symbol"===typeof b||isNaN(b)?c[b]:c.at(b)},set:function(c,b,A){if("symbol"===typeof b||isNaN(b))c[b]=A;else{var o=Array.from(c.$items.keys()),t=parseInt(o[b]||b);void 0===A||null===A?c.deleteAt(t):c.setAt(t,A)}return!0},deleteProperty:function(c,b){return"number"===typeof b?c.deleteAt(b):delete c[b],!0}})}var k=function(){function b(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,c)}return b.prototype.Zb=function(b,A){return void 0===A&&(A=!0),C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,b,A?this.$items:void 0)},b.prototype.lc=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,b)},b.is=function(c){return Array.isArray(c)||void 0!==c.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(c){0===c?this.clear():this.splice(c,this.length-c)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var c,b=this,A=[],o=0;o<arguments.length;o++)A[o]=arguments[o];return A.forEach((function(A){c=b.$refId++,b.setAt(c,A)})),c},b.prototype.pop=function(){var c=Array.from(this.$indexes.values()).pop();if(void 0!==c){this.$changes.delete(c),this.$indexes.delete(c);var b=this.$items.get(c);return this.$items.delete(c),b}},b.prototype.at=function(c){var b=Array.from(this.$items.keys())[c];return this.$items.get(b)},b.prototype.setAt=function(b,A){var o,t;if(void 0!==A&&null!==A){if(this.$items.get(b)!==A){void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,b);var n=null!==(t=null===(o=this.$changes.indexes[b])||void 0===o?void 0:o.op)&&void 0!==t?t:c.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,A),this.$changes.change(b,n)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(c){var b=Array.from(this.$items.keys())[c];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(c){return this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&J.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var c,A=[],o=0;o<arguments.length;o++)A[o]=arguments[o];return new(b.bind.apply(b,t([void 0],(c=Array.from(this.$items.values())).concat.apply(c,A),!1)))},b.prototype.join=function(c){return Array.from(this.$items.values()).join(c)},b.prototype.reverse=function(){var c=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(A,o){c.setAt(b[o],A)})),this},b.prototype.shift=function(){var c=Array.from(this.$items.keys()).shift();if(void 0!==c){var b=this.$items.get(c);return this.$deleteAt(c),b}},b.prototype.slice=function(c,A){var o=new b;return o.push.apply(o,Array.from(this.$items.values()).slice(c,A)),o},b.prototype.sort=function(c){var b=this;void 0===c&&(c=R);var A=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(c).forEach((function(c,o){b.setAt(A[o],c)})),this},b.prototype.splice=function(c,b){void 0===b&&(b=this.length-c);for(var A=Array.from(this.$items.keys()),o=[],t=c;t<c+b;t++)o.push(this.$items.get(A[t])),this.$deleteAt(A[t]);return o},b.prototype.unshift=function(){for(var c=this,b=[],A=0;A<arguments.length;A++)b[A]=arguments[A];var o=this.length,t=b.length,n=Array.from(this.$items.values());return b.forEach((function(b,A){c.setAt(A,b)})),n.forEach((function(b,A){c.setAt(t+A,b)})),o+t},b.prototype.indexOf=function(c,b){return Array.from(this.$items.values()).indexOf(c,b)},b.prototype.lastIndexOf=function(c,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(c,b)},b.prototype.every=function(c,b){return Array.from(this.$items.values()).every(c,b)},b.prototype.some=function(c,b){return Array.from(this.$items.values()).some(c,b)},b.prototype.forEach=function(c,b){Array.from(this.$items.values()).forEach(c,b)},b.prototype.map=function(c,b){return Array.from(this.$items.values()).map(c,b)},b.prototype.filter=function(c,b){return Array.from(this.$items.values()).filter(c,b)},b.prototype.reduce=function(c,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(c,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(c,b){return Array.from(this.$items.values()).find(c,b)},b.prototype.findIndex=function(c,b){return Array.from(this.$items.values()).findIndex(c,b)},b.prototype.fill=function(c,b,A){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(c,b,A){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(c,b){return Array.from(this.$items.values()).includes(c,b)},b.prototype.flatMap=function(c,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(c){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var c=Array.from(this.$items.values());return c.findLast.apply(c,arguments)},b.prototype.findLastIndex=function(){var c=Array.from(this.$items.values());return c.findLastIndex.apply(c,arguments)},b.prototype.setIndex=function(c,b){this.$indexes.set(c,b)},b.prototype.getIndex=function(c){return this.$indexes.get(c)},b.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},b.prototype.deleteByIndex=function(c){var b=this.$indexes.get(c);this.$items.delete(b),this.$indexes.delete(c)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(c){return"function"===typeof c.toJSON?c.toJSON():c}))},b.prototype.clone=function(c){return c?new(b.bind.apply(b,t([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,t([void 0],this.map((function(c){return c.$changes?c.clone():c})),!1)))},b}();function E(c){return c.$proxy=!0,c=new Proxy(c,{get:function(c,b){return"symbol"!==typeof b&&"undefined"===typeof c[b]?c.get(b):c[b]},set:function(c,b,A){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"Zb"!==b&&"lc"!==b&&"onChange"!==b?c.set(b,A):c[b]=A,!0},deleteProperty:function(c,b){return c.delete(b),!0}})}var V=function(){function b(c){var A=this;if(this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,c)if(c instanceof Map||c instanceof b)c.forEach((function(c,b){return A.set(b,c)}));else for(var o in c)this.set(o,c[o])}return b.prototype.Zb=function(b,A){return void 0===A&&(A=!0),C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,b,A?this.$items:void 0)},b.prototype.lc=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,b)},b.is=function(c){return void 0!==c.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,A){if(void 0===A||null===A)throw new Error("MapSchema#set('".concat(b,"', ").concat(A,"): trying to set ").concat(A," value on '").concat(b,"'."));b=b.toString();var o="undefined"!==typeof this.$changes.indexes[b],t=o?this.$changes.indexes[b]:this.$refId++,n=o?c.OPERATION.REPLACE:c.OPERATION.ADD,h=void 0!==A.$changes;if(h&&A.$changes.setParent(this,this.$changes.root,t),o){if(!h&&this.$items.get(b)===A)return;h&&this.$items.get(b)!==A&&(n=c.OPERATION.ADD)}else this.$changes.indexes[b]=t,this.$indexes.set(t,b);return this.$items.set(b,A),this.$changes.change(b,n),this},b.prototype.get=function(c){return this.$items.get(c)},b.prototype.delete=function(c){return this.$changes.delete(c),this.$items.delete(c)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&J.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(c){return this.$items.has(c)},b.prototype.forEach=function(c){this.$items.forEach(c)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(c,b){this.$indexes.set(c,b)},b.prototype.getIndex=function(c){return this.$indexes.get(c)},b.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},b.prototype.deleteByIndex=function(c){var b=this.$indexes.get(c);this.$items.delete(b),this.$indexes.delete(c)},b.prototype.toJSON=function(){var c={};return this.forEach((function(b,A){c[A]="function"===typeof b.toJSON?b.toJSON():b})),c},b.prototype.clone=function(c){var A;return c?A=Object.assign(new b,this):(A=new b,this.forEach((function(c,b){c.$changes?A.set(b,c.clone()):A.set(b,c)}))),A},b}(),y={};function j(c,b){y[c]=b}function F(c){return y[c]}var M=function(){function c(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return c.create=function(b){var A=new c;return A.schema=Object.assign({},b&&b.schema||{}),A.indexes=Object.assign({},b&&b.indexes||{}),A.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),A.descriptors=Object.assign({},b&&b.descriptors||{}),A.deprecated=Object.assign({},b&&b.deprecated||{}),A},c.prototype.addField=function(c,b){var A=this.getNextFieldIndex();this.fieldsByIndex[A]=c,this.indexes[c]=A,this.schema[c]=Array.isArray(b)?{array:b[0]}:b},c.prototype.hasField=function(c){return void 0!==this.indexes[c]},c.prototype.addFilter=function(c,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[c]]=b,this.indexesWithFilters.push(this.indexes[c]),!0},c.prototype.addChildrenFilter=function(c,b){var A=this.indexes[c],o=this.schema[c];if(F(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[A]=b,!0;console.warn("@filterChildren: field '".concat(c,"' can't have children. Ignoring filter."))},c.prototype.getChildrenFilter=function(c){return this.childFilters&&this.childFilters[this.indexes[c]]},c.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},c}();function W(c){return c._context&&c._context.useFilters}var d=function(){function c(){this.types={},this.schemas=new Map,this.useFilters=!1}return c.prototype.has=function(c){return this.schemas.has(c)},c.prototype.get=function(c){return this.types[c]},c.prototype.add=function(c,b){void 0===b&&(b=this.schemas.size),c._definition=M.create(c._definition),c._typeid=b,this.types[b]=c,this.schemas.set(c,b)},c.create=function(b){return void 0===b&&(b={}),function(A){return b.context||(b.context=new c),z(A,b)}},c}(),r=new d;function z(c,b){return void 0===b&&(b={}),function(A,o){var n=b.context||r,h=A.constructor;if(h._context=n,!c)throw new Error("".concat(h.name,': @type() reference provided for "').concat(o,"\" is undefined. Make sure you don't have any circular dependencies."));n.has(h)||n.add(h);var s=h._definition;if(s.addField(o,c),s.descriptors[o]){if(s.deprecated[o])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(o,"' definition on '").concat(h.name,"'.\nCheck @type() annotation"))}catch(y){var L=y.stack.split("\n")[4].trim();throw new Error("".concat(y.message," ").concat(L))}}var C=k.is(c),J=!C&&V.is(c);if("string"!==typeof c&&!Oc.is(c)){var X=Object.values(c)[0];"string"===typeof X||n.has(X)||n.add(X)}if(b.manual)s.descriptors[o]={enumerable:!0,configurable:!0,writable:!0};else{var R="_".concat(o);s.descriptors[R]={enumerable:!1,configurable:!1,writable:!0},s.descriptors[o]={get:function(){return this[R]},set:function(c){c!==this[R]&&(void 0!==c&&null!==c?(!C||c instanceof k||(c=new(k.bind.apply(k,t([void 0],c,!1)))),!J||c instanceof V||(c=new V(c)),void 0===c.$proxy&&(J?c=E(c):C&&(c=N(c))),this.$changes.change(o),c.$changes&&c.$changes.setParent(this,this.$changes.root,this._definition.indexes[o])):this[R]&&this.$changes.delete(o),this[R]=c)},enumerable:!0,configurable:!0}}}}function Y(c){return function(b,A){var o=b.constructor;o._definition.addFilter(A,c)&&(o._context.useFilters=!0)}}function D(c){return function(b,A){var o=b.constructor;o._definition.addChildrenFilter(A,c)&&(o._context.useFilters=!0)}}function f(c){return void 0===c&&(c=!0),function(b,A){var o=b.constructor._definition;o.deprecated[A]=!0,c&&(o.descriptors[A]={get:function(){throw new Error("".concat(A," is deprecated."))},set:function(c){},enumerable:!1,configurable:!0})}}function v(c,b,A){for(var o in void 0===A&&(A={}),A.context||(A.context=c._context||A.context||r),b)z(b[o],A)(c.prototype,o);return c}function G(c){for(var b=0,A=0,o=0,t=c.length;o<t;o++)(b=c.charCodeAt(o))<128?A+=1:b<2048?A+=2:b<55296||b>=57344?A+=3:(o++,A+=4);return A}function P(c,b,A){for(var o=0,t=0,n=A.length;t<n;t++)(o=A.charCodeAt(t))<128?c[b++]=o:o<2048?(c[b++]=192|o>>6,c[b++]=128|63&o):o<55296||o>=57344?(c[b++]=224|o>>12,c[b++]=128|o>>6&63,c[b++]=128|63&o):(t++,o=65536+((1023&o)<<10|1023&A.charCodeAt(t)),c[b++]=240|o>>18,c[b++]=128|o>>12&63,c[b++]=128|o>>6&63,c[b++]=128|63&o)}function O(c,b){c.push(255&b)}function p(c,b){c.push(255&b)}function q(c,b){c.push(255&b),c.push(b>>8&255)}function I(c,b){c.push(255&b),c.push(b>>8&255)}function K(c,b){c.push(255&b),c.push(b>>8&255),c.push(b>>16&255),c.push(b>>24&255)}function Z(c,b){var A=b>>24,o=b>>16,t=b>>8,n=b;c.push(255&n),c.push(255&t),c.push(255&o),c.push(255&A)}function H(c,b){var A=Math.floor(b/Math.pow(2,32));Z(c,b>>>0),Z(c,A)}function S(c,b){var A=b/Math.pow(2,32)|0;Z(c,b>>>0),Z(c,A)}function B(c,b){i(c,b)}function Q(c,b){g(c,b)}var a=new Int32Array(2),l=new Float32Array(a.buffer),T=new Float64Array(a.buffer);function i(c,b){l[0]=b,K(c,a[0])}function g(c,b){T[0]=b,K(c,a[0]),K(c,a[1])}function u(c,b){return p(c,b?1:0)}function e(c,b){b||(b="");var A=G(b),o=0;if(A<32)c.push(160|A),o=1;else if(A<256)c.push(217),p(c,A),o=2;else if(A<65536)c.push(218),I(c,A),o=3;else{if(!(A<4294967296))throw new Error("String too long");c.push(219),Z(c,A),o=5}return P(c,c.length,b),o+A}function x(c,b){return isNaN(b)?x(c,0):isFinite(b)?b!==(0|b)?(c.push(203),g(c,b),9):b>=0?b<128?(p(c,b),1):b<256?(c.push(204),p(c,b),2):b<65536?(c.push(205),I(c,b),3):b<4294967296?(c.push(206),Z(c,b),5):(c.push(207),S(c,b),9):b>=-32?(c.push(224|b+32),1):b>=-128?(c.push(208),O(c,b),2):b>=-32768?(c.push(209),q(c,b),3):b>=-2147483648?(c.push(210),K(c,b),5):(c.push(211),H(c,b),9):x(c,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var U=Object.freeze({__proto__:null,utf8Write:P,int8:O,uint8:p,int16:q,uint16:I,int32:K,uint32:Z,int64:H,uint64:S,float32:B,float64:Q,writeFloat32:i,writeFloat64:g,boolean:u,string:e,number:x});function w(c,b,A){for(var o="",t=0,n=b,h=b+A;n<h;n++){var s=c[n];0!==(128&s)?192!==(224&s)?224!==(240&s)?240!==(248&s)?console.error("Invalid byte "+s.toString(16)):(t=(7&s)<<18|(63&c[++n])<<12|(63&c[++n])<<6|63&c[++n])>=65536?(t-=65536,o+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):o+=String.fromCharCode(t):o+=String.fromCharCode((15&s)<<12|(63&c[++n])<<6|63&c[++n]):o+=String.fromCharCode((31&s)<<6|63&c[++n]):o+=String.fromCharCode(s)}return o}function m(c,b){return cc(c,b)<<24>>24}function cc(c,b){return c[b.offset++]}function bc(c,b){return Ac(c,b)<<16>>16}function Ac(c,b){return c[b.offset++]|c[b.offset++]<<8}function oc(c,b){return c[b.offset++]|c[b.offset++]<<8|c[b.offset++]<<16|c[b.offset++]<<24}function tc(c,b){return oc(c,b)>>>0}function nc(c,b){return Rc(c,b)}function hc(c,b){return Nc(c,b)}function sc(c,b){var A=tc(c,b);return oc(c,b)*Math.pow(2,32)+A}function Lc(c,b){var A=tc(c,b);return tc(c,b)*Math.pow(2,32)+A}var Cc=new Int32Array(2),Jc=new Float32Array(Cc.buffer),Xc=new Float64Array(Cc.buffer);function Rc(c,b){return Cc[0]=oc(c,b),Jc[0]}function Nc(c,b){return Cc[0]=oc(c,b),Cc[1]=oc(c,b),Xc[0]}function kc(c,b){return cc(c,b)>0}function Ec(c,b){var A,o=c[b.offset++];o<192?A=31&o:217===o?A=cc(c,b):218===o?A=Ac(c,b):219===o&&(A=tc(c,b));var t=w(c,b.offset,A);return b.offset+=A,t}function Vc(c,b){var A=c[b.offset];return A<192&&A>160||217===A||218===A||219===A}function yc(c,b){var A=c[b.offset++];return A<128?A:202===A?Rc(c,b):203===A?Nc(c,b):204===A?cc(c,b):205===A?Ac(c,b):206===A?tc(c,b):207===A?Lc(c,b):208===A?m(c,b):209===A?bc(c,b):210===A?oc(c,b):211===A?sc(c,b):A>223?-1*(255-A+1):void 0}function jc(c,b){var A=c[b.offset];return A<128||A>=202&&A<=211}function Fc(c,b){return c[b.offset]<160}function Mc(c,b){return c[b.offset-1]===h&&(c[b.offset]<128||c[b.offset]>=202&&c[b.offset]<=211)}var Wc=Object.freeze({__proto__:null,int8:m,uint8:cc,int16:bc,uint16:Ac,int32:oc,uint32:tc,float32:nc,float64:hc,int64:sc,uint64:Lc,readFloat32:Rc,readFloat64:Nc,boolean:kc,string:Ec,stringCheck:Vc,number:yc,numberCheck:jc,arrayCheck:Fc,switchStructureCheck:Mc}),dc=function(){function b(c){var b=this;this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,c&&c.forEach((function(c){return b.add(c)}))}return b.prototype.Zb=function(b,A){return void 0===A&&(A=!0),C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,b,A?this.$items:void 0)},b.prototype.lc=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,b)},b.is=function(c){return void 0!==c.collection},b.prototype.add=function(c){var b=this.$refId++;return void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,c),this.$changes.change(b),b},b.prototype.at=function(c){var b=Array.from(this.$items.keys())[c];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(c){for(var b,A,o=this.$items.entries();(A=o.next())&&!A.done;)if(c===A.value[1]){b=A.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&J.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(c){return Array.from(this.$items.values()).some((function(b){return b===c}))},b.prototype.forEach=function(c){var b=this;this.$items.forEach((function(A,o,t){return c(A,o,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(c,b){this.$indexes.set(c,b)},b.prototype.getIndex=function(c){return this.$indexes.get(c)},b.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},b.prototype.deleteByIndex=function(c){var b=this.$indexes.get(c);this.$items.delete(b),this.$indexes.delete(c)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var c=[];return this.forEach((function(b,A){c.push("function"===typeof b.toJSON?b.toJSON():b)})),c},b.prototype.clone=function(c){var A;return c?A=Object.assign(new b,this):(A=new b,this.forEach((function(c){c.$changes?A.add(c.clone()):A.add(c)}))),A},b}(),rc=function(){function b(c){var b=this;this.$changes=new L(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,c&&c.forEach((function(c){return b.add(c)}))}return b.prototype.Zb=function(b,A){return void 0===A&&(A=!0),C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,b,A?this.$items:void 0)},b.prototype.lc=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,b)},b.is=function(c){return void 0!==c.set},b.prototype.add=function(b){var A,o;if(this.has(b))return!1;var t=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,t);var n=null!==(o=null===(A=this.$changes.indexes[t])||void 0===A?void 0:A.op)&&void 0!==o?o:c.OPERATION.ADD;return this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,b),this.$changes.change(t,n),t},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(c){for(var b,A,o=this.$items.entries();(A=o.next())&&!A.done;)if(c===A.value[1]){b=A.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&J.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(c){for(var b,A=this.$items.values(),o=!1;(b=A.next())&&!b.done;)if(c===b.value){o=!0;break}return o},b.prototype.forEach=function(c){var b=this;this.$items.forEach((function(A,o,t){return c(A,o,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(c,b){this.$indexes.set(c,b)},b.prototype.getIndex=function(c){return this.$indexes.get(c)},b.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},b.prototype.deleteByIndex=function(c){var b=this.$indexes.get(c);this.$items.delete(b),this.$indexes.delete(c)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var c=[];return this.forEach((function(b,A){c.push("function"===typeof b.toJSON?b.toJSON():b)})),c},b.prototype.clone=function(c){var A;return c?A=Object.assign(new b,this):(A=new b,this.forEach((function(c){c.$changes?A.add(c.clone()):A.add(c)}))),A},b}(),zc=function(){function c(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return c.prototype.addRefId=function(c){this.refIds.has(c)||(this.refIds.add(c),this.containerIndexes.set(c,new Set))},c.get=function(b){return void 0===b.$filterState&&(b.$filterState=new c),b.$filterState},c}(),Yc=function(){function c(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return c.prototype.getNextUniqueId=function(){return this.nextUniqueId++},c.prototype.addRef=function(c,b,A){void 0===A&&(A=!0),this.refs.set(c,b),A&&(this.refCounts[c]=(this.refCounts[c]||0)+1)},c.prototype.removeRef=function(c){this.refCounts[c]=this.refCounts[c]-1,this.deletedRefs.add(c)},c.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},c.prototype.garbageCollectDeletedRefs=function(){var c=this;this.deletedRefs.forEach((function(b){if(!(c.refCounts[b]>0)){var A=c.refs.get(b);if(A instanceof Oc)for(var o in A._definition.schema)"string"!==typeof A._definition.schema[o]&&A[o]&&A[o].$changes&&c.removeRef(A[o].$changes.refId);else{var t=A.$changes.parent._definition,n=t.schema[t.fieldsByIndex[A.$changes.parentIndex]];"function"===typeof Object.values(n)[0]&&Array.from(A.values()).forEach((function(b){return c.removeRef(b.$changes.refId)}))}c.refs.delete(b),delete c.refCounts[b]}})),this.deletedRefs.clear()},c}(),Dc=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}return A(b,c),b}(Error);function fc(c,b,A,o){var t,n=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":t="number",isNaN(c)&&console.log('trying to encode "NaN" in '.concat(A.constructor.name,"#").concat(o));break;case"string":t="string",n=!0;break;case"boolean":return}if(typeof c!==t&&(!n||n&&null!==c)){var h="'".concat(JSON.stringify(c),"'").concat(c&&c.constructor&&" (".concat(c.constructor.name,")")||"");throw new Dc("a '".concat(t,"' was expected, but ").concat(h," was provided in ").concat(A.constructor.name,"#").concat(o))}}function vc(c,b,A,o){if(!(c instanceof b))throw new Dc("a '".concat(b.name,"' was expected, but '").concat(c.constructor.name,"' was provided in ").concat(A.constructor.name,"#").concat(o))}function Gc(c,b,A,o,t){fc(A,c,o,t);var n=U[c];if(!n)throw new Dc("a '".concat(c,"' was expected, but ").concat(A," was provided in ").concat(o.constructor.name,"#").concat(t));n(b,A)}function Pc(c,b,A){return Wc[c](b,A)}var Oc=function(){function b(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new L(this,void 0,new Yc),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var A=this._definition.descriptors;A&&Object.defineProperties(this,A),c[0]&&this.assign(c[0])}return b.onError=function(c){console.error(c)},b.is=function(c){return c._definition&&void 0!==c._definition.schema},b.prototype.onChange=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,b)},b.prototype.lc=function(b){return C(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,b)},b.prototype.assign=function(c){return Object.assign(this,c),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(c,b){this.$changes.change(c,b)},b.prototype.listen=function(c,b,A){var o=this;return void 0===A&&(A=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[c]||(this.$callbacks[c]=[]),this.$callbacks[c].push(b),A&&void 0!==this[c]&&b(this[c],void 0),function(){return X(o.$callbacks[c],o.$callbacks[c].indexOf(b))}},b.prototype.decode=function(A,o,t){var n;void 0===o&&(o={offset:0}),void 0===t&&(t=this);var s=[],L=this.$changes.root,C=A.length,J=0;for(L.refs.set(J,this);o.offset<C;){var X=A[o.offset++];if(X!=h){var R=t.$changes,N=void 0!==t._definition,E=N?X>>6<<6:X;if(E!==c.OPERATION.CLEAR){var y=N?X%(E||255):yc(A,o),j=N?t._definition.fieldsByIndex[y]:"",M=R.getType(y),W=void 0,d=void 0,r=void 0;if(N?d=t["_".concat(j)]:(d=t.getByIndex(y),(E&c.OPERATION.ADD)===c.OPERATION.ADD?(r=t instanceof V?Ec(A,o):y,t.setIndex(y,r)):r=t.getIndex(y)),(E&c.OPERATION.DELETE)===c.OPERATION.DELETE&&(E!==c.OPERATION.DELETE_AND_ADD&&t.deleteByIndex(y),d&&d.$changes&&L.removeRef(d.$changes.refId),W=null),void 0!==j){if(E===c.OPERATION.DELETE);else if(b.is(M)){var z=yc(A,o);if(W=L.refs.get(z),E!==c.OPERATION.REPLACE){var Y=this.getSchemaType(A,o,M);W||((W=this.createTypeInstance(Y)).$changes.refId=z,d&&(W.$callbacks=d.$callbacks,d.$changes.refId&&z!==d.$changes.refId&&L.removeRef(d.$changes.refId))),L.addRef(z,W,W!==d)}}else if("string"===typeof M)W=Pc(M,A,o);else{var D=F(Object.keys(M)[0]),f=yc(A,o),v=L.refs.has(f)?d||L.refs.get(f):new D.constructor;if((W=v.clone(!0)).$changes.refId=f,d&&(W.$callbacks=d.$callbacks,d.$changes.refId&&f!==d.$changes.refId)){L.removeRef(d.$changes.refId);for(var G=d.entries(),P=void 0;(P=G.next())&&!P.done;){var O=(n=P.value)[0],p=n[1];s.push({refId:f,op:c.OPERATION.DELETE,field:O,value:void 0,previousValue:p})}}L.addRef(f,W,v!==d)}if(null!==W&&void 0!==W)if(W.$changes&&W.$changes.setParent(R.ref,R.root,y),t instanceof b)t[j]=W;else if(t instanceof V)O=r,t.$items.set(O,W),t.$changes.allChanges.add(y);else if(t instanceof k)t.setAt(y,W);else if(t instanceof dc){var q=t.add(W);t.setIndex(y,q)}else t instanceof rc&&!1!==(q=t.add(W))&&t.setIndex(y,q);d!==W&&s.push({refId:J,op:E,field:j,dynamicIndex:r,value:W,previousValue:d})}else{console.warn("@colyseus/schema: definition mismatch");for(var I={offset:o.offset};o.offset<C&&(!Mc(A,o)||(I.offset=o.offset+1,!L.refs.has(yc(A,I))));)o.offset++}}else t.clear(s)}else{J=yc(A,o);var K=L.refs.get(J);if(!K)throw new Error('"refId" not found: '.concat(J));t=K}}return this._triggerChanges(s),L.garbageCollectDeletedRefs(),s},b.prototype.encode=function(A,o,t){void 0===A&&(A=!1),void 0===o&&(o=[]),void 0===t&&(t=!1);for(var n=this.$changes,s=new WeakSet,L=[n],C=1,J=0;J<C;J++){var X=L[J],R=X.ref,N=R instanceof b;X.ensureRefId(),s.add(X),X!==n&&(X.changed||A)&&(p(o,h),x(o,X.refId));for(var k=A?Array.from(X.allChanges):Array.from(X.changes.values()),E=0,y=k.length;E<y;E++){var j=A?{op:c.OPERATION.ADD,index:k[E]}:k[E],M=j.index,W=N?R._definition.fieldsByIndex&&R._definition.fieldsByIndex[M]:M,d=o.length;if(j.op!==c.OPERATION.TOUCH)if(N)p(o,M|j.op);else{if(p(o,j.op),j.op===c.OPERATION.CLEAR)continue;x(o,M)}if(N||(j.op&c.OPERATION.ADD)!=c.OPERATION.ADD||R instanceof V&&e(o,X.ref.$indexes.get(M)),j.op!==c.OPERATION.DELETE){var r=X.getType(M),z=X.getValue(M);if(z&&z.$changes&&!s.has(z.$changes)&&(L.push(z.$changes),z.$changes.ensureRefId(),C++),j.op!==c.OPERATION.TOUCH){if(b.is(r))vc(z,r,R,W),x(o,z.$changes.refId),(j.op&c.OPERATION.ADD)===c.OPERATION.ADD&&this.tryEncodeTypeId(o,r,z.constructor);else if("string"===typeof r)Gc(r,o,z,R,W);else{var Y=F(Object.keys(r)[0]);vc(R["_".concat(W)],Y.constructor,R,W),x(o,z.$changes.refId)}t&&X.cache(M,o.slice(d))}}}A||t||X.discard()}return o},b.prototype.encodeAll=function(c){return this.encode(!0,[],c)},b.prototype.applyFilters=function(A,o){var t,n;void 0===o&&(o=!1);for(var s=this,L=new Set,C=zc.get(A),J=[this.$changes],X=1,R=[],N=function(N){var k=J[N];if(L.has(k.refId))return"continue";var E=k.ref,y=E instanceof b;p(R,h),x(R,k.refId);var j=C.refIds.has(k),F=o||!j;C.addRefId(k);var M=C.containerIndexes.get(k),W=F?Array.from(k.allChanges):Array.from(k.changes.values());!o&&y&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach((function(b){!M.has(b)&&k.allChanges.has(b)&&(F?W.push(b):W.push({op:c.OPERATION.ADD,index:b}))}));for(var d=0,r=W.length;d<r;d++){var z=F?{op:c.OPERATION.ADD,index:W[d]}:W[d];if(z.op!==c.OPERATION.CLEAR){var Y=z.index;if(z.op!==c.OPERATION.DELETE){var D=k.getValue(Y),f=k.getType(Y);if(y){if((v=E._definition.filters&&E._definition.filters[Y])&&!v.call(E,A,D,s)){D&&D.$changes&&L.add(D.$changes.refId);continue}}else{var v,G=k.parent;if((v=k.getChildrenFilter())&&!v.call(G,A,E.$indexes.get(Y),D,s)){D&&D.$changes&&L.add(D.$changes.refId);continue}}if(D.$changes&&(J.push(D.$changes),X++),z.op!==c.OPERATION.TOUCH)if(z.op===c.OPERATION.ADD||y)R.push.apply(R,null!==(t=k.caches[Y])&&void 0!==t?t:[]),M.add(Y);else if(M.has(Y))R.push.apply(R,null!==(n=k.caches[Y])&&void 0!==n?n:[]);else{if(M.add(Y),p(R,c.OPERATION.ADD),x(R,Y),E instanceof V){var P=k.ref.$indexes.get(Y);e(R,P)}D.$changes?x(R,D.$changes.refId):U[f](R,D)}else D.$changes&&!y&&(p(R,c.OPERATION.ADD),x(R,Y),E instanceof V&&(P=k.ref.$indexes.get(Y),e(R,P)),x(R,D.$changes.refId))}else y?p(R,z.op|Y):(p(R,z.op),x(R,Y))}else p(R,z.op)}},k=0;k<X;k++)N(k);return R},b.prototype.clone=function(){var c,b=new this.constructor,A=this._definition.schema;for(var o in A)"object"===typeof this[o]&&"function"===typeof(null===(c=this[o])||void 0===c?void 0:c.clone)?b[o]=this[o].clone():b[o]=this[o];return b},b.prototype.toJSON=function(){var c=this._definition.schema,b=this._definition.deprecated,A={};for(var o in c)b[o]||null===this[o]||"undefined"===typeof this[o]||(A[o]="function"===typeof this[o].toJSON?this[o].toJSON():this["_".concat(o)]);return A},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(c){return this[this._definition.fieldsByIndex[c]]},b.prototype.deleteByIndex=function(c){this[this._definition.fieldsByIndex[c]]=void 0},b.prototype.tryEncodeTypeId=function(c,b,A){b._typeid!==A._typeid&&(p(c,s),x(c,A._typeid))},b.prototype.getSchemaType=function(c,b,A){var o;return c[b.offset]===s&&(b.offset++,o=this.constructor._context.get(yc(c,b))),o||A},b.prototype.createTypeInstance=function(c){var b=new c;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(A){for(var o,t,n,h,s,L,C,J,X,R=new Set,N=this.$changes.root.refs,k=function(k){var E=A[k],V=E.refId,y=N.get(V),j=y.$callbacks;if((E.op&c.OPERATION.DELETE)===c.OPERATION.DELETE&&E.previousValue instanceof b&&(null===(t=null===(o=E.previousValue.$callbacks)||void 0===o?void 0:o[c.OPERATION.DELETE])||void 0===t||t.forEach((function(c){return c()}))),!j)return"continue";if(y instanceof b){if(!R.has(V))try{null===(n=null===j||void 0===j?void 0:j[c.OPERATION.REPLACE])||void 0===n||n.forEach((function(c){return c()}))}catch(F){b.onError(F)}try{j.hasOwnProperty(E.field)&&(null===(h=j[E.field])||void 0===h||h.forEach((function(c){return c(E.value,E.previousValue)})))}catch(F){b.onError(F)}}else E.op===c.OPERATION.ADD&&void 0===E.previousValue?null===(s=j[c.OPERATION.ADD])||void 0===s||s.forEach((function(c){var b;return c(E.value,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)})):E.op===c.OPERATION.DELETE?void 0!==E.previousValue&&(null===(L=j[c.OPERATION.DELETE])||void 0===L||L.forEach((function(c){var b;return c(E.previousValue,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)}))):E.op===c.OPERATION.DELETE_AND_ADD&&(void 0!==E.previousValue&&(null===(C=j[c.OPERATION.DELETE])||void 0===C||C.forEach((function(c){var b;return c(E.previousValue,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)}))),null===(J=j[c.OPERATION.ADD])||void 0===J||J.forEach((function(c){var b;return c(E.value,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)}))),E.value!==E.previousValue&&(null===(X=j[c.OPERATION.REPLACE])||void 0===X||X.forEach((function(c){var b;return c(E.value,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)})));R.add(V)},E=0;E<A.length;E++)k(E)},b._definition=M.create(),b}();function pc(c){for(var b=[c.$changes],A=1,o={},t=o,n=function(c){var A=b[c];A.changes.forEach((function(c){var b=A.ref,o=c.index,n=b._definition?b._definition.fieldsByIndex[o]:b.$indexes.get(o);t[n]=A.getValue(o)}))},h=0;h<A;h++)n(h);return o}var qc={context:new d},Ic=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}return A(b,c),o([z("string",qc)],b.prototype,"name",void 0),o([z("string",qc)],b.prototype,"type",void 0),o([z("number",qc)],b.prototype,"referencedType",void 0),b}(Oc),Kc=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;return b.fields=new k,b}return A(b,c),o([z("number",qc)],b.prototype,"id",void 0),o([z([Ic],qc)],b.prototype,"fields",void 0),b}(Oc),Zc=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;return b.types=new k,b}return A(b,c),b.encode=function(c){var A=c.constructor,o=new b;o.rootType=A._typeid;var t=function(c,b){for(var A in b){var t=new Ic;t.name=A;var n=void 0;if("string"===typeof b[A])n=b[A];else{var h=b[A],s=void 0;Oc.is(h)?(n="ref",s=b[A]):"string"===typeof h[n=Object.keys(h)[0]]?n+=":"+h[n]:s=h[n],t.referencedType=s?s._typeid:-1}t.type=n,c.fields.push(t)}o.types.push(c)},n=A._context.types;for(var h in n){var s=new Kc;s.id=Number(h),t(s,n[h]._definition.schema)}return o.encodeAll()},b.decode=function(c,o){var t=new d,n=new b;n.decode(c,o);var h=n.types.reduce((function(c,b){var o=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}return A(b,c),b}(Oc),n=b.id;return c[n]=o,t.add(o,n),c}),{});n.types.forEach((function(c){var b=h[c.id];c.fields.forEach((function(c){var A;if(void 0!==c.referencedType){var o=c.type,n=h[c.referencedType];if(!n){var s=c.type.split(":");o=s[0],n=s[1]}"ref"===o?z(n,{context:t})(b.prototype,c.name):z(((A={})[o]=n,A),{context:t})(b.prototype,c.name)}else z(c.type,{context:t})(b.prototype,c.name)}))}));var s=h[n.rootType],L=new s;for(var C in s._definition.schema){var J=s._definition.schema[C];"string"!==typeof J&&(L[C]="function"===typeof J?new J:new(F(Object.keys(J)[0]).constructor))}return L},o([z([Kc],qc)],b.prototype,"types",void 0),o([z("number",qc)],b.prototype,"rootType",void 0),b}(Oc);j("map",{constructor:V}),j("array",{constructor:k}),j("set",{constructor:rc}),j("collection",{constructor:dc}),c.ArraySchema=k,c.CollectionSchema=dc,c.Context=d,c.MapSchema=V,c.Reflection=Zc,c.ReflectionField=Ic,c.ReflectionType=Kc,c.Schema=Oc,c.SchemaDefinition=M,c.SetSchema=rc,c.decode=Wc,c.defineTypes=v,c.deprecated=f,c.dumpChanges=pc,c.encode=U,c.filter=Y,c.filterChildren=D,c.hasFilter=W,c.registerType=j,c.type=z,Object.defineProperty(c,"__esModule",{value:!0})}(b)},12992:c=>{"use strict";c.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12990:(c,b,A)=>{var o=A(12992),t=A(12995),n=Object.hasOwnProperty,h=Object.create(null);for(var s in o)n.call(o,s)&&(h[o[s]]=s);var L=c.exports={to:{},get:{}};function C(c,b,A){return Math.min(Math.max(b,c),A)}function J(c){var b=Math.round(c).toString(16).toUpperCase();return b.length<2?"0"+b:b}L.get=function(c){var b,A;switch(c.substring(0,3).toLowerCase()){case"hsl":b=L.get.hsl(c),A="hsl";break;case"hwb":b=L.get.hwb(c),A="hwb";break;default:b=L.get.rgb(c),A="rgb"}return b?{model:A,value:b}:null},L.get.rgb=function(c){if(!c)return null;var b,A,t,h=[0,0,0,1];if(b=c.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(t=b[2],b=b[1],A=0;A<3;A++){var s=2*A;h[A]=parseInt(b.slice(s,s+2),16)}t&&(h[3]=parseInt(t,16)/255)}else if(b=c.match(/^#([a-f0-9]{3,4})$/i)){for(t=(b=b[1])[3],A=0;A<3;A++)h[A]=parseInt(b[A]+b[A],16);t&&(h[3]=parseInt(t+t,16)/255)}else if(b=c.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(A=0;A<3;A++)h[A]=parseInt(b[A+1],0);b[4]&&(b[5]?h[3]=.01*parseFloat(b[4]):h[3]=parseFloat(b[4]))}else{if(!(b=c.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=c.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:n.call(o,b[1])?((h=o[b[1]])[3]=1,h):null:null;for(A=0;A<3;A++)h[A]=Math.round(2.55*parseFloat(b[A+1]));b[4]&&(b[5]?h[3]=.01*parseFloat(b[4]):h[3]=parseFloat(b[4]))}for(A=0;A<3;A++)h[A]=C(h[A],0,255);return h[3]=C(h[3],0,1),h},L.get.hsl=function(c){if(!c)return null;var b=c.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var A=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,C(parseFloat(b[2]),0,100),C(parseFloat(b[3]),0,100),C(isNaN(A)?1:A,0,1)]}return null},L.get.hwb=function(c){if(!c)return null;var b=c.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var A=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,C(parseFloat(b[2]),0,100),C(parseFloat(b[3]),0,100),C(isNaN(A)?1:A,0,1)]}return null},L.to.hex=function(){var c=t(arguments);return"#"+J(c[0])+J(c[1])+J(c[2])+(c[3]<1?J(Math.round(255*c[3])):"")},L.to.rgb=function(){var c=t(arguments);return c.length<4||1===c[3]?"rgb("+Math.round(c[0])+", "+Math.round(c[1])+", "+Math.round(c[2])+")":"rgba("+Math.round(c[0])+", "+Math.round(c[1])+", "+Math.round(c[2])+", "+c[3]+")"},L.to.rgb.percent=function(){var c=t(arguments),b=Math.round(c[0]/255*100),A=Math.round(c[1]/255*100),o=Math.round(c[2]/255*100);return c.length<4||1===c[3]?"rgb("+b+"%, "+A+"%, "+o+"%)":"rgba("+b+"%, "+A+"%, "+o+"%, "+c[3]+")"},L.to.hsl=function(){var c=t(arguments);return c.length<4||1===c[3]?"hsl("+c[0]+", "+c[1]+"%, "+c[2]+"%)":"hsla("+c[0]+", "+c[1]+"%, "+c[2]+"%, "+c[3]+")"},L.to.hwb=function(){var c=t(arguments),b="";return c.length>=4&&1!==c[3]&&(b=", "+c[3]),"hwb("+c[0]+", "+c[1]+"%, "+c[2]+"%"+b+")"},L.to.keyword=function(c){return h[c.slice(0,3)]}},12986:(c,b,A)=>{const o=A(12990),t=A(13005),n=["keyword","gray","hex"],h={};for(const N of Object.keys(t))h[[...t[N].labels].sort().join("")]=N;const s={};function L(c,b){if(!(this instanceof L))return new L(c,b);if(b&&b in n&&(b=null),b&&!(b in t))throw new Error("Unknown model: "+b);let A,C;if(null==c)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(c instanceof L)this.model=c.model,this.color=[...c.color],this.valpha=c.valpha;else if("string"===typeof c){const b=o.get(c);if(null===b)throw new Error("Unable to parse color from string: "+c);this.model=b.model,C=t[this.model].channels,this.color=b.value.slice(0,C),this.valpha="number"===typeof b.value[C]?b.value[C]:1}else if(c.length>0){this.model=b||"rgb",C=t[this.model].channels;const A=Array.prototype.slice.call(c,0,C);this.color=R(A,C),this.valpha="number"===typeof c[C]?c[C]:1}else if("number"===typeof c)this.model="rgb",this.color=[c>>16&255,c>>8&255,255&c],this.valpha=1;else{this.valpha=1;const b=Object.keys(c);"alpha"in c&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof c.alpha?c.alpha:0);const o=b.sort().join("");if(!(o in h))throw new Error("Unable to parse color from object: "+JSON.stringify(c));this.model=h[o];const{labels:n}=t[this.model],s=[];for(A=0;A<n.length;A++)s.push(c[n[A]]);this.color=R(s)}if(s[this.model])for(C=t[this.model].channels,A=0;A<C;A++){const c=s[this.model][A];c&&(this.color[A]=c(this.color[A]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}L.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(c){let b=this.model in o.to?this:this.rgb();b=b.round("number"===typeof c?c:1);const A=1===b.valpha?b.color:[...b.color,this.valpha];return o.to[b.model](A)},percentString(c){const b=this.rgb().round("number"===typeof c?c:1),A=1===b.valpha?b.color:[...b.color,this.valpha];return o.to.rgb.percent(A)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const c={},{channels:b}=t[this.model],{labels:A}=t[this.model];for(let o=0;o<b;o++)c[A[o]]=this.color[o];return 1!==this.valpha&&(c.alpha=this.valpha),c},unitArray(){const c=this.rgb().color;return c[0]/=255,c[1]/=255,c[2]/=255,1!==this.valpha&&c.push(this.valpha),c},unitObject(){const c=this.rgb().object();return c.r/=255,c.g/=255,c.b/=255,1!==this.valpha&&(c.alpha=this.valpha),c},round(c){return c=Math.max(c||0,0),new L([...this.color.map(C(c)),this.valpha],this.model)},alpha(c){return void 0!==c?new L([...this.color,Math.max(0,Math.min(1,c))],this.model):this.valpha},red:J("rgb",0,X(255)),green:J("rgb",1,X(255)),blue:J("rgb",2,X(255)),hue:J(["hsl","hsv","hsl","hwb","hcg"],0,(c=>(c%360+360)%360)),saturationl:J("hsl",1,X(100)),lightness:J("hsl",2,X(100)),saturationv:J("hsv",1,X(100)),value:J("hsv",2,X(100)),chroma:J("hcg",1,X(100)),gray:J("hcg",2,X(100)),white:J("hwb",1,X(100)),wblack:J("hwb",2,X(100)),cyan:J("cmyk",0,X(100)),magenta:J("cmyk",1,X(100)),yellow:J("cmyk",2,X(100)),black:J("cmyk",3,X(100)),x:J("xyz",0,X(95.047)),y:J("xyz",1,X(100)),z:J("xyz",2,X(108.833)),l:J("lab",0,X(100)),a:J("lab",1),b:J("lab",2),keyword(c){return void 0!==c?new L(c):t[this.model].keyword(this.color)},hex(c){return void 0!==c?new L(c):o.to.hex(this.rgb().round().color)},hexa(c){if(void 0!==c)return new L(c);const b=this.rgb().round().color;let A=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===A.length&&(A="0"+A),o.to.hex(b)+A},rgbNumber(){const c=this.rgb().color;return(255&c[0])<<16|(255&c[1])<<8|255&c[2]},luminosity(){const c=this.rgb().color,b=[];for(const[A,o]of c.entries()){const c=o/255;b[A]=c<=.04045?c/12.92:((c+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(c){const b=this.luminosity(),A=c.luminosity();return b>A?(b+.05)/(A+.05):(A+.05)/(b+.05)},level(c){const b=this.contrast(c);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const c=this.rgb().color;return(2126*c[0]+7152*c[1]+722*c[2])/1e4<128},isLight(){return!this.isDark()},negate(){const c=this.rgb();for(let b=0;b<3;b++)c.color[b]=255-c.color[b];return c},lighten(c){const b=this.hsl();return b.color[2]+=b.color[2]*c,b},darken(c){const b=this.hsl();return b.color[2]-=b.color[2]*c,b},saturate(c){const b=this.hsl();return b.color[1]+=b.color[1]*c,b},desaturate(c){const b=this.hsl();return b.color[1]-=b.color[1]*c,b},whiten(c){const b=this.hwb();return b.color[1]+=b.color[1]*c,b},blacken(c){const b=this.hwb();return b.color[2]+=b.color[2]*c,b},grayscale(){const c=this.rgb().color,b=.3*c[0]+.59*c[1]+.11*c[2];return L.rgb(b,b,b)},fade(c){return this.alpha(this.valpha-this.valpha*c)},opaquer(c){return this.alpha(this.valpha+this.valpha*c)},rotate(c){const b=this.hsl();let A=b.color[0];return A=(A+c)%360,A=A<0?360+A:A,b.color[0]=A,b},mix(c,b){if(!c||!c.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof c);const A=c.rgb(),o=this.rgb(),t=void 0===b?.5:b,n=2*t-1,h=A.alpha()-o.alpha(),s=((n*h===-1?n:(n+h)/(1+n*h))+1)/2,C=1-s;return L.rgb(s*A.red()+C*o.red(),s*A.green()+C*o.green(),s*A.blue()+C*o.blue(),A.alpha()*t+o.alpha()*(1-t))}};for(const N of Object.keys(t)){if(n.includes(N))continue;const{channels:c}=t[N];L.prototype[N]=function(){if(this.model===N)return new L(this);for(var c=arguments.length,b=new Array(c),A=0;A<c;A++)b[A]=arguments[A];return b.length>0?new L(b,N):new L([...(o=t[this.model][N].raw(this.color),Array.isArray(o)?o:[o]),this.valpha],N);var o},L[N]=function(){for(var b=arguments.length,A=new Array(b),o=0;o<b;o++)A[o]=arguments[o];let t=A[0];return"number"===typeof t&&(t=R(A,c)),new L(t,N)}}function C(c){return function(b){return function(c,b){return Number(c.toFixed(b))}(b,c)}}function J(c,b,A){c=Array.isArray(c)?c:[c];for(const o of c)(s[o]||(s[o]=[]))[b]=A;return c=c[0],function(o){let t;return void 0!==o?(A&&(o=A(o)),t=this[c](),t.color[b]=o,t):(t=this[c]().color[b],A&&(t=A(t)),t)}}function X(c){return function(b){return Math.max(0,Math.min(c,b))}}function R(c,b){for(let A=0;A<b;A++)"number"!==typeof c[A]&&(c[A]=0);return c}c.exports=L},13014:(c,b,A)=>{const o=A(13018),t={};for(const h of Object.keys(o))t[o[h]]=h;const n={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};c.exports=n;for(const h of Object.keys(n)){if(!("channels"in n[h]))throw new Error("missing channels property: "+h);if(!("labels"in n[h]))throw new Error("missing channel labels property: "+h);if(n[h].labels.length!==n[h].channels)throw new Error("channel and label counts mismatch: "+h);const{channels:c,labels:b}=n[h];delete n[h].channels,delete n[h].labels,Object.defineProperty(n[h],"channels",{value:c}),Object.defineProperty(n[h],"labels",{value:b})}n.rgb.hsl=function(c){const b=c[0]/255,A=c[1]/255,o=c[2]/255,t=Math.min(b,A,o),n=Math.max(b,A,o),h=n-t;let s,L;n===t?s=0:b===n?s=(A-o)/h:A===n?s=2+(o-b)/h:o===n&&(s=4+(b-A)/h),s=Math.min(60*s,360),s<0&&(s+=360);const C=(t+n)/2;return L=n===t?0:C<=.5?h/(n+t):h/(2-n-t),[s,100*L,100*C]},n.rgb.hsv=function(c){let b,A,o,t,n;const h=c[0]/255,s=c[1]/255,L=c[2]/255,C=Math.max(h,s,L),J=C-Math.min(h,s,L),X=function(c){return(C-c)/6/J+.5};return 0===J?(t=0,n=0):(n=J/C,b=X(h),A=X(s),o=X(L),h===C?t=o-A:s===C?t=1/3+b-o:L===C&&(t=2/3+A-b),t<0?t+=1:t>1&&(t-=1)),[360*t,100*n,100*C]},n.rgb.hwb=function(c){const b=c[0],A=c[1];let o=c[2];const t=n.rgb.hsl(c)[0],h=1/255*Math.min(b,Math.min(A,o));return o=1-1/255*Math.max(b,Math.max(A,o)),[t,100*h,100*o]},n.rgb.cmyk=function(c){const b=c[0]/255,A=c[1]/255,o=c[2]/255,t=Math.min(1-b,1-A,1-o);return[100*((1-b-t)/(1-t)||0),100*((1-A-t)/(1-t)||0),100*((1-o-t)/(1-t)||0),100*t]},n.rgb.keyword=function(c){const b=t[c];if(b)return b;let A,n=1/0;for(const t of Object.keys(o)){const b=o[t],L=(s=b,((h=c)[0]-s[0])**2+(h[1]-s[1])**2+(h[2]-s[2])**2);L<n&&(n=L,A=t)}var h,s;return A},n.keyword.rgb=function(c){return o[c]},n.rgb.xyz=function(c){let b=c[0]/255,A=c[1]/255,o=c[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92;return[100*(.4124*b+.3576*A+.1805*o),100*(.2126*b+.7152*A+.0722*o),100*(.0193*b+.1192*A+.9505*o)]},n.rgb.lab=function(c){const b=n.rgb.xyz(c);let A=b[0],o=b[1],t=b[2];A/=95.047,o/=100,t/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*o-16,500*(A-o),200*(o-t)]},n.hsl.rgb=function(c){const b=c[0]/360,A=c[1]/100,o=c[2]/100;let t,n,h;if(0===A)return h=255*o,[h,h,h];t=o<.5?o*(1+A):o+A-o*A;const s=2*o-t,L=[0,0,0];for(let C=0;C<3;C++)n=b+1/3*-(C-1),n<0&&n++,n>1&&n--,h=6*n<1?s+6*(t-s)*n:2*n<1?t:3*n<2?s+(t-s)*(2/3-n)*6:s,L[C]=255*h;return L},n.hsl.hsv=function(c){const b=c[0];let A=c[1]/100,o=c[2]/100,t=A;const n=Math.max(o,.01);o*=2,A*=o<=1?o:2-o,t*=n<=1?n:2-n;return[b,100*(0===o?2*t/(n+t):2*A/(o+A)),100*((o+A)/2)]},n.hsv.rgb=function(c){const b=c[0]/60,A=c[1]/100;let o=c[2]/100;const t=Math.floor(b)%6,n=b-Math.floor(b),h=255*o*(1-A),s=255*o*(1-A*n),L=255*o*(1-A*(1-n));switch(o*=255,t){case 0:return[o,L,h];case 1:return[s,o,h];case 2:return[h,o,L];case 3:return[h,s,o];case 4:return[L,h,o];case 5:return[o,h,s]}},n.hsv.hsl=function(c){const b=c[0],A=c[1]/100,o=c[2]/100,t=Math.max(o,.01);let n,h;h=(2-A)*o;const s=(2-A)*t;return n=A*t,n/=s<=1?s:2-s,n=n||0,h/=2,[b,100*n,100*h]},n.hwb.rgb=function(c){const b=c[0]/360;let A=c[1]/100,o=c[2]/100;const t=A+o;let n;t>1&&(A/=t,o/=t);const h=Math.floor(6*b),s=1-o;n=6*b-h,0!==(1&h)&&(n=1-n);const L=A+n*(s-A);let C,J,X;switch(h){default:case 6:case 0:C=s,J=L,X=A;break;case 1:C=L,J=s,X=A;break;case 2:C=A,J=s,X=L;break;case 3:C=A,J=L,X=s;break;case 4:C=L,J=A,X=s;break;case 5:C=s,J=A,X=L}return[255*C,255*J,255*X]},n.cmyk.rgb=function(c){const b=c[0]/100,A=c[1]/100,o=c[2]/100,t=c[3]/100;return[255*(1-Math.min(1,b*(1-t)+t)),255*(1-Math.min(1,A*(1-t)+t)),255*(1-Math.min(1,o*(1-t)+t))]},n.xyz.rgb=function(c){const b=c[0]/100,A=c[1]/100,o=c[2]/100;let t,n,h;return t=3.2406*b+-1.5372*A+-.4986*o,n=-.9689*b+1.8758*A+.0415*o,h=.0557*b+-.204*A+1.057*o,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,t=Math.min(Math.max(0,t),1),n=Math.min(Math.max(0,n),1),h=Math.min(Math.max(0,h),1),[255*t,255*n,255*h]},n.xyz.lab=function(c){let b=c[0],A=c[1],o=c[2];b/=95.047,A/=100,o/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*A-16,500*(b-A),200*(A-o)]},n.lab.xyz=function(c){let b,A,o;A=(c[0]+16)/116,b=c[1]/500+A,o=A-c[2]/200;const t=A**3,n=b**3,h=o**3;return A=t>.008856?t:(A-16/116)/7.787,b=n>.008856?n:(b-16/116)/7.787,o=h>.008856?h:(o-16/116)/7.787,b*=95.047,A*=100,o*=108.883,[b,A,o]},n.lab.lch=function(c){const b=c[0],A=c[1],o=c[2];let t;t=360*Math.atan2(o,A)/2/Math.PI,t<0&&(t+=360);return[b,Math.sqrt(A*A+o*o),t]},n.lch.lab=function(c){const b=c[0],A=c[1],o=c[2]/360*2*Math.PI;return[b,A*Math.cos(o),A*Math.sin(o)]},n.rgb.ansi16=function(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[A,o,t]=c;let h=null===b?n.rgb.hsv(c)[2]:b;if(h=Math.round(h/50),0===h)return 30;let s=30+(Math.round(t/255)<<2|Math.round(o/255)<<1|Math.round(A/255));return 2===h&&(s+=60),s},n.hsv.ansi16=function(c){return n.rgb.ansi16(n.hsv.rgb(c),c[2])},n.rgb.ansi256=function(c){const b=c[0],A=c[1],o=c[2];if(b===A&&A===o)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(A/255*5)+Math.round(o/255*5)},n.ansi16.rgb=function(c){let b=c%10;if(0===b||7===b)return c>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const A=.5*(1+~~(c>50));return[(1&b)*A*255,(b>>1&1)*A*255,(b>>2&1)*A*255]},n.ansi256.rgb=function(c){if(c>=232){const b=10*(c-232)+8;return[b,b,b]}let b;c-=16;return[Math.floor(c/36)/5*255,Math.floor((b=c%36)/6)/5*255,b%6/5*255]},n.rgb.hex=function(c){const b=(((255&Math.round(c[0]))<<16)+((255&Math.round(c[1]))<<8)+(255&Math.round(c[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},n.hex.rgb=function(c){const b=c.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let A=b[0];3===b[0].length&&(A=A.split("").map((c=>c+c)).join(""));const o=parseInt(A,16);return[o>>16&255,o>>8&255,255&o]},n.rgb.hcg=function(c){const b=c[0]/255,A=c[1]/255,o=c[2]/255,t=Math.max(Math.max(b,A),o),n=Math.min(Math.min(b,A),o),h=t-n;let s,L;return s=h<1?n/(1-h):0,L=h<=0?0:t===b?(A-o)/h%6:t===A?2+(o-b)/h:4+(b-A)/h,L/=6,L%=1,[360*L,100*h,100*s]},n.hsl.hcg=function(c){const b=c[1]/100,A=c[2]/100,o=A<.5?2*b*A:2*b*(1-A);let t=0;return o<1&&(t=(A-.5*o)/(1-o)),[c[0],100*o,100*t]},n.hsv.hcg=function(c){const b=c[1]/100,A=c[2]/100,o=b*A;let t=0;return o<1&&(t=(A-o)/(1-o)),[c[0],100*o,100*t]},n.hcg.rgb=function(c){const b=c[0]/360,A=c[1]/100,o=c[2]/100;if(0===A)return[255*o,255*o,255*o];const t=[0,0,0],n=b%1*6,h=n%1,s=1-h;let L=0;switch(Math.floor(n)){case 0:t[0]=1,t[1]=h,t[2]=0;break;case 1:t[0]=s,t[1]=1,t[2]=0;break;case 2:t[0]=0,t[1]=1,t[2]=h;break;case 3:t[0]=0,t[1]=s,t[2]=1;break;case 4:t[0]=h,t[1]=0,t[2]=1;break;default:t[0]=1,t[1]=0,t[2]=s}return L=(1-A)*o,[255*(A*t[0]+L),255*(A*t[1]+L),255*(A*t[2]+L)]},n.hcg.hsv=function(c){const b=c[1]/100,A=b+c[2]/100*(1-b);let o=0;return A>0&&(o=b/A),[c[0],100*o,100*A]},n.hcg.hsl=function(c){const b=c[1]/100,A=c[2]/100*(1-b)+.5*b;let o=0;return A>0&&A<.5?o=b/(2*A):A>=.5&&A<1&&(o=b/(2*(1-A))),[c[0],100*o,100*A]},n.hcg.hwb=function(c){const b=c[1]/100,A=b+c[2]/100*(1-b);return[c[0],100*(A-b),100*(1-A)]},n.hwb.hcg=function(c){const b=c[1]/100,A=1-c[2]/100,o=A-b;let t=0;return o<1&&(t=(A-o)/(1-o)),[c[0],100*o,100*t]},n.apple.rgb=function(c){return[c[0]/65535*255,c[1]/65535*255,c[2]/65535*255]},n.rgb.apple=function(c){return[c[0]/255*65535,c[1]/255*65535,c[2]/255*65535]},n.gray.rgb=function(c){return[c[0]/100*255,c[0]/100*255,c[0]/100*255]},n.gray.hsl=function(c){return[0,0,c[0]]},n.gray.hsv=n.gray.hsl,n.gray.hwb=function(c){return[0,100,c[0]]},n.gray.cmyk=function(c){return[0,0,0,c[0]]},n.gray.lab=function(c){return[c[0],0,0]},n.gray.hex=function(c){const b=255&Math.round(c[0]/100*255),A=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(A.length)+A},n.rgb.gray=function(c){return[(c[0]+c[1]+c[2])/3/255*100]}},13005:(c,b,A)=>{const o=A(13014),t=A(13021),n={};Object.keys(o).forEach((c=>{n[c]={},Object.defineProperty(n[c],"channels",{value:o[c].channels}),Object.defineProperty(n[c],"labels",{value:o[c].labels});const b=t(c);Object.keys(b).forEach((A=>{const o=b[A];n[c][A]=function(c){const b=function(){for(var b=arguments.length,A=new Array(b),o=0;o<b;o++)A[o]=arguments[o];const t=A[0];if(void 0===t||null===t)return t;t.length>1&&(A=t);const n=c(A);if("object"===typeof n)for(let c=n.length,h=0;h<c;h++)n[h]=Math.round(n[h]);return n};return"conversion"in c&&(b.conversion=c.conversion),b}(o),n[c][A].raw=function(c){const b=function(){for(var b=arguments.length,A=new Array(b),o=0;o<b;o++)A[o]=arguments[o];const t=A[0];return void 0===t||null===t?t:(t.length>1&&(A=t),c(A))};return"conversion"in c&&(b.conversion=c.conversion),b}(o)}))})),c.exports=n},13021:(c,b,A)=>{const o=A(13014);function t(c){const b=function(){const c={},b=Object.keys(o);for(let A=b.length,o=0;o<A;o++)c[b[o]]={distance:-1,parent:null};return c}(),A=[c];for(b[c].distance=0;A.length;){const c=A.pop(),t=Object.keys(o[c]);for(let o=t.length,n=0;n<o;n++){const o=t[n],h=b[o];-1===h.distance&&(h.distance=b[c].distance+1,h.parent=c,A.unshift(o))}}return b}function n(c,b){return function(A){return b(c(A))}}function h(c,b){const A=[b[c].parent,c];let t=o[b[c].parent][c],h=b[c].parent;for(;b[h].parent;)A.unshift(b[h].parent),t=n(o[b[h].parent][h],t),h=b[h].parent;return t.conversion=A,t}c.exports=function(c){const b=t(c),A={},o=Object.keys(b);for(let t=o.length,n=0;n<t;n++){const c=o[n];null!==b[c].parent&&(A[c]=h(c,b))}return A}},13018:c=>{"use strict";c.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12058:function(c,b,A){"use strict";var o=this&&this.__createBinding||(Object.create?function(c,b,A,o){void 0===o&&(o=A);var t=Object.getOwnPropertyDescriptor(b,A);t&&!("get"in t?!b.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return b[A]}}),Object.defineProperty(c,o,t)}:function(c,b,A,o){void 0===o&&(o=A),c[o]=b[A]}),t=this&&this.__setModuleDefault||(Object.create?function(c,b){Object.defineProperty(c,"default",{enumerable:!0,value:b})}:function(c,b){c.default=b}),n=this&&this.__importStar||function(c){if(c&&c.__esModule)return c;var b={};if(null!=c)for(var A in c)"default"!==A&&Object.prototype.hasOwnProperty.call(c,A)&&o(b,c,A);return t(b,c),b},h=this&&this.__awaiter||function(c,b,A,o){return new(A||(A=Promise))((function(t,n){function h(c){try{L(o.next(c))}catch(b){n(b)}}function s(c){try{L(o.throw(c))}catch(b){n(b)}}function L(c){var b;c.done?t(c.value):(b=c.value,b instanceof A?b:new A((function(c){c(b)}))).then(h,s)}L((o=o.apply(c,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=b.Platform=void 0;const s=n(A(11994)),L=A(12065),C="colyseus-auth-token";!function(c){c.ios="ios",c.android="android"}(b.Platform||(b.Platform={}));b.Auth=class{constructor(c){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=c.replace("ws","http"),(0,L.getItem)(C,(c=>this.token=c))}get hasToken(){return!!this.token}login(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h(this,void 0,void 0,(function*(){const b=Object.assign({},c);this.hasToken&&(b.token=this.token);const A=yield this.request("post","/auth",b);this.token=A.token,(0,L.setItem)(C,this.token);for(let c in A)this.hasOwnProperty(c)&&(this[c]=A[c]);return this.registerPingService(),this}))}save(){return h(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return h(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return h(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return h(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(c){return h(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:c})}))}acceptFriendRequest(c){return h(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:c})}))}declineFriendRequest(c){return h(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:c})}))}blockUser(c){return h(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:c})}))}unblockUser(c){return h(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:c})}))}request(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return h(this,void 0,void 0,(function*(){t.Accept="application/json",this.hasToken&&(t.Authorization="Bearer "+this.token);const n=[];for(const c in A)n.push(`${c}=${A[c]}`);const h=n.length>0?`?${n.join("&")}`:"",L={headers:t};return o&&(L.body=o),(yield s[c](`${this.endpoint}${b}${h}`,L)).data}))}logout(){this.token=void 0,(0,L.removeItem)(C),this.unregisterPingService()}registerPingService(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),c)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11992:function(c,b,A){"use strict";var o,t=this&&this.__awaiter||function(c,b,A,o){return new(A||(A=Promise))((function(t,n){function h(c){try{L(o.next(c))}catch(b){n(b)}}function s(c){try{L(o.throw(c))}catch(b){n(b)}}function L(c){var b;c.done?t(c.value):(b=c.value,b instanceof A?b:new A((function(c){c(b)}))).then(h,s)}L((o=o.apply(c,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const n=A(11994),h=A(11999),s=A(12004);class L extends Error{constructor(c,b){super(c),this.code=b,Object.setPrototypeOf(this,L.prototype)}}b.MatchMakeError=L;const C="undefined"!==typeof window&&"undefined"!==typeof(null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;if("string"===typeof c){const b=new URL(c),A="https:"===b.protocol||"wss:"===b.protocol,o=Number(b.port||(A?443:80));this.settings={hostname:b.hostname,pathname:"/"!==b.pathname?b.pathname:"",port:o,secure:A}}else void 0===c.port&&(c.port=c.secure?443:80),void 0===c.pathname&&(c.pathname=""),this.settings=c}joinOrCreate(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",c,b,A)}))}create(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",c,b,A)}))}join(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",c,b,A)}))}joinById(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",c,b,A)}))}reconnect(c,b){return t(this,void 0,void 0,(function*(){if("string"===typeof c&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[A,o]=c.split(":");return yield this.createMatchMakeRequest("reconnect",A,{reconnectionToken:o},b)}))}getAvailableRooms(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t(this,void 0,void 0,(function*(){return(yield(0,n.get)(this.getHttpEndpoint(`${c}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(c,b,A){return t(this,void 0,void 0,(function*(){const o=this.createRoom(c.room.name,b);o.roomId=c.room.roomId,o.sessionId=c.sessionId;const n={sessionId:o.sessionId};c.reconnectionToken&&(n.reconnectionToken=c.reconnectionToken);const s=A||o;return o.connect(this.buildEndpoint(c.room,n),c.devMode&&(()=>t(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${o.roomId}'...`);let A=0;const n=()=>t(this,void 0,void 0,(function*(){A++;try{yield this.consumeSeatReservation(c,b,s),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${o.roomId}'`)}catch(t){A<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${A} out of 8)`),setTimeout(n,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(n,2e3)}))),s),new Promise(((c,b)=>{const A=(c,A)=>b(new h.ServerError(c,A));s.onError.once(A),s.onJoin.once((()=>{s.onError.remove(A),c(s)}))}))}))}createMatchMakeRequest(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;return t(this,void 0,void 0,(function*(){const t=(yield(0,n.post)(this.getHttpEndpoint(`${c}/${b}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(A)})).data;if(t.error)throw new L(t.error,t.code);return"reconnect"===c&&(t.reconnectionToken=A.reconnectionToken),yield this.consumeSeatReservation(t,o,h)}))}createRoom(c,b){return new s.Room(c,b)}buildEndpoint(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=[];for(const t in b)b.hasOwnProperty(t)&&A.push(`${t}=${b[t]}`);let o=this.settings.secure?"wss://":"ws://";return c.publicAddress?o+=`${c.publicAddress}`:o+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${o}/${c.processId}/${c.roomId}?${A.join("&")}`}getHttpEndpoint(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${c}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12015:(c,b,A)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const o=A(12022);b.Connection=class{constructor(){this.events={},this.transport=new o.WebSocketTransport(this.events)}send(c){this.transport.send(c)}connect(c){this.transport.connect(c)}close(c,b){this.transport.close(c,b)}get isOpen(){return this.transport.isOpen}}},12033:(c,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(c){c[c.HANDSHAKE=9]="HANDSHAKE",c[c.JOIN_ROOM=10]="JOIN_ROOM",c[c.ERROR=11]="ERROR",c[c.LEAVE_ROOM=12]="LEAVE_ROOM",c[c.ROOM_DATA=13]="ROOM_DATA",c[c.ROOM_STATE=14]="ROOM_STATE",c[c.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",c[c.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",c[c.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(c){c[c.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",c[c.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",c[c.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",c[c.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",c[c.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",c[c.AUTH_FAILED=4215]="AUTH_FAILED",c[c.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(c,b){const A=c[b++];for(var o="",t=0,n=b,h=b+A;n<h;n++){var s=c[n];if(0!==(128&s))if(192!==(224&s))if(224!==(240&s)){if(240!==(248&s))throw new Error("Invalid byte "+s.toString(16));(t=(7&s)<<18|(63&c[++n])<<12|(63&c[++n])<<6|63&c[++n])>=65536?(t-=65536,o+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):o+=String.fromCharCode(t)}else o+=String.fromCharCode((15&s)<<12|(63&c[++n])<<6|63&c[++n]);else o+=String.fromCharCode((31&s)<<6|63&c[++n]);else o+=String.fromCharCode(s)}return o},b.utf8Length=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,A=0;for(let o=0,t=c.length;o<t;o++)b=c.charCodeAt(o),b<128?A+=1:b<2048?A+=2:b<55296||b>=57344?A+=3:(o++,A+=4);return A+1}},12004:function(c,b,A){"use strict";var o=this&&this.__createBinding||(Object.create?function(c,b,A,o){void 0===o&&(o=A);var t=Object.getOwnPropertyDescriptor(b,A);t&&!("get"in t?!b.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return b[A]}}),Object.defineProperty(c,o,t)}:function(c,b,A,o){void 0===o&&(o=A),c[o]=b[A]}),t=this&&this.__setModuleDefault||(Object.create?function(c,b){Object.defineProperty(c,"default",{enumerable:!0,value:b})}:function(c,b){c.default=b}),n=this&&this.__importStar||function(c){if(c&&c.__esModule)return c;var b={};if(null!=c)for(var A in c)"default"!==A&&Object.prototype.hasOwnProperty.call(c,A)&&o(b,c,A);return t(b,c),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const h=n(A(12006)),s=A(12015),L=A(12033),C=A(12037),J=A(12041),X=A(12047),R=A(12050),N=A(11999);class k{constructor(c,b){this.onStateChange=(0,X.createSignal)(),this.onError=(0,X.createSignal)(),this.onLeave=(0,X.createSignal)(),this.onJoin=(0,X.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,J.createNanoEvents)(),this.roomId=null,this.name=c,b&&(this.serializer=new((0,C.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((c,b)=>{var A;return null===(A=console.warn)||void 0===A?void 0:A.call(console,`colyseus.js - onError => (${c}) ${b}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const o=new s.Connection;A.connection=o,o.events.onmessage=k.prototype.onMessageCallback.bind(A),o.events.onclose=function(c){var o;if(!A.hasJoined)return null===(o=console.warn)||void 0===o||o.call(console,`Room connection was closed unexpectedly (${c.code}): ${c.reason}`),void A.onError.invoke(c.code,c.reason);c.code===N.CloseCode.DEVMODE_RESTART&&b?b():(A.onLeave.invoke(c.code),A.destroy())},o.events.onerror=function(c){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${c.code}): ${c.reason}`),A.onError.invoke(c.code,c.reason)},o.connect(c)}leave(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((c=>b(c))),this.connection?c?this.connection.send([L.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(N.CloseCode.CONSENTED)}))}onMessage(c,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(c),b)}send(c,b){const A=[L.Protocol.ROOM_DATA];let o;if("string"===typeof c?R.encode.string(A,c):R.encode.number(A,c),void 0!==b){const c=h.encode(b);o=new Uint8Array(A.length+c.byteLength),o.set(new Uint8Array(A),0),o.set(new Uint8Array(c),A.length)}else o=new Uint8Array(A);this.connection.send(o.buffer)}sendBytes(c,b){const A=[L.Protocol.ROOM_DATA_BYTES];let o;"string"===typeof c?R.encode.string(A,c):R.encode.number(A,c),o=new Uint8Array(A.length+(b.byteLength||b.length)),o.set(new Uint8Array(A),0),o.set(new Uint8Array(b),A.length),this.connection.send(o.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(c){const b=Array.from(new Uint8Array(c.data)),A=b[0];if(A===L.Protocol.JOIN_ROOM){let c=1;const A=(0,L.utf8Read)(b,c);if(c+=(0,L.utf8Length)(A),this.serializerId=(0,L.utf8Read)(b,c),c+=(0,L.utf8Length)(this.serializerId),!this.serializer){const c=(0,C.getSerializer)(this.serializerId);this.serializer=new c}b.length>c&&this.serializer.handshake&&this.serializer.handshake(b,{offset:c}),this.reconnectionToken=`${this.roomId}:${A}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([L.Protocol.JOIN_ROOM])}else if(A===L.Protocol.ERROR){const c={offset:1},A=R.decode.number(b,c),o=R.decode.string(b,c);this.onError.invoke(A,o)}else if(A===L.Protocol.LEAVE_ROOM)this.leave();else if(A===L.Protocol.ROOM_DATA_SCHEMA){const c={offset:1},A=this.serializer.getState().constructor._context.get(R.decode.number(b,c)),o=new A;o.decode(b,c),this.dispatchMessage(A,o)}else if(A===L.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(A===L.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(A===L.Protocol.ROOM_DATA){const A={offset:1},o=R.decode.stringCheck(b,A)?R.decode.string(b,A):R.decode.number(b,A),t=b.length>A.offset?h.decode(c.data,A.offset):void 0;this.dispatchMessage(o,t)}else if(A===L.Protocol.ROOM_DATA_BYTES){const c={offset:1},A=R.decode.stringCheck(b,c)?R.decode.string(b,c):R.decode.number(b,c);this.dispatchMessage(A,new Uint8Array(b.slice(c.offset)))}}setState(c){this.serializer.setState(c),this.onStateChange.invoke(this.serializer.getState())}patch(c){this.serializer.patch(c),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(c,b){var A;const o=this.getMessageHandlerKey(c);this.onMessageHandlers.events[o]?this.onMessageHandlers.emit(o,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",c,b):null===(A=console.warn)||void 0===A||A.call(console,`colyseus.js: onMessage() not registered for type '${c}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(c){switch(typeof c){case"function":return`$${c._typeid}`;case"string":return c;case"number":return`i${c}`;default:throw new Error("invalid message type.")}}}b.Room=k},12065:(c,b)=>{"use strict";let A;function o(){return A||(A="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(c,b){this.cache[c]=b},getItem:function(c){this.cache[c]},removeItem:function(c){delete this.cache[c]}}),A}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(c,b){o().setItem(c,b)},b.removeItem=function(c){o().removeItem(c)},b.getItem=function(c,b){const A=o().getItem(c);"undefined"!==typeof Promise&&A instanceof Promise?A.then((c=>b(c))):b(A)}},12041:(c,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(c){let b=this.events[c]||[];for(var A=arguments.length,o=new Array(A>1?A-1:0),t=1;t<A;t++)o[t-1]=arguments[t];for(let n=0,h=b.length;n<h;n++)b[n](...o)},events:{},on(c,b){var A;return(null===(A=this.events[c])||void 0===A?void 0:A.push(b))||(this.events[c]=[b]),()=>{var A;this.events[c]=null===(A=this.events[c])||void 0===A?void 0:A.filter((c=>b!==c))}}})},12047:(c,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class A{constructor(){this.handlers=[]}register(c){return this.handlers.push(c),this}invoke(){for(var c=arguments.length,b=new Array(c),A=0;A<c;A++)b[A]=arguments[A];this.handlers.forEach((c=>c.apply(this,b)))}invokeAsync(){for(var c=arguments.length,b=new Array(c),A=0;A<c;A++)b[A]=arguments[A];return Promise.all(this.handlers.map((c=>c.apply(this,b))))}remove(c){const b=this.handlers.indexOf(c);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=A,b.createSignal=function(){const c=new A;function b(b){return c.register(b,null===this)}return b.once=b=>{const A=function(){for(var o=arguments.length,t=new Array(o),n=0;n<o;n++)t[n]=arguments[n];b.apply(this,t),c.remove(A)};c.register(A)},b.remove=b=>c.remove(b),b.invoke=function(){return c.invoke(...arguments)},b.invokeAsync=function(){return c.invokeAsync(...arguments)},b.clear=()=>c.clear(),b}},11999:(c,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(c){c[c.CONSENTED=4e3]="CONSENTED",c[c.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class A extends Error{constructor(c,b){super(b),this.name="ServerError",this.code=c}}b.ServerError=A},11978:(c,b,A)=>{"use strict";b.c=void 0,A(11987);var o=A(11992);Object.defineProperty(b,"c",{enumerable:!0,get:function(){return o.Client}});var t=A(12033);var n=A(12004);var h=A(12058);const s=A(12069);const L=A(12071),C=A(12037);(0,C.registerSerializer)("schema",s.SchemaSerializer),(0,C.registerSerializer)("none",L.NoneSerializer)},11987:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=c=>null!==c&&"object"===typeof c&&c.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12006:(c,b)=>{"use strict";function A(c,b){if(this._offset=b,c instanceof ArrayBuffer)this._buffer=c,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(c))throw new Error("Invalid argument");this._buffer=c.buffer,this._view=new DataView(this._buffer,c.byteOffset,c.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,A.prototype._array=function(c){for(var b=new Array(c),A=0;A<c;A++)b[A]=this._parse();return b},A.prototype._map=function(c){for(var b={},A=0;A<c;A++)b[this._parse()]=this._parse();return b},A.prototype._str=function(c){var b=function(c,b,A){for(var o="",t=0,n=b,h=b+A;n<h;n++){var s=c.getUint8(n);if(0!==(128&s))if(192!==(224&s))if(224!==(240&s)){if(240!==(248&s))throw new Error("Invalid byte "+s.toString(16));(t=(7&s)<<18|(63&c.getUint8(++n))<<12|(63&c.getUint8(++n))<<6|63&c.getUint8(++n))>=65536?(t-=65536,o+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):o+=String.fromCharCode(t)}else o+=String.fromCharCode((15&s)<<12|(63&c.getUint8(++n))<<6|63&c.getUint8(++n));else o+=String.fromCharCode((31&s)<<6|63&c.getUint8(++n));else o+=String.fromCharCode(s)}return o}(this._view,this._offset,c);return this._offset+=c,b},A.prototype._bin=function(c){var b=this._buffer.slice(this._offset,this._offset+c);return this._offset+=c,b},A.prototype._parse=function(){var c,b=this._view.getUint8(this._offset++),A=0,o=0,t=0,n=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return A=this._view.getUint8(this._offset),this._offset+=1,this._bin(A);case 197:return A=this._view.getUint16(this._offset),this._offset+=2,this._bin(A);case 198:return A=this._view.getUint32(this._offset),this._offset+=4,this._bin(A);case 199:if(A=this._view.getUint8(this._offset),o=this._view.getInt8(this._offset+1),this._offset+=2,-1===o){var h=this._view.getUint32(this._offset);return t=this._view.getInt32(this._offset+4),n=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*t+n)+h/1e6)}return[o,this._bin(A)];case 200:return A=this._view.getUint16(this._offset),o=this._view.getInt8(this._offset+2),this._offset+=3,[o,this._bin(A)];case 201:return A=this._view.getUint32(this._offset),o=this._view.getInt8(this._offset+4),this._offset+=5,[o,this._bin(A)];case 202:return c=this._view.getFloat32(this._offset),this._offset+=4,c;case 203:return c=this._view.getFloat64(this._offset),this._offset+=8,c;case 204:return c=this._view.getUint8(this._offset),this._offset+=1,c;case 205:return c=this._view.getUint16(this._offset),this._offset+=2,c;case 206:return c=this._view.getUint32(this._offset),this._offset+=4,c;case 207:return t=this._view.getUint32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,t+n;case 208:return c=this._view.getInt8(this._offset),this._offset+=1,c;case 209:return c=this._view.getInt16(this._offset),this._offset+=2,c;case 210:return c=this._view.getInt32(this._offset),this._offset+=4,c;case 211:return t=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,t+n;case 212:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?void(this._offset+=1):[o,this._bin(1)];case 213:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(2)];case 214:return o=this._view.getInt8(this._offset),this._offset+=1,-1===o?(c=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*c)):[o,this._bin(4)];case 215:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?(t=this._view.getInt32(this._offset)*Math.pow(2,32),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(t+n)):-1===o?(t=this._view.getUint32(this._offset),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&t)+n)+(t>>>2)/1e6)):[o,this._bin(8)];case 216:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(16)];case 217:return A=this._view.getUint8(this._offset),this._offset+=1,this._str(A);case 218:return A=this._view.getUint16(this._offset),this._offset+=2,this._str(A);case 219:return A=this._view.getUint32(this._offset),this._offset+=4,this._str(A);case 220:return A=this._view.getUint16(this._offset),this._offset+=2,this._array(A);case 221:return A=this._view.getUint32(this._offset),this._offset+=4,this._array(A);case 222:return A=this._view.getUint16(this._offset),this._offset+=2,this._map(A);case 223:return A=this._view.getUint32(this._offset),this._offset+=4,this._map(A)}throw new Error("Could not parse")},b.decode=function(c){var b=new A(c,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),o=b._parse();if(b._offset!==c.byteLength)throw new Error(c.byteLength-b._offset+" trailing bytes");return o};function o(c,b,A){for(var o=0,t=0,n=A.length;t<n;t++)(o=A.charCodeAt(t))<128?c.setUint8(b++,o):o<2048?(c.setUint8(b++,192|o>>6),c.setUint8(b++,128|63&o)):o<55296||o>=57344?(c.setUint8(b++,224|o>>12),c.setUint8(b++,128|o>>6&63),c.setUint8(b++,128|63&o)):(t++,o=65536+((1023&o)<<10|1023&A.charCodeAt(t)),c.setUint8(b++,240|o>>18),c.setUint8(b++,128|o>>12&63),c.setUint8(b++,128|o>>6&63),c.setUint8(b++,128|63&o))}function t(c,b,A){var o=typeof A,n=0,h=0,s=0,L=0,C=0,J=0;if("string"===o){if(C=function(c){for(var b=0,A=0,o=0,t=c.length;o<t;o++)(b=c.charCodeAt(o))<128?A+=1:b<2048?A+=2:b<55296||b>=57344?A+=3:(o++,A+=4);return A}(A),C<32)c.push(160|C),J=1;else if(C<256)c.push(217,C),J=2;else if(C<65536)c.push(218,C>>8,C),J=3;else{if(!(C<4294967296))throw new Error("String too long");c.push(219,C>>24,C>>16,C>>8,C),J=5}return b.push({_str:A,_length:C,_offset:c.length}),J+C}if("number"===o)return Math.floor(A)===A&&isFinite(A)?A>=0?A<128?(c.push(A),1):A<256?(c.push(204,A),2):A<65536?(c.push(205,A>>8,A),3):A<4294967296?(c.push(206,A>>24,A>>16,A>>8,A),5):(s=A/Math.pow(2,32)|0,L=A>>>0,c.push(207,s>>24,s>>16,s>>8,s,L>>24,L>>16,L>>8,L),9):A>=-32?(c.push(A),1):A>=-128?(c.push(208,A),2):A>=-32768?(c.push(209,A>>8,A),3):A>=-2147483648?(c.push(210,A>>24,A>>16,A>>8,A),5):(s=Math.floor(A/Math.pow(2,32)),L=A>>>0,c.push(211,s>>24,s>>16,s>>8,s,L>>24,L>>16,L>>8,L),9):(c.push(203),b.push({_float:A,_length:8,_offset:c.length}),9);if("object"===o){if(null===A)return c.push(192),1;if(Array.isArray(A)){if((C=A.length)<16)c.push(144|C),J=1;else if(C<65536)c.push(220,C>>8,C),J=3;else{if(!(C<4294967296))throw new Error("Array too large");c.push(221,C>>24,C>>16,C>>8,C),J=5}for(n=0;n<C;n++)J+=t(c,b,A[n]);return J}if(A instanceof Date){var X=A.getTime(),R=Math.floor(X/1e3),N=1e6*(X-1e3*R);return R>=0&&N>=0&&R<=17179869183?0===N&&R<=4294967295?(c.push(214,255,R>>24,R>>16,R>>8,R),6):(s=R/4294967296,L=4294967295&R,c.push(215,255,N>>22,N>>14,N>>6,s,L>>24,L>>16,L>>8,L),10):(s=Math.floor(R/4294967296),L=R>>>0,c.push(199,12,255,N>>24,N>>16,N>>8,N,s>>24,s>>16,s>>8,s,L>>24,L>>16,L>>8,L),15)}if(A instanceof ArrayBuffer){if((C=A.byteLength)<256)c.push(196,C),J=2;else if(C<65536)c.push(197,C>>8,C),J=3;else{if(!(C<4294967296))throw new Error("Buffer too large");c.push(198,C>>24,C>>16,C>>8,C),J=5}return b.push({_bin:A,_length:C,_offset:c.length}),J+C}if("function"===typeof A.toJSON)return t(c,b,A.toJSON());var k=[],E="",V=Object.keys(A);for(n=0,h=V.length;n<h;n++)void 0!==A[E=V[n]]&&"function"!==typeof A[E]&&k.push(E);if((C=k.length)<16)c.push(128|C),J=1;else if(C<65536)c.push(222,C>>8,C),J=3;else{if(!(C<4294967296))throw new Error("Object too large");c.push(223,C>>24,C>>16,C>>8,C),J=5}for(n=0;n<C;n++)J+=t(c,b,E=k[n]),J+=t(c,b,A[E]);return J}if("boolean"===o)return c.push(A?195:194),1;if("undefined"===o)return c.push(192),1;if("function"===typeof A.toJSON)return t(c,b,A.toJSON());throw new Error("Could not encode")}b.encode=function(c){var b=[],A=[],n=t(b,A,c),h=new ArrayBuffer(n),s=new DataView(h),L=0,C=0,J=-1;A.length>0&&(J=A[0]._offset);for(var X,R=0,N=0,k=0,E=b.length;k<E;k++)if(s.setUint8(C+k,b[k]),k+1===J){if(R=(X=A[L])._length,N=C+J,X._bin)for(var V=new Uint8Array(X._bin),y=0;y<R;y++)s.setUint8(N+y,V[y]);else X._str?o(s,N,X._str):void 0!==X._float&&s.setFloat64(N,X._float);C+=R,A[++L]&&(J=A[L]._offset)}return h}},12071:(c,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(c){}getState(){return null}patch(c){}teardown(){}handshake(c){}}},12069:(c,b,A)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const o=A(12050);b.SchemaSerializer=class{setState(c){return this.state.decode(c)}getState(){return this.state}patch(c){return this.state.decode(c)}teardown(){var c,b;null===(b=null===(c=this.state)||void 0===c?void 0:c.$changes)||void 0===b||b.root.clearRefs()}handshake(c,b){if(this.state){(new o.Reflection).decode(c,b)}else this.state=o.Reflection.decode(c,b)}}},12037:(c,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const A={};b.registerSerializer=function(c,b){A[c]=b},b.getSerializer=function(c){const b=A[c];if(!b)throw new Error("missing serializer: "+c);return b}},12022:function(c,b,A){"use strict";var o=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const t=o(A(12026)),n=globalThis.WebSocket||t.default;b.WebSocketTransport=class{constructor(c){this.events=c}send(c){c instanceof ArrayBuffer?this.ws.send(c):Array.isArray(c)&&this.ws.send(new Uint8Array(c).buffer)}connect(c){this.ws=new n(c,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(c,b){this.ws.close(c,b)}get isOpen(){return this.ws.readyState===n.OPEN}}},12026:c=>{"use strict";c.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13082:c=>{"use strict";c.exports=function(c,b,A,o,t,n){var h=+b[0],s=+b[1],L=+b[2],C=+A[0],J=+A[1],X=+A[2],R=Math.sqrt(C*C+J*J+X*X);if(0===R)throw new Error("Can't raycast along a zero vector");return function(c,b,A,o,t,n,h,s,L,C){for(var J=0,X=Math.floor,R=0|X(b),N=0|X(A),k=0|X(o),E=t>0?1:-1,V=n>0?1:-1,y=h>0?1:-1,j=Math.abs(1/t),F=Math.abs(1/n),M=Math.abs(1/h),W=j<1/0?j*(E>0?R+1-b:b-R):1/0,d=F<1/0?F*(V>0?N+1-A:A-N):1/0,r=M<1/0?M*(y>0?k+1-o:o-k):1/0,z=-1;J<=s;){var Y=c(R,N,k);if(Y)return L&&(L[0]=b+J*t,L[1]=A+J*n,L[2]=o+J*h),C&&(C[0]=C[1]=C[2]=0,0===z&&(C[0]=-E),1===z&&(C[1]=-V),2===z&&(C[2]=-y)),Y;W<d?W<r?(R+=E,J=W,W+=j,z=0):(k+=y,J=r,r+=M,z=2):d<r?(N+=V,J=d,d+=F,z=1):(k+=y,J=r,r+=M,z=2)}return L&&(L[0]=b+J*t,L[1]=A+J*n,L[2]=o+J*h),C&&(C[0]=C[1]=C[2]=0),0}(c,h,s,L,C/=R,J/=R,X/=R,o="undefined"===typeof o?64:+o,t,n)}},13117:(c,b,A)=>{"use strict";A.d(b,{b:()=>n});var o=A(85);function t(){this.Pl=!1,this.stopPropagation=!1,this.Ql=!1,this.disabled=!1}class n{constructor(c,b){this.version="0.7.0";var A=Object.assign({},new t,b||{});this.element=c||document,this.Pl=!!A.Pl,this.stopPropagation=!!A.stopPropagation,this.Ql=!!A.Ql,this.disabled=!!A.disabled,this.filterEvents=(c,b)=>!0,this.down=new o.EventEmitter,this.up=new o.EventEmitter,this.state={},this.Hg={dx:0,dy:0,wm:0,Gg:0,xm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?s(this):document.addEventListener("DOMContentLoaded",(c=>{s(this)}),{once:!0})}bind(c){for(var b=arguments.length,A=new Array(b>1?b-1:0),o=1;o<b;o++)A[o-1]=arguments[o];A.forEach((b=>{var A=this._keyBindmap[b]||[];A.includes(c)||(A.push(c),this._keyBindmap[b]=A)})),this.state[c]=!!this.state[c],this.pressCount[c]=this.pressCount[c]||0,this.releaseCount[c]=this.releaseCount[c]||0}unbind(c){for(var b in this._keyBindmap){var A=this._keyBindmap[b],o=A.indexOf(c);o>-1&&A.splice(o,1)}}getBindings(){var c={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((A=>{c[A]=c[A]||[],c[A].push(b)}))}return c}Kj(){h(this.Hg),h(this.pressCount),h(this.releaseCount)}}function h(c){for(var b in c)c[b]=0}function s(c){window.addEventListener("keydown",k.bind(null,c,!0),!1),window.addEventListener("keyup",k.bind(null,c,!1),!1);var b={passive:!0};c.element.addEventListener("touchstart",X.bind(void 0,c),{passive:!1}),c.element.addEventListener("touchend",N.bind(void 0,c),b),c.element.addEventListener("mousedown",E.bind(null,c,!0),b),window.document.addEventListener("mouseup",E.bind(null,c,!1),b),c.element.addEventListener("touchmove",V.bind(null,c),b),c.element.addEventListener("mousemove",V.bind(null,c),b),window.PointerEvent,c.element.addEventListener("wheel",y.bind(null,c),b),c.element.addEventListener("contextmenu",j.bind(null,c),!1),window.addEventListener("blur",F.bind(null,c),!1)}var L=0,C=0,J=null;function X(c,b){b.preventDefault(),R(b)}function R(c){let b=!1;for(let A=0;A<c.touches.length;++A)if(c.touches[A].identifier===J){b=!0;break}if(!b){const b=c.changedTouches[0];L=b.clientX,C=b.clientY,J=b.identifier}}function N(c,b){for(var A=b.changedTouches,o=0;o<A.length;++o)A[o].identifier===J&&(J=null)}function k(c,b,A){M(A.code,b,c,A)}function E(c,b,A){if("pointerId"in A)if(b){if(null!==c._touches.currID)return;c._touches.currID=A.pointerId}else{if(c._touches.currID!==A.pointerId)return;c._touches.currID=null}return M("Mouse"+("button"in A?A.button+1:1),b,c,A),!1}function V(c,b){var A=b.movementX||b.mozMovementX||0,o=b.movementY||b.mozMovementY||0;if(b.touches&&0===(A|o)){var t=function(c){R(c);for(let b=0;b<c.changedTouches.length;++b)if(c.changedTouches[b].identifier==J){const A=c.changedTouches[b],o=[A.clientX-L,A.clientY-C];return L=A.clientX,C=A.clientY,o}return console.error(`Did not find touch id ${J}`),[0,0]}(b);A=t[0],o=t[1]}c.Hg.dx+=A,c.Hg.dy+=o}function y(c,b){var A=1;switch(b.deltaMode){case 0:A=1;break;case 1:A=12;break;case 2:A=c.element.clientHeight||window.innerHeight}c.Hg.wm+=(b.deltaX||0)*A,c.Hg.Gg+=(b.deltaY||0)*A,c.Hg.xm+=(b.deltaZ||0)*A}function j(c,b){if(!c.Ql)return b.preventDefault(),!1}function F(c){for(var b in c._keyStates)c._keyStates[b]&&(/^Mouse\d/.test(b)||M(b,!1,c,{code:b,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function M(c,b,A,o){var t=A._keyBindmap[c];t&&(W(A._keyStates[c],b)&&(A._keyStates[c]=b,t.forEach((c=>{(!A.filterEvents||A.filterEvents(o,c))&&function(c,b,A,o){var t=b?A.pressCount:A.releaseCount;t[c]=(t[c]||0)+1;var n=A._bindPressCount[c]||0;(n+=b?1:-1)<0&&(n=0);A._bindPressCount[c]=n;var h=A.state[c];if(W(h,n)){A.state[c]=n>0;var s=b?A.down:A.up;A.disabled||s.emit(c,o)}}(c,b,A,o)}))),"button"in o||(A.Pl&&!o.defaultPrevented&&o.preventDefault(),A.stopPropagation&&o.stopPropagation()))}function W(c,b){return c?!b:b}},13088:(c,b,A)=>{"use strict";A.d(b,{c:()=>o});class o{constructor(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Wk=!1,this.Xk=!1,this.if=30,this.Vk=0,this.cl=!1,this.fullscreen=!1,this.Zk=function(c){},this.$k=function(){},this.al=function(){},this.k=function(){},this._k=function(c){},this.onFullscreenChanged=function(c){},C((()=>{!function(c,b){c._nowObject=performance||Date,c._lastTick=0,c._renderAccum=0,c._rt=0,c._frameCB=s.bind(null,c),requestAnimationFrame(c._frameCB),b>0&&(c._intervalCB=h.bind(null,c),c._interval=setInterval(c._intervalCB,Math.max(b,1e3/c.if/2)))}(this,b),function(c,b){if(!b)return;var A=!1,o=!1;document.addEventListener("pointerlockchange",(o=>{A=document.pointerLockElement===b,c._k(A)})),document.addEventListener("fullscreenchange",(A=>{o=document.fullscreenElement===b,c.onFullscreenChanged(o)})),Object.defineProperty(c,"cl",{get:()=>A,set:c=>{c&&!A?L(b):A&&!c&&function(c){c.exitPointerLock&&c.exitPointerLock()}(document)}}),Object.defineProperty(c,"fullscreen",{get:()=>o,set:c=>{c&&!o?b.requestFullscreen():o&&!c&&document.exitFullscreen()}}),b.addEventListener("click",(t=>{c.Wk&&!A&&L(b),c.Xk&&!o&&b.requestFullscreen()}));var t=()=>c.k();if(window.ResizeObserver){new ResizeObserver(t).observe(b)}else window.addEventListener("resize",t)}(this,c),this.al()}))}}var t=3,n=20;function h(c){for(var b=1e3/c.if,A=c._nowObject.now()+n,o=0;c._nowObject.now()>=c._lastTick+b&&c._nowObject.now()<A&&++o<=t;)c.Zk(b),c._lastTick+=b;var h=5*(b+5),s=c._nowObject.now();if(s-c._lastTick>h)for(;s>=c._lastTick+b;)c._lastTick+=b}function s(c){requestAnimationFrame(c._frameCB),h(c);var b=c._nowObject.now(),A=b-c._rt;if(c._rt=b,c.Vk>0){c._renderAccum+=A;var o=1e3/c.Vk;if(c._renderAccum<o)return;c._renderAccum=Math.min(c._renderAccum-o,o)}var t=1e3/c.if,n=(b-c._lastTick)/t;c.$k(A,n,t)}function L(c){c.requestPointerLock&&c.requestPointerLock()}var C=c=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),c()};document.addEventListener("readystatechange",b)}else setTimeout(c,1)}},12979:c=>{var b;self,b=()=>(()=>{"use strict";var c={d:(b,A)=>{for(var o in A)c.o(A,o)&&!c.o(b,o)&&Object.defineProperty(b,o,{enumerable:!0,get:A[o]})},o:(c,b)=>Object.prototype.hasOwnProperty.call(c,b)},b={};c.d(b,{default:()=>p});var A,o=function(c,b){var A=b.x-c.x,o=b.y-c.y;return Math.sqrt(A*A+o*o)},t=function(c){return c*(Math.PI/180)},n=new Map,h=function(c){n.has(c)&&clearTimeout(n.get(c)),n.set(c,setTimeout(c,100))},s=function(c,b,A){for(var o,t=b.split(/[ ,]+/g),n=0;n<t.length;n+=1)o=t[n],c.addEventListener?c.addEventListener(o,A,!1):c.attachEvent&&c.attachEvent(o,A)},L=function(c,b,A){for(var o,t=b.split(/[ ,]+/g),n=0;n<t.length;n+=1)o=t[n],c.removeEventListener?c.removeEventListener(o,A):c.detachEvent&&c.detachEvent(o,A)},C=function(c){return c.preventDefault(),c.type.match(/^touch/)?c.changedTouches:c},J=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},X=function(c,b){b.top||b.right||b.bottom||b.left?(c.style.top=b.top,c.style.right=b.right,c.style.bottom=b.bottom,c.style.left=b.left):(c.style.left=b.x+"px",c.style.top=b.y+"px")},R=function(c,b,A){var o=N(c);for(var t in o)if(o.hasOwnProperty(t))if("string"==typeof b)o[t]=b+" "+A;else{for(var n="",h=0,s=b.length;h<s;h+=1)n+=b[h]+" "+A+", ";o[t]=n.slice(0,-2)}return o},N=function(c){var b={};return b[c]="",["webkit","Moz","o"].forEach((function(A){b[A+c.charAt(0).toUpperCase()+c.slice(1)]=""})),b},k=function(c,b){for(var A in b)b.hasOwnProperty(A)&&(c[A]=b[A]);return c},E=function(c,b){if(c.length)for(var A=0,o=c.length;A<o;A+=1)b(c[A]);else b(c)},V="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,y=window.matchMedia("(any-hover: none)").matches,j=!!("ontouchstart"in window),F=!!window.PointerEvent,M=!!window.MSPointerEvent,W={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},d={start:"mousedown",move:"mousemove",end:"mouseup"},r={};function z(){}V&&!y?A=W:F?A={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:M?A={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:j?(A=W,r=d):A=d,z.prototype.on=function(c,b){var A,o=this,t=c.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var n=0;n<t.length;n+=1)A=t[n],o._handlers_[A]=o._handlers_[A]||[],o._handlers_[A].push(b);return o},z.prototype.off=function(c,b){var A=this;return A._handlers_=A._handlers_||{},void 0===c?A._handlers_={}:void 0===b?A._handlers_[c]=null:A._handlers_[c]&&A._handlers_[c].indexOf(b)>=0&&A._handlers_[c].splice(A._handlers_[c].indexOf(b),1),A},z.prototype.trigger=function(c,b){var A,o=this,t=c.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var n=0;n<t.length;n+=1)A=t[n],o._handlers_[A]&&o._handlers_[A].length&&o._handlers_[A].forEach((function(c){c.call(o,{type:A,target:o},b)}))},z.prototype.config=function(c){var b=this;b.options=b.defaults||{},c&&(b.options=function(c,b){var A={};for(var o in c)c.hasOwnProperty(o)&&b.hasOwnProperty(o)?A[o]=b[o]:c.hasOwnProperty(o)&&(A[o]=c[o]);return A}(b.options,c))},z.prototype.bindEvt=function(c,b){var o=this;return o._domHandlers_=o._domHandlers_||{},o._domHandlers_[b]=function(){"function"==typeof o["on"+b]?o["on"+b].apply(o,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},s(c,A[b],o._domHandlers_[b]),r[b]&&s(c,r[b],o._domHandlers_[b]),o},z.prototype.unbindEvt=function(c,b){var o=this;return o._domHandlers_=o._domHandlers_||{},L(c,A[b],o._domHandlers_[b]),r[b]&&L(c,r[b],o._domHandlers_[b]),delete o._domHandlers_[b],this};const Y=z;function D(c,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=c,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=D.id,D.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}D.prototype=new Y,D.constructor=D,D.id=0,D.prototype.buildEl=function(c){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},D.prototype.stylize=function(){if(this.options.dataOnly)return this;var c=this.options.fadeTime+"ms",b=function(){var c=N("borderRadius");for(var b in c)c.hasOwnProperty(b)&&(c[b]="50%");return c}(),A=R("transition","opacity",c),o={};return o.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},o.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},o.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},k(o.el,A),"circle"===this.options.shape&&k(o.back,b),k(o.front,b),this.applyStyles(o),this},D.prototype.applyStyles=function(c){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var A in c[b])this.ui[b].style[A]=c[b][A];return this},D.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},D.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},D.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},D.prototype.show=function(c){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof c&&c.call(this)}),b.options.fadeTime)),b},D.prototype.hide=function(c){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var A="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=A,"function"==typeof c&&c.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var A=b.options.restJoystick,o={};o.x=!0===A||!1!==A.x?0:b.instance.frontPosition.x,o.y=!0===A||!1!==A.y?0:b.instance.frontPosition.y,b.setPosition(c,o)}return b},D.prototype.setPosition=function(c,b){var A=this;A.frontPosition={x:b.x,y:b.y};var o=A.options.fadeTime+"ms",t={};t.front=R("transition",["transform"],o);var n={front:{}};n.front={transform:"translate("+A.frontPosition.x+"px,"+A.frontPosition.y+"px)"},A.applyStyles(t),A.applyStyles(n),A.restTimeout=setTimeout((function(){"function"==typeof c&&c.call(A),A.restCallback()}),A.options.fadeTime)},D.prototype.restCallback=function(){var c=this,b={};b.front=R("transition","none",""),c.applyStyles(b),c.trigger("rested",c.instance)},D.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},D.prototype.computeDirection=function(c){var b,A,o,t=c.angle.radian,n=Math.PI/4,h=Math.PI/2;if(t>n&&t<3*n&&!c.lockX?b="up":t>-n&&t<=n&&!c.lockY?b="left":t>3*-n&&t<=-n&&!c.lockX?b="down":c.lockY||(b="right"),c.lockY||(A=t>-h&&t<h?"left":"right"),c.lockX||(o=t>0?"up":"down"),c.force>this.options.threshold){var s,L={};for(s in this.direction)this.direction.hasOwnProperty(s)&&(L[s]=this.direction[s]);var C={};for(s in this.direction={x:A,y:o,angle:b},c.direction=this.direction,L)L[s]===this.direction[s]&&(C[s]=!0);if(C.x&&C.y&&C.angle)return c;C.x&&C.y||this.trigger("plain",c),C.x||this.trigger("plain:"+A,c),C.y||this.trigger("plain:"+o,c),C.angle||this.trigger("dir dir:"+b,c)}else this.resetDirection();return c};const f=D;function v(c,b){var A=this;A.nipples=[],A.idles=[],A.actives=[],A.ids=[],A.pressureIntervals={},A.manager=c,A.id=v.id,v.id+=1,A.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},A.config(b),"static"!==A.options.mode&&"semi"!==A.options.mode||(A.options.multitouch=!1),A.options.multitouch||(A.options.maxNumberOfNipples=1);var o=getComputedStyle(A.options.zone.parentElement);return o&&"flex"===o.display&&(A.parentIsFlex=!0),A.updateBox(),A.prepareNipples(),A.Rl(),A.begin(),A.nipples}v.prototype=new Y,v.constructor=v,v.id=0,v.prototype.prepareNipples=function(){var c=this,b=c.nipples;b.on=c.on.bind(c),b.off=c.off.bind(c),b.options=c.options,b.destroy=c.destroy.bind(c),b.ids=c.ids,b.id=c.id,b.processOnMove=c.processOnMove.bind(c),b.processOnEnd=c.processOnEnd.bind(c),b.get=function(c){if(void 0===c)return b[0];for(var A=0,o=b.length;A<o;A+=1)if(b[A].identifier===c)return b[A];return!1}},v.prototype.Rl=function(){var c=this;c.bindEvt(c.options.zone,"start"),c.options.zone.style.touchAction="none",c.options.zone.style.msTouchAction="none"},v.prototype.begin=function(){var c=this,b=c.options;if("static"===b.mode){var A=c.createNipple(b.position,c.manager.getIdentifier());A.add(),c.idles.push(A)}},v.prototype.createNipple=function(c,b){var A=this,o=A.manager.scroll,t={},n=A.options,h=A.parentIsFlex?o.x:o.x+A.box.left,s=A.parentIsFlex?o.y:o.y+A.box.top;if(c.x&&c.y)t={x:c.x-h,y:c.y-s};else if(c.top||c.right||c.bottom||c.left){var L=document.createElement("DIV");L.style.display="hidden",L.style.top=c.top,L.style.right=c.right,L.style.bottom=c.bottom,L.style.left=c.left,L.style.position="absolute",n.zone.appendChild(L);var C=L.getBoundingClientRect();n.zone.removeChild(L),t=c,c={x:C.left+o.x,y:C.top+o.y}}var J=new f(A,{color:n.color,size:n.size,threshold:n.threshold,fadeTime:n.fadeTime,dataOnly:n.dataOnly,restJoystick:n.restJoystick,restOpacity:n.restOpacity,mode:n.mode,identifier:b,position:c,zone:n.zone,frontPosition:{x:0,y:0},shape:n.shape});return n.dataOnly||(X(J.ui.el,t),X(J.ui.front,J.frontPosition)),A.nipples.push(J),A.trigger("added "+J.identifier+":added",J),A.manager.trigger("added "+J.identifier+":added",J),A.bindNipple(J),J},v.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},v.prototype.bindNipple=function(c){var b,A=this,o=function(c,o){b=c.type+" "+o.id+":"+c.type,A.trigger(b,o)};c.on("destroyed",A.onDestroyed.bind(A)),c.on("shown hidden rested dir plain",o),c.on("dir:up dir:right dir:down dir:left",o),c.on("plain:up plain:right plain:down plain:left",o)},v.prototype.pressureFn=function(c,b,A){var o=this,t=0;clearInterval(o.pressureIntervals[A]),o.pressureIntervals[A]=setInterval(function(){var A=c.force||c.pressure||c.webkitForce||0;A!==t&&(b.trigger("pressure",A),o.trigger("pressure "+b.identifier+":pressure",A),t=A)}.bind(o),100)},v.prototype.onstart=function(c){var b=this,A=b.options,o=c;return c=C(c),b.updateBox(),E(c,(function(t){b.actives.length<A.maxNumberOfNipples?b.processOnStart(t):o.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(A){if(Object.values(o.touches).findIndex((function(c){return c.identifier===A}))<0){var t=[c[0]];t.identifier=A,b.processOnEnd(t)}})),b.actives.length<A.maxNumberOfNipples&&b.processOnStart(t))})),b.manager.bindDocument(),!1},v.prototype.processOnStart=function(c){var b,A=this,t=A.options,n=A.manager.getIdentifier(c),h=c.force||c.pressure||c.webkitForce||0,s={x:c.pageX,y:c.pageY},L=A.getOrCreate(n,s);L.identifier!==n&&A.manager.removeIdentifier(L.identifier),L.identifier=n;var C=function(b){b.trigger("start",b),A.trigger("start "+b.id+":start",b),b.show(),h>0&&A.pressureFn(c,b,b.identifier),A.processOnMove(c)};if((b=A.idles.indexOf(L))>=0&&A.idles.splice(b,1),A.actives.push(L),A.ids.push(L.identifier),"semi"!==t.mode)C(L);else{if(!(o(s,L.position)<=t.catchDistance))return L.destroy(),void A.processOnStart(c);C(L)}return L},v.prototype.getOrCreate=function(c,b){var A,o=this,t=o.options;return/(semi|static)/.test(t.mode)?(A=o.idles[0])?(o.idles.splice(0,1),A):"semi"===t.mode?o.createNipple(b,c):(console.warn("Coudln't find the needed nipple."),!1):A=o.createNipple(b,c)},v.prototype.processOnMove=function(c){var b=this,A=b.options,n=b.manager.getIdentifier(c),h=b.nipples.get(n),s=b.manager.scroll;if(function(c){return isNaN(c.buttons)?0!==c.pressure:0!==c.buttons}(c)){if(!h)return console.error("Found zombie joystick with ID "+n),void b.manager.removeIdentifier(n);if(A.dynamicPage){var L=h.el.getBoundingClientRect();h.position={x:s.x+L.left,y:s.y+L.top}}h.identifier=n;var C=h.options.size/2,J={x:c.pageX,y:c.pageY};A.lockX&&(J.y=h.position.y),A.lockY&&(J.x=h.position.x);var X,R,N,k,E,V,y,j,F,M,W=o(J,h.position),d=(X=J,N=(R=h.position).x-X.x,k=R.y-X.y,function(c){return c*(180/Math.PI)}(Math.atan2(k,N))),r=t(d),z=W/C,Y={distance:W,position:J};if("circle"===h.options.shape?(E=Math.min(W,C),y=h.position,j=E,M={x:0,y:0},F=t(F=d),M.x=y.x-j*Math.cos(F),M.y=y.y-j*Math.sin(F),V=M):(V=function(c,b,A){return{x:Math.min(Math.max(c.x,b.x-A),b.x+A),y:Math.min(Math.max(c.y,b.y-A),b.y+A)}}(J,h.position,C),E=o(V,h.position)),A.follow){if(W>C){var D=J.x-V.x,f=J.y-V.y;h.position.x+=D,h.position.y+=f,h.el.style.top=h.position.y-(b.box.top+s.y)+"px",h.el.style.left=h.position.x-(b.box.left+s.x)+"px",W=o(J,h.position)}}else J=V,W=E;var v=J.x-h.position.x,G=J.y-h.position.y;h.frontPosition={x:v,y:G},A.dataOnly||(h.ui.front.style.transform="translate("+v+"px,"+G+"px)");var P={identifier:h.identifier,position:J,force:z,pressure:c.force||c.pressure||c.webkitForce||0,distance:W,angle:{radian:r,degree:d},vector:{x:v/C,y:-G/C},raw:Y,instance:h,lockX:A.lockX,lockY:A.lockY};(P=h.computeDirection(P)).angle={radian:t(180-d),degree:180-d},h.trigger("move",P),b.trigger("move "+h.id+":move",P)}else this.processOnEnd(c)},v.prototype.processOnEnd=function(c){var b=this,A=b.options,o=b.manager.getIdentifier(c),t=b.nipples.get(o),n=b.manager.removeIdentifier(t.identifier);t&&(A.dataOnly||t.hide((function(){"dynamic"===A.mode&&(t.trigger("removed",t),b.trigger("removed "+t.id+":removed",t),b.manager.trigger("removed "+t.id+":removed",t),t.destroy())})),clearInterval(b.pressureIntervals[t.identifier]),t.resetDirection(),t.trigger("end",t),b.trigger("end "+t.id+":end",t),b.ids.indexOf(t.identifier)>=0&&b.ids.splice(b.ids.indexOf(t.identifier),1),b.actives.indexOf(t)>=0&&b.actives.splice(b.actives.indexOf(t),1),/(semi|static)/.test(A.mode)?b.idles.push(t):b.nipples.indexOf(t)>=0&&b.nipples.splice(b.nipples.indexOf(t),1),b.manager.unbindDocument(),/(semi|static)/.test(A.mode)&&(b.manager.ids[n.id]=n.identifier))},v.prototype.onDestroyed=function(c,b){var A=this;A.nipples.indexOf(b)>=0&&A.nipples.splice(A.nipples.indexOf(b),1),A.actives.indexOf(b)>=0&&A.actives.splice(A.actives.indexOf(b),1),A.idles.indexOf(b)>=0&&A.idles.splice(A.idles.indexOf(b),1),A.ids.indexOf(b.identifier)>=0&&A.ids.splice(A.ids.indexOf(b.identifier),1),A.manager.removeIdentifier(b.identifier),A.manager.unbindDocument()},v.prototype.destroy=function(){var c=this;for(var b in c.unbindEvt(c.options.zone,"start"),c.nipples.forEach((function(c){c.destroy()})),c.pressureIntervals)c.pressureIntervals.hasOwnProperty(b)&&clearInterval(c.pressureIntervals[b]);c.trigger("destroyed",c.nipples),c.manager.unbindDocument(),c.off()};const G=v;function P(c){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=J(),b.config(c),b.prepareCollections();var A=function(){var c;b.collections.forEach((function(A){A.forEach((function(A){c=A.el.getBoundingClientRect(),A.position={x:b.scroll.x+c.left,y:b.scroll.y+c.top}}))}))};s(window,"resize",(function(){h(A)}));var o=function(){b.scroll=J()};return s(window,"scroll",(function(){h(o)})),b.collections}P.prototype=new Y,P.constructor=P,P.prototype.prepareCollections=function(){var c=this;c.collections.create=c.create.bind(c),c.collections.on=c.on.bind(c),c.collections.off=c.off.bind(c),c.collections.destroy=c.destroy.bind(c),c.collections.get=function(b){var A;return c.collections.every((function(c){return!(A=c.get(b))})),A}},P.prototype.create=function(c){return this.createCollection(c)},P.prototype.createCollection=function(c){var b=this,A=new G(b,c);return b.bindCollection(A),b.collections.push(A),A},P.prototype.bindCollection=function(c){var b,A=this,o=function(c,o){b=c.type+" "+o.id+":"+c.type,A.trigger(b,o)};c.on("destroyed",A.onDestroyed.bind(A)),c.on("shown hidden rested dir plain",o),c.on("dir:up dir:right dir:down dir:left",o),c.on("plain:up plain:right plain:down plain:left",o)},P.prototype.bindDocument=function(){var c=this;c.binded||(c.bindEvt(document,"move").bindEvt(document,"end"),c.binded=!0)},P.prototype.unbindDocument=function(c){var b=this;Object.keys(b.ids).length&&!0!==c||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},P.prototype.getIdentifier=function(c){var b;return c?void 0===(b=void 0===c.identifier?c.pointerId:c.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},P.prototype.removeIdentifier=function(c){var b={};for(var A in this.ids)if(this.ids[A]===c){b.id=A,b.identifier=this.ids[A],delete this.ids[A];break}return b},P.prototype.onmove=function(c){return this.onAny("move",c),!1},P.prototype.onend=function(c){return this.onAny("end",c),!1},P.prototype.oncancel=function(c){return this.onAny("end",c),!1},P.prototype.onAny=function(c,b){var A,o=this,t="processOn"+c.charAt(0).toUpperCase()+c.slice(1);b=C(b);var n=function(c,b,A){A.ids.indexOf(b)>=0&&(A[t](c),c._found_=!0)};return E(b,(function(c){A=o.getIdentifier(c),E(o.collections,n.bind(null,c,A)),c._found_||o.removeIdentifier(A)})),!1},P.prototype.destroy=function(){var c=this;c.unbindDocument(!0),c.ids={},c.index=0,c.collections.forEach((function(c){c.destroy()})),c.off()},P.prototype.onDestroyed=function(c,b){var A=this;if(A.collections.indexOf(b)<0)return!1;A.collections.splice(A.collections.indexOf(b),1)};var O=new P;const p={create:function(c){return O.create(c)},factory:O};return b.default})(),c.exports=b()},12184:(c,b,A)=>{"use strict";const{Deflate:o,deflate:t,deflateRaw:n,gzip:h}=A(12193),{Inflate:s,inflate:L,inflateRaw:C,ungzip:J}=A(12249),X=A(12229);c.exports.Deflate=o,c.exports.deflate=t,c.exports.deflateRaw=n,c.exports.gzip=h,c.exports.Inflate=s,c.exports.inflate=L,c.exports.inflateRaw=C,c.exports.ungzip=J,c.exports.constants=X},12193:(c,b,A)=>{"use strict";const o=A(12196),t=A(12238),n=A(12241),h=A(12221),s=A(12244),L=Object.prototype.toString,{Z_NO_FLUSH:C,Z_SYNC_FLUSH:J,Z_FULL_FLUSH:X,Z_FINISH:R,Z_OK:N,Z_STREAM_END:k,Z_DEFAULT_COMPRESSION:E,Z_DEFAULT_STRATEGY:V,Z_DEFLATED:y}=A(12229);function j(c){this.options=t.assign({level:E,method:y,Ja:16384,windowBits:15,memLevel:8,strategy:V},c||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let A=o.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(A!==N)throw new Error(h[A]);if(b.header&&o.deflateSetHeader(this.strm,b.header),b.dictionary){let c;if(c="string"===typeof b.dictionary?n.string2buf(b.dictionary):"[object ArrayBuffer]"===L.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,A=o.deflateSetDictionary(this.strm,c),A!==N)throw new Error(h[A]);this._dict_set=!0}}function F(c,b){const A=new j(b);if(A.push(c,!0),A.err)throw A.msg||h[A.err];return A.result}j.prototype.push=function(c,b){const A=this.strm,t=this.options.Ja;let h,s;if(this.ended)return!1;for(s=b===~~b?b:!0===b?R:C,"string"===typeof c?A.input=n.string2buf(c):"[object ArrayBuffer]"===L.call(c)?A.input=new Uint8Array(c):A.input=c,A.next_in=0,A.avail_in=A.input.length;;)if(0===A.avail_out&&(A.output=new Uint8Array(t),A.next_out=0,A.avail_out=t),(s===J||s===X)&&A.avail_out<=6)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else{if(h=o.deflate(A,s),h===k)return A.next_out>0&&this.onData(A.output.subarray(0,A.next_out)),h=o.deflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===N;if(0!==A.avail_out){if(s>0&&A.next_out>0)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else if(0===A.avail_in)break}else this.onData(A.output)}return!0},j.prototype.onData=function(c){this.chunks.push(c)},j.prototype.onEnd=function(c){c===N&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},c.exports.Deflate=j,c.exports.deflate=F,c.exports.deflateRaw=function(c,b){return(b=b||{}).raw=!0,F(c,b)},c.exports.gzip=function(c,b){return(b=b||{}).gzip=!0,F(c,b)},c.exports.constants=A(12229)},12249:(c,b,A)=>{"use strict";const o=A(12255),t=A(12238),n=A(12241),h=A(12221),s=A(12244),L=A(12272),C=Object.prototype.toString,{Z_NO_FLUSH:J,Z_FINISH:X,Z_OK:R,Z_STREAM_END:N,Z_NEED_DICT:k,Z_STREAM_ERROR:E,Z_DATA_ERROR:V,Z_MEM_ERROR:y}=A(12229);function j(c){this.options=t.assign({Ja:65536,windowBits:15,to:""},c||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||c&&c.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let A=o.inflateInit2(this.strm,b.windowBits);if(A!==R)throw new Error(h[A]);if(this.header=new L,o.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=n.string2buf(b.dictionary):"[object ArrayBuffer]"===C.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(A=o.inflateSetDictionary(this.strm,b.dictionary),A!==R)))throw new Error(h[A])}function F(c,b){const A=new j(b);if(A.push(c),A.err)throw A.msg||h[A.err];return A.result}j.prototype.push=function(c,b){const A=this.strm,t=this.options.Ja,h=this.options.dictionary;let s,L,j;if(this.ended)return!1;for(L=b===~~b?b:!0===b?X:J,"[object ArrayBuffer]"===C.call(c)?A.input=new Uint8Array(c):A.input=c,A.next_in=0,A.avail_in=A.input.length;;){for(0===A.avail_out&&(A.output=new Uint8Array(t),A.next_out=0,A.avail_out=t),s=o.inflate(A,L),s===k&&h&&(s=o.inflateSetDictionary(A,h),s===R?s=o.inflate(A,L):s===V&&(s=k));A.avail_in>0&&s===N&&A.state.wrap>0&&0!==c[A.next_in];)o.inflateReset(A),s=o.inflate(A,L);switch(s){case E:case V:case k:case y:return this.onEnd(s),this.ended=!0,!1}if(j=A.avail_out,A.next_out&&(0===A.avail_out||s===N))if("string"===this.options.to){let c=n.utf8border(A.output,A.next_out),b=A.next_out-c,o=n.buf2string(A.output,c);A.next_out=b,A.avail_out=t-b,b&&A.output.set(A.output.subarray(c,c+b),0),this.onData(o)}else this.onData(A.output.length===A.next_out?A.output:A.output.subarray(0,A.next_out));if(s!==R||0!==j){if(s===N)return s=o.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===A.avail_in)break}}return!0},j.prototype.onData=function(c){this.chunks.push(c)},j.prototype.onEnd=function(c){c===R&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},c.exports.Inflate=j,c.exports.inflate=F,c.exports.inflateRaw=function(c,b){return(b=b||{}).raw=!0,F(c,b)},c.exports.ungzip=F,c.exports.constants=A(12229)},12238:c=>{"use strict";const b=(c,b)=>Object.prototype.hasOwnProperty.call(c,b);c.exports.assign=function(c){const A=Array.prototype.slice.call(arguments,1);for(;A.length;){const o=A.shift();if(o){if("object"!==typeof o)throw new TypeError(o+"must be non-object");for(const A in o)b(o,A)&&(c[A]=o[A])}}return c},c.exports.flattenChunks=c=>{let b=0;for(let o=0,t=c.length;o<t;o++)b+=c[o].length;const A=new Uint8Array(b);for(let o=0,t=0,n=c.length;o<n;o++){let b=c[o];A.set(b,t),t+=b.length}return A}},12241:c=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){b=!1}const A=new Uint8Array(256);for(let t=0;t<256;t++)A[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;A[254]=A[254]=1,c.exports.string2buf=c=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(c);let b,A,o,t,n,h=c.length,s=0;for(t=0;t<h;t++)A=c.charCodeAt(t),55296===(64512&A)&&t+1<h&&(o=c.charCodeAt(t+1),56320===(64512&o)&&(A=65536+(A-55296<<10)+(o-56320),t++)),s+=A<128?1:A<2048?2:A<65536?3:4;for(b=new Uint8Array(s),n=0,t=0;n<s;t++)A=c.charCodeAt(t),55296===(64512&A)&&t+1<h&&(o=c.charCodeAt(t+1),56320===(64512&o)&&(A=65536+(A-55296<<10)+(o-56320),t++)),A<128?b[n++]=A:A<2048?(b[n++]=192|A>>>6,b[n++]=128|63&A):A<65536?(b[n++]=224|A>>>12,b[n++]=128|A>>>6&63,b[n++]=128|63&A):(b[n++]=240|A>>>18,b[n++]=128|A>>>12&63,b[n++]=128|A>>>6&63,b[n++]=128|63&A);return b};c.exports.buf2string=(c,o)=>{const t=o||c.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(c.subarray(0,o));let n,h;const s=new Array(2*t);for(h=0,n=0;n<t;){let b=c[n++];if(b<128){s[h++]=b;continue}let o=A[b];if(o>4)s[h++]=65533,n+=o-1;else{for(b&=2===o?31:3===o?15:7;o>1&&n<t;)b=b<<6|63&c[n++],o--;o>1?s[h++]=65533:b<65536?s[h++]=b:(b-=65536,s[h++]=55296|b>>10&1023,s[h++]=56320|1023&b)}}return((c,A)=>{if(A<65534&&c.subarray&&b)return String.fromCharCode.apply(null,c.length===A?c:c.subarray(0,A));let o="";for(let b=0;b<A;b++)o+=String.fromCharCode(c[b]);return o})(s,h)},c.exports.utf8border=(c,b)=>{(b=b||c.length)>c.length&&(b=c.length);let o=b-1;for(;o>=0&&128===(192&c[o]);)o--;return o<0||0===o?b:o+A[c[o]]>b?o:b}},12206:c=>{"use strict";c.exports=(c,b,A,o)=>{let t=65535&c,n=c>>>16&65535,h=0;for(;0!==A;){h=A>2e3?2e3:A,A-=h;do{t=t+b[o++]|0,n=n+t|0}while(--h);t%=65521,n%=65521}return t|n<<16}},12229:c=>{"use strict";c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12212:c=>{"use strict";const b=new Uint32Array((()=>{let c,b=[];for(var A=0;A<256;A++){c=A;for(var o=0;o<8;o++)c=1&c?3988292384^c>>>1:c>>>1;b[A]=c}return b})());c.exports=(c,A,o,t)=>{const n=b,h=t+o;c^=-1;for(let b=t;b<h;b++)c=c>>>8^n[255&(c^A[b])];return~c}},12196:(c,b,A)=>{"use strict";const{_tr_init:o,_tr_stored_block:t,_tr_flush_block:n,_tr_tally:h,_tr_align:s}=A(12198),L=A(12206),C=A(12212),J=A(12221),{Z_NO_FLUSH:X,Z_PARTIAL_FLUSH:R,Z_FULL_FLUSH:N,Z_FINISH:k,Z_BLOCK:E,Z_OK:V,Z_STREAM_END:y,Z_STREAM_ERROR:j,Z_DATA_ERROR:F,Z_BUF_ERROR:M,Z_DEFAULT_COMPRESSION:W,Z_FILTERED:d,Z_HUFFMAN_ONLY:r,Z_RLE:z,Z_FIXED:Y,Z_DEFAULT_STRATEGY:D,Z_UNKNOWN:f,Z_DEFLATED:v}=A(12229),G=258,P=262,O=103,p=113,q=666,I=(c,b)=>(c.msg=J[b],b),K=c=>(c<<1)-(c>4?9:0),Z=c=>{let b=c.length;for(;--b>=0;)c[b]=0};let H=(c,b,A)=>(b<<c.hash_shift^A)&c.hash_mask;const S=c=>{const b=c.state;let A=b.pending;A>c.avail_out&&(A=c.avail_out),0!==A&&(c.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+A),c.next_out),c.next_out+=A,b.pending_out+=A,c.total_out+=A,c.avail_out-=A,b.pending-=A,0===b.pending&&(b.pending_out=0))},B=(c,b)=>{n(c,c.block_start>=0?c.block_start:-1,c.strstart-c.block_start,b),c.block_start=c.strstart,S(c.strm)},Q=(c,b)=>{c.pending_buf[c.pending++]=b},a=(c,b)=>{c.pending_buf[c.pending++]=b>>>8&255,c.pending_buf[c.pending++]=255&b},l=(c,b,A,o)=>{let t=c.avail_in;return t>o&&(t=o),0===t?0:(c.avail_in-=t,b.set(c.input.subarray(c.next_in,c.next_in+t),A),1===c.state.wrap?c.adler=L(c.adler,b,t,A):2===c.state.wrap&&(c.adler=C(c.adler,b,t,A)),c.next_in+=t,c.total_in+=t,t)},T=(c,b)=>{let A,o,t=c.max_chain_length,n=c.strstart,h=c.prev_length,s=c.nice_match;const L=c.strstart>c.w_size-P?c.strstart-(c.w_size-P):0,C=c.window,J=c.w_mask,X=c.prev,R=c.strstart+G;let N=C[n+h-1],k=C[n+h];c.prev_length>=c.good_match&&(t>>=2),s>c.lookahead&&(s=c.lookahead);do{if(A=b,C[A+h]===k&&C[A+h-1]===N&&C[A]===C[n]&&C[++A]===C[n+1]){n+=2,A++;do{}while(C[++n]===C[++A]&&C[++n]===C[++A]&&C[++n]===C[++A]&&C[++n]===C[++A]&&C[++n]===C[++A]&&C[++n]===C[++A]&&C[++n]===C[++A]&&C[++n]===C[++A]&&n<R);if(o=G-(R-n),n=R-G,o>h){if(c.match_start=b,h=o,o>=s)break;N=C[n+h-1],k=C[n+h]}}}while((b=X[b&J])>L&&0!==--t);return h<=c.lookahead?h:c.lookahead},i=c=>{const b=c.w_size;let A,o,t,n,h;do{if(n=c.window_size-c.lookahead-c.strstart,c.strstart>=b+(b-P)){c.window.set(c.window.subarray(b,b+b),0),c.match_start-=b,c.strstart-=b,c.block_start-=b,o=c.hash_size,A=o;do{t=c.head[--A],c.head[A]=t>=b?t-b:0}while(--o);o=b,A=o;do{t=c.prev[--A],c.prev[A]=t>=b?t-b:0}while(--o);n+=b}if(0===c.strm.avail_in)break;if(o=l(c.strm,c.window,c.strstart+c.lookahead,n),c.lookahead+=o,c.lookahead+c.insert>=3)for(h=c.strstart-c.insert,c.ins_h=c.window[h],c.ins_h=H(c,c.ins_h,c.window[h+1]);c.insert&&(c.ins_h=H(c,c.ins_h,c.window[h+3-1]),c.prev[h&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=h,h++,c.insert--,!(c.lookahead+c.insert<3)););}while(c.lookahead<P&&0!==c.strm.avail_in)},g=(c,b)=>{let A,o;for(;;){if(c.lookahead<P){if(i(c),c.lookahead<P&&b===X)return 1;if(0===c.lookahead)break}if(A=0,c.lookahead>=3&&(c.ins_h=H(c,c.ins_h,c.window[c.strstart+3-1]),A=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),0!==A&&c.strstart-A<=c.w_size-P&&(c.match_length=T(c,A)),c.match_length>=3)if(o=h(c,c.strstart-c.match_start,c.match_length-3),c.lookahead-=c.match_length,c.match_length<=c.max_lazy_match&&c.lookahead>=3){c.match_length--;do{c.strstart++,c.ins_h=H(c,c.ins_h,c.window[c.strstart+3-1]),A=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart}while(0!==--c.match_length);c.strstart++}else c.strstart+=c.match_length,c.match_length=0,c.ins_h=c.window[c.strstart],c.ins_h=H(c,c.ins_h,c.window[c.strstart+1]);else o=h(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++;if(o&&(B(c,!1),0===c.strm.avail_out))return 1}return c.insert=c.strstart<2?c.strstart:2,b===k?(B(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(B(c,!1),0===c.strm.avail_out)?1:2},u=(c,b)=>{let A,o,t;for(;;){if(c.lookahead<P){if(i(c),c.lookahead<P&&b===X)return 1;if(0===c.lookahead)break}if(A=0,c.lookahead>=3&&(c.ins_h=H(c,c.ins_h,c.window[c.strstart+3-1]),A=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),c.prev_length=c.match_length,c.prev_match=c.match_start,c.match_length=2,0!==A&&c.prev_length<c.max_lazy_match&&c.strstart-A<=c.w_size-P&&(c.match_length=T(c,A),c.match_length<=5&&(c.strategy===d||3===c.match_length&&c.strstart-c.match_start>4096)&&(c.match_length=2)),c.prev_length>=3&&c.match_length<=c.prev_length){t=c.strstart+c.lookahead-3,o=h(c,c.strstart-1-c.prev_match,c.prev_length-3),c.lookahead-=c.prev_length-1,c.prev_length-=2;do{++c.strstart<=t&&(c.ins_h=H(c,c.ins_h,c.window[c.strstart+3-1]),A=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart)}while(0!==--c.prev_length);if(c.match_available=0,c.match_length=2,c.strstart++,o&&(B(c,!1),0===c.strm.avail_out))return 1}else if(c.match_available){if(o=h(c,0,c.window[c.strstart-1]),o&&B(c,!1),c.strstart++,c.lookahead--,0===c.strm.avail_out)return 1}else c.match_available=1,c.strstart++,c.lookahead--}return c.match_available&&(o=h(c,0,c.window[c.strstart-1]),c.match_available=0),c.insert=c.strstart<2?c.strstart:2,b===k?(B(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(B(c,!1),0===c.strm.avail_out)?1:2};function e(c,b,A,o,t){this.good_length=c,this.max_lazy=b,this.nice_length=A,this.max_chain=o,this.func=t}const x=[new e(0,0,0,0,((c,b)=>{let A=65535;for(A>c.pending_buf_size-5&&(A=c.pending_buf_size-5);;){if(c.lookahead<=1){if(i(c),0===c.lookahead&&b===X)return 1;if(0===c.lookahead)break}c.strstart+=c.lookahead,c.lookahead=0;const o=c.block_start+A;if((0===c.strstart||c.strstart>=o)&&(c.lookahead=c.strstart-o,c.strstart=o,B(c,!1),0===c.strm.avail_out))return 1;if(c.strstart-c.block_start>=c.w_size-P&&(B(c,!1),0===c.strm.avail_out))return 1}return c.insert=0,b===k?(B(c,!0),0===c.strm.avail_out?3:4):(c.strstart>c.block_start&&(B(c,!1),c.strm.avail_out),1)})),new e(4,4,8,4,g),new e(4,5,16,8,g),new e(4,6,32,32,g),new e(4,4,16,16,u),new e(8,16,32,32,u),new e(8,16,128,128,u),new e(8,32,128,256,u),new e(32,128,258,1024,u),new e(32,258,258,4096,u)];function U(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const w=c=>{if(!c||!c.state)return I(c,j);c.total_in=c.total_out=0,c.data_type=f;const b=c.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:p,c.adler=2===b.wrap?0:1,b.last_flush=X,o(b),V},m=c=>{const b=w(c);var A;return b===V&&((A=c.state).window_size=2*A.w_size,Z(A.head),A.max_lazy_match=x[A.level].max_lazy,A.good_match=x[A.level].good_length,A.nice_match=x[A.level].nice_length,A.max_chain_length=x[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=2,A.match_available=0,A.ins_h=0),b},cc=(c,b,A,o,t,n)=>{if(!c)return j;let h=1;if(b===W&&(b=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),t<1||t>9||A!==v||o<8||o>15||b<0||b>9||n<0||n>Y)return I(c,j);8===o&&(o=9);const s=new U;return c.state=s,s.strm=c,s.wrap=h,s.gzhead=null,s.w_bits=o,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=t+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<t+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=b,s.strategy=n,s.method=A,m(c)};c.exports.deflateInit=(c,b)=>cc(c,b,v,15,8,D),c.exports.deflateInit2=cc,c.exports.deflateReset=m,c.exports.deflateResetKeep=w,c.exports.deflateSetHeader=(c,b)=>c&&c.state?2!==c.state.wrap?j:(c.state.gzhead=b,V):j,c.exports.deflate=(c,b)=>{let A,o;if(!c||!c.state||b>E||b<0)return c?I(c,j):j;const n=c.state;if(!c.output||!c.input&&0!==c.avail_in||n.status===q&&b!==k)return I(c,0===c.avail_out?M:j);n.strm=c;const L=n.last_flush;if(n.last_flush=b,42===n.status)if(2===n.wrap)c.adler=0,Q(n,31),Q(n,139),Q(n,8),n.gzhead?(Q(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Q(n,255&n.gzhead.time),Q(n,n.gzhead.time>>8&255),Q(n,n.gzhead.time>>16&255),Q(n,n.gzhead.time>>24&255),Q(n,9===n.level?2:n.strategy>=r||n.level<2?4:0),Q(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Q(n,255&n.gzhead.extra.length),Q(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(c.adler=C(c.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(Q(n,0),Q(n,0),Q(n,0),Q(n,0),Q(n,0),Q(n,9===n.level?2:n.strategy>=r||n.level<2?4:0),Q(n,3),n.status=p);else{let b=v+(n.w_bits-8<<4)<<8,A=-1;A=n.strategy>=r||n.level<2?0:n.level<6?1:6===n.level?2:3,b|=A<<6,0!==n.strstart&&(b|=32),b+=31-b%31,n.status=p,a(n,b),0!==n.strstart&&(a(n,c.adler>>>16),a(n,65535&c.adler)),c.adler=1}if(69===n.status)if(n.gzhead.extra){for(A=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>A&&(c.adler=C(c.adler,n.pending_buf,n.pending-A,A)),S(c),A=n.pending,n.pending!==n.pending_buf_size));)Q(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>A&&(c.adler=C(c.adler,n.pending_buf,n.pending-A,A)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){A=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>A&&(c.adler=C(c.adler,n.pending_buf,n.pending-A,A)),S(c),A=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Q(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>A&&(c.adler=C(c.adler,n.pending_buf,n.pending-A,A)),0===o&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){A=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>A&&(c.adler=C(c.adler,n.pending_buf,n.pending-A,A)),S(c),A=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Q(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>A&&(c.adler=C(c.adler,n.pending_buf,n.pending-A,A)),0===o&&(n.status=O)}else n.status=O;if(n.status===O&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&S(c),n.pending+2<=n.pending_buf_size&&(Q(n,255&c.adler),Q(n,c.adler>>8&255),c.adler=0,n.status=p)):n.status=p),0!==n.pending){if(S(c),0===c.avail_out)return n.last_flush=-1,V}else if(0===c.avail_in&&K(b)<=K(L)&&b!==k)return I(c,M);if(n.status===q&&0!==c.avail_in)return I(c,M);if(0!==c.avail_in||0!==n.lookahead||b!==X&&n.status!==q){let A=n.strategy===r?((c,b)=>{let A;for(;;){if(0===c.lookahead&&(i(c),0===c.lookahead)){if(b===X)return 1;break}if(c.match_length=0,A=h(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,A&&(B(c,!1),0===c.strm.avail_out))return 1}return c.insert=0,b===k?(B(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(B(c,!1),0===c.strm.avail_out)?1:2})(n,b):n.strategy===z?((c,b)=>{let A,o,t,n;const s=c.window;for(;;){if(c.lookahead<=G){if(i(c),c.lookahead<=G&&b===X)return 1;if(0===c.lookahead)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(t=c.strstart-1,o=s[t],o===s[++t]&&o===s[++t]&&o===s[++t])){n=c.strstart+G;do{}while(o===s[++t]&&o===s[++t]&&o===s[++t]&&o===s[++t]&&o===s[++t]&&o===s[++t]&&o===s[++t]&&o===s[++t]&&t<n);c.match_length=G-(n-t),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(A=h(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(A=h(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),A&&(B(c,!1),0===c.strm.avail_out))return 1}return c.insert=0,b===k?(B(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(B(c,!1),0===c.strm.avail_out)?1:2})(n,b):x[n.level].func(n,b);if(3!==A&&4!==A||(n.status=q),1===A||3===A)return 0===c.avail_out&&(n.last_flush=-1),V;if(2===A&&(b===R?s(n):b!==E&&(t(n,0,0,!1),b===N&&(Z(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),S(c),0===c.avail_out))return n.last_flush=-1,V}return b!==k?V:n.wrap<=0?y:(2===n.wrap?(Q(n,255&c.adler),Q(n,c.adler>>8&255),Q(n,c.adler>>16&255),Q(n,c.adler>>24&255),Q(n,255&c.total_in),Q(n,c.total_in>>8&255),Q(n,c.total_in>>16&255),Q(n,c.total_in>>24&255)):(a(n,c.adler>>>16),a(n,65535&c.adler)),S(c),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?V:y)},c.exports.deflateEnd=c=>{if(!c||!c.state)return j;const b=c.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==O&&b!==p&&b!==q?I(c,j):(c.state=null,b===p?I(c,F):V)},c.exports.deflateSetDictionary=(c,b)=>{let A=b.length;if(!c||!c.state)return j;const o=c.state,t=o.wrap;if(2===t||1===t&&42!==o.status||o.lookahead)return j;if(1===t&&(c.adler=L(c.adler,b,A,0)),o.wrap=0,A>=o.w_size){0===t&&(Z(o.head),o.strstart=0,o.block_start=0,o.insert=0);let c=new Uint8Array(o.w_size);c.set(b.subarray(A-o.w_size,A),0),b=c,A=o.w_size}const n=c.avail_in,h=c.next_in,s=c.input;for(c.avail_in=A,c.next_in=0,c.input=b,i(o);o.lookahead>=3;){let c=o.strstart,b=o.lookahead-2;do{o.ins_h=H(o,o.ins_h,o.window[c+3-1]),o.prev[c&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=c,c++}while(--b);o.strstart=c,o.lookahead=2,i(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,c.next_in=h,c.input=s,c.avail_in=n,o.wrap=t,V},c.exports.deflateInfo="pako deflate (from Nodeca project)"},12272:c=>{"use strict";c.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12259:c=>{"use strict";c.exports=function(c,b){let A,o,t,n,h,s,L,C,J,X,R,N,k,E,V,y,j,F,M,W,d,r,z,Y;const D=c.state;A=c.next_in,z=c.input,o=A+(c.avail_in-5),t=c.next_out,Y=c.output,n=t-(b-c.avail_out),h=t+(c.avail_out-257),s=D.dmax,L=D.wsize,C=D.whave,J=D.wnext,X=D.window,R=D.hold,N=D.bits,k=D.lencode,E=D.distcode,V=(1<<D.lenbits)-1,y=(1<<D.distbits)-1;c:do{N<15&&(R+=z[A++]<<N,N+=8,R+=z[A++]<<N,N+=8),j=k[R&V];b:for(;;){if(F=j>>>24,R>>>=F,N-=F,F=j>>>16&255,0===F)Y[t++]=65535&j;else{if(!(16&F)){if(0===(64&F)){j=k[(65535&j)+(R&(1<<F)-1)];continue b}if(32&F){D.mode=12;break c}c.msg="invalid literal/length code",D.mode=30;break c}M=65535&j,F&=15,F&&(N<F&&(R+=z[A++]<<N,N+=8),M+=R&(1<<F)-1,R>>>=F,N-=F),N<15&&(R+=z[A++]<<N,N+=8,R+=z[A++]<<N,N+=8),j=E[R&y];A:for(;;){if(F=j>>>24,R>>>=F,N-=F,F=j>>>16&255,!(16&F)){if(0===(64&F)){j=E[(65535&j)+(R&(1<<F)-1)];continue A}c.msg="invalid distance code",D.mode=30;break c}if(W=65535&j,F&=15,N<F&&(R+=z[A++]<<N,N+=8,N<F&&(R+=z[A++]<<N,N+=8)),W+=R&(1<<F)-1,W>s){c.msg="invalid distance too far back",D.mode=30;break c}if(R>>>=F,N-=F,F=t-n,W>F){if(F=W-F,F>C&&D.sane){c.msg="invalid distance too far back",D.mode=30;break c}if(d=0,r=X,0===J){if(d+=L-F,F<M){M-=F;do{Y[t++]=X[d++]}while(--F);d=t-W,r=Y}}else if(J<F){if(d+=L+J-F,F-=J,F<M){M-=F;do{Y[t++]=X[d++]}while(--F);if(d=0,J<M){F=J,M-=F;do{Y[t++]=X[d++]}while(--F);d=t-W,r=Y}}}else if(d+=J-F,F<M){M-=F;do{Y[t++]=X[d++]}while(--F);d=t-W,r=Y}for(;M>2;)Y[t++]=r[d++],Y[t++]=r[d++],Y[t++]=r[d++],M-=3;M&&(Y[t++]=r[d++],M>1&&(Y[t++]=r[d++]))}else{d=t-W;do{Y[t++]=Y[d++],Y[t++]=Y[d++],Y[t++]=Y[d++],M-=3}while(M>2);M&&(Y[t++]=Y[d++],M>1&&(Y[t++]=Y[d++]))}break}}break}}while(A<o&&t<h);M=N>>3,A-=M,N-=M<<3,R&=(1<<N)-1,c.next_in=A,c.next_out=t,c.avail_in=A<o?o-A+5:5-(A-o),c.avail_out=t<h?h-t+257:257-(t-h),D.hold=R,D.bits=N}},12255:(c,b,A)=>{"use strict";const o=A(12206),t=A(12212),n=A(12259),h=A(12267),{Z_FINISH:s,Z_BLOCK:L,Z_TREES:C,Z_OK:J,Z_STREAM_END:X,Z_NEED_DICT:R,Z_STREAM_ERROR:N,Z_DATA_ERROR:k,Z_MEM_ERROR:E,Z_BUF_ERROR:V,Z_DEFLATED:y}=A(12229),j=12,F=30,M=c=>(c>>>24&255)+(c>>>8&65280)+((65280&c)<<8)+((255&c)<<24);function W(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const d=c=>{if(!c||!c.state)return N;const b=c.state;return c.total_in=c.total_out=b.total=0,c.msg="",b.wrap&&(c.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,J},r=c=>{if(!c||!c.state)return N;const b=c.state;return b.wsize=0,b.whave=0,b.wnext=0,d(c)},z=(c,b)=>{let A;if(!c||!c.state)return N;const o=c.state;return b<0?(A=0,b=-b):(A=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?N:(null!==o.window&&o.wbits!==b&&(o.window=null),o.wrap=A,o.wbits=b,r(c))},Y=(c,b)=>{if(!c)return N;const A=new W;c.state=A,A.window=null;const o=z(c,b);return o!==J&&(c.state=null),o};let D,f,v=!0;const G=c=>{if(v){D=new Int32Array(512),f=new Int32Array(32);let b=0;for(;b<144;)c.lens[b++]=8;for(;b<256;)c.lens[b++]=9;for(;b<280;)c.lens[b++]=7;for(;b<288;)c.lens[b++]=8;for(h(1,c.lens,0,288,D,0,c.work,{bits:9}),b=0;b<32;)c.lens[b++]=5;h(2,c.lens,0,32,f,0,c.work,{bits:5}),v=!1}c.lencode=D,c.lenbits=9,c.distcode=f,c.distbits=5},P=(c,b,A,o)=>{let t;const n=c.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),o>=n.wsize?(n.window.set(b.subarray(A-n.wsize,A),0),n.wnext=0,n.whave=n.wsize):(t=n.wsize-n.wnext,t>o&&(t=o),n.window.set(b.subarray(A-o,A-o+t),n.wnext),(o-=t)?(n.window.set(b.subarray(A-o,A),0),n.wnext=o,n.whave=n.wsize):(n.wnext+=t,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=t))),0};c.exports.inflateReset=r,c.exports.inflateReset2=z,c.exports.inflateResetKeep=d,c.exports.inflateInit=c=>Y(c,15),c.exports.inflateInit2=Y,c.exports.inflate=(c,b)=>{let A,W,d,r,z,Y,D,f,v,O,p,q,I,K,Z,H,S,B,Q,a,l,T,i=0;const g=new Uint8Array(4);let u,e;const x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!c||!c.state||!c.output||!c.input&&0!==c.avail_in)return N;A=c.state,A.mode===j&&(A.mode=13),z=c.next_out,d=c.output,D=c.avail_out,r=c.next_in,W=c.input,Y=c.avail_in,f=A.hold,v=A.bits,O=Y,p=D,T=J;c:for(;;)switch(A.mode){case 1:if(0===A.wrap){A.mode=13;break}for(;v<16;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(2&A.wrap&&35615===f){A.check=0,g[0]=255&f,g[1]=f>>>8&255,A.check=t(A.check,g,2,0),f=0,v=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&f)<<8)+(f>>8))%31){c.msg="incorrect header check",A.mode=F;break}if((15&f)!==y){c.msg="unknown compression method",A.mode=F;break}if(f>>>=4,v-=4,l=8+(15&f),0===A.wbits)A.wbits=l;else if(l>A.wbits){c.msg="invalid window size",A.mode=F;break}A.dmax=1<<A.wbits,c.adler=A.check=1,A.mode=512&f?10:j,f=0,v=0;break;case 2:for(;v<16;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(A.flags=f,(255&A.flags)!==y){c.msg="unknown compression method",A.mode=F;break}if(57344&A.flags){c.msg="unknown header flags set",A.mode=F;break}A.head&&(A.head.text=f>>8&1),512&A.flags&&(g[0]=255&f,g[1]=f>>>8&255,A.check=t(A.check,g,2,0)),f=0,v=0,A.mode=3;case 3:for(;v<32;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}A.head&&(A.head.time=f),512&A.flags&&(g[0]=255&f,g[1]=f>>>8&255,g[2]=f>>>16&255,g[3]=f>>>24&255,A.check=t(A.check,g,4,0)),f=0,v=0,A.mode=4;case 4:for(;v<16;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}A.head&&(A.head.xflags=255&f,A.head.os=f>>8),512&A.flags&&(g[0]=255&f,g[1]=f>>>8&255,A.check=t(A.check,g,2,0)),f=0,v=0,A.mode=5;case 5:if(1024&A.flags){for(;v<16;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}A.length=f,A.head&&(A.head.extra_len=f),512&A.flags&&(g[0]=255&f,g[1]=f>>>8&255,A.check=t(A.check,g,2,0)),f=0,v=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(q=A.length,q>Y&&(q=Y),q&&(A.head&&(l=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Uint8Array(A.head.extra_len)),A.head.extra.set(W.subarray(r,r+q),l)),512&A.flags&&(A.check=t(A.check,W,q,r)),Y-=q,r+=q,A.length-=q),A.length))break c;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(0===Y)break c;q=0;do{l=W[r+q++],A.head&&l&&A.length<65536&&(A.head.name+=String.fromCharCode(l))}while(l&&q<Y);if(512&A.flags&&(A.check=t(A.check,W,q,r)),Y-=q,r+=q,l)break c}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(0===Y)break c;q=0;do{l=W[r+q++],A.head&&l&&A.length<65536&&(A.head.comment+=String.fromCharCode(l))}while(l&&q<Y);if(512&A.flags&&(A.check=t(A.check,W,q,r)),Y-=q,r+=q,l)break c}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;v<16;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(f!==(65535&A.check)){c.msg="header crc mismatch",A.mode=F;break}f=0,v=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),c.adler=A.check=0,A.mode=j;break;case 10:for(;v<32;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}c.adler=A.check=M(f),f=0,v=0,A.mode=11;case 11:if(0===A.havedict)return c.next_out=z,c.avail_out=D,c.next_in=r,c.avail_in=Y,A.hold=f,A.bits=v,R;c.adler=A.check=1,A.mode=j;case j:if(b===L||b===C)break c;case 13:if(A.last){f>>>=7&v,v-=7&v,A.mode=27;break}for(;v<3;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}switch(A.last=1&f,f>>>=1,v-=1,3&f){case 0:A.mode=14;break;case 1:if(G(A),A.mode=20,b===C){f>>>=2,v-=2;break c}break;case 2:A.mode=17;break;case 3:c.msg="invalid block type",A.mode=F}f>>>=2,v-=2;break;case 14:for(f>>>=7&v,v-=7&v;v<32;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if((65535&f)!==(f>>>16^65535)){c.msg="invalid stored block lengths",A.mode=F;break}if(A.length=65535&f,f=0,v=0,A.mode=15,b===C)break c;case 15:A.mode=16;case 16:if(q=A.length,q){if(q>Y&&(q=Y),q>D&&(q=D),0===q)break c;d.set(W.subarray(r,r+q),z),Y-=q,r+=q,D-=q,z+=q,A.length-=q;break}A.mode=j;break;case 17:for(;v<14;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(A.nlen=257+(31&f),f>>>=5,v-=5,A.ndist=1+(31&f),f>>>=5,v-=5,A.ncode=4+(15&f),f>>>=4,v-=4,A.nlen>286||A.ndist>30){c.msg="too many length or distance symbols",A.mode=F;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;v<3;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}A.lens[x[A.have++]]=7&f,f>>>=3,v-=3}for(;A.have<19;)A.lens[x[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,u={bits:A.lenbits},T=h(0,A.lens,0,19,A.lencode,0,A.work,u),A.lenbits=u.bits,T){c.msg="invalid code lengths set",A.mode=F;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;i=A.lencode[f&(1<<A.lenbits)-1],Z=i>>>24,H=i>>>16&255,S=65535&i,!(Z<=v);){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(S<16)f>>>=Z,v-=Z,A.lens[A.have++]=S;else{if(16===S){for(e=Z+2;v<e;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(f>>>=Z,v-=Z,0===A.have){c.msg="invalid bit length repeat",A.mode=F;break}l=A.lens[A.have-1],q=3+(3&f),f>>>=2,v-=2}else if(17===S){for(e=Z+3;v<e;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}f>>>=Z,v-=Z,l=0,q=3+(7&f),f>>>=3,v-=3}else{for(e=Z+7;v<e;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}f>>>=Z,v-=Z,l=0,q=11+(127&f),f>>>=7,v-=7}if(A.have+q>A.nlen+A.ndist){c.msg="invalid bit length repeat",A.mode=F;break}for(;q--;)A.lens[A.have++]=l}}if(A.mode===F)break;if(0===A.lens[256]){c.msg="invalid code -- missing end-of-block",A.mode=F;break}if(A.lenbits=9,u={bits:A.lenbits},T=h(1,A.lens,0,A.nlen,A.lencode,0,A.work,u),A.lenbits=u.bits,T){c.msg="invalid literal/lengths set",A.mode=F;break}if(A.distbits=6,A.distcode=A.distdyn,u={bits:A.distbits},T=h(2,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,u),A.distbits=u.bits,T){c.msg="invalid distances set",A.mode=F;break}if(A.mode=20,b===C)break c;case 20:A.mode=21;case 21:if(Y>=6&&D>=258){c.next_out=z,c.avail_out=D,c.next_in=r,c.avail_in=Y,A.hold=f,A.bits=v,n(c,p),z=c.next_out,d=c.output,D=c.avail_out,r=c.next_in,W=c.input,Y=c.avail_in,f=A.hold,v=A.bits,A.mode===j&&(A.back=-1);break}for(A.back=0;i=A.lencode[f&(1<<A.lenbits)-1],Z=i>>>24,H=i>>>16&255,S=65535&i,!(Z<=v);){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(H&&0===(240&H)){for(B=Z,Q=H,a=S;i=A.lencode[a+((f&(1<<B+Q)-1)>>B)],Z=i>>>24,H=i>>>16&255,S=65535&i,!(B+Z<=v);){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}f>>>=B,v-=B,A.back+=B}if(f>>>=Z,v-=Z,A.back+=Z,A.length=S,0===H){A.mode=26;break}if(32&H){A.back=-1,A.mode=j;break}if(64&H){c.msg="invalid literal/length code",A.mode=F;break}A.extra=15&H,A.mode=22;case 22:if(A.extra){for(e=A.extra;v<e;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}A.length+=f&(1<<A.extra)-1,f>>>=A.extra,v-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;i=A.distcode[f&(1<<A.distbits)-1],Z=i>>>24,H=i>>>16&255,S=65535&i,!(Z<=v);){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(0===(240&H)){for(B=Z,Q=H,a=S;i=A.distcode[a+((f&(1<<B+Q)-1)>>B)],Z=i>>>24,H=i>>>16&255,S=65535&i,!(B+Z<=v);){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}f>>>=B,v-=B,A.back+=B}if(f>>>=Z,v-=Z,A.back+=Z,64&H){c.msg="invalid distance code",A.mode=F;break}A.offset=S,A.extra=15&H,A.mode=24;case 24:if(A.extra){for(e=A.extra;v<e;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}A.offset+=f&(1<<A.extra)-1,f>>>=A.extra,v-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){c.msg="invalid distance too far back",A.mode=F;break}A.mode=25;case 25:if(0===D)break c;if(q=p-D,A.offset>q){if(q=A.offset-q,q>A.whave&&A.sane){c.msg="invalid distance too far back",A.mode=F;break}q>A.wnext?(q-=A.wnext,I=A.wsize-q):I=A.wnext-q,q>A.length&&(q=A.length),K=A.window}else K=d,I=z-A.offset,q=A.length;q>D&&(q=D),D-=q,A.length-=q;do{d[z++]=K[I++]}while(--q);0===A.length&&(A.mode=21);break;case 26:if(0===D)break c;d[z++]=A.length,D--,A.mode=21;break;case 27:if(A.wrap){for(;v<32;){if(0===Y)break c;Y--,f|=W[r++]<<v,v+=8}if(p-=D,c.total_out+=p,A.total+=p,p&&(c.adler=A.check=A.flags?t(A.check,d,p,z-p):o(A.check,d,p,z-p)),p=D,(A.flags?f:M(f))!==A.check){c.msg="incorrect data check",A.mode=F;break}f=0,v=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;v<32;){if(0===Y)break c;Y--,f+=W[r++]<<v,v+=8}if(f!==(4294967295&A.total)){c.msg="incorrect length check",A.mode=F;break}f=0,v=0}A.mode=29;case 29:T=X;break c;case F:T=k;break c;case 31:return E;default:return N}return c.next_out=z,c.avail_out=D,c.next_in=r,c.avail_in=Y,A.hold=f,A.bits=v,(A.wsize||p!==c.avail_out&&A.mode<F&&(A.mode<27||b!==s))&&P(c,c.output,c.next_out,p-c.avail_out)?(A.mode=31,E):(O-=c.avail_in,p-=c.avail_out,c.total_in+=O,c.total_out+=p,A.total+=p,A.wrap&&p&&(c.adler=A.check=A.flags?t(A.check,d,p,c.next_out-p):o(A.check,d,p,c.next_out-p)),c.data_type=A.bits+(A.last?64:0)+(A.mode===j?128:0)+(20===A.mode||15===A.mode?256:0),(0===O&&0===p||b===s)&&T===J&&(T=V),T)},c.exports.inflateEnd=c=>{if(!c||!c.state)return N;let b=c.state;return b.window&&(b.window=null),c.state=null,J},c.exports.inflateGetHeader=(c,b)=>{if(!c||!c.state)return N;const A=c.state;return 0===(2&A.wrap)?N:(A.head=b,b.done=!1,J)},c.exports.inflateSetDictionary=(c,b)=>{const A=b.length;let t,n,h;return c&&c.state?(t=c.state,0!==t.wrap&&11!==t.mode?N:11===t.mode&&(n=1,n=o(n,b,A,0),n!==t.check)?k:(h=P(c,b,A,A),h?(t.mode=31,E):(t.havedict=1,J))):N},c.exports.inflateInfo="pako inflate (from Nodeca project)"},12267:c=>{"use strict";const b=15,A=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),o=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);c.exports=(c,h,s,L,C,J,X,R)=>{const N=R.bits;let k,E,V,y,j,F,M=0,W=0,d=0,r=0,z=0,Y=0,D=0,f=0,v=0,G=0,P=null,O=0;const p=new Uint16Array(16),q=new Uint16Array(16);let I,K,Z,H=null,S=0;for(M=0;M<=b;M++)p[M]=0;for(W=0;W<L;W++)p[h[s+W]]++;for(z=N,r=b;r>=1&&0===p[r];r--);if(z>r&&(z=r),0===r)return C[J++]=20971520,C[J++]=20971520,R.bits=1,0;for(d=1;d<r&&0===p[d];d++);for(z<d&&(z=d),f=1,M=1;M<=b;M++)if(f<<=1,f-=p[M],f<0)return-1;if(f>0&&(0===c||1!==r))return-1;for(q[1]=0,M=1;M<b;M++)q[M+1]=q[M]+p[M];for(W=0;W<L;W++)0!==h[s+W]&&(X[q[h[s+W]]++]=W);if(0===c?(P=H=X,F=19):1===c?(P=A,O-=257,H=o,S-=257,F=256):(P=t,H=n,F=-1),G=0,W=0,M=d,j=J,Y=z,D=0,V=-1,v=1<<z,y=v-1,1===c&&v>852||2===c&&v>592)return 1;for(;;){I=M-D,X[W]<F?(K=0,Z=X[W]):X[W]>F?(K=H[S+X[W]],Z=P[O+X[W]]):(K=96,Z=0),k=1<<M-D,E=1<<Y,d=E;do{E-=k,C[j+(G>>D)+E]=I<<24|K<<16|Z}while(0!==E);for(k=1<<M-1;G&k;)k>>=1;if(0!==k?(G&=k-1,G+=k):G=0,W++,0===--p[M]){if(M===r)break;M=h[s+X[W]]}if(M>z&&(G&y)!==V){for(0===D&&(D=z),j+=d,Y=M-D,f=1<<Y;Y+D<r&&(f-=p[Y+D],!(f<=0));)Y++,f<<=1;if(v+=1<<Y,1===c&&v>852||2===c&&v>592)return 1;V=G&y,C[V]=z<<24|Y<<16|j-J}}return 0!==G&&(C[j+G]=M-D<<24|64<<16),R.bits=z,0}},12221:c=>{"use strict";c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12198:c=>{"use strict";function b(c){let b=c.length;for(;--b>=0;)c[b]=0}const A=256,o=286,t=30,n=15,h=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),s=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),L=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),J=new Array(576);b(J);const X=new Array(60);b(X);const R=new Array(512);b(R);const N=new Array(256);b(N);const k=new Array(29);b(k);const E=new Array(t);function V(c,b,A,o,t){this.static_tree=c,this.extra_bits=b,this.extra_base=A,this.elems=o,this.max_length=t,this.has_stree=c&&c.length}let y,j,F;function M(c,b){this.dyn_tree=c,this.max_code=0,this.stat_desc=b}b(E);const W=c=>c<256?R[c]:R[256+(c>>>7)],d=(c,b)=>{c.pending_buf[c.pending++]=255&b,c.pending_buf[c.pending++]=b>>>8&255},r=(c,b,A)=>{c.bi_valid>16-A?(c.bi_buf|=b<<c.bi_valid&65535,d(c,c.bi_buf),c.bi_buf=b>>16-c.bi_valid,c.bi_valid+=A-16):(c.bi_buf|=b<<c.bi_valid&65535,c.bi_valid+=A)},z=(c,b,A)=>{r(c,A[2*b],A[2*b+1])},Y=(c,b)=>{let A=0;do{A|=1&c,c>>>=1,A<<=1}while(--b>0);return A>>>1},D=(c,b,A)=>{const o=new Array(16);let t,h,s=0;for(t=1;t<=n;t++)o[t]=s=s+A[t-1]<<1;for(h=0;h<=b;h++){let b=c[2*h+1];0!==b&&(c[2*h]=Y(o[b]++,b))}},f=c=>{let b;for(b=0;b<o;b++)c.dyn_ltree[2*b]=0;for(b=0;b<t;b++)c.dyn_dtree[2*b]=0;for(b=0;b<19;b++)c.bl_tree[2*b]=0;c.dyn_ltree[512]=1,c.opt_len=c.static_len=0,c.last_lit=c.matches=0},v=c=>{c.bi_valid>8?d(c,c.bi_buf):c.bi_valid>0&&(c.pending_buf[c.pending++]=c.bi_buf),c.bi_buf=0,c.bi_valid=0},G=(c,b,A,o)=>{const t=2*b,n=2*A;return c[t]<c[n]||c[t]===c[n]&&o[b]<=o[A]},P=(c,b,A)=>{const o=c.heap[A];let t=A<<1;for(;t<=c.heap_len&&(t<c.heap_len&&G(b,c.heap[t+1],c.heap[t],c.depth)&&t++,!G(b,o,c.heap[t],c.depth));)c.heap[A]=c.heap[t],A=t,t<<=1;c.heap[A]=o},O=(c,b,o)=>{let t,n,L,C,J=0;if(0!==c.last_lit)do{t=c.pending_buf[c.d_buf+2*J]<<8|c.pending_buf[c.d_buf+2*J+1],n=c.pending_buf[c.l_buf+J],J++,0===t?z(c,n,b):(L=N[n],z(c,L+A+1,b),C=h[L],0!==C&&(n-=k[L],r(c,n,C)),t--,L=W(t),z(c,L,o),C=s[L],0!==C&&(t-=E[L],r(c,t,C)))}while(J<c.last_lit);z(c,256,b)},p=(c,b)=>{const A=b.dyn_tree,o=b.stat_desc.static_tree,t=b.stat_desc.has_stree,h=b.stat_desc.elems;let s,L,C,J=-1;for(c.heap_len=0,c.heap_max=573,s=0;s<h;s++)0!==A[2*s]?(c.heap[++c.heap_len]=J=s,c.depth[s]=0):A[2*s+1]=0;for(;c.heap_len<2;)C=c.heap[++c.heap_len]=J<2?++J:0,A[2*C]=1,c.depth[C]=0,c.opt_len--,t&&(c.static_len-=o[2*C+1]);for(b.max_code=J,s=c.heap_len>>1;s>=1;s--)P(c,A,s);C=h;do{s=c.heap[1],c.heap[1]=c.heap[c.heap_len--],P(c,A,1),L=c.heap[1],c.heap[--c.heap_max]=s,c.heap[--c.heap_max]=L,A[2*C]=A[2*s]+A[2*L],c.depth[C]=(c.depth[s]>=c.depth[L]?c.depth[s]:c.depth[L])+1,A[2*s+1]=A[2*L+1]=C,c.heap[1]=C++,P(c,A,1)}while(c.heap_len>=2);c.heap[--c.heap_max]=c.heap[1],((c,b)=>{const A=b.dyn_tree,o=b.max_code,t=b.stat_desc.static_tree,h=b.stat_desc.has_stree,s=b.stat_desc.extra_bits,L=b.stat_desc.extra_base,C=b.stat_desc.max_length;let J,X,R,N,k,E,V=0;for(N=0;N<=n;N++)c.bl_count[N]=0;for(A[2*c.heap[c.heap_max]+1]=0,J=c.heap_max+1;J<573;J++)X=c.heap[J],N=A[2*A[2*X+1]+1]+1,N>C&&(N=C,V++),A[2*X+1]=N,X>o||(c.bl_count[N]++,k=0,X>=L&&(k=s[X-L]),E=A[2*X],c.opt_len+=E*(N+k),h&&(c.static_len+=E*(t[2*X+1]+k)));if(0!==V){do{for(N=C-1;0===c.bl_count[N];)N--;c.bl_count[N]--,c.bl_count[N+1]+=2,c.bl_count[C]--,V-=2}while(V>0);for(N=C;0!==N;N--)for(X=c.bl_count[N];0!==X;)R=c.heap[--J],R>o||(A[2*R+1]!==N&&(c.opt_len+=(N-A[2*R+1])*A[2*R],A[2*R+1]=N),X--)}})(c,b),D(A,J,c.bl_count)},q=(c,b,A)=>{let o,t,n=-1,h=b[1],s=0,L=7,C=4;for(0===h&&(L=138,C=3),b[2*(A+1)+1]=65535,o=0;o<=A;o++)t=h,h=b[2*(o+1)+1],++s<L&&t===h||(s<C?c.bl_tree[2*t]+=s:0!==t?(t!==n&&c.bl_tree[2*t]++,c.bl_tree[32]++):s<=10?c.bl_tree[34]++:c.bl_tree[36]++,s=0,n=t,0===h?(L=138,C=3):t===h?(L=6,C=3):(L=7,C=4))},I=(c,b,A)=>{let o,t,n=-1,h=b[1],s=0,L=7,C=4;for(0===h&&(L=138,C=3),o=0;o<=A;o++)if(t=h,h=b[2*(o+1)+1],!(++s<L&&t===h)){if(s<C)do{z(c,t,c.bl_tree)}while(0!==--s);else 0!==t?(t!==n&&(z(c,t,c.bl_tree),s--),z(c,16,c.bl_tree),r(c,s-3,2)):s<=10?(z(c,17,c.bl_tree),r(c,s-3,3)):(z(c,18,c.bl_tree),r(c,s-11,7));s=0,n=t,0===h?(L=138,C=3):t===h?(L=6,C=3):(L=7,C=4)}};let K=!1;const Z=(c,b,A,o)=>{r(c,0+(o?1:0),3),((c,b,A,o)=>{v(c),o&&(d(c,A),d(c,~A)),c.pending_buf.set(c.window.subarray(b,b+A),c.pending),c.pending+=A})(c,b,A,!0)};c.exports._tr_init=c=>{K||((()=>{let c,b,A,C,M;const W=new Array(16);for(A=0,C=0;C<28;C++)for(k[C]=A,c=0;c<1<<h[C];c++)N[A++]=C;for(N[A-1]=C,M=0,C=0;C<16;C++)for(E[C]=M,c=0;c<1<<s[C];c++)R[M++]=C;for(M>>=7;C<t;C++)for(E[C]=M<<7,c=0;c<1<<s[C]-7;c++)R[256+M++]=C;for(b=0;b<=n;b++)W[b]=0;for(c=0;c<=143;)J[2*c+1]=8,c++,W[8]++;for(;c<=255;)J[2*c+1]=9,c++,W[9]++;for(;c<=279;)J[2*c+1]=7,c++,W[7]++;for(;c<=287;)J[2*c+1]=8,c++,W[8]++;for(D(J,287,W),c=0;c<t;c++)X[2*c+1]=5,X[2*c]=Y(c,5);y=new V(J,h,257,o,n),j=new V(X,s,0,t,n),F=new V(new Array(0),L,0,19,7)})(),K=!0),c.l_desc=new M(c.dyn_ltree,y),c.d_desc=new M(c.dyn_dtree,j),c.bl_desc=new M(c.bl_tree,F),c.bi_buf=0,c.bi_valid=0,f(c)},c.exports._tr_stored_block=Z,c.exports._tr_flush_block=(c,b,o,t)=>{let n,h,s=0;c.level>0?(2===c.strm.data_type&&(c.strm.data_type=(c=>{let b,o=4093624447;for(b=0;b<=31;b++,o>>>=1)if(1&o&&0!==c.dyn_ltree[2*b])return 0;if(0!==c.dyn_ltree[18]||0!==c.dyn_ltree[20]||0!==c.dyn_ltree[26])return 1;for(b=32;b<A;b++)if(0!==c.dyn_ltree[2*b])return 1;return 0})(c)),p(c,c.l_desc),p(c,c.d_desc),s=(c=>{let b;for(q(c,c.dyn_ltree,c.l_desc.max_code),q(c,c.dyn_dtree,c.d_desc.max_code),p(c,c.bl_desc),b=18;b>=3&&0===c.bl_tree[2*C[b]+1];b--);return c.opt_len+=3*(b+1)+5+5+4,b})(c),n=c.opt_len+3+7>>>3,h=c.static_len+3+7>>>3,h<=n&&(n=h)):n=h=o+5,o+4<=n&&-1!==b?Z(c,b,o,t):4===c.strategy||h===n?(r(c,2+(t?1:0),3),O(c,J,X)):(r(c,4+(t?1:0),3),((c,b,A,o)=>{let t;for(r(c,b-257,5),r(c,A-1,5),r(c,o-4,4),t=0;t<o;t++)r(c,c.bl_tree[2*C[t]+1],3);I(c,c.dyn_ltree,b-1),I(c,c.dyn_dtree,A-1)})(c,c.l_desc.max_code+1,c.d_desc.max_code+1,s+1),O(c,c.dyn_ltree,c.dyn_dtree)),f(c),t&&v(c)},c.exports._tr_tally=(c,b,o)=>(c.pending_buf[c.d_buf+2*c.last_lit]=b>>>8&255,c.pending_buf[c.d_buf+2*c.last_lit+1]=255&b,c.pending_buf[c.l_buf+c.last_lit]=255&o,c.last_lit++,0===b?c.dyn_ltree[2*o]++:(c.matches++,b--,c.dyn_ltree[2*(N[o]+A+1)]++,c.dyn_dtree[2*W(b)]++),c.last_lit===c.lit_bufsize-1),c.exports._tr_align=c=>{r(c,2,3),z(c,256,J),(c=>{16===c.bi_valid?(d(c,c.bi_buf),c.bi_buf=0,c.bi_valid=0):c.bi_valid>=8&&(c.pending_buf[c.pending++]=255&c.bi_buf,c.bi_buf>>=8,c.bi_valid-=8)})(c)}},12244:c=>{"use strict";c.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12151:c=>{function b(c,b,A){for(var o=c.length,t=-1/0,n=1/0,h=0;h<o;h++){var s=(A[0][h]-c[h])/b[h],L=(A[1][h]-c[h])/b[h];if(s>L){var C=s;s=L,L=C}if(L<t||s>n)return 1/0;s>t&&(t=s),L<n&&(n=L)}return t>n?1/0:t}c.exports=function(c,A,o,t){var n=b(A,o,t);if(n===1/0)c=null;else{c=c||[];for(var h=0;h<A.length;h++)c[h]=A[h]+o[h]*n}return c},c.exports.distance=b},13044:(c,b,A)=>{"use strict";A.d(b,{b:()=>h});var o=A(26);const t=o.useLayoutEffect;const n=function(c){var b=(0,o.useRef)(c);return t((function(){b.current=c})),b};var h=function(c){var b=n(c);(0,o.nd)((function(){var c=function(c){var A;if(null!=b.current&&(A=b.current(c)),c.defaultPrevented&&(c.returnValue=""),"string"===typeof A)return c.returnValue=A,A};return window.addEventListener("beforeunload",c),function(){window.removeEventListener("beforeunload",c)}}),[])}},12995:(c,b,A)=>{"use strict";var o=A(12999),t=Array.prototype.concat,n=Array.prototype.slice,h=c.exports=function(c){for(var b=[],A=0,h=c.length;A<h;A++){var s=c[A];o(s)?b=t.call(b,n.call(s)):b.push(s)}return b};h.wrap=function(c){return function(){return c(h(arguments))}}},12999:c=>{c.exports=function(c){return!(!c||"string"===typeof c)&&(c instanceof Array||Array.isArray(c)||c.length>=0&&(c.splice instanceof Function||Object.getOwnPropertyDescriptor(c,c.length-1)&&"String"!==c.constructor.name))}},12160:(c,b,A)=>{var o=A(12168);function t(c){for(var b,A,t=0,n=c.length,h=0;h<c.length;){for(b=c[h],A=0;h<n&&c[h]===b;)++h,++A;t+=o.log2(A)/7|0,t+=o.log2(b>>>0)/7|0,t+=2}return t}b.size=t,b.encode=function(c,b){b||(b=new Uint8Array(t(c)));for(var A,o,n=0,h=b.length,s=0;s<c.length;){for(A=c[s],o=0;s<c.length&&c[s]===A;)++s,++o;for(;n<h&&o>=128;)b[n++]=128+(127&o),o>>>=7;if(n>=h)throw new Error("RLE buffer overflow");for(b[n++]=o,A>>>=0;n<h&&A>=128;)b[n++]=128+(127&A),A>>>=7;if(n>=h)throw new Error("RLE buffer overflow");b[n++]=A}return b},b.decode=function(c,b){for(var A,o,t,n,h=b.length,s=c.length,L=0,C=0;C<s;){for(A=0,o=0;C<s&&c[C]>=128;)A+=(127&c[C++])<<o,o+=7;if(A+=c[C++]<<o,C>=s)throw new Error("RLE buffer underrun");if(L+A>h)throw new Error("Chunk buffer overflow");for(t=0,o=0;C<s&&c[C]>=128;)t+=(127&c[C++])<<o,o+=7;if(C>=s)throw new Error("RLE buffer underrun");for(t+=c[C++]<<o,n=0;n<A;++n)b[L++]=t}return b}},12168:(c,b)=>{"use strict";function A(c){var b=32;return(c&=-c)&&b--,65535&c&&(b-=16),16711935&c&&(b-=8),252645135&c&&(b-=4),858993459&c&&(b-=2),1431655765&c&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(c){return(c>0)-(c<0)},b.abs=function(c){var b=c>>31;return(c^b)-b},b.min=function(c,b){return b^(c^b)&-(c<b)},b.max=function(c,b){return c^(c^b)&-(c<b)},b.isPow2=function(c){return!(c&c-1)&&!!c},b.log2=function(c){var b,A;return b=(c>65535)<<4,b|=A=((c>>>=b)>255)<<3,b|=A=((c>>>=A)>15)<<2,(b|=A=((c>>>=A)>3)<<1)|(c>>>=A)>>1},b.log10=function(c){return c>=1e9?9:c>=1e8?8:c>=1e7?7:c>=1e6?6:c>=1e5?5:c>=1e4?4:c>=1e3?3:c>=100?2:c>=10?1:0},b.popCount=function(c){return 16843009*((c=(858993459&(c-=c>>>1&1431655765))+(c>>>2&858993459))+(c>>>4)&252645135)>>>24},b.countTrailingZeros=A,b.nextPow2=function(c){return c+=0===c,--c,c|=c>>>1,c|=c>>>2,c|=c>>>4,c|=c>>>8,(c|=c>>>16)+1},b.prevPow2=function(c){return c|=c>>>1,c|=c>>>2,c|=c>>>4,c|=c>>>8,(c|=c>>>16)-(c>>>1)},b.parity=function(c){return c^=c>>>16,c^=c>>>8,c^=c>>>4,27030>>>(c&=15)&1};var o=new Array(256);!function(c){for(var b=0;b<256;++b){var A=b,o=b,t=7;for(A>>>=1;A;A>>>=1)o<<=1,o|=1&A,--t;c[b]=o<<t&255}}(o),b.reverse=function(c){return o[255&c]<<24|o[c>>>8&255]<<16|o[c>>>16&255]<<8|o[c>>>24&255]},b.interleave2=function(c,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(c,b){return(c=65535&((c=16711935&((c=252645135&((c=858993459&((c=c>>>b&1431655765)|c>>>1))|c>>>2))|c>>>4))|c>>>16))<<16>>16},b.interleave3=function(c,b,A){return c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2),(c|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<2},b.deinterleave3=function(c,b){return(c=1023&((c=4278190335&((c=251719695&((c=3272356035&((c=c>>>b&1227133513)|c>>>2))|c>>>4))|c>>>8))|c>>>16))<<22>>22},b.nextCombination=function(c){var b=c|c-1;return b+1|(~b&-~b)-1>>>A(c)+1}},13119:(c,b,A)=>{"use strict";A.d(b,{d:()=>X});var o=A(905),t=A(144);class n{constructor(c,b,A,n,h,s,L){this.pf=new o(c.base,c.qf),this.mass=b,this.friction=A,this.restitution=n,this._d=h,this.Ae=s,this.ae=!!L,this.Ok=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Vh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.sf=t.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=t.create(),this._impulses=t.create(),this._sleepFrameCount=10}loadFromCopy(c){t.i(this.pf.base,c.pf.base),t.i(this.pf.qf,c.pf.qf),t.i(this.pf.max,c.pf.max),this.pf.mag=c.pf.mag,this.mass=c.mass,this.friction=c.friction,this.restitution=c.restitution,this._d=c._d,this.Ae=c.Ae,this.ae=c.ae,this.Ok=c.Ok,this.fluidDrag=c.fluidDrag,this.Vh=c.Vh,this.preventFallOffEdge=c.preventFallOffEdge,this.rolledBackLastTick=c.rolledBackLastTick,t.i(this.sf,c.sf),t.i(this.resting,c.resting),this.inFluid=c.inFluid,this._ratioInFluid=c._ratioInFluid,t.i(this._forces,c._forces),t.i(this._impulses,c._impulses),this._sleepFrameCount=c._sleepFrameCount}setPosition(c){h(c),t.Xd(c,c,this.pf.base),this.pf.translate(c),this.Oh()}rg(){return t.clone(this.pf.base)}applyForce(c){h(c),t.add(this._forces,this._forces,c),this.Oh()}applyImpulse(c){h(c),t.add(this._impulses,this._impulses,c),this.Oh()}Oh(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var h=c=>{};var s=A(905),L=A(144),C=A(909);function J(){this.Ok=.1,this.fluidDrag=.4,this.je=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function X(c,b,A){c=Object.assign(new J,c),this.gravity=c.gravity||[0,-10,0],this.Ok=c.Ok||.1,this.je=c.je||2,this.fluidDrag=c.fluidDrag||.4,this.minBounceImpulse=c.minBounceImpulse,this.bodies=[],this.om=c.om,this.testSolid=b,this.testFluid=A}X.prototype.df=function(c,b,A,o,t,h){c=c||new s([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof A&&(A=1),"undefined"==typeof o&&(o=0),"undefined"==typeof t&&(t=1);var L=new n(c,b,A,o,t,h);return this.bodies.push(L),L},X.prototype.ff=function(c){var b=this.bodies.indexOf(c);b<0||(this.bodies.splice(b,1),c.pf=c.Ae=null)};var R=L.create(),N=L.create(),k=L.create(),E=L.create(),V=L.create(),y=L.create(),j=L.create(),F=new s([0,0,0],[1,1,1]),M=new n(F,1,1,0,1,(()=>{}),!1);function W(c,b,A){return b=A,b*=1-(1-c.ratioInFluid)**2}X.prototype.Kj=function(c){c/=1e3;var b=H(0,L.squaredLength(this.gravity));this.bodies.forEach((A=>function(c,b,A,o){L.i(V,b.resting),c.om&&M.loadFromCopy(b);if(b.mass<=0)return L.set(b.sf,0,0,0),L.set(b._forces,0,0,0),void L.set(b._impulses,0,0,0);var t=o||0===b._d;if(function(c,b,A,o){if(b._sleepFrameCount>0)return!1;if(o)return!0;var t=!1,n=.5*A*A*b._d;return L.scale(Z,c.gravity,n),C(c.testSolid,b.pf,Z,(function(){return t=!0,!0}),!0),t}(c,b,A,t))return;b._sleepFrameCount--,function(c,b){var A=b.pf,o=Math.floor(A.base[0]),t=Math.floor(A.base[2]),n=Math.floor(A.base[1]),h=Math.floor(A.max[1]);if(!c.testFluid(o,n,t))return b.inFluid=!1,void(b.ratioInFluid=0);var s=1,C=n+1;for(;C<=h&&c.testFluid(o,C,t);)s++,C++;var J=(n+s-A.base[1])/A.qf[1];J>1&&(J=1);var X=A.qf[0]*A.qf[1]*A.qf[2]*J,R=r;L.scale(R,c.gravity,-c.je*X*b._d),b.applyForce(R),b.inFluid=!0,b.ratioInFluid=J}(c,b),B(b._forces),B(b._impulses),B(b.sf),B(b.resting),L.scale(R,b._forces,1/b.mass),L.vf(R,R,c.gravity,b._d),L.scale(N,b._impulses,1/b.mass),L.vf(N,N,R,A),L.add(b.sf,b.sf,N),b.friction&&(z(c,0,b,N,A),z(c,1,b,N,A),z(c,2,b,N,A));var n=b.fluidDrag>=0?b.fluidDrag:c.fluidDrag,h=b.Ok>=0?b.Ok:c.Ok,s=h,J=h;b.inFluid&&(s=W(b,s,b.fluidDragHoriz>=0?b.fluidDragHoriz:n),J=W(b,J,b.fluidDragVert>=0?b.fluidDragVert:n));s=Math.max(1-s*A/b.mass,0),J=Math.max(1-J*A/b.mass,0),L.set(d,s,J,s),L.multiply(b.sf,b.sf,d),L.scale(k,b.sf,A),L.set(b._forces,0,0,0),L.set(b._impulses,0,0,0),b.ae&&S(f,b.pf);L.i(y,k),L.set(j,0,0,0),b.preventFallOffEdge&&function(c,b,A,o){if(!b.resting[1]||A[1]>0)return;var t=q;S(t,b.pf);for(var n=0;n<3;n+=2){L.set(p,0,0,0),p[n]=A[n];var h=!0;(h=(h=(h=(h=h&&!K(c,t.base[0]+p[0]+1e-5,t.base[1],t.base[2]+p[2]+1e-5))&&!K(c,t.max[0]+p[0]-1e-5,t.base[1],t.base[2]+p[2]+1e-5))&&!K(c,t.base[0]+p[0]+1e-5,t.base[1],t.max[2]+p[2]-1e-5))&&!K(c,t.max[0]+p[0]-1e-5,t.base[1],t.max[2]+p[2]-1e-5))?(o[n]=A[n]>0?1:-1,A[n]=0):0===n&&(L.set(I,A[0],0,0),D(c,t,I,o,b.slideOnCollision))}}(c,b,k,j);D(c,b.pf,k,b.resting,b.slideOnCollision),b.ae&&function(c,b,A,o){if(b.resting[1]>=0&&!b.inFluid)return;var t=0!==b.resting[0],n=0!==b.resting[2];if(!t&&!n)return;var h=Math.abs(o[0]/o[2]),s=4;if(!t&&h>s)return;if(!n&&h<1/s)return;L.add(G,A.base,o);var J=c.testSolid;C(J,A,o,(function(c,b,A,o){if(1!==b)return!0;o[b]=0}));var X=A.base[1],R=b.inFluid?1.951:1.001,N=Math.floor(X+R)-X;L.set(P,0,N,0);var k=!1;if(C(J,A,P,(function(c,b,A,o){return k=!0,!0})),k)return;L.Xd(O,G,A.base),O[1]=0,D(c,A,O,v,!0);var E=H(A.base[0],G[0]),V=H(A.base[2],G[2]);if(t&&!E&&(!V||!n))return;if(n&&(!E||!t)&&!V)return;var y=!0;if(y=y&&!K(c,A.base[0]+1e-5,A.base[1],A.base[2]+1e-5),y=y&&!K(c,A.max[0]-1e-5,A.base[1],A.base[2]+1e-5),y=y&&!K(c,A.base[0]+1e-5,A.base[1],A.max[2]-1e-5),y=y&&!K(c,A.max[0]-1e-5,A.base[1],A.max[2]-1e-5),y)return;S(b.pf,A),b.resting[0]=v[0],b.resting[2]=v[2],b.Vh&&b.Vh()}(c,b,f,y);for(var X=0;X<3;++X)b.resting[X]=b.resting[X]||j[X],E[X]=0,b.resting[X]&&(V[X]||(E[X]=-b.sf[X]),b.sf[X]=0);var F=L.length(E);F>.001&&(L.scale(E,E,b.mass),b.Ae&&b.Ae(E),b.restitution>0&&F>c.minBounceImpulse&&(L.scale(E,E,b.restitution),b.applyImpulse(E)));var Y=L.squaredLength(b.sf);Y>1e-5&&b.Oh();c.om&&c.om(b)?(b.loadFromCopy(M),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,A,c,b)))};var d=L.create([0,0,0]);var r=L.create();function z(c,b,A,o,t){var n=A.resting[b],h=o[b];if(!A.alwaysApplyHorizFriction||1!==b){if(0===n)return;if(n*h<=0)return}L.i(Y,A.sf),Y[b]=0;var s=L.length(Y);if(!H(s,0)){var C=Math.abs(A.friction*c.gravity[b]*t),J=s>C?(s-C)/s:0;A.sf[(b+1)%3]*=J,A.sf[(b+2)%3]*=J}}var Y=L.create();function D(c,b,A,o,t){return L.set(o,0,0,0),C(c.testSolid,b,A,(function(c,b,A,n){o[b]=A,n[b]=0,t||(n[0]=0,n[1]=0,n[2]=0)}))}var f=new s([],[]),v=L.create(),G=L.create(),P=L.create(),O=L.create();var p=L.create(),q=new s([],[]),I=L.create();function K(c,b,A,o){return c.testSolid(Math.floor(b),Math.floor(A-1),Math.floor(o))}var Z=L.create();function H(c,b){return Math.abs(c-b)<1e-5}function S(c,b){for(var A=0;A<3;A++)c.base[A]=b.base[A],c.max[A]=b.max[A],c.qf[A]=b.qf[A]}var B=function(c){}},12181:c=>{"use strict";c.exports=function(c,b,A,o){var t=self||window;try{try{var n;try{n=new t.Blob([c])}catch(C){(n=new(t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder)).append(c),n=n.getBlob()}var h=t.URL||t.webkitURL,s=h.createObjectURL(n),L=new t[b](s,A);return h.revokeObjectURL(s),L}catch(C){return new t[b]("data:application/javascript,".concat(encodeURIComponent(c)),A)}}catch(C){if(!o)throw Error("Inline worker is not supported");return new t[b](o,A)}}},12136:(c,b,A)=>{"use strict";function o(c,b,A,o,t){var n={};return Object.keys(o).forEach((function(c){n[c]=o[c]})),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=A.slice().reverse().reduce((function(A,o){return o(c,b,A)||A}),n),t&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(t):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(c,b,n),n=null),n}A.d(b,{c:()=>o})},12133:(c,b,A)=>{"use strict";function o(c,b,A,o){A&&Object.defineProperty(c,b,{enumerable:A.enumerable,configurable:A.configurable,writable:A.writable,value:A.initializer?A.initializer.call(o):void 0})}A.d(b,{e:()=>o})},13028:(c,b,A)=>{"use strict";A.d(b,{b:()=>h,f:()=>X,i:()=>s,k:()=>n,m:()=>L,n:()=>t,r:()=>C,s:()=>J});var o=A(2042);class t{constructor(){this._easingMode=t.EASINGMODE_EASEIN}setEasingMode(c){const b=Math.min(Math.max(c,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(c){throw new Error("You must implement this method")}ease(c){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(c);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-c)}return c>=.5?.5*(1-this.easeInCore(2*(1-c)))+.5:.5*this.easeInCore(2*c)}}t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2;class n extends t{easeInCore(c){return c=Math.max(0,Math.min(1,c)),1-Math.sqrt(1-c*c)}}class h extends t{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=c}easeInCore(c){const b=Math.max(0,this.amplitude);return Math.pow(c,3)-c*b*Math.sin(3.141592653589793*c)}}class s extends t{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=c,this.bounciness=b}easeInCore(c){const b=Math.max(0,this.bounces);let A=this.bounciness;A<=1&&(A=1.001);const o=Math.pow(A,b),t=1-A,n=(1-o)/t+.5*o,h=c*n,s=Math.log(-h*(1-A)+1)/Math.log(A),L=Math.floor(s),C=L+1,J=(1-Math.pow(A,L))/(t*n),X=.5*(J+(1-Math.pow(A,C))/(t*n)),R=c-X,N=X-J;return-Math.pow(1/A,b-L)/(N*N)*(R-N)*(R+N)}}class L extends t{easeInCore(c){return c*c*c}}class C extends t{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=c,this.springiness=b}easeInCore(c){let b;const A=Math.max(0,this.oscillations),o=Math.max(0,this.springiness);return b=0==o?c:(Math.exp(o*c)-1)/(Math.exp(o)-1),b*Math.sin((6.283185307179586*A+1.5707963267948966)*c)}}class J extends t{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=c}easeInCore(c){return this.exponent<=0?c:(Math.exp(this.exponent*c)-1)/(Math.exp(this.exponent)-1)}}class X extends t{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=c,this.y1=b,this.x2=A,this.y2=o}easeInCore(c){return o.c.Interpolate(c,this.x1,this.y1,this.x2,this.y2)}}},12701:(c,b,A)=>{"use strict";A.d(b,{b:()=>h});var o=A(688),t=A(699),n=A(711);class h extends n.b{get _matrix(){return this._compose(),this.Jk}set _matrix(c){(c.updateFlag!==this.Jk.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Jk.p(c),this._markAsDirtyAndDecompose())}constructor(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(c,b.va(),!1),this.name=c,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.Jk=(null===t||void 0===t?void 0:t.clone())??o.b.Identity(),this._restMatrix=n??this.Jk.clone(),this._bindMatrix=h??this.Jk.clone(),this._index=s,this._absoluteMatrix=new o.b,this._absoluteBindMatrix=new o.b,this._absoluteInverseBindMatrix=new o.b,this._finalMatrix=new o.b,b.bones.push(this),this.setParent(A,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(c){this.setParent(c)}setParent(c){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==c){if(this.parent){const c=this.parent.children.indexOf(this);-1!==c&&this.parent.children.splice(c,1)}this._parentNode=c,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.Yj()}}getLocalMatrix(){return this._compose(),this.Jk}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(c){this._restMatrix.p(c)}setRestPose(c){this.setRestMatrix(c)}getBindPose(){return this.getBindMatrix()}setBindMatrix(c){this.nk(c)}setBindPose(c){this.setBindMatrix(c)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const c=o.f.ak[0],b=o.f.Quaternion[0],A=o.f.ak[1];this.getRestMatrix().decompose(c,b,A),this._linkedTransformNode.position.p(A),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??o.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(b),this._linkedTransformNode.ld.p(c)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(c){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=c,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.hd}set position(c){this._decompose(),this.hd.p(c),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(c){this.setRotation(c)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(c){this.setRotationQuaternion(c)}get ld(){return this.getScale()}set ld(c){this.setScale(c)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.k.Zero(),this._localRotation=o.e.Zero(),this.hd=o.k.Zero()),this.Jk.decompose(this._localScaling,this._localRotation,this.hd))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,o.b.ComposeToRef(this._localScaling,this._localRotation,this.hd,this.Jk)):this._needToCompose=!1)}nk(c){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(c),b&&this._updateAbsoluteBindMatrices(),A?this._matrix=c:this.Yj()}_updateAbsoluteBindMatrices(c){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(c||(c=this._bindMatrix),this.parent?c.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(c),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let A=0;A<this.children.length;A++)this.children[A]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Yj(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Yj(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Yj(),this._needToDecompose=!0}_updatePosition(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=this.getLocalMatrix();if(0==b)t?(n.addAtIndex(12,c.x),n.addAtIndex(13,c.y),n.addAtIndex(14,c.z)):n.setTranslationFromFloats(c.x,c.y,c.z);else{let b=null;A&&(b=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const s=h._TmpMats[0],L=h._TmpVecs[0];this.parent?A&&b?(s.p(this.parent.getAbsoluteMatrix()),s.multiplyToRef(b,s)):s.p(this.parent.getAbsoluteMatrix()):o.b.IdentityToRef(s),t&&s.setTranslationFromFloats(0,0,0),s.invert(),o.k.TransformCoordinatesToRef(c,s,L),t?(n.addAtIndex(12,L.x),n.addAtIndex(13,L.y),n.addAtIndex(14,L.z)):n.setTranslationFromFloats(L.x,L.y,L.z)}this._markAsDirtyAndDecompose()}translate(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(c,b,A,!0)}setPosition(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(c,b,A,!1)}setAbsolutePosition(c,b){this.setPosition(c,1,b)}scale(c,b,A){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=this.getLocalMatrix(),s=h._TmpMats[0];o.b.ScalingToRef(c,b,A,s),s.multiplyToRef(n,n),s.invert();for(const o of this.children){const t=o.getLocalMatrix();t.multiplyToRef(s,t),t.multiplyAtIndex(12,c),t.multiplyAtIndex(13,b),t.multiplyAtIndex(14,A),o._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),t)for(const o of this.children)o.scale(c,b,A,t)}setScale(c){this._decompose(),this._localScaling.p(c),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(c){this._decompose(),c.p(this._localScaling)}setYawPitchRoll(c,b,A){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;if(0===t){const s=h._TmpQuat;return o.e.RotationYawPitchRollToRef(c,b,A,s),void this.setRotationQuaternion(s,t,n)}const s=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(s,n))return;const L=h._TmpMats[1];o.b.RotationYawPitchRollToRef(c,b,A,L),s.multiplyToRef(L,L),this._rotateWithMatrix(L,t,n)}rotate(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;const n=h._TmpMats[0];n.setTranslationFromFloats(0,0,0),o.b.RotationAxisToRef(c,b,n),this._rotateWithMatrix(n,A,t)}setAxisAngle(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;if(0===A){const n=h._TmpQuat;return o.e.RotationAxisToRef(c,b,n),void this.setRotationQuaternion(n,A,t)}const n=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(n,t))return;const s=h._TmpMats[1];o.b.RotationAxisToRef(c,b,s),n.multiplyToRef(s,s),this._rotateWithMatrix(s,A,t)}setRotation(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(c.y,c.x,c.z,b,A)}setRotationQuaternion(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.p(c),void this._markAsDirtyAndCompose();const t=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,A))return;const n=h._TmpMats[1];o.b.FromQuaternionToRef(c,n),t.multiplyToRef(n,n),this._rotateWithMatrix(n,b,A)}setRotationMatrix(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===b){const t=h._TmpQuat;return o.e.FromRotationMatrixToRef(c,t),void this.setRotationQuaternion(t,b,A)}const t=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,A))return;const n=h._TmpMats[1];n.p(c),t.multiplyToRef(c,n),this._rotateWithMatrix(n,b,A)}_rotateWithMatrix(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const o=this.getLocalMatrix(),t=o.m[12],n=o.m[13],s=o.m[14],L=this.getParent(),C=h._TmpMats[3],J=h._TmpMats[4];L&&1==b?(A?(C.p(A.getWorldMatrix()),L.getAbsoluteMatrix().multiplyToRef(C,C)):C.p(L.getAbsoluteMatrix()),J.p(C),J.invert(),o.multiplyToRef(C,o),o.multiplyToRef(c,o),o.multiplyToRef(J,o)):1==b&&A?(C.p(A.getWorldMatrix()),J.p(C),J.invert(),o.multiplyToRef(C,o),o.multiplyToRef(c,o),o.multiplyToRef(J,o)):o.multiplyToRef(c,o),o.setTranslationFromFloats(t,n,s),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(c,b){const A=h._TmpMats[2];return c.p(this.getAbsoluteMatrix()),b?(c.multiplyToRef(b.getWorldMatrix(),c),o.b.ScalingToRef(b.ld.x,b.ld.y,b.ld.z,A)):o.b.IdentityToRef(A),c.invert(),!isNaN(c.m[0])&&(A.multiplyAtIndex(0,this._scalingDeterminant),c.multiplyToRef(A,c),!0)}rg(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=o.k.Zero();return this.getPositionToRef(c,b,A),A}getPositionToRef(){let c=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const c=this.getLocalMatrix();b.x=c.m[12],b.y=c.m[13],b.z=c.m[14]}else{let A=null;c&&(A=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let o=h._TmpMats[0];c&&A?(o.p(this.getAbsoluteMatrix()),o.multiplyToRef(A,o)):o=this.getAbsoluteMatrix(),b.x=o.m[12],b.y=o.m[13],b.z=o.m[14]}}getAbsolutePosition(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=o.k.Zero();return this.getPositionToRef(1,c,b),b}getAbsolutePositionToRef(c,b){this.getPositionToRef(1,c,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Jk.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Jk);const c=this._skeleton.getPoseMatrix();c&&this._absoluteMatrix.multiplyToRef(c,this._absoluteMatrix)}const c=this.children,b=c.length;for(let A=0;A<b;A++)c[A].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ag(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=o.k.Zero();return this.getDirectionToRef(c,b,A),A}getDirectionToRef(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,t=null;b&&(t=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=h._TmpMats[0];n.p(this.getAbsoluteMatrix()),b&&t&&n.multiplyToRef(t,n),o.k.TransformNormalToRef(c,n,A),A.normalize()}getRotation(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=o.k.Zero();return this.getRotationToRef(c,b,A),A}getRotationToRef(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const o=h._TmpQuat;this.getRotationQuaternionToRef(c,b,o),o.toEulerAnglesToRef(A)}getRotationQuaternion(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=o.e.Identity();return this.getRotationQuaternionToRef(c,b,A),A}getRotationQuaternionToRef(){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.p(this._localRotation);else{const A=h._TmpMats[0],o=this.getAbsoluteMatrix();c?o.multiplyToRef(c.getWorldMatrix(),A):A.p(o),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.decompose(void 0,b,void 0)}}getRotationMatrix(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const A=o.b.Identity();return this.getRotationMatrixToRef(c,b,A),A}getRotationMatrixToRef(){let c=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const A=h._TmpMats[0],o=this.getAbsoluteMatrix();c?o.multiplyToRef(c.getWorldMatrix(),A):A.p(o),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=o.k.Zero();return this.getAbsolutePositionFromLocalToRef(c,b,A),A}getAbsolutePositionFromLocalToRef(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,t=null;b&&(t=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=h._TmpMats[0];n.p(this.getAbsoluteMatrix()),b&&t&&n.multiplyToRef(t,n),o.k.TransformCoordinatesToRef(c,n,A)}getLocalPositionFromAbsolute(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=o.k.Zero();return this.getLocalPositionFromAbsoluteToRef(c,b,A),A}getLocalPositionFromAbsoluteToRef(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,t=null;b&&(t=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const n=h._TmpMats[0];n.p(this.getAbsoluteMatrix()),b&&t&&n.multiplyToRef(t,n),n.invert(),o.k.TransformCoordinatesToRef(c,n,A)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const c=this._skeleton.bones.indexOf(this);if(-1!==c&&this._skeleton.bones.splice(c,1),this._parentNode&&this._parentNode.children){const c=this._parentNode.children,b=c.indexOf(this);-1!==b&&c.splice(b,1)}super.dispose()}}h._TmpVecs=(0,t.c)(2,o.k.Zero),h._TmpQuat=o.e.Identity(),h._TmpMats=(0,t.c)(5,o.b.Identity)},13023:(c,b,A)=>{"use strict";A.d(b,{b:()=>p});var o=A(672),t=A(674),n=A(518),h=A(688),s=A(702),L=A(711),C=A(510),J=A(2204),X=A(536),R=A(693);class N{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(c){this._zoomStopsAnimation=c}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(c){this._idleRotationSpeed=c}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(c){this._idleRotationWaitTime=c}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(c){this._idleRotationSpinupTime=c}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(c){this._attachedCamera=c;const b=this._attachedCamera.va();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((c=>{c.type!==J.d.POINTERDOWN?c.type===J.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const c=X.e.Now;let b=0;null!=this._lastFrameTime&&(b=c-this._lastFrameTime),this._lastFrameTime=c,this._applyUserInteraction();const A=c-this._lastInteractionTime-this._idleRotationWaitTime,o=Math.max(Math.min(A/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*o,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const c=this._attachedCamera.va();this._onPrePointerObservableObserver&&c.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(c){this._lastInteractionTime=c??X.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<R.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let c=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(c=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?c:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=X.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var k=A(13028),E=A(11907);class V{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(c){if(this._autoTransitionRange===c)return;this._autoTransitionRange=c;const b=this._attachedCamera;b&&(c?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((c=>{if(c&&(c.Zj(!0),c.getBoundingInfo)){const b=c.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(c){this._attachedCamera=c,this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(c){return!!this._attachedCamera&&(this._attachedCamera.radius===c&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(c){if(!this._attachedCamera)return;this._radiusBounceTransition||(V.EasingFunction.setEasingMode(V.EasingMode),this._radiusBounceTransition=E.d.CreateAnimation("radius",E.d.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=E.d.TransitionTo("radius",this._attachedCamera.radius+c,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}V.EasingFunction=new k.b(.3),V.EasingMode=k.n.EASINGMODE_EASEOUT;class y{constructor(){this.onTargetFramingAnimationEndObservable=new n.b,this._mode=y.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(c){this._mode=c}get mode(){return this._mode}set radiusScale(c){this._radiusScale=c}get radiusScale(){return this._radiusScale}set positionScale(c){this._positionScale=c}get positionScale(){return this._positionScale}set defaultElevation(c){this._defaultElevation=c}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(c){this._elevationReturnTime=c}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(c){this._elevationReturnWaitTime=c}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(c){this._zoomStopsAnimation=c}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(c){this._framingTime=c}get framingTime(){return this._framingTime}init(){}attach(c){this._attachedCamera=c;const b=this._attachedCamera.va();y.EasingFunction.setEasingMode(y.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((c=>{c.type!==J.d.POINTERDOWN?c.type===J.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((c=>{c&&c.getBoundingInfo&&this.zoomOnMesh(c,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const c=this._attachedCamera.va();this._onPrePointerObservableObserver&&c.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c.Zj(!0);const o=c.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(o.minimumWorld,o.maximumWorld,b,A)}zoomOnMeshHierarchy(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c.Zj(!0);const o=c.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(o.min,o.max,b,A)}zoomOnMeshesHierarchy(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new h.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new h.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let n=0;n<c.length;n++){const b=c[n].getHierarchyBoundingVectors(!0);h.k.CheckExtends(b.min,o,t),h.k.CheckExtends(b.max,o,t)}this.zoomOnBoundingInfo(o,t,b,A)}zoomOnBoundingInfo(c,b){let A,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const n=c.y,s=n+(b.y-n)*this._positionScale,L=b.Xd(c).scale(.5);if(!isFinite(s))return!1;if(o)A=new h.k(0,s,0);else{const b=c.add(L);A=new h.k(b.x,s,b.z)}this._vectorTransition||(this._vectorTransition=E.d.CreateAnimation("target",E.d.ANIMATIONTYPE_VECTOR3,60,y.EasingFunction)),this._betaIsAnimating=!0;let C=E.d.TransitionTo("target",A,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);C&&this._animatables.push(C);let J=0;if(this._mode===y.FitFrustumSidesMode){const A=this._calculateLowerRadiusFromModelBoundingSphere(c,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=L.length()+this._attachedCamera.Vj),J=A}else this._mode===y.IgnoreBoundsSizeMode&&(J=this._calculateLowerRadiusFromModelBoundingSphere(c,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Vj));if(this.autoCorrectCameraLimitsAndSensibility){const A=b.Xd(c).length();this._attachedCamera.panningSensibility=5e3/A,this._attachedCamera.wheelPrecision=100/J}return this._radiusTransition||(this._radiusTransition=E.d.CreateAnimation("radius",E.d.ANIMATIONTYPE_FLOAT,60,y.EasingFunction)),C=E.d.TransitionTo("radius",J,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),t&&t(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),C&&this._animatables.push(C),!0}_calculateLowerRadiusFromModelBoundingSphere(c,b){const A=this._attachedCamera;if(!A)return 0;let o=A._calculateLowerRadiusFromModelBoundingSphere(c,b,this._radiusScale);return A.lowerRadiusLimit&&this._mode===y.IgnoreBoundsSizeMode&&(o=o<A.lowerRadiusLimit?A.lowerRadiusLimit:o),A.upperRadiusLimit&&(o=o>A.upperRadiusLimit?A.upperRadiusLimit:o),o}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const c=X.e.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,A=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>A&&c>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=E.d.CreateAnimation("beta",E.d.ANIMATIONTYPE_FLOAT,60,y.EasingFunction));const c=E.d.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));c&&this._animatables.push(c)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=X.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}y.EasingFunction=new k.s,y.EasingMode=k.n.EASINGMODE_EASEINOUT,y.IgnoreBoundsSizeMode=0,y.FitFrustumSidesMode=1;var j=A(663),F=A(11843),M=A(12698),W=A(525);class d{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(c){c=W.d.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),A=b.getInputElement();let o=0,t=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{var h,s;const L=n.event,C="touch"===L.pointerType;if(n.type!==J.d.POINTERMOVE&&-1===this.buttons.indexOf(L.button))return;const X=L.target;if(this._altKey=L.altKey,this._ctrlKey=L.ctrlKey,this._metaKey=L.metaKey,this._shiftKey=L.shiftKey,this._buttonsPressed=L.buttons,b.isPointerLock){const c=L.movementX,b=L.movementY;this.onTouch(null,c,b),this._pointA=null,this._pointB=null}else{if(n.type!==J.d.POINTERDOWN&&n.type!==J.d.POINTERDOUBLETAP&&C&&(null===(h=this._pointA)||void 0===h?void 0:h.pointerId)!==L.pointerId&&(null===(s=this._pointB)||void 0===s?void 0:s.pointerId)!==L.pointerId)return;if(n.type!==J.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!C)if(n.type===J.d.POINTERDOUBLETAP)this.onDoubleTap(L.pointerType);else if(n.type!==J.d.POINTERUP||this._currentMousePointerIdDown!==L.pointerId&&!C){if(n.type===J.d.POINTERMOVE)if(c||L.preventDefault(),this._pointA&&null===this._pointB){const c=L.clientX-this._pointA.x,b=L.clientY-this._pointA.y;this._pointA.x=L.clientX,this._pointA.y=L.clientY,this.onTouch(this._pointA,c,b)}else if(this._pointA&&this._pointB){const c=this._pointA.pointerId===L.pointerId?this._pointA:this._pointB;c.x=L.clientX,c.y=L.clientY;const b=this._pointA.x-this._pointB.x,A=this._pointA.y-this._pointB.y,h=b*b+A*A,s={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:L.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,o,h,t,s),t=s,o=h}}else{try{null===X||void 0===X||X.releasePointerCapture(L.pointerId)}catch(R){}C||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==L.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==L.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==o||t)&&(this.onMultiTouch(this._pointA,this._pointB,o,0,t,null),o=0,t=null),this._currentMousePointerIdDown=-1,this.onButtonUp(L),c||L.preventDefault()}else{try{null===X||void 0===X||X.setPointerCapture(L.pointerId)}catch(R){}if(null===this._pointA)this._pointA={x:L.clientX,y:L.clientY,pointerId:L.pointerId,type:L.pointerType};else{if(null!==this._pointB)return;this._pointB={x:L.clientX,y:L.clientY,pointerId:L.pointerId,type:L.pointerType}}-1!==this._currentMousePointerIdDown||C||(this._currentMousePointerIdDown=L.pointerId),this.onButtonDown(L),c||(L.preventDefault(),A&&A.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,J.d.POINTERDOWN|J.d.POINTERUP|J.d.POINTERMOVE|J.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,o=0,t=null,this.onLostFocus()},this._contextMenuBind=c=>this.onContextMenu(c),A&&A.addEventListener("contextmenu",this._contextMenuBind,!1);const n=this.camera.va().getEngine().getHostWindow();n&&W.d.RegisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}Xj(){if(this._onLostFocus){const c=this.camera.va().getEngine().getHostWindow();c&&W.d.UnregisterTopRootEvents(c,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const c=this.camera.va().getEngine().getInputElement();c&&c.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(c){}onTouch(c,b,A){}onMultiTouch(c,b,A,o,t,n){}onContextMenu(c){c.preventDefault()}onButtonDown(c){}onButtonUp(c){}onLostFocus(){}}(0,o.e)([(0,t.J)()],d.prototype,"buttons",void 0);class r extends d{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(c,b){if(0!==this.panningSensibility&&c&&b){const A=b.x-c.x,o=b.y-c.y;this.camera.inertialPanningX+=-A/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility}}_computePinchZoom(c,b){const A=this.camera.radius||r.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=A*Math.sqrt(c)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-c)*A*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-c)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(c,b,A){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=A/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(c,b,A,o,t,n){0===A&&null===t||0===o&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(A,o),this._computeMultiTouchPanning(t,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(o)-Math.sqrt(A))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(A,o),this._isPinching=!0):this._computeMultiTouchPanning(t,n)):this.multiTouchPanning?this._computeMultiTouchPanning(t,n):this.pinchZoom&&this._computePinchZoom(A,o))}onButtonDown(c){this._isPanClick=c.button===this.camera._panningMouseButton}onButtonUp(c){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}r.MinimumRadiusForPinch=.001,(0,o.e)([(0,t.J)()],r.prototype,"buttons",void 0),(0,o.e)([(0,t.J)()],r.prototype,"angularSensibilityX",void 0),(0,o.e)([(0,t.J)()],r.prototype,"angularSensibilityY",void 0),(0,o.e)([(0,t.J)()],r.prototype,"pinchPrecision",void 0),(0,o.e)([(0,t.J)()],r.prototype,"pinchDeltaPercentage",void 0),(0,o.e)([(0,t.J)()],r.prototype,"useNaturalPinchZoom",void 0),(0,o.e)([(0,t.J)()],r.prototype,"pinchZoom",void 0),(0,o.e)([(0,t.J)()],r.prototype,"panningSensibility",void 0),(0,o.e)([(0,t.J)()],r.prototype,"multiTouchPanning",void 0),(0,o.e)([(0,t.J)()],r.prototype,"multiTouchPanAndZoom",void 0),M.e.ArcRotateCameraPointersInput=r;var z=A(2211);class Y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(c){c=W.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const A=b.event;if(!A.metaKey)if(b.type===z.e.KEYDOWN){if(this._ctrlPressed=A.ctrlKey,this._altPressed=A.altKey,-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),A.preventDefault&&(c||A.preventDefault())}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){const b=this._keys.indexOf(A.keyCode);b>=0&&this._keys.splice(b,1),A.preventDefault&&(c||A.preventDefault())}})))}Xj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const c=this.camera;for(let b=0;b<this._keys.length;b++){const A=this._keys[b];-1!==this.keysLeft.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningX-=1/this.panningSensibility:c.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?c.inertialRadiusOffset+=1/this.zoomingSensibility:c.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningX+=1/this.panningSensibility:c.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?c.inertialRadiusOffset-=1/this.zoomingSensibility:c.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(A)&&c.useInputToRestoreState&&c.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,o.e)([(0,t.J)()],Y.prototype,"keysUp",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"keysDown",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"keysLeft",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"keysRight",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"keysReset",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"panningSensibility",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"zoomingSensibility",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"useAltToZoom",void 0),(0,o.e)([(0,t.J)()],Y.prototype,"angularSpeed",void 0),M.e.ArcRotateCameraKeyboardMoveInput=Y;var D=A(744),f=A(2214);class v{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new h.k(0,0,0),this._globalOffset=new h.k(0,0,0),this._inertialPanning=h.k.Zero()}_computeDeltaFromMouseWheelLegacyEvent(c,b){let A=0;const o=.01*c*this.wheelDeltaPercentage*b;return A=c>0?o/(1+this.wheelDeltaPercentage):o*(1+this.wheelDeltaPercentage),A}attachControl(c){c=W.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==J.d.POINTERWHEEL)return;const A=b.event;let o=0;const t=A.deltaMode===f.e.DOM_DELTA_LINE?40:1,n=-A.deltaY*t;if(this.customComputeDeltaFromMouseWheel)o=this.customComputeDeltaFromMouseWheel(n,this,A);else if(this.wheelDeltaPercentage){if(o=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),o>0){let c=this.camera.radius,b=this.camera.inertialRadiusOffset+o;for(let A=0;A<20&&!(c<=b)&&!(Math.abs(b*this.camera.inertia)<.001);A++)c-=b,b*=this.camera.inertia;c=(0,s.Clamp)(c,0,Number.MAX_VALUE),o=this._computeDeltaFromMouseWheelLegacyEvent(n,c)}}else o=n/(40*this.wheelPrecision);o&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(o)):this.camera.inertialRadiusOffset+=o),A.preventDefault&&(c||A.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,J.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.bk(0)}Xj(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const c=this.camera;0+c.inertialAlphaOffset+c.inertialBetaOffset+c.inertialRadiusOffset&&(this._updateHitPlane(),c.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(c.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const c=this.camera,b=c.target.Xd(c.position);this._hitPlane=D.c.FromPositionAndNormal(c.target,b)}_getPosition(){const c=this.camera,b=c.va(),A=b.createPickingRay(b.pointerX,b.pointerY,h.b.Identity(),c,!1);0===c.targetScreenOffset.x&&0===c.targetScreenOffset.y||(this._viewOffset.set(c.targetScreenOffset.x,c.targetScreenOffset.y,0),c.getViewMatrix().invertToRef(c._cameraTransformMatrix),this._globalOffset=h.k.TransformNormal(this._viewOffset,c._cameraTransformMatrix),A.origin.addInPlace(this._globalOffset));let o=0;return this._hitPlane&&(o=A.intersectsPlane(this._hitPlane)??0),A.origin.addInPlace(A.direction.scaleInPlace(o))}_zoomToMouse(c){const b=this.camera,A=1-b.inertia;if(b.lowerRadiusLimit){const o=b.lowerRadiusLimit??0;b.radius-(b.inertialRadiusOffset+c)/A<o&&(c=(b.radius-o)*A-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const o=b.upperRadiusLimit??0;b.radius-(b.inertialRadiusOffset+c)/A>o&&(c=(b.radius-o)*A-b.inertialRadiusOffset)}const o=c/A/b.radius,t=this._getPosition(),n=h.f.ak[6];t.subtractToRef(b.target,n),n.scaleInPlace(o),n.scaleInPlace(A),this._inertialPanning.addInPlace(n),b.inertialRadiusOffset+=c}_zeroIfClose(c){Math.abs(c.x)<R.d&&(c.x=0),Math.abs(c.y)<R.d&&(c.y=0),Math.abs(c.z)<R.d&&(c.z=0)}}(0,o.e)([(0,t.J)()],v.prototype,"wheelPrecision",void 0),(0,o.e)([(0,t.J)()],v.prototype,"zoomToMouseLocation",void 0),(0,o.e)([(0,t.J)()],v.prototype,"wheelDeltaPercentage",void 0),M.e.ArcRotateCameraMouseWheelInput=v;class G extends M.i{constructor(c){super(c)}addMouseWheel(){return this.add(new v),this}addPointers(){return this.add(new r),this}addKeyboard(){return this.add(new Y),this}}var P=A(633);function O(c,b){return isNaN(c)?b:c}L.b.AddNodeConstructor("ArcRotateCamera",((c,b)=>()=>new p(c,0,0,1,h.k.Zero(),b)));class p extends F.e{get target(){return this._target}set target(c){this.setTarget(c)}get targetHost(){return this._targetHost}set targetHost(c){c&&this.setTarget(c)}getTarget(){return this.target}get position(){return this._position}set position(c){this.setPosition(c)}set upVector(c){this._upToYMatrix||(this._yToUpMatrix=new h.b,this._upToYMatrix=new h.b,this._upVector=h.k.Zero()),c.normalize(),this._upVector.p(c),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){h.b.RotationAlignToRef(h.k.UpReadOnly,this._upVector,this._yToUpMatrix),h.b.RotationAlignToRef(this._upVector,h.k.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const c=this.inputs.attached.pointers;return c?c.angularSensibilityX:0}set angularSensibilityX(c){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=c)}get angularSensibilityY(){const c=this.inputs.attached.pointers;return c?c.angularSensibilityY:0}set angularSensibilityY(c){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=c)}get pinchPrecision(){const c=this.inputs.attached.pointers;return c?c.pinchPrecision:0}set pinchPrecision(c){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=c)}get pinchDeltaPercentage(){const c=this.inputs.attached.pointers;return c?c.pinchDeltaPercentage:0}set pinchDeltaPercentage(c){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=c)}get useNaturalPinchZoom(){const c=this.inputs.attached.pointers;return!!c&&c.useNaturalPinchZoom}set useNaturalPinchZoom(c){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=c)}get panningSensibility(){const c=this.inputs.attached.pointers;return c?c.panningSensibility:0}set panningSensibility(c){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=c)}get keysUp(){const c=this.inputs.attached.keyboard;return c?c.keysUp:[]}set keysUp(c){const b=this.inputs.attached.keyboard;b&&(b.keysUp=c)}get keysDown(){const c=this.inputs.attached.keyboard;return c?c.keysDown:[]}set keysDown(c){const b=this.inputs.attached.keyboard;b&&(b.keysDown=c)}get keysLeft(){const c=this.inputs.attached.keyboard;return c?c.keysLeft:[]}set keysLeft(c){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=c)}get keysRight(){const c=this.inputs.attached.keyboard;return c?c.keysRight:[]}set keysRight(c){const b=this.inputs.attached.keyboard;b&&(b.keysRight=c)}get wheelPrecision(){const c=this.inputs.attached.mousewheel;return c?c.wheelPrecision:0}set wheelPrecision(c){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=c)}get zoomToMouseLocation(){const c=this.inputs.attached.mousewheel;return!!c&&c.zoomToMouseLocation}set zoomToMouseLocation(c){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=c)}get wheelDeltaPercentage(){const c=this.inputs.attached.mousewheel;return c?c.wheelDeltaPercentage:0}set wheelDeltaPercentage(c){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=c)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(c){c!==this.useBouncingBehavior&&(c?(this._bouncingBehavior=new V,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(c){c!==this.useFramingBehavior&&(c?(this._framingBehavior=new y,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(c){c!==this.useAutoRotationBehavior&&(c?(this._autoRotationBehavior=new N,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(c,b,A,o,t,s){var L;let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(c,h.k.Zero(),s,C),L=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=h.k.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=h.h.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new h.b,this.panningAxis=new h.k(1,1,0),this._transformedDirection=new h.k,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new n.b,this.checkCollisions=!1,this.collisionRadius=new h.k(.5,.5,.5),this._previousPosition=h.k.Zero(),this._collisionVelocity=h.k.Zero(),this._newPosition=h.k.Zero(),this._computationVector=h.k.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new h.k(NaN,NaN,NaN),this._goalTargetScreenOffset=new h.h(NaN,NaN),this._onCollisionPositionChange=function(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A?(L.setPosition(b),L.Ae&&L.Ae(A)):L._previousPosition.p(L._position);const o=Math.cos(L.alpha),t=Math.sin(L.alpha),n=Math.cos(L.beta);let h=Math.sin(L.beta);0===h&&(h=1e-4);const s=L._getTargetPosition();L._computationVector.jd(L.radius*o*h,L.radius*n,L.radius*t*h),s.addToRef(L._computationVector,L._newPosition),L._position.p(L._newPosition);let C=L.upVector;L.allowUpsideDown&&L.beta<0&&(C=C.clone(),C=C.negate()),L._computeViewMatrix(L._position,s,C),L._viewMatrix.addAtIndex(12,L.targetScreenOffset.x),L._viewMatrix.addAtIndex(13,L.targetScreenOffset.y),L._collisionTriggered=!1},this._target=h.k.Zero(),t&&this.setTarget(t),this.alpha=b,this.beta=A,this.radius=o,this.getViewMatrix(),this.inputs=new G(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new h.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=h.h.Zero()}_updateCache(c){c||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const c=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?c.addToRef(this._targetBoundingCenter,this._target):this._target.p(c)}const c=this._getLockedTargetPosition();return c||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>R.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,n=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=n?this._currentInterpolationFactor=n:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=O(c,this._goalAlpha),this._goalBeta=O(b,this._goalBeta),this._goalRadius=O(A,this._goalRadius),this._goalTarget.set(O(o.x,this._goalTarget.x),O(o.y,this._goalTarget.y),O(o.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(O(t.x,this._goalTargetScreenOffset.x),O(t.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,s.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,s.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,s.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,s.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(c,b){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const t=arguments;b=W.d.BackCompatCameraNoPreventDefault(t),this._useCtrlForPanning=A,this._panningMouseButton=o,"boolean"===typeof t[0]&&(t.length>1&&(this._useCtrlForPanning=t[1]),t.length>2&&(this._panningMouseButton=t[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Xj(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let c=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){c=!0;const b=this.invertRotation?-1:1,A=this._calculateHandednessMultiplier();let o=this.inertialAlphaOffset*A;this.beta<0&&(o*=-1),this.alpha+=o*b,this.beta+=this.inertialBetaOffset*b,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<R.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<R.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*R.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){c=!0;const b=new h.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),b.multiplyInPlace(this.panningAxis),h.k.TransformNormalToRef(b,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const c=this.upVector,b=h.k.CrossToRef(this._transformedDirection,c,this._transformedDirection);h.k.CrossToRef(c,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);h.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const c=h.f.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.transposeToRef(c),h.k.TransformCoordinatesToRef(this._transformedDirection,c,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*R.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*R.d&&(this.inertialPanningY=0)}if(c)this.stopInterpolation();else if(this._isInterpolating){let c=!1;const b=this._scene.getEngine().getDeltaTime()/1e3,A=1-Math.pow(2,-b/this._currentInterpolationFactor),o=O(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const b=h.f.ak[0].set(O(this._goalTarget.x,this._target.x),O(this._goalTarget.y,this._target.y),O(this._goalTarget.z,this._target.z));h.k.LerpToRef(this.target,b,A,this._target),10*h.k.Distance(this.target,b)/o<R.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(b),this.setTarget(this.target,!1,!0,!0)):c=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const b=h.e.RotationAlphaBetaGammaToRef(O(this._goalAlpha,this.alpha),O(this._goalBeta,this.beta),0,h.f.Quaternion[0]),o=h.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,h.f.Quaternion[1]),t=h.e.SlerpToRef(o,b,A,h.f.Quaternion[2]);t.normalize();const n=t.toAlphaBetaGammaToRef(h.f.ak[0]);if(this.alpha=n.x,this.beta=n.y,t.isApprox(b,R.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const c=b.toAlphaBetaGammaToRef(h.f.ak[0]);this.alpha=c.x,this.beta=c.y}else c=!0}if(isNaN(this._goalRadius)||(this.radius+=(o-this.radius)*A,Math.abs(o/this.radius-1)<R.d?(this._goalRadius=NaN,this.radius=o):c=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const b=h.f.Vector2[0].set(O(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),O(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));h.h.LerpToRef(this.targetScreenOffset,b,A,this.targetScreenOffset),h.h.Distance(this.targetScreenOffset,b)<R.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(b)):c=!0}this._isInterpolating=c}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const c=this.alpha;var b,A;this.alpha=function(c){let b=Math.PI/2;return 0===c.x&&0===c.z||(b=Math.acos(c.x/Math.sqrt(Math.pow(c.x,2)+Math.pow(c.z,2)))),c.z<0&&(b=2*Math.PI-b),b}(this._computationVector),this.beta=(b=this._computationVector.y,A=this.radius,Math.acos(b/A));const o=Math.round((c-this.alpha)/(2*Math.PI));this.alpha+=2*o*Math.PI,this._checkLimits()}setPosition(c){this._position.equals(c)||(this._position.p(c),this.rebuildAnglesAndRadius())}setTarget(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(o=this.overrideCloneAlphaBetaRadius??o,c.Zj)b&&c.getBoundingInfo?this._targetBoundingCenter=c.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,c.Zj(),this._targetHost=c,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=c,o=this._getTargetPosition();if(o&&!A&&o.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}o||this.rebuildAnglesAndRadius()}_getViewMatrix(){const c=Math.cos(this.alpha),b=Math.sin(this.alpha),A=Math.cos(this.beta);let o=Math.sin(this.beta);0===o&&(o=1e-4),0===this.radius&&(this.radius=1e-4);const t=this._getTargetPosition();if(this._computationVector.jd(this.radius*c*o,this.radius*A,this.radius*b*o),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),t.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const c=this.va().collisionCoordinator;this._collider||(this._collider=c.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,c.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let c=this.upVector;this.allowUpsideDown&&o<0&&(c=c.negate()),this._computeViewMatrix(this._position,t,c),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(t),this._viewMatrix}zoomOn(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c=c||this.va().meshes;const A=C.d.MinMax(c);let o=this._calculateLowerRadiusFromModelBoundingSphere(A.min,A.max);if(o=Math.max(Math.min(o,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=o*this.zoomOnFactor,this.mode===j.c.ORTHOGRAPHIC_CAMERA){const c=this.va().getEngine().getAspectRatio(this),b=o*this.zoomOnFactor/2;this.orthoLeft=-b*c,this.orthoRight=b*c,this.orthoBottom=-b,this.orthoTop=b}this.focusOn({min:A.min,max:A.max,distance:o},b)}focusOn(c){let b,A,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===c.min){const o=c||this.va().meshes;b=C.d.MinMax(o),A=h.k.Distance(b.min,b.max)}else{b=c,A=c.distance}this._target=C.d.Center(b),o||(this.maxZ=2*A)}createRigCamera(c,b){let A=0;switch(this.cameraRigMode){case j.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case j.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case j.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case j.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case j.c.RIG_MODE_VR:A=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case j.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:A=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const o=new p(c,this.alpha+A,this.beta,this.radius,this._target,this.va());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o.mode=this.mode,o.orthoLeft=this.orthoLeft,o.orthoRight=this.orthoRight,o.orthoBottom=this.orthoBottom,o.orthoTop=this.orthoTop,o}_updateRigCameras(){const c=this._rigCameras[0],b=this._rigCameras[1];switch(c.beta=b.beta=this.beta,this.cameraRigMode){case j.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case j.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case j.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case j.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case j.c.RIG_MODE_VR:c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case j.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const o=h.k.Distance(c,b),t=this.va().getEngine().getAspectRatio(this),n=Math.tan(this.fov/2),s=n*t,L=.5*o*A,C=L*Math.sqrt(1+1/(s*s)),J=L*Math.sqrt(1+1/(n*n));return Math.max(C,J)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,o.e)([(0,t.J)()],p.prototype,"alpha",void 0),(0,o.e)([(0,t.J)()],p.prototype,"beta",void 0),(0,o.e)([(0,t.J)()],p.prototype,"radius",void 0),(0,o.e)([(0,t.J)()],p.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,o.e)([(0,t.I)("target")],p.prototype,"_target",void 0),(0,o.e)([(0,t.C)("targetHost")],p.prototype,"_targetHost",void 0),(0,o.e)([(0,t.J)()],p.prototype,"inertialAlphaOffset",void 0),(0,o.e)([(0,t.J)()],p.prototype,"inertialBetaOffset",void 0),(0,o.e)([(0,t.J)()],p.prototype,"inertialRadiusOffset",void 0),(0,o.e)([(0,t.J)()],p.prototype,"lowerAlphaLimit",void 0),(0,o.e)([(0,t.J)()],p.prototype,"upperAlphaLimit",void 0),(0,o.e)([(0,t.J)()],p.prototype,"lowerBetaLimit",void 0),(0,o.e)([(0,t.J)()],p.prototype,"upperBetaLimit",void 0),(0,o.e)([(0,t.J)()],p.prototype,"lowerRadiusLimit",void 0),(0,o.e)([(0,t.J)()],p.prototype,"upperRadiusLimit",void 0),(0,o.e)([(0,t.J)()],p.prototype,"lowerTargetYLimit",void 0),(0,o.e)([(0,t.J)()],p.prototype,"inertialPanningX",void 0),(0,o.e)([(0,t.J)()],p.prototype,"inertialPanningY",void 0),(0,o.e)([(0,t.J)()],p.prototype,"pinchToPanMaxDistance",void 0),(0,o.e)([(0,t.J)()],p.prototype,"panningDistanceLimit",void 0),(0,o.e)([(0,t.I)()],p.prototype,"panningOriginTarget",void 0),(0,o.e)([(0,t.J)()],p.prototype,"panningInertia",void 0),(0,o.e)([(0,t.J)()],p.prototype,"zoomToMouseLocation",null),(0,o.e)([(0,t.J)()],p.prototype,"zoomOnFactor",void 0),(0,o.e)([(0,t.G)()],p.prototype,"targetScreenOffset",void 0),(0,o.e)([(0,t.J)()],p.prototype,"allowUpsideDown",void 0),(0,o.e)([(0,t.J)()],p.prototype,"useInputToRestoreState",void 0),(0,o.e)([(0,t.J)()],p.prototype,"restoreStateInterpolationFactor",void 0),(0,P.d)("BABYLON.ArcRotateCamera",p)},12698:(c,b,A)=>{"use strict";A.d(b,{e:()=>h,i:()=>s});var o=A(531),t=A(714),n=A(663),h={};class s{constructor(c){this.attachedToElement=!1,this.attached={},this.camera=c,this.checkInputs=()=>{}}add(c){const b=c.getSimpleName();this.attached[b]?o.c.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=c,c.camera=this.camera,c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c))),this.attachedToElement&&c.attachControl(this.noPreventDefault))}remove(c){for(const b in this.attached){const A=this.attached[b];if(A===c)return A.Xj(),A.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(c){for(const b in this.attached){const A=this.attached[b];A.getClassName()===c&&(A.Xj(),A.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(c){const b=this.checkInputs;return()=>{b(),c()}}attachInput(c){this.attachedToElement&&c.attachControl(this.noPreventDefault)}attachElement(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){c=!n.c.ForceAttachControlToAlwaysPreventDefault&&c,this.attachedToElement=!0,this.noPreventDefault=c;for(const b in this.attached)this.attached[b].attachControl(c)}}detachElement(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].Xj(),c&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const c in this.attached){const b=this.attached[c];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(c){const b={};for(const A in this.attached){const c=this.attached[A],o=t.c.Serialize(c);b[c.getClassName()]=o}c.inputsmgr=b}parse(c){const b=c.inputsmgr;if(b){this.clear();for(const c in b){const A=h[c];if(A){const o=b[c],n=t.c.Parse((()=>new A),o,null);this.add(n)}}}else for(const A in this.attached){const b=h[this.attached[A].getClassName()];if(b){const o=t.c.Parse((()=>new b),c,null);this.remove(this.attached[A]),this.add(o)}}}}},12696:(c,b,A)=>{"use strict";A.d(b,{d:()=>d});var o=A(672),t=A(674),n=A(688),h=A(11843),s=A(12698),L=A(2211),C=A(525);class J{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(c){c=C.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const A=b.event;if(!A.metaKey)if(b.type===L.e.KEYDOWN){if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),c||A.preventDefault()}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){const b=this._keys.indexOf(A.keyCode);b>=0&&this._keys.splice(b,1),c||A.preventDefault()}})))}Xj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const c=this.camera;for(let b=0;b<this._keys.length;b++){const A=this._keys[b],o=c._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(A)?c._localDirection.jd(-o,0,0):-1!==this.keysUp.indexOf(A)?c._localDirection.jd(0,0,o):-1!==this.keysRight.indexOf(A)?c._localDirection.jd(o,0,0):-1!==this.keysDown.indexOf(A)?c._localDirection.jd(0,0,-o):-1!==this.keysUpward.indexOf(A)?c._localDirection.jd(0,o,0):-1!==this.keysDownward.indexOf(A)?c._localDirection.jd(0,-o,0):-1!==this.keysRotateLeft.indexOf(A)?(c._localDirection.jd(0,0,0),c.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(A)?(c._localDirection.jd(0,0,0),c.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(A)?(c._localDirection.jd(0,0,0),c.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(A)&&(c._localDirection.jd(0,0,0),c.cameraRotation.x+=this._getLocalRotation()),c.va().useRightHandedSystem&&(c._localDirection.z*=-1),c.getViewMatrix().invertToRef(c._cameraTransformMatrix),n.k.TransformNormalToRef(c._localDirection,c._cameraTransformMatrix,c._transformedDirection),c.cameraDirection.addInPlace(c._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const c=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*c}}(0,o.e)([(0,t.J)()],J.prototype,"keysUp",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysUpward",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysDown",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysDownward",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysLeft",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysRight",void 0),(0,o.e)([(0,t.J)()],J.prototype,"rotationSpeed",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysRotateLeft",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysRotateRight",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysRotateUp",void 0),(0,o.e)([(0,t.J)()],J.prototype,"keysRotateDown",void 0),s.e.FreeCameraKeyboardMoveInput=J;var X=A(518),R=A(2204);class N{constructor(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=c,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new X.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(c){c=C.d.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),A=b.getInputElement();this._pointerInput||(this._pointerInput=o=>{const t=o.event,n="touch"===t.pointerType;if(!this.touchEnabled&&n)return;if(o.type!==R.d.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const h=t.target;if(o.type===R.d.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=t.pointerId;try{null===h||void 0===h||h.setPointerCapture(t.pointerId)}catch(s){}-1===this._currentActiveButton&&(this._currentActiveButton=t.button),this._previousPosition={x:t.clientX,y:t.clientY},c||(t.preventDefault(),A&&A.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(o.event)}else if(o.type===R.d.POINTERUP){if(n&&this._activePointerId!==t.pointerId||!n&&this._currentActiveButton!==t.button)return;try{null===h||void 0===h||h.releasePointerCapture(t.pointerId)}catch(s){}this._currentActiveButton=-1,this._previousPosition=null,c||t.preventDefault(),this._activePointerId=-1}else if(o.type===R.d.POINTERMOVE&&(this._activePointerId===t.pointerId||!n))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(o.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),A=(t.clientX-this._previousPosition.x)*b,o=t.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=A/this.angularSensibility,this.camera.cameraRotation.x+=o/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:A,offsetY:o}),this._previousPosition={x:t.clientX,y:t.clientY},c||t.preventDefault()}}),this._onMouseMove=A=>{if(!b.isPointerLock)return;const o=this.camera._calculateHandednessMultiplier(),t=A.movementX*o;this.camera.cameraRotation.y+=t/this.angularSensibility;const n=A.movementY;this.camera.cameraRotation.x+=n/this.angularSensibility,this._previousPosition=null,c||A.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,R.d.POINTERDOWN|R.d.POINTERUP|R.d.POINTERMOVE),A&&(this._contextMenuBind=c=>this.onContextMenu(c),A.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(c){c.preventDefault()}Xj(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const c=this.camera.getEngine().getInputElement();c&&c.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,o.e)([(0,t.J)()],N.prototype,"buttons",void 0),(0,o.e)([(0,t.J)()],N.prototype,"angularSensibility",void 0),s.e.FreeCameraMouseInput=N;var k,E=A(2214);class V{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new X.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(c){c=C.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==R.d.POINTERWHEEL)return;const A=b.event,o=A.deltaMode===E.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*o*A.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*o*A.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*o*A.deltaZ/this._normalize,A.preventDefault&&(c||A.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,R.d.POINTERWHEEL)}Xj(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,o.e)([(0,t.J)()],V.prototype,"wheelPrecisionX",void 0),(0,o.e)([(0,t.J)()],V.prototype,"wheelPrecisionY",void 0),(0,o.e)([(0,t.J)()],V.prototype,"wheelPrecisionZ",void 0),function(c){c[c.MoveRelative=0]="MoveRelative",c[c.RotateRelative=1]="RotateRelative",c[c.MoveScene=2]="MoveScene"}(k||(k={}));class y extends V{constructor(){super(...arguments),this._moveRelative=n.k.Zero(),this._rotateRelative=n.k.Zero(),this._moveScene=n.k.Zero(),this._wheelXAction=k.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=k.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(c){null===c&&this._wheelXAction!==k.MoveRelative||(this._wheelXAction=k.MoveRelative,this._wheelXActionCoordinate=c)}get wheelXMoveRelative(){return this._wheelXAction!==k.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(c){null===c&&this._wheelYAction!==k.MoveRelative||(this._wheelYAction=k.MoveRelative,this._wheelYActionCoordinate=c)}get wheelYMoveRelative(){return this._wheelYAction!==k.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(c){null===c&&this._wheelZAction!==k.MoveRelative||(this._wheelZAction=k.MoveRelative,this._wheelZActionCoordinate=c)}get wheelZMoveRelative(){return this._wheelZAction!==k.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(c){null===c&&this._wheelXAction!==k.RotateRelative||(this._wheelXAction=k.RotateRelative,this._wheelXActionCoordinate=c)}get wheelXRotateRelative(){return this._wheelXAction!==k.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(c){null===c&&this._wheelYAction!==k.RotateRelative||(this._wheelYAction=k.RotateRelative,this._wheelYActionCoordinate=c)}get wheelYRotateRelative(){return this._wheelYAction!==k.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(c){null===c&&this._wheelZAction!==k.RotateRelative||(this._wheelZAction=k.RotateRelative,this._wheelZActionCoordinate=c)}get wheelZRotateRelative(){return this._wheelZAction!==k.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(c){null===c&&this._wheelXAction!==k.MoveScene||(this._wheelXAction=k.MoveScene,this._wheelXActionCoordinate=c)}get wheelXMoveScene(){return this._wheelXAction!==k.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(c){null===c&&this._wheelYAction!==k.MoveScene||(this._wheelYAction=k.MoveScene,this._wheelYActionCoordinate=c)}get wheelYMoveScene(){return this._wheelYAction!==k.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(c){null===c&&this._wheelZAction!==k.MoveScene||(this._wheelZAction=k.MoveScene,this._wheelZActionCoordinate=c)}get wheelZMoveScene(){return this._wheelZAction!==k.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.bk(0),this._rotateRelative.bk(0),this._moveScene.bk(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const c=n.b.Zero();this.camera.getViewMatrix().invertToRef(c);const b=n.k.Zero();n.k.TransformNormalToRef(this._moveRelative,c,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(c,b,A){if(0===c)return;if(null===b||null===A)return;let o=null;switch(b){case k.MoveRelative:o=this._moveRelative;break;case k.RotateRelative:o=this._rotateRelative;break;case k.MoveScene:o=this._moveScene}switch(A){case 0:o.set(c,0,0);break;case 1:o.set(0,c,0);break;case 2:o.set(0,0,c)}}}(0,o.e)([(0,t.J)()],y.prototype,"wheelXMoveRelative",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelYMoveRelative",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelZMoveRelative",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelXRotateRelative",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelYRotateRelative",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelZRotateRelative",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelXMoveScene",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelYMoveScene",null),(0,o.e)([(0,t.J)()],y.prototype,"wheelZMoveScene",null),s.e.FreeCameraMouseWheelInput=y;class j{constructor(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=c,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=C.d.IsSafari()}attachControl(c){c=C.d.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=A=>{const o=A.event,t="mouse"===o.pointerType||this._isSafari&&"undefined"===typeof o.pointerType;if(this.allowMouse||!t)if(A.type===R.d.POINTERDOWN){if(c||o.preventDefault(),this._pointerPressed.push(o.pointerId),1!==this._pointerPressed.length)return;b={x:o.clientX,y:o.clientY}}else if(A.type===R.d.POINTERUP){c||o.preventDefault();const A=this._pointerPressed.indexOf(o.pointerId);if(-1===A)return;if(this._pointerPressed.splice(A,1),0!=A)return;b=null,this._offsetX=null,this._offsetY=null}else if(A.type===R.d.POINTERMOVE){if(c||o.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(o.pointerId))return;this._offsetX=o.clientX-b.x,this._offsetY=-(o.clientY-b.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,R.d.POINTERDOWN|R.d.POINTERUP|R.d.POINTERMOVE),this._onLostFocus){const c=this.camera.getEngine().getInputElement();c&&c.addEventListener("blur",this._onLostFocus)}}Xj(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const c=this.camera.getEngine().getInputElement();c&&c.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const c=this.camera,b=c._calculateHandednessMultiplier();c.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)c.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=c._computeLocalCameraSpeed(),A=new n.k(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);n.b.RotationYawPitchRollToRef(c.rotation.y,c.rotation.x,0,c._cameraRotationMatrix),c.cameraDirection.addInPlace(n.k.TransformCoordinates(A,c._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,o.e)([(0,t.J)()],j.prototype,"touchAngularSensibility",void 0),(0,o.e)([(0,t.J)()],j.prototype,"touchMoveSensibility",void 0),s.e.FreeCameraTouchInput=j;class F extends s.i{constructor(c){super(c),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new J),this}addMouse(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new N(c),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new y,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new j),this}clear(){super.clear(),this._mouseInput=null}}var M=A(633),W=A(589);class d extends h.e{get angularSensibility(){const c=this.inputs.attached.mouse;return c?c.angularSensibility:0}set angularSensibility(c){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=c)}get keysUp(){const c=this.inputs.attached.keyboard;return c?c.keysUp:[]}set keysUp(c){const b=this.inputs.attached.keyboard;b&&(b.keysUp=c)}get keysUpward(){const c=this.inputs.attached.keyboard;return c?c.keysUpward:[]}set keysUpward(c){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=c)}get keysDown(){const c=this.inputs.attached.keyboard;return c?c.keysDown:[]}set keysDown(c){const b=this.inputs.attached.keyboard;b&&(b.keysDown=c)}get keysDownward(){const c=this.inputs.attached.keyboard;return c?c.keysDownward:[]}set keysDownward(c){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=c)}get keysLeft(){const c=this.inputs.attached.keyboard;return c?c.keysLeft:[]}set keysLeft(c){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=c)}get keysRight(){const c=this.inputs.attached.keyboard;return c?c.keysRight:[]}set keysRight(c){const b=this.inputs.attached.keyboard;b&&(b.keysRight=c)}get keysRotateLeft(){const c=this.inputs.attached.keyboard;return c?c.keysRotateLeft:[]}set keysRotateLeft(c){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=c)}get keysRotateRight(){const c=this.inputs.attached.keyboard;return c?c.keysRotateRight:[]}set keysRotateRight(c){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=c)}get keysRotateUp(){const c=this.inputs.attached.keyboard;return c?c.keysRotateUp:[]}set keysRotateUp(c){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=c)}get keysRotateDown(){const c=this.inputs.attached.keyboard;return c?c.keysRotateDown:[]}set keysRotateDown(c){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=c)}constructor(c,b,A){var o;super(c,b,A,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),o=this,this.ellipsoid=new n.k(.5,1,.5),this.ellipsoidOffset=new n.k(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=n.k.Zero(),this._diffPosition=n.k.Zero(),this._newPosition=n.k.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o._newPosition.p(b),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o._diffPosition.length()>W.c.CollisionsEpsilon&&(o.position.addToRef(o._diffPosition,o._deferredPositionUpdate),o._deferOnly?o._deferredUpdated=!0:o.position.p(o._deferredPositionUpdate),o.Ae&&A&&o.Ae(A))},this.inputs=new F(this),this.inputs.addKeyboard().addMouse()}attachControl(c,b){b=C.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}Xj(){this.inputs.detachElement(),this.cameraDirection=new n.k(0,0,0),this.cameraRotation=new n.h(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(c){this._collisionMask=isNaN(c)?-1:c}_collideWithWorld(c){let b;b=this.parent?n.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const A=this.va().collisionCoordinator;this._collider||(this._collider=A.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let o=c;this.applyGravity&&(o=c.add(this.va().gravity)),A.getNewPosition(this._oldPosition,o,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=n.k.Zero(),this._transformedDirection=n.k.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(c){this._needMoveForGravity=c}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,o.e)([(0,t.I)()],d.prototype,"ellipsoid",void 0),(0,o.e)([(0,t.I)()],d.prototype,"ellipsoidOffset",void 0),(0,o.e)([(0,t.J)()],d.prototype,"checkCollisions",void 0),(0,o.e)([(0,t.J)()],d.prototype,"applyGravity",void 0),(0,M.d)("BABYLON.FreeCamera",d)},13093:(c,b,A)=>{"use strict";A.d(b,{b:()=>n});var o=A(684),t=A(13100);class n{constructor(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=A,this.fl=[],this._maxBlockCapacity=b||64,this._selectionContent=new o.e(1024),this._creationFunc=c}update(c,b,A){t.c._CreateBlocks(c,b,A,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}vk(c){for(let b=0;b<this.Qk.length;b++){this.Qk[b].addEntry(c)}}wk(c){for(let b=0;b<this.Qk.length;b++){this.Qk[b].removeEntry(c)}}select(c,b){this._selectionContent.reset();for(let A=0;A<this.Qk.length;A++){this.Qk[A].select(c,this._selectionContent,b)}return b?this._selectionContent.concat(this.fl):this._selectionContent.concatWithNoDuplicate(this.fl),this._selectionContent}intersects(c,b,A){this._selectionContent.reset();for(let o=0;o<this.Qk.length;o++){this.Qk[o].intersects(c,b,this._selectionContent,A)}return A?this._selectionContent.concat(this.fl):this._selectionContent.concatWithNoDuplicate(this.fl),this._selectionContent}intersectsRay(c){this._selectionContent.reset();for(let b=0;b<this.Qk.length;b++){this.Qk[b].intersectsRay(c,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.fl),this._selectionContent}}n.CreationFuncForMeshes=(c,b)=>{const A=c.getBoundingInfo();!c.isBlocked&&A.boundingBox.intersectsMinMax(b.hl,b.il)&&b.entries.push(c)},n.CreationFuncForSubMeshes=(c,b)=>{c.getBoundingInfo().boundingBox.intersectsMinMax(b.hl,b.il)&&b.entries.push(c)}},13100:(c,b,A)=>{"use strict";A.d(b,{c:()=>n});var o=A(688),t=A(782);class n{constructor(c,b,A,o,t,n){this.entries=[],this.jl=new Array,this._capacity=A,this._depth=o,this._maxDepth=t,this._creationFunc=n,this._minPoint=c,this._maxPoint=b,this.jl.push(c.clone()),this.jl.push(b.clone()),this.jl.push(c.clone()),this.jl[2].x=b.x,this.jl.push(c.clone()),this.jl[3].y=b.y,this.jl.push(c.clone()),this.jl[4].z=b.z,this.jl.push(b.clone()),this.jl[5].z=c.z,this.jl.push(b.clone()),this.jl[6].x=c.x,this.jl.push(b.clone()),this.jl[7].y=c.y}get xb(){return this._capacity}get hl(){return this._minPoint}get il(){return this._maxPoint}addEntry(c){if(this.Qk)for(let b=0;b<this.Qk.length;b++){this.Qk[b].addEntry(c)}else this._creationFunc(c,this),this.entries.length>this.xb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(c){if(this.Qk){for(let b=0;b<this.Qk.length;b++){this.Qk[b].removeEntry(c)}return}const b=this.entries.indexOf(c);b>-1&&this.entries.splice(b,1)}addEntries(c){for(let b=0;b<c.length;b++){const A=c[b];this.addEntry(A)}}select(c,b,A){if(t.d.IsInFrustum(this.jl,c)){if(this.Qk){for(let o=0;o<this.Qk.length;o++){this.Qk[o].select(c,b,A)}return}A?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(c,b,A,o){if(t.d.IntersectsSphere(this._minPoint,this._maxPoint,c,b)){if(this.Qk){for(let t=0;t<this.Qk.length;t++){this.Qk[t].intersects(c,b,A,o)}return}o?A.concat(this.entries):A.concatWithNoDuplicate(this.entries)}}intersectsRay(c,b){if(c.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Qk){for(let A=0;A<this.Qk.length;A++){this.Qk[A].intersectsRay(c,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){n._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(c,b,A,t,h,s,L,C){L.Qk=new Array;const J=new o.k((b.x-c.x)/2,(b.y-c.y)/2,(b.z-c.z)/2);for(let o=0;o<2;o++)for(let b=0;b<2;b++)for(let X=0;X<2;X++){const R=c.add(J.multiplyByFloats(o,b,X)),N=c.add(J.multiplyByFloats(o+1,b+1,X+1)),k=new n(R,N,t,h+1,s,C);k.addEntries(A),L.Qk.push(k)}}}},13107:(c,b,A)=>{"use strict";A.d(b,{e:()=>J});var o=A(2186),t=A(688),n=A(821),h=A(12465),s=A(877),L=A(13093),C=A(550);o.d.prototype.createOrUpdateSelectionOctree=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,A=this._getComponent(s.e.NAME_OCTREE);A||(A=new J(this),this.bb(A)),this.dl||(this.dl=new L.b(L.b.CreationFuncForMeshes,c,b));const o=this.getWorldExtends();return this.dl.update(o.min,o.max,this.meshes),this.dl},Object.defineProperty(o.d.prototype,"selectionOctree",{get:function(){return this.dl},enumerable:!0,configurable:!0}),n.d.prototype.createOrUpdateSubmeshesOctree=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const A=this.va();let o=A._getComponent(s.e.NAME_OCTREE);o||(o=new J(A),A.bb(o)),this._submeshesOctree||(this._submeshesOctree=new L.b(L.b.CreationFuncForSubMeshes,c,b)),this.Zj(!0);const t=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(t.minimumWorld,t.maximumWorld,this.lk),this._submeshesOctree};class J{constructor(c){this.name=s.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new h.d(t.k.Zero(),new t.k(1,1,1)),(c=c||C.c.LastCreatedScene)&&(this.yd=c,this.yd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.yd.getActiveSubMeshCandidates=c=>this.getActiveSubMeshCandidates(c),this.yd.getCollidingSubMeshCandidates=(c,b)=>this.getCollidingSubMeshCandidates(c,b),this.yd.getIntersectingSubMeshCandidates=(c,b)=>this.getIntersectingSubMeshCandidates(c,b))}register(){this.yd.onMeshRemovedObservable.add((c=>{const b=this.yd.selectionOctree;if(void 0!==b&&null!==b){const A=b.fl.indexOf(c);-1!==A&&b.fl.splice(A,1)}})),this.yd.onMeshImportedObservable.add((c=>{const b=this.yd.selectionOctree;void 0!==b&&null!==b&&b.vk(c)}))}getActiveMeshCandidates(){var c;return(null===(c=this.yd.dl)||void 0===c?void 0:c.select(this.yd.frustumPlanes))||this.yd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(c){if(c._submeshesOctree&&c.useOctreeForRenderingSelection){return c._submeshesOctree.select(this.yd.frustumPlanes)}return this.yd._getDefaultSubMeshCandidates(c)}getIntersectingSubMeshCandidates(c,b){if(c._submeshesOctree&&c.useOctreeForPicking){h.d.TransformToRef(b,c.getWorldMatrix(),this._tempRay);return c._submeshesOctree.intersectsRay(this._tempRay)}return this.yd._getDefaultSubMeshCandidates(c)}getCollidingSubMeshCandidates(c,b){if(c._submeshesOctree&&c.useOctreeForCollisions){const A=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return c._submeshesOctree.intersects(b._basePointWorld,A)}return this.yd._getDefaultSubMeshCandidates(c)}rebuild(){}dispose(){}}},12465:(c,b,A)=>{"use strict";A.d(b,{d:()=>N});var o=A(2186),t=A(663),n=A(693),h=A(688),s=A(699),L=A(771),C=A(833),J=A(550),X=A(2220);const R={internalPickerForMesh:void 0};class N{constructor(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.d;this.origin=c,this.direction=b,this.length=A,this.epsilon=o}clone(){return new N(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=N._TmpVector3[0].jd(c.x-A,c.y-A,c.z-A),t=N._TmpVector3[1].jd(b.x+A,b.y+A,b.z+A);let n,h,s,L,C=0,J=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<o.x||this.origin.x>t.x)return!1}else if(n=1/this.direction.x,h=(o.x-this.origin.x)*n,s=(t.x-this.origin.x)*n,s===-1/0&&(s=1/0),h>s&&(L=h,h=s,s=L),C=Math.max(h,C),J=Math.min(s,J),C>J)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<o.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,h=(o.y-this.origin.y)*n,s=(t.y-this.origin.y)*n,s===-1/0&&(s=1/0),h>s&&(L=h,h=s,s=L),C=Math.max(h,C),J=Math.min(s,J),C>J)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<o.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,h=(o.z-this.origin.z)*n,s=(t.z-this.origin.z)*n,s===-1/0&&(s=1/0),h>s&&(L=h,h=s,s=L),C=Math.max(h,C),J=Math.min(s,J),C>J)return!1;return!0}intersectsBox(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(c.minimum,c.maximum,b)}intersectsSphere(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=c.center.x-this.origin.x,o=c.center.y-this.origin.y,t=c.center.z-this.origin.z,n=A*A+o*o+t*t,h=c.radius+b,s=h*h;if(n<=s)return!0;const L=A*this.direction.x+o*this.direction.y+t*this.direction.z;if(L<0)return!1;return n-L*L<=s}intersectsTriangle(c,b,A){const o=N._TmpVector3[0],t=N._TmpVector3[1],n=N._TmpVector3[2],s=N._TmpVector3[3],C=N._TmpVector3[4];b.subtractToRef(c,o),A.subtractToRef(c,t),h.k.CrossToRef(this.direction,t,n);const J=h.k.Dot(o,n);if(0===J)return null;const X=1/J;this.origin.subtractToRef(c,s);const R=h.k.Dot(s,n)*X;if(R<-this.epsilon||R>1+this.epsilon)return null;h.k.CrossToRef(s,o,C);const k=h.k.Dot(this.direction,C)*X;if(k<-this.epsilon||R+k>1+this.epsilon)return null;const E=h.k.Dot(t,C)*X;return E>this.length?null:new L.d(1-R-k,R,E)}intersectsPlane(c){let b;const A=h.k.Dot(c.ik,this.direction);if(Math.abs(A)<9.99999997475243e-7)return null;{const o=h.k.Dot(c.ik,this.origin);return b=(-c.d-o)/A,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(c){case"y":{const c=(this.origin.y-b)/this.direction.y;return c>0?null:new h.k(this.origin.x+this.direction.x*-c,b,this.origin.z+this.direction.z*-c)}case"x":{const c=(this.origin.x-b)/this.direction.x;return c>0?null:new h.k(b,this.origin.y+this.direction.y*-c,this.origin.z+this.direction.z*-c)}case"z":{const c=(this.origin.z-b)/this.direction.z;return c>0?null:new h.k(this.origin.x+this.direction.x*-c,this.origin.y+this.direction.y*-c,b)}default:return null}}intersectsMesh(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=h.f.Matrix[0];return c.getWorldMatrix().invertToRef(s),this._tmpRay?N.TransformToRef(this,s,this._tmpRay):this._tmpRay=N.Transform(this,s),c.intersects(this._tmpRay,b,A,o,t,n)}intersectsMeshes(c,b,A){A?A.length=0:A=[];for(let o=0;o<c.length;o++){const t=this.intersectsMesh(c[o],b);t.hit&&A.push(t)}return A.sort(this._comparePickingInfo),A}_comparePickingInfo(c,b){return c.distance<b.distance?-1:c.distance>b.distance?1:0}intersectionSegment(c,b,A){const o=this.origin,t=h.f.ak[0],n=h.f.ak[1],s=h.f.ak[2],L=h.f.ak[3];b.subtractToRef(c,t),this.direction.scaleToRef(N._Rayl,s),o.addToRef(s,n),c.subtractToRef(o,L);const C=h.k.Dot(t,t),J=h.k.Dot(t,s),X=h.k.Dot(s,s),R=h.k.Dot(t,L),k=h.k.Dot(s,L),E=C*X-J*J;let V,y,j=E,F=E;E<N._Smallnum?(V=0,j=1,y=k,F=X):(V=J*k-X*R,y=C*k-J*R,V<0?(V=0,y=k,F=X):V>j&&(V=j,y=k+J,F=X)),y<0?(y=0,-R<0?V=0:-R>C?V=j:(V=-R,j=C)):y>F&&(y=F,-R+J<0?V=0:-R+J>C?V=j:(V=-R+J,j=C));const M=Math.abs(V)<N._Smallnum?0:V/j,W=Math.abs(y)<N._Smallnum?0:y/F,d=h.f.ak[4];s.scaleToRef(W,d);const r=h.f.ak[5];t.scaleToRef(M,r),r.addInPlace(L);const z=h.f.ak[6];r.subtractToRef(d,z);return W>0&&W<=this.length&&z.lengthSquared()<A*A?r.length():-1}update(c,b,A,o,t,n,s){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){N._RayDistant||(N._RayDistant=N.Zero()),N._RayDistant.unprojectRayToRef(c,b,A,o,h.b.IdentityReadOnly,n,s);const L=h.f.Matrix[0];t.invertToRef(L),N.TransformToRef(N._RayDistant,L,this)}else this.unprojectRayToRef(c,b,A,o,t,n,s);return this}static Zero(){return new N(h.k.Zero(),h.k.Zero())}static CreateNew(c,b,A,o,t,n,h){return N.Zero().update(c,b,A,o,t,n,h)}static CreateNewFromTo(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.b.IdentityReadOnly;const o=new N(new h.k(0,0,0),new h.k(0,0,0));return N.CreateFromToToRef(c,b,o,A)}static CreateFromToToRef(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.b.IdentityReadOnly;A.origin.p(c);const t=b.subtractToRef(c,A.direction),n=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return A.length=n,A.direction.normalize(),N.TransformToRef(A,o,A)}static Transform(c,b){const A=new N(new h.k(0,0,0),new h.k(0,0,0));return N.TransformToRef(c,b,A),A}static TransformToRef(c,b,A){h.k.TransformCoordinatesToRef(c.origin,b,A.origin),h.k.TransformNormalToRef(c.direction,b,A.direction),A.length=c.length,A.epsilon=c.epsilon;const o=A.direction,t=o.length();if(0!==t&&1!==t){const c=1/t;o.x*=c,o.y*=c,o.z*=c,A.length*=t}return A}unprojectRayToRef(c,b,A,o,t,n,s){const L=h.f.Matrix[0];t.multiplyToRef(n,L),L.multiplyToRef(s,L),L.invert();const C=J.c.LastCreatedEngine,X=h.f.ak[0];X.x=c/A*2-1,X.y=-(b/o*2-1),X.z=null!==C&&void 0!==C&&C.useReverseDepthBuffer?1:null!==C&&void 0!==C&&C.isNDCHalfZRange?0:-1;const R=h.f.ak[1].jd(X.x,X.y,1-1e-8),N=h.f.ak[2],k=h.f.ak[3];h.k._UnprojectFromInvertedMatrixToRef(X,L,N),h.k._UnprojectFromInvertedMatrixToRef(R,L,k),this.origin.p(N),k.subtractToRef(N,this.direction),this.direction.normalize()}}function k(c,b,A,o,t){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=N.Zero();return E(c,b,A,o,h,t,n),h}function E(c,b,A,o,t,n){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const C=c.getEngine();if(!n&&!(n=c.activeCamera))return c;const J=n.viewport,X=C.getRenderHeight(),{x:R,y:N,width:k,height:E}=J.toGlobal(C.getRenderWidth(),X),V=1/C.getHardwareScalingLevel();return b=b*V-R,A=A*V-(X-N-E),t.update(b,A,k,E,o||h.b.IdentityReadOnly,s?h.b.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix(),L),c}function V(c,b,A,o,t){if(!C.e)return c;const n=c.getEngine();if(!t&&!(t=c.activeCamera))throw new Error("Active camera not set");const s=t.viewport,L=n.getRenderHeight(),{x:J,y:X,width:R,height:N}=s.toGlobal(n.getRenderWidth(),L),k=h.b.Identity(),E=1/n.getHardwareScalingLevel();return b=b*E-J,A=A*E-(L-X-N),o.update(b,A,R,N,k,k,t.getProjectionMatrix()),c}function y(c,b,A,o,t,n,h,s){const L=b(o,A.enableDistantPicking),C=A.intersects(L,t,h,n,o,s);return C&&C.hit?!t&&null!=c&&C.distance>=c.distance?null:C:null}function j(c,b,A,o,t,n){let s=null;const L=!!(c.activeCameras&&c.activeCameras.length>1&&c.cameraToUseForPointers!==c.activeCamera),J=c.cameraToUseForPointers||c.activeCamera,X=R.internalPickerForMesh||y;for(let C=0;C<c.meshes.length;C++){const R=c.meshes[C];if(A){if(!A(R,-1))continue}else if(!R.isEnabled()||!R.isVisible||!R.Ye)continue;const N=L&&R.isWorldMatrixCameraDependent(),k=R.Zj(N,J);if(R.hasThinInstances&&R.thinInstanceEnablePicking){const c=X(s,b,R,k,!0,!0,n);if(c){if(t)return c;const L=h.f.Matrix[1],C=R.thinInstanceGetWorldMatrices();for(let c=0;c<C.length;c++){if(A&&!A(R,c))continue;C[c].multiplyToRef(k,L);const h=X(s,b,R,L,o,t,n,!0);if(h&&(s=h,s.thinInstanceIndex=c,o))return s}}}else{const c=X(s,b,R,k,o,t,n);if(c&&(s=c,o))return s}}return s||new C.e}function F(c,b,A,o){if(!C.e)return null;const t=[],n=!!(c.activeCameras&&c.activeCameras.length>1&&c.cameraToUseForPointers!==c.activeCamera),s=c.cameraToUseForPointers||c.activeCamera,L=R.internalPickerForMesh||y;for(let C=0;C<c.meshes.length;C++){const J=c.meshes[C];if(A){if(!A(J,-1))continue}else if(!J.isEnabled()||!J.isVisible||!J.Ye)continue;const X=n&&J.isWorldMatrixCameraDependent(),R=J.Zj(X,s);if(J.hasThinInstances&&J.thinInstanceEnablePicking){if(L(null,b,J,R,!0,!0,o)){const c=h.f.Matrix[1],n=J.thinInstanceGetWorldMatrices();for(let h=0;h<n.length;h++){if(A&&!A(J,h))continue;n[h].multiplyToRef(R,c);const s=L(null,b,J,c,!1,!1,o,!0);s&&(s.thinInstanceIndex=h,t.push(s))}}}else{const c=L(null,b,J,R,!1,!1,o);c&&t.push(c)}}return t}function M(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;o||(o=c.getWorldMatrix()),b.length=A,t?b.origin.p(t):b.origin.p(c.position);const n=h.f.ak[2];n.set(0,0,c._scene.useRightHandedSystem?-1:1);const s=h.f.ak[3];return h.k.TransformNormalToRef(n,o,s),h.k.NormalizeToRef(s,b.direction),b}var W,d;N._TmpVector3=(0,s.c)(6,h.k.Zero),N._RayDistant=N.Zero(),N._Smallnum=1e-8,N._Rayl=1e9,W=o.d,(d=t.c)&&(d.prototype.getForwardRay=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;return M(this,new N(h.k.Zero(),h.k.Zero(),c),c,b,A)},d.prototype.getForwardRayToRef=function(c){return M(this,c,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),W&&(X.e._IsPickingAvailable=!0,W.prototype.createPickingRay=function(c,b,A,o){return k(this,c,b,A,o,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),o.d.prototype.createPickingRayToRef=function(c,b,A,o,t){return E(this,c,b,A,o,t,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},o.d.prototype.createPickingRayInCameraSpace=function(c,b,A){return function(c,b,A,o){const t=N.Zero();return V(c,b,A,t,o),t}(this,c,b,A)},o.d.prototype.createPickingRayInCameraSpaceToRef=function(c,b,A,o){return V(this,c,b,A,o)},o.d.prototype.pickWithBoundingInfo=function(c,b,A,o,t){return function(c,b,A,o,t,n){if(!C.e)return null;const s=j(c,(o=>(c._tempPickingRay||(c._tempPickingRay=N.Zero()),E(c,b,A,o,c._tempPickingRay,n||null),c._tempPickingRay)),o,t,!0);return s&&(s.ray=k(c,b,A,h.b.Identity(),n||null)),s}(this,c,b,A,o,t)},o.d.prototype.Wd=function(c,b,A,o,t,n){return function(c,b,A,o,t,n,s){const L=j(c,((o,t)=>(c._tempPickingRay||(c._tempPickingRay=N.Zero()),E(c,b,A,o,c._tempPickingRay,n||null,!1,t),c._tempPickingRay)),o,t,!1,s);return L&&(L.ray=k(c,b,A,h.b.Identity(),n||null)),L}(this,c,b,A,o,t,n)},o.d.prototype.pickWithRay=function(c,b,A,o){return function(c,b,A,o,t){const n=j(c,(A=>(c._pickWithRayInverseMatrix||(c._pickWithRayInverseMatrix=h.b.Identity()),A.invertToRef(c._pickWithRayInverseMatrix),c._cachedRayForTransform||(c._cachedRayForTransform=N.Zero()),N.TransformToRef(b,c._pickWithRayInverseMatrix,c._cachedRayForTransform),c._cachedRayForTransform)),A,o,!1,t);return n&&(n.ray=b),n}(this,c,b,A,o)},o.d.prototype.multiPick=function(c,b,A,o,t){return function(c,b,A,o,t,n){return F(c,(o=>k(c,b,A,o,t||null)),o,n)}(this,c,b,A,o,t)},o.d.prototype.multiPickWithRay=function(c,b,A){return function(c,b,A,o){return F(c,(A=>(c._pickWithRayInverseMatrix||(c._pickWithRayInverseMatrix=h.b.Identity()),A.invertToRef(c._pickWithRayInverseMatrix),c._cachedRayForTransform||(c._cachedRayForTransform=N.Zero()),N.TransformToRef(b,c._pickWithRayInverseMatrix,c._cachedRayForTransform),c._cachedRayForTransform)),A,o)}(this,c,b,A)}},2164:(c,b,A)=>{"use strict";var o=A(615),t=A(531),n=A(552),h=A(640),s=A(589),L=A(625);s.c.prototype._partialLoadFile=function(c,b,A,o){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(c,(c=>{A[b]=c,A._internalCount++,6===A._internalCount&&o(A)}),void 0,void 0,!0,((c,b)=>{t&&c&&t(c.status+" "+c.statusText,b)}))},s.c.prototype._cascadeLoadFiles=function(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=[];t._internalCount=0;for(let n=0;n<6;n++)this._partialLoadFile(A[n],n,t,b,o)},s.c.prototype._cascadeLoadImgs=function(c,b,A,o){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5?arguments[5]:void 0;const h=[];h._internalCount=0;for(let s=0;s<6;s++)this._partialLoadImg(o[s],s,h,c,b,A,t,n)},s.c.prototype._partialLoadImg=function(c,b,A,o,t,s){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0;const J=(0,h.d)();(0,n.r)(c,(c=>{A[b]=c,A._internalCount++,o&&o.removePendingData(J),6===A._internalCount&&s&&s(t,A)}),((c,b)=>{o&&o.removePendingData(J),L&&L(c,b)}),o?o.offlineProvider:null,C),o&&o.addPendingData(J)},s.c.prototype.createCubeTextureBase=function(c,b,A,n){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,V=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,y=arguments.length>14&&void 0!==arguments[14]&&arguments[14],j=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const F=k||new o.c(this,7);F.isCube=!0,F.url=c,F.generateMipMaps=!n,F._lodGenerationScale=R,F._lodGenerationOffset=N,F._useSRGBBuffer=!!y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),F!==k&&(F.label=c.substring(0,60)),this._doNotHandleContextLost||(F._extension=J,F._files=A,F._buffer=j);const M=c;this._transformTextureUrl&&!k&&(c=this._transformTextureUrl(c));const W=J??function(c){const b=c.split("?")[0],A=b.lastIndexOf(".");return A>-1?b.substring(A).toLowerCase():""}(c),d=(0,L.d)(W),r=(c,b)=>{F.dispose(),s?s(c,b):c&&t.c.Warn(c)},z=(o,s)=>{c===M?o&&r(o.status+" "+o.statusText,s):(t.c.Warn(`Failed to load ${c}, falling back to the ${M}`),this.createCubeTextureBase(M,b,A,!!n,h,r,C,J,X,R,N,F,E,V,y,j))};if(d)d.then((o=>{const t=c=>{E&&E(F,c),o.loadCubeData(c,F,X,h,((c,b)=>{r(c,b)}))};j?t(j):A&&6===A.length?o.supportCascades?this._cascadeLoadFiles(b,(c=>t(c.map((c=>new Uint8Array(c))))),A,r):r("Textures type does not support cascades."):this._loadFile(c,(c=>t(new Uint8Array(c))),void 0,void 0,!0,z)}));else{if(!A||0===A.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(b,F,((c,b)=>{V&&V(c,b)}),A,r)}return this._internalTexturesCache.push(F),F}},13113:(c,b,A)=>{"use strict";A(531);var o=A(2102);A(615),A(752),A(612),A(2152),A(2117);o.d},12760:(c,b,A)=>{"use strict";A.d(b,{d:()=>t});var o=A(633);class t{constructor(c){this.value=this._toInt(c)}_toInt(c){return 0|c}add(c){return new t(this.value+c.value)}Xd(c){return new t(this.value-c.value)}multiply(c){return new t(Math.imul(this.value,c.value))}divide(c){return new t(this.value/c.value)}getClassName(){return t.ClassName}equals(c){return this.value===c.value}static FromValue(c){return new t(c)}toString(){return this.value.toString()}}t.ClassName="FlowGraphInteger",(0,o.d)("FlowGraphInteger",t)},12767:(c,b,A)=>{"use strict";A.d(b,{e:()=>t,h:()=>n});var o=A(688);class t{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.gk=c}get m(){return this.gk}transformVector(c){return this.transformVectorToRef(c,new o.h)}transformVectorToRef(c,b){return b.x=c.x*this.gk[0]+c.y*this.gk[1],b.y=c.x*this.gk[2]+c.y*this.gk[3],b}hk(){return this.toArray()}toArray(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<4;b++)c[b]=this.gk[b];return c}Zd(c){for(let b=0;b<4;b++)this.gk[b]=c[b];return this}multiplyToRef(c,b){const A=c.gk,o=this.gk,t=b.gk;return t[0]=A[0]*o[0]+A[1]*o[2],t[1]=A[0]*o[1]+A[1]*o[3],t[2]=A[2]*o[0]+A[3]*o[2],t[3]=A[2]*o[1]+A[3]*o[3],b}multiply(c){return this.multiplyToRef(c,new t)}divideToRef(c,b){const A=this.gk,o=c.gk,t=b.gk;return t[0]=A[0]/o[0],t[1]=A[1]/o[1],t[2]=A[2]/o[2],t[3]=A[3]/o[3],b}divide(c){return this.divideToRef(c,new t)}addToRef(c,b){const A=this.gk,o=c.m,t=b.m;return t[0]=A[0]+o[0],t[1]=A[1]+o[1],t[2]=A[2]+o[2],t[3]=A[3]+o[3],b}add(c){return this.addToRef(c,new t)}subtractToRef(c,b){const A=this.gk,o=c.m,t=b.m;return t[0]=A[0]-o[0],t[1]=A[1]-o[1],t[2]=A[2]-o[2],t[3]=A[3]-o[3],b}Xd(c){return this.subtractToRef(c,new t)}transpose(){const c=this.gk;return new t([c[0],c[2],c[1],c[3]])}determinant(){const c=this.gk;return c[0]*c[3]-c[1]*c[2]}inverse(){const c=this.determinant();if(0===c)throw new Error("Matrix is not invertible");const b=this.gk,A=1/c;return new t([b[3]*A,-b[1]*A,-b[2]*A,b[0]*A])}equals(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.gk,o=c.m;return 0===b?A[0]===o[0]&&A[1]===o[1]&&A[2]===o[2]&&A[3]===o[3]:Math.abs(A[0]-o[0])<b&&Math.abs(A[1]-o[1])<b&&Math.abs(A[2]-o[2])<b&&Math.abs(A[3]-o[3])<b}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.gk.join(", ")})`}}class n{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.gk=c}get m(){return this.gk}transformVector(c){return this.transformVectorToRef(c,new o.k)}transformVectorToRef(c,b){const A=this.gk;return b.x=c.x*A[0]+c.y*A[1]+c.z*A[2],b.y=c.x*A[3]+c.y*A[4]+c.z*A[5],b.z=c.x*A[6]+c.y*A[7]+c.z*A[8],b}multiplyToRef(c,b){const A=c.gk,o=this.gk,t=b.m;return t[0]=A[0]*o[0]+A[1]*o[3]+A[2]*o[6],t[1]=A[0]*o[1]+A[1]*o[4]+A[2]*o[7],t[2]=A[0]*o[2]+A[1]*o[5]+A[2]*o[8],t[3]=A[3]*o[0]+A[4]*o[3]+A[5]*o[6],t[4]=A[3]*o[1]+A[4]*o[4]+A[5]*o[7],t[5]=A[3]*o[2]+A[4]*o[5]+A[5]*o[8],t[6]=A[6]*o[0]+A[7]*o[3]+A[8]*o[6],t[7]=A[6]*o[1]+A[7]*o[4]+A[8]*o[7],t[8]=A[6]*o[2]+A[7]*o[5]+A[8]*o[8],b}multiply(c){return this.multiplyToRef(c,new n)}divideToRef(c,b){const A=this.gk,o=c.m,t=b.m;return t[0]=A[0]/o[0],t[1]=A[1]/o[1],t[2]=A[2]/o[2],t[3]=A[3]/o[3],t[4]=A[4]/o[4],t[5]=A[5]/o[5],t[6]=A[6]/o[6],t[7]=A[7]/o[7],t[8]=A[8]/o[8],b}divide(c){return this.divideToRef(c,new n)}addToRef(c,b){const A=this.gk,o=c.m,t=b.m;return t[0]=A[0]+o[0],t[1]=A[1]+o[1],t[2]=A[2]+o[2],t[3]=A[3]+o[3],t[4]=A[4]+o[4],t[5]=A[5]+o[5],t[6]=A[6]+o[6],t[7]=A[7]+o[7],t[8]=A[8]+o[8],b}add(c){return this.addToRef(c,new n)}subtractToRef(c,b){const A=this.gk,o=c.m,t=b.m;return t[0]=A[0]-o[0],t[1]=A[1]-o[1],t[2]=A[2]-o[2],t[3]=A[3]-o[3],t[4]=A[4]-o[4],t[5]=A[5]-o[5],t[6]=A[6]-o[6],t[7]=A[7]-o[7],t[8]=A[8]-o[8],b}Xd(c){return this.subtractToRef(c,new n)}toArray(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<9;b++)c[b]=this.gk[b];return c}hk(){return this.toArray()}Zd(c){for(let b=0;b<9;b++)this.gk[b]=c[b];return this}transpose(){const c=this.gk;return new n([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]])}determinant(){const c=this.gk;return c[0]*(c[4]*c[8]-c[5]*c[7])-c[1]*(c[3]*c[8]-c[5]*c[6])+c[2]*(c[3]*c[7]-c[4]*c[6])}inverse(){const c=this.determinant();if(0===c)throw new Error("Matrix is not invertible");const b=this.gk,A=1/c;return new n([(b[4]*b[8]-b[5]*b[7])*A,(b[2]*b[7]-b[1]*b[8])*A,(b[1]*b[5]-b[2]*b[4])*A,(b[5]*b[6]-b[3]*b[8])*A,(b[0]*b[8]-b[2]*b[6])*A,(b[2]*b[3]-b[0]*b[5])*A,(b[3]*b[7]-b[4]*b[6])*A,(b[1]*b[6]-b[0]*b[7])*A,(b[0]*b[4]-b[1]*b[3])*A])}equals(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.gk,o=c.m;return 0===b?A[0]===o[0]&&A[1]===o[1]&&A[2]===o[2]&&A[3]===o[3]&&A[4]===o[4]&&A[5]===o[5]&&A[6]===o[6]&&A[7]===o[7]&&A[8]===o[8]:Math.abs(A[0]-o[0])<b&&Math.abs(A[1]-o[1])<b&&Math.abs(A[2]-o[2])<b&&Math.abs(A[3]-o[3])<b&&Math.abs(A[4]-o[4])<b&&Math.abs(A[5]-o[5])<b&&Math.abs(A[6]-o[6])<b&&Math.abs(A[7]-o[7])<b&&Math.abs(A[8]-o[8])<b}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.gk.join(", ")})`}}},12774:(c,b,A)=>{"use strict";var o;function t(c,b,A,o){switch(b){case"Animation":return o?c.animations.find((c=>c.uniqueId===A))??null:c.animations[A]??null;case"AnimationGroup":return o?c.animationGroups.find((c=>c.uniqueId===A))??null:c.animationGroups[A]??null;case"Mesh":return o?c.meshes.find((c=>c.uniqueId===A))??null:c.meshes[A]??null;case"Material":return o?c.materials.find((c=>c.uniqueId===A))??null:c.materials[A]??null;case"Wj":return o?c.cameras.find((c=>c.uniqueId===A))??null:c.cameras[A]??null;case"Light":return o?c.lights.find((c=>c.uniqueId===A))??null:c.lights[A]??null;default:return null}}A.d(b,{e:()=>t}),function(c){c.Animation="Animation",c.AnimationGroup="AnimationGroup",c.Mesh="Mesh",c.Material="Material",c.Wj="Wj",c.Light="Light"}(o||(o={}))},12807:(c,b,A)=>{"use strict";A.d(b,{d:()=>t});var o=A(12813);class t extends o.d{constructor(c,b){if(super(c),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),b)for(const A of b)this._eventsSignalOutputs[A]=this._registerSignalOutput(A+"Event")}_executeOnTick(c){}_startPendingTasks(c){c._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(c),this._resetAfterCanceled(c)),this._preparePendingTasks(c),c._addPendingBlock(this),this.out._activateSignal(c),c._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(c){c._deleteExecutionVariable(this,"_initialized"),c._removePendingBlock(this)}}},12789:(c,b,A)=>{"use strict";A.d(b,{d:()=>C});var o=A(640),t=A(633),n=A(12796),h=A(518),s=A(12752);class L extends n.b{constructor(c,b,A,o){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.defaultValue,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(c,b,A),this.richType=o,this._defaultValue=t,this._optional=n,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new h.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(c){this._isDisabled!==c&&(this._isDisabled=c,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(c,b){b._getConnectionValue(this)!==c&&(b._setConnectionValue(this,c),this.onValueChangedObservable.notifyObservers(c))}resetToDefaultValue(c){c._setConnectionValue(this,this._defaultValue)}connectTo(c){this._isDisabled||super.connectTo(c)}_getValueOrDefault(c){const b=c._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(b):b}getValue(c){if(1===this.connectionType){c._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(c);const b=this._getValueOrDefault(c);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}const b=this.isConnected()?this._connectedPoint[0].getValue(c):this._getValueOrDefault(c);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(c),c.richType={},this.richType.serialize(c.richType),c.optional=this._optional,(0,s.e)("defaultValue",this._defaultValue,c)}}(0,t.d)("FlowGraphDataConnection",L);class C{constructor(c){var b;this.config=c,this.uniqueId=(0,o.d)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(c){}registerDataInput(c,b,A){const o=new L(c,0,this,b,A);return this.dataInputs.push(o),o}registerDataOutput(c,b,A){const o=new L(c,1,this,b,A);return this.dataOutputs.push(o),o}getDataInput(c){return this.dataInputs.find((b=>b.name===c))}getDataOutput(c){return this.dataOutputs.find((b=>b.name===c))}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.e;if(c.uniqueId=this.uniqueId,c.config={},this.config){const A=this.config,o=Object.keys(A);for(const t of o)b(t,A[t],c.config)}c.dataInputs=[],c.dataOutputs=[],c.className=this.getClassName();for(const A of this.dataInputs){const b={};A.serialize(b),c.dataInputs.push(b)}for(const A of this.dataOutputs){const b={};A.serialize(b),c.dataOutputs.push(b)}}deserialize(c){}_log(c,b,A){var o;null===(o=c.logger)||void 0===o||o.addLogItem({action:b,payload:A,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12796:(c,b,A)=>{"use strict";A.d(b,{b:()=>n});var o,t=A(640);!function(c){c[c.Input=0]="Input",c[c.Output=1]="Output"}(o||(o={}));class n{constructor(c,b,A){this._ownerBlock=A,this._connectedPoint=[],this.uniqueId=(0,t.d)(),this.connectedPointIds=[],this.name=c,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(c){if(this._connectionType===c._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||c._isSingularConnection()&&c._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(c),c._connectedPoint.push(this)}disconnectFrom(c){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this._connectedPoint.indexOf(c),o=c._connectedPoint.indexOf(this);-1!==A&&-1!==o&&(b&&this._connectedPoint.splice(A,1),c._connectedPoint.splice(o,1))}disconnectFromAll(){for(const c of this._connectedPoint)this.disconnectFrom(c,!1);this._connectedPoint.length=0}dispose(){for(const c of this._connectedPoint)this.disconnectFrom(c)}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c.uniqueId=this.uniqueId,c.name=this.name,c._connectionType=this._connectionType,c.connectedPointIds=[],c.className=this.getClassName();for(const b of this._connectedPoint)c.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(c){this.uniqueId=c.uniqueId,this.name=c.name,this._connectionType=c._connectionType,this.connectedPointIds=c.connectedPointIds}}},12744:(c,b,A)=>{"use strict";A.d(b,{b:()=>F});var o,t=A(518),n=A(672),h=A(674),s=A(640),L=A(12752),C=A(12774),J=A(531);!function(c){c.ExecuteBlock="ExecuteBlock",c.ExecuteEvent="ExecuteEvent",c.TriggerConnection="TriggerConnection",c.ContextVariableSet="ContextVariableSet",c.GlobalVariableSet="GlobalVariableSet",c.GlobalVariableDelete="GlobalVariableDelete",c.GlobalVariableGet="GlobalVariableGet",c.AddConnection="AddConnection",c.GetConnectionValue="GetConnectionValue",c.SetConnectionValue="SetConnectionValue",c.ActivateSignal="ActivateSignal",c.ContextVariableGet="ContextVariableGet"}(o||(o={}));class X{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(c){if(c.time||(c.time=Date.now()),this.log.push(c),this.logToConsole){var b;const A=null===(b=c.payload)||void 0===b?void 0:b.value;"object"===typeof A&&A.getClassName?J.c.Log(`[FGLog] ${c.className}:${c.uniqueId.split("-")[0]} ${c.action} - ${JSON.stringify(A.getClassName())}: ${A.toString()}`):J.c.Log(`[FGLog] ${c.className}:${c.uniqueId.split("-")[0]} ${c.action} - ${JSON.stringify(c.payload)}`)}}getItemsOfType(c){return this.log.filter((b=>b.action===c))}}class R{get enableLogging(){return this._enableLogging}set enableLogging(c){this._enableLogging!==c&&(this._enableLogging=c,this._enableLogging?(this.logger=new X,this.logger.logToConsole=!0):this.logger=null)}constructor(c){this.uniqueId=(0,s.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new t.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=c,this.assetsContext=c.assetsContext??c.yd}hasVariable(c){return c in this._userVariables}setVariable(c,b){var A;this._userVariables[c]=b,null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:c,value:b}})}getAsset(c,b){return(0,C.e)(this.assetsContext,c,b)}getVariable(c){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:c,value:this._userVariables[c]}}),this._userVariables[c]}get userVariables(){return this._userVariables}va(){return this._configuration.yd}_getUniqueIdPrefixedName(c,b){return`${c.uniqueId}_${b}`}_getGlobalContextVariable(c,b){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:c,defaultValue:b,possibleValue:this._globalContextVariables[c]}}),this._hasGlobalContextVariable(c)?this._globalContextVariables[c]:b}_setGlobalContextVariable(c,b){var A;null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:c,value:b}}),this._globalContextVariables[c]=b}_deleteGlobalContextVariable(c){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:c}}),delete this._globalContextVariables[c]}_hasGlobalContextVariable(c){return c in this._globalContextVariables}_setExecutionVariable(c,b,A){this._executionVariables[this._getUniqueIdPrefixedName(c,b)]=A}_getExecutionVariable(c,b,A){return this._hasExecutionVariable(c,b)?this._executionVariables[this._getUniqueIdPrefixedName(c,b)]:A}_deleteExecutionVariable(c,b){delete this._executionVariables[this._getUniqueIdPrefixedName(c,b)]}_hasExecutionVariable(c,b){return this._getUniqueIdPrefixedName(c,b)in this._executionVariables}_hasConnectionValue(c){return c.uniqueId in this._connectionValues}_setConnectionValue(c,b){var A;this._connectionValues[c.uniqueId]=b,null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:c.uniqueId,value:b}})}_setConnectionValueByKey(c,b){this._connectionValues[c]=b}_getConnectionValue(c){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:c.uniqueId,value:this._connectionValues[c.uniqueId]}}),this._connectionValues[c.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(c){this._pendingBlocks.includes(c)||(this._pendingBlocks.push(c),this._pendingBlocks.sort(((c,b)=>c.priority-b.priority)))}_removePendingBlock(c){const b=this._pendingBlocks.indexOf(c);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const c of this._pendingBlocks)c._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(c){var b;this.onNodeExecutedObservable.notifyObservers(c),null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:c.getClassName(),uniqueId:c.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(c){this._setGlobalContextVariable("timeSinceStart",c.timeSinceStart),this._setGlobalContextVariable("deltaTime",c.deltaTime);for(const A of this._pendingBlocks){var b;null===(b=A._executeOnTick)||void 0===b||b.call(A,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.e;c.uniqueId=this.uniqueId,c._userVariables={};for(const o in this._userVariables)b(o,this._userVariables[o],c._userVariables);c._connectionValues={};for(const o in this._connectionValues)b(o,this._connectionValues[o],c._connectionValues);var A;this.assetsContext!==this.va()&&(c._assetsContext={meshes:this.assetsContext.meshes.map((c=>c.id)),materials:this.assetsContext.materials.map((c=>c.id)),textures:this.assetsContext.textures.map((c=>c.name)),animations:this.assetsContext.animations.map((c=>c.name)),lights:this.assetsContext.lights.map((c=>c.id)),cameras:this.assetsContext.cameras.map((c=>c.id)),jm:null===(A=this.assetsContext.jm)||void 0===A?void 0:A.map((c=>c.name)),skeletons:this.assetsContext.skeletons.map((c=>c.id)),xk:this.assetsContext.xk.map((c=>c.name)),geometries:this.assetsContext.geometries.map((c=>c.id)),multiMaterials:this.assetsContext.multiMaterials.map((c=>c.id)),transformNodes:this.assetsContext.transformNodes.map((c=>c.id))})}getClassName(){return"FlowGraphContext"}}(0,n.e)([(0,h.J)()],R.prototype,"uniqueId",void 0);var N=A(12780),k=A(2204);class E{constructor(c){this.onEventTriggeredObservable=new t.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=c,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.fk.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const c=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:c}}),this._startingTime+=c})),this._meshPickedObserver=this._scene.onPointerObservable.add((c=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:c})}),k.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((c=>{const b=c.pointerId,A=c.mesh,o=this._pointerUnderMeshState[b];!o&&A?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:b,mesh:A}}):o&&!A?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:b,mesh:o}}):o&&A&&o!==A&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:b,mesh:o,over:A}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:b,mesh:A,out:o}})),this._pointerUnderMeshState[b]=A}),k.d.POINTERMOVE)}dispose(){var c,b,A,o,t;null===(c=this._sceneDisposeObserver)||void 0===c||c.remove(),null===(b=this._sceneReadyObserver)||void 0===b||b.remove(),null===(A=this._sceneOnBeforeRenderObserver)||void 0===A||A.remove(),null===(o=this._meshPickedObserver)||void 0===o||o.remove(),null===(t=this._meshUnderPointerObserver)||void 0===t||t.remove(),this.onEventTriggeredObservable.clear()}}var V,y=A(12801);!function(c){c[c.Stopped=0]="Stopped",c[c.Started=1]="Started"}(V||(V={}));class j{get state(){return this._state}set state(c){this._state=c,this.onStateChangedObservable.notifyObservers(c)}constructor(c){this.onStateChangedObservable=new t.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=c.yd,this._sceneEventCoordinator=new E(this._scene),this._coordinator=c.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((c=>{for(const b of this._executionContexts){const A=this._getContextualOrder(c.type,b);for(const o of A)if(!o._executeEvent(b,c.payload))break}switch(c.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const b of this._executionContexts)b._notifyOnTick(c.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const c=new R({yd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(c),c}getContext(c){return this._executionContexts[c]}addEventBlock(c){if("PointerOver"!==c.type&&"PointerOut"!==c.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==c.type&&this._eventBlocks[c.type].push(c),1===this.state)for(const b of this._executionContexts)c._startPendingTasks(b);else this.onStateChangedObservable.addOnce((b=>{if(1===b)for(const A of this._executionContexts)c._startPendingTasks(A)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((c=>{1===c&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const c of this._executionContexts)for(const b in this._eventBlocks){const A=this._getContextualOrder(b,c);for(const b of A)b._startPendingTasks(c)}}_getContextualOrder(c,b){const A=this._eventBlocks[c].sort(((c,b)=>b.initPriority-c.initPriority));if("MeshPick"===c){const c=[];for(const o of A){const t=o.asset.getValue(b);let n=0;for(;n<A.length;n++){const c=A[n].asset.getValue(b);if(t&&c&&(0,y.n)(t,c))break}c.splice(n,0,o)}return c}return A}dispose(){var c;if(0!==this.state){this.state=0;for(const c of this._executionContexts)c._clearPendingBlocks();this._executionContexts.length=0;for(const c in this._eventBlocks)this._eventBlocks[c].length=0;null===(c=this._eventObserver)||void 0===c||c.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(c){const b=[],A=new Set;for(const o in this._eventBlocks)for(const c of this._eventBlocks[o])b.push(c),A.add(c.uniqueId);for(;b.length>0;){const o=b.pop();c(o);for(const c of o.dataInputs)for(const o of c._connectedPoint)A.has(o._ownerBlock.uniqueId)||(b.push(o._ownerBlock),A.add(o._ownerBlock.uniqueId));if(o instanceof N.e)for(const c of o.signalOutputs)for(const o of c._connectedPoint)A.has(o._ownerBlock.uniqueId)||(b.push(o._ownerBlock),A.add(o._ownerBlock.uniqueId))}}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;c.allBlocks=[],this.visitAllBlocks((b=>{const A={};b.serialize(A),c.allBlocks.push(A)})),c.executionContexts=[];for(const A of this._executionContexts){const o={};A.serialize(o,b),c.executionContexts.push(o)}}}class F{constructor(c){this.config=c,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.yd.fk.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.yd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const c=this._executeOnNextFrame.slice(0);if(c.length)for(const b of c){this.notifyCustomEvent(b.id,b.data,!1);const c=this._executeOnNextFrame.findIndex((c=>c.uniqueId===b.uniqueId));-1!==c&&this._executeOnNextFrame.splice(c,1)}}));(F.SceneCoordinators.get(this.config.yd)??[]).push(this)}createGraph(){const c=new j({yd:this.config.yd,coordinator:this});return this._flowGraphs.push(c),c}removeGraph(c){const b=this._flowGraphs.indexOf(c);-1!==b&&(c.dispose(),this._flowGraphs.splice(b,1))}start(){for(const c of this._flowGraphs)c.start()}dispose(){var c,b;for(const t of this._flowGraphs)t.dispose();this._flowGraphs.length=0,null===(c=this._disposeObserver)||void 0===c||c.remove(),null===(b=this._onBeforeRenderObserver)||void 0===b||b.remove();const A=F.SceneCoordinators.get(this.config.yd)??[],o=A.indexOf(this);-1!==o&&A.splice(o,1)}serialize(c,b){c._flowGraphs=[];for(const A of this._flowGraphs){const o={};A.serialize(o,b),c._flowGraphs.push(o)}c.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(c){let b=this._customEventsMap.get(c);return b||(b=new t.b,this._customEventsMap.set(c,b)),b}notifyCustomEvent(c,b){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:c,data:b,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(c)){const b=this._eventExecutionCounter.get(c);if(this._eventExecutionCounter.set(c,b+1),b>=F.MaxEventTypeExecutionPerFrame)return void(b===F.MaxEventTypeExecutionPerFrame&&J.c.Warn(`FlowGraphCoordinator: Too many executions of event "${c}".`))}else this._eventExecutionCounter.set(c,1);const A=this._customEventsMap.get(c);A&&A.notifyObservers(b)}}F.MaxEventsPerType=30,F.MaxEventTypeExecutionPerFrame=30,F.SceneCoordinators=new Map},12803:(c,b,A)=>{"use strict";A.d(b,{e:()=>t});var o=A(12807);class t extends o.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(c){c._notifyExecuteNode(this),this.done._activateSignal(c)}}},12780:(c,b,A)=>{"use strict";A.d(b,{e:()=>s});var o=A(12789),t=A(12796),n=A(633);class h extends t.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(c){super.connectTo(c),this._connectedPoint.sort(((c,b)=>b.priority-c.priority))}_activateSignal(c){var b;if(null===(b=c.logger)||void 0===b||b.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)c._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(c,this),c._increaseExecutionId();else for(const A of this._connectedPoint)A._activateSignal(c)}}(0,n.d)("FlowGraphSignalConnection",h);class s extends o.d{constructor(c){super(c),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(c){const b=new h(c,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(c){const b=new h(c,1,this);return this.signalOutputs.push(b),b}_unregisterSignalInput(c){const b=this.signalInputs.findIndex((b=>b.name===c));-1!==b&&(this.signalInputs[b].dispose(),this.signalInputs.splice(b,1))}_unregisterSignalOutput(c){const b=this.signalOutputs.findIndex((b=>b.name===c));-1!==b&&(this.signalOutputs[b].dispose(),this.signalOutputs.splice(b,1))}_reportError(c,b){this.error.payload="string"===typeof b?new Error(b):b,this.error._activateSignal(c)}getSignalInput(c){return this.signalInputs.find((b=>b.name===c))}getSignalOutput(c){return this.signalOutputs.find((b=>b.name===c))}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(c),c.signalInputs=[],c.signalOutputs=[];for(const b of this.signalInputs){const A={};b.serialize(A),c.signalInputs.push(A)}for(const b of this.signalOutputs){const A={};b.serialize(A),c.signalOutputs.push(A)}}deserialize(c){for(let b=0;b<c.signalInputs.length;b++){const A=this.getSignalInput(c.signalInputs[b].name);if(!A)throw new Error("Could not find signal input with name "+c.signalInputs[b].name+" in block "+c.className);A.deserialize(c.signalInputs[b])}for(let b=0;b<c.signalOutputs.length;b++){const A=this.getSignalOutput(c.signalOutputs[b].name);if(!A)throw new Error("Could not find signal output with name "+c.signalOutputs[b].name+" in block "+c.className);A.deserialize(c.signalOutputs[b])}}getClassName(){return"FlowGraphExecutionBlock"}}},12813:(c,b,A)=>{"use strict";A.d(b,{d:()=>t});var o=A(12780);class t extends o.e{constructor(c){super(c),this.out=this._registerSignalOutput("out")}}},12763:(c,b,A)=>{"use strict";A.d(b,{C:()=>N,D:()=>k,F:()=>E,I:()=>Y,K:()=>D,L:()=>z,O:()=>r,e:()=>C,f:()=>R,g:()=>d,k:()=>V,o:()=>y,q:()=>j,t:()=>X,v:()=>W,z:()=>J});var o,t=A(688),n=A(721),h=A(12760),s=A(12767);!function(c){c.Any="any",c.String="string",c.Number="number",c.Boolean="boolean",c.Object="object",c.Integer="FlowGraphInteger",c.Vector2="Vector2",c.ak="ak",c.Vector4="Vector4",c.Quaternion="Quaternion",c.Matrix="Matrix",c.Matrix2D="Matrix2D",c.Matrix3D="Matrix3D",c.rk="rk",c.sk="sk"}(o||(o={}));class L{constructor(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=c,this.defaultValue=b,this.animationType=A}serialize(c){c.typeName=this.typeName,c.defaultValue=this.defaultValue}}const C=new L("any",void 0),J=new L("string",""),X=new L("number",0,0),R=new L("boolean",!1),N=new L("Vector2",t.h.Zero(),5),k=new L("ak",t.k.Zero(),1),E=new L("Vector4",t.o.Zero()),V=new L("Matrix",t.b.Identity(),3),y=new L("Matrix2D",new s.e),j=new L("Matrix3D",new s.h),F=new L("rk",n.d.Black(),4),M=new L("sk",new n.h(0,0,0,0),7),W=new L("Quaternion",t.e.Identity(),2);W.typeTransformer=c=>{if(c.getClassName){if("Vector4"===c.getClassName())return t.e.$j(c.hk());if("ak"===c.getClassName())return t.e.FromEulerVector(c);if("Matrix"===c.getClassName())return t.e.FromRotationMatrix(c)}return c};const d=new L("FlowGraphInteger",new h.d(0),0);function r(c){const b=c;switch(typeof c){case"string":return J;case"number":return X;case"boolean":return R;case"object":if(b.getClassName)switch(b.getClassName()){case"Vector2":return N;case"ak":return k;case"Vector4":return E;case"Matrix":return V;case"rk":return F;case"sk":return M;case"Quaternion":return W;case"FlowGraphInteger":return d;case"Matrix2D":return y;case"Matrix3D":return j}return C;default:return C}}function z(c){switch(c){case"string":return J;case"number":return X;case"boolean":return R;case"Vector2":return N;case"ak":return k;case"Vector4":return E;case"Matrix":return V;case"rk":return F;case"sk":return M;case"Quaternion":return W;case"FlowGraphInteger":return d;case"Matrix2D":return y;case"Matrix3D":return j;default:return C}}function Y(c){switch(c){case"number":default:return 0;case"Vector2":return 5;case"ak":return 1;case"Matrix":return 3;case"rk":return 4;case"sk":return 7;case"Quaternion":return 2}}function D(c){switch(c){case 0:return X;case 5:return N;case 1:return k;case 3:return V;case 4:return F;case 7:return M;case 2:return W;default:return C}}},12752:(c,b,A)=>{"use strict";A.d(b,{b:()=>J,e:()=>C,f:()=>X});var o=A(721),t=A(688),n=A(12760),h=A(12763),s=A(12767);function L(c){return"Vector2"===c||"ak"===c||"Vector4"===c||"Quaternion"===c||"rk"===c||"sk"===c}function C(c,b,A){var o;const t=(null===b||void 0===b||null===(o=b.getClassName)||void 0===o?void 0:o.call(b))??"";if(L(t)||function(c){return"Matrix"===c||"Matrix2D"===c||"Matrix3D"===c}(t))A[c]={value:b.hk(),className:t};else if("FlowGraphInteger"===t)A[c]={value:b.value,className:t};else if(t&&(b.id||b.name))A[c]={id:b.id,name:b.name,className:t};else{if("object"===typeof b)throw new Error(`Could not serialize value ${b}`);A[c]=b}}function J(c,b,A,C){const X=b[c];let R;const N=(null===X||void 0===X?void 0:X.type)??(null===X||void 0===X?void 0:X.className);if(function(c){return"Mesh"===c||"AbstractMesh"===c||"GroundMesh"===c||"InstanceMesh"===c||"LinesMesh"===c||"GoldbergMesh"===c||"GreasedLineMesh"===c||"TrailMesh"===c}(N)){let c=C.meshes.filter((c=>X.id?c.id===X.id:c.name===X.name));0===c.length&&(c=C.transformNodes.filter((c=>X.id?c.id===X.id:c.name===X.name))),R=X.uniqueId?c.find((c=>c.uniqueId===X.uniqueId)):c[0]}else if(L(N))R=function(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===c)return t.h.$j(b);if("ak"===c)return A&&(b[2]*=-1),t.k.$j(b);if("Vector4"===c)return t.o.$j(b);if("Quaternion"===c)return A&&(b[2]*=-1,b[3]*=-1),t.e.$j(b);if("rk"===c)return new o.d(b[0],b[1],b[2]);if("sk"===c)return new o.h(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${c}`)}(N,X.value);else if(function(c){return"AnimationGroup"===c}(N)){const c=C.animationGroups.filter((c=>c.name===X.name));R=1===c.length?c[0]:c.find((c=>c.uniqueId===X.uniqueId))}else R="Matrix"===N?t.b.$j(X.value):"Matrix2D"===N?new s.e(X.value):"Matrix3D"===N?new s.h(X.value):"FlowGraphInteger"===N?n.d.FromValue(X.value):"number"===N||"string"===N||"boolean"===N?X.value[0]:X&&void 0!==X.value?X.value:Array.isArray(X)?X.reduce(((c,b)=>b.eventData?(c[b.id]={type:(0,h.L)(b.type)},"undefined"!==typeof b.value&&(c[b.id].value=J("value",b,A,C)),c):c),{}):X;return R}function X(c){return"FlowGraphJsonPointerParserBlock"===c}},12801:(c,b,A)=>{"use strict";function o(c,b){return!(!c.parent||c.parent!==b&&!o(c.parent,b))}function t(c){if(c.getClassName)return c.getClassName()}function n(c,b){return c===b&&("Vector2"===c||"ak"===c||"Vector4"===c||"Quaternion"===c)}function h(c,b){return c===b&&("Matrix"===c||"Matrix2D"===c||"Matrix3D"===c)}function s(c,b){return"FlowGraphInteger"===c&&"FlowGraphInteger"===b}function L(c,b){const A="number"===typeof c||"number"===typeof(null===c||void 0===c?void 0:c.value);return A&&!b?!isNaN(C(c)):A}function C(c){return"number"===typeof c?c:c.value}A.d(b,{c:()=>s,f:()=>h,g:()=>n,k:()=>t,n:()=>o,r:()=>C,u:()=>L})},12176:(c,b,A)=>{"use strict";A.r(b),A.d(b,{SceneInstrumentation:()=>n});var o=A(525),t=A(2160);class n{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(c){c!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=c,c?(this._onBeforeActiveMeshesEvaluationObserver=this.yd.onBeforeActiveMeshesEvaluationObservable.add((()=>{o.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.yd.onAfterActiveMeshesEvaluationObservable.add((()=>{o.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.yd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(c){c!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=c,c?(this._onBeforeRenderTargetsRenderObserver=this.yd.onBeforeRenderTargetsRenderObservable.add((()=>{o.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.yd.onAfterRenderTargetsRenderObservable.add((()=>{o.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(c){c!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=c,c?(this._onBeforeParticlesRenderingObserver=this.yd.onBeforeParticlesRenderingObservable.add((()=>{o.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.yd.onAfterParticlesRenderingObservable.add((()=>{o.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(c){c!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=c,this.yd.spriteManagers&&(c?(this._onBeforeSpritesRenderingObserver=this.yd.onBeforeSpritesRenderingObservable.add((()=>{o.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.yd.onAfterSpritesRenderingObservable.add((()=>{o.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.yd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.yd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(c){c!==this._capturePhysicsTime&&this.yd.onBeforePhysicsObservable&&(this._capturePhysicsTime=c,c?(this._onBeforePhysicsObserver=this.yd.onBeforePhysicsObservable.add((()=>{o.d.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.yd.onAfterPhysicsObservable.add((()=>{o.d.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.yd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.yd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(c){c!==this._captureAnimationsTime&&(this._captureAnimationsTime=c,c?this._onAfterAnimationsObserver=this.yd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.yd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(c){this._captureFrameTime=c}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(c){this._captureInterFrameTime=c}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(c){c!==this._captureRenderTime&&(this._captureRenderTime=c,c?(this._onBeforeDrawPhaseObserver=this.yd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),o.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.yd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),o.d.EndPerformanceCounter("Main render")}))):(this.yd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(c){c!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=c,c?(this._onBeforeCameraRenderObserver=this.yd.onBeforeCameraRenderObservable.add((c=>{this._cameraRenderTime.beginMonitoring(),o.d.StartPerformanceCounter(`Rendering camera ${c.name}`)})),this._onAfterCameraRenderObserver=this.yd.onAfterCameraRenderObservable.add((c=>{this._cameraRenderTime.endMonitoring(!1),o.d.EndPerformanceCounter(`Rendering camera ${c.name}`)}))):(this.yd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.yd.getEngine()._drawCalls}constructor(c){this.yd=c,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new t.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new t.b,this._captureFrameTime=!1,this._frameTime=new t.b,this._captureRenderTime=!1,this._renderTime=new t.b,this._captureInterFrameTime=!1,this._interFrameTime=new t.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new t.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new t.b,this._capturePhysicsTime=!1,this._physicsTime=new t.b,this._captureAnimationsTime=!1,this._animationsTime=new t.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new t.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=c.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(o.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.yd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=c.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(o.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ek(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ek(),this._captureParticlesRenderTime&&this._particlesRenderTime.ek(),this._captureSpritesRenderTime&&this._spritesRenderTime.ek(),this._captureRenderTime&&this._renderTime.ek(),this._captureCameraRenderTime&&this._cameraRenderTime.ek()}))}dispose(){this._disposed||(this.yd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.yd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.yd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.yd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.yd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.yd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.yd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.yd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.yd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.yd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.yd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.yd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.yd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.yd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.yd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.yd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.yd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.yd=null,this._disposed=!0)}}},12740:(c,b,A)=>{"use strict";A.d(b,{c:()=>J});var o=A(672),t=A(674),n=A(688),h=A(711),s=A(11921),L=A(11964),C=A(633);h.b.AddNodeConstructor("Light_Type_1",((c,b)=>()=>new J(c,n.k.Zero(),b)));class J extends L.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(c){this._shadowFrustumSize=c,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(c){this._shadowOrthoScale=c,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(c){this._orthoLeft=c}get orthoRight(){return this._orthoRight}set orthoRight(c){this._orthoRight=c}get orthoTop(){return this._orthoTop}set orthoTop(c){this._orthoTop=c}get orthoBottom(){return this._orthoBottom}set orthoBottom(c){this._orthoBottom=c}constructor(c,b,A){super(c,A),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"kb"}getTypeID(){return s.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(c,b,A){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(c):this._setDefaultAutoExtendShadowProjectionMatrix(c,b,A)}_setDefaultFixedFrustumShadowProjectionMatrix(c){const b=this.va().activeCamera;b&&n.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b.Vj,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,c,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(c,b,A){const o=this.va().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const c=n.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let o=Number.MAX_VALUE,t=-Number.MAX_VALUE;for(let h=0;h<A.length;h++){const s=A[h];if(!s)continue;const L=s.getBoundingInfo().boundingBox;for(let A=0;A<L.vectorsWorld.length;A++)n.k.TransformCoordinatesToRef(L.vectorsWorld[A],b,c),c.x<this._orthoLeft&&(this._orthoLeft=c.x),c.y<this._orthoBottom&&(this._orthoBottom=c.y),c.x>this._orthoRight&&(this._orthoRight=c.x),c.y>this._orthoTop&&(this._orthoTop=c.y),this.autoCalcShadowZBounds&&(c.z<o&&(o=c.z),c.z>t&&(t=c.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=o,this._shadowMaxZ=t)}const t=this._orthoRight-this._orthoLeft,h=this._orthoTop-this._orthoBottom,s=void 0!==this.shadowMinZ?this.shadowMinZ:(null===o||void 0===o?void 0:o.Vj)||0,L=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===o||void 0===o?void 0:o.maxZ)||1e4,C=this.va().getEngine().useReverseDepthBuffer;n.b.OrthoOffCenterLHToRef(this._orthoLeft-t*this.shadowOrthoScale,this._orthoRight+t*this.shadowOrthoScale,this._orthoBottom-h*this.shadowOrthoScale,this._orthoTop+h*this.shadowOrthoScale,C?L:s,C?s:L,c,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(c,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(c,b){return this.computeTransformedInformation()?(c.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(c.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(c){const b=this._scene.getEngine();return!b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}getDepthMaxZ(c){const b=this._scene.getEngine();return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(c,b){c["DIRLIGHT"+b]=!0}}(0,o.e)([(0,t.J)()],J.prototype,"shadowFrustumSize",null),(0,o.e)([(0,t.J)()],J.prototype,"shadowOrthoScale",null),(0,o.e)([(0,t.J)()],J.prototype,"autoUpdateExtends",void 0),(0,o.e)([(0,t.J)()],J.prototype,"autoCalcShadowZBounds",void 0),(0,o.e)([(0,t.J)("orthoLeft")],J.prototype,"_orthoLeft",void 0),(0,o.e)([(0,t.J)("orthoRight")],J.prototype,"_orthoRight",void 0),(0,o.e)([(0,t.J)("orthoTop")],J.prototype,"_orthoTop",void 0),(0,o.e)([(0,t.J)("orthoBottom")],J.prototype,"_orthoBottom",void 0),(0,C.d)("BABYLON.DirectionalLight",J)},13036:(c,b,A)=>{"use strict";A.d(b,{e:()=>J});var o=A(672),t=A(674),n=A(688),h=A(721),s=A(711),L=A(11921),C=A(633);s.b.AddNodeConstructor("Light_Type_3",((c,b)=>()=>new J(c,n.k.Zero(),b)));class J extends L.e{constructor(c,b,A){super(c,A),this.groundColor=new h.d(0,0,0),this.direction=b||n.k.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(c){return this.direction=n.k.Normalize(c.Xd(n.k.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(c,b){const A=n.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",A.x,A.y,A.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.cb),b),this}transferToNodeMaterialEffect(c,b){const A=n.k.Normalize(this.direction);return c.setFloat3(b,A.x,A.y,A.z),this}Zj(){return this._worldMatrix||(this._worldMatrix=n.b.Identity()),this._worldMatrix}getTypeID(){return L.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(c,b){c["HEMILIGHT"+b]=!0}}(0,o.e)([(0,t.n)()],J.prototype,"groundColor",void 0),(0,o.e)([(0,t.I)()],J.prototype,"direction",void 0),(0,C.d)("BABYLON.HemisphericLight",J)},12723:(c,b,A)=>{"use strict";A.d(b,{d:()=>X});var o=A(672),t=A(674),n=A(688),h=A(711),s=A(11921),L=A(11964),C=A(2070),J=A(633);h.b.AddNodeConstructor("Light_Type_2",((c,b)=>()=>new X(c,n.k.Zero(),n.k.Zero(),0,0,b)));class X extends L.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(c){this._iesProfileTexture!==c&&(this._iesProfileTexture=c,this._iesProfileTexture&&X._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(c){this._angle=c,this._cosHalfAngle=Math.cos(.5*c),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(c){this._innerAngle=c,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(c){this._shadowAngleScale=c,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(c){this._projectionTextureLightNear=c,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(c){this._projectionTextureLightFar=c,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(c){this._projectionTextureUpDirection=c,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(c){this._projectionTexture!==c&&(this._projectionTexture=c,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(X._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):X._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(c){return void 0!==c.onGeneratedObservable}static _IsTexture(c){return void 0!==c.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(c){this._projectionTextureProjectionLightMatrix=c,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(c,b,A,o,t,h){super(c,h),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=n.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=n.k.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=n.k.Zero(),this._projectionTextureViewLightMatrix=n.b.Zero(),this._projectionTextureProjectionLightMatrix=n.b.Zero(),this._projectionTextureScalingMatrix=n.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=A,this.angle=o,this.exponent=t}getClassName(){return"SpotLight"}getTypeID(){return s.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(c){super._setDirection(c),this._projectionTextureViewLightDirty=!0}_setPosition(c){super._setPosition(c),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(c,b,A){const o=this.va().activeCamera;if(!o)return;this._shadowAngleScale=this._shadowAngleScale||1;const t=this._shadowAngleScale*this._angle,h=void 0!==this.shadowMinZ?this.shadowMinZ:o.Vj,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,L=this.va().getEngine().useReverseDepthBuffer;n.b.PerspectiveFovLHToRef(t,1,L?s:h,L?h:s,c,!0,this._scene.getEngine().isNDCHalfZRange,void 0,L)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),n.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const c=this.projectionTextureLightFar,b=this.projectionTextureLightNear,A=c/(c-b),o=-A*b,t=1/Math.tan(this._angle/2);n.b.FromValuesToRef(t/1,0,0,0,0,t,0,0,0,0,A,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof C.d){const c=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;n.b.FromValuesToRef(c,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(c,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),c.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),c.setTexture("projectionLightTexture"+b,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&c.setTexture("iesLightTexture"+b,this._iesProfileTexture),this}transferToEffect(c,b){let A;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),A=n.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),A=n.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",A.x,A.y,A.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(c,b){let A;return A=this.computeTransformedInformation()?n.k.Normalize(this.transformedDirection):n.k.Normalize(this.direction),this.va().useRightHandedSystem?c.setFloat3(b,-A.x,-A.y,-A.z):c.setFloat3(b,A.x,A.y,A.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(c){const b=this._scene.getEngine(),A=void 0!==this.shadowMinZ?this.shadowMinZ:(null===c||void 0===c?void 0:c.Vj)??0;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?A:this._scene.getEngine().isNDCHalfZRange?0:A}getDepthMaxZ(c){const b=this._scene.getEngine(),A=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===c||void 0===c?void 0:c.maxZ)??1e4;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:A}prepareLightSpecificDefines(c,b){c["SPOTLIGHT"+b]=!0,c["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady()),c["IESLIGHTTEXTURE"+b]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,o.e)([(0,t.J)()],X.prototype,"angle",null),(0,o.e)([(0,t.J)()],X.prototype,"innerAngle",null),(0,o.e)([(0,t.J)()],X.prototype,"shadowAngleScale",null),(0,o.e)([(0,t.J)()],X.prototype,"exponent",void 0),(0,o.e)([(0,t.J)()],X.prototype,"projectionTextureLightNear",null),(0,o.e)([(0,t.J)()],X.prototype,"projectionTextureLightFar",null),(0,o.e)([(0,t.J)()],X.prototype,"projectionTextureUpDirection",null),(0,o.e)([(0,t.F)("projectedLightTexture")],X.prototype,"_projectionTexture",void 0),(0,J.d)("BABYLON.SpotLight",X)},12461:(c,b,A)=>{"use strict";A.d(b,{d:()=>h,h:()=>n,l:()=>s});const o={},t={};function n(c,b){o[c]=b}function h(c,b){t[c]=b}function s(c){return t[c]?t[c]:null}},12350:(c,b,A)=>{"use strict";A.d(b,{b:()=>r,d:()=>I});var o,t=A(525),n=A(518),h=A(2186),s=A(550),L=A(531),C=A(814),J=A(552),X=A(557),R=A(640),N=A(589),k=A(545);!function(c){c[c.Clean=0]="Clean",c[c.Stop=1]="Stop",c[c.Sync=2]="Sync",c[c.NoSync=3]="NoSync"}(o||(o={}));const E=new n.b,V={};let y=!1;function j(){return V[".babylon"]}function F(c,b){const A=V[c];return A||(L.c.Warn("Unable to find a plugin to load "+c+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),b?j():void 0)}function M(c,b,A){let o="Unable to load from "+(c.rawData?"binary data":c.url);return b?o+=`: ${b}`:A&&(o+=`: ${A}`),o}async function W(c,b,A,o,t,n,h,s,L){var C;const X="data:"===(R=c.url).substring(0,5)?R.substring(5):null;var R;if(c.rawData&&!h)throw"When using ArrayBufferView to load data the file extension must be provided.";const y=X||h?"":function(c){const b=c.indexOf("?");-1!==b&&(c=c.substring(0,b));const A=c.lastIndexOf(".");return c.substring(A,c.length).toLowerCase()}(c.url);let M=h?F(h,!0):X?function(c){for(const b in V){const A=V[b].plugin;if(A.canDirectLoad&&A.canDirectLoad(c))return V[b]}return j()}(c.url):F(y,!1);if(!M&&y){if(c.url&&!c.url.startsWith("blob:")){const b=await async function(c,b){const A=b.method||"GET";return await new Promise(((o,t)=>{const n=new k.c;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const c={};if(b.responseHeaders)for(const A of b.responseHeaders)c[A]=n.getResponseHeader(A)||"";o({response:n.response,headerValues:c})}else t(`Unable to fetch data from ${c}. Error code: ${n.status}`)})),n.open(A,c),n.send()}))}(c.url,{method:"HEAD",responseHeaders:["Content-Type"]}),A=b.headerValues?b.headerValues["Content-Type"]:"";A&&(M=function(c){for(const b in V){const A=V[b];if(A.mimeType===c)return A}}(A))}M||(M=j())}if(!M)throw new Error(`No plugin or fallback for ${h??c.url}`);if(!1===(null===L||void 0===L||null===(C=L[M.plugin.name])||void 0===C?void 0:C.enabled))throw new Error(`The '${M.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(c.rawData&&!M.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(c=>{if(M.plugin.createPlugin){const b=M.plugin.createPlugin(L??{});return b instanceof Promise?(b.then(c).catch((c=>{t("Error instantiating plugin.",c)})),null):(c(b),b)}return c(M.plugin),M.plugin})((L=>{var C;if(!L)throw`The loader plugin corresponding to the '${h}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(E.notifyObservers(L),X&&(L.canDirectLoad&&L.canDirectLoad(c.url)||!(0,J.l)(c.url))){if(L.directLoad){const c=L.directLoad(b,X);c instanceof Promise?c.then((c=>{A(L,c)})).catch((c=>{t("Error in directLoad of _loadData: "+c,c)})):A(L,c)}else A(L,X);return}const R=M.isBinary,k=(c,o)=>{b.u?t("Scene has been disposed"):A(L,c,o)};let V=null,y=!1;null===(C=L.fk)||void 0===C||C.add((()=>{y=!0,V&&(V.abort(),V=null),n()}));const j=()=>{if(y)return;const A=(c,b)=>{t(null===c||void 0===c?void 0:c.statusText,b)};if(!L.loadFile&&c.rawData)throw"Plugin does not support loading ArrayBufferView.";V=L.loadFile?L.loadFile(b,c.rawData||c.file||c.url,c.rootUrl,k,o,R,A,s):b._loadFile(c.file||c.url,k,o,!0,R,A)},F=b.getEngine();let W=F.enableOfflineSupport;if(W){let A=!1;for(const o of b.disableOfflineSupportExceptionRules)if(o.test(c.url)){A=!0;break}W=!A}W&&N.c.OfflineProviderFactory?b.offlineProvider=N.c.OfflineProviderFactory(c.url,j,F.disableManifestCheck):j()}))}function d(c,b){let A,o,n=null,h=null;if(b)if(b.name)A=`file:${b.name}`,o=b.name,n=b;else if(ArrayBuffer.isView(b))A="",o=(0,R.d)(),h=b;else if(b.startsWith("data:"))A=b,o="";else if(c){const n=b;if("/"===n.substring(0,1))return t.d.Error("Wrong sceneFilename parameter"),null;A=c+n,o=n}else A=b,o=t.d.GetFilename(b),c=t.d.GetFolderPath(b);else A=c,o=t.d.GetFilename(c),c=t.d.GetFolderPath(c);return{url:A,rootUrl:c,name:o,file:n,rawData:h}}function r(c){if("string"===typeof c.extensions){const b=c.extensions;V[b.toLowerCase()]={plugin:c,isBinary:!1}}else{const b=c.extensions,A=Object.keys(b);for(const o of A)V[o.toLowerCase()]={plugin:c,isBinary:b[o].isBinary,mimeType:b[o].mimeType}}}async function z(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.c.LastCreatedScene,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!o)return L.c.Error("No scene available to import mesh to"),null;const N=d(b,A);if(!N)return null;const k={};o.addPendingData(k);const E=()=>{o.removePendingData(k)},V=(c,b)=>{const A=M(N,c,b);h?h(o,A,new X.h(A,X.e.SceneLoaderError,b)):L.c.Error(A),E()},y=n?c=>{try{n(c)}catch(b){V("Error in onProgress callback: "+b,b)}}:void 0,j=(c,b,A,n,h,s,L,C)=>{if(o.importedMeshesFiles.push(N.url),t)try{t(c,b,A,n,h,s,L,C)}catch(J){V("Error in onSuccess callback: "+J,J)}o.removePendingData(k)};return await W(N,o,((b,A,t)=>{if(b.rewriteRootURL&&(N.rootUrl=b.rewriteRootURL(N.rootUrl,t)),b.importMesh){const t=[],n=[],h=[];if(!b.importMesh(c,o,A,N.rootUrl,t,n,h,V))return;o.loadingPluginName=b.name,j(t,n,h,[],[],[],[],[])}else{b.importMeshAsync(c,o,A,N.rootUrl,y,N.name).then((c=>{o.loadingPluginName=b.name,j(c.meshes,c.xk,c.skeletons,c.animationGroups,c.transformNodes,c.geometries,c.lights,c.spriteManagers)})).catch((c=>{V(c.message,c)}))}}),y,V,E,C,J,R)}async function Y(c,b,A,o,t,n,h,s){return await new Promise(((L,C)=>{try{z(c,b,A,o,((c,b,A,o,t,n,h,s)=>{L({meshes:c,xk:b,skeletons:A,animationGroups:o,transformNodes:t,geometries:n,lights:h,spriteManagers:s})}),t,((c,b,A)=>{C(A||new Error(b))}),n,h,s).catch(C)}catch(X){C(X)}}))}async function D(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.c.LastCreatedEngine,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};A?await v(c,b,new h.d(A),o,n,L,C,J,X):t.d.Error("No engine available")}async function f(c,b,A,o,t,n,h){return await new Promise(((s,L)=>{D(c,b,A,(c=>{s(c)}),o,((c,b,A)=>{L(A||new Error(b))}),t,n,h)}))}async function v(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.c.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return L.c.Error("No scene available to append to"),null;const N=d(c,b);if(!N)return null;const k={};A.addPendingData(k);const E=()=>{A.removePendingData(k)};C.b.ShowLoadingScreen&&!y&&(y=!0,A.getEngine().displayLoadingUI(),A.executeWhenReady((()=>{A.getEngine().hideLoadingUI(),y=!1})));const V=(c,b)=>{const o=M(N,c,b);n?n(A,o,new X.h(o,X.e.SceneLoaderError,b)):L.c.Error(o),E()},j=t?c=>{try{t(c)}catch(b){V("Error in onProgress callback",b)}}:void 0,F=()=>{if(o)try{o(A)}catch(c){V("Error in onSuccess callback",c)}A.removePendingData(k)};return await W(N,A,((c,b)=>{if(c.load){if(!c.load(A,b,N.rootUrl,V))return;A.loadingPluginName=c.name,F()}else{c.loadAsync(A,b,N.rootUrl,j,N.name).then((()=>{A.loadingPluginName=c.name,F()})).catch((c=>{V(c.message,c)}))}}),j,V,E,h,J,R)}async function G(c,b,A,o,t,n,h){return await new Promise(((s,L)=>{try{v(c,b,A,(c=>{s(c)}),o,((c,b,A)=>{L(A||new Error(b))}),t,n,h).catch(L)}catch(X){L(X)}}))}async function P(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.c.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return L.c.Error("No scene available to load asset container to"),null;const R=d(c,b);if(!R)return null;const N={};A.addPendingData(N);const k=()=>{A.removePendingData(N)},E=(c,b)=>{const o=M(R,c,b);n?n(A,o,new X.h(o,X.e.SceneLoaderError,b)):L.c.Error(o),k()},V=t?c=>{try{t(c)}catch(b){E("Error in onProgress callback",b)}}:void 0,y=c=>{if(o)try{o(c)}catch(b){E("Error in onSuccess callback",b)}A.removePendingData(N)};return await W(R,A,((c,b)=>{if(c.loadAssetContainer){const o=c.loadAssetContainer(A,b,R.rootUrl,E);if(!o)return;o.populateRootNodes(),A.loadingPluginName=c.name,y(o)}else if(c.loadAssetContainerAsync){c.loadAssetContainerAsync(A,b,R.rootUrl,V,R.name).then((b=>{b.populateRootNodes(),A.loadingPluginName=c.name,y(b)})).catch((c=>{E(c.message,c)}))}else E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,E,k,h,C,J)}async function O(c,b,A,o,t,n,h){return await new Promise(((s,L)=>{try{P(c,b,A,(c=>{s(c)}),o,((c,b,A)=>{L(A||new Error(b))}),t,n,h).catch(L)}catch(X){L(X)}}))}async function p(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.c.LastCreatedScene,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,R=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!A)return void L.c.Error("No scene available to load animations to");if(o){for(const o of A.animatables)o.reset();A.stopAllAnimations();const c=A.animationGroups.slice();for(const A of c)A.dispose();const b=A.getNodes();for(const A of b)A.animations&&(A.animations=[])}else switch(t){case 0:const c=A.animationGroups.slice();for(const b of c)b.dispose();break;case 1:for(const b of A.animationGroups)b.stop();break;case 2:for(const b of A.animationGroups)b.reset(),b.restart();break;case 3:break;default:return void L.c.Error("Unknown animation group loading mode value '"+t+"'")}const k=A.animatables.length;await P(c,b,A,(c=>{c.mergeAnimationsTo(A,A.animatables.slice(k),n),c.dispose(),A.onAnimationFileImportedObservable.notifyObservers(A),h&&h(A)}),C,J,X,R,N)}async function q(c,b,A,o,t,n,h,s,L,C){return await new Promise(((J,R)=>{try{p(c,b,A,o,t,n,(c=>{J(c)}),h,((c,b,A)=>{R(A||new Error(b))}),s,L,C).catch(R)}catch(X){R(X)}}))}class I{static get ForceFullSceneLoadingForIncremental(){return C.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(c){C.b.ForceFullSceneLoadingForIncremental=c}static get ShowLoadingScreen(){return C.b.ShowLoadingScreen}static set ShowLoadingScreen(c){C.b.ShowLoadingScreen=c}static get loggingLevel(){return C.b.loggingLevel}static set loggingLevel(c){C.b.loggingLevel=c}static get CleanBoneMatrixWeights(){return C.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(c){C.b.CleanBoneMatrixWeights=c}static GetDefaultPlugin(){return j()}static GetPluginForExtension(c){var b;return null===(b=F(c,!0))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(c){return function(c){return!!V[c]}(c)}static RegisterPlugin(c){r(c)}static ImportMesh(c,b,A,o,t,n,h,L,C){z(c,b,A,o,t,n,h,L,C).catch((c=>null===h||void 0===h?void 0:h(s.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async ImportMeshAsync(c,b,A,o,t,n,h){return await Y(c,b,A,o,t,n,h)}static Load(c,b,A,o,t,n,h,L){D(c,b,A,o,t,n,h,L).catch((c=>null===n||void 0===n?void 0:n(s.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async LoadAsync(c,b,A,o,t,n){return await f(c,b,A,o,t,n)}static Append(c,b,A,o,t,n,h,L){v(c,b,A,o,t,n,h,L).catch((c=>null===n||void 0===n?void 0:n(A??s.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async AppendAsync(c,b,A,o,t,n){return await G(c,b,A,o,t,n)}static LoadAssetContainer(c,b,A,o,t,n,h,L){P(c,b,A,o,t,n,h,L).catch((c=>null===n||void 0===n?void 0:n(A??s.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async LoadAssetContainerAsync(c,b,A,o,t,n){return await O(c,b,A,o,t,n)}static ImportAnimations(c,b,A,o,t,n,h,L,C,J,X){p(c,b,A,o,t,n,h,L,C,J,X).catch((c=>null===C||void 0===C?void 0:C(A??s.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async ImportAnimationsAsync(c,b,A,o,t,n,h,s,L,C,J){return await q(c,b,A,o,t,n,s,C,J)}}I.NO_LOGGING=0,I.MINIMAL_LOGGING=1,I.SUMMARY_LOGGING=2,I.DETAILED_LOGGING=3,I.OnPluginActivatedObservable=E},12734:(c,b,A)=>{"use strict";A.d(b,{b:()=>R});var o=A(672),t=A(674),n=A(525),h=A(688),s=A(2073),L=A(2070),C=A(633),J=A(518),X=A(714);A(2164);class R extends s.b{set boundingBoxSize(c){if(this._boundingBoxSize&&this._boundingBoxSize.equals(c))return;this._boundingBoxSize=c;const b=this.va();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(c){this._rotationY=c,this.setReflectionTextureMatrix(h.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(c,b,A){let o="";for(const t of c)o+=t;return new R(o,b,null,A,c)}static CreateFromPrefilteredData(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const n=new R(c,b,null,!1,null,null,null,void 0,!0,A,o);return b.useDelayedTextureLoading=t,n}constructor(c,b){var A;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,R=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]&&arguments[10],E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,y=arguments.length>13?arguments[13]:void 0,j=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new J.b,this.boundingBoxPosition=h.k.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new h.b,this._buffer=null,this.name=c,this.url=c,this._noMipmap=t,this.pi=!1,this.isCube=!0,this._textureMatrix=h.b.Identity(),this.coordinatesMode=L.d.CUBIC_MODE;let F=null,M=null;null===o||Array.isArray(o)?(this._noMipmap=t,this._format=X,this._createPolynomials=k,F=o,this._loaderOptions=y,this._useSRGBBuffer=j,this._lodScale=E,this._lodOffset=V):(F=o.extensions??null,this._noMipmap=o.noMipmap??!1,n=o.files??null,M=o.buffer??null,this._format=o.format??5,R=o.prefiltered??!1,N=o.forcedExtension??null,this._createPolynomials=o.createPolynomials??!1,this._lodScale=o.lodScale??.8,this._lodOffset=o.lodOffset??0,this._loaderOptions=o.loaderOptions,this._useSRGBBuffer=o.useSRGBBuffer,s=o.X??null,C=o.onError??null),(c||n)&&this.updateURL(c,N,s,R,C,F,null===(A=this.va())||void 0===A?void 0:A.useDelayedTextureLoading,n,M)}getClassName(){return"CubeTexture"}updateURL(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=c),this.url=c,b&&(this._forcedExtension=b);const C=c.lastIndexOf("."),J=b||(C>-1?c.substring(C).toLowerCase():""),X=0===J.indexOf(".dds"),R=0===J.indexOf(".env"),N=0===J.indexOf(".basis");if(R?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=o,o&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),s)this._files=s;else if(N||R||X||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,n){for(let b=0;b<n.length;b++)this._files.push(c+n[b]);this._extensions=n}this._buffer=L,h?(this.delayLoadState=4,this._delayedOnLoad=A,this._delayedOnError=t):this._loadTexture(A,t)}delayLoad(c){4===this.delayLoadState&&(c&&(this._forcedExtension=c),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(c){var b,A;if(c.updateFlag===this._textureMatrix.updateFlag)return;c.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(A=this.va())||void 0===A||A.markAllMaterialsAsDirty(1,(c=>-1!==c.getActiveTextures().indexOf(this))));if(this._textureMatrix=c,null===(b=this.va())||void 0===b||!b.useRightHandedSystem)return;const o=h.f.ak[0],t=h.f.Quaternion[0],n=h.f.ak[1];this._textureMatrix.decompose(o,t,n),t.z*=-1,t.w*=-1,h.b.ComposeToRef(o,t,n,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var c;return null!==(c=this.va())&&void 0!==c&&c.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this.va(),o=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const t=()=>{var b;(this.onLoadObservable.notifyObservers(this),o)&&(o.dispose(),null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1));c&&c()},h=(c,A)=>{this._loadingError=!0,this._errorObject={message:c,exception:A},b&&b(c,A),L.d.OnTextureLoadErrorObservable.notifyObservers(this)};var s;this._texture?this._texture.isReady?n.d.SetImmediate((()=>t())):this._texture.onLoadedObservable.add((()=>t())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,A,this._lodScale,this._lodOffset,c,h,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,A,this._files,this._noMipmap,c,h,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(s=this._texture)||void 0===s||s.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(c,b,A){const o=X.c.Parse((()=>{let o=!1;return c.prefiltered&&(o=c.prefiltered),new R(A+(c.url??c.name),b,c.extensions,!1,c.files||null,null,null,void 0,o,c.forcedExtension)}),c,b);if(c.boundingBoxPosition&&(o.boundingBoxPosition=h.k.$j(c.boundingBoxPosition)),c.boundingBoxSize&&(o.boundingBoxSize=h.k.$j(c.boundingBoxSize)),c.animations)for(let t=0;t<c.animations.length;t++){const b=c.animations[t],A=(0,C.c)("BABYLON.Animation");A&&o.animations.push(A.Parse(b))}return o}clone(){let c=0;const b=X.c.Clone((()=>{const b=new R(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return c=b.uniqueId,b}),this);return b.uniqueId=c,b}}(0,o.e)([(0,t.J)()],R.prototype,"url",void 0),(0,o.e)([(0,t.I)()],R.prototype,"boundingBoxPosition",void 0),(0,o.e)([(0,t.I)()],R.prototype,"boundingBoxSize",null),(0,o.e)([(0,t.J)("rotationY")],R.prototype,"rotationY",null),(0,o.e)([(0,t.J)("files")],R.prototype,"_files",void 0),(0,o.e)([(0,t.J)("forcedExtension")],R.prototype,"_forcedExtension",void 0),(0,o.e)([(0,t.J)("extensions")],R.prototype,"_extensions",void 0),(0,o.e)([(0,t.B)("textureMatrix")],R.prototype,"_textureMatrix",void 0),(0,o.e)([(0,t.B)("textureMatrixRefraction")],R.prototype,"_textureMatrixRefraction",void 0),L.d._CubeTextureParser=R.Parse,(0,C.d)("BABYLON.CubeTexture",R)},13053:(c,b,A)=>{"use strict";A.d(b,{d:()=>L});var o=A(531),t=A(2070),n=A(644),h=A(2110),s=A(615);h.ThinEngine.prototype.createDynamicTexture=function(c,b,A,o){const t=new s.c(this,4);return t.baseWidth=c,t.baseHeight=b,A&&(c=this.needPOTTextures?(0,n.i)(c,this._caps.maxTextureSize):c,b=this.needPOTTextures?(0,n.i)(b,this._caps.maxTextureSize):b),t.width=c,t.height=b,t.isReady=!1,t.generateMipMaps=A,t.samplingMode=o,this.updateTextureSamplingMode(o,t),this._internalTexturesCache.push(t),t},h.ThinEngine.prototype.updateDynamicTexture=function(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!c)return;const h=this._gl,s=h.TEXTURE_2D,L=this._bindTextureDirectly(s,c,!0,n);this._unpackFlipY(void 0===A?c.invertY:A),o&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const C=this._getWebGLTextureType(c.type),J=this._getInternalFormat(t||c.format),X=this._getRGBABufferInternalSizedFormat(c.type,J);h.texImage2D(s,0,X,J,C,b),c.generateMipMaps&&h.generateMipmap(s),L||this._bindTextureDirectly(s,null),o&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t&&(c.format=t),c._dynamicTextureSource=b,c._premulAlpha=o,c.invertY=A||!1,c.isReady=!0};class L extends t.d{constructor(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,s=arguments.length>6?arguments[6]:void 0;const L=!A||A._isScene;super(null,L?A:null===A||void 0===A?void 0:A.yd,L?!o:A,s,n,void 0,void 0,void 0,void 0,h),this.name=c,this.wrapU=t.d.CLAMP_ADDRESSMODE,this.wrapV=t.d.CLAMP_ADDRESSMODE,this._generateMipMaps=o;const C=this._getEngine();if(!C)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=C.createDynamicTexture(this._canvas.width,this._canvas.height,o,n);else{this._canvas=C.createCanvas(1,1),this._ownCanvas=!0;const c=b;c.width||0===c.width?this._texture=C.createDynamicTexture(c.width,c.height,o,n):this._texture=C.createDynamicTexture(b,b,o,n)}const J=this.getSize();this._canvas.width!==J.width&&(this._canvas.width=J.width),this._canvas.height!==J.height&&(this._canvas.height=J.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(c){this._canvas.width=c.width,this._canvas.height=c.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(c.width,c.height,this._generateMipMaps,this.samplingMode)}scale(c){const b=this.getSize();b.width*=c,b.height*=c,this._recreate(b)}scaleTo(c,b){const A=this.getSize();A.width=c,A.height=b,this._recreate(A)}getContext(){return this._context}clear(c){const b=this.getSize();c&&(this._context.fillStyle=c),this._context.clearRect(0,0,b.width,b.height)}update(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===c||c,b,this._format||void 0,void 0,A)}drawText(c,b,A,o,t,n,h){let s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const L=this.getSize();if(n&&(this._context.fillStyle=n,this._context.fillRect(0,0,L.width,L.height)),this._context.font=o,null===b||void 0===b){const A=this._context.measureText(c);b=(L.width-A.width)/2}if(null===A||void 0===A){const c=parseInt(o.replace(/\D/g,""));A=L.height/2+c/3.65}this._context.fillStyle=t||"",this._context.fillText(c,b,A),s&&this.update(h)}dispose(){var c,b;(super.dispose(),this._ownCanvas)&&(null===(c=this._canvas)||void 0===c||null===(b=c.remove)||void 0===b||b.call(c));this._canvas=null,this._context=null}clone(){const c=this.va();if(!c)return this;const b=this.getSize(),A=new L(this.name,b,c,this._generateMipMaps);return A.pi=this.pi,A.level=this.level,A.wrapU=this.wrapU,A.wrapV=this.wrapV,A}serialize(){const c=this.va();c&&!c.isReady()&&o.c.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return L._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(c){return void 0!==c.toDataURL}_rebuild(){this.update()}}},12659:(c,b,A)=>{"use strict";A.d(b,{d:()=>t});var o=A(2070);class t extends o.d{get depth(){return this._depth}constructor(c,b,A,t,n,h){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],L=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:o.d.TRILINEAR_SAMPLINGMODE,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10?arguments[10]:void 0;super(null,h,!s,L),this.format=n,this._texture=h.getEngine().createRawTexture2DArray(c,b,A,t,n,s,L,C,null,J,X),this._depth=t,this.is2DArray=!0}update(c){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,c,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(c,b,A,o,n){return new t(c,b,A,o,5,n,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12472:(c,b,A)=>{"use strict";A.d(b,{c:()=>s,d:()=>L,f:()=>n,h:()=>h});var o=A(702),t=A(688);function n(c,b){return`{X: ${c.x.toFixed(b)} Y: ${c.y.toFixed(b)}}`}function h(c,b){return`{X: ${c._x.toFixed(b)} Y: ${c._y.toFixed(b)} Z: ${c._z.toFixed(b)}}`}function s(c,b){return 2*Math.acos((0,o.Clamp)(t.e.Dot(c,b)))}function L(c,b){const A=new t.e;return function(c,b,A){const n=t.k.Cross(c,b),h=Math.acos((0,o.Clamp)(t.k.Dot(c,b),-1,1));t.e.RotationAxisToRef(n,h,A)}(c,b,A),A}},12301:(c,b,A)=>{"use strict";A.d(b,{c:()=>C});var o=A(688),t=A(721),n=A(510),h=A(760),s=A(816);A(12303);function L(c){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const A=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[];let L=[];const C=c.width||c.size||1,J=c.height||c.size||1,X=c.depth||c.size||1,R=c.wrap||!1;let N=void 0===c.topBaseAt?1:c.topBaseAt,k=void 0===c.bottomBaseAt?0:c.bottomBaseAt;N=(N+4)%4,k=(k+4)%4;let E=[2,0,3,1][N],V=[2,0,1,3][k],y=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(R){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],y=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let c=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],A=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const o=[17,18,19,16],t=[22,23,20,21];for(;E>0;)c.unshift(c.pop()),o.unshift(o.pop()),E--;for(;V>0;)A.unshift(A.pop()),t.unshift(t.pop()),V--;c=c.flat(),A=A.flat(),y=y.concat(c).concat(A),b.push(o[0],o[2],o[3],o[0],o[1],o[2]),b.push(t[0],t[2],t[3],t[0],t[1],t[2])}const j=[C/2,J/2,X/2];L=y.reduce(((c,b,A)=>c.concat(b*j[A%3])),[]);const F=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE,M=c.faceUV||new Array(6),W=c.faceColors,d=[];for(let h=0;h<6;h++)void 0===M[h]&&(M[h]=new o.o(0,0,1,1)),W&&void 0===W[h]&&(W[h]=new t.h(1,1,1,1));for(let o=0;o<6;o++)if(n.push(M[o].z,s.b?1-M[o].w:M[o].w),n.push(M[o].x,s.b?1-M[o].w:M[o].w),n.push(M[o].x,s.b?1-M[o].y:M[o].y),n.push(M[o].z,s.b?1-M[o].y:M[o].y),W)for(let c=0;c<4;c++)d.push(W[o].r,W[o].g,W[o].b,W[o].a);h.c._ComputeSides(F,L,b,A,n,c.frontUVs,c.backUVs);const r=new h.c;if(r.indices=b,r.xa=L,r.ya=A,r.Aa=n,W){const c=F===h.c.DOUBLESIDE?d.concat(d):d;r.za=c}return r}function C(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new n.d(c,A);b.sideOrientation=n.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return L(b).Ca(o,b.updatable),o}h.c.CreateBox=L,n.d.CreateBox=function(c,b){return C(c,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12303:(c,b,A)=>{"use strict";A.d(b,{g:()=>V,d:()=>j,k:()=>y});var o=A(688),t=A(721),n=A(510),h=A(760),s=A(747);n.d._GroundMeshParser=(c,b)=>L.Parse(c,b);class L extends n.d{constructor(c,b){super(c,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=c,this._subdivisionsY=c,this.subdivide(c);const A=this;A.createOrUpdateSubmeshesOctree&&A.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(c,b){const A=this.getWorldMatrix(),t=o.f.Matrix[5];A.invertToRef(t);const n=o.f.ak[8];if(o.k.TransformCoordinatesFromFloatsToRef(c,0,b,t,n),c=n.x,b=n.z,c<this._minX||c>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(c,b),s=-(h.x*c+h.z*b+h.w)/h.y;return o.k.TransformCoordinatesFromFloatsToRef(0,s,0,A,n),n.y}getNormalAtCoordinates(c,b){const A=new o.k(0,1,0);return this.getNormalAtCoordinatesToRef(c,b,A),A}getNormalAtCoordinatesToRef(c,b,A){const t=this.getWorldMatrix(),n=o.f.Matrix[5];t.invertToRef(n);const h=o.f.ak[8];if(o.k.TransformCoordinatesFromFloatsToRef(c,0,b,n,h),c=h.x,b=h.z,c<this._minX||c>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const s=this._getFacetAt(c,b);return o.k.TransformNormalFromFloatsToRef(s.x,s.y,s.z,t,A),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(c,b){const A=Math.floor((c+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),t=this._heightQuads[o*this._subdivisionsX+A];let n;return n=b<t.slope.x*c+t.slope.y?t.facet1:t.facet2,n}_initHeightQuads(){const c=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=[];for(let A=0;A<b;A++)for(let b=0;b<c;b++){const t={slope:o.h.Zero(),facet1:new o.o(0,0,0,0),facet2:new o.o(0,0,0,0)};this._heightQuads[A*c+b]=t}return this}_computeHeightQuads(){const c=this.getVerticesData(s.f.PositionKind);if(!c)return this;const b=o.f.ak[3],A=o.f.ak[2],t=o.f.ak[1],n=o.f.ak[0],h=o.f.ak[4],L=o.f.ak[5],C=o.f.ak[6],J=o.f.ak[7],X=o.f.ak[8];let R=0,N=0,k=0,E=0,V=0,y=0,j=0;const F=this._subdivisionsX,M=this._subdivisionsY;for(let s=0;s<M;s++)for(let M=0;M<F;M++){R=3*M,N=s*(F+1)*3,k=(s+1)*(F+1)*3,b.x=c[N+R],b.y=c[N+R+1],b.z=c[N+R+2],A.x=c[N+R+3],A.y=c[N+R+4],A.z=c[N+R+5],t.x=c[k+R],t.y=c[k+R+1],t.z=c[k+R+2],n.x=c[k+R+3],n.y=c[k+R+4],n.z=c[k+R+5],E=(n.z-b.z)/(n.x-b.x),V=b.z-E*b.x,A.subtractToRef(b,h),t.subtractToRef(b,L),n.subtractToRef(b,C),o.k.CrossToRef(C,L,J),o.k.CrossToRef(h,C,X),J.normalize(),X.normalize(),y=-(J.x*b.x+J.y*b.y+J.z*b.z),j=-(X.x*A.x+X.y*A.y+X.z*A.z);const W=this._heightQuads[s*F+M];W.slope.jd(E,V),W.facet1.jd(J.x,J.y,J.z,y),W.facet2.jd(X.x,X.y,X.z,j)}return this}serialize(c){super.serialize(c),c.subdivisionsX=this._subdivisionsX,c.subdivisionsY=this._subdivisionsY,c.minX=this._minX,c.maxX=this._maxX,c.Vj=this._minZ,c.maxZ=this._maxZ,c.width=this._width,c.height=this._height}static Parse(c,b){const A=new L(c.name,b);return A._subdivisionsX=c.subdivisionsX||1,A._subdivisionsY=c.subdivisionsY||1,A._minX=c.minX,A._maxX=c.maxX,A._minZ=c.Vj,A._maxZ=c.maxZ,A._width=c.width,A._height=c.height,A}}var C=A(525),J=A(550),X=A(693),R=A(816);function N(c){const b=[],A=[],t=[],n=[];let s,L;const C=c.width||c.size||1,J=c.height||c.size||1,X=0|(c.subdivisionsX||c.subdivisions||1),N=0|(c.subdivisionsY||c.subdivisions||1);for(s=0;s<=N;s++)for(L=0;L<=X;L++){const c=new o.k(L*C/X-C/2,0,(N-s)*J/N-J/2),b=new o.k(0,1,0);A.push(c.x,c.y,c.z),t.push(b.x,b.y,b.z),n.push(L/X,R.b?s/N:1-s/N)}for(s=0;s<N;s++)for(L=0;L<X;L++)b.push(L+1+(s+1)*(X+1)),b.push(L+1+s*(X+1)),b.push(L+s*(X+1)),b.push(L+(s+1)*(X+1)),b.push(L+1+(s+1)*(X+1)),b.push(L+s*(X+1));const k=new h.c;return k.indices=b,k.xa=A,k.ya=t,k.Aa=n,k}function k(c){const b=void 0!==c.xmin&&null!==c.xmin?c.xmin:-1,A=void 0!==c.zmin&&null!==c.zmin?c.zmin:-1,t=void 0!==c.xmax&&null!==c.xmax?c.xmax:1,n=void 0!==c.zmax&&null!==c.zmax?c.zmax:1,s=c.subdivisions||{w:1,h:1},L=c.precision||{w:1,h:1},C=[],J=[],X=[],R=[];let N,k,E,V;s.h=s.h<1?1:s.h,s.w=s.w<1?1:s.w,L.w=L.w<1?1:L.w,L.h=L.h<1?1:L.h;const y=(t-b)/s.w,j=(n-A)/s.h;function F(c,b,A,t){const n=J.length/3,h=L.w+1;for(N=0;N<L.h;N++)for(k=0;k<L.w;k++){const c=[n+k+N*h,n+(k+1)+N*h,n+(k+1)+(N+1)*h,n+k+(N+1)*h];C.push(c[1]),C.push(c[2]),C.push(c[3]),C.push(c[0]),C.push(c[1]),C.push(c[3])}const s=o.k.Zero(),E=new o.k(0,1,0);for(N=0;N<=L.h;N++)for(s.z=N*(t-b)/L.h+b,k=0;k<=L.w;k++)s.x=k*(A-c)/L.w+c,s.y=0,J.push(s.x,s.y,s.z),X.push(E.x,E.y,E.z),R.push(k/L.w,N/L.h)}for(E=0;E<s.h;E++)for(V=0;V<s.w;V++)F(b+V*y,A+E*j,b+(V+1)*y,A+(E+1)*j);const M=new h.c;return M.indices=C,M.xa=J,M.ya=X,M.Aa=R,M}function E(c){const b=[],A=[],n=[],s=[];let L,C;const J=c.colorFilter||new t.d(.3,.59,.11),R=c.alphaFilter||0;let N=!1;if(c.minHeight>c.maxHeight){N=!0;const b=c.maxHeight;c.maxHeight=c.minHeight,c.minHeight=b}for(L=0;L<=c.subdivisions;L++)for(C=0;C<=c.subdivisions;C++){const b=new o.k(C*c.width/c.subdivisions-c.width/2,0,(c.subdivisions-L)*c.height/c.subdivisions-c.height/2),t=4*(((b.x+c.width/2)/c.width*(c.bufferWidth-1)|0)+((1-(b.z+c.height/2)/c.height)*(c.bufferHeight-1)|0)*c.bufferWidth);let h=c.buffer[t]/255,k=c.buffer[t+1]/255,E=c.buffer[t+2]/255;const V=c.buffer[t+3]/255;N&&(h=1-h,k=1-k,E=1-E);const y=h*J.r+k*J.g+E*J.b;b.y=V>=R?c.minHeight+(c.maxHeight-c.minHeight)*y:c.minHeight-X.d,c.heightBuffer&&(c.heightBuffer[L*(c.subdivisions+1)+C]=b.y),A.push(b.x,b.y,b.z),n.push(0,0,0),s.push(C/c.subdivisions,1-L/c.subdivisions)}for(L=0;L<c.subdivisions;L++)for(C=0;C<c.subdivisions;C++){const o=C+1+(L+1)*(c.subdivisions+1),t=C+1+L*(c.subdivisions+1),n=C+L*(c.subdivisions+1),h=C+(L+1)*(c.subdivisions+1),s=A[3*o+1]>=c.minHeight,J=A[3*t+1]>=c.minHeight,X=A[3*n+1]>=c.minHeight;s&&J&&X&&(b.push(o),b.push(t),b.push(n));A[3*h+1]>=c.minHeight&&s&&X&&(b.push(h),b.push(o),b.push(n))}h.c.ComputeNormals(A,b,n);const k=new h.c;return k.indices=b,k.xa=A,k.ya=n,k.Aa=s,k}function V(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=new L(c,arguments.length>2?arguments[2]:void 0);A._setReady(!1),A._subdivisionsX=b.subdivisionsX||b.subdivisions||1,A._subdivisionsY=b.subdivisionsY||b.subdivisions||1,A._width=b.width||1,A._height=b.height||1,A._maxX=A._width/2,A._maxZ=A._height/2,A._minX=-A._maxX,A._minZ=-A._maxZ;return N(b).Ca(A,b.updatable),A._setReady(!0),A}function y(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new n.d(c,A);return k(b).Ca(o,b.updatable),o}function j(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const n=A.width||10,h=A.height||10,s=A.subdivisions||1,X=A.minHeight||0,R=A.maxHeight||1,N=A.colorFilter||new t.d(.3,.59,.11),k=A.alphaFilter||0,V=A.updatable,y=A.onReady;o=o||J.c.LastCreatedScene;const j=new L(c,o);let F;j._subdivisionsX=s,j._subdivisionsY=s,j._width=n,j._height=h,j._maxX=j._width/2,j._maxZ=j._height/2,j._minX=-j._maxX,j._minZ=-j._maxZ,j._setReady(!1),A.passHeightBufferInCallback&&(F=new Float32Array((s+1)*(s+1)));const M=(c,b,A)=>{E({width:n,height:h,subdivisions:s,minHeight:X,maxHeight:R,colorFilter:N,buffer:c,bufferWidth:b,bufferHeight:A,alphaFilter:k,heightBuffer:F}).Ca(j,V),y&&y(j,F),j._setReady(!0)};if("string"===typeof b){const c=c=>{var b;const A=c.width,t=c.height;if(o.u)return;const n=null===(b=o)||void 0===b?void 0:b.getEngine().resizeImageBitmap(c,A,t);M(n,A,t)};C.d.LoadImage(b,c,A.onError?A.onError:()=>{},o.offlineProvider)}else M(b.data,b.width,b.height);return j}h.c.CreateGround=N,h.c.CreateTiledGround=k,h.c.CreateGroundFromHeightMap=E,n.d.CreateGround=(c,b,A,o,t,n)=>V(c,{width:b,height:A,subdivisions:o,updatable:n},t),n.d.CreateTiledGround=(c,b,A,o,t,n,h,s,L)=>y(c,{xmin:b,zmin:A,xmax:o,zmax:t,subdivisions:n,precision:h,updatable:L},s),n.d.CreateGroundFromHeightMap=(c,b,A,o,t,n,h,s,L,C,J)=>j(c,b,{width:A,height:o,subdivisions:t,minHeight:n,maxHeight:h,updatable:L,onReady:C,alphaFilter:J},s)},12953:(c,b,A)=>{"use strict";A.d(b,{e:()=>N,h:()=>X,i:()=>R});var o=A(688),t=A(510),n=A(760),h=A(11930),s=A(747),L=A(531);function C(c){const b=[],A=[],o=c.lines,t=c.za,h=[];let s=0;for(let n=0;n<o.length;n++){const c=o[n];for(let o=0;o<c.length;o++){const{x:L,y:C,z:J}=c[o];if(A.push(L,C,J),t){const c=t[n],{r:b,g:A,b:s,a:L}=c[o];h.push(b,A,s,L)}o>0&&(b.push(s-1),b.push(s)),s++}}const L=new n.c;return L.indices=b,L.xa=A,t&&(L.za=h),L}function J(c){const b=c.dashSize||3,A=c.gapSize||1,t=c.dashNb||200,h=c.points,s=[],L=[],C=o.k.Zero();let J=0,X=0,R=0,N=0,k=0,E=0,V=0;for(V=0;V<h.length-1;V++)h[V+1].subtractToRef(h[V],C),J+=C.length();for(R=J/t,N=b*R/(b+A),V=0;V<h.length-1;V++){h[V+1].subtractToRef(h[V],C),X=Math.floor(C.length()/R),C.normalize();for(let c=0;c<X;c++)k=R*c,s.push(h[V].x+k*C.x,h[V].y+k*C.y,h[V].z+k*C.z),s.push(h[V].x+(k+N)*C.x,h[V].y+(k+N)*C.y,h[V].z+(k+N)*C.z),L.push(E,E+1),E+=2}const y=new n.c;return y.xa=s,y.indices=L,y}function X(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.instance,t=b.lines,n=b.za;if(o){const c=o.getVerticesData(s.f.PositionKind);let b,A;n&&(b=o.getVerticesData(s.f.ColorKind));let h=0,L=0;for(let o=0;o<t.length;o++){const s=t[o];for(let t=0;t<s.length;t++)c[h]=s[t].x,c[h+1]=s[t].y,c[h+2]=s[t].z,n&&b&&(A=n[o],b[L]=A[t].r,b[L+1]=A[t].g,b[L+2]=A[t].b,b[L+3]=A[t].a,L+=4),h+=3}return o.updateVerticesData(s.f.PositionKind,c,!1,!1),n&&b&&o.updateVerticesData(s.f.ColorKind,b,!1,!1),o.refreshBoundingInfo(),o}const L=!!n,J=new h.b(c,A,null,void 0,void 0,L,b.useVertexAlpha,b.material);return C(b).Ca(J,b.updatable),J}function R(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.za?[b.za]:null;return X(c,{lines:[b.points],updatable:b.updatable,instance:b.instance,za:o,useVertexAlpha:b.useVertexAlpha,material:b.material},A)}function N(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=b.points,s=b.instance,C=b.gapSize||1,X=b.dashSize||3;if(s){const c=c=>{const b=o.k.Zero(),A=c.length/6;let t=0,h=0,L=0,C=0,J=0,X=0,R=0,N=0;for(R=0;R<n.length-1;R++)n[R+1].subtractToRef(n[R],b),t+=b.length();L=t/A;const k=s._creationDataStorage.dashSize;for(C=k*L/(k+s._creationDataStorage.gapSize),R=0;R<n.length-1;R++)for(n[R+1].subtractToRef(n[R],b),h=Math.floor(b.length()/L),b.normalize(),N=0;N<h&&X<c.length;)J=L*N,c[X]=n[R].x+J*b.x,c[X+1]=n[R].y+J*b.y,c[X+2]=n[R].z+J*b.z,c[X+3]=n[R].x+(J+C)*b.x,c[X+4]=n[R].y+(J+C)*b.y,c[X+5]=n[R].z+(J+C)*b.z,X+=6,N++;for(;X<c.length;)c[X]=n[R].x,c[X+1]=n[R].y,c[X+2]=n[R].z,X+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&L.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),s.updateMeshPositions(c,!1),s}const R=new h.b(c,A,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return J(b).Ca(R,b.updatable),R._creationDataStorage=new t.g,R._creationDataStorage.dashSize=X,R._creationDataStorage.gapSize=C,R}n.c.CreateLineSystem=C,n.c.CreateDashedLines=J,t.d.Ek=function(c,b){return R(c,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},t.d.CreateDashedLines=function(c,b,A,o,t){return N(c,{points:b,dashSize:A,gapSize:o,dashNb:t,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12359:(c,b,A)=>{"use strict";A.d(b,{c:()=>s,f:()=>L});var o=A(510),t=A(760),n=A(816);function h(c){const b=[],A=[],o=[],h=[],s=void 0!==c.width?c.width:void 0!==c.size?c.size:1,L=void 0!==c.height?c.height:void 0!==c.size?c.size:1,C=0===c.sideOrientation?0:c.sideOrientation||t.c.DEFAULTSIDE,J=s/2,X=L/2;A.push(-J,-X,0),o.push(0,0,-1),h.push(0,n.b?1:0),A.push(J,-X,0),o.push(0,0,-1),h.push(1,n.b?1:0),A.push(J,X,0),o.push(0,0,-1),h.push(1,n.b?0:1),A.push(-J,X,0),o.push(0,0,-1),h.push(0,n.b?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),t.c._ComputeSides(C,A,b,o,h,c.frontUVs,c.backUVs);const R=new t.c;return R.indices=b,R.xa=A,R.ya=o,R.Aa=h,R}function s(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new o.d(c,A);b.sideOrientation=o.d._GetDefaultSideOrientation(b.sideOrientation),t._originalBuilderSideOrientation=b.sideOrientation;return h(b).Ca(t,b.updatable),b.sourcePlane&&(t.translate(b.sourcePlane.ik,-b.sourcePlane.d),t.setDirection(b.sourcePlane.ik.scale(-1))),t}const L={Fk:s};t.c.Fk=h,o.d.Fk=(c,b,A,o,t)=>s(c,{size:b,width:b,height:b,sideOrientation:t,updatable:o},A)},12457:(c,b,A)=>{"use strict";A.d(b,{c:()=>L});var o=A(688),t=A(510),n=A(760),h=A(816);function s(c){const b=0|(c.segments||32),A=c.diameterX||c.diameter||1,t=c.diameterY||c.diameter||1,s=c.diameterZ||c.diameter||1,L=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1,C=c.slice&&c.slice<=0?1:c.slice||1,J=0===c.sideOrientation?0:c.sideOrientation||n.c.DEFAULTSIDE,X=!!c.dedupTopBottomIndices,R=new o.k(A/2,t/2,s/2),N=2+b,k=2*N,E=[],V=[],y=[],j=[];for(let n=0;n<=N;n++){const c=n/N,b=c*Math.PI*C;for(let A=0;A<=k;A++){const t=A/k,n=t*Math.PI*2*L,s=o.b.RotationZ(-b),C=o.b.RotationY(n),J=o.k.TransformCoordinates(o.k.Up(),s),X=o.k.TransformCoordinates(J,C),N=X.multiply(R),E=X.divide(R).normalize();V.push(N.x,N.y,N.z),y.push(E.x,E.y,E.z),j.push(t,h.b?1-c:c)}if(n>0){const c=V.length/3;for(let b=c-2*(k+1);b+k+2<c;b++)X?(n>1&&(E.push(b),E.push(b+1),E.push(b+k+1)),(n<N||C<1)&&(E.push(b+k+1),E.push(b+1),E.push(b+k+2))):(E.push(b),E.push(b+1),E.push(b+k+1),E.push(b+k+1),E.push(b+1),E.push(b+k+2))}}n.c._ComputeSides(J,V,E,y,j,c.frontUVs,c.backUVs);const F=new n.c;return F.indices=E,F.xa=V,F.ya=y,F.Aa=j,F}function L(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return s(b).Ca(o,b.updatable),o}n.c.CreateSphere=s,t.d.CreateSphere=(c,b,A,o,t,n)=>L(c,{segments:b,diameterX:A,diameterY:A,diameterZ:A,sideOrientation:n,updatable:t},o)},13064:(c,b,A)=>{"use strict";A.d(b,{c:()=>s});var o=A(11946),t=A(12736),n=A(11953),h=A(760);class s{static get Configuration(){return{get decoder(){return t.c.DefaultConfiguration},set decoder(c){t.c.DefaultConfiguration=c}}}static set Configuration(c){t.c.DefaultConfiguration=c.decoder}static get DecoderAvailable(){return(0,o.j)(t.c.DefaultConfiguration)}static get Default(){return s._Default??(s._Default=new s),s._Default}static ResetDefault(c){s._Default&&(c||s._Default.dispose(),s._Default=null)}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultNumWorkers;const b="number"===typeof c?{...t.c.DefaultConfiguration,numWorkers:c}:{...t.c.DefaultConfiguration,...c};this._decoder=new t.c(b)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(c,b,A){return this._decoder.decodeMeshToMeshDataAsync(c,b,A)}async decodeMeshToGeometryAsync(c,b,A,o){return await this._decoder.decodeMeshToGeometryAsync(c,b,A,o)}async _decodeMeshToGeometryForGltfAsync(c,b,A,o,t,n){return await this._decoder._decodeMeshToGeometryForGltfAsync(c,b,A,o,t,n)}async decodeMeshAsync(c,b){const A=await this._decoder.decodeMeshToMeshDataAsync(c,b),o=new h.c;A.indices&&(o.indices=A.indices);for(const t of A.attributes){const c=n.b.GetFloatData(t.data,t.size,n.b.GetDataType(t.data),t.byteOffset,t.byteStride,t.normalized,A.totalVertices);o.set(c,t.kind)}return o}}s.DefaultNumWorkers=(0,o.h)(),s._Default=null},12736:(c,b,A)=>{"use strict";A.d(b,{c:()=>C});var o=A(11946),t=A(525),n=A(808),h=A(11953),s=A(531),L=A(11950);class C extends o.e{static get DefaultAvailable(){return(0,o.j)(C.DefaultConfiguration)}static get Default(){return C._Default??(C._Default=new C),C._Default}static ResetDefault(c){C._Default&&(c||C._Default.dispose(),C._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(c,b){return{module:await(b||DracoDecoderModule)({wasmBinary:c})}}_getWorkerContent(){return`${L.b}(${L.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultConfiguration)}decodeMeshToMeshDataAsync(c,b,A){const o=c instanceof ArrayBuffer?new Int8Array(c):new Int8Array(c.buffer,c.byteOffset,c.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async c=>await new Promise(((t,n)=>{c.push(((c,h)=>{let L=null;const C=[],J=b=>{c.removeEventListener("error",J),c.removeEventListener("message",X),n(b),h()},X=b=>{const o=b.data;switch(o.id){case"indices":L=o.data;break;case"attribute":C.push({kind:o.kind,data:o.data,size:o.size,byteOffset:o.byteOffset,byteStride:o.byteStride,normalized:(n=o.kind,R=o.normalized,A&&void 0!==A[n]?(R!==A[n]&&s.c.Warn(`Normalized flag from Draco data (${R}) does not match normalized flag from glTF accessor (${A[n]}). Using flag from glTF accessor.`),A[n]):R)});break;case"decodeMeshDone":c.removeEventListener("error",J),c.removeEventListener("message",X),t({indices:L,attributes:C,totalVertices:o.totalVertices}),h()}var n,R};c.addEventListener("error",J),c.addEventListener("message",X);const R=o.slice();c.postMessage({id:"decodeMesh",dataView:R,attributes:b},[R.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((c=>{let A=null;const t=[],n=(0,L.b)(c.module,o,b,(c=>{A=c}),((c,b,A,o,n,h)=>{t.push({kind:c,data:b,size:A,byteOffset:o,byteStride:n,normalized:h})}));return{indices:A,attributes:t,totalVertices:n}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(c,b,A,o){const t=await this.decodeMeshToMeshDataAsync(A,o),s=new n.c(c,b);t.indices&&s.setIndices(t.indices);for(const n of t.attributes)s.setVerticesBuffer(new h.b(b.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),t.totalVertices);return s}async _decodeMeshToGeometryForGltfAsync(c,b,A,o,t,s){const L=await this.decodeMeshToMeshDataAsync(A,o,t),C=new n.c(c,b);s&&(C._boundingInfo=s,C.useBoundingInfoFromGeometry=!0),L.indices&&C.setIndices(L.indices);for(const n of L.attributes)C.setVerticesBuffer(new h.b(b.getEngine(),n.data,n.kind,!1,void 0,n.byteStride,void 0,n.byteOffset,n.size,void 0,n.normalized,!0),L.totalVertices);return C}}C.DefaultConfiguration={wasmUrl:`${t.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${t.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${t.d._DefaultCdnUrl}/draco_decoder_gltf.js`},C._Default=null},12945:(c,b,A)=>{"use strict";A.d(b,{b:()=>sc});var o=A(688),t=A(510),n=A(747),h=A(760),s=A(816);function L(c){let b=c.pathArray;const A=c.closeArray||!1,o=c.closePath||!1,t=c.invertUV||!1,L=Math.floor(b[0].length/2);let C=c.offset||L;C=C>L?L:Math.floor(C);const J=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE,X=c.Aa,R=c.za,N=[],k=[],E=[],V=[],y=[],j=[],F=[],M=[];let W;const d=[],r=[];let z,Y,D;if(b.length<2){const c=[],A=[];for(Y=0;Y<b[0].length-C;Y++)c.push(b[0][Y]),A.push(b[0][Y+C]);b=[c,A]}let f=0;const v=o?1:0,G=A?1:0;let P,O,p,q,I,K;for(W=b[0].length,z=0;z<b.length+G;z++){for(F[z]=0,y[z]=[0],P=z===b.length?b[0]:b[z],O=P.length,W=W<O?W:O,D=0;D<O;)N.push(P[D].x,P[D].y,P[D].z),D>0&&(p=P[D].Xd(P[D-1]).length(),q=p+F[z],y[z].push(q),F[z]=q),D++;o&&(D--,N.push(P[0].x,P[0].y,P[0].z),p=P[D].Xd(P[0]).length(),q=p+F[z],y[z].push(q),F[z]=q),d[z]=O+v,r[z]=f,f+=O+v}let Z,H,S=null,B=null;for(Y=0;Y<W+v;Y++)for(M[Y]=0,j[Y]=[0],z=0;z<b.length-1+G;z++)I=b[z],K=z===b.length-1?b[0]:b[z+1],Y===W?(S=I[0],B=K[0]):(S=I[Y],B=K[Y]),p=B.Xd(S).length(),q=p+M[Y],j[Y].push(q),M[Y]=q;if(X)for(z=0;z<X.length;z++)V.push(X[z].x,s.b?1-X[z].y:X[z].y);else for(z=0;z<b.length+G;z++)for(Y=0;Y<W+v;Y++)Z=0!=F[z]?y[z][Y]/F[z]:0,H=0!=M[Y]?j[Y][z]/M[Y]:0,t?V.push(H,Z):V.push(Z,s.b?1-H:H);z=0;let Q=0,a=d[z]-1,l=d[z+1]-1,T=a<l?a:l,i=r[1]-r[0];const g=d.length-1;for(;Q<=T&&z<g;)k.push(Q,Q+i,Q+1),k.push(Q+i+1,Q+1,Q+i),Q+=1,Q===T&&(z++,i=r[z+1]-r[z],a=d[z]-1,l=d[z+1]-1,Q=r[z],T=a<l?a+Q:l+Q);if(h.c.ComputeNormals(N,k,E),o){let c=0,A=0;for(z=0;z<b.length;z++){c=3*r[z],A=z+1<b.length?3*(r[z+1]-1):E.length-3,E[c]=.5*(E[c]+E[A]),E[c+1]=.5*(E[c+1]+E[A+1]),E[c+2]=.5*(E[c+2]+E[A+2]);const o=Math.sqrt(E[c]*E[c]+E[c+1]*E[c+1]+E[c+2]*E[c+2]);E[c]/=o,E[c+1]/=o,E[c+2]/=o,E[A]=E[c],E[A+1]=E[c+1],E[A+2]=E[c+2]}}if(A){let c=3*r[0],A=3*r[b.length];for(Y=0;Y<W+v;Y++){E[c]=.5*(E[c]+E[A]),E[c+1]=.5*(E[c+1]+E[A+1]),E[c+2]=.5*(E[c+2]+E[A+2]);const b=Math.sqrt(E[c]*E[c]+E[c+1]*E[c+1]+E[c+2]*E[c+2]);E[c]/=b,E[c+1]/=b,E[c+2]/=b,E[A]=E[c],E[A+1]=E[c+1],E[A+2]=E[c+2],c+=3,A+=3}}h.c._ComputeSides(J,N,k,E,V,c.frontUVs,c.backUVs);let u=null;if(R){u=new Float32Array(4*R.length);for(let c=0;c<R.length;c++)u[4*c]=R[c].r,u[4*c+1]=R[c].g,u[4*c+2]=R[c].b,u[4*c+3]=R[c].a}const e=new h.c,x=new Float32Array(N),U=new Float32Array(E),w=new Float32Array(V);return e.indices=k,e.xa=x,e.ya=U,e.Aa=w,u&&e.set(u,n.f.ColorKind),o&&(e._idx=r),e}function C(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=b.pathArray,J=b.closeArray,X=b.closePath,R=t.d._GetDefaultSideOrientation(b.sideOrientation),N=b.instance,k=b.updatable;if(N){const c=o.f.ak[0].bk(Number.MAX_VALUE),A=o.f.ak[1].bk(-Number.MAX_VALUE),L=b=>{let o=C[0].length;const n=N;let h=0;const s=n._originalBuilderSideOrientation===t.d.DOUBLESIDE?2:1;for(let t=1;t<=s;++t)for(let s=0;s<C.length;++s){const t=C[s],L=t.length;o=o<L?o:L;for(let n=0;n<o;++n){const o=t[n];b[h]=o.x,b[h+1]=o.y,b[h+2]=o.z,c.minimizeInPlaceFromFloats(o.x,o.y,o.z),A.maximizeInPlaceFromFloats(o.x,o.y,o.z),h+=3}if(n._creationDataStorage&&n._creationDataStorage.closePath){const c=t[0];b[h]=c.x,b[h+1]=c.y,b[h+2]=c.z,h+=3}}},J=N.getVerticesData(n.f.PositionKind);if(L(J),N.hasBoundingInfo?N.getBoundingInfo().reConstruct(c,A,N._worldMatrix):N.buildBoundingInfo(c,A,N._worldMatrix),N.updateVerticesData(n.f.PositionKind,J,!1,!1),b.za){const c=N.getVerticesData(n.f.ColorKind);for(let A=0,o=0;A<b.za.length;A++,o+=4){const t=b.za[A];c[o]=t.r,c[o+1]=t.g,c[o+2]=t.b,c[o+3]=t.a}N.updateVerticesData(n.f.ColorKind,c,!1,!1)}if(b.Aa){const c=N.getVerticesData(n.f.UVKind);for(let A=0;A<b.Aa.length;A++)c[2*A]=b.Aa[A].x,c[2*A+1]=s.b?1-b.Aa[A].y:b.Aa[A].y;N.updateVerticesData(n.f.UVKind,c,!1,!1)}if(!N.areNormalsFrozen||N.isFacetDataEnabled){const c=N._j(),b=N.getVerticesData(n.f.NormalKind),A=N.isFacetDataEnabled?N.getFacetDataParameters():null;if(h.c.ComputeNormals(J,c,b,A),N._creationDataStorage&&N._creationDataStorage.closePath){let c=0,A=0;for(let o=0;o<C.length;o++)c=3*N._creationDataStorage.idx[o],A=o+1<C.length?3*(N._creationDataStorage.idx[o+1]-1):b.length-3,b[c]=.5*(b[c]+b[A]),b[c+1]=.5*(b[c+1]+b[A+1]),b[c+2]=.5*(b[c+2]+b[A+2]),b[A]=b[c],b[A+1]=b[c+1],b[A+2]=b[c+2]}N.areNormalsFrozen||N.updateVerticesData(n.f.NormalKind,b,!1,!1)}return N}{const o=new t.d(c,A);o._originalBuilderSideOrientation=R,o._creationDataStorage=new t.g;const n=L(b);return X&&(o._creationDataStorage.idx=n._idx),o._creationDataStorage.closePath=X,o._creationDataStorage.closeArray=J,n.Ca(o,k),o}}h.c.CreateRibbon=L,t.d.CreateRibbon=function(c,b){return C(c,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var J=A(886),X=A(12301),R=A(721);function N(c){const b=c.pattern||t.d.NO_FLIP,A=c.tileWidth||c.tileSize||1,o=c.tileHeight||c.tileSize||1,n=c.alignHorizontal||0,s=c.alignVertical||0,L=c.width||c.size||1,C=Math.floor(L/A);let J=L-C*A;const X=c.height||c.size||1,R=Math.floor(X/o);let N=X-R*o;const k=A*C/2,E=o*R/2;let V=0,y=0,j=0,F=0,M=0,W=0;if(J>0||N>0){switch(j=-k,F=-E,M=k,W=E,n){case t.d.CENTER:J/=2,j-=J,M+=J;break;case t.d.LEFT:M+=J,V=-J/2;break;case t.d.RIGHT:j-=J,V=J/2}switch(s){case t.d.CENTER:N/=2,F-=N,W+=N;break;case t.d.BOTTOM:W+=N,y=-N/2;break;case t.d.TOP:F-=N,y=N/2}}const d=[],r=[],z=[];z[0]=[0,0,1,0,1,1,0,1],z[1]=[0,0,1,0,1,1,0,1],b!==t.d.ROTATE_TILE&&b!==t.d.ROTATE_ROW||(z[1]=[1,1,0,1,0,0,1,0]),b!==t.d.FLIP_TILE&&b!==t.d.FLIP_ROW||(z[1]=[1,0,0,0,0,1,1,1]),b!==t.d.FLIP_N_ROTATE_TILE&&b!==t.d.FLIP_N_ROTATE_ROW||(z[1]=[0,1,1,1,1,0,0,0]);let Y=[];const D=[],f=[];let v=0;for(let h=0;h<R;h++)for(let c=0;c<C;c++)d.push(c*A-k+V,h*o-E+y,0),d.push((c+1)*A-k+V,h*o-E+y,0),d.push((c+1)*A-k+V,(h+1)*o-E+y,0),d.push(c*A-k+V,(h+1)*o-E+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),Y=b===t.d.FLIP_TILE||b===t.d.ROTATE_TILE||b===t.d.FLIP_N_ROTATE_TILE?Y.concat(z[(c%2+h%2)%2]):b===t.d.FLIP_ROW||b===t.d.ROTATE_ROW||b===t.d.FLIP_N_ROTATE_ROW?Y.concat(z[h%2]):Y.concat(z[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),v+=4;if(J>0||N>0){const c=N>0&&(s===t.d.CENTER||s===t.d.TOP),h=N>0&&(s===t.d.CENTER||s===t.d.BOTTOM),L=J>0&&(n===t.d.CENTER||n===t.d.RIGHT),X=J>0&&(n===t.d.CENTER||n===t.d.LEFT);let z,G,P,O,p=[];if(c&&L&&(d.push(j+V,F+y,0),d.push(-k+V,F+y,0),d.push(-k+V,F+N+y,0),d.push(j+V,F+N+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=1-J/A,G=1-N/o,P=1,O=1,p=[z,G,P,G,P,O,z,O],b===t.d.ROTATE_ROW&&(p=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),b===t.d.FLIP_ROW&&(p=[1-z,G,1-P,G,1-P,O,1-z,O]),b===t.d.FLIP_N_ROTATE_ROW&&(p=[z,1-G,P,1-G,P,1-O,z,1-O]),Y=Y.concat(p),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c&&X&&(d.push(k+V,F+y,0),d.push(M+V,F+y,0),d.push(M+V,F+N+y,0),d.push(k+V,F+N+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=0,G=1-N/o,P=J/A,O=1,p=[z,G,P,G,P,O,z,O],(b===t.d.ROTATE_ROW||b===t.d.ROTATE_TILE&&C%2===0)&&(p=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),(b===t.d.FLIP_ROW||b===t.d.FLIP_TILE&&C%2===0)&&(p=[1-z,G,1-P,G,1-P,O,1-z,O]),(b===t.d.FLIP_N_ROTATE_ROW||b===t.d.FLIP_N_ROTATE_TILE&&C%2===0)&&(p=[z,1-G,P,1-G,P,1-O,z,1-O]),Y=Y.concat(p),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&L&&(d.push(j+V,E+y,0),d.push(-k+V,E+y,0),d.push(-k+V,W+y,0),d.push(j+V,W+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=1-J/A,G=0,P=1,O=N/o,p=[z,G,P,G,P,O,z,O],(b===t.d.ROTATE_ROW&&R%2===1||b===t.d.ROTATE_TILE&&R%1===0)&&(p=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),(b===t.d.FLIP_ROW&&R%2===1||b===t.d.FLIP_TILE&&R%2===0)&&(p=[1-z,G,1-P,G,1-P,O,1-z,O]),(b===t.d.FLIP_N_ROTATE_ROW&&R%2===1||b===t.d.FLIP_N_ROTATE_TILE&&R%2===0)&&(p=[z,1-G,P,1-G,P,1-O,z,1-O]),Y=Y.concat(p),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&X&&(d.push(k+V,E+y,0),d.push(M+V,E+y,0),d.push(M+V,W+y,0),d.push(k+V,W+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,z=0,G=0,P=J/A,O=N/o,p=[z,G,P,G,P,O,z,O],(b===t.d.ROTATE_ROW&&R%2===1||b===t.d.ROTATE_TILE&&(R+C)%2===1)&&(p=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),(b===t.d.FLIP_ROW&&R%2===1||b===t.d.FLIP_TILE&&(R+C)%2===1)&&(p=[1-z,G,1-P,G,1-P,O,1-z,O]),(b===t.d.FLIP_N_ROTATE_ROW&&R%2===1||b===t.d.FLIP_N_ROTATE_TILE&&(R+C)%2===1)&&(p=[z,1-G,P,1-G,P,1-O,z,1-O]),Y=Y.concat(p),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c){const c=[];z=0,G=1-N/o,P=1,O=1,c[0]=[z,G,P,G,P,O,z,O],c[1]=[z,G,P,G,P,O,z,O],b!==t.d.ROTATE_TILE&&b!==t.d.ROTATE_ROW||(c[1]=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),b!==t.d.FLIP_TILE&&b!==t.d.FLIP_ROW||(c[1]=[1-z,G,1-P,G,1-P,O,1-z,O]),b!==t.d.FLIP_N_ROTATE_TILE&&b!==t.d.FLIP_N_ROTATE_ROW||(c[1]=[z,1-G,P,1-G,P,1-O,z,1-O]);for(let o=0;o<C;o++)d.push(o*A-k+V,F+y,0),d.push((o+1)*A-k+V,F+y,0),d.push((o+1)*A-k+V,F+N+y,0),d.push(o*A-k+V,F+N+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,Y=b===t.d.FLIP_TILE||b===t.d.ROTATE_TILE||b===t.d.FLIP_N_ROTATE_TILE?Y.concat(c[(o+1)%2]):b===t.d.FLIP_ROW||b===t.d.ROTATE_ROW||b===t.d.FLIP_N_ROTATE_ROW?Y.concat(c[1]):Y.concat(c[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const c=[];z=0,G=0,P=1,O=N/o,c[0]=[z,G,P,G,P,O,z,O],c[1]=[z,G,P,G,P,O,z,O],b!==t.d.ROTATE_TILE&&b!==t.d.ROTATE_ROW||(c[1]=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),b!==t.d.FLIP_TILE&&b!==t.d.FLIP_ROW||(c[1]=[1-z,G,1-P,G,1-P,O,1-z,O]),b!==t.d.FLIP_N_ROTATE_TILE&&b!==t.d.FLIP_N_ROTATE_ROW||(c[1]=[z,1-G,P,1-G,P,1-O,z,1-O]);for(let o=0;o<C;o++)d.push(o*A-k+V,W-N+y,0),d.push((o+1)*A-k+V,W-N+y,0),d.push((o+1)*A-k+V,W+y,0),d.push(o*A-k+V,W+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,Y=b===t.d.FLIP_TILE||b===t.d.ROTATE_TILE||b===t.d.FLIP_N_ROTATE_TILE?Y.concat(c[(o+R)%2]):b===t.d.FLIP_ROW||b===t.d.ROTATE_ROW||b===t.d.FLIP_N_ROTATE_ROW?Y.concat(c[R%2]):Y.concat(c[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const c=[];z=1-J/A,G=0,P=1,O=1,c[0]=[z,G,P,G,P,O,z,O],c[1]=[z,G,P,G,P,O,z,O],b!==t.d.ROTATE_TILE&&b!==t.d.ROTATE_ROW||(c[1]=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),b!==t.d.FLIP_TILE&&b!==t.d.FLIP_ROW||(c[1]=[1-z,G,1-P,G,1-P,O,1-z,O]),b!==t.d.FLIP_N_ROTATE_TILE&&b!==t.d.FLIP_N_ROTATE_ROW||(c[1]=[z,1-G,P,1-G,P,1-O,z,1-O]);for(let A=0;A<R;A++)d.push(j+V,A*o-E+y,0),d.push(j+J+V,A*o-E+y,0),d.push(j+J+V,(A+1)*o-E+y,0),d.push(j+V,(A+1)*o-E+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,Y=b===t.d.FLIP_TILE||b===t.d.ROTATE_TILE||b===t.d.FLIP_N_ROTATE_TILE?Y.concat(c[(A+1)%2]):b===t.d.FLIP_ROW||b===t.d.ROTATE_ROW||b===t.d.FLIP_N_ROTATE_ROW?Y.concat(c[A%2]):Y.concat(c[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const c=[];z=0,G=0,P=J/o,O=1,c[0]=[z,G,P,G,P,O,z,O],c[1]=[z,G,P,G,P,O,z,O],b!==t.d.ROTATE_TILE&&b!==t.d.ROTATE_ROW||(c[1]=[1-z,1-G,1-P,1-G,1-P,1-O,1-z,1-O]),b!==t.d.FLIP_TILE&&b!==t.d.FLIP_ROW||(c[1]=[1-z,G,1-P,G,1-P,O,1-z,O]),b!==t.d.FLIP_N_ROTATE_TILE&&b!==t.d.FLIP_N_ROTATE_ROW||(c[1]=[z,1-G,P,1-G,P,1-O,z,1-O]);for(let A=0;A<R;A++)d.push(M-J+V,A*o-E+y,0),d.push(M+V,A*o-E+y,0),d.push(M+V,(A+1)*o-E+y,0),d.push(M-J+V,(A+1)*o-E+y,0),f.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,Y=b===t.d.FLIP_TILE||b===t.d.ROTATE_TILE||b===t.d.FLIP_N_ROTATE_TILE?Y.concat(c[(A+C)%2]):b===t.d.FLIP_ROW||b===t.d.ROTATE_ROW||b===t.d.FLIP_N_ROTATE_ROW?Y.concat(c[A%2]):Y.concat(c[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const G=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE;h.c._ComputeSides(G,d,f,r,Y,c.frontUVs,c.backUVs);const P=new h.c;P.indices=f,P.xa=d,P.ya=r,P.Aa=Y;const O=G===h.c.DOUBLESIDE?D.concat(D):D;return P.za=O,P}function k(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return N(b).Ca(o,b.updatable),o}function E(c){const b=c.faceUV||new Array(6),A=c.faceColors,n=c.pattern||t.d.NO_FLIP,L=c.width||c.size||1,C=c.height||c.size||1,J=c.depth||c.size||1,X=c.tileWidth||c.tileSize||1,k=c.tileHeight||c.tileSize||1,E=c.alignHorizontal||0,V=c.alignVertical||0,y=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE;for(let t=0;t<6;t++)void 0===b[t]&&(b[t]=new o.o(0,0,1,1)),A&&void 0===A[t]&&(A[t]=new R.h(1,1,1,1));const j=L/2,F=C/2,M=J/2,W=[];for(let o=0;o<2;o++)W[o]=N({pattern:n,tileWidth:X,tileHeight:k,width:L,height:C,alignVertical:V,alignHorizontal:E,sideOrientation:y});for(let o=2;o<4;o++)W[o]=N({pattern:n,tileWidth:X,tileHeight:k,width:J,height:C,alignVertical:V,alignHorizontal:E,sideOrientation:y});let d=V;V===t.d.BOTTOM?d=t.d.TOP:V===t.d.TOP&&(d=t.d.BOTTOM);for(let o=4;o<6;o++)W[o]=N({pattern:n,tileWidth:X,tileHeight:k,width:L,height:J,alignVertical:d,alignHorizontal:E,sideOrientation:y});let r=[],z=[],Y=[],D=[];const f=[],v=[],G=[],P=[];let O=0,p=0;for(let t=0;t<6;t++){const c=W[t].xa.length;v[t]=[],G[t]=[];for(let b=0;b<c/3;b++)v[t].push(new o.k(W[t].xa[3*b],W[t].xa[3*b+1],W[t].xa[3*b+2])),G[t].push(new o.k(W[t].ya[3*b],W[t].ya[3*b+1],W[t].ya[3*b+2]));O=W[t].Aa.length,P[t]=[];for(let A=0;A<O;A+=2)P[t][A]=b[t].x+(b[t].z-b[t].x)*W[t].Aa[A],P[t][A+1]=b[t].y+(b[t].w-b[t].y)*W[t].Aa[A+1],s.b&&(P[t][A+1]=1-P[t][A+1]);if(Y=Y.concat(P[t]),D=D.concat(W[t].indices.map((c=>c+p))),p+=v[t].length,A)for(let b=0;b<4;b++)f.push(A[t].r,A[t].g,A[t].b,A[t].a)}const q=new o.k(0,0,M),I=o.b.RotationY(Math.PI);r=v[0].map((c=>o.k.TransformNormal(c,I).add(q))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[]),z=G[0].map((c=>o.k.TransformNormal(c,I))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[]),r=r.concat(v[1].map((c=>c.Xd(q))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[])),z=z.concat(G[1].map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[]));const K=new o.k(j,0,0),Z=o.b.RotationY(-Math.PI/2);r=r.concat(v[2].map((c=>o.k.TransformNormal(c,Z).add(K))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[])),z=z.concat(G[2].map((c=>o.k.TransformNormal(c,Z))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[]));const H=o.b.RotationY(Math.PI/2);r=r.concat(v[3].map((c=>o.k.TransformNormal(c,H).Xd(K))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[])),z=z.concat(G[3].map((c=>o.k.TransformNormal(c,H))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[]));const S=new o.k(0,F,0),B=o.b.RotationX(Math.PI/2);r=r.concat(v[4].map((c=>o.k.TransformNormal(c,B).add(S))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[])),z=z.concat(G[4].map((c=>o.k.TransformNormal(c,B))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[]));const Q=o.b.RotationX(-Math.PI/2);r=r.concat(v[5].map((c=>o.k.TransformNormal(c,Q).Xd(S))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[])),z=z.concat(G[5].map((c=>o.k.TransformNormal(c,Q))).map((c=>[c.x,c.y,c.z])).reduce(((c,b)=>c.concat(b)),[])),h.c._ComputeSides(y,r,D,z,Y);const a=new h.c;if(a.indices=D,a.xa=r,a.ya=z,a.Aa=Y,A){const c=y===h.c.DOUBLESIDE?f.concat(f):f;a.za=c}return a}function V(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return E(b).Ca(o,b.updatable),o}h.c.CreateTiledPlane=N;h.c.CreateTiledBox=E;var y=A(12457),j=A(2186),F=A(843);function M(c){const b=c.height||2;let A=0===c.diameterTop?0:c.diameterTop||c.diameter||1,n=0===c.diameterBottom?0:c.diameterBottom||c.diameter||1;A=A||1e-5,n=n||1e-5;const L=0|(c.tessellation||24),C=0|(c.subdivisions||1),J=!!c.hasRings,X=!!c.enclose,N=0===c.cap?0:c.cap||t.d.CAP_ALL,k=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1,E=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE,V=c.faceUV||new Array(3),y=c.faceColors,j=2+(1+(1!==k&&X?2:0))*(J?C:1);let M;for(M=0;M<j;M++)y&&void 0===y[M]&&(y[M]=new R.h(1,1,1,1));for(M=0;M<j;M++)V&&void 0===V[M]&&(V[M]=new o.o(0,0,1,1));const W=[],d=[],r=[],z=[],Y=[],D=2*Math.PI*k/L;let f,v,G;const P=(n-A)/2/b,O=o.k.Zero(),p=o.k.Zero(),q=o.k.Zero(),I=o.k.Zero(),K=o.k.Zero(),Z=F.e.Y;let H,S,B,Q=1,a=1,l=0,T=0;for(H=0;H<=C;H++)for(v=H/C,G=(v*(A-n)+n)/2,Q=J&&0!==H&&H!==C?2:1,B=0;B<Q;B++){for(J&&(a+=B),X&&(a+=2*B),S=0;S<=L;S++)f=S*D,O.x=Math.cos(-f)*G,O.y=-b/2+v*b,O.z=Math.sin(-f)*G,0===A&&H===C?(p.x=r[r.length-3*(L+1)],p.y=r[r.length-3*(L+1)+1],p.z=r[r.length-3*(L+1)+2]):(p.x=O.x,p.z=O.z,p.y=Math.sqrt(p.x*p.x+p.z*p.z)*P,p.normalize()),0===S&&(q.p(O),I.p(p)),d.push(O.x,O.y,O.z),r.push(p.x,p.y,p.z),T=J?l!==a?V[a].y:V[a].w:V[a].y+(V[a].w-V[a].y)*v,z.push(V[a].x+(V[a].z-V[a].x)*S/L,s.b?1-T:T),y&&Y.push(y[a].r,y[a].g,y[a].b,y[a].a);1!==k&&X&&(d.push(O.x,O.y,O.z),d.push(0,O.y,0),d.push(0,O.y,0),d.push(q.x,q.y,q.z),o.k.CrossToRef(Z,p,K),K.normalize(),r.push(K.x,K.y,K.z,K.x,K.y,K.z),o.k.CrossToRef(I,Z,K),K.normalize(),r.push(K.x,K.y,K.z,K.x,K.y,K.z),T=J?l!==a?V[a+1].y:V[a+1].w:V[a+1].y+(V[a+1].w-V[a+1].y)*v,z.push(V[a+1].x,s.b?1-T:T),z.push(V[a+1].z,s.b?1-T:T),T=J?l!==a?V[a+2].y:V[a+2].w:V[a+2].y+(V[a+2].w-V[a+2].y)*v,z.push(V[a+2].x,s.b?1-T:T),z.push(V[a+2].z,s.b?1-T:T),y&&(Y.push(y[a+1].r,y[a+1].g,y[a+1].b,y[a+1].a),Y.push(y[a+1].r,y[a+1].g,y[a+1].b,y[a+1].a),Y.push(y[a+2].r,y[a+2].g,y[a+2].b,y[a+2].a),Y.push(y[a+2].r,y[a+2].g,y[a+2].b,y[a+2].a))),l!==a&&(l=a)}const i=1!==k&&X?L+4:L;for(H=0,a=0;a<C;a++){let c=0,b=0,A=0,o=0;for(S=0;S<L;S++)c=H*(i+1)+S,b=(H+1)*(i+1)+S,A=H*(i+1)+(S+1),o=(H+1)*(i+1)+(S+1),W.push(c,b,A),W.push(o,A,b);1!==k&&X&&(W.push(c+2,b+2,A+2),W.push(o+2,A+2,b+2),W.push(c+4,b+4,A+4),W.push(o+4,A+4,b+4)),H=J?H+2:H+1}const g=c=>{const t=c?A/2:n/2;if(0===t)return;let h,C,J;const X=c?V[j-1]:V[0];let R=null;y&&(R=c?y[j-1]:y[0]);const N=d.length/3,E=c?b/2:-b/2,F=new o.k(0,E,0);d.push(F.x,F.y,F.z),r.push(0,c?1:-1,0);const M=X.y+.5*(X.w-X.y);z.push(X.x+.5*(X.z-X.x),s.b?1-M:M),R&&Y.push(R.r,R.g,R.b,R.a);const D=new o.h(.5,.5);for(J=0;J<=L;J++){h=2*Math.PI*J*k/L;const b=Math.cos(-h),A=Math.sin(-h);C=new o.k(b*t,E,A*t);const n=new o.h(b*D.x+.5,A*D.y+.5);d.push(C.x,C.y,C.z),r.push(0,c?1:-1,0);const N=X.y+(X.w-X.y)*n.y;z.push(X.x+(X.z-X.x)*n.x,s.b?1-N:N),R&&Y.push(R.r,R.g,R.b,R.a)}for(J=0;J<L;J++)c?(W.push(N),W.push(N+(J+2)),W.push(N+(J+1))):(W.push(N),W.push(N+(J+1)),W.push(N+(J+2)))};N!==t.d.CAP_START&&N!==t.d.CAP_ALL||g(!1),N!==t.d.CAP_END&&N!==t.d.CAP_ALL||g(!0),h.c._ComputeSides(E,d,W,r,z,c.frontUVs,c.backUVs);const u=new h.c;return u.indices=W,u.xa=d,u.ya=r,u.Aa=z,y&&(u.za=Y),u}function W(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return M(b).Ca(o,b.updatable),o}function d(c){const b=[],A=[],t=[],n=[],L=c.diameter||1,C=c.thickness||.5,J=0|(c.tessellation||16),X=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE,R=J+1;for(let h=0;h<=J;h++){const c=h/J,X=h*Math.PI*2/J-Math.PI/2,N=o.b.Translation(L/2,0,0).multiply(o.b.RotationY(X));for(let L=0;L<=J;L++){const X=1-L/J,k=L*Math.PI*2/J+Math.PI,E=Math.cos(k),V=Math.sin(k);let y=new o.k(E,V,0),j=y.scale(C/2);const F=new o.h(c,X);j=o.k.TransformCoordinates(j,N),y=o.k.TransformNormal(y,N),A.push(j.x,j.y,j.z),t.push(y.x,y.y,y.z),n.push(F.x,s.b?1-F.y:F.y);const M=(h+1)%R,W=(L+1)%R;b.push(h*R+L),b.push(h*R+W),b.push(M*R+L),b.push(h*R+W),b.push(M*R+W),b.push(M*R+L)}}h.c._ComputeSides(X,A,b,t,n,c.frontUVs,c.backUVs);const N=new h.c;return N.indices=b,N.xa=A,N.ya=t,N.Aa=n,N}function r(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return d(b).Ca(o,b.updatable),o}h.c.CreateCylinder=M,t.d.CreateCylinder=(c,b,A,o,n,h,s,L,C)=>{void 0!==s&&s instanceof j.d||(void 0!==s&&(C=L||t.d.DEFAULTSIDE,L=s),s=h,h=1);return W(c,{height:b,diameterTop:A,diameterBottom:o,tessellation:n,subdivisions:h,sideOrientation:C,updatable:L},s)};function z(c){const b=[],A=[],t=[],n=[],L=c.radius||2,C=c.tube||.5,J=c.radialSegments||32,X=c.tubularSegments||32,R=c.p||2,N=c.q||3,k=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE,E=c=>{const b=Math.cos(c),A=Math.sin(c),t=N/R*c,n=Math.cos(t),h=L*(2+n)*.5*b,s=L*(2+n)*A*.5,C=L*Math.sin(t)*.5;return new o.k(h,s,C)};let V,y;for(V=0;V<=J;V++){const c=V%J/J*2*R*Math.PI,b=E(c),t=E(c+.01),h=t.Xd(b);let L=t.add(b);const N=o.k.Cross(h,L);for(L=o.k.Cross(N,h),N.normalize(),L.normalize(),y=0;y<X;y++){const c=y%X/X*2*Math.PI,o=-C*Math.cos(c),t=C*Math.sin(c);A.push(b.x+o*L.x+t*N.x),A.push(b.y+o*L.y+t*N.y),A.push(b.z+o*L.z+t*N.z),n.push(V/J),n.push(s.b?1-y/X:y/X)}}for(V=0;V<J;V++)for(y=0;y<X;y++){const c=(y+1)%X,A=V*X+y,o=(V+1)*X+y,t=(V+1)*X+c,n=V*X+c;b.push(n),b.push(o),b.push(A),b.push(n),b.push(t),b.push(o)}h.c.ComputeNormals(A,b,t),h.c._ComputeSides(k,A,b,t,n,c.frontUVs,c.backUVs);const j=new h.c;return j.indices=b,j.xa=A,j.ya=t,j.Aa=n,j}function Y(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return z(b).Ca(o,b.updatable),o}h.c.CreateTorus=d,t.d.CreateTorus=(c,b,A,o,t,n,h)=>r(c,{diameter:b,thickness:A,tessellation:o,sideOrientation:h,updatable:n},t);h.c.CreateTorusKnot=z,t.d.CreateTorusKnot=(c,b,A,o,t,n,h,s,L,C)=>Y(c,{radius:b,tube:A,radialSegments:o,tubularSegments:t,p:n,q:h,sideOrientation:C,updatable:L},s);var D=A(12953),f=A(11944),v=A(2042);function G(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.path,n=b.shape,h=b.scale||1,s=b.rotation||0,L=0===b.cap?0:b.cap||t.d.NO_CAP,C=b.updatable,J=t.d._GetDefaultSideOrientation(b.sideOrientation),X=b.instance||null,R=b.invertUV||!1,N=b.closeShape||!1,k=b.closePath||!1,E=b.capFunction||null;return O(c,n,o,h,s,null,null,k,N,L,!1,A,!!C,J,X,R,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame,E)}function P(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=b.path,n=b.shape,h=b.scaleFunction||(()=>1),s=b.rotationFunction||(()=>0),L=b.closePath||b.ribbonCloseArray||!1,C=b.closeShape||b.ribbonClosePath||!1,J=0===b.cap?0:b.cap||t.d.NO_CAP,X=b.updatable,R=b.firstNormal||null,N=b.adjustFrame||!1,k=t.d._GetDefaultSideOrientation(b.sideOrientation),E=b.instance,V=b.invertUV||!1,y=b.capFunction||null;return O(c,n,o,null,null,h,s,L,C,J,!0,A,!!X,k,E||null,V,b.frontUVs||null,b.backUVs||null,R,N,y||null)}function O(c,b,A,n,h,s,L,J,X,R,N,k,E,V,y,j,F,M,W,d,r){const z=(c,b,A,n,h,s,L,C,J,X,R)=>{const N=A.getTangents(),k=A.getNormals(),E=A.getBinormals(),V=A.getDistances();if(R)for(let t=0;t<N.length;t++)if(0==N[t].x&&0==N[t].y&&0==N[t].z&&N[t].p(N[t-1]),0==k[t].x&&0==k[t].y&&0==k[t].z&&k[t].p(k[t-1]),0==E[t].x&&0==E[t].y&&0==E[t].z&&E[t].p(E[t-1]),t>0){let c=N[t-1];o.k.Dot(c,N[t])<0&&N[t].scaleInPlace(-1),c=k[t-1],o.k.Dot(c,k[t])<0&&k[t].scaleInPlace(-1),c=E[t-1],o.k.Dot(c,E[t])<0&&E[t].scaleInPlace(-1)}let y=0;const j=X&&C?C:()=>null!==s?s:0,F=X&&L?L:()=>null!==h?h:1;let M=J===t.d.NO_CAP||J===t.d.CAP_END?0:2;const W=o.f.Matrix[0];for(let t=0;t<b.length;t++){const A=[],h=j(t,V[t]),s=F(t,V[t]);o.b.RotationAxisToRef(N[t],y,W);for(let n=0;n<c.length;n++){const h=N[t].scale(c[n].z).add(k[t].scale(c[n].x)).add(E[t].scale(c[n].y)),L=o.k.Zero();o.k.TransformCoordinatesToRef(h,W,L),L.scaleInPlace(s).addInPlace(b[t]),A[n]=L}n[M]=A,y+=h,M++}const d=r||(c=>{const b=Array(),A=o.k.Zero();let t;for(t=0;t<c.length;t++)A.addInPlace(c[t]);for(A.scaleInPlace(1/c.length),t=0;t<c.length;t++)b.push(A);return b});switch(J){case t.d.NO_CAP:break;case t.d.CAP_START:n[0]=d(n[2]),n[1]=n[2];break;case t.d.CAP_END:n[M]=n[M-1],n[M+1]=d(n[M-1]);break;case t.d.CAP_ALL:n[0]=d(n[2]),n[1]=n[2],n[M]=n[M-1],n[M+1]=d(n[M-1])}return n};let Y,D;if(y){const c=y._creationDataStorage;return Y=W?c.path3D.update(A,W):c.path3D.update(A),D=z(b,A,c.path3D,c.pathArray,n,h,s,L,c.cap,N,d),y=C("",{pathArray:D,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:y},k||void 0)}Y=W?new v.k(A,W):new v.k(A);D=z(b,A,Y,new Array,n,h,s,L,R=R<0||R>3?0:R,N,d);const f=C(c,{pathArray:D,closeArray:J,closePath:X,updatable:E,sideOrientation:V,invertUV:j,frontUVs:F||void 0,backUVs:M||void 0},k);return f._creationDataStorage.pathArray=D,f._creationDataStorage.path3D=Y,f._creationDataStorage.cap=R,f}function p(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,h=void 0===b.closed||b.closed,s=b.shape,L=b.radius||1,J=b.tessellation||64,X=b.clip||0,R=b.updatable,N=t.d._GetDefaultSideOrientation(b.sideOrientation),k=b.cap||t.d.NO_CAP,E=2*Math.PI,V=[],y=b.invertUV||!1;let j=0,F=0;const M=E/J*n;let W,d;for(j=0;j<=J-X;j++){for(d=[],k!=t.d.CAP_START&&k!=t.d.CAP_ALL||(d.push(new o.k(0,s[0].y,0)),d.push(new o.k(Math.cos(j*M)*s[0].x*L,s[0].y,Math.sin(j*M)*s[0].x*L))),F=0;F<s.length;F++)W=new o.k(Math.cos(j*M)*s[F].x*L,s[F].y,Math.sin(j*M)*s[F].x*L),d.push(W);k!=t.d.CAP_END&&k!=t.d.CAP_ALL||(d.push(new o.k(Math.cos(j*M)*s[s.length-1].x*L,s[s.length-1].y,Math.sin(j*M)*s[s.length-1].x*L)),d.push(new o.k(0,s[s.length-1].y,0))),V.push(d)}return C(c,{pathArray:V,closeArray:h,sideOrientation:N,updatable:R,invertUV:y,frontUVs:b.frontUVs,backUVs:b.backUVs},A)}t.d.ExtrudeShape=function(c,b,A,o,n,h){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,J=arguments.length>9?arguments[9]:void 0;return G(c,{shape:b,path:A,scale:o,rotation:n,cap:0===h?0:h||t.d.NO_CAP,sideOrientation:C,instance:J,updatable:L},s)},t.d.ExtrudeShapeCustom=(c,b,A,o,n,h,s,L,C,J,X,R)=>P(c,{shape:b,path:A,scaleFunction:o,rotationFunction:n,ribbonCloseArray:h,ribbonClosePath:s,cap:0===L?0:L||t.d.NO_CAP,sideOrientation:X,instance:R,updatable:J},C);t.d.CreateLathe=(c,b,A,o,t,n,h)=>p(c,{shape:b,radius:A,tessellation:o,sideOrientation:h,updatable:n},t);var q=A(12359),I=A(12303);function K(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=b.path;let h=b.instance,s=1;void 0!==b.radius?s=b.radius:h&&(s=h._creationDataStorage.radius);const L=b.tessellation||64,J=b.radiusFunction||null;let X=b.cap||t.d.NO_CAP;const R=b.invertUV||!1,N=b.updatable,k=t.d._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const E=(c,b,A,n,h,s,L,C)=>{const J=b.getTangents(),X=b.getNormals(),R=b.getDistances(),N=2*Math.PI/h*C,k=s||(()=>n);let E,V,y,j;const F=o.f.Matrix[0];let M=L===t.d.NO_CAP||L===t.d.CAP_END?0:2;for(let t=0;t<c.length;t++){V=k(t,R[t]),E=Array(),y=X[t];for(let b=0;b<h;b++)o.b.RotationAxisToRef(J[t],N*b,F),j=E[b]?E[b]:o.k.Zero(),o.k.TransformCoordinatesToRef(y,F,j),j.scaleInPlace(V).addInPlace(c[t]),E[b]=j;A[M]=E,M++}const W=(b,A)=>{const o=Array();for(let t=0;t<b;t++)o.push(c[A]);return o};switch(L){case t.d.NO_CAP:break;case t.d.CAP_START:A[0]=W(h,0),A[1]=A[2].slice(0);break;case t.d.CAP_END:A[M]=A[M-1].slice(0),A[M+1]=W(h,c.length-1);break;case t.d.CAP_ALL:A[0]=W(h,0),A[1]=A[2].slice(0),A[M]=A[M-1].slice(0),A[M+1]=W(h,c.length-1)}return A};let V,y;if(h){const c=h._creationDataStorage,A=b.arc||c.arc;return V=c.path3D.update(n),y=E(n,V,c.pathArray,s,c.tessellation,J,c.cap,A),h=C("",{pathArray:y,instance:h}),c.path3D=V,c.pathArray=y,c.arc=A,c.radius=s,h}V=new v.k(n);X=X<0||X>3?0:X,y=E(n,V,new Array,s,L,J,X,b.arc);const j=C(c,{pathArray:y,closePath:!0,closeArray:!1,updatable:N,sideOrientation:k,invertUV:R,frontUVs:b.frontUVs,backUVs:b.backUVs},A);return j._creationDataStorage.pathArray=y,j._creationDataStorage.path3D=V,j._creationDataStorage.tessellation=L,j._creationDataStorage.cap=X,j._creationDataStorage.arc=b.arc,j._creationDataStorage.radius=s,j}function Z(c){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const A=c.type&&(c.type<0||c.type>=b.length)?0:c.type||0,t=c.size,n=c.sizeX||t||1,L=c.sizeY||t||1,C=c.sizeZ||t||1,J=c.custom||b[A],X=J.face.length,N=c.faceUV||new Array(X),k=c.faceColors,E=void 0===c.flat||c.flat,V=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE,y=[],j=[],F=[],M=[],W=[];let d=0,r=0;const z=[];let Y,D,f,v,G,P,O=0,p=0;if(E)for(p=0;p<X;p++)k&&void 0===k[p]&&(k[p]=new R.h(1,1,1,1)),N&&void 0===N[p]&&(N[p]=new o.o(0,0,1,1));if(E)for(p=0;p<X;p++){const c=J.face[p].length;for(f=2*Math.PI/c,v=.5*Math.tan(f/2),G=.5,O=0;O<c;O++)y.push(J.vertex[J.face[p][O]][0]*n,J.vertex[J.face[p][O]][1]*L,J.vertex[J.face[p][O]][2]*C),z.push(d),d++,Y=N[p].x+(N[p].z-N[p].x)*(.5+v),D=N[p].y+(N[p].w-N[p].y)*(G-.5),M.push(Y,s.b?1-D:D),P=v*Math.cos(f)-G*Math.sin(f),G=v*Math.sin(f)+G*Math.cos(f),v=P,k&&W.push(k[p].r,k[p].g,k[p].b,k[p].a);for(O=0;O<c-2;O++)j.push(z[0+r],z[O+2+r],z[O+1+r]);r+=c}else{for(O=0;O<J.vertex.length;O++)y.push(J.vertex[O][0]*n,J.vertex[O][1]*L,J.vertex[O][2]*C),M.push(0,s.b?1:0);for(p=0;p<X;p++)for(O=0;O<J.face[p].length-2;O++)j.push(J.face[p][0],J.face[p][O+2],J.face[p][O+1])}h.c.ComputeNormals(y,j,F),h.c._ComputeSides(V,y,j,F,M,c.frontUVs,c.backUVs);const q=new h.c;return q.xa=y,q.indices=j,q.ya=F,q.Aa=M,k&&E&&(q.za=W),q}function H(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return Z(b).Ca(o,b.updatable),o}t.d.CreateTube=(c,b,A,o,t,n,h,s,L,C)=>K(c,{path:b,radius:A,tessellation:o,radiusFunction:t,arc:1,cap:n,updatable:s,sideOrientation:L,instance:C},h);function S(c){const b=c.sideOrientation||h.c.DEFAULTSIDE,A=c.radius||1,t=void 0===c.flat||c.flat,n=0|(c.subdivisions||4),L=c.radiusX||A,C=c.radiusY||A,J=c.radiusZ||A,X=(1+Math.sqrt(5))/2,R=[-1,X,-0,1,X,0,-1,-X,0,1,-X,0,0,-1,-X,0,1,-X,0,-1,X,0,1,X,X,0,1,X,0,-1,-X,0,1,-X,0,-1],N=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],k=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],E=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],V=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],y=[],j=[],F=[],M=[];let W=0;const d=new Array(3),r=new Array(3);let z;for(z=0;z<3;z++)d[z]=o.k.Zero(),r[z]=o.h.Zero();for(let h=0;h<20;h++){for(z=0;z<3;z++){const c=N[3*h+z];d[z].jd(R[3*k[c]],R[3*k[c]+1],R[3*k[c]+2]),d[z].normalize(),r[z].jd(.134765625*E[2*c]+.05859375+-.0390625*V[h],.2333984375*E[2*c+1]+.025390625+.01953125*V[h])}const c=(c,b,A,h)=>{const X=o.k.Lerp(d[0],d[2],b/n),R=o.k.Lerp(d[1],d[2],b/n),N=n===b?d[2]:o.k.Lerp(X,R,c/(n-b));let k;if(N.normalize(),t){const c=o.k.Lerp(d[0],d[2],h/n),b=o.k.Lerp(d[1],d[2],h/n);k=o.k.Lerp(c,b,A/(n-h))}else k=new o.k(N.x,N.y,N.z);k.x/=L,k.y/=C,k.z/=J,k.normalize();const E=o.h.Lerp(r[0],r[2],b/n),V=o.h.Lerp(r[1],r[2],b/n),z=n===b?r[2]:o.h.Lerp(E,V,c/(n-b));j.push(N.x*L,N.y*C,N.z*J),F.push(k.x,k.y,k.z),M.push(z.x,s.b?1-z.y:z.y),y.push(W),W++};for(let b=0;b<n;b++)for(let A=0;A+b<n;A++)c(A,b,A+1/3,b+1/3),c(A+1,b,A+1/3,b+1/3),c(A,b+1,A+1/3,b+1/3),A+b+1<n&&(c(A+1,b,A+2/3,b+2/3),c(A+1,b+1,A+2/3,b+2/3),c(A,b+1,A+2/3,b+2/3))}h.c._ComputeSides(b,j,y,F,M,c.frontUVs,c.backUVs);const Y=new h.c;return Y.indices=y,Y.xa=j,Y.ya=F,Y.Aa=M,Y}function B(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new t.d(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),o._originalBuilderSideOrientation=b.sideOrientation;return S(b).Ca(o,b.updatable),o}h.c.CreatePolyhedron=Z,t.d.CreatePolyhedron=(c,b,A)=>H(c,b,A);h.c.CreateIcoSphere=S,t.d.CreateIcoSphere=(c,b,A)=>B(c,b,A);var Q=A(702);const a=new o.k(1,0,0),l=new o.k(-1,0,0),T=new o.k(0,1,0),i=new o.k(0,-1,0),g=new o.k(0,0,1),u=new o.k(0,0,-1);class e{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.k.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.k.Up(),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.h.Zero(),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=c,this.ik=b,this.uv=A,this.vertexIdx=t,this.vertexIdxForBones=n,this.localPositionOverride=h,this.localNormalOverride=s,this.matrixIndicesOverride=L,this.matrixWeightsOverride=C}clone(){var c,b,A,o;return new e(this.position.clone(),this.ik.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(c=this.localPositionOverride)||void 0===c?void 0:c.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(A=this.matrixIndicesOverride)||void 0===A?void 0:A.slice(),null===(o=this.matrixWeightsOverride)||void 0===o?void 0:o.slice())}}function x(c,b,A){var L,C,J,X,R;const N=!!b.skeleton,k=!(null===(L=b.morphTargetManager)||void 0===L||!L.numTargets),E=A.localMode||N,V=b._j(),y=N||k?b.Bc(!0,!0):b.getVerticesData(n.f.PositionKind),j=N||k?b.getNormalsData(!0,!0):b.getVerticesData(n.f.NormalKind),F=E?N?b.getVerticesData(n.f.PositionKind):y:null,M=E?N?b.getVerticesData(n.f.NormalKind):j:null,W=b.getVerticesData(n.f.UVKind),d=N?b.getVerticesData(n.f.MatricesIndicesKind):null,r=N?b.getVerticesData(n.f.MatricesWeightsKind):null,z=N?b.getVerticesData(n.f.MatricesIndicesExtraKind):null,Y=N?b.getVerticesData(n.f.MatricesWeightsExtraKind):null,D=A.position||o.k.Zero();let f=A.ik||o.k.Up();const v=A.size||o.k.One(),G=A.angle||0;if(!f){const c=new o.k(0,0,1),A=b.va().activeCamera,t=o.k.TransformCoordinates(c,A.getWorldMatrix());f=A.globalPosition.Xd(t)}const P=-Math.atan2(f.z,f.x)-Math.PI/2,O=Math.sqrt(f.x*f.x+f.z*f.z),p=Math.atan2(f.y,O),q=new h.c;q.indices=[],q.xa=[],q.ya=[],q.Aa=[],q.matricesIndices=N?[]:null,q.matricesWeights=N?[]:null,q.matricesIndicesExtra=z?[]:null,q.matricesWeightsExtra=Y?[]:null;let I=0;const K=(c,b)=>{const t=new e;if(!V||!y||!j)return t;const n=V[c];if(t.vertexIdx=3*n,t.vertexIdxForBones=4*n,t.position=new o.k(y[3*n],y[3*n+1],y[3*n+2]),o.k.TransformCoordinatesToRef(t.position,b,t.position),t.ik=new o.k(j[3*n],j[3*n+1],j[3*n+2]),o.k.TransformNormalToRef(t.ik,b,t.ik),A.captureUVS&&W){const c=W[2*n+1];t.uv=new o.h(W[2*n],s.b?1-c:c)}return t},Z=[0,0,0,0],H=(c,b)=>{if(0===c.length)return c;const A=.5*Math.abs(o.k.Dot(v,b)),t=(c,b,A,o)=>{for(let t=0;t<o;++t)if(c[A+t]===b)return A+t;return-1},n=(c,n)=>{const h=o.k.GetClipFactor(c.position,n.position,b,A);let s=Z,L=Z;if(d&&r){const b=c.matrixIndicesOverride?0:c.vertexIdxForBones,A=c.matrixIndicesOverride??d,o=c.matrixWeightsOverride??r,C=n.matrixIndicesOverride?0:n.vertexIdxForBones,J=n.matrixIndicesOverride??d,X=n.matrixWeightsOverride??r;s=[0,0,0,0],L=[0,0,0,0];let R=0;for(let c=0;c<4;++c)if(o[b+c]>0){const n=t(J,A[b+c],C,4);s[R]=A[b+c],L[R]=(0,Q.Lerp)(o[b+c],n>=0?X[n]:0,h),R++}for(let c=0;c<4&&R<4;++c){const o=J[C+c];-1===t(A,o,b,4)&&(s[R]=o,L[R]=(0,Q.Lerp)(0,X[C+c],h),R++)}const N=L[0]+L[1]+L[2]+L[3];L[0]/=N,L[1]/=N,L[2]/=N,L[3]/=N}const C=c.localPositionOverride?c.localPositionOverride[0]:(null===F||void 0===F?void 0:F[c.vertexIdx])??0,J=c.localPositionOverride?c.localPositionOverride[1]:(null===F||void 0===F?void 0:F[c.vertexIdx+1])??0,X=c.localPositionOverride?c.localPositionOverride[2]:(null===F||void 0===F?void 0:F[c.vertexIdx+2])??0,R=n.localPositionOverride?n.localPositionOverride[0]:(null===F||void 0===F?void 0:F[n.vertexIdx])??0,N=n.localPositionOverride?n.localPositionOverride[1]:(null===F||void 0===F?void 0:F[n.vertexIdx+1])??0,k=n.localPositionOverride?n.localPositionOverride[2]:(null===F||void 0===F?void 0:F[n.vertexIdx+2])??0,E=c.localNormalOverride?c.localNormalOverride[0]:(null===M||void 0===M?void 0:M[c.vertexIdx])??0,V=c.localNormalOverride?c.localNormalOverride[1]:(null===M||void 0===M?void 0:M[c.vertexIdx+1])??0,y=c.localNormalOverride?c.localNormalOverride[2]:(null===M||void 0===M?void 0:M[c.vertexIdx+2])??0,j=E+((n.localNormalOverride?n.localNormalOverride[0]:(null===M||void 0===M?void 0:M[n.vertexIdx])??0)-E)*h,W=V+((n.localNormalOverride?n.localNormalOverride[1]:(null===M||void 0===M?void 0:M[n.vertexIdx+1])??0)-V)*h,z=y+((n.localNormalOverride?n.localNormalOverride[2]:(null===M||void 0===M?void 0:M[n.vertexIdx+2])??0)-y)*h,Y=Math.sqrt(j*j+W*W+z*z);return new e(o.k.Lerp(c.position,n.position,h),o.k.Lerp(c.ik,n.ik,h).normalize(),o.h.Lerp(c.uv,n.uv,h),-1,-1,F?[C+(R-C)*h,J+(N-J)*h,X+(k-X)*h]:null,M?[j/Y,W/Y,z/Y]:null,s,L)};let h=null;c.length>3&&(h=[]);for(let s=0;s<c.length;s+=3){let t=0,L=null,C=null,J=null,X=null;const R=o.k.Dot(c[s].position,b)-A>0,N=o.k.Dot(c[s+1].position,b)-A>0,k=o.k.Dot(c[s+2].position,b)-A>0;switch(t=(R?1:0)+(N?1:0)+(k?1:0),t){case 0:c.length>3?(h.push(c[s]),h.push(c[s+1]),h.push(c[s+2])):h=c;break;case 1:if(h=h??new Array,R&&(L=c[s+1],C=c[s+2],J=n(c[s],L),X=n(c[s],C)),N){L=c[s],C=c[s+2],J=n(c[s+1],L),X=n(c[s+1],C),h.push(J),h.push(C.clone()),h.push(L.clone()),h.push(C.clone()),h.push(J.clone()),h.push(X);break}k&&(L=c[s],C=c[s+1],J=n(c[s+2],L),X=n(c[s+2],C)),L&&C&&J&&X&&(h.push(L.clone()),h.push(C.clone()),h.push(J),h.push(X),h.push(J.clone()),h.push(C.clone()));break;case 2:h=h??new Array,R||(L=c[s].clone(),C=n(L,c[s+1]),J=n(L,c[s+2]),h.push(L),h.push(C),h.push(J)),N||(L=c[s+1].clone(),C=n(L,c[s+2]),J=n(L,c[s]),h.push(L),h.push(C),h.push(J)),k||(L=c[s+2].clone(),C=n(L,c[s]),J=n(L,c[s+1]),h.push(L),h.push(C),h.push(J))}}return h},S=b instanceof t.d?b:null,B=null===S||void 0===S?void 0:S._thinInstanceDataStorage.matrixData,x=(null===S||void 0===S?void 0:S.Hk)||1,U=o.f.Matrix[0];U.p(o.b.IdentityReadOnly);for(let t=0;t<x;++t){if(null!==S&&void 0!==S&&S.hasThinInstances&&B){const c=16*t;U.setRowFromFloats(0,B[c+0],B[c+1],B[c+2],B[c+3]),U.setRowFromFloats(1,B[c+4],B[c+5],B[c+6],B[c+7]),U.setRowFromFloats(2,B[c+8],B[c+9],B[c+10],B[c+11]),U.setRowFromFloats(3,B[c+12],B[c+13],B[c+14],B[c+15])}const c=o.b.RotationYawPitchRoll(P,p,G).multiply(o.b.Translation(D.x,D.y,D.z)),n=o.b.Invert(c),h=b.getWorldMatrix(),L=U.multiply(h).multiply(n),C=new Array(3);for(let b=0;b<V.length;b+=3){let c=C;if(c[0]=K(b,L),c[1]=K(b+1,L),c[2]=K(b+2,L),!(A.cullBackFaces&&-c[0].ik.z<=0&&-c[1].ik.z<=0&&-c[2].ik.z<=0)&&(c=H(c,a),c&&(c=H(c,l),c&&(c=H(c,T),c&&(c=H(c,i),c&&(c=H(c,g),c&&(c=H(c,u),c)))))))for(let b=0;b<c.length;b++){const o=c[b];if(q.indices.push(I),E?(o.localPositionOverride?(q.xa[3*I]=o.localPositionOverride[0],q.xa[3*I+1]=o.localPositionOverride[1],q.xa[3*I+2]=o.localPositionOverride[2]):F&&(q.xa[3*I]=F[o.vertexIdx],q.xa[3*I+1]=F[o.vertexIdx+1],q.xa[3*I+2]=F[o.vertexIdx+2]),o.localNormalOverride?(q.ya[3*I]=o.localNormalOverride[0],q.ya[3*I+1]=o.localNormalOverride[1],q.ya[3*I+2]=o.localNormalOverride[2]):M&&(q.ya[3*I]=M[o.vertexIdx],q.ya[3*I+1]=M[o.vertexIdx+1],q.ya[3*I+2]=M[o.vertexIdx+2])):(o.position.toArray(q.xa,3*I),o.ik.toArray(q.ya,3*I)),q.matricesIndices&&q.matricesWeights&&(o.matrixIndicesOverride?(q.matricesIndices[4*I]=o.matrixIndicesOverride[0],q.matricesIndices[4*I+1]=o.matrixIndicesOverride[1],q.matricesIndices[4*I+2]=o.matrixIndicesOverride[2],q.matricesIndices[4*I+3]=o.matrixIndicesOverride[3]):(d&&(q.matricesIndices[4*I]=d[o.vertexIdxForBones],q.matricesIndices[4*I+1]=d[o.vertexIdxForBones+1],q.matricesIndices[4*I+2]=d[o.vertexIdxForBones+2],q.matricesIndices[4*I+3]=d[o.vertexIdxForBones+3]),z&&q.matricesIndicesExtra&&(q.matricesIndicesExtra[4*I]=z[o.vertexIdxForBones],q.matricesIndicesExtra[4*I+1]=z[o.vertexIdxForBones+1],q.matricesIndicesExtra[4*I+2]=z[o.vertexIdxForBones+2],q.matricesIndicesExtra[4*I+3]=z[o.vertexIdxForBones+3])),o.matrixWeightsOverride?(q.matricesWeights[4*I]=o.matrixWeightsOverride[0],q.matricesWeights[4*I+1]=o.matrixWeightsOverride[1],q.matricesWeights[4*I+2]=o.matrixWeightsOverride[2],q.matricesWeights[4*I+3]=o.matrixWeightsOverride[3]):(r&&(q.matricesWeights[4*I]=r[o.vertexIdxForBones],q.matricesWeights[4*I+1]=r[o.vertexIdxForBones+1],q.matricesWeights[4*I+2]=r[o.vertexIdxForBones+2],q.matricesWeights[4*I+3]=r[o.vertexIdxForBones+3]),Y&&q.matricesWeightsExtra&&(q.matricesWeightsExtra[4*I]=Y[o.vertexIdxForBones],q.matricesWeightsExtra[4*I+1]=Y[o.vertexIdxForBones+1],q.matricesWeightsExtra[4*I+2]=Y[o.vertexIdxForBones+2],q.matricesWeightsExtra[4*I+3]=Y[o.vertexIdxForBones+3]))),A.captureUVS)o.uv.toArray(q.Aa,2*I);else{q.Aa.push(.5+o.position.x/v.x);const c=.5+o.position.y/v.y;q.Aa.push(s.b?1-c:c)}I++}}}0===q.indices.length&&(q.indices=null),0===q.xa.length&&(q.xa=null),0===q.ya.length&&(q.ya=null),0===q.Aa.length&&(q.Aa=null),0===(null===(C=q.matricesIndices)||void 0===C?void 0:C.length)&&(q.matricesIndices=null),0===(null===(J=q.matricesWeights)||void 0===J?void 0:J.length)&&(q.matricesWeights=null),0===(null===(X=q.matricesIndicesExtra)||void 0===X?void 0:X.length)&&(q.matricesIndicesExtra=null),0===(null===(R=q.matricesWeightsExtra)||void 0===R?void 0:R.length)&&(q.matricesWeightsExtra=null);const w=new t.d(c,b.va());return q.Ca(w),E?(w.skeleton=b.skeleton,w.parent=b):(w.position=D.clone(),w.rotation=new o.k(p,P,G)),w.Zj(!0),w.refreshBoundingInfo(!0,!0),w}function U(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const b=0|Math.max(c.subdivisions?c.subdivisions:2,1),A=0|Math.max(c.tessellation?c.tessellation:16,3),t=Math.max(c.height?c.height:1,0),n=Math.max(c.radius?c.radius:.25,0),L=0|Math.max(c.capSubdivisions?c.capSubdivisions:6,1),C=A,J=b,X=Math.max(c.radiusTop?c.radiusTop:n,0),R=Math.max(c.radiusBottom?c.radiusBottom:n,0),N=t-(X+R),k=2*Math.PI,E=Math.max(c.topCapSubdivisions?c.topCapSubdivisions:L,1),V=Math.max(c.bottomCapSubdivisions?c.bottomCapSubdivisions:L,1),y=Math.acos((R-X)/t);let j=[];const F=[],M=[],W=[];let d=0;const r=[],z=.5*N,Y=.5*Math.PI;let D,f;const v=o.k.Zero(),G=o.k.Zero(),P=Math.cos(y),O=Math.sin(y),p=new o.h(X*O,z+X*P).Xd(new o.h(R*O,R*P-z)).length(),q=X*y+p+R*(Y-y);let I=0;for(f=0;f<=E;f++){const c=[],b=Y-y*(f/E);I+=X*y/E;const A=Math.cos(b),o=Math.sin(b),t=A*X;for(D=0;D<=C;D++){const b=D/C,n=b*k+0,h=Math.sin(n),L=Math.cos(n);G.x=t*h,G.y=z+o*X,G.z=t*L,F.push(G.x,G.y,G.z),v.set(A*h,o,A*L),M.push(v.x,v.y,v.z),W.push(b,s.b?I/q:1-I/q),c.push(d),d++}r.push(c)}const K=t-X-R+P*X-P*R,Z=O*(R-X)/K;for(f=1;f<=J;f++){const c=[];I+=p/J;const b=O*(f*(R-X)/J+X);for(D=0;D<=C;D++){const A=D/C,o=A*k+0,t=Math.sin(o),n=Math.cos(o);G.x=b*t,G.y=z+P*X-f*K/J,G.z=b*n,F.push(G.x,G.y,G.z),v.set(t,Z,n).normalize(),M.push(v.x,v.y,v.z),W.push(A,s.b?I/q:1-I/q),c.push(d),d++}r.push(c)}for(f=1;f<=V;f++){const c=[],b=Y-y-(Math.PI-y)*(f/V);I+=R*y/V;const A=Math.cos(b),o=Math.sin(b),t=A*R;for(D=0;D<=C;D++){const b=D/C,n=b*k+0,h=Math.sin(n),L=Math.cos(n);G.x=t*h,G.y=o*R-z,G.z=t*L,F.push(G.x,G.y,G.z),v.set(A*h,o,A*L),M.push(v.x,v.y,v.z),W.push(b,s.b?I/q:1-I/q),c.push(d),d++}r.push(c)}for(D=0;D<C;D++)for(f=0;f<E+J+V;f++){const c=r[f][D],b=r[f+1][D],A=r[f+1][D+1],o=r[f][D+1];j.push(c),j.push(b),j.push(o),j.push(b),j.push(A),j.push(o)}if(j=j.reverse(),c.orientation&&!c.orientation.equals(o.k.Up())){const b=new o.b;c.orientation.clone().scale(.5*Math.PI).cross(o.k.Up()).toQuaternion().toRotationMatrix(b);const A=o.k.Zero();for(let c=0;c<F.length;c+=3)A.set(F[c],F[c+1],F[c+2]),o.k.TransformCoordinatesToRef(A.clone(),b,A),F[c]=A.x,F[c+1]=A.y,F[c+2]=A.z}const H=new h.c;return H.xa=F,H.ya=M,H.Aa=W,H.indices=j,H}function w(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:o.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new t.d(c,A);return U(b).Ca(n,b.updatable),n}t.d.CreateDecal=(c,b,A,o,t,n)=>x(c,b,{position:A,ik:o,size:t,angle:n});t.d.CreateCapsule=(c,b,A)=>w(c,b,A),h.c.CreateCapsule=U;var m=A(531),cc=A(693);class bc{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=c,this.y=b,c!==Math.floor(c)&&(c=Math.floor(c),m.c.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),m.c.Warn("y is not an integer, floor(y) used"))}clone(){return new bc(this.x,this.y)}rotate60About(c){const b=this.x;return this.x=c.x+c.y-this.y,this.y=b+this.y-c.x,this}rotateNeg60About(c){const b=this.x;return this.x=b+this.y-c.y,this.y=c.x+c.y-b,this}rotate120(c,b){c!==Math.floor(c)&&(c=Math.floor(c),m.c.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),m.c.Warn("n not an integer only floor(n) used"));const A=this.x;return this.x=c-A-this.y,this.y=b+A,this}rotateNeg120(c,b){c!==Math.floor(c)&&(c=Math.floor(c),m.c.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),m.c.Warn("n is not an integer,   floor(n) used"));const A=this.x;return this.x=this.y-b,this.y=c+b-A-this.y,this}toCartesianOrigin(c,b){const A=o.k.Zero();return A.x=c.x+2*this.x*b+this.y*b,A.y=c.y+Math.sqrt(3)*this.y*b,A}static Zero(){return new bc(0,0)}}class Ac{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new oc("icosahedron","Regular",[[0,cc.f,-1],[-cc.f,1,0],[-1,0,-cc.f],[1,0,-cc.f],[cc.f,1,0],[0,cc.f,1],[-1,0,cc.f],[-cc.f,-1,0],[0,-cc.f,-1],[cc.f,-1,0],[1,0,cc.f],[0,-cc.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let c=12;const b={},A=this.m,o=this.n;let t,n,h,s,L,C=A,J=1,X=0;0!==o&&(C=(0,Q.HighestCommonFactor)(A,o)),J=A/C,X=o/C;const R=bc.Zero(),N=new bc(A,o),k=new bc(-o,A+o),E=bc.Zero(),V=bc.Zero(),y=bc.Zero();let j,F,M,W,d=[];const r=[],z=this.vertByDist,Y=(A,o,t,n)=>{j=A+"|"+t,F=o+"|"+n,j in b||F in b?j in b&&!(F in b)?b[F]=b[j]:F in b&&!(j in b)&&(b[j]=b[F]):(b[j]=c,b[F]=c,c++),z[t][0]>2?r[b[j]]=[-z[t][0],z[t][1],b[j]]:r[b[j]]=[d[z[t][0]],z[t][1],b[j]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let D=0;D<20;D++){if(d=this.IDATA.face[D],h=d[2],s=d[1],L=d[0],M=R.x+"|"+R.y,j=D+"|"+M,j in b||(b[j]=h,r[h]=[d[z[M][0]],z[M][1]]),M=N.x+"|"+N.y,j=D+"|"+M,j in b||(b[j]=s,r[s]=[d[z[M][0]],z[M][1]]),M=k.x+"|"+k.y,j=D+"|"+M,j in b||(b[j]=L,r[L]=[d[z[M][0]],z[M][1]]),t=this.IDATA.edgematch[D][0],n=this.IDATA.edgematch[D][1],"B"===n)for(let c=1;c<C;c++)V.x=A-c*(J+X),V.y=o+c*J,y.x=-c*X,y.y=c*(J+X),M=V.x+"|"+V.y,W=y.x+"|"+y.y,Y(D,t,M,W);if("O"===n)for(let c=1;c<C;c++)y.x=-c*X,y.y=c*(J+X),E.x=c*J,E.y=c*X,M=y.x+"|"+y.y,W=E.x+"|"+E.y,Y(D,t,M,W);if(t=this.IDATA.edgematch[D][2],n=this.IDATA.edgematch[D][3],n&&"A"===n)for(let c=1;c<C;c++)E.x=c*J,E.y=c*X,V.x=A-(C-c)*(J+X),V.y=o+(C-c)*J,M=E.x+"|"+E.y,W=V.x+"|"+V.y,Y(D,t,M,W);for(let A=0;A<this.vertices.length;A++)M=this.vertices[A].x+"|"+this.vertices[A].y,j=D+"|"+M,j in b||(b[j]=c++,z[M][0]>2?r[b[j]]=[-z[M][0],z[M][1],b[j]]:r[b[j]]=[d[z[M][0]],z[M][1],b[j]])}this.closestTo=r,this.vecToidx=b}calcCoeffs(){const c=this.m,b=this.n,A=Math.sqrt(3)/3,o=c*c+b*b+c*b;this.coau=(c+b)/o,this.cobu=-b/o,this.coav=-A*(c-b)/o,this.cobv=A*(2*c+b)/o}createInnerFacets(){const c=this.m,b=this.n;for(let A=0;A<b+c+1;A++)for(let c=this.min[A];c<this.max[A]+1;c++)c<this.max[A]&&c<this.max[A+1]+1&&this.innerFacets.push(["|"+c+"|"+A,"|"+c+"|"+(A+1),"|"+(c+1)+"|"+A]),A>0&&c<this.max[A-1]&&c+1<this.max[A]+1&&this.innerFacets.push(["|"+c+"|"+A,"|"+(c+1)+"|"+A,"|"+(c+1)+"|"+(A-1)])}edgeVecsABOB(){const c=this.m,b=this.n,A=new bc(-b,c+b);for(let o=1;o<c+b;o++){const c=new bc(this.min[o],o),b=new bc(this.min[o-1],o-1),t=new bc(this.min[o+1],o+1),n=c.clone(),h=b.clone(),s=t.clone();n.rotate60About(A),h.rotate60About(A),s.rotate60About(A);const L=new bc(this.max[n.y],n.y),C=new bc(this.max[n.y-1],n.y-1),J=new bc(this.max[n.y-1]-1,n.y-1);n.x===L.x&&n.y===L.y||(n.x!==C.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([c,C,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([c,J,L])):n.y===s.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([c,b,C]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([c,C,t])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([c,b,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([c,C,L])))}}mapABOBtoOBOA(){const c=new bc(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const A=[];for(let o=0;o<3;o++)c.x=this.isoVecsABOB[b][o].x,c.y=this.isoVecsABOB[b][o].y,0===this.vertexTypes[b][o]&&c.rotateNeg120(this.m,this.n),A.push(c.clone());this.isoVecsOBOA.push(A)}}mapABOBtoBAOA(){const c=new bc(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const A=[];for(let o=0;o<3;o++)c.x=this.isoVecsABOB[b][o].x,c.y=this.isoVecsABOB[b][o].y,1===this.vertexTypes[b][o]&&c.rotate120(this.m,this.n),A.push(c.clone());this.isoVecsBAOA.push(A)}}MapToFace(c,b){const A=this.IDATA.face[c],t=A[2],n=A[1],h=A[0],s=o.k.$j(this.IDATA.vertex[t]),L=o.k.$j(this.IDATA.vertex[n]),C=o.k.$j(this.IDATA.vertex[h]),J=L.Xd(s),X=C.Xd(s),R=J.scale(this.coau).add(X.scale(this.cobu)),N=J.scale(this.coav).add(X.scale(this.cobv)),k=[];let E,V=o.f.ak[0];for(let o=0;o<this.cartesian.length;o++)V=R.scale(this.cartesian[o].x).add(N.scale(this.cartesian[o].y)).add(s),k[o]=[V.x,V.y,V.z],E=c+"|"+this.vertices[o].x+"|"+this.vertices[o].y,b.vertex[this.vecToidx[E]]=[V.x,V.y,V.z]}build(c,b){const A=[],o=bc.Zero(),t=new bc(c,b),n=new bc(-b,c+b);A.push(o,t,n);for(let M=b;M<c+1;M++)for(let b=0;b<c+1-M;b++)A.push(new bc(b,M));if(b>0){const o=(0,Q.HighestCommonFactor)(c,b),t=c/o,n=b/o;for(let s=1;s<o;s++)A.push(new bc(s*t,s*n)),A.push(new bc(-s*n,s*(t+n))),A.push(new bc(c-s*(t+n),b+s*t));const h=c/b;for(let s=1;s<b;s++)for(let o=0;o<s*h;o++)A.push(new bc(o,s)),A.push(new bc(o,s).rotate120(c,b)),A.push(new bc(o,s).rotateNeg120(c,b))}A.sort(((c,b)=>c.x-b.x)),A.sort(((c,b)=>c.y-b.y));const h=new Array(c+b+1),s=new Array(c+b+1);for(let M=0;M<h.length;M++)h[M]=1/0,s[M]=-1/0;let L=0,C=0;const J=A.length;for(let M=0;M<J;M++)C=A[M].x,L=A[M].y,h[L]=Math.min(C,h[L]),s[L]=Math.max(C,s[L]);const X=(A,o)=>{const t=A.clone();return"A"===o&&t.rotateNeg120(c,b),"B"===o&&t.rotate120(c,b),t.x<0?t.y:t.x+t.y},R=[],N=[],k=[],E=[],V={},y=[];let j=-1,F=-1;for(let M=0;M<J;M++)R[M]=A[M].toCartesianOrigin(new bc(0,0),.5),N[M]=X(A[M],"O"),k[M]=X(A[M],"A"),E[M]=X(A[M],"B"),N[M]===k[M]&&k[M]===E[M]?(j=3,F=N[M]):N[M]===k[M]?(j=4,F=N[M]):k[M]===E[M]?(j=5,F=k[M]):E[M]===N[M]&&(j=6,F=N[M]),N[M]<k[M]&&N[M]<E[M]&&(j=2,F=N[M]),k[M]<N[M]&&k[M]<E[M]&&(j=1,F=k[M]),E[M]<k[M]&&E[M]<N[M]&&(j=0,F=E[M]),y.push([j,F,A[M].x,A[M].y]);y.sort(((c,b)=>c[2]-b[2])),y.sort(((c,b)=>c[3]-b[3])),y.sort(((c,b)=>c[1]-b[1])),y.sort(((c,b)=>c[0]-b[0]));for(let M=0;M<y.length;M++)V[y[M][2]+"|"+y[M][3]]=[y[M][0],y[M][1],M];return this.m=c,this.n=b,this.vertices=A,this.vertByDist=V,this.cartesian=R,this.min=h,this.max=s,this}}class oc{constructor(c,b,A,o){this.name=c,this.category=b,this.vertex=A,this.face=o}}class tc extends oc{innerToData(c,b){for(let A=0;A<b.innerFacets.length;A++)this.face.push(b.innerFacets[A].map((A=>b.vecToidx[c+A])))}mapABOBtoDATA(c,b){const A=b.IDATA.edgematch[c][0];for(let o=0;o<b.isoVecsABOB.length;o++){const t=[];for(let n=0;n<3;n++)0===b.vertexTypes[o][n]?t.push(c+"|"+b.isoVecsABOB[o][n].x+"|"+b.isoVecsABOB[o][n].y):t.push(A+"|"+b.isoVecsABOB[o][n].x+"|"+b.isoVecsABOB[o][n].y);this.face.push([b.vecToidx[t[0]],b.vecToidx[t[1]],b.vecToidx[t[2]]])}}mapOBOAtoDATA(c,b){const A=b.IDATA.edgematch[c][0];for(let o=0;o<b.isoVecsOBOA.length;o++){const t=[];for(let n=0;n<3;n++)1===b.vertexTypes[o][n]?t.push(c+"|"+b.isoVecsOBOA[o][n].x+"|"+b.isoVecsOBOA[o][n].y):t.push(A+"|"+b.isoVecsOBOA[o][n].x+"|"+b.isoVecsOBOA[o][n].y);this.face.push([b.vecToidx[t[0]],b.vecToidx[t[1]],b.vecToidx[t[2]]])}}mapBAOAtoDATA(c,b){const A=b.IDATA.edgematch[c][2];for(let o=0;o<b.isoVecsBAOA.length;o++){const t=[];for(let n=0;n<3;n++)1===b.vertexTypes[o][n]?t.push(c+"|"+b.isoVecsBAOA[o][n].x+"|"+b.isoVecsBAOA[o][n].y):t.push(A+"|"+b.isoVecsBAOA[o][n].x+"|"+b.isoVecsBAOA[o][n].y);this.face.push([b.vecToidx[t[0]],b.vecToidx[t[1]],b.vecToidx[t[2]]])}}orderData(c){const b=[];for(let n=0;n<13;n++)b[n]=[];const A=c.closestTo;for(let n=0;n<A.length;n++)A[n][0]>-1?A[n][1]>0&&b[A[n][0]].push([n,A[n][1]]):b[12].push([n,A[n][0]]);const o=[];for(let n=0;n<12;n++)o[n]=n;let t=12;for(let n=0;n<12;n++){b[n].sort(((c,b)=>c[1]-b[1]));for(let c=0;c<b[n].length;c++)o[b[n][c][0]]=t++}for(let n=0;n<b[12].length;n++)o[b[12][n][0]]=t++;for(let n=0;n<this.vertex.length;n++)this.vertex[n].push(o[n]);this.vertex.sort(((c,b)=>c[3]-b[3]));for(let n=0;n<this.vertex.length;n++)this.vertex[n].pop();for(let n=0;n<this.face.length;n++)for(let c=0;c<this.face[n].length;c++)this.face[n][c]=o[this.face[n][c]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(c,b){const A=[],o=[];let t=b.pop();o.push(t);let n=this.face[t].indexOf(c);n=(n+2)%3;let h=this.face[t][n];A.push(h);let s=0;for(;b.length>0;)t=b[s],this.face[t].indexOf(h)>-1?(n=(this.face[t].indexOf(h)+1)%3,h=this.face[t][n],A.push(h),o.push(t),b.splice(s,1),s=0):s++;return this.adjacentFaces.push(A),o}toGoldbergPolyhedronData(){const c=new oc("GeoDual","Goldberg",[],[]);c.name="GD dual";const b=this.vertex.length,A=new Array(b);for(let L=0;L<b;L++)A[L]=[];for(let L=0;L<this.face.length;L++)for(let c=0;c<3;c++)A[this.face[L][c]].push(L);let o=0,t=0,n=0,h=[],s=[];this.adjacentFaces=[];for(let L=0;L<A.length;L++){c.face[L]=this.setOrder(L,A[L].concat([]));for(const b of A[L]){o=0,t=0,n=0,h=this.face[b];for(let c=0;c<3;c++)s=this.vertex[h[c]],o+=s[0],t+=s[1],n+=s[2];c.vertex[b]=[o/3,t/3,n/3]}}return c}static BuildGeodesicData(c){const b=new tc("Geodesic-m-n","Geodesic",[[0,cc.f,-1],[-cc.f,1,0],[-1,0,-cc.f],[1,0,-cc.f],[cc.f,1,0],[0,cc.f,1],[-1,0,cc.f],[-cc.f,-1,0],[0,-cc.f,-1],[cc.f,-1,0],[1,0,cc.f],[0,-cc.f,1]],[]);c.setIndices(),c.calcCoeffs(),c.createInnerFacets(),c.edgeVecsABOB(),c.mapABOBtoOBOA(),c.mapABOBtoBAOA();for(let A=0;A<c.IDATA.face.length;A++)c.MapToFace(A,b),b.innerToData(A,c),"B"===c.IDATA.edgematch[A][1]&&b.mapABOBtoDATA(A,c),"O"===c.IDATA.edgematch[A][1]&&b.mapOBOAtoDATA(A,c),"A"===c.IDATA.edgematch[A][3]&&b.mapBAOAtoDATA(A,c);b.orderData(c);return b.vertex=b.vertex.map((function(c){const b=c[0],A=c[1],o=c[2],t=Math.sqrt(b*b+A*A+o*o);return c[0]*=1/t,c[1]*=1/t,c[2]*=1/t,c})),b}}t.d._GoldbergMeshParser=(c,b)=>nc.Parse(c,b);class nc extends t.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(c,b){return void 0===b?(c>this.goldbergData.nbUnsharedFaces-1&&(m.c.Warn("Maximum number of unshared faces used"),c=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+c):(c>11&&(m.c.Warn("Last pole used"),c=11),b>this.goldbergData.nbFacesAtPole-1&&(m.c.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+c*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(c){for(let A=0;A<c.length;A++){const b=c[A][0],o=c[A][1],t=c[A][2];for(let c=b;c<o+1;c++)this.goldbergData.faceColors[c]=t}const b=[];for(let A=0;A<12;A++)for(let c=0;c<5;c++)b.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);for(let A=12;A<this.goldbergData.faceColors.length;A++)for(let c=0;c<6;c++)b.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);return b}setGoldbergFaceColors(c){const b=this._changeGoldbergFaceColors(c);this.Ga(n.f.ColorKind,b)}updateGoldbergFaceColors(c){const b=this._changeGoldbergFaceColors(c);this.updateVerticesData(n.f.ColorKind,b)}_changeGoldbergFaceUVs(c){const b=this.getVerticesData(n.f.UVKind);for(let A=0;A<c.length;A++){const o=c[A][0],t=c[A][1],n=c[A][2],h=c[A][3],s=c[A][4],L=[],C=[];let J,X;for(let c=0;c<5;c++)J=n.x+h*Math.cos(s+c*Math.PI/2.5),X=n.y+h*Math.sin(s+c*Math.PI/2.5),J<0&&(J=0),J>1&&(J=1),L.push(J,X);for(let c=0;c<6;c++)J=n.x+h*Math.cos(s+c*Math.PI/3),X=n.y+h*Math.sin(s+c*Math.PI/3),J<0&&(J=0),J>1&&(J=1),C.push(J,X);for(let c=o;c<Math.min(12,t+1);c++)for(let A=0;A<5;A++)b[10*c+2*A]=L[2*A],b[10*c+2*A+1]=L[2*A+1];for(let c=Math.max(12,o);c<t+1;c++)for(let A=0;A<6;A++)b[12*c-24+2*A]=C[2*A],b[12*c-23+2*A]=C[2*A+1]}return b}setGoldbergFaceUVs(c){const b=this._changeGoldbergFaceUVs(c);this.Ga(n.f.UVKind,b)}updateGoldbergFaceUVs(c){const b=this._changeGoldbergFaceUVs(c);this.updateVerticesData(n.f.UVKind,b)}placeOnGoldbergFaceAt(c,b,A){const t=o.k.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);c.rotation=t,c.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(A.x)).add(this.goldbergData.faceYaxis[b].scale(A.y)).add(this.goldbergData.faceZaxis[b].scale(A.z))}serialize(c){super.serialize(c),c.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const c of this.goldbergData.faceColors)b.faceColors.push(c.hk())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const c of this.goldbergData.faceCenters)b.faceCenters.push(c.hk())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const c of this.goldbergData.faceZaxis)b.faceZaxis.push(c.hk())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const c of this.goldbergData.faceYaxis)b.faceYaxis.push(c.hk())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const c of this.goldbergData.faceXaxis)b.faceXaxis.push(c.hk())}c.goldbergData=b}static Parse(c,b){const A=c.goldbergData;A.faceColors=A.faceColors.map((c=>R.h.$j(c))),A.faceCenters=A.faceCenters.map((c=>o.k.$j(c))),A.faceZaxis=A.faceZaxis.map((c=>o.k.$j(c))),A.faceXaxis=A.faceXaxis.map((c=>o.k.$j(c))),A.faceYaxis=A.faceYaxis.map((c=>o.k.$j(c)));const t=new nc(c.name,b);return t.goldbergData=A,t}}var hc=A(11937);const sc={CreateBox:X.c,CreateTiledBox:V,CreateSphere:y.c,CreateDisc:J.c,CreateIcoSphere:B,CreateRibbon:C,CreateCylinder:W,CreateTorus:r,CreateTorusKnot:Y,CreateLineSystem:D.h,Ek:D.i,CreateDashedLines:D.e,ExtrudeShape:G,ExtrudeShapeCustom:P,CreateLathe:p,CreateTiledPlane:k,Fk:q.c,CreateGround:I.g,CreateTiledGround:I.k,CreateGroundFromHeightMap:I.d,CreatePolygon:f.b,ExtrudePolygon:f.f,CreateTube:K,CreatePolyhedron:H,CreateGeodesic:function(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=b.m||1;o!==Math.floor(o)&&(o=Math.floor(o),m.c.Warn("m not an integer only floor(m) used"));let t=b.n||0;if(t!==Math.floor(t)&&(t=Math.floor(t),m.c.Warn("n not an integer only floor(n) used")),t>o){const c=t;t=o,o=c,m.c.Warn("n > m therefore m and n swapped")}const n=new Ac;return n.build(o,t),H(c,{custom:tc.BuildGeodesicData(n),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},A)},CreateGoldberg:function(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=b.size,L=b.sizeX||n||1,C=b.sizeY||n||1,J=b.sizeZ||n||1;let X=b.m||1;X!==Math.floor(X)&&(X=Math.floor(X),m.c.Warn("m not an integer only floor(m) used"));let N=b.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),m.c.Warn("n not an integer only floor(n) used")),N>X){const c=N;N=X,X=c,m.c.Warn("n > m therefore m and n swapped")}const k=new Ac;k.build(X,N);const E=tc.BuildGeodesicData(k),V=E.toGoldbergPolyhedronData(),y=new nc(c,A);b.sideOrientation=t.d._GetDefaultSideOrientation(b.sideOrientation),y._originalBuilderSideOrientation=b.sideOrientation;(function(c,b){const A=c.size,t=c.sizeX||A||1,n=c.sizeY||A||1,L=c.sizeZ||A||1,C=0===c.sideOrientation?0:c.sideOrientation||h.c.DEFAULTSIDE,J=[],X=[],R=[],N=[];let k=1/0,E=-1/0,V=1/0,y=-1/0;for(let o=0;o<b.vertex.length;o++)k=Math.min(k,b.vertex[o][0]*t),E=Math.max(E,b.vertex[o][0]*t),V=Math.min(V,b.vertex[o][1]*n),y=Math.max(y,b.vertex[o][1]*n);let j=0;for(let h=0;h<b.face.length;h++){const c=b.face[h],A=o.k.$j(b.vertex[c[0]]),C=o.k.$j(b.vertex[c[2]]),F=o.k.$j(b.vertex[c[1]]),M=C.Xd(A),W=F.Xd(A),d=o.k.Cross(W,M).normalize();for(let o=0;o<c.length;o++){R.push(d.x,d.y,d.z);const A=b.vertex[c[o]];J.push(A[0]*t,A[1]*n,A[2]*L);const h=(A[1]*n-V)/(y-V);N.push((A[0]*t-k)/(E-k),s.b?1-h:h)}for(let b=0;b<c.length-2;b++)X.push(j,j+b+2,j+b+1);j+=c.length}h.c._ComputeSides(C,J,X,R,N);const F=new h.c;return F.xa=J,F.indices=X,F.ya=R,F.Aa=N,F})(b,V).Ca(y,b.updatable),y.goldbergData.nbSharedFaces=E.sharedNodes,y.goldbergData.nbUnsharedFaces=E.poleNodes,y.goldbergData.adjacentFaces=E.adjacentFaces,y.goldbergData.nbFaces=y.goldbergData.nbSharedFaces+y.goldbergData.nbUnsharedFaces,y.goldbergData.nbFacesAtPole=(y.goldbergData.nbUnsharedFaces-12)/12;for(let t=0;t<E.vertex.length;t++)y.goldbergData.faceCenters.push(o.k.$j(E.vertex[t])),y.goldbergData.faceCenters[t].x*=L,y.goldbergData.faceCenters[t].y*=C,y.goldbergData.faceCenters[t].z*=J,y.goldbergData.faceColors.push(new R.h(1,1,1,1));for(let t=0;t<V.face.length;t++){const c=V.face[t],b=o.k.$j(V.vertex[c[0]]),A=o.k.$j(V.vertex[c[2]]),n=o.k.$j(V.vertex[c[1]]),h=A.Xd(b),s=n.Xd(b),L=o.k.Cross(s,h).normalize(),C=o.k.Cross(s,L).normalize();y.goldbergData.faceXaxis.push(s.normalize()),y.goldbergData.faceYaxis.push(L),y.goldbergData.faceZaxis.push(C)}return y},CreateDecal:x,CreateCapsule:w,CreateText:hc.e}},12377:(c,b,A)=>{"use strict";A.d(b,{d:()=>sb});var o=A(688),t=A(11862);class n extends t.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var h=A(721),s=(A(2141),A(633));class L{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(c){this._targetStopDuration!==c&&(this._targetStopDuration=c)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(c){this._noiseTexture!==c&&(this._noiseTexture=c,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(c){this._animationSheetEnabled!==c&&(this._animationSheetEnabled=c)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(c){this._isAnimationSheetEnabled!=c&&(this._isAnimationSheetEnabled=c,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(c){this._useLogarithmicDepth=c&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(c){switch(c){case L.BLENDMODE_MULTIPLYADD:return;case L.BLENDMODE_ADD:c=1;break;case L.BLENDMODE_ONEONE:c=6;break;case L.BLENDMODE_STANDARD:c=2;break;case L.BLENDMODE_MULTIPLY:c=4;break;case L.BLENDMODE_SUBTRACT:c=3}this._engine.setAlphaMode(c)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:o.k.Zero()}set direction1(c){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=c)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:o.k.Zero()}set direction2(c){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=c)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:o.k.Zero()}set minEmitBox(c){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=c)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:o.k.Zero()}set maxEmitBox(c){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=c)}get billboardMode(){return this._billboardMode}set billboardMode(c){this._billboardMode!==c&&(this._billboardMode=c,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(c){this._isBillboardBased!==c&&(this._isBillboardBased=c,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(c){this._attachImageProcessingConfiguration(c)}_attachImageProcessingConfiguration(c){c!==this._imageProcessingConfiguration&&(!c&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=c)}_reset(){}_removeGradientAndTexture(c,b,A){if(!b)return this;let o=0;for(const t of b){if(t.gradient===c){b.splice(o,1);break}o++}return A&&A.dispose(),this}constructor(c){this.animations=[],this.renderingGroupId=0,this.j=o.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new o.k(10,10,10),this.onAnimationEnd=null,this.blendMode=L.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new o.h(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.tg=new o.k(0,0,0),this._useLogarithmicDepth=!1,this.gravity=o.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new h.h(1,1,1,1),this.color2=new h.h(1,1,1,1),this.colorDead=new h.h(0,0,0,1),this.textureMask=new h.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new n,this.id=c,this.name=c}createPointEmitter(c,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new o.k(0,1,0),arguments.length>2&&void 0!==arguments[2]||new o.k(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new o.k(0,1,0),arguments.length>4&&void 0!==arguments[4]||new o.k(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new o.k(0,1,0),arguments.length>3&&void 0!==arguments[3]||new o.k(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(c,b,A,o){throw new Error("Method not implemented.")}}L.BLENDMODE_ONEONE=0,L.BLENDMODE_STANDARD=1,L.BLENDMODE_ADD=2,L.BLENDMODE_MULTIPLY=3,L.BLENDMODE_MULTIPLYADD=4,L.BLENDMODE_SUBTRACT=-1,(0,s.d)("BABYLON.BaseParticleSystem",L);var C=A(702),J=A(534);class X{constructor(){this.direction1=new o.k(0,1,0),this.direction2=new o.k(0,1,0),this.minEmitBox=new o.k(-.5,-.5,-.5),this.maxEmitBox=new o.k(.5,.5,.5)}startDirectionFunction(c,b,A,t){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),h=(0,C.RandomRange)(this.direction1.y,this.direction2.y),s=(0,C.RandomRange)(this.direction1.z,this.direction2.z);if(t)return b.x=n,b.y=h,void(b.z=s);o.k.TransformNormalFromFloatsToRef(n,h,s,c,b)}startPositionFunction(c,b,A,t){const n=(0,C.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),h=(0,C.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),s=(0,C.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(t)return b.x=n,b.y=h,void(b.z=s);o.k.TransformCoordinatesFromFloatsToRef(n,h,s,c,b)}clone(){const c=new X;return J.d.DeepCopy(this,c),c}applyToShader(c){c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2),c.setVector3("minEmitBox",this.minEmitBox),c.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(c){c.addUniform("direction1",3),c.addUniform("direction2",3),c.addUniform("minEmitBox",3),c.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.direction1=this.direction1.hk(),c.direction2=this.direction2.hk(),c.minEmitBox=this.minEmitBox.hk(),c.maxEmitBox=this.maxEmitBox.hk(),c}parse(c){o.k.FromArrayToRef(c.direction1,0,this.direction1),o.k.FromArrayToRef(c.direction2,0,this.direction2),o.k.FromArrayToRef(c.minEmitBox,0,this.minEmitBox),o.k.FromArrayToRef(c.maxEmitBox,0,this.maxEmitBox)}}class R{get radius(){return this._radius}set radius(c){this._radius=c,this._buildHeight()}get angle(){return this._angle}set angle(c){this._angle=c,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=A,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=c}startDirectionFunction(c,b,A,t){t?o.f.ak[0].p(A.hd).normalize():A.position.subtractToRef(c.getTranslation(),o.f.ak[0]).normalize();const n=(0,C.RandomRange)(0,this.directionRandomizer),h=(0,C.RandomRange)(0,this.directionRandomizer),s=(0,C.RandomRange)(0,this.directionRandomizer);b.x=o.f.ak[0].x+n,b.y=o.f.ak[0].y+h,b.z=o.f.ak[0].z+s,b.normalize()}startPositionFunction(c,b,A,t){const n=(0,C.RandomRange)(0,2*Math.PI);let h;this.emitFromSpawnPointOnly?h=1e-4:(h=(0,C.RandomRange)(0,this.heightRange),h=1-h*h);let s=this._radius-(0,C.RandomRange)(0,this._radius*this.radiusRange);s*=h;const L=s*Math.sin(n),J=s*Math.cos(n),X=h*this._height;if(t)return b.x=L,b.y=X,void(b.z=J);o.k.TransformCoordinatesFromFloatsToRef(L,X,J,c,b)}clone(){const c=new R(this._radius,this._angle,this.directionRandomizer);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setFloat2("radius",this._radius,this.radiusRange),c.setFloat("coneAngle",this._angle),c.setFloat2("height",this._height,this.heightRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",2),c.addUniform("coneAngle",1),c.addUniform("height",2),c.addUniform("directionRandomizer",1)}getEffectDefines(){let c="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(c+="\n#define CONEEMITTERSPAWNPOINT"),c}getClassName(){return"ConeParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this._radius,c.angle=this._angle,c.directionRandomizer=this.directionRandomizer,c.radiusRange=this.radiusRange,c.heightRange=this.heightRange,c.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,c}parse(c){this.radius=c.radius,this.angle=c.angle,this.directionRandomizer=c.directionRandomizer,this.radiusRange=void 0!==c.radiusRange?c.radiusRange:1,this.heightRange=void 0!==c.radiusRange?c.heightRange:1,this.emitFromSpawnPointOnly=void 0!==c.emitFromSpawnPointOnly&&c.emitFromSpawnPointOnly}}class N extends R{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0);super(c,b),this.direction1=A,this.direction2=t}startDirectionFunction(c,b){const A=(0,C.RandomRange)(this.direction1.x,this.direction2.x),t=(0,C.RandomRange)(this.direction1.y,this.direction2.y),n=(0,C.RandomRange)(this.direction1.z,this.direction2.z);o.k.TransformNormalFromFloatsToRef(A,t,n,c,b)}clone(){const c=new N(this.radius,this.angle,this.direction1,this.direction2);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const c=super.serialize();return c.direction1=this.direction1.hk(),c.direction2=this.direction2.hk(),c}parse(c){super.parse(c),this.direction1.p(c.direction1),this.direction2.p(c.direction2)}}class k{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=c,this.height=b,this.radiusRange=A,this.directionRandomizer=t,this._tempVector=o.k.Zero()}startDirectionFunction(c,b,A,t,n){A.position.subtractToRef(c.getTranslation(),this._tempVector),this._tempVector.normalize(),o.k.TransformNormalToRef(this._tempVector,n,this._tempVector);const h=(0,C.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let s=Math.atan2(this._tempVector.x,this._tempVector.z);s+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=h,this._tempVector.x=Math.sin(s),this._tempVector.z=Math.cos(s),this._tempVector.normalize(),t?b.p(this._tempVector):o.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,c,b)}startPositionFunction(c,b,A,t){const n=(0,C.RandomRange)(-this.height/2,this.height/2),h=(0,C.RandomRange)(0,2*Math.PI),s=(0,C.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),L=Math.sqrt(s)*this.radius,J=L*Math.cos(h),X=L*Math.sin(h);t?b.jd(J,n,X):o.k.TransformCoordinatesFromFloatsToRef(J,n,X,c,b)}clone(){const c=new k(this.radius,this.directionRandomizer);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("height",this.height),c.setFloat("radiusRange",this.radiusRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("height",1),c.addUniform("radiusRange",1),c.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this.radius,c.height=this.height,c.radiusRange=this.radiusRange,c.directionRandomizer=this.directionRandomizer,c}parse(c){this.radius=c.radius,this.height=c.height,this.radiusRange=c.radiusRange,this.directionRandomizer=c.directionRandomizer}}class E extends k{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.k(0,1,0);super(c,b,A),this.direction1=t,this.direction2=n}startDirectionFunction(c,b,A,t){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),h=(0,C.RandomRange)(this.direction1.y,this.direction2.y),s=(0,C.RandomRange)(this.direction1.z,this.direction2.z);t?b.jd(n,h,s):o.k.TransformNormalFromFloatsToRef(n,h,s,c,b)}clone(){const c=new E(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("height",this.height),c.setFloat("radiusRange",this.radiusRange),c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("height",1),c.addUniform("radiusRange",1),c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const c=super.serialize();return c.direction1=this.direction1.hk(),c.direction2=this.direction2.hk(),c}parse(c){super.parse(c),o.k.FromArrayToRef(c.direction1,0,this.direction1),o.k.FromArrayToRef(c.direction2,0,this.direction2)}}class V{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=c,this.radiusRange=b,this.directionRandomizer=A}startDirectionFunction(c,b,A,t){const n=A.position.Xd(c.getTranslation()).normalize(),h=(0,C.RandomRange)(0,this.directionRandomizer),s=(0,C.RandomRange)(0,this.directionRandomizer),L=(0,C.RandomRange)(0,this.directionRandomizer);n.x+=h,n.y+=s,n.z+=L,n.normalize(),t?b.p(n):o.k.TransformNormalFromFloatsToRef(n.x,n.y,n.z,c,b)}startPositionFunction(c,b,A,t){const n=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),h=(0,C.RandomRange)(0,1),s=(0,C.RandomRange)(0,2*Math.PI),L=Math.acos(2*h-1),J=n*Math.cos(s)*Math.sin(L),X=n*Math.cos(L),R=n*Math.sin(s)*Math.sin(L);t?b.jd(J,Math.abs(X),R):o.k.TransformCoordinatesFromFloatsToRef(J,Math.abs(X),R,c,b)}clone(){const c=new V(this.radius,this.directionRandomizer);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this.radius,c.radiusRange=this.radiusRange,c.directionRandomizer=this.directionRandomizer,c}parse(c){this.radius=c.radius,this.radiusRange=c.radiusRange,this.directionRandomizer=c.directionRandomizer}}class y{constructor(){this.direction1=new o.k(0,1,0),this.direction2=new o.k(0,1,0)}startDirectionFunction(c,b,A,t){const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),h=(0,C.RandomRange)(this.direction1.y,this.direction2.y),s=(0,C.RandomRange)(this.direction1.z,this.direction2.z);t?b.jd(n,h,s):o.k.TransformNormalFromFloatsToRef(n,h,s,c,b)}startPositionFunction(c,b,A,t){t?b.jd(0,0,0):o.k.TransformCoordinatesFromFloatsToRef(0,0,0,c,b)}clone(){const c=new y;return J.d.DeepCopy(this,c),c}applyToShader(c){c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.direction1=this.direction1.hk(),c.direction2=this.direction2.hk(),c}parse(c){o.k.FromArrayToRef(c.direction1,0,this.direction1),o.k.FromArrayToRef(c.direction2,0,this.direction2)}}class j{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=c,this.radiusRange=b,this.directionRandomizer=A}startDirectionFunction(c,b,A,t){const n=A.position.Xd(c.getTranslation()).normalize(),h=(0,C.RandomRange)(0,this.directionRandomizer),s=(0,C.RandomRange)(0,this.directionRandomizer),L=(0,C.RandomRange)(0,this.directionRandomizer);n.x+=h,n.y+=s,n.z+=L,n.normalize(),t?b.p(n):o.k.TransformNormalFromFloatsToRef(n.x,n.y,n.z,c,b)}startPositionFunction(c,b,A,t){const n=this.radius-(0,C.RandomRange)(0,this.radius*this.radiusRange),h=(0,C.RandomRange)(0,1),s=(0,C.RandomRange)(0,2*Math.PI),L=Math.acos(2*h-1),J=n*Math.cos(s)*Math.sin(L),X=n*Math.cos(L),R=n*Math.sin(s)*Math.sin(L);t?b.jd(J,X,R):o.k.TransformCoordinatesFromFloatsToRef(J,X,R,c,b)}clone(){const c=new j(this.radius,this.directionRandomizer);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this.radius,c.radiusRange=this.radiusRange,c.directionRandomizer=this.directionRandomizer,c}parse(c){this.radius=c.radius,this.radiusRange=c.radiusRange,this.directionRandomizer=c.directionRandomizer}}class F extends j{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.k(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0);super(c),this.direction1=b,this.direction2=A}startDirectionFunction(c,b){const A=(0,C.RandomRange)(this.direction1.x,this.direction2.x),t=(0,C.RandomRange)(this.direction1.y,this.direction2.y),n=(0,C.RandomRange)(this.direction1.z,this.direction2.z);o.k.TransformNormalFromFloatsToRef(A,t,n,c,b)}clone(){const c=new F(this.radius,this.direction1,this.direction2);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const c=super.serialize();return c.direction1=this.direction1.hk(),c.direction2=this.direction2.hk(),c}parse(c){super.parse(c),this.direction1.p(c.direction1),this.direction2.p(c.direction2)}}class M{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(c,b,A,t){const n=o.f.ak[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,A,n);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,A,n);const c=o.f.ak[1];n.subtractToRef(A.position,c),c.scaleToRef(1/A.lifeTime,n)}else n.set(0,0,0);t?b.p(n):o.k.TransformNormalToRef(n,c,b)}startPositionFunction(c,b,A,t){const n=o.f.ak[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,A,n):n.set(0,0,0),t?b.p(n):o.k.TransformCoordinatesToRef(n,c,b)}clone(){const c=new M;return J.d.DeepCopy(this,c),c}applyToShader(c){}buildUniformLayout(c){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.particlePositionGenerator=this.particlePositionGenerator,c.particleDestinationGenerator=this.particleDestinationGenerator,c}parse(c){c.particlePositionGenerator&&(this.particlePositionGenerator=c.particlePositionGenerator),c.particleDestinationGenerator&&(this.particleDestinationGenerator=c.particleDestinationGenerator)}}var W=A(747);class d{get mesh(){return this._mesh}set mesh(c){this._mesh!==c&&(this._mesh=c,c?(this._indices=c._j(),this._positions=c.getVerticesData(W.f.PositionKind),this._normals=c.getVerticesData(W.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=o.k.Zero(),this._mesh=null,this.direction1=new o.k(0,1,0),this.direction2=new o.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=c}startDirectionFunction(c,b,A,t){if(this.useMeshNormalsForDirection&&this._normals)return void o.k.TransformNormalToRef(this._storedNormal,c,b);const n=(0,C.RandomRange)(this.direction1.x,this.direction2.x),h=(0,C.RandomRange)(this.direction1.y,this.direction2.y),s=(0,C.RandomRange)(this.direction1.z,this.direction2.z);t?b.jd(n,h,s):o.k.TransformNormalFromFloatsToRef(n,h,s,c,b)}startPositionFunction(c,b,A,t){if(!this._indices||!this._positions)return;const n=3*(Math.random()*(this._indices.length/3)|0),h=Math.random(),s=Math.random()*(1-h),L=1-h-s,C=this._indices[n],J=this._indices[n+1],X=this._indices[n+2],R=o.f.ak[0],N=o.f.ak[1],k=o.f.ak[2],E=o.f.ak[3];o.k.FromArrayToRef(this._positions,3*C,R),o.k.FromArrayToRef(this._positions,3*J,N),o.k.FromArrayToRef(this._positions,3*X,k),E.x=h*R.x+s*N.x+L*k.x,E.y=h*R.y+s*N.y+L*k.y,E.z=h*R.z+s*N.z+L*k.z,t?b.jd(E.x,E.y,E.z):o.k.TransformCoordinatesFromFloatsToRef(E.x,E.y,E.z,c,b),this.useMeshNormalsForDirection&&this._normals&&(o.k.FromArrayToRef(this._normals,3*C,R),o.k.FromArrayToRef(this._normals,3*J,N),o.k.FromArrayToRef(this._normals,3*X,k),this._storedNormal.x=h*R.x+s*N.x+L*k.x,this._storedNormal.y=h*R.y+s*N.y+L*k.y,this._storedNormal.z=h*R.z+s*N.z+L*k.z)}clone(){const c=new d(this.mesh);return J.d.DeepCopy(this,c),c}applyToShader(c){c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var c;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.hk(),b.direction2=this.direction2.hk(),b.meshId=null===(c=this.mesh)||void 0===c?void 0:c.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(c,b){o.k.FromArrayToRef(c.direction1,0,this.direction1),o.k.FromArrayToRef(c.direction2,0,this.direction2),c.meshId&&b&&(this.mesh=b.getLastMeshById(c.meshId)),this.useMeshNormalsForDirection=c.useMeshNormalsForDirection}}class r{_isUbo(c){return void 0!==c.addUniform}constructor(c){this._isUbo(c)?(this.setMatrix3x3=c.updateMatrix3x3.bind(c),this.setMatrix2x2=c.updateMatrix2x2.bind(c),this.setFloat=c.updateFloat.bind(c),this.setFloat2=c.updateFloat2.bind(c),this.setFloat3=c.updateFloat3.bind(c),this.setFloat4=c.updateFloat4.bind(c),this.setFloatArray=c.updateFloatArray.bind(c),this.setArray=c.updateArray.bind(c),this.setIntArray=c.updateIntArray.bind(c),this.setMatrix=c.nk.bind(c),this.setMatrices=c.updateMatrices.bind(c),this.setVector3=c.updateVector3.bind(c),this.setVector4=c.updateVector4.bind(c),this.setColor3=c.updateColor3.bind(c),this.setColor4=c.updateColor4.bind(c),this.setDirectColor4=c.updateDirectColor4.bind(c),this.setInt=c.updateInt.bind(c),this.setInt2=c.updateInt2.bind(c),this.setInt3=c.updateInt3.bind(c),this.setInt4=c.updateInt4.bind(c)):(this.setMatrix3x3=c.setMatrix3x3.bind(c),this.setMatrix2x2=c.setMatrix2x2.bind(c),this.setFloat=c.setFloat.bind(c),this.setFloat2=c.setFloat2.bind(c),this.setFloat3=c.setFloat3.bind(c),this.setFloat4=c.setFloat4.bind(c),this.setFloatArray=c.setFloatArray.bind(c),this.setArray=c.setArray.bind(c),this.setIntArray=c.setIntArray.bind(c),this.setMatrix=c.setMatrix.bind(c),this.setMatrices=c.setMatrices.bind(c),this.setVector3=c.setVector3.bind(c),this.setVector4=c.setVector4.bind(c),this.setColor3=c.setColor3.bind(c),this.setColor4=c.setColor4.bind(c),this.setDirectColor4=c.setDirectColor4.bind(c),this.setInt=c.setInt.bind(c),this.setInt2=c.setInt2.bind(c),this.setInt3=c.setInt3.bind(c),this.setInt4=c.setInt4.bind(c))}}var z=A(601);const Y="gpuUpdateParticlesPixelShader",D="#version 300 es\nvoid main() {discard;}\n";z.e.ShadersStore[Y]||(z.e.ShadersStore[Y]=D);const f="gpuUpdateParticlesVertexShader",v="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";z.e.ShadersStore[f]||(z.e.ShadersStore[f]=v);(0,s.d)("BABYLON.WebGL2ParticleSystem",class{constructor(c,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=c,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var c;return(null===(c=this._updateEffect)||void 0===c?void 0:c.isReady())??!1}createUpdateBuffer(c){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof M&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=c,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new r(this._updateEffect)}createVertexBuffers(c,b){this._updateVAO.push(this._createUpdateVAO(c)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(c){return c}bindDrawBuffers(c,b,A){A?this._engine.bindBuffers(this._renderVertexBuffers,A,b):this._engine.bindVertexArrayObject(this._renderVAO[c],null)}preUpdateParticleBuffer(){const c=this._engine;if(this._engine.enableEffect(this._updateEffect),!c.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(c,b,A){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[c],null);const o=this._engine;o.bindTransformFeedbackBuffer(b.getBuffer()),o.setRasterizerState(!1),o.beginTransformFeedback(!0),o.drawArraysType(3,0,A),o.endTransformFeedback(),o.setRasterizerState(!0),o.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let c=0;c<this._updateVAO.length;c++)this._engine.releaseVertexArrayObject(this._updateVAO[c]);this._updateVAO.length=0;for(let c=0;c<this._renderVAO.length;c++)this._engine.releaseVertexArrayObject(this._renderVAO[c]);this._renderVAO.length=0}_createUpdateVAO(c){const b={};b.position=c.createVertexBuffer("position",0,3);let A=3;b.age=c.createVertexBuffer("age",A,1),A+=1,b.size=c.createVertexBuffer("size",A,3),A+=3,b.life=c.createVertexBuffer("life",A,1),A+=1,b.seed=c.createVertexBuffer("seed",A,4),A+=4,b.direction=c.createVertexBuffer("direction",A,3),A+=3,this._parent.particleEmitterType instanceof M&&(b.initialPosition=c.createVertexBuffer("initialPosition",A,3),A+=3),this._parent._colorGradientsTexture||(b.color=c.createVertexBuffer("color",A,4),A+=4),this._parent._isBillboardBased||(b.initialDirection=c.createVertexBuffer("initialDirection",A,3),A+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",A,3),A+=3,b.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",A,3),A+=3),this._parent._angularSpeedGradientsTexture?(b.angle=c.createVertexBuffer("angle",A,1),A+=1):(b.angle=c.createVertexBuffer("angle",A,2),A+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=c.createVertexBuffer("cellIndex",A,1),A+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=c.createVertexBuffer("cellStartOffset",A,1),A+=1));const o=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),o}});class G{constructor(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=arguments.length>3?arguments[3]:void 0;this._engine=c,this._label=o,this._engine._storageBuffers.push(this),this._create(b,A)}_create(c,b){this._bufferSize=c,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(c,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(c,b,A){this._buffer&&this._engine.updateStorageBuffer(this._buffer,c,b,A)}async read(c,b,A,o){return await this._engine.readFromStorageBuffer(this._buffer,c,b,A,o)}dispose(){const c=this._engine._storageBuffers,b=c.indexOf(this);-1!==b&&(c[b]=c[c.length-1],c.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var P=A(672),O=A(674),p=A(714),q=A(2070),I=A(2224),K=A(531),Z=A(618),H=A(2160);class S{constructor(){this._gpuTimeInFrameId=-1,this.counter=new H.b}_addDuration(c,b){c<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==c?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=c):this.counter.addCount(b,!1))}}var B=A(580);class Q{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=c,this._engine=b,this.uniqueId=I.d.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new S),this._engine.getCaps().supportComputeShaders?o.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=A,this._options={bindingsMapping:{},defines:[],...o}):K.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):K.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(c,b){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=this._bindings[c];this._bindings[c]={type:A?0:4,object:b,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!o||o.object!==b||o.type!==this._bindings[c].type)}setStorageTexture(c,b){const A=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==b),this._bindings[c]={type:1,object:b,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setExternalTexture(c,b){const A=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==b),this._bindings[c]={type:6,object:b,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setVideoTexture(c,b){return!!b.externalTexture&&(this.setExternalTexture(c,b.externalTexture),!0)}setUniformBuffer(c,b){const A=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==b),this._bindings[c]={type:Q._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setStorageBuffer(c,b){const A=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==b),this._bindings[c]={type:Q._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setTextureSampler(c,b){const A=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!A||!b.compareSampler(A.object)),this._bindings[c]={type:5,object:b,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}isReady(){let c=this._effect;for(const t in this._bindings){const c=this._bindings[t],b=c.type,A=c.object;switch(b){case 0:case 4:case 1:if(!A.isReady())return!1;break;case 6:if(!A.isReady())return!1;break}}const b=[],A=this._shaderPath;if(this._options.defines)for(let t=0;t<this._options.defines.length;t++)b.push(this._options.defines[t]);const o=b.join("\n");return this._cachedDefines!==o&&(this._cachedDefines=o,c=this._engine.createComputeEffect(A,{defines:o,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=c),!!c.isReady()}dispatch(c,b,A){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,c,b,A,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const A=Q._BufferIsDataBuffer(c)?c:c.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,A,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const A=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(A.type){case 0:{const o=this._samplers[b],t=A.object;var c;if(!o||!t._texture||!o.compareSampler(t._texture))this._samplers[b]=(new Z.c).setParameters(t.wrapU,t.wrapV,t.wrapR,t.anisotropicFilteringLevel,t._texture.samplingMode,null===(c=t._texture)||void 0===c?void 0:c._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const c=A.object;c.getBuffer()!==A.buffer&&(A.buffer=c.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((t=>{(0,B.d)((()=>this.dispatch(c,b,A)),t,void 0,o)}))}serialize(){const c=p.c.Serialize(this);c.options=this._options,c.shaderPath=this._shaderPath,c.Rl={},c.textures={};for(const b in this._bindings){const A=this._bindings[b],o=A.object;switch(A.type){case 0:case 4:case 1:{const t=o.serialize();t&&(c.textures[b]=t,c.Rl[b]={type:A.type});break}}}return c}static Parse(c,b,A){const o=p.c.Parse((()=>new Q(c.name,b.getEngine(),c.shaderPath,c.options)),c,b,A);for(const t in c.textures){const n=c.Rl[t],h=q.d.Parse(c.textures[t],b,A);0===n.type?o.setTexture(t,h):4===n.type?o.setTexture(t,h,!1):o.setStorageTexture(t,h)}return o}static _BufferIsDataBuffer(c){return void 0!==c.underlyingResource}}(0,P.e)([(0,O.J)()],Q.prototype,"name",void 0),(0,P.e)([(0,O.J)()],Q.prototype,"fastMode",void 0),(0,s.d)("BABYLON.ComputeShader",Q);var a=A(837);const l="gpuUpdateParticlesComputeShader",T="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";z.e.ShadersStoreWGSL[l]||(z.e.ShadersStoreWGSL[l]=T);(0,s.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(c,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=c,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var c;return(null===(c=this._updateComputeShader)||void 0===c?void 0:c.isReady())??!1}createUpdateBuffer(c){var b;const A={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(A.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(A.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(A.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(A.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(A.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(A.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(A.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new Q("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:A,defines:c.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new a.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new r(this._simParamsComputeShader)}createVertexBuffers(c,b){this._renderVertexBuffers.push(b)}createParticleBuffer(c){const b=new G(this._engine,4*c.length,11,"ComputeShaderParticleSystemBuffer");return b.update(c),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(c,b,A){this._engine.bindBuffers(this._renderVertexBuffers[c],A,b)}preUpdateParticleBuffer(){}updateParticleBuffer(c,b,A){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[c]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^c]),this._updateComputeShader.dispatch(Math.ceil(A/64))}releaseBuffers(){var c;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class i{constructor(c,b,A){this.gradient=c,this.color1=b,this.color2=A}getColorToRef(c){this.color2?h.h.LerpToRef(this.color1,this.color2,Math.random(),c):c.p(this.color1)}}class g{constructor(c,b){this.gradient=c,this.color=b}}class u{constructor(c,b,A){this.gradient=c,this.factor1=b,this.factor2=A}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class e{static GetCurrentGradient(c,b,A){if(b[0].gradient>c)return void A(b[0],b[0],1);for(let t=0;t<b.length-1;t++){const o=b[t],n=b[t+1];if(c>=o.gradient&&c<=n.gradient){return void A(o,n,(c-o.gradient)/(n.gradient-o.gradient))}}const o=b.length-1;A(b[o],b[o],1)}}var x=A(518),U=A(11833),w=A(550);class m{constructor(c){this.particleSystem=c,this.position=o.k.Zero(),this.direction=o.k.Zero(),this.color=new h.h(0,0,0,0),this.colorStep=new h.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new o.h(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new h.h(0,0,0,0),this._currentColor2=new h.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=m._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let c=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,c=this._randomCellOffset):c+=this._randomCellOffset);const A=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let o;o=this._initialSpriteCellLoop?(0,C.Clamp)(c*b%this.lifeTime/this.lifeTime):(0,C.Clamp)(c*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+o*A|0}_inheritParticleInfoToSubEmitter(c){if(c.particleSystem.j.position){const b=c.particleSystem.j;if(b.position.p(this.position),c.inheritDirection){const c=o.f.ak[0];this.direction.normalizeToRef(c),b.setDirection(c,0,Math.PI/2)}}else{c.particleSystem.j.p(this.position)}this.direction.scaleToRef(c.inheritedVelocityAmount/2,o.f.ak[0]),c.particleSystem._inheritedVelocityOffset.p(o.f.ak[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const c of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(c)}_reset(){this.age=0,this.id=m._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(c){c.position.p(this.position),this._initialDirection?c._initialDirection?c._initialDirection.p(this._initialDirection):c._initialDirection=this._initialDirection.clone():c._initialDirection=null,c.direction.p(this.direction),this.hd&&(c.hd?c.hd.p(this.hd):c.hd=this.hd.clone()),c.color.p(this.color),c.colorStep.p(this.colorStep),c.lifeTime=this.lifeTime,c.age=this.age,c._randomCellOffset=this._randomCellOffset,c.size=this.size,c.scale.p(this.scale),c.angle=this.angle,c.angularSpeed=this.angularSpeed,c.particleSystem=this.particleSystem,c.cellIndex=this.cellIndex,c.id=this.id,c._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(c._currentColorGradient=this._currentColorGradient,c._currentColor1.p(this._currentColor1),c._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(c._currentSizeGradient=this._currentSizeGradient,c._currentSize1=this._currentSize1,c._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(c._currentAngularSpeedGradient=this._currentAngularSpeedGradient,c._currentAngularSpeed1=this._currentAngularSpeed1,c._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(c._currentVelocityGradient=this._currentVelocityGradient,c._currentVelocity1=this._currentVelocity1,c._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(c._currentLimitVelocityGradient=this._currentLimitVelocityGradient,c._currentLimitVelocity1=this._currentLimitVelocity1,c._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(c._currentDragGradient=this._currentDragGradient,c._currentDrag1=this._currentDrag1,c._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(c._initialStartSpriteCellId=this._initialStartSpriteCellId,c._initialEndSpriteCellId=this._initialEndSpriteCellId,c._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(c.remapData&&this.remapData?c.remapData.p(this.remapData):c.remapData=new o.o(0,0,0,0)),this._randomNoiseCoordinates1&&(c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),c._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(c._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),c._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}m._Count=0;var cc=A(802),bc=(A(2132),A(867)),Ac=A(860),oc=A(2201);function tc(c,b){const A=(0,C.RandomRange)(0,1);h.h.LerpToRef(b.color1,b.color2,A,c.color),b.colorDead.subtractToRef(c.color,b._colorDiff),b._colorDiff.scaleToRef(1/c.lifeTime,c.colorStep)}function nc(c,b){c._currentColorGradient=b._colorGradients[0],c._currentColorGradient.getColorToRef(c.color),c._currentColor1.p(c.color),b._colorGradients.length>1?b._colorGradients[1].getColorToRef(c._currentColor2):c._currentColor2.p(c.color)}function hc(c,b){const A=b._colorGradients;e.GetCurrentGradient(b._ratio,A,((b,A,o)=>{b!==c._currentColorGradient&&(c._currentColor1.p(c._currentColor2),A.getColorToRef(c._currentColor2),c._currentColorGradient=b),h.h.LerpToRef(c._currentColor1,c._currentColor2,o,c.color)}))}function sc(c,b){c.colorStep.scaleToRef(b._scaledUpdateSpeed,b._scaledColorStep),c.color.addInPlace(b._scaledColorStep),c.color.a<0&&(c.color.a=0)}function Lc(c,b){e.GetCurrentGradient(b._ratio,b._angularSpeedGradients,((b,A,o)=>{b!==c._currentAngularSpeedGradient&&(c._currentAngularSpeed1=c._currentAngularSpeed2,c._currentAngularSpeed2=A.getFactor(),c._currentAngularSpeedGradient=b),c.angularSpeed=(0,C.Lerp)(c._currentAngularSpeed1,c._currentAngularSpeed2,o)}))}function Cc(c,b){c.angle+=c.angularSpeed*b._scaledUpdateSpeed}function Jc(c,b){b.particleEmitterType.startDirectionFunction(b._emitterWorldMatrix,c.direction,c,b.isLocal,b._emitterInverseWorldMatrix)}function Xc(c,b){b.startDirectionFunction(b._emitterWorldMatrix,c.direction,c,b.isLocal)}function Rc(c,b){c._currentVelocityGradient=b._velocityGradients[0],c._currentVelocity1=c._currentVelocityGradient.getFactor(),b._velocityGradients.length>1?c._currentVelocity2=b._velocityGradients[1].getFactor():c._currentVelocity2=c._currentVelocity1}function Nc(c,b){c._currentLimitVelocityGradient=b._limitVelocityGradients[0],c._currentLimitVelocity1=c._currentLimitVelocityGradient.getFactor(),b._limitVelocityGradients.length>1?c._currentLimitVelocity2=b._limitVelocityGradients[1].getFactor():c._currentLimitVelocity2=c._currentLimitVelocity1}function kc(c,b){e.GetCurrentGradient(b._ratio,b._velocityGradients,((A,o,t)=>{A!==c._currentVelocityGradient&&(c._currentVelocity1=c._currentVelocity2,c._currentVelocity2=o.getFactor(),c._currentVelocityGradient=A),b._directionScale*=(0,C.Lerp)(c._currentVelocity1,c._currentVelocity2,t)}))}function Ec(c,b){e.GetCurrentGradient(b._ratio,b._limitVelocityGradients,((A,o,t)=>{A!==c._currentLimitVelocityGradient&&(c._currentLimitVelocity1=c._currentLimitVelocity2,c._currentLimitVelocity2=o.getFactor(),c._currentLimitVelocityGradient=A);const n=(0,C.Lerp)(c._currentLimitVelocity1,c._currentLimitVelocity2,t);c.direction.length()>n&&c.direction.scaleInPlace(b.limitVelocityDamping)}))}function Vc(c,b){c.direction.scaleToRef(b._directionScale,b._scaledDirection)}function yc(c,b){b.particleEmitterType.startPositionFunction(b._emitterWorldMatrix,c.position,c,b.isLocal)}function jc(c,b){b.startPositionFunction(b._emitterWorldMatrix,c.position,c,b.isLocal)}function Fc(c,b){c.hd?c.hd.p(c.position):c.hd=c.position.clone(),o.k.TransformCoordinatesToRef(c.hd,b._emitterWorldMatrix,c.position)}function Mc(c,b){b.isLocal&&c.hd?(c.hd.addInPlace(b._scaledDirection),o.k.TransformCoordinatesToRef(c.hd,b._emitterWorldMatrix,c.position)):c.position.addInPlace(b._scaledDirection)}function Wc(c,b){c._currentDragGradient=b._dragGradients[0],c._currentDrag1=c._currentDragGradient.getFactor(),b._dragGradients.length>1?c._currentDrag2=b._dragGradients[1].getFactor():c._currentDrag2=c._currentDrag1}function dc(c,b){e.GetCurrentGradient(b._ratio,b._dragGradients,((A,o,t)=>{A!==c._currentDragGradient&&(c._currentDrag1=c._currentDrag2,c._currentDrag2=o.getFactor(),c._currentDragGradient=A);const n=(0,C.Lerp)(c._currentDrag1,c._currentDrag2,t);b._scaledDirection.scaleInPlace(1-n)}))}function rc(c,b){c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.jd(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2.jd(Math.random(),Math.random(),Math.random())):(c._randomNoiseCoordinates1=new o.k(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2=new o.k(Math.random(),Math.random(),Math.random()))}function zc(c,b){const A=b._noiseTextureData,t=b._noiseTextureSize;if(A&&t&&c._randomNoiseCoordinates1){const n=b._fetchR(c._randomNoiseCoordinates1.x,c._randomNoiseCoordinates1.y,t.width,t.height,A),h=b._fetchR(c._randomNoiseCoordinates1.z,c._randomNoiseCoordinates2.x,t.width,t.height,A),s=b._fetchR(c._randomNoiseCoordinates2.y,c._randomNoiseCoordinates2.z,t.width,t.height,A),L=o.f.ak[0],C=o.f.ak[1];L.jd((2*n-1)*b.noiseStrength.x,(2*h-1)*b.noiseStrength.y,(2*s-1)*b.noiseStrength.z),L.scaleToRef(b._tempScaledUpdateSpeed,C),c.direction.addInPlace(C)}}function Yc(c,b){b.gravity.scaleToRef(b._tempScaledUpdateSpeed,b._scaledGravity),c.direction.addInPlace(b._scaledGravity)}function Dc(c,b){c.size=(0,C.RandomRange)(b.minSize,b.maxSize),c.scale.jd((0,C.RandomRange)(b.minScaleX,b.maxScaleX),(0,C.RandomRange)(b.minScaleY,b.maxScaleY))}function fc(c,b){c._currentSizeGradient=b._sizeGradients[0],c._currentSize1=c._currentSizeGradient.getFactor(),c.size=c._currentSize1,b._sizeGradients.length>1?c._currentSize2=b._sizeGradients[1].getFactor():c._currentSize2=c._currentSize1,c.scale.jd((0,C.RandomRange)(b.minScaleX,b.maxScaleX),(0,C.RandomRange)(b.minScaleY,b.maxScaleY))}function vc(c,b){const A=b._actualFrame/b.targetStopDuration;e.GetCurrentGradient(A,b._startSizeGradients,((A,o,t)=>{A!==b._currentStartSizeGradient&&(b._currentStartSize1=b._currentStartSize2,b._currentStartSize2=o.getFactor(),b._currentStartSizeGradient=A);const n=(0,C.Lerp)(b._currentStartSize1,b._currentStartSize2,t);c.scale.scaleInPlace(n)}))}function Gc(c,b){e.GetCurrentGradient(b._ratio,b._sizeGradients,((b,A,o)=>{b!==c._currentSizeGradient&&(c._currentSize1=c._currentSize2,c._currentSize2=A.getFactor(),c._currentSizeGradient=b),c.size=(0,C.Lerp)(c._currentSize1,c._currentSize2,o)}))}function Pc(c,b){c.remapData=new o.o(0,1,0,1)}function Oc(c,b){b._colorRemapGradients&&b._colorRemapGradients.length>0&&e.GetCurrentGradient(b._ratio,b._colorRemapGradients,((b,A,o)=>{const t=(0,C.Lerp)(b.factor1,A.factor1,o),n=(0,C.Lerp)(b.factor2,A.factor2,o);c.remapData.x=t,c.remapData.y=n-t})),b._alphaRemapGradients&&b._alphaRemapGradients.length>0&&e.GetCurrentGradient(b._ratio,b._alphaRemapGradients,((b,A,o)=>{const t=(0,C.Lerp)(b.factor1,A.factor1,o),n=(0,C.Lerp)(b.factor2,A.factor2,o);c.remapData.z=t,c.remapData.w=n-t}))}function pc(c,b){const A=(0,C.Clamp)(b._actualFrame/b.targetStopDuration);e.GetCurrentGradient(A,b._lifeTimeGradients,((b,o)=>{const t=b,n=o,h=t.getFactor(),s=n.getFactor(),L=(A-t.gradient)/(n.gradient-t.gradient);c.lifeTime=(0,C.Lerp)(h,s,L)})),b._emitPower=(0,C.RandomRange)(b.minEmitPower,b.maxEmitPower)}function qc(c,b){c.lifeTime=(0,C.RandomRange)(b.minLifeTime,b.maxLifeTime),b._emitPower=(0,C.RandomRange)(b.minEmitPower,b.maxEmitPower)}function Ic(c,b){0===b._emitPower?(c._initialDirection?c._initialDirection.p(c.direction):c._initialDirection=c.direction.clone(),c.direction.set(0,0,0)):(c._initialDirection=null,c.direction.scaleInPlace(b._emitPower)),c.direction.addInPlace(b._inheritedVelocityOffset)}function Kc(c,b){c.angularSpeed=(0,C.RandomRange)(b.minAngularSpeed,b.maxAngularSpeed),c.angle=(0,C.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function Zc(c,b){c._currentAngularSpeedGradient=b._angularSpeedGradients[0],c.angularSpeed=c._currentAngularSpeedGradient.getFactor(),c._currentAngularSpeed1=c.angularSpeed,b._angularSpeedGradients.length>1?c._currentAngularSpeed2=b._angularSpeedGradients[1].getFactor():c._currentAngularSpeed2=c._currentAngularSpeed1,c.angle=(0,C.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function Hc(c,b){c._initialStartSpriteCellId=b.startSpriteCellID,c._initialEndSpriteCellId=b.endSpriteCellID,c._initialSpriteCellLoop=b.spriteCellLoop}function Sc(c,b){c.previousItem=b.previousItem,c.nextItem=b,b.previousItem&&(b.previousItem.nextItem=c),b.previousItem=c}function Bc(c,b){c.previousItem=b,c.nextItem=b.nextItem,b.nextItem&&(b.nextItem.previousItem=c),b.nextItem=c}function Qc(c,b){let A=b;for(;A.nextItem;)A=A.nextItem;c.previousItem=A,c.nextItem=A.nextItem,A.nextItem=c}function ac(c){c.previousItem&&(c.previousItem.nextItem=c.nextItem),c.nextItem&&(c.nextItem.previousItem=c.previousItem)}class lc extends L{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(c){this._startDirectionFunction!==c&&(this._startDirectionFunction=c,this._directionProcessing.process=c?Xc:Jc)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(c){this._startPositionFunction!==c&&(this._startPositionFunction=c,this._positionCreation.process=c?jc:yc)}set onDispose(c){this._onDisposeObserver&&this.fk.remove(this._onDisposeObserver),this._onDisposeObserver=this.fk.add(c)}get u(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(c){this._useRampGradients!==c&&(this._useRampGradients=c,this._resetEffect(),c?(this._rampCreation={process:Pc,previousItem:null,nextItem:null},Bc(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Oc,previousItem:null,nextItem:null},Bc(this._remapGradientProcessing,this._gravityProcessing)):(ac(this._rampCreation),ac(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(c){this._isLocal!==c&&(this._isLocal=c,c?(this._isLocalCreation={process:Fc,previousItem:null,nextItem:null},Bc(this._isLocalCreation,this._positionCreation)):ac(this._isLocalCreation))}get particles(){return this.Ml}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(c){this._animationSheetEnabled!==c&&(this._animationSheetEnabled=c,c?(this._sheetCreation={process:Hc,previousItem:null,nextItem:null},Bc(this._sheetCreation,this._colorCreation)):ac(this._sheetCreation),this._reset())}getActiveCount(){return this.Ml.length}getClassName(){return"Mk"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var c;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(c=this._customWrappers[b])||void 0===c?void 0:c.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[c]??this._customWrappers[0]}setCustomEffect(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new cc.d(this._engine),this._customWrappers[b].effect=c,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new x.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(c){if(this.noiseTexture!==c){if(this._noiseTexture=c,!c)return ac(this._noiseCreation),void ac(this._noiseProcessing);this._noiseCreation={process:rc,previousItem:null,nextItem:null},Bc(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:zc,previousItem:null,nextItem:null},Bc(this._noiseProcessing,this._positionProcessing)}}constructor(c,b,A){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(c),this._emitterInverseWorldMatrix=o.b.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new o.k,this.fk=new x.b,this.onStoppedObservable=new x.b,this.onStartedObservable=new x.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Ml=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new h.h(0,0,0,0),this._colorDiff=new h.h(0,0,0,0),this._scaledDirection=o.k.Zero(),this._scaledGravity=o.k.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=c=>{},this.recycleParticle=c=>{const b=this.Ml.pop();b!==c&&b.copyTo(c),this._stockParticles.push(b)},this._createParticle=()=>{let c;return 0!==this._stockParticles.length?(c=this._stockParticles.pop(),c._reset()):c=new m(this),this._prepareParticle(c),c},this.paused=!1,this._shadersLoaded=!1,this._capacity=b,this._epsilon=s,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=o.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||w.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xk.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:qc,previousItem:null,nextItem:null},this._positionCreation={process:yc,previousItem:null,nextItem:null},Bc(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Jc,previousItem:null,nextItem:null},Bc(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Ic,previousItem:null,nextItem:null},Bc(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Dc,previousItem:null,nextItem:null},Bc(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Kc,previousItem:null,nextItem:null},Bc(this._angleCreation,this._sizeCreation),this._colorCreation={process:tc,previousItem:null,nextItem:null},Bc(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,L||(this._colorProcessing={process:sc,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Cc,previousItem:null,nextItem:null},Bc(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Vc,previousItem:null,nextItem:null},Bc(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Mc,previousItem:null,nextItem:null},Bc(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Yc,previousItem:null,nextItem:null},Bc(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=n,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new cc.d(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new X,this.updateFunction=c=>{var b;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(b=this.noiseTexture.getContent())||void 0===b||b.then((c=>{this._noiseTextureData=c})));const A=c===this.Ml;for(let o=0;o<c.length;o++){const b=c[o];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const t=b.age;if(b.age+=this._tempScaledUpdateSpeed,b.age>b.lifeTime){const c=b.age-t,A=b.lifeTime-t;this._tempScaledUpdateSpeed=A*this._tempScaledUpdateSpeed/c,b.age=b.lifeTime}this._ratio=b.age/b.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let n=this._updateQueueStart;for(;n;)n.process(b,this),n=n.nextItem;if(this._isAnimationSheetEnabled&&!L&&b.updateCellIndex(),b._inheritParticleInfoToSubEmitters(),b.age>=b.lifeTime){if(this._emitFromParticle(b),b._attachedSubEmitters){for(const c of b._attachedSubEmitters)c.particleSystem.disposeOnStop=!0,c.particleSystem.stop();b._attachedSubEmitters=null}this.recycleParticle(b),A&&o--}else;}}}serialize(c){throw new Error("Method not implemented.")}clone(c,b){throw new Error("Method not implemented.")}_addFactorGradient(c,b,A,o){const t=new u(b,A,o);c.push(t),c.sort(((c,b)=>c.gradient<b.gradient?-1:c.gradient>b.gradient?1:0))}_removeFactorGradient(c,b){if(!c)return;let A=0;for(const o of c){if(o.gradient===b){c.splice(A,1);break}A++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=pc:this._lifeTimeCreation.process=qc}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:vc,previousItem:null,nextItem:null},Bc(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(ac(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(c){this.targetStopDuration!==c&&(this._targetStopDuration=c,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(c,b,A){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,c,b,A),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(c){return this._removeFactorGradient(this._lifeTimeGradients,c),this._syncLifeTimeCreation(),this}addSizeGradient(c,b,A){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=fc,this._sizeGradientProcessing={process:Gc,previousItem:null,nextItem:null},Sc(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,c,b,A),this}removeSizeGradient(c){var b;return this._removeFactorGradient(this._sizeGradients,c),0===(null===(b=this._sizeGradients)||void 0===b?void 0:b.length)&&(ac(this._sizeGradientProcessing),this._sizeCreation.process=Dc),this}addColorRemapGradient(c,b,A){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,c,b,A),this}removeColorRemapGradient(c){return this._removeFactorGradient(this._colorRemapGradients,c),this}addAlphaRemapGradient(c,b,A){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,c,b,A),this}removeAlphaRemapGradient(c){return this._removeFactorGradient(this._alphaRemapGradients,c),this}addAngularSpeedGradient(c,b,A){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Zc,this._angularSpeedGradientProcessing={process:Lc,previousItem:null,nextItem:null},Sc(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,c,b,A),this}removeAngularSpeedGradient(c){var b;return this._removeFactorGradient(this._angularSpeedGradients,c),0===(null===(b=this._angularSpeedGradients)||void 0===b?void 0:b.length)&&(this._angleCreation.process=Kc,ac(this._angularSpeedGradientProcessing)),this}addVelocityGradient(c,b,A){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Rc,previousItem:null,nextItem:null},Bc(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:kc,previousItem:null,nextItem:null},Sc(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,c,b,A),this}removeVelocityGradient(c){var b;return this._removeFactorGradient(this._velocityGradients,c),0===(null===(b=this._velocityGradients)||void 0===b?void 0:b.length)&&(ac(this._velocityCreation),ac(this._velocityGradientProcessing)),this}addLimitVelocityGradient(c,b,A){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Nc,previousItem:null,nextItem:null},Bc(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Ec,previousItem:null,nextItem:null},Bc(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,c,b,A),this}removeLimitVelocityGradient(c){var b;return this._removeFactorGradient(this._limitVelocityGradients,c),0===(null===(b=this._limitVelocityGradients)||void 0===b?void 0:b.length)&&(ac(this._limitVelocityCreation),ac(this._limitVelocityGradientProcessing)),this}addDragGradient(c,b,A){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Wc,previousItem:null,nextItem:null},Sc(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:dc,previousItem:null,nextItem:null},Sc(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,c,b,A),this}removeDragGradient(c){var b;return this._removeFactorGradient(this._dragGradients,c),0===(null===(b=this._dragGradients)||void 0===b?void 0:b.length)&&(ac(this._dragCreation),ac(this._dragGradientProcessing)),this}addEmitRateGradient(c,b,A){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,c,b,A),this}removeEmitRateGradient(c){return this._removeFactorGradient(this._emitRateGradients,c),this}addStartSizeGradient(c,b,A){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,c,b,A),this._syncStartSizeCreation(),this}removeStartSizeGradient(c){return this._removeFactorGradient(this._startSizeGradients,c),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const c=new Uint8Array(4*this._rawTextureWidth),b=h.j.rk[0];for(let A=0;A<this._rawTextureWidth;A++){const o=A/this._rawTextureWidth;e.GetCurrentGradient(o,this._rampGradients,((o,t,n)=>{h.d.LerpToRef(o.color,t.color,n,b),c[4*A]=255*b.r,c[4*A+1]=255*b.g,c[4*A+2]=255*b.b,c[4*A+3]=255}))}this._rampGradientsTexture=U.d.CreateRGBATexture(c,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((c,b)=>c.gradient<b.gradient?-1:c.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(c,b){this._rampGradients||(this._rampGradients=[]);const A=new g(c,b);return this._rampGradients.push(A),this._syncRampGradientTexture(),this}removeRampGradient(c){return this._removeGradientAndTexture(c,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(c,b,A){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=nc,this._colorProcessing.process=hc);const o=new i(c,b,A);return this._colorGradients.push(o),this._colorGradients.sort(((c,b)=>c.gradient<b.gradient?-1:c.gradient>b.gradient?1:0)),this}removeColorGradient(c){if(!this._colorGradients)return this;let b=0;for(const A of this._colorGradients){if(A.gradient===c){this._colorGradients.splice(b,1);break}b++}return 0===this._colorGradients.length&&(this._colorCreation.process=tc,this._colorProcessing.process=sc),this}resetDrawCache(){if(this._drawWrappers){for(const c of this._drawWrappers)if(c)for(const b of c)null===b||void 0===b||b.dispose();this._drawWrappers=[]}}_fetchR(c,b,A,o,t){return t[4*(((c=.5*Math.abs(c)+.5)*A%A|0)+((b=.5*Math.abs(b)+.5)*o%o|0)*A)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const c=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new W.d(c,this._vertexData,!0,b);let A=0;const o=this._vertexBuffer.createVertexBuffer(W.f.PositionKind,A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[W.f.PositionKind]=o,A+=3;const t=this._vertexBuffer.createVertexBuffer(W.f.ColorKind,A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[W.f.ColorKind]=t,A+=4;const n=this._vertexBuffer.createVertexBuffer("angle",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=n,A+=1;const h=this._vertexBuffer.createVertexBuffer("size",A,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=h,A+=2,this._isAnimationSheetEnabled){const c=this._vertexBuffer.createVertexBuffer("cellIndex",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=c,A+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const c=this._vertexBuffer.createVertexBuffer("direction",A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=c,A+=3}if(this._useRampGradients){const c=this._vertexBuffer.createVertexBuffer("remapData",A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=c,A+=4}let s;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new W.d(c,b,!1,2),s=this._spriteBuffer.createVertexBuffer("offset",0,2)}else s=this._vertexBuffer.createVertexBuffer("offset",A,2,this._vertexBufferSize,this._useInstancing),A+=2;this._vertexBuffers.offset=s,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const c=[],b=[];let A=0;for(let o=0;o<this._capacity;o++)c.push(A),c.push(A+1),c.push(A+2),c.push(A),c.push(A+2),c.push(A+3),b.push(A,A+1,A+1,A+2,A+2,A+3,A+3,A,A,A+3),A+=4;this._indexBuffer=this._engine.createIndexBuffer(c),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(c)setTimeout((()=>{this.start(0)}),c);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.j)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.j.Zj(!0);const c=this.noiseTexture;if(c&&c.onGeneratedObservable)c.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),c.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(c))}_postStop(c){}reset(){this._stockParticles.length=0,this.Ml.length=0}_appendParticleVertex(c,b,A,t){let n=c*this._vertexBufferSize;if(this._vertexData[n++]=b.position.x+this.tg.x,this._vertexData[n++]=b.position.y+this.tg.y,this._vertexData[n++]=b.position.z+this.tg.z,this._vertexData[n++]=b.color.r,this._vertexData[n++]=b.color.g,this._vertexData[n++]=b.color.b,this._vertexData[n++]=b.color.a,this._vertexData[n++]=b.angle,this._vertexData[n++]=b.scale.x*b.size,this._vertexData[n++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[n++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[n++]=b.direction.x,this._vertexData[n++]=b.direction.y,this._vertexData[n++]=b.direction.z);else if(b._initialDirection){let c=b._initialDirection;this.isLocal&&(o.k.TransformNormalToRef(c,this._emitterWorldMatrix,o.f.ak[0]),c=o.f.ak[0]),0===c.x&&0===c.z&&(c.x=.001),this._vertexData[n++]=c.x,this._vertexData[n++]=c.y,this._vertexData[n++]=c.z}else{let c=b.direction;this.isLocal&&(o.k.TransformNormalToRef(c,this._emitterWorldMatrix,o.f.ak[0]),c=o.f.ak[0]),0===c.x&&0===c.z&&(c.x=.001),this._vertexData[n++]=c.x,this._vertexData[n++]=c.y,this._vertexData[n++]=c.z}this._useRampGradients&&b.remapData&&(this._vertexData[n++]=b.remapData.x,this._vertexData[n++]=b.remapData.y,this._vertexData[n++]=b.remapData.z,this._vertexData[n++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===A?A=this._epsilon:1===A&&(A=1-this._epsilon),0===t?t=this._epsilon:1===t&&(t=1-this._epsilon)),this._vertexData[n++]=A,this._vertexData[n++]=t)}_prepareParticle(c){}_createNewOnes(c){let b;for(let A=0;A<c&&this.Ml.length!==this._capacity;A++){b=this._createParticle(),this.Ml.push(b);let c=this._createQueueStart;for(;c;)c.process(b,this),c=c.nextItem;b._inheritParticleInfoToSubEmitters()}}_update(c){if(this._alive=this.Ml.length>0,this.j.position){const c=this.j;this._emitterWorldMatrix=c.getWorldMatrix()}else{const c=this.j;this._emitterWorldMatrix=o.b.Translation(c.x,c.y,c.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ml),this._createNewOnes(c)}static _GetAttributeNamesOrOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=[W.f.PositionKind,W.f.ColorKind,"angle","offset","size"];return c&&o.push("cellIndex"),b||o.push("direction"),A&&o.push("remapData"),o}static _GetEffectCreationOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bc.e)(o),c&&o.push("particlesInfos"),b&&o.push("logarithmicDepthConstant"),A&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(c,b){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bc.j)(this,this._scene,c),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&c.push("#define FOG")),this._isAnimationSheetEnabled&&c.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&c.push("#define LOGARITHMICDEPTH"),b===L.BLENDMODE_MULTIPLY&&c.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&c.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(c.push("#define BILLBOARD"),this.billboardMode){case 2:c.push("#define BILLBOARDY");break;case 8:case 9:c.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&c.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:c.push("#define BILLBOARDMODE_ALL")}A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),c.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(c,b,A){b.push(...lc._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),c.push(...lc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,oc.f)(c,this._imageProcessingConfigurationDefines),(0,oc.e)(A,this._imageProcessingConfigurationDefines))}_getWrapper(c){const b=this._getCustomDrawWrapper(c);if(null!==b&&void 0!==b&&b.effect)return b;const A=[];this.fillDefines(A,c);const o=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let t=this._drawWrappers[o];t||(t=this._drawWrappers[o]=[]);let n=t[c];n||(n=new cc.d(this._engine),n.drawContext&&(n.drawContext.useInstancing=this._useInstancing),t[c]=n);const h=A.join("\n");if(n.defines!==h){const c=[],b=[],A=[];this.fillUniformsAttributesAndSamplerNames(b,c,A),n.setEffect(this._engine.createEffect("particles",c,b,A,h,void 0,void 0,void 0,void 0,this._shaderLanguage),h)}return n}animate(){var c;let b,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!A&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(A?this.preWarmStepOffset:(null===(c=this._scene)||void 0===c?void 0:c.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let c=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;e.GetCurrentGradient(b,this._emitRateGradients,((b,A,o)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=A.getFactor(),this._currentEmitRateGradient=b),c=(0,C.Lerp)(this._currentEmitRate1,this._currentEmitRate2,o)}))}b=c*this._scaledUpdateSpeed|0,this._newPartsExcess+=c*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!A){let c=0;for(let b=0;b<this.Ml.length;b++){const A=this.Ml[b];this._appendParticleVertices(c,A),c+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ml.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(c,b){this._appendParticleVertex(c++,b,0,0),this._useInstancing||(this._appendParticleVertex(c++,b,1,0),this._appendParticleVertex(c++,b,1,1),this._appendParticleVertex(c++,b,0,1))}rebuild(){var c;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(c=this._spriteBuffer)||void 0===c||c._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!lc.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(A.bind(A,12540)),Promise.resolve().then(A.bind(A,12499))])):await Promise.all([Promise.resolve().then(A.bind(A,12489)),Promise.resolve().then(A.bind(A,12480))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==L.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(L.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(L.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(c){const b=this._getWrapper(c),A=b.effect,t=this._engine;t.enableEffect(b);const n=this.defaultViewMatrix??this._scene.getViewMatrix();if(A.setTexture("diffuseSampler",this.particleTexture),A.setMatrix("view",n),A.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const c=this.particleTexture.getBaseSize();A.setFloat3("particlesInfos",this.spriteCellWidth/c.width,this.spriteCellHeight/c.height,this.spriteCellWidth/c.width)}if(A.setVector2("translationPivot",this.translationPivot),A.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const c=this._scene.activeCamera;A.setVector3("eyePosition",c.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),A.setTexture("rampSampler",this._rampGradientsTexture));const h=A.defines;var s,L,C,J,X,R;(this._scene&&((0,bc.g)(A,this,this._scene),this.applyFog&&(0,Ac.e)(this._scene,void 0,A)),h.indexOf("#define BILLBOARDMODE_ALL")>=0&&(n.invertToRef(o.f.Matrix[0]),A.setMatrix("invView",o.f.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?t.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,A):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,A)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?t.bindBuffers(this._vertexBuffers,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBuffer:this._indexBuffer,A):t.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:null,A);(this.useLogarithmicDepth&&this._scene&&(0,Ac.i)(h,A,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(A),this._setEngineBasedOnBlendMode(c),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(A),this._useInstancing)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?t.drawElementsType(6,0,10,this.Ml.length):t.drawArraysType(7,0,4,this.Ml.length):null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?t.drawElementsType(1,0,10*this.Ml.length):t.drawElementsType(0,0,6*this.Ml.length);return this.Ml.length}render(){if(!this.isReady()||!this.Ml.length)return 0;const c=this._engine;c.setState&&(c.setState(!1),this.forceDepthWrite&&c.setDepthWrite(!0));let b=0;return b=this.blendMode===L.BLENDMODE_MULTIPLYADD?this._render(L.BLENDMODE_MULTIPLY)+this._render(L.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),c&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),c&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,A),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const c=this._scene.xk.indexOf(this);c>-1&&this._scene.xk.splice(c,1),this._scene._activeParticleSystems.dispose()}this.fk.notifyObservers(this),this.fk.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}lc.ForceGLSL=!1;var Tc,ic=A(543);!function(c){c[c.ATTACHED=0]="ATTACHED",c[c.END=1]="END"}(Tc||(Tc={}));class gc{constructor(c){if(this.particleSystem=c,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!c.j||!c.j.dispose){const b=(0,s.c)("BABYLON.AbstractMesh");c.j=new b("SubemitterSystemEmitter",c.va()),c._disposeEmitterOnDispose=!0}}clone(){let c=this.particleSystem.j;if(c){if(c instanceof o.k)c=c.clone();else if(-1!==c.getClassName().indexOf("Mesh")){c=new((0,s.c)("BABYLON.Mesh"))("",c.va()),c.isVisible=!1}}else c=new o.k;const b=new gc(this.particleSystem.clone(this.particleSystem.name,c));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(c),b}static _ParseParticleSystem(c,b,A){throw(0,ic.c)("ParseParticle")}static Parse(c,b,A){const o=c.particleSystem,t=new gc(gc._ParseParticleSystem(o,b,A,!0));return t.type=c.type,t.inheritDirection=c.inheritDirection,t.inheritedVelocityAmount=c.inheritedVelocityAmount,t.particleSystem._isSubEmitter=!0,t}dispose(){this.particleSystem.dispose()}}var uc=A(589);function ec(c,b){const A=new y;return A.direction1=c,A.direction2=b,A}function xc(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Uc(){return new j(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function wc(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.k(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0);return new F(c,b,A)}function mc(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function cb(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0),n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.k(0,1,0);return new E(c,b,A,t,n)}function bb(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new R(c,b)}function Ab(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0);return new N(c,b,A,t)}const ob=o.k.Zero(),tb=o.k.Zero(),nb=o.k.Zero();class hb{constructor(){this.strength=0,this.position=o.k.Zero()}_processParticle(c,b){this.position.subtractToRef(c.position,ob);const A=ob.lengthSquared()+1;ob.normalize().scaleToRef(this.strength/A,tb),tb.scaleToRef(b._tempScaledUpdateSpeed,nb),c.direction.addInPlace(nb)}serialize(){return{position:this.position.hk(),strength:this.strength}}}class sb extends lc{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=c=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);for(const A of this._subEmitters[b])if(1===A.type){const b=A.clone();c._inheritParticleInfoToSubEmitter(b),b.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(b.particleSystem),b.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(c,b){const A=ec(c,b);return this.particleEmitterType=A,A}get flowMap(){return this._flowMap}set flowMap(c){this._flowMap!==c&&(this._flowMap=c,this._flowMapUpdate&&(ac(this._flowMapUpdate),this._flowMapUpdate=null),c&&(this._flowMapUpdate={process:c=>{var b;const A=null===(b=this.va())||void 0===b?void 0:b.getTransformMatrix();this._flowMap._processParticle(c,this.flowMapStrength*this._tempScaledUpdateSpeed,A)},previousItem:null,nextItem:null},Bc(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(c){this._attractors.push(c),1===this._attractors.length&&(this._attractorUpdate={process:c=>{for(const b of this._attractors)b._processParticle(c,this)},previousItem:null,nextItem:null},Bc(this._attractorUpdate,this._directionProcessing))}removeAttractor(c){const b=this._attractors.indexOf(c);-1!==b&&this._attractors.splice(b,1),0===this._attractors.length&&ac(this._attractorUpdate)}start(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(c)}createHemisphericEmitter(){const c=xc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createSphereEmitter(){const c=Uc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createDirectedSphereEmitter(){const c=wc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0));return this.particleEmitterType=c,c}createCylinderEmitter(){const c=mc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=c,c}createDirectedCylinderEmitter(){const c=cb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.k(0,1,0));return this.particleEmitterType=c,c}createConeEmitter(){const c=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=c,c}createDirectedConeEmitter(){const c=Ab(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0));return this.particleEmitterType=c,c}createBoxEmitter(c,b,A,o){const t=new X;return this.particleEmitterType=t,this.direction1=c,this.direction2=b,this.minEmitBox=A,this.maxEmitBox=o,t}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const c of this.subEmitters)c instanceof sb?this._subEmitters.push([new gc(c)]):c instanceof gc?this._subEmitters.push([c]):c instanceof Array&&this._subEmitters.push(c)}_stopSubEmitters(){if(this.activeSubSystems){for(const c of this.activeSubSystems)c.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const c=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==c&&this._rootParticleSystem.activeSubSystems.splice(c,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(c){c&&this._stopSubEmitters()}_prepareParticle(c){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];c._attachedSubEmitters=[];for(const A of b)if(0===A.type){const b=A.clone();c._attachedSubEmitters.push(b),b.particleSystem.start()}}}_onDispose(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),c&&this.particles)for(const A of this.particles)if(A._attachedSubEmitters)for(let c=A._attachedSubEmitters.length-1;c>=0;c-=1)A._attachedSubEmitters[c].dispose();if(b&&this.activeSubSystems)for(let A=this.activeSubSystems.length-1;A>=0;A-=1)this.activeSubSystems[A].dispose();if(this._subEmitters&&this._subEmitters.length){for(let c=0;c<this._subEmitters.length;c++)for(const b of this._subEmitters[c])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(c,b,A,t){let n;n=A instanceof uc.c?null:A;const L=(0,s.c)("BABYLON.Texture");if(L&&n&&(c.texture?b.particleTexture=L.Parse(c.texture,n,t):c.textureName&&(b.particleTexture=new L(t+c.textureName,n,!1,void 0===c.invertY||c.invertY),b.particleTexture.name=c.textureName)),c.emitterId||0===c.emitterId||void 0!==c.j?c.emitterId&&n?b.j=n.getLastMeshById(c.emitterId):b.j=o.k.$j(c.j):b.j=o.k.Zero(),b.isLocal=!!c.isLocal,void 0!==c.renderingGroupId&&(b.renderingGroupId=c.renderingGroupId),void 0!==c.isBillboardBased&&(b.isBillboardBased=c.isBillboardBased),void 0!==c.billboardMode&&(b.billboardMode=c.billboardMode),void 0!==c.useLogarithmicDepth&&(b.useLogarithmicDepth=c.useLogarithmicDepth),c.animations){for(let A=0;A<c.animations.length;A++){const o=c.animations[A],t=(0,s.c)("BABYLON.Animation");t&&b.animations.push(t.Parse(o))}b.beginAnimationOnStart=c.beginAnimationOnStart,b.beginAnimationFrom=c.beginAnimationFrom,b.beginAnimationTo=c.beginAnimationTo,b.beginAnimationLoop=c.beginAnimationLoop}if(c.autoAnimate&&n&&n.beginAnimation(b,c.autoAnimateFrom,c.autoAnimateTo,c.autoAnimateLoop,c.autoAnimateSpeed||1),b.startDelay=0|c.startDelay,b.minAngularSpeed=c.minAngularSpeed,b.maxAngularSpeed=c.maxAngularSpeed,b.minSize=c.minSize,b.maxSize=c.maxSize,c.minScaleX&&(b.minScaleX=c.minScaleX,b.maxScaleX=c.maxScaleX,b.minScaleY=c.minScaleY,b.maxScaleY=c.maxScaleY),void 0!==c.preWarmCycles&&(b.preWarmCycles=c.preWarmCycles,b.preWarmStepOffset=c.preWarmStepOffset),void 0!==c.minInitialRotation&&(b.minInitialRotation=c.minInitialRotation,b.maxInitialRotation=c.maxInitialRotation),b.minLifeTime=c.minLifeTime,b.maxLifeTime=c.maxLifeTime,b.minEmitPower=c.minEmitPower,b.maxEmitPower=c.maxEmitPower,b.emitRate=c.emitRate,b.gravity=o.k.$j(c.gravity),c.noiseStrength&&(b.noiseStrength=o.k.$j(c.noiseStrength)),b.color1=h.h.$j(c.color1),b.color2=h.h.$j(c.color2),b.colorDead=h.h.$j(c.colorDead),b.updateSpeed=c.updateSpeed,b.targetStopDuration=c.targetStopDuration,b.blendMode=c.blendMode,c.colorGradients)for(const o of c.colorGradients)b.addColorGradient(o.gradient,h.h.$j(o.color1),o.color2?h.h.$j(o.color2):void 0);if(c.rampGradients){for(const A of c.rampGradients)b.addRampGradient(A.gradient,h.d.$j(A.color));b.useRampGradients=c.useRampGradients}if(c.colorRemapGradients)for(const o of c.colorRemapGradients)b.addColorRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.alphaRemapGradients)for(const o of c.alphaRemapGradients)b.addAlphaRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.sizeGradients)for(const o of c.sizeGradients)b.addSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.angularSpeedGradients)for(const o of c.angularSpeedGradients)b.addAngularSpeedGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.velocityGradients)for(const o of c.velocityGradients)b.addVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.dragGradients)for(const o of c.dragGradients)b.addDragGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.emitRateGradients)for(const o of c.emitRateGradients)b.addEmitRateGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.startSizeGradients)for(const o of c.startSizeGradients)b.addStartSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.lifeTimeGradients)for(const o of c.lifeTimeGradients)b.addLifeTimeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(c.limitVelocityGradients){for(const A of c.limitVelocityGradients)b.addLimitVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);b.limitVelocityDamping=c.limitVelocityDamping}if(c.noiseTexture&&n){const A=(0,s.c)("BABYLON.ProceduralTexture");b.noiseTexture=A.Parse(c.noiseTexture,n,t)}let C;if(c.particleEmitterType){switch(c.particleEmitterType.type){case"SphereParticleEmitter":C=new j;break;case"SphereDirectedParticleEmitter":C=new F;break;case"ConeEmitter":case"ConeParticleEmitter":C=new R;break;case"ConeDirectedParticleEmitter":C=new N;break;case"CylinderParticleEmitter":C=new k;break;case"CylinderDirectedParticleEmitter":C=new E;break;case"HemisphericParticleEmitter":C=new V;break;case"PointParticleEmitter":C=new y;break;case"MeshParticleEmitter":C=new d;break;case"CustomParticleEmitter":C=new M;break;default:C=new X}C.parse(c.particleEmitterType,n)}else C=new X,C.parse(c,n);b.particleEmitterType=C,b.startSpriteCellID=c.startSpriteCellID,b.endSpriteCellID=c.endSpriteCellID,b.spriteCellLoop=c.spriteCellLoop??!0,b.spriteCellWidth=c.spriteCellWidth,b.spriteCellHeight=c.spriteCellHeight,b.spriteCellChangeSpeed=c.spriteCellChangeSpeed,b.spriteRandomStartCell=c.spriteRandomStartCell,b.disposeOnStop=c.disposeOnStop??!1,b.manualEmitCount=c.manualEmitCount??-1}static Parse(c,b,A){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0;const s=c.name;let L,C,J=null,X=null;if(b instanceof uc.c?L=b:(C=b,L=C.getEngine()),c.customShader&&L.createEffectForParticles){X=c.customShader;const b=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";J=L.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,b)}const R=new sb(s,n||c.xb,b,J,c.isAnimationSheetEnabled);if(R.customShader=X,R._rootUrl=A,c.id&&(R.id=c.id),c.subEmitters){R.subEmitters=[];for(const o of c.subEmitters){const c=[];for(const t of o)c.push(gc.Parse(t,b,A));R.subEmitters.push(c)}}if(c.attractors)for(const h of c.attractors){const c=new hb;c.position=o.k.$j(h.position),c.strength=h.strength,R.addAttractor(c)}return sb._Parse(c,R,b,A),c.textureMask&&(R.textureMask=h.h.$j(c.textureMask)),c.tg&&(R.tg=o.k.$j(c.tg)),c.preventAutoStart&&(R.preventAutoStart=c.preventAutoStart),t||R.preventAutoStart||R.start(),R}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(sb._Serialize(b,this,c),b.textureMask=this.textureMask.hk(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.tg=this.tg.hk(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const A of this._subEmitters){const o=[];for(const b of A)o.push(b.serialize(c));b.subEmitters.push(o)}}if(this._attractors&&this._attractors.length){b.attractors=[];for(const c of this._attractors)b.attractors.push(c.serialize())}return b}static _Serialize(c,b,A){if(c.name=b.name,c.id=b.id,c.xb=b.getCapacity(),c.disposeOnStop=b.disposeOnStop,c.manualEmitCount=b.manualEmitCount,b.j.position){const A=b.j;c.emitterId=A.id}else{const A=b.j;c.j=A.hk()}b.particleEmitterType&&(c.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(A?c.texture=b.particleTexture.serialize():(c.textureName=b.particleTexture.name,c.invertY=!!b.particleTexture._invertY)),c.isLocal=b.isLocal,p.c.AppendSerializedAnimations(b,c),c.beginAnimationOnStart=b.beginAnimationOnStart,c.beginAnimationFrom=b.beginAnimationFrom,c.beginAnimationTo=b.beginAnimationTo,c.beginAnimationLoop=b.beginAnimationLoop,c.startDelay=b.startDelay,c.renderingGroupId=b.renderingGroupId,c.isBillboardBased=b.isBillboardBased,c.billboardMode=b.billboardMode,c.minAngularSpeed=b.minAngularSpeed,c.maxAngularSpeed=b.maxAngularSpeed,c.minSize=b.minSize,c.maxSize=b.maxSize,c.minScaleX=b.minScaleX,c.maxScaleX=b.maxScaleX,c.minScaleY=b.minScaleY,c.maxScaleY=b.maxScaleY,c.minEmitPower=b.minEmitPower,c.maxEmitPower=b.maxEmitPower,c.minLifeTime=b.minLifeTime,c.maxLifeTime=b.maxLifeTime,c.emitRate=b.emitRate,c.gravity=b.gravity.hk(),c.noiseStrength=b.noiseStrength.hk(),c.color1=b.color1.hk(),c.color2=b.color2.hk(),c.colorDead=b.colorDead.hk(),c.updateSpeed=b.updateSpeed,c.targetStopDuration=b.targetStopDuration,c.blendMode=b.blendMode,c.preWarmCycles=b.preWarmCycles,c.preWarmStepOffset=b.preWarmStepOffset,c.minInitialRotation=b.minInitialRotation,c.maxInitialRotation=b.maxInitialRotation,c.startSpriteCellID=b.startSpriteCellID,c.spriteCellLoop=b.spriteCellLoop,c.endSpriteCellID=b.endSpriteCellID,c.spriteCellChangeSpeed=b.spriteCellChangeSpeed,c.spriteCellWidth=b.spriteCellWidth,c.spriteCellHeight=b.spriteCellHeight,c.spriteRandomStartCell=b.spriteRandomStartCell,c.isAnimationSheetEnabled=b.isAnimationSheetEnabled,c.useLogarithmicDepth=b.useLogarithmicDepth;const o=b.getColorGradients();if(o){c.colorGradients=[];for(const b of o){const A={gradient:b.gradient,color1:b.color1.hk()};b.color2?A.color2=b.color2.hk():A.color2=b.color1.hk(),c.colorGradients.push(A)}}const t=b.getRampGradients();if(t){c.rampGradients=[];for(const b of t){const A={gradient:b.gradient,color:b.color.hk()};c.rampGradients.push(A)}c.useRampGradients=b.useRampGradients}const n=b.getColorRemapGradients();if(n){c.colorRemapGradients=[];for(const b of n){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.colorRemapGradients.push(A)}}const h=b.getAlphaRemapGradients();if(h){c.alphaRemapGradients=[];for(const b of h){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.alphaRemapGradients.push(A)}}const s=b.getSizeGradients();if(s){c.sizeGradients=[];for(const b of s){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.sizeGradients.push(A)}}const L=b.getAngularSpeedGradients();if(L){c.angularSpeedGradients=[];for(const b of L){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.angularSpeedGradients.push(A)}}const C=b.getVelocityGradients();if(C){c.velocityGradients=[];for(const b of C){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.velocityGradients.push(A)}}const J=b.getDragGradients();if(J){c.dragGradients=[];for(const b of J){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.dragGradients.push(A)}}const X=b.getEmitRateGradients();if(X){c.emitRateGradients=[];for(const b of X){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.emitRateGradients.push(A)}}const R=b.getStartSizeGradients();if(R){c.startSizeGradients=[];for(const b of R){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.startSizeGradients.push(A)}}const N=b.getLifeTimeGradients();if(N){c.lifeTimeGradients=[];for(const b of N){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.lifeTimeGradients.push(A)}}const k=b.getLimitVelocityGradients();if(k){c.limitVelocityGradients=[];for(const b of k){const A={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?A.factor2=b.factor2:A.factor2=b.factor1,c.limitVelocityGradients.push(A)}c.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(c.noiseTexture=b.noiseTexture.serialize())}clone(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let t=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){t=this.customShader;const c=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"",b=n.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,c);o[0]?o[0].effect=b:this.setCustomEffect(b,0)}const h=this.serialize(A),s=sb.Parse(h,this._scene||this._engine,this._rootUrl);return s.name=c,s.customShader=t,s._customWrappers=o,void 0===b&&(b=this.j),this.noiseTexture&&(s.noiseTexture=this.noiseTexture.clone()),s.j=b,this.preventAutoStart||s.start(),s}}sb.BILLBOARDMODE_Y=2,sb.BILLBOARDMODE_ALL=7,sb.BILLBOARDMODE_STRETCHED=8,sb.BILLBOARDMODE_STRETCHED_LOCAL=9,gc._ParseParticleSystem=sb.Parse;var Lb=A(2189),Cb=A(2186),Jb=A(2102);Jb.d.prototype.createTransformFeedback=function(){const c=this._gl.createTransformFeedback();if(!c)throw new Error("Unable to create Transform Feedback");return c},Jb.d.prototype.deleteTransformFeedback=function(c){this._gl.deleteTransformFeedback(c)},Jb.d.prototype.bindTransformFeedback=function(c){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,c)},Jb.d.prototype.beginTransformFeedback=function(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(c?this._gl.POINTS:this._gl.TRIANGLES)},Jb.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Jb.d.prototype.setTranformFeedbackVaryings=function(c,b){this._gl.transformFeedbackVaryings(c,b,this._gl.INTERLEAVED_ATTRIBS)},Jb.d.prototype.bindTransformFeedbackBuffer=function(c){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,c?c.underlyingResource:null)},Jb.d.prototype.readTransformFeedbackBuffer=function(c){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,c)};const Xb="clipPlaneFragmentDeclaration2",Rb="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";z.e.IncludesShadersStore[Xb]||(z.e.IncludesShadersStore[Xb]=Rb);A(12385),A(12389),A(12392),A(12400),A(12407),A(12414),A(12420),A(12425);const Nb="gpuRenderParticlesPixelShader",kb="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";z.e.ShadersStore[Nb]||(z.e.ShadersStore[Nb]=kb);const Eb="clipPlaneVertexDeclaration2",Vb="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";z.e.IncludesShadersStore[Eb]||(z.e.IncludesShadersStore[Eb]=Vb);A(12431),A(12436),A(12442),A(12450);const yb="gpuRenderParticlesVertexShader",jb="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";z.e.ShadersStore[yb]||(z.e.ShadersStore[yb]=jb);class Fb extends L{static get IsSupported(){if(!w.c.LastCreatedEngine)return!1;const c=w.c.LastCreatedEngine.getCaps();return c.supportTransformFeedbacks||c.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(c){this._maxActiveParticleCount=Math.min(c,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(c){this.maxActiveParticleCount=c}createPointEmitter(c,b){const A=ec(c,b);return this.particleEmitterType=A,A}createHemisphericEmitter(){const c=xc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createSphereEmitter(){const c=Uc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createDirectedSphereEmitter(){const c=wc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0));return this.particleEmitterType=c,c}createCylinderEmitter(){const c=mc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=c,c}createDirectedCylinderEmitter(){const c=cb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.k(0,1,0));return this.particleEmitterType=c,c}createConeEmitter(){const c=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=c,c}createDirectedConeEmitter(){const c=Ab(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.k(0,1,0));return this.particleEmitterType=c,c}createBoxEmitter(c,b,A,o){const t=new X;return this.particleEmitterType=t,this.direction1=c,this.direction2=b,this.minEmitBox=A,this.maxEmitBox=o,t}get flowMap(){return this._flowMap}set flowMap(c){this._flowMap!==c&&(this._flowMap=c)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==sb.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(sb.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(sb.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";c?setTimeout((()=>{this.start(0)}),c):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var c;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(c=this._customWrappers[b])||void 0===c?void 0:c.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[c]??this._customWrappers[0]}setCustomEffect(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new cc.d(this._engine),this._customWrappers[b].effect=c}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new x.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(c,b,A){return super._removeGradientAndTexture(c,b,A),this._releaseBuffers(),this}addColorGradient(c,b){this._colorGradients||(this._colorGradients=[]);const A=new i(c,b);return this._colorGradients.push(A),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(c&&this._colorGradients.sort(((c,b)=>c.gradient<b.gradient?-1:c.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(c){return this._removeGradientAndTexture(c,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var c;null===(c=this._drawWrappers[b].drawContext)||void 0===c||c.reset()}}_addFactorGradient(c,b,A){const o=new u(b,A);c.push(o),this._releaseBuffers()}addSizeGradient(c,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,c,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(c){return this._removeGradientAndTexture(c,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(c,b){if(!c)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&c.sort(((c,b)=>c.gradient<b.gradient?-1:c.gradient>b.gradient?1:0));const A=this;A[b]&&(A[b].dispose(),A[b]=null)}addAngularSpeedGradient(c,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,c,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(c){return this._removeGradientAndTexture(c,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(c,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,c,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(c){return this._removeGradientAndTexture(c,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(c,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,c,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(c){return this._removeGradientAndTexture(c,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(c,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,c,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(c){return this._removeGradientAndTexture(c,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(c){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(c,b,A){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(c),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.fk=new x.b,this.onStoppedObservable=new x.b,this.onStartedObservable=new x.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=o.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||w.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xk.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,s.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,s.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,s.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,s.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new cc.d(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers={0:new cc.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const h={xb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},L=b;isFinite(L)&&(h.xb=L),this._capacity=h.xb,this._maxActiveParticleCount=h.xb,this._currentActiveCount=0,this._isAnimationSheetEnabled=n,this.particleEmitterType=new X;const C=Math.min(this._engine.getCaps().maxTextureSize,h.randomTextureSize);let J=[];for(let o=0;o<C;++o)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());this._randomTexture=new U.d(new Float32Array(J),C,1,5,A,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,J=[];for(let o=0;o<C;++o)J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random());this._randomTexture2=new U.d(new Float32Array(J),C,1,5,A,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=C}_reset(){this._releaseBuffers()}_createVertexBuffers(c,b,A){const o={};o.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let t=3;o.age=b.createVertexBuffer("age",t,1,this._attributesStrideSize,!0),t+=1,o.size=b.createVertexBuffer("size",t,3,this._attributesStrideSize,!0),t+=3,o.life=b.createVertexBuffer("life",t,1,this._attributesStrideSize,!0),t+=1,t+=4,this.billboardMode===sb.BILLBOARDMODE_STRETCHED&&(o.direction=b.createVertexBuffer("direction",t,3,this._attributesStrideSize,!0)),t+=3,this._platform.alignDataInBuffer&&(t+=1),this.particleEmitterType instanceof M&&(t+=3,this._platform.alignDataInBuffer&&(t+=1)),this._colorGradientsTexture||(o.color=b.createVertexBuffer("color",t,4,this._attributesStrideSize,!0),t+=4),this._isBillboardBased||(o.initialDirection=b.createVertexBuffer("initialDirection",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),this.noiseTexture&&(o.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1),o.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),o.angle=b.createVertexBuffer("angle",t,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?t++:t+=2,this._isAnimationSheetEnabled&&(o.cellIndex=b.createVertexBuffer("cellIndex",t,1,this._attributesStrideSize,!0),t+=1,this.spriteRandomStartCell&&(o.cellStartOffset=b.createVertexBuffer("cellStartOffset",t,1,this._attributesStrideSize,!0),t+=1)),o.offset=A.createVertexBuffer("offset",0,2),o.uv=A.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(o),this._platform.createVertexBuffers(c,o),this.resetDrawCache()}_initialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!c)return;const b=this._engine,A=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof M&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const t=this.particleEmitterType instanceof M,n=o.f.ak[0];let h=0;for(let o=0;o<this._capacity;o++)if(A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),t?(this.particleEmitterType.particleDestinationGenerator(o,null,n),A.push(n.x),A.push(n.y),A.push(n.z)):(A.push(0),A.push(0),A.push(0)),this._platform.alignDataInBuffer&&A.push(0),h+=16,t&&(this.particleEmitterType.particlePositionGenerator(o,null,n),A.push(n.x),A.push(n.y),A.push(n.z),this._platform.alignDataInBuffer&&A.push(0),h+=4),this._colorGradientsTexture||(A.push(0),A.push(0),A.push(0),A.push(0),h+=4),this.isBillboardBased||(A.push(0),A.push(0),A.push(0),this._platform.alignDataInBuffer&&A.push(0),h+=4),this.noiseTexture&&(A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),h+=8),A.push(0),h+=1,this._angularSpeedGradientsTexture||(A.push(0),h+=1),this._isAnimationSheetEnabled&&(A.push(0),h+=1,this.spriteRandomStartCell&&(A.push(0),h+=1)),this._platform.alignDataInBuffer){let c=3-(h+3&3);for(h+=c;c-- >0;)A.push(0)}const s=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),L=this._platform.createParticleBuffer(A),C=this._platform.createParticleBuffer(A);this._buffer0=new W.d(b,L,!1,this._attributesStrideSize),this._buffer1=new W.d(b,C,!1,this._attributesStrideSize),this._spriteBuffer=new W.d(b,s,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let c=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(c+="\n#define BILLBOARD"),this._colorGradientsTexture&&(c+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(c+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(c+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(c+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(c+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(c+="\n#define DRAGGRADIENTS"),this._flowMap&&(c+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(c+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(c+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(c+="\n#define NOISE"),this.isLocal&&(c+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===c||(this._cachedUpdateDefines=c,this._updateBuffer=this._platform.createUpdateBuffer(c)),this._platform.isUpdateBufferReady()}_getWrapper(c){const b=this._getCustomDrawWrapper(c);if(null!==b&&void 0!==b&&b.effect)return b;const A=[];this.fillDefines(A,c);let o=this._drawWrappers[c];o||(o=new cc.d(this._engine),o.drawContext&&(o.drawContext.useInstancing=!0),this._drawWrappers[c]=o);const t=A.join("\n");if(o.defines!==t){const c=[],b=[],A=[];this.fillUniformsAttributesAndSamplerNames(b,c,A),o.setEffect(this._engine.createEffect("gpuRenderParticles",c,b,A,t),t)}return o}static _GetAttributeNamesOrOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=[W.f.PositionKind,"age","life","size","angle"];return c||t.push(W.f.ColorKind),b&&t.push("cellIndex"),A||t.push("initialDirection"),o&&t.push("direction"),t.push("offset",W.f.UVKind),t}static _GetEffectCreationOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["emitterWM","tg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bc.e)(o),c&&o.push("sheetInfos"),b&&o.push("logarithmicDepthConstant"),A&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bc.j)(this,this._scene,c),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Cb.d.FOGMODE_NONE&&c.push("#define FOG")),b===sb.BLENDMODE_MULTIPLY&&c.push("#define BLENDMULTIPLYMODE"),this.isLocal&&c.push("#define LOCAL"),this.useLogarithmicDepth&&c.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(c.push("#define BILLBOARD"),this.billboardMode){case sb.BILLBOARDMODE_Y:c.push("#define BILLBOARDY");break;case sb.BILLBOARDMODE_STRETCHED:c.push("#define BILLBOARDSTRETCHED");break;case sb.BILLBOARDMODE_ALL:c.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&c.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&c.push("#define ANIMATESHEET"),A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),c.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(c,b,A){b.push(...Fb._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===sb.BILLBOARDMODE_STRETCHED)),c.push(...Fb._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Lb.e.PrepareUniforms(c,this._imageProcessingConfigurationDefines),Lb.e.PrepareSamplers(A,this._imageProcessingConfigurationDefines))}animate(){var c;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(c=this._scene)||void 0===c?void 0:c.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(c,b){const A=this[b];if(!c||!c.length||A)return;const o=new Float32Array(this._rawTextureWidth);for(let t=0;t<this._rawTextureWidth;t++){const b=t/this._rawTextureWidth;e.GetCurrentGradient(b,c,((c,b,A)=>{o[t]=(0,C.Lerp)(c.factor1,b.factor1,A)}))}this[b]=U.d.CreateRTexture(o,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const c=new Uint8Array(4*this._rawTextureWidth),b=h.j.sk[0];for(let A=0;A<this._rawTextureWidth;A++){const o=A/this._rawTextureWidth;e.GetCurrentGradient(o,this._colorGradients,((o,t,n)=>{h.h.LerpToRef(o.color1,t.color1,n,b),c[4*A]=255*b.r,c[4*A+1]=255*b.g,c[4*A+2]=255*b.b,c[4*A+3]=255*b.a}))}this._colorGradientsTexture=U.d.CreateRGBATexture(c,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(c,b){var A,t,n,h;const s=this._getWrapper(c),L=s.effect;this._engine.enableEffect(s);const C=(null===(A=this._scene)||void 0===A?void 0:A.getViewMatrix())||o.b.IdentityReadOnly;if(L.setMatrix("view",C),L.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),L.setTexture("diffuseSampler",this.particleTexture),L.setVector2("translationPivot",this.translationPivot),L.setVector3("tg",this.tg),this.isLocal&&L.setMatrix("emitterWM",b),this._colorGradientsTexture?L.setTexture("colorGradientSampler",this._colorGradientsTexture):L.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const c=this.particleTexture.getBaseSize();L.setFloat3("sheetInfos",this.spriteCellWidth/c.width,this.spriteCellHeight/c.height,c.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const c=this._scene.activeCamera;L.setVector3("eyePosition",c.globalPosition)}const J=L.defines;if(this._scene&&((0,bc.g)(L,this,this._scene),this.applyFog&&(0,Ac.e)(this._scene,void 0,L)),J.indexOf("#define BILLBOARDMODE_ALL")>=0){const c=C.clone();c.invert(),L.setMatrix("invView",c)}return this.useLogarithmicDepth&&this._scene&&(0,Ac.i)(J,L,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(L),this._setEngineBasedOnBlendMode(c),this._platform.bindDrawBuffers(this._targetIndex,L,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(L),null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(h=this._scene)&&void 0!==h&&h.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(c){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!c)if(this.j.position){c=this.j.getWorldMatrix()}else{const b=this.j;c=o.f.Matrix[0],o.b.TranslationToRef(b.x,b.y,b.z,c)}const b=this._engine,A=b.getDepthWrite();if(b.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const c=this.va();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",c.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",c),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const t=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=t,b.setDepthWrite(A)}render(){let c,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const c=0|this._accumulatedCount;this._accumulatedCount-=c,this._currentActiveCount+=c}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){c=this.j.getWorldMatrix()}else{const b=this.j;c=o.f.Matrix[0],o.b.TranslationToRef(b.x,b.y,b.z,c)}const t=this._engine;this.updateInAnimate||this._update(c);let n=0;return b||A||(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0),n=this.blendMode===sb.BLENDMODE_MULTIPLYADD?this._render(sb.BLENDMODE_MULTIPLY,c)+this._render(sb.BLENDMODE_ADD,c):this._render(this.blendMode,c),this._engine.setAlphaMode(0)),n}rebuild(){const c=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(c,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,c()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const c=this._scene.xk.indexOf(this);c>-1&&this._scene.xk.splice(c,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const c=this._renderVertexBuffers[b];for(const b in c)c[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),c&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),c&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.fk.notifyObservers(this),this.fk.clear()}clone(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let t=null;const n=this._engine;if(n.createEffectForParticles&&null!=this.customShader){t=this.customShader;const c=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";o[0]=n.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,c,void 0,void 0,void 0,this)}const h=this.serialize(A),s=Fb.Parse(h,this._scene||this._engine,this._rootUrl);return s.name=c,s.customShader=t,s._customWrappers=o,void 0===b&&(b=this.j),this.noiseTexture&&(s.noiseTexture=this.noiseTexture.clone()),s.j=b,s}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return sb._Serialize(b,this,c),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const n=c.name;let h,s;b instanceof uc.c?h=b:(s=b,h=s.getEngine());const L=new Fb(n,{xb:t||c.xb,randomTextureSize:c.randomTextureSize},b,null,c.isAnimationSheetEnabled);if(L._rootUrl=A,c.customShader&&h.createEffectForParticles){const b=c.customShader,A=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",o=h.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,A,void 0,void 0,void 0,L);L.setCustomEffect(o,0),L.customShader=b}return c.id&&(L.id=c.id),c.activeParticleCount&&(L.activeParticleCount=c.activeParticleCount),sb._Parse(c,L,b,A),c.preventAutoStart&&(L.preventAutoStart=c.preventAutoStart),o||L.preventAutoStart||L.start(),L}}var Mb=A(525),Wb=A(12457),db=A(11900);class rb{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(c){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.j=c;this._emitterNode=c}setEmitterAsSphere(c,b,A){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:c,renderingGroupId:b};const o=(0,Wb.c)("emitterSphere",{diameter:c.diameter,segments:c.segments},A);o.renderingGroupId=b;const t=new db.d("emitterSphereMaterial",A);t.emissiveColor=c.color,o.material=t;for(const n of this.systems)n.j=o;this._emitterNode=o}start(c){for(const b of this.systems)c&&(b.j=c),b.start()}dispose(){for(const c of this.systems)c.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const A of this.systems)b.systems.push(A.serialize(c));return this._emitterNode&&(b.j=this._emitterCreationOptions),b}static Parse(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;const t=new rb,n=this.BaseAssetsUrl+"/textures/";b=b||w.c.LastCreatedScene;for(const h of c.systems)t.systems.push(A?Fb.Parse(h,b,n,!0,o):sb.Parse(h,b,n,!0,o));if(c.j){const A=c.j.options;if("Sphere"===c.j.kind)t.setEmitterAsSphere({diameter:A.diameter,segments:A.segments,color:h.d.$j(A.color)},c.j.renderingGroupId,b)}return t}}rb.BaseAssetsUrl="https://assets.babylonjs.com/particles";var zb=A(545);class Yb{static CreateDefault(c){let b,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,o=arguments.length>2?arguments[2]:void 0;b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Fb("default system",{xb:A},o):new sb("default system",A,o),b.j=c;const t=Mb.d.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return b.particleTexture=new q.d(t,b.va()),b.createConeEmitter(.1,Math.PI/4),b.color1=new h.h(1,1,1,1),b.color2=new h.h(1,1,1,1),b.colorDead=new h.h(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;b||(b=w.c.LastCreatedScene);const t={};return b.addPendingData(t),new Promise(((n,h)=>{if(A&&!Fb.IsSupported)return b.removePendingData(t),h("Particle system with GPU is not supported.");Mb.d.LoadFile(`${Yb.BaseAssetsUrl}/systems/${c}.json`,(c=>{b.removePendingData(t);const h=JSON.parse(c.toString());return n(rb.Parse(h,b,A,o))}),void 0,void 0,void 0,(()=>(b.removePendingData(t),h(`An error occurred with the creation of your particle system. Check if your type '${c}' exists.`))))}))}static ExportSet(c){const b=new rb;for(const A of c)b.systems.push(A);return b}static ParseFromFileAsync(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5?arguments[5]:void 0;return new Promise(((h,s)=>{const L=new zb.c;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const b=JSON.parse(L.responseText);let s;s=o?Fb.Parse(b,A,t,!1,n):sb.Parse(b,A,t,!1,n),c&&(s.name=c),h(s)}else s("Unable to load the particle system")})),L.open("GET",b),L.send()}))}static ParseFromSnippetAsync(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0;if("_BLANK"===c){const c=this.CreateDefault(null);return c.start(),Promise.resolve(c)}return new Promise(((n,h)=>{const s=new zb.c;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const h=JSON.parse(JSON.parse(s.responseText).jsonPayload),L=JSON.parse(h.particleSystem);let C;C=A?Fb.Parse(L,b,o,!1,t):sb.Parse(L,b,o,!1,t),C.snippetId=c,n(C)}else h("Unable to load the snippet "+c)})),s.open("GET",this.SnippetUrl+"/"+c.replace(/#/g,"/")),s.send()}))}}Yb.BaseAssetsUrl=rb.BaseAssetsUrl,Yb.SnippetUrl="https://snippet.babylonjs.com",Yb.CreateFromSnippetAsync=Yb.ParseFromSnippetAsync;var Db=A(510),fb=A(877),vb=A(12461);(0,vb.h)(fb.e.NAME_PARTICLESYSTEM,((c,b,A,o)=>{const t=(0,vb.l)(fb.e.NAME_PARTICLESYSTEM);if(t&&void 0!==c.xk&&null!==c.xk)for(let n=0,h=c.xk.length;n<h;n++){const h=c.xk[n];A.xk.push(t(h,b,o))}})),(0,vb.d)(fb.e.NAME_PARTICLESYSTEM,((c,b,A)=>{if(c.activeParticleCount){return Fb.Parse(c,b,A)}return sb.Parse(c,b,A)})),uc.c.prototype.createEffectForParticles=function(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,L=arguments.length>7?arguments[7]:void 0,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,J=arguments.length>9?arguments[9]:void 0,X=[],R=[];const N=[];return L?L.fillUniformsAttributesAndSamplerNames(R,X,N):(X=sb._GetAttributeNamesOrOptions(),R=sb._GetEffectCreationOptions()),-1===t.indexOf(" BILLBOARD")&&(t+="\n#define BILLBOARD\n"),null!==L&&void 0!==L&&L.isAnimationSheetEnabled&&-1===t.indexOf(" ANIMATESHEET")&&(t+="\n#define ANIMATESHEET\n"),-1===o.indexOf("diffuseSampler")&&o.push("diffuseSampler"),this.createEffect({vertex:J??(null===L||void 0===L?void 0:L.vertexShaderName)??"particles",fragmentElement:c},X,R.concat(b),N.concat(o),t,n,h,s,void 0,C,(async()=>{0===C?await Promise.resolve().then(A.bind(A,12489)):await Promise.resolve().then(A.bind(A,12540))}))},Db.d.prototype.getEmittedParticleSystems=function(){const c=[];for(let b=0;b<this.va().xk.length;b++){const A=this.va().xk[b];A.j===this&&c.push(A)}return c},Db.d.prototype.getHierarchyEmittedParticleSystems=function(){const c=[],b=this.getDescendants();b.push(this);for(let A=0;A<this.va().xk.length;A++){const o=this.va().xk[A],t=o.j;t.position&&-1!==b.indexOf(t)&&c.push(o)}return c};A(773),A(788),A(821);A(760),A(886),A(843),A(762),A(875);A(2037);var Gb;A(12465),A(2073);!function(c){c[c.Color=2]="Color",c[c.UV=1]="UV",c[c.Random=0]="Random",c[c.Stated=3]="Stated"}(Gb||(Gb={}));var Pb=A(2064);const Ob=new o.k(0,0,0),pb=new o.k(0,0,0),qb=new o.k(0,0,0);class Ib{constructor(c,b,A){this.width=c,this.height=b,this.data=A}processFlowable(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;if(!A)return;A instanceof o.b?o.k.TransformCoordinatesToRef(c.position,A,qb):(qb.x=A.x,qb.y=A.y,qb.z=A.z);const t=.5*qb.x+.5,n=1-(.5*qb.y+.5),h=Math.floor(t*this.width),s=Math.floor(n*this.height);if(h<0||h>=this.width||s<0||s>=this.height)return;const L=4*(s*this.width+h),C=this.data[L]/255*2-1,J=this.data[L+1]/255*2-1,X=this.data[L+2]/255*2-1,R=this.data[L+3]/255;Ob.set(C,J,X),Ob.scaleToRef(b*R,pb),c.direction.addInPlace(pb)}_processParticle(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;this.processFlowable(c,b,A)}static async FromUrlAsync(c){return await new Promise(((b,A)=>{const o=document.createElement("canvas"),t=o.getContext("2d");let n=null;const h=new Image;h.crossOrigin="anonymous",h.src=c,h.onerror=b=>{A(new Error(`Failed to load image: ${c} : ${b}`))},h.onload=()=>{o.width=h.width,o.height=h.height,t.drawImage(h,0,0),n=t.getImageData(0,0,o.width,o.height),b(new Ib(o.width,o.height,n.data))}}))}static async ExtractFromTextureAsync(c){return await new Promise(((b,A)=>{if(!c.isReady())return void c.onLoadObservable.addOnce((async()=>{try{const A=await this.ExtractFromTextureAsync(c);b(A)}catch(o){A(o)}}));const o=c.getSize();Pb.i.GetTextureDataAsync(c,o.width,o.height).then((c=>{b(new Ib(o.width,o.height,new Uint8ClampedArray(c)))})).catch(A)}))}}var Kb,Zb,Hb,Sb,Bb,Qb,ab,lb,Tb;!function(c){c[c.Int=1]="Int",c[c.Float=2]="Float",c[c.Vector2=4]="Vector2",c[c.ak=8]="ak",c[c.Matrix=16]="Matrix",c[c.Particle=32]="Particle",c[c.Texture=64]="Texture",c[c.sk=128]="sk",c[c.FloatGradient=256]="FloatGradient",c[c.Vector2Gradient=512]="Vector2Gradient",c[c.Vector3Gradient=1024]="Vector3Gradient",c[c.Color4Gradient=2048]="Color4Gradient",c[c.System=4096]="System",c[c.AutoDetect=8192]="AutoDetect",c[c.BasedOnInput=16384]="BasedOnInput",c[c.Undefined=32768]="Undefined",c[c.All=65535]="All"}(Kb||(Kb={})),function(c){c[c.Compatible=0]="Compatible",c[c.TypeIncompatible=1]="TypeIncompatible",c[c.HierarchyIssue=2]="HierarchyIssue"}(Zb||(Zb={})),function(c){c[c.Input=0]="Input",c[c.Output=1]="Output"}(Hb||(Hb={}));class ib{get direction(){return this._direction}get type(){if(this._type===Kb.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Kb.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(c){this._type=c}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((c=>c.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(c,b,A){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Kb.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new x.b,this.onDisconnectionObservable=new x.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=b,this.name=c,this._direction=A}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(c){var b;return this.isConnected?null!==(b=this._connectedPoint)&&void 0!==b&&b._storedFunction?this._connectedPoint._storedFunction(c):this._connectedPoint._storedValue:this.value}canConnectTo(c){return 0===this.checkCompatibilityState(c)}checkCompatibilityState(c){const b=this._ownerBlock,A=c.ownerBlock;if(this.type!==c.type&&c.innerType!==Kb.AutoDetect)return c.acceptedConnectionPointTypes&&-1!==c.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(c.excludedConnectionPointTypes&&-1!==c.excludedConnectionPointTypes.indexOf(this.type))return 1;let o=A,t=b;return 0===this.direction&&(o=b,t=A),o.isAnAncestorOf(t)?2:0}connectTo(c){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(c))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${c.ownerBlock.name}".${c.name}`;return this._endpoints.push(c),c._connectedPoint=this,this.onConnectionObservable.notifyObservers(c),c.onConnectionObservable.notifyObservers(this),this}disconnectFrom(c){const b=this._endpoints.indexOf(c);return-1===b||(this._endpoints.splice(b,1),c._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(c),c.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(c){let b=1;for(;b<Kb.All;)c&b||this.excludedConnectionPointTypes.push(b),b<<=1}serialize(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b={};return b.name=this.name,b.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.hk?(b.valueType="BABYLON."+this.value.getClassName(),b.value=this.value.hk()):(b.valueType="number",b.value=this.value)),c&&this.connectedPoint&&(b.inputName=this.name,b.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,b.targetConnectionName=this.connectedPoint.name,b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),b}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class gb{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(c){this._name=c}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(c){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new x.b,this.fk=new x.b,this.onInputChangedObservable=new x.b,this.visibleOnFrame=!1,this._name=c,this.uniqueId=I.d.UniqueId}_inputRename(c){return c}_outputRename(c){return c}isAnAncestorOf(c){for(const b of this._outputs)if(b.hasEndpoints)for(const A of b.endpoints){if(A.ownerBlock===c)return!0;if(A.ownerBlock.isAnAncestorOf(c))return!0}return!1}isAnAncestorOfType(c){if(this.getClassName()===c)return!0;for(const b of this._outputs)if(b.hasEndpoints)for(const A of b.endpoints)if(A.ownerBlock.isAnAncestorOfType(c))return!0;return!1}getInputByName(c){const b=this._inputs.filter((b=>b.name===c));return b.length?b[0]:null}_linkConnectionTypes(c,b){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[b]._acceptedConnectionPointType=this._inputs[c]:(this._inputs[c]._linkedConnectionSource=this._inputs[b],this._inputs[c]._isMainLinkSource=!0),this._inputs[b]._linkedConnectionSource=this._inputs[c]}registerInput(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;const h=new ib(c,this,0);return h.type=b,h.isOptional=A,h.defaultValue=o,h.value=o,h.valueMin=t,h.valueMax=n,this._inputs.push(h),this.onInputChangedObservable.notifyObservers(h),this}registerOutput(c,b,A){return(A=A??new ib(c,this,1)).type=b,this._outputs.push(A),this}_build(c){}_customBuildStep(c){}build(c){if(this._buildId===c.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((c=>c.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=c.buildId;for(const b of this._inputs){if(!b.connectedPoint){b.isOptional||c.notConnectedNonOptionalInputs.push(b);continue}const A=b.connectedPoint.ownerBlock;A&&A!==this&&!A.isSystem&&A.build(c)}return this._customBuildStep(c),c.verbose&&K.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(c),this.onBuildObservable.notifyObservers(this),!1}serialize(){const c={};c.customType="BABYLON."+this.getClassName(),c.id=this.uniqueId,c.name=this.name,c.visibleOnFrame=this.visibleOnFrame,c.inputs=[],c.outputs=[];for(const b of this.inputs)c.inputs.push(b.serialize());for(const b of this.outputs)c.outputs.push(b.serialize(!1));return c}_deserialize(c){this._name=c.name,this.comments=c.comments,this.visibleOnFrame=!!c.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(c)}_deserializePortDisplayNamesAndExposedOnFrame(c){const b=c.inputs,A=c.outputs;if(b)for(const o of b){const c=this.inputs.find((c=>c.name===o.name));if(!c)return;if(o.displayName&&(c.displayName=o.displayName),o.isExposedOnFrame&&(c.isExposedOnFrame=o.isExposedOnFrame,c.exposedPortPosition=o.exposedPortPosition),void 0!==o.value&&null!==o.value)if("number"===o.valueType)c.value=o.value;else{const b=(0,s.c)(o.valueType);b&&(c.value=b.$j(o.value))}}if(A)for(let o=0;o<A.length;o++){const c=A[o];c.displayName&&(this.outputs[o].displayName=c.displayName),c.isExposedOnFrame&&(this.outputs[o].isExposedOnFrame=c.isExposedOnFrame,this.outputs[o].exposedPortPosition=c.exposedPortPosition)}}clone(){const c=this.serialize(),b=(0,s.c)(c.customType);if(b){const A=new b;return A._deserialize(c),A}return null}dispose(){this.fk.notifyObservers(this),this.fk.clear();for(const c of this.inputs)c.dispose();for(const c of this.outputs)c.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ub(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",o=arguments.length>3?arguments[3]:void 0;return(t,n)=>{let h=t._propStore;h||(h=[],t._propStore=h),h.push({propertyName:n,displayName:c,type:b,groupName:A,options:o??{},className:t.getClassName()})}}(0,P.e)([(0,O.J)("comment")],gb.prototype,"comments",void 0),function(c){c[c.Boolean=0]="Boolean",c[c.Float=1]="Float",c[c.Int=2]="Int",c[c.Vector2=3]="Vector2",c[c.List=4]="List",c[c.sk=5]="sk",c[c.SamplingMode=6]="SamplingMode",c[c.TextureFormat=7]="TextureFormat",c[c.TextureType=8]="TextureType"}(Sb||(Sb={})),function(c){c[c.None=0]="None",c[c.Position=1]="Position",c[c.Direction=2]="Direction",c[c.Age=3]="Age",c[c.Lifetime=4]="Lifetime",c[c.Color=5]="Color",c[c.ScaledDirection=6]="ScaledDirection",c[c.Scale=7]="Scale",c[c.AgeGradient=8]="AgeGradient",c[c.Angle=9]="Angle",c[c.SpriteCellIndex=16]="SpriteCellIndex",c[c.SpriteCellStart=17]="SpriteCellStart",c[c.SpriteCellEnd=18]="SpriteCellEnd"}(Bb||(Bb={})),function(c){c[c.None=0]="None",c[c.Time=1]="Time",c[c.Delta=2]="Delta",c[c.Emitter=3]="Emitter"}(Qb||(Qb={}));class eb{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let c="";for(const b of this.notConnectedNonOptionalInputs)c+=`input ${b.name} from block ${b.ownerBlock.name}[${b.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(c)throw"Build of Node Particle System Set failed:\n"+c}adapt(c,b){const A=c.getConnectedValue(this)||0;if(c.type===b)return A;switch(b){case Kb.Vector2:return new o.h(A,A);case Kb.ak:return new o.k(A,A,A);case Kb.sk:return new h.h(A,A,A,A)}return null}getContextualValue(c){if(!this.particleContext||!this.systemContext)return null;switch(c){case Bb.Position:return this.particleContext.position;case Bb.Direction:return this.particleContext.direction;case Bb.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Bb.Color:return this.particleContext.color;case Bb.Age:return this.particleContext.age;case Bb.Lifetime:return this.particleContext.lifeTime;case Bb.Angle:return this.particleContext.angle;case Bb.Scale:return this.particleContext.scale;case Bb.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Bb.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Bb.SpriteCellIndex:return this.particleContext.cellIndex;case Bb.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(c){if(!this.particleContext||!this.systemContext)return null;switch(c){case Qb.Time:return this.systemContext._actualFrame;case Qb.Delta:return this.systemContext._scaledUpdateSpeed;case Qb.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function xb(c,b,A){const o=new eb;o.yd=b;const t=c.createSystem(o);return t.canStart=()=>!0,t.j=A.clone(),t.disposeOnStop=!0,t.start(),t}class Ub extends gb{constructor(c){super(c),this.blendMode=L.BLENDMODE_ONEONE,this.xb=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Kb.Particle),this.registerInput("texture",Kb.Texture),this.registerInput("onStart",Kb.System,!0),this.registerInput("onEnd",Kb.System,!0),this.registerOutput("system",Kb.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(c){c.xb=this.xb,c.buildId=this._buildId++,this.build(c);const b=this.particle.getConnectedValue(c);return b.particleTexture=this.texture.getConnectedValue(c),b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.name=this.name,b._nodeGenerated=!0,b._targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,this.system._storedValue=this,b.canStart=()=>!this.doNoStart,b.onStartedObservable.add((A=>{const o=this.onStart.getConnectedValue(c);o&&A.onStartedObservable.addOnce((()=>{c.systemContext=b;const A=xb(o,c.yd,c.emitterPosition);this.fk.addOnce((()=>{A.dispose()}))}));const t=this.onEnd.getConnectedValue(c);t&&A.onStoppedObservable.addOnce((()=>{c.systemContext=b;const A=xb(t,c.yd,c.emitterPosition);this.fk.addOnce((()=>{A.dispose()}))}))})),this.fk.addOnce((()=>{b.dispose()})),b}serialize(){const c=super.serialize();return c.xb=this.xb,c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.doNoStart=this.doNoStart,c.targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,c}_deserialize(c){super._deserialize(c),this.xb=c.xb,this.emitRate=c.emitRate,this.doNoStart=!!c.doNoStart,void 0!==c.blendMode&&(this.blendMode=c.blendMode),void 0!==c.targetStopDuration&&(this.targetStopDuration=c.targetStopDuration),void 0!==c.startDelay&&(this.startDelay=c.startDelay)}}(0,P.e)([ub("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:L.BLENDMODE_ONEONE},{label:"Standard",value:L.BLENDMODE_STANDARD},{label:"Add",value:L.BLENDMODE_ADD},{label:"Multiply",value:L.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:L.BLENDMODE_MULTIPLYADD}]})],Ub.prototype,"blendMode",void 0),(0,P.e)([ub("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Ub.prototype,"xb",void 0),(0,P.e)([ub("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ub.prototype,"emitRate",void 0),(0,P.e)([ub("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ub.prototype,"targetStopDuration",void 0),(0,P.e)([ub("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ub.prototype,"startDelay",void 0),(0,P.e)([ub("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ub.prototype,"doNoStart",void 0),(0,s.d)("BABYLON.SystemBlock",Ub);class wb extends gb{get type(){if(this._type===Kb.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Kb.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Kb.Vector2,this._type;case"ak":return this._type=Kb.ak,this._type;case"sk":return this._type=Kb.sk,this._type;case"Matrix":return this._type=Kb.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Bb.None&&this._systemSource!==Qb.None}get systemSource(){return this._systemSource}set systemSource(c){if(this._systemSource=c,c!==Qb.None){switch(this._contextualSource=Bb.None,this._type=Kb.Float,c){case Qb.Time:case Qb.Delta:this._type=Kb.Float;break;case Qb.Emitter:this._type=Kb.ak}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Bb.None}get contextualValue(){return this._contextualSource}set contextualValue(c){if(this._contextualSource=c,c!==Bb.None){switch(this._systemSource=Qb.None,c){case Bb.Scale:this._type=Kb.Vector2;break;case Bb.Position:case Bb.Direction:case Bb.ScaledDirection:this._type=Kb.ak;break;case Bb.Color:this._type=Kb.sk;break;case Bb.Age:case Bb.Lifetime:case Bb.Angle:case Bb.AgeGradient:this._type=Kb.Float;break;case Bb.SpriteCellEnd:case Bb.SpriteCellStart:case Bb.SpriteCellIndex:this._type=Kb.Int}this.output&&(this.output.type=this._type)}}constructor(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kb.AutoDetect;super(c),this._type=Kb.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new x.b,this._systemSource=Qb.None,this._contextualSource=Bb.None,this._type=b,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",b)}get value(){return this._storedValue}set value(c){this.type===Kb.Float&&this.min!==this.max&&(c=Math.max(this.min,c),c=Math.min(this.max,c)),this._storedValue=c,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(c){this._valueCallback=c}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Kb.Int:case Kb.Float:this.value=0;break;case Kb.Vector2:this.value=o.h.Zero();break;case Kb.ak:this.value=o.k.Zero();break;case Kb.sk:this.value=new h.h(1,1,1,1);break;case Kb.Matrix:this.value=o.b.Identity()}}_build(c){super._build(c),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=c=>c.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=c=>c.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const c=super.serialize();return c.type=this.type,c.contextualValue=this.contextualValue,c.systemSource=this.systemSource,c.min=this.min,c.max=this.max,c.groupInInspector=this.groupInInspector,c.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.hk?(c.valueType="BABYLON."+this._storedValue.getClassName(),c.value=this._storedValue.hk()):(c.valueType="number",c.value=this._storedValue)),c}_deserialize(c){if(super._deserialize(c),this._type=c.type,this.contextualValue=c.contextualValue,this.systemSource=c.systemSource||Qb.None,this.min=c.min||0,this.max=c.max||0,this.groupInInspector=c.groupInInspector||"",void 0!==c.displayInInspector&&(this.displayInInspector=c.displayInInspector),c.valueType)if("number"===c.valueType)this._storedValue=c.value;else{const b=(0,s.c)(c.valueType);b&&(this._storedValue=b.$j(c.value))}}}(0,s.d)("BABYLON.ParticleInputBlock",wb);class mb extends gb{get url(){return this._url}set url(c){this._url!==c&&(this._cachedData=null,this._url=c,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(c){this._textureDataUrl!==c&&(this._cachedData=null,this._textureDataUrl=c,this._url="",this._sourceTexture=null)}set sourceTexture(c){this._sourceTexture!==c&&(this._cachedData=null,this._sourceTexture=c,this._url="",this._textureDataUrl="")}constructor(c){super(c),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Kb.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const c=this.texture._storedValue;return await new Promise(((b,A)=>{if(!c.isReady())return void c.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),b(this._cachedData)}catch(c){A(c)}}));const o=c.getSize();Pb.i.GetTextureDataAsync(c,o.width,o.height).then((A=>{this._cachedData={width:o.width,height:o.height,data:new Uint8ClampedArray(A)},c.dispose(),b(this._cachedData)})).catch(A)}))}_build(c){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new q.d(this._textureDataUrl,c.yd):this.texture._storedValue=new q.d(this._url,c.yd):this.texture._storedValue=null}serialize(){const c=super.serialize();return c.url=this.url,c.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(c.textureDataUrl=this.textureDataUrl),c}_deserialize(c){super._deserialize(c),this.url=c.url,this.serializedCachedData=!!c.serializedCachedData,c.textureDataUrl&&(this.textureDataUrl=c.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,s.d)("BABYLON.ParticleTextureSourceBlock",mb);class cA extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("position",Kb.ak),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(c){const b=this.particle.getConnectedValue(c);if(this.output._storedValue=b,!this.position.isConnected)return;const A={process:A=>{c.particleContext=A,c.systemContext=b,A.position.p(this.position.getConnectedValue(c))},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A}}(0,s.d)("BABYLON.UpdatePositionBlock",cA),function(c){c[c.Add=0]="Add",c[c.Subtract=1]="Subtract",c[c.Multiply=2]="Multiply",c[c.Divide=3]="Divide",c[c.Max=4]="Max",c[c.Min=5]="Min"}(ab||(ab={}));class bA extends gb{constructor(c){super(c),this.operation=ab.Add,this.registerInput("left",Kb.AutoDetect),this.registerInput("right",Kb.AutoDetect),this.registerOutput("output",Kb.BasedOnInput),this.output._typeConnectionSource=this.left;const b=[Kb.Matrix,Kb.Particle,Kb.Texture,Kb.System,Kb.FloatGradient,Kb.Color4Gradient,Kb.Vector2Gradient,Kb.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...b),this.right.excludedConnectionPointTypes.push(...b),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(c){let b;const A=this.left,t=this.right;if(!A.isConnected||!t.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const n=A.type===Kb.Float||A.type===Kb.Int,s=t.type===Kb.Float||t.type===Kb.Int,L=n&&s;switch(this.operation){case ab.Add:b=L?c=>A.getConnectedValue(c)+t.getConnectedValue(c):n?c=>c.adapt(A,t.type).add(t.getConnectedValue(c)):c=>A.getConnectedValue(c).add(c.adapt(t,A.type));break;case ab.Subtract:b=L?c=>A.getConnectedValue(c)-t.getConnectedValue(c):n?c=>c.adapt(A,t.type).Xd(t.getConnectedValue(c)):c=>A.getConnectedValue(c).Xd(c.adapt(t,A.type));break;case ab.Multiply:b=L?c=>A.getConnectedValue(c)*t.getConnectedValue(c):n?c=>c.adapt(A,t.type).multiply(t.getConnectedValue(c)):c=>A.getConnectedValue(c).multiply(c.adapt(t,A.type));break;case ab.Divide:b=L?c=>A.getConnectedValue(c)/t.getConnectedValue(c):n?c=>c.adapt(A,t.type).divide(t.getConnectedValue(c)):c=>A.getConnectedValue(c).divide(c.adapt(t,A.type));break;case ab.Min:if(L)b=c=>Math.min(A.getConnectedValue(c),t.getConnectedValue(c));else{const[c,s]=n?[t,A]:[A,t];switch(c.type){case Kb.Vector2:b=b=>o.h.Minimize(c.getConnectedValue(b),b.adapt(s,c.type));break;case Kb.ak:b=b=>o.k.Minimize(c.getConnectedValue(b),b.adapt(s,c.type));break;case Kb.sk:b=b=>{const A=c.getConnectedValue(b),{r:o,g:t,b:n,a:L}=b.adapt(s,c.type);return new h.h(Math.min(A.r,o),Math.min(A.g,t),Math.min(A.b,n),Math.min(A.a,L))}}}break;case ab.Max:if(!L){const[c,s]=n?[t,A]:[A,t];switch(c.type){case Kb.Vector2:b=b=>o.h.Maximize(c.getConnectedValue(b),b.adapt(s,c.type));break;case Kb.ak:b=b=>o.k.Maximize(c.getConnectedValue(b),b.adapt(s,c.type));break;case Kb.sk:b=b=>{const A=c.getConnectedValue(b),{r:o,g:t,b:n,a:L}=b.adapt(s,c.type);return new h.h(Math.max(A.r,o),Math.min(A.g,t),Math.min(A.b,n),Math.min(A.a,L))}}break}b=c=>Math.max(A.getConnectedValue(c),t.getConnectedValue(c))}this.output._storedFunction=c=>A.type===Kb.Int?0|b(c):b(c)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Kb.Int||this.left.type===Kb.Float&&this.right.type!==Kb.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[c,b]of[[this.left,this.right],[this.right,this.left]])c.acceptedConnectionPointTypes=[Kb.Int,Kb.Float],b.isConnected&&(c.acceptedConnectionPointTypes.push(b.type),b.type!==Kb.Int&&b.type!==Kb.Float||c.acceptedConnectionPointTypes.push(Kb.Vector2,Kb.ak,Kb.sk))}dispose(){super.dispose();for(const c of this._connectionObservers)c.remove();this._connectionObservers.length=0}serialize(){const c=super.serialize();return c.operation=this.operation,c}_deserialize(c){super._deserialize(c),this.operation=c.operation}}(0,P.e)([ub("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ab.Add},{label:"Subtract",value:ab.Subtract},{label:"Multiply",value:ab.Multiply},{label:"Divide",value:ab.Divide},{label:"Max",value:ab.Max},{label:"Min",value:ab.Min}]})],bA.prototype,"operation",void 0),(0,s.d)("BABYLON.ParticleMathBlock",bA);class AA extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("direction1",Kb.ak,!0,new o.k(0,1,0)),this.registerInput("direction2",Kb.ak,!0,new o.k(0,1,0)),this.registerInput("minEmitBox",Kb.ak,!0,new o.k(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Kb.ak,!0,new o.k(.5,.5,.5)),this.registerOutput("output",Kb.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(c){const b=this.particle.getConnectedValue(c);b._directionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.direction1.getConnectedValue(c),n=this.direction2.getConnectedValue(c),h=(0,C.RandomRange)(t.x,n.x),s=(0,C.RandomRange)(t.y,n.y),L=(0,C.RandomRange)(t.z,n.z);c.isEmitterTransformNode?o.k.TransformNormalFromFloatsToRef(h,s,L,c.emitterWorldMatrix,A.direction):A.direction.jd(h,s,L)},b._positionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.minEmitBox.getConnectedValue(c),n=this.maxEmitBox.getConnectedValue(c),h=(0,C.RandomRange)(t.x,n.x),s=(0,C.RandomRange)(t.y,n.y),L=(0,C.RandomRange)(t.z,n.z);c.isEmitterTransformNode?o.k.TransformCoordinatesFromFloatsToRef(h,s,L,c.emitterWorldMatrix,A.position):(A.position.jd(h,s,L),A.position.addInPlace(c.emitterPosition))},this.output._storedValue=b}}(0,s.d)("BABYLON.BoxShapeBlock",AA);class oA extends gb{constructor(c){super(c),this.registerInput("emitPower",Kb.Float,!0,1),this.registerInput("lifeTime",Kb.Float,!0,1),this.registerInput("color",Kb.sk,!0,new h.h(1,1,1,1)),this.registerInput("scale",Kb.Vector2,!0,new o.h(1,1)),this.registerInput("angle",Kb.Float,!0,0),this.registerOutput("particle",Kb.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(c){const b=new sb(this.name,c.xb,c.yd,null,!1,void 0,!0);b.particleEmitterType=new y,b._lifeTimeCreation.process=(b,A)=>{c.particleContext=b,b.lifeTime=this.lifeTime.getConnectedValue(c),A._emitPower=this.emitPower.getConnectedValue(c)},b._colorCreation.process=b=>{c.particleContext=b,b.color.p(this.color.getConnectedValue(c))},b._sizeCreation.process=b=>{c.particleContext=b,b.size=1,b.scale.p(this.scale.getConnectedValue(c))},b._angleCreation.process=b=>{c.particleContext=b,b.angle=this.angle.getConnectedValue(c)},this.particle._storedValue=b}}(0,s.d)("BABYLON.CreateParticleBlock",oA);class tA{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const c=[];for(const b of this.attachedBlocks)b.isInput&&c.push(b);return c}constructor(c){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new x.b,this.name=c}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(c){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(c)&&this.attachedBlocks.push(c);for(const A of c.inputs){const o=A.connectedPoint;if(o){const A=o.ownerBlock;A!==c&&this._initializeBlock(A,b)}}}async buildAsync(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((A=>{const o=new rb;for(const c of this._systemBlocks)this._initializeBlock(c);for(const t of this.systemBlocks){const A=new eb;A.buildId=this._buildId++,A.yd=c,A.verbose=b;const n=t.createSystem(A);A.emitErrors(),o.systems.push(n)}this.onBuildObservable.notifyObservers(this),A(o)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const c=new Ub("Particle system"),b=new cA("Update position");b.output.connectTo(c.particle);const A=new wb("Position");A.contextualValue=Bb.Position;const o=new wb("Scaled direction");o.contextualValue=Bb.ScaledDirection;const t=new bA("Add");t.operation=ab.Add,A.output.connectTo(t.left),o.output.connectTo(t.right),t.output.connectTo(b.position);const n=new oA("Create particle"),h=new AA("Box shape");n.particle.connectTo(h.particle),h.output.connectTo(b.particle);const s=new mb("Texture");s.texture.connectTo(c.texture),s.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(c)}removeBlock(c){const b=this.attachedBlocks.indexOf(c);if(b>-1&&this.attachedBlocks.splice(b,1),c.isSystem){const b=this._systemBlocks.indexOf(c);b>-1&&this._systemBlocks.splice(b,1)}}parseSerializedObject(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b||this.clear();const A={};for(const o of c.Qk){const c=(0,s.c)(o.customType);if(c){const b=new c;b._deserialize(o),A[o.id]=b,this.attachedBlocks.push(b),b.isSystem&&this._systemBlocks.push(b)}}for(const o of this.attachedBlocks)if(o.isTeleportOut){const c=o,b=c._tempEntryPointUniqueId;if(b){const o=A[b];o&&o.attachToEndpoint(c)}}for(let o=0;o<c.Qk.length;o++){const t=c.Qk[o],n=A[t.id];n&&(n.inputs.length&&t.inputs.some((c=>c.targetConnectionName))&&!b||this._restoreConnections(n,c,A))}if(c.locations||c.editorData&&c.editorData.locations){const o=c.locations||c.editorData.locations;for(const c of o)A[c.blockId]&&(c.blockId=A[c.blockId].uniqueId);b&&this.editorData&&this.editorData.locations&&o.concat(this.editorData.locations),c.locations?this.editorData={locations:o}:(this.editorData=c.editorData,this.editorData.locations=o);const t=[];for(const c in A)t[c]=A[c].uniqueId;this.editorData.map=t}this.comment=c.comment}_restoreConnections(c,b,A){for(const o of c.outputs)for(const t of b.Qk){const n=A[t.id];if(n)for(const h of t.inputs)if(A[h.targetBlockId]!==c||h.targetConnectionName!==o.name);else{const c=n.getInputByName(h.inputName);if(!c||c.isConnected)continue;o.connectTo(c,!0),this._restoreConnections(n,b,A)}}}serialize(c){const b=c?{}:p.c.Serialize(this);b.editorData=JSON.parse(JSON.stringify(this.editorData));let A=[];c?A=c:b.customType="BABYLON.NodeParticleSystemSet",b.Qk=[];for(const o of A)b.Qk.push(o.serialize());if(!c)for(const o of this.attachedBlocks)-1===A.indexOf(o)&&b.Qk.push(o.serialize());return b}dispose(){for(const c of this.attachedBlocks)c.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(c){const b=new tA(c);return b.setToDefault(),b}static Parse(c){const b=p.c.Parse((()=>new tA(c.name)),c,null);return b.parseSerializedObject(c),b}static ParseFromSnippetAsync(c,b){return"_BLANK"===c?Promise.resolve(tA.CreateDefault("blank")):new Promise(((A,o)=>{const t=new zb.c;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const h=JSON.parse(JSON.parse(t.responseText).jsonPayload),s=JSON.parse(h.nodeParticle);b||(b=p.c.Parse((()=>new tA(c)),s,null)),b.parseSerializedObject(s),b.snippetId=c;try{A(b)}catch(n){o(n)}}else o("Unable to load the snippet "+c)})),t.open("GET",this.SnippetUrl+"/"+c.replace(/#/g,"/")),t.send()}))}}tA.EditorURL=`${Mb.d._DefaultCdnUrl}/v${uc.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,tA.SnippetUrl="https://snippet.babylonjs.com",(0,P.e)([(0,O.J)()],tA.prototype,"name",void 0),(0,P.e)([(0,O.J)("comment")],tA.prototype,"comment",void 0),function(c){c[c.None=0]="None",c[c.PerParticle=1]="PerParticle",c[c.PerSystem=2]="PerSystem"}(lb||(lb={}));class nA extends gb{constructor(c){super(c),this._currentLockId=-2,this.lockMode=lb.PerParticle,this.registerInput("min",Kb.AutoDetect,!0,0),this.registerInput("max",Kb.AutoDetect,!0,1),this.registerOutput("output",Kb.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Kb.Float|Kb.Int|Kb.Vector2|Kb.ak|Kb.sk),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Kb.Float|Kb.Int|Kb.Vector2|Kb.ak|Kb.sk),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Kb.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let c=null;switch(this._currentLockId=-2,this.min.type){case Kb.AutoDetect:case Kb.Int:case Kb.Float:c=c=>{const b=this.min.getConnectedValue(c)||0,A=this.max.getConnectedValue(c)||1;return b+Math.random()*(A-b)};break;case Kb.Vector2:c=c=>{const b=this.min.getConnectedValue(c)||o.h.Zero(),A=this.max.getConnectedValue(c)||o.h.One();return new o.h(b.x+Math.random()*(A.x-b.x),b.y+Math.random()*(A.y-b.y))};break;case Kb.ak:c=c=>{const b=this.min.getConnectedValue(c)||o.k.Zero(),A=this.max.getConnectedValue(c)||o.k.One();return new o.k(b.x+Math.random()*(A.x-b.x),b.y+Math.random()*(A.y-b.y),b.z+Math.random()*(A.z-b.z))};break;case Kb.sk:c=c=>{const b=this.min.getConnectedValue(c)||new h.h(0,0,0,0),A=this.max.getConnectedValue(c)||new h.h(1,1,1,1);return new h.h(b.x+Math.random()*(A.x-b.x),b.y+Math.random()*(A.y-b.y),b.z+Math.random()*(A.z-b.z),b.w+Math.random()*(A.w-b.w))}}this.output._storedFunction=b=>{var A;let o=0;switch(this.lockMode){case lb.PerParticle:o=(null===(A=b.particleContext)||void 0===A?void 0:A.id)||-1;break;case lb.PerSystem:o=b.buildId||0}return this._currentLockId!==o&&(this.lockMode!==lb.None&&(this._currentLockId=o),this.output._storedValue=c(b)),this.output._storedValue}}serialize(){const c=super.serialize();return c.lockMode=this.lockMode,c}_deserialize(c){super._deserialize(c),this.lockMode=c.lockMode}}(0,P.e)([ub("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:lb.None},{label:"Per particle",value:lb.PerParticle},{label:"Per system",value:lb.PerSystem}]})],nA.prototype,"lockMode",void 0),(0,s.d)("BABYLON.ParticleRandomBlock",nA);class hA extends gb{constructor(c){super(c),this._currentLockId=-2,this.lockMode=lb.PerParticle,this.registerInput("min",Kb.AutoDetect),this.registerInput("max",Kb.AutoDetect),this.registerOutput("output",Kb.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const b=[Kb.Matrix,Kb.Particle,Kb.Texture,Kb.System,Kb.FloatGradient,Kb.Color4Gradient,Kb.Vector2Gradient,Kb.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...b),this.max.excludedConnectionPointTypes.push(...b)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let c=null;switch(this._currentLockId=-2,this.min.type){case Kb.Float:case Kb.Int:c=c=>{const b=this.min.getConnectedValue(c),A=this.max.getConnectedValue(c);return Math.random()*(A-b)+b};break;case Kb.Vector2:c=c=>{const b=this.min.getConnectedValue(c),A=this.max.getConnectedValue(c);return new o.h(Math.random()*(A.x-b.x)+b.x,Math.random()*(A.y-b.y)+b.y)};break;case Kb.ak:c=c=>{const b=this.min.getConnectedValue(c),A=this.max.getConnectedValue(c);return new o.k(Math.random()*(A.x-b.x)+b.x,Math.random()*(A.y-b.y)+b.y,Math.random()*(A.z-b.z)+b.z)};break;case Kb.sk:c=c=>{const b=this.min.getConnectedValue(c),A=this.max.getConnectedValue(c);return new h.h(Math.random()*(A.r-b.r)+b.r,Math.random()*(A.g-b.g)+b.g,Math.random()*(A.b-b.b)+b.b,Math.random()*(A.a-b.a)+b.a)}}this.output._storedFunction=b=>{var A;let o=0;switch(this.lockMode){case lb.PerParticle:o=(null===(A=b.particleContext)||void 0===A?void 0:A.id)||-1;break;case lb.PerSystem:o=b.buildId||0}return this._currentLockId!==o&&(this.lockMode!==lb.None&&(this._currentLockId=o),this.output._storedValue=c(b)),this.output._storedValue}}serialize(){const c=super.serialize();return c.lockMode=this.lockMode,c}_deserialize(c){super._deserialize(c),void 0!==c.lockMode&&(this.lockMode=c.lockMode)}}(0,P.e)([ub("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:lb.None},{label:"Per particle",value:lb.PerParticle},{label:"Per system",value:lb.PerSystem}]})],hA.prototype,"lockMode",void 0),(0,s.d)("BABYLON.RandomRangeBlock",hA);(0,s.d)("BABYLON.ParticleLerpBlock",class extends gb{constructor(c){super(c),this.registerInput("left",Kb.AutoDetect),this.registerInput("right",Kb.AutoDetect),this.registerInput("gradient",Kb.Float,!0,0,0,1),this.registerOutput("output",Kb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Kb.Float|Kb.Int|Kb.Vector2|Kb.ak|Kb.sk)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const c=(c,b,A)=>(1-c)*b+c*A;this.output._storedFunction=b=>{const A=this.left.getConnectedValue(b),t=this.right.getConnectedValue(b),n=this.gradient.getConnectedValue(b);switch(this.left.type){case Kb.Int:case Kb.Float:return c(n,A,t);case Kb.Vector2:return new o.h(c(n,A.x,t.x),c(n,A.y,t.y));case Kb.ak:return new o.k(c(n,A.x,t.x),c(n,A.y,t.y),c(n,A.z,t.z));case Kb.sk:return new h.h(c(n,A.r,t.r),c(n,A.g,t.g),c(n,A.b,t.b),c(n,A.a,t.a))}return 0}}});(0,s.d)("BABYLON.UpdateDirectionBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("direction",Kb.ak),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(c){const b=this.particle.getConnectedValue(c);if(this.output._storedValue=b,!this.direction.isConnected)return;const A={process:A=>{c.particleContext=A,c.systemContext=b,A.direction.p(this.direction.getConnectedValue(c))},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A}});(0,s.d)("BABYLON.UpdateColorBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("color",Kb.sk),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(c){const b=this.particle.getConnectedValue(c);if(this.output._storedValue=b,!this.color.isConnected)return;const A={process:A=>{c.particleContext=A,c.systemContext=b,A.color.p(this.color.getConnectedValue(c))},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A}});(0,s.d)("BABYLON.UpdateScaleBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("scale",Kb.Vector2),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(c){const b=this.particle.getConnectedValue(c);if(this.output._storedValue=b,!this.scale.isConnected)return;const A={process:A=>{c.particleContext=A,c.systemContext=b,A.scale.p(this.scale.getConnectedValue(c))},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A}});(0,s.d)("BABYLON.UpdateAngleBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("angle",Kb.Float),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(c){const b=this.particle.getConnectedValue(c);if(this.output._storedValue=b,!this.angle.isConnected)return;const A={process:A=>{c.particleContext=A,c.systemContext=b,A.angle=this.angle.getConnectedValue(c)},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A}});(0,s.d)("BABYLON.BasicPositionUpdateBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(c){const b=this.particle.getConnectedValue(c),A={process:A=>{c.particleContext=A,c.systemContext=b,A.direction.scaleToRef(b._directionScale,b._scaledDirection),A.position.addInPlace(b._scaledDirection)},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A,this.output._storedValue=b}});(0,s.d)("BABYLON.BasicSpriteUpdateBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(c){const b=this.particle.getConnectedValue(c),A={process:A=>{c.particleContext=A,c.systemContext=b,A.updateCellIndex()},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A,this.output._storedValue=b}});(0,s.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("cellIndex",Kb.Int),this.registerOutput("output",Kb.Particle),this.cellIndex.acceptedConnectionPointTypes=[Kb.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(c){const b=this.particle.getConnectedValue(c);if(this.output._storedValue=b,!this.cellIndex.isConnected)return;const A={process:A=>{c.particleContext=A,c.systemContext=b,A.cellIndex=Math.floor(this.cellIndex.getConnectedValue(c))},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A}});class sA extends gb{constructor(c){super(c),this.strength=1,this.registerInput("particle",Kb.Particle),this.registerInput("flowMap",Kb.Texture),this.registerOutput("output",Kb.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(c){var b;const A=this.particle.getConnectedValue(c),o=c.yd;let t;(null===(b=this.flowMap.connectedPoint)||void 0===b?void 0:b.ownerBlock).extractTextureContentAsync().then((c=>{c&&(t=new Ib(c.width,c.height,c.data))}));const n={process:c=>{const b=o.getTransformMatrix();t&&t._processParticle(c,this.strength*A._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null};A._updateQueueStart?Qc(n,A._updateQueueStart):A._updateQueueStart=n,this.output._storedValue=A}serialize(){const c=super.serialize();return c.strength=this.strength,c}_deserialize(c){super._deserialize(c),this.strength=c.strength}}(0,P.e)([ub("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sA.prototype,"strength",void 0),(0,s.d)("BABYLON.UpdateFlowMapBlock",sA);(0,s.d)("BABYLON.SphereShapeBlock",class extends gb{constructor(c){super(c),this.registerInput("input",Kb.Particle),this.registerInput("radius",Kb.Float,!0,1),this.registerInput("radiusRange",Kb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Kb.Float,!0,0,0,1),this.registerOutput("output",Kb.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(c){const b=this.input.getConnectedValue(c);b._directionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.directionRandomizer.getConnectedValue(c),n=A.position.Xd(c.emitterPosition).normalize(),h=(0,C.RandomRange)(0,t),s=(0,C.RandomRange)(0,t),L=(0,C.RandomRange)(0,t);n.x+=h,n.y+=s,n.z+=L,n.normalize(),c.isEmitterTransformNode?o.k.TransformNormalFromFloatsToRef(h,s,L,c.emitterWorldMatrix,A.direction):A.direction.jd(h,s,L)},b._positionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.radius.getConnectedValue(c),n=this.radiusRange.getConnectedValue(c),h=t-(0,C.RandomRange)(0,t*n),s=(0,C.RandomRange)(0,1),L=(0,C.RandomRange)(0,2*Math.PI),J=Math.acos(2*s-1),X=h*Math.cos(L)*Math.sin(J),R=h*Math.cos(J),N=h*Math.sin(L)*Math.sin(J);c.isEmitterTransformNode?o.k.TransformCoordinatesFromFloatsToRef(X,R,N,c.emitterWorldMatrix,A.position):(A.position.jd(X,R,N),A.position.addInPlace(c.emitterPosition))},this.output._storedValue=b}});(0,s.d)("BABYLON.PointShapeBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("direction1",Kb.ak,!0,new o.k(0,1,0)),this.registerInput("direction2",Kb.ak,!0,new o.k(0,1,0)),this.registerOutput("output",Kb.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(c){const b=this.particle.getConnectedValue(c);b._directionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.direction1.getConnectedValue(c),n=this.direction2.getConnectedValue(c),h=(0,C.RandomRange)(t.x,n.x),s=(0,C.RandomRange)(t.y,n.y),L=(0,C.RandomRange)(t.z,n.z);c.isEmitterTransformNode?o.k.TransformNormalFromFloatsToRef(h,s,L,c.emitterWorldMatrix,A.direction):A.direction.jd(h,s,L)},b._positionCreation.process=A=>{c.systemContext=b,c.isEmitterTransformNode?o.k.TransformCoordinatesFromFloatsToRef(0,0,0,c.emitterWorldMatrix,A.position):A.position.p(c.emitterPosition)},this.output._storedValue=b}});(0,s.d)("BABYLON.CustomShapeBlock",class extends gb{constructor(c){super(c),this.registerInput("particle",Kb.Particle),this.registerInput("position",Kb.ak,!0,new o.k(0,0,0)),this.registerInput("direction",Kb.ak,!0,new o.k(0,1,0)),this.registerOutput("output",Kb.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(c){const b=this.particle.getConnectedValue(c);b._directionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.direction.getConnectedValue(c);c.isEmitterTransformNode?o.k.TransformNormalToRef(t,c.emitterWorldMatrix,A.direction):A.direction.p(t)},b._positionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.position.getConnectedValue(c);c.isEmitterTransformNode?o.k.TransformCoordinatesToRef(t,c.emitterWorldMatrix,A.position):(A.position.p(t),A.position.addInPlace(c.emitterPosition))},this.output._storedValue=b}});(0,s.d)("BABYLON.CylinderShapeBlock",class extends gb{constructor(c){super(c),this._tempVector=o.k.Zero(),this.registerInput("particle",Kb.Particle),this.registerInput("radius",Kb.Float,!0,1),this.registerInput("height",Kb.Float,!0,1,0),this.registerInput("radiusRange",Kb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Kb.Float,!0,0,0,1),this.registerOutput("output",Kb.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(c){const b=this.particle.getConnectedValue(c);b._directionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.directionRandomizer.getConnectedValue(c);A.position.subtractToRef(c.emitterPosition,this._tempVector),this._tempVector.normalize(),c.isEmitterTransformNode&&o.k.TransformNormalToRef(this._tempVector,c.emitterInverseWorldMatrix,this._tempVector);const n=(0,C.RandomRange)(-t/2,t/2);let h=Math.atan2(this._tempVector.x,this._tempVector.z);h+=(0,C.RandomRange)(-Math.PI/2,Math.PI/2)*t,this._tempVector.y=n,this._tempVector.x=Math.sin(h),this._tempVector.z=Math.cos(h),this._tempVector.normalize(),c.isEmitterTransformNode?o.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,c.emitterWorldMatrix,A.direction):A.direction.p(this._tempVector)},b._positionCreation.process=A=>{c.particleContext=A,c.systemContext=b;const t=this.height.getConnectedValue(c),n=this.radiusRange.getConnectedValue(c),h=this.radius.getConnectedValue(c),s=(0,C.RandomRange)(-t/2,t/2),L=(0,C.RandomRange)(0,2*Math.PI),J=(0,C.RandomRange)((1-n)*(1-n),1),X=Math.sqrt(J)*h,R=X*Math.cos(L),N=X*Math.sin(L);c.isEmitterTransformNode?o.k.TransformCoordinatesFromFloatsToRef(R,s,N,c.emitterWorldMatrix,A.position):(A.position.jd(R,s,N),A.position.addInPlace(c.emitterPosition))},this.output._storedValue=b}});class LA extends gb{constructor(c){super(c),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Kb.Particle),this.registerOutput("output",Kb.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){super._build(c);const b=this.particle.getConnectedValue(c);b._isAnimationSheetEnabled=!0,b.spriteCellWidth=this.width,b.spriteCellHeight=this.height,b.startSpriteCellID=this.start,b.endSpriteCellID=this.end,b.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=b}serialize(){const c=super.serialize();return c.width=this.width,c.height=this.height,c.start=this.start,c.end=this.end,c.randomStartCell=this.randomStartCell,c}_deserialize(c){super._deserialize(c),this.width=c.width,this.height=c.height,this.start=c.start,this.end=c.end,this.randomStartCell=c.randomStartCell}}(0,P.e)([ub("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LA.prototype,"start",void 0),(0,P.e)([ub("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LA.prototype,"end",void 0),(0,P.e)([ub("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LA.prototype,"width",void 0),(0,P.e)([ub("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LA.prototype,"height",void 0),(0,P.e)([ub("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],LA.prototype,"loop",void 0),(0,P.e)([ub("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],LA.prototype,"randomStartCell",void 0),(0,s.d)("BABYLON.SetupSpriteSheetBlock",LA);class CA extends gb{constructor(c){super(c),this.reference=0,this.registerInput("value",Kb.AutoDetect),this.registerOutput("output",Kb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=c=>{switch(c){case Kb.Float:return Kb.FloatGradient;case Kb.Vector2:return Kb.Vector2Gradient;case Kb.ak:return Kb.Vector3Gradient;case Kb.sk:return Kb.Color4Gradient}return c},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Kb.Float|Kb.Vector2|Kb.ak|Kb.sk)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=c=>null}serialize(){const c=super.serialize();return c.reference=this.reference,c}_deserialize(c){super._deserialize(c),this.reference=c.reference}}(0,P.e)([ub("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],CA.prototype,"reference",void 0),(0,s.d)("BABYLON.ParticleGradientValueBlock",CA);(0,s.d)("BABYLON.ParticleGradientBlock",class extends gb{constructor(c){super(c),this._entryCount=1,this.registerInput("gradient",Kb.Float,!0,1,0,1),this.registerInput("value0",Kb.AutoDetect),this.registerOutput("output",Kb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=c=>{switch(c){case Kb.FloatGradient:return Kb.Float;case Kb.Vector2Gradient:return Kb.Vector2;case Kb.Vector3Gradient:return Kb.ak;case Kb.Color4Gradient:return Kb.sk}return c},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Kb.FloatGradient|Kb.Vector2Gradient|Kb.Vector3Gradient|Kb.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(c){this._inputs[c].onConnectionObservable.add((()=>{this._entryCount>c||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Kb.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const c=[];for(let A=1;A<this._inputs.length;A++){var b;if(this._inputs[A].isConnected)c.push(null===(b=this._inputs[A].connectedPoint)||void 0===b?void 0:b.ownerBlock)}c.sort(((c,b)=>c.reference-b.reference)),this.output._storedFunction=b=>{const A=this.gradient.getConnectedValue(b);if(1===c.length)return c[0].value.getConnectedValue(b);let t=null;for(let n=c.length-1;n>=0;n--){const s=c[n];if(s.reference<=A){const c=s.value.getConnectedValue(b);if(t){const n=t.value.getConnectedValue(b),L=t.reference,J=s.reference,X=Math.max(0,Math.min(1,(A-J)/(L-J)));switch(this.output.type){case Kb.Float:return(0,C.Lerp)(c,n,X);case Kb.Vector2:return o.h.Lerp(c,n,X);case Kb.ak:return o.k.Lerp(c,n,X);case Kb.sk:return h.h.Lerp(c,n,X)}}return c}t=s}return 0}}});(0,s.d)("BABYLON.ParticleConverterBlock",class extends gb{constructor(c){super(c),this.registerInput("color ",Kb.sk,!0),this.registerInput("xyz ",Kb.ak,!0),this.registerInput("xy ",Kb.Vector2,!0),this.registerInput("zw ",Kb.Vector2,!0),this.registerInput("x ",Kb.Float,!0),this.registerInput("y ",Kb.Float,!0),this.registerInput("z ",Kb.Float,!0),this.registerInput("w ",Kb.Float,!0),this.registerOutput("color",Kb.sk),this.registerOutput("xyz",Kb.ak),this.registerOutput("xy",Kb.Vector2),this.registerOutput("zw",Kb.Vector2),this.registerOutput("x",Kb.Float),this.registerOutput("y",Kb.Float),this.registerOutput("z",Kb.Float),this.registerOutput("w",Kb.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(c){return"color "===c?"colorIn":"xyz "===c?"xyzIn":"xy "===c?"xyIn":"zw "===c?"zwIn":"x "===c?"xIn":"y "===c?"yIn":"z "===c?"zIn":"w "===c?"wIn":c}_outputRename(c){switch(c){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return c}}_build(c){super._build(c);const b=this.xIn,A=this.yIn,t=this.zIn,n=this.wIn,s=this.xyIn,L=this.zwIn,C=this.xyzIn,J=this.colorIn,X=this.colorOut,R=this.xyzOut,N=this.xyOut,k=this.zwOut,E=this.xOut,V=this.yOut,y=this.zOut,j=this.wOut,F=c=>{if(J.isConnected)return J.getConnectedValue(c);let o=0,X=0,R=0,N=0;if(b.isConnected&&(o=b.getConnectedValue(c)),A.isConnected&&(X=A.getConnectedValue(c)),t.isConnected&&(R=t.getConnectedValue(c)),n.isConnected&&(N=n.getConnectedValue(c)),s.isConnected){const b=s.getConnectedValue(c);b&&(o=b.x,X=b.y)}if(L.isConnected){const b=L.getConnectedValue(c);b&&(R=b.x,N=b.y)}if(C.isConnected){const b=C.getConnectedValue(c);b&&(o=b.x,X=b.y,R=b.z)}return new h.h(o,X,R,N)};X._storedFunction=c=>F(c),R._storedFunction=c=>{const b=F(c);return new o.k(b.r,b.g,b.b)},N._storedFunction=c=>{const b=F(c);return new o.h(b.r,b.g)},k._storedFunction=c=>{const b=F(c);return new o.h(b.b,b.a)},E._storedFunction=c=>F(c).r,V._storedFunction=c=>F(c).g,y._storedFunction=c=>F(c).b,j._storedFunction=c=>F(c).a}}),function(c){c[c.Cos=0]="Cos",c[c.Sin=1]="Sin",c[c.Abs=2]="Abs",c[c.Exp=3]="Exp",c[c.Exp2=4]="Exp2",c[c.Round=5]="Round",c[c.Floor=6]="Floor",c[c.Ceiling=7]="Ceiling",c[c.Sqrt=8]="Sqrt",c[c.Log=9]="Log",c[c.Tan=10]="Tan",c[c.ArcTan=11]="ArcTan",c[c.ArcCos=12]="ArcCos",c[c.ArcSin=13]="ArcSin",c[c.Sign=14]="Sign",c[c.Negate=15]="Negate",c[c.OneMinus=16]="OneMinus",c[c.Reciprocal=17]="Reciprocal",c[c.ToDegrees=18]="ToDegrees",c[c.ToRadians=19]="ToRadians",c[c.Fract=20]="Fract"}(Tb||(Tb={}));class JA extends gb{constructor(c){super(c),this.operation=Tb.Cos,this.registerInput("input",Kb.AutoDetect),this.registerOutput("output",Kb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Kb.Float|Kb.Int|Kb.Vector2|Kb.ak|Kb.sk)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){super._build(c);let b=null;switch(this.operation){case Tb.Cos:b=c=>Math.cos(c);break;case Tb.Sin:b=c=>Math.sin(c);break;case Tb.Abs:b=c=>Math.abs(c);break;case Tb.Exp:b=c=>Math.exp(c);break;case Tb.Exp2:b=c=>Math.pow(2,c);break;case Tb.Round:b=c=>Math.round(c);break;case Tb.Floor:b=c=>Math.floor(c);break;case Tb.Ceiling:b=c=>Math.ceil(c);break;case Tb.Sqrt:b=c=>Math.sqrt(c);break;case Tb.Log:b=c=>Math.log(c);break;case Tb.Tan:b=c=>Math.tan(c);break;case Tb.ArcTan:b=c=>Math.atan(c);break;case Tb.ArcCos:b=c=>Math.acos(c);break;case Tb.ArcSin:b=c=>Math.asin(c);break;case Tb.Sign:b=c=>Math.sign(c);break;case Tb.Negate:b=c=>-c;break;case Tb.OneMinus:b=c=>1-c;break;case Tb.Reciprocal:b=c=>1/c;break;case Tb.ToRadians:b=c=>c*Math.PI/180;break;case Tb.ToDegrees:b=c=>180*c/Math.PI;break;case Tb.Fract:b=c=>c>=0?c-Math.floor(c):c-Math.ceil(c)}if(!b)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Kb.Int:case Kb.Float:this.output._storedFunction=c=>{const A=this.input.getConnectedValue(c);return b(A)};break;case Kb.Vector2:this.output._storedFunction=c=>{const A=this.input.getConnectedValue(c);return new o.h(b(A.x),b(A.y))};break;case Kb.ak:this.output._storedFunction=c=>{const A=this.input.getConnectedValue(c);return new o.k(b(A.x),b(A.y),b(A.z))};break;case Kb.sk:this.output._storedFunction=c=>{const A=this.input.getConnectedValue(c);return new h.h(b(A.r),b(A.g),b(A.b),b(A.a))}}return this}serialize(){const c=super.serialize();return c.operation=this.operation,c}_deserialize(c){super._deserialize(c),this.operation=c.operation}}(0,P.e)([ub("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Tb.Cos},{label:"Sin",value:Tb.Sin},{label:"Abs",value:Tb.Abs},{label:"Exp",value:Tb.Exp},{label:"Exp2",value:Tb.Exp2},{label:"Round",value:Tb.Round},{label:"Floor",value:Tb.Floor},{label:"Ceiling",value:Tb.Ceiling},{label:"Sqrt",value:Tb.Sqrt},{label:"Log",value:Tb.Log},{label:"Tan",value:Tb.Tan},{label:"ArcTan",value:Tb.ArcTan},{label:"ArcCos",value:Tb.ArcCos},{label:"ArcSin",value:Tb.ArcSin},{label:"Sign",value:Tb.Sign},{label:"Negate",value:Tb.Negate},{label:"OneMinus",value:Tb.OneMinus},{label:"Reciprocal",value:Tb.Reciprocal},{label:"ToDegrees",value:Tb.ToDegrees},{label:"ToRadians",value:Tb.ToRadians},{label:"Fract",value:Tb.Fract}]})],JA.prototype,"operation",void 0),(0,s.d)("BABYLON.ParticleTrigonometryBlock",JA);var XA,RA=A(12472);class NA extends gb{constructor(c){super(c),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Kb.AutoDetect),this.registerOutput("output",Kb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Kb.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Kb.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Kb.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Kb.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Kb.System),this._inputs[0].excludedConnectionPointTypes.push(Kb.Particle),this._inputs[0].excludedConnectionPointTypes.push(Kb.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const b=c=>{const b=this.input.getConnectedValue(c);if(this.log.length>=this.stackSize)return b;if(null===b||void 0===b)return this.log.push(["null",""]),b;switch(this.input.type){case Kb.Vector2:this.log.push([(0,RA.f)(b,4),b.toString()]);break;case Kb.ak:this.log.push([(0,RA.h)(b,4),b.toString()]);break;case Kb.sk:this.log.push([`{R: ${b.r.toFixed(4)} G: ${b.g.toFixed(4)} B: ${b.b.toFixed(4)} A: ${b.a.toFixed(4)}}`,b.toString()]);break;default:this.log.push([b.toString(),b.toString()])}return b};this.output.isConnected?this.output._storedFunction=b:this.output._storedValue=b(c)}serialize(){const c=super.serialize();return c.stackSize=this.stackSize,c}_deserialize(c){super._deserialize(c),this.stackSize=c.stackSize}}(0,P.e)([ub("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],NA.prototype,"stackSize",void 0),(0,s.d)("BABYLON.ParticleDebugBlock",NA);(0,s.d)("BABYLON.ParticleElbowBlock",class extends gb{constructor(c){super(c),this.registerInput("input",Kb.AutoDetect),this.registerOutput("output",Kb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){super._build(c);const b=this._outputs[0],A=this._inputs[0];b._storedFunction=c=>A.getConnectedValue(c)}});(0,s.d)("BABYLON.ParticleTeleportInBlock",class extends gb{get endpoints(){return this._endpoints}constructor(c){super(c),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Kb.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(c){if(this.getClassName()===c)return!0;for(const b of this.endpoints)if(b.isAnAncestorOfType(c))return!0;return!1}isAnAncestorOf(c){for(const b of this.endpoints){if(b===c)return!0;if(b.isAnAncestorOf(c))return!0}return!1}attachToEndpoint(c){c.detach(),this._endpoints.push(c),c._entryPoint=this,c._outputs[0]._typeConnectionSource=this._inputs[0],c._tempEntryPointUniqueId=null,c.name="> "+this.name}detachFromEndpoint(c){const b=this._endpoints.indexOf(c);-1!==b&&(this._endpoints.splice(b,1),c._outputs[0]._typeConnectionSource=null,c._entryPoint=null)}_build(){for(const c of this._endpoints)c.output._storedFunction=c=>this.input.getConnectedValue(c)}});(0,s.d)("BABYLON.ParticleTeleportOutBlock",class extends gb{constructor(c){super(c),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Kb.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(c){this.entryPoint&&this.entryPoint.build(c)}clone(){const c=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(c),c}serialize(){var c;const b=super.serialize();return b.entryPoint=(null===(c=this.entryPoint)||void 0===c?void 0:c.uniqueId)??"",b}_deserialize(c){super._deserialize(c),this._tempEntryPointUniqueId=c.entryPoint}}),function(c){c[c.Equal=0]="Equal",c[c.NotEqual=1]="NotEqual",c[c.LessThan=2]="LessThan",c[c.GreaterThan=3]="GreaterThan",c[c.LessOrEqual=4]="LessOrEqual",c[c.GreaterOrEqual=5]="GreaterOrEqual",c[c.Xor=6]="Xor",c[c.Or=7]="Or",c[c.And=8]="And"}(XA||(XA={}));class kA extends gb{constructor(c){super(c),this.test=XA.Equal,this.epsilon=0,this.registerInput("left",Kb.Float),this.registerInput("right",Kb.Float,!0,0),this.registerInput("ifTrue",Kb.AutoDetect,!0,1),this.registerInput("ifFalse",Kb.AutoDetect,!0,0),this.registerOutput("output",Kb.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Kb.Float,this._inputs[0].acceptedConnectionPointTypes.push(Kb.Int),this._inputs[1].acceptedConnectionPointTypes.push(Kb.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const c=c=>{const b=this.left.getConnectedValue(c),A=this.right.getConnectedValue(c);let o=!1;switch(this.test){case XA.Equal:o=(0,C.WithinEpsilon)(b,A,this.epsilon);break;case XA.NotEqual:o=!(0,C.WithinEpsilon)(b,A,this.epsilon);break;case XA.LessThan:o=b<A+this.epsilon;break;case XA.GreaterThan:o=b>A-this.epsilon;break;case XA.LessOrEqual:o=b<=A+this.epsilon;break;case XA.GreaterOrEqual:o=b>=A-this.epsilon;break;case XA.Xor:o=!!b&&!A||!b&&!!A;break;case XA.Or:o=!!b||!!A;break;case XA.And:o=!!b&&!!A}return o};this.output._storedFunction=b=>c(b)?this.ifTrue.getConnectedValue(b):this.ifFalse.getConnectedValue(b)}serialize(){const c=super.serialize();return c.test=this.test,c.epsilon=this.epsilon,c}_deserialize(c){super._deserialize(c),this.test=c.test,void 0!==c.epsilon&&(this.epsilon=c.epsilon)}}(0,P.e)([ub("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:XA.Equal},{label:"NotEqual",value:XA.NotEqual},{label:"LessThan",value:XA.LessThan},{label:"GreaterThan",value:XA.GreaterThan},{label:"LessOrEqual",value:XA.LessOrEqual},{label:"GreaterOrEqual",value:XA.GreaterOrEqual},{label:"Xor",value:XA.Xor},{label:"Or",value:XA.Or},{label:"And",value:XA.And}]})],kA.prototype,"test",void 0),(0,P.e)([ub("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kA.prototype,"epsilon",void 0),(0,s.d)("BABYLON.ParticleConditionBlock",kA);class EA extends gb{constructor(c){super(c),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Kb.Particle),this.registerInput("condition",Kb.Float,!0,0),this.registerInput("system",Kb.System),this.registerOutput("output",Kb.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(c){this._triggerCount=0;const b=this.input.getConnectedValue(c),A={process:A=>{if(c.particleContext=A,c.systemContext=b,0!==this.condition.getConnectedValue(c)&&(0===this.limit||this._triggerCount<this.limit)){const o=(new Date).getTime();if(this._previousOne&&o-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=o;const t=this.system.getConnectedValue(c);if(t){const o=xb(t,c.yd,A.position);o.fk.addOnce((()=>{this._triggerCount--})),b.fk.addOnce((()=>{o.dispose()}))}}},previousItem:null,nextItem:null};b._updateQueueStart?Qc(A,b._updateQueueStart):b._updateQueueStart=A,this.output._storedValue=b}serialize(){const c=super.serialize();return c.limit=this.limit,c.delay=this.delay,c}_deserialize(c){super._deserialize(c),void 0!==c.limit&&(this.limit=c.limit),void 0!==c.delay&&(this.delay=c.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,P.e)([ub("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],EA.prototype,"limit",void 0),(0,P.e)([ub("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],EA.prototype,"delay",void 0),(0,s.d)("BABYLON.ParticleTriggerBlock",EA);A(12480),A(12489),A(12499),A(12540)},12527:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12502:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12563:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneVertex",n="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12548:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12534:(c,b,A)=>{"use strict";var o=A(601);const t="fogFragment",n="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12521:(c,b,A)=>{"use strict";var o=A(601);const t="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12568:(c,b,A)=>{"use strict";var o=A(601);const t="fogVertex",n="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12555:(c,b,A)=>{"use strict";var o=A(601);const t="fogVertexDeclaration",n="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12513:(c,b,A)=>{"use strict";var o=A(601);const t="helperFunctions",n="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12505:(c,b,A)=>{"use strict";var o=A(601);const t="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12518:(c,b,A)=>{"use strict";var o=A(601);const t="imageProcessingFunctions",n="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12510:(c,b,A)=>{"use strict";var o=A(601);const t="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12529:(c,b,A)=>{"use strict";var o=A(601);const t="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12572:(c,b,A)=>{"use strict";var o=A(601);const t="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";o.e.IncludesShadersStoreWGSL[t]||(o.e.IncludesShadersStoreWGSL[t]=n)},12499:(c,b,A)=>{"use strict";A.r(b),A.d(b,{particlesPixelShaderWGSL:()=>h});var o=A(601);A(12502),A(12505),A(12510),A(12513),A(12518),A(12521),A(12527),A(12529),A(12534);const t="particlesPixelShader",n="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.e.ShadersStoreWGSL[t]||(o.e.ShadersStoreWGSL[t]=n);const h={name:t,shader:n}},12540:(c,b,A)=>{"use strict";A.r(b),A.d(b,{particlesVertexShaderWGSL:()=>h});var o=A(601);A(12548),A(12555),A(12510),A(12563),A(12568),A(12572);const t="particlesVertexShader",n="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.e.ShadersStoreWGSL[t]||(o.e.ShadersStoreWGSL[t]=n);const h={name:t,shader:n}},12414:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneFragment",n="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12487:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneFragmentDeclaration",n="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12436:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneVertex",n="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12497:(c,b,A)=>{"use strict";var o=A(601);const t="clipPlaneVertexDeclaration",n="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12425:(c,b,A)=>{"use strict";var o=A(601);const t="fogFragment",n="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12407:(c,b,A)=>{"use strict";var o=A(601);const t="fogFragmentDeclaration",n="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12442:(c,b,A)=>{"use strict";var o=A(601);const t="fogVertex",n="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12431:(c,b,A)=>{"use strict";var o=A(601);const t="fogVertexDeclaration",n="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12392:(c,b,A)=>{"use strict";var o=A(601);const t="helperFunctions",n="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12385:(c,b,A)=>{"use strict";var o=A(601);const t="imageProcessingDeclaration",n="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12400:(c,b,A)=>{"use strict";var o=A(601);const t="imageProcessingFunctions",n="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12389:(c,b,A)=>{"use strict";var o=A(601);const t="logDepthDeclaration",n="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12420:(c,b,A)=>{"use strict";var o=A(601);const t="logDepthFragment",n="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12450:(c,b,A)=>{"use strict";var o=A(601);const t="logDepthVertex",n="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";o.e.IncludesShadersStore[t]||(o.e.IncludesShadersStore[t]=n)},12480:(c,b,A)=>{"use strict";A.r(b),A.d(b,{particlesPixelShader:()=>h});var o=A(601);A(12487),A(12385),A(12389),A(12392),A(12400),A(12407),A(12414),A(12420),A(12425);const t="particlesPixelShader",n="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.e.ShadersStore[t]||(o.e.ShadersStore[t]=n);const h={name:t,shader:n}},12489:(c,b,A)=>{"use strict";A.r(b),A.d(b,{particlesVertexShader:()=>h});var o=A(601);A(12497),A(12431),A(12389),A(12436),A(12442),A(12450);const t="particlesVertexShader",n="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.e.ShadersStore[t]||(o.e.ShadersStore[t]=n);const h={name:t,shader:n}},12816:(c,b,A)=>{"use strict";A.r(b),A.d(b,{FlowGraphGLTFDataProvider:()=>n});var o=A(12789),t=A(12763);class n extends o.d{constructor(c){var b,A;super();const o=c.glTF,n=(null===(b=o.animations)||void 0===b?void 0:b.map((c=>c._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",t.e,n);const h=(null===(A=o.nodes)||void 0===A?void 0:A.map((c=>c._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",t.e,h)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12718:(c,b,A)=>{"use strict";A.d(b,{e:()=>V,g:()=>k,j:()=>N,l:()=>E});var o=A(688),t=A(11838),n=A(721),h=A(12723);const s=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class L{constructor(c,b){this._gltf=c,this._infoTree=b}convert(c){let b,A=this._gltf,o=this._infoTree;if(!c.startsWith("/"))throw new Error("Path must start with a /");const t=c.split("/");if(t.shift(),t[t.length-1].includes(".length")){const c=t[t.length-1].split(".");t.pop(),t.push(...c)}let n=!1;for(const L of t){const t="length"===L;if(t&&!o.__array__)throw new Error(`Path ${c} is invalid`);if(o.__ignoreObjectTree__&&(n=!0),o.__array__&&!t)o=o.__array__;else if(o=o[L],!o)throw new Error(`Path ${c} is invalid`);if(!n)if(void 0===A){if(!s.find((b=>b.regex.test(c))))throw new Error(`Path ${c} is invalid`)}else if(!t){var h;A=null===(h=A)||void 0===h?void 0:h[L]}(o.__target__||t)&&(b=A)}return{object:b,info:o}}}function C(c,b,A,o){const t=J(c,b);return o?t[A][o]:t[A]}function J(c,b,A){var o,n;return null===(o=c._data)||void 0===o||null===(n=o[(null===A||void 0===A?void 0:A.fillMode)??t.e.MATERIAL_TriangleFillMode])||void 0===n?void 0:n.babylonMaterial}function X(c,b){return{offset:{componentsCount:2,type:"Vector2",get:(A,t,n)=>{const h=C(A,n,c,b);return new o.h(null===h||void 0===h?void 0:h.uOffset,null===h||void 0===h?void 0:h.vOffset)},getTarget:J,set:(A,o,t,n)=>{const h=C(o,n,c,b);h.uOffset=A.x,h.vOffset=A.y},getPropertyName:[()=>`${c}${b?"."+b:""}.uOffset`,()=>`${c}${b?"."+b:""}.vOffset`]},rotation:{type:"number",get:(A,o,t)=>{var n;return null===(n=C(A,t,c,b))||void 0===n?void 0:n.wAng},getTarget:J,set:(A,o,t,n)=>C(o,n,c,b).wAng=A,getPropertyName:[()=>`${c}${b?"."+b:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(A,t,n)=>{const h=C(A,n,c,b);return new o.h(null===h||void 0===h?void 0:h.uScale,null===h||void 0===h?void 0:h.vScale)},getTarget:J,set:(A,o,t,n)=>{const h=C(o,n,c,b);h.uScale=A.x,h.vScale=A.y},getPropertyName:[()=>`${c}${b?"."+b:""}.uScale`,()=>`${c}${b?"."+b:""}.vScale`]}}}const R={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:c=>{var b,A;return new o.h((null===(b=c._babylonCamera)||void 0===b?void 0:b.orthoLeft)??0,(null===(A=c._babylonCamera)||void 0===A?void 0:A.orthoRight)??0)},set:(c,b)=>{b._babylonCamera&&(b._babylonCamera.orthoLeft=c.x,b._babylonCamera.orthoRight=c.y)},getTarget:c=>c,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:c=>{var b,A;return new o.h((null===(b=c._babylonCamera)||void 0===b?void 0:b.orthoBottom)??0,(null===(A=c._babylonCamera)||void 0===A?void 0:A.orthoTop)??0)},set:(c,b)=>{b._babylonCamera&&(b._babylonCamera.orthoBottom=c.x,b._babylonCamera.orthoTop=c.y)},getTarget:c=>c,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:c=>{var b;return null===(b=c._babylonCamera)||void 0===b?void 0:b.maxZ},set:(c,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=c)},getTarget:c=>c,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:c=>{var b;return null===(b=c._babylonCamera)||void 0===b?void 0:b.Vj},set:(c,b)=>{b._babylonCamera&&(b._babylonCamera.Vj=c)},getTarget:c=>c,getPropertyName:[()=>"Vj"]}},perspective:{aspectRatio:{type:"number",get:c=>{var b;return null===(b=c._babylonCamera)||void 0===b?void 0:b.getEngine().getAspectRatio(c._babylonCamera)},getTarget:c=>c,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:c=>{var b;return null===(b=c._babylonCamera)||void 0===b?void 0:b.fov},set:(c,b)=>{b._babylonCamera&&(b._babylonCamera.fov=c)},getTarget:c=>c,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:c=>{var b;return null===(b=c._babylonCamera)||void 0===b?void 0:b.maxZ},set:(c,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=c)},getTarget:c=>c,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:c=>{var b;return null===(b=c._babylonCamera)||void 0===b?void 0:b.Vj},set:(c,b)=>{b._babylonCamera&&(b._babylonCamera.Vj=c)},getTarget:c=>c,getPropertyName:[()=>"Vj"]}}}},nodes:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ak",get:c=>{var b;return null===(b=c._babylonTransformNode)||void 0===b?void 0:b.position},set:(c,b)=>{var A;return null===(A=b._babylonTransformNode)||void 0===A?void 0:A.position.p(c)},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:c=>{var b;return null===(b=c._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion},set:(c,b)=>{var A,o;return null===(A=b._babylonTransformNode)||void 0===A||null===(o=A.rotationQuaternion)||void 0===o?void 0:o.p(c)},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ak",get:c=>{var b;return null===(b=c._babylonTransformNode)||void 0===b?void 0:b.ld},set:(c,b)=>{var A;return null===(A=b._babylonTransformNode)||void 0===A?void 0:A.ld.p(c)},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"ld"]},weights:{length:{type:"number",get:c=>c._numMorphTargets,getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(c,b)=>{var A,o;return void 0!==b?null===(A=c._primitiveBabylonMeshes)||void 0===A||null===(o=A[0].morphTargetManager)||void 0===o?void 0:o.getTarget(b).influence:void 0},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(c,b)=>[0],getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:c=>{var b,A,t;return o.b.Compose(null===(b=c._babylonTransformNode)||void 0===b?void 0:b.ld,null===(A=c._babylonTransformNode)||void 0===A?void 0:A.rotationQuaternion,null===(t=c._babylonTransformNode)||void 0===t?void 0:t.position)},getTarget:c=>c._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:c=>{var b,A,t,n;const h=o.b.Identity();let s=c.parent;for(;s&&s.parent;)s=s.parent;const L=(null===(b=c._babylonTransformNode)||void 0===b?void 0:b.position._isDirty)||(null===(A=c._babylonTransformNode)||void 0===A||null===(t=A.rotationQuaternion)||void 0===t?void 0:t._isDirty)||(null===(n=c._babylonTransformNode)||void 0===n?void 0:n.ld._isDirty);if(s){var C;const b=null===(C=s._babylonTransformNode)||void 0===C?void 0:C.Zj(!0).invert();var J,X;if(b)null===(J=c._babylonTransformNode)||void 0===J||null===(X=J.Zj(L))||void 0===X||X.multiplyToRef(b,h)}else c._babylonTransformNode&&h.p(c._babylonTransformNode.Zj(L));return h},getTarget:c=>c._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:c=>{var b,A;return null===(b=c._babylonTransformNode)||void 0===b||null===(A=b.getChildren((c=>c instanceof h.d),!0)[0])||void 0===A?void 0:A.cb},getTarget:c=>{var b;return null===(b=c._babylonTransformNode)||void 0===b?void 0:b.getChildren((c=>c instanceof h.d),!0)[0]},set:(c,b)=>{if(b._babylonTransformNode){const A=b._babylonTransformNode.getChildren((c=>c instanceof h.d),!0)[0];A&&(A.cb=c)}}},color:{type:"rk",get:c=>{var b,A;return null===(b=c._babylonTransformNode)||void 0===b||null===(A=b.getChildren((c=>c instanceof h.d),!0)[0])||void 0===A?void 0:A.fb},getTarget:c=>{var b;return null===(b=c._babylonTransformNode)||void 0===b?void 0:b.getChildren((c=>c instanceof h.d),!0)[0]},set:(c,b)=>{if(b._babylonTransformNode){const A=b._babylonTransformNode.getChildren((c=>c instanceof h.d),!0)[0];A&&(A.fb=c)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"rk",get:(c,b,A)=>J(c,b,A).emissiveColor,set:(c,b,A,o)=>J(b,A,o).emissiveColor.p(c),getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:X("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(c,b,A)=>{var o;return null===(o=C(c,A,"bumpTexture"))||void 0===o?void 0:o.level},set:(c,b,A,o)=>{const t=C(b,o,"bumpTexture");t&&(t.level=c)},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:X("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(c,b,A)=>J(c,b,A).ambientTextureStrength,set:(c,b,A,o)=>{const t=J(b,A,o);t&&(t.ambientTextureStrength=c)},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:X("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"sk",get:(c,b,A)=>{const o=J(c,b,A);return n.h.FromColor3(o.albedoColor,o.alpha)},set:(c,b,A,o)=>{const t=J(b,A,o);t.albedoColor.set(c.r,c.g,c.b),t.alpha=c.a},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:X("albedoTexture")}},metallicFactor:{type:"number",get:(c,b,A)=>J(c,b,A).metallic,set:(c,b,A,o)=>{const t=J(b,A,o);t&&(t.metallic=c)},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(c,b,A)=>J(c,b,A).roughness,set:(c,b,A,o)=>{const t=J(b,A,o);t&&(t.roughness=c)},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:X("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(c,b,A)=>J(c,b,A).anisotropy.cb,set:(c,b,A,o)=>{J(b,A,o).anisotropy.cb=c},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(c,b,A)=>J(c,b,A).anisotropy.angle,set:(c,b,A,o)=>{J(b,A,o).anisotropy.angle=c},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:X("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(c,b,A)=>J(c,b,A).clearCoat.cb,set:(c,b,A,o)=>{J(b,A,o).clearCoat.cb=c},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(c,b,A)=>J(c,b,A).clearCoat.roughness,set:(c,b,A,o)=>{J(b,A,o).clearCoat.roughness=c},getTarget:(c,b,A)=>J(c,b,A),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:X("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(c,b,A)=>{var o;return null===(o=J(c,b,A).clearCoat.bumpTexture)||void 0===o?void 0:o.level},getTarget:J,set:(c,b,A,o)=>J(b,A,o).clearCoat.bumpTexture.level=c},extensions:{KHR_texture_transform:X("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:X("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(c,b,A)=>J(c,b,A).subSurface.dispersion,getTarget:J,set:(c,b,A,o)=>J(b,A,o).subSurface.dispersion=c}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(c,b,A)=>J(c,b,A).emissiveIntensity,getTarget:J,set:(c,b,A,o)=>J(b,A,o).emissiveIntensity=c}},KHR_materials_ior:{ior:{type:"number",get:(c,b,A)=>J(c,b,A).indexOfRefraction,getTarget:J,set:(c,b,A,o)=>J(b,A,o).indexOfRefraction=c}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(c,b,A)=>J(c,b,A).iridescence.cb,getTarget:J,set:(c,b,A,o)=>J(b,A,o).iridescence.cb=c},iridescenceIor:{type:"number",get:(c,b,A)=>J(c,b,A).iridescence.indexOfRefraction,getTarget:J,set:(c,b,A,o)=>J(b,A,o).iridescence.indexOfRefraction=c},iridescenceTexture:{extensions:{KHR_texture_transform:X("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(c,b,A)=>J(c,b,A).iridescence.maximumThickness,getTarget:J,set:(c,b,A,o)=>J(b,A,o).iridescence.maximumThickness=c},iridescenceThicknessMinimum:{type:"number",get:(c,b,A)=>J(c,b,A).iridescence.minimumThickness,getTarget:J,set:(c,b,A,o)=>J(b,A,o).iridescence.minimumThickness=c},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:X("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"rk",get:(c,b,A)=>J(c,b,A).sheen.color,getTarget:J,set:(c,b,A,o)=>J(b,A,o).sheen.color.p(c)},sheenColorTexture:{extensions:{KHR_texture_transform:X("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(c,b,A)=>J(c,b,A).sheen.cb,getTarget:J,set:(c,b,A,o)=>J(b,A,o).sheen.cb=c},sheenRoughnessTexture:{extensions:{KHR_texture_transform:X("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(c,b,A)=>J(c,b,A).metallicF0Factor,getTarget:J,set:(c,b,A,o)=>J(b,A,o).metallicF0Factor=c,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"rk",get:(c,b,A)=>J(c,b,A).metallicReflectanceColor,getTarget:J,set:(c,b,A,o)=>J(b,A,o).metallicReflectanceColor.p(c),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:X("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:X("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(c,b,A)=>J(c,b,A).subSurface.refractionIntensity,getTarget:J,set:(c,b,A,o)=>J(b,A,o).subSurface.refractionIntensity=c,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:X("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(c,b,A)=>J(c,b,A).subSurface.translucencyIntensity,getTarget:J,set:(c,b,A,o)=>J(b,A,o).subSurface.translucencyIntensity=c},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:X("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"rk",get:(c,b,A)=>J(c,b,A).subSurface.translucencyColor,getTarget:J,set:(c,b,A,o)=>{var t;return c&&(null===(t=J(b,A,o).subSurface.translucencyColor)||void 0===t?void 0:t.p(c))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:X("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"rk",get:(c,b,A)=>J(c,b,A).subSurface.tintColor,getTarget:J,set:(c,b,A,o)=>J(b,A,o).subSurface.tintColor.p(c)},attenuationDistance:{type:"number",get:(c,b,A)=>J(c,b,A).subSurface.tintColorAtDistance,getTarget:J,set:(c,b,A,o)=>J(b,A,o).subSurface.tintColorAtDistance=c},thicknessFactor:{type:"number",get:(c,b,A)=>J(c,b,A).subSurface.maximumThickness,getTarget:J,set:(c,b,A,o)=>J(b,A,o).subSurface.maximumThickness=c},thicknessTexture:{extensions:{KHR_texture_transform:X("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonLight)),getPropertyName:[c=>"length"]},__array__:{__target__:!0,color:{type:"rk",get:c=>{var b;return null===(b=c._babylonLight)||void 0===b?void 0:b.fb},set:(c,b)=>{var A;return null===(A=b._babylonLight)||void 0===A?void 0:A.fb.p(c)},getTarget:c=>c._babylonLight,getPropertyName:[c=>"diffuse"]},cb:{type:"number",get:c=>{var b;return null===(b=c._babylonLight)||void 0===b?void 0:b.cb},set:(c,b)=>b._babylonLight?b._babylonLight.cb=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"intensity"]},range:{type:"number",get:c=>{var b;return null===(b=c._babylonLight)||void 0===b?void 0:b.range},set:(c,b)=>b._babylonLight?b._babylonLight.range=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"range"]},spot:{innerConeAngle:{type:"number",get:c=>{var b;return null===(b=c._babylonLight)||void 0===b?void 0:b.innerAngle},set:(c,b)=>b._babylonLight?b._babylonLight.innerAngle=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"innerConeAngle"]},outerConeAngle:{type:"number",get:c=>{var b;return null===(b=c._babylonLight)||void 0===b?void 0:b.angle},set:(c,b)=>b._babylonLight?b._babylonLight.angle=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonLight)),getPropertyName:[c=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonTexture)),getPropertyName:[c=>"length"]},__array__:{__target__:!0,cb:{type:"number",get:c=>{var b;return null===(b=c._babylonTexture)||void 0===b?void 0:b.level},set:(c,b)=>{b._babylonTexture&&(b._babylonTexture.level=c)},getTarget:c=>c._babylonTexture},rotation:{type:"Quaternion",get:c=>{var b;return c._babylonTexture&&o.e.FromRotationMatrix(null===(b=c._babylonTexture)||void 0===b?void 0:b.getReflectionTextureMatrix())},set:(c,b)=>{var A;b._babylonTexture&&(null!==(A=b._babylonTexture.va())&&void 0!==A&&A.useRightHandedSystem||(c=o.e.Inverse(c)),o.b.FromQuaternionToRef(c,b._babylonTexture.getReflectionTextureMatrix()))},getTarget:c=>c._babylonTexture}}}}},animations:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>{var b;return null===(b=c.primitives[0]._instanceData)||void 0===b?void 0:b.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function N(c){return new L(c,R)}function k(c){const b=c.split("/").map((c=>c.replace(/{}/g,"__array__")));let A=R;for(const o of b)o&&(A=A[o]);if(A&&A.type&&A.get)return A}function E(c,b){const A=c.split("/").map((c=>c.replace(/{}/g,"__array__")));let o=R;for(const t of A)t&&(o=o[t]);o&&o.type&&o.get&&(o.interpolation=b)}function V(c,b){const A=c.split("/").map((c=>c.replace(/{}/g,"__array__")));let o=R;for(const t of A)if(t){if(!o[t]){if("?"===t){o.__ignoreObjectTree__=!0;continue}o[t]={},"__array__"===t&&(o[t].__target__=!0)}o=o[t]}Object.assign(o,b)}},12730:(c,b,A)=>{"use strict";A.r(b),A.d(b,{AnimationPropertyInfo:()=>C,TransformNodeAnimationPropertyInfo:()=>J,WeightAnimationPropertyInfo:()=>X,getQuaternion:()=>s,getVector3:()=>h,getWeights:()=>L});var o=A(11907),t=A(688),n=A(12718);function h(c,b,A,o){return t.k.$j(b,A).scaleInPlace(o)}function s(c,b,A,o){return t.e.$j(b,A).scaleInPlace(o)}function L(c,b,A,o){const t=new Array(c._numMorphTargets);for(let n=0;n<t.length;n++)t[n]=b[A++]*o;return t}class C{constructor(c,b,A,o){this.type=c,this.name=b,this.getValue=A,this.getStride=o}_buildAnimation(c,b,A){const t=new o.d(c,this.name,b,this.type);return t.setKeys(A),t}}class J extends C{buildAnimations(c,b,A,o){const t=[];return t.push({babylonAnimatable:c._babylonTransformNode,babylonAnimation:this._buildAnimation(b,A,o)}),t}}class X extends C{buildAnimations(c,b,A,t){const n=[];if(c._numMorphTargets)for(let h=0;h<c._numMorphTargets;h++){const s=new o.d(`${b}_${h}`,this.name,A,this.type);if(s.setKeys(t.map((c=>({frame:c.frame,inTangent:c.inTangent?c.inTangent[h]:void 0,value:c.value[h],outTangent:c.outTangent?c.outTangent[h]:void 0,interpolation:c.interpolation})))),c._primitiveBabylonMeshes)for(const b of c._primitiveBabylonMeshes)if(b.morphTargetManager){const c=b.morphTargetManager.getTarget(h),A=s.clone();c.animations.push(A),n.push({babylonAnimatable:c,babylonAnimation:A})}}return n}}(0,n.l)("/nodes/{}/translation",[new J(o.d.ANIMATIONTYPE_VECTOR3,"position",h,(()=>3))]),(0,n.l)("/nodes/{}/rotation",[new J(o.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",s,(()=>4))]),(0,n.l)("/nodes/{}/scale",[new J(o.d.ANIMATIONTYPE_VECTOR3,"ld",h,(()=>3))]),(0,n.l)("/nodes/{}/weights",[new X(o.d.ANIMATIONTYPE_FLOAT,"influence",L,(c=>c._numMorphTargets))])},12694:(c,b,A)=>{"use strict";class o{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((c,b)=>{this._resolve=c,this._reject=b}))}}var t=A(688),n=A(721),h=A(525),s=A(663),L=A(12696),C=A(12701),J=A(518),X=A(11833),R=A(11907),N=A(11915),k=A(550),E=A(531),V=A(534);class y{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(c){this._useTextureToStoreBoneMatrices=c,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(c){this._animationPropertiesOverride=c}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(c,b,A){this.name=c,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=t.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new J.b,this.bones=[],this._scene=A||k.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const o=this._scene.getEngine().getCaps();this._canUseTextureForBones=o.textureFloat&&o.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((c=>!c.getParent()))}getTransformMatrices(c){if(this.needInitialSkinMatrix){if(!c)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return c._bonesTransformMatrices||this.prepare(!0),c._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(c){return this.needInitialSkinMatrix&&c._transformMatrixTexture?c._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(c){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,c){b+=", Ranges: {";let c=!0;for(const A in this._ranges)c&&(b+=", ",c=!1),b+=A;b+="}"}return b}getBoneIndexByName(c){for(let b=0,A=this.bones.length;b<A;b++)if(this.bones[b].name===c)return b;return-1}createAnimationRange(c,b,A){if(!this._ranges[c]){this._ranges[c]=new N.c(c,b,A);for(let o=0,t=this.bones.length;o<t;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].createRange(c,b,A)}}deleteAnimationRange(c){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let A=0,o=this.bones.length;A<o;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].deleteRange(c,b);this._ranges[c]=null}getAnimationRange(c){return this._ranges[c]||null}getAnimationRanges(){const c=[];let b;for(b in this._ranges)c.push(this._ranges[b]);return c}copyAnimationRange(c,b){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!c.getAnimationRange(b))return!1;let o=!0;const t=this._getHighestAnimationFrame()+1,n={},h=c.bones;let s,L;for(L=0,s=h.length;L<s;L++)n[h[L].name]=h[L];this.bones.length!==h.length&&(E.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${h.length}`),o=!1);const C=A&&this.dimensionsAtRest&&c.dimensionsAtRest?this.dimensionsAtRest.divide(c.dimensionsAtRest):null;for(L=0,s=this.bones.length;L<s;L++){const c=this.bones[L].name,h=n[c];h?o=o&&this.bones[L].copyAnimationRange(h,b,t,A,C):(E.c.Warn("copyAnimationRange: not same rig, missing source bone "+c),o=!1)}const J=c.getAnimationRange(b);return J&&(this._ranges[b]=new N.c(b,J.from+t,J.to+t)),o}returnToRest(){for(const c of this.bones)-1!==c._index&&c.returnToRest()}_getHighestAnimationFrame(){let c=0;for(let b=0,A=this.bones.length;b<A;b++)if(this.bones[b].animations[0]){const A=this.bones[b].animations[0].getHighestFrame();c<A&&(c=A)}return c}beginAnimation(c,b,A,o){const t=this.getAnimationRange(c);return t?this._scene.beginAnimation(this,t.from,t.to,b,A,o):null}static MakeAnimationAdditive(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const o=c.getAnimationRange(A);if(!o)return null;const t=c._scene.getAllAnimatablesByTarget(c);let n=null;for(let s=0;s<t.length;s++){const c=t[s];if(c.fromFrame===(null===o||void 0===o?void 0:o.from)&&c.toFrame===(null===o||void 0===o?void 0:o.to)){n=c;break}}const h=c.getAnimatables();for(let s=0;s<h.length;s++){const c=h[s].animations;if(c)for(let o=0;o<c.length;o++)R.d.MakeAnimationAdditive(c[o],b,A)}return n&&(n.isAdditive=!0),c}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(c){this._meshesWithPoseMatrix.push(c)}_unregisterMeshWithPoseMatrix(c){const b=this._meshesWithPoseMatrix.indexOf(c);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(c,b){this.onBeforeComputeObservable.notifyObservers(this);for(let A=0;A<this.bones.length;A++){const o=this.bones[A];o._childUpdateId++;const t=o.getParent();if(t?o.getLocalMatrix().multiplyToRef(t.getFinalMatrix(),o.getFinalMatrix()):b?o.getLocalMatrix().multiplyToRef(b,o.getFinalMatrix()):o.getFinalMatrix().p(o.getLocalMatrix()),-1!==o._index){const b=null===o._index?A:o._index;o.getAbsoluteInverseBindMatrix().multiplyToArray(o.getFinalMatrix(),c,16*b)}}this._identity.copyToArray(c,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const c=this.va().getRenderId();if(this._currentRenderId===c)return;this._currentRenderId=c}if(this._numBonesWithLinkedTransformNode>0)for(const c of this.bones)if(c._linkedTransformNode){const b=c._linkedTransformNode;c.position=b.position,b.rotationQuaternion?c.rotationQuaternion=b.rotationQuaternion:c.rotation=b.rotation,c.ld=b.ld}if(this.needInitialSkinMatrix)for(const c of this._meshesWithPoseMatrix){const b=c.getPoseMatrix();let A=this._isDirty;if(c._bonesTransformMatrices&&c._bonesTransformMatrices.length===16*(this.bones.length+1)||(c._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),A=!0),A){if(this._synchronizedWithMesh!==c){this._synchronizedWithMesh=c;for(const c of this.bones)if(!c.getParent()){c.getBindMatrix().multiplyToRef(b,t.f.Matrix[1]),c._updateAbsoluteBindMatrices(t.f.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);c._transformMatrixTexture&&c._transformMatrixTexture.getSize().width===b||(c._transformMatrixTexture&&c._transformMatrixTexture.dispose(),c._transformMatrixTexture=X.d.CreateRGBATexture(c._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(c._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&c._transformMatrixTexture&&c._transformMatrixTexture.update(c._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=X.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let c=0;c<this.bones.length;c++)this._animatables.push(this.bones[c])}return this._animatables}clone(c,b){const A=new y(c,b||c,this._scene);A.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){const c=this.bones[o];let b=null;const t=c.getParent();if(t){const c=this.bones.indexOf(t);b=A.bones[c]}const n=new C.b(c.name,A,b,c.getBindMatrix().clone(),c.getRestMatrix().clone());n._index=c._index,c._linkedTransformNode&&n.linkTransformNode(c._linkedTransformNode),V.d.DeepCopy(c.animations,n.animations)}if(this._ranges){A._ranges={};for(const c in this._ranges){const b=this._ranges[c];b&&(A._ranges[c]=b.clone())}}return this._isDirty=!0,A.prepare(!0),A}enableBlending(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const b of this.bones)for(const A of b.animations)A.enableBlending=!0,A.blendingSpeed=c}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const c=this._parentContainer.skeletons.indexOf(this);c>-1&&this._parentContainer.skeletons.splice(c,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const c={};c.name=this.name,c.id=this.id,this.dimensionsAtRest&&(c.dimensionsAtRest=this.dimensionsAtRest.hk()),c.bones=[],c.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){var b;const o=this.bones[A],t=o.getParent(),n={parentBoneIndex:t?this.bones.indexOf(t):-1,index:o.getIndex(),name:o.name,id:o.id,matrix:o.getBindMatrix().hk(),rest:o.getRestMatrix().hk(),linkedTransformNodeId:null===(b=o.getTransformNode())||void 0===b?void 0:b.id};c.bones.push(n),o.length&&(n.length=o.length),o.metadata&&(n.metadata=o.metadata),o.animations&&o.animations.length>0&&(n.animation=o.animations[0].serialize()),c.ranges=[];for(const b in this._ranges){const A=this._ranges[b];if(!A)continue;const o={};o.name=b,o.from=A.from,o.to=A.to,c.ranges.push(o)}}return c}static Parse(c,b){const A=new y(c.name,c.id,b);let o;for(c.dimensionsAtRest&&(A.dimensionsAtRest=t.k.$j(c.dimensionsAtRest)),A.needInitialSkinMatrix=c.needInitialSkinMatrix,o=0;o<c.bones.length;o++){const b=c.bones[o],n=c.bones[o].index;let h=null;b.parentBoneIndex>-1&&(h=A.bones[b.parentBoneIndex]);const s=b.rest?t.b.$j(b.rest):null,L=new C.b(b.name,A,h,t.b.$j(b.matrix),s,null,n);void 0!==b.id&&null!==b.id&&(L.id=b.id),b.length&&(L.length=b.length),b.metadata&&(L.metadata=b.metadata),b.animation&&L.animations.push(R.d.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(A._hasWaitingData=!0,L._waitingTransformNodeId=b.linkedTransformNodeId)}if(c.ranges)for(o=0;o<c.ranges.length;o++){const b=c.ranges[o];A.createAnimationRange(b.name,b.from,b.to)}return A}computeAbsoluteMatrices(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||c)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(c)}getPoseMatrix(){let c=null;return this._meshesWithPoseMatrix.length>0&&(c=this._meshesWithPoseMatrix[0].getPoseMatrix()),c}sortBones(){const c=[],b=new Array(this.bones.length);for(let A=0;A<this.bones.length;A++)this._sortBones(A,c,b);this.bones=c}_sortBones(c,b,A){if(A[c])return;A[c]=!0;const o=this.bones[c];if(!o)return;void 0===o._index&&(o._index=c);const t=o.getParent();t&&this._sortBones(this.bones.indexOf(t),b,A),b.push(o)}setCurrentPoseAsRest(){for(const c of this.bones)c.setCurrentPoseAsRest()}}var j=A(852),F=A(11847),M=A(2070),W=A(830),d=A(747),r=A(808),z=A(821),Y=A(510),D=A(11917),f=A(684),v=A(12659);class G{set areUpdatesFrozen(c){c?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new f.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,c||(c=k.c.LastCreatedScene),this._scene=c,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const c=this._scene.getEngine().getCaps();this._canUseTextureForTargets=c.canUseGLVertexID&&c.textureFloat&&c.maxVertexTextureImageUnits>0&&c.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return G.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?G.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(c){this._numMaxInfluencers!==c&&(this._numMaxInfluencers=c,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(c){this._useTextureToStoreTargets!==c&&(this._useTextureToStoreTargets=c,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var c;return G.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(c=this._scene)&&void 0!==c&&c.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(c){return this._activeTargets.data[c]}getTarget(c){return this._targets[c]}getTargetByName(c){for(const b of this._targets)if(b.name===c)return b;return null}addTarget(c){this._targets.push(c),this._targetInfluenceChangedObservers.push(c.onInfluenceChanged.add((c=>{this.areUpdatesFrozen&&c&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(c)}))),this._targetDataLayoutChangedObservers.push(c._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(c){const b=this._targets.indexOf(c);b>=0&&(this._targets.splice(b,1),c.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),c._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(c)}_bind(c){c.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),c.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),c.setTexture("morphTargets",this._targetStoreTexture),c.setInt("morphTargetCount",this.numInfluencers)}clone(){const c=new G(this._scene);for(const b of this._targets)c.addTarget(b.clone());return c.enablePositionMorphing=this.enablePositionMorphing,c.enableNormalMorphing=this.enableNormalMorphing,c.enableTangentMorphing=this.enableTangentMorphing,c.enableUVMorphing=this.enableUVMorphing,c.enableUV2Morphing=this.enableUV2Morphing,c.enableColorMorphing=this.enableColorMorphing,c}serialize(){const c={};c.id=this.uniqueId,c.targets=[];for(const b of this._targets)c.targets.push(b.serialize());return c}_syncActiveTargets(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const b=!!this._targetStoreTexture,A=this.isUsingTextureForTargets;(this._mustSynchronize||b!==A)&&(this._mustSynchronize=!1,this.synchronize());let o=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let t=-1;for(const n of this._targets)if(t++,0!==n.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=G.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(n),this._morphTargetTextureIndices[o]=t,this._tempInfluences[o++]=n.influence}this._morphTargetTextureIndices.length!==o&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,o)),this._influences&&this._influences.length===o||(this._influences=new Float32Array(o));for(let n=0;n<o;n++)this._influences[n]=this._tempInfluences[n];if(c&&this._scene)for(const n of this._scene.meshes)n.morphTargetManager===this&&(A?n._markSubMeshesAsAttributesDirty():n._syncGeometryWithMorphTargetManager())}synchronize(){var c;if(!this._scene||this.areUpdatesFrozen)return;const b=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(c=this._targetStoreTexture)||void 0===c||c.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>b.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const A of this._targets){this._supportsPositions=this._supportsPositions&&A.hasPositions,this._supportsNormals=this._supportsNormals&&A.hasNormals,this._supportsTangents=this._supportsTangents&&A.hasTangents,this._supportsUVs=this._supportsUVs&&A.hasUVs,this._supportsUV2s=this._supportsUV2s&&A.hasUV2s,this._supportsColors=this._supportsColors&&A.hasColors;const c=A.vertexCount;if(0===this._vertexCount)this._vertexCount=c;else if(this._vertexCount!==c)return void E.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${A.name}": ${c}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const c=b.getCaps().maxTextureSize;this._textureWidth>c&&(this._textureHeight=Math.ceil(this._textureWidth/c),this._textureWidth=c);const A=this._targets.length,o=new Float32Array(A*this._textureWidth*this._textureHeight*4);let t=0;for(let b=0;b<A;b++){const c=this._targets[b],A=c.getPositions(),n=c.getNormals(),h=c.getUVs(),s=c.getTangents(),L=c.getUV2s(),C=c.getColors();t=b*this._textureWidth*this._textureHeight*4;for(let b=0;b<this._vertexCount;b++)this._supportsPositions&&A&&(o[t]=A[3*b],o[t+1]=A[3*b+1],o[t+2]=A[3*b+2],t+=4),this._supportsNormals&&n&&(o[t]=n[3*b],o[t+1]=n[3*b+1],o[t+2]=n[3*b+2],t+=4),this._supportsUVs&&h&&(o[t]=h[2*b],o[t+1]=h[2*b+1],t+=4),this._supportsTangents&&s&&(o[t]=s[3*b],o[t+1]=s[3*b+1],o[t+2]=s[3*b+2],t+=4),this._supportsUV2s&&L&&(o[t]=L[2*b],o[t+1]=L[2*b+1],t+=4),this._supportsColors&&C&&(o[t]=C[4*b],o[t+1]=C[4*b+1],o[t+2]=C[4*b+2],o[t+3]=C[4*b+3],t+=4)}this._targetStoreTexture=v.d.CreateRGBATexture(o,this._textureWidth,this._textureHeight,A,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const A of this._scene.meshes)A.morphTargetManager===this&&A._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const c=this._parentContainer.morphTargetManagers.indexOf(this);c>-1&&this._parentContainer.morphTargetManagers.splice(c,1),this._parentContainer=null}for(const c of this._targets)this._scene.stopAnimation(c)}}static Parse(c,b){const A=new G(b);for(const o of c.targets)A.addTarget(D.b.Parse(o,b));return A}}G.EnableTextureStorage=!0,G.MaxActiveMorphTargetsInVertexAttributeMode=8,G.ConstantTargetCountForTextureMode=0;var P=A(12703),O=A(552),p=A(773);const q=new Map,I=q;function K(c,b,A){Z(c)&&E.c.Warn(`Extension with the name '${c}' already exists`),q.set(c,{isGLTFExtension:b,factory:A})}function Z(c){return q.delete(c)}var H=A(12718),S=A(11955),B=A(758);class Q{static Get(c,b,A){if(!b||void 0==A||!b[A])throw new Error(`${c}: Failed to find index (${A})`);return b[A]}static TryGet(c,b){return c&&void 0!=b&&c[b]?c[b]:null}static Assign(c){if(c)for(let b=0;b<c.length;b++)c[b].index=b}}function a(c){if(c.min&&c.max){const b=c.min,A=c.max,o=t.f.ak[0].jd(b[0],b[1],b[2]),n=t.f.ak[1].jd(A[0],A[1],A[2]);if(c.normalized&&5126!==c.componentType){let b=1;switch(c.componentType){case 5120:b=127;break;case 5121:b=255;break;case 5122:b=32767;break;case 5123:b=65535}const A=1/b;o.scaleInPlace(A),n.scaleInPlace(A)}return new p.b(o,n)}return null}class l{static RegisterExtension(c,b){K(c,!1,b)}static UnregisterExtension(c){return Z(c)}get Lk(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(c){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=c}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((c=>c.dispose&&c.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(c,b,A,o,t,n){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=b,this._assetContainer=A,this._loadData(o);let n=null;if(c){const b={};if(this._gltf.nodes)for(const c of this._gltf.nodes)c.name&&(b[c.name]=c.index);n=(c instanceof Array?c:[c]).map((c=>{const A=b[c];if(void 0===A)throw new Error(`Failed to find node '${c}'`);return A}))}return await this._loadAsync(t,h,n,(()=>({meshes:this._getMeshes(),xk:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(c,b,A,o){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=c,this._loadData(b),await this._loadAsync(A,t,null,(()=>{}))}async _loadAsync(c,b,A,o){return await Promise.resolve().then((async()=>{this._rootUrl=c,this._uniqueRootUrl=!c.startsWith("file:")&&b?c:`${c}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const t=`${P.i[P.i.LOADING]} => ${P.i[P.i.READY]}`,n=`${P.i[P.i.LOADING]} => ${P.i[P.i.COMPLETE]}`;this._parent._startPerformanceCounter(t),this._parent._startPerformanceCounter(n),this._parent._setState(P.i.LOADING),this._extensionsOnLoading();const s=new Array;if(!this.parent.loadOnlyMaterials)if(A)s.push(this.loadSceneAsync("/nodes",{nodes:A,index:-1}));else if(void 0!=this._gltf.yd||this._gltf.scenes&&this._gltf.scenes[0]){const c=Q.Get("/scene",this._gltf.scenes,this._gltf.yd||0);s.push(this.loadSceneAsync(`/scenes/${c.index}`,c))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let c=0;c<this._gltf.materials.length;++c){const b=this._gltf.materials[c],A="/materials/"+c,o=j.b.TriangleFillMode;s.push(this._loadMaterialAsync(A,b,null,o,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&s.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&s.push(this._compileShadowGeneratorsAsync());const L=Promise.all(s).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.jc(!0);for(const c of this._babylonScene.materials){const b=c;void 0!==b.maxSimultaneousLights&&(b.maxSimultaneousLights=Math.max(b.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(P.i.READY),this._skipStartAnimationStep||this._startAnimations(),o()}));return await L.then((c=>(this._parent._endPerformanceCounter(t),h.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(n),this._parent._setState(P.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(c=>{this._parent.onErrorObservable.notifyObservers(c),this._parent.onErrorObservable.clear(),this.dispose()}))})),c)))})).catch((c=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(c),this._parent.onErrorObservable.clear(),this.dispose()),c}))}_loadData(c){if(this._gltf=c.json,this._setupData(),c.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const A=b[0];(A.byteLength<c.bin.byteLength-3||A.byteLength>c.bin.byteLength)&&E.c.Warn(`Binary buffer length (${A.byteLength}) from JSON does not match chunk length (${c.bin.byteLength})`),this._bin=c.bin}else E.c.Warn("Unexpected BIN chunk")}}_setupData(){if(Q.Assign(this._gltf.accessors),Q.Assign(this._gltf.animations),Q.Assign(this._gltf.buffers),Q.Assign(this._gltf.bufferViews),Q.Assign(this._gltf.cameras),Q.Assign(this._gltf.images),Q.Assign(this._gltf.materials),Q.Assign(this._gltf.meshes),Q.Assign(this._gltf.nodes),Q.Assign(this._gltf.samplers),Q.Assign(this._gltf.scenes),Q.Assign(this._gltf.skins),Q.Assign(this._gltf.textures),this._gltf.nodes){const c={};for(const A of this._gltf.nodes)if(A.children)for(const b of A.children)c[b]=A.index;const b=this._createRootNode();for(const A of this._gltf.nodes){const o=c[A.index];A.parent=void 0===o?b:this._gltf.nodes[o]}}}async _loadExtensionsAsync(){const c=[];if(I.forEach(((b,A)=>{var o;!1===(null===(o=this.parent.extensionOptions[A])||void 0===o?void 0:o.enabled)?b.isGLTFExtension&&this.isExtensionUsed(A)&&E.c.Warn(`Extension ${A} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(A)||c.push((async()=>{const c=await b.factory(this);return c.name!==A&&E.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${c.name} !== ${A}`),this._parent.onExtensionLoadedObservable.notifyObservers(c),c})())})),this._extensions.push(...await Promise.all(c)),this._extensions.sort(((c,b)=>(c.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const A of this._gltf.extensionsRequired){if(!this._extensions.some((c=>c.name===A&&c.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[A])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${A} is disabled`);throw new Error(`Required extension ${A} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new Y.d("__root__",this._babylonScene);this._rootBabylonMesh=c,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.jc(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case P.h.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],l._LoadTransform(b,this._rootBabylonMesh));break;case P.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(c),b}loadSceneAsync(c,b){const A=this._extensionsLoadSceneAsync(c,b);if(A)return A;const o=new Array;if(this.logOpen(`${c} ${b.name||""}`),b.nodes)for(const t of b.nodes){const b=Q.Get(`${c}/nodes/${t}`,this._gltf.nodes,t);o.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(c=>{c.parent=this._rootBabylonMesh})))}for(const t of this._postSceneLoadActions)t();return o.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(o).then((()=>{}))}_forEachPrimitive(c,b){if(c._primitiveBabylonMeshes)for(const A of c._primitiveBabylonMeshes)b(A)}_getGeometries(){const c=[],b=this._gltf.nodes;if(b)for(const A of b)this._forEachPrimitive(A,(b=>{const A=b.mk;A&&-1===c.indexOf(A)&&c.push(A)}));return c}_getMeshes(){const c=[];this._rootBabylonMesh instanceof z.d&&c.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const A of b)this._forEachPrimitive(A,(b=>{c.push(b)}));return c}_getTransformNodes(){const c=[],b=this._gltf.nodes;if(b)for(const A of b)A._babylonTransformNode&&"Kk"===A._babylonTransformNode.getClassName()&&c.push(A._babylonTransformNode),A._babylonTransformNodeForSkin&&c.push(A._babylonTransformNodeForSkin);return c}_getSkeletons(){const c=[],b=this._gltf.skins;if(b)for(const A of b)A._data&&c.push(A._data.babylonSkeleton);return c}_getAnimationGroups(){const c=[],b=this._gltf.animations;if(b)for(const A of b)A._babylonAnimationGroup&&c.push(A._babylonAnimationGroup);return c}_startAnimations(){switch(this._parent.animationStartMode){case P.e.NONE:break;case P.e.FIRST:{const c=this._getAnimationGroups();0!==c.length&&c[0].start(!0);break}case P.e.ALL:{const c=this._getAnimationGroups();for(const b of c)b.start(!0);break}default:return void E.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadNodeAsync(c,b,A);if(o)return o;if(b._babylonTransformNode)throw new Error(`${c}: Invalid recursive node hierarchy`);const t=new Array;this.logOpen(`${c} ${b.name||""}`);const n=o=>{if(l.AddPointerMetadata(o,c),l._LoadTransform(b,o),void 0!=b.camera){const A=Q.Get(`${c}/camera`,this._gltf.cameras,b.camera);t.push(this.loadCameraAsync(`/cameras/${A.index}`,A,(c=>{c.parent=o,this._babylonScene.useRightHandedSystem||(o.ld.x=-1)})))}if(b.children)for(const A of b.children){const b=Q.Get(`${c}/children/${A}`,this._gltf.nodes,A);t.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(c=>{c.parent=o})))}A(o)},h=void 0!=b.mesh,s=this._parent.loadSkins&&void 0!=b.skin;if(!h||s){const c=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new W.e(c,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=A:b._babylonTransformNodeForSkin=A,n(A)}if(h)if(s){const A=Q.Get(`${c}/mesh`,this._gltf.meshes,b.mesh);t.push(this._loadMeshAsync(`/meshes/${A.index}`,b,A,(A=>{const o=b._babylonTransformNodeForSkin;A.metadata=(0,S.e)(o.metadata,A.metadata||{});const n=Q.Get(`${c}/skin`,this._gltf.skins,b.skin);t.push(this._loadSkinAsync(`/skins/${n.index}`,b,n,(c=>{this._forEachPrimitive(b,(b=>{b.skeleton=c})),this._postSceneLoadActions.push((()=>{if(void 0!=n.skeleton){const c=Q.Get(`/skins/${n.index}/skeleton`,this._gltf.nodes,n.skeleton).parent;b.index===c.index?A.parent=o.parent:A.parent=c._babylonTransformNode}else A.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:o,skinnedNode:A})}))})))})))}else{const A=Q.Get(`${c}/mesh`,this._gltf.meshes,b.mesh);t.push(this._loadMeshAsync(`/meshes/${A.index}`,b,A,n))}return this.logClose(),Promise.all(t).then((()=>(this._forEachPrimitive(b,(c=>{const b=c;!b.isAnInstance&&b.mk&&b.mk.useBoundingInfoFromGeometry?c.Ea():c.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(c,b,A,o){const t=A.primitives;if(!t||!t.length)throw new Error(`${c}: Primitives are missing`);void 0==t[0].index&&Q.Assign(t);const n=new Array;this.logOpen(`${c} ${A.name||""}`);const h=b.name||`node${b.index}`;if(1===t.length){const o=A.primitives[0];n.push(this._loadMeshPrimitiveAsync(`${c}/primitives/${o.index}`,h,b,A,o,(c=>{b._babylonTransformNode=c,b._primitiveBabylonMeshes=[c]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new W.e(h,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const o of t)n.push(this._loadMeshPrimitiveAsync(`${c}/primitives/${o.index}`,`${h}_primitive${o.index}`,b,A,o,(c=>{c.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(c)})))}return o(b._babylonTransformNode),this.logClose(),Promise.all(n).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(c,b,A,o,t,n){const h=this._extensionsLoadMeshPrimitiveAsync(c,b,A,o,t,n);if(h)return h;this.logOpen(`${c}`);const s=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==A.skin&&!o.primitives[0].targets;let L,C;if(s&&t._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,L=t._instanceData.babylonSourceMesh.createInstance(b),L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C=t._instanceData.promise;else{const n=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new Y.d(b,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.sideOrientation=this._babylonScene.useRightHandedSystem?j.b.CounterClockWiseSideOrientation:j.b.ClockWiseSideOrientation,this._createMorphTargets(c,A,o,t,h),n.push(this._loadVertexDataAsync(c,t,h).then((async b=>await this._loadMorphTargetsAsync(c,t,h,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.Ca(h),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const J=l._GetDrawMode(c,t.mode);if(void 0==t.material){let c=this._defaultBabylonMaterialData[J];c||(c=this._createDefaultMaterial("__GLTFLoader._default",J),this._parent.onMaterialLoadedObservable.notifyObservers(c),this._defaultBabylonMaterialData[J]=c),h.material=c}else if(!this.parent.skipMaterials){const b=Q.Get(`${c}/material`,this._gltf.materials,t.material);n.push(this._loadMaterialAsync(`/materials/${b.index}`,b,h,J,(c=>{h.material=c})))}C=Promise.all(n),s&&(t._instanceData={babylonSourceMesh:h,promise:C}),L=h}return l.AddPointerMetadata(L,c),this._parent.onMeshLoadedObservable.notifyObservers(L),n(L),this.logClose(),C.then((()=>L))}_loadVertexDataAsync(c,b,A){const o=this._extensionsLoadVertexDataAsync(c,b,A);if(o)return o;const t=b.attributes;if(!t)throw new Error(`${c}: Attributes are missing`);const n=new Array,h=new r.c(A.name,this._babylonScene);if(void 0==b.indices)A.isUnIndexed=!0;else{const A=Q.Get(`${c}/indices`,this._gltf.accessors,b.indices);n.push(this._loadIndicesAccessorAsync(`/accessors/${A.index}`,A).then((c=>{h.setIndices(c)})))}const s=(b,o,s)=>{if(void 0==t[b])return;A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(o)&&A._delayInfo.push(o);const L=Q.Get(`${c}/attributes/${b}`,this._gltf.accessors,t[b]);n.push(this._loadVertexAccessorAsync(`/accessors/${L.index}`,L,o).then((c=>{if(c.getKind()===d.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!A.skeleton){const c=a(L);c&&(h._boundingInfo=c,h.useBoundingInfoFromGeometry=!0)}h.setVerticesBuffer(c,L.count)}))),o==d.f.MatricesIndicesExtraKind&&(A.numBoneInfluencers=8),s&&s(L)};return s("POSITION",d.f.PositionKind),s("NORMAL",d.f.NormalKind),s("TANGENT",d.f.TangentKind),s("TEXCOORD_0",d.f.UVKind),s("TEXCOORD_1",d.f.UV2Kind),s("TEXCOORD_2",d.f.UV3Kind),s("TEXCOORD_3",d.f.UV4Kind),s("TEXCOORD_4",d.f.UV5Kind),s("TEXCOORD_5",d.f.UV6Kind),s("JOINTS_0",d.f.MatricesIndicesKind),s("WEIGHTS_0",d.f.MatricesWeightsKind),s("JOINTS_1",d.f.MatricesIndicesExtraKind),s("WEIGHTS_1",d.f.MatricesWeightsExtraKind),s("COLOR_0",d.f.ColorKind,(c=>{"VEC4"===c.type&&(A.hasVertexAlpha=!0)})),Promise.all(n).then((()=>h))}_createMorphTargets(c,b,A,o,t){if(!o.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=o.targets.length;else if(o.targets.length!==b._numMorphTargets)throw new Error(`${c}: Primitives do not have the same number of targets`);const n=A.extras?A.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,t.morphTargetManager=new G(this._babylonScene),t.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.morphTargetManager.areUpdatesFrozen=!0;for(let h=0;h<o.targets.length;h++){const c=b.weights?b.weights[h]:A.weights?A.weights[h]:0,o=n?n[h]:`morphTarget${h}`;t.morphTargetManager.addTarget(new D.b(o,c,t.va()))}}_loadMorphTargetsAsync(c,b,A,o){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const t=new Array,n=A.morphTargetManager;for(let h=0;h<n.numTargets;h++){const A=n.getTarget(h);t.push(this._loadMorphTargetVertexDataAsync(`${c}/targets/${h}`,o,b.targets[h],A))}return Promise.all(t).then((()=>{n.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(c,b,A,o){const t=new Array,n=(o,n,h)=>{if(void 0==A[o])return;const s=b.getVertexBuffer(n);if(!s)return;const L=Q.Get(`${c}/${o}`,this._gltf.accessors,A[o]);t.push(this._loadFloatAccessorAsync(`/accessors/${L.index}`,L).then((c=>{h(s,c)})))};return n("POSITION",d.f.PositionKind,((c,b)=>{const A=new Float32Array(b.length);c.forEach(b.length,((c,o)=>{A[o]=b[o]+c})),o.setPositions(A)})),n("NORMAL",d.f.NormalKind,((c,b)=>{const A=new Float32Array(b.length);c.forEach(A.length,((c,o)=>{A[o]=b[o]+c})),o.setNormals(A)})),n("TANGENT",d.f.TangentKind,((c,b)=>{const A=new Float32Array(b.length/3*4);let t=0;c.forEach(b.length/3*4,((c,o)=>{(o+1)%4!==0&&(A[t]=b[t]+c,t++)})),o.setTangents(A)})),n("TEXCOORD_0",d.f.UVKind,((c,b)=>{const A=new Float32Array(b.length);c.forEach(b.length,((c,o)=>{A[o]=b[o]+c})),o.setUVs(A)})),n("TEXCOORD_1",d.f.UV2Kind,((c,b)=>{const A=new Float32Array(b.length);c.forEach(b.length,((c,o)=>{A[o]=b[o]+c})),o.setUV2s(A)})),n("COLOR_0",d.f.ColorKind,((b,A)=>{let t=null;const n=b.getSize();if(3===n){t=new Float32Array(A.length/3*4),b.forEach(A.length,((c,b)=>{const o=Math.floor(b/3),n=b%3;t[4*o+n]=A[3*o+n]+c}));for(let c=0;c<A.length/3;++c)t[4*c+3]=1}else{if(4!==n)throw new Error(`${c}: Invalid number of components (${n}) for COLOR_0 attribute`);t=new Float32Array(A.length),b.forEach(A.length,((c,b)=>{t[b]=A[b]+c}))}o.setColors(t)})),await Promise.all(t).then((()=>{}))}static _LoadTransform(c,b){if(void 0!=c.skin)return;let A=t.k.Zero(),o=t.e.Identity(),n=t.k.One();if(c.matrix){t.b.$j(c.matrix).decompose(n,o,A)}else c.translation&&(A=t.k.$j(c.translation)),c.rotation&&(o=t.e.$j(c.rotation)),c.scale&&(n=t.k.$j(c.scale));b.position=A,b.rotationQuaternion=o,b.ld=n}_loadSkinAsync(c,b,A,o){if(!this._parent.loadSkins)return Promise.resolve();const t=this._extensionsLoadSkinAsync(c,b,A);if(t)return t;if(A._data)return o(A._data.babylonSkeleton),A._data.promise;const n=`skeleton${A.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new y(A.name||n,n,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(c,A,h);const s=this._loadSkinInverseBindMatricesDataAsync(c,A).then((c=>{this._updateBoneMatrices(h,c)}));return A._data={babylonSkeleton:h,promise:s},o(h),s}_loadBones(c,b,A){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const A=this._findSkeletonRootNode(`${c}/joints`,b.joints);if(A)if(void 0===b.skeleton)b.skeleton=A.index;else{const o=(c,b)=>{for(;b.parent;b=b.parent)if(b.parent===c)return!0;return!1},t=Q.Get(`${c}/skeleton`,this._gltf.nodes,b.skeleton);t===A||o(t,A)||(E.c.Warn(`${c}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=A.index)}else E.c.Warn(`${c}: Failed to find common root`)}const o={};for(const t of b.joints){const n=Q.Get(`${c}/joints/${t}`,this._gltf.nodes,t);this._loadBone(n,b,A,o)}}_findSkeletonRootNode(c,b){if(0===b.length)return null;const A={};for(const t of b){const b=[];let o=Q.Get(`${c}/${t}`,this._gltf.nodes,t);for(;-1!==o.index;)b.unshift(o),o=o.parent;A[t]=b}let o=null;for(let t=0;;++t){let c=A[b[0]];if(t>=c.length)return o;const n=c[t];for(let h=1;h<b.length;++h)if(c=A[b[h]],t>=c.length||n!==c[t])return o;o=n}}_loadBone(c,b,A,o){c._isJoint=!0;let t=o[c.index];if(t)return t;let n=null;c.index!==b.skeleton&&(c.parent&&-1!==c.parent.index?n=this._loadBone(c.parent,b,A,o):void 0!==b.skeleton&&E.c.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const h=b.joints.indexOf(c.index);return t=new C.b(c.name||`joint${c.index}`,A,n,this._getNodeMatrix(c),null,null,h),o[c.index]=t,this._postSceneLoadActions.push((()=>{t.linkTransformNode(c._babylonTransformNode)})),t}_loadSkinInverseBindMatricesDataAsync(c,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const A=Q.Get(`${c}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)}_updateBoneMatrices(c,b){for(const A of c.bones){const c=t.b.Identity(),o=A._index;b&&-1!==o&&(t.b.FromArrayToRef(b,16*o,c),c.invertToRef(c));const n=A.getParent();n&&c.multiplyToRef(n.getAbsoluteInverseBindMatrix(),c),A.nk(c,!1,!1),A._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(c){return c.matrix?t.b.$j(c.matrix):t.b.Compose(c.scale?t.k.$j(c.scale):t.k.One(),c.rotation?t.e.$j(c.rotation):t.e.Identity(),c.translation?t.k.$j(c.translation):t.k.Zero())}loadCameraAsync(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadCameraAsync(c,b,A);if(o)return o;const n=new Array;this.logOpen(`${c} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new L.d(b.name||`camera${b.index}`,t.k.Zero(),this._babylonScene,!1);switch(h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonCamera=h,h.setTarget(new t.k(0,0,-1)),b.type){case"perspective":{const A=b.perspective;if(!A)throw new Error(`${c}: Camera perspective properties are missing`);h.fov=A.yfov,h.Vj=A.znear,h.maxZ=A.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${c}: Camera orthographic properties are missing`);h.mode=s.c.ORTHOGRAPHIC_CAMERA,h.orthoLeft=-b.orthographic.xmag,h.orthoRight=b.orthographic.xmag,h.orthoBottom=-b.orthographic.ymag,h.orthoTop=b.orthographic.ymag,h.Vj=b.orthographic.znear,h.maxZ=b.orthographic.zfar;break;default:throw new Error(`${c}: Invalid camera type (${b.type})`)}return l.AddPointerMetadata(h,c),this._parent.onCameraLoadedObservable.notifyObservers(h),A(h),this.logClose(),Promise.all(n).then((()=>h))}_loadAnimationsAsync(){const c=this._gltf.animations;if(!c)return Promise.resolve();const b=new Array;for(let A=0;A<c.length;A++){const o=c[A];b.push(this.loadAnimationAsync(`/animations/${o.index}`,o).then((c=>{0===c.targetedAnimations.length&&c.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(c,b){const o=this._extensionsLoadAnimationAsync(c,b);return o||A.e(62).then(A.bind(A,13953)).then((A=>{let{AnimationGroup:o}=A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new o(b.name||`animation${b.index}`,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=t;const n=new Array;Q.Assign(b.channels),Q.Assign(b.samplers);for(const h of b.channels)n.push(this._loadAnimationChannelAsync(`${c}/channels/${h.index}`,c,b,h,((c,b)=>{c.animations=c.animations||[],c.animations.push(b),t.addTargetedAnimation(b,c)})));return Promise.all(n).then((()=>(t.normalize(0),t)))}))}async _loadAnimationChannelAsync(c,b,o,t,n){const h=this._extensionsLoadAnimationChannelAsync(c,b,o,t,n);if(h)return await h;if(void 0==t.target.node)return await Promise.resolve();const s=Q.Get(`${c}/target/node`,this._gltf.nodes,t.target.node),L=t.target.path,C="weights"===L;if(C&&!s._numMorphTargets||!C&&!s._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!C&&!s._isJoint)return await Promise.resolve();let J;switch(await Promise.resolve().then(A.bind(A,12730)),L){case"translation":var X;J=null===(X=(0,H.g)("/nodes/{}/translation"))||void 0===X?void 0:X.interpolation;break;case"rotation":var R;J=null===(R=(0,H.g)("/nodes/{}/rotation"))||void 0===R?void 0:R.interpolation;break;case"scale":var N;J=null===(N=(0,H.g)("/nodes/{}/scale"))||void 0===N?void 0:N.interpolation;break;case"weights":var k;J=null===(k=(0,H.g)("/nodes/{}/weights"))||void 0===k?void 0:k.interpolation;break;default:throw new Error(`${c}/target/path: Invalid value (${t.target.path})`)}if(!J)throw new Error(`${c}/target/path: Could not find interpolation properties for target path (${t.target.path})`);const E={object:s,info:J};return await this._loadAnimationChannelFromTargetInfoAsync(c,b,o,t,E,n)}_loadAnimationChannelFromTargetInfoAsync(c,b,A,o,t,n){const h=this.parent.targetFps,s=1/h,L=Q.Get(`${c}/sampler`,A.samplers,o.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${o.sampler}`,L).then((c=>{let b=0;const L=t.object,C=t.info;for(const t of C){const C=t.getStride(L),J=c.input,X=c.output,R=new Array(J.length);let N=0;switch(c.interpolation){case"STEP":for(let c=0;c<J.length;c++){const b=t.getValue(L,X,N,1);N+=C,R[c]={frame:J[c]*h,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let c=0;c<J.length;c++){const b=t.getValue(L,X,N,s);N+=C;const A=t.getValue(L,X,N,1);N+=C;const o=t.getValue(L,X,N,s);N+=C,R[c]={frame:J[c]*h,inTangent:b,value:A,outTangent:o}}break;case"LINEAR":for(let c=0;c<J.length;c++){const b=t.getValue(L,X,N,1);N+=C,R[c]={frame:J[c]*h,value:b}}}if(N>0){const c=`${A.name||`animation${A.index}`}_channel${o.index}_${b}`,s=t.buildAnimations(L,c,h,R);for(const A of s)b++,n(A.babylonAnimatable,A.babylonAnimation)}}}))}_loadAnimationSamplerAsync(c,b){if(b._data)return b._data;const A=b.interpolation||"LINEAR";switch(A){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${c}/interpolation: Invalid value (${b.interpolation})`)}const o=Q.Get(`${c}/input`,this._gltf.accessors,b.input),t=Q.Get(`${c}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${o.index}`,o),this._loadFloatAccessorAsync(`/accessors/${t.index}`,t)]).then((c=>{let[b,o]=c;return{input:b,interpolation:A,output:o}})),b._data}loadBufferAsync(c,b,A,o){const t=this._extensionsLoadBufferAsync(c,b,A,o);if(t)return t;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${c}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${c}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+A,o)}catch(t){throw new Error(`${c}: ${t.message}`)}}))}loadBufferViewAsync(c,b){const A=this._extensionsLoadBufferViewAsync(c,b);if(A)return A;if(b._data)return b._data;const o=Q.Get(`${c}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${o.index}`,o,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(c,b,A){if(b._data)return b._data;const o=l._GetNumComponents(c,b.type),t=o*d.f.GetTypeByteLength(b.componentType),n=o*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new A(n));else{const h=Q.Get(`${c}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((s=>{if(5126!==b.componentType||b.normalized||h.byteStride&&h.byteStride!==t){const c=new A(n);return d.f.ForEach(s,b.byteOffset||0,h.byteStride||t,o,b.componentType,c.length,b.normalized||!1,((b,A)=>{c[A]=b})),c}return l._GetTypedArray(c,b.componentType,s,b.byteOffset,n)}))}if(b.sparse){const n=b.sparse;b._data=b._data.then((h=>{const s=h,L=Q.Get(`${c}/sparse/indices/bufferView`,this._gltf.bufferViews,n.indices.bufferView),C=Q.Get(`${c}/sparse/values/bufferView`,this._gltf.bufferViews,n.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${L.index}`,L),this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)]).then((h=>{let[L,C]=h;const J=l._GetTypedArray(`${c}/sparse/indices`,n.indices.componentType,L,n.indices.byteOffset,n.count),X=o*n.count;let R;if(5126!==b.componentType||b.normalized){const h=l._GetTypedArray(`${c}/sparse/values`,b.componentType,C,n.values.byteOffset,X);R=new A(X),d.f.ForEach(h,0,t,o,b.componentType,R.length,b.normalized||!1,((c,b)=>{R[b]=c}))}else R=l._GetTypedArray(`${c}/sparse/values`,b.componentType,C,n.values.byteOffset,X);let N=0;for(let c=0;c<J.length;c++){let b=J[c]*o;for(let c=0;c<o;c++)s[b++]=R[N++]}return s}))}))}return b._data}_loadFloatAccessorAsync(c,b){return this._loadAccessorAsync(c,b,Float32Array)}_loadIndicesAccessorAsync(c,b){if("SCALAR"!==b.type)throw new Error(`${c}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${c}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const A=l._GetTypedArrayConstructor(`${c}/componentType`,b.componentType);b._data=this._loadAccessorAsync(c,b,A)}else{const A=Q.Get(`${c}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((A=>l._GetTypedArray(c,b.componentType,A,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(c){if(c._babylonBuffer)return c._babylonBuffer;const b=this._babylonScene.getEngine();return c._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then((c=>new d.d(b,c,!1))),c._babylonBuffer}_loadVertexAccessorAsync(c,b,A){var o;if(null!==(o=b._babylonVertexBuffer)&&void 0!==o&&o[A])return b._babylonVertexBuffer[A];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const t=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[A]=this._loadFloatAccessorAsync(c,b).then((c=>new d.f(t,c,A,!1)));else{const o=Q.Get(`${c}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[A]=this._loadVertexBufferViewAsync(o).then((n=>{const h=l._GetNumComponents(c,b.type);return new d.f(t,n,A,!1,void 0,o.byteStride,void 0,b.byteOffset,h,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[A]}_loadMaterialMetallicRoughnessPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return b&&(b.baseColorFactor?(A.albedoColor=n.d.$j(b.baseColorFactor),A.alpha=b.baseColorFactor[3]):A.albedoColor=n.d.White(),A.metallic=void 0==b.metallicFactor?1:b.metallicFactor,A.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&o.push(this.loadTextureInfoAsync(`${c}/baseColorTexture`,b.baseColorTexture,(c=>{c.name=`${A.name} (Base Color)`,A.albedoTexture=c}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${c}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(c=>{c.name=`${A.name} (Metallic Roughness)`,A.metallicTexture=c}))),A.useMetallnessFromMetallicTextureBlue=!0,A.useRoughnessFromMetallicTextureGreen=!0,A.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(o).then((()=>{}))}_loadMaterialAsync(c,b,A,o){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const n=this._extensionsLoadMaterialAsync(c,b,A,o,t);if(n)return n;b._data=b._data||{};let h=b._data[o];if(!h){this.logOpen(`${c} ${b.name||""}`);const A=this.createMaterial(c,b,o);h={babylonMaterial:A,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(c,b,A)},b._data[o]=h,l.AddPointerMetadata(A,c),this._parent.onMaterialLoadedObservable.notifyObservers(A),this.logClose()}return A&&(h.babylonMeshes.push(A),A.fk.addOnce((()=>{const c=h.babylonMeshes.indexOf(A);-1!==c&&h.babylonMeshes.splice(c,1)}))),t(h.babylonMaterial),h.promise.then((()=>h.babylonMaterial))}_createDefaultMaterial(c,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new F.b(c,this._babylonScene);return A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.fillMode=b,A.enableSpecularAntiAliasing=!0,A.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,A.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,A.transparencyMode=F.b.PBRMATERIAL_OPAQUE,A.metallic=1,A.roughness=1,A}createMaterial(c,b,A){const o=this._extensionsCreateMaterial(c,b,A);if(o)return o;const t=b.name||`material${b.index}`;return this._createDefaultMaterial(t,A)}loadMaterialPropertiesAsync(c,b,A){const o=this._extensionsLoadMaterialPropertiesAsync(c,b,A);if(o)return o;const t=new Array;return t.push(this.loadMaterialBasePropertiesAsync(c,b,A)),b.pbrMetallicRoughness&&t.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${c}/pbrMetallicRoughness`,b.pbrMetallicRoughness,A)),this.loadMaterialAlphaProperties(c,b,A),Promise.all(t).then((()=>{}))}loadMaterialBasePropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return A.emissiveColor=b.emissiveFactor?n.d.$j(b.emissiveFactor):new n.d(0,0,0),b.doubleSided&&(A.jk=!1,A.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${c}/normalTexture`,b.normalTexture,(c=>{c.name=`${A.name} (Normal)`,A.bumpTexture=c}))),A.invertNormalMapX=!this._babylonScene.useRightHandedSystem,A.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&A.bumpTexture&&(A.bumpTexture.level=b.normalTexture.scale),A.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${c}/occlusionTexture`,b.occlusionTexture,(c=>{c.name=`${A.name} (Occlusion)`,A.ambientTexture=c}))),A.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(A.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&o.push(this.loadTextureInfoAsync(`${c}/emissiveTexture`,b.emissiveTexture,(c=>{c.name=`${A.name} (Emissive)`,A.emissiveTexture=c}))),Promise.all(o).then((()=>{}))}loadMaterialAlphaProperties(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":A.transparencyMode=F.b.PBRMATERIAL_OPAQUE,A.alpha=1;break;case"MASK":A.transparencyMode=F.b.PBRMATERIAL_ALPHATEST,A.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,A.albedoTexture&&(A.albedoTexture.pi=!0);break;case"BLEND":A.transparencyMode=F.b.PBRMATERIAL_ALPHABLEND,A.albedoTexture&&(A.albedoTexture.pi=!0,A.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${c}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureInfoAsync(c,b,A);if(o)return o;if(this.logOpen(`${c}`),b.texCoord>=6)throw new Error(`${c}/texCoord: Invalid value (${b.texCoord})`);const t=Q.Get(`${c}/index`,this._gltf.textures,b.index);t._textureInfo=b;const n=this._loadTextureAsync(`/textures/${b.index}`,t,(o=>{o.coordinatesIndex=b.texCoord||0,l.AddPointerMetadata(o,c),this._parent.onTextureLoadedObservable.notifyObservers(o),A(o)}));return this.logClose(),n}_loadTextureAsync(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureAsync(c,b,A);if(o)return o;this.logOpen(`${c} ${b.name||""}`);const t=void 0==b.sampler?l.DefaultSampler:Q.Get(`${c}/sampler`,this._gltf.samplers,b.sampler),n=Q.Get(`${c}/source`,this._gltf.images,b.source),h=this._createTextureAsync(c,t,n,A,void 0,!b._textureInfo.nonColorData);return this.logClose(),h}_createTextureAsync(c,b,A){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},n=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;const s=this._loadSampler(`/samplers/${b.index}`,b),L=new Array,C=new o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const J={noMipmap:s.noMipMaps,invertY:!1,samplingMode:s.samplingMode,X:()=>{this._disposed||C.resolve()},onError:(b,A)=>{this._disposed||C.reject(new Error(`${c}: ${A&&A.message?A.message:b||"Failed to load texture"}`))},mimeType:A.mimeType??(0,O.j)(A.uri??""),loaderOptions:n,useSRGBBuffer:!!h&&this._parent.useSRGBBuffers},X=new M.d(null,this._babylonScene,J);return X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.push(C.promise),L.push(this.loadImageAsync(`/images/${A.index}`,A).then((c=>{const b=A.uri||`${this._fileName}#image${A.index}`,o=`data:${this._uniqueRootUrl}${b}`;X.updateURL(o,c);const t=X.getInternalTexture();t&&(t.label=A.name)}))),X.wrapU=s.wrapU,X.wrapV=s.wrapV,t(X),this._parent.useGltfTextureNames&&(X.name=A.name||A.uri||`image${A.index}`),Promise.all(L).then((()=>X))}_loadSampler(c,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:l._GetTextureSamplingMode(c,b),wrapU:l._GetTextureWrapMode(`${c}/wrapS`,b.wrapS),wrapV:l._GetTextureWrapMode(`${c}/wrapT`,b.wrapT)}),b._data}loadImageAsync(c,b){if(!b._data){if(this.logOpen(`${c} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${c}/uri`,b,b.uri);else{const A=Q.Get(`${c}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}this.logClose()}return b._data}loadUriAsync(c,b,A){const o=this._extensionsLoadUriAsync(c,b,A);if(o)return o;if(!l._ValidateUri(A))throw new Error(`${c}: '${A}' is invalid`);if((0,O.l)(A)){const b=new Uint8Array((0,O.d)(A));return this.log(`${c}: Decoded ${A.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${c}: Loading ${A}`),this._parent.preprocessUrlAsync(this._rootUrl+A).then((b=>new Promise(((o,t)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${c}: Loaded ${A} (${b.byteLength} bytes)`),o(new Uint8Array(b)))}),!0,(b=>{t(new O.o(`${c}: Failed to load '${A}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(c,b){c.metadata=c.metadata||{};const A=c._internalMetadata=c._internalMetadata||{},o=A.Lk=A.Lk||{};(o.pointers=o.pointers||[]).push(b)}static _GetTextureWrapMode(c,b){switch(b=void 0==b?10497:b){case 33071:return M.d.CLAMP_ADDRESSMODE;case 33648:return M.d.MIRROR_ADDRESSMODE;case 10497:return M.d.WRAP_ADDRESSMODE;default:return E.c.Warn(`${c}: Invalid value (${b})`),M.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(c,b){const A=void 0==b.magFilter?9729:b.magFilter,o=void 0==b.minFilter?9987:b.minFilter;if(9729===A)switch(o){case 9728:return M.d.LINEAR_NEAREST;case 9729:return M.d.LINEAR_LINEAR;case 9984:return M.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return M.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return M.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return M.d.LINEAR_LINEAR_MIPLINEAR;default:return E.c.Warn(`${c}/minFilter: Invalid value (${o})`),M.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==A&&E.c.Warn(`${c}/magFilter: Invalid value (${A})`),o){case 9728:return M.d.NEAREST_NEAREST;case 9729:return M.d.NEAREST_LINEAR;case 9984:return M.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return M.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return M.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return M.d.NEAREST_LINEAR_MIPLINEAR;default:return E.c.Warn(`${c}/minFilter: Invalid value (${o})`),M.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(c,b){try{return(0,B.q)(b)}catch(A){throw new Error(`${c}: ${A.message}`)}}static _GetTypedArray(c,b,A,o,t){const n=A.buffer;o=A.byteOffset+(o||0);const h=l._GetTypedArrayConstructor(`${c}/componentType`,b),s=d.f.GetTypeByteLength(b);return o%s!==0?(E.c.Warn(`${c}: Copying buffer as byte offset (${o}) is not a multiple of component type byte length (${s})`),new h(n.slice(o,o+t*s),0)):new h(n,o,t)}static _GetNumComponents(c,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${c}: Invalid type (${b})`)}static _ValidateUri(c){return h.d.IsBase64(c)||-1===c.indexOf("..")}static _GetDrawMode(c,b){switch(void 0==b&&(b=4),b){case 0:return j.b.PointListDrawMode;case 1:return j.b.LineListDrawMode;case 2:return j.b.LineLoopDrawMode;case 3:return j.b.LineStripDrawMode;case 4:return j.b.TriangleFillMode;case 5:return j.b.TriangleStripDrawMode;case 6:return j.b.TriangleFanDrawMode}throw new Error(`${c}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const c=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const A in b._data){const o=b._data[A];for(const b of o.babylonMeshes){b.Zj(!0);const A=o.babylonMaterial;c.push(A.forceCompilationAsync(b)),c.push(A.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(c.push(A.forceCompilationAsync(b,{clipPlane:!0})),c.push(A.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(c).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const c=new Array,b=this._babylonScene.lights;for(const A of b){const b=A.getShadowGenerator();b&&c.push(b.forceCompilationAsync())}return Promise.all(c).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(c){for(const b of this._extensions)b.enabled&&c(b)}_applyExtensions(c,b,A){for(const o of this._extensions)if(o.enabled){const t=`${o.name}.${b}`,n=c;n._activeLoaderExtensionFunctions=n._activeLoaderExtensionFunctions||{};const h=n._activeLoaderExtensionFunctions;if(!h[t]){h[t]=!0;try{const c=A(o);if(c)return c}finally{delete h[t]}}}return null}_extensionsOnLoading(){this._forEachExtensions((c=>c.onLoading&&c.onLoading()))}_extensionsOnReady(){this._forEachExtensions((c=>c.onReady&&c.onReady()))}_extensionsLoadSceneAsync(c,b){return this._applyExtensions(b,"loadScene",(A=>A.loadSceneAsync&&A.loadSceneAsync(c,b)))}_extensionsLoadNodeAsync(c,b,A){return this._applyExtensions(b,"loadNode",(o=>o.loadNodeAsync&&o.loadNodeAsync(c,b,A)))}_extensionsLoadCameraAsync(c,b,A){return this._applyExtensions(b,"loadCamera",(o=>o.loadCameraAsync&&o.loadCameraAsync(c,b,A)))}_extensionsLoadVertexDataAsync(c,b,A){return this._applyExtensions(b,"loadVertexData",(o=>o._loadVertexDataAsync&&o._loadVertexDataAsync(c,b,A)))}_extensionsLoadMeshPrimitiveAsync(c,b,A,o,t,n){return this._applyExtensions(t,"loadMeshPrimitive",(h=>h._loadMeshPrimitiveAsync&&h._loadMeshPrimitiveAsync(c,b,A,o,t,n)))}_extensionsLoadMaterialAsync(c,b,A,o,t){return this._applyExtensions(b,"loadMaterial",(n=>n._loadMaterialAsync&&n._loadMaterialAsync(c,b,A,o,t)))}_extensionsCreateMaterial(c,b,A){return this._applyExtensions(b,"createMaterial",(o=>o.createMaterial&&o.createMaterial(c,b,A)))}_extensionsLoadMaterialPropertiesAsync(c,b,A){return this._applyExtensions(b,"loadMaterialProperties",(o=>o.loadMaterialPropertiesAsync&&o.loadMaterialPropertiesAsync(c,b,A)))}_extensionsLoadTextureInfoAsync(c,b,A){return this._applyExtensions(b,"loadTextureInfo",(o=>o.loadTextureInfoAsync&&o.loadTextureInfoAsync(c,b,A)))}_extensionsLoadTextureAsync(c,b,A){return this._applyExtensions(b,"loadTexture",(o=>o._loadTextureAsync&&o._loadTextureAsync(c,b,A)))}_extensionsLoadAnimationAsync(c,b){return this._applyExtensions(b,"loadAnimation",(A=>A.loadAnimationAsync&&A.loadAnimationAsync(c,b)))}_extensionsLoadAnimationChannelAsync(c,b,A,o,t){return this._applyExtensions(A,"loadAnimationChannel",(n=>n._loadAnimationChannelAsync&&n._loadAnimationChannelAsync(c,b,A,o,t)))}_extensionsLoadSkinAsync(c,b,A){return this._applyExtensions(A,"loadSkin",(o=>o._loadSkinAsync&&o._loadSkinAsync(c,b,A)))}_extensionsLoadUriAsync(c,b,A){return this._applyExtensions(b,"loadUri",(o=>o._loadUriAsync&&o._loadUriAsync(c,b,A)))}_extensionsLoadBufferViewAsync(c,b){return this._applyExtensions(b,"loadBufferView",(A=>A.loadBufferViewAsync&&A.loadBufferViewAsync(c,b)))}_extensionsLoadBufferAsync(c,b,A,o){return this._applyExtensions(b,"loadBuffer",(t=>t.loadBufferAsync&&t.loadBufferAsync(c,b,A,o)))}static LoadExtensionAsync(c,b,A,o){if(!b.extensions)return null;const t=b.extensions[A];return t?o(`${c}/extensions/${A}`,t):null}static LoadExtraAsync(c,b,A,o){if(!b.extras)return null;const t=b.extras[A];return t?o(`${c}/extras/${A}`,t):null}isExtensionUsed(c){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(c)}logOpen(c){this._parent._logOpen(c)}logClose(){this._parent._logClose()}log(c){this._parent._log(c)}startPerformanceCounter(c){this._parent._startPerformanceCounter(c)}endPerformanceCounter(c){this._parent._endPerformanceCounter(c)}}l.DefaultSampler={index:-1},P.b._CreateGLTF2Loader=c=>new l(c);var T=A(12730),i=A(2031),g=A(714),u=A(2181),e=A(12734);class x extends e.b{constructor(c,b,A){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",c),this._texture=c.getEngine().createRawCubeTexture(b,A,o,t,n,h,s,L)}update(c,b,A,o){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,c,b,A,o,t)}updateRGBDAsync(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,u.j)(this._texture,c,b,A,o).then((()=>{}))}clone(){return g.c.Clone((()=>{const c=this.va(),b=this._texture,A=new x(c,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&A.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),A}),this)}}const U="EXT_lights_image_based";class w{constructor(c){this.name=U,this._loader=c,this.enabled=this._loader.isExtensionUsed(U)}dispose(){this._loader=null,delete this._lights}onLoading(){const c=this._loader.Lk.extensions;if(c&&c[this.name]){const b=c[this.name];this._lights=b.lights}}loadSceneAsync(c,b){return l.LoadExtensionAsync(c,b,this.name,(async(A,o)=>{this._loader._allMaterialsDirtyRequired=!0;const t=new Array;t.push(this._loader.loadSceneAsync(c,b)),this._loader.logOpen(`${A}`);const n=Q.Get(`${A}/light`,this._lights,o.ab);return t.push(this._loadLightAsync(`/extensions/${this.name}/lights/${o.ab}`,n).then((c=>{this._loader.babylonScene.environmentTexture=c}))),this._loader.logClose(),await Promise.all(t).then((()=>{}))}))}_loadLightAsync(c,b){if(!b._loaded){const A=new Array;this._loader.logOpen(`${c}`);const o=new Array(b.specularImages.length);for(let t=0;t<b.specularImages.length;t++){const n=b.specularImages[t];o[t]=new Array(n.length);for(let b=0;b<n.length;b++){const h=`${c}/specularImages/${t}/${b}`;this._loader.logOpen(`${h}`);const s=n[b],L=Q.Get(h,this._loader.Lk.images,s);A.push(this._loader.loadImageAsync(`/images/${s}`,L).then((c=>{o[t][b]=c}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(A).then((async()=>{const A=new x(this._loader.babylonScene,null,b.specularImageSize);if(A.name=b.name||"environment",b._babylonTexture=A,void 0!=b.cb&&(A.level=b.cb),b.rotation){let c=t.e.$j(b.rotation);this._loader.babylonScene.useRightHandedSystem||(c=t.e.Inverse(c)),t.b.FromQuaternionToRef(c,A.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${c}: Irradiance coefficients are missing`);const n=i.c.$j(b.irradianceCoefficients);n.scaleInPlace(b.cb),n.convertIrradianceToLambertianRadiance();const h=i.d.FromHarmonics(n),s=(o.length-1)/Math.log2(b.specularImageSize);return await A.updateRGBDAsync(o,h,s)}))}return b._loaded.then((()=>b._babylonTexture))}}Z(U),K(U,!0,(c=>new w(c)));A(507);const m="EXT_mesh_gpu_instancing";class cc{constructor(c){this.name=m,this._loader=c,this.enabled=this._loader.isExtensionUsed(m)}dispose(){this._loader=null}loadNodeAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(c,o)=>{this._loader._disableInstancedMesh++;const n=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,A);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return await n;const h=new Array;let s=0;const L=b=>{if(void 0==o.attributes[b])return void h.push(Promise.resolve(null));const A=Q.Get(`${c}/attributes/${b}`,this._loader.Lk.accessors,o.attributes[b]);if(h.push(this._loader._loadFloatAccessorAsync(`/accessors/${A.bufferView}`,A)),0===s)s=A.count;else if(s!==A.count)throw new Error(`${c}/attributes: Instance buffer accessors do not have the same count.`)};return L("TRANSLATION"),L("ROTATION"),L("SCALE"),await n.then((async c=>{const[A,o,n]=await Promise.all(h),L=new Float32Array(16*s);t.f.ak[0].jd(0,0,0),t.f.Quaternion[0].jd(0,0,0,1),t.f.ak[1].jd(1,1,1);for(let b=0;b<s;++b)A&&t.k.FromArrayToRef(A,3*b,t.f.ak[0]),o&&t.e.FromArrayToRef(o,4*b,t.f.Quaternion[0]),n&&t.k.FromArrayToRef(n,3*b,t.f.ak[1]),t.b.ComposeToRef(t.f.ak[1],t.f.Quaternion[0],t.f.ak[0],t.f.Matrix[0]),t.f.Matrix[0].copyToArray(L,16*b);for(const t of b._primitiveBabylonMeshes)t.Ak("matrix",L,16,!0);return c}))}))}}Z(m),K(m,!0,(c=>new cc(c)));let bc=0,Ac=null;class oc{static get Default(){return oc._Default||(oc._Default=new oc),oc._Default}constructor(){const c=oc.Configuration.decoder;this._decoderModulePromise=h.d.LoadBabylonScriptAsync(c.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(c,b,A,o,t){await this._decoderModulePromise,0===bc&&(MeshoptDecoder.useWorkers(1),bc=1);const n=await MeshoptDecoder.decodeGltfBufferAsync(b,A,c,o,t);return null!==Ac&&clearTimeout(Ac),Ac=setTimeout((()=>{MeshoptDecoder.useWorkers(0),bc=0,Ac=null}),1e3),n}}oc.Configuration={decoder:{url:`${h.d._DefaultCdnUrl}/meshopt_decoder.js`}},oc._Default=null;const tc="EXT_meshopt_compression";class nc{constructor(c){this.name=tc,this.enabled=c.isExtensionUsed(tc),this._loader=c}dispose(){this._loader=null}loadBufferViewAsync(c,b){return l.LoadExtensionAsync(c,b,this.name,(async(A,o)=>{const t=b;if(t._meshOptData)return await t._meshOptData;const n=Q.Get(`${c}/buffer`,this._loader.Lk.buffers,o.buffer);return t._meshOptData=this._loader.loadBufferAsync(`/buffers/${n.index}`,n,o.byteOffset||0,o.byteLength).then((async c=>await oc.Default.decodeGltfBufferAsync(c,o.count,o.byteStride,o.mode,o.filter))),await t._meshOptData}))}}Z(tc),K(tc,!0,(c=>new nc(c)));const hc="EXT_texture_webp";class sc{constructor(c){this.name=hc,this._loader=c,this.enabled=c.isExtensionUsed(hc)}dispose(){this._loader=null}_loadTextureAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=void 0==b.sampler?l.DefaultSampler:Q.Get(`${c}/sampler`,this._loader.Lk.samplers,b.sampler),h=Q.Get(`${o}/source`,this._loader.Lk.images,t.source);return await this._loader._createTextureAsync(c,n,h,(c=>{A(c)}),void 0,!b._textureInfo.nonColorData)}))}}Z(hc),K(hc,!0,(c=>new sc(c)));const Lc="EXT_texture_avif";class Cc{constructor(c){this.name=Lc,this._loader=c,this.enabled=c.isExtensionUsed(Lc)}dispose(){this._loader=null}_loadTextureAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=void 0==b.sampler?l.DefaultSampler:Q.Get(`${c}/sampler`,this._loader.Lk.samplers,b.sampler),h=Q.Get(`${o}/source`,this._loader.Lk.images,t.source);return await this._loader._createTextureAsync(c,n,h,(c=>{A(c)}),void 0,!b._textureInfo.nonColorData)}))}}Z(Lc),K(Lc,!0,(c=>new Cc(c)));var Jc=A(12723),Xc=A(11921);const Rc="EXT_lights_ies";class Nc{constructor(c){this.name=Rc,this._loader=c,this.enabled=this._loader.isExtensionUsed(Rc)}dispose(){this._loader=null,delete this._lights}onLoading(){const c=this._loader.Lk.extensions;if(c&&c[this.name]){const b=c[this.name];this._lights=b.lights,Q.Assign(this._lights)}}loadNodeAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,h)=>{let s,L;this._loader._allMaterialsDirtyRequired=!0;const C=await this._loader.loadNodeAsync(c,b,(c=>{L=Q.Get(o,this._lights,h.ab);const b=L.name||c.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,s=new Jc.d(b,t.k.Zero(),t.k.Backward(),0,1,this._loader.babylonScene),s.angle=Math.PI/2,s.innerAngle=0,s._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,L._babylonLight=s,s.falloffType=Xc.e.FALLOFF_GLTF,s.fb=h.color?n.d.$j(h.color):n.d.White(),s.cb=h.multiplier||1,s.range=Number.MAX_VALUE,s.parent=c,this._loader._babylonLights.push(s),l.AddPointerMetadata(s,o),A(c)}));let J;if(L.uri)J=await this._loader.loadUriAsync(c,L,L.uri);else{const b=Q.Get(`${c}/bufferView`,this._loader.Lk.bufferViews,L.bufferView);J=await this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}return s.iesProfileTexture=new M.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,J,!0,void 0,void 0,void 0,void 0,".ies"),C}))}}Z(Rc),K(Rc,!0,(c=>new Nc(c)));var kc=A(12736);const Ec="KHR_draco_mesh_compression";class Vc{constructor(c){this.name=Ec,this.useNormalizedFlagFromAccessor=!0,this._loader=c,this.enabled=kc.c.DefaultAvailable&&this._loader.isExtensionUsed(Ec)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${c}: Unsupported mode ${b.mode}`);const n={},h={},s=(c,o)=>{const s=t.attributes[c];if(void 0!=s&&(A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(o)&&A._delayInfo.push(o),n[o]=s,this.useNormalizedFlagFromAccessor)){const A=Q.TryGet(this._loader.Lk.accessors,b.attributes[c]);A&&(h[o]=A.normalized||!1)}};s("POSITION",d.f.PositionKind),s("NORMAL",d.f.NormalKind),s("TANGENT",d.f.TangentKind),s("TEXCOORD_0",d.f.UVKind),s("TEXCOORD_1",d.f.UV2Kind),s("TEXCOORD_2",d.f.UV3Kind),s("TEXCOORD_3",d.f.UV4Kind),s("TEXCOORD_4",d.f.UV5Kind),s("TEXCOORD_5",d.f.UV6Kind),s("JOINTS_0",d.f.MatricesIndicesKind),s("WEIGHTS_0",d.f.MatricesWeightsKind),s("COLOR_0",d.f.ColorKind);const L=Q.Get(o,this._loader.Lk.bufferViews,t.bufferView);return L._dracoBabylonGeometry||(L._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((async o=>{const t=this.dracoDecoder||kc.c.Default,s=Q.TryGet(this._loader.Lk.accessors,b.attributes.POSITION),L=this._loader.parent.alwaysComputeBoundingBox||A.skeleton||!s?null:a(s);return await t._decodeMeshToGeometryForGltfAsync(A.name,this._loader.babylonScene,o,n,h,L).catch((b=>{throw new Error(`${c}: ${b.message}`)}))}))),await L._dracoBabylonGeometry}))}}Z(Ec),K(Ec,!0,(c=>new Vc(c)));var yc=A(12740),jc=A(672),Fc=A(674),Mc=A(711),Wc=A(11964),dc=A(633);Mc.b.AddNodeConstructor("Light_Type_0",((c,b)=>()=>new rc(c,t.k.Zero(),b)));class rc extends Wc.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(c){this._shadowAngle=c,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(c){const b=this.needCube();if(this._direction=c,this.needCube()!==b&&this._shadowGenerators){const c=this._shadowGenerators.values();for(let b=c.next();!0!==b.done;b=c.next()){b.value.recreateShadowMap()}}}constructor(c,b,A){super(c,A),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return Xc.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(c){if(this.direction)return super.getShadowDirection(c);switch(c){case 0:return new t.k(1,0,0);case 1:return new t.k(-1,0,0);case 2:return new t.k(0,-1,0);case 3:return new t.k(0,1,0);case 4:return new t.k(0,0,1);case 5:return new t.k(0,0,-1)}return t.k.Zero()}_setDefaultShadowProjectionMatrix(c,b,A){const o=this.va().activeCamera;if(!o)return;const n=void 0!==this.shadowMinZ?this.shadowMinZ:o.Vj,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,s=this.va().getEngine().useReverseDepthBuffer;t.b.PerspectiveFovLHToRef(this.shadowAngle,1,s?h:n,s?n:h,c,!0,this._scene.getEngine().isNDCHalfZRange,void 0,s)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(c,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(c,b){return this.computeTransformedInformation()?c.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):c.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(c,b){c["POINTLIGHT"+b]=!0}}(0,jc.e)([(0,Fc.J)()],rc.prototype,"shadowAngle",null),(0,dc.d)("BABYLON.PointLight",rc);const zc="KHR_lights_punctual";class Yc{constructor(c){this.name=zc,this._loader=c,this.enabled=this._loader.isExtensionUsed(zc)}dispose(){this._loader=null,delete this._lights}onLoading(){const c=this._loader.Lk.extensions;if(c&&c[this.name]){const b=c[this.name];this._lights=b.lights,Q.Assign(this._lights)}}loadNodeAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,h)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(c,b,(c=>{let b;const s=Q.Get(o,this._lights,h.ab),L=s.name||c.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,s.type){case"directional":{const c=new yc.c(L,t.k.Backward(),this._loader.babylonScene);c.position.bk(0),b=c;break}case"point":b=new rc(L,t.k.Zero(),this._loader.babylonScene);break;case"spot":{const c=new Jc.d(L,t.k.Zero(),t.k.Backward(),0,1,this._loader.babylonScene);c.angle=2*(s.spot&&s.spot.outerConeAngle||Math.PI/4),c.innerAngle=2*(s.spot&&s.spot.innerConeAngle||0),b=c;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${o}: Invalid light type (${s.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,s._babylonLight=b,b.falloffType=Xc.e.FALLOFF_GLTF,b.fb=s.color?n.d.$j(s.color):n.d.White(),b.cb=void 0==s.cb?1:s.cb,b.range=void 0==s.range?Number.MAX_VALUE:s.range,b.parent=c,this._loader._babylonLights.push(b),l.AddPointerMetadata(b,o),A(c)})))))}}Z(zc),K(zc,!0,(c=>new Yc(c)));const Dc="KHR_materials_pbrSpecularGlossiness";class fc{constructor(c){this.name=Dc,this.order=200,this._loader=c,this.enabled=this._loader.isExtensionUsed(Dc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialBasePropertiesAsync(c,b,A)),n.push(this._loadSpecularGlossinessPropertiesAsync(o,t,A)),this._loader.loadMaterialAlphaProperties(c,b,A),await Promise.all(n).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return A.metallic=null,A.roughness=null,b.diffuseFactor?(A.albedoColor=n.d.$j(b.diffuseFactor),A.alpha=b.diffuseFactor[3]):A.albedoColor=n.d.White(),A.reflectivityColor=b.specularFactor?n.d.$j(b.specularFactor):n.d.White(),A.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/diffuseTexture`,b.diffuseTexture,(c=>{c.name=`${A.name} (Diffuse)`,A.albedoTexture=c}))),b.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync(`${c}/specularGlossinessTexture`,b.specularGlossinessTexture,(c=>{c.name=`${A.name} (Specular Glossiness)`,A.reflectivityTexture=c,A.reflectivityTexture.pi=!0}))),A.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then((()=>{}))}}Z(Dc),K(Dc,!0,(c=>new fc(c)));const vc="KHR_materials_unlit";class Gc{constructor(c){this.name=vc,this.order=210,this._loader=c,this.enabled=this._loader.isExtensionUsed(vc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async()=>await this._loadUnlitPropertiesAsync(c,b,A)))}_loadUnlitPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;A.unlit=!0;const t=b.pbrMetallicRoughness;return t&&(t.baseColorFactor?(A.albedoColor=n.d.$j(t.baseColorFactor),A.alpha=t.baseColorFactor[3]):A.albedoColor=n.d.White(),t.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/baseColorTexture`,t.baseColorTexture,(c=>{c.name=`${A.name} (Base Color)`,A.albedoTexture=c})))),b.doubleSided&&(A.jk=!1,A.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(c,b,A),Promise.all(o).then((()=>{}))}}Z(vc),K(vc,!0,(c=>new Gc(c)));const Pc="KHR_materials_clearcoat";class Oc{constructor(c){this.name=Pc,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(Pc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadClearCoatPropertiesAsync(o,t,A)),await Promise.all(n)}))}_loadClearCoatPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return A.clearCoat.isEnabled=!0,A.clearCoat.useRoughnessFromMainTexture=!1,A.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?A.clearCoat.cb=b.clearcoatFactor:A.clearCoat.cb=0,b.clearcoatTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/clearcoatTexture`,b.clearcoatTexture,(c=>{c.name=`${A.name} (ClearCoat)`,A.clearCoat.texture=c}))),void 0!=b.clearcoatRoughnessFactor?A.clearCoat.roughness=b.clearcoatRoughnessFactor:A.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${c}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(c=>{c.name=`${A.name} (ClearCoat Roughness)`,A.clearCoat.textureRoughness=c})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${c}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(c=>{c.name=`${A.name} (ClearCoat Normal)`,A.clearCoat.bumpTexture=c}))),A.invertNormalMapX=!A.va().useRightHandedSystem,A.invertNormalMapY=A.va().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(A.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(o).then((()=>{}))}}Z(Pc),K(Pc,!0,(c=>new Oc(c)));const pc="KHR_materials_iridescence";class qc{constructor(c){this.name=pc,this.order=195,this._loader=c,this.enabled=this._loader.isExtensionUsed(pc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadIridescencePropertiesAsync(o,t,A)),await Promise.all(n).then((()=>{}))}))}_loadIridescencePropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return A.iridescence.isEnabled=!0,A.iridescence.cb=b.iridescenceFactor??0,A.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,A.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,A.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/iridescenceTexture`,b.iridescenceTexture,(c=>{c.name=`${A.name} (Iridescence)`,A.iridescence.texture=c}))),b.iridescenceThicknessTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(c=>{c.name=`${A.name} (Iridescence Thickness)`,A.iridescence.thicknessTexture=c}))),Promise.all(o).then((()=>{}))}}Z(pc),K(pc,!0,(c=>new qc(c)));const Ic="KHR_materials_anisotropy";class Kc{constructor(c){this.name=Ic,this.order=195,this._loader=c,this.enabled=this._loader.isExtensionUsed(Ic)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadIridescencePropertiesAsync(o,t,A)),await Promise.all(n)}))}async _loadIridescencePropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;A.anisotropy.isEnabled=!0,A.anisotropy.cb=b.anisotropyStrength??0,A.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${c}/anisotropyTexture`,b.anisotropyTexture,(c=>{c.name=`${A.name} (Anisotropy Intensity)`,A.anisotropy.texture=c})))),await Promise.all(o)}}Z(Ic),K(Ic,!0,(c=>new Kc(c)));const Zc="KHR_materials_emissive_strength";class Hc{constructor(c){this.name=Zc,this.order=170,this._loader=c,this.enabled=this._loader.isExtensionUsed(Zc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>await this._loader.loadMaterialPropertiesAsync(c,b,A).then((()=>{this._loadEmissiveProperties(o,t,A)}))))}_loadEmissiveProperties(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);void 0!==b.emissiveStrength&&(A.emissiveIntensity=b.emissiveStrength)}}Z(Zc),K(Zc,!0,(c=>new Hc(c)));const Sc="KHR_materials_sheen";class Bc{constructor(c){this.name=Sc,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(Sc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadSheenPropertiesAsync(o,t,A)),await Promise.all(n).then((()=>{}))}))}_loadSheenPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return A.sheen.isEnabled=!0,A.sheen.cb=1,void 0!=b.sheenColorFactor?A.sheen.color=n.d.$j(b.sheenColorFactor):A.sheen.color=n.d.Black(),b.sheenColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/sheenColorTexture`,b.sheenColorTexture,(c=>{c.name=`${A.name} (Sheen Color)`,A.sheen.texture=c}))),void 0!==b.sheenRoughnessFactor?A.sheen.roughness=b.sheenRoughnessFactor:A.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${c}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(c=>{c.name=`${A.name} (Sheen Roughness)`,A.sheen.textureRoughness=c})))),A.sheen.albedoScaling=!0,A.sheen.useRoughnessFromMainTexture=!1,Promise.all(o).then((()=>{}))}}Z(Sc),K(Sc,!0,(c=>new Bc(c)));var Qc=A(11838);const ac="KHR_materials_specular";class lc{constructor(c){this.name=ac,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(ac)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;if(n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadSpecularPropertiesAsync(o,t,A)),t.extensions&&t.extensions.EXT_materials_specular_edge_color&&A instanceof F.b){t.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(A.brdf.dielectricSpecularModel=Qc.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,A.brdf.conductorSpecularModel=Qc.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(n).then((()=>{}))}))}_loadSpecularPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return void 0!==b.specularFactor&&(A.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(A.metallicReflectanceColor=n.d.$j(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${c}/specularTexture`,b.specularTexture,(c=>{c.name=`${A.name} (Specular)`,A.metallicReflectanceTexture=c,A.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/specularColorTexture`,b.specularColorTexture,(c=>{c.name=`${A.name} (Specular Color)`,A.reflectanceTexture=c}))),Promise.all(o).then((()=>{}))}}Z(ac),K(ac,!0,(c=>new lc(c)));const Tc="KHR_materials_ior";class ic{constructor(c){this.name=Tc,this.order=180,this._loader=c,this.enabled=this._loader.isExtensionUsed(Tc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadIorPropertiesAsync(o,t,A)),await Promise.all(n).then((()=>{}))}))}_loadIorPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);return void 0!==b.ior?A.indexOfRefraction=b.ior:A.indexOfRefraction=ic._DEFAULT_IOR,Promise.resolve()}}ic._DEFAULT_IOR=1.5,Z(Tc),K(Tc,!0,(c=>new ic(c)));const gc="KHR_materials_variants";class uc{constructor(c){this.name=gc,this._loader=c,this.enabled=this._loader.isExtensionUsed(gc)}dispose(){this._loader=null}static GetAvailableVariants(c){const b=this._GetExtensionMetadata(c);return b?Object.keys(b.variants):[]}getAvailableVariants(c){return uc.GetAvailableVariants(c)}static SelectVariant(c,b){const A=this._GetExtensionMetadata(c);if(!A)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${gc} extension`);const o=c=>{const b=A.variants[c];if(b)for(const A of b)A.mesh.material=A.material};if(b instanceof Array)for(const t of b)o(t);else o(b);A.lastSelected=b}selectVariant(c,b){uc.SelectVariant(c,b)}static Reset(c){const b=this._GetExtensionMetadata(c);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${gc} extension`);for(const A of b.original)A.mesh.material=A.material;b.lastSelected=null}reset(c){uc.Reset(c)}static GetLastSelectedVariant(c){const b=this._GetExtensionMetadata(c);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${gc} extension`);return b.lastSelected}getLastSelectedVariant(c){return uc.GetLastSelectedVariant(c)}static _GetExtensionMetadata(c){var b,A;return(null===c||void 0===c||null===(b=c._internalMetadata)||void 0===b||null===(A=b.Lk)||void 0===A?void 0:A[gc])||null}onLoading(){const c=this._loader.Lk.extensions;if(c&&c[this.name]){const b=c[this.name];this._variants=b.variants}}onReady(){const c=this._loader.rootBabylonMesh;if(c){var b;const A=this._loader.parent.extensionOptions[gc];null!==A&&void 0!==A&&A.defaultVariant&&uc.SelectVariant(c,A.defaultVariant),null===A||void 0===A||null===(b=A.onLoaded)||void 0===b||b.call(A,{get variants(){return uc.GetAvailableVariants(c)},get selectedVariant(){const b=uc.GetLastSelectedVariant(c);return b?Array.isArray(b)?b[0]:b:uc.GetAvailableVariants(c)[0]},set selectedVariant(b){uc.SelectVariant(c,b)}})}}_loadMeshPrimitiveAsync(c,b,A,o,t,n){return l.LoadExtensionAsync(c,t,this.name,(async(h,s)=>{const L=new Array;return L.push(this._loader._loadMeshPrimitiveAsync(c,b,A,o,t,(b=>{if(n(b),b instanceof Y.d){const A=l._GetDrawMode(c,t.mode),o=this._loader.rootBabylonMesh,n=o?o._internalMetadata=o._internalMetadata||{}:{},C=n.Lk=n.Lk||{},J=C[gc]=C[gc]||{lastSelected:null,original:[],variants:{}};J.original.push({mesh:b,material:b.material});for(let c=0;c<s.mappings.length;++c){const t=s.mappings[c],n=Q.Get(`${h}/mappings/${c}/material`,this._loader.Lk.materials,t.material);L.push(this._loader._loadMaterialAsync(`#/materials/${t.material}`,n,b,A,(c=>{for(let A=0;A<t.variants.length;++A){const n=t.variants[A],h=Q.Get(`/extensions/${gc}/variants/${n}`,this._variants,n);J.variants[h.name]=J.variants[h.name]||[],J.variants[h.name].push({mesh:b,material:c}),b.onClonedObservable.add((c=>{const A=c;let t=null,n=A;do{if(n=n.parent,!n)return;t=uc._GetExtensionMetadata(n)}while(null===t);if(o&&t===uc._GetExtensionMetadata(o)){n._internalMetadata={};for(const c in o._internalMetadata)n._internalMetadata[c]=o._internalMetadata[c];n._internalMetadata.Lk=[];for(const c in o._internalMetadata.Lk)n._internalMetadata.Lk[c]=o._internalMetadata.Lk[c];n._internalMetadata.Lk[gc]={lastSelected:null,original:[],variants:{}};for(const c of t.original)n._internalMetadata.Lk[gc].original.push({mesh:c.mesh,material:c.material});for(const c in t.variants)if(Object.prototype.hasOwnProperty.call(t.variants,c)){n._internalMetadata.Lk[gc].variants[c]=[];for(const b of t.variants[c])n._internalMetadata.Lk[gc].variants[c].push({mesh:b.mesh,material:b.material})}t=n._internalMetadata.Lk[gc]}for(const o of t.original)o.mesh===b&&(o.mesh=A);for(const o of t.variants[h.name])o.mesh===b&&(o.mesh=A)}))}})))}}}))),await Promise.all(L).then((c=>{let[b]=c;return b}))}))}}Z(gc),K(gc,!0,(c=>new uc(c)));var ec=A(2077);class xc{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Qc.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(c,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...xc._GetDefaultOptions(),...c},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new J.b,this._scene.fk.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(c){if(!Object.keys(c).filter((b=>this._options[b]!==c[b])).length)return;const b={...this._options,...c},A=this._options;this._options=b,b.renderSize===A.renderSize&&b.renderTargetTextureType===A.renderTargetTextureType&&b.generateMipmaps===A.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(c){return!!c&&!!(c instanceof F.b&&c.subSurface.isRefractionEnabled)}_addMesh(c){this._materialObservers[c.uniqueId]=c.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),h.d.SetImmediate((()=>{this._shouldRenderAsTransmission(c.material)?(c.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(c)&&this._transparentMeshesCache.push(c)):-1===this._opaqueMeshesCache.indexOf(c)&&this._opaqueMeshesCache.push(c)}))}_removeMesh(c){c.onMaterialChangedObservable.remove(this._materialObservers[c.uniqueId]),delete this._materialObservers[c.uniqueId];let b=this._transparentMeshesCache.indexOf(c);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(c),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(c){const b=this._transparentMeshesCache.indexOf(c),A=this._opaqueMeshesCache.indexOf(c);this._shouldRenderAsTransmission(c.material)?(c.material instanceof F.b&&(c.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==A?(this._opaqueMeshesCache.splice(A,1),this._transparentMeshesCache.push(c)):-1===b&&this._transparentMeshesCache.push(c)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(c)):-1===A&&this._opaqueMeshesCache.push(c)}_isRenderTargetValid(){var c;return null!==(null===(c=this._opaqueRenderTarget)||void 0===c?void 0:c.getInternalTexture())}_setupRenderTargets(){var c;let b;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ec.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(c=this._options.clearColor)||void 0===c?void 0:c.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((c=>{b=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?c.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(c.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=b}));for(const A of this._transparentMeshesCache)this._shouldRenderAsTransmission(A.material)&&(A.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Uc="KHR_materials_transmission";class wc{constructor(c){this.name=Uc,this.order=175,this._loader=c,this.enabled=this._loader.isExtensionUsed(Uc),this.enabled&&(c.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadTransparentPropertiesAsync(o,b,A,t)),await Promise.all(n).then((()=>{}))}))}_loadTransparentPropertiesAsync(c,b,A,o){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const t=A;if(t.subSurface.isRefractionEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.useAlbedoToTintRefraction=!0,void 0===o.transmissionFactor)return t.subSurface.refractionIntensity=0,t.subSurface.isRefractionEnabled=!1,Promise.resolve();{var n;t.subSurface.refractionIntensity=o.transmissionFactor;const c=t.va();if(t.subSurface.refractionIntensity&&!c._transmissionHelper)new xc({},t.va());else if(t.subSurface.refractionIntensity&&(null===(n=c._transmissionHelper)||void 0===n||!n._isRenderTargetValid())){var h;null===(h=c._transmissionHelper)||void 0===h||h._setupRenderTargets()}}return t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,o.transmissionTexture?(o.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${c}/transmissionTexture`,o.transmissionTexture,void 0).then((c=>{c.name=`${A.name} (Transmission)`,t.subSurface.refractionIntensityTexture=c,t.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Z(Uc),K(Uc,!0,(c=>new wc(c)));const mc="KHR_materials_diffuse_transmission";class cb{constructor(c){this.name=mc,this.order=174,this._loader=c,this.enabled=this._loader.isExtensionUsed(mc),this.enabled&&(c.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadTranslucentPropertiesAsync(o,b,A,t)),await Promise.all(n).then((()=>{}))}))}_loadTranslucentPropertiesAsync(c,b,A,o){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const t=A;if(t.subSurface.isTranslucencyEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,t.subSurface.useAlbedoToTintTranslucency=!1,void 0===o.diffuseTransmissionFactor)return t.subSurface.translucencyIntensity=0,t.subSurface.isTranslucencyEnabled=!1,Promise.resolve();t.subSurface.translucencyIntensity=o.diffuseTransmissionFactor;const h=new Array;return t.subSurface.useGltfStyleTextures=!0,o.diffuseTransmissionTexture&&(o.diffuseTransmissionTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${c}/diffuseTransmissionTexture`,o.diffuseTransmissionTexture).then((c=>{c.name=`${A.name} (Diffuse Transmission)`,t.subSurface.translucencyIntensityTexture=c})))),void 0!==o.diffuseTransmissionColorFactor?t.subSurface.translucencyColor=n.d.$j(o.diffuseTransmissionColorFactor):t.subSurface.translucencyColor=n.d.White(),o.diffuseTransmissionColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${c}/diffuseTransmissionColorTexture`,o.diffuseTransmissionColorTexture).then((c=>{c.name=`${A.name} (Diffuse Transmission Color)`,t.subSurface.translucencyColorTexture=c}))),Promise.all(h).then((()=>{}))}}Z(mc),K(mc,!0,(c=>new cb(c)));const bb="KHR_materials_volume";class Ab{constructor(c){this.name=bb,this.order=173,this._loader=c,this.enabled=this._loader.isExtensionUsed(bb),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadVolumePropertiesAsync(o,b,A,t)),await Promise.all(n).then((()=>{}))}))}_loadVolumePropertiesAsync(c,b,A,o){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);if(!A.subSurface.isRefractionEnabled&&!A.subSurface.isTranslucencyEnabled||!o.thicknessFactor)return Promise.resolve();A.subSurface.volumeIndexOfRefraction=A.indexOfRefraction;const t=void 0!==o.attenuationDistance?o.attenuationDistance:Number.MAX_VALUE;return A.subSurface.tintColorAtDistance=t,void 0!==o.attenuationColor&&3==o.attenuationColor.length&&A.subSurface.tintColor.jd(o.attenuationColor[0],o.attenuationColor[1],o.attenuationColor[2]),A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=o.thicknessFactor,A.subSurface.useThicknessAsDepth=!0,o.thicknessTexture?(o.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${c}/thicknessTexture`,o.thicknessTexture).then((c=>{c.name=`${A.name} (Thickness)`,A.subSurface.thicknessTexture=c,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Z(bb),K(bb,!0,(c=>new Ab(c)));const ob="KHR_materials_dispersion";class tb{constructor(c){this.name=ob,this.order=174,this._loader=c,this.enabled=this._loader.isExtensionUsed(ob)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadDispersionPropertiesAsync(o,b,A,t)),await Promise.all(n).then((()=>{}))}))}_loadDispersionPropertiesAsync(c,b,A,o){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);return A.subSurface.isRefractionEnabled&&o.dispersion?(A.subSurface.isDispersionEnabled=!0,A.subSurface.dispersion=o.dispersion,Promise.resolve()):Promise.resolve()}}Z(ob),K(ob,!0,(c=>new tb(c)));const nb="EXT_materials_diffuse_roughness";class hb{constructor(c){this.name=nb,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(nb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=new Array;return n.push(this._loader.loadMaterialPropertiesAsync(c,b,A)),n.push(this._loadDiffuseRoughnessPropertiesAsync(o,t,A)),await Promise.all(n).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(c,b,A){if(!(A instanceof F.b))throw new Error(`${c}: Material type not supported`);const o=new Array;return A.brdf.baseDiffuseModel=Qc.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=b.diffuseRoughnessFactor?A.baseDiffuseRoughness=b.diffuseRoughnessFactor:A.baseDiffuseRoughness=0,b.diffuseRoughnessTexture&&o.push(this._loader.loadTextureInfoAsync(`${c}/diffuseRoughnessTexture`,b.diffuseRoughnessTexture,(c=>{c.name=`${A.name} (Diffuse Roughness)`,A.baseDiffuseRoughnessTexture=c}))),Promise.all(o).then((()=>{}))}}Z(nb),K(nb,!0,(c=>new hb(c)));const sb="KHR_mesh_quantization";class Lb{constructor(c){this.name=sb,this.enabled=c.isExtensionUsed(sb)}dispose(){}}Z(sb),K(sb,!0,(c=>new Lb(c)));const Cb="KHR_texture_basisu";class Jb{constructor(c){this.name=Cb,this._loader=c,this.enabled=c.isExtensionUsed(Cb)}dispose(){this._loader=null}_loadTextureAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>{const n=void 0==b.sampler?l.DefaultSampler:Q.Get(`${c}/sampler`,this._loader.Lk.samplers,b.sampler),h=Q.Get(`${o}/source`,this._loader.Lk.images,t.source);return await this._loader._createTextureAsync(c,n,h,(c=>{A(c)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}Z(Cb),K(Cb,!0,(c=>new Jb(c)));const Xb="KHR_texture_transform";class Rb{constructor(c){this.name=Xb,this._loader=c,this.enabled=this._loader.isExtensionUsed(Xb)}dispose(){this._loader=null}loadTextureInfoAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(o,t)=>await this._loader.loadTextureInfoAsync(c,b,(c=>{if(!(c instanceof M.d))throw new Error(`${o}: Texture type not supported`);t.offset&&(c.uOffset=t.offset[0],c.vOffset=t.offset[1]),c.uRotationCenter=0,c.vRotationCenter=0,t.rotation&&(c.wAng=-t.rotation),t.scale&&(c.uScale=t.scale[0],c.vScale=t.scale[1]),void 0!=t.texCoord&&(c.coordinatesIndex=t.texCoord),A(c)}))))}}Z(Xb),K(Xb,!0,(c=>new Rb(c)));const Nb="KHR_xmp_json_ld";class kb{constructor(c){this.name=Nb,this.order=100,this._loader=c,this.enabled=this._loader.isExtensionUsed(Nb)}dispose(){this._loader=null}onLoading(){var c,b,A;if(null===this._loader.rootBabylonMesh)return;const o=null===(c=this._loader.Lk.extensions)||void 0===c?void 0:c.KHR_xmp_json_ld,t=null===(b=this._loader.Lk.asset)||void 0===b||null===(A=b.extensions)||void 0===A?void 0:A.KHR_xmp_json_ld;if(o&&t){const c=+t.packet;o.packets&&c<o.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=o.packets[c])}}}function Eb(c,b,A,o){return n.d.$j(b,A).scale(o)}function Vb(c,b,A,o){return b[A]*o}function yb(c,b,A,o){return-b[A]*o}function jb(c,b,A,o){return b[A+1]*o}function Fb(c,b,A,o){return b[A]*o*2}function Mb(c){return{scale:[new db(R.d.ANIMATIONTYPE_FLOAT,`${c}.uScale`,Vb,(()=>2)),new db(R.d.ANIMATIONTYPE_FLOAT,`${c}.vScale`,jb,(()=>2))],offset:[new db(R.d.ANIMATIONTYPE_FLOAT,`${c}.uOffset`,Vb,(()=>2)),new db(R.d.ANIMATIONTYPE_FLOAT,`${c}.vOffset`,jb,(()=>2))],rotation:[new db(R.d.ANIMATIONTYPE_FLOAT,`${c}.wAng`,yb,(()=>1))]}}Z(Nb),K(Nb,!0,(c=>new kb(c)));class Wb extends T.AnimationPropertyInfo{buildAnimations(c,b,A,o){return[{babylonAnimatable:c._babylonCamera,babylonAnimation:this._buildAnimation(b,A,o)}]}}class db extends T.AnimationPropertyInfo{buildAnimations(c,b,A,o){const t=[];for(const n in c._data)t.push({babylonAnimatable:c._data[n].babylonMaterial,babylonAnimation:this._buildAnimation(b,A,o)});return t}}class rb extends T.AnimationPropertyInfo{buildAnimations(c,b,A,o){return[{babylonAnimatable:c._babylonLight,babylonAnimation:this._buildAnimation(b,A,o)}]}}(0,H.l)("/cameras/{}/orthographic/xmag",[new Wb(R.d.ANIMATIONTYPE_FLOAT,"orthoLeft",yb,(()=>1)),new Wb(R.d.ANIMATIONTYPE_FLOAT,"orthoRight",jb,(()=>1))]),(0,H.l)("/cameras/{}/orthographic/ymag",[new Wb(R.d.ANIMATIONTYPE_FLOAT,"orthoBottom",yb,(()=>1)),new Wb(R.d.ANIMATIONTYPE_FLOAT,"orthoTop",jb,(()=>1))]),(0,H.l)("/cameras/{}/orthographic/zfar",[new Wb(R.d.ANIMATIONTYPE_FLOAT,"maxZ",Vb,(()=>1))]),(0,H.l)("/cameras/{}/orthographic/znear",[new Wb(R.d.ANIMATIONTYPE_FLOAT,"Vj",Vb,(()=>1))]),(0,H.l)("/cameras/{}/perspective/yfov",[new Wb(R.d.ANIMATIONTYPE_FLOAT,"fov",Vb,(()=>1))]),(0,H.l)("/cameras/{}/perspective/zfar",[new Wb(R.d.ANIMATIONTYPE_FLOAT,"maxZ",Vb,(()=>1))]),(0,H.l)("/cameras/{}/perspective/znear",[new Wb(R.d.ANIMATIONTYPE_FLOAT,"Vj",Vb,(()=>1))]),(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new db(R.d.ANIMATIONTYPE_COLOR3,"albedoColor",Eb,(()=>4)),new db(R.d.ANIMATIONTYPE_FLOAT,"alpha",(function(c,b,A,o){return b[A+3]*o}),(()=>4))]),(0,H.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"metallic",Vb,(()=>1))]),(0,H.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"roughness",Vb,(()=>1))]);const zb=Mb("albedoTexture");(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",zb.scale),(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",zb.offset),(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",zb.rotation);const Yb=Mb("metallicTexture");(0,H.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Yb.scale),(0,H.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Yb.offset),(0,H.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Yb.rotation),(0,H.l)("/materials/{}/emissiveFactor",[new db(R.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Eb,(()=>3))]);const Db=Mb("bumpTexture");(0,H.l)("/materials/{}/normalTexture/scale",[new db(R.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Vb,(()=>1))]),(0,H.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Db.scale),(0,H.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Db.offset),(0,H.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Db.rotation),(0,H.l)("/materials/{}/occlusionTexture/strength",[new db(R.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Vb,(()=>1))]);const fb=Mb("ambientTexture");(0,H.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",fb.scale),(0,H.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",fb.offset),(0,H.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",fb.rotation);const vb=Mb("emissiveTexture");(0,H.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",vb.scale),(0,H.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",vb.offset),(0,H.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",vb.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new db(R.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new db(R.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Vb,(()=>1))]);const Gb=Mb("anisotropy.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Gb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Gb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Gb.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Vb,(()=>1))]);const Pb=Mb("clearCoat.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Pb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Pb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Pb.rotation);const Ob=Mb("clearCoat.bumpTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new db(R.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ob.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ob.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ob.rotation);const pb=Mb("clearCoat.textureRoughness");(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",pb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",pb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",pb.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new db(R.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new db(R.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new db(R.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new db(R.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new db(R.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Vb,(()=>1))]);const qb=Mb("iridescence.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",qb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",qb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",qb.rotation);const Ib=Mb("iridescence.thicknessTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ib.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ib.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ib.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new db(R.d.ANIMATIONTYPE_COLOR3,"sheen.color",Eb,(()=>3))]),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",Vb,(()=>1))]);const Kb=Mb("sheen.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Kb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Kb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Kb.rotation);const Zb=Mb("sheen.textureRoughness");(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Zb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Zb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Zb.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new db(R.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Eb,(()=>3))]);const Hb=Mb("metallicReflectanceTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Hb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Hb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Hb.rotation);const Sb=Mb("reflectanceTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Sb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Sb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Sb.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Vb,(()=>1))]);const Bb=Mb("subSurface.refractionIntensityTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Bb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Bb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Bb.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new db(R.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Eb,(()=>3))]),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new db(R.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Vb,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Vb,(()=>1))]);const Qb=Mb("subSurface.thicknessTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Qb.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Qb.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Qb.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new db(R.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Vb,(()=>1))]);const ab=Mb("subSurface.translucencyIntensityTexture");(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ab.scale),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ab.offset),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ab.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new db(R.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Eb,(()=>3))]);const lb=Mb("subSurface.translucencyColorTexture");(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",lb.scale),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",lb.offset),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",lb.rotation),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new rb(R.d.ANIMATIONTYPE_COLOR3,"diffuse",Eb,(()=>3))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new rb(R.d.ANIMATIONTYPE_FLOAT,"intensity",Vb,(()=>1))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new rb(R.d.ANIMATIONTYPE_FLOAT,"range",Vb,(()=>1))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new rb(R.d.ANIMATIONTYPE_FLOAT,"innerAngle",Fb,(()=>1))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new rb(R.d.ANIMATIONTYPE_FLOAT,"angle",Fb,(()=>1))]),(0,H.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new rb(R.d.ANIMATIONTYPE_COLOR3,"diffuse",Eb,(()=>3))]),(0,H.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new rb(R.d.ANIMATIONTYPE_FLOAT,"intensity",Vb,(()=>1))]);const Tb="KHR_animation_pointer";class ib{constructor(c){this.name=Tb,this._loader=c,this._pathToObjectConverter=(0,H.j)(this._loader.Lk)}get enabled(){return this._loader.isExtensionUsed(Tb)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(c,b,A,o,t){var n;const h=null===(n=o.target.extensions)||void 0===n?void 0:n.KHR_animation_pointer;if(!h||!this._pathToObjectConverter)return null;"pointer"!==o.target.path&&E.c.Warn(`${c}/target/path: Value (${o.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=o.target.node&&E.c.Warn(`${c}/target/node: Value (${o.target.node}) must not be present when using the ${this.name} extension`);const s=`${c}/extensions/${this.name}`,L=h.pointer;if(!L)throw new Error(`${s}: Pointer is missing`);try{const n=this._pathToObjectConverter.convert(L);if(!n.info.interpolation)throw new Error(`${s}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(c,b,A,o,{object:n.object,info:n.info.interpolation},t)}catch(C){return E.c.Warn(`${s}/pointer: Invalid pointer (${L}) skipped`),null}}}Z(Tb),K(Tb,!0,(c=>new ib(c)));class gb{constructor(c,b,A){this.frame=c,this.action=b,this.onlyOnce=A,this.isDone=!1}_clone(){return new gb(this.frame,this.action,this.onlyOnce)}}var ub=A(543),eb=A(589),xb=A(580);class Ub{get loop(){return this._loop}set loop(c){c!==this._loop&&(this._loop=c,this.updateOptions({loop:c}))}get currentTime(){var c;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(c=eb.c.audioEngine)&&void 0!==c&&c.audioContext&&(this.isPlaying||this.isPaused)){const c=this.isPaused?0:eb.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+c}return 0}get spatialSound(){return this._spatialSound}set spatialSound(c){if(c==this._spatialSound)return;const b=this.isPlaying;this.pause(),c?(this._spatialSound=c,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(c,b,A){var o;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new J.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=t.k.Zero(),this._localDirection=new t.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=c,A=A||k.c.LastCreatedScene)if(this._scene=A,Ub._SceneComponentInitialization(A),this._readyToPlayCallback=n,this._customAttenuationFunction=(c,b,A,o,t)=>b<A?c*(1-b/A):0,s&&(this.autoplay=s.autoplay||!1,this._loop=s.loop||!1,void 0!==s.volume&&(this._volume=s.volume),this._spatialSound=s.spatialSound??!1,this.maxDistance=s.maxDistance??100,this.useCustomAttenuation=s.useCustomAttenuation??!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=s.streaming??!1,this._length=s.length,this._offset=s.offset),null!==(o=eb.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&eb.c.audioEngine.audioContext){this._soundGain=eb.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let c=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let A=[],o=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eb.c.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eb.c.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(o=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":A.push(b);case"Array":0===A.length&&(A=b);for(let c=0;c<A.length;c++){const b=A[c];if(o=s&&s.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&eb.c.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&eb.c.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),o){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,h.d.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(c=>{this._soundLoaded(c)}),void 0,!0,!0,(c=>{c&&E.c.Error("XHR "+c.status+" error on: "+b+"."),E.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:c=!1}c?o||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):E.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(L){E.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),eb.c.audioEngine&&!eb.c.audioEngine.WarnedWebAudioUnsupported&&(E.c.Error("Web Audio is not supported by your browser."),eb.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var c;null!==(c=eb.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(c){var b;null!==(b=eb.c.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=c,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(c){var b;null!==(b=eb.c.audioEngine)&&void 0!==b&&b.audioContext&&eb.c.audioEngine.audioContext.decodeAudioData(c,(c=>{this._audioBufferLoaded(c)}),(c=>{E.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+c)}))}setAudioBuffer(c){var b;null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=c,this._isReadyToPlay=!0)}updateOptions(c){c&&(this.loop=c.loop??this.loop,this.maxDistance=c.maxDistance??this.maxDistance,this.useCustomAttenuation=c.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=c.rolloffFactor??this.rolloffFactor,this.refDistance=c.refDistance??this.refDistance,this.distanceModel=c.distanceModel??this.distanceModel,this._playbackRate=c.playbackRate??this._playbackRate,this._length=c.length??void 0,this.spatialSound=c.spatialSound??this._spatialSound,this._setOffset(c.offset??void 0),this.setVolume(c.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var c;null!==(c=eb.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&eb.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??eb.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var c;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(c=this._soundPanner)||void 0===c||c.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var c;null!==(c=eb.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(c){var b;null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(c),this._isOutputConnected=!0)}setDirectionalCone(c,b,A){b<c?E.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=c,this._coneOuterAngle=b,this._coneOuterGain=A,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(c){if(c!=this._coneInnerAngle){var b;if(this._coneOuterAngle<c)return void E.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=c,null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(c){if(c!=this._coneOuterAngle){var b;if(c<this._coneInnerAngle)return void E.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=c,null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(c){var b;c.equals(this._position)||(this._position.p(c),null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(c){var b;this._localDirection=c,null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const c=this._connectedTransformNode.getWorldMatrix(),b=t.k.TransformNormal(this._localDirection,c);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var c;if(null!==(c=eb.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const c=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Xd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,c,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(c){this._customAttenuationFunction=c}play(c,b,A){var o;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(o=eb.c.audioEngine)&&void 0!==o&&o.audioContext)try{var t,n;this._clearTimeoutsAndObservers();let o=c?(null===(t=eb.c.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+c:null===(n=eb.c.audioEngine)||void 0===n?void 0:n.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=eb.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const c=()=>{var A;if(null!==(A=eb.c.audioEngine)&&void 0!==A&&A.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const A=this._htmlAudioElement.play();void 0!==A&&A.catch((()=>{var b,A;(null===(b=eb.c.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(A=eb.c.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{c()})))}))}else{var o;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(o=eb.c.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{c()}))}};c()}}else{var h;const t=()=>{var t;if(null!==(t=eb.c.audioEngine)&&void 0!==t&&t.audioContext){var n;if(A=A||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const c=this._soundSource;c.onended=()=>{c.disconnect()}}if(this._soundSource=null===(n=eb.c.audioEngine)||void 0===n?void 0:n.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var h;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==A&&(this._soundSource.loopEnd=(0|b)+A),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},o=c?(null===(h=eb.c.audioEngine)||void 0===h?void 0:h.audioContext.currentTime)+c:eb.c.audioEngine.audioContext.currentTime;const t=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(o,t,this.loop?void 0:A)}}};"suspended"===(null===(h=eb.c.audioEngine)||void 0===h?void 0:h.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var c;"suspended"===(null===(c=eb.c.audioEngine)||void 0===c?void 0:c.audioContext.state)?(eb.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=eb.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{t()})))):t()}),500):t()}this._startTime=o,this.isPlaying=!0,this.isPaused=!1}catch(s){E.c.Error("Error while trying to play audio: "+this.name+", "+s.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(c){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var A;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(A=this._streamingSource)||void 0===A||A.disconnect();this.isPlaying=!1}else if(null!==(b=eb.c.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=c?eb.c.audioEngine.audioContext.currentTime+c:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(c=eb.c.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=eb.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(c,b){var A;null!==(A=eb.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._soundGain&&(b&&eb.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(eb.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,eb.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(c,eb.c.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=c),this._volume=c}setPlaybackRate(c){this._playbackRate=c,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(c){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=c,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=c=>this._onRegisterAfterWorldMatrixUpdate(c),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(c){var b;if(c.getBoundingInfo){const b=c.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(c.absolutePosition);null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const c=()=>{(0,xb.d)((()=>this._isReadyToPlay),(()=>{A._audioBuffer=this.getAudioBuffer(),A._isReadyToPlay=!0,A.autoplay&&A.play(0,this._offset,this._length)}),void 0,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},A=new Ub(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&A.setAttenuationFunction(this._customAttenuationFunction),A.setPosition(this._position),A.setPlaybackRate(this._playbackRate),c(),A}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const c={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(c.connectedMeshId=this._connectedTransformNode.id),c.position=this._position.hk(),c.refDistance=this.refDistance,c.distanceModel=this.distanceModel,c.isDirectional=this._isDirectional,c.localDirectionToMesh=this._localDirection.hk(),c.coneInnerAngle=this._coneInnerAngle,c.coneOuterAngle=this._coneOuterAngle,c.coneOuterGain=this._coneOuterGain),c}static Parse(c,b,A,o){const n=c.name;let h;h=c.url?A+c.url:A+n;const s={autoplay:c.autoplay,loop:c.loop,volume:c.volume,spatialSound:c.spatialSound,maxDistance:c.maxDistance,rolloffFactor:c.rolloffFactor,refDistance:c.refDistance,distanceModel:c.distanceModel,playbackRate:c.playbackRate};let L;if(o){const c=()=>{(0,xb.d)((()=>o._isReadyToPlay),(()=>{L._audioBuffer=o.getAudioBuffer(),L._isReadyToPlay=!0,L.autoplay&&L.play(0,L._offset,L._length)}),void 0,300)};L=new Ub(n,new ArrayBuffer(0),b,null,s),c()}else L=new Ub(n,h,b,(()=>{b.removePendingData(L)}),s),b.addPendingData(L);if(c.position){const b=t.k.$j(c.position);L.setPosition(b)}if(c.isDirectional&&(L.setDirectionalCone(c.coneInnerAngle||360,c.coneOuterAngle||360,c.coneOuterGain||0),c.localDirectionToMesh)){const b=t.k.$j(c.localDirectionToMesh);L.setLocalDirectionToMesh(b)}if(c.connectedMeshId){const A=b.getMeshById(c.connectedMeshId);A&&L.attachToMesh(A)}return c.metadata&&(L.metadata=c.metadata),L}_setOffset(c){this._offset!==c&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=c)}_clearTimeoutsAndObservers(){var c;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(c=eb.c.audioEngine)||void 0===c||c.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Ub._SceneComponentInitialization=c=>{throw(0,ub.c)("AudioSceneComponent")},(0,dc.d)("BABYLON.Sound",Ub);class wb{constructor(c,b,A){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==A.length)throw new Error("Sounds length does not equal weights length");this.loop=c,this._weights=A;let o=0;for(const n of A)o+=n;const t=o>0?1/o:0;for(let n=0;n<this._weights.length;n++)this._weights[n]*=t;this._sounds=b;for(const n of this._sounds)n.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(c){if(c!==this._coneInnerAngle){if(this._coneOuterAngle<c)return void E.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=c;for(const b of this._sounds)b.directionalConeInnerAngle=c}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(c){if(c!==this._coneOuterAngle){if(c<this._coneInnerAngle)return void E.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=c;for(const b of this._sounds)b.directionalConeOuterAngle=c}}get volume(){return this._volume}set volume(c){if(c!==this._volume)for(const b of this._sounds)b.setVolume(c)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(c){if(!this.isPaused){this.stop();const c=Math.random();let b=0;for(let A=0;A<this._weights.length;A++)if(b+=this._weights[A],c<=b){this._currentIndex=A;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:c):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mb{constructor(c){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(c=c||k.c.LastCreatedScene)&&(this._scene=c,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var c;null!==(c=eb.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&eb.c.audioEngine.audioContext&&(this._outputAudioNode=eb.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(eb.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(eb.c.audioEngine&&eb.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(c){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&c.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==c.soundTrackId&&(-1===c.soundTrackId?this._scene.mainSoundTrack.removeSound(c):this._scene.soundTracks&&this._scene.soundTracks[c.soundTrackId].removeSound(c)),this.soundCollection.push(c),c.soundTrackId=this.id}removeSound(c){const b=this.soundCollection.indexOf(c);-1!==b&&this.soundCollection.splice(b,1)}setVolume(c){var b;null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=c)}switchPanningModelToHRTF(){var c;if(null!==(c=eb.c.audioEngine)&&void 0!==c&&c.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var c;if(null!==(c=eb.c.audioEngine)&&void 0!==c&&c.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(c){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=c,null!==(b=eb.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,eb.c.audioEngine.masterGain))}}var cA=A(877),bA=A(2186),AA=A(528);eb.c.AudioEngineFactory=(c,b,A)=>new oA(c,b,A);class oA{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new J.b,this.onAudioLockedObservable=new J.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,AA.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const o=document.createElement("audio");this._hostElement=c,this._audioContext=b,this._audioDestination=A;try{o&&o.canPlayType&&(o.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||o.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(t){}try{o&&o.canPlayType&&o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(t){}}lock(){this._triggerSuspendedState()}unlock(){var c,b;if("running"===(null===(c=this._audioContext)||void 0===c?void 0:c.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(b=this._audioContext)||void 0===b||b.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{E.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var c;null===(c=this._audioContext)||void 0===c||c.addEventListener("statechange",(()=>{var c;this.unlocked&&"running"!==(null===(c=this._audioContext)||void 0===c?void 0:c.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var c;return null!==(c=this._audioContext)&&void 0!==c&&c.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(c){this.canUseWebAudio=!1,E.c.Error("Web Audio: "+c.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(c){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const c=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",b=document.createElement("style");b.appendChild(document.createTextNode(c)),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var c;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(c=this._audioContext)||void 0===c||c.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(c){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=c)}connectToAnalyser(c){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=c,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var tA=A(536);(0,A(12461).h)(cA.e.NAME_AUDIO,((c,b,A,o)=>{let t,n=[];if(A.jm=A.jm||[],void 0!==c.jm&&null!==c.jm)for(let s=0,L=c.jm.length;s<L;s++){var h;const L=c.jm[s];null!==(h=eb.c.audioEngine)&&void 0!==h&&h.canUseWebAudio?(L.url||(L.url=L.name),n[L.url]?A.jm.push(Ub.Parse(L,b,o,n[L.url])):(t=Ub.Parse(L,b,o),n[L.url]=t,A.jm.push(t))):A.jm.push(new Ub(L.name,null,b))}n=[]})),Object.defineProperty(bA.d.prototype,"mainSoundTrack",{get:function(){let c=this._getComponent(cA.e.NAME_AUDIO);return c||(c=new nA(this),this.bb(c)),this._mainSoundTrack||(this._mainSoundTrack=new mb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),bA.d.prototype.getSoundByName=function(c){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===c)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let A=0;A<this.soundTracks.length;A++)for(b=0;b<this.soundTracks[A].soundCollection.length;b++)if(this.soundTracks[A].soundCollection[b].name===c)return this.soundTracks[A].soundCollection[b];return null},Object.defineProperty(bA.d.prototype,"audioEnabled",{get:function(){let c=this._getComponent(cA.e.NAME_AUDIO);return c||(c=new nA(this),this.bb(c)),c.audioEnabled},set:function(c){let b=this._getComponent(cA.e.NAME_AUDIO);b||(b=new nA(this),this.bb(b)),c?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(bA.d.prototype,"headphone",{get:function(){let c=this._getComponent(cA.e.NAME_AUDIO);return c||(c=new nA(this),this.bb(c)),c.headphone},set:function(c){let b=this._getComponent(cA.e.NAME_AUDIO);b||(b=new nA(this),this.bb(b)),c?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(bA.d.prototype,"audioListenerPositionProvider",{get:function(){let c=this._getComponent(cA.e.NAME_AUDIO);return c||(c=new nA(this),this.bb(c)),c.audioListenerPositionProvider},set:function(c){let b=this._getComponent(cA.e.NAME_AUDIO);if(b||(b=new nA(this),this.bb(b)),c&&"function"!==typeof c)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=c},enumerable:!0,configurable:!0}),Object.defineProperty(bA.d.prototype,"audioListenerRotationProvider",{get:function(){let c=this._getComponent(cA.e.NAME_AUDIO);return c||(c=new nA(this),this.bb(c)),c.audioListenerRotationProvider},set:function(c){let b=this._getComponent(cA.e.NAME_AUDIO);if(b||(b=new nA(this),this.bb(b)),c&&"function"!==typeof c)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=c},enumerable:!0,configurable:!0}),Object.defineProperty(bA.d.prototype,"audioPositioningRefreshRate",{get:function(){let c=this._getComponent(cA.e.NAME_AUDIO);return c||(c=new nA(this),this.bb(c)),c.audioPositioningRefreshRate},set:function(c){let b=this._getComponent(cA.e.NAME_AUDIO);b||(b=new nA(this),this.bb(b)),b.audioPositioningRefreshRate=c},enumerable:!0,configurable:!0});class nA{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(c){this.name=cA.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new t.k,this._cachedCameraPosition=new t.k,this._lastCheck=0,this._invertMatrixTemp=new t.b,this._cameraDirectionTemp=new t.k,(c=c||k.c.LastCreatedScene)&&(this.yd=c,c.soundTracks=[],c.jm=[])}register(){this.yd._afterRenderStage.registerStep(cA.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(c){if(c.jm=[],this.yd.soundTracks)for(let b=0;b<this.yd.soundTracks.length;b++){const A=this.yd.soundTracks[b];for(let b=0;b<A.soundCollection.length;b++)c.jm.push(A.soundCollection[b].serialize())}}addFromContainer(c){if(c.jm)for(const b of c.jm)b.play(),b.autoplay=!0,this.yd.mainSoundTrack.addSound(b)}removeFromContainer(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(c.jm)for(const A of c.jm)A.stop(),A.autoplay=!1,this.yd.mainSoundTrack.removeSound(A),b&&A.dispose()}dispose(){const c=this.yd;if(c._mainSoundTrack&&c.mainSoundTrack.dispose(),c.soundTracks)for(let b=0;b<c.soundTracks.length;b++)c.soundTracks[b].dispose()}disableAudio(){const c=this.yd;let b;for(this._audioEnabled=!1,eb.c.audioEngine&&eb.c.audioEngine.audioContext&&eb.c.audioEngine.audioContext.suspend(),b=0;b<c.mainSoundTrack.soundCollection.length;b++)c.mainSoundTrack.soundCollection[b].pause();if(c.soundTracks)for(b=0;b<c.soundTracks.length;b++)for(let A=0;A<c.soundTracks[b].soundCollection.length;A++)c.soundTracks[b].soundCollection[A].pause()}enableAudio(){const c=this.yd;let b;for(this._audioEnabled=!0,eb.c.audioEngine&&eb.c.audioEngine.audioContext&&eb.c.audioEngine.audioContext.resume(),b=0;b<c.mainSoundTrack.soundCollection.length;b++)c.mainSoundTrack.soundCollection[b].isPaused&&c.mainSoundTrack.soundCollection[b].play();if(c.soundTracks)for(b=0;b<c.soundTracks.length;b++)for(let A=0;A<c.soundTracks[b].soundCollection.length;A++)c.soundTracks[b].soundCollection[A].isPaused&&c.soundTracks[b].soundCollection[A].play()}switchAudioModeForHeadphones(){const c=this.yd;if(this._headphone=!0,c.mainSoundTrack.switchPanningModelToHRTF(),c.soundTracks)for(let b=0;b<c.soundTracks.length;b++)c.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const c=this.yd;if(this._headphone=!1,c.mainSoundTrack.switchPanningModelToEqualPower(),c.soundTracks)for(let b=0;b<c.soundTracks.length;b++)c.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const c=tA.e.Now;if(this._lastCheck&&c-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=c;const b=this.yd;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const A=eb.c.audioEngine;if(A&&A.audioContext){let c,o=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(o=b.activeCameras[0]),this.audioListenerPositionProvider){const c=this.audioListenerPositionProvider();A.audioContext.listener.setPosition(c.x||0,c.y||0,c.z||0)}else o?this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.p(o.globalPosition),A.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)):A.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const c=this.audioListenerRotationProvider();A.audioContext.listener.setOrientation(c.x||0,c.y||0,c.z||0,0,1,0)}else o?(o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]),o.getViewMatrix().invertToRef(this._invertMatrixTemp),t.k.TransformNormalToRef(nA._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),A.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):A.audioContext.listener.setOrientation(0,0,0,0,1,0);for(c=0;c<b.mainSoundTrack.soundCollection.length;c++){const A=b.mainSoundTrack.soundCollection[c];A.useCustomAttenuation&&A.updateDistanceFromListener()}if(b.soundTracks)for(c=0;c<b.soundTracks.length;c++)for(let A=0;A<b.soundTracks[c].soundCollection.length;A++){const o=b.soundTracks[c].soundCollection[A];o.useCustomAttenuation&&o.updateDistanceFromListener()}}}}nA._CameraDirection=new t.k(0,0,-1),Ub._SceneComponentInitialization=c=>{let b=c._getComponent(cA.e.NAME_AUDIO);b||(b=new nA(c),c.bb(b))};const hA="MSFT_audio_emitter";class sA{constructor(c){this.name=hA,this._loader=c,this.enabled=this._loader.isExtensionUsed(hA)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const c=this._loader.Lk.extensions;if(c&&c[this.name]){const b=c[this.name];this._clips=b.clips,this._emitters=b.emitters,Q.Assign(this._clips),Q.Assign(this._emitters)}}loadSceneAsync(c,b){return l.LoadExtensionAsync(c,b,this.name,(async(A,o)=>{const t=new Array;t.push(this._loader.loadSceneAsync(c,b));for(const c of o.emitters){const b=Q.Get(`${A}/emitters`,this._emitters,c);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${A}: Direction or Distance properties are not allowed on emitters attached to a scene`);t.push(this._loadEmitterAsync(`${A}/emitters/${b.index}`,b))}await Promise.all(t)}))}loadNodeAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(c,o)=>{const n=new Array,s=await this._loader.loadNodeAsync(c,b,(b=>{for(const A of o.emitters){const o=Q.Get(`${c}/emitters`,this._emitters,A);n.push(this._loadEmitterAsync(`${c}/emitters/${o.index}`,o).then((()=>{for(const c of o._babylonSounds)c.attachToMesh(b),void 0==o.innerAngle&&void 0==o.outerAngle||(c.setLocalDirectionToMesh(t.k.Forward()),c.setDirectionalCone(2*h.d.ToDegrees(void 0==o.innerAngle?Math.PI:o.innerAngle),2*h.d.ToDegrees(void 0==o.outerAngle?Math.PI:o.outerAngle),0))})))}A(b)}));return await Promise.all(n),s}))}loadAnimationAsync(c,b){return l.LoadExtensionAsync(c,b,this.name,(async(A,o)=>{const t=await this._loader.loadAnimationAsync(c,b),n=new Array;Q.Assign(o.events);for(const h of o.events)n.push(this._loadAnimationEventAsync(`${A}/events/${h.index}`,c,b,h,t));return await Promise.all(n),t}))}_loadClipAsync(c,b){if(b._objectURL)return b._objectURL;let A;if(b.uri)A=this._loader.loadUriAsync(c,b,b.uri);else{const o=Q.Get(`${c}/bufferView`,this._loader.Lk.bufferViews,b.bufferView);A=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}return b._objectURL=A.then((c=>URL.createObjectURL(new Blob([c],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(c,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const c=new Array,A=b.name||`emitter${b.index}`,o={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let n=0;n<b.clips.length;n++){const t=`/extensions/${this.name}/clips`,h=Q.Get(t,this._clips,b.clips[n].clip);c.push(this._loadClipAsync(`${t}/${b.clips[n].clip}`,h).then((c=>{const t=b._babylonSounds[n]=new Ub(A,c,this._loader.babylonScene,null,o);t.refDistance=b.refDistance||1,t.maxDistance=b.maxDistance||256,t.rolloffFactor=b.rolloffFactor||1,t.distanceModel=b.distanceModel||"exponential"})))}const t=Promise.all(c).then((()=>{const c=b.clips.map((c=>c.weight||1)),A=new wb(b.loop||!1,b._babylonSounds,c);b.innerAngle&&(A.directionalConeInnerAngle=2*h.d.ToDegrees(b.innerAngle)),b.outerAngle&&(A.directionalConeOuterAngle=2*h.d.ToDegrees(b.outerAngle)),b.volume&&(A.volume=b.volume),b._babylonData.sound=A}));b._babylonData={loaded:t}}return b._babylonData.loaded}_getEventAction(c,b,A,o,t){switch(A){case"play":return c=>{const A=(t||0)+(c-o);b.play(A)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${c}: Unsupported action ${A}`)}}_loadAnimationEventAsync(c,b,A,o,t){if(0==t.targetedAnimations.length)return Promise.resolve();const n=t.targetedAnimations[0],h=o.j,s=Q.Get(`/extensions/${this.name}/emitters`,this._emitters,h);return this._loadEmitterAsync(c,s).then((()=>{const b=s._babylonData.sound;if(b){const A=new gb(o.time,this._getEventAction(c,b,o.action,o.time,o.startOffset));n.animation.addEvent(A),t.onAnimationGroupEndObservable.add((()=>{b.stop()})),t.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}Z(hA),K(hA,!0,(c=>new sA(c)));const LA="MSFT_lod";class CA{constructor(c){var b;this.name=LA,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new J.b,this.onMaterialLODsLoadedObservable=new J.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=c,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[LA])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(LA)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let c=0;c<this._nodePromiseLODs.length;c++){const b=Promise.all(this._nodePromiseLODs[c]).then((()=>{0!==c&&(this._loader.endPerformanceCounter(`Node LOD ${c}`),this._loader.log(`Loaded node LOD ${c}`)),this.onNodeLODsLoadedObservable.notifyObservers(c),c!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${c+1}`),this._loadBufferLOD(this._nodeBufferLODs,c+1),this._nodeSignalLODs[c]&&this._nodeSignalLODs[c].resolve())}));this._loader._completePromises.push(b)}for(let c=0;c<this._materialPromiseLODs.length;c++){const b=Promise.all(this._materialPromiseLODs[c]).then((()=>{0!==c&&(this._loader.endPerformanceCounter(`Material LOD ${c}`),this._loader.log(`Loaded material LOD ${c}`)),this.onMaterialLODsLoadedObservable.notifyObservers(c),c!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${c+1}`),this._loadBufferLOD(this._materialBufferLODs,c+1),this._materialSignalLODs[c]&&this._materialSignalLODs[c].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(c,b){const A=this._loader.loadSceneAsync(c,b);return this._loadBufferLOD(this._bufferLODs,0),A}loadNodeAsync(c,b,A){return l.LoadExtensionAsync(c,b,this.name,(async(c,t)=>{let n;const h=this._getLODs(c,b,this._loader.Lk.nodes,t.ids);this._loader.logOpen(`${c}`);for(let b=0;b<h.length;b++){const c=h[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new o);const t=c=>{A(c),c.jc(!1)},s=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,t).then((c=>{if(0!==b){const c=h[b-1];c._babylonTransformNode&&(this._disposeTransformNode(c._babylonTransformNode),delete c._babylonTransformNode)}return c.jc(!0),c}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?n=s:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(s))}return this._loader.logClose(),await n}))}_loadMaterialAsync(c,b,A,o,t){return this._nodeIndexLOD?null:l.LoadExtensionAsync(c,b,this.name,(async(c,n)=>{let h;const s=this._getLODs(c,b,this._loader.Lk.materials,n.ids);this._loader.logOpen(`${c}`);for(let b=0;b<s.length;b++){const c=s[b];0!==b&&(this._materialIndexLOD=b);const n=this._loader._loadMaterialAsync(`/materials/${c.index}`,c,A,o,(c=>{0===b&&t(c)})).then((c=>{if(0!==b){t(c);const A=s[b-1]._data;A[o]&&(this._disposeMaterials([A[o].babylonMaterial]),delete A[o])}return c}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?h=n:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(n))}return this._loader.logClose(),await h}))}_loadUriAsync(c,b,A){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const t=this._nodeIndexLOD-1;return this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new o,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(c,b,A)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const t=this._materialIndexLOD-1;return this._materialSignalLODs[t]=this._materialSignalLODs[t]||new o,this._materialSignalLODs[t].promise.then((async()=>await this._loader.loadUriAsync(c,b,A)))}return null}loadBufferAsync(c,b,A,t){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${c}: Uri is missing or the binary glTF is missing its binary chunk`);const b=async(c,b)=>{const n=A,h=n+t-1;let s=c[b];return s?(s.start=Math.min(s.start,n),s.end=Math.max(s.end,h)):(s={start:n,end:h,loaded:new o},c[b]=s),await s.loaded.promise.then((c=>new Uint8Array(c.buffer,c.byteOffset+A-s.start,t)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(c,b){const A=c[b];A&&(this._loader.log(`Loading buffer range [${A.start}-${A.end}]`),this._loader.bin.readAsync(A.start,A.end-A.start+1).then((c=>{A.loaded.resolve(c)}),(c=>{A.loaded.reject(c)})))}_getLODs(c,b,A,o){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const t=[];for(let n=o.length-1;n>=0;n--)if(t.push(Q.Get(`${c}/ids/${o[n]}`,A,o[n])),t.length===this.maxLODsToLoad)return t;return t.push(b),t}_disposeTransformNode(c){const b=[],A=c.material;A&&b.push(A);for(const t of c.getChildMeshes())t.material&&b.push(t.material);c.dispose();const o=b.filter((c=>this._loader.babylonScene.meshes.every((b=>b.material!=c))));this._disposeMaterials(o)}_disposeMaterials(c){const b={};for(const A of c){for(const c of A.getActiveTextures())b[c.uniqueId]=c;A.dispose()}for(const A in b)for(const c of this._loader.babylonScene.materials)c.hasTexture(b[A])&&delete b[A];for(const A in b)b[A].dispose()}}Z(LA),K(LA,!0,(c=>new CA(c)));const JA="MSFT_minecraftMesh";class XA{constructor(c){this.name=JA,this._loader=c,this.enabled=this._loader.isExtensionUsed(JA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtraAsync(c,b,this.name,(async(o,t)=>{if(t){if(!(A instanceof F.b))throw new Error(`${o}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(c,b,A);return A.needAlphaBlending()&&(A.forceDepthWrite=!0,A.separateCullingPass=!0),A.jk=A.forceDepthWrite,A.twoSidedLighting=!0,await t}}))}}Z(JA),K(JA,!0,(c=>new XA(c)));const RA="MSFT_sRGBFactors";class NA{constructor(c){this.name=RA,this._loader=c,this.enabled=this._loader.isExtensionUsed(RA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,b,A){return l.LoadExtraAsync(c,b,this.name,(async(o,t)=>{if(t){if(!(A instanceof F.b))throw new Error(`${o}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(c,b,A),n=A.va().getEngine().useExactSrgbConversions;return A.albedoTexture||A.albedoColor.toLinearSpaceToRef(A.albedoColor,n),A.reflectivityTexture||A.reflectivityColor.toLinearSpaceToRef(A.reflectivityColor,n),await t}}))}}Z(RA),K(RA,!0,(c=>new NA(c)));var kA=A(12744);const EA={};var VA=A(12803),yA=A(12780),jA=A(12752),FA=A(12763);function MA(c,b){for(const A of c)for(const c of A.dataOutputs)if(c.uniqueId===b)return c;throw new Error("Could not find data out connection with unique id "+b)}function WA(c,b){for(const A of c)if(A instanceof yA.e)for(const c of A.signalInputs)if(c.uniqueId===b)return c;throw new Error("Could not find signal in connection with unique id "+b)}async function dA(c,b){const o=await Promise.all(c.allBlocks.map((async c=>{const b=function(c){switch(c){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([A.e(62),A.e(63)]).then(A.bind(A,13955))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await A.e(64).then(A.bind(A,13962))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await A.e(65).then(A.bind(A,13969))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await A.e(66).then(A.bind(A,13976))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await A.e(67).then(A.bind(A,13984))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await A.e(68).then(A.bind(A,13993))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await A.e(69).then(A.bind(A,14e3))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await A.e(70).then(A.bind(A,14004))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await A.e(71).then(A.bind(A,14008))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await A.e(74).then(A.bind(A,14044))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await A.e(74).then(A.bind(A,14044))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await A.e(74).then(A.bind(A,14044))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await A.e(74).then(A.bind(A,14044))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await A.e(79).then(A.bind(A,14047))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await A.e(80).then(A.bind(A,14054))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await A.e(81).then(A.bind(A,14059))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await A.e(82).then(A.bind(A,14065))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await A.e(83).then(A.bind(A,14073))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await A.e(84).then(A.bind(A,14079))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await A.e(85).then(A.bind(A,14082))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await A.e(86).then(A.bind(A,14091))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await A.e(87).then(A.bind(A,14099))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await A.e(88).then(A.bind(A,14103))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await A.e(89).then(A.bind(A,14112))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await A.e(90).then(A.bind(A,14121))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await A.e(91).then(A.bind(A,14128))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await A.e(92).then(A.bind(A,14136))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await A.e(93).then(A.bind(A,14140))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await A.e(94).then(A.bind(A,14148))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await A.e(95).then(A.bind(A,14151))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await A.e(96).then(A.bind(A,14156))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await A.e(97).then(A.bind(A,14162))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await A.e(76).then(A.bind(A,14171))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await A.e(98).then(A.bind(A,14179))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await A.e(99).then(A.bind(A,14183))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await A.e(100).then(A.bind(A,14188))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await A.e(77).then(A.bind(A,14196))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await A.e(72).then(A.bind(A,14016))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await A.e(78).then(A.bind(A,14200))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await A.e(73).then(A.bind(A,14041))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await A.e(74).then(A.bind(A,14044))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await A.e(74).then(A.bind(A,14044))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await A.e(75).then(A.bind(A,14209))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await A.e(75).then(A.bind(A,14209))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await A.e(75).then(A.bind(A,14209))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await A.e(75).then(A.bind(A,14209))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await A.e(75).then(A.bind(A,14209))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await A.e(75).then(A.bind(A,14209))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await A.e(101).then(A.bind(A,14218))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await A.e(102).then(A.bind(A,14221))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await A.e(103).then(A.bind(A,14230))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await A.e(104).then(A.bind(A,14236))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await A.e(105).then(A.bind(A,14240))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await A.e(106).then(A.bind(A,14243))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await A.e(107).then(A.bind(A,14248))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await A.e(108).then(A.bind(A,14250))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await A.e(109).then(A.bind(A,14254))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await A.e(110).then(A.bind(A,14256))).FlowGraphDataSwitchBlock;default:if(EA[c])return EA[c];throw new Error(`Unknown block name ${c}`)}}(c.className);return await b()})));return function(c,b,A){const o=b.coordinator.createGraph(),t=[],n=b.valueParseFunction??jA.b;for(let h=0;h<c.allBlocks.length;h++){const s=zA(c.allBlocks[h],{yd:b.coordinator.config.yd,pathConverter:b.pathConverter,assetsContainer:b.coordinator.config.yd,valueParseFunction:n},A[h]);t.push(s),s instanceof VA.e&&o.addEventBlock(s)}for(const h of t){for(const c of h.dataInputs)for(const b of c.connectedPointIds){const A=MA(t,b);c.connectTo(A)}if(h instanceof yA.e)for(const c of h.signalOutputs)for(const b of c.connectedPointIds){const A=WA(t,b);c.connectTo(A)}}for(const h of c.executionContexts)rA(h,{graph:o,valueParseFunction:n},c.rightHanded);return o}(c,b,o)}function rA(c,b,A){const o=b.graph.createContext();c.enableLogging&&(o.enableLogging=!0),o.treatDataAsRightHanded=A||!1;const t=b.valueParseFunction??jA.b;o.uniqueId=c.uniqueId;const n=o.va();if(c._assetsContext){var h,s,L,C,J,X,R,N,k,E;const b=c._assetsContext,A={meshes:null===(h=b.meshes)||void 0===h?void 0:h.map((c=>n.getMeshById(c))),lights:null===(s=b.lights)||void 0===s?void 0:s.map((c=>n.getLightByName(c))),cameras:null===(L=b.cameras)||void 0===L?void 0:L.map((c=>n.getCameraByName(c))),materials:null===(C=b.materials)||void 0===C?void 0:C.map((c=>n.getMaterialById(c))),textures:null===(J=b.textures)||void 0===J?void 0:J.map((c=>n.getTextureByName(c))),animations:null===(X=b.animations)||void 0===X?void 0:X.map((c=>n.animations.find((b=>b.name===c)))),skeletons:null===(R=b.skeletons)||void 0===R?void 0:R.map((c=>n.getSkeletonByName(c))),xk:null===(N=b.xk)||void 0===N?void 0:N.map((c=>n.getParticleSystemById(c))),animationGroups:null===(k=b.animationGroups)||void 0===k?void 0:k.map((c=>n.getAnimationGroupByName(c))),transformNodes:null===(E=b.transformNodes)||void 0===E?void 0:E.map((c=>n.getTransformNodeById(c))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],jm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};o.assetsContext=A}for(const V in c._userVariables){const b=t(V,c._userVariables,o.assetsContext,n);o.userVariables[V]=b}for(const V in c._connectionValues){const b=t(V,c._connectionValues,o.assetsContext,n);o._setConnectionValueByKey(V,b)}return o}function zA(c,b,A){const o={},t=b.valueParseFunction??jA.b;if(c.config)for(const h in c.config)o[h]=t(h,c.config,b.assetsContainer||b.yd,b.yd);if((0,jA.f)(c.className)){if(!b.pathConverter)throw new Error("Path converter is required for this block");o.pathConverter=b.pathConverter}const n=new A(o);n.uniqueId=c.uniqueId;for(let h=0;h<c.dataInputs.length;h++){const b=n.getDataInput(c.dataInputs[h].name);if(!b)throw new Error("Could not find data input with name "+c.dataInputs[h].name+" in block "+c.className);b.deserialize(c.dataInputs[h])}for(let h=0;h<c.dataOutputs.length;h++){const b=n.getDataOutput(c.dataOutputs[h].name);if(!b)throw new Error("Could not find data output with name "+c.dataOutputs[h].name+" in block "+c.className);b.deserialize(c.dataOutputs[h])}return n.metadata=c.metadata,n.deserialize&&n.deserialize(c),n}function YA(c){const[b,A]=c.split(":");return DA({op:b,extension:A})}function DA(c){var b;let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=c.extension?null===(b=vA[c.extension])||void 0===b?void 0:b[c.op]:GA[c.op];if(!o&&(E.c.Warn(`No mapping found for operation ${c.op} and extension ${c.extension||"KHR_interactivity"}`),A)){const b={},A={flows:{}};if(c.inputValueSockets){b.values={};for(const A in c.inputValueSockets)b.values[A]={name:A}}return c.outputValueSockets&&(A.values={},Object.keys(c.outputValueSockets).forEach((c=>{A.values[c]={name:c}}))),{Qk:[],inputs:b,outputs:A}}return o}function fA(c,b,A){vA[b]||(vA[b]={}),vA[b][c]=A}const vA={BABYLON:{"flow/log":{Qk:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},GA={"event/onStart":{Qk:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Qk:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Qk:["FlowGraphSendCustomEventBlock"],extraProcessor(c,b,A,o,t){if("event/send"!==b.op||!c.configuration||1!==Object.keys(c.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=c.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const h=o.arrays.events[n],s=t[0];return s.config||(s.config={}),s.config.eventId=h.eventId,s.config.eventData=h.eventData,t}},"event/receive":{Qk:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(c,b){var A;if(!c.configuration)return E.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const o=c.configuration.event;if(!o)return E.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const t=o.value[0];if("number"!==typeof t)return E.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(A=b.events)||void 0===A?void 0:A[t])?{valid:!0}:(E.c.Error(`Event with id ${t} not found`),{valid:!1,error:`Event with id ${t} not found`})},extraProcessor(c,b,A,o,t){if("event/receive"!==b.op||!c.configuration||1!==Object.keys(c.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const n=c.configuration.event.value[0];if("number"!==typeof n)throw new Error("Event id should be a number");const h=o.arrays.events[n],s=t[0];return s.config||(s.config={}),s.config.eventId=h.eventId,s.config.eventData=h.eventData,t}},"math/e":PA("FlowGraphEBlock"),"math/pi":PA("FlowGraphPIBlock"),"math/inf":PA("FlowGraphInfBlock"),"math/nan":PA("FlowGraphNaNBlock"),"math/abs":PA("FlowGraphAbsBlock"),"math/sign":PA("FlowGraphSignBlock"),"math/trunc":PA("FlowGraphTruncBlock"),"math/floor":PA("FlowGraphFloorBlock"),"math/ceil":PA("FlowGraphCeilBlock"),"math/round":{Qk:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.roundHalfAwayFromZero=!0,t}},"math/fract":PA("FlowGraphFractBlock"),"math/neg":PA("FlowGraphNegationBlock"),"math/add":PA("FlowGraphAddBlock",["a","b"],!0),"math/sub":PA("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Qk:["FlowGraphMultiplyBlock"],extraProcessor(c,b,A,o,t){var n;(n=t[0]).config||(n.config={}),t[0].config.useMatrixPerComponent=!0,t[0].config.preventIntegerFloatArithmetic=!0;let h=-1;return Object.keys(c.values||{}).find((b=>{var A;return void 0!==(null===(A=c.values)||void 0===A?void 0:A[b].type)&&(h=c.values[b].type,!0)})),-1!==h&&(t[0].config.type=o.arrays.types[h].flowGraphType),t},validation:c=>c.values?OA(c):{valid:!0}},"math/div":PA("FlowGraphDivideBlock",["a","b"],!0),"math/rem":PA("FlowGraphModuloBlock",["a","b"]),"math/min":PA("FlowGraphMinBlock",["a","b"]),"math/max":PA("FlowGraphMaxBlock",["a","b"]),"math/clamp":PA("FlowGraphClampBlock",["a","b","c"]),"math/saturate":PA("FlowGraphSaturateBlock"),"math/mix":PA("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":PA("FlowGraphEqualityBlock",["a","b"]),"math/lt":PA("FlowGraphLessThanBlock",["a","b"]),"math/le":PA("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":PA("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":PA("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":PA("FlowGraphIsNaNBlock"),"math/isinf":PA("FlowGraphIsInfBlock"),"math/select":{Qk:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Qk:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":PA("FlowGraphSinBlock"),"math/cos":PA("FlowGraphCosBlock"),"math/tan":PA("FlowGraphTanBlock"),"math/asin":PA("FlowGraphASinBlock"),"math/acos":PA("FlowGraphACosBlock"),"math/atan":PA("FlowGraphATanBlock"),"math/atan2":PA("FlowGraphATan2Block",["a","b"]),"math/sinh":PA("FlowGraphSinhBlock"),"math/cosh":PA("FlowGraphCoshBlock"),"math/tanh":PA("FlowGraphTanhBlock"),"math/asinh":PA("FlowGraphASinhBlock"),"math/acosh":PA("FlowGraphACoshBlock"),"math/atanh":PA("FlowGraphATanhBlock"),"math/exp":PA("FlowGraphExponentialBlock"),"math/log":PA("FlowGraphLogBlock"),"math/log2":PA("FlowGraphLog2Block"),"math/log10":PA("FlowGraphLog10Block"),"math/sqrt":PA("FlowGraphSquareRootBlock"),"math/cbrt":PA("FlowGraphCubeRootBlock"),"math/pow":PA("FlowGraphPowerBlock",["a","b"]),"math/length":PA("FlowGraphLengthBlock"),"math/normalize":PA("FlowGraphNormalizeBlock"),"math/dot":PA("FlowGraphDotBlock",["a","b"]),"math/cross":PA("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":PA("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":PA("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Qk:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Qk:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Qk:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Qk:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Qk:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Qk:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Qk:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":PA("FlowGraphTransposeBlock"),"math/determinant":PA("FlowGraphDeterminantBlock"),"math/inverse":PA("FlowGraphInvertMatrixBlock"),"math/matmul":PA("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Qk:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ld",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t,n){const h=t[0].dataInputs.find((c=>"rotationQuaternion"===c.name));if(!h)throw new Error("Rotation quaternion input not found");return n._connectionValues[h.uniqueId]&&(n._connectionValues[h.uniqueId].type="Quaternion"),t}},"math/matDecompose":{Qk:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ld"}}}},"math/quatConjugate":PA("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Qk:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.type="Quaternion",t}},"math/quatAngleBetween":PA("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Qk:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":PA("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":PA("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Qk:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract2x2":{Qk:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Qk:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract3x3":{Qk:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Qk:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t){var n;return(n=t[0]).config||(n.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract4x4":{Qk:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Qk:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t,n){var h,s;(s=t[0]).config||(s.config={});const L=t[0].dataInputs[0];return t[0].config.valueType=(null===(h=n._connectionValues[L.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",t}},"math/and":{Qk:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t,n){var h,s,L;(L=t[0]).config||(L.config={});const C=t[0].dataInputs[0],J=t[0].dataInputs[1];return t[0].config.valueType=(null===(h=n._connectionValues[C.uniqueId])||void 0===h?void 0:h.type)??(null===(s=n._connectionValues[J.uniqueId])||void 0===s?void 0:s.type)??"FlowGraphInteger",t}},"math/or":{Qk:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t,n){var h,s,L;(L=t[0]).config||(L.config={});const C=t[0].dataInputs[0],J=t[0].dataInputs[1];return t[0].config.valueType=(null===(h=n._connectionValues[C.uniqueId])||void 0===h?void 0:h.type)??(null===(s=n._connectionValues[J.uniqueId])||void 0===s?void 0:s.type)??"FlowGraphInteger",t}},"math/xor":{Qk:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,b,A,o,t,n){var h,s,L;(L=t[0]).config||(L.config={});const C=t[0].dataInputs[0],J=t[0].dataInputs[1];return t[0].config.valueType=(null===(h=n._connectionValues[C.uniqueId])||void 0===h?void 0:h.type)??(null===(s=n._connectionValues[J.uniqueId])||void 0===s?void 0:s.type)??"FlowGraphInteger",t}},"math/asr":PA("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":PA("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":PA("FlowGraphLeadingZerosBlock"),"math/ctz":PA("FlowGraphTrailingZerosBlock"),"math/popcnt":PA("FlowGraphOneBitsCounterBlock"),"math/rad":PA("FlowGraphDegToRadBlock"),"math/deg":PA("FlowGraphRadToDegBlock"),"type/boolToInt":PA("FlowGraphBooleanToInt"),"type/boolToFloat":PA("FlowGraphBooleanToFloat"),"type/intToBool":PA("FlowGraphIntToBoolean"),"type/intToFloat":PA("FlowGraphIntToFloat"),"type/floatToInt":PA("FlowGraphFloatToInt"),"type/floatToBool":PA("FlowGraphFloatToBoolean"),"flow/sequence":{Qk:["FlowGraphSequenceBlock"],extraProcessor(c,b,A,o,t){const n=t[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(c.flows||[]).length,n.signalOutputs.forEach(((c,b)=>{c.name="out_"+b})),t}},"flow/branch":{Qk:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Qk:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(c){if(c.configuration&&c.configuration.cases){const b=c.configuration.cases.value;if(!b.every((c=>"number"===typeof c&&/^-?\d+$/.test(c.toString()))))return E.c.Warn("Switch cases should be integers. Using empty array instead."),c.configuration.cases.value=[],{valid:!0};const A=new Set(b);c.configuration.cases.value=Array.from(A)}return{valid:!0}},extraProcessor(c,b,A,o,t){if("flow/switch"!==b.op||!c.flows||0===Object.keys(c.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return t[0].signalOutputs.forEach((c=>{"default"!==c.name&&(c.name="out_"+c.name)})),t}},"flow/while":{Qk:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Qk:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(c,b,A,o,t){const n=t[0];return n.config||(n.config={}),n.config.incrementIndexWhenLoopDone=!0,t}},"flow/doN":{Qk:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Qk:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(c,b,A,o,t){if("flow/multiGate"!==b.op||!c.flows||0===Object.keys(c.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const n=t[0];return n.config||(n.config={}),n.config.outputSignalCount=Object.keys(c.flows).length,n.signalOutputs.forEach(((c,b)=>{c.name="out_"+b})),t}},"flow/waitAll":{Qk:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(c){var b,A;return"number"!==typeof(null===(b=c.configuration)||void 0===b||null===(A=b.inputFlows)||void 0===A?void 0:A.value[0])&&(c.configuration=c.configuration||{inputFlows:{value:[0]}},c.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Qk:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Qk:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Qk:["FlowGraphCancelDelayBlock"]},"variable/get":{Qk:["FlowGraphGetVariableBlock"],validation(c){var b,A;return null!==(b=c.configuration)&&void 0!==b&&null!==(A=b.variable)&&void 0!==A&&A.value?{valid:!0}:(E.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(c,b)=>[b.getVariableName(c[0])]}}},"variable/set":{Qk:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(c,b)=>[b.getVariableName(c[0])]}}},"variable/setMultiple":{Qk:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(c,b)=>[c[0].map((c=>b.getVariableName(c)))]}},extraProcessor:(c,b,A,o,t)=>(t[0].dataInputs.forEach((c=>{c.name=o.getVariableName(+c.name)})),t)},"variable/interpolate":{Qk:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(c,b)=>[b.getVariableName(c[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:c=>!0===c[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(c,b,A,o,t){var n,h,s;const L=t[0],C=null===(n=c.configuration)||void 0===n?void 0:n.variable.value[0];if("number"!==typeof C)throw E.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const J=o.arrays.staticVariables[C];"undefined"===typeof L.config.animationType.value&&(o.arrays.staticVariables,L.config.animationType.value=(0,FA.I)(J.type));const X=t[4];return X.config||(X.config={}),(h=X.config).variable||(h.variable={}),X.config.variable.value=o.getVariableName(C),(s=t[3]).config||(s.config={}),t}},"pointer/get":{Qk:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(c,b,A,o,t)=>(t.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className&&(c.config||(c.config={}),c.config.outputValue=!0)})),t)},"pointer/set":{Qk:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(c,b,A,o,t)=>(t.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className&&(c.config||(c.config={}),c.config.outputValue=!0)})),t)},"pointer/interpolate":{Qk:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(c,b,A,o,t)=>(t.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className?(b.config||(b.config={}),b.config.outputValue=!0):"FlowGraphInterpolationBlock"===b.className&&(b.config||(b.config={}),Object.keys(c.values||[]).forEach((A=>{var t;const n=null===(t=c.values)||void 0===t?void 0:t[A];if("value"===A&&n){const c=n.type;void 0!==c&&(b.config.animationType=o.arrays.types[c].flowGraphType)}})))})),t)},"animation/start":{Qk:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(c,b)=>[c[0]*b._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(c,b)=>[c[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(c,b,A,o,t,n,h){const s=t[t.length-1];return s.config||(s.config={}),s.config.glTF=h,t}},"animation/stop":{Qk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(c,b,A,o,t,n,h){const s=t[t.length-1];return s.config||(s.config={}),s.config.glTF=h,t}},"animation/stopAt":{Qk:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(c,b)=>[c[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(c,b,A,o,t,n,h){const s=t[t.length-1];return s.config||(s.config={}),s.config.glTF=h,t}},"math/switch":{Qk:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(c){if(c.configuration&&c.configuration.cases){const b=c.configuration.cases.value;if(!b.every((c=>"number"===typeof c&&/^-?\d+$/.test(c.toString()))))return E.c.Warn("Switch cases should be integers. Using empty array instead."),c.configuration.cases.value=[],{valid:!0};const A=new Set(b);c.configuration.cases.value=Array.from(A)}return{valid:!0}},extraProcessor(c,b,A,o,t){const n=t[0];return n.dataInputs.forEach((c=>{"default"!==c.name&&"case"!==c.name&&(c.name="in_"+c.name)})),n.config||(n.config={}),n.config.treatCasesAsIntegers=!0,t}},"debug/log":{Qk:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function PA(c){let b=arguments.length>2?arguments[2]:void 0;return{Qk:[c],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((c,b)=>(c[b]={name:b},c)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(c,A,o,t,n){var h;if(b){(h=n[0]).config||(h.config={}),n[0].config.preventIntegerFloatArithmetic=!0;let b=-1;Object.keys(c.values||{}).find((A=>{var o;return void 0!==(null===(o=c.values)||void 0===o?void 0:o[A].type)&&(b=c.values[A].type,!0)})),-1!==b&&(n[0].config.type=t.arrays.types[b].flowGraphType)}return n},validation:c=>b?OA(c):{valid:!0}}}function OA(c){if(c.values){const b=Object.keys(c.values).map((b=>c.values[b].type)).filter((c=>void 0!==c));if(!b.every((c=>c===b[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}GA["math/compose"]=GA["math/matCompose"],GA["math/decompose"]=GA["math/matDecompose"];var pA=A(640);const qA={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ak",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class IA{constructor(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=c,this._gltf=b,this._animationTargetFps=A,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const c of this._interactivityGraph.types)this._types.push(qA[c.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const c of this._interactivityGraph.declarations){const b=DA(c);if(!b)throw E.c.Error(["No mapping found for declaration",c]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:b,fullOperationName:c.extension?c.op+":"+c.extension:c.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const c of this._interactivityGraph.variables){const b=this._parseVariable(c);this._staticVariables.push(b)}}_parseVariable(c,b){const A=this._types[c.type];if(!A)throw E.c.Error(["No type found for variable",c]),new Error("Error parsing variables");if(c.value&&c.value.length!==A.length)throw E.c.Error(["Invalid value length for variable",c,A]),new Error("Error parsing variables");const o=c.value||[];if(!o.length)switch(A.flowGraphType){case"boolean":o.push(!1);break;case"FlowGraphInteger":o.push(0);break;case"number":o.push(NaN);break;case"Vector2":o.push(NaN,NaN);break;case"ak":o.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":o.fill(NaN,0,4);break;case"Matrix":o.fill(NaN,0,16);break;case"Matrix3D":o.fill(NaN,0,9)}return"number"===A.elementType&&"string"===typeof o[0]&&(o[0]=parseFloat(o[0])),{type:A.flowGraphType,value:b?b(o,this):o}}_parseEvents(){if(this._interactivityGraph.events)for(const c of this._interactivityGraph.events){const b={eventId:c.id||"internalEvent_"+this._internalEventsCounter++};c.values&&(b.eventData=Object.keys(c.values).map((b=>{var A;const o=null===(A=c.values)||void 0===A?void 0:A[b];if(!o)throw E.c.Error(["No value found for event key",b]),new Error("Error parsing events");const t=this._types[o.type];if(!t)throw E.c.Error(["No type found for event value",o]),new Error("Error parsing events");const n="undefined"!==typeof o.value?this._parseVariable(o):void 0;return{id:b,type:t.flowGraphType,eventData:!0,value:n}}))),this._events.push(b)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const b of this._interactivityGraph.nodes){if("number"!==typeof b.declaration)throw E.c.Error(["No declaration found for node",b]),new Error("Error parsing nodes");const A=this._mappings[b.declaration];if(!A)throw E.c.Error(["No mapping found for node",b]),new Error("Error parsing nodes");if(A.flowGraphMapping.validation){const o=A.flowGraphMapping.validation(b,this._interactivityGraph,this._gltf);var c;if(!o.valid)throw new Error(`Error validating interactivity node ${null===(c=this._interactivityGraph.declarations)||void 0===c?void 0:c[b.declaration].op} - ${o.error}`)}const o=[];for(const c of A.flowGraphMapping.Qk){const t=this._getEmptyBlock(c,A.fullOperationName);this._parseNodeConfiguration(b,t,A.flowGraphMapping,c),o.push(t)}this._nodes.push({Qk:o,fullOperationName:A.fullOperationName})}}_getEmptyBlock(c,b){return{uniqueId:(0,pA.d)(),className:c,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:b,metadata:{}}}_parseNodeConfiguration(c,b,A,o){const t=b.config;if(c.configuration){const b=Object.keys(c.configuration);for(const s of b){var n,h;const b=null===(n=c.configuration)||void 0===n?void 0:n[s];if(!b)throw E.c.Error(["No value found for node configuration",s]),new Error("Error parsing node configuration");const L=null===(h=A.configuration)||void 0===h?void 0:h[s];if(L&&L.toBlock?L.toBlock===o:0===A.Qk.indexOf(o)){const c=(null===L||void 0===L?void 0:L.name)||s;b&&"undefined"!==typeof b.value||"undefined"===typeof(null===L||void 0===L?void 0:L.defaultValue)?b.value.length>=0?t[c]={value:1===b.value.length?b.value[0]:b.value}:E.c.Warn(["Invalid value for node configuration",b]):t[c]={value:L.defaultValue},L&&L.dataTransformer&&(t[c].value=L.dataTransformer([t[c].value],this)[0])}}}}_parseNodeConnections(c){for(let d=0;d<this._nodes.length;d++){var b;const r=null===(b=this._interactivityGraph.nodes)||void 0===b?void 0:b[d];if(!r)throw E.c.Error(["No node found for interactivity node",this._nodes[d]]),new Error("Error parsing node connections");const z=this._nodes[d],Y=this._mappings[r.declaration];if(!Y)throw E.c.Error(["No mapping found for node",r]),new Error("Error parsing node connections");const D=r.flows||{},f=Object.keys(D).sort();for(const c of f){var A,o,t,n;const b=D[c],C=null===(A=Y.flowGraphMapping.outputs)||void 0===A||null===(o=A.flows)||void 0===o?void 0:o[c],J=(null===C||void 0===C?void 0:C.name)||c,X=this._createNewSocketConnection(J,!0);(C&&C.toBlock&&z.Qk.find((c=>c.className===C.toBlock))||z.Qk[0]).signalOutputs.push(X);const R=b.node,N=this._nodes[R];if(!N)throw E.c.Error(["No node found for input node id",R]),new Error("Error parsing node connections");const k=YA(N.fullOperationName);if(!k)throw E.c.Error(["No mapping found for input node",N]),new Error("Error parsing node connections");let V=null===(t=k.inputs)||void 0===t||null===(n=t.flows)||void 0===n?void 0:n[b.socket||"in"],y=!1;if(!V)for(const c in null===(h=k.inputs)||void 0===h?void 0:h.flows){var h,s,L;if(c.startsWith("[")&&c.endsWith("]"))y=!0,V=null===(s=k.inputs)||void 0===s||null===(L=s.flows)||void 0===L?void 0:L[c]}const j=V?y?V.name.replace("$1",b.socket||""):V.name:b.socket||"in",F=V&&V.toBlock&&N.Qk.find((c=>c.className===V.toBlock))||N.Qk[0];let M=F.signalInputs.find((c=>c.name===j));M||(M=this._createNewSocketConnection(j),F.signalInputs.push(M)),M.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(M.uniqueId)}const v=r.values||{},G=Object.keys(v);for(const b of G){var C,J;const A=v[b];let o=null===(C=Y.flowGraphMapping.inputs)||void 0===C||null===(J=C.values)||void 0===J?void 0:J[b],t=!1;if(!o)for(const c in null===(X=Y.flowGraphMapping.inputs)||void 0===X?void 0:X.values){var X,R,N;if(c.startsWith("[")&&c.endsWith("]"))t=!0,o=null===(R=Y.flowGraphMapping.inputs)||void 0===R||null===(N=R.values)||void 0===N?void 0:N[c]}const n=o?t?o.name.replace("$1",b):o.name:b,h=this._createNewSocketConnection(n);if((o&&o.toBlock&&z.Qk.find((c=>c.className===o.toBlock))||z.Qk[0]).dataInputs.push(h),void 0!==A.value){const b=this._parseVariable(A,o&&o.dataTransformer);c._connectionValues[h.uniqueId]=b}else{if("undefined"===typeof A.node)throw E.c.Error(["Invalid value for value connection",A]),new Error("Error parsing node connections");{var k,V,y;const c=A.node,b=A.socket||"value",o=this._nodes[c];if(!o)throw E.c.Error(["No node found for output socket reference",A]),new Error("Error parsing node connections");const t=YA(o.fullOperationName);if(!t)throw E.c.Error(["No mapping found for output socket reference",A]),new Error("Error parsing node connections");let n=null===(k=t.outputs)||void 0===k||null===(V=k.values)||void 0===V?void 0:V[b],s=!1;if(!n)for(const A in null===(j=t.outputs)||void 0===j?void 0:j.values){var j,F,M;if(A.startsWith("[")&&A.endsWith("]"))s=!0,n=null===(F=t.outputs)||void 0===F||null===(M=F.values)||void 0===M?void 0:M[A]}const L=n?s?n.name.replace("$1",b):null===(y=n)||void 0===y?void 0:y.name:b,C=n&&n.toBlock&&o.Qk.find((c=>c.className===n.toBlock))||o.Qk[0];let J=C.dataOutputs.find((c=>c.name===L));J||(J=this._createNewSocketConnection(L,!0),C.dataOutputs.push(J)),h.connectedPointIds.push(J.uniqueId),J.connectedPointIds.push(h.uniqueId)}}}if(Y.flowGraphMapping.interBlockConnectors)for(const c of Y.flowGraphMapping.interBlockConnectors){const b=c.input,A=c.output,o=c.isVariable;this._connectFlowGraphNodes(b,A,z.Qk[c.inputBlockIndex],z.Qk[c.outputBlockIndex],o)}if(Y.flowGraphMapping.extraProcessor){var W;const b=null===(W=this._interactivityGraph.declarations)||void 0===W?void 0:W[r.declaration];if(!b)throw E.c.Error(["No declaration found for extra processor",r]),new Error("Error parsing node connections");z.Qk=Y.flowGraphMapping.extraProcessor(r,b,Y.flowGraphMapping,this,z.Qk,c,this._gltf)}}}_createNewSocketConnection(c,b){return{uniqueId:(0,pA.d)(),name:c,_connectionType:b?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(c,b,A,o,t){const n=t?A.dataInputs:A.signalInputs,h=t?o.dataOutputs:o.signalOutputs,s=n.find((b=>b.name===c))||this._createNewSocketConnection(c),L=h.find((c=>c.name===b))||this._createNewSocketConnection(b,!0);n.find((b=>b.name===c))||n.push(s),h.find((c=>c.name===b))||h.push(L),s.connectedPointIds.push(L.uniqueId),L.connectedPointIds.push(s.uniqueId)}getVariableName(c){return"staticVariable_"+c}serializeToFlowGraph(){const c={uniqueId:(0,pA.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(c);for(let b=0;b<this._staticVariables.length;b++){const A=this._staticVariables[b];c._userVariables[this.getVariableName(b)]=A}return{rightHanded:!0,allBlocks:this._nodes.reduce(((c,b)=>c.concat(b.Qk)),[]),executionContexts:[c]}}}const KA="KHR_interactivity";class ZA{constructor(c){this._loader=c,this.name=KA,this.enabled=this._loader.isExtensionUsed(KA),this._pathConverter=(0,H.j)(this._loader.Lk),c._skipStartAnimationStep=!0;const b=c.babylonScene;b&&function(c){(0,H.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!c.activeCamera)return new t.e(NaN,NaN,NaN,NaN);const b=t.e.FromRotationMatrix(c.activeCamera.getWorldMatrix()).normalize();return c.useRightHandedSystem||(b.w*=-1,b.x*=-1),b},type:"Quaternion",getTarget:()=>c.activeCamera}),(0,H.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!c.activeCamera)return new t.k(NaN,NaN,NaN);const b=c.activeCamera.getWorldMatrix().getTranslation();return c.useRightHandedSystem||(b.x*=-1),b},type:"ak",getTarget:()=>c.activeCamera}),(0,H.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:c=>{var b;return(null===(b=c._babylonAnimationGroup)||void 0===b?void 0:b.isPlaying)??!1},type:"boolean",getTarget:c=>c._babylonAnimationGroup}),(0,H.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:c=>{var b;return((null===(b=c._babylonAnimationGroup)||void 0===b?void 0:b.from)??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup}),(0,H.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:c=>{var b;return((null===(b=c._babylonAnimationGroup)||void 0===b?void 0:b.to)??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup}),(0,H.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:c=>{var b;return((null===(b=c._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup}),(0,H.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:c=>{var b;return((null===(b=c._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup})}(b)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var c;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,A=null===(c=this._loader.Lk.extensions)||void 0===c?void 0:c.KHR_interactivity;if(!A)return;const o=new kA.b({yd:b});o.dispatchEventsSynchronously=!1;const t=A.graphs.map((c=>new IA(c,this._loader.Lk,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(t.map((async c=>await dA(c,{coordinator:o,pathConverter:this._pathConverter})))),o.start()}}var HA;HA=async()=>(await Promise.resolve().then(A.bind(A,12816))).FlowGraphGLTFDataProvider,EA[`${KA}/${"FlowGraphGLTFDataProvider"}`]=HA,Z(KA),K(KA,!0,(c=>new ZA(c)));const SA="KHR_node_visibility";(0,H.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:c=>{const b=c._babylonTransformNode;return!b||void 0===b.isVisible||b.isVisible},set:(c,b)=>{var A,o;null===(A=b._primitiveBabylonMeshes)||void 0===A||A.forEach((c=>{c.inheritVisibility=!0})),b._babylonTransformNode&&(b._babylonTransformNode.isVisible=c),null===(o=b._primitiveBabylonMeshes)||void 0===o||o.forEach((b=>{b.isVisible=c}))},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class BA{constructor(c){this.name=SA,this._loader=c,this.enabled=c.isExtensionUsed(SA)}async onReady(){var c;null===(c=this._loader.Lk.nodes)||void 0===c||c.forEach((c=>{var b,A,o,t;(null===(b=c._primitiveBabylonMeshes)||void 0===b||b.forEach((c=>{c.inheritVisibility=!0})),null!==(A=c.extensions)&&void 0!==A&&A.KHR_node_visibility)&&(!1===(null===(o=c.extensions)||void 0===o?void 0:o.KHR_node_visibility.visible)&&(c._babylonTransformNode&&(c._babylonTransformNode.isVisible=!1),null===(t=c._primitiveBabylonMeshes)||void 0===t||t.forEach((c=>{c.isVisible=!1}))))}))}dispose(){this._loader=null}}Z(SA),K(SA,!0,(c=>new BA(c)));const QA="KHR_node_selectability";fA("event/onSelect",QA,{Qk:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:c=>["pickedMesh_"+c[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(c,b,A,o,t,n,h){var s,L,C,J,X,R;const N=t[t.length-1];N.config=N.config||{},N.config.glTF=h;const k=null===(s=c.configuration)||void 0===s||null===(L=s.nodeIndex)||void 0===L?void 0:L.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const E="pickedMesh_"+k;return t[1].config.variable=E,n._userVariables[E]={className:"Mesh",id:null===h||void 0===h||null===(C=h.nodes)||void 0===C||null===(J=C[k]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===h||void 0===h||null===(X=h.nodes)||void 0===X||null===(R=X[k]._babylonTransformNode)||void 0===R?void 0:R.uniqueId},t}}),(0,H.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:c=>{const b=c._babylonTransformNode;return!b||void 0===b.Ye||b.Ye},set:(c,b)=>{var A;null===(A=b._primitiveBabylonMeshes)||void 0===A||A.forEach((b=>{b.Ye=c}))},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"Ye"],type:"boolean"});class aA{constructor(c){this.name=QA,this._loader=c,this.enabled=c.isExtensionUsed(QA)}async onReady(){var c;null===(c=this._loader.Lk.nodes)||void 0===c||c.forEach((c=>{var b,A,o;null!==(b=c.extensions)&&void 0!==b&&b.KHR_node_selectability&&!1===(null===(A=c.extensions)||void 0===A?void 0:A.KHR_node_selectability.selectable)&&(null===(o=c._babylonTransformNode)||void 0===o||o.getChildMeshes().forEach((c=>{c.Ye=!1})))}))}dispose(){this._loader=null}}Z(QA),K(QA,!0,(c=>new aA(c)));const lA="KHR_node_hoverability",TA="targetMeshPointerOver_";fA("event/onHoverIn",lA,{Qk:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:c=>[TA+c[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(c,b,A,o,t,n,h){var s,L,C,J,X,R;const N=t[t.length-1];N.config=N.config||{},N.config.glTF=h;const k=null===(s=c.configuration)||void 0===s||null===(L=s.nodeIndex)||void 0===L?void 0:L.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const E=TA+k;return t[1].config.variable=E,n._userVariables[E]={className:"Mesh",id:null===h||void 0===h||null===(C=h.nodes)||void 0===C||null===(J=C[k]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===h||void 0===h||null===(X=h.nodes)||void 0===X||null===(R=X[k]._babylonTransformNode)||void 0===R?void 0:R.uniqueId},t}});const iA="targetMeshPointerOut_";fA("event/onHoverOut",lA,{Qk:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:c=>[iA+c[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(c,b,A,o,t,n,h){var s,L,C,J,X,R;const N=t[t.length-1];N.config=N.config||{},N.config.glTF=h;const k=null===(s=c.configuration)||void 0===s||null===(L=s.nodeIndex)||void 0===L?void 0:L.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const E=iA+k;return t[1].config.variable=E,n._userVariables[E]={className:"Mesh",id:null===h||void 0===h||null===(C=h.nodes)||void 0===C||null===(J=C[k]._babylonTransformNode)||void 0===J?void 0:J.id,uniqueId:null===h||void 0===h||null===(X=h.nodes)||void 0===X||null===(R=X[k]._babylonTransformNode)||void 0===R?void 0:R.uniqueId},t}}),(0,H.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:c=>{const b=c._babylonTransformNode;return!b||void 0===b.pointerOverDisableMeshTesting||b.pointerOverDisableMeshTesting},set:(c,b)=>{var A;null===(A=b._primitiveBabylonMeshes)||void 0===A||A.forEach((b=>{b.pointerOverDisableMeshTesting=!c}))},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class gA{constructor(c){this.name=lA,this._loader=c,this.enabled=c.isExtensionUsed(lA)}async onReady(){var c;null===(c=this._loader.Lk.nodes)||void 0===c||c.forEach((c=>{var b,A,o;null!==(b=c.extensions)&&void 0!==b&&b.KHR_node_hoverability&&!1===(null===(A=c.extensions)||void 0===A?void 0:A.KHR_node_hoverability.hoverable)&&(null===(o=c._babylonTransformNode)||void 0===o||o.getChildMeshes().forEach((c=>{c.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}Z(lA),K(lA,!0,(c=>new gA(c)));const uA="ExtrasAsMetadata";class eA{_assignExtras(c,b){if(b.extras&&Object.keys(b.extras).length>0){const A=c.metadata=c.metadata||{};(A.Lk=A.Lk||{}).extras=b.extras}}constructor(c){this.name=uA,this.enabled=!0,this._loader=c}dispose(){this._loader=null}loadNodeAsync(c,b,A){return this._loader.loadNodeAsync(c,b,(c=>{this._assignExtras(c,b),A(c)}))}loadCameraAsync(c,b,A){return this._loader.loadCameraAsync(c,b,(c=>{this._assignExtras(c,b),A(c)}))}createMaterial(c,b,A){const o=this._loader.createMaterial(c,b,A);return this._assignExtras(o,b),o}}Z(uA),K(uA,!1,(c=>new eA(c)));A(12816)},12703:(c,b,A)=>{"use strict";A.d(b,{b:()=>O,e:()=>Y,h:()=>z,i:()=>D});var o=A(518),t=A(525),n=A(12350),h=A(510),s=A(830),L=A(821),C=A(531),J=A(550),X=A(11831),R=A(11921),N=A(663),k=A(653);class E{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.xk=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.jm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(c){this._environmentTexture=c}getNodes(){let c=[];c=c.concat(this.meshes),c=c.concat(this.lights),c=c.concat(this.cameras),c=c.concat(this.transformNodes);for(const b of this.skeletons)c=c.concat(b.bones);return c}}class V extends E{}class y{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const c=this.rootNodes;for(const o of c)o.dispose();c.length=0;const b=this.skeletons;for(const o of b)o.dispose();b.length=0;const A=this.animationGroups;for(const o of A)o.dispose();A.length=0}}class j extends E{constructor(c){super(),this._wasAddedToScene=!1,(c=c||J.c.LastCreatedScene)&&(this.yd=c,this.proceduralTextures=[],c.fk.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=c.getEngine().onContextRestoredObservable.add((()=>{for(const c of this.geometries)c._rebuild();for(const c of this.meshes)c._rebuild();for(const c of this.xk)c.rebuild();for(const c of this.textures)c._rebuild()})))}_topologicalSort(c){const b=new Map;for(const h of c)b.set(h.uniqueId,h);const A={dependsOn:new Map,dependedBy:new Map};for(const h of c){const c=h.uniqueId;A.dependsOn.set(c,new Set),A.dependedBy.set(c,new Set)}for(const h of c){const c=h.uniqueId,o=A.dependsOn.get(c);if(h instanceof X.c){const t=h.sourceMesh;b.has(t.uniqueId)&&(o.add(t.uniqueId),A.dependedBy.get(t.uniqueId).add(c))}const t=A.dependedBy.get(c);for(const n of h.getDescendants()){const o=n.uniqueId;if(b.has(o)){t.add(o);A.dependsOn.get(o).add(c)}}}const o=[],t=[];for(const h of c){const c=h.uniqueId;0===A.dependsOn.get(c).size&&(t.push(h),b.delete(c))}const n=t;for(;n.length>0;){const c=n.shift();o.push(c);const t=A.dependedBy.get(c.uniqueId);for(const o of Array.from(t.values())){const t=A.dependsOn.get(o);t.delete(c.uniqueId),0===t.size&&b.get(o)&&(n.push(b.get(o)),b.delete(o))}}return b.size>0&&(C.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((c=>{C.c.Error(c.name)}))),o}_addNodeAndDescendantsToList(c,b,A,o){if(A&&(!o||o(A))&&!b.has(A.uniqueId)){c.push(A),b.add(A.uniqueId);for(const t of A.getDescendants(!0))this._addNodeAndDescendantsToList(c,b,t,o)}}_isNodeInContainer(c){return c instanceof L.d&&-1!==this.meshes.indexOf(c)||(c instanceof s.e&&-1!==this.transformNodes.indexOf(c)||(c instanceof R.e&&-1!==this.lights.indexOf(c)||c instanceof N.c&&-1!==this.cameras.indexOf(c)))}_isValidHierarchy(){for(const c of this.meshes)if(c.parent&&!this._isNodeInContainer(c.parent))return C.c.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;for(const c of this.transformNodes)if(c.parent&&!this._isNodeInContainer(c.parent))return C.c.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;for(const c of this.lights)if(c.parent&&!this._isNodeInContainer(c.parent))return C.c.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;for(const c of this.cameras)if(c.parent&&!this._isNodeInContainer(c.parent))return C.c.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(c){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||t.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const o={},n={},s=new y,L=[],C=[],J={doNotInstantiate:!0,...A},X=[],R=new Set;for(const t of this.transformNodes)null===t.parent&&this._addNodeAndDescendantsToList(X,R,t,J.predicate);for(const t of this.meshes)null===t.parent&&this._addNodeAndDescendantsToList(X,R,t,J.predicate);const N=this._topologicalSort(X),k=(A,t)=>{if(((b,A)=>{if(o[b.uniqueId]=A.uniqueId,n[A.uniqueId]=A,c&&(A.name=c(b.name)),A instanceof h.d){const c=A;if(c.morphTargetManager){const A=b.morphTargetManager;c.morphTargetManager=A.clone();for(let b=0;b<A.numTargets;b++){const t=A.getTarget(b),h=c.morphTargetManager.getTarget(b);o[t.uniqueId]=h.uniqueId,n[h.uniqueId]=h}}}})(A,t),A.parent){const c=o[A.parent.uniqueId],b=n[c];t.parent=b||A.parent}if(t.position&&A.position&&t.position.p(A.position),t.rotationQuaternion&&A.rotationQuaternion&&t.rotationQuaternion.p(A.rotationQuaternion),t.rotation&&A.rotation&&t.rotation.p(A.rotation),t.ld&&A.ld&&t.ld.p(A.ld),t.material){const h=t;if(h.material)if(b){const b=A.material;if(-1===C.indexOf(b)){let A=b.clone(c?c(b.name):"Clone of "+b.name);if(C.push(b),o[b.uniqueId]=A.uniqueId,n[A.uniqueId]=A,"MultiMaterial"===b.getClassName()){const t=b;for(const b of t.qk)b&&(A=b.clone(c?c(b.name):"Clone of "+b.name),C.push(b),o[b.uniqueId]=A.uniqueId,n[A.uniqueId]=A);t.qk=t.qk.map((c=>c&&n[o[c.uniqueId]]))}}"InstancedMesh"!==h.getClassName()&&(h.material=n[o[b.uniqueId]])}else"MultiMaterial"===h.material.getClassName()?-1===this.yd.multiMaterials.indexOf(h.material)&&this.yd.addMultiMaterial(h.material):-1===this.yd.materials.indexOf(h.material)&&this.yd.addMaterial(h.material)}null===t.parent&&s.rootNodes.push(t)};for(const t of N)if("InstancedMesh"===t.getClassName()){const c=t,b=c.sourceMesh,A=o[b.uniqueId];k(c,("number"===typeof A?n[A]:b).createInstance(c.name))}else{let c=!0;"Kk"===t.getClassName()||"Node"===t.getClassName()||t.skeleton||!t.getTotalVertices||0===t.getTotalVertices()?c=!1:J.doNotInstantiate&&(c="function"===typeof J.doNotInstantiate?!J.doNotInstantiate(t):!J.doNotInstantiate);const b=c?t.createInstance(`instance of ${t.name}`):t.clone(`Clone of ${t.name}`,null,!0);if(!b)throw new Error(`Could not clone or instantiate node on Asset Container ${t.name}`);k(t,b)}for(const t of this.skeletons){if(J.predicate&&!J.predicate(t))continue;const b=t.clone(c?c(t.name):"Clone of "+t.name);for(const c of this.meshes)if(c.skeleton===t&&!c.isAnInstance){const A=n[o[c.uniqueId]];if(!A||A.isAnInstance)continue;if(A.skeleton=b,-1!==L.indexOf(b))continue;L.push(b);for(const c of b.bones)c._linkedTransformNode&&(c._linkedTransformNode=n[o[c._linkedTransformNode.uniqueId]])}s.skeletons.push(b)}for(const t of this.animationGroups){if(J.predicate&&!J.predicate(t))continue;const b=t.clone(c?c(t.name):"Clone of "+t.name,(c=>n[o[c.uniqueId]]||c));s.animationGroups.push(b)}return s}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||t.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.yd.environmentTexture=this.environmentTexture);for(const c of this.yd._serializableComponents)c.addFromContainer(this);this.yd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];for(const A of this.cameras)c&&!c(A)||(this.yd.addCamera(A),b.push(A));for(const A of this.lights)c&&!c(A)||(this.yd.addLight(A),b.push(A));for(const A of this.meshes)c&&!c(A)||(this.yd.vk(A),b.push(A));for(const A of this.skeletons)c&&!c(A)||this.yd.addSkeleton(A);for(const A of this.animations)c&&!c(A)||this.yd.addAnimation(A);for(const A of this.animationGroups)c&&!c(A)||this.yd.addAnimationGroup(A);for(const A of this.multiMaterials)c&&!c(A)||this.yd.addMultiMaterial(A);for(const A of this.materials)c&&!c(A)||this.yd.addMaterial(A);for(const A of this.morphTargetManagers)c&&!c(A)||this.yd.addMorphTargetManager(A);for(const A of this.geometries)c&&!c(A)||this.yd.addGeometry(A);for(const A of this.transformNodes)c&&!c(A)||(this.yd.addTransformNode(A),b.push(A));for(const A of this.actionManagers)c&&!c(A)||this.yd.addActionManager(A);for(const A of this.textures)c&&!c(A)||this.yd.addTexture(A);for(const A of this.reflectionProbes)c&&!c(A)||this.yd.addReflectionProbe(A);for(const A of b)A.parent&&-1===this.yd.getNodes().indexOf(A.parent)&&(A.setParent?A.setParent(null):A.parent=null)}removeAllFromScene(){this._isValidHierarchy()||t.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.yd.environmentTexture&&(this.yd.environmentTexture=null);for(const c of this.yd._serializableComponents)c.removeFromContainer(this)}removeFromScene(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const b of this.cameras)c&&!c(b)||this.yd.removeCamera(b);for(const b of this.lights)c&&!c(b)||this.yd.removeLight(b);for(const b of this.meshes)c&&!c(b)||this.yd.wk(b,!0);for(const b of this.skeletons)c&&!c(b)||this.yd.removeSkeleton(b);for(const b of this.animations)c&&!c(b)||this.yd.removeAnimation(b);for(const b of this.animationGroups)c&&!c(b)||this.yd.removeAnimationGroup(b);for(const b of this.multiMaterials)c&&!c(b)||this.yd.removeMultiMaterial(b);for(const b of this.materials)c&&!c(b)||this.yd.removeMaterial(b);for(const b of this.morphTargetManagers)c&&!c(b)||this.yd.removeMorphTargetManager(b);for(const b of this.geometries)c&&!c(b)||this.yd.removeGeometry(b);for(const b of this.transformNodes)c&&!c(b)||this.yd.removeTransformNode(b);for(const b of this.actionManagers)c&&!c(b)||this.yd.removeActionManager(b);for(const b of this.textures)c&&!c(b)||this.yd.removeTexture(b);for(const b of this.reflectionProbes)c&&!c(b)||this.yd.removeReflectionProbe(b)}dispose(){const c=this.cameras.slice(0);for(const N of c)N.dispose();this.cameras.length=0;const b=this.lights.slice(0);for(const N of b)N.dispose();this.lights.length=0;const A=this.meshes.slice(0);for(const N of A)N.dispose();this.meshes.length=0;const o=this.skeletons.slice(0);for(const N of o)N.dispose();this.skeletons.length=0;const t=this.animationGroups.slice(0);for(const N of t)N.dispose();this.animationGroups.length=0;const n=this.multiMaterials.slice(0);for(const N of n)N.dispose();this.multiMaterials.length=0;const h=this.materials.slice(0);for(const N of h)N.dispose();this.materials.length=0;const s=this.geometries.slice(0);for(const N of s)N.dispose();this.geometries.length=0;const L=this.transformNodes.slice(0);for(const N of L)N.dispose();this.transformNodes.length=0;const C=this.actionManagers.slice(0);for(const N of C)N.dispose();this.actionManagers.length=0;const J=this.textures.slice(0);for(const N of J)N.dispose();this.textures.length=0;const X=this.reflectionProbes.slice(0);for(const N of X)N.dispose();this.reflectionProbes.length=0;const R=this.morphTargetManagers.slice(0);for(const N of R)N.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const N of this.yd._serializableComponents)N.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.yd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(c,b,A){if(c&&b)for(const o of c){let c=!0;if(A)for(const b of A)if(o===b){c=!1;break}c&&(b.push(o),o._parentContainer=this)}}moveAllFromScene(c){this._wasAddedToScene=!1,void 0===c&&(c=new V);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.yd[b],this[b],c[b]));this.environmentTexture=this.yd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const c=new h.d("assetContainerRootMesh",this.yd);for(const b of this.meshes)b.parent||c.addChild(b);return this.meshes.unshift(c),c}mergeAnimationsTo(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.c.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!c)return C.c.Error("No scene available to merge animations to"),[];const o=A||(b=>{let A=null;const o=b.animations.length?b.animations[0].targetProperty:"",t=b.name.split(".").join("").split("_primitive")[0];switch(o){case"position":case"rotationQuaternion":A=c.getTransformNodeByName(b.name)||c.getTransformNodeByName(t);break;case"influence":A=c.getMorphTargetByName(b.name)||c.getMorphTargetByName(t);break;default:A=c.getNodeByName(b.name)||c.getNodeByName(t)}return A}),t=this.getNodes();for(const s of t){const c=o(s);if(null!==c){for(const b of s.animations){const A=c.animations.filter((c=>c.targetProperty===b.targetProperty));for(const b of A){const A=c.animations.indexOf(b,0);A>-1&&c.animations.splice(A,1)}}c.animations=c.animations.concat(s.animations)}}const n=[],h=this.animationGroups.slice();for(const s of h){n.push(s.clone(s.name,o));for(const c of s.animatables)c.stop()}for(const s of b){const b=o(s.target);b&&(c.beginAnimation(b,s.fromFrame,s.toFrame,s.loopAnimation,s.speedRatio,s.onAnimationEnd?s.onAnimationEnd:void 0,void 0,!0,void 0,s.onAnimationLoop?s.onAnimationLoop:void 0),c.stopAnimation(s.target))}return n}populateRootNodes(){this.rootNodes.length=0;for(const c of this.meshes)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c);for(const c of this.transformNodes)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c);for(const c of this.lights)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c);for(const c of this.cameras)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c)}addAllAssetsToContainer(c){if(!c)return;const b=[],A=new Set;for(b.push(c);b.length>0;){const c=b.pop();if(c instanceof h.d?(c.mk&&-1===this.geometries.indexOf(c.mk)&&this.geometries.push(c.mk),this.meshes.push(c)):c instanceof X.c?this.meshes.push(c):c instanceof s.e?this.transformNodes.push(c):c instanceof R.e?this.lights.push(c):c instanceof N.c&&this.cameras.push(c),c instanceof L.d){if(c.material&&-1===this.materials.indexOf(c.material)){this.materials.push(c.material);for(const b of c.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}c.skeleton&&-1===this.skeletons.indexOf(c.skeleton)&&this.skeletons.push(c.skeleton),c.morphTargetManager&&-1===this.morphTargetManagers.indexOf(c.morphTargetManager)&&this.morphTargetManagers.push(c.morphTargetManager)}for(const o of c.getChildren())A.has(o)||b.push(o);A.add(c)}this.populateRootNodes()}_getByTags(c,b,A){if(void 0===b)return c;const o=[];for(const t in c){const n=c[t];k.d&&k.d.MatchesQuery(n,b)&&(!A||A(n))&&o.push(n)}return o}getMeshesByTags(c,b){return this._getByTags(this.meshes,c,b)}getCamerasByTags(c,b){return this._getByTags(this.cameras,c,b)}getLightsByTags(c,b){return this._getByTags(this.lights,c,b)}getMaterialsByTags(c,b){return this._getByTags(this.materials,c,b).concat(this._getByTags(this.multiMaterials,c,b))}getTransformNodesByTags(c,b){return this._getByTags(this.transformNodes,c,b)}}var F=A(566);class M{constructor(c){this.byteOffset=0,this.buffer=c}async loadAsync(c){const b=await this.buffer.readAsync(this.byteOffset,c);this._dataView=new DataView(b.buffer,b.byteOffset,b.byteLength),this._dataByteOffset=0}readUint32(){const c=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,c}readUint8Array(c){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,c);return this._dataByteOffset+=c,this.byteOffset+=c,b}readString(c){return(0,F.h)(this.readUint8Array(c))}skipBytes(c){this._dataByteOffset+=c,this.byteOffset+=c}}var W=A(12711);const d="Z2xURg",r={name:"Lk",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:c=>-1!==c.indexOf("asset")&&-1!==c.indexOf("version")||c.startsWith("data:base64,"+d)||c.startsWith("data:;base64,"+d)||c.startsWith("data:application/octet-stream;base64,"+d)||c.startsWith("data:model/gltf-binary;base64,"+d)};var z,Y,D,f=A(552),v=A(557);function G(c,b,A){try{return Promise.resolve(new Uint8Array(c,b,A))}catch(o){return Promise.reject(o)}}!function(c){c[c.AUTO=0]="AUTO",c[c.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(z||(z={})),function(c){c[c.NONE=0]="NONE",c[c.FIRST=1]="FIRST",c[c.ALL=2]="ALL"}(Y||(Y={})),function(c){c[c.LOADING=0]="LOADING",c[c.READY=1]="READY",c[c.COMPLETE=2]="COMPLETE"}(D||(D={}));class P{constructor(){this.coordinateSystemMode=z.AUTO,this.animationStartMode=Y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=c=>Promise.resolve(c),this.extensionOptions={}}p(c){c&&(this.onParsed=c.onParsed,this.coordinateSystemMode=c.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=c.animationStartMode??this.animationStartMode,this.loadNodeAnimations=c.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=c.loadSkins??this.loadSkins,this.loadMorphTargets=c.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=c.compileMaterials??this.compileMaterials,this.useClipPlane=c.useClipPlane??this.useClipPlane,this.compileShadowGenerators=c.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=c.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=c.useRangeRequests??this.useRangeRequests,this.createInstances=c.createInstances??this.createInstances,this.alwaysComputeBoundingBox=c.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=c.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=c.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=c.skipMaterials??this.skipMaterials,this.useSRGBBuffers=c.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=c.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=c.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=c.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=c.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=c.customRootNode,this.onMeshLoaded=c.onMeshLoaded,this.onSkinLoaded=c.onSkinLoaded,this.onTextureLoaded=c.onTextureLoaded,this.onMaterialLoaded=c.onMaterialLoaded,this.onCameraLoaded=c.onCameraLoaded,this.extensionOptions=c.extensionOptions??this.extensionOptions)}}class O extends P{constructor(c){super(),this.onParsedObservable=new o.b,this.onMeshLoadedObservable=new o.b,this.onSkinLoadedObservable=new o.b,this.onTextureLoadedObservable=new o.b,this.onMaterialLoadedObservable=new o.b,this.onCameraLoadedObservable=new o.b,this.onCompleteObservable=new o.b,this.onErrorObservable=new o.b,this.fk=new o.b,this.onExtensionLoadedObservable=new o.b,this.validate=!1,this.onValidatedObservable=new o.b,this._loader=null,this._state=null,this._requests=new Array,this.name=r.name,this.extensions=r.extensions,this.onLoaderStateChangedObservable=new o.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(c)}set onParsed(c){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),c&&(this._onParsedObserver=this.onParsedObservable.add(c))}set onMeshLoaded(c){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),c&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(c))}set onSkinLoaded(c){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),c&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>c(b.node,b.skinnedNode))))}set onTextureLoaded(c){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),c&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(c))}set onMaterialLoaded(c){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),c&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(c))}set onCameraLoaded(c){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),c&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(c))}set onComplete(c){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(c)}set onError(c){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(c)}set onDispose(c){this._onDisposeObserver&&this.fk.remove(this._onDisposeObserver),this._onDisposeObserver=this.fk.add(c)}set onExtensionLoaded(c){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(c)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(c){this._loggingEnabled!==c&&(this._loggingEnabled=c,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(c){this._capturePerformanceCounters!==c&&(this._capturePerformanceCounters=c,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(c){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(c)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const c of this._requests)c.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=c=>Promise.resolve(c),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.fk.notifyObservers(void 0),this.fk.clear()}loadFile(c,b,A,n,h,s,L,J){if(ArrayBuffer.isView(b))return this._loadBinary(c,b,A,n,L,J),null;this._progressCallback=h;const X=b.name||t.d.GetFilename(b);if(s){if(this.useRangeRequests){this.validate&&C.c.Warn("glTF validation is not supported when range requests are enabled");const A={abort:()=>{},onCompleteObservable:new o.b},t={readAsync:(A,o)=>new Promise(((t,n)=>{this._loadFile(c,b,(c=>{t(new Uint8Array(c))}),!0,(c=>{n(c)}),(c=>{c.setRequestHeader("Range",`bytes=${A}-${A+o-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new M(t)).then((c=>{A.onCompleteObservable.notifyObservers(A),n(c)}),L?c=>L(void 0,c):void 0),A}return this._loadFile(c,b,(b=>{this._validate(c,new Uint8Array(b,0,b.byteLength),A,X),this._unpackBinaryAsync(new M({readAsync:(c,A)=>G(b,c,A),byteLength:b.byteLength})).then((c=>{n(c)}),L?c=>L(void 0,c):void 0)}),!0,L)}return this._loadFile(c,b,(b=>{try{this._validate(c,b,A,X),n({json:this._parseJson(b)})}catch{L&&L()}}),!1,L)}_loadBinary(c,b,A,o,t,n){this._validate(c,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),A,n),this._unpackBinaryAsync(new M({readAsync:(c,A)=>function(c,b,A){try{if(b<0||b>=c.byteLength)throw new RangeError("Offset is out of range.");if(b+A>c.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(c.buffer,c.byteOffset+b,A))}catch(o){return Promise.reject(o)}}(b,c,A),byteLength:b.byteLength})).then((c=>{o(c)}),t?c=>t(void 0,c):void 0)}importMeshAsync(c,b,A,o,t,n){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${n||""}`),this._loader=this._getLoader(A),this._loader.importMeshAsync(c,b,null,A,o,t,n))))}loadAsync(c,b,A,o,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(c,b,A,o,t))))}loadAssetContainerAsync(c,b,A,o,t){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(b);const n=new j(c),h=[];this.onMaterialLoadedObservable.add((c=>{h.push(c)}));const s=[];this.onTextureLoadedObservable.add((c=>{s.push(c)}));const L=[];this.onCameraLoadedObservable.add((c=>{L.push(c)}));const C=[];return this.onMeshLoadedObservable.add((c=>{c.morphTargetManager&&C.push(c.morphTargetManager)})),this._loader.importMeshAsync(null,c,n,b,A,o,t).then((c=>(Array.prototype.push.apply(n.geometries,c.geometries),Array.prototype.push.apply(n.meshes,c.meshes),Array.prototype.push.apply(n.xk,c.xk),Array.prototype.push.apply(n.skeletons,c.skeletons),Array.prototype.push.apply(n.animationGroups,c.animationGroups),Array.prototype.push.apply(n.materials,h),Array.prototype.push.apply(n.textures,s),Array.prototype.push.apply(n.lights,c.lights),Array.prototype.push.apply(n.transformNodes,c.transformNodes),Array.prototype.push.apply(n.cameras,L),Array.prototype.push.apply(n.morphTargetManagers,C),n)))}))}canDirectLoad(c){return r.canDirectLoad(c)}directLoad(c,b){if(b.startsWith("base64,"+d)||b.startsWith(";base64,"+d)||b.startsWith("application/octet-stream;base64,"+d)||b.startsWith("model/gltf-binary;base64,"+d)){const A=(0,f.d)(b);return this._validate(c,new Uint8Array(A,0,A.byteLength)),this._unpackBinaryAsync(new M({readAsync:(c,b)=>G(A,c,b),byteLength:A.byteLength}))}return this._validate(c,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(c){return new O(c[r.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((c,b)=>{this.onCompleteObservable.addOnce((()=>{c()})),this.onErrorObservable.addOnce((c=>{b(c)}))}))}_setState(c){this._state!==c&&(this._state=c,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(D[this._state]))}_loadFile(c,b,A,o,t,n){const h=c._loadFile(b,A,(c=>{this._onProgress(c,h)}),!0,o,t,n);return h.onCompleteObservable.add((()=>{h._lengthComputable=!0,h._total=h._loaded})),this._requests.push(h),h}_onProgress(c,b){if(!this._progressCallback)return;b._lengthComputable=c.lengthComputable,b._loaded=c.loaded,b._total=c.total;let A=!0,o=0,t=0;for(const n of this._requests){if(void 0===n._lengthComputable||void 0===n._loaded||void 0===n._total)return;A=A&&n._lengthComputable,o+=n._loaded,t+=n._total}this._progressCallback({lengthComputable:A,loaded:o,total:A?t:0})}_validate(c,b){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),W.d.ValidateAsync(b,A,o,(b=>this.preprocessUrlAsync(A+b).then((b=>c._loadFileAsync(b,void 0,!0,!0).then((c=>new Uint8Array(c,0,c.byteLength))))))).then((c=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(c),this.onValidatedObservable.clear()}),(c=>{this._endPerformanceCounter("Validate JSON"),t.d.Warn(`Failed to validate: ${c.message}`),this.onValidatedObservable.clear()})))}_getLoader(c){const b=c.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const A=O._parseVersion(b.version);if(!A)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const c=O._parseVersion(b.minVersion);if(!c)throw new Error("Invalid minimum version: "+b.minVersion);if(O._compareVersion(c,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const o={1:O._CreateGLTF1Loader,2:O._CreateGLTF2Loader}[A.major];if(!o)throw new Error("Unsupported version: "+b.version);return o(this)}_parseJson(c){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${c.length}`);const b=JSON.parse(c);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(c){return this._startPerformanceCounter("Unpack Binary"),c.loadAsync(20).then((()=>{const b=c.readUint32();if(1179937895!==b)throw new v.h("Unexpected magic: "+b,v.e.GLTFLoaderUnexpectedMagicError);const A=c.readUint32();this.loggingEnabled&&this._log(`Binary version: ${A}`);const o=c.readUint32();let t;switch(this.useRangeRequests||o===c.buffer.byteLength||C.c.Warn(`Length in header does not match actual data length: ${o} != ${c.buffer.byteLength}`),A){case 1:t=this._unpackBinaryV1Async(c,o);break;case 2:t=this._unpackBinaryV2Async(c,o);break;default:throw new Error("Unsupported version: "+A)}return this._endPerformanceCounter("Unpack Binary"),t}))}_unpackBinaryV1Async(c,b){const A=c.readUint32(),o=c.readUint32();if(0!==o)throw new Error(`Unexpected content format: ${o}`);const t=b-c.byteOffset,n={json:this._parseJson(c.readString(A)),bin:null};if(0!==t){const b=c.byteOffset;n.bin={readAsync:(A,o)=>c.buffer.readAsync(b+A,o),byteLength:t}}return Promise.resolve(n)}_unpackBinaryV2Async(c,b){const A=1313821514,o=5130562,t=c.readUint32();if(c.readUint32()!==A)throw new Error("First chunk format is not JSON");return c.byteOffset+t===b?c.loadAsync(t).then((()=>({json:this._parseJson(c.readString(t)),bin:null}))):c.loadAsync(t+8).then((()=>{const n={json:this._parseJson(c.readString(t)),bin:null},h=()=>{const t=c.readUint32();switch(c.readUint32()){case A:throw new Error("Unexpected JSON chunk");case o:{const b=c.byteOffset;n.bin={readAsync:(A,o)=>c.buffer.readAsync(b+A,o),byteLength:t},c.skipBytes(t);break}default:c.skipBytes(t)}return c.byteOffset!==b?c.loadAsync(8).then(h):Promise.resolve(n)};return h()}))}static _parseVersion(c){if("1.0"===c||"1.0.1"===c)return{major:1,minor:0};const b=(c+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(c,b){return c.major>b.major?1:c.major<b.major?-1:c.minor>b.minor?1:c.minor<b.minor?-1:0}_logOpen(c){this._log(c),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(c){const b=O._logSpaces.substring(0,2*this._logIndentLevel);C.c.Log(`${b}${c}`)}_logDisabled(c){}_startPerformanceCounterEnabled(c){t.d.StartPerformanceCounter(c)}_startPerformanceCounterDisabled(c){}_endPerformanceCounterEnabled(c){t.d.EndPerformanceCounter(c)}_endPerformanceCounterDisabled(c){}}O.IncrementalLoading=!0,O.HomogeneousCoordinates=!1,O._logSpaces="                                ",(0,n.b)(new O)},12711:(c,b,A)=>{"use strict";A.d(b,{d:()=>h});var o=A(525);function t(c,b,A,o){const t={externalResourceFunction:o};return A&&(t.uri="file:"===b?A:b+A),ArrayBuffer.isView(c)?GLTFValidator.validateBytes(c,t):GLTFValidator.validateString(c,t)}function n(){const c=[];onmessage=b=>{const A=b.data;switch(A.id){case"init":importScripts(A.url);break;case"validate":t(A.data,A.rootUrl,A.fileName,(b=>new Promise(((A,o)=>{const t=c.length;c.push({resolve:A,reject:o}),postMessage({id:"getExternalResource",index:t,uri:b})})))).then((c=>{postMessage({id:"validate.resolve",value:c})}),(c=>{postMessage({id:"validate.reject",reason:c})}));break;case"getExternalResource.resolve":c[A.index].resolve(A.value);break;case"getExternalResource.reject":c[A.index].reject(A.reason)}}}class h{static ValidateAsync(c,b,A,h){return"function"===typeof Worker?new Promise(((s,L)=>{const C=`${t}(${n})()`,J=URL.createObjectURL(new Blob([C],{type:"application/javascript"})),X=new Worker(J),R=c=>{X.removeEventListener("error",R),X.removeEventListener("message",N),L(c)},N=c=>{const b=c.data;switch(b.id){case"getExternalResource":h(b.uri).then((c=>{X.postMessage({id:"getExternalResource.resolve",index:b.index,value:c},[c.buffer])}),(c=>{X.postMessage({id:"getExternalResource.reject",index:b.index,reason:c})}));break;case"validate.resolve":X.removeEventListener("error",R),X.removeEventListener("message",N),s(b.value),X.terminate();break;case"validate.reject":X.removeEventListener("error",R),X.removeEventListener("message",N),L(b.reason),X.terminate()}};if(X.addEventListener("error",R),X.addEventListener("message",N),X.postMessage({id:"init",url:o.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(c)){const o=c.slice();X.postMessage({id:"validate",data:o,rootUrl:b,fileName:A},[o.buffer])}else X.postMessage({id:"validate",data:c,rootUrl:b,fileName:A})})):(this._LoadScriptPromise||(this._LoadScriptPromise=o.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>t(c,b,A,h))))}}h.Configuration={url:`${o.d._DefaultCdnUrl}/gltf_validator.js`}},13057:(c,b,A)=>{"use strict";A.d(b,{c:()=>r});var o=A(672),t=A(674),n=A(714),h=A(688),s=A(11862),L=A(11872),C=A(747),J=A(2186),X=A(633),R=A(601);A(12487),A(12389),A(12407),A(12392),A(12414),A(12420),A(12425);const N="imageProcessingCompatibility",k="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";R.e.IncludesShadersStore[N]||(R.e.IncludesShadersStore[N]=k);const E="skyPixelShader",V="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";R.e.ShadersStore[E]||(R.e.ShadersStore[E]=V);A(12497),A(12431),A(12436),A(12450),A(12442);const y="skyVertexShader",j="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";R.e.ShadersStore[y]||(R.e.ShadersStore[y]=j);var F=A(11885),M=A(867),W=A(860);class d extends s.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class r extends L.e{constructor(c,b){super(c,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new h.k(0,100,0),this.useSunPosition=!1,this.cameraOffset=h.k.Zero(),this.up=h.k.Up(),this.dithering=!1,this._cameraPosition=h.k.Zero(),this._skyOrientation=new h.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(c,b){const A=b._drawWrapper;if(this.isFrozen&&A.effect&&A._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new d);const o=b.materialDefines,t=this.va();if(this._isReadyForSubMesh(b))return!0;if((0,W.X)(c,t,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,o),(0,W.K)(c,o,!0,!1),o.IMAGEPROCESSINGPOSTPROCESS!==t.imageProcessingConfiguration.applyByPostProcess&&o.markAsMiscDirty(),o.DITHER!==this.dithering&&o.markAsMiscDirty(),o.isDirty){o.markAsProcessed(),t.resetCachedMaterial();const c=new F.b;o.FOG&&c.addFallback(1,"FOG"),o.IMAGEPROCESSINGPOSTPROCESS=t.imageProcessingConfiguration.applyByPostProcess,o.DITHER=this.dithering;const A=[C.f.PositionKind];o.VERTEXCOLOR&&A.push(C.f.ColorKind);const n="sky",h=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,M.e)(h);const s=o.toString();b.setEffect(t.getEngine().createEffect(n,A,h,[],s,c,this.onCompiled,this.onError),o,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(o._renderId=t.getRenderId(),A._wasPreviouslyReady=!0,!0)}bindForSubMesh(c,b,A){const o=this.va(),t=A.materialDefines;if(!t)return;const n=A.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(c),this._activeEffect.setMatrix("viewProjection",o.getTransformMatrix()),this._mustRebind(o,n,A)&&((0,M.g)(n,this,o),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,W.i)(t,n,o)),o.fogEnabled&&b.applyFog&&o.fogMode!==J.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",o.getViewMatrix()),(0,W.e)(o,b,this._activeEffect);const s=o.activeCamera;if(s){const c=s.getWorldMatrix();this._cameraPosition.x=c.m[12],this._cameraPosition.y=c.m[13],this._cameraPosition.z=c.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const c=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(c),this.sunPosition.y=this.distance*Math.sin(-c),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(c),h.e.FromUnitVectorsToRef(h.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,A)}getAnimatables(){return[]}dispose(c){super.dispose(c)}clone(c){return n.c.Clone((()=>new r(c,this.va())),this)}serialize(){const c=super.serialize();return c.customType="BABYLON.SkyMaterial",c}getClassName(){return"SkyMaterial"}static Parse(c,b,A){return n.c.Parse((()=>new r(c.name,b)),c,b,A)}}(0,o.e)([(0,t.J)()],r.prototype,"luminance",void 0),(0,o.e)([(0,t.J)()],r.prototype,"turbidity",void 0),(0,o.e)([(0,t.J)()],r.prototype,"rayleigh",void 0),(0,o.e)([(0,t.J)()],r.prototype,"mieCoefficient",void 0),(0,o.e)([(0,t.J)()],r.prototype,"mieDirectionalG",void 0),(0,o.e)([(0,t.J)()],r.prototype,"distance",void 0),(0,o.e)([(0,t.J)()],r.prototype,"inclination",void 0),(0,o.e)([(0,t.J)()],r.prototype,"azimuth",void 0),(0,o.e)([(0,t.I)()],r.prototype,"sunPosition",void 0),(0,o.e)([(0,t.J)()],r.prototype,"useSunPosition",void 0),(0,o.e)([(0,t.I)()],r.prototype,"cameraOffset",void 0),(0,o.e)([(0,t.I)()],r.prototype,"up",void 0),(0,o.e)([(0,t.J)()],r.prototype,"dithering",void 0),(0,X.d)("BABYLON.SkyMaterial",r)},11994:(c,b,A)=>{"use strict";function o(c,b){b.headers=c.headers||{},b.statusMessage=c.statusText,b.statusCode=c.status,b.data=c.response}function t(c,b,A){return new Promise((function(t,n){A=A||{};var h,s,L,C=new XMLHttpRequest,J=A.body,X=A.headers||{};for(h in A.timeout&&(C.timeout=A.timeout),C.ontimeout=C.onerror=function(c){c.timeout="timeout"==c.type,n(c)},C.open(c,b.href||b),C.onload=function(){for(L=C.getAllResponseHeaders().trim().split(/[\r\n]+/),o(C,C);s=L.shift();)s=s.split(": "),C.headers[s.shift().toLowerCase()]=s.join(": ");if((s=C.headers["content-type"])&&~s.indexOf("application/json"))try{C.data=JSON.parse(C.data,A.reviver)}catch(c){return o(C,c),n(c)}(C.status>=400?n:t)(C)},typeof FormData<"u"&&J instanceof FormData||J&&"object"==typeof J&&(X["content-type"]="application/json",J=JSON.stringify(J)),C.withCredentials=!!A.withCredentials,X)C.setRequestHeader(h,X[h]);C.send(J)}))}A.r(b),A.d(b,{del:()=>L,get:()=>n,patch:()=>s,post:()=>h,put:()=>C,send:()=>t});var n=t.bind(t,"GET"),h=t.bind(t,"POST"),s=t.bind(t,"PATCH"),L=t.bind(t,"DELETE"),C=t.bind(t,"PUT")},13170:(c,b,A)=>{"use strict";A.d(b,{c:()=>X});const o=.5*(Math.sqrt(3)-1),t=(3-Math.sqrt(3))/6,n=1/3,h=1/6,s=(Math.sqrt(5)-1)/4,L=(5-Math.sqrt(5))/20,C=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),J=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const X=class{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof c?c:function(c){let b=0,A=0,o=0,t=1;const n=function(){let c=4022871197;return function(b){b=b.toString();for(let A=0;A<b.length;A++){c+=b.charCodeAt(A);let o=.02519603282416938*c;c=o>>>0,o-=c,o*=c,c=o>>>0,o-=c,c+=4294967296*o}return 2.3283064365386963e-10*(c>>>0)}}();b=n(" "),A=n(" "),o=n(" "),b-=n(c),b<0&&(b+=1);A-=n(c),A<0&&(A+=1);o-=n(c),o<0&&(o+=1);return function(){const c=2091639*b+2.3283064365386963e-10*t;return b=A,A=o,o=c-(t=0|c)}}(c);this.p=function(c){const b=new Uint8Array(256);for(let A=0;A<256;A++)b[A]=A;for(let A=0;A<255;A++){const o=A+~~(c()*(256-A)),t=b[A];b[A]=b[o],b[o]=t}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let A=0;A<512;A++)this.perm[A]=this.p[255&A],this.permMod12[A]=this.perm[A]%12}noise2D(c,b){const A=this.permMod12,n=this.perm;let h=0,s=0,L=0;const J=(c+b)*o,X=Math.floor(c+J),R=Math.floor(b+J),N=(X+R)*t,k=c-(X-N),E=b-(R-N);let V,y;k>E?(V=1,y=0):(V=0,y=1);const j=k-V+t,F=E-y+t,M=k-1+2*t,W=E-1+2*t,d=255&X,r=255&R;let z=.5-k*k-E*E;if(z>=0){const c=3*A[d+n[r]];z*=z,h=z*z*(C[c]*k+C[c+1]*E)}let Y=.5-j*j-F*F;if(Y>=0){const c=3*A[d+V+n[r+y]];Y*=Y,s=Y*Y*(C[c]*j+C[c+1]*F)}let D=.5-M*M-W*W;if(D>=0){const c=3*A[d+1+n[r+1]];D*=D,L=D*D*(C[c]*M+C[c+1]*W)}return 70*(h+s+L)}noise3D(c,b,A){const o=this.permMod12,t=this.perm;let s,L,J,X;const R=(c+b+A)*n,N=Math.floor(c+R),k=Math.floor(b+R),E=Math.floor(A+R),V=(N+k+E)*h,y=c-(N-V),j=b-(k-V),F=A-(E-V);let M,W,d,r,z,Y;y>=j?j>=F?(M=1,W=0,d=0,r=1,z=1,Y=0):y>=F?(M=1,W=0,d=0,r=1,z=0,Y=1):(M=0,W=0,d=1,r=1,z=0,Y=1):j<F?(M=0,W=0,d=1,r=0,z=1,Y=1):y<F?(M=0,W=1,d=0,r=0,z=1,Y=1):(M=0,W=1,d=0,r=1,z=1,Y=0);const D=y-M+h,f=j-W+h,v=F-d+h,G=y-r+2*h,P=j-z+2*h,O=F-Y+2*h,p=y-1+.5,q=j-1+.5,I=F-1+.5,K=255&N,Z=255&k,H=255&E;let S=.6-y*y-j*j-F*F;if(S<0)s=0;else{const c=3*o[K+t[Z+t[H]]];S*=S,s=S*S*(C[c]*y+C[c+1]*j+C[c+2]*F)}let B=.6-D*D-f*f-v*v;if(B<0)L=0;else{const c=3*o[K+M+t[Z+W+t[H+d]]];B*=B,L=B*B*(C[c]*D+C[c+1]*f+C[c+2]*v)}let Q=.6-G*G-P*P-O*O;if(Q<0)J=0;else{const c=3*o[K+r+t[Z+z+t[H+Y]]];Q*=Q,J=Q*Q*(C[c]*G+C[c+1]*P+C[c+2]*O)}let a=.6-p*p-q*q-I*I;if(a<0)X=0;else{const c=3*o[K+1+t[Z+1+t[H+1]]];a*=a,X=a*a*(C[c]*p+C[c+1]*q+C[c+2]*I)}return 32*(s+L+J+X)}noise4D(c,b,A,o){const t=this.perm;let n,h,C,X,R;const N=(c+b+A+o)*s,k=Math.floor(c+N),E=Math.floor(b+N),V=Math.floor(A+N),y=Math.floor(o+N),j=(k+E+V+y)*L,F=c-(k-j),M=b-(E-j),W=A-(V-j),d=o-(y-j);let r=0,z=0,Y=0,D=0;F>M?r++:z++,F>W?r++:Y++,F>d?r++:D++,M>W?z++:Y++,M>d?z++:D++,W>d?Y++:D++;const f=r>=3?1:0,v=z>=3?1:0,G=Y>=3?1:0,P=D>=3?1:0,O=r>=2?1:0,p=z>=2?1:0,q=Y>=2?1:0,I=D>=2?1:0,K=r>=1?1:0,Z=z>=1?1:0,H=Y>=1?1:0,S=D>=1?1:0,B=F-f+L,Q=M-v+L,a=W-G+L,l=d-P+L,T=F-O+2*L,i=M-p+2*L,g=W-q+2*L,u=d-I+2*L,e=F-K+3*L,x=M-Z+3*L,U=W-H+3*L,w=d-S+3*L,m=F-1+4*L,cc=M-1+4*L,bc=W-1+4*L,Ac=d-1+4*L,oc=255&k,tc=255&E,nc=255&V,hc=255&y;let sc=.6-F*F-M*M-W*W-d*d;if(sc<0)n=0;else{const c=t[oc+t[tc+t[nc+t[hc]]]]%32*4;sc*=sc,n=sc*sc*(J[c]*F+J[c+1]*M+J[c+2]*W+J[c+3]*d)}let Lc=.6-B*B-Q*Q-a*a-l*l;if(Lc<0)h=0;else{const c=t[oc+f+t[tc+v+t[nc+G+t[hc+P]]]]%32*4;Lc*=Lc,h=Lc*Lc*(J[c]*B+J[c+1]*Q+J[c+2]*a+J[c+3]*l)}let Cc=.6-T*T-i*i-g*g-u*u;if(Cc<0)C=0;else{const c=t[oc+O+t[tc+p+t[nc+q+t[hc+I]]]]%32*4;Cc*=Cc,C=Cc*Cc*(J[c]*T+J[c+1]*i+J[c+2]*g+J[c+3]*u)}let Jc=.6-e*e-x*x-U*U-w*w;if(Jc<0)X=0;else{const c=t[oc+K+t[tc+Z+t[nc+H+t[hc+S]]]]%32*4;Jc*=Jc,X=Jc*Jc*(J[c]*e+J[c+1]*x+J[c+2]*U+J[c+3]*w)}let Xc=.6-m*m-cc*cc-bc*bc-Ac*Ac;if(Xc<0)R=0;else{const c=t[oc+1+t[tc+1+t[nc+1+t[hc+1]]]]%32*4;Xc*=Xc,R=Xc*Xc*(J[c]*m+J[c+1]*cc+J[c+2]*bc+J[c+3]*Ac)}return 27*(n+h+C+X+R)}}}}]);